<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Templating with Handlebars"><div class="chapter" id="ch_templating">
<h1><span class="label">Chapter 7. </span>Templating with Handlebars</h1>


<p><a data-type="indexterm" data-primary="templating" id="ix_ch-07-templating-asciidoc0"/>In this chapter, we’ll cover <em>templating</em>, which is a technique for
constructing and formating your content to display to the user. <a data-type="indexterm" data-primary="templating" data-secondary="basics" id="idm45053595246168"/>You can think of templating as an evolution of the form letter: “Dear
[Name]: we regret to inform you nobody uses [Outdated Technology] anymore,
but templating is alive and well!” To send that letter to a bunch of
people, you just have to replace [Name] and [Outdated Technology].</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This process of replacing fields is sometimes called <em>interpolation</em>, which
is just a fancy word for “supplying missing information” in this context.</p>
</div>

<p>While server-side templating is being fast supplanted by frontend
frameworks like React, Angular, and Vue, it still has applications, like
creating HTML email. Also, Angular and Vue both use a template-like
approach to writing HTML, so what you learn about server-side templating
will transfer to those frontend frameworks.</p>

<p>If you’re coming from a PHP background, you may wonder what the fuss is all
about: PHP is one of the first languages that could really be called a
templating language. Almost all major languages
that have been adapted for the web have included some kind of templating
support. What is different today is that the <em>templating engine</em> is being
decoupled from the language.</p>

<p>So what does templating look like? Let’s
start with what templating is replacing by considering the most obvious and
straightforward way to generate one language
 from another
(specifically, we’ll generate some HTML with JavaScript):</p>

<pre data-type="programlisting" data-code-language="js"><code class="nb">document</code><code class="p">.</code><code class="nx">write</code><code class="p">(</code><code class="s1">'&lt;h1&gt;Please Don\'t Do This&lt;/h1&gt;'</code><code class="p">)</code>
<code class="nb">document</code><code class="p">.</code><code class="nx">write</code><code class="p">(</code><code class="s1">'&lt;p&gt;&lt;span class="code"&gt;document.write&lt;/span&gt; is naughty,\n'</code><code class="p">)</code>
<code class="nb">document</code><code class="p">.</code><code class="nx">write</code><code class="p">(</code><code class="s1">'and should be avoided at all costs.&lt;/p&gt;'</code><code class="p">)</code>
<code class="nb">document</code><code class="p">.</code><code class="nx">write</code><code class="p">(</code><code class="s1">'&lt;p&gt;Today\'s date is '</code> <code class="o">+</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">()</code> <code class="o">+</code> <code class="s1">'.&lt;/p&gt;'</code><code class="p">)</code></pre>

<p>Perhaps the only reason this seems “obvious” is that it’s the way
programming has always been taught:</p>

<pre data-type="programlisting" data-code-language="basic"><code class="nl">10</code><code class="w"> </code><code class="kr">PRINT</code><code class="w"> </code><code class="s2">"Hello world!"</code></pre>

<p>In imperative languages, we’re used to saying, “Do this, then do that, then
do something else.” For some things, this approach works fine. If you
have 500 lines of JavaScript to perform a complicated calculation that
results in a single number, and every step is dependent on the previous
step, there’s no harm in it. What if it’s the other way around, though?
You have 500 lines of HTML and 3 lines of JavaScript. Does it make sense
to write <code>document.write</code> 500 times? Not at all.</p>

<p><a data-type="indexterm" data-primary="HTML" data-secondary="problems with having JavaScript emit" id="idm45053595211288"/><a data-type="indexterm" data-primary="JavaScript" data-secondary="HTML and" id="idm45053595144936"/>Really, the problem boils down to this: switching context is problematic.
If you’re writing lots of JavaScript, it’s inconvenient and confusing to be
mixing in HTML. The other way isn’t so bad. We’re quite used to writing
JavaScript in <code>&lt;script&gt;</code> blocks, but I hope you see the difference:
there’s still a context switch, and either you’re writing HTML or you’re in
a <code>&lt;script&gt;</code> block writing JavaScript. Having JavaScript emit HTML is
fraught with problems:</p>

<ul>
<li>
<p>You have to constantly worry about what characters need to be escaped and how to do that.</p>
</li>
<li>
<p>Using JavaScript to generate HTML that itself includes JavaScript quickly leads to madness.</p>
</li>
<li>
<p>You usually lose the nice syntax highlighting and other handy language-specific features your editor has.</p>
</li>
<li>
<p>It can be much harder to spot malformed HTML.</p>
</li>
<li>
<p>Your code is hard to visually parse.</p>
</li>
<li>
<p>It can make it harder for other people to understand your code.</p>
</li>
</ul>

<p>Templating solves the problem by allowing you
to write in the target language, while at the same time providing the
ability to insert dynamic data. Consider the previous example rewritten as
a Mustache template:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;h1&gt;</code>Much Better<code class="nt">&lt;/h1&gt;</code>
<code class="nt">&lt;p&gt;</code>No <code class="nt">&lt;span</code> <code class="na">class=</code><code class="s">"code"</code><code class="nt">&gt;</code>document.write<code class="nt">&lt;/span&gt;</code> here!<code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;p&gt;</code>Today's date is {{today}}.<code class="nt">&lt;/p&gt;</code></pre>

<p>Now all we have to do is provide a value for <code>{{today}}</code>,
and that’s at the heart of templating languages.</p>






<section data-type="sect1" data-pdf-bookmark="There Are No Absolute Rules Except This One"><div class="sect1" id="idm45053595110936">
<h1>There Are No Absolute Rules Except This One</h1>

<p><a data-type="indexterm" data-primary="HTML" data-secondary="templates versus" id="idm45053595109656"/><a data-type="indexterm" data-primary="templating" data-secondary="avoiding HTML" id="idm45053595108680"/>I’m not suggesting that you should <em>never</em> write HTML in JavaScript, only
that you should avoid it whenever possible. In particular, it’s slightly
more palatable in frontend code, especially if you’re using a robust frontend
framework. For example, this would pass with little comment from me:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#error'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code>
  <code class="s1">'Something &lt;b&gt;very bad&lt;/b&gt; happened!'</code></pre>

<p>However, say that eventually mutated into this:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#error'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code>
  <code class="s1">'&lt;div class="error"&gt;&lt;h3&gt;Error&lt;/h3&gt;'</code> <code class="o">+</code>
  <code class="s1">'&lt;p&gt;Something &lt;b&gt;&lt;a href="/error-detail/'</code> <code class="o">+</code> <code class="nx">errorNumber</code> <code class="o">+</code>
  <code class="s1">'"&gt;very bad&lt;/a&gt;&lt;/b&gt; '</code> <code class="o">+</code>
  <code class="s1">'happened.  &lt;a href="/try-again"&gt;Try again&lt;a&gt;, or '</code> <code class="o">+</code>
  <code class="s1">'&lt;a href="/contact"&gt;contact support&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;'</code></pre>

<p>Then I might suggest it’s time to employ a template. The point is, I suggest
you develop good judgment when deciding where to draw the line between
HTML in strings and using templates. I would err on the side of templates,
however, and avoid generating HTML with JavaScript except for the simplest
cases.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Choosing a Template Engine"><div class="sect1" id="idm45053595041112">
<h1>Choosing a Template Engine</h1>

<p><a data-type="indexterm" data-primary="templating" data-secondary="criteria for choosing a template engine" id="idm45053595039864"/>In the Node world, you have many templating engines to choose from, so how
to pick? It’s a complicated question, and very much depends on your
needs. Here are some
criteria to consider, though:</p>
<dl>
<dt>Performance</dt>
<dd>
<p>  Clearly, you want your templating engine to be as fast as possible. It’s
not something you want slowing down your website.</p>
</dd>
<dt>Client, server, or both?</dt>
<dd>
<p>  Most, but not all, templating engines are available on both the server
and client sides. If you need to use templates in both realms (and you
will), I recommend you pick something that is equally capable in either
capacity.</p>
</dd>
<dt>Abstraction</dt>
<dd>
<p>  Do you want something familiar (like normal HTML with curly brackets
thrown in, for example), or do you secretly hate HTML and would love
something that saves you from all those angle brackets? Templating
(especially server-side templating) gives you some choices here.</p>
</dd>
</dl>

<p>These are just some of the more prominent criteria in selecting a
templating language. Templating options are pretty mature at this point,
so you probably can’t go too wrong with whatever you pick.</p>

<p>Express allows you to use any templating engine you wish, so if Handlebars is
not to your liking, you’ll find it’s easy to switch it out. If you want
to explore your options, you can use the fun and useful
<a href="http://bit.ly/2CExtK0">Template-Engine-Chooser</a>
(it’s still useful even though it’s no longer being updated).</p>

<p>Let’s take a look at a particularly abstract templating engine before we get
to our discussion of Handlebars.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Pug: A Different Approach"><div class="sect1" id="idm45053595004568">
<h1>Pug: A Different Approach</h1>

<p><a data-type="indexterm" data-primary="HTML" data-secondary="Pug and" id="idm45053595003320"/><a data-type="indexterm" data-primary="Pug" id="idm45053595002344"/><a data-type="indexterm" data-primary="templating" data-secondary="Pug approach to" id="idm45053595001672"/>Whereas most templating engines take an HTML-centric approach, Pug stands
out by abstracting the details of HTML away from
you. <a data-type="indexterm" data-primary="Holowaychuk, TJ" id="idm45053595000456"/>It is also worth noting that
Pug is the brainchild of TJ Holowaychuk, the same person who brought us
Express. It should come as no surprise, then, that Pug integration with
Express is very good. The approach that Pug takes is noble: at its
core is the assertion that HTML is a fussy and tedious language to write by
hand. Let’s take a look at what a Pug template looks like, along with the
HTML it will output (originally taken from the <a href="https://pugjs.org">Pug home
page</a> and modified slightly to fit the book format):</p>

<pre data-type="programlisting">doctype html                        &lt;!DOCTYPE html&gt;
html(lang="en")                     &lt;html lang="en"&gt;
  head                              &lt;head&gt;
    title= pageTitle                &lt;title&gt;Pug Demo&lt;/title&gt;
    script.                         &lt;script&gt;
      if (foo) {                        if (foo) {
         bar(1 + 5)                         bar(1 + 5)
      }                                 }
  body                              &lt;/script&gt;
                                    &lt;body&gt;
    h1 Pug                         &lt;h1&gt;Pug&lt;/h1&gt;
    #container                      &lt;div id="container"&gt;
      if youAreUsingPug
        p You are amazing           &lt;p&gt;You are amazing&lt;/p&gt;
      else
        p Get on it!
      p.                            &lt;p&gt;
        Pug is a terse and           Pug is a terse and
        simple templating             simple templating
        language with a               language with a
        strong focus on               strong focus on
        performance and               performance and
        powerful features.            powerful features.
                                    &lt;/p&gt;
                                    &lt;/body&gt;
                                    &lt;/html&gt;</pre>

<p>Pug certainly represents a lot less typing (no more angle brackets or
closing tags). Instead, it relies on indentation and some commonsense
rules, making it easier to say what you mean. Pug has an additional
advantage: theoretically, when HTML itself changes, you can simply get Pug
to retarget the newest version of HTML, allowing you to “future proof” your
content.</p>

<p>As much as I admire the Pug philosophy and the elegance of its execution,
I’ve found that I don’t want the details of HTML abstracted away from me.
As a web developer, HTML is at the heart of everything I do, and if the
price is wearing out the angle bracket keys on my keyboard, then so be it.
A lot of frontend developers I talk to feel the same, so maybe the world
just isn’t ready for Pug.</p>

<p>Here’s where we’ll part ways with Pug; you won’t be seeing it in this book.
However, if the abstraction appeals to you, you will certainly have no
problems using Pug with Express, and there are plenty of resources to help
you do so.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Handlebars Basics"><div class="sect1" id="idm45053594994264">
<h1>Handlebars Basics</h1>

<p><a data-type="indexterm" data-primary="Handlebars" data-secondary="basics" id="ix_ch-07-templating-asciidoc1"/><em>Handlebars</em> is an extension of Mustache, another popular templating
engine. I recommend Handlebars
for its easy JavaScript integration (both frontend and backend) and
familiar syntax. For me, it strikes all the right balances and is what
we’ll be focusing on in this book. The concepts we’re discussing are
broadly applicable to other templating engines, though, so you will be well
prepared to try different templating engines if Handlebars doesn’t strike
your fancy.</p>

<p><a data-type="indexterm" data-primary="context, templating and" id="idm45053594989976"/>The key to understanding templating is understanding the concept of
<em>context</em>. <a data-type="indexterm" data-primary="context object" id="idm45053594988760"/>When you render a
template, you pass the templating engine an object called the <em>context
object</em>, and this is what allows replacements to work.</p>

<p>For example, if my context object is</p>

<pre data-type="programlisting" data-code-language="js"><code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'Buttercup'</code> <code class="p">}</code></pre>

<p>and my template is</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;p&gt;</code>Hello, {{name}}!<code class="nt">&lt;/p&gt;</code></pre>

<p>then <code>{{name}}</code> will be replaced with <code>Buttercup</code>.
What if you want to pass HTML to the template? For example, if our context
was instead</p>

<pre data-type="programlisting" data-code-language="js"><code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'&lt;b&gt;Buttercup&lt;/b&gt;'</code> <code class="p">}</code></pre>

<p>then using the previous template will result in <code>&lt;p&gt;Hello,
&amp;lt;b&amp;gt;Buttercup&amp;lt;b&amp;gt;&lt;/p&gt;</code>, which is probably not what you’re
looking for. To solve this problem, simply use three curly brackets
instead of two: <code>{{{name}}}</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>While we’ve already established that we should avoid writing HTML in
JavaScript, the ability to turn off HTML escaping with triple <span class="keep-together">curly</span> brackets has some important uses. For
example, if you were building a content management system (CMS) with what you see is what you get (WYSIWYG) editors, you would
probably want to be able to pass HTML to your views. Also, the ability to
render <span class="keep-together">properties</span> from the
context without HTML escaping is important for <em>layouts</em> and <em>sections</em>,
which we’ll learn about shortly.</p>
</div>

<p>In <a data-type="xref" href="#img_templating_rendering_view">Figure 7-1</a>, we see how the Handlebars engine uses
the context (represented by an oval) combined with the template to render
HTML.</p>

<figure><div id="img_templating_rendering_view" class="figure">
<img src="Images/bwne_0701.png" alt="Rendering HTML with Handlebars" width="1568" height="525"/>
<h6><span class="label">Figure 7-1. </span>Rendering HTML with Handlebars</h6>
</div></figure>








<section data-type="sect2" data-pdf-bookmark="Comments"><div class="sect2" id="idm45053594954280">
<h2>Comments</h2>

<p><a data-type="indexterm" data-primary="comments, in Handlebars" id="idm45053594953112"/><a data-type="indexterm" data-primary="Handlebars" data-secondary="comments" id="idm45053594952408"/><a data-type="indexterm" data-primary="templating" data-secondary="comments" id="idm45053594951464"/><em>Comments</em> <a data-type="indexterm" data-primary="{{ }} (curly brackets)" id="ix_ch-07-templating-asciidoc2"/><a data-type="indexterm" data-primary="curly brackets ({{ }})" id="ix_ch-07-templating-asciidoc3"/>in Handlebars look like <code>{{! comment goes here
}}</code>.
 It’s important to understand the distinction
between Handlebars comments and HTML comments. Consider the following
template:</p>

<pre data-type="programlisting" data-code-language="html">{{! super-secret comment }}
<code class="c">&lt;!-- not-so-secret comment --&gt;</code></pre>

<p>Assuming this is a server-side template, the super-secret comment will
never be sent to the browser, whereas the not-so-secret comment will be
visible if the user inspects the HTML source. You should prefer Handlebars
comments for anything that exposes implementation details, or anything else
you don’t want exposed.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Blocks"><div class="sect2" id="idm45053594881192">
<h2>Blocks</h2>

<p><a data-type="indexterm" data-primary="blocks, in Handlebars" id="ix_ch-07-templating-asciidoc4"/><a data-type="indexterm" data-primary="Handlebars" data-secondary="blocks in" id="ix_ch-07-templating-asciidoc5"/><a data-type="indexterm" data-primary="templating" data-secondary="blocks" id="ix_ch-07-templating-asciidoc6"/>Things start to get more complicated when you consider <em>blocks</em>.
 Blocks provide
flow control, conditional execution, and extensibility. Consider the
following context object:</p>

<pre data-type="programlisting" data-code-language="js"><code class="p">{</code>
  <code class="nx">currency</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">name</code><code class="o">:</code> <code class="s1">'United States dollars'</code><code class="p">,</code>
    <code class="nx">abbrev</code><code class="o">:</code> <code class="s1">'USD'</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="nx">tours</code><code class="o">:</code> <code class="p">[</code>
    <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'Hood River'</code><code class="p">,</code> <code class="nx">price</code><code class="o">:</code> <code class="s1">'$99.95'</code> <code class="p">},</code>
    <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'Oregon Coast'</code><code class="p">,</code> <code class="nx">price</code><code class="o">:</code> <code class="s1">'$159.95'</code> <code class="p">},</code>
  <code class="p">],</code>
  <code class="nx">specialsUrl</code><code class="o">:</code> <code class="s1">'/january-specials'</code><code class="p">,</code>
  <code class="nx">currencies</code><code class="o">:</code> <code class="p">[</code> <code class="s1">'USD'</code><code class="p">,</code> <code class="s1">'GBP'</code><code class="p">,</code> <code class="s1">'BTC'</code> <code class="p">],</code>
<code class="p">}</code></pre>

<p>Now let’s examine a template we can pass that context to:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;ul&gt;</code>
  {{#each tours}}
    {{! I'm in a new block...and the context has changed }}
    <code class="nt">&lt;li&gt;</code>
      {{name}} - {{price}}
      {{#if ../currencies}}
        ({{../currency.abbrev}})
      {{/if}}
    <code class="nt">&lt;/li&gt;</code>
  {{/each}}
<code class="nt">&lt;/ul&gt;</code>
{{#unless currencies}}
  <code class="nt">&lt;p&gt;</code>All prices in {{currency.name}}.<code class="nt">&lt;/p&gt;</code>
{{/unless}}
{{#if specialsUrl}}
  {{! I'm in a new block...but the context hasn't changed (sortof) }}
  <code class="nt">&lt;p&gt;</code>Check out our <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"{{specialsUrl}}"</code><code class="nt">&gt;</code>specials!<code class="nt">&lt;/p&gt;</code>
{{else}}
  <code class="nt">&lt;p&gt;</code>Please check back often for specials.<code class="nt">&lt;/p&gt;</code>
{{/if}}
<code class="nt">&lt;p&gt;</code>
  {{#each currencies}}
    <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"#"</code> <code class="na">class=</code><code class="s">"currency"</code><code class="nt">&gt;</code>{{.}}<code class="nt">&lt;/a&gt;</code>
  {{else}}
    Unfortunately, we currently only accept {{currency.name}}.
  {{/each}}
<code class="nt">&lt;/p&gt;</code></pre>

<p>A lot is going on in this template, so let’s break it down. It starts
off with the <code>each</code> helper, which allows us to iterate over an array.
What’s important to understand is that between <code>{{#each
tours}}</code> and <code>{{/each tours}}</code>, the context
changes. On the first pass, it changes to <code>{ name: 'Hood
River', price: '$99.95' }</code>, and on the second pass, the context is
<code>{ name: 'Oregon Coast', price: '$159.95' }</code>. So within
that block, we can refer to <code>{{name}}</code> and
<code>{{price}}</code>. However, if we want to access the
<code>currency</code> object, we have to use <code>../</code> to access the <em>parent</em> context.</p>

<p>If a property of the context is itself an object, we can access its
properties as normal with a period, such as
<code>{{currency.name}}</code>.</p>

<p>Both <code>if</code> and <code>each</code> have an optional <code>else</code> block (with <code>each</code>, if there
are no elements in the array, the <code>else</code> block will execute). We’ve also
used the <code>unless</code> helper, which is essentially the opposite of the <code>if</code>
helper: it executes only if the argument is false.</p>

<p>The last thing to note about this template is the use of
<code>{{.}}</code> in the <code>{{#each currencies}}</code>
block. <code>{{.}}</code> refers to the current context; in
this case, the current context is simply a string in an array that we want
to print out.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Accessing the current context with a lone period has another use: it can
distinguish helpers (which we’ll learn about soon) from properties of the
current context. For example, if you have a helper called <code>foo</code> and a
property in the current context called <code>foo</code>, <code>{{foo}}</code>
refers to the helper, and <code>{{./foo}}</code> refers to the
property<a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc6" id="idm45053594702376"/><a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc5" id="idm45053594701576"/>.<a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc4" id="idm45053594700760"/><a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc3" id="idm45053594700040"/><a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc2" id="idm45053594699352"/></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Server-Side Templates"><div class="sect2" id="idm45053594886584">
<h2>Server-Side Templates</h2>

<p><a data-type="indexterm" data-primary="Handlebars" data-secondary="server-side templates" id="idm45053594697256"/><a data-type="indexterm" data-primary="server-side templates" id="idm45053594696280"/><a data-type="indexterm" data-primary="templating" data-secondary="server-side templates" id="idm45053594695608"/><em>Server-side templates</em> allow you to render HTML <em>before</em> it’s sent to the
client. Unlike client-side templating,
where the templates are available for the curious user who knows how to
view the HTML source, your users will never see your server-side template or
the context objects used to generate the final HTML.</p>

<p><a data-type="indexterm" data-primary="caching" data-secondary="templates" id="idm45053594693304"/><a data-type="indexterm" data-primary="template caching" id="idm45053594692328"/>Server-side templates, in addition to hiding your implementation details,
support template <em>caching</em>, which is important for
performance. The templating engine will cache
compiled templates (recompiling and recaching only when the template itself
changes), which will improve the performance of templated views. By
default, view caching is disabled in development mode and enabled in
production mode. If you want to explicitly enable
view caching, you can do so thusly:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'view cache'</code><code class="p">,</code> <code class="kc">true</code><code class="p">)</code></pre>

<p>Out of the box, Express supports Pug, EJS, and JSHTML. We’ve already
discussed Pug, and I find little to recommend EJS or JSHTML (neither go far
enough, syntactically, for my taste). <a data-type="indexterm" data-primary="express-handlebars" id="idm45053594687032"/>So we’ll need to add a Node
package that provides Handlebars
support for Express:</p>

<pre data-type="programlisting">npm install express-handlebars</pre>

<p>Then we’ll link it into Express (<em>ch07/00/meadowlark.js</em> in the companion
repo):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">expressHandlebars</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'express-handlebars'</code><code class="p">)</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">engine</code><code class="p">(</code><code class="s1">'handlebars'</code><code class="p">,</code> <code class="nx">expressHandlebars</code><code class="p">({</code>
  <code class="nx">defaultLayout</code><code class="o">:</code> <code class="s1">'main'</code><code class="p">,</code>
<code class="p">})</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'view engine'</code><code class="p">,</code> <code class="s1">'handlebars'</code><code class="p">)</code></pre>
<div data-type="tip"><h6>Tip</h6>
<p><code>express-handlebars</code> expects Handlebars templates to have the
<em>.handlebars</em> extension. I’ve grown used to this, but if it’s too wordy
for you, you can change the extension to the also common <em>.hbs</em> when you
create the <code>express-handlebars</code> instance: <code>app.engine('handlebars',
expressHandlebars({ extname: '.hbs' }))</code>.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Views and Layouts"><div class="sect2" id="idm45053594624856">
<h2>Views and Layouts</h2>

<p><a data-type="indexterm" data-primary="Express" data-secondary="layouts in" id="idm45053594623416"/><a data-type="indexterm" data-primary="Handlebars" data-secondary="views and layouts" id="idm45053594622216"/><a data-type="indexterm" data-primary="layouts" data-secondary="templating and" id="idm45053594621272"/><a data-type="indexterm" data-primary="templating" data-secondary="using layouts in Express" id="idm45053594620328"/><a data-type="indexterm" data-primary="templating" data-secondary="views and layouts" id="idm45053594619416"/><a data-type="indexterm" data-primary="views" data-secondary="templating and" id="idm45053594618472"/>A <em>view</em> usually represents an individual page on your website (though it
could represent an Ajax-loaded portion of a page, an email, or anything
else for that matter). By default, Express looks for views in the <em>views</em>
subdirectory. <a data-type="indexterm" data-primary="layouts" data-secondary="defined" id="idm45053594616344"/>A <em>layout</em> is a special kind of view—essentially, a template
for templates. Layouts are essential because most (if not
all) of the pages on your site will have an almost identical layout. For
example, they must have an <code>&lt;html&gt;</code> element and a <code>&lt;title&gt;</code> element, they
usually all load the same CSS files, and so on. You don’t want to have to
duplicate that code for every single page, which is where layouts come in.
Let’s look at a bare-bones layout file:</p>

<pre data-type="programlisting" data-code-language="html"><code class="cp">&lt;!doctype html&gt;</code>
<code class="nt">&lt;html&gt;</code>
  <code class="nt">&lt;head&gt;</code>
    <code class="nt">&lt;title&gt;</code>Meadowlark Travel<code class="nt">&lt;/title&gt;</code>
    <code class="nt">&lt;link</code> <code class="na">rel=</code><code class="s">"stylesheet"</code> <code class="na">href=</code><code class="s">"/css/main.css"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;/head&gt;</code>
  <code class="nt">&lt;body&gt;</code>
    {{{body}}}
  <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p>Notice the text inside the <code>&lt;body&gt;</code> tag: <code>{{{body}}}</code>.
That’s so the view engine knows where to render the content of your view.
It’s important to use three curly brackets instead of two: our view is most
likely to contain HTML, and we don’t want Handlebars trying to escape it.
Note that there’s no restriction on where you place the
<code>{{{body}}}</code> field. For example, if you were building a
responsive layout in Bootstrap, you would probably want to put your view
inside a container <code>&lt;div&gt;</code>. Also, common page elements like headers and
footers usually live in the layout, not the view. Here’s an example:</p>

<pre data-type="programlisting" data-code-language="html"><code class="c">&lt;!-- ... --&gt;</code>
<code class="nt">&lt;body&gt;</code>
  <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"container"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;header&gt;</code>
      <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"container"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;h1&gt;</code>Meadowlark Travel<code class="nt">&lt;/h1&gt;</code>
        <code class="nt">&lt;img</code> <code class="na">src=</code><code class="s">"/img/logo.png"</code> <code class="na">alt=</code><code class="s">"Meadowlark Travel Logo"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;/div&gt;</code>
    <code class="nt">&lt;/header&gt;</code>
    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"container"</code><code class="nt">&gt;</code>
      {{{body}}}
    <code class="nt">&lt;/div&gt;</code>
    <code class="nt">&lt;footer&gt;</code><code class="ni">&amp;copy;</code> 2019 Meadowlark Travel<code class="nt">&lt;/footer&gt;</code>
  <code class="nt">&lt;/div&gt;</code>
<code class="nt">&lt;/body&gt;</code></pre>

<p>In <a data-type="xref" href="#img_templating_rendering_view_with_layout">Figure 7-2</a>, we see how the template
engine combines the view, layout, and context. The important
thing that this diagram makes clear is the order of operations. The <em>view
is rendered first</em>, before the layout. At first, this may seem
counterintuitive: the view is being rendered <em>inside</em> the layout, so
shouldn’t the layout be rendered first? While it could technically be done
this way, there are advantages to doing it in reverse. Particularly, it
allows the view itself to further customize the layout, which will come in
handy when we discuss <em>sections</em> later in this chapter.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Because of the order of operations, you can pass a property called <code>body</code>
into the view, and it will render correctly in the view. However, when the
layout is rendered, the value of <code>body</code> will be overwritten by the rendered
view.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Layouts (or Not) in Express"><div class="sect2" id="idm45053594502504">
<h2>Using Layouts (or Not) in Express</h2>

<p>Chances are, most (if not all) of your pages will use the same layout, so
it doesn’t make sense to keep specifying the layout every time we render a
view. You’ll notice that
when we created the view engine, we specified the name of the default
layout:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">engine</code><code class="p">(</code><code class="s1">'handlebars'</code><code class="p">,</code> <code class="nx">expressHandlebars</code><code class="p">({</code>
  <code class="nx">defaultLayout</code><code class="o">:</code> <code class="s1">'main'</code><code class="p">,</code>
<code class="p">})</code></pre>

<p>By default, Express looks for views in the <em>views</em> subdirectory, and
layouts in <em>views/layouts</em>. So if you have a view
<em>views/foo.handlebars</em>, you can render it this way:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/foo'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">))</code></pre>

<p>It will use <em>views/layouts/main.handlebars</em> as the layout. If you don’t
want to use a layout at all (meaning you’ll have to have all of the
boilerplate in the view), you can specify <code>layout: null</code> in the context
object:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/foo'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">,</code> <code class="p">{</code> <code class="nx">layout</code><code class="o">:</code> <code class="kc">null</code> <code class="p">}))</code></pre>

<figure><div id="img_templating_rendering_view_with_layout" class="figure">
<img src="Images/bwne_0702.png" alt="Rendering a view with a layout" width="1569" height="1495"/>
<h6><span class="label">Figure 7-2. </span>Rendering a view with a layout</h6>
</div></figure>

<p>Or, if we want to use a different template, we can specify the
template name:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/foo'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'foo'</code><code class="p">,</code> <code class="p">{</code> <code class="nx">layout</code><code class="o">:</code> <code class="s1">'microsite'</code> <code class="p">}))</code></pre>

<p>This will render the view with layout
<em>views/layouts/microsite.handlebars</em>.</p>

<p>Keep in mind that the more templates you have, the more basic HTML layout
you have to maintain. On the other hand, if you have pages that are
substantially different in layout, it may be worth it; you have to find a
balance that works for your projects.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sections"><div class="sect2" id="idm45053594501880">
<h2>Sections</h2>

<p><a data-type="indexterm" data-primary="Handlebars" data-secondary="helper for sections" id="idm45053594310472"/><a data-type="indexterm" data-primary="layouts" data-secondary="sections versus" id="idm45053594309272"/><a data-type="indexterm" data-primary="sections" id="idm45053594308328"/><a data-type="indexterm" data-primary="templating" data-secondary="sections" id="idm45053594307656"/>One technique I’m borrowing from Microsoft’s excellent <em>Razor</em> template
engine is the idea of <em>sections</em>. Layouts work well if all of your view fits neatly within a single element in
your layout, but what happens when your view needs to inject itself into
different parts of your layout? A common example of this is a view needing to
add something to the <code>&lt;head&gt;</code> element or to insert a <code>&lt;script&gt;</code>, which is
sometimes the very last thing in the layout, for performance reasons.</p>

<p>Neither Handlebars nor <code>express-handlebars</code> has a built-in way to do this.
Fortunately, Handlebars helpers make this really easy. When we instantiate
the Handlebars object, we’ll add a helper called <code>section</code>
(<em>ch07/01/meadowlark.js</em> in the companion repo):</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">engine</code><code class="p">(</code><code class="s1">'handlebars'</code><code class="p">,</code> <code class="nx">expressHandlebars</code><code class="p">({</code>
  <code class="nx">defaultLayout</code><code class="o">:</code> <code class="s1">'main'</code><code class="p">,</code>
  <code class="nx">helpers</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">section</code><code class="o">:</code> <code class="kd">function</code><code class="p">(</code><code class="nx">name</code><code class="p">,</code> <code class="nx">options</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="k">this</code><code class="p">.</code><code class="nx">_sections</code><code class="p">)</code> <code class="k">this</code><code class="p">.</code><code class="nx">_sections</code> <code class="o">=</code> <code class="p">{}</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">_sections</code><code class="p">[</code><code class="nx">name</code><code class="p">]</code> <code class="o">=</code> <code class="nx">options</code><code class="p">.</code><code class="nx">fn</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>
      <code class="k">return</code> <code class="kc">null</code>
    <code class="p">},</code>
  <code class="p">},</code>
<code class="p">}))</code></pre>

<p>Now we can use the <code>section</code> helper in a view. Let’s add a view
(<em>views/section-test.handlebars</em>) to add something to the <code>&lt;head&gt;</code> and a
script:</p>

<pre data-type="programlisting" data-code-language="html">{{#section 'head'}}
  <code class="c">&lt;!-- we want Google to ignore this page --&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"robots"</code> <code class="na">content=</code><code class="s">"noindex"</code><code class="nt">&gt;</code>
{{/section}}

<code class="nt">&lt;h1&gt;</code>Test Page<code class="nt">&lt;/h1&gt;</code>
<code class="nt">&lt;p&gt;</code>We're testing some script stuff.<code class="nt">&lt;/p&gt;</code>

{{#section 'scripts'}}
  <code class="nt">&lt;script&gt;</code>
    <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'body'</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">insertAdjacentHTML</code><code class="p">(</code><code class="s1">'beforeEnd'</code><code class="p">,</code> <code class="s1">'&lt;small&gt;(scripting works!)&lt;/small&gt;'</code><code class="p">)</code>
  <code class="nt">&lt;/script&gt;</code>
{{/section}}</pre>

<p>Now in our layout, we can place the sections just as we place
<code>{{{body}}}</code>:</p>

<pre data-type="programlisting" data-code-language="html">{{#section 'head'}}
  <code class="c">&lt;!-- we want Google to ignore this page --&gt;</code>
  <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"robots"</code> <code class="na">content=</code><code class="s">"noindex"</code><code class="nt">&gt;</code>
{{/section}}

<code class="nt">&lt;h1&gt;</code>Test Page<code class="nt">&lt;/h1&gt;</code>
<code class="nt">&lt;p&gt;</code>We're testing some script stuff.<code class="nt">&lt;/p&gt;</code>

{{#section 'scripts'}}
  <code class="nt">&lt;script&gt;</code>
    <code class="kr">const</code> <code class="nx">div</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'div'</code><code class="p">)</code>
    <code class="nx">div</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">createTextNode</code><code class="p">(</code><code class="s1">'(scripting works!)'</code><code class="p">))</code>
    <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'body'</code><code class="p">).</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">div</code><code class="p">)</code>
  <code class="nt">&lt;/script&gt;</code>
{{/section}}</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Partials"><div class="sect2" id="idm45053593021304">
<h2>Partials</h2>

<p><a data-type="indexterm" data-primary="Handlebars" data-secondary="partials" id="ix_ch-07-templating-asciidoc7"/><a data-type="indexterm" data-primary="partials" id="ix_ch-07-templating-asciidoc8"/><a data-type="indexterm" data-primary="templating" data-secondary="partials" id="ix_ch-07-templating-asciidoc9"/>Very often, you’ll have <a data-type="indexterm" data-primary="widgets" id="idm45053593024808"/>components that you want to reuse on different
pages (sometimes called <em>widgets</em> in frontend circles).
One way
to achieve that with templates is to use <em>partials</em> (so named because they
don’t render a whole view or a whole page). Let’s imagine we want a
Current Weather component that displays the current weather conditions in
Portland, Bend, and Manzanita. We want this component to be reusable
so we can easily put it on whatever page we want, so we’ll use a partial.
First, we create a partial file, <em>views/partials/weather.handlebars</em>:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"weatherWidget"</code><code class="nt">&gt;</code>
  {{#each partials.weatherContext}}
    <code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"location"</code><code class="nt">&gt;</code>
      <code class="nt">&lt;h3&gt;</code>{{location.name}}<code class="nt">&lt;/h3&gt;</code>
      <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"{{location.forecastUrl}}"</code><code class="nt">&gt;</code>
        <code class="nt">&lt;img</code> <code class="na">src=</code><code class="s">"{{iconUrl}}"</code> <code class="na">alt=</code><code class="s">"{{weather}}"</code><code class="nt">&gt;</code>
        {{weather}}, {{temp}}
      <code class="nt">&lt;/a&gt;</code>
    <code class="nt">&lt;/div&gt;</code>
  {{/each}}
  <code class="nt">&lt;small&gt;</code>Source: <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"https://www.weather.gov/documentation/services-web-api"</code><code class="nt">&gt;</code>
    National Weather Service<code class="nt">&lt;/a&gt;&lt;/small&gt;</code>
<code class="nt">&lt;/div&gt;</code></pre>

<p>Note that we namespace our context by starting with
<code>partials.weatherContext</code>. Since we want to be able to use the partial on
any page, it’s not practical to pass the context in for every view, so
instead we use <code>res.locals</code> (which is available to every view). But because we don’t want to
interfere with the context specified by individual views, we put all
partial context in the <code>partials</code> object.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-type="indexterm" data-primary="express-handlebars" data-secondary="partial templates" id="idm45053593012408"/><code>express-handlebars</code> allows you to pass in partial templates as part of the
context. For example, if you add <code>partials.foo = "Template!"</code> to your
context, you can render this partial with <code>{{&gt; foo}}</code>. This usage will
override any <em>.handlebars</em> view files, which is why we used
<code>partials.weatherContext</code> earlier, instead of <code>partials.weather</code>, which would
override <em>views/partials/weather.handlebars</em>.</p>
</div>

<p>In <a data-type="xref" href="ch19.xhtml#ch_integrating_with_third_party_rest_apis">Chapter 19</a>, we’ll see how to get
current weather information from the free National Weather Service API. For
now, we’re just going to use dummy data returned from a function we’ll call
<code>getWeatherData</code>.</p>

<p>In this example, we want this weather data to be available to any view, and
the best mechanism for that is middleware (which we’ll learn more about in
<a data-type="xref" href="ch10.xhtml#ch_middleware">Chapter 10</a>). Our middleware will inject the weather data into the
<code>res.locals.partials</code> object, which will make it available as the context
for our partial.</p>

<p>To make our middleware more testable, we’ll put it in its
own file, <em>lib/middleware/weather.js</em> (<em>ch07/01/lib/middleware/weather.js</em>
in the companion repo):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">getWeatherData</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">resolve</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">location</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">name</code><code class="o">:</code> <code class="s1">'Portland'</code><code class="p">,</code>
      <code class="nx">coordinates</code><code class="o">:</code> <code class="p">{</code> <code class="nx">lat</code><code class="o">:</code> <code class="mf">45.5154586</code><code class="p">,</code> <code class="nx">lng</code><code class="o">:</code> <code class="o">-</code><code class="mf">122.6793461</code> <code class="p">},</code>
    <code class="p">},</code>
    <code class="nx">forecastUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/gridpoints/PQR/112,103/forecast'</code><code class="p">,</code>
    <code class="nx">iconUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/icons/land/day/tsra,40?size=medium'</code><code class="p">,</code>
    <code class="nx">weather</code><code class="o">:</code> <code class="s1">'Chance Showers And Thunderstorms'</code><code class="p">,</code>
    <code class="nx">temp</code><code class="o">:</code> <code class="s1">'59 F'</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">location</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">name</code><code class="o">:</code> <code class="s1">'Bend'</code><code class="p">,</code>
      <code class="nx">coordinates</code><code class="o">:</code> <code class="p">{</code> <code class="nx">lat</code><code class="o">:</code> <code class="mf">44.0581728</code><code class="p">,</code> <code class="nx">lng</code><code class="o">:</code> <code class="o">-</code><code class="mf">121.3153096</code> <code class="p">},</code>
    <code class="p">},</code>
    <code class="nx">forecastUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/gridpoints/PDT/34,40/forecast'</code><code class="p">,</code>
    <code class="nx">iconUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/icons/land/day/tsra_sct,50?size=medium'</code><code class="p">,</code>
    <code class="nx">weather</code><code class="o">:</code> <code class="s1">'Scattered Showers And Thunderstorms'</code><code class="p">,</code>
    <code class="nx">temp</code><code class="o">:</code> <code class="s1">'51 F'</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">location</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">name</code><code class="o">:</code> <code class="s1">'Manzanita'</code><code class="p">,</code>
      <code class="nx">coordinates</code><code class="o">:</code> <code class="p">{</code> <code class="nx">lat</code><code class="o">:</code> <code class="mf">45.7184398</code><code class="p">,</code> <code class="nx">lng</code><code class="o">:</code> <code class="o">-</code><code class="mf">123.9351354</code> <code class="p">},</code>
    <code class="p">},</code>
    <code class="nx">forecastUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/gridpoints/PQR/73,120/forecast'</code><code class="p">,</code>
    <code class="nx">iconUrl</code><code class="o">:</code> <code class="s1">'https://api.weather.gov/icons/land/day/tsra,90?size=medium'</code><code class="p">,</code>
    <code class="nx">weather</code><code class="o">:</code> <code class="s1">'Showers And Thunderstorms'</code><code class="p">,</code>
    <code class="nx">temp</code><code class="o">:</code> <code class="s1">'55 F'</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">])</code>

<code class="kr">const</code> <code class="nx">weatherMiddleware</code> <code class="o">=</code> <code class="nx">async</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">,</code> <code class="nx">next</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nx">res</code><code class="p">.</code><code class="nx">locals</code><code class="p">.</code><code class="nx">partials</code><code class="p">)</code> <code class="nx">res</code><code class="p">.</code><code class="nx">locals</code><code class="p">.</code><code class="nx">partials</code> <code class="o">=</code> <code class="p">{}</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">locals</code><code class="p">.</code><code class="nx">partials</code><code class="p">.</code><code class="nx">weatherContext</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">getWeatherData</code><code class="p">()</code>
  <code class="nx">next</code><code class="p">()</code>
<code class="p">}</code>

<code class="nx">module</code><code class="p">.</code><code class="nx">exports</code> <code class="o">=</code> <code class="nx">weatherMiddleware</code></pre>

<p>Now that everything is set up, all we have to do is use the partial in a view.
For example, to put our widget on the home page, edit
<em>views/home.handlebars</em>:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;h2&gt;</code>Home<code class="nt">&lt;/h2&gt;</code>
{{&gt; weather}}</pre>

<p>The <code>{{&gt; partial_name}}</code> syntax is how you include a
partial in a view: <code>express-handlebars</code> will know to look in
<em>views/partials</em> for a view called <em>partial_name.handlebars</em> (or
<em>weather.handlebars</em>, in our example).</p>
<div data-type="tip"><h6>Tip</h6>
<p><a data-type="indexterm" data-primary="express-handlebars" data-secondary="subdirectories" id="idm45053592352680"/><code>express-handlebars</code> supports subdirectories, so if you have a lot of
partials, you can organize them. For example, if you have some social media partials, you
could put them in the <em>views/partials/social</em> directory and include them
using <code>{{&gt; social/facebook}}</code>, <code>{{&gt;
social/twitter}}</code>, etc.<a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc9" id="idm45053592348504"/><a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc8" id="idm45053592347800"/><a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc7" id="idm45053592347160"/></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Perfecting Your Templates"><div class="sect2" id="idm45053593029032">
<h2>Perfecting Your Templates</h2>

<p><a data-type="indexterm" data-primary="templating" data-secondary="perfecting templates" id="idm45053592345384"/>Your templates are at the heart of your website. A good template structure will
save you development time, promote consistency across your website, and
reduce the number of places that layout quirks can hide. To achieve these
benefits, though, you must spend some time crafting your templates carefully.
Deciding how many templates you should have is an art; generally, fewer is
better, but there is a point of diminishing returns, depending on the
uniformity of your pages. Your templates are also your first line of defense
against cross-browser compatibility issues and valid HTML. They should be
lovingly crafted and maintained by someone who is well versed in frontend
development. <a data-type="indexterm" data-primary="HTML5 Boilerplate" id="idm45053592322584"/>A great place to start—especially if you’re new—is
<a href="http://html5boilerplate.com">HTML5 Boilerplate</a>. In
the previous examples, we’ve been using a minimal HTML5 template to fit the
book format, but for our actual project, we’ll be using HTML5 <span class="keep-together">Boilerplate.</span></p>

<p>Another popular place to start with your template are third-party
themes. Sites like
<a href="http://bit.ly/34Tdkfj">Themeforest</a>
and <a href="https://wrapbootstrap.com">WrapBootstrap</a>
have hundreds of ready-to-use HTML5 themes that you
can use as a starting place for your template. Using a third-party theme
starts with taking the primary file (usually <em>index.html</em>), renaming
it to <em>main.handlebars</em> (or whatever you choose to call your layout
file), and placing any resources (CSS, JavaScript, images) in the
<em>public</em> directory you use for static files. Then you’ll have to edit the
template file and figure out where you want to put the
<code>{{{body}}}</code> expression.</p>

<p>Depending on the elements of
your template, you may want to move some of them into partials. A great
example is a <em>hero</em> (a tall banner designed to grab the user’s attention.
If the hero appears on every page (probably a poor choice), you would leave
the hero in the template file. If it appears on only one page (usually the
home page), then it would go only in that view. If it appears on
several—but not all—pages, then you might consider putting it in a partial.
The choice is yours, and herein lies the artistry of making a unique,
captivating website.<a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc1" id="idm45053592341288"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45053594993320">
<h1>Conclusion</h1>

<p>We’ve seen how templating can make our code easier to write, read, and
maintain. Thanks to templates, we don’t have to painfully cobble together
HTML from JavaScript strings; we can write HTML in our favorite editor and
use a compact and easy-to-read templating language to make it dynamic.<a data-type="indexterm" data-startref="ix_ch-07-templating-asciidoc0" id="idm45053592339288"/></p>

<p>Now that we’ve seen how to format our content for display, we’ll turn our
attention to how to get data <em>into</em> our system with HTML forms.</p>
</div></section>







</div></section></div>



  </body></html>