<html><head></head><body><section data-pdf-bookmark="Chapter 2. Simple Persistence with the &#10;Web Storage API" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_webStorage">&#13;
<h1><span class="label">Chapter 2. </span>Simple Persistence with the &#13;
<span class="keep-together">Web Storage API</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id22">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="Web Storage API" data-type="indexterm" id="ix_02-web-storage-api-asciidoc0"/>The<a data-primary="Web Storage API" data-secondary="basics" data-type="indexterm" id="ix_02-web-storage-api-asciidoc1"/> Web Storage API persists simple data locally, in the user’s browser. You can retrieve this data later, even after closing and reopening the browser.</p>&#13;
&#13;
<p><a data-primary="Storage interface" data-type="indexterm" id="id735"/>This API has a <code>Storage</code> interface that provides data access and persistence. You don’t create instances of <code>Storage</code> directly; there are two global instances: <code>window.localStorage</code> and <code>window.sessionStorage</code>. The only difference between these is how long they retain the data.</p>&#13;
&#13;
<p><code>sessionStorage</code> data is associated with a specific browser session. It retains the data if the page is reloaded, but closing the browser completely loses the data. Different tabs for the same origin do not share the same persisted data.</p>&#13;
&#13;
<p>On the other hand, <code>localStorage</code> shares the same storage space across all tabs and sessions for the same origin. The browser retains this data even after you close the browser. In general, session storage is a good choice if you want to store something ephemeral or sensitive that you want to be destroyed once the browser is closed.</p>&#13;
&#13;
<p>In both cases, storage space is specific to a given origin.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id736">&#13;
<h1>What Is an Origin?</h1>&#13;
<p><a data-primary="origin, of page" data-type="indexterm" id="id737"/><a data-primary="page, origin of" data-type="indexterm" id="id738"/>A page’s origin is a string combining the protocol (<code>http</code> or <code>https</code>), host, and port of a URL. For example, the URLs <em>https://example.com/path/to/index.html</em> and <em>https://example.com/profile/index.html</em> both have the same origin: <em>https://example.com</em>.</p>&#13;
</div></aside>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting and Setting Items" data-type="sect2"><div class="sect2" id="id23">&#13;
<h2>Getting and Setting Items</h2>&#13;
&#13;
<p><a data-primary="items, getting and setting" data-type="indexterm" id="id739"/><a data-primary="Web Storage API" data-secondary="getting and setting items" data-type="indexterm" id="id740"/>Web Storage can only store string values. Each value has a key that you can use to look it up. The API is simple:</p>&#13;
<dl>&#13;
<dt><code>getItem(key)</code></dt>&#13;
<dd>&#13;
<p>Returns the string bound to a key, or <code>null</code> if the key doesn’t exist.</p>&#13;
</dd>&#13;
<dt><code>setItem(key, value)</code></dt>&#13;
<dd>&#13;
<p>Stores a string value under the given key. If the key already exists, you’ll overwrite it.</p>&#13;
</dd>&#13;
<dt><code>clear()</code></dt>&#13;
<dd>&#13;
<p>Deletes all stored data for the current origin.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Disadvantages" data-type="sect2"><div class="sect2" id="id24">&#13;
<h2>Disadvantages</h2>&#13;
&#13;
<p><a data-primary="Web Storage API" data-secondary="disadvantages" data-type="indexterm" id="id741"/>Web Storage can be really useful, but it does have a few disadvantages:</p>&#13;
<dl>&#13;
<dt>Data storage limitations</dt>&#13;
<dd>&#13;
<p>Web Storage can only store string data. You can store simple objects, but not directly—you’ll need to convert them to a JavaScript Object Notation (JSON) string first.</p>&#13;
</dd>&#13;
<dt>Size limitations</dt>&#13;
<dd>&#13;
<p>Each origin has a limited amount of space available for storage. In most browsers this is 5 megabytes. If an origin’s storage becomes full, the browser will throw an exception if you attempt to add more data.</p>&#13;
</dd>&#13;
<dt>Security concerns</dt>&#13;
<dd>&#13;
<p><a data-primary="cross-site scripting (XSS) attacks" data-type="indexterm" id="id742"/><a data-primary="XSS (cross-site scripting) attacks" data-type="indexterm" id="id743"/>Even though the browser stores each origin’s data separately, it’s still vulnerable &#13;
<span class="keep-together">to cross-site</span> scripting (XSS) attacks. An attacker can inject code via an XSS &#13;
<span class="keep-together">attack that</span> steals locally persisted data. Be mindful of what sensitive data you store here.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The recipes in this chapter all use <em>local</em> storage, but they all apply to <em>session</em> storage as well, since both objects implement the same &#13;
<span class="keep-together"><code>Storage</code></span> interface<a data-startref="ix_02-web-storage-api-asciidoc1" data-type="indexterm" id="id744"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Checking for Web Storage Support" data-type="sect1"><div class="sect1" id="id399">&#13;
<h1>Checking for Web Storage Support</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id262">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Web Storage API" data-secondary="support" data-type="indexterm" id="id745"/>You want to check if local storage is available before using it to avoid crashing your app. You also want to handle the situation where local storage is available but blocked by user settings.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id400">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Check the global <code>window</code> object for the <code>localStorage</code> property to verify that the browser supports local storage. If the check passes, local storage is available (see <a data-type="xref" href="#code_checkLocalStorage">Example 2-1</a>).</p>&#13;
<div data-type="example" id="code_checkLocalStorage">&#13;
<h5><span class="label">Example 2-1. </span>Checking if local storage is available</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Determines if local storage is available.</code>&#13;
<code class="cm"> * @returns true if the browser can use local storage, false if not</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">isLocalStorageAvailable</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="c1">// Local storage is available if the property exists.</code>&#13;
    <code class="k">return</code> <code class="k">typeof</code> <code class="nb">window</code><code class="p">.</code><code class="nx">localStorage</code> <code class="o">!==</code> <code class="s1">'undefined'</code><code class="p">;</code>&#13;
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// If window.localStorage exists but the user is blocking local</code>&#13;
    <code class="c1">// storage, the attempt to read the property throws an exception.</code>&#13;
    <code class="c1">// If this happens, consider local storage not available.</code>&#13;
    <code class="k">return</code> <code class="kc">false</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id401">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The function in <a data-type="xref" href="#code_checkLocalStorage">Example 2-1</a> handles both cases: if local storage is supported at all, and if it exists and is not blocked by user settings.</p>&#13;
&#13;
<p>It checks to see if the <code>window.localStorage</code> property is not <code>undefined</code>. If this check passes, this means the browser supports local storage. If the user has <em>blocked</em> local storage, just the act of referencing the <code>window.localStorage</code> property throws an exception with a message saying access is denied.</p>&#13;
&#13;
<p>By surrounding the property check with a <code>try</code>/<code>catch</code> block, you can also handle this case. When catching the exception, it considers local storage not available and returns <code>false</code>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Persisting String Data" data-type="sect1"><div class="sect1" id="recipe_persistStringData">&#13;
<h1>Persisting String Data</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id25">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="animations" data-secondary="scheduling updates with requestAnimationFrame" data-type="indexterm" id="id746"/><a data-primary="requestAnimationFrame" data-secondary="scheduling updates with" data-type="indexterm" id="id747"/><a data-primary="string data, persisting to local storage" data-type="indexterm" id="id748"/><a data-primary="Web Storage API" data-secondary="persisting string data" data-type="indexterm" id="id749"/>You want to persist a string value to local storage and read it back later.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id403">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>localStorage.getItem</code> and <code>localStorage.setItem</code> to read and write the data. <a data-type="xref" href="#example2-2">Example 2-2</a> shows how we can use local storage to remember the value of a color picker.</p>&#13;
<div data-type="example" id="example2-2">&#13;
<h5><span class="label">Example 2-2. </span>Persisting data to local storage</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// A reference to the color picker input element</code>&#13;
<code class="kr">const</code> <code class="nx">colorPicker</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#colorPicker'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Load the saved color, if any, and set it on the color picker.</code>&#13;
<code class="kr">const</code> <code class="nx">storedValue</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'savedColor'</code><code class="p">);</code>&#13;
<code class="k">if</code> <code class="p">(</code><code class="nx">storedValue</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Found saved color:'</code><code class="p">,</code> <code class="nx">storedValue</code><code class="p">);</code>&#13;
  <code class="nx">colorPicker</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">storedValue</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// Update the saved color whenever the value changes.</code>&#13;
<code class="nx">colorPicker</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'savedColor'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">);</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Saving new color:'</code><code class="p">,</code> <code class="nx">colorPicker</code><code class="p">.</code><code class="nx">value</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id404">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When the page first loads, local storage is checked for a previously saved color. If you call <code>getItem</code> with a key that doesn’t exist, it returns <code>null</code>. The return value is only set in the color picker if it is not null or empty.</p>&#13;
&#13;
<p>When the color picker’s value changes, the event handler saves the new value to local storage. If there’s already a saved color, this overwrites it.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Persisting Simple Objects" data-type="sect1"><div class="sect1" id="id405">&#13;
<h1>Persisting Simple Objects</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id26">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="objects (generally)" data-secondary="simple" data-type="indexterm" id="ix_02-web-storage-api-asciidoc2"/><a data-primary="simple objects, persisting to local storage" data-type="indexterm" id="ix_02-web-storage-api-asciidoc3"/><a data-primary="Web Storage API" data-secondary="persisting simple objects" data-type="indexterm" id="ix_02-web-storage-api-asciidoc4"/>You have a JavaScript object, such as a user profile, that you want to persist to local storage. You can’t do this directly because local storage only supports string values.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id27">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="JSON.stringify" data-type="indexterm" id="ix_02-web-storage-api-asciidoc5"/>Use <code>JSON.stringify</code> to convert the object to a JSON string before saving it. When loading the value later, use <code>JSON.parse</code> to turn it back into an object, as shown in <a data-type="xref" href="#example2-3">Example 2-3</a>.</p>&#13;
<div data-type="example" id="example2-3">&#13;
<h5><span class="label">Example 2-3. </span>Using <code>JSON.parse</code> and <code>JSON.stringify</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Given a user profile object, serialize it to JSON and store it in local storage.</code>&#13;
<code class="cm"> * @param userProfile the profile object to save</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">saveProfile</code><code class="p">(</code><code class="nx">userProfile</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'userProfile'</code><code class="p">,</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">userProfile</code><code class="p">));</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="cm">/**</code>&#13;
<code class="cm"> * Loads the user profile from local storage and deserializes the JSON back to</code>&#13;
<code class="cm"> * an object. If there is no stored profile, an empty object is returned.</code>&#13;
<code class="cm"> * @returns the stored user profile or an empty object.</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">loadProfile</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="c1">// If there is no stored userProfile value, this will return null. In this case,</code>&#13;
  <code class="c1">// use the default value of an empty object.</code>&#13;
  <code class="k">return</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'userProfile'</code><code class="p">))</code> <code class="o">||</code> <code class="p">{};</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id28">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Passing the profile object directly to <code>localStorage.setItem</code> won’t have the desired effect, as shown in <a data-type="xref" href="#example2-4">Example 2-4</a>.</p>&#13;
<div data-type="example" id="example2-4">&#13;
<h5><span class="label">Example 2-4. </span>Attempting to persist an array</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">userProfile</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">firstName</code><code class="o">:</code> <code class="s1">'Ava'</code><code class="p">,</code>&#13;
  <code class="nx">lastName</code><code class="o">:</code> <code class="s1">'Johnson'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'userProfile'</code><code class="p">,</code> <code class="nx">userProfile</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Prints [object Object]</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'userProfile'</code><code class="p">));</code></pre></div>&#13;
&#13;
<p>The saved value is <code>[object Object]</code>. This is the result of calling <code>toString</code> on the profile object.</p>&#13;
&#13;
<p><code>JSON.stringify</code> takes an object and returns a JSON string representing the object. Passing the user profile object to <code>JSON.stringify</code> results in this JSON string (whitespace added for readability):</p>&#13;
&#13;
<pre data-type="programlisting">{&#13;
  "firstName": "Ava",&#13;
  "lastName": "Johnson"&#13;
}</pre>&#13;
&#13;
<p>This approach works for objects like the user profile, but the <a href="https://www.json.org">JSON specification</a> limits what can be serialized to a string. Generally speaking, these are objects, arrays, strings, numbers, booleans, and <code>null</code>. Other values, like class instances or functions, can’t be serialized in this <a data-startref="ix_02-web-storage-api-asciidoc5" data-type="indexterm" id="id750"/>way<a data-startref="ix_02-web-storage-api-asciidoc4" data-type="indexterm" id="id751"/><a data-startref="ix_02-web-storage-api-asciidoc3" data-type="indexterm" id="id752"/><a data-startref="ix_02-web-storage-api-asciidoc2" data-type="indexterm" id="id753"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Persisting Complex Objects" data-type="sect1"><div class="sect1" id="id406">&#13;
<h1>Persisting Complex Objects</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id29">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="complex objects, persisting to local storage" data-type="indexterm" id="ix_02-web-storage-api-asciidoc6"/><a data-primary="JSON" data-secondary="string" data-type="indexterm" id="ix_02-web-storage-api-asciidoc7"/><a data-primary="objects (generally)" data-secondary="complex" data-type="indexterm" id="ix_02-web-storage-api-asciidoc8"/><a data-primary="Web Storage API" data-secondary="persisting complex objects" data-type="indexterm" id="ix_02-web-storage-api-asciidoc9"/>You want to persist an object that can’t be directly serialized to a JSON string, to local storage. For example, the user profile object might have a <code>Date</code> object in it specifying when it was last updated.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id407">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>replacer</code> and <code>reviver</code> functions with <code>JSON.stringify</code> and <code>JSON.parse</code> to provide custom serialization for the complex data.</p>&#13;
&#13;
<p>Consider the following profile object:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">userProfile</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">firstName</code><code class="o">:</code> <code class="s1">'Ava'</code><code class="p">,</code>&#13;
  <code class="nx">lastName</code><code class="o">:</code> <code class="s1">'Johnson'</code><code class="p">,</code>&#13;
&#13;
  <code class="c1">// This date represents June 2, 2025.</code>&#13;
  <code class="c1">// Months start with zero but days start with 1.</code>&#13;
  <code class="nx">lastUpdated</code><code class="o">:</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="mi">2025</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">2</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>If you serialize this object with <code>JSON.stringify</code>, the resulting string has the <code>lastUpdated</code> date as an ISO date string (see <a data-type="xref" href="#example2-5">Example 2-5</a>).</p>&#13;
<div data-type="example" id="example2-5">&#13;
<h5><span class="label">Example 2-5. </span>Attempting to serialize an object with a <code>Date</code> object</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">json</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">userProfile</code><code class="p">);</code></pre></div>&#13;
&#13;
<p class="pagebreak-before">The resulting JSON string looks like this:</p>&#13;
&#13;
<pre data-type="programlisting">{&#13;
  "firstName": "Ava",&#13;
  "lastName": "Johnson",&#13;
  "lastUpdated": '2025-06-02T04:00:00.000Z'&#13;
}</pre>&#13;
&#13;
<p>Now you have a JSON string that you can save to local storage. However, if you call <code>JSON.parse</code> with this JSON string, the resulting object differs slightly from the original. The <code>lastUpdated</code> property is still a string, not a <code>Date</code>, because <code>JSON.parse</code> doesn’t know that this should be a <code>Date</code> object.</p>&#13;
&#13;
<p>To handle these situations, <code>JSON.stringify</code> and <code>JSON.parse</code> accept special functions called <code>replacer</code> and <code>reviver</code>, respectively. These functions provide custom logic to convert nonprimitive values to and from JSON.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Serializing with a replacer function" data-type="sect3"><div class="sect3" id="id30">&#13;
<h3>Serializing with a replacer function</h3>&#13;
&#13;
<p><a data-primary="replacer function" data-type="indexterm" id="id754"/>The <code>replacer</code> argument to <code>JSON.stringify</code> can work in several different ways. MDN has some comprehensive <a href="https://oreil.ly/H56TM">documentation on the <code>replacer</code> function</a>.</p>&#13;
&#13;
<p>The <code>replacer</code> function takes two arguments: <code>key</code> and <code>value</code> (see <a data-type="xref" href="#example2-6">Example 2-6</a>). <code>JSON.stringify</code> first calls this function with an empty string as the key, and the object being stringified as the value. You can transform the <code>lastUpdated</code> field here to a serializable representation of the <code>Date</code> object by calling <code>getTime()</code>, which gives the date as the number of milliseconds since the epoch (midnight UTC on January 1, 1970).</p>&#13;
<div data-type="example" id="example2-6">&#13;
<h5><span class="label">Example 2-6. </span>The <code>replacer</code> function</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">replacer</code><code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s1">''</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// First replacer call, "value" is the object itself.</code>&#13;
    <code class="c1">// Return all properties of the object, but transform lastUpdated.</code>&#13;
    <code class="c1">// This uses object spread syntax to make a copy of "value" before</code>&#13;
    <code class="c1">// adding the lastUpdated property.</code>&#13;
    <code class="k">return</code> <code class="p">{</code>&#13;
      <code class="p">...</code><code class="nx">value</code><code class="p">,</code>&#13;
      <code class="nx">lastUpdated</code><code class="o">:</code> <code class="nx">value</code><code class="p">.</code><code class="nx">lastUpdated</code><code class="p">.</code><code class="nx">getTime</code><code class="p">()</code>&#13;
    <code class="p">};</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="c1">// After the initial transformation, the replacer is called once</code>&#13;
  <code class="c1">// for each key/value pair.</code>&#13;
  <code class="c1">// No more replacements are necessary, so return these as is.</code>&#13;
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>You can pass this <code>replacer</code> function to <code>JSON.stringify</code> to serialize the object to JSON, as shown in <a data-type="xref" href="#example2-7">Example 2-7</a>.</p>&#13;
<div data-type="example" id="example2-7">&#13;
<h5><span class="label">Example 2-7. </span>Stringifying with the <code>replacer</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">json</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">userProfile</code><code class="p">,</code> <code class="nx">replacer</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>This generates the following JSON string:</p>&#13;
&#13;
<pre data-type="programlisting">{&#13;
  "firstName": "Ava",&#13;
  "lastName": "Johnson",&#13;
  "lastUpdated": 1748836800000&#13;
}</pre>&#13;
&#13;
<p>The number in the <code>lastUpdated</code> property is the timestamp for June 2, 2025.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Deserializing with the reviver function" data-type="sect3"><div class="sect3" id="id31">&#13;
<h3>Deserializing with the reviver function</h3>&#13;
&#13;
<p><a data-primary="reviver function" data-type="indexterm" id="id755"/>Later, when you pass this JSON string to <code>JSON.parse</code>, the <code>lastUpdated</code> property remains as a number (the timestamp). You can use a <code>reviver</code> function to transform this serialized number value back into a <code>Date</code> object.</p>&#13;
&#13;
<p><code>JSON.parse</code> calls the <code>reviver</code> function for each property in the JSON string. For each key, the value returned from the function is the value that is set in the final object (see <a data-type="xref" href="#example2-8">Example 2-8</a>).</p>&#13;
<div data-type="example" id="example2-8">&#13;
<h5><span class="label">Example 2-8. </span>The <code>reviver</code> function</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">reviver</code><code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="c1">// JSON.parse calls the reviver once for each key/value pair.</code>&#13;
  <code class="c1">// Watch for the lastUpdated key.</code>&#13;
  <code class="c1">// Only proceed if there's actually a value for lastUpdated.</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s1">'lastUpdated'</code> <code class="o">&amp;&amp;</code> <code class="nx">value</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// Here, the value is the timestamp. You can pass this to the Date constructor</code>&#13;
    <code class="c1">// to create a Date object referring to the proper time.</code>&#13;
    <code class="k">return</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="nx">value</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="c1">// Restore all other values as is.</code>&#13;
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>To use the <code>reviver</code>, pass it as the second argument to <code>JSON.parse</code>, as shown in <a data-type="xref" href="#example2-9">Example 2-9</a>.</p>&#13;
<div data-type="example" id="example2-9">&#13;
<h5><span class="label">Example 2-9. </span>Parsing with the <code>reviver</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">object</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">userProfile</code><code class="p">,</code> <code class="nx">reviver</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>This returns an object that is equal to the user profile object we started with:</p>&#13;
&#13;
<pre data-type="programlisting">{&#13;
  firstName: 'Ava',&#13;
  lastName: 'Johnson',&#13;
  lastUpdated: [Date object representing June 2, 2025]&#13;
}</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id32">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>With this reliable method to convert this object to and from JSON, keeping the <code>Date</code> property intact, you can persist these values in local storage.</p>&#13;
&#13;
<p>The approach shown here is just one way to work with a <code>replacer</code> function. Instead of a <code>replacer</code> function, you could also define a <code>toJSON</code> function on the object being stringified. Combined with a factory function, no <code>replacer</code> function is necessary.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id756">&#13;
<h1>Factory Functions</h1>&#13;
<p><a data-primary="factory functions" data-type="indexterm" id="id757"/><a data-type="xref" href="#factoryToJSON">Example 2-10</a> uses a <em>factory function</em> to create user profile objects. It takes some arguments and returns a new object containing data based on those arguments. A factory function is similar to a class’s constructor function. The main difference is that you use a constructor function with the <code>new</code> operator, but a factory is called directly like any other function.</p>&#13;
</div></aside>&#13;
<div data-type="example" id="factoryToJSON">&#13;
<h5><span class="label">Example 2-10. </span>Using a factory that adds a <code>toJSON</code> function</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * A factory function to create a user profile object,</code>&#13;
<code class="cm"> * with the lastUpdated property set to today and a toJSON method</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * @param firstName The user's first name</code>&#13;
<code class="cm"> * @param lastName The user's last name</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">createUser</code><code class="p">(</code><code class="nx">firstName</code><code class="p">,</code> <code class="nx">lastName</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">firstName</code><code class="p">,</code>&#13;
    <code class="nx">lastName</code><code class="p">,</code>&#13;
    <code class="nx">lastUpdated</code><code class="o">:</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(),</code>&#13;
    <code class="nx">toJSON</code><code class="p">()</code> <code class="p">{</code>&#13;
      <code class="k">return</code> <code class="p">{</code>&#13;
        <code class="nx">firstName</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">firstName</code><code class="p">,</code>&#13;
        <code class="nx">lastName</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">lastName</code><code class="p">,</code>&#13;
        <code class="nx">lastUpdated</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">lastUpdated</code><code class="p">.</code><code class="nx">getTime</code><code class="p">();</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">userProfile</code> <code class="o">=</code> <code class="nx">createUser</code><code class="p">(</code><code class="s1">'Ava'</code><code class="p">,</code> <code class="s1">'Johnson'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Calling <code>JSON.stringify</code> with the object in <a data-type="xref" href="#factoryToJSON">Example 2-10</a> returns the same JSON string as before, with <code>lastUpdated</code> properly converted to a timestamp.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>There isn’t any mechanism like this for parsing a string back to an object with <code>JSON.parse</code>. If you use the <code>toJSON</code> approach shown here, you’ll&#13;
still need to write a <code>reviver</code> function to properly deserialize a user profile string.</p>&#13;
</div>&#13;
&#13;
<p>Since functions can’t be serialized, the resulting JSON string won’t have a <code>toJSON</code> property. Whatever method you choose, the resulting JSON is the same<a data-startref="ix_02-web-storage-api-asciidoc9" data-type="indexterm" id="id758"/><a data-startref="ix_02-web-storage-api-asciidoc8" data-type="indexterm" id="id759"/><a data-startref="ix_02-web-storage-api-asciidoc7" data-type="indexterm" id="id760"/><a data-startref="ix_02-web-storage-api-asciidoc6" data-type="indexterm" id="id761"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Listening for Storage Changes" data-type="sect1"><div class="sect1" id="id408">&#13;
<h1>Listening for Storage Changes</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id263">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Web Storage API" data-secondary="listening for storage changes" data-type="indexterm" id="id762"/>You want to receive a notification when another tab on the same origin makes changes to local storage.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id409">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Listen for the <code>storage</code> event on the <code>window</code> object. This event fires when other tabs or sessions in the same browser, on the same origin, make changes to any data in local storage (see <a data-type="xref" href="#example2-11">Example 2-11</a>).</p>&#13;
<div data-type="example" id="example2-11">&#13;
<h5><span class="label">Example 2-11. </span>Listening for storage changes from another tab</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Listen for the 'storage' event. If another tab changes the</code>&#13;
<code class="c1">// 'savedColor' item, update this page's color picker with the new value.</code>&#13;
<code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'storage'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">key</code> <code class="o">===</code> <code class="s1">'savedColor'</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'New color was chosen in another tab:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">newValue</code><code class="p">);</code>&#13;
    <code class="nx">colorPicker</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">event</code><code class="p">.</code><code class="nx">newValue</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Consider the persistent color picker from <a data-type="xref" href="#recipe_persistStringData">“Persisting String Data”</a>. If the user has multiple tabs open and changes the color in another tab, you can get notified and update the local in-memory copy of the data to keep everything in sync.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>storage</code> event is <em>not</em> triggered on the tab or page that made the storage change. It’s meant to listen for&#13;
changes that <em>other</em> pages have made to local storage.</p>&#13;
</div>&#13;
&#13;
<p>A <code>storage</code> event specifies which key was changed and what the new value is. It also includes the old value, in case you need it for comparison.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id410">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The main use case for the <code>storage</code> event is to keep multiple sessions in sync with each other in real time.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>storage</code> event is only triggered for other tabs and sessions in the same browser on the same device.</p>&#13;
</div>&#13;
&#13;
<p>Even if you don’t listen for the <code>storage</code> event, all sessions on the same origin still share the same local storage data. If you call <code>localStorage.getItem</code> at any point, you’ll still get the latest value. The <code>storage</code> event just provides a real-time notification when such a change happens so the app can update the local data.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Finding All Known Keys" data-type="sect1"><div class="sect1" id="id411">&#13;
<h1>Finding All Known Keys</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id33">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="key function" data-type="indexterm" id="ix_02-web-storage-api-asciidoc10"/><a data-primary="keys" data-secondary="finding all known keys" data-type="indexterm" id="ix_02-web-storage-api-asciidoc11"/><a data-primary="length property" data-type="indexterm" id="ix_02-web-storage-api-asciidoc12"/><a data-primary="Web Storage API" data-secondary="finding all known keys" data-type="indexterm" id="ix_02-web-storage-api-asciidoc13"/>You want to know all the keys that are currently in local storage for the current origin.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id412">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>length</code> property with the <code>key</code> function to build a list of all the known keys. &#13;
<span class="keep-together"><code>Storage</code></span> objects don’t have a function to return the list of keys directly, but you can build such a list by using the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <code>length</code> property returns the number of keys.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>key</code> function, given an index, returns the key at that index.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>You can combine these with a <code>for</code> loop to build an array of all the keys, as shown <a data-type="xref" href="#buildListKeys">Example 2-12</a>.</p>&#13;
<div data-type="example" id="buildListKeys">&#13;
<h5><span class="label">Example 2-12. </span>Building a list of keys</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Generates an array of all keys found in the local storage area</code>&#13;
<code class="cm"> * @returns an array of keys</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">getAllKeys</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">keys</code> <code class="o">=</code> <code class="p">[];</code>&#13;
&#13;
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">keys</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">key</code><code class="p">(</code><code class="nx">i</code><code class="p">));</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">return</code> <code class="nx">keys</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id34">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>You can combine the <code>length</code> property and the <code>key</code> function to perform other types of queries, too. This could be, for example, a function that takes an array of keys and returns an object containing just those key/value pairs (see <a data-type="xref" href="#example2-13">Example 2-13</a>).</p>&#13;
<div data-type="example" id="example2-13">&#13;
<h5><span class="label">Example 2-13. </span>Querying for a subset of key/value pairs</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">getAll</code><code class="p">(</code><code class="nx">keys</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">results</code> <code class="o">=</code> <code class="p">{};</code>&#13;
&#13;
  <code class="c1">// Check each key in local storage.</code>&#13;
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>&#13;
&#13;
    <code class="c1">// Get the ith key. If the keys array includes this key, add it and its value</code>&#13;
    <code class="c1">// to the results object.</code>&#13;
    <code class="kr">const</code> <code class="nx">key</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">key</code><code class="p">(</code><code class="nx">i</code><code class="p">);</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">keys</code><code class="p">.</code><code class="nx">includes</code><code class="p">(</code><code class="nx">key</code><code class="p">))</code> <code class="p">{</code>&#13;
      <code class="nx">results</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="nx">key</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="c1">// results now has all key/value pairs that exist in local storage.</code>&#13;
  <code class="k">return</code> <code class="nx">results</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The ordering of the keys, as referenced with the <code>key</code> function, may not be the same across different browsers.<a data-startref="ix_02-web-storage-api-asciidoc13" data-type="indexterm" id="id763"/><a data-startref="ix_02-web-storage-api-asciidoc12" data-type="indexterm" id="id764"/><a data-startref="ix_02-web-storage-api-asciidoc11" data-type="indexterm" id="id765"/><a data-startref="ix_02-web-storage-api-asciidoc10" data-type="indexterm" id="id766"/></p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Removing Data" data-type="sect1"><div class="sect1" id="id413">&#13;
<h1>Removing Data</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id35">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="data removal, from local storage" data-type="indexterm" id="id767"/><a data-primary="Web Storage API" data-secondary="data removal" data-type="indexterm" id="id768"/>You want to remove some, or all, data from local storage.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id414">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>removeItem</code> and <code>clear</code> methods as appropriate.</p>&#13;
&#13;
<p>To remove a particular key/value pair from local storage, call <code>localStorage.remove​I⁠tem</code> with the key (see <a data-type="xref" href="#example2-14">Example 2-14</a>).</p>&#13;
<div data-type="example" id="example2-14">&#13;
<h5><span class="label">Example 2-14. </span>Removing an item from local storage</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// This is a safe operation. If the key doesn't exist,</code>&#13;
<code class="c1">// no exception is thrown.</code>&#13;
<code class="nx">localStorage</code><code class="p">.</code><code class="nx">removeItem</code><code class="p">(</code><code class="s1">'my-key'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Call <code>localStorage.clear</code> to remove <em>all</em> data from local storage for the current origin, as shown in <a data-type="xref" href="#example2-15">Example 2-15</a>.</p>&#13;
<div data-type="example" id="example2-15">&#13;
<h5><span class="label">Example 2-15. </span>Removing all items from local storage</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">localStorage</code><code class="p">.</code><code class="nx">clear</code><code class="p">();</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id36">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Browsers limit the amount of data that you can store in Web Storage. Typically, the limit is about 5 MB. To avoid running out of space and throwing an error, you should remove items once they are no longer needed. Depending on what you’re using Web Storage for, you can also provide a way for your users to clear stored data. Consider an emoji picker that stores recently selected emojis in local storage. You might add a Clear Recents button that removes these items<a data-startref="ix_02-web-storage-api-asciidoc0" data-type="indexterm" id="id769"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>