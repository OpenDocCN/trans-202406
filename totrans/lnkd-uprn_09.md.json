["```\n# Install booksapp...\n$ kubectl create ns booksapp && \\\n  curl --proto '=https' --tlsv1.2 -sSfL https://run.linkerd.io/booksapp.yml \\\n  | linkerd inject - \\\n  | kubectl -n booksapp apply -f -\n\n# Wait for Pods to be running...\n$ kubectl rollout status -n booksapp deploy\n\n# ...then test using a port forward.\n$ kubectl -n booksapp port-forward svc/webapp 8080:80\n\n# Now browse to localhost:8080.\n```", "```\n# Create books-infra-policy.yaml.\n$ cat <<EOF > books-infra-policy.yaml\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: Server\nmetadata:\n namespace: booksapp\n name: linkerd-admin\nspec:\n podSelector:\n matchLabels: {}\n port: linkerd-admin\n proxyProtocol: HTTP/2\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n name: allow-viz\n namespace: booksapp\nspec:\n targetRef:\n kind: Namespace\n name: booksapp\n requiredAuthenticationRefs:\n - name: linkerd-viz\n kind: MeshTLSAuthentication\n group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n name: linkerd-viz\n namespace: booksapp\nspec:\n identities:\n - \"tap.linkerd-viz.serviceaccount.identity.linkerd.cluster.local\"\n - \"prometheus.linkerd-viz.serviceaccount.identity.linkerd.cluster.local\"\nEOF\n```", "```\n# Apply the YAML we just created...\n$ kubectl apply -f books-infra-policy.yaml\n\n# Switch `booksapp` to default deny...\n$ kubectl annotate namespace booksapp config.linkerd.io/default-inbound-policy=deny\n\n# ...and finally, restart the booksapp workloads.\n$ kubectl rollout restart deployment -n booksapp\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: Server\nmetadata:\n  namespace: booksapp\n  name: authors\n  labels:\n    app: authors\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  podSelector:\n    matchLabels:\n      app: authors\n      project: booksapp\n  port: service\n  proxyProtocol: HTTP/1\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: authors-get-route\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  parentRefs:\n    - name: authors\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/authors.json\"\n        method: GET\n      - path:\n          value: \"/authors/\"\n          type: \"PathPrefix\"\n        method: GET\n```", "```\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: allow-books-to-authors\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: authors-get-route\n  requiredAuthenticationRefs:\n    - name: books\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: books\n  namespace: booksapp\nspec:\n  identities:\n    - \"books.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: books-probes\n  namespace: booksapp\nspec:\n  parentRefs:\n    - name: authors\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/ping\"\n        method: GET\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: authors-probe\n  namespace: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: books-probes\n  requiredAuthenticationRefs:\n    - name: probe-authn\n      kind: NetworkAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: NetworkAuthentication\nmetadata:\n  name: probe-authn\n  namespace: booksapp\nspec:\n  networks:\n  - cidr: 0.0.0.0/0\n  - cidr: ::/0\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: Server\nmetadata:\n  namespace: booksapp\n  name: books\n  labels:\n    app: books\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  podSelector:\n    matchLabels:\n      app: books\n      project: booksapp\n  port: service\n  proxyProtocol: HTTP/1\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: books-get-route\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  parentRefs:\n    - name: books\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/books.json\"\n        method: GET\n      - path:\n          value: \"/books/\"\n          type: \"PathPrefix\"\n        method: GET\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: allow-authors-to-books\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: books-get-route\n  requiredAuthenticationRefs:\n    - name: authors\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: authors\n  namespace: booksapp\nspec:\n  identities:\n    - \"authors.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: authors-probes\n  namespace: booksapp\nspec:\n  parentRefs:\n    - name: authors\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/ping\"\n        method: GET\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: authors-probe\n  namespace: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: authors-probes\n  requiredAuthenticationRefs:\n    - name: probe-authn\n      kind: NetworkAuthentication\n      group: policy.linkerd.io\n```", "```\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: allow-webapp-to-books\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: authors-get-route\n  requiredAuthenticationRefs:\n    - name: webapp\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: allow-webapp-to-authors\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: authors-get-route\n  requiredAuthenticationRefs:\n    - name: webapp\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: webapp\n  namespace: booksapp\nspec:\n  identities:\n    - \"webapp.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: authors-modify-route\n  namespace: booksapp\nspec:\n  parentRefs:\n    - name: authors\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/authors/\"\n          type: \"PathPrefix\"\n        method: DELETE\n      - path:\n          value: \"/authors/\"\n          type: \"PathPrefix\"\n        method: PUT\n      - path:\n          value: \"/authors.json\"\n        method: POST\n      - path:\n          value: \"/\"\n---\n```", "```\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: authors-modify-policy\n  namespace: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: authors-modify-route\n  requiredAuthenticationRefs:\n    - name: webapp-books\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: webapp-books\n  namespace: booksapp\nspec:\n  identities:\n    - \"webapp.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n    - \"books.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: HTTPRoute\nmetadata:\n  name: books-modify-route\n  namespace: booksapp\nspec:\n  parentRefs:\n    - name: books\n      kind: Server\n      group: policy.linkerd.io\n  rules:\n    - matches:\n      - path:\n          value: \"/books/\"\n          type: \"PathPrefix\"\n        method: DELETE\n      - path:\n          value: \"/books/\"\n          type: \"PathPrefix\"\n        method: PUT\n      - path:\n          value: \"/books.json\"\n        method: POST\n      - path:\n          value: \"/\"\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: books-modify-policy\n  namespace: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: HTTPRoute\n    name: books-modify-route\n  requiredAuthenticationRefs:\n    - name: webapp-authors\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: webapp-authors\n  namespace: booksapp\nspec:\n  identities:\n    - \"webapp.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n    - \"authors.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n```", "```\n---\napiVersion: policy.linkerd.io/v1beta1\nkind: Server\nmetadata:\n  namespace: booksapp\n  name: webapp-server\n  labels:\n    app: webapp\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  podSelector:\n    matchLabels:\n      app: webapp\n      project: booksapp\n  port: service\n  proxyProtocol: HTTP/1\n```", "```\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: AuthorizationPolicy\nmetadata:\n  name: allow-traffic\n  namespace: booksapp\n  labels:\n    app.kubernetes.io/part-of: booksapp\n    project: booksapp\nspec:\n  targetRef:\n    group: policy.linkerd.io\n    kind: Server\n    name: webapp\n  requiredAuthenticationRefs:\n    - name: traffic\n      kind: MeshTLSAuthentication\n      group: policy.linkerd.io\n---\napiVersion: policy.linkerd.io/v1alpha1\nkind: MeshTLSAuthentication\nmetadata:\n  name: traffic\n  namespace: booksapp\nspec:\n  identities:\n    - \"traffic.booksapp.serviceaccount.identity.linkerd.cluster.local\"\n```"]