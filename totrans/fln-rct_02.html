<html><head></head><body><section class="pagenumrestart" data-pdf-bookmark="Chapter 1. The Entry-Level Stuff" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch01">&#13;
<h1><span class="label">Chapter 1. </span>The Entry-Level Stuff</h1>&#13;
&#13;
&#13;
<p>Let’s start with a disclaimer: React<a data-primary="React" data-type="indexterm" id="ix_React.01.5.37"/> was made to be used by all. In&#13;
fact, you could go through life having never read this book and continue&#13;
to use React without problems! This book dives much deeper into React&#13;
for those of us who are curious about its underlying mechanism,&#13;
advanced patterns, and best practices<a data-primary="optimizations" data-see="performance" data-type="indexterm" id="id266"/><a data-primary="JavaScript XML" data-see="JSX" data-type="indexterm" id="id267"/><a data-primary="updates" data-secondary="prioritizing" data-see="prioritizing updates" data-type="indexterm" id="id268"/><a data-primary="frameworks" data-secondary="Next.js" data-see="Next.js" data-type="indexterm" id="id269"/><a data-primary="RSCs" data-see="React Server Components" data-type="indexterm" id="id270"/><a data-primary="React" data-secondary="virtual DOM" data-see="virtual DOM" data-type="indexterm" id="id271"/><a data-primary="primitive types" data-see="scalars" data-type="indexterm" id="id272"/><a data-primary="rendering" data-secondary="server-side" data-see="server-side rendering" data-type="indexterm" id="id273"/><a data-primary="rendering" data-secondary="concurrent" data-see="concurrent rendering and updating" data-type="indexterm" id="id274"/><a data-primary="updates" data-secondary="concurrent" data-see="concurrent rendering and updating" data-type="indexterm" id="id275"/><a data-primary="rendering" data-secondary="synchronous" data-see="synchronous rendering" data-type="indexterm" id="id276"/><a data-primary="rendering" data-secondary="asynchronous" data-see="asynchronous rendering" data-type="indexterm" id="id277"/><a data-primary="SSR" data-see="server-side rendering" data-type="indexterm" id="id278"/>. It lends itself better to knowing&#13;
how React works instead of learning how to use React. There are plenty&#13;
of other books that are written with the intent to teach folks how to&#13;
use React as an end user. In contrast, this book will help you&#13;
understand React at the level of a library or framework author instead of&#13;
an end user. In keeping with that theme, let’s go on a deep dive&#13;
together, starting at the top: the higher-level, entry-level topics.&#13;
We’ll start with the basics of React, and then dive deeper and deeper&#13;
into the details of how React works.</p>&#13;
&#13;
<p>In this chapter, we’ll talk about why React exists, how it works, and&#13;
what problems it solves. We’ll cover its initial inspiration and design,&#13;
and follow it from its humble beginnings at Facebook to the prevalent&#13;
solution that it is today. This chapter is a bit of a meta chapter (no&#13;
pun intended), because it’s important to understand the context of React&#13;
before we dive into the details.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Why Is React a Thing?" data-type="sect1"><div class="sect1" id="id2">&#13;
<h1>Why Is React a Thing?</h1>&#13;
&#13;
<p>The answer<a data-primary="React" data-secondary="updates as central feature" data-type="indexterm" id="ix_Reactupdatesascentralfeature.01.28.11"/> in one word is: <em>updates</em>. In the early days of the web, we&#13;
had a lot of static pages. We’d fill out forms, hit Submit, and load an&#13;
entirely new page. This was fine for a while, but eventually web&#13;
experiences evolved significantly in terms of capabilities. As the&#13;
capabilities grew, so did our desire for superior user experiences on&#13;
the web. We wanted to be able to see things update instantly without&#13;
having to wait for a new page to be rendered and loaded. We wanted the&#13;
web and its pages to feel <em>snappier</em> and more “instant.” The problem&#13;
was that these instant updates were pretty hard to do <em>at scale</em> for a&#13;
number of reasons:</p>&#13;
<dl>&#13;
<dt>Performance</dt>&#13;
<dd>&#13;
<p>Making updates to web pages often caused performance<a data-primary="performance" data-secondary="challenge for web as it grew" data-type="indexterm" id="id279"/>&#13;
bottlenecks because we were prone to perform work that triggered&#13;
browsers to recalculate a page’s layout (called a reflow) and repaint&#13;
the page.</p>&#13;
</dd>&#13;
<dt>Reliability</dt>&#13;
<dd>&#13;
<p>Keeping track of state and making sure that the state&#13;
was consistent across a rich web experience was hard to do because we&#13;
had to keep track of state in multiple places and make sure that the&#13;
state was consistent across all of those places. This was especially&#13;
hard to do when we had multiple people working on the same codebase.</p>&#13;
</dd>&#13;
<dt>Security</dt>&#13;
<dd>&#13;
<p>We had to be sure<a data-primary="security" data-secondary="as web challenge" data-secondary-sortas="web challenge" data-type="indexterm" id="id280"/> to sanitize all HTML and JavaScript that&#13;
we were injecting into the page to prevent exploits like cross-site&#13;
scripting (XSS)<a data-primary="cross-site scripting (XSS)" data-type="indexterm" id="id281"/><a data-primary="XSS (cross-site scripting)" data-type="indexterm" id="id282"/> and cross-site request forgery (CSRF)<a data-primary="cross-site request forgery (CSRF)" data-type="indexterm" id="id283"/>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>To fully understand and appreciate how React solves these problems for&#13;
us, we need to understand the context in which React was created and the&#13;
world without or before React. Let’s do that now<a data-startref="ix_Reactupdatesascentralfeature.01.28.11" data-type="indexterm" id="id284"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The World Before React" data-type="sect1"><div class="sect1" id="id3">&#13;
<h1>The World Before React</h1>&#13;
&#13;
<p>These were some of the large problems for those of us building web apps&#13;
before React<a data-primary="React" data-secondary="web app challenges and solutions prior to" data-type="indexterm" id="ix_Reactwebappchallengesandsolutionspriorto.01.63.14"/>. We had to figure out how to make our apps feel snappy and&#13;
instant, but also scale to millions of users and work reliably in a safe&#13;
way. For example, let’s consider a button click: when a user clicks a&#13;
button, we want to update the user interface to reflect that the button&#13;
has been clicked. We’ll need to consider at least four different states that&#13;
the user interface can be in:</p>&#13;
<dl>&#13;
<dt>Pre-click</dt>&#13;
<dd>&#13;
<p>The button is in its default state and has not been&#13;
clicked.</p>&#13;
</dd>&#13;
<dt>Clicked but pending</dt>&#13;
<dd>&#13;
<p>The button has been clicked, but the action that&#13;
the button is supposed to perform has not yet completed.</p>&#13;
</dd>&#13;
<dt>Clicked and succeeded</dt>&#13;
<dd>&#13;
<p>The button has been clicked, and the action that&#13;
the button is supposed to perform has completed. From here, we may want&#13;
to revert the button to its pre-click state, or we may want the button&#13;
to change color (green) to indicate success.</p>&#13;
</dd>&#13;
<dt>Clicked and failed</dt>&#13;
<dd>&#13;
<p>The button has been clicked, but the action that&#13;
the button is supposed to perform has failed. From here, we may want to&#13;
revert the button to its pre-click state, or we may want the button to&#13;
change color (red) to indicate failure.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Once we have these states, we need to figure out how to update the user&#13;
interface to reflect them. Oftentimes, updating the user interface<a data-primary="user interface (UI)" data-type="indexterm" id="ix_userinterfaceUI.01.89.67"/><a data-primary="updates" data-secondary="process prior to React" data-type="indexterm" id="ix_updatesprocesspriortoReact.01.89.67"/>&#13;
would require the following steps:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Find the button in the host environment (often the browser) using some&#13;
type of element locator API, such as <code>document.querySelector</code> or&#13;
<code>document.getElementById</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Attach event listeners to the button to listen for click events.</p>&#13;
</li>&#13;
<li>&#13;
<p>Perform any state updates in response to events.</p>&#13;
</li>&#13;
<li>&#13;
<p>When the button leaves the page, remove the event listeners and clean&#13;
up any state.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>This is a simple example, but it’s a good one to start with. Let’s say&#13;
we have a button labeled “Like,” and when a user clicks it, we want&#13;
to update the button to “Liked.” How do we do this? To start with,&#13;
we’d have an HTML element:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code><code class="p">&gt;</code>Like<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>We’d need some way to reference this button with JavaScript, so we’d&#13;
give it an <code>id</code> attribute:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code> <code class="na">id</code><code class="o">=</code><code class="s">"likeButton"</code><code class="p">&gt;</code>Like<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Great! Now that there’s an <code>id</code>, JavaScript can work with it to make it&#13;
interactive. We can get a reference to the button using&#13;
<code>document.getElementById</code>, and then we’ll add an event listener to the&#13;
button to listen for click events:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// do something</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Now that we have an event listener<a data-primary="event listeners" data-type="indexterm" id="id285"/>, we can do something when the button&#13;
is clicked. Let’s say we want to update the button to have the label&#13;
“Liked” when it’s clicked. We can do this by updating the button’s&#13;
text content:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p class="pagebreak-before">Great! Now we have a button that says “Like,” and when it’s clicked, it&#13;
says “Liked.” The problem here is that we can’t “unlike” things.&#13;
Let’s fix that and update the button to say “Like” again if it’s&#13;
clicked in its “Liked” state. We’d need to add some state to the&#13;
button to keep track of whether or not it’s been clicked. We can do this&#13;
by adding a <code>data-liked</code> attribute to the button:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code> <code class="na">id</code><code class="o">=</code><code class="s">"likeButton"</code> <code class="na">data-liked</code><code class="o">=</code><code class="s">"false"</code><code class="p">&gt;</code>Like<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Now that we have this attribute, we can use it to keep track of whether&#13;
or not the button has been clicked. We can update the button’s text&#13;
content based on the value of this attribute:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">liked</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">,</code> <code class="o">!</code><code class="nx">liked</code><code class="p">);</code>&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">liked</code> <code class="o">?</code> <code class="s2">"Like"</code> <code class="o">:</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Wait, but we’re just changing the <code>textContent</code> of the button! We’re not&#13;
actually saving the “Liked” state<a data-primary="state management" data-secondary="saving state to database" data-type="indexterm" id="id286"/> to a database. Normally, to do this we&#13;
had to communicate over the network, like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kd">var</code> <code class="nx">liked</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
&#13;
  <code class="c1">// communicate over the network</code>&#13;
  <code class="kd">var</code> <code class="nx">xhr</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">XMLHttpRequest</code><code class="p">();</code>&#13;
  <code class="nx">xhr</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="s2">"POST"</code><code class="p">,</code> <code class="s2">"/like"</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
  <code class="nx">xhr</code><code class="p">.</code><code class="nx">setRequestHeader</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code> <code class="s2">"application/json;charset=UTF-8"</code><code class="p">);</code>&#13;
&#13;
  <code class="nx">xhr</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">xhr</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;=</code> <code class="mi">200</code> <code class="o">&amp;&amp;</code> <code class="nx">xhr</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">400</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="c1">// Success!</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">,</code> <code class="o">!</code><code class="nx">liked</code><code class="p">);</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">liked</code> <code class="o">?</code> <code class="s2">"Like"</code> <code class="o">:</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// We reached our target server, but it returned an error</code>&#13;
      <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s2">"Server returned an error:"</code><code class="p">,</code> <code class="nx">xhr</code><code class="p">.</code><code class="nx">statusText</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="nx">xhr</code><code class="p">.</code><code class="nx">onerror</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// There was a connection error of some sort</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s2">"Network error."</code><code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="nx">xhr</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="nx">liked</code> <code class="p">}));</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Of course, we’re using <code>XMLHttpRequest</code> and <code>var</code> to be&#13;
time relevant. React was released as open source software in 2013, and the more common&#13;
<code>fetch</code> API was introduced in 2015. In between <code>XMLHttpRequest</code> and&#13;
<code>fetch</code>, we had jQuery that often abstracted away some complexity with&#13;
primitives like <code>$.ajax()</code>, <code>$.post()</code>, etc.</p>&#13;
&#13;
<p>If we were to write this today, it would look more like this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">liked</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
&#13;
  <code class="c1">// communicate over the network</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="nx">liked</code> <code class="p">}),</code>&#13;
  <code class="p">}).</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">,</code> <code class="o">!</code><code class="nx">liked</code><code class="p">);</code>&#13;
    <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">liked</code> <code class="o">?</code> <code class="s2">"Like"</code> <code class="o">:</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Without digressing too much, the point now is that we’re communicating&#13;
over the network, but what if the network request fails? We’d need to&#13;
update the button’s text content to reflect the failure. We can do this by adding a <code>data-failed</code> attribute to the&#13;
button:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code> <code class="na">id</code><code class="o">=</code><code class="s">"likeButton"</code> <code class="na">data-liked</code><code class="o">=</code><code class="s">"false"</code> <code class="na">data-failed</code><code class="o">=</code><code class="s">"false"</code><code class="p">&gt;</code>Like<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Now we can update the button’s text content based on the value of this&#13;
attribute:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">liked</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
&#13;
  <code class="c1">// communicate over the network</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="nx">liked</code> <code class="p">}),</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">,</code> <code class="o">!</code><code class="nx">liked</code><code class="p">);</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">liked</code> <code class="o">?</code> <code class="s2">"Like"</code> <code class="o">:</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
    <code class="p">})</code>&#13;
    <code class="p">.</code><code class="k">catch</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-failed"</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s2">"Failed"</code><code class="p">;</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>There’s one more case to handle: the process of currently “liking” a&#13;
thing. That is, the pending state. To model this in code, we’d set yet&#13;
another attribute on the button for the pending state by adding&#13;
<code>data-pending</code>, like so:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code>&#13;
  <code class="na">id</code><code class="o">=</code><code class="s">"likeButton"</code>&#13;
  <code class="na">data-pending</code><code class="o">=</code><code class="s">"false"</code>&#13;
  <code class="na">data-liked</code><code class="o">=</code><code class="s">"false"</code>&#13;
  <code class="na">data-failed</code><code class="o">=</code><code class="s">"false"</code>&#13;
<code class="p">&gt;</code>&#13;
  Like&#13;
<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Now we can disable the button if a network request is in process so&#13;
that multiple clicks don’t queue up network requests and lead to odd&#13;
race conditions and server overload. We can do that like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"likeButton"</code><code class="p">);</code>&#13;
<code class="nx">likeButton</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">liked</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
  <code class="kr">const</code> <code class="nx">isPending</code> <code class="o">=</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s2">"data-pending"</code><code class="p">)</code> <code class="o">===</code> <code class="s2">"true"</code><code class="p">;</code>&#13;
&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-pending"</code><code class="p">,</code> <code class="s2">"true"</code><code class="p">);</code>&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"disabled"</code><code class="p">,</code> <code class="s2">"disabled"</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// communicate over the network</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="nx">liked</code> <code class="p">}),</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-liked"</code><code class="p">,</code> <code class="o">!</code><code class="nx">liked</code><code class="p">);</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">liked</code> <code class="o">?</code> <code class="s2">"Like"</code> <code class="o">:</code> <code class="s2">"Liked"</code><code class="p">;</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"disabled"</code><code class="p">,</code> <code class="kc">null</code><code class="p">);</code>&#13;
    <code class="p">})</code>&#13;
    <code class="p">.</code><code class="k">catch</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-failed"</code><code class="p">,</code> <code class="s2">"true"</code><code class="p">);</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s2">"Failed"</code><code class="p">;</code>&#13;
    <code class="p">})</code>&#13;
    <code class="p">.</code><code class="k">finally</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">likeButton</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"data-pending"</code><code class="p">,</code> <code class="s2">"false"</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>We can also make use of powerful techniques like debouncing and&#13;
throttling to prevent users from performing redundant or repetitive&#13;
actions.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>As a quick aside, we mention <a data-primary="debouncing" data-type="indexterm" id="id287"/><a data-primary="throttling" data-type="indexterm" id="id288"/>debouncing and throttling. For clarity,&#13;
debouncing delays a function’s execution until after a set time has&#13;
passed since the last event trigger (e.g., waits for users to stop&#13;
typing to process input), and throttling limits a function to running at&#13;
most once every set time interval, ensuring it doesn’t execute too&#13;
frequently (e.g., processes scroll events at set intervals). Both&#13;
techniques optimize performance by controlling function execution rates.</p>&#13;
</div>&#13;
&#13;
<p>OK, now our button is kind of robust and can handle multiple&#13;
states—but some questions still remain:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Is <code>data-pending</code> really necessary? Can’t we just check if the button&#13;
is disabled? Probably not, because a disabled button could be disabled&#13;
for other reasons, like the user not being logged in or not&#13;
having permission to click the button.</p>&#13;
</li>&#13;
<li>&#13;
<p>Would it make more sense to have a <code>data-state</code> attribute, where&#13;
<code>data-state</code> can be one of <code>pending</code>, <code>liked</code>, or <code>unliked</code>, instead of&#13;
so many other data attributes? Probably, but then we’d need to add a&#13;
large switch/case or similar code block to handle each case. Ultimately,&#13;
the volume of code to handle both approaches is incomparable: we still&#13;
end up with complexity and verbosity either way.</p>&#13;
</li>&#13;
<li>&#13;
<p>How do we test this button in isolation? Can we?</p>&#13;
</li>&#13;
<li>&#13;
<p>Why do we have the button initially written in HTML<a data-primary="HTML" data-secondary="versus all code in JavaScript" data-secondary-sortas="all code in JavaScript" data-type="indexterm" id="id289"/><a data-primary="JavaScript" data-secondary="versus HTML/JavaScript combo code" data-secondary-sortas="HTML/JavaScript combo code" data-type="indexterm" id="id290"/><a data-primary="JavaScript" data-seealso="JSX" data-type="indexterm" id="id291"/>, and then later&#13;
work with it in JavaScript? Wouldn’t it be better if we could just&#13;
create the button in JavaScript with <code>document.createElement('button')</code>&#13;
and then <code>document.appendChild(likeButton)</code>? This would make it easier&#13;
to test and would make the code more self-contained, but then we’d have&#13;
to keep track of its parent if its parent isn’t <code>document</code>. In fact, we&#13;
might have to keep track of <em>all</em> the parents on the page<a data-startref="ix_userinterfaceUI.01.89.67" data-type="indexterm" id="id292"/><a data-startref="ix_updatesprocesspriortoReact.01.89.67" data-type="indexterm" id="id293"/>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>React helps us solve some of these problems but not all of them: for&#13;
example, the question of how to break up state into separate flags&#13;
(<code>isPending</code>, <code>hasFailed</code>, etc.) or a single state variable (like&#13;
<code>state</code>) is a question that React doesn’t answer for us. It’s a question&#13;
that we have to answer for ourselves. However, React does help us solve&#13;
the problem of scale<a data-primary="scaling of code" data-type="indexterm" id="id294"/>: creating a lot of buttons that need to be&#13;
interactive and updating the user interface in response to events in a&#13;
minimal and efficient way, and doing this in a testable, reproducible,&#13;
declarative, performant, predictable, and reliable way.</p>&#13;
&#13;
<p>Moreover, React helps us make state far more predictable<a data-primary="state management" data-secondary="increasing predictability of" data-type="indexterm" id="id295"/><a data-primary="React" data-secondary="as owner of states" data-secondary-sortas="owner of states" data-type="indexterm" id="id296"/><a data-primary="state management" data-secondary="React’s approach" data-type="indexterm" id="id297"/> by fully owning&#13;
the state of the user interface and rendering based on that state. This&#13;
is in stark contrast to having the state be owned and operated on by the&#13;
browser<a data-primary="browsers" data-secondary="as owner of state" data-secondary-sortas="owner of state" data-type="indexterm" id="id298"/><a data-primary="state management" data-secondary="browser as owner of state" data-type="indexterm" id="id299"/>, whose state can be largely unreliable due to a number of&#13;
factors like other client-side scripts running on the page, browser&#13;
extensions, device constraints, and so many more variables.</p>&#13;
&#13;
<p>Our example with the Like button is a very simple example, but it’s a&#13;
good one to start with. So far, we’ve seen how we can use JavaScript to&#13;
make a button interactive, but this is a very manual process if we want&#13;
to do it <em>well</em>: we have to find the button in the browser, add an event&#13;
listener, update the button’s text content, and account for myriad edge&#13;
cases. This is a lot of work, and it’s not very scalable. What if we had&#13;
a lot of buttons on the page? What if we had a lot of buttons that&#13;
needed to be interactive? What if we had a lot of buttons that needed to&#13;
be interactive, and we needed to update the user interface in response&#13;
to events? Would we use event delegation (or event bubbling)<a data-primary="event delegation (event bubbling)" data-type="indexterm" id="id300"/> and attach&#13;
an event listener to the higher <code>document</code>? Or should we attach event&#13;
listeners to each button?</p>&#13;
&#13;
<p>As stated in the Preface, this book assumes we have a satisfactory&#13;
understanding of this statement: browsers render web pages. Web pages&#13;
are HTML documents that are styled by CSS and made interactive with&#13;
JavaScript. This has worked great for decades and still does, but&#13;
building modern web applications that are intended to service a&#13;
significant (think millions) amount of users with these technologies&#13;
requires a good amount of abstraction in order to do it safely and&#13;
reliably with as little possibility for error as possible. Unfortunately,&#13;
based on the example of the Like button that we’ve been exploring, it’s&#13;
clear that we’re going to need some help with this.</p>&#13;
&#13;
<p>Let’s consider another example that’s a little bit more complex than our&#13;
Like button. We’ll start with a simple example: a list of items. Let’s&#13;
say we have a list of items and we want to add a new item to the list.&#13;
We could do this with an HTML form that looks something like this:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">ul</code> <code class="na">id</code><code class="o">=</code><code class="s">"list-parent"</code><code class="p">&gt;&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">form</code> <code class="na">id</code><code class="o">=</code><code class="s">"add-item-form"</code> <code class="na">action</code><code class="o">=</code><code class="s">"/api/add-item"</code> <code class="na">method</code><code class="o">=</code><code class="s">"POST"</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">id</code><code class="o">=</code><code class="s">"new-list-item-label"</code> <code class="p">/&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code>Add Item<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>JavaScript gives us access to Document Object Model (DOM) APIs<a data-primary="Document Object Model (DOM)" data-secondary="APIs" data-type="indexterm" id="id301"/>. For the unaware, the DOM is an in-memory&#13;
model of a web page’s document structure: it’s a tree of objects that&#13;
represents the elements on your page, giving you ways to interact with&#13;
them via JavaScript. The problem is, the DOMs on user devices are like an&#13;
alien planet: we have no way of knowing what browsers they’re using, in&#13;
what network conditions, and on what operating systems (OS) they’re&#13;
working. The result? We have to write code that is resilient to all of&#13;
these factors.</p>&#13;
&#13;
<p>As we’ve discussed, application state becomes quite hard to predict when&#13;
it updates without some type of state-reconciliation mechanism to keep&#13;
track of things. To continue with our list example, let’s consider some&#13;
JavaScript code to add a new item to the list:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="p">(</code><code class="kd">function</code> <code class="nx">myApp</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kd">var</code> <code class="nx">listItems</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"I love"</code><code class="p">,</code> <code class="s2">"React"</code><code class="p">,</code> <code class="s2">"and"</code><code class="p">,</code> <code class="s2">"TypeScript"</code><code class="p">];</code>&#13;
  <code class="kd">var</code> <code class="nx">parentList</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"list-parent"</code><code class="p">);</code>&#13;
  <code class="kd">var</code> <code class="nx">addForm</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"add-item-form"</code><code class="p">);</code>&#13;
  <code class="kd">var</code> <code class="nx">newListItemLabel</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"new-list-item-label"</code><code class="p">);</code>&#13;
&#13;
  <code class="nx">addForm</code><code class="p">.</code><code class="nx">onsubmit</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
    <code class="nx">listItems</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">newListItemLabel</code><code class="p">.</code><code class="nx">value</code><code class="p">);</code>&#13;
    <code class="nx">renderListItems</code><code class="p">();</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="kd">function</code> <code class="nx">renderListItems</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">for</code> <code class="p">(</code><code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">listItems</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="kd">var</code> <code class="nx">el</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s2">"li"</code><code class="p">);</code>&#13;
      <code class="nx">el</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">listItems</code><code class="p">[</code><code class="nx">i</code><code class="p">];</code>&#13;
      <code class="nx">parentList</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">el</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">renderListItems</code><code class="p">();</code>&#13;
<code class="p">})();</code></pre>&#13;
&#13;
<p>This code snippet is written to look as similar as possible to early web&#13;
applications. Why does this go haywire over time? Mainly because&#13;
building applications intended to scale<a data-primary="scaling of code" data-type="indexterm" id="ix_scalingofcode.01.456.40"/> this way over time presents some&#13;
footguns, making them:</p>&#13;
<dl>&#13;
<dt>Error prone</dt>&#13;
<dd>&#13;
<p><code>addForm</code>’s <code>onsubmit</code> attribute could be easily&#13;
rewritten by other client-side JavaScript on the page. We could use&#13;
<code>addEventListener</code> instead, but this presents more questions:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Where and when would we clean it up with <code>removeEventListener</code>?</p>&#13;
</li>&#13;
<li>&#13;
<p>Would we accumulate a lot of event listeners over time if we’re not&#13;
careful about this?</p>&#13;
</li>&#13;
<li>&#13;
<p>What penalties will we pay because of it?</p>&#13;
</li>&#13;
<li>&#13;
<p>How does event delegation fit into this?</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>Unpredictable</dt>&#13;
<dd>&#13;
<p>Our sources of truth are mixed: we’re holding list&#13;
items in a JavaScript array, but relying on existing elements in the DOM&#13;
(like an element with <code>id="list-parent"</code>) to complete our app. Because&#13;
of these interdependencies between JavaScript and HTML, we have a few&#13;
more things to consider:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>What if there are mistakenly multiple elements with the same <code>id</code>?</p>&#13;
</li>&#13;
<li>&#13;
<p>What if the element doesn’t exist at all?</p>&#13;
</li>&#13;
<li>&#13;
<p>What if it’s not a <code>ul</code>? Can we append list items (<code>li</code> elements) to&#13;
other parents?</p>&#13;
</li>&#13;
<li>&#13;
<p>What if we use class names instead?</p>&#13;
&#13;
<p>Our sources of truth are mixed between <a data-primary="JavaScript" data-secondary="versus HTML/JavaScript combo code" data-secondary-sortas="HTML/JavaScript combo code" data-type="indexterm" id="id302"/><a data-primary="HTML" data-secondary="versus all code in JavaScript" data-secondary-sortas="all code in JavaScript" data-type="indexterm" id="id303"/>JavaScript and HTML, making the&#13;
truth unreliable. We’d benefit more from having a single source of&#13;
truth. Moreover, elements are added and removed from the DOM by&#13;
client-side JavaScript all the time. If we rely on the existence of&#13;
these specific elements, our app has no guarantees of working reliably&#13;
as the UI keeps updating. Our app in this case is full of&#13;
“side effects,” where its success or failure depends on some userland&#13;
concern. React has remedied this by advocating a functional&#13;
programming-inspired model where side effects are intentionally marked&#13;
and isolated.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>Inefficient</dt>&#13;
<dd>&#13;
<p><code>renderListItems</code> renders items on the screen&#13;
sequentially. Each mutation of the DOM can be computationally expensive,&#13;
especially where layout shift and reflows are concerned. Since we’re on&#13;
an alien planet with unknown computational power, this can be quite&#13;
unsafe for performance in case of large lists. Remember, we’re intending&#13;
our large-scale web application to be used by millions&#13;
worldwide, including those with low-power devices from communities across&#13;
the world without access to the latest and greatest Apple M3 Max&#13;
processors. What may be more ideal in this scenario, instead of&#13;
sequentially updating the DOM<a data-primary="Document Object Model (DOM)" data-secondary="APIs" data-type="indexterm" id="id304"/> per single list item, would be to batch&#13;
these operations somehow and apply them all to the DOM at the same time.&#13;
But maybe this isn’t worth doing for us as engineers because perhaps&#13;
browsers will eventually update the way they work with quick updates to&#13;
the DOM and automatically batch things for us<a data-startref="ix_scalingofcode.01.456.40" data-type="indexterm" id="id305"/>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>These are some of the problems that have plagued web developers for&#13;
years before React and other abstractions appeared. Packaging code in a&#13;
way that was maintainable, reusable, and predictable at scale was a&#13;
problem without much standardized consensus in the industry. This pain&#13;
of creating reliable and scalable user interfaces was shared by many web&#13;
companies at the time. It was at this point on the web that we saw the&#13;
rise of multiple JavaScript-based solutions that aimed to solve this:&#13;
Backbone, KnockoutJS, AngularJS, and jQuery. Let’s look at these&#13;
solutions in turn and see how they solved this problem. This will help&#13;
us understand how React is different from these solutions, and may even&#13;
be superior to them.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="jQuery" data-type="sect2"><div class="sect2" id="id4">&#13;
<h2>jQuery</h2>&#13;
&#13;
<p>Let’s explore how we solved some of these issues earlier on the web&#13;
using tools that predate React and thus learn why React is important.&#13;
We’ll start with jQuery<a data-primary="jQuery" data-type="indexterm" id="ix_jQuery.01.522.24"/>, and we’ll do so by revisiting our Like button&#13;
example from earlier.</p>&#13;
&#13;
<p>To recap, we’ve got a Like button in the browser that we’d like to make&#13;
interactive:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code> <code class="na">id</code><code class="o">=</code><code class="s">"likeButton"</code><code class="p">&gt;</code>Like<code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>With jQuery, we’d add “like” behavior to it as we did earlier, like&#13;
this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">$</code><code class="p">(</code><code class="s2">"#likeButton"</code><code class="p">).</code><code class="nx">on</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">this</code><code class="p">.</code><code class="nx">prop</code><code class="p">(</code><code class="s2">"disabled"</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">text</code><code class="p">()</code> <code class="o">===</code> <code class="s2">"Like"</code> <code class="p">}),</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">text</code><code class="p">()</code> <code class="o">===</code> <code class="s2">"Like"</code> <code class="o">?</code> <code class="s2">"Liked"</code> <code class="o">:</code> <code class="s2">"Like"</code><code class="p">);</code>&#13;
    <code class="p">})</code>&#13;
    <code class="p">.</code><code class="k">catch</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="s2">"Failed"</code><code class="p">);</code>&#13;
    <code class="p">})</code>&#13;
    <code class="p">.</code><code class="k">finally</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">prop</code><code class="p">(</code><code class="s2">"disabled"</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>From this example, we observe that we’re binding data to the user&#13;
interface and using this data binding<a data-primary="data binding" data-type="indexterm" id="id306"/> to update the user interface in&#13;
place. jQuery as a tool is quite active in directly manipulating the&#13;
user interface itself.</p>&#13;
&#13;
<p>jQuery runs in a heavily “side-effectful” way<a data-primary="“side-effectful” approach, jQuery" data-primary-sortas="side-effectful approach, jQuery" data-type="indexterm" id="id307"/>, constantly interacting&#13;
with and altering state outside of its own control. We say this is&#13;
“side-effectful” because it allows direct and global modifications to&#13;
the page’s structure from anywhere in the code, including from other&#13;
imported modules or even remote script execution! This can lead to&#13;
unpredictable behavior and complex interactions that are difficult to&#13;
track and reason about, as changes in one part of the page can affect&#13;
other parts in unforeseen ways. This scattered and unstructured&#13;
manipulation makes the code hard to maintain and debug.</p>&#13;
&#13;
<p>Modern frameworks address these issues by providing structured,&#13;
predictable ways to update the UI without direct DOM<a data-primary="Document Object Model (DOM)" data-secondary="jQuery’s reliance on" data-type="indexterm" id="id308"/> manipulation. This&#13;
pattern was common at the time, and it is&#13;
difficult to reason about and test because the world around the code,&#13;
that is, the application state adjacent to the code, is constantly&#13;
changing. At some point, we’d have to stop and ask ourselves: “what is&#13;
the state of the app in the browser right now?”—a question that became&#13;
increasingly difficult to answer as the complexity of our applications&#13;
grew.</p>&#13;
&#13;
<p>Moreover, this button with jQuery is hard to test<a data-primary="testing of code" data-secondary="jQuery’s reliance on browser disadvantage for" data-type="indexterm" id="id309"/> because it’s just an&#13;
event handler. If we were to write a test, it would look like this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">test</code><code class="p">(</code><code class="s2">"LikeButton"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">$button</code> <code class="o">=</code> <code class="nx">$</code><code class="p">(</code><code class="s2">"#likeButton"</code><code class="p">);</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">$button</code><code class="p">.</code><code class="nx">text</code><code class="p">()).</code><code class="nx">toBe</code><code class="p">(</code><code class="s2">"Like"</code><code class="p">);</code>&#13;
  <code class="nx">$button</code><code class="p">.</code><code class="nx">trigger</code><code class="p">(</code><code class="s2">"click"</code><code class="p">);</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">$button</code><code class="p">.</code><code class="nx">text</code><code class="p">()).</code><code class="nx">toBe</code><code class="p">(</code><code class="s2">"Liked"</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>The only problem is that <code>$('#likeButton')</code> returns <code>null</code> in the&#13;
testing environment because it’s not a real browser. We’d have to mock&#13;
out the browser environment to test this code, which is a lot of work.&#13;
This is a common problem with jQuery: it’s hard to test because it’s&#13;
hard to isolate the behavior it adds. jQuery also depends heavily on&#13;
the browser environment. Moreover, jQuery shares ownership of the user&#13;
interface with the <a data-primary="browsers" data-secondary="and jQuery" data-secondary-sortas="jQuery" data-type="indexterm" id="id310"/>browser, which makes it difficult to reason about and&#13;
test: the browser owns the interface, and jQuery is just a guest. This&#13;
deviation from the “one-way data flow” paradigm was a common problem&#13;
with libraries at the time.</p>&#13;
&#13;
<p>Eventually, jQuery started to lose its popularity as the web evolved and&#13;
the need for more robust and scalable solutions became apparent. While&#13;
jQuery is still used in many production applications, it’s no longer the&#13;
go-to solution for building modern web applications. Here are some of&#13;
the reasons why jQuery has fallen out of favor:</p>&#13;
<dl>&#13;
<dt>Weight and load times</dt>&#13;
<dd>&#13;
<p>One of the significant criticisms of jQuery&#13;
is its size. Integrating the full jQuery library<a data-primary="performance" data-secondary="jQuery weight and load times issue" data-type="indexterm" id="id311"/> into web projects adds&#13;
extra weight, which can be especially taxing for websites aiming for&#13;
fast load times. In today’s age of mobile browsing, where many users&#13;
might be on slower or limited data connections, every kilobyte counts.&#13;
The inclusion of the entire jQuery library can, therefore, negatively&#13;
impact the performance and experience of mobile users.</p>&#13;
&#13;
<p>A common practice before React was to offer configurators&#13;
for libraries like jQuery and Mootools<a data-primary="Mootools" data-type="indexterm" id="id312"/> where users could cherry-pick the&#13;
functionality they desired. While this helped ship less code, it did&#13;
introduce more complexity into the decisions developers had to&#13;
make, and into the overall development &#13;
<span class="keep-together">workflow.</span></p>&#13;
</dd>&#13;
<dt>Redundancy with modern browsers</dt>&#13;
<dd>&#13;
<p>When jQuery first emerged, it&#13;
addressed many inconsistencies across browsers and provided developers&#13;
with a unified way to handle these differences in the context of&#13;
selecting and then modifying elements in the browser. As the web&#13;
evolved, so did web browsers. Many features that made jQuery a&#13;
must-have, such as consistent DOM manipulation or network-oriented&#13;
functionality around data fetching, are now natively and consistently&#13;
supported across modern browsers. Using jQuery for these tasks in&#13;
contemporary web development can be seen as redundant, adding an&#13;
unnecessary layer of complexity.</p>&#13;
&#13;
<p><code>document.querySelector</code>, for example, quite easily replaces jQuery’s&#13;
built-in <code>$</code> selector API.</p>&#13;
</dd>&#13;
<dt>Performance considerations</dt>&#13;
<dd>&#13;
<p>While jQuery simplifies many tasks, it&#13;
often comes at the cost of performance. Native runtime-level JavaScript&#13;
methods improve with each browser iteration and thus at some point may&#13;
execute faster than their jQuery equivalents. For small projects, this&#13;
difference might be negligible. However, in larger and more complex web&#13;
applications these complexities can accumulate, leading to noticeable&#13;
jank or reduced responsiveness.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>For these reasons, while jQuery played a pivotal role in the web’s&#13;
evolution and simplified many challenges faced by developers, the modern&#13;
web landscape offers native solutions that often make jQuery less&#13;
relevant. As developers, we need to weigh the convenience of jQuery&#13;
against its potential drawbacks, especially in the context of current&#13;
web projects.</p>&#13;
&#13;
<p>jQuery, despite its drawbacks, was an absolute revolution in the way we&#13;
interacted with the DOM at the time. So much so that other libraries emerged&#13;
that used jQuery but added more predictability and reusability to the&#13;
mix. One such library was Backbone, which was an attempt to solve the&#13;
same problems React solves today, but much earlier<a data-startref="ix_jQuery.01.522.24" data-type="indexterm" id="id313"/>. Let’s dive in.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Backbone" data-type="sect2"><div class="sect2" id="id5">&#13;
<h2>Backbone</h2>&#13;
&#13;
<p>Backbone, developed in the early 2010s, was one of the first solutions to the problems we’ve been&#13;
exploring in the world before React: state dissonance between the&#13;
browser and JavaScript, code reuse, testability, and more. It was an&#13;
elegantly simple solution: a library that provided a way to create&#13;
“models” and “views.” <a data-primary="Model-View-Controller (MVC) pattern" data-type="indexterm" id="ix_ModelViewControllerMVCpattern.01.670.27"/><a data-primary="MVC (Model-View-Controller) pattern" data-type="indexterm" id="ix_MVCModelViewControllerpattern.01.670.27"/>Backbone<a data-primary="BackboneJS" data-type="indexterm" id="ix_Backbone.01.670.35"/> had its own take on the traditional&#13;
MVC (Model-View-Controller) pattern (see <a data-type="xref" href="#figure1-1">Figure 1-1</a>). Let’s understand this pattern a&#13;
little bit to help us understand React and form the basis of a&#13;
higher-quality &#13;
<span class="keep-together">discussion.</span></p>&#13;
&#13;
<figure><div class="figure" id="figure1-1">&#13;
<img alt="mvc" src="assets/frea_0101.png"/>&#13;
<h6><span class="label">Figure 1-1. </span>Traditional MVC pattern</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The MVC pattern" data-type="sect3"><div class="sect3" id="id6">&#13;
<h3>The MVC pattern</h3>&#13;
&#13;
<p>The MVC pattern is a design philosophy that&#13;
divides software applications into three interconnected components to&#13;
separate internal representations of information from how that&#13;
information is presented to or accepted from the user. Here’s a&#13;
breakdown:</p>&#13;
<dl>&#13;
<dt>Model</dt>&#13;
<dd>&#13;
<p>The Model<a data-primary="Model, MVC" data-type="indexterm" id="id314"/> is responsible for the data and the business rules&#13;
of the application. The Model is unaware of the View and Controller,&#13;
ensuring that the business logic is isolated from the user interface.</p>&#13;
</dd>&#13;
<dt>View</dt>&#13;
<dd>&#13;
<p>The View<a data-primary="View, MVC pattern" data-type="indexterm" id="id315"/> represents the user interface of the application. It&#13;
displays data from the Model to the user and sends user commands to the&#13;
Controller. The View is passive, meaning it waits for the Model to&#13;
provide data to display and does not fetch or save data directly. The&#13;
View also does not handle user interaction on its own, but delegates&#13;
this responsibility to the next component: the Controller.</p>&#13;
</dd>&#13;
<dt>Controller</dt>&#13;
<dd>&#13;
<p>The Controller<a data-primary="Controller, MVC pattern" data-type="indexterm" id="id316"/> acts as an interface between the Model&#13;
and the View. It takes the user input from the View, processes it (with&#13;
potential updates to the Model), and returns the output display to the&#13;
View. The Controller decouples the Model from the View, making the&#13;
system architecture more flexible.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The primary advantage of the MVC pattern is the separation of concerns<a data-primary="separation of concerns (SoC)" data-secondary="MVC pattern" data-type="indexterm" id="id317"/>,&#13;
which means that the business logic, user interface, and user input are&#13;
separated into different sections of the codebase. This not only makes&#13;
the application more modular but also easier to maintain, scale, and&#13;
test. The MVC pattern is widely used in web applications, with many&#13;
frameworks like Django, Ruby on Rails, and ASP.NET MVC offering built-in&#13;
support for it.</p>&#13;
&#13;
<p>The MVC pattern has been a staple in software&#13;
design for many years, especially in web development. However, as web&#13;
applications have evolved and user expectations for interactive and&#13;
dynamic interfaces have grown, some limitations of the traditional MVC have&#13;
become apparent. Here’s where MVC can fall short and how React addresses&#13;
these challenges:</p>&#13;
<dl>&#13;
<dt>Complex interactivity and state management</dt>&#13;
<dd>&#13;
<p>Traditional MVC architectures<a data-primary="state management" data-secondary="complex interactivity impact on" data-type="indexterm" id="id318"/><a data-primary="component-based architecture" data-secondary="advantages of" data-type="indexterm" id="id319"/> often struggle when it comes to managing complex user&#13;
interfaces with many interactive elements. As an application grows,&#13;
managing state changes and their effects on various parts of the UI can&#13;
become cumbersome as controllers pile up, and can sometimes conflict with&#13;
other controllers, with some controllers controlling views that do not&#13;
represent them, or the separation between MVC components not accurately scoped in product code.</p>&#13;
&#13;
<p>React, with its component-based architecture and virtual DOM<a data-primary="virtual DOM (vDOM)" data-secondary="React’s use of" data-type="indexterm" id="id320"/>, makes it&#13;
easier to reason about state changes and their effects on the UI by&#13;
essentially positing that UI components are like a function: they&#13;
receive input (props) and return output based on those inputs&#13;
(elements)<a data-primary="state management" data-secondary="React’s approach" data-type="indexterm" id="id321"/>. This mental model radically simplified the MVC pattern&#13;
because functions are fairly ubiquitous in JavaScript and much more&#13;
approachable when compared to an external mental model that is not&#13;
native to the programming language like MVC.</p>&#13;
</dd>&#13;
<dt>Two-way data binding</dt>&#13;
<dd>&#13;
<p> Some MVC frameworks utilize two-way data&#13;
binding<a data-primary="two-way data binding" data-type="indexterm" id="id322"/><a data-primary="data binding" data-secondary="two-way data binding" data-type="indexterm" id="id323"/>, which can lead to unintended side effects if not managed&#13;
carefully, where in some cases either the view becomes out of sync with&#13;
the model or vice versa. Moreover, with two-way data binding the&#13;
question of data ownership often had a crude answer, with an unclear&#13;
separation of concerns. This is particularly interesting because while&#13;
MVC is a proven model for teams that fully understand the appropriate&#13;
way &#13;
<span class="keep-together">to separate</span> concerns for their use cases, these separation rules are&#13;
seldom &#13;
<span class="keep-together">enforced—especially</span> when faced with high-velocity output and&#13;
rapid startup &#13;
<span class="keep-together">growth—and</span> thus separation of concerns, one of the&#13;
greatest strengths of MVC, is often turned into a weakness by this lack of&#13;
enforcement.</p>&#13;
&#13;
<p>React leverages a pattern counter to two-way data binding<a data-primary="unidirectional data flow" data-type="indexterm" id="id324"/> called&#13;
“unidirectional data flow” (more on this later) to prioritize and even&#13;
enforce a unidirectional data flow through systems like Forget<a data-primary="Forget" data-type="indexterm" id="id325"/><a data-primary="React Forget" data-type="indexterm" id="id326"/> (which we&#13;
will also discuss further in the book). These approaches make UI updates&#13;
more predictable, enable us to separate concerns more clearly, and&#13;
ultimately are conducive to high-velocity hyper-growth software teams.</p>&#13;
</dd>&#13;
<dt>Tight coupling</dt>&#13;
<dd>&#13;
<p>In some MVC implementations, the Model, View, and&#13;
Controller can become tightly coupled<a data-primary="tight coupling, in MVC" data-type="indexterm" id="id327"/>, making it hard to change or&#13;
refactor one without affecting the others. React encourages a more&#13;
modular and decoupled approach with its component-based model, enabling&#13;
and supporting colocation of dependencies close to their UI&#13;
representations.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>We don’t need to get too much into the details of this pattern since&#13;
this is a React book, but for our intents and purposes here, models were&#13;
conceptually sources of data, and views were conceptually user&#13;
interfaces that consumed and rendered that data. Backbone exported&#13;
comfortable APIs to work with these models and views, and provided a way&#13;
to connect the models and views together. This solution was&#13;
very powerful and flexible for its time. It was also a solution that was&#13;
scalable to use and allowed developers to test their code in isolation.</p>&#13;
&#13;
<p>As an example, here’s our earlier button example, this time&#13;
using &#13;
<span class="keep-together">Backbone:</span></p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">LikeButton</code> <code class="o">=</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">View</code><code class="p">.</code><code class="nx">extend</code><code class="p">({</code>&#13;
  <code class="nx">tagName</code><code class="o">:</code> <code class="s2">"button"</code><code class="p">,</code>&#13;
  <code class="nx">attributes</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">type</code><code class="o">:</code> <code class="s2">"button"</code><code class="p">,</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">events</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">click</code><code class="o">:</code> <code class="s2">"onClick"</code><code class="p">,</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">initialize</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s2">"change"</code><code class="p">,</code> <code class="k">this</code><code class="p">.</code><code class="nx">render</code><code class="p">,</code> <code class="k">this</code><code class="p">);</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">render</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">$el</code><code class="p">.</code><code class="nx">text</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"liked"</code><code class="p">)</code> <code class="o">?</code> <code class="s2">"Liked"</code> <code class="o">:</code> <code class="s2">"Like"</code><code class="p">);</code>&#13;
    <code class="k">return</code> <code class="k">this</code><code class="p">;</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">onClick</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
      <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
      <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"liked"</code><code class="p">)</code> <code class="p">}),</code>&#13;
    <code class="p">})</code>&#13;
      <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"liked"</code><code class="p">,</code> <code class="o">!</code><code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"liked"</code><code class="p">));</code>&#13;
      <code class="p">})</code>&#13;
      <code class="p">.</code><code class="k">catch</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"failed"</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
      <code class="p">})</code>&#13;
      <code class="p">.</code><code class="k">finally</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">model</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"pending"</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>&#13;
      <code class="p">});</code>&#13;
  <code class="p">},</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">LikeButton</code><code class="p">({</code>&#13;
  <code class="nx">model</code><code class="o">:</code> <code class="k">new</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Model</code><code class="p">({</code>&#13;
    <code class="nx">liked</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>&#13;
  <code class="p">}),</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">likeButton</code><code class="p">.</code><code class="nx">render</code><code class="p">().</code><code class="nx">el</code><code class="p">);</code></pre>&#13;
&#13;
<p>Notice how <code>LikeButton</code> extends <code>Backbone.View</code> and how it has a&#13;
<code>render</code> method that returns <code>this</code>? We’ll go on to see a similar&#13;
<code>render</code> method<a data-primary="render method, Backbone versus React" data-type="indexterm" id="id328"/> in React, but let’s not get ahead of ourselves. It’s&#13;
also worth noting here that Backbone didn’t include an actual&#13;
implementation for <code>render</code>. Instead, you either manually mutated the&#13;
DOM via jQuery, or used a templating system like Handlebars.</p>&#13;
&#13;
<p>Backbone exposed a chainable API that allowed developers to colocate&#13;
logic as properties on objects. Comparing this to our previous example,&#13;
we can see that Backbone has made it far more comfortable to create a&#13;
button that is interactive and updates the user interface in&#13;
response to events.</p>&#13;
&#13;
<p>It also does this in a more structured way by grouping logic together.&#13;
Also note that Backbone has made it more approachable to test&#13;
this button in isolation because we can create a <code>LikeButton</code> instance&#13;
and then call its <code>render</code> method to test it.</p>&#13;
&#13;
<p>We test this component like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">test</code><code class="p">(</code><code class="s2">"LikeButton initial state"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">LikeButton</code><code class="p">({</code>&#13;
    <code class="nx">model</code><code class="o">:</code> <code class="k">new</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Model</code><code class="p">({</code>&#13;
      <code class="nx">liked</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code> <code class="c1">// Initial state set to not liked</code>&#13;
    <code class="p">}),</code>&#13;
  <code class="p">});</code>&#13;
  <code class="nx">likeButton</code><code class="p">.</code><code class="nx">render</code><code class="p">();</code> <code class="c1">// Ensure render is called to reflect the initial state</code>&#13;
  <code class="c1">// Check the text content to be "Like" reflecting the initial state</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">likeButton</code><code class="p">.</code><code class="nx">el</code><code class="p">.</code><code class="nx">textContent</code><code class="p">).</code><code class="nx">toBe</code><code class="p">(</code><code class="s2">"Like"</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>We can even test the button’s behavior after its state changes, as in&#13;
the case of a click event, like so<a data-startref="ix_ModelViewControllerMVCpattern.01.670.27" data-type="indexterm" id="id329"/><a data-startref="ix_MVCModelViewControllerpattern.01.670.27" data-type="indexterm" id="id330"/>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">test</code><code class="p">(</code><code class="s2">"LikeButton"</code><code class="p">,</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// Mark the function as async to handle promise</code>&#13;
  <code class="kr">const</code> <code class="nx">likeButton</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">LikeButton</code><code class="p">({</code>&#13;
    <code class="nx">model</code><code class="o">:</code> <code class="k">new</code> <code class="nx">Backbone</code><code class="p">.</code><code class="nx">Model</code><code class="p">({</code>&#13;
      <code class="nx">liked</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>&#13;
    <code class="p">}),</code>&#13;
  <code class="p">});</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">likeButton</code><code class="p">.</code><code class="nx">render</code><code class="p">().</code><code class="nx">el</code><code class="p">.</code><code class="nx">textContent</code><code class="p">).</code><code class="nx">toBe</code><code class="p">(</code><code class="s2">"Like"</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Mock fetch to prevent actual HTTP request</code>&#13;
  <code class="nx">global</code><code class="p">.</code><code class="nx">fetch</code> <code class="o">=</code> <code class="nx">jest</code><code class="p">.</code><code class="nx">fn</code><code class="p">(()</code> <code class="o">=&gt;</code>&#13;
    <code class="nb">Promise</code><code class="p">.</code><code class="nx">resolve</code><code class="p">({</code>&#13;
      <code class="nx">json</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">resolve</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}),</code>&#13;
    <code class="p">})</code>&#13;
  <code class="p">);</code>&#13;
&#13;
  <code class="c1">// Await the onClick method to ensure async operations are complete</code>&#13;
  <code class="nx">await</code> <code class="nx">likeButton</code><code class="p">.</code><code class="nx">onClick</code><code class="p">();</code>&#13;
&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">likeButton</code><code class="p">.</code><code class="nx">render</code><code class="p">().</code><code class="nx">el</code><code class="p">.</code><code class="nx">textContent</code><code class="p">).</code><code class="nx">toBe</code><code class="p">(</code><code class="s2">"Liked"</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Optionally, restore fetch to its original implementation if needed</code>&#13;
  <code class="nx">global</code><code class="p">.</code><code class="nx">fetch</code><code class="p">.</code><code class="nx">mockRestore</code><code class="p">();</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>For this reason, Backbone was a very popular solution at the time. The&#13;
alternative was to write a lot of code that was hard to test and hard to&#13;
reason about with no guarantees that the code would work as expected in&#13;
a reliable way. Therefore, Backbone was a very welcome solution. While&#13;
it gained popularity in its early days for its simplicity and&#13;
flexibility, it’s not without its criticisms. Here are some of the&#13;
negatives associated with Backbone.js:</p>&#13;
<dl>&#13;
<dt>Verbose and boilerplate code</dt>&#13;
<dd>&#13;
<p>One of the frequent criticisms of&#13;
Backbone.js is the amount of boilerplate<a data-primary="boilerplate code" data-type="indexterm" id="id331"/> code developers needed to&#13;
write. For simple applications, this might not be a big deal, but as the&#13;
application grows, so does the boilerplate, leading to potentially&#13;
redundant and hard-to-maintain code.</p>&#13;
</dd>&#13;
<dt>Lack of two-way data binding</dt>&#13;
<dd>&#13;
<p>Unlike some of its contemporaries,&#13;
Backbone.js doesn’t offer built-in two-way data binding<a data-primary="two-way data binding" data-type="indexterm" id="id332"/><a data-primary="data binding" data-secondary="two-way data binding" data-type="indexterm" id="id333"/>. This means that&#13;
if the data changes, the DOM doesn’t automatically update, and vice&#13;
versa. Developers often need to write custom code or use plug-ins to&#13;
achieve this functionality.</p>&#13;
</dd>&#13;
<dt>Event-driven architecture</dt>&#13;
<dd>&#13;
<p>Updates to model data can trigger&#13;
numerous events<a data-primary="event-driven architecture" data-secondary="BackboneJS" data-type="indexterm" id="id334"/> throughout the application. This cascade of events can&#13;
become unmanageable, leading to a situation where it’s unclear how&#13;
changing a single piece of data will affect the rest of the application,&#13;
making debugging and maintenance difficult. To address these issues,&#13;
&#13;
<span class="keep-together">developers</span> often needed to use careful event management practices to&#13;
prevent the ripple effect of updates across the entire app.</p>&#13;
</dd>&#13;
<dt>Lack of composability</dt>&#13;
<dd>&#13;
<p>Backbone.js lacks built-in features for&#13;
easily nesting views<a data-primary="nesting views" data-type="indexterm" id="id335"/>, which can make composing complex user interfaces&#13;
difficult. React, in contrast, allows for seamless nesting of components&#13;
through the children prop, making it much simpler to build intricate UI&#13;
hierarchies. Marionette.js, an extension of Backbone, attempted to&#13;
address some of these composition issues, but it does not provide as&#13;
integrated a solution as React’s component model.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>While Backbone.js has its set of challenges, it’s essential to remember&#13;
that no tool or framework is perfect. The best choice often depends on&#13;
the specific needs of the project and the preferences of the development&#13;
team. It’s also worth noting how much web development tools depend on a&#13;
strong community to thrive, and unfortunately Backbone.js has seen a&#13;
decline in popularity in recent years, especially with the advent of&#13;
React. Some would say React killed it, but we’ll reserve judgment for&#13;
now<a data-startref="ix_Backbone.01.670.35" data-type="indexterm" id="id336"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="KnockoutJS" data-type="sect2"><div class="sect2" id="id7">&#13;
<h2>KnockoutJS</h2>&#13;
&#13;
<p>Let’s compare this approach with another popular solution at the time:&#13;
KnockoutJS. KnockoutJS<a data-primary="KnockoutJS" data-type="indexterm" id="ix_KnockoutJS.01.936.23"/>, developed in the early 2010s, was a library that provided a way to create&#13;
“observables” and “bindings,” making use of dependency tracking<a data-primary="dependency tracking" data-type="indexterm" id="id337"/>&#13;
whenever state changes<a data-primary="state management" data-secondary="KnockoutJS" data-type="indexterm" id="ix_statemanagementKnockoutJS.01.938.23"/>.</p>&#13;
&#13;
<p>KnockoutJS was among the first, if not the first, reactive JavaScript&#13;
libraries<a data-primary="reactive JavaScript library" data-type="indexterm" id="id338"/>, where reactivity<a data-primary="reactive programming" data-type="indexterm" id="id339"/> is defined as values updating in response to&#13;
state changes in an observable manner. Modern takes on this style of&#13;
reactivity are sometimes<a data-primary="signals" data-type="indexterm" id="id340"/> called “signals” and are prevalent in&#13;
libraries like Vue.js, SolidJS, Svelte, Qwik, modern Angular, and more.&#13;
We cover these in <a data-type="xref" href="ch10.html#ch10">Chapter 10</a> in more detail.</p>&#13;
&#13;
<p>Observables were conceptually sources of data, and bindings<a data-primary="bindings" data-type="indexterm" id="id341"/> were&#13;
conceptually user interfaces that consumed and rendered that data:&#13;
observables were like models, and bindings were like views.</p>&#13;
&#13;
<p>However, as a bit of an evolution of the MVC pattern we discussed previously,&#13;
KnockoutJS instead worked more along a Model-View-ViewModel or&#13;
MVVM-style pattern<a data-primary="Model-View-ViewModel (MVVM) pattern" data-type="indexterm" id="ix_ModelViewViewModelMVVMpattern.01.953.19"/><a data-primary="MVVM (Model-View-ViewModel) pattern" data-type="indexterm" id="ix_MVVMModelViewViewModelpattern.01.953.19"/> (see <a data-type="xref" href="#figure1-2">Figure 1-2</a>). Let’s understand this pattern in some detail.</p>&#13;
&#13;
<figure><div class="figure" id="figure1-2">&#13;
<img alt="mvvm" src="assets/frea_0102.png"/>&#13;
<h6><span class="label">Figure 1-2. </span>MVVM pattern</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="MVVM pattern" data-type="sect3"><div class="sect3" id="id8">&#13;
<h3>MVVM pattern</h3>&#13;
&#13;
<p>The MVVM pattern is an architectural design&#13;
pattern that’s particularly popular in applications with rich user&#13;
interfaces, such as those built using platforms like WPF and Xamarin.&#13;
MVVM is an evolution of the traditional Model-View-Controller (MVC)&#13;
pattern, tailored for modern UI development platforms where data binding<a data-primary="data binding" data-secondary="and MVVM pattern" data-secondary-sortas="MVVM pattern" data-type="indexterm" id="id342"/>&#13;
is a prominent feature. Here’s a breakdown of the MVVM components:</p>&#13;
<dl>&#13;
<dt>Model</dt>&#13;
<dd>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Represents<a data-primary="Model, MVVM" data-type="indexterm" id="id343"/> the data and business logic of the application.</p>&#13;
</li>&#13;
<li>&#13;
<p>Is responsible for retrieving, storing, and processing the data.</p>&#13;
</li>&#13;
<li>&#13;
<p>Typically communicates with databases, services, or other data sources&#13;
and &#13;
<span class="keep-together">operations.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>Is unaware of the View and ViewModel.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>View</dt>&#13;
<dd>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Represents<a data-primary="View, MVC pattern" data-type="indexterm" id="id344"/> the UI of the application.</p>&#13;
</li>&#13;
<li>&#13;
<p>Displays information to the user and receives user input.</p>&#13;
</li>&#13;
<li>&#13;
<p>In MVVM, the View is passive and doesn’t contain any application&#13;
logic. Instead, it declaratively binds to the ViewModel, reflecting&#13;
changes automatically through data binding mechanisms.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>ViewModel</dt>&#13;
<dd>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Acts as a bridge between the Model<a data-primary="ViewModel, MVVM pattern" data-type="indexterm" id="id345"/> and the View.</p>&#13;
</li>&#13;
<li>&#13;
<p>Exposes data and commands for the View to bind to. The data here is&#13;
often in a format that’s display ready.</p>&#13;
</li>&#13;
<li>&#13;
<p>Handles user input, often through command patterns.</p>&#13;
</li>&#13;
<li>&#13;
<p>Contains the presentation logic and transforms data from the Model&#13;
into a format that can be easily displayed by the View.</p>&#13;
</li>&#13;
<li>&#13;
<p>Notably, the ViewModel is unaware of the specific View that’s using&#13;
it, allowing for a decoupled architecture.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The key advantage of the MVVM pattern is the separation of concerns<a data-primary="separation of concerns (SoC)" data-secondary="MVVM pattern’s advantage in" data-type="indexterm" id="id346"/>&#13;
similar to MVC, which leads to:</p>&#13;
<dl>&#13;
<dt>Testability</dt>&#13;
<dd>&#13;
<p>The decoupling<a data-primary="testing of code" data-secondary="MVVM pattern" data-type="indexterm" id="id347"/> of ViewModel from View makes it easier&#13;
to write unit tests for the presentation logic without involving the UI.</p>&#13;
</dd>&#13;
<dt>Reusability</dt>&#13;
<dd>&#13;
<p>The ViewModel can be reused across different views or&#13;
platforms.</p>&#13;
</dd>&#13;
<dt>Maintainability</dt>&#13;
<dd>&#13;
<p>With a clear separation, it’s easier to manage,&#13;
extend, and refactor code.</p>&#13;
</dd>&#13;
<dt>Data binding</dt>&#13;
<dd>&#13;
<p>The pattern excels in platforms that support data&#13;
binding, reducing the amount of boilerplate code required to update the&#13;
UI.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Since we discussed both MVC<a data-primary="Model-View-Controller (MVC) pattern" data-type="indexterm" id="ix_ModelViewControllerMVCpattern.01.1011.28"/><a data-primary="MVC (Model-View-Controller) pattern" data-type="indexterm" id="ix_MVCModelViewControllerpattern.01.1011.28"/> and MVVM patterns, let’s quickly contrast&#13;
them so that we can understand the differences between them (see <a data-type="xref" href="#table1-1">Table 1-1</a>).</p>&#13;
<table id="table1-1" style="width: 100%">&#13;
<caption><span class="label">Table 1-1. </span>Comparison of MVC and MVVM patterns</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Criteria</th>&#13;
<th>MVC</th>&#13;
<th>MVVM</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Primary purpose</strong></p></td>&#13;
<td><p>Primarily for web applications, separating user&#13;
interface from logic.</p></td>&#13;
<td><p>Tailored for rich UI applications, especially&#13;
with two-way data binding, like desktop or SPAs.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Components</strong></p></td>&#13;
<td><p>Model: data and business logic. View: user&#13;
interface. Controller: manages user input, updates View.</p></td>&#13;
<td><p>Model: data and&#13;
business logic. View: user interface elements. ViewModel: bridge between&#13;
Model and View.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Data flow</strong></p></td>&#13;
<td><p>User input is managed by the Controller, which updates the&#13;
Model and then the View.</p></td>&#13;
<td><p>The View binds directly to the ViewModel.&#13;
Changes in the View are automatically reflected in the ViewModel and&#13;
vice versa.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Decoupling</strong></p></td>&#13;
<td><p>View is often tightly coupled with the Controller.</p></td>&#13;
<td><p>High&#13;
decoupling as ViewModel doesn’t know the specific View using it.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>User interaction</strong></p></td>&#13;
<td><p>Handled by the Controller.</p></td>&#13;
<td><p>Handled through data&#13;
bindings and commands in the ViewModel.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Platform suitability</strong></p></td>&#13;
<td><p>Common in web application development (e.g.,&#13;
Ruby on Rails, Django, ASP.NET MVC).</p></td>&#13;
<td><p>Suited for platforms supporting&#13;
robust data binding (e.g., WPF, Xamarin).</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>From this brief comparison, we can see that the real difference between&#13;
MVC and MVVM patterns is one of coupling<a data-primary="bindings" data-type="indexterm" id="id348"/> and binding: with no Controller&#13;
between a Model and a View, data ownership is clearer and closer to&#13;
the user. React further improves on MVVM with its unidirectional data&#13;
flow,<a data-primary="unidirectional data flow" data-type="indexterm" id="id349"/> which we’ll discuss in a little bit, by getting <em>even narrower</em> in&#13;
terms of data ownership, such that state is owned by specific components&#13;
that need them. For now, let’s get back to KnockoutJS and how it relates&#13;
to React.</p>&#13;
&#13;
<p>KnockoutJS exported APIs to work with these observables and bindings.&#13;
Let’s look at how we’d implement the Like button in KnockoutJS. This will&#13;
help us understand “why React” a little better. Here’s the KnockoutJS&#13;
version of our button:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kd">function</code> <code class="nx">createViewModel</code><code class="p">({</code> <code class="nx">liked</code> <code class="p">})</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">isPending</code> <code class="o">=</code> <code class="nx">ko</code><code class="p">.</code><code class="nx">observable</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">hasFailed</code> <code class="o">=</code> <code class="nx">ko</code><code class="p">.</code><code class="nx">observable</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">onClick</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">isPending</code><code class="p">(</code><code class="kc">true</code><code class="p">);</code>&#13;
    <code class="nx">fetch</code><code class="p">(</code><code class="s2">"/like"</code><code class="p">,</code> <code class="p">{</code>&#13;
      <code class="nx">method</code><code class="o">:</code> <code class="s2">"POST"</code><code class="p">,</code>&#13;
      <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="o">!</code><code class="nx">liked</code><code class="p">()</code> <code class="p">}),</code>&#13;
    <code class="p">})</code>&#13;
      <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">liked</code><code class="p">(</code><code class="o">!</code><code class="nx">liked</code><code class="p">());</code>&#13;
      <code class="p">})</code>&#13;
      <code class="p">.</code><code class="k">catch</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">hasFailed</code><code class="p">(</code><code class="kc">true</code><code class="p">);</code>&#13;
      <code class="p">})</code>&#13;
      <code class="p">.</code><code class="k">finally</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">isPending</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>&#13;
      <code class="p">});</code>&#13;
  <code class="p">};</code>&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">isPending</code><code class="p">,</code>&#13;
    <code class="nx">hasFailed</code><code class="p">,</code>&#13;
    <code class="nx">onClick</code><code class="p">,</code>&#13;
    <code class="nx">liked</code><code class="p">,</code>&#13;
  <code class="p">};</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">ko</code><code class="p">.</code><code class="nx">applyBindings</code><code class="p">(</code><code class="nx">createViewModel</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="nx">ko</code><code class="p">.</code><code class="nx">observable</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code> <code class="p">}));</code></pre>&#13;
&#13;
<p>In KnockoutJS, a “view model” is a JavaScript object that contains&#13;
keys and values that we bind<a data-primary="view models, binding to element in browser" data-type="indexterm" id="id350"/><a data-primary="browsers" data-secondary="binding view models to elements" data-type="indexterm" id="id351"/> to various elements in our page using the&#13;
<code>data-bind</code> attribute. There are no “components” or “templates” in&#13;
KnockoutJS, just a view model and a way to bind it to an element in the&#13;
browser.</p>&#13;
&#13;
<p>Our function <code>createViewModel</code> is how we’d create a view model with&#13;
Knockout. We then use <code>ko.applyBindings</code> to connect the view model to&#13;
the host environment (the browser). The <code>ko.applyBindings</code> function&#13;
takes a view model and finds all the elements in the browser that&#13;
have a <code>data-bind</code> attribute, which Knockout uses to bind them to the&#13;
view model.</p>&#13;
&#13;
<p>A button in our browser would be bound to this view model’s properties&#13;
like so<a data-startref="ix_ModelViewViewModelMVVMpattern.01.953.19" data-type="indexterm" id="id352"/><a data-startref="ix_statemanagementKnockoutJS.01.938.23" data-type="indexterm" id="id353"/><a data-startref="ix_MVVMModelViewViewModelpattern.01.953.19" data-type="indexterm" id="id354"/>:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">button</code>&#13;
  <code class="na">data-bind</code><code class="o">=</code><code class="s">"click:</code> <code class="na">onClick</code><code class="err">,</code> <code class="na">text:</code> <code class="na">liked</code> <code class="err">?</code> <code class="err">'</code><code class="na">Liked</code><code class="err">'</code> <code class="na">:</code> <code class="na">isPending</code> <code class="err">?</code> <code class="err">[...]</code>&#13;
<code class="p">&gt;&lt;/</code><code class="nt">button</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Note that this code has been truncated for simplicity.</p>&#13;
&#13;
<p>We <em>bind</em> the HTML element to the “view model” we created using our&#13;
<code>createViewModel</code> function, and the site becomes interactive. As you can&#13;
imagine, explicitly subscribing to changes in observables and then&#13;
updating the user interface in response to these changes is a lot of&#13;
work. KnockoutJS was a great library for its time, but it also required a lot of boilerplate code<a data-primary="boilerplate code" data-type="indexterm" id="id355"/> to get things done.</p>&#13;
&#13;
<p>Moreover, view models often grew to be very large and complex, which led&#13;
to increasing uncertainty around refactors and optimizations to code.&#13;
Eventually, we ended up with verbose monolithic view models that were&#13;
hard to test and reason about. Still, KnockoutJS was a very&#13;
popular solution and a great library for its time. It was also&#13;
relatively easy to test in isolation, which was a big plus<a data-startref="ix_KnockoutJS.01.936.23" data-type="indexterm" id="id356"/>.</p>&#13;
&#13;
<p>For posterity, here’s how we’d test<a data-primary="testing of code" data-secondary="KnockoutJS" data-type="indexterm" id="id357"/> this button in KnockoutJS<a data-startref="ix_ModelViewControllerMVCpattern.01.1011.28" data-type="indexterm" id="id358"/><a data-startref="ix_MVCModelViewControllerpattern.01.1011.28" data-type="indexterm" id="id359"/>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">test</code><code class="p">(</code><code class="s2">"LikeButton"</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">viewModel</code> <code class="o">=</code> <code class="nx">createViewModel</code><code class="p">({</code> <code class="nx">liked</code><code class="o">:</code> <code class="nx">ko</code><code class="p">.</code><code class="nx">observable</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code> <code class="p">});</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">viewModel</code><code class="p">.</code><code class="nx">liked</code><code class="p">()).</code><code class="nx">toBe</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>&#13;
  <code class="nx">viewModel</code><code class="p">.</code><code class="nx">onClick</code><code class="p">();</code>&#13;
  <code class="nx">expect</code><code class="p">(</code><code class="nx">viewModel</code><code class="p">.</code><code class="nx">liked</code><code class="p">()).</code><code class="nx">toBe</code><code class="p">(</code><code class="kc">true</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="AngularJS" data-type="sect2"><div class="sect2" id="id9">&#13;
<h2>AngularJS</h2>&#13;
&#13;
<p>AngularJS was developed by Google in 2010. It was a pioneering&#13;
JavaScript framework that had a significant impact on the web&#13;
development landscape. It stood in sharp contrast to the libraries and&#13;
frameworks we’ve been discussing by incorporating several innovative&#13;
features, the ripples of which can be seen in subsequent libraries,&#13;
including React. Through a detailed comparison of AngularJS<a data-primary="AngularJS" data-type="indexterm" id="ix_AngularJS.01.1149.60"/> with these&#13;
other libraries and a look at its pivotal features, let’s try to&#13;
understand the path it carved for React.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Two-way data binding" data-type="sect3"><div class="sect3" id="id10">&#13;
<h3>Two-way data binding</h3>&#13;
&#13;
<p>Two-way data binding<a data-primary="two-way data binding" data-type="indexterm" id="id360"/> was a hallmark feature of AngularJS that greatly&#13;
simplified the interaction between the UI and the&#13;
underlying data. If the model (the underlying data) changes, the view&#13;
(the UI) gets updated automatically to reflect the change, and vice&#13;
versa. This was a stark contrast to libraries like jQuery, where&#13;
developers had to manually manipulate the DOM to reflect any changes in&#13;
the data and capture user inputs to update the data.</p>&#13;
&#13;
<p>Let’s consider a simple AngularJS application where two-way data binding&#13;
plays a crucial role:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">html</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">head</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">script</code>&#13;
    <code class="na">src</code><code class="o">=</code><code class="s">"https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">head</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">body</code> <code class="na">ng-app</code><code class="o">=</code><code class="s">""</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Name: <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">ng-model</code><code class="o">=</code><code class="s">"name"</code> <code class="p">/&gt;&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">p</code> <code class="na">ng-if</code><code class="o">=</code><code class="s">"name"</code><code class="p">&gt;</code>Hello, {{name}}!<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">body</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">html</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>In this application, the <code>ng-model</code> directive binds the value of the&#13;
input field to the variable <code>name</code>. As you type into the input field,&#13;
the model <code>name</code> gets updated, and the view—in this case, the greeting&#13;
<code>"Hello, {{name}}!"</code>—gets updated in real time.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Modular architecture" data-type="sect3"><div class="sect3" id="id11">&#13;
<h3>Modular architecture</h3>&#13;
&#13;
<p>AngularJS introduced a modular architecture<a data-primary="modular architecture, AngularJS" data-type="indexterm" id="id361"/> that allowed developers to&#13;
logically separate their application’s components. Each module could&#13;
encapsulate a functionality and could be developed, tested, and&#13;
maintained independently. Some would call this a precursor to React’s&#13;
component<a data-primary="component-based architecture" data-secondary="AngularJS" data-type="indexterm" id="id362"/> model, but this is debated.</p>&#13;
&#13;
<p>Here’s a quick example:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">var</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">angular</code><code class="p">.</code><code class="nx">module</code><code class="p">(</code><code class="s2">"myApp"</code><code class="p">,</code> <code class="p">[</code>&#13;
  <code class="s2">"ngRoute"</code><code class="p">,</code>&#13;
  <code class="s2">"appRoutes"</code><code class="p">,</code>&#13;
  <code class="s2">"userCtrl"</code><code class="p">,</code>&#13;
  <code class="s2">"userService"</code><code class="p">,</code>&#13;
<code class="p">]);</code>&#13;
&#13;
<code class="kd">var</code> <code class="nx">userCtrl</code> <code class="o">=</code> <code class="nx">angular</code><code class="p">.</code><code class="nx">module</code><code class="p">(</code><code class="s2">"userCtrl"</code><code class="p">,</code> <code class="p">[]);</code>&#13;
<code class="nx">userCtrl</code><code class="p">.</code><code class="nx">controller</code><code class="p">(</code><code class="s2">"UserController"</code><code class="p">,</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">$scope</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">$scope</code><code class="p">.</code><code class="nx">message</code> <code class="o">=</code> <code class="s2">"Hello from UserController"</code><code class="p">;</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kd">var</code> <code class="nx">userService</code> <code class="o">=</code> <code class="nx">angular</code><code class="p">.</code><code class="nx">module</code><code class="p">(</code><code class="s2">"userService"</code><code class="p">,</code> <code class="p">[]);</code>&#13;
<code class="nx">userService</code><code class="p">.</code><code class="nx">factory</code><code class="p">(</code><code class="s2">"User"</code><code class="p">,</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">$http</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="c1">//...</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>In the preceding example, the <code>myApp</code> module depends on several other&#13;
modules: <code>ngRoute</code>, <code>appRoutes</code>, <code>userCtrl</code>, and <code>userService</code>. Each&#13;
dependent module could be in its own JavaScript file, and could be&#13;
developed separately from the main <code>myApp</code> module. This concept was&#13;
significantly different from jQuery and Backbone.js, which didn’t have a&#13;
concept of a “module” in this sense.</p>&#13;
&#13;
<p>We inject these dependencies (<code>appRoutes</code>, <code>userCtrl</code>, etc.)&#13;
into our root <code>app</code> using a pattern<a data-primary="dependency injection (DI) pattern, AngularJS" data-type="indexterm" id="id363"/> called <em>dependency injection</em> that&#13;
was popularized in Angular. Needless to say, this pattern was prevalent&#13;
before JavaScript modules were standardized. Since then, <code>import</code> and&#13;
<code>export</code> statements quickly took over. To contrast these dependencies&#13;
with React components, let’s talk about dependency injection a little&#13;
more.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Dependency injection" data-type="sect3"><div class="sect3" id="id220">&#13;
<h3>Dependency injection</h3>&#13;
&#13;
<p>Dependency injection (DI) is a design pattern where an object receives&#13;
its dependencies instead of creating them. AngularJS incorporated this&#13;
design pattern at its core, which was not a common feature in other&#13;
JavaScript libraries at the time. This had a profound impact on the way&#13;
modules and components were created and managed, promoting a higher&#13;
degree of modularity and reusability.</p>&#13;
&#13;
<p>Here is an example of how DI works in AngularJS:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">var</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">angular</code><code class="p">.</code><code class="nx">module</code><code class="p">(</code><code class="s2">"myApp"</code><code class="p">,</code> <code class="p">[]);</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">controller</code><code class="p">(</code><code class="s2">"myController"</code><code class="p">,</code> <code class="kd">function</code> <code class="p">(</code><code class="nx">$scope</code><code class="p">,</code> <code class="nx">myService</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">$scope</code><code class="p">.</code><code class="nx">greeting</code> <code class="o">=</code> <code class="nx">myService</code><code class="p">.</code><code class="nx">sayHello</code><code class="p">();</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">factory</code><code class="p">(</code><code class="s2">"myService"</code><code class="p">,</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">sayHello</code><code class="o">:</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
      <code class="k">return</code> <code class="s2">"Hello, World!"</code><code class="p">;</code>&#13;
    <code class="p">},</code>&#13;
  <code class="p">};</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>In the example, <code>myService</code> is a service that is injected into the&#13;
<code>myController</code> controller through DI. The controller does not need to&#13;
know how to create the service. It just declares the service as a&#13;
dependency, and AngularJS takes care of creating and injecting it. This&#13;
simplifies the management of dependencies and enhances the testability&#13;
and reusability of components.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Comparison with Backbone.js and Knockout.js" data-type="sect3"><div class="sect3" id="id12">&#13;
<h3>Comparison with Backbone.js and Knockout.js</h3>&#13;
&#13;
<p>Backbone.js and Knockout.js<a data-primary="BackboneJS" data-type="indexterm" id="id364"/><a data-primary="KnockoutJS" data-type="indexterm" id="id365"/> were two popular libraries used around the&#13;
time AngularJS was introduced. Both libraries had their strengths, but&#13;
they lacked some features that were built into AngularJS.</p>&#13;
&#13;
<p>Backbone.js, for example, gave developers more control over their code&#13;
and was less opinionated than AngularJS. This flexibility was both a&#13;
strength and a weakness: it allowed for more customization, but also&#13;
required more boilerplate code. AngularJS, with its two-way data binding&#13;
and DI, allowed for more structure. It had more opinions that led to&#13;
greater developer velocity: something we see with modern frameworks like&#13;
Next.js, Remix, etc. This is one way AngularJS was far ahead of its&#13;
time.</p>&#13;
&#13;
<p>Backbone also didn’t have an answer to directly mutating the view (the&#13;
DOM) and often left this up to developers. AngularJS took care of DOM&#13;
mutations with its two-way data binding, which was a big plus.</p>&#13;
&#13;
<p>Knockout.js was primarily focused on data binding and lacked some of the&#13;
other powerful tools that AngularJS provided, such as DI and a modular&#13;
architecture. AngularJS, being a full-fledged framework, offered a more&#13;
comprehensive solution for building single-page applications (SPAs). While AngularJS was&#13;
discontinued, today its newer variant called Angular offers the same,&#13;
albeit enhanced, slew of comprehensive benefits that make it an ideal&#13;
choice for large-scale applications.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="AngularJS trade-offs" data-type="sect3"><div class="sect3" id="id13">&#13;
<h3>AngularJS trade-offs</h3>&#13;
&#13;
<p>AngularJS (1.x) represented a significant leap in web development&#13;
practices when it was introduced. However, as the landscape of web&#13;
development continued to evolve rapidly, certain aspects of AngularJS&#13;
were seen as limitations or weaknesses that contributed to its relative&#13;
decline. Some of these include:</p>&#13;
<dl>&#13;
<dt>Performance</dt>&#13;
<dd>&#13;
<p>AngularJS had performance<a data-primary="performance" data-secondary="AngularJS issues" data-type="indexterm" id="id366"/> issues, particularly in&#13;
large-scale applications with complex data bindings. The digest cycle in&#13;
AngularJS, a core feature for change detection, could result in slow&#13;
updates and laggy user interfaces in large applications. The two-way&#13;
data binding, while innovative and useful in many situations, also&#13;
contributed to the performance issues.</p>&#13;
</dd>&#13;
<dt>Complexity</dt>&#13;
<dd>&#13;
<p>AngularJS introduced a range of novel concepts<a data-primary="state management" data-secondary="complex interactivity impact on" data-type="indexterm" id="id367"/>, including&#13;
directives, controllers, services, dependency injection, factories, and&#13;
more. While these features made AngularJS powerful, they also made it&#13;
complex and hard to learn, especially for beginners. A common debate, for&#13;
example, was “should this be a factory or a service?” leaving a number&#13;
of developer teams puzzled.</p>&#13;
</dd>&#13;
<dt>Migration issues to Angular 2+</dt>&#13;
<dd>&#13;
<p>When Angular 2 was announced, it was&#13;
not backward compatible with AngularJS 1.x. and required code to be&#13;
written in Dart and/or TypeScript. This meant that developers had to&#13;
rewrite significant portions of their code to upgrade to Angular 2,&#13;
which was seen as a big hurdle. The introduction of Angular 2+&#13;
essentially split the Angular community and caused confusion, paving the&#13;
way for React.</p>&#13;
</dd>&#13;
<dt>Complex syntax in templates</dt>&#13;
<dd>&#13;
<p>AngularJS’s allowance for complex&#13;
JavaScript expressions within template attributes, such as&#13;
<code>on-click="$ctrl.some.deeply.nested.field = 123"</code>, was problematic&#13;
because it led to a blend of presentation and business logic within the&#13;
markup. This approach created challenges in maintainability, as&#13;
deciphering and managing the intertwined code became cumbersome.</p>&#13;
&#13;
<p>Furthermore, debugging<a data-primary="debugging" data-secondary="AngularJS’s issues with" data-type="indexterm" id="id368"/> was more difficult because template layers&#13;
weren’t inherently designed to handle complex logic, and any errors that&#13;
arose from these inline expressions could be challenging to locate and&#13;
resolve. Additionally, such practices violated the principle of&#13;
separation of concerns, which is a fundamental design philosophy&#13;
advocating for the distinct handling of different aspects of an&#13;
application to improve code quality and maintainability.</p>&#13;
&#13;
<p>In theory, a template ought to call a controller method to perform an&#13;
update, but nothing restricted that.</p>&#13;
</dd>&#13;
<dt>Absence of type safety</dt>&#13;
<dd>&#13;
<p>Templates in AngularJS did not work with&#13;
static type-checkers like TypeScript, which made it difficult to catch&#13;
errors early in the development process. This was a significant&#13;
drawback, especially for large-scale applications where type safety<a data-primary="type safety" data-type="indexterm" id="id369"/> is&#13;
crucial for maintainability and scalability.</p>&#13;
</dd>&#13;
<dt>Confusing <code>$scope</code> model</dt>&#13;
<dd>&#13;
<p>The <code>$scope</code> object<a data-primary="$scope model, AngularJS" data-primary-sortas="scope model, AngularJS" data-type="indexterm" id="id370"/> in AngularJS was often&#13;
found to be a source of confusion due to its role in binding data and&#13;
its behavior in different contexts because it served as the glue between&#13;
the view and the controller, but its behavior was not always intuitive&#13;
or predictable.</p>&#13;
&#13;
<p>This led to complexities, especially for newcomers, in understanding how&#13;
data was synchronized between the model and the view. Additionally,&#13;
<code>$scope</code> could inherit properties from parent scopes in nested&#13;
controllers, making it difficult to track where a particular <code>$scope</code>&#13;
property was originally defined or modified.</p>&#13;
&#13;
<p>This inheritance<a data-primary="inheritance problem with AngularJS" data-type="indexterm" id="id371"/> could cause unexpected side effects in the application,&#13;
particularly when dealing with nested scopes where parent and child&#13;
scopes could inadvertently affect each other. The concept of scope&#13;
hierarchy and the prototypal inheritance on which it was based were&#13;
often at odds with the more traditional and familiar lexical scoping&#13;
rules found in JavaScript, adding another layer of learning complexity.</p>&#13;
&#13;
<p>React, for example, colocates state with the component that needs it, and&#13;
thus avoids this problem entirely.</p>&#13;
</dd>&#13;
<dt>Limited development tools</dt>&#13;
<dd>&#13;
<p>AngularJS did not offer extensive&#13;
developer tools for debugging and performance profiling, especially when&#13;
compared to the DevTools available in React like Replay.io, which allows&#13;
extensive capabilities around time-travel debugging for React&#13;
applications<a data-startref="ix_Reactwebappchallengesandsolutionspriorto.01.63.14" data-type="indexterm" id="id372"/><a data-startref="ix_AngularJS.01.1149.60" data-type="indexterm" id="id373"/>.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Enter React" data-type="sect1"><div class="sect1" id="id14">&#13;
<h1>Enter React</h1>&#13;
&#13;
<p>It was around this time that React<a data-primary="React" data-secondary="development of" data-type="indexterm" id="ix_Reactdevelopmentof.01.1382.35"/> rose to prominence. One of the core&#13;
ideas that React presented was the component-based architecture<a data-primary="component-based architecture" data-secondary="React’s approach" data-type="indexterm" id="id374"/><a data-primary="React" data-secondary="component-based architecture" data-type="indexterm" id="id375"/>.&#13;
Although the implementation is different, the underlying idea is&#13;
similar: it is optimal to build user interfaces for the web and other&#13;
platforms by composing reusable components.</p>&#13;
&#13;
<p>While AngularJS used directives to bind views to models, React&#13;
introduced JSX and a radically simpler component model. Yet, without the&#13;
ground laid by AngularJS in promoting a component-based architecture&#13;
through Angular modules, some would argue the transition to React’s&#13;
model might not have been as smooth.</p>&#13;
&#13;
<p>In AngularJS, the two-way data binding model<a data-primary="two-way data binding" data-type="indexterm" id="id376"/> was the industry&#13;
standard; however, it also had some downsides, such as potential&#13;
performance<a data-primary="performance" data-secondary="two-data binding issues" data-type="indexterm" id="id377"/> issues on large applications. React learned from this and&#13;
introduced a unidirectional data flow<a data-primary="unidirectional data flow" data-type="indexterm" id="id378"/> pattern, giving developers more&#13;
control over their applications and making it easier to understand how&#13;
data changes over time.</p>&#13;
&#13;
<p>React also introduced the virtual DOM<a data-primary="virtual DOM (vDOM)" data-secondary="React’s use of" data-type="indexterm" id="id379"/> as we’ll read about in <a data-type="xref" href="ch03.html#ch03">Chapter 3</a>: a concept that improved performance by minimizing direct DOM&#13;
manipulation. AngularJS, on the other hand, often directly manipulated&#13;
the DOM, which could lead to performance issues and other inconsistent&#13;
state issues we recently discussed with jQuery.</p>&#13;
&#13;
<p>That said, AngularJS represented a significant shift in web development&#13;
practices, and we’d be remiss if we didn’t mention that AngularJS not&#13;
only revolutionized the web development landscape when it was&#13;
introduced, but also paved the way for the evolution of future&#13;
frameworks and libraries, React being one of them.</p>&#13;
&#13;
<p>Let’s explore how React fits into all of this and where React came from&#13;
at this point in history. At this time, UI updates were still a&#13;
relatively hard and unsolved problem. They’re far from solved today, but&#13;
React has made them noticeably less hard, and has inspired other&#13;
libraries like SolidJS, Qwik, and more to do so. Meta’s Facebook was&#13;
no exception to the problem of UI<a data-primary="user interface (UI)" data-seealso="updates" data-type="indexterm" id="id380"/> complexity and scale. As a result,&#13;
Meta created a number of internal solutions complementary to what&#13;
already existed at the time. Among the first of these was BoltJS<a data-primary="BoltJS" data-type="indexterm" id="id381"/>: a&#13;
tool Facebook<a data-primary="Facebook" data-type="indexterm" id="id382"/><a data-primary="Meta (Facebook)" data-type="indexterm" id="id383"/> engineers would say “bolted together” a bunch of things&#13;
that they liked. A combination of tools was&#13;
assembled to make updates to Facebook’s web user interface more&#13;
intuitive.</p>&#13;
&#13;
<p>Around this time, Facebook engineer Jordan Walke<a data-primary="Walke, Jordan" data-type="indexterm" id="id384"/> had a radical idea that&#13;
did away with the status quo of the time and entirely replaced&#13;
minimal portions of web pages with new ones as updates happened. As&#13;
we’ve seen previously, JavaScript libraries would manage relationships&#13;
between views (user interfaces) and models (conceptually, sources of&#13;
data) using a paradigm called two-way data binding. In light of this&#13;
model’s limitations, as we’ve discussed earlier, Jordan’s idea was to&#13;
instead use a paradigm called one-way data flow. This was a much simpler&#13;
paradigm, and it was much easier to keep the views and models in sync.&#13;
This was the birth of the unidirectional architecture that would go on&#13;
to be the foundation of React.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="React’s Value Proposition" data-type="sect2"><div class="sect2" id="id175">&#13;
<h2>React’s Value Proposition</h2>&#13;
&#13;
<p>OK, history<a data-primary="React" data-secondary="value proposition" data-type="indexterm" id="ix_Reactvalueproposition.01.1439.12"/> lesson’s over. Hopefully we now have enough context to&#13;
begin to understand why React is a thing. Given how easy it was to fall&#13;
into the pit of unsafe, unpredictable, and inefficient JavaScript code&#13;
at scale, we needed a solution to steer us toward a pit of success&#13;
where we <em>accidentally win</em>. Let’s talk about exactly how React does&#13;
that.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Declarative versus imperative code" data-type="sect3"><div class="sect3" id="id15">&#13;
<h3>Declarative versus imperative code</h3>&#13;
&#13;
<p>React provides a declarative<a data-primary="declarative programming" data-secondary="in React" data-secondary-sortas="React" data-type="indexterm" id="id385"/><a data-primary="React" data-secondary="and declarative programming" data-secondary-sortas="declarative programming" data-type="indexterm" id="id386"/> abstraction on the DOM. We’ll talk more&#13;
about how it does this in more detail later in the book, but essentially&#13;
it provides us a way to write code that expresses <em>what we want to see</em>,&#13;
while then taking care of <em>how it happens</em>, ensuring our user interface&#13;
is created and works in a safe, predictable, and efficient manner.</p>&#13;
&#13;
<p>Let’s consider the list app that we created earlier. In React, we could&#13;
rewrite it like this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kd">function</code> <code class="nx">MyList</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">items</code><code class="p">,</code> <code class="nx">setItems</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">([</code><code class="s2">"I love"</code><code class="p">]);</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">ul</code><code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="nx">items</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">i</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">li</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">i</code> <code class="cm">/* keep items unique */</code><code class="p">}</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">i</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/li&gt;</code>&#13;
        <code class="p">))}</code>&#13;
      <code class="o">&lt;</code><code class="err">/ul&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">NewItemForm</code> <code class="nx">onAddItem</code><code class="o">=</code><code class="p">{(</code><code class="nx">newItem</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">setItems</code><code class="p">([...</code><code class="nx">items</code><code class="p">,</code> <code class="nx">newItem</code><code class="p">])}</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/div&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Notice how in the <code>return</code>, we literally write something that looks like&#13;
HTML: it looks like what we want to see. I want to see a box with a&#13;
<code>NewItemForm</code>, and a list. Boom. How does it get there? That’s for React&#13;
to figure out. Do we batch list items to add chunks of them at once? Do&#13;
we add them sequentially, one by one? React deals with <em>how</em> this is&#13;
done, while we merely describe <em>what</em> we want done. In further chapters,&#13;
we’ll dive into React and explore exactly how it does this at the time&#13;
of writing.</p>&#13;
&#13;
<p>Do we then depend on class names to reference HTML elements? Do we&#13;
<code>getElementById</code> in JavaScript? Nope. React<a data-primary="elements" data-seealso="tree of React elements" data-type="indexterm" id="id387"/> creates unique “React&#13;
elements” for us under the hood that it uses to detect changes and make&#13;
incremental updates so we don’t need to read class names and other&#13;
identifiers from user code whose existence we cannot guarantee: our&#13;
source of truth becomes exclusively JavaScript with React.</p>&#13;
&#13;
<p>We export our <code>MyList</code> component to React, and React gets it on the&#13;
screen for us in a way that is safe, predictable, and performant—no&#13;
questions asked. The component’s job is to just return a description of&#13;
what this piece of the UI should look like. It does this by using a&#13;
<em>virtual DOM</em> (vDOM)<a data-primary="virtual DOM (vDOM)" data-type="indexterm" id="ix_virtualDOMvDOM.01.1495.21"/>, which is a lightweight description of the intended UI&#13;
structure. React then compares the virtual DOM <em>after an update happens</em>&#13;
to the virtual DOM <em>before an update happens</em>, and turns that into&#13;
small, performant updates to the real DOM to make it match the virtual&#13;
DOM. This is how React is able to make updates to the DOM.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The virtual DOM" data-type="sect3"><div class="sect3" id="id16">&#13;
<h3>The virtual DOM</h3>&#13;
&#13;
<p>The virtual DOM is a programming concept that represents the real DOM&#13;
but as a JavaScript<a data-primary="JavaScript object, virtual DOM as" data-type="indexterm" id="id388"/> object. If this is a little too in the weeds for&#13;
now, don’t worry: <a data-type="xref" href="ch03.html#ch03">Chapter 3</a> is dedicated to this and&#13;
breaks things down in a little more detail. For now, it’s just important&#13;
to know that the virtual DOM allows developers to update the UI without&#13;
directly manipulating the actual DOM. React uses the virtual DOM to keep&#13;
track of changes to a component and rerenders the component only when&#13;
necessary. This approach is faster and more efficient than updating the&#13;
entire DOM tree every time there is a change.</p>&#13;
&#13;
<p>In React, the virtual DOM is a lightweight representation of the actual&#13;
DOM tree. It is a plain JavaScript object that describes the structure&#13;
and properties of the UI elements. React creates and updates the virtual&#13;
DOM to match the actual DOM tree, and any changes made to the virtual&#13;
DOM are applied to the actual DOM using a process called <em>reconciliation</em>.</p>&#13;
&#13;
<p><a data-type="xref" href="ch04.html#ch04">Chapter 4</a> is dedicated to this, but for our contextual discussion here, let’s look at a small summary&#13;
with a few examples. To understand how the virtual DOM works, let’s&#13;
bring back our example of the Like button. We will create a React&#13;
component that displays a Like button and the number of likes. When the&#13;
user clicks the button, the number of likes should increase by one.</p>&#13;
&#13;
<p>Here is the code for our component:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="nx">React</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useState</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">LikeButton</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">likes</code><code class="p">,</code><code class="w"> </code><code class="nx">setLikes</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="mf">0</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="kd">function</code><code class="w"> </code><code class="nx">handleLike</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setLikes</code><code class="p">(</code><code class="nx">likes</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="mf">1</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">handleLike</code><code class="p">}&gt;</code><code class="nx">Like</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;{</code><code class="nx">likes</code><code class="p">}</code><code class="w"> </code><code class="nx">Likes</code><code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="nx">LikeButton</code><code class="p">;</code><code class="w"/></pre>&#13;
&#13;
<p>In this code, we have used the <code>useState</code> hook to create a state&#13;
variable <code>likes</code>, which holds the number of likes. To recap what we&#13;
might already know about React, a hook<a data-primary="hooks" data-type="indexterm" id="id389"/> is a special function that allows&#13;
us to use React features, like state and lifecycle methods, within&#13;
functional components. Hooks enable us to reuse stateful logic without&#13;
changing the component hierarchy, making it easy to extract and share&#13;
hooks among components or even with the community as self-contained&#13;
open source packages.</p>&#13;
&#13;
<p>We have also defined a function <code>handleLike</code> that increases the value of&#13;
likes by one when the button is clicked. Finally, we render the Like button and the number of likes using JSX.</p>&#13;
&#13;
<p>Now, let’s take a closer look at how the virtual DOM works in this&#13;
example.</p>&#13;
&#13;
<p>When the <code>LikeButton</code> component is first rendered, React creates a&#13;
virtual DOM tree that mirrors the actual DOM tree. The virtual DOM&#13;
contains a single <code>div</code> element that contains a <code>button</code> element and a&#13;
<code>p</code> element:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">$$typeof</code><code class="o">:</code><code class="w"> </code><code class="nb">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s1">'react.element'</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'div'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{},</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">$$typeof</code><code class="o">:</code><code class="w"> </code><code class="nb">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s1">'react.element'</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'button'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">onClick</code><code class="o">:</code><code class="w"> </code><code class="nx">handleLike</code><code class="w"> </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="s1">'Like'</code><code class="p">]</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">$$typeof</code><code class="o">:</code><code class="w"> </code><code class="nb">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s1">'react.element'</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'p'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{},</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="mf">0</code><code class="p">,</code><code class="w"> </code><code class="s1">' Likes'</code><code class="p">]</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">]</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>The <code>children</code> property of the <code>p</code> element contains the value of the <code>Likes</code>&#13;
state variable, which is initially set to zero.</p>&#13;
&#13;
<p>When the user clicks the Like button, the <code>handleLike</code> function is&#13;
called, which updates the <code>likes</code> state variable. React then creates a&#13;
new virtual DOM tree that reflects the updated state:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'div'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{},</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'button'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">onClick</code><code class="o">:</code><code class="w"> </code><code class="nx">handleLike</code><code class="w"> </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="s1">'Like'</code><code class="p">]</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="s1">'p'</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{},</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">children</code><code class="o">:</code><code class="w"> </code><code class="p">[</code><code class="mf">1</code><code class="p">,</code><code class="w"> </code><code class="s1">' Likes'</code><code class="p">]</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">]</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Notice that the virtual DOM tree contains the same elements as before,&#13;
but the <code>children</code> property of the <code>p</code> element has been updated to reflect&#13;
the new value of likes, going from <code>0</code> to <code>1</code>. What follows<a data-primary="reconciliation" data-type="indexterm" id="id390"/> is a process&#13;
called <em>reconciliation</em> in React, where the new vDOM is&#13;
compared with the old one. Let’s briefly discuss this process.</p>&#13;
&#13;
<p>After computing a new virtual DOM tree, React performs a process called&#13;
reconciliation to understand the differences between the new tree and&#13;
the old one. Reconciliation is the process of comparing the old virtual&#13;
DOM tree with the new virtual DOM tree and determining which parts of&#13;
the actual DOM need to be updated. If you’re interested in <em>how</em> exactly&#13;
this is done, <a data-type="xref" href="ch04.html#ch04">Chapter 4</a> goes into a lot of detail about&#13;
this. For now, let’s consider our Like button.</p>&#13;
&#13;
<p>In our example, React compares the old virtual DOM tree with the new&#13;
virtual DOM tree and finds that the <code>p</code> element has changed:&#13;
specifically that its props or state or both have changed. This enables&#13;
React to mark the component as “dirty” or “should be updated.” React&#13;
then computes a minimal effective set of updates to make on the actual&#13;
DOM to reconcile the state of the new vDOM with the DOM, and eventually&#13;
updates the actual DOM to reflect the changes made to the virtual DOM.</p>&#13;
&#13;
<p>React<a data-primary="performance" data-secondary="React’s improvements in" data-type="indexterm" id="id391"/> updates only the necessary parts of the actual DOM to minimize the&#13;
number of DOM manipulations. This approach is much faster and more&#13;
efficient than updating the entire DOM tree every time there is a&#13;
change.</p>&#13;
&#13;
<p>The virtual DOM has been a powerful and influential invention for the&#13;
modern web, with newer libraries like Preact and Inferno adopting it&#13;
once it was proven in React. We will cover more of the virtual DOM&#13;
in <a data-type="xref" href="ch04.html#ch04">Chapter 4</a>, but for now, let’s move on to the next section<a data-startref="ix_virtualDOMvDOM.01.1495.21" data-type="indexterm" id="id392"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The component model" data-type="sect3"><div class="sect3" id="id17">&#13;
<h3>The component model</h3>&#13;
&#13;
<p>React highly encourages “thinking in components”: that is, breaking&#13;
your app into smaller pieces and adding them to a larger tree to&#13;
compose your application. The component<a data-primary="component-based architecture" data-secondary="React’s approach" data-type="indexterm" id="id393"/><a data-primary="React" data-secondary="component-based architecture" data-type="indexterm" id="id394"/> model is a key concept in React,&#13;
and it’s what makes React so powerful. Let’s talk about why:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>It encourages reusing the same thing everywhere so that if it breaks,&#13;
you fix it in one place and it’s fixed everywhere. This is called&#13;
DRY (Don’t Repeat Yourself) development<a data-primary="DRY development" data-type="indexterm" id="id395"/> and is a key concept in&#13;
software engineering. For example, if we have a <code>Button</code> component, we&#13;
can use it in many places in our app, and if we need to change the style&#13;
of the button, we can do it in one place and it’s changed everywhere.</p>&#13;
</li>&#13;
<li>&#13;
<p>React is more easily able to keep track of components and do&#13;
performance magic like memoization, batching, and other optimizations&#13;
under the hood if it’s able to identify specific components over and&#13;
over and track<a data-primary="keying" data-type="indexterm" id="id396"/> updates to the specific components over time. This&#13;
is called <em>keying</em>. For example, if we have a <code>Button</code> component, we&#13;
can give it a <code>key</code> prop and React will be able to keep track of the&#13;
<code>Button</code> component over time and “know” when to update it, or when to&#13;
skip updating it and continue making minimal changes to the user&#13;
interface. Most components have implicit keys, but we can also&#13;
explicitly provide them if we want to.</p>&#13;
</li>&#13;
<li>&#13;
<p>It helps us separate concerns and colocate logic closer to the parts&#13;
of the user interface that the logic affects. For example, if we have a&#13;
<code>RegisterButton</code> component, we can put the logic for what happens when&#13;
the button is clicked in the same file as the <code>RegisterButton</code>&#13;
component, instead of having to jump around to different files to find&#13;
the logic for what happens when the button is clicked. The&#13;
<code>RegisterButton</code> component would wrap a more simple <code>Button</code> component,&#13;
and the <code>RegisterButton</code> component would be responsible for handling the&#13;
logic for what happens when the button is clicked. This is <a data-primary="composition, in React process" data-type="indexterm" id="id397"/>called&#13;
<em>composition</em>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>React’s component model is a fundamental concept that underpins the&#13;
framework’s popularity and success. This approach to development has&#13;
numerous benefits, including increased modularity, easier debugging, and&#13;
more efficient code reuse.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Immutable state" data-type="sect3"><div class="sect3" id="id18">&#13;
<h3>Immutable state</h3>&#13;
&#13;
<p>React’s design philosophy emphasizes a paradigm wherein the state of our&#13;
application is described as a set of immutable<a data-primary="immutability in state management" data-type="indexterm" id="id398"/><a data-primary="React" data-secondary="immutability in state management" data-type="indexterm" id="id399"/><a data-primary="state management" data-secondary="React’s approach" data-type="indexterm" id="id400"/> values. Each state update&#13;
is treated as a new, distinct snapshot and memory reference. This&#13;
immutable approach to state management is a core part of React’s value&#13;
proposition, and it has several advantages for developing robust,&#13;
efficient, and predictable user interfaces.</p>&#13;
&#13;
<p>By enforcing immutability, React ensures that the UI components reflect&#13;
a specific state at any given point in time. When the state changes,&#13;
rather than mutating it directly, you return a new object that&#13;
represents the new state. This makes it easier to track changes, debug,&#13;
and understand your application’s behavior. Since state &#13;
<span class="keep-together">transitions</span> are&#13;
discrete and do not interfere with each other, the chances of subtle&#13;
bugs caused by a shared mutable state are significantly reduced.</p>&#13;
&#13;
<p>In coming chapters, we’ll explore how React batches state updates and&#13;
processes them asynchronously<a data-primary="asynchronous rendering" data-type="indexterm" id="id401"/> to optimize performance<a data-primary="performance" data-secondary="and immutability in React" data-secondary-sortas="immutability in React" data-type="indexterm" id="id402"/>. Because state&#13;
must be treated immutably, these “transactions” can be safely&#13;
aggregated and applied without the risk of one update corrupting the&#13;
state for another. This leads to more predictable state management and&#13;
can improve app performance, especially during complex state&#13;
transitions.</p>&#13;
&#13;
<p>The use of immutable state further reinforces best practices in software&#13;
development. It encourages developers to think functionally about their&#13;
data flow, reducing side effects and making the code easier to follow.&#13;
The clarity of an immutable data flow simplifies the mental model for&#13;
understanding how an application works.</p>&#13;
&#13;
<p>Immutability also enables powerful developer tools, such as <a data-primary="time-travel debugging" data-type="indexterm" id="id403"/>time-travel&#13;
debugging with tools like Replay.io<a data-primary="Replay.io" data-type="indexterm" id="id404"/>, where developers can step forward&#13;
and backward through the state changes of an application to inspect the&#13;
UI at any point in time. This is only feasible if every state update is&#13;
kept as a unique and unmodified snapshot.</p>&#13;
&#13;
<p>React’s commitment to immutable state updates is a deliberate design&#13;
choice that brings numerous benefits. It aligns with modern functional&#13;
programming principles, enabling efficient UI updates, optimizing&#13;
performance, reducing the likelihood of bugs, and improving the overall&#13;
developer experience. This approach to state management underpins many&#13;
of React’s advanced features and will continue to be a cornerstone as&#13;
React evolves<a data-startref="ix_Reactvalueproposition.01.1439.12" data-type="indexterm" id="id405"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Releasing React" data-type="sect2"><div class="sect2" id="id19">&#13;
<h2>Releasing React</h2>&#13;
&#13;
<p>Unidirectional data flow was a radical departure<a data-primary="React" data-secondary="release of" data-type="indexterm" id="id406"/> from the way we had&#13;
been building web apps for years, and it was met&#13;
with skepticism. The fact that Facebook<a data-primary="Facebook" data-type="indexterm" id="id407"/><a data-primary="Meta (Facebook)" data-type="indexterm" id="id408"/> was a large company with a lot&#13;
of resources, a lot of users, and a lot of engineers with opinions made&#13;
its upward climb a steep one. After much scrutiny, React was an internal&#13;
success. It was adopted by Facebook and then by Instagram.</p>&#13;
&#13;
<p>It was then made open source in 2013 and released to the world where it was&#13;
met with a tremendous amount of backlash. People heavily criticized React&#13;
for its use of JSX<a data-primary="JSX (JavaScript Syntax eXtension)" data-secondary="initial criticism of React for using" data-type="indexterm" id="id409"/>, accusing Facebook of “putting HTML in JavaScript”&#13;
and breaking separation of concerns. Facebook became known as the&#13;
company that “rethinks best practices” and breaks the web. Eventually,&#13;
after slow and steady adoption by companies like Netflix, Airbnb, and&#13;
<em>The New York Times</em>, React became the de facto standard for building user&#13;
interfaces on the web.</p>&#13;
&#13;
<p>A number of details are left out of this story because&#13;
they fall out of the scope of this book, but it’s important to&#13;
understand the context of React before we dive into the details:&#13;
specifically the class of technical problems React was created to solve.&#13;
Should you be more interested in the story of React, there is a full&#13;
documentary on the &#13;
<span class="keep-together">history</span> of React that is freely available on YouTube&#13;
under <em>React.js: The Documentary</em> by Honeypot.</p>&#13;
&#13;
<p>Given that Facebook had a front-row seat to these problems at enormous&#13;
scale, React pioneered a component-based approach to building user&#13;
interfaces that would solve these problems and more, where each&#13;
component would be a self-contained unit of code that could be reused&#13;
and composed with other components to build more complex user&#13;
interfaces.</p>&#13;
&#13;
<p>A year after React was released as open source software, Facebook released Flux: a pattern&#13;
for managing data flow in React applications. Flux was a response to the&#13;
challenges of managing data flow in large-scale applications, and it was&#13;
a key part of the React ecosystem<a data-primary="ecosystems and tooling" data-secondary="Flux as part of" data-type="indexterm" id="id410"/>. Let’s take a look at Flux and how it&#13;
fits into the React.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Flux Architecture" data-type="sect2"><div class="sect2" id="id20">&#13;
<h2>The Flux Architecture</h2>&#13;
&#13;
<p>Flux<a data-primary="React" data-secondary="Flux architecture" data-type="indexterm" id="ix_ReactFluxarchitecture.01.1776.5"/><a data-primary="Flux architecture" data-type="indexterm" id="ix_Fluxarchitecture.01.1776.5"/> is an architectural design pattern for building client-side web&#13;
applications, popularized by Facebook (now Meta) (see <a data-type="xref" href="#figure1-3">Figure 1-3</a>). It emphasizes a unidirectional data flow, which makes the flow of data within the app more predictable.</p>&#13;
&#13;
<figure><div class="figure" id="figure1-3">&#13;
<img alt="flux" src="assets/frea_0103.png"/>&#13;
<h6><span class="label">Figure 1-3. </span>The Flux architecture</h6>&#13;
</div></figure>&#13;
&#13;
<p>Here are the key concepts of the Flux architecture:</p>&#13;
<dl>&#13;
<dt>Actions</dt>&#13;
<dd>&#13;
<p>Actions<a data-primary="actions in Flux" data-type="indexterm" id="id411"/> are simple objects containing new data and an&#13;
identifying type property. They represent the external and internal&#13;
inputs to the system, like user interactions, server responses, and form&#13;
inputs. Actions are dispatched through a central dispatcher to various&#13;
stores:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Example of an action object</code>&#13;
<code class="p">{</code>&#13;
  <code class="nx">type</code><code class="o">:</code> <code class="s1">'ADD_TODO'</code><code class="p">,</code>&#13;
  <code class="nx">text</code><code class="o">:</code> <code class="s1">'Learn Flux Architecture'</code>&#13;
<code class="p">}</code></pre>&#13;
</dd>&#13;
<dt>Dispatcher</dt>&#13;
<dd>&#13;
<p>The dispatcher<a data-primary="dispatchers in Flux" data-type="indexterm" id="id412"/> is the central hub of the Flux&#13;
architecture. It receives actions and dispatches them to the registered&#13;
stores in the application. It manages a list of callbacks, and every&#13;
store registers itself and its callback with the dispatcher. When an&#13;
action is dispatched, it is sent to all registered callbacks:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Example of dispatching an action</code>&#13;
<code class="nx">Dispatcher</code><code class="p">.</code><code class="nx">dispatch</code><code class="p">(</code><code class="nx">action</code><code class="p">);</code></pre>&#13;
</dd>&#13;
<dt>Stores</dt>&#13;
<dd>&#13;
<p>Stores<a data-primary="stores in Flux" data-type="indexterm" id="id413"/> contain the application state and logic. They are&#13;
somewhat similar to models in the MVC architecture, but they manage the&#13;
state of many objects. They register with the dispatcher and provide&#13;
callbacks to handle the actions. When a store’s state is updated, it&#13;
emits a change event to alert the views that something has changed:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Example of a store</code>&#13;
<code class="kr">class</code> <code class="nx">TodoStore</code> <code class="kr">extends</code> <code class="nx">EventEmitter</code> <code class="p">{</code>&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">todos</code> <code class="o">=</code> <code class="p">[];</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">handleActions</code><code class="p">(</code><code class="nx">action</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">switch</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">case</code> <code class="s2">"ADD_TODO"</code><code class="o">:</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">todos</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">text</code><code class="p">);</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">emit</code><code class="p">(</code><code class="s2">"change"</code><code class="p">);</code>&#13;
        <code class="k">break</code><code class="p">;</code>&#13;
      <code class="k">default</code><code class="o">:</code>&#13;
      <code class="c1">// no op</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</dd>&#13;
<dt>Views</dt>&#13;
<dd>&#13;
<p>Views<a data-primary="views in Flux" data-type="indexterm" id="id414"/> are React components. They listen to change events from&#13;
the stores and update themselves when the data they depend on changes.&#13;
They can also create new actions to update the system state, forming a&#13;
unidirectional cycle of data flow.</p>&#13;
&#13;
<p>The Flux architecture promotes a unidirectional data flow <a data-primary="unidirectional data flow" data-type="indexterm" id="id415"/>through a&#13;
system, which makes it easier to track changes over time. This&#13;
predictability can later be used as the basis for compilers to further&#13;
optimize code, as is the case with React Forget (more on this later).</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Benefits of the Flux Architecture" data-type="sect2"><div class="sect2" id="id21">&#13;
<h2>Benefits of the Flux Architecture</h2>&#13;
&#13;
<p>The Flux architecture brings about a variety of benefits that help&#13;
manage complexity and improve the maintainability of web&#13;
applications. Here are some of the notable benefits:</p>&#13;
<dl>&#13;
<dt>Single source of truth</dt>&#13;
<dd>&#13;
<p>Flux emphasizes having a single source of&#13;
truth for the application’s state, which is stored in the stores<a data-primary="single source of truth, in Flux stores" data-type="indexterm" id="id416"/>. This&#13;
centralized state management makes the application’s behavior more&#13;
predictable and easier to understand. It eliminates the complications&#13;
that come with having multiple, interdependent sources of truth, which&#13;
can lead to bugs and inconsistent state across the application.</p>&#13;
</dd>&#13;
<dt>Testability</dt>&#13;
<dd>&#13;
<p>Flux’s well-defined structures and predictable data&#13;
flow make the application highly testable<a data-primary="testing of code" data-secondary="Flux architecture" data-type="indexterm" id="id417"/>. The separation of concerns<a data-primary="separation of concerns (SoC)" data-secondary="Flux architecture" data-type="indexterm" id="id418"/>&#13;
among different parts of the system (like actions, dispatcher, stores,&#13;
and views) allows for unit testing each part in isolation. Moreover,&#13;
it’s easier to write tests when the data flow is unidirectional and when&#13;
the state is stored in specific, predictable locations.</p>&#13;
</dd>&#13;
<dt>Separation of concerns (SoC)</dt>&#13;
<dd>&#13;
<p>Flux clearly separates the concerns of&#13;
different parts of the system, as described earlier. This separation makes&#13;
the system more modular, easier to maintain, and easier to reason about.&#13;
Each part has a clearly defined role, and the unidirectional data flow&#13;
makes it clear how these parts interact with each other.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The Flux architecture provides a solid foundation for building robust,&#13;
scalable, and maintainable web applications. Its emphasis on a&#13;
unidirectional data flow, single source of truth, and Separation of&#13;
Concerns leads to applications that are easier to develop, test, and&#13;
debug<a data-startref="ix_Reactdevelopmentof.01.1382.35" data-type="indexterm" id="id419"/><a data-startref="ix_ReactFluxarchitecture.01.1776.5" data-type="indexterm" id="id420"/><a data-startref="ix_Fluxarchitecture.01.1776.5" data-type="indexterm" id="id421"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Wrap-Up: So…Why Is React a Thing?" data-type="sect1"><div class="sect1" id="id22">&#13;
<h1>Wrap-Up: So…Why Is React a Thing?</h1>&#13;
&#13;
<p>React<a data-primary="React" data-secondary="purpose and feature wrap-up" data-type="indexterm" id="id422"/><a data-primary="user interface (UI)" data-type="indexterm" id="id423"/> is a thing because it allows developers to build user interfaces&#13;
with greater predictability and reliability, enabling us to&#13;
declaratively express <em>what we’d like on the screen</em> while React takes&#13;
care of the <em>how</em> by making incremental updates to the DOM in an&#13;
efficient manner. It also encourages us to think in components, which&#13;
helps us separate concerns and reuse code more easily. It is battle-tested at Meta and designed to be used at scale. It’s also open source&#13;
and free to use.</p>&#13;
&#13;
<p>React also has a vast and active ecosystem<a data-primary="ecosystems and tooling" data-type="indexterm" id="id424"/>, with a wide range of tools,&#13;
libraries, and resources available to developers. This ecosystem&#13;
includes tools for testing, debugging, and optimizing React&#13;
applications, as well as libraries for common tasks such as data&#13;
management, routing, and state management. Additionally, the React&#13;
community is highly engaged and supportive, with many online resources,&#13;
forums, and communities available to help developers learn and grow.</p>&#13;
&#13;
<p>React is platform-agnostic<a data-primary="platform-agnostic, React as" data-type="indexterm" id="id425"/>, meaning that it can be used to build web&#13;
applications for a wide range of platforms, including desktop, mobile,&#13;
and virtual reality. This flexibility makes React an attractive option for developers&#13;
who need to build applications for multiple platforms, as it allows them&#13;
to use a single codebase to build applications that run across multiple&#13;
devices.</p>&#13;
&#13;
<p>To conclude, React’s value proposition is centered around its&#13;
component-based architecture, declarative programming model, virtual&#13;
DOM, JSX, extensive ecosystem, platform agnostic nature, and backing by&#13;
Meta. Together, these features make React an attractive option for&#13;
developers who need to build fast, scalable, and maintainable web&#13;
applications. Whether you’re building a simple website or a complex&#13;
enterprise application, React can help you achieve your goals more&#13;
efficiently and effectively than many other technologies. Let’s review.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Chapter Review" data-type="sect1"><div class="sect1" id="id221">&#13;
<h1>Chapter Review</h1>&#13;
&#13;
<p>In this chapter, we covered a brief history of React, its initial value&#13;
proposition, and how it solves the problems of unsafe, unpredictable,&#13;
and inefficient user interface updates at scale. We also talked about&#13;
the component model and why it has been revolutionary for interfaces on&#13;
the web. Let’s recap what we’ve learned. Ideally, after this chapter you&#13;
are more informed about the roots of React and where it comes from as&#13;
well as its main strengths and value proposition.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review Questions" data-type="sect1"><div class="sect1" id="id23">&#13;
<h1>Review Questions</h1>&#13;
&#13;
<p>Let’s make sure you’ve fully grasped the topics we covered. Take a&#13;
moment to answer the following questions:</p>&#13;
<ol>&#13;
<li>&#13;
<p>What was the motivation to create React?</p>&#13;
</li>&#13;
<li>&#13;
<p>How does React improve on prior patterns like MVC and MVVM?</p>&#13;
</li>&#13;
<li>&#13;
<p>What’s so special about the Flux architecture?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are the benefits of declarative programming abstractions?</p>&#13;
</li>&#13;
<li>&#13;
<p>What’s the role of the virtual DOM in making efficient UI updates?</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>If you have trouble answering these questions, this chapter may be worth&#13;
another read. If not, let’s explore the next chapter<a data-startref="ix_React.01.5.37" data-type="indexterm" id="id426"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Up Next" data-type="sect1"><div class="sect1" id="id222">&#13;
<h1>Up Next</h1>&#13;
&#13;
<p>In <a data-type="xref" href="ch02.html#ch02">Chapter 2</a> we will dive a little deeper into this declarative&#13;
abstraction that allows us to express what we want to see on the screen:&#13;
the syntax and inner workings of JSX—the language that looks like HTML&#13;
in JavaScript that got React into a lot of trouble in its early days,&#13;
but ultimately revealed itself to be the ideal way to build user&#13;
interfaces on the web, influencing a number of future libraries for&#13;
building user interfaces.</p>&#13;
</div></section>&#13;
</div></section></body></html>