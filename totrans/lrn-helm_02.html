<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. Using Helm"><div class="chapter" id="Using_Helm">
<h1><span class="label">Chapter 2. </span>Using Helm</h1>


<p class="lead">Helm provides a command-line tool, named <code>helm</code>, that makes available all the features necessary for working with Helm charts.<a data-type="indexterm" data-primary="Helm" data-secondary="helm client" data-tertiary="about" id="idm46126000112248"/><a data-type="indexterm" data-primary="getting started" data-secondary="about helm client" id="idm46126000111000"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="about helm client" id="idm46126000110056"/><a data-type="indexterm" data-primary="Helm" data-secondary="helm client" data-tertiary="installing" id="ch02-inst"/> In this chapter, we will discover the primary features of the <code>helm</code> client. Along the way, we’ll learn how Helm interacts with Kubernetes.</p>

<p>We will start by looking at how to install and configure Helm, and work our way through the main command groups in Helm. Then we will cover finding and learning about packages, and how to install, upgrade, and delete them.</p>






<section data-type="sect1" data-pdf-bookmark="Installing and Configuring the Helm Client"><div class="sect1" id="idm46126000106488">
<h1>Installing and Configuring the Helm Client</h1>

<p>Helm provides a single command-line client that is capable of performing all of the main Helm tasks. <a data-type="indexterm" data-primary="charts" data-secondary="about helm client" id="idm46126000104840"/>This client is, appropriately enough, named <code>helm</code>. While there are many other tools that can work with Helm charts, this one is the official general-purpose tool maintained by the Helm core maintainers, and it is the subject of this chapter as well as the next.</p>

<p>The <code>helm</code> client is written in a programming language called Go. Unlike Python, JavaScript, or Ruby, Go is a compiled language. Once a Go program is compiled, you do not need any of the Go tools to run or otherwise work with the binary.</p>

<p>So we will first cover downloading and installing the static binary, and then we will briefly introduce the process for fetching and compiling from the Go source code, should you so desire.</p>








<section data-type="sect2" data-pdf-bookmark="Installing a Prebuilt Binary"><div class="sect2" id="idm46126000101208">
<h2>Installing a Prebuilt Binary</h2>

<p>Each time the Helm maintainers issue a new release of <code>helm</code>, the project provides new signed binary<a data-type="indexterm" data-primary="getting started" data-secondary="installing helm client" data-tertiary="prebuilt binary" id="ch02-inst2"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" id="ch02-inst4"/><a data-type="indexterm" data-primary="prebuilt binary for helm client installation" id="ch02-inst3"/> builds of <code>helm</code> for a number of common operating systems and 
<span class="keep-together">architectures</span>. At the time of this writing, prebuilt versions of Helm are available for Linux, Windows, and macOS on architectures ranging from 64-bit Intel/AMD to ARM, to s390 and PPC. This means you can run Helm on anything from a Raspberry Pi to a supercomputer.</p>

<p>The definitive list of Helm releases is at <a href="https://oreil.ly/L_My5">the Helm release page</a>.<a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" data-tertiary="list of Helm releases" id="idm46126000092680"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Helm releases" id="idm46126000091432"/> The release page will show a chronological list of releases, with the latest release at the top.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46126000090120">
<h5>Install with a Package Manager</h5>
<p>Many operating system package managers, including Homebrew for <a data-type="indexterm" data-primary="package managers" data-secondary="installing helm client" id="idm46126000088856"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" data-tertiary="package managers" id="idm46126000087800"/>macOS, Snap for Linux, and Chocolatey for Windows, can install Helm for you. We are big package management fans. Package managers make it easy to install, update, and delete your software, so we encourage you let your operating system package manager install Helm for you. But it is often wise to check whether the version in your package manager of choice is the same version that is currently marked stable on the Helm site.</p>
</div></aside>










<section data-type="sect3" data-pdf-bookmark="A note on Helm version numbers"><div class="sect3" id="idm46126000085688">
<h3>A note on Helm version numbers</h3>

<p>Until November 2020, two different major versions of Helm were actively maintained.<a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" data-tertiary="Helm version numbers" id="idm46126000084024"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="prebuilt binaries" id="idm46126000082712"/><a data-type="indexterm" data-primary="versions of Helm" data-secondary="prebuilt binaries" id="idm46126000081496"/> The current stable major version of Helm is version 3. When you visit the Helm download pages, you may see both versions available for download. Because the versions are chronologically listed, it is even possible that a Helm 2 release will be newer than the latest Helm 3 release. You should use Helm 3.</p>

<p>Helm follows a versioning convention known as <a href="https://semver.org">Semantic Versioning</a> (SemVer). <a data-type="indexterm" data-primary="versions of Helm" data-secondary="prebuilt binaries" data-tertiary="Semantic Versioning" id="idm46126000079032"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="Semantic Versioning" id="idm46126000077752"/><a data-type="indexterm" data-primary="Semantic Versioning" id="idm46126000076536"/><a data-type="indexterm" data-primary="versions of Helm" data-secondary="Semantic Versioning" id="idm46126000075864"/><a data-type="indexterm" data-primary="charts" data-secondary="versions" data-tertiary="Semantic Versioning" id="idm46126000074920"/>In Semantic Versioning, the version number conveys meaning about what you can expect in the release. Because Helm follows this specification, users can expect certain things out of releases simply by carefully reading the version number.</p>

<p>At its core, a semantic version has three numerical components and an optional <em>stability marker</em> (for alphas, betas, and release candidates). Here are some examples:</p>

<ul>
<li>
<p><code>v1.0.0</code></p>
</li>
<li>
<p><code>v3.3.2</code></p>
</li>
<li>
<p><code>v2.4.22-alpha.2</code></p>
</li>
</ul>

<p>Let’s talk about the numerical components first.</p>

<p>We often generalize this format to talk about <code>X.Y.Z</code>, where <code>X</code> is a <em>major version</em>, <code>Y</code> is a <em>minor version</em> and <code>Z</code> is a <em>patch release</em>:</p>

<ul>
<li>
<p>The major release number tends to be incremented infrequently. It indicates that major changes have been made to Helm, and that some of those changes may break compatibility with previous versions. The difference between Helm 2 and Helm 3 is substantial, and there is work necessary to migrate between the 
<span class="keep-together">versions</span>.</p>
</li>
<li>
<p>The minor release number indicates feature additions. The difference between 3.2.0 and 3.3.0 might be that a few small new features were added. However, there are no <em>breaking changes</em> between versions. (With one caveat: a security fix might necessitate a breaking change, but we announce boldly when that is the case.)</p>
</li>
<li>
<p>The patch release number indicates that <em>only</em> backward compatible bug fixes have been made between this release and the last one. It is always recommended to stay at the latest patch release.</p>
</li>
</ul>

<p>When you see a release with a stability marker, like <code>alpha.1</code>, <code>beta.4</code>, or <code>rc.2</code>, appended to the release number, that means the release is considered to be a pre-release, and is not ready for mainstream production usage. In particular, Helm frequently issues <em>release candidates</em> before a major or minor update. These give the community a chance to give us some feedback on stability, compatibility, and new features before we issue a final release.</p>

<p>With this in mind, we are ready to proceed with the actual installation.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Downloading the binary"><div class="sect3" id="idm46126000085096">
<h3>Downloading the binary</h3>

<p>The easiest way to install Helm from the repository is to simply go to the <a href="https://oreil.ly/L_My5">releases page</a> and download the latest Helm 3 version.<a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" data-tertiary="downloading binary" id="idm46126000054136"/></p>

<p>On Windows, the download file is a ZIP archive containing a <em>README.md</em> text file, a <em>LICENSE</em> text file, and <em>helm.exe</em>.</p>

<p>On macOS and Linux, the download will be in a gzipped tar archive (<code>.tar.gz</code>) that can be extracted with the <code>tar -zxf</code> command. Like the Windows version, it will contain a <em>README.md</em> text file, a <em>LICENSE</em> text file, and the <code>helm</code> binary. If you are using Windows Subsystem for Linux (WSL), you should install the Linux AMD64 version into your WSL instance.</p>

<p>Regardless of which operating system you use, the binary is the only file you need to run Helm, and you can put it wherever you prefer on your system. It should be pre-marked as an executable, but on rare occasions in UNIX-like environments, you may also need to run the command <code>chmod helm +x</code> to set Helm to be an executable.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When installing with package managers like Homebrew (macOS), Snap (Linux), or Chocolatey (Windows), <code>helm</code> will be installed in a standard location and be made immediately available to you via the command line.</p>
</div>

<p>Once you have <code>helm</code> installed, you should be able to run the command <code>helm help</code> and see the Helm help text.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Using the get script to install"><div class="sect3" id="idm46126000043688">
<h3>Using the get script to install</h3>

<p>On macOS and Linux, you may prefer to run a shell script that will determine which version of Helm to install and do it automatically for you.<a data-type="indexterm" data-primary="installation of helm client" data-secondary="prebuilt binary" data-tertiary="shell script" id="idm46126000041992"/><a data-type="indexterm" data-primary="shells" data-secondary="shell script to install helm client" data-seealso="Bash scripts" id="idm46126000040680"/><a data-type="indexterm" data-primary="Bash scripts" data-secondary="shell script to install helm client" id="idm46126000039448"/></p>

<p>The usual sequence of commands for installing this way is as follows:</p>

<pre data-type="programlisting">$ curl -fsSL -o get_helm.sh \
https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
$ chmod 700 get_helm.sh
$ ./get_helm.sh</pre>

<p>The preceding commands fetch the latest version of the <code>get_helm.sh</code> script, and then use that to find and install the latest version of Helm 3.</p>

<p>For systems that automatically install Helm, such as continuous integration (CI) systems, we recommend using this method if it is important to always have the latest Helm version.<a data-type="indexterm" data-startref="ch02-inst2" id="idm46126000035816"/><a data-type="indexterm" data-startref="ch02-inst3" id="idm46126000035112"/><a data-type="indexterm" data-startref="ch02-inst4" id="idm46126000034440"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Guidance on Building from Source"><div class="sect2" id="idm46126000033640">
<h2>Guidance on Building from Source</h2>

<p>Unless you are already familiar with Go development, building Helm from source can be a daunting task.<a data-type="indexterm" data-primary="installation of helm client" data-secondary="building from source" id="idm46126000031640"/><a data-type="indexterm" data-primary="getting started" data-secondary="installing helm client" data-tertiary="building from source" id="idm46126000030696"/> You will need a version of the <code>make</code> command. Because <code>Makefile</code>-style build scripts do not follow a single standard, not all versions of <code>make</code> will work to build Helm. Gnu Make, the one most frequently used on Linux and Mac, is the one most Helm core developers use, so it is a safe bet. You will also need the <code>gcc</code> compiler and the entire Go toolchain.</p>

<p>In addition to these, Helm needs several auxilliary tools. Fortunately, when you run <code>make</code> the first time, it will attempt to install any additional tools that are missing.</p>

<p>While they are not strictly necessary, you will probably also want the <code>git</code> tool and the <code>kubectl</code> command.<a data-type="indexterm" data-primary="Kubernetes" data-secondary="kubectl" data-tertiary="about" id="idm46126000025208"/><a data-type="indexterm" data-primary="git tool" id="idm46126000023928"/> The <code>git</code> tool will allow you to work directly with the Helm source code repository instead of downloading source code bundles. <code>kubectl</code>, of course, is for interacting with your Kubernetes cluster. While that’s not necessary for <em>building</em> Helm, it’s certainly necessary when checking to see whether Helm is doing what you want it to do.</p>

<p>Once you have the tools installed and configured, you can simply change directories in the folder that contains Helm’s source code (the directory with the <em>README.md</em> and Makefile files) and run <code>make build</code>. The first time you run this command, it will take at least several minutes. The build system must fetch lots of dependencies, including much of the Kubernetes source code, and compile it all.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Compiling Helm for the first time can be daunting, especially if you are new to the Go programming language. Kubernetes is a sophisticated platform, and thus the Helm source code is large and difficult to build. Plan on spending at least an hour or two to get a fresh environment prepared to install Helm.</p>
</div>

<p>To verify that Helm is functioning correctly (especially if you have modified the source code), you can run <code>make test</code>. This will build the code, run a variety of checkers and linters, and then run the unit tests for Helm. If you plan on contributing any changes to Helm, this command <em>must</em> pass before Helm’s core maintainers will even look at your requested change.</p>

<p>When Helm is compiled, it will be located alongside the source code in a subdirectory called <em>bin/</em>. It will not automatically be added to your executable path, so to execute the version you just built, you may need to specify the relative or exact path (e.g., <em>./bin/helm</em> or <em>$GOPATH/src/helm.sh/helm/bin/helm</em>).</p>

<p>If the command <code>helm version</code> correctly executes, you can be assured that you correctly compiled Helm.</p>

<p>From here, you can follow the detailed <a href="https://oreil.ly/X9-Ii">Developer Guide</a> to learn more.<a data-type="indexterm" data-primary="resources for learning" data-secondary="Helm Developer Guide" id="idm46126000012792"/><a data-type="indexterm" data-primary="Helm" data-secondary="Developer Guide" id="idm46126000011784"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="helm-users channel on Kubernetes Slack server" id="idm46126000010840"/><a data-type="indexterm" data-primary="Helm" data-secondary="online community" id="idm46126000009864"/><a data-type="indexterm" data-primary="online community" id="idm46126000008920"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="online community" id="idm46126000008248"/> As always, if you run into problems, the <code>helm-users</code> channel on the Kubernetes Slack server is a great place to ask for help.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Working with Kubernetes Clusters"><div class="sect2" id="idm46126000033048">
<h2>Working with Kubernetes Clusters</h2>

<p>Helm interacts directly with the Kubernetes API server. For that reason, <a data-type="indexterm" data-primary="installation of helm client" data-secondary="Kubernetes cluster connection" id="idm46126000005416"/><a data-type="indexterm" data-primary="getting started" data-secondary="installing helm client" data-tertiary="Kubernetes cluster connection" id="idm46126000004408"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="helm client connection" id="idm46126000003176"/><a data-type="indexterm" data-primary="configuration" data-secondary="helm client connecting to Kubernetes cluster" id="idm46126000002232"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="kubectl" data-tertiary="helm client connection" id="idm46126000001256"/>Helm needs to be able to connect to a Kubernetes cluster. Helm attempts to do this automatically by reading the same configuration files used by <code>kubectl</code> (the main Kubernetes command-line client).</p>

<p>Helm will try to find this information by reading the environment variable 
<span class="keep-together"><em>$KUBECONFIG</em></span>. If that is not set, it will look in the same default locations that <code>kubectl</code> looks in (for example, <em>$HOME/.kube/config</em> on UNIX, Linux, and macOS).</p>

<p>You can also override these settings with environment variables (<code>HELM_KUBECONTEXT</code>) and command-line flags (<code>--kube-context</code>). You can see a list of environment variables and flags by running <code>helm help</code>.</p>

<p>The Helm maintainers recommend using <code>kubectl</code> to manage your <a data-type="indexterm" data-primary="Kubernetes" data-secondary="kubectl" data-tertiary="credential management" id="idm46125999994392"/>Kubernetes credentials and letting Helm merely autodetect these settings. If you have not yet installed <code>kubectl</code>, the best place to start is with the <a href="https://oreil.ly/pHZIh">official Kubernetes installation documentation</a>.<a data-type="indexterm" data-startref="ch02-inst" id="idm46125999991672"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Getting Started with Helm"><div class="sect2" id="idm46125999990840">
<h2>Getting Started with Helm</h2>

<p>Whether you built Helm from source or installed using one of the aforementioned methods, at this point you should have the <code>helm</code> command available on your system. From here on, we will assume that Helm can be executed with the command <code>helm</code> (as opposed to a full or relative path, as discussed in the previous section).</p>

<p>In what follows, we are going to take a look at the most common workflow for starting out with Helm:</p>
<ol>
<li>
<p>Add a chart repository.</p>
</li>
<li>
<p>Find a chart to install.</p>
</li>
<li>
<p>Install a Helm chart.</p>
</li>
<li>
<p>See the list of what is installed.</p>
</li>
<li>
<p>Upgrade your installation.</p>
</li>
<li>
<p>Delete the installation.</p>
</li>

</ol>

<p>Then, in the next chapter we will dive into some of the additional features of Helm and in so doing learn more about how Helm works.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Adding a Chart Repository"><div class="sect1" id="idm46125999981080">
<h1>Adding a Chart Repository</h1>

<p>Chart repositories are a topic in their own right, and in <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a> <a data-type="indexterm" data-primary="getting started" data-secondary="chart repository added" id="idm46125999978376"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="about" data-tertiary="basics" id="idm46125999977400"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="adding chart repository" id="idm46125999976184"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" id="idm46125999975272"/><a data-type="indexterm" data-primary="Helm" data-secondary="chart repositories" data-tertiary="adding" id="idm46125999974360"/>we will examine them in detail. But anyone using Helm must know a few basics about chart 
<span class="keep-together">repositories</span>.</p>

<p>A Helm chart is an <em>individual package</em> that can be installed into your Kubernetes cluster.<a data-type="indexterm" data-primary="charts" data-secondary="as packages" data-secondary-sortas="packages" id="idm46125999971416"/><a data-type="indexterm" data-primary="packages" data-secondary="charts as" id="idm46125999970168"/><a data-type="indexterm" data-primary="package managers" data-secondary="charts as packages" id="idm46125999969224"/> During chart development, you will often just work with a chart that is stored on your local filesystem.</p>

<p>But when it comes to sharing charts, Helm describes a standard format for indexing and sharing information about Helm charts.<a data-type="indexterm" data-primary="Helm" data-secondary="chart repositories" data-seealso="chart repositories" id="idm46125999967496"/> A Helm <em>chart repository</em> is simply a set of files, reachable over the network, that conforms to the Helm specification for indexing packages.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Helm 3 introduced an experimental feature for storing Helm charts in a different kind of repository:<a data-type="indexterm" data-primary="versions of Helm" data-secondary="charts and" data-tertiary="open container initiative registries" id="idm46125999964456"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="open container initiative registries" id="idm46125999963240"/><a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" id="idm46125999962008"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="Helm 3 introducing" id="idm46125999961064"/><a data-type="indexterm" data-primary="open container initiative registries" data-see="OCI" id="idm46125999960024"/> Open Container Initiative (OCI) registries (sometimes called Docker registries). In this backend, a Helm chart can be stored alongside Docker images. While this feature is not yet broadly supported, it may become the future of Helm package storage. This is discussed more in <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a>.</p>
</div>

<p>There are many—perhaps thousands of—chart repositories on the internet.<a data-type="indexterm" data-primary="resources for learning" data-secondary="chart repositories" id="idm46125999957304"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="Artifact Hub for" id="idm46125999956328"/><a data-type="indexterm" data-primary="Artifact Hub" data-secondary="chart repositories" id="idm46125999955384"/><a data-type="indexterm" data-primary="Helm" data-secondary="online community" data-tertiary="Artifact Hub for chart repositories" id="idm46125999954440"/><a data-type="indexterm" data-primary="online community" data-secondary="Artifact Hub for chart repositories" id="idm46125999953208"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="online community" data-tertiary="Artifact Hub for chart repositories" id="idm46125999952248"/> The easiest way to find the popular repositories is to use your web browser to navigate to <a href="https://artifacthub.io">the Artifact Hub</a>. There you will find thousands of Helm charts, each hosted on an appropriate repository.</p>

<p>To get started, we will install the popular <a href="https://www.drupal.org">Drupal content management system</a>.<a data-type="indexterm" data-primary="Drupal charts" data-secondary="installation of content management system" id="idm46125999948680"/> This makes a good example chart because it exercises many of Kubernetes’ types, including <code>Deployment</code>s, <code>Service</code>s, <code>Ingress</code>, and <code>ConfigMap</code>s.</p>

<p>Helm 2 came with a Helm repository installed by default. The <code>stable</code> chart repository was at one time the official source of production-ready Helm charts. But we realized that centralizing the charts into one repository was overly taxing to a small group of maintainers and frustrating for chart contributors.</p>

<p>In Helm 3, there is no default repository. Users are encouraged to use the Artifact Hub to find what they are looking for and then add their preferred repositories.</p>

<p>Drupal’s Helm chart is located in one of the most well-curated chart repositories available: Bitnami’s official Helm charts. You can take a look at the Artifact Hub’s <a href="https://oreil.ly/baxxf">entry for the Drupal chart</a> for more information.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A handful of Bitnami developers were among the core contributors who designed the Helm repository system. They have contributed to the establishment of Helm’s best practices for chart development and have written many of the most widely used charts.</p>
</div>

<p>Adding a Helm chart is done with the <code>helm repo add</code> command. Several Helm repository commands are grouped under the <code>helm repo</code> command group:</p>

<pre data-type="programlisting">$ helm repo add bitnami https://charts.bitnami.com/bitnami
"bitnami" has been added to your repositories</pre>

<p>The <code>helm repo add</code> command will add a repository named <code>bitnami</code> that points to the URL <em><a href="https://charts.bitnami.com/bitnami"><em class="hyperlink">https://charts.bitnami.com/bitnami</em></a></em>.</p>

<p>Now we can verify that the Bitnami repository exists by running a second <code>repo</code> 
<span class="keep-together">command</span>:</p>

<pre data-type="programlisting">$ helm repo list
NAME    URL
bitnami https://charts.bitnami.com/bitnami</pre>

<p>This command shows us all of the repositories installed for Helm. Right now, we see only the Bitnami repository that we just added.</p>

<p>Once we have added a repository, its index will be locally cached until we next update it (see <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a>). And one important thing that we can now do is search the 
<span class="keep-together">repository</span>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Searching a Chart Repository"><div class="sect1" id="idm46125999980456">
<h1>Searching a Chart Repository</h1>

<p>Although we know, having looked at the Artifact Hub, that the Drupal chart exists in this repository,<a data-type="indexterm" data-primary="chart repositories" data-secondary="searching a chart repository" id="idm46125999929560"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="chart repository searched" id="idm46125999928520"/><a data-type="indexterm" data-primary="getting started" data-secondary="chart repository searched" id="idm46125999927544"/><a data-type="indexterm" data-primary="Drupal charts" data-secondary="searching" id="idm46125999926584"/><a data-type="indexterm" data-primary="Helm" data-secondary="chart repositories" data-tertiary="searching" id="idm46125999925640"/> it is still useful to search for it from the command line. Oftentimes, searching is a useful way to find not only what charts can be installed, but what versions are available.</p>

<p>To begin, let’s search for the Drupal chart:</p>

<pre data-type="programlisting">$ helm search repo drupal
NAME            CHART VERSION   APP VERSION     DESCRIPTION
bitnami/drupal  7.0.0           9.0.0           One of the most versatile open...</pre>

<p>We did a simple search for the term <em>drupal</em>. Helm will search not just the package names, but also other fields like labels and descriptions. Thus, we could search for <em>content</em> and see Drupal listed there because it is a content management system:</p>

<pre data-type="programlisting">$ helm search repo content
NAME                    CHART VERSION   APP VERSION     DESCRIPTION
bitnami/drupal          7.0.0           9.0.0           One of the most versa...
bitnami/harbor          6.0.1           2.0.0           Harbor is an an open...
bitnami/joomla          7.1.18          3.9.19          PHP content managemen...
bitnami/mongodb         7.14.6          4.2.8           NoSQL document-orient...
bitnami/mongodb-sharded 1.4.2           4.2.8           NoSQL document-orient...</pre>

<p>While Drupal is the first result, note that there are a variety of other charts that contain the word <em>content</em> somewhere in the descriptive text.</p>

<p>By default, Helm tries to install the latest stable release of a chart, but you can override this behavior and install a specific verison of a chart. Thus it is often useful to see not just the summary info for a chart, but exactly which versions exist for a chart:</p>

<pre data-type="programlisting">$ helm search repo drupal --versions
NAME            CHART VERSION   APP VERSION     DESCRIPTION
bitnami/drupal  7.0.0           9.0.0           One of the most versatile op...
bitnami/drupal  6.2.22          8.9.0           One of the most versatile op...
bitnami/drupal  6.2.21          8.8.6           One of the most versatile op...
bitnami/drupal  6.2.20          8.8.5           One of the most versatile op...
bitnami/drupal  6.2.19          8.8.5           One of the most versatile op...
...</pre>

<p>There are several dozen versions of the Drupal chart. The preceding example has been truncated to just show the top few versions.</p>
<div data-type="tip"><h1>Chart and App Versions</h1>
<p>A <em>chart version</em> is the version of the Helm chart. The <em>app version</em> is the version<a data-type="indexterm" data-primary="versions of Helm" data-secondary="charts and" data-tertiary="chart version" id="idm46125999914280"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="chart version" id="idm46125999913000"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="chart version" id="idm46125999911784"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="app version" id="idm46125999910840"/><a data-type="indexterm" data-primary="app version" id="idm46125999909896"/><a data-type="indexterm" data-primary="charts" data-secondary="versions" data-tertiary="chart repositories" id="idm46125999909224"/> of the application packaged in the chart. Helm uses the chart version to make versioning decisions, such as which package is newest. As we can see in the preceding example, multiple chart versions may contain the same app version.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Installing a Package"><div class="sect1" id="idm46125999930840">
<h1>Installing a Package</h1>

<p>In the next chapter, we will dive deeply into the details of how package installation works in Helm. In this section, though, we will look at the basic mechanics of installing a Helm chart.<a data-type="indexterm" data-primary="getting started" data-secondary="installing a package" data-seealso="installation of charts" id="ch02-instpkg"/><a data-type="indexterm" data-primary="getting started" data-secondary="chart installation" data-seealso="installation of charts" id="ch02-instpkg2"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="installing a package" id="ch02-instpkg3"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="chart installation" id="ch02-instpkg4"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="basic mechanics of" id="idm46125999900440"/><a data-type="indexterm" data-primary="Drupal charts" data-secondary="installation of chart" id="idm46125999899224"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="basic mechanics of" id="idm46125999898280"/></p>

<p>At very minimum, installing a chart in Helm requires just two pieces of information: the name of the installation and the chart you want to install.</p>

<p>Recall that in the previous chapter we distinguished between an <em>installation</em> and a <em>chart</em>. This is an important distinction during installation and upgrading. In an operating system package manager, we may request that it install a piece of software. But it is extremely rare that we need to install the same exact package multiple times on an operating system. A Kubernetes cluster is different. It makes complete sense in Kubernetes to say “I want to install a MySQL database for Application A, and a second MySQL database for Application B.” Even if the two databases are exactly the same version and have the same configuration, in order to appropriately manage our applications, we may desire to have two instances running.</p>

<p>Therefore, Helm needs a way to distinguish between the different instances of the same chart. So an <em>installation</em> of a chart is a specific instance of the chart. One chart may have many installations. When we run the <code>helm install</code> command, we need to give it an installation name as well as the chart name. <a data-type="indexterm" data-primary="install command" id="idm46125999893288"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="helm install command" id="idm46125999892584"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="helm install command" id="idm46125999891640"/>So the most basic installation command looks something like this:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal
NAME: mysite
LAST DEPLOYED: Sun Jun 14 14:46:51 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
*******************************************************************
*** PLEASE BE PATIENT: Drupal may take a few minutes to install ***
*******************************************************************

1. Get the Drupal URL:

  You should be able to access your new Drupal installation through

  http://drupal.local/

2. Login with the following credentials

  echo Username: user
  echo Password: $(kubectl get secret --namespace default mysite-drupal...</pre>

<p>The preceding will create an instance of the <code>bitnami/drupal</code> chart, and will name this instance <code>mysite</code>.</p>

<p>As the install command runs, it will return a considerable amount of information, including user-facing instructions about getting started with Drupal.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In future examples of <code>helm install</code>, we will omit the returned output for the sake of brevity. However, when using Helm, you will see that output for each installation. In the next chapter, we will also see how to view that output again with the <code>helm get</code> command.</p>
</div>

<p>At this point, there is now an instance named <code>mysite</code> in the cluster. If we tried to rerun the preceding command, we wouldn’t get a second instance. Instead, we would get an error because the name <code>mysite</code> has already been used:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal
Error: cannot re-use a name that is still in use</pre>

<p>One further clarification is in order. In Helm 2, instance names were cluster-wide.<a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="chart instance names" id="idm46125999881992"/><a data-type="indexterm" data-primary="versions of Helm" data-secondary="charts and" data-tertiary="chart instance names" id="idm46125999880744"/><a data-type="indexterm" data-primary="names" data-secondary="chart instance name scope" id="idm46125999879528"/><a data-type="indexterm" data-primary="instance name scope" id="idm46125999878568"/><a data-type="indexterm" data-primary="scope" data-secondary="chart instance name" id="idm46125999877896"/><a data-type="indexterm" data-primary="releases" data-secondary="instance name scope" id="idm46125999876952"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="release instance name scope" id="idm46125999876008"/><a data-type="indexterm" data-primary="namespace (Kubernetes)" data-secondary="names unique within" data-tertiary="chart instance name scope" id="idm46125999875048"/> You could only have an instance named <code>mysite</code> once <em>per cluster</em>. In Helm 3, naming has been changed. Now instance names are scoped to Kubernetes namespaces. We could install two instances named <code>mysite</code> as long as they each lived in a different namespace.</p>

<p>For example, the following is perfectly legal in Helm 3, though it would have generated a fatal error in Helm 2:</p>

<pre data-type="programlisting">$ kubectl create ns first
$ kubectl create ns second
$ helm install --namespace first mysite bitnami/drupal
$ helm install --namespace second mysite bitnami/drupal</pre>

<p>This will install one Drupal site named <code>mysite</code> in the <code>first</code> namespace, and an identically configured instance named <code>mysite</code> in the <code>second</code> namespace. This might seem confusing at first, but it becomes clearer when we think about a namespace as a <em>prefix on a name</em>. In that sense, we have a site named “first mysite” and another named “second mysite.”</p>
<div data-type="tip"><h1>Using Namespace Flags Throughout Helm</h1>
<p>When working with namespaces and Helm, you can use the 
<span class="keep-together"><code>--namespace</code></span> or <code>-n</code> flags to specify the namespace you desire.<a data-type="indexterm" data-primary="Kubernetes" data-secondary="namespace" data-tertiary="Helm and namespace flags" id="idm46125999865336"/><a data-type="indexterm" data-primary="namespace (Kubernetes)" data-secondary="Helm and namespace flags" id="idm46125999864024"/><a data-type="indexterm" data-primary="resources" data-secondary="namespace" data-tertiary="Helm and namespace flags" id="idm46125999863064"/></p>
</div>








<section data-type="sect2" data-pdf-bookmark="Configuration at Installation Time"><div class="sect2" id="idm46125999861576">
<h2>Configuration at Installation Time</h2>

<p>In the preceding examples, we installed the same chart a few different ways. In all cases, they are identically configured.<a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="configuration at installation" id="idm46125999859768"/><a data-type="indexterm" data-primary="configuration" data-secondary="chart installation" id="idm46125999858456"/><a data-type="indexterm" data-primary="Drupal charts" data-secondary="installation of chart" data-tertiary="configuration at installation" id="idm46125999857512"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="configuration at installation" id="idm46125999856280"/><a data-type="indexterm" data-primary="install command" data-secondary="configuration at installation" id="idm46125999855320"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="helm install command" data-tertiary="configuration at installation" id="idm46125999854360"/> While the default configuration is good sometimes, more often we want to pass our own configuration to the chart.</p>

<p>Many charts will allow you to provide configuration values. If we take a look at the <a data-type="indexterm" data-primary="Artifact Hub" data-secondary="Drupal configuration parameters" id="idm46125999852488"/><a href="https://oreil.ly/baxxf">Artifact Hub page for Drupal</a>, we would see a long list of configurable parameters. For example, we can configure the username of the Drupal admin account by setting the <code>drupalUsername</code> value.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In the next chapter we will learn how to get this information using the <code>helm</code> command.</p>
</div>

<p>There are several ways of telling Helm which values you want to be configured. The best way is to create a YAML file with all of the configuration overrides. For example, we can create a file that sets values for <code>drupalUsername</code> and <code>drupalEmail</code>:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">drupalUsername</code><code class="p">:</code> <code class="l-Scalar-Plain">admin</code>
<code class="nt">drupalEmail</code><code class="p">:</code> <code class="l-Scalar-Plain">admin@example.com</code></pre>

<p>Now we have a file (conventionally named <em>values.yaml</em>) that has all of our configuration. Since it is in a file, it is easy to reproduce the same installation. You can also check this file into a version control system to track changes to your values over time. The Helm core maintainers consider it a good practice to keep your configuration values in a YAML file. It is important to keep in mind, though, that if a configuration file has sensitive information (like a password or authentication token), you should take steps to ensure that this information is not leaked.</p>

<p>Both <code>helm install</code> and <code>helm upgrade</code> provide a <code>--values</code> flag that points to a YAML file with value overrides:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal --values values.yaml
NAME: mysite
LAST DEPLOYED: Sun Jun 14 14:56:15 2020
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
*******************************************************************
*** PLEASE BE PATIENT: Drupal may take a few minutes to install ***
*******************************************************************

1. Get the Drupal URL:

  You should be able to access your new Drupal installation through

  http://drupal.local/

2. Login with the following credentials

  echo Username: admin
  echo Password: $(kubectl get secret --namespace default mysite-drupal -o js...</pre>

<p>Notice that in the preceding output the <code>Username</code> is now <code>admin</code> instead of <code>user</code>. One nice feature of Helm is that even the help text can be updated using values you 
<span class="keep-together">provide</span>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can specify the <code>--values</code> flag multiple times. Some people use this feature to have “common” overrides in one file and specific overrides in another.</p>
</div>

<p>There is a second flag that can be used to add individual parameters to an install or upgrade. The <code>--set</code> flag takes one or more values directly. They do not need to be stored in a YAML file:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal --set drupalUsername=admin</pre>

<p>This sets just one parameter, <code>drupalUsername</code>. This flag uses a simple <code>key=value</code> 
<span class="keep-together">format</span>.</p>

<p>Configuration parameters can be structured. That is, a configuration file may have multiple sections. The Drupal chart, for example, has configuration specific to the MariaDB database. These parameters are all grouped into a <code>mariadb</code> section. Building on our previous example, we could override the MariaDB database name like this:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">drupalUsername</code><code class="p">:</code> <code class="l-Scalar-Plain">admin</code>
<code class="nt">drupalEmail</code><code class="p">:</code> <code class="l-Scalar-Plain">admin@example.com</code>
<code class="nt">mariadb</code><code class="p">:</code>
  <code class="nt">db</code><code class="p">:</code>
    <code class="nt">name</code><code class="p">:</code> <code class="s">"my-database"</code></pre>

<p>Subsections are a little more complicated when using the <code>--set</code> flag. You will need to use a dotted notation: <code>--set mariadb.db.name=my-database</code>. This can get verbose when setting multiple values.</p>

<p>In general, Helm core maintainers suggest storing configuration in <em>values.yaml</em> files (note that the filename does not need to be “values”), only using <code>--set</code> when absolutely necessary. This way, you have easy access to the values you used during an operation (and can track those over time), while also keeping your Helm commands short. Working with files also means you do not have to escape as many characters as you do when setting things on the command line.<a data-type="indexterm" data-startref="ch02-instpkg" id="idm46125999785512"/><a data-type="indexterm" data-startref="ch02-instpkg2" id="idm46125999784840"/><a data-type="indexterm" data-startref="ch02-instpkg3" id="idm46125999784168"/><a data-type="indexterm" data-startref="ch02-instpkg4" id="idm46125999783496"/></p>

<p>Before moving on to upgrades, though, we will take a quick look at one of the most helpful Helm commands.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Listing Your Installations"><div class="sect1" id="idm46125999907176">
<h1>Listing Your Installations</h1>

<p>As we have seen so far, Helm can install many things into the same cluster—even multiple<a data-type="indexterm" data-primary="getting started" data-secondary="listing installations" id="idm46125999780872"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="chart installation" data-tertiary="listing installations" id="idm46125999779896"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="listing installations" id="idm46125999778712"/><a data-type="indexterm" data-primary="listing installations" id="idm46125999777496"/><a data-type="indexterm" data-primary="installation of helm client" data-secondary="installing a package" data-tertiary="listing installations" id="idm46125999776824"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="listing installations" id="idm46125999775640"/><a data-type="indexterm" data-primary="debugging and troubleshooting" data-secondary="listing installations" id="idm46125999774696"/> instances of the same chart. And with multiple users on your cluster, different people may be installing things into the same namespace on a cluster.</p>

<p>The <code>helm list</code> command is a simple tool to help you see installations and learn about those installations:</p>

<pre data-type="programlisting">$ helm list
NAME    NAMESPACE  REVISION  UPDATED       STATUS    CHART           APP VERSION
mysite  default    1         2020-06-14... deployed  drupal-7.0.0    9.0.0</pre>

<p>This command will provide you with lots of useful information, including the name and namespace of the release, the current revision number (discussed in <a data-type="xref" href="ch01.xhtml#introducing_helm">Chapter 1</a>, and in more depth in the next section), the last time it was updated, the installation status, and the versions of the chart and app.</p>

<p>Like other commands, <code>helm list</code> is namespace aware. By default, Helm <a data-type="indexterm" data-primary="namespace (Kubernetes)" data-secondary="listing installations" id="idm46125999769064"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="namespace" data-tertiary="listing installations" id="idm46125999768088"/>uses the namespace your Kubernetes configuration file sets as the default. Usually this is the namespace named <code>default</code>. Earlier, we installed a Drupal instance into the namespace <code>first</code>. We can see that with <code>helm list --namespace first</code>.</p>

<p>When listing all of your releases, one useful flag is the <code>--all-namespaces</code> flag,<a data-type="indexterm" data-primary="releases" data-secondary="listing installations" id="idm46125999764664"/> which will query all of the Kubernetes namespaces to which you have permission, and return all of the releases it finds:</p>

<pre data-type="programlisting">$ helm list --all-namespaces
NAME    NAMESPACE  REVISION  UPDATED        STATUS     CHART         APP VERSION
mysite  default    1         2020-06-14...  deployed   drupal-7.0.0  9.0.0
mysite  first      1         2020-06-14...  deployed   drupal-7.0.0  9.0.0
mysite  second     1         2020-06-14...  deployed   drupal-7.0.0  9.0.0</pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Upgrading an Installation"><div class="sect1" id="idm46125999744056">
<h1>Upgrading an Installation</h1>

<p>When we talk about upgrading in Helm, we talk about upgrading an installation, not a chart. <a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="upgrading an installation" id="idm46125999741704"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="upgrading an installation" id="idm46125999740488"/><a data-type="indexterm" data-primary="upgrades" data-secondary="installation upgrades" id="idm46125999739528"/><a data-type="indexterm" data-primary="configuration" data-secondary="chart installation upgrade" id="idm46125999738584"/>An <em>installation</em> is a particular instance of a chart in your cluster. When you run <code>helm install</code>, it creates the installation. To modify that installation, use <code>helm upgrade</code>.</p>

<p>This is an important distinction to make in the present context because upgrading an installation can consist of two different kinds of changes:</p>

<ul>
<li>
<p>You can upgrade the <em>version of the chart</em></p>
</li>
<li>
<p>You can upgrade the <em>configuration</em> of the installation</p>
</li>
</ul>

<p>The two are not mutually exclusive; you can do both at the same time. But this does introduce one new term that Helm users refer to when talking about their systems: <a data-type="indexterm" data-primary="releases" data-secondary="about" id="idm46125999732120"/><a data-type="indexterm" data-primary="releases" data-secondary="upgrading installations" id="idm46125999731144"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="upgrading and releases" id="idm46125999730200"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="upgrading an installation" data-tertiary="releases" id="idm46125999728984"/>a <em>release</em> is a particular combination of configuration and chart version for an 
<span class="keep-together">installation</span>.</p>

<p>When we first install a chart, we create the initial release of an installation. Let’s call this release 1. When we perform an upgrade, we are creating a new <em>release</em> of the same <em>installation</em>: release 2. When we upgrade again, we will create release 3. (In the next chapter, we’ll see how rollbacks also create releases.)</p>

<p>During an upgrade, then, we can create a release with new configuration, with a new chart version, or with both.</p>

<p>For example, say we install the Drupal chart with the <code>ingress</code> turned off.<a data-type="indexterm" data-primary="Drupal charts" data-secondary="upgrading installation" id="idm46125999723560"/><a data-type="indexterm" data-primary="ingress flag" id="idm46125999722552"/> (This will effectively prevent traffic from being routed from outside the cluster into the Drupal instance.)</p>

<p>Note that we are using the <code>--set</code> flag to keep examples compact, but would recommend using a <em>values.yaml</em> file in regular scenarios:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal --set ingress.enabled=false</pre>

<p>With <code>ingress</code> turned off, we can work on getting our site all set up to our liking. Then when we are ready, we can create a new release that enables the <code>ingress</code> feature:</p>

<pre data-type="programlisting">$ helm upgrade mysite bitnami/drupal --set ingress.enabled=true</pre>

<p>In this case, we are running an <code>upgrade</code> that will only change the configuration.</p>

<p>In the background, Helm will load the chart, generate all of the Kubernetes objects in that chart, and then see how those differ from the version of the chart that is already installed. It will only send Kubernetes the things that need to change. In other words, Helm will attempt to alter only the bare minimum.</p>

<p>The preceding example will only change the <code>ingress</code> configuration. Nothing changes with the database, or even with the web server running Drupal. For that reason, nothing will be restarted or deleted and re-created. This can occasionally confuse new Helm users, but it is by design. The Kubernetes philosophy is to make changes in the most streamlined way possible, and Helm seeks to follow this philosophy.</p>

<p>On occasion, you may want to force one of your services to restart. <a data-type="indexterm" data-primary="Service (Kubernetes)" data-secondary="restarting a service" id="idm46125999713960"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="kubectl" data-tertiary="restarting a service" id="idm46125999712904"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="Service" data-tertiary="restarting a service" id="idm46125999711688"/><a data-type="indexterm" data-primary="restarting a service with kubectl" id="idm46125999710472"/>This is not something you need to use Helm for. You can simply use <code>kubectl</code> itself to restart things. With an operating system’s package manager, you do not use the package manager to restart a program. Likewise, you don’t need to use Helm to restart your web server or database.</p>

<p>When a new version of a chart comes out, you may want to upgrade your existing installation to use the new chart version. For the most part, Helm tries to make this easy:</p>

<pre data-type="programlisting">$ helm repo update <a class="co" id="co_using_helm_CO1-1" href="#callout_using_helm_CO1-1"><img src="Images/1.png" alt="1"/></a>
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "bitnami" chart repository
Update Complete. ⎈ Happy Helming!⎈

$ helm upgrade mysite bitnami/drupal <a class="co" id="co_using_helm_CO1-2" href="#callout_using_helm_CO1-2"><img src="Images/2.png" alt="2"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_helm_CO1-1" href="#co_using_helm_CO1-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>Fetch the latest packages from chart repositories.</p></dd>
<dt><a class="co" id="callout_using_helm_CO1-2" href="#co_using_helm_CO1-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>Upgrade the <code>mysite</code> release to use the latest version of <code>bitnami/drupal</code>.</p></dd>
</dl>

<p>As you can see, the default policy of Helm is to attempt to use the latest version of a chart. If you would prefer to stay on a particular version of a chart, you can explicitly declare this:</p>

<pre data-type="programlisting">$ helm upgrade mysite bitnami/drupal --version 6.2.22</pre>

<p>In this case, even if a newer version is released, only <code>bitnaim/drupal</code> version <code>6.2.22</code> will be installed.</p>








<section data-type="sect2" data-pdf-bookmark="Configuration Values and Upgrades"><div class="sect2" id="idm46125999694504">
<h2>Configuration Values and Upgrades</h2>

<p>One of the most important things to learn about Helm installs and upgrades is that <a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="upgrading and configuration" id="idm46125999692728"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="upgrading an installation" data-tertiary="configuration fresh with release" id="idm46125999691416"/><a data-type="indexterm" data-primary="configuration" data-secondary="chart installation upgrade" data-tertiary="configuration fresh with release" id="idm46125999690168"/><a data-type="indexterm" data-primary="releases" data-secondary="upgrading installations" data-tertiary="configuration fresh with release" id="idm46125999688920"/>configuration gets applied freshly on each release. Here’s a quick illustration:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal --values values.yaml <a class="co" id="co_using_helm_CO2-1" href="#callout_using_helm_CO2-1"><img src="Images/1.png" alt="1"/></a>
$ helm upgrade mysite bitnami/drupal <a class="co" id="co_using_helm_CO2-2" href="#callout_using_helm_CO2-2"><img src="Images/2.png" alt="2"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_helm_CO2-1" href="#co_using_helm_CO2-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>Install using a configuration file.</p></dd>
<dt><a class="co" id="callout_using_helm_CO2-2" href="#co_using_helm_CO2-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>Upgrade without a configuration file.</p></dd>
</dl>

<p>What is the result of this pair of operations? The installation will use all of the <a data-type="indexterm" data-primary="charts" data-secondary="about" data-tertiary="values.yaml" id="idm46125999677272"/><a data-type="indexterm" data-primary="configuration" data-secondary="values.yaml file" id="idm46125999676024"/><a data-type="indexterm" data-primary="values.yaml file" data-secondary="upgrading an installation" id="idm46125999675080"/>configuration data supplied in <em>values.yaml</em>, but the upgrade will not. As a result, some settings could be changed back to their defaults. This is usually not what you want.</p>
<div data-type="tip"><h1>Inspecting Values</h1>
<p>In the next chapter we will look at the <code>helm get</code> command. You can use <code>helm get values mysite</code> to see what values were used on the last <code>helm install</code> or <code>helm upgrade</code> operation.</p>
</div>

<p>Helm core maintainers suggest that you provide consistent configuration<a data-type="indexterm" data-primary="install command" data-secondary="configuration at installation" id="idm46125999669752"/><a data-type="indexterm" data-primary="configuration" data-secondary="chart installation" id="idm46125999668632"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="configuration at installation" id="idm46125999667688"/> with each installation and upgrade. To apply the same configuration to both releases, supply the values on each operation:</p>

<pre data-type="programlisting">$ helm install mysite bitnami/drupal --values values.yaml <a class="co" id="co_using_helm_CO3-1" href="#callout_using_helm_CO3-1"><img src="Images/1.png" alt="1"/></a>
$ helm upgrade mysite bitnami/drupal --values values.yaml <a class="co" id="co_using_helm_CO3-2" href="#callout_using_helm_CO3-2"><img src="Images/2.png" alt="2"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_using_helm_CO3-1" href="#co_using_helm_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Install using a configuration file.</p></dd>
<dt><a class="co" id="callout_using_helm_CO3-2" href="#co_using_helm_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Upgrade using the same configuration file.</p></dd>
</dl>

<p>One of the reasons we suggest storing configuration in a <em>values.yaml</em> file is so that this pattern is easy to reproduce. Imagine how much more cumbersome these commands would be if you used <code>--set</code> to set three or four configuration parameters! For each release, you’d have to remember exactly which things to set.</p>

<p>While we strongly advise using the pattern discussed here, and specifying <code>--values</code> each time, there is an upgrade shortcut available that will just reuse the last set of values that you sent:</p>

<pre data-type="programlisting">$ helm upgrade mysite bitnami/drupal --reuse-values</pre>

<p>The <code>--reuse-values</code> flag will tell Helm to reload the server-side copy of the last set of values, and then use those to generate the upgrade. This method is okay if you are always <em>just</em> reusing the same values. However, the Helm maintainers strongly suggest not trying to mix <code>--reuse-values</code> with additional <code>--set</code> or <code>--values</code> options. Doing so can make troubleshooting complicated and can quickly lead to unmaintainable installations in which nobody is sure how certain configuration parameters were set. While Helm does retain some state information, it is not a configuration management tool. Users are advised to manage configuration using their own tools and explicitly pass that configuration to Helm in each invocation.</p>

<p>At this point, we’ve learned how to install, list, and upgrade installations. In the final section of this chapter, we will delete an installation.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Uninstalling an Installation"><div class="sect1" id="idm46125999743240">
<h1>Uninstalling an Installation</h1>

<p>To remove a Helm installation, use the <code>helm uninstall</code> command:<a data-type="indexterm" data-primary="installation of charts" data-secondary="uninstalling" id="ch02-chrt3"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="uninstalling" id="ch02-chrt"/><a data-type="indexterm" data-primary="charts" data-secondary="uninstalling" id="ch02-chrt2"/><a data-type="indexterm" data-primary="uninstalling charts" id="ch02-chrt4"/><a data-type="indexterm" data-primary="debugging and troubleshooting" data-secondary="listing installations" data-tertiary="uninstalling an installation" id="ch02-chrt5"/></p>

<pre data-type="programlisting">$ helm uninstall mysite</pre>

<p>Note that this command does not need a chart name (<code>bitnami/drupal</code>) or any configuration files. It simply needs the name of the installation. In this section, we will look at how deletion works and take a brief detour into a big change between Helm 2 and Helm 3.</p>

<p>Like <code>install</code>, <code>list</code>, and <code>upgrade</code>, you can supply a <code>--namespace</code> flag to specify that you want to delete an installation <em>from a specific namespace</em>:</p>

<pre data-type="programlisting">$ helm uninstall mysite --namespace first</pre>

<p>The preceding will delete the site we created in the <code>first</code> namespace earlier in this chapter. Note that there is no command to delete multiple applications. You must uninstall a <em>specific</em> installation.</p>

<p>Deletion can take time. Larger applications may take several minutes, or even longer, as Kubernetes cleans up all of the resources. During this time, you will not be able to reinstall using the same name.</p>








<section data-type="sect2" data-pdf-bookmark="How Helm Stores Release Information"><div class="sect2" id="idm46125999633784">
<h2>How Helm Stores Release Information</h2>

<p>One of the big changes in Helm 3 is how it deletes Helm’s own data about an installation.<a data-type="indexterm" data-primary="versions of Helm" data-secondary="release information storage" id="idm46125999631928"/><a data-type="indexterm" data-primary="releases" data-secondary="information in release records" id="idm46125999630888"/><a data-type="indexterm" data-primary="charts" data-secondary="installation of" data-tertiary="release information" id="idm46125999629928"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="release information storage" id="idm46125999628712"/><a data-type="indexterm" data-primary="installation of charts" data-secondary="release information" id="idm46125999627480"/><a data-type="indexterm" data-primary="information in release records" id="idm46125999626536"/> This section briefly describes how installations are tracked and then concludes by explaining how and why Helm changed between version 2 and version 3.</p>

<p>When we first install a chart with Helm (such as with <code>helm install mysite bitnami/drupal</code>), we create the Drupal application instance, and we also create a special record that contains release information. <a data-type="indexterm" data-primary="Secrets (Kubernetes)" data-secondary="release information storage" id="idm46125999624616"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="Secrets" data-tertiary="release information storage" id="idm46125999623608"/>By default, Helm stores these records as Kubernetes <code>Secret</code>s (though there are other supported storage backends).</p>

<p>We can see these records with <code>kubectl get secret</code>:<a data-type="indexterm" data-primary="Kubernetes" data-secondary="kubectl" data-tertiary="release information secrets" id="idm46125999620904"/></p>

<pre data-type="programlisting">$ kubectl get secret
NAME                           TYPE                                  DATA   AGE
default-token-vjhx2            kubernetes.io/service-account-token   3      58m
mysite-drupal                  Opaque                                1      13m
mysite-mariadb                 Opaque                                2      13m
sh.helm.release.v1.mysite.v1   helm.sh/release.v1                    1      13m
sh.helm.release.v1.mysite.v2   helm.sh/release.v1                    1      13m
sh.helm.release.v1.mysite.v3   helm.sh/release.v1                    1      7m53s
sh.helm.release.v1.mysite.v4   helm.sh/release.v1                    1      5m30s</pre>

<p>We can see multiple release records at the bottom, one for each revision. As you can see, we have created four revisions of <code>mysite</code> by running <code>install</code> and <code>upgrade</code> 
<span class="keep-together">operations</span>.</p>

<p>In the next chapter, we will see how these extended records can be used to roll back to previous revisions of an installation. But we point this out now to illustrate something about how <code>helm uninstall</code> works.</p>

<p>When we run the command <code>helm uninstall mysite</code>, it will load the latest release record for the <code>mysite</code> installation. From that record, it will assemble a list of objects that it should remove from Kubernetes. Then Helm will delete all of those things before returning and deleting the four release records:</p>

<pre data-type="programlisting">$ helm uninstall mysite
release "mysite" uninstalled</pre>

<p>The <code>helm list</code> command will no longer show <code>mysite</code>:</p>

<pre data-type="programlisting">$ helm list
NAME    NAMESPACE       REVISION        UPDATED STATUS  CHART   APP VERSION</pre>

<p>We now have no installations. And if we rerun the <code>kubectl get secrets</code> command, we will also see all records of <code>mysite</code> have been purged:</p>

<pre data-type="programlisting">$ kubectl get secrets
NAME                  TYPE                                  DATA   AGE
default-token-vjhx2   kubernetes.io/service-account-token   3      65m</pre>

<p>As we can see from this output, not only were the two <code>Secret</code>s created by the Drupal chart deleted, but the four release records were deleted as well.</p>

<p>In the next chapter, we will see the <code>helm rollback</code> command. The preceding explanation should give you some hints as to why, by default, you cannot roll back an uninstall. It is possible, though, to delete the application, but keep the release records:</p>

<pre data-type="programlisting">$ helm uninstall --keep-history</pre>

<p>In Helm 2, history was retained by default. In Helm 3, the default was changed to deleting history. Different organizations prefer different policies, but core maintainers found that when most people uninstalled, they expected all traces of the installation to be destroyed.<a data-type="indexterm" data-startref="ch02-chrt" id="idm46125999604360"/><a data-type="indexterm" data-startref="ch02-chrt2" id="idm46125999603656"/><a data-type="indexterm" data-startref="ch02-chrt3" id="idm46125999602984"/><a data-type="indexterm" data-startref="ch02-chrt4" id="idm46125999602312"/><a data-type="indexterm" data-startref="ch02-chrt5" id="idm46125999601640"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm46125999633160">
<h1>Conclusion</h1>

<p>In this chapter, we covered the basics of installing and then using Helm. After looking at popular methods of getting Helm installed and configured, we added a chart repository and learned how to search for charts. Then we installed, listed, upgraded, and finally uninstalled the <code>bitnami/drupal</code> chart.</p>

<p>Along the way, we picked up some important concepts. We learned about installations and releases. We took a first look at chart repositories, which will be covered at length in <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a>. And at the end of the chapter we learned a little about how Helm stores information about our installations.</p>

<p>In the next chapter, we will return to the <code>helm</code> command, learning about other things that the Helm tool can do.</p>
</div></section>







</div></section></div></body></html>