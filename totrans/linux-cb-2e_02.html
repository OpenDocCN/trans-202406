<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. Managing the GRUB Bootloader"><div class="chapter" id="managing-grub-bootloader">
<h1><span class="label">Chapter 2. </span>Managing the GRUB Bootloader</h1>


<p>The <em>bootloader</em> is <a data-type="indexterm" data-primary="bootloaders" data-seealso="GRUB" id="idm46466163526920"/><a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" id="idm46466163526072"/>the software that loads your operating system after
you power up your computer. The GRUB (GRand Unified Bootloader) bootloader is the
most commonly used bootloader on Linux.</p>

<p>GRUB supports a number of useful features: boot multiple operating systems on a
single PC, live configuration editing, themeable interface, and rescue modes. In
this chapter you will learn about all of these.</p>
<div data-type="note" epub:type="note" id="grubvgrub2"><h1>GRUB versus GRUB 2</h1>
<p>There are<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="legacy GRUB versus GRUB 2" id="idm46466163524216"/> two major GRUB releases, legacy GRUB and GRUB 2. GRUB 2 is version
1.99 and up. Legacy GRUB ended at version 0.97 in 2005. A lot of GRUB how-tos still
reference legacy GRUB and compare it with GRUB 2. In this chapter I’m not going
to talk about legacy GRUB. It’s been retired for a long time and has little relevance
to using GRUB 2, so this chapter will focus exclusively on GRUB 2.</p>

<p>Some Linux distros use plain GRUB naming, some use GRUB 2. For example, Ubuntu
has the <em>/boot/grub/</em> directory and <em>grub-mkconfig</em> command, and Fedora calls
them <em>/boot/grub2/</em> and <em>grub2-mkconfig</em>. Check your filepaths and names. In this
chapter I use the Ubuntu naming scheme, except in distro-specific examples.</p>
</div>

<p>Starting<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="booting, steps in" id="GRUB-bootstrap-steps"/><a data-type="indexterm" data-primary="booting" data-secondary="steps in" id="bootstrap-steps"/><a data-type="indexterm" data-primary="bootstrapping" data-see="booting" id="idm46466163518040"/> a computer hasn’t changed all that much since UNIVAC was first built, back
in the 1940s in the last millennium. Starting a computer is called <em>bootstrapping</em>,
a reference to “pulling yourself up by your own bootstraps,” which is impossible.
The difficulty with a programmable computer is it needs software instructions to
tell it what to do, but where will those instructions come from before the
operating system is loaded?</p>

<p>The solution for the modern x86_64 PC architecture is to store the initial startup
instructions on a chip on the motherboard and program the CPU with the address
of these instructions. You could say the CPU is hardwired to receive
the startup instructions. This address is the same on all x86_64 machines,
and that is why you can mix and match motherboards and CPUs. (This address is called
the <em>reset vector</em>, if <a data-type="indexterm" data-primary="reset vector" id="idm46466163512696"/>you feel like doing some research.)</p>

<p>This is a simplified description of how it all works:</p>

<p>The first stage is launched when the system is powered up. The CPU fetches
instructions from the<a data-type="indexterm" data-primary="BIOS/UEFI setup" data-secondary="steps in startup" id="idm46466163509816"/> BIOS/UEFI firmware, and then initializes CPU caches and system
memory. When the system memory is initialized, the Power On Self-Test (POST) runs,
testing the memory and testing connectivity with other hardware such as keyboard,
mouse, display, and disk drives. You have probably noticed the LEDs on your keyboard
and mouse lighting up and heard the noises from inside your computer’s case as your
disk drives are probed.</p>

<p>After the POST, the BIOS/UEFI firmware launches the second stage of startup and looks
for the boot files on your hard disk. The GRUB bootloader loads the necessary files to
launch your operating system and complete system startup.</p>

<p>When your<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="displaying" id="idm46466163510376"/><a data-type="indexterm" data-primary="boot screen" data-secondary="displaying" id="idm46466163502184"/><a data-type="indexterm" data-primary="displaying" data-secondary="boot screen" id="idm46466163504760"/> boot screen appears (<a data-type="xref" href="#fig-grub-2">Figure 2-1</a>), GRUB waits a configured amount of
time for your input, usually 5–10 seconds, then boots the default if you do
nothing. Navigate the
boot menu with your arrow keys. When you press any key, it stops the
countdown, and then you can explore your boot options at your leisure.</p>

<p>In <a data-type="xref" href="#fig-grub-2">Figure 2-1</a>, the first entry boots the system. The next two
entries open submenus with more boot options. When you are exploring submenus,
press the Esc key to get back to the main menu.</p>

<p>Some Linux distros, such as Fedora and Ubuntu, do not display the boot screen when
there is only one installed operating system. In this case, press the Shift key
at startup to see the boot screen. There is a configuration option to always
display the <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="booting, steps in" data-startref="GRUB-bootstrap-steps" id="idm46466163499144"/><a data-type="indexterm" data-primary="booting" data-secondary="steps in" data-startref="bootstrap-steps" id="idm46466163497928"/>boot screen.</p>

<p>You may wish<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="customizing" id="idm46466163501416"/><a data-type="indexterm" data-primary="boot screen" data-secondary="customizing" id="idm46466163500328"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" id="idm46466163496440"/> to customize the appearance and behavior of your GRUB menu by adjusting a few options in the GRUB configuration files.</p>

<p>If you prefer a graphical tool for customizing your GRUB menu,  try GRUB Customizer
(<a data-type="xref" href="#fig-grub-customizer">Figure 2-2</a>). This is available in most Linux distributions as the
<em>grub-customizer</em> package, except openSUSE, which has a GRUB module
(labeled Boot Loader) in the YaST system configuration utility.</p>

<figure><div id="fig-grub-2" class="figure">
<img src="Images/lcb2_0201.png" alt="openSUSE GRUB boot screen" width="637" height="473"/>
<h6><span class="label">Figure 2-1. </span>openSUSE GRUB boot screen</h6>
</div></figure>

<figure><div id="fig-grub-customizer" class="figure">
<img src="Images/lcb2_0202.png" alt="GRUB Customizer" width="690" height="502"/>
<h6><span class="label">Figure 2-2. </span>GRUB Customizer</h6>
</div></figure>






<section data-type="sect1" data-pdf-bookmark="2.1 Rebuilding Your GRUB Configuration File"><div class="sect1" id="rec-rebuild-grub">
<h1>2.1 Rebuilding Your GRUB Configuration File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466163487208">
<h2>Problem</h2>

<p>Whenever<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="rebuilding" id="GRUB-config-rebuild"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="rebuilding" id="config-GRUB-rebuild"/><a data-type="indexterm" data-primary="rebuilding GRUB configuration files" id="rebuild-GRUB-config"/> you change your GRUB configuration, you need to rebuild it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466163482152">
<h2>Solution</h2>

<p>The command to rebuild your GRUB configuration varies. On Fedora <a data-type="indexterm" data-primary="Fedora Linux" data-secondary="rebuilding GRUB configuration files" id="idm46466163151320"/><a data-type="indexterm" data-primary="openSUSE" data-secondary="rebuilding GRUB configuration files" id="idm46466163150472"/>and openSUSE,
use this command:</p>
<pre>$ <strong>sudo grub2-mkconfig -o /boot/grub2/grub.cfg</strong></pre>

<p>Some distros, such as Ubuntu, use:</p>
<pre>$ <strong>sudo grub-mkconfig -o /boot/grub/grub.cfg</strong></pre>

<p>Ubuntu Linux also has a script that runs <em>grub-mkconfig</em>, <em>update-grub</em>:</p>
<pre>$ <strong>sudo update-grub</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466163146248">
<h2>Discussion</h2>

<p>Some Linux distributions helpfully provide the correct command at the top of
<em>/etc/default/grub</em>.</p>

<p>Remember to always verify your correct filenames and paths when you edit your GRUB
configuration because they vary on the different Linuxes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466163144088">
<h2>See Also</h2>

<ul>
<li>
<p>Your motherboard documentation, to learn about your system’s BIOS/UEFI</p>
</li>
<li>
<p><a href="https://oreil.ly/szAiR">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has multiple single-purpose man pages; run <em>man -k grub</em> to see all of
them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.2 Unhiding a Hidden GRUB Menu"><div class="sect1" id="rec-unhide-menu">
<h1>2.2 Unhiding a Hidden GRUB Menu</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466163134760">
<h2>Problem</h2>

<p>Your<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="displaying" id="GRUB-bootscreen-display"/><a data-type="indexterm" data-primary="boot screen" data-secondary="displaying" id="bootscreen-display"/><a data-type="indexterm" data-primary="displaying" data-secondary="boot screen" id="display-bootscreen"/><a data-type="indexterm" data-primary="viewing" data-see="displaying" id="idm46466163130056"/> favorite Linux distribution hides the GRUB menu when you have only one
operating system installed on your computer, and you want it to appear every
time you boot up.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466163128360">
<h2>Solution</h2>

<p>Several Linux distros do this, including Ubuntu and Fedora. You can unhide your
GRUB menu temporarily by pressing and holding the Shift key at startup.</p>

<p>Edit <em>/etc/default/grub</em> to unhide it permanently with the following options:</p>
<pre>GRUB_TIMEOUT="10"
GRUB_TIMEOUT_STYLE=menu
</pre>

<p>If the lines <code>GRUB_HIDDEN_TIMEOUT=0</code> and <code>GRUB_HIDDEN_TIMEOUT_QUIET=true</code>
are in your file, comment them out.</p>

<p>After changing <em>/etc/default/grub</em>, rebuild your GRUB configuration
(<a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466163121960">
<h2>Discussion</h2>

<p><code>GRUB_HIDDEN_TIMEOUT=0</code> means do not display the GRUB menu, while

<span class="keep-together"><code>GRUB_HIDDEN_TIMEOUT_QUIET=true</code></span> means do not display the countdown timer.</p>

<p>If you install another operating system in a multiboot configuration, then the
GRUB menu should unhide <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="displaying" data-startref="GRUB-bootscreen-display" id="idm46466163116888"/><a data-type="indexterm" data-primary="boot screen" data-secondary="displaying" data-startref="bootscreen-display" id="idm46466163116120"/><a data-type="indexterm" data-primary="displaying" data-secondary="boot screen" data-startref="display-bootscreen" id="idm46466163115480"/>itself.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466163114184">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a></p>
</li>
<li>
<p><a href="https://oreil.ly/DqiwS">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has multiple single-purpose man pages; run <em>man -k grub</em> to see all of
them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.3 Booting to a Different Linux Kernel"><div class="sect1" id="idm46466163106952">
<h1>2.3 Booting to a Different Linux Kernel</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466163105752">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="booting" data-secondary="to older kernels" data-secondary-sortas="older kernels" id="boot-linux-older"/><a data-type="indexterm" data-primary="older kernels, booting to" id="older-kernel-boot"/> are wondering about the extra entries in your GRUB menu that reference specific
Linux kernel versions, like in <a data-type="xref" href="#fig-grub-15">Figure 2-3</a>. You want to know what they are for
and what to do with them.</p>

<figure><div id="fig-grub-15" class="figure">
<img src="Images/lcb2_0203.png" alt="GRUB kernel boot options" width="661" height="484"/>
<h6><span class="label">Figure 2-3. </span>GRUB kernel boot options</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466163098616">
<h2>Solution</h2>

<p>Over time, as you update your Linux system, older Linux kernels are retained and added to
your GRUB menu. This provides an easy way to boot to a known good older kernel if
something goes awry with a newer kernel. You don’t have to keep the older kernels and can remove them with your package manager.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466163092776">
<h2>Discussion</h2>

<p>In olden times kernel updates were a big deal, because they often meant bug fixes,
additional support for hardware, such as video, network, and audio interfaces, and
support for software features, such as proprietary file formats and new protocols. The
rate of change was rapid, and it was not unusual for a new kernel to not work correctly,
so keeping the option to boot to an older kernel was routine. These days such
troubles are less common, and kernel updates are generally <a data-type="indexterm" data-primary="Linux" data-secondary="booting" data-see="booting" id="idm46466163093352"/><a data-type="indexterm" data-primary="booting" data-secondary="to older kernels" data-secondary-sortas="older kernels" data-startref="boot-linux-older" id="idm46466163096216"/><a data-type="indexterm" data-primary="older kernels, booting to" data-startref="older-kernel-boot" id="idm46466163094824"/>undramatic.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466163093784">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/qxk2m">GNU GRUB Manual</a></p>
</li>
<li>
<p><a href="https://oreil.ly/l5xyK">The Linux Kernel Archives</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.4 Understanding GRUB Configuration Files"><div class="sect1" id="rec-grub-config-files">
<h1>2.4 Understanding GRUB Configuration Files</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466163085080">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="explained" id="GRUB-config-explain"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="explained" id="config-GRUB-explain"/>know that configuring GRUB is done a little differently than most programs,
and you want to know where the GRUB configuration files are and which ones you
use to manage GRUB.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466163081048">
<h2>Solution</h2>

<p>GRUB configuration files are in <em>/boot/grub/</em>, <em>/etc/default/grub</em>, and
<em>/etc/grub.d/</em>. The GRUB configuration is complex, with many scripts and
modules.</p>
<div data-type="tip"><h1>GRUB versus GRUB 2</h1>
<p>Remember, as discussed in the introduction to this chapter, some Linux distros use
plain GRUB naming, and some use GRUB2 in filenames and commands. In this chapter
I use plain GRUB naming, except in distro-specific examples.</p>
</div>

<p><em>/etc/default/grub</em> is <a data-type="indexterm" data-primary="/etc/default/grub" data-secondary="purpose of" id="idm46466163075464"/>for configuring the appearance of the GRUB menu you see
at startup,  such as hiding or showing the boot menu, applying themes and background
images, menu timeout, and kernel options.</p>

<p>The files in <em>/etc/grub.d/</em> support<a data-type="indexterm" data-primary="/etc/grub.d/" id="idm46466163071544"/> more complex configurations, and
<em>/boot/grub/</em> stores image and theme files for customizing the appearance of your
GRUB menu.</p>

<p>The main GRUB<a data-type="indexterm" data-primary="/boot/grub/" id="idm46466163073528"/> configuration file is <em>/boot/grub/grub.cfg</em>, which GRUB reads at
startup. You do not edit this file because it is built from <em>/etc/grub.d/</em> and
<em>/etc/default/grub</em>; every time you make configuration changes you must
rebuild the GRUB 
<span class="keep-together">configuration</span>.</p>

<p>The GRUB configuration is automatically rebuilt when you install any updates that
affect the boot process, such as installing newer kernels and removing older
kernels.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466163068232">
<h2>Discussion</h2>

<p>If you are interested in scripting, studying the GRUB files is an excellent
course in organizing large numbers of interdependent scripts.</p>

<p>The files in <em>/etc/grub.d/</em> are called <em>drop-in</em> files. Rather<a data-type="indexterm" data-primary="drop-in files" id="idm46466163066184"/> than dealing with
a giant single configuration file, each drop-in file contains a configuration
for a specific task. These files are numbered in the order that GRUB should
read them, with lower numbers indicating higher priority. The following example
is from Fedora 32:</p>
<pre>$ <strong>sudo ls -C1 /etc/grub.d/</strong>
00_header
01_users
08_fallback_counting
10_linux
10_reset_boot_success
12_menu_auto_hide
20_linux_xen
20_ppc_terminfo
30_os-prober
30_uefi-firmware
40_custom
41_custom
backup
README</pre>

<p>Each of these files is a script, and each must have the executable bit set. You can
disable any of them by clearing the executable bit, like <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="explained" data-startref="GRUB-config-explain" id="idm46466163059352"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="explained" data-startref="config-GRUB-explain" id="idm46466163061672"/>this:</p>
<pre>$ <strong>sudo chmod -x 20_linux_xen</strong></pre>

<p>Re-enable a script by adding the executable bit:</p>
<pre>$ <strong>sudo chmod +x 20_linux_xen</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466163067256">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/RWh6k">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has numerous man pages; run <em>man -k grub</em> to see all of them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
<li>
<p><a data-type="xref" href="ch06.xhtml#cha-files-directories">Chapter 6</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.5 Writing a Minimal GRUB Configuration File"><div class="sect1" id="idm46466163049560">
<h1>2.5 Writing a Minimal GRUB Configuration File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466163048552">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="writing" id="GRUB-config-write"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="writing" id="config-GRUB-write"/><a data-type="indexterm" data-primary="writing GRUB configuration files" id="write-GRUB-config"/> want to write the most minimal working GRUB configuration.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466163042952">
<h2>Solution</h2>

<p>This is <a data-type="indexterm" data-primary="/etc/default/grub" data-secondary="options" id="etc-default-grub-options"/>the most basic <em>/etc/default/grub</em> file, with only the necessary entries
to boot a Linux system and show the GRUB menu. The following example is for
openSUSE Leap 15.2:</p>
<pre># If you change this file, run 'grub2-mkconfig -o /boot/grub2/grub.cfg'
# afterwards to update /boot/grub2/grub.cfg.

GRUB_DEFAULT=0
GRUB_TIMEOUT=10
GRUB_TIMEOUT_STYLE=menu
</pre>

<p>Remember <a data-type="xref" href="#fig-grub-2">Figure 2-1</a>? <a data-type="xref" href="#fig-grub-16">Figure 2-4</a> is the same system, but with a minimal GRUB 
<span class="keep-together">configuration</span>.</p>

<figure><div id="fig-grub-16" class="figure">
<img src="Images/lcb2_0204.png" alt="Minimal GRUB menu" width="1250" height="577"/>
<h6><span class="label">Figure 2-4. </span>Minimal GRUB menu</h6>
</div></figure>

<p>There are more options you can try, such as different ways to set the default boot option, change
background images and themes, change the colors, and change the screen resolution.
See the Discussion to learn about these.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466163033816">
<h2>Discussion</h2>

<p>There are numerous options you can use in <em>/etc/default/grub</em>, and you can ignore
most of them. These are the options that I think are the most useful:</p>
<dl>
<dt><code>GRUB_DEFAULT=</code></dt>
<dd>
<div class="openblock">
<p>Sets the <a data-type="indexterm" data-primary="default boot entry, setting" id="idm46466163028088"/>default boot entry. The boot entries are counted from 0
in <em>grub.cfg</em>, but not numbered. How do you know what numbers each
boot option has? There is no obvious way to figure this out; you have to count your
boot options manually. Count the “menuentry” sections to figure out the
numbering. A menu entry looks like this:</p>

<pre data-type="programlisting" class="li-code-block">menuentry 'openSUSE Leap 15.2'  --class opensuse --class gnu-linux
  --class gnu --class os
menuentry_id_option 'gnulinux-simple-102a6fce-8985-4896-a5f9-e5980cb21fdb' {
        load_video
        set gfxpayload=keep
        insmod gzio
        [...]</pre>

<p>Or use the <em>awk</em> command to list them for you, like this example for Ubuntu 20.04:</p>
<pre class="li-code-block">$ <strong>sudo awk -F\' '/menuentry / {print i++,$2}' /boot/grub/grub.cfg</strong>
0 Ubuntu
1 Ubuntu, with Linux 5.8.0-53-generic
2 Ubuntu, with Linux 5.8.0-53-generic (recovery mode)
3 Ubuntu, with Linux 5.8.0-50-generic
4 Ubuntu, with Linux 5.8.0-50-generic (recovery mode)
5 UEFI Firmware Settings
</pre>

<p>You probably don’t want to use a recovery mode entry as the default, or a memory test,
though it doesn’t hurt anything if you do. UEFI Firmware Settings is a shortcut to your system’s BIOS/UEFI.</p>
</div>

</dd>
<dt><code>GRUB_TIMEOUT=10</code></dt>
<dd>
<p>Sets the number of seconds the GRUB menu waits before booting
the default, and <code>GRUB_TIMEOUT_STYLE=menu</code> displays the menu during the
countdown. <code>GRUB_TIMEOUT=0</code> boots immediately without displaying the menu, and
<code>GRUB_TIMEOUT=-1</code> disables automatic booting and waits for the user to select a boot
entry.</p>
</dd>
<dt><code>GRUB_DEFAULT=saved</code></dt>
<dd>
<p>Together with <code>GRUB_SAVEDEFAULT=true</code>, <code>GRUB_DEFAULT=saved</code> makes the last
menu entry that you booted the default for the next boot.</p>
</dd>
<dt><code>GRUB_CMDLINE_LINUX=</code></dt>
<dd>
<p>Adds Linux kernel options for all menu entries.</p>
</dd>
<dt><code>GRUB_CMDLINE_LINUX_DEFAULT=</code></dt>
<dd>
<div class="openblock">
<p>Passes kernel options only to the default menu
entries. <code>G⁠R⁠U⁠B⁠_⁠C⁠M⁠D⁠L⁠I⁠N⁠E⁠_⁠L⁠I⁠N​U⁠X⁠_⁠D⁠E⁠F⁠A⁠U⁠L⁠T⁠=⁠"⁠q⁠u⁠i⁠e⁠t⁠ ⁠s⁠p⁠l⁠a⁠s⁠h⁠"</code> is a common default option
that disables the verbose output at startup and displays a graphical splash
screen. <a data-type="xref" href="#fig-grub-17">Figure 2-5</a> shows what the verbose output looks like. If you have
<code>G⁠R⁠U⁠B⁠_⁠C⁠M⁠D⁠L⁠I⁠N⁠E⁠_⁠L⁠I⁠N⁠U⁠X⁠_⁠D⁠E⁠F​A⁠U⁠L⁠T⁠=⁠"⁠q⁠u⁠i⁠e⁠t⁠ ⁠s⁠p⁠l⁠a⁠s⁠h⁠"</code> configured, you can see this
output without changing your configuration by pressing the Esc key during startup.</p>
</div>

</dd>
<dt><code>GRUB_TERMINAL=gfxterm</code></dt>
<dd>
<p>Sets the your GRUB screen to a graphical mode that
supports colors and images. <code>GRUB_TERMINAL=console</code> disables graphical mode.</p>
</dd>
<dt><code>GRUB_GFXMODE=</code></dt>
<dd>
<div class="openblock">
<p>Sets the screen resolution for the graphical mode, for example,
<code>GRUB_GFXMODE=1024x768</code>. Run the <em>set pager=1</em> command, and then run <em>videoinfo</em>
from your GRUB command line to see your supported modes (<a data-type="xref" href="#fig-grub-18">Figure 2-6</a>).
<em>set pager=1</em> lets you use the arrow keys to page up and down long command output.
<code>GRUB_GFXMODE=auto</code>  calculates a reasonable default.</p>
</div>

</dd>
</dl>

<figure><div id="fig-grub-17" class="figure">
<img src="Images/lcb2_0205.png" alt="Startup messages" width="853" height="524"/>
<h6><span class="label">Figure 2-5. </span>Startup messages</h6>
</div></figure>

<figure class="width-90"><div id="fig-grub-18" class="figure">
<img src="Images/lcb2_0206.png" alt="Supported video modes" width="683" height="477"/>
<h6><span class="label">Figure 2-6. </span>Supported video modes</h6>
</div></figure>
<dl>
<dt><code>GRUB_BACKGROUND=</code></dt>
<dd>
<p>Sets a background image on the GRUB menu, using the image
of your choice (see <a data-type="xref" href="#rec-grub-menu-background">Recipe 2.6</a>).</p>
</dd>
<dt><code>GRUB_THEME=</code></dt>
<dd>
<p>Decorates your GRUB menu with a complete<a data-type="indexterm" data-primary="/etc/default/grub" data-secondary="options" data-startref="etc-default-grub-options" id="idm46466162993800"/><a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="writing" data-startref="GRUB-config-write" id="idm46466162992712"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="writing" data-startref="config-GRUB-write" id="idm46466162991384"/><a data-type="indexterm" data-primary="writing GRUB configuration files" data-startref="write-GRUB-config" id="idm46466162990136"/> theme
(see <a data-type="xref" href="#rec-theme-grub">Recipe 2.8</a>).</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466163007336">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="#rec-grub-menu-background">Recipe 2.6</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-theme-grub">Recipe 2.8</a></p>
</li>
<li>
<p><a href="https://oreil.ly/zIbDg">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has multiple single-purpose man pages; run <em>man -k grub</em> to see all of
them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.6 Setting a Custom Background for Your GRUB Menu"><div class="sect1" id="rec-grub-menu-background">
<h1>2.6 Setting a Custom Background for Your GRUB Menu</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162978664">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="background" id="GRUB-bootscreen-background"/><a data-type="indexterm" data-primary="boot screen" data-secondary="background, changing" id="bootscreen-background"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="background" id="custom-bootscreen-background"/><a data-type="indexterm" data-primary="backgrounds for boot screen, customizing" id="background-bootscreen-custom"/>don’t care for the appearance of your GRUB menu, and you want to pretty it
up.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162971464">
<h2>Solution</h2>

<p>You need an image in PNG, 8-bit JPG, or TFA format. It can be any size, and GRUB will
scale it to fit. In the following example, a photo of Duchess enjoying the
bookshelves graces our GRUB menu.</p>

<p>Copy your image to <em>/boot/grub/</em>, and add the full filepath of your image to
<em>/etc/default/grub</em>. The photo of Duchess is <em>/boot/grub/duchess-books.jpg</em>:</p>
<pre>GRUB_BACKGROUND="/boot/grub/duchess-books.jpg"</pre>

<p>If there is a <code>GRUB_THEME=</code> line, make sure it is commented out, then rebuild
your GRUB configuration (<a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a>).</p>

<p>You should see a line like “Found background: /boot/grub/duchess-books.jpg”
in the output of your rebuild command. If you do not see this, there is an error
in your configuration.</p>

<p>When it looks correct, rebuild, reboot, and enjoy your new GRUB menu background
(<a data-type="xref" href="#fig-grub-7">Figure 2-7</a>).</p>

<figure><div id="fig-grub-7" class="figure">
<img src="Images/lcb2_0207.png" alt="Duchess the literacy cat gracing the GRUB menu" width="700" height="439"/>
<h6><span class="label">Figure 2-7. </span>Duchess the literacy cat gracing the GRUB menu</h6>
</div></figure>

<p>The fonts in the example are barely readable, so jump ahead to
<a data-type="xref" href="#rec-change-font-color">Recipe 2.7</a> to learn how to change their colors.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162961960">
<h2>Discussion</h2>

<p>You may use any image on your system; it does not have to be in <em>/boot/grub/</em>.
Putting your image files in <em>/boot/grub/</em> keeps all your GRUB customizations in one place and makes them available to all installed Linux systems on a<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="background" data-startref="GRUB-bootscreen-background" id="idm46466162958248"/><a data-type="indexterm" data-primary="boot screen" data-secondary="background, changing" data-startref="bootscreen-background" id="idm46466162957128"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="background" data-startref="custom-bootscreen-background" id="idm46466162956488"/><a data-type="indexterm" data-primary="backgrounds for boot screen, customizing" data-startref="background-bootscreen-custom" id="idm46466162954008"/> multiboot
setup.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162951720">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/xv9AE">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has multiple single-purpose man pages; run <em>man -k grub</em> to see all of
them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.7 Changing Font Colors in the GRUB Menu"><div class="sect1" id="rec-change-font-color">
<h1>2.7 Changing Font Colors in the GRUB Menu</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162944920">
<h2>Problem</h2>

<p>Your <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="font colors" id="GRUB-bootscreen-fonts"/><a data-type="indexterm" data-primary="boot screen" data-secondary="font colors, changing" id="bootscreen-fonts-changing"/><a data-type="indexterm" data-primary="font colors for boot screen, changing" data-secondary-sortas="boot screen" id="font-color-bootscreen"/><a data-type="indexterm" data-primary="colors" data-secondary="for boot screen fonts, changing" data-secondary-sortas="boot screen fonts" id="color-bootscreen-font"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="font colors" id="custom-bootscreen-fonts"/>new background is lovely (<a data-type="xref" href="#fig-grub-7">Figure 2-7</a>), but your fonts are barely visible,
and you need to change the colors so you can read your GRUB menu.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162934376">
<h2>Solution</h2>

<p>This is fun because you can quickly preview colors from the GRUB command line.
Then, when you know what colors you want, edit <em>/etc/default/grub</em> and create
a new file in <em>/etc/grub.d/</em> to load your colors, then rebuild
<em>/boot/grub/grub/cfg</em>. Reboot to enjoy your background image with pretty
colored fonts.</p>

<p>Start up your computer, and when the GRUB menu appears, press C to open the GRUB
command line (<a data-type="xref" href="#fig-grub-9">Figure 2-8</a>).</p>

<figure><div id="fig-grub-9" class="figure">
<img src="Images/lcb2_0208.png" alt="The GRUB command line" width="700" height="211"/>
<h6><span class="label">Figure 2-8. </span>The GRUB command line</h6>
</div></figure>

<p>The following two commands set the colors in <a data-type="xref" href="#fig-grub-10">Figure 2-9</a>:</p>
<pre>grub&gt; <strong>menu_color_highlight=cyan/blue</strong>
grub&gt; <strong>menu_color_normal=yellow/black</strong></pre>

<figure><div id="fig-grub-10" class="figure">
<img src="Images/lcb2_0209.png" alt="Setting GRUB menu colors from the GRUB command line" width="642" height="426"/>
<h6><span class="label">Figure 2-9. </span>Setting GRUB menu colors from the GRUB command line</h6>
</div></figure>

<p>You may set and test each color pair one pair at a time. From the GRUB menu,
press C to open the GRUB command shell. Type your command (sorry, no copy-paste),
press Enter, then press Esc to return to the menu to see how it looks. You can
list your previous commands with the up and down arrow keys, and edit and reuse
them rather than retyping everything.</p>

<p>You must specify two colors in this order: foreground/background. All the colors
are solid, with<a data-type="indexterm" data-primary="colors" data-secondary="transparency" id="idm46466162921032"/><a data-type="indexterm" data-primary="transparency of colors" id="idm46466162920488"/> no transparency, with one exception: when you select <em>black</em> as
a background color it is transparent. That is why <code>menu_color_normal=</code> must have
black as the background color, when you have a background image. If you use any
other color, your image will be covered by the background color. The
<code>menu_color_highlight=</code> background color only applies to whatever line is
currently selected.</p>

<p>When you figure out your colors, make them permanent. Boot up and create a new
script in <em>/etc/grub.d/</em>. In the following example, it is called
<em>07_font_colors</em>. Copy this exactly:</p>
<pre>#!/bin/sh

        if [ "x${GRUB_BACKGROUND}" != "x" ] ; then
                if [ "x${GRUB_COLOR_NORMAL}" != "x" ] ; then
                echo "set color_normal=${GRUB_COLOR_NORMAL}"
                fi

                if [ "x${GRUB_COLOR_HIGHLIGHT}" != "x" ] ; then
                echo "set color_highlight=${GRUB_COLOR_HIGHLIGHT}"
                fi
        fi</pre>

<p>Then make it executable:</p>
<pre>$ <strong>sudo chown +x 07_font_colors</strong></pre>

<p>Now add these lines to your <em>/etc/default/grub</em> file, using your colors:</p>
<pre>export GRUB_COLOR_NORMAL="yellow/black"
export GRUB_COLOR_HIGHLIGHT="cyan/blue"</pre>

<p>Rebuild your GRUB configuration (<a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a>) and reboot to see if it
worked.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162936504">
<h2>Discussion</h2>

<p>See <a data-type="xref" href="#rec-grub-config-files">Recipe 2.4</a> to learn about the files in <em>/etc/grub.d/</em> and
why the filenames must start with numbers. In my experience it doesn’t matter
if your fonts script starts early or late, but if it doesn’t work for you, try
changing the priority. Make sure it is executable. The options are as follows:</p>

<ul class="pagebreak-before less_space">
<li>
<p><em>menu_color_highlight</em> controls the colors of the highlighted lines inside the
menu box.</p>
</li>
<li>
<p><em>menu_color_normal</em> controls the colors of the not-highlighted lines.</p>
</li>
</ul>

<p>Use these colors exactly as they are written in <a data-type="xref" href="#ch2-color-table">Table 2-1</a>, all lowercase and with this exact <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="font colors" data-startref="GRUB-bootscreen-fonts" id="idm46466162906520"/><a data-type="indexterm" data-primary="boot screen" data-secondary="font colors, changing" data-startref="bootscreen-fonts-changing" id="idm46466162903320"/><a data-type="indexterm" data-primary="font colors for boot screen, changing" data-secondary-sortas="boot screen" data-startref="font-color-bootscreen" id="idm46466162902232"/><a data-type="indexterm" data-primary="colors" data-secondary="for boot screen fonts, changing" data-secondary-sortas="boot screen fonts" data-startref="color-bootscreen-font" id="idm46466162901144"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="font colors" data-startref="custom-bootscreen-fonts" id="idm46466162899752"/>spelling.</p>
<table id="ch2-color-table" class="table-width-60 border">
<caption><span class="label">Table 2-1. </span>GRUB color options</caption>
<thead>
<tr>
  <th colspan="4">Color options</th>
</tr>
</thead>
<tbody>
<tr>
  <td>black</td> <td>dark-gray</td><td>light-green</td><td>magenta</td>
</tr>
<tr>
  <td>blue</td>  <td>green</td><td>light-gray</td>  <td>red</td>
</tr>
<tr>
  <td>brown</td> <td>light-cyan</td> <td>light-magenta</td> <td>white</td>
</tr>
<tr>
  <td>cyan</td>  <td>light-blue</td> <td>light-red</td>  <td>yellow</td>
</tr>
</tbody>
</table>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162885960">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/BZHWt">GNU GRUB Manual</a></p>
</li>
<li>
<p>GRUB has multiple single-purpose man pages; run <em>man -k grub</em> to see all of
them</p>
</li>
<li>
<p><em>info grub</em> or <em>info grub2</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-grub-config-files">Recipe 2.4</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.8 Applying a Theme to Your GRUB Menu"><div class="sect1" id="rec-theme-grub">
<h1>2.8 Applying a Theme to Your GRUB Menu</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162877528">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="themes" id="GRUB-bootscreen-theme"/><a data-type="indexterm" data-primary="boot screen" data-secondary="themes" id="bootscreen-theme"/><a data-type="indexterm" data-primary="themes for boot screen" id="theme-bootscreen"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="themes" id="custom-bootscreen-theme"/> like prettying up your GRUB menu, and you want to know if there are themes for
the GRUB menu and how to install them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162870232">
<h2>Solution</h2>

<p>You are in luck, for there are many themes for GRUB. Start by using your package
manager with the <strong><code>grep</code></strong> command to search for package names. This example is
for Ubuntu Linux:</p>
<pre>$ <strong>apt search theme | grep grub</strong></pre>

<p>Using <em>theme | grep grub</em> to filter your results will find all relevant packages,
like <em>grub-theme-breeze</em>, <em>grub2-themes-ubuntu-mate</em>, and
<em>grub-breeze-theme</em>. Install themes<a data-type="indexterm" data-primary="installing" data-secondary="themes" id="idm46466162865000"/> just as you would any package.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162863992">
<h2>Discussion</h2>

<p>Your new theme should be installed in <em>/boot/grub/themes</em>. Find your new theme,
for example  <em>/boot/grub/themes/ubuntu-mate</em>, and look for the <em>theme.txt</em> file.
Enter the full path in <em>/etc/default/grub</em>, like this example for the
<em>ubuntu-mate</em> theme:</p>
<pre>GRUB_THEME=/boot/grub/themes/ubuntu-mate/theme.txt</pre>

<p>Be sure to comment out any other configuration lines pertaining to appearance that you
may have, such as <code>GRUB_BACKGROUND=</code>, any custom font colors, and any other
themes. Then rebuild your GRUB configuration (<a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a>). You should
see a line like “Found theme: /boot/grub/themes/ubuntu-mate/theme.txt” in your
command output.</p>

<p>If all goes well, reboot and you will be rewarded with a screen like
<a data-type="xref" href="#fig-grub-mate-theme">Figure 2-10</a>.
If it does not display correctly, recheck your configuration and <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="themes" data-startref="GRUB-bootscreen-theme" id="idm46466162854984"/><a data-type="indexterm" data-primary="boot screen" data-secondary="themes" data-startref="bootscreen-theme" id="idm46466162853656"/><a data-type="indexterm" data-primary="themes for boot screen" data-startref="theme-bootscreen" id="idm46466162852568"/><a data-type="indexterm" data-primary="customizing" data-secondary="boot screen" data-tertiary="themes" data-startref="custom-bootscreen-theme" id="idm46466162851656"/>commands.</p>

<figure class="width-80"><div id="fig-grub-mate-theme" class="figure">
<img src="Images/lcb2_0210.png" alt="The Ubuntu MATE GRUB theme" width="700" height="522"/>
<h6><span class="label">Figure 2-10. </span>The Ubuntu MATE GRUB theme</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162863496">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/oLJtx">GNOME Themes</a></p>
</li>
<li>
<p><a href="https://oreil.ly/SLdkp">KDE Themes</a></p>
</li>
<li>
<p><a href="https://oreil.ly/LeIHu">GNU GRUB Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.9 Rescuing a Nonbooting System from the &#10;grub&gt; Prompt"><div class="sect1" id="idm46466162842296">
<h1>2.9 Rescuing a Nonbooting System from the 
<span class="keep-together">grub&gt; Prompt</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162840664">
<h2>Problem</h2>

<p>When <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="grub&gt; prompt" id="GRUB-bootscreen-prompt"/><a data-type="indexterm" data-primary="boot screen" data-secondary="grub&gt; prompt" id="bootscreen-prompt"/><a data-type="indexterm" data-primary="grub&gt; prompt" id="grub-prompt"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="nonbooting system" data-tertiary="grub&gt; prompt" id="troubleshoot-nonboot-prompt"/><a data-type="indexterm" data-primary="nonbooting system, troubleshooting" data-secondary="grub&gt; prompt" id="nonboot-troubleshoot-prompt"/>you start your system, it stops at a GRUB prompt, <code>grub&gt;</code>, and does not boot.
You need to know how to boot your system and then repair your configuration.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162833016">
<h2>Solution</h2>

<p>When the boot process stops at the  <code>grub&gt;</code> prompt (<a data-type="xref" href="#fig-grub-13">Figure 2-11</a>), this means it found

<span class="keep-together"><em>/boot/grub/</em></span> but cannot find the root filesystem.</p>

<figure><div id="fig-grub-13" class="figure">
<img src="Images/lcb2_0211.png" alt="The GRUB command shell" width="1225" height="186"/>
<h6><span class="label">Figure 2-11. </span>The GRUB command shell</h6>
</div></figure>

<p>You need to find the root filesystem, the Linux kernel, and its matching <em>initrd</em> file. When
you are in the GRUB command shell, the entire filesystem is open to you.</p>

<p>The first command you should run is to invoke the pager, so that you can page up and
down long output:</p>
<pre><strong>grub&gt; set pager=1</strong></pre>

<p>List your disks and partitions. GRUB has its own way of identifying hard disks
and partitions. It numbers disks from 0, partitions from 1, and labels all
hard disks as <em>hd</em>. On a running Linux system, hard disks are identified as
<em>/dev/sda</em>, <em>/dev/sdb</em>, and so on.</p>

<p>In the following example, GRUB lists two hard disks,  <em>hd0</em> and <em>hd1</em>, which
are the same as <em>/dev/sda</em> and <em>/dev/sdb</em>. <em>hd0,gpt5</em> is the same as
<em>/dev/sda5</em>, and <em>hd1,msdos1</em> is the same as <em>/dev/sdb1</em>:</p>
<pre><strong>grub&gt; ls</strong>
(hd,0) (hd0,gpt5) (hd0,gpt4) (hd0,gpt3) (hd0,gpt2) (hd0,gpt1)
(hd1) (hd1,msdos1)</pre>

<p>This output shows that <em>hd0</em> has a <em>gpt</em> partition table, and <em>hd1</em> has the old-fashioned
<em>msdos</em> partition table. It is not necessary to use the <em>gpt</em> and <em>msdos</em> labels
when you are listing partitions and files.</p>

<p>GRUB tells you the filesystem types, universally unique identifiers (UUIDs), and
other information on the partitions:</p>
<pre><strong>grub&gt; ls (hd0,3)</strong>
  Partition hd0,3: filesystem type ext* - Last modification time 2021-12-29
  01:17:58 Tuesday, UUID 5c44d8b2-e34a-4464-8fa8-222363cd1aff - Partition start
  at 526336KiB -
Total size 20444160KiB</pre>

<p>You need to find <em>/boot</em>. Suppose you remember that it is in the root
filesystem
on the second partition; start looking there. A forward slash following the
partition name means list all files and directories on the partition:</p>
<pre><strong>grub&gt; ls (hd0,2)/</strong>
bin   dev  home  lib64   media  opt   root  sbin  sys  usr
boot  etc  lib   lost+found  mnt    proc  run   srv   tmp  var</pre>

<p>All boot files are in the <em>/boot</em> directory:</p>
<pre><strong>grub&gt; ls (hd0,2)/boot</strong>
efi/ grub/ System.map-5.3.18-lp152.57-default config-5.3.18-lp152.57-default
initrd-5.3.18-lp152.57-default vmlinuz vmlinuz-5.3.18-lp152.57-default
sysctl.conf-5.3.18-lp152.57-default vmlinux-5.3.18-lp152.57-default.gz</pre>

<p>Everything you need to boot your system is there. Set the root filesystem partition, kernel, and initrd image:</p>
<pre><strong>grub&gt; set root=(hd0,2)</strong>
<strong>grub&gt; linux /boot/vmlinuz-5.3.18-lp152.57-default root=/dev/sda2</strong>
<strong>grub&gt; initrd /boot/initrd-5.3.18-lp152.57-default</strong>
<strong>grub&gt; boot</strong></pre>
<div data-type="tip"><h1>Tab Completion</h1>
<p>Just <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="tab completion" id="idm46466162803544"/><a data-type="indexterm" data-primary="tab completion in GRUB" id="idm46466162802696"/>like the Bash shell, the GRUB command shell supports tab completion. This
means you can start typing <em>/boot/vml</em>, for example, then press the Tab key to
autocomplete the line, or display a list of possibilities.</p>
</div>

<p>If there are multiple <em>vmlinuz</em> and <em>initrd</em> files, use the two with the newest
matching version numbers. If all the commands are correct, your system will boot
and you can fix your GRUB configuration (<a data-type="xref" href="#rec-grub-restore">Recipe 2.11</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162832072">
<h2>Discussion</h2>

<p>When <em>/boot</em> is in its own partition, you won’t see any other directories because it is
not in the root filesystem.</p>

<p><em>vmlinuz-5.3.18-lp152.57-default</em> is the compressed Linux kernel.</p>

<p><em>initrd-5.3.18-lp152.57-default</em> is the initial ramdisk, a temporary root filesystem
used only to start up your system.</p>

<p>Boot failures are caused by corrupted files; adding, removing, or moving hard disks;
installing or removing operating systems; or repartitioning. If you can’t get to 
<span class="keep-together">a GRUB</span>
prompt, see <a data-type="xref" href="Images/ch19.html#cha-rescue-recovery">Chapter 19</a> to learn how to rescue your system with

<span class="keep-together">SystemRescue</span>.</p>

<p>You can practice using the <code>grub&gt;</code> shell by pressing C when your GRUB menu appears.
This is safe because changes you make do not survive a <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="grub&gt; prompt" data-startref="GRUB-bootscreen-prompt" id="idm46466162792456"/><a data-type="indexterm" data-primary="boot screen" data-secondary="grub&gt; prompt" data-startref="bootscreen-prompt" id="idm46466162791384"/><a data-type="indexterm" data-primary="grub&gt; prompt" data-startref="grub-prompt" id="idm46466162790744"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="nonbooting system" data-tertiary="grub&gt; prompt" data-startref="troubleshoot-nonboot-prompt" id="idm46466162790232"/><a data-type="indexterm" data-primary="nonbooting system, troubleshooting" data-secondary="grub&gt; prompt" data-startref="nonboot-troubleshoot-prompt" id="idm46466162787304"/>reboot.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162785688">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/8SdwS">GNU GRUB Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.10 Rescuing a Nonbooting System from the grub rescue&gt; Prompt"><div class="sect1" id="idm46466162782056">
<h1>2.10 Rescuing a Nonbooting System from the grub rescue&gt; Prompt</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162781160">
<h2>Problem</h2>

<p>When<a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="grub rescue&gt; prompt" id="GRUB-bootscreen-rescue-prompt"/><a data-type="indexterm" data-primary="boot screen" data-secondary="grub rescue&gt; prompt" id="bootscreen-rescue-prompt"/><a data-type="indexterm" data-primary="grub rescue&gt; prompt" id="grub-rescue-prompt"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="nonbooting system" data-tertiary="grub rescue&gt; prompt" id="troubleshoot-nonboot-rescue-prompt"/><a data-type="indexterm" data-primary="nonbooting system, troubleshooting" data-secondary="grub rescue&gt; prompt" id="nonboot-troubleshoot-rescue-prompt"/> you start your system, it stops at a GRUB prompt,  <code>grub rescue&gt;</code>, and does not boot.
You need to know how to boot your system and then repair your configuration.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162773528">
<h2>Solution</h2>

<p>The <code>grub rescue&gt;</code> prompt (<a data-type="xref" href="#fig-grub-14">Figure 2-12</a>) is the rescue shell, which means GRUB
could not find  <em>/boot</em>. Not to worry, you can find it from the GRUB prompt, boot
your system, and then make a permanent fix.</p>

<figure><div id="fig-grub-14" class="figure">
<img src="Images/lcb2_0212.png" alt="The GRUB rescue shell" width="798" height="129"/>
<h6><span class="label">Figure 2-12. </span>The GRUB rescue shell</h6>
</div></figure>

<p>List your partitions:</p>
<pre><strong>grub rescue&gt; ls</strong>
(hd0) (hd0,gpt5) (hd0,gpt4) (hd0,gpt3) (hd0,gpt2) (hd0,gpt1)
(hd1) (hd1, msdos1)</pre>

<p>At this point there is no tab-completion or paging, so you have to type everything.</p>

<p class="pagebreak-before less_space">GRUB tells you the filesystem types, UUIDs, and other information on the partitions:</p>
<pre><strong>grub rescue&gt; ls (hd0,3)</strong>
    Partition hd0,3: filesystem type ext* - Last modification time 2021-12-29
    01:17:58
Tuesday, UUID 5c44d8b2-e34a-4464-8fa8-222363cd1aff - Partition start at
526336KiB -
Total size 20444160KiB</pre>

<p>If you don’t know which partition contains <em>/boot</em>, you will have to list the files
and directories in each one until you find it. You do not have to use the <em>gpt</em> and
<em>msdos</em> labels. A forward slash following the device name means list all files and
directories:</p>
<pre><strong>grub rescue&gt; ls (hd0,2)/</strong>
bin   dev  home  lib64   media  opt   root  sbin  sys  usr
boot  etc  lib   lost+found  mnt    proc  run   srv   tmp  var</pre>

<p>Hurrah, there it is in the root filesystem. List the files in <em>/boot</em>:</p>
<pre><strong>grub rescue&gt; ls (hd0,2)/boot</strong>
efi/ grub/ System.map-5.3.18-lp152.57-default config-5.3.18-lp152.57-default
initrd-5.3.18-lp152.57-default vmlinuz vmlinuz-5.3.18-lp152.57-default
sysctl.conf-5.3.18-lp152.57-default vmlinux-5.3.18-lp152.57-default.gz</pre>

<p>There are a few additional commands for <code>grub rescue&gt;</code>. You have to tell it where

<span class="keep-together"><em>/boot/grub</em></span> is, and then load the <em>normal</em> and <em>linux</em> kernel modules, which are in
<em>/boot/grub/i386-pc</em> (along with many other kernel modules that GRUB uses at startup).
<em>normal</em> changes the boot mode from rescue to normal, and <em>linux</em> starts the system
loader:</p>
<pre><strong>grub rescue&gt; set prefix=(hd0,2)/boot/grub
grub rescue&gt; set root=(hd0,2)
grub rescue&gt; insmod normal
grub rescue&gt; insmod linux</strong></pre>

<p>After loading <em>normal</em>  and <em>linux</em>, you have tab completion. You could also turn on
paging, <em>set pager=1</em>, to enable using the arrow keys to scroll to your previous
commands. Now tell GRUB where to find the <em>kernel</em> and <em>initrd</em> file:</p>
<pre><strong>grub&gt; linux /boot/vmlinuz-5.3.18-lp152.57-default root=/dev/sda2</strong>
<strong>grub&gt; initrd /boot/initrd-5.3.18-lp152.57-default</strong>
<strong>grub&gt; boot</strong></pre>

<p>If there are multiple <em>vmlinuz</em> and <em>initrd</em> files, use the two with the newest
matching version numbers. If all the commands are correct, your system will boot
and you can fix your GRUB configuration (<a data-type="xref" href="#rec-grub-restore">Recipe 2.11</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162773064">
<h2>Discussion</h2>

<p>When <em>/boot</em> is on its own partition, you won’t see any other directories because
it is in its own <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="boot screen" data-tertiary="grub rescue&gt; prompt" data-startref="GRUB-bootscreen-rescue-prompt" id="idm46466162743512"/><a data-type="indexterm" data-primary="boot screen" data-secondary="grub rescue&gt; prompt" data-startref="bootscreen-rescue-prompt" id="idm46466162742744"/><a data-type="indexterm" data-primary="grub rescue&gt; prompt" data-startref="grub-rescue-prompt" id="idm46466162742104"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="nonbooting system" data-tertiary="grub rescue&gt; prompt" data-startref="troubleshoot-nonboot-rescue-prompt" id="idm46466162741592"/><a data-type="indexterm" data-primary="nonbooting system, troubleshooting" data-secondary="grub rescue&gt; prompt" data-startref="nonboot-troubleshoot-rescue-prompt" id="idm46466162740536"/>filesystem.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162738552">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/6REHG">GNU GRUB Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="2.11 Reinstalling Your GRUB Configuration"><div class="sect1" id="rec-grub-restore">
<h1>2.11 Reinstalling Your GRUB Configuration</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162734312">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="GRUB (GRand Unified Bootloader)" data-secondary="configuration files" data-tertiary="reinstalling" id="idm46466162732760"/><a data-type="indexterm" data-primary="configuration files (GRUB)" data-secondary="reinstalling" id="idm46466162731672"/><a data-type="indexterm" data-primary="reinstalling GRUB configuration files" id="idm46466162730824"/>were able to boot your system from the GRUB prompt, and now you need to know how
to make a permanent repair.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162729784">
<h2>Solution</h2>

<p>Check your GRUB configuration carefully for errors. When it looks correct, rebuild
your GRUB configuration (<a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a>). Then you need to reinstall GRUB.
In the following example, it is reinstalled to <em>/dev/sda</em>:</p>
<pre>$ <strong>sudo grub-mkconfig -o /boot/grub/grub.cfg</strong>
$ <strong>sudo grub-install /dev/sda</strong></pre>
<div data-type="warning" epub:type="warning"><h1>Using the Correct Rebuild Command</h1>
<p>As discussed in <a data-type="xref" href="#rec-rebuild-grub">Recipe 2.1</a> and <a data-type="xref" href="#grubvgrub2">“GRUB versus GRUB 2”</a>, you must check your
filepaths to ensure you are using the correct rebuild command.</p>
</div>

<p>Be sure to install it to the correct disk, if you have more than one, and use
only the device name (for example, <em>/dev/sda</em> ) and not a partition (such as <em>/dev/sda1</em>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162720248">
<h2>Discussion</h2>

<p>Be sure to have good current backups. If your rescue efforts fail, try reinstalling
GRUB from SystemRescue (<a data-type="xref" href="ch19.xhtml#rec-repair-grub">Recipe 19.9</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162718136">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/zkwke">GNU GRUB Manual</a></p>
</li>
<li>
<p><a data-type="xref" href="Images/ch19.html#cha-rescue-recovery">Chapter 19</a></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>