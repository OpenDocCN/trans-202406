<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Selecting Data from Tables"><div class="chapter" id="nch-select"><h1><span class="label">Chapter 5. </span>Selecting Data from Tables</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820377385264"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="5.0 Introduction"><div class="sect1" id="nch-select-select-intro"><h1>5.0 Introduction</h1><p>This chapter focuses on using the <code>SELECT</code>
    statement to retrieve information from your database. You will find the
    chapter helpful if your SQL background is limited or to find out about the
    MySQL-specific extensions to <code>SELECT</code>
    syntax.</p><p>There are many ways to write <code>SELECT</code> statements; we’ll look at only a few.
    Consult the <em>MySQL Reference Manual</em> or a general MySQL
    text for more information about <code>SELECT</code>
    syntax and the functions and operators available to extract and manipulate
    data.</p><p>Many examples in this chapter use a table named <code>mail</code> that contains rows that track mail message
    traffic between users on a set of hosts. The following shows how that table was created:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">mail</code>
<code class="p">(</code>
  <code class="n">id</code>      <code class="nb">INT</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code> <code class="k">PRIMARY</code> <code class="k">KEY</code><code class="p">,</code>
  <code class="n">t</code>       <code class="n">DATETIME</code><code class="p">,</code>    <code class="o">#</code> <code class="k">when</code> <code class="n">message</code> <code class="n">was</code> <code class="n">sent</code>
  <code class="n">srcuser</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">8</code><code class="p">),</code>  <code class="o">#</code> <code class="n">sender</code> <code class="p">(</code><code class="k">source</code> <code class="k">user</code> <code class="k">and</code> <code class="k">host</code><code class="p">)</code>
  <code class="n">srchost</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">),</code>
  <code class="n">dstuser</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">8</code><code class="p">),</code>  <code class="o">#</code> <code class="n">recipient</code> <code class="p">(</code><code class="n">destination</code> <code class="k">user</code> <code class="k">and</code> <code class="k">host</code><code class="p">)</code>
  <code class="n">dsthost</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">),</code>
  <code class="k">size</code>    <code class="nb">BIGINT</code><code class="p">,</code>      <code class="o">#</code> <code class="n">message</code> <code class="k">size</code> <code class="k">in</code> <code class="n">bytes</code>
  <code class="k">INDEX</code> <code class="p">(</code><code class="n">t</code><code class="p">)</code>
<code class="p">);</code></pre><p>The <code>mail</code> table contents look like
    this:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, dstuser, dsthost, size FROM mail;</code></strong>
+---------------------+---------+---------+---------+---------+---------+
| t                   | srcuser | srchost | dstuser | dsthost | size    |
+---------------------+---------+---------+---------+---------+---------+
| 2014-05-11 10:15:08 | barb    | saturn  | tricia  | mars    |   58274 |
| 2014-05-12 12:48:13 | tricia  | mars    | gene    | venus   |  194925 |
| 2014-05-12 15:02:49 | phil    | mars    | phil    | saturn  |    1048 |
| 2014-05-12 18:59:18 | barb    | saturn  | tricia  | venus   |     271 |
| 2014-05-14 09:31:37 | gene    | venus   | barb    | mars    |    2291 |
| 2014-05-14 11:52:17 | phil    | mars    | tricia  | saturn  |    5781 |
| 2014-05-14 14:42:21 | barb    | venus   | barb    | venus   |   98151 |
| 2014-05-14 17:03:01 | tricia  | saturn  | phil    | venus   | 2394482 |
| 2014-05-15 07:17:48 | gene    | mars    | gene    | saturn  |    3824 |
| 2014-05-15 08:50:57 | phil    | venus   | phil    | venus   |     978 |
| 2014-05-15 10:25:52 | gene    | mars    | tricia  | saturn  |  998532 |
| 2014-05-15 17:35:31 | gene    | saturn  | gene    | mars    |    3856 |
| 2014-05-16 09:00:28 | gene    | venus   | barb    | mars    |     613 |
| 2014-05-16 23:04:19 | phil    | venus   | barb    | venus   |   10294 |
| 2014-05-19 12:49:23 | phil    | mars    | tricia  | saturn  |     873 |
| 2014-05-19 22:21:51 | gene    | saturn  | gene    | venus   |   23992 |
+---------------------+---------+---------+---------+---------+---------+</pre><p>To create and load the <code>mail</code>
    table, change location into the <em class="filename">tables</em> directory of the <code>recipes</code> distribution and run this
    command:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; mail.sql</code></strong></pre><p>This chapter also uses other tables from time to time. Some were
    used in previous chapters, whereas others are new. To create any of them,
    do so the same way as for the <code>mail</code>
    table, using the appropriate script in the <em class="filename">tables</em> directory. In addition, many of the
    other scripts and programs used in this chapter are located in the
    <em class="filename">select</em> directory. The files in that
    directory enable you to try the examples more easily.</p><p>Many of the statements shown here can be executed from within the
    <span class="command"><em>mysql</em></span> program, which is discussed in
    <a data-type="xref" href="ch01.xhtml#nch-mysql">Chapter 1</a>. A few examples involve issuing statements
    from within the context of a programming language. See <a data-type="xref" href="ch04.xhtml#nch-api">Chapter 4</a> for information on programming techniques.</p></div></section><section data-type="sect1" data-pdf-bookmark="5.1 Specifying Which Columns and Rows to Select"><div class="sect1" id="nch-select-select-cols-rows"><h1>5.1 Specifying Which Columns and Rows to Select</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820377254352"><h2>Problem</h2><p>You want to display specific columns and rows from a table.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820377253344"><h2>Solution</h2><p>To indicate which columns to display, name them in the output
      column list. To indicate which rows to display, use a <code>WHERE</code> clause that specifies conditions that rows must satisfy.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820377251888"><h2>Discussion</h2><p>The simplest way to display columns from a table is to use
      <code>SELECT</code> <code>*</code> <code>FROM</code>
      <em><code>tbl_name</code></em>. The <code>*</code> specifier is a shortcut that means <q>all
      columns</q>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, dstuser, dsthost, size FROM mail;</code></strong>
+---------------------+---------+---------+---------+---------+---------+
| t                   | srcuser | srchost | dstuser | dsthost | size    |
+---------------------+---------+---------+---------+---------+---------+
| 2014-05-11 10:15:08 | barb    | saturn  | tricia  | mars    |   58274 |
| 2014-05-12 12:48:13 | tricia  | mars    | gene    | venus   |  194925 |
| 2014-05-12 15:02:49 | phil    | mars    | phil    | saturn  |    1048 |
| 2014-05-12 18:59:18 | barb    | saturn  | tricia  | venus   |     271 |
…</pre><p>Using <code>*</code> is easy, but you cannot
      select only certain columns or control column display order. Naming
      columns explicitly enables you to select only the ones of interest, in
      any order. This query omits the recipient columns and displays the
      sender before the date and size:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT srcuser, srchost, t, size FROM mail;</code></strong>
+---------+---------+---------------------+---------+
| srcuser | srchost | t                   | size    |
+---------+---------+---------------------+---------+
| barb    | saturn  | 2014-05-11 10:15:08 |   58274 |
| tricia  | mars    | 2014-05-12 12:48:13 |  194925 |
| phil    | mars    | 2014-05-12 15:02:49 |    1048 |
| barb    | saturn  | 2014-05-12 18:59:18 |     271 |
…</pre><p>Unless you qualify or restrict a <code>SELECT</code> query in some way, it retrieves every
      row in your table. To be more precise, provide a <code>WHERE</code> clause that specifies one or more
      conditions that rows must satisfy.</p><p>Conditions can test for equality, inequality, or relative
      ordering. For some types of data, such as strings, you can use pattern
      matches. The following statements select columns from rows in the
      <code>mail</code> table containing <code>srchost</code> values that are exactly equal to the
      string <code>'venus'</code> or that begin with the
      letter <code>'s'</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost  FROM mail WHERE srchost = 'venus';</code></strong>
+---------------------+---------+---------+
| t                   | srcuser | srchost |
+---------------------+---------+---------+
| 2014-05-14 09:31:37 | gene    | venus   |
| 2014-05-14 14:42:21 | barb    | venus   |
| 2014-05-15 08:50:57 | phil    | venus   |
| 2014-05-16 09:00:28 | gene    | venus   |
| 2014-05-16 23:04:19 | phil    | venus   |
+---------------------+---------+---------+
mysql&gt; <strong><code>SELECT t, srcuser, srchost FROM mail WHERE srchost LIKE 's%';</code></strong>
+---------------------+---------+---------+
| t                   | srcuser | srchost |
+---------------------+---------+---------+
| 2014-05-11 10:15:08 | barb    | saturn  |
| 2014-05-12 18:59:18 | barb    | saturn  |
| 2014-05-14 17:03:01 | tricia  | saturn  |
| 2014-05-15 17:35:31 | gene    | saturn  |
| 2014-05-19 22:21:51 | gene    | saturn  |
+---------------------+---------+---------+</pre><p>The <code>LIKE</code> operator in the previous query performs a pattern match, where <code>%</code> acts as
      a wildcard that matches any string. <a data-type="xref" href="ch07.xhtml#nch-strings-strings-pat-sql">Recipe 7.10</a> discusses pattern matching
      further.</p><p>A <code>WHERE</code> clause can test
      multiple conditions and different conditions can test different columns.
      The following statement finds messages sent by <code>barb</code> to <code>tricia</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, dstuser, dsthost, size FROM mail</code></strong>
    -&gt; <strong><code>WHERE srcuser = 'barb' AND dstuser = 'tricia';</code></strong>
+---------------------+---------+---------+---------+---------+-------+
| t                   | srcuser | srchost | dstuser | dsthost | size  |
+---------------------+---------+---------+---------+---------+-------+
| 2014-05-11 10:15:08 | barb    | saturn  | tricia  | mars    | 58274 |
| 2014-05-12 18:59:18 | barb    | saturn  | tricia  | venus   |   271 |
+---------------------+---------+---------+---------+---------+-------+</pre><p>Output columns can be calculated by evaluating expressions. This
      query combines the <code>srcuser</code> and
      <code>srchost</code> columns using <code>CONCAT()</code> to produce composite values in email address format:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, CONCAT(srcuser,'@',srchost), size FROM mail;</code></strong>
+---------------------+-----------------------------+---------+
| t                   | CONCAT(srcuser,'@',srchost) | size    |
+---------------------+-----------------------------+---------+
| 2014-05-11 10:15:08 | barb@saturn                 |   58274 |
| 2014-05-12 12:48:13 | tricia@mars                 |  194925 |
| 2014-05-12 15:02:49 | phil@mars                   |    1048 |
| 2014-05-12 18:59:18 | barb@saturn                 |     271 |
…</pre><p>You’ll notice that the email address column label is the
      expression that calculates it. To provide a better label, use a column alias (see <a data-type="xref" href="#nch-select-select-column-alias">Recipe 5.2</a>).</p><p>
          As of MySQL 8.0.19 you can use statement <code>TABLE</code> to select all columns from the table. <code>TABLE</code> supports <code>ORDER BY</code> (see <a data-type="xref" href="#nch-select-select-sort">Recipe 5.3</a>) and <code>LIMIT</code> (see <a data-type="xref" href="#nch-select-select-limit-calc">Recipe 5.11</a>) clauses, but does not allow any other filtering of columns or rows.
          
          </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">TABLE</code><code> </code><code class="n">mail</code><code> </code><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="k">size</code><code> </code><code class="k">DESC</code><code> </code><code class="k">LIMIT</code><code> </code><code class="mi">3</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----+---------------------+---------+---------+---------+---------+---------+
</code><code class="o">|</code><code> </code><code class="n">id</code><code> </code><code class="o">|</code><code> </code><code class="n">t</code><code>                   </code><code class="o">|</code><code> </code><code class="n">srcuser</code><code> </code><code class="o">|</code><code> </code><code class="n">srchost</code><code> </code><code class="o">|</code><code> </code><code class="n">dstuser</code><code> </code><code class="o">|</code><code> </code><code class="n">dsthost</code><code> </code><code class="o">|</code><code> </code><code class="k">size</code><code>    </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----+---------------------+---------+---------+---------+---------+---------+
</code><code class="o">|</code><code>  </code><code class="mi">8</code><code> </code><code class="o">|</code><code> </code><code class="mi">2014</code><code class="o">-</code><code class="mi">05</code><code class="o">-</code><code class="mi">14</code><code> </code><code class="mi">17</code><code class="p">:</code><code class="mi">03</code><code class="p">:</code><code class="mi">01</code><code> </code><code class="o">|</code><code> </code><code class="n">tricia</code><code>  </code><code class="o">|</code><code> </code><code class="n">saturn</code><code>  </code><code class="o">|</code><code> </code><code class="n">phil</code><code>    </code><code class="o">|</code><code> </code><code class="n">venus</code><code>   </code><code class="o">|</code><code> </code><code class="mi">2394482</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="mi">11</code><code> </code><code class="o">|</code><code> </code><code class="mi">2014</code><code class="o">-</code><code class="mi">05</code><code class="o">-</code><code class="mi">15</code><code> </code><code class="mi">10</code><code class="p">:</code><code class="mi">25</code><code class="p">:</code><code class="mi">52</code><code> </code><code class="o">|</code><code> </code><code class="n">gene</code><code>    </code><code class="o">|</code><code> </code><code class="n">mars</code><code>    </code><code class="o">|</code><code> </code><code class="n">tricia</code><code>  </code><code class="o">|</code><code> </code><code class="n">saturn</code><code>  </code><code class="o">|</code><code>  </code><code class="mi">998532</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code>  </code><code class="mi">2</code><code> </code><code class="o">|</code><code> </code><code class="mi">2014</code><code class="o">-</code><code class="mi">05</code><code class="o">-</code><code class="mi">12</code><code> </code><code class="mi">12</code><code class="p">:</code><code class="mi">48</code><code class="p">:</code><code class="mi">13</code><code> </code><code class="o">|</code><code> </code><code class="n">tricia</code><code>  </code><code class="o">|</code><code> </code><code class="n">mars</code><code>    </code><code class="o">|</code><code> </code><code class="n">gene</code><code>    </code><code class="o">|</code><code> </code><code class="n">venus</code><code>   </code><code class="o">|</code><code>  </code><code class="mi">194925</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----+---------------------+---------+---------+---------+---------+---------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.2 Naming Query Result Columns"><div class="sect1" id="nch-select-select-column-alias"><h1>5.2 Naming Query Result Columns</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820377026464"><h2>Problem</h2><p>The column names in a query result are unsuitable, ugly, or difficult to
      work with, so you want to name them yourself.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820377025584"><h2>Solution</h2><p>Use aliases to choose your own column names.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820377023472"><h2>Discussion</h2><p>When you retrieve a result set, MySQL gives every output column a
      name. (That’s how the <span class="command"><em>mysql</em></span> program
      gets the names you see displayed in the initial row of column headers in
      result set output.) By default, MySQL assigns the column names specified
      in the <code>CREATE</code> <code>TABLE</code> or <code>ALTER</code> <code>TABLE</code>
      statement to output columns, but if these defaults are not suitable, you
      can use column aliases to specify your own names.</p><p>This recipe explains aliases and shows how to use them to assign
      column names in statements. If you’re writing a program that must
      determine the names, see <a data-type="xref" href="ch12.xhtml#nch-meta-meta-result">Recipe 12.2</a> for
      information about accessing column metadata.</p><p>If an output column comes directly from a table, MySQL uses the
      table column name for the output column name. The following statement
      selects four table columns, the names of which become the corresponding
      output column names:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, size FROM mail;</code></strong>
+---------------------+---------+---------+---------+
| t                   | srcuser | srchost | size    |
+---------------------+---------+---------+---------+
| 2014-05-11 10:15:08 | barb    | saturn  |   58274 |
| 2014-05-12 12:48:13 | tricia  | mars    |  194925 |
| 2014-05-12 15:02:49 | phil    | mars    |    1048 |
| 2014-05-12 18:59:18 | barb    | saturn  |     271 |
…</pre><p>If you generate a column by evaluating an expression, the
      expression itself is the column name. This can produce long and unwieldy
      names in result sets, as illustrated by the following statement that
      uses one expression to reformat the dates in the <code>t</code> column, and another to combine <code>srcuser</code> and <code>srchost</code> into email address format:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>DATE_FORMAT(t,'%M %e, %Y'), CONCAT(srcuser,'@',srchost), size</code></strong>
    -&gt; <strong><code>FROM mail;</code></strong>
+----------------------------+-----------------------------+---------+
| DATE_FORMAT(t,'%M %e, %Y') | CONCAT(srcuser,'@',srchost) | size    |
+----------------------------+-----------------------------+---------+
| May 11, 2014               | barb@saturn                 |   58274 |
| May 12, 2014               | tricia@mars                 |  194925 |
| May 12, 2014               | phil@mars                   |    1048 |
| May 12, 2014               | barb@saturn                 |     271 |
…</pre><p>To choose your own output column name, use an <code>AS</code> <em><code>name</code></em> clause to
      specify a column alias (the keyword <code>AS</code> is
      optional). The following statement retrieves the same result as the
      previous one, but renames the first column to <code>date_sent</code> and the second to <code>sender</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>DATE_FORMAT(t,'%M %e, %Y') AS date_sent,</code></strong>
    -&gt; <strong><code>CONCAT(srcuser,'@',srchost) AS sender,</code></strong>
    -&gt; <strong><code>size FROM mail;</code></strong>
+--------------+---------------+---------+
| date_sent    | sender        | size    |
+--------------+---------------+---------+
| May 11, 2014 | barb@saturn   |   58274 |
| May 12, 2014 | tricia@mars   |  194925 |
| May 12, 2014 | phil@mars     |    1048 |
| May 12, 2014 | barb@saturn   |     271 |
…</pre><p>The aliases make the column names more concise, easier to read,
      and more meaningful. Aliases are subject to a few restrictions. For
      example, they must be quoted if they are SQL keywords, entirely numeric,
      or contain spaces or other special characters (an alias can consist of
      several words if you want to use a descriptive phrase). The following
      statement retrieves the same data values as the preceding one but uses
      phrases to name the output columns:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>DATE_FORMAT(t,'%M %e, %Y') AS 'Date of message',</code></strong>
    -&gt; <strong><code>CONCAT(srcuser,'@',srchost) AS 'Message sender',</code></strong>
    -&gt; <strong><code>size AS 'Number of bytes' FROM mail;</code></strong>
+-----------------+----------------+-----------------+
| Date of message | Message sender | Number of bytes |
+-----------------+----------------+-----------------+
| May 11, 2014    | barb@saturn    |           58274 |
| May 12, 2014    | tricia@mars    |          194925 |
| May 12, 2014    | phil@mars      |            1048 |
| May 12, 2014    | barb@saturn    |             271 |
…</pre><p>If MySQL complains about a single-word alias, the word probably is
      reserved. Quoting the alias should make it legal:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT 1 AS INTEGER;</code></strong>
You have an error in your SQL syntax near 'INTEGER'
mysql&gt; <strong><code>SELECT 1 AS 'INTEGER';</code></strong>
+---------+
| INTEGER |
+---------+
|       1 |
+---------+</pre><p>Column aliases also are useful for programming purposes. If you
      write a program that fetches rows into an array and accesses them by
      numeric column indexes, the presence or absence of column aliases makes
      no difference because aliases don’t change the positions of columns
      within the result set. However, aliases make a big difference if you
      access output columns by name because aliases change those names.
      Exploit this fact to give your program easier names to work with. For
      example, if your query displays reformatted message time values from the
      <code>mail</code> table using the expression
      <code>DATE_FORMAT(t,'%M %e, %Y')</code>, that
      expression is also the name you must use when referring to the output
      column. In a Perl hashref, for example, you’d access it as <code>$ref-&gt;{"DATE_FORMAT(t,'%M %e, %Y')"}</code>.
      That’s inconvenient. Use <code>AS</code> <code>date_sent</code> to give the column an alias and you
      can refer to it more easily as <code>$ref-&gt;{date_sent}</code>. Here’s an example that
      shows how a Perl DBI script might process such values. It retrieves rows
      into a hash and refers to column values by name:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT srcuser,</code>
<code class="s">                       DATE_FORMAT(t,'%M %e, %Y') AS date_sent</code>
<code class="s">                       FROM mail"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_hashref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="nb">printf</code> <code class="s">"user: %s, date sent: %s\n"</code><code class="p">,</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">srcuser</code><code class="p">},</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">date_sent</code><code class="p">};</code>
<code class="p">}</code></pre><p>In Java, you’d do something like this, where the argument to <code>getString()</code>
      names the column to access:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code> <code class="o">(</code><code class="s">"SELECT srcuser,"</code>
                <code class="o">+</code> <code class="s">" DATE_FORMAT(t,'%M %e, %Y') AS date_sent"</code>
                <code class="o">+</code> <code class="s">" FROM mail"</code><code class="o">);</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSet</code> <code class="o">();</code>
<code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code>  <code class="c1">// loop through rows of result set</code>
<code class="o">{</code>
  <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code> <code class="o">(</code><code class="s">"srcuser"</code><code class="o">);</code>
  <code class="n">String</code> <code class="n">dateSent</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code> <code class="o">(</code><code class="s">"date_sent"</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"user: "</code> <code class="o">+</code> <code class="n">name</code> <code class="o">+</code> <code class="s">", date sent: "</code> <code class="o">+</code> <code class="n">dateSent</code><code class="o">);</code>
<code class="o">}</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code></pre><p><a data-type="xref" href="ch04.xhtml#nch-api-api-statement">Recipe 4.4</a> shows for each of our
      programming languages how to fetch rows into data structures that permit
      access to column values by name. The <em class="filename">select</em> directory of the <code>recipes</code> distribution has examples that show
      how to do this for the <code>mail</code>
      table.</p><p>You cannot refer to column aliases in a <code>WHERE</code>
      clause. Thus, the following statement is illegal:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, dstuser, size/1024 AS kilobytes</code></strong>
    -&gt; <strong><code>FROM mail WHERE kilobytes &gt; 500;</code></strong>
ERROR 1054 (42S22): Unknown column 'kilobytes' in 'where clause'</pre><p>The error occurs because an alias names an
      <em>output</em> column, whereas a <code>WHERE</code> clause operates on
      <em>input</em> columns to determine which rows to select for
      output. To make the statement legal, replace the alias in the <code>WHERE</code> clause with the same column or
      expression that the alias represents:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, dstuser, size/1024 AS kilobytes</code></strong>
    -&gt; <strong><code>FROM mail WHERE size/1024 &gt; 500;</code></strong>
+---------------------+---------+---------+-----------+
| t                   | srcuser | dstuser | kilobytes |
+---------------------+---------+---------+-----------+
| 2014-05-14 17:03:01 | tricia  | phil    | 2338.3613 |
| 2014-05-15 10:25:52 | gene    | tricia  |  975.1289 |
+---------------------+---------+---------+-----------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.3 Sorting Query Results"><div class="sect1" id="nch-select-select-sort"><h1>5.3 Sorting Query Results</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376814192"><h2>Problem</h2><p>You want to control how your query results are sorted.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376813248"><h2>Solution</h2><p>MUse an <code>ORDER</code>
      <code>BY</code> clause to tell it how to sort
      result rows.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376811344"><h2>Discussion</h2><p>When you select rows, the MySQL server is free to return them in
      any order unless you instruct it otherwise by saying how to sort the
      result. There are lots of ways to use sorting techniques, as <a data-type="xref" href="ch09.xhtml#nch-sort">Chapter 9</a> explores in detail. Briefly, to sort a result set,
      add an <code>ORDER</code> <code>BY</code> clause that names the column or columns to
      use for sorting. This statement names multiple columns in the <code>ORDER</code> <code>BY</code>
      clause to sort rows by host and by user within each host:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, dstuser, dsthost, size</code></strong>
    -&gt; <strong><code>FROM mail WHERE dstuser = 'tricia'</code></strong>
    -&gt; <strong><code>ORDER BY srchost, srcuser;</code></strong>
+---------------------+---------+---------+---------+---------+--------+
| t                   | srcuser | srchost | dstuser | dsthost | size   |
+---------------------+---------+---------+---------+---------+--------+
| 2014-05-15 10:25:52 | gene    | mars    | tricia  | saturn  | 998532 |
| 2014-05-14 11:52:17 | phil    | mars    | tricia  | saturn  |   5781 |
| 2014-05-19 12:49:23 | phil    | mars    | tricia  | saturn  |    873 |
| 2014-05-11 10:15:08 | barb    | saturn  | tricia  | mars    |  58274 |
| 2014-05-12 18:59:18 | barb    | saturn  | tricia  | venus   |    271 |
+---------------------+---------+---------+---------+---------+--------+</pre><p>MySQL sorts rows in the ascending order by default. To sort a column in reverse (descending) order, add the keyword <code>DESC</code> after its
      name in the <code>ORDER</code> <code>BY</code> clause:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT t, srcuser, srchost, dstuser, dsthost, size</code></strong>
    -&gt; <strong><code>FROM mail WHERE size &gt; 50000 ORDER BY size DESC;</code></strong>
+---------------------+---------+---------+---------+---------+---------+
| t                   | srcuser | srchost | dstuser | dsthost | size    |
+---------------------+---------+---------+---------+---------+---------+
| 2014-05-14 17:03:01 | tricia  | saturn  | phil    | venus   | 2394482 |
| 2014-05-15 10:25:52 | gene    | mars    | tricia  | saturn  |  998532 |
| 2014-05-12 12:48:13 | tricia  | mars    | gene    | venus   |  194925 |
| 2014-05-14 14:42:21 | barb    | venus   | barb    | venus   |   98151 |
| 2014-05-11 10:15:08 | barb    | saturn  | tricia  | mars    |   58274 |
+---------------------+---------+---------+---------+---------+---------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.4 Removing Duplicate Rows"><div class="sect1" id="nch-select-select-nodup"><h1>5.4 Removing Duplicate Rows</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376800928"><h2>Problem</h2><p>Output from a query contains duplicate rows. You want to eliminate them.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376799952"><h2>Solution</h2><p>Use <code>DISTINCT</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376798560"><h2>Discussion</h2><p>Some queries produce results containing duplicate rows. For example, to
      see who sent mail, query the <code>mail</code>
      table like this:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT srcuser FROM mail;</code></strong>
+---------+
| srcuser |
+---------+
| barb    |
| tricia  |
| phil    |
| barb    |
| gene    |
| phil    |
| barb    |
| tricia  |
| gene    |
| phil    |
| gene    |
| gene    |
| gene    |
| phil    |
| phil    |
| gene    |
+---------+</pre><p>That result is heavily redundant. To remove the duplicate rows and
      produce a set of unique values, add <code>DISTINCT</code> to the query:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT DISTINCT srcuser FROM mail;</code></strong>
+---------+
| srcuser |
+---------+
| barb    |
| tricia  |
| phil    |
| gene    |
+---------+</pre><p>To count the number of unique values in a column, use <code>COUNT(DISTINCT)</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(DISTINCT srcuser) FROM mail;</code></strong>
+-------------------------+
| COUNT(DISTINCT srcuser) |
+-------------------------+
|                       4 |
+-------------------------+</pre><p><code>DISTINCT</code> works with
      multiple-column output, too. The following query shows which dates are
      represented in the <code>mail</code> table:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT DISTINCT YEAR(t), MONTH(t), DAYOFMONTH(t) FROM mail;</code></strong>
+---------+----------+---------------+
| YEAR(t) | MONTH(t) | DAYOFMONTH(t) |
+---------+----------+---------------+
|    2014 |        5 |            11 |
|    2014 |        5 |            12 |
|    2014 |        5 |            14 |
|    2014 |        5 |            15 |
|    2014 |        5 |            16 |
|    2014 |        5 |            19 |
+---------+----------+---------------+</pre></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820376789600"><h2>See Also</h2><p><a data-type="xref" href="ch10.xhtml#nch-sum">Chapter 10</a> revisits <code>DISTINCT</code> and <code>COUNT(DISTINCT)</code>. <a data-type="xref" href="ch18.xhtml#nch-dups">Chapter 18</a>
      discusses duplicate removal in more detail.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.5 Working with NULL Values"><div class="sect1" id="nch-select-select-null"><h1>5.5 Working with NULL Values</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376785040"><h2>Problem</h2><p>You’re trying to to compare column values to <code>NULL</code>, but it isn’t working.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376783536"><h2>Solution</h2><p>Use the proper comparison operators: <code>IS</code> <code>NULL</code>, <code>IS</code>
      <code>NOT</code> <code>NULL</code>, or <code>&lt;=&gt;</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376782544"><h2>Discussion</h2><p>Conditions that involve <code>NULL</code>
      are special because <code>NULL</code> means
      <q>unknown value.</q> Consequently, comparisons such as
      <em><code>value</code></em> <code>=</code>
      <code>NULL</code> or
      <em><code>value</code></em> <code>&lt;&gt;</code> <code>NULL</code> always produce a result of <code>NULL</code> (not true or false) because it’s
      impossible to tell whether they are true or false. Even <code>NULL</code> <code>=</code>
      <code>NULL</code> produces <code>NULL</code> because you can’t determine whether one
      unknown value is the same as another.</p><p>To look for values that are or are not <code>NULL</code>, use the <code>IS</code> <code>NULL</code> or
      <code>IS</code> <code>NOT</code> <code>NULL</code>
      operator. Suppose that a table named <code>expt</code> contains experimental results for
      subjects who are to be given four tests each and that represents tests
      not yet administered using <code>NULL</code>:</p><pre data-type="programlisting">+---------+------+-------+
| subject | test | score |
+---------+------+-------+
| Jane    | A    |    47 |
| Jane    | B    |    50 |
| Jane    | C    |  NULL |
| Jane    | D    |  NULL |
| Marvin  | A    |    52 |
| Marvin  | B    |    45 |
| Marvin  | C    |    53 |
| Marvin  | D    |  NULL |
+---------+------+-------+</pre><p>You can see that <code>=</code> and <code>&lt;&gt;</code> fail to identify <code>NULL</code> values:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM expt WHERE score = NULL;</code></strong>
Empty set (0.00 sec)
mysql&gt; <strong><code>SELECT * FROM expt WHERE score &lt;&gt; NULL;</code></strong>
Empty set (0.00 sec)</pre><p>Write the statements like this instead:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM expt WHERE score IS NULL;</code></strong>
+---------+------+-------+
| subject | test | score |
+---------+------+-------+
| Jane    | C    |  NULL |
| Jane    | D    |  NULL |
| Marvin  | D    |  NULL |
+---------+------+-------+
mysql&gt; <strong><code>SELECT * FROM expt WHERE score IS NOT NULL;</code></strong>
+---------+------+-------+
| subject | test | score |
+---------+------+-------+
| Jane    | A    |    47 |
| Jane    | B    |    50 |
| Marvin  | A    |    52 |
| Marvin  | B    |    45 |
| Marvin  | C    |    53 |
+---------+------+-------+
mysql&gt; <strong><code>SELECT * FROM expt WHERE score &lt;=&gt; NULL;</code></strong>
+---------+------+-------+
| subject | test | score |
+---------+------+-------+
| Jane    | C    |  NULL |
| Jane    | D    |  NULL |
| Marvin  | D    |  NULL |
+---------+------+-------+</pre><p>The MySQL-specific <code>&lt;=&gt;</code>
      null-safe comparison operator, unlike the <code>=</code>
      operator, is true even for two <code>NULL</code>
      values:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT NULL = NULL, NULL &lt;=&gt; NULL;</code></strong>
+-------------+---------------+
| NULL = NULL | NULL &lt;=&gt; NULL |
+-------------+---------------+
|        NULL |             1 |
+-------------+---------------+</pre><p>Sometimes it’s useful to map <code>NULL</code> values onto some other value that has
      more meaning in the context of your application. For example, use <code>IF()</code> to map
      <code>NULL</code> onto the string <code>Unknown</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT subject, test, IF(score IS NULL,'Unknown', score) AS 'score'</code></strong>
    -&gt; <strong><code>FROM expt;</code></strong>
+---------+------+---------+
| subject | test | score   |
+---------+------+---------+
| Jane    | A    | 47      |
| Jane    | B    | 50      |
| Jane    | C    | Unknown |
| Jane    | D    | Unknown |
| Marvin  | A    | 52      |
| Marvin  | B    | 45      |
| Marvin  | C    | 53      |
| Marvin  | D    | Unknown |
+---------+------+---------+</pre><p>This <code>IF()</code>-based mapping
      technique works for any kind of value, but it’s especially useful with
      <code>NULL</code> values because <code>NULL</code> tends to be given a variety of meanings:
      unknown, missing, not yet determined, out of range, and so forth. Choose
      the label that makes the most sense in a given context.</p><p>The preceding query can be written more concisely using <code>IFNULL()</code>, which
      tests its first argument and returns it if it’s not <code>NULL</code>, or returns its second argument
      otherwise:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="n">subject</code><code class="p">,</code> <code class="n">test</code><code class="p">,</code> <code class="n">IFNULL</code><code class="p">(</code><code class="n">score</code><code class="p">,</code><code class="s1">'Unknown'</code><code class="p">)</code> <code class="k">AS</code> <code class="s1">'score'</code>
<code class="k">FROM</code> <code class="n">expt</code><code class="p">;</code></pre><p>In other words, these two tests are equivalent:</p><pre data-type="programlisting">IF(<em><code>expr1</code></em> IS NOT NULL,<em><code>expr1</code></em>,<em><code>expr2</code></em>)
IFNULL(<em><code>expr1</code></em>,<em><code>expr2</code></em>)</pre><p>From a readability standpoint, <code>IF()</code> often is easier to understand than
      <code>IFNULL()</code>. From a computational
      perspective, <code>IFNULL()</code> is more
      efficient because <em><code>expr1</code></em> need not be evaluated
      twice, as happens with <code>IF()</code>.</p><p>
        One more way to map <code>NULL</code> values is to use function <code>COALESCE</code> that returns first not-null element from the list of parameters.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="n">subject</code><code class="p">,</code> <code class="n">test</code><code class="p">,</code> <code class="n">COALESCE</code><code class="p">(</code><code class="n">score</code><code class="p">,</code><code class="s1">'Unknown'</code><code class="p">)</code> <code class="k">AS</code> <code class="s1">'score'</code> <code class="k">FROM</code> <code class="n">expt</code><code class="p">;</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820376723744"><h2>See Also</h2><p><code>NULL</code> values also behave differently when used by sorting and summary operations. See <a data-type="xref" href="ch09.xhtml#nch-sort-sort-float">Recipe 9.11</a> and <a data-type="xref" href="ch10.xhtml#nch-sum-sum-null">Recipe 10.9</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.6 Writing Comparisons Involving NULL in Programs"><div class="sect1" id="nch-select-select-null-compare"><h1>5.6 Writing Comparisons Involving NULL in Programs</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376677136"><h2>Problem</h2><p>You’re writing a program that looks for rows containing a specific
      value, but it fails when the value is <code>NULL</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376675616"><h2>Solution</h2><p>Choose the proper comparison operator according to whether the
      comparison value is or is not <code>NULL</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376674112"><h2>Discussion</h2><p><a data-type="xref" href="#nch-select-select-null">Recipe 5.5</a> discusses the need to
      use different comparison operators for <code>NULL</code> values than for non-<code>NULL</code> values in SQL statements. This issue
      leads to a subtle danger when constructing statement strings within
      programs. If a value stored in a variable might represent a <code>NULL</code> value, you must account for that when you
      use the value in comparisons. For example, in Python, <code>None</code>
      represents a <code>NULL</code> value, so to
      construct a statement that finds rows in the <code>expt</code> table matching some arbitrary value in a
      <code>score</code> variable, you cannot do
      this:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT * FROM expt WHERE score = </code><code class="si">%s</code><code class="s2">"</code><code class="p">,</code> <code class="p">(</code><code class="n">score</code><code class="p">,))</code></pre><p>The statement fails when <code>score</code>
      is <code>None</code> because the resulting
      statement becomes:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">expt</code> <code class="k">WHERE</code> <code class="n">score</code> <code class="o">=</code> <code class="k">NULL</code><code class="p">;</code></pre><p>A comparison of <code>score</code> <code>=</code> <code>NULL</code> is
      never true, so that statement returns no rows. To take into account the
      possibility that <code>score</code> could be
      <code>None</code>, construct the statement using
      the appropriate comparison operator like this:</p><pre data-type="programlisting" data-code-language="python"><code class="n">operator</code> <code class="o">=</code> <code class="s2">"IS"</code> <code class="k">if</code> <code class="n">score</code> <code class="ow">is</code> <code class="bp">None</code> <code class="k">else</code> <code class="s2">"="</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT * FROM expt WHERE score {} </code><code class="si">%s</code><code class="s2">"</code><code class="o">.</code><code class="n">format</code><code class="p">(</code><code class="n">operator</code><code class="p">),</code> <code class="p">(</code><code class="n">score</code><code class="p">,))</code></pre><p>This results in statements as follows for <code>score</code> values of <code>None</code> (<code>NULL</code>) or 43 (not <code>NULL</code>):</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">expt</code> <code class="k">WHERE</code> <code class="n">score</code> <code class="k">IS</code> <code class="k">NULL</code>
<code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">expt</code> <code class="k">WHERE</code> <code class="n">score</code> <code class="o">=</code> <code class="mi">43</code><code class="p">;</code></pre><p>For inequality tests, set <code>operator</code> like this instead:</p><pre data-type="programlisting" data-code-language="perl"><code class="n">operator</code> <code class="o">=</code> <code class="s">"IS NOT"</code> <code class="k">if</code> <code class="n">score</code> <code class="n">is</code> <code class="n">None</code> <code class="k">else</code> <code class="s">"&lt;&gt;"</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.7 Using Views to Simplify Table Access"><div class="sect1" id="nch-select-select-view"><h1>5.7 Using Views to Simplify Table Access</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376484672"><h2>Problem</h2><p>You want to refer to values calculated from expressions without writing the
      expressions each time you retrieve them.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376483792"><h2>Solution</h2><p>Use a view defined such that its columns perform the desired
      calculations.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376470512"><h2>Discussion</h2><p>Suppose that you retrieve several values from the <code>mail</code> table, using expressions to calculate
      most of them:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>DATE_FORMAT(t,'%M %e, %Y') AS date_sent,</code></strong>
    -&gt; <strong><code>CONCAT(srcuser,'@',srchost) AS sender,</code></strong>
    -&gt; <strong><code>CONCAT(dstuser,'@',dsthost) AS recipient,</code></strong>
    -&gt; <strong><code>size FROM mail;</code></strong>
+--------------+---------------+---------------+---------+
| date_sent    | sender        | recipient     | size    |
+--------------+---------------+---------------+---------+
| May 11, 2014 | barb@saturn   | tricia@mars   |   58274 |
| May 12, 2014 | tricia@mars   | gene@venus    |  194925 |
| May 12, 2014 | phil@mars     | phil@saturn   |    1048 |
| May 12, 2014 | barb@saturn   | tricia@venus  |     271 |
…</pre><p>If you must issue such a statement often, it’s inconvenient to
      keep writing the expressions. To make the statement results easier to
      access, use a view, which is a virtual table that contains no data.
      Instead, it’s defined as the <code>SELECT</code>
      statement that retrieves the data of interest. The following view,
      <code>mail_view</code>, is equivalent to the
      <code>SELECT</code> statement just shown:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE VIEW mail_view AS</code></strong>
    -&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>DATE_FORMAT(t,'%M %e, %Y') AS date_sent,</code></strong>
    -&gt; <strong><code>CONCAT(srcuser,'@',srchost) AS sender,</code></strong>
    -&gt; <strong><code>CONCAT(dstuser,'@',dsthost) AS recipient,</code></strong>
    -&gt; <strong><code>size FROM mail;</code></strong></pre><p>To access the view contents, refer to it like any other table. You
      can select some or all of its columns, add a <code>WHERE</code> clause to restrict which rows to retrieve, use <code>ORDER</code> <code>BY</code> to
      sort the rows, and so forth. For example:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT date_sent, sender, size FROM mail_view</code></strong>
    -&gt; <strong><code>WHERE size &gt; 100000 ORDER BY size;</code></strong>
+--------------+---------------+---------+
| date_sent    | sender        | size    |
+--------------+---------------+---------+
| May 12, 2014 | tricia@mars   |  194925 |
| May 15, 2014 | gene@mars     |  998532 |
| May 14, 2014 | tricia@saturn | 2394482 |
+--------------+---------------+---------+</pre><p>Stored programs provide another way to encapsulate calculations
      (see <a data-type="xref" href="ch11.xhtml#nch-routines-routines-encapsulation">Recipe 11.2</a>).</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.8 Selecting Data from Multiple Tables"><div class="sect1" id="nch-select-select-join"><h1>5.8 Selecting Data from Multiple Tables</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376455104"><h2>Problem</h2><p>The answer to a question requires data from more than one table, so you need to select data from multiple tables.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376454000"><h2>Solution</h2><p>Use a join or a subquery.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376453008"><h2>Discussion</h2><p>The queries shown so far select data from a single table, but
      sometimes you must retrieve information from multiple tables. Two types
      of statements that accomplish this are joins and subqueries. A join
      matches rows in one table with rows in another and enables
      you to retrieve output rows that contain columns from either or both
      tables. A subquery is one query nested within another, to perform a comparison
      between values selected by the inner query against values selected by
      the outer query.</p><p>This recipe shows a couple brief examples to illustrate the basic
      ideas. Other examples appear elsewhere: subqueries are used in various
      examples throughout the book (for example, <a data-type="xref" href="#nch-select-select-limit-sort">Recipe 5.10</a> and <a data-type="xref" href="ch10.xhtml#nch-sum-sum-assoc">Recipe 10.6</a>). <a data-type="xref" href="ch16.xhtml#nch-multi">Chapter 16</a>
      discusses joins in detail, including some that select from more than two
      tables.</p><p>The following examples use the <code>profile</code> table introduced in <a data-type="xref" href="ch04.xhtml#nch-api">Chapter 4</a>. Recall that it lists the people on your buddy
      list:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile;</code></strong>
+----+---------+------------+-------+-----------------------+------+
| id | name    | birth      | color | foods                 | cats |
+----+---------+------------+-------+-----------------------+------+
|  1 | Sybil   | 1970-04-13 | black | lutefisk,fadge,pizza  |    0 |
|  2 | Nancy   | 1969-09-30 | white | burrito,curry,eggroll |    3 |
|  3 | Ralph   | 1973-11-02 | red   | eggroll,pizza         |    4 |
|  4 | Lothair | 1963-07-04 | blue  | burrito,curry         |    5 |
|  5 | Henry   | 1965-02-14 | red   | curry,fadge           |    1 |
|  6 | Aaron   | 1968-09-17 | green | lutefisk,fadge        |    1 |
|  7 | Joanna  | 1952-08-20 | green | lutefisk,fadge        |    0 |
|  8 | Stephen | 1960-05-01 | white | burrito,pizza         |    0 |
+----+---------+------------+-------+-----------------------+------+</pre><p>Let’s extend use of the <code>profile</code>
      table to include another table named <code>profile_contact</code>. This second table indicates
      how to contact people listed in the <code>profile</code> table via various social media
      services and is defined like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">profile_contact</code>
<code class="p">(</code>
  <code class="n">id</code>           <code class="nb">INT</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code> <code class="k">PRIMARY</code> <code class="k">KEY</code><code class="p">,</code>
  <code class="n">profile_id</code>   <code class="nb">INT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code> <code class="o">#</code> <code class="n">ID</code> <code class="k">from</code> <code class="n">profile</code> <code class="k">table</code>
  <code class="n">service</code>      <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">)</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>  <code class="o">#</code> <code class="n">social</code> <code class="n">media</code> <code class="n">service</code> <code class="n">name</code>
  <code class="n">contact_name</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">25</code><code class="p">)</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>  <code class="o">#</code> <code class="n">name</code> <code class="k">to</code> <code class="n">use</code> <code class="k">for</code> <code class="n">contacting</code> <code class="n">person</code>
  <code class="k">INDEX</code> <code class="p">(</code><code class="n">profile_id</code><code class="p">)</code>
<code class="p">);</code></pre><p>The table associates each row with the proper <code>profile</code> row via the <code>profile_id</code> column. The <code>service</code> and <code>contact_name</code> columns name the media service
      and the name to use for contacting the given person via that service.
      For the examples, assume that the table contains these rows:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT profile_id, service, contact_name</code></strong>
    -&gt; <strong><code>FROM profile_contact ORDER BY profile_id, service;</code></strong>
+------------+----------+--------------+
| profile_id | service  | contact_name |
+------------+----------+--------------+
|          1 | Facebook | user1-fbid   |
|          1 | Twitter  | user1-twtrid |
|          2 | Facebook | user2-msnid  |
|          2 | LinkedIn | user2-lnkdid |
|          2 | Twitter  | user2-fbrid  |
|          4 | LinkedIn | user4-lnkdid |
+------------+----------+--------------+</pre><p>A question that requires information from both tables is,
      <q>For each person in the <code class="keep-together">profile</code> table, show me which services I
      can use to get in touch, and the contact name for each service.</q>
      To answer this question, use a join. Select from both tables and match
      rows by comparing the <code>id</code> column from
      the <code>profile</code> table with the <code>profile_id</code> column from the <code>profile_contact</code> table:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT profile.id, name, service, contact_name</code></strong>
    -&gt; <strong><code>FROM profile INNER JOIN profile_contact ON profile.id = profile_id;</code></strong>
+----+---------+----------+--------------+
| id | name    | service  | contact_name |
+----+---------+----------+--------------+
|  1 | Sybil   | Twitter  | user1-twtrid |
|  1 | Sybil   | Facebook | user1-fbid   |
|  2 | Nancy   | Twitter  | user2-fbrid  |
|  2 | Nancy   | Facebook | user2-msnid  |
|  2 | Nancy   | LinkedIn | user2-lnkdid |
|  4 | Lothair | LinkedIn | user4-lnkdid |
+----+---------+----------+--------------+</pre><p>The <code>FROM</code> clause indicates the
      tables from which to select data, and the <code>ON</code> clause tells MySQL which columns to use to
      find matches between the tables. In the result, rows include the
      <code>id</code> and <code>name</code> columns from the <code>profile</code> table, and the <code>service</code> and <code>contact_name</code> columns from the <code>profile_contact</code> table.</p><p>Here’s another question that requires both tables to answer:
      <q>List all the <code>profile_contact</code>
      records for Nancy.</q> To pull the proper rows from the <code>profile_contact</code> table, you need Nancy’s ID,
      which is stored in the <code>profile</code> table.
      To write the query without looking up Nancy’s ID yourself, use a
      subquery that, given her name, looks it up for you:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT profile_id, service, contact_name FROM profile_contact</code></strong>
    -&gt; <strong><code>WHERE profile_id = (SELECT id FROM profile WHERE name = 'Nancy');</code></strong>
+------------+----------+--------------+
| profile_id | service  | contact_name |
+------------+----------+--------------+
|          2 | Twitter  | user2-fbrid  |
|          2 | Facebook | user2-msnid  |
|          2 | LinkedIn | user2-lnkdid |
+------------+----------+--------------+</pre><p>Here the subquery appears as a nested <code>SELECT</code> statement
      enclosed within parentheses.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.9 Selecting Rows from the Beginning, End, or Middle of Query&#10;    Results"><div class="sect1" id="nch-select-select-limit"><h1>5.9 Selecting Rows from the Beginning, End, or Middle of Query
    Results</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376312160"><h2>Problem</h2><p>You want only certain rows from a result set, such as the first one, the last
      five, or rows 21 through 40.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376311088"><h2>Solution</h2><p>Use a <code>LIMIT</code> clause, perhaps in conjunction with an <code>ORDER</code> <code>BY</code>
      clause.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376308768"><h2>Discussion</h2><p>MySQL supports a <code>LIMIT</code> clause
      that tells the server to return only part of a result set. <code>LIMIT</code> is a MySQL-specific extension to SQL
      that is extremely valuable when your result set contains more rows than
      you want to see at a time. It enables you to retrieve an arbitrary
      section of a result set. Typical <code>LIMIT</code> uses include the following kinds of
      problems:</p><ul><li><p>Answering questions about first or last, largest or smallest,
          newest or oldest, least or most expensive, and so forth.</p></li><li><p>Splitting a result set into sections so that you can process
          it one piece at a time. This technique is common in web applications
          for displaying a large search result across several pages. Showing
          the result in sections enables display of smaller,
          easier-to-understand pages.</p></li></ul><p>The following examples use the <code>profile</code> table shown in <a data-type="xref" href="#nch-select-select-join">Recipe 5.8</a>. To see the first
      <em><code>n</code></em> rows of a <code>SELECT</code> result, add <code>LIMIT</code> <em><code>n</code></em> to the end
      of the statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile LIMIT 1;</code></strong>
+----+-------+------------+-------+----------------------+------+
| id | name  | birth      | color | foods                | cats |
+----+-------+------------+-------+----------------------+------+
|  1 | Sybil | 1970-04-13 | black | lutefisk,fadge,pizza |    0 |
+----+-------+------------+-------+----------------------+------+
mysql&gt; <strong><code>SELECT * FROM profile LIMIT 3;</code></strong>
+----+-------+------------+-------+-----------------------+------+
| id | name  | birth      | color | foods                 | cats |
+----+-------+------------+-------+-----------------------+------+
|  1 | Sybil | 1970-04-13 | black | lutefisk,fadge,pizza  |    0 |
|  2 | Nancy | 1969-09-30 | white | burrito,curry,eggroll |    3 |
|  3 | Ralph | 1973-11-02 | red   | eggroll,pizza         |    4 |
+----+-------+------------+-------+-----------------------+------+</pre><p><code>LIMIT</code>
      <em><code>n</code></em> means <q>return <em>at
      most</em> <em><code>n</code></em> rows.</q> If you
      specify <code>LIMIT</code> <code>10</code>, and the result set has only four rows, the
      server returns four rows.</p><p>The rows in the preceding query results are returned in no
      particular order, so they may not be very meaningful. A more common
      technique uses <code>ORDER</code> <code>BY</code> to sort the result set and <code>LIMIT</code> to find smallest and largest values. For
      example, to find the row with the minimum (earliest) birth date, sort by
      the <code>birth</code> column, then add <code>LIMIT</code> <code>1</code> to
      retrieve the first row:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile ORDER BY birth LIMIT 1;</code></strong>
+----+--------+------------+-------+----------------+------+
| id | name   | birth      | color | foods          | cats |
+----+--------+------------+-------+----------------+------+
|  7 | Joanna | 1952-08-20 | green | lutefisk,fadge |    0 |
+----+--------+------------+-------+----------------+------+</pre><p>This works because MySQL processes the <code>ORDER</code> <code>BY</code>
      clause to sort the rows, then applies <code>LIMIT</code>.</p><p>To obtain rows from the end of a result set, sort them in the
      opposite order. The statement that finds the row with the most recent
      birth date is similar to the previous one, except that the sort order is
      descending:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile ORDER BY birth DESC LIMIT 1;</code></strong>
+----+-------+------------+-------+---------------+------+
| id | name  | birth      | color | foods         | cats |
+----+-------+------------+-------+---------------+------+
|  3 | Ralph | 1973-11-02 | red   | eggroll,pizza |    4 |
+----+-------+------------+-------+---------------+------+</pre><p>To find the earliest or latest birthday within the calendar year,
      sort by the month and day of the <code>birth</code> values:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name, DATE_FORMAT(birth,'%m-%d') AS birthday</code></strong>
    -&gt; <strong><code>FROM profile ORDER BY birthday LIMIT 1;</code></strong>
+-------+----------+
| name  | birthday |
+-------+----------+
| Henry | 02-14    |
+-------+----------+</pre><p>You can obtain the same information by running these statements
      without <code>LIMIT</code> and ignoring everything
      but the first row. The advantage of <code>LIMIT</code> is that the server returns only the
      first row, and the extra rows don’t cross the network at all. This is
      much more efficient than retrieving an entire result set, only to
      discard all but one row.</p><p>To pull rows from the middle of a result set, use the two-argument
      form of <code>LIMIT</code>, which enables you to
      pick an arbitrary section of rows. The arguments indicate how many rows
      to skip and how many to return. This means that you can use <code>LIMIT</code> to do such things as skip two rows and
      return the next one, thus answering questions such as <q>What is the
      <em>third-</em>smallest or
      <em>third-</em>largest value?</q> These are questions
      that <code>MIN()</code> or <code>MAX()</code> are not suited for, but are easy with
      <code>LIMIT</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile ORDER BY birth LIMIT 2,1;</code></strong>
+----+---------+------------+-------+---------------+------+
| id | name    | birth      | color | foods         | cats |
+----+---------+------------+-------+---------------+------+
|  4 | Lothair | 1963-07-04 | blue  | burrito,curry |    5 |
+----+---------+------------+-------+---------------+------+
mysql&gt; <strong><code>SELECT * FROM profile ORDER BY birth DESC LIMIT 2,1;</code></strong>
+----+-------+------------+-------+-----------------------+------+
| id | name  | birth      | color | foods                 | cats |
+----+-------+------------+-------+-----------------------+------+
|  2 | Nancy | 1969-09-30 | white | burrito,curry,eggroll |    3 |
+----+-------+------------+-------+-----------------------+------+</pre><p>The two-argument form of <code>LIMIT</code>
      also makes it possible to partition a result set into smaller sections.
      For example, to retrieve 20 rows at a time from a result, issue a
      <code>SELECT</code> statement repeatedly, but vary
      its <code>LIMIT</code> clause like so:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="p">...</code> <code class="k">FROM</code> <code class="p">...</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="p">...</code> <code class="k">LIMIT</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">20</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="p">...</code> <code class="k">FROM</code> <code class="p">...</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="p">...</code> <code class="k">LIMIT</code> <code class="mi">20</code><code class="p">,</code> <code class="mi">20</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="p">...</code> <code class="k">FROM</code> <code class="p">...</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="p">...</code> <code class="k">LIMIT</code> <code class="mi">40</code><code class="p">,</code> <code class="mi">20</code><code class="p">;</code>
<code class="err">…</code></pre><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          This way of using <code>LIMIT</code> clause can cause performance degradations for large data sets, because it requires reading minimum <code>OFFSET</code> plus <code>LIMIT</code> rows. This means that to get result for the <code>LIMIT 0, 20</code> statement MySQL will have to read 20 rows from the table, to get result of <code>LIMIT 20, 20</code> it will need to read 40 rows, and so on.
        </p></div><p>To determine the number of rows in a result set so that you can
      determine the number of sections, issue a <code>COUNT()</code> statement first. For example, to display <code>profile</code> table rows in name order, three at a
      time, you can find out how many there are with the following
      statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM profile;</code></strong>
+----------+
| COUNT(*) |
+----------+
|        8 |
+----------+</pre><p>That tells you that there are three sets of rows (the last with
      fewer than three rows), which you can retrieve as follows:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="n">name</code> <code class="k">LIMIT</code> <code class="mi">0</code><code class="p">,</code> <code class="mi">3</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="n">name</code> <code class="k">LIMIT</code> <code class="mi">3</code><code class="p">,</code> <code class="mi">3</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">ORDER</code> <code class="k">BY</code> <code class="n">name</code> <code class="k">LIMIT</code> <code class="mi">6</code><code class="p">,</code> <code class="mi">3</code><code class="p">;</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820376256304"><h2>See Also</h2><p><code>LIMIT</code> is useful in combination
      with <code>RAND()</code> to make random selections from a set of items. See <a data-type="xref" href="ch17.xhtml#nch-stats-stats-rand-items">Recipe 17.8</a>.</p><p>You can use <code>LIMIT</code> to restrict
      the effect of a <code>DELETE</code> or
      <code>UPDATE</code> statement to a subset of the
      rows that would otherwise be deleted or updated, respectively. For more
      information about using <code>LIMIT</code> for
      duplicate row removal, see <a data-type="xref" href="ch18.xhtml#nch-dups-dups-elim-table">Recipe 18.5</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.10 What to Do When LIMIT and Final Result Require Different Sort Order"><div class="sect1" id="nch-select-select-limit-sort"><h1>5.10 What to Do When LIMIT and Final Result Require Different <span class="keep-together">Sort Order</span></h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376127408"><h2>Problem</h2><p><code>LIMIT</code> usually works best in conjunction with an <code>ORDER</code> <code>BY</code>
      clause that sorts rows. But sometimes that sort order differs from what
      you want for the final result.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376122400"><h2>Solution</h2><p>Use <code>LIMIT</code> in a subquery to
      retrieve the desired rows, then use the outer query to
      sort them.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376120896"><h2>Discussion</h2><p>If you want the last four rows of a result set, you can obtain
      them easily by sorting the set in reverse order and using <code>LIMIT</code> <code>4</code>.
      The following statement returns the names and birth dates for the four
      people in the <code>profile</code> table who were
      born most recently:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name, birth FROM profile ORDER BY birth DESC LIMIT 4;</code></strong>
+-------+------------+
| name  | birth      |
+-------+------------+
| Ralph | 1973-11-02 |
| Sybil | 1970-04-13 |
| Nancy | 1969-09-30 |
| Aaron | 1968-09-17 |
+-------+------------+</pre><p>But that requires sorting the <code>birth</code> values in descending order to place them
      at the head of the result set. What if you want the output rows to
      appear in ascending order instead? Use the <code>SELECT</code> as a subquery of an outer statement
      that re-sorts the rows in the desired final order:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM</code></strong>
    -&gt; <strong><code>(SELECT name, birth FROM profile ORDER BY birth DESC LIMIT 4) AS t</code></strong>
    -&gt; <strong><code>ORDER BY birth;</code></strong>
+-------+------------+
| name  | birth      |
+-------+------------+
| Aaron | 1968-09-17 |
| Nancy | 1969-09-30 |
| Sybil | 1970-04-13 |
| Ralph | 1973-11-02 |
+-------+------------+</pre><p><code>AS</code> <code>t</code> is used here because any table referred to in the <code>FROM</code> clause must
      have a name, even a <q>derived</q> table produced from a
      subquery.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.11 Calculating LIMIT Values from Expressions"><div class="sect1" id="nch-select-select-limit-calc"><h1>5.11 Calculating LIMIT Values from Expressions</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376111184"><h2>Problem</h2><p>You want to use expressions to specify the arguments for <code>LIMIT</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820376109792"><h2>Solution</h2><p><code>LIMIT</code>
      arguments must be literal integers—unless you issue the statement in a
      context that permits the statement string to be constructed dynamically.
      In that case, you can evaluate the expressions yourself and insert the
      resulting values into the statement string.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820376108528"><h2>Discussion</h2><p>Arguments to <code>LIMIT</code> must be
      literal integers, not expressions. Statements such as the following are
      illegal:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">LIMIT</code> <code class="mi">5</code><code class="o">+</code><code class="mi">5</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">LIMIT</code> <code class="o">@</code><code class="n">skip_count</code><code class="p">,</code> <code class="o">@</code><code class="n">show_count</code><code class="p">;</code></pre><p>The same <q>no expressions permitted</q> principle applies
      if you use an expression to calculate a <code>LIMIT</code> value in a program that constructs a
      statement string. You must evaluate the expression first, and then place
      the resulting value in the statement. For example, if you produce a
      statement string in Perl or PHP as follows, an error will result when
      you attempt to execute the statement:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$str</code> <code class="o">=</code> <code class="s">"SELECT * FROM profile LIMIT $x + $y"</code><code class="p">;</code></pre><p>To avoid the problem, evaluate the expression first:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$z</code> <code class="o">=</code> <code class="nv">$x</code> <code class="o">+</code> <code class="nv">$y</code><code class="p">;</code>
<code class="nv">$str</code> <code class="o">=</code> <code class="s">"SELECT * FROM profile LIMIT $z"</code><code class="p">;</code></pre><p>Or do this (don’t omit the parentheses or the expression won’t
      evaluate properly):</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$str</code> <code class="o">=</code> <code class="s">"SELECT * FROM profile LIMIT "</code> <code class="o">.</code> <code class="p">(</code><code class="nv">$x</code> <code class="o">+</code> <code class="nv">$y</code><code class="p">);</code></pre><p>To construct a two-argument <code>LIMIT</code> clause, evaluate both expressions before
      placing them into the statement string.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.12 Combining Two or More SELECT Results"><div class="sect1" id="nch-select-select-union"><h1>5.12 Combining Two or More SELECT Results</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820376015648"><h2>Problem</h2><p>
        You want to combine rows, retrieved by two or more <code>SELECT</code> statements into one result set.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820375993264"><h2>Solution</h2><p>
        Use <code>UNION</code> clause.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820375991984"><h2>Discussion</h2><p>
        The <code>mail</code> table stores user names and hosts of the email senders and recipients. But what if we want to know all the user and host combinations possible?
      </p><p>
        Naive approach would be to choose either sender or receiver pairs. But if we perform even very basic test by comparing number of unique user-host combinations we will find out that it is different for each of directions.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">COUNT</code><code class="p">(</code><code class="k">distinct</code><code> </code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="n">srchost</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mail</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="o">|</code><code> </code><code class="k">count</code><code class="p">(</code><code class="k">distinct</code><code> </code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="n">srchost</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="o">|</code><code>                                </code><code class="mi">9</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">select</code><code> </code><code class="k">count</code><code class="p">(</code><code class="k">distinct</code><code> </code><code class="n">dstuser</code><code class="p">,</code><code> </code><code class="n">dsthost</code><code class="p">)</code><code> </code><code class="k">from</code><code> </code><code class="n">mail</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="o">|</code><code> </code><code class="k">count</code><code class="p">(</code><code class="k">distinct</code><code> </code><code class="n">dstuser</code><code class="p">,</code><code> </code><code class="n">dsthost</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="o">|</code><code>                               </code><code class="mi">10</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
       We also do not know if our table stores emails from users who only send them and for users who receive but never send.
      </p><p>
        To get the full list we need to select pairs for both sender and receiver, then remove duplicates. SQL clause <code>UNION DISTINCT</code> and its short form <code>UNION</code> does exactly that. It combines results of two or more <code>SELECT</code> queries that select the same number of columns of the same type.
      </p><p>
        By default <code>UNION</code> uses column names of the first <code>SELECT</code> for the full result set header, but we can also use aliases as discussed in <a data-type="xref" href="#nch-select-select-column-alias">Recipe 5.2</a>.
        
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">DISTINCT</code><code> </code><code class="n">srcuser</code><code> </code><code class="k">AS</code><code> </code><code class="k">user</code><code class="p">,</code><code> </code><code class="n">srchost</code><code> </code><code class="k">AS</code><code> </code><code class="k">host</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mail</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">UNION</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">DISTINCT</code><code> </code><code class="n">dstuser</code><code> </code><code class="k">AS</code><code> </code><code class="k">user</code><code class="p">,</code><code> </code><code class="n">dsthost</code><code> </code><code class="k">AS</code><code> </code><code class="k">host</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mail</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------+--------+
</code><code class="o">|</code><code> </code><code class="k">user</code><code>   </code><code class="o">|</code><code> </code><code class="k">host</code><code>   </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+--------+
</code><code class="o">|</code><code> </code><code class="n">barb</code><code>   </code><code class="o">|</code><code> </code><code class="n">saturn</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code> </code><code class="o">|</code><code> </code><code class="n">mars</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">phil</code><code>   </code><code class="o">|</code><code> </code><code class="n">mars</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code>   </code><code class="o">|</code><code> </code><code class="n">venus</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code>   </code><code class="o">|</code><code> </code><code class="n">venus</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code> </code><code class="o">|</code><code> </code><code class="n">saturn</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code>   </code><code class="o">|</code><code> </code><code class="n">mars</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">phil</code><code>   </code><code class="o">|</code><code> </code><code class="n">venus</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code>   </code><code class="o">|</code><code> </code><code class="n">saturn</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">phil</code><code>   </code><code class="o">|</code><code> </code><code class="n">saturn</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code> </code><code class="o">|</code><code> </code><code class="n">venus</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code>   </code><code class="o">|</code><code> </code><code class="n">mars</code><code>   </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+--------+
</code><code class="mi">12</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        You may sort as individual query, participating in <code>UNION</code>, as well the whole result. If you do not want to remove duplicates from the result use clause <code>UNION ALL</code>.
      </p><p>
        To demonstrate this lets create a query that will find four users who sent the highest number of emails and four users who recieved the highest number of emails, then sort result of the union by the user name.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="p">(</code><code class="k">SELECT</code><code> </code><code class="n">CONCAT</code><code class="p">(</code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="s1">'@'</code><code class="p">,</code><code> </code><code class="n">srchost</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="k">user</code><code class="p">,</code><code> </code><code class="k">COUNT</code><code class="p">(</code><code class="o">*</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">emails</code><code> </code></strong><a class="co" id="co_nch-select-select-union-concat_co" href="#callout_nch-select-select-union-concat_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">mail</code><code> </code><code class="k">GROUP</code><code> </code><code class="k">BY</code><code> </code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="n">srchost</code><code> </code><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="n">emails</code><code> </code><code class="k">DESC</code><code> </code><code class="k">LIMIT</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code></strong><a class="co" id="co_nch-select-select-union-order_co" href="#callout_nch-select-select-union-order_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">UNION</code><code> </code><code class="k">ALL</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">(</code><code class="k">SELECT</code><code> </code><code class="n">CONCAT</code><code class="p">(</code><code class="n">dstuser</code><code class="p">,</code><code> </code><code class="s1">'@'</code><code class="p">,</code><code> </code><code class="n">dsthost</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="k">user</code><code class="p">,</code><code> </code><code class="k">COUNT</code><code class="p">(</code><code class="o">*</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">emails</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">mail</code><code> </code><code class="k">GROUP</code><code> </code><code class="k">BY</code><code> </code><code class="n">dstuser</code><code class="p">,</code><code> </code><code class="n">dsthost</code><code> </code><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="n">emails</code><code> </code><code class="k">DESC</code><code> </code><code class="k">LIMIT</code><code> </code><code class="mi">4</code><code class="p">)</code><code> </code></strong><a class="co" id="co_nch-select-select-union-order2_co" href="#callout_nch-select-select-union-order2_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="k">user</code><code class="p">;</code></strong><a class="co" id="co_nch-select-select-union-order-union_co" href="#callout_nch-select-select-union-order-union_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="o">+</code><code class="c1">---------------+--------+
</code><code class="o">|</code><code> </code><code class="k">user</code><code>          </code><code class="o">|</code><code> </code><code class="n">emails</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------+--------+
</code><code class="o">|</code><code> </code><code class="n">barb</code><code class="o">@</code><code class="n">mars</code><code>     </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code class="o">@</code><code class="n">saturn</code><code>   </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">saturn</code><code>   </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code> </code><a class="co" id="co_nch-select-select-union-duplicate_co" href="#callout_nch-select-select-union-duplicate_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">phil</code><code class="o">@</code><code class="n">mars</code><code>     </code><code class="o">|</code><code>      </code><code class="mi">3</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code class="o">@</code><code class="n">saturn</code><code> </code><code class="o">|</code><code>      </code><code class="mi">3</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------+--------+
</code><code class="mi">8</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        
        </p><dl class="calloutlist"><dt><a class="co" id="callout_nch-select-select-union-concat_co" href="#co_nch-select-select-union-concat_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>Concatenate user and host into email address of the user.</p></dd><dt><a class="co" id="callout_nch-select-select-union-order_co" href="#co_nch-select-select-union-order_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>Order first <code>SELECT</code> result by number of emails descending and limit number of retrieved rows.</p></dd><dt><a class="co" id="callout_nch-select-select-union-order2_co" href="#co_nch-select-select-union-order2_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>Order result of the second <code>SELECT</code>.</p></dd><dt><a class="co" id="callout_nch-select-select-union-order-union_co" href="#co_nch-select-select-union-order-union_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt><dd><p>Order result of the <code>UNION</code> by the user email address.</p></dd><dt><a class="co" id="callout_nch-select-select-union-duplicate_co" href="#co_nch-select-select-union-duplicate_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt><dd><p>We used clause <code>UNION ALL</code> instead of <code>UNION [DISTINCT]</code>, therefore we have two entries for <code>gene@venus</code> in the result. This user is in the top list of those who send emails and also of those who recieve emails.</p></dd></dl><p>
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="5.13 Selecting Results of Subqueries"><div class="sect1" id="nch-select-select-subqueries"><h1>5.13 Selecting Results of Subqueries</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820375354384"><h2>Problem</h2><p>
        You want to retrieve not only table columns, but also results of queries that use these columns.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820375353376"><h2>Solution</h2><p>
        Use subquery in the column list.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820375352496"><h2>Discussion</h2><p>
        Suppose that you want to know not only how many emails sent a particular user, but also how many emails they received. You cannot do it without accessing the table <code>mail</code> two times: one to count how many emails were sent and second to count how many emails were received.
      </p><p>
        One of solutions for this issue is to use subqueries in the column list.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">CONCAT</code><code class="p">(</code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="s1">'@'</code><code class="p">,</code><code> </code><code class="n">srchost</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="k">user</code><code class="p">,</code><code> </code><code class="k">COUNT</code><code class="p">(</code><code class="o">*</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">mails_sent</code><code class="p">,</code></strong><code> </code><a class="co" id="co_nch-select-select-subqueries-sent_co" href="#callout_nch-select-select-subqueries-sent_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">(</code><code class="k">SELECT</code><code> </code><code class="k">COUNT</code><code class="p">(</code><code class="o">*</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mail</code><code> </code><code class="n">d</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">d</code><code class="p">.</code><code class="n">dstuser</code><code class="o">=</code><code class="n">m</code><code class="p">.</code><code class="n">srcuser</code><code> </code><code class="k">AND</code><code> </code><code class="n">d</code><code class="p">.</code><code class="n">dsthost</code><code class="o">=</code><code class="n">m</code><code class="p">.</code><code class="n">srchost</code><code class="p">)</code><code> </code></strong><code> </code><a class="co" id="co_nch-select-select-subqueries-received_co" href="#callout_nch-select-select-subqueries-received_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AS</code><code> </code><code class="n">mails_received</code></strong><code> </code><a class="co" id="co_nch-select-select-subqueries-received_alias_co" href="#callout_nch-select-select-subqueries-received_alias_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">mail</code><code> </code><code class="n">m</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">GROUP</code><code> </code><code class="k">BY</code><code>  </code><code class="n">srcuser</code><code class="p">,</code><code> </code><code class="n">srchost</code><code> </code></strong><code> </code><a class="co" id="co_nch-select-select-subqueries-group_co" href="#callout_nch-select-select-subqueries-group_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="n">mails_sent</code><code> </code><code class="k">DESC</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------+------------+----------------+
</code><code class="o">|</code><code> </code><code class="k">user</code><code>          </code><code class="o">|</code><code> </code><code class="n">mails_sent</code><code> </code><code class="o">|</code><code> </code><code class="n">mails_received</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------+------------+----------------+
</code><code class="o">|</code><code> </code><code class="n">phil</code><code class="o">@</code><code class="n">mars</code><code>     </code><code class="o">|</code><code>          </code><code class="mi">3</code><code> </code><code class="o">|</code><code>              </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code class="o">@</code><code class="n">saturn</code><code>   </code><code class="o">|</code><code>          </code><code class="mi">2</code><code> </code><code class="o">|</code><code>              </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>          </code><code class="mi">2</code><code> </code><code class="o">|</code><code>              </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">mars</code><code>     </code><code class="o">|</code><code>          </code><code class="mi">2</code><code> </code><code class="o">|</code><code>              </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">phil</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>          </code><code class="mi">2</code><code> </code><code class="o">|</code><code>              </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">gene</code><code class="o">@</code><code class="n">saturn</code><code>   </code><code class="o">|</code><code>          </code><code class="mi">2</code><code> </code><code class="o">|</code><code>              </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code class="o">@</code><code class="n">mars</code><code>   </code><code class="o">|</code><code>          </code><code class="mi">1</code><code> </code><code class="o">|</code><code>              </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">barb</code><code class="o">@</code><code class="n">venus</code><code>    </code><code class="o">|</code><code>          </code><code class="mi">1</code><code> </code><code class="o">|</code><code>              </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">tricia</code><code class="o">@</code><code class="n">saturn</code><code> </code><code class="o">|</code><code>          </code><code class="mi">1</code><code> </code><code class="o">|</code><code>              </code><code class="mi">3</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------+------------+----------------+
</code><code class="mi">9</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        
        </p><dl class="calloutlist"><dt><a class="co" id="callout_nch-select-select-subqueries-sent_co" href="#co_nch-select-select-subqueries-sent_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>First we are retrieved a user name and a host of the sender and count number of emails that they sent.</p></dd><dt><a class="co" id="callout_nch-select-select-subqueries-received_co" href="#co_nch-select-select-subqueries-received_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>To find the number of emails that this user received we are using subquery to the same table <code>mail</code>. In the <code>WHERE</code> clause we select only those rows where receiver has the same credentials as the sender in the main query.</p></dd><dt><a class="co" id="callout_nch-select-select-subqueries-received_alias_co" href="#co_nch-select-select-subqueries-received_alias_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>A subquery in the column list must have its own alias.</p></dd><dt><a class="co" id="callout_nch-select-select-subqueries-group_co" href="#co_nch-select-select-subqueries-group_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt><dd><p>To display statistics per user we use clause <code>GROUP BY</code>, so result is groupped by each user name and host. We discuss <code>GROUP BY</code> clause in detail in <a data-type="xref" href="ch10.xhtml#nch-sum">Chapter 10</a>.</p></dd></dl><p>
      </p></div></section></div></section></div></section></div></body></html>