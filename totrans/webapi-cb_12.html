<html><head></head><body><section data-pdf-bookmark="Chapter 12. Web Components" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_webComponents">&#13;
<h1><span class="label">Chapter 12. </span>Web Components</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id163">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="web components" data-type="indexterm" id="ix_12-web-components-asciidoc0"/>Web <a data-primary="web components" data-secondary="basics" data-type="indexterm" id="ix_12-web-components-asciidoc1"/>components are a way to build new HTML elements with their own behavior. This behavior is encapsulated in a <em>custom element</em>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Component" data-type="sect2"><div class="sect2" id="id164">&#13;
<h2>Creating a Component</h2>&#13;
&#13;
<p><a data-primary="web components" data-secondary="creating" data-type="indexterm" id="id1071"/>You can create a web component by defining a class that extends <code>HTMLElement</code>, as shown in <a data-type="xref" href="#example12-1">Example 12-1</a>.</p>&#13;
<div data-type="example" id="example12-1">&#13;
<h5><span class="label">Example 12-1. </span>A barebones web component</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">MyComponent</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">'Hello from MyComponent'</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p><a data-primary="lifecycle callbacks" data-type="indexterm" id="id1072"/>When you add the custom element to the DOM, the browser calls the <code>connectedCallback</code> method. This is typically where most of your component’s logic resides. This is one of the <em>lifecycle callbacks</em>. Some other lifecycle callbacks include:</p>&#13;
<dl>&#13;
<dt><code>disconnectedCallback</code></dt>&#13;
<dd>&#13;
<p>Called when you remove the custom element from the DOM. This is a good place to do cleanup, such as removing event listeners.</p>&#13;
</dd>&#13;
<dt><code>attributeChangedCallback</code></dt>&#13;
<dd>&#13;
<p>Called when you change one of the element’s watched attributes.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Registering a Custom Element" data-type="sect2"><div class="sect2" id="id165">&#13;
<h2>Registering a Custom Element</h2>&#13;
&#13;
<p><a data-primary="custom elements, registering" data-type="indexterm" id="id1073"/><a data-primary="registering custom elements" data-type="indexterm" id="id1074"/><a data-primary="web components" data-secondary="registering custom elements" data-type="indexterm" id="id1075"/>Once you’ve created your custom element class, you must register it with the browser before using it in an HTML document.&#13;
You can register your custom element by calling <code>define</code> on the global <code>customElements</code> object, as shown in <a data-type="xref" href="#example12-2">Example 12-2</a>.</p>&#13;
<div data-type="example" id="example12-2">&#13;
<h5><span class="label">Example 12-2. </span>Registering a custom element with the browser</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'my-component'</code><code class="p">,</code> <code class="nx">MyComponent</code><code class="p">);</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you try to define a custom element that has already been &#13;
<span class="keep-together">defined, the</span> browser throws an error. If this is a possibility for &#13;
<span class="keep-together">you,&#13;
you</span> can call <code>customElements.get('my-component')</code> in order to check if it’s already defined. If this returns <code>undefined</code>, it’s safe to call&#13;
<code>customElements.define</code>.</p>&#13;
</div>&#13;
&#13;
<p>Once you register the element, you can use it like any other HTML element, as shown in <a data-type="xref" href="#example12-3">Example 12-3</a>.</p>&#13;
<div data-type="example" id="example12-3">&#13;
<h5><span class="label">Example 12-3. </span>Using the custom element</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">my-component</code><code class="p">&gt;&lt;/</code><code class="nt">my-component</code><code class="p">&gt;</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Custom elements must always have a hyphenated name. This is required by the specification. They also must always&#13;
have a closing tag, even if there is no child content.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Templates" data-type="sect2"><div class="sect2" id="id166">&#13;
<h2>Templates</h2>&#13;
&#13;
<p><a data-primary="&lt;template&gt; element" data-primary-sortas="template" data-type="indexterm" id="id1076"/><a data-primary="web components" data-secondary="templates" data-type="indexterm" id="id1077"/>There are several ways to get HTML markup into a web component. For example, in the <code>connectedCallback</code>, you can manually create elements by calling <code>document.createElement</code> and manually appending them.</p>&#13;
&#13;
<p>You can also specify a component’s markup with a <code>&lt;template&gt;</code> element. This contains some HTML that you’ll use during the <code>connectedCallback</code> to give your component its content.&#13;
These templates are very simple—they don’t support data binding, variable interpolation, or any kind of logic. They only serve as a starting point of the HTML content. Within&#13;
the <code>connectedCallback</code>, you can select elements, set dynamic values, and add event listeners as needed.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Slots" data-type="sect2"><div class="sect2" id="id167">&#13;
<h2>Slots</h2>&#13;
&#13;
<p><a data-primary="&lt;slot&gt; element" data-primary-sortas="slot" data-type="indexterm" id="id1078"/><a data-primary="web components" data-secondary="slots" data-type="indexterm" id="id1079"/>A <code>&lt;slot&gt;</code> is a special element you can use in a template. A slot is a placeholder for some child content that is passed in. A component can have a default slot as well as one or more <em>named</em> slots. You can use named slots to place multiple pieces of content inside your component.</p>&#13;
&#13;
<p><a data-type="xref" href="#example12-4">Example 12-4</a> shows a simple template that has a named and default slot.</p>&#13;
<div data-type="example" id="example12-4">&#13;
<h5><span class="label">Example 12-4. </span>A template with slots</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;&lt;</code><code class="nt">slot</code> <code class="na">name</code><code class="o">=</code><code class="s">"name"</code><code class="p">&gt;&lt;/</code><code class="nt">slot</code><code class="p">&gt;&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">slot</code><code class="p">&gt;&lt;/</code><code class="nt">slot</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Suppose this template is used in an <code>&lt;author-bio&gt;</code> component, as shown in <a data-type="xref" href="#example12-5">Example 12-5</a>.</p>&#13;
<div data-type="example" id="example12-5">&#13;
<h5><span class="label">Example 12-5. </span>Specifying content for slots</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">author-bio</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">span</code> <code class="na">slot</code><code class="o">=</code><code class="s">"name"</code><code class="p">&gt;</code>John Doe<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>John is a great author who has written many books.<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">author-bio</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>In the component’s child content, you can specify a <code>slot</code> attribute that corresponds to a named slot in the component template. The <code>span</code> element containing the text “John Doe” will be placed in the component’s <code>name</code> slot, inside the <code>h2</code> element. Any other child content, without a <code>slot</code> element, is placed in the default slot (the one with no name).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Shadow DOM" data-type="sect2"><div class="sect2" id="id168">&#13;
<h2>Shadow DOM</h2>&#13;
&#13;
<p><a data-primary="shadow DOM" data-type="indexterm" id="id1080"/><a data-primary="web components" data-secondary="shadow DOM" data-type="indexterm" id="id1081"/>A shadow DOM is a collection of elements that are isolated from the rest of the main DOM. Web components use shadow DOM extensively. One main advantage of using shadow DOM is for scoped CSS styles. Any styles you define in a shadow DOM <em>only</em> apply to elements inside that shadow DOM. Other elements in the document, even if they’d normally match the selector of a CSS rule, do not have the CSS applied.</p>&#13;
&#13;
<p>This style scoping goes both ways. If you have global styles on your page, they will not apply to any of the elements in a shadow DOM.</p>&#13;
&#13;
<p>A shadow DOM, created by attaching a <em>shadow root</em> to a web component, can be open or closed. When a shadow DOM is open, you can access and modify its &#13;
<span class="keep-together">elements</span> with JavaScript. When it is closed, a web component’s <code>shadowRoot</code> property is <code>null</code> so you can’t access the content within.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Light DOM" data-type="sect2"><div class="sect2" id="id169">&#13;
<h2>Light DOM</h2>&#13;
&#13;
<p><a data-primary="Light DOM" data-type="indexterm" id="id1082"/><a data-primary="web components" data-secondary="Light DOM" data-type="indexterm" id="id1083"/>Using shadow DOM is completely optional, however. The <em>Light DOM</em> refers to the regular, non-encapsulated DOM inside the web component. Because Light DOM is not encapsulated from the rest of the page, global styles will be applied to its child elements<a data-startref="ix_12-web-components-asciidoc1" data-type="indexterm" id="id1084"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Component to Show Today’s Date" data-type="sect1"><div class="sect1" id="recipe_todaysDate">&#13;
<h1>Creating a Component to Show Today’s Date</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id301">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="date formatting" data-secondary="creating a component to show today’s date" data-type="indexterm" id="id1085"/><a data-primary="web components" data-secondary="to show today’s date" data-type="indexterm" id="id1086"/>You want a web component that formats and shows today’s date in the browser’s locale.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id170">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="Intl.DateTimeFormat" data-type="indexterm" id="id1087"/>Use <code>Intl.DateTimeFormat</code> inside the web component to format the current date (see <a data-type="xref" href="#example12-6">Example 12-6</a>).</p>&#13;
<div data-type="example" id="example12-6">&#13;
<h5><span class="label">Example 12-6. </span>A custom element that formats the current date</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">TodaysDate</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">formatter</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code>&#13;
      <code class="nx">navigator</code><code class="p">.</code><code class="nx">language</code><code class="p">,</code>&#13;
      <code class="p">{</code> <code class="nx">dateStyle</code><code class="o">:</code> <code class="s1">'full'</code> <code class="p">}</code>&#13;
    <code class="p">);</code>&#13;
&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">formatter</code><code class="p">.</code><code class="nx">format</code><code class="p">(</code><code class="k">new</code> <code class="nb">Date</code><code class="p">());</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'todays-date'</code><code class="p">,</code> <code class="nx">TodaysDate</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Now you can show today’s date by using this web component without any attributes or child content, as shown in <a data-type="xref" href="#example12-7">Example 12-7</a>.</p>&#13;
<div data-type="example" id="example12-7">&#13;
<h5><span class="label">Example 12-7. </span>Showing the current date</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  Today's date is: <code class="p">&lt;</code><code class="nt">todays-date</code><code class="p">&gt;&lt;/</code><code class="nt">todays-date</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id557">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When a <code>&lt;todays-date&gt;</code> element enters the DOM, the browser calls the <code>connectedCallback</code> method. In the <code>connectedCallback</code>, the <code>TodaysDate</code> class formats the current date with an <code>Intl.DateTimeFormat</code> object, which you may remember from <a data-type="xref" href="ch11.html#ch_i18n">Chapter 11</a>. The <code>connectedCallback</code> sets this formatted date string as the element’s <code>textContent</code>, which is inherited from <code>Node</code> (an ancestor of <code>HTMLElement</code>).</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Component to Format a Custom Date" data-type="sect1"><div class="sect1" id="id558">&#13;
<h1>Creating a Component to Format a Custom Date</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id302">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="date formatting" data-secondary="custom formatting" data-type="indexterm" id="ix_12-web-components-asciidoc2"/><a data-primary="web components" data-secondary="to format custom date" data-type="indexterm" id="ix_12-web-components-asciidoc3"/>You want a web component that formats an arbitrary date value.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id559">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Give the web component a <code>date</code> attribute, and use this to generate the formatted date (see <a data-type="xref" href="#example12-8">Example 12-8</a>). You can watch this attribute for changes and reformat the date if the date attribute changes.</p>&#13;
<div data-type="example" id="example12-8">&#13;
<h5><span class="label">Example 12-8. </span>A custom date component</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">DateFormatter</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="c1">// The browser will only notify the component about changes, via the</code>&#13;
  <code class="c1">// attributeChangedCallback, for attributes that are listed here.</code>&#13;
  <code class="kr">static</code> <code class="nx">observedAttributes</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'date'</code><code class="p">];</code>&#13;
&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
&#13;
    <code class="c1">// Create the format here so you don't have to</code>&#13;
    <code class="c1">// re-create it every time the date changes.</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">formatter</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Intl</code><code class="p">.</code><code class="nx">DateTimeFormat</code><code class="p">(</code>&#13;
      <code class="nx">navigator</code><code class="p">.</code><code class="nx">language</code><code class="p">,</code>&#13;
      <code class="p">{</code> <code class="nx">dateStyle</code><code class="o">:</code> <code class="s1">'full'</code> <code class="p">}</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Formats the date represented by the current value of the 'date'</code>&#13;
<code class="cm">   * attribute, if any.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">formatDate</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">hasAttribute</code><code class="p">(</code><code class="s1">'date'</code><code class="p">))</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">formatter</code><code class="p">.</code><code class="nx">format</code><code class="p">(</code>&#13;
        <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'date'</code><code class="p">))</code>&#13;
      <code class="p">);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// If no date specified, show nothing.</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">attributeChangedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// Only watching one attribute, so this must be a change</code>&#13;
    <code class="c1">// to the date attribute. Update the formatted date, if any.</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">formatDate</code><code class="p">();</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="c1">// The element was just added. Show the initial formatted date, if any.</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">formatDate</code><code class="p">();</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'date-formatter'</code><code class="p">,</code> <code class="nx">DateFormatter</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>You can now pass a date to the <code>date</code> attribute to get it formatted in the user’s locale (see <a data-type="xref" href="#example12-9">Example 12-9</a>).</p>&#13;
<div data-type="example" id="example12-9">&#13;
<h5><span class="label">Example 12-9. </span>Using the <code>date-formatter</code> element</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">date-formatter</code> <code class="na">date</code><code class="o">=</code><code class="s">"2023-10-16T03:52:49.955Z"</code><code class="p">&gt;&lt;/</code><code class="nt">date-formatter</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id171">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This recipe expands on <a data-type="xref" href="#recipe_todaysDate">“Creating a Component to Show Today’s Date”</a> by adding the ability to specify your own date via an attribute.</p>&#13;
&#13;
<p>By default, if you change the value of an attribute passed to a custom element, nothing happens. The logic in <code>connectedCallback</code> only runs when you first add the component to the DOM. To make the component react to attribute changes, you can implement the <code>attributeChangedCallback</code> method. In the <code>date-formatter</code> component, this method takes the updated <code>date</code> attribute and create a new formatted date. When an attribute changes, the browser calls this method with the attribute name, the old value, and the new value.</p>&#13;
&#13;
<p>However, this alone won’t solve the problem. If you just implement <code>attribute​Change⁠dCallback</code>, you still won’t be notified of attribute changes. This is because the browser only calls <code>attributeChangedCallback</code> for <em>observed</em> attributes. This lets you define a subset of attributes so the browser only calls <code>attributeChangedCallback</code> &#13;
<span class="keep-together">for those</span> attributes you’re interested in. To define these attributes, add a static &#13;
<span class="keep-together"><code>observedAttributes</code></span> property to your component class. This should be an array of attribute names.</p>&#13;
&#13;
<p>In the <code>date-formatter</code> component, you’re only watching one attribute (the <code>date</code> attribute). Because of this, in <code>attributeChangedCallback</code> you don’t need to check the <code>name</code> argument since you already know it’s the <code>date</code> attribute that changed. In a component with multiple watched attributes, you can check the <code>name</code> to find out which attribute has changed.</p>&#13;
&#13;
<p>If you change the value of the <code>date</code> attribute with JavaScript, the <code>attributeChangedCallback</code> will run and update the formatted date<a data-startref="ix_12-web-components-asciidoc3" data-type="indexterm" id="id1088"/><a data-startref="ix_12-web-components-asciidoc2" data-type="indexterm" id="id1089"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Feedback Component" data-type="sect1"><div class="sect1" id="id560">&#13;
<h1>Creating a Feedback Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id172">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="feedback component" data-type="indexterm" id="ix_12-web-components-asciidoc4"/><a data-primary="user feedback, reusable component for" data-type="indexterm" id="ix_12-web-components-asciidoc5"/><a data-primary="web components" data-secondary="feedback" data-type="indexterm" id="ix_12-web-components-asciidoc6"/>You want to create a reusable component where a user can provide feedback about whether or not the page is helpful.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id173">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a web component to present the feedback buttons and dispatch a custom event when the user clicks on one.</p>&#13;
&#13;
<p>First, you need to create a template element to contain the markup that this component uses, as shown in <a data-type="xref" href="#example12-10">Example 12-10</a>.</p>&#13;
<div data-type="example" id="example12-10">&#13;
<h5><span class="label">Example 12-10. </span>Creating the template</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">template</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'template'</code><code class="p">);</code>&#13;
<code class="nx">template</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`</code>&#13;
<code class="sb">  &lt;style&gt;</code>&#13;
<code class="sb">    .feedback-prompt {</code>&#13;
<code class="sb">      display: flex;</code>&#13;
<code class="sb">      align-items: center;</code>&#13;
<code class="sb">      gap: 0.5em;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    button {</code>&#13;
<code class="sb">      padding: 0.5em 1em;</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  &lt;/style&gt;</code>&#13;
&#13;
<code class="sb">  &lt;div class="feedback-prompt"&gt;</code>&#13;
<code class="sb">    &lt;p&gt;Was this helpful?&lt;/p&gt;</code>&#13;
<code class="sb">    &lt;button type="button" data-helpful="true"&gt;Yes&lt;/button&gt;</code>&#13;
<code class="sb">    &lt;button type="button" data-helpful="false"&gt;No&lt;/button&gt;</code>&#13;
<code class="sb">  &lt;/div&gt;</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre></div>&#13;
&#13;
<p><a data-primary="shadow DOM" data-type="indexterm" id="ix_12-web-components-asciidoc7"/>This component uses a shadow DOM that contains the template markup (see <a data-type="xref" href="#example12-11">Example 12-11</a>). The CSS style rules are scoped to this component only.</p>&#13;
<div data-type="example" id="example12-11">&#13;
<h5><span class="label">Example 12-11. </span>The component implementation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">FeedbackRating</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
&#13;
    <code class="c1">// Create the shadow DOM and render the template into it.</code>&#13;
    <code class="kr">const</code> <code class="nx">shadowRoot</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code> <code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code> <code class="p">});</code>&#13;
    <code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">template</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">cloneNode</code><code class="p">(</code><code class="kc">true</code><code class="p">));</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'.feedback-prompt'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code>&#13;
    <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="p">{</code> <code class="nx">helpful</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">dataset</code><code class="p">;</code>&#13;
&#13;
      <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">helpful</code> <code class="o">!==</code> <code class="s1">'undefined'</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">// Once a feedback option is chosen, hide the buttons and show a</code>&#13;
        <code class="c1">// confirmation.</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'.feedback-prompt'</code><code class="p">).</code><code class="nx">remove</code><code class="p">();</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">'Thanks for your feedback!'</code><code class="p">;</code>&#13;
&#13;
        <code class="c1">// JavaScript doesn't have a 'parseBoolean' type function, so convert the</code>&#13;
        <code class="c1">// string value to the corresponding boolean value.</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">helpful</code> <code class="o">=</code> <code class="nx">helpful</code> <code class="o">===</code> <code class="s1">'true'</code><code class="p">;</code>&#13;
&#13;
        <code class="c1">// Dispatch a custom event, so your app can be notified when a feedback</code>&#13;
        <code class="c1">// button is clicked.</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">dispatchEvent</code><code class="p">(</code><code class="k">new</code> <code class="nx">CustomEvent</code><code class="p">(</code><code class="s1">'feedback'</code><code class="p">,</code> <code class="p">{</code>&#13;
          <code class="nx">composed</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code> <code class="c1">// This is needed to "escape" the shadow DOM boundary.</code>&#13;
          <code class="nx">bubbles</code><code class="o">:</code> <code class="kc">true</code> <code class="c1">// This is needed to propagate up the DOM.</code>&#13;
        <code class="p">}));</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'feedback-rating'</code><code class="p">,</code> <code class="nx">FeedbackRating</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Now you can add this feedback component to your app (see <a data-type="xref" href="#example12-12">Example 12-12</a>).</p>&#13;
<div data-type="example" id="example12-12">&#13;
<h5><span class="label">Example 12-12. </span>Using the feedback-rating component</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Feedback</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>&#13;
<code class="o">&lt;</code><code class="nx">feedback</code><code class="o">-</code><code class="nx">rating</code><code class="o">&gt;&lt;</code><code class="err">/feedback-rating&gt;</code></pre></div>&#13;
&#13;
<p>You can listen for the custom <code>feedback</code> event to be notified when the user selects a feedback option (see <a data-type="xref" href="#example12-13">Example 12-13</a>). It’s up to you what to do with this information; maybe you want to send the data to an analytics endpoint with the Fetch API.</p>&#13;
<div data-type="example" id="example12-13">&#13;
<h5><span class="label">Example 12-13. </span>Listening for the feedback event</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'feedback-rating'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'feedback'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// Get the value of the feedback component's "helpful" property and send it to an</code>&#13;
  <code class="c1">// endpoint with a POST request.</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/analytics/feedback'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">helpful</code><code class="o">:</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">helpful</code> <code class="p">}),</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json'</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id174">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>feedback-rating</code> component presents a prompt and two buttons. The user clicks one of the two buttons depending on whether they think the website content is helpful or not.</p>&#13;
&#13;
<p>The <code>click</code> event listener uses event delegation. Instead of adding a listener to each button, it adds a single listen that responds to a click anywhere inside the feedback prompt. If the clicked element does not have a <code>data-helpful</code> attribute, then the user must not have clicked on a feedback button, so do nothing. Otherwise, it converts the string value to a boolean and sets it as a property on the custom element that can be retrieved later. It also dispatches an event that you can listen for elsewhere.</p>&#13;
&#13;
<p>In order for this event to cross the shadow DOM into the regular DOM, you must set the <code>composed: true</code> option. Otherwise, any event listener that you added to the custom element won’t be triggered.</p>&#13;
&#13;
<p>Once that event is triggered, you can check the feedback element itself (available as the <code>event.target</code> property) for the <code>helpful</code> property to determine which feedback button the user clicked.</p>&#13;
&#13;
<p>Because the styles and markup are contained in a shadow DOM, the CSS rules do not affect any elements outside of the shadow DOM. This is important to note, as otherwise an element selector like <code>button</code> would style every button on the page. Because the styles are scoped, they are only applied to buttons inside the custom element.</p>&#13;
&#13;
<p>However, the content passed to the component’s slots <em>can</em> be styled by global CSS rules. The slotted content does not move into the shadow DOM, but rather remains in the standard, or light<a data-startref="ix_12-web-components-asciidoc7" data-type="indexterm" id="id1090"/>, DOM<a data-startref="ix_12-web-components-asciidoc6" data-type="indexterm" id="id1091"/><a data-startref="ix_12-web-components-asciidoc5" data-type="indexterm" id="id1092"/><a data-startref="ix_12-web-components-asciidoc4" data-type="indexterm" id="id1093"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Profile Card Component" data-type="sect1"><div class="sect1" id="recipe_profileCard">&#13;
<h1>Creating a Profile Card Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id175">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="&lt;slot&gt; element" data-primary-sortas="slot" data-secondary="for profile card" data-type="indexterm" id="ix_12-web-components-asciidoc8"/><a data-primary="&lt;slot&gt; element" data-primary-sortas="slot" data-secondary="for profile card components" data-type="indexterm" id="ix_12-web-components-asciidoc9"/><a data-primary="profile card, web components for" data-type="indexterm" id="ix_12-web-components-asciidoc10"/><a data-primary="user profiles, profile card component for" data-type="indexterm" id="ix_12-web-components-asciidoc11"/><a data-primary="web components" data-secondary="profile cards" data-type="indexterm" id="ix_12-web-components-asciidoc12"/>You want to create a reusable card component to show a user profile.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id562">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use slots in your web component to pass content to certain regions.</p>&#13;
&#13;
<p>First, define the template with some styles and markup, as shown in <a data-type="xref" href="#example12-14">Example 12-14</a>.</p>&#13;
<div data-type="example" id="example12-14">&#13;
<h5><span class="label">Example 12-14. </span>The profile card template</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">template</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'template'</code><code class="p">);</code>&#13;
<code class="nx">template</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`</code>&#13;
<code class="sb">  &lt;style&gt;</code>&#13;
<code class="sb">    :host {</code>&#13;
<code class="sb">      display: grid;</code>&#13;
<code class="sb">      border: 1px solid #ccc;</code>&#13;
<code class="sb">      border-radius: 5px;</code>&#13;
<code class="sb">      padding: 8px;</code>&#13;
<code class="sb">      grid-template-columns: auto 1fr;</code>&#13;
<code class="sb">      column-gap: 16px;</code>&#13;
<code class="sb">      align-items: center;</code>&#13;
<code class="sb">      margin: 1rem;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    .photo {</code>&#13;
<code class="sb">      border-radius: 50%;</code>&#13;
<code class="sb">      grid-row: 1 / span 3;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    .name {</code>&#13;
<code class="sb">      font-size: 2rem;</code>&#13;
<code class="sb">      font-weight: bold;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    .title {</code>&#13;
<code class="sb">      font-weight: bold;</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  &lt;/style&gt;</code>&#13;
&#13;
<code class="sb">  &lt;div class="photo"&gt;&lt;slot name="photo"&gt;&lt;/slot&gt;&lt;/div&gt;</code>&#13;
<code class="sb">  &lt;div class="name"&gt;&lt;slot name="name"&gt;&lt;/slot&gt;&lt;/div&gt;</code>&#13;
<code class="sb">  &lt;div class="title"&gt;&lt;slot name="title"&gt;&lt;/slot&gt;&lt;/div&gt;</code>&#13;
<code class="sb">  &lt;div class="bio"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/div&gt;</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre></div>&#13;
&#13;
<p>This template has three named slots (photo, name, and title) and one default slot for the biography. The component implementation itself is rather minimal; it just creates and attaches a shadow root with the template (see <a data-type="xref" href="#example12-15">Example 12-15</a>).</p>&#13;
<div data-type="example" id="example12-15">&#13;
<h5><span class="label">Example 12-15. </span>The component implementation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">ProfileCard</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code> <code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code> <code class="p">});</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">template</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">cloneNode</code><code class="p">(</code><code class="kc">true</code><code class="p">));</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'profile-card'</code><code class="p">,</code> <code class="nx">ProfileCard</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>To use the component, you can specify the <code>slot</code> attribute on child elements to specify which slot the content should go into (see <a data-type="xref" href="#example12-16">Example 12-16</a>). The biography element, which does not have a <code>slot</code> attribute, is placed in the default slot.</p>&#13;
<div data-type="example" id="example12-16">&#13;
<h5><span class="label">Example 12-16. </span>Using the profile card</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">profile-card</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">img</code> <code class="na">slot</code><code class="o">=</code><code class="s">"photo"</code> <code class="na">src</code><code class="o">=</code><code class="s">"/api/portraits/chavez.jpg"</code> <code class="p">/&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"name"</code><code class="p">&gt;</code>Phillip Chavez<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"title"</code><code class="p">&gt;</code>CEO<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Philip is a great CEO.<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">profile-card</code><code class="p">&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">profile-card</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">img</code> <code class="na">slot</code><code class="o">=</code><code class="s">"photo"</code> <code class="na">src</code><code class="o">=</code><code class="s">"/api/portraits/lynch.jpg"</code> <code class="p">/&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"name"</code><code class="p">&gt;</code>Jamie Lynch<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"title"</code><code class="p">&gt;</code>Vice President<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Jamie is a great vice president.<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">profile-card</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#img_profileCard">Figure 12-1</a> shows the rendered result of the profile card component.</p>&#13;
&#13;
<figure><div class="figure" id="img_profileCard">&#13;
<img alt="The rendered profile card" src="assets/wacb_1201.png"/>&#13;
<h6><span class="label">Figure 12-1. </span>The rendered profile card</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id176">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>In the CSS styles, you might have noticed the <code>:host</code> selector, which represents styles that are applied to the custom element’s <em>shadow host</em>. This is the element that the shadow DOM is attached to.</p>&#13;
&#13;
<p>With this example, you can see how web components let you create reusable content and layouts. Slots are a powerful tool that enables you to insert content exactly where it’s needed<a data-startref="ix_12-web-components-asciidoc12" data-type="indexterm" id="id1094"/><a data-startref="ix_12-web-components-asciidoc11" data-type="indexterm" id="id1095"/><a data-startref="ix_12-web-components-asciidoc10" data-type="indexterm" id="id1096"/><a data-startref="ix_12-web-components-asciidoc9" data-type="indexterm" id="id1097"/><a data-startref="ix_12-web-components-asciidoc8" data-type="indexterm" id="id1098"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Lazy Loading Image Component" data-type="sect1"><div class="sect1" id="id563">&#13;
<h1>Creating a Lazy Loading Image Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id303">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="images" data-secondary="lazy loading components" data-type="indexterm" id="ix_12-web-components-asciidoc13"/><a data-primary="IntersectionObserver" data-secondary="for lazy loading image component" data-type="indexterm" id="ix_12-web-components-asciidoc14"/><a data-primary="lazy loading" data-secondary="for images" data-type="indexterm" id="ix_12-web-components-asciidoc15"/><a data-primary="web components" data-secondary="lazy loading images" data-type="indexterm" id="ix_12-web-components-asciidoc16"/>You want a reusable component that contains an image that isn’t loaded until it scrolls into the viewport.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id564">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use an <code>IntersectionObserver</code> to wait for the element to scroll into view, then set the <code>src</code> element on the contained image.</p>&#13;
&#13;
<p>This recipe adapts <a data-type="xref" href="ch06.html#recipe_lazyImage">“Lazy Loading an Image When Scrolled into View”</a> from <a data-type="xref" href="ch06.html#ch_observers">Chapter 6</a>, presenting its solution inside a web component (see Examples <a data-type="xref" data-xrefstyle="select:labelnumber" href="#example12-17">12-17</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#example12-18">12-18</a>).</p>&#13;
<div data-type="example" id="example12-17">&#13;
<h5><span class="label">Example 12-17. </span>The <code>LazyImage</code> component</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">LazyImage</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
&#13;
    <code class="kr">const</code> <code class="nx">shadowRoot</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code> <code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code> <code class="p">});</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">image</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'img'</code><code class="p">);</code>&#13;
    <code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">image</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">observer</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">IntersectionObserver</code><code class="p">(</code><code class="nx">entries</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="k">if</code> <code class="p">(</code><code class="nx">entries</code><code class="p">[</code><code class="mi">0</code><code class="p">].</code><code class="nx">isIntersecting</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Loading image'</code><code class="p">);</code>&#13;
        <code class="k">this</code><code class="p">.</code><code class="nx">image</code><code class="p">.</code><code class="nx">src</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'src'</code><code class="p">);</code>&#13;
        <code class="nx">observer</code><code class="p">.</code><code class="nx">disconnect</code><code class="p">();</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
&#13;
    <code class="nx">observer</code><code class="p">.</code><code class="nx">observe</code><code class="p">(</code><code class="k">this</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'lazy-image'</code><code class="p">,</code> <code class="nx">LazyImage</code><code class="p">);</code></pre></div>&#13;
<div data-type="example" id="example12-18">&#13;
<h5><span class="label">Example 12-18. </span>Using the <code>LazyImage</code> component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">lazy-image</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://placekitten.com/200/138"</code><code class="p">&gt;&lt;/</code><code class="nt">lazy-image</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id177">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Once the element scrolls into view, the <code>IntersectionObserver</code> callback gets the <code>src</code> attribute and sets it as the image’s <code>src</code> attribute, which triggers the image to load.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This example illustrates how to create a custom element that extends a built-in element, but for lazy loading images you may not need it. Newer browsers support the <code>loading="lazy"</code> attribute on <code>img</code> tags, which has the same effect—the image is not loaded until it scrolls into view<a data-startref="ix_12-web-components-asciidoc16" data-type="indexterm" id="id1099"/><a data-startref="ix_12-web-components-asciidoc15" data-type="indexterm" id="id1100"/><a data-startref="ix_12-web-components-asciidoc14" data-type="indexterm" id="id1101"/><a data-startref="ix_12-web-components-asciidoc13" data-type="indexterm" id="id1102"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Disclosure Component" data-type="sect1"><div class="sect1" id="recipe_disclosure">&#13;
<h1>Creating a Disclosure Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id178">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="&lt;slot&gt; element" data-primary-sortas="slot" data-secondary="for disclosure web component" data-type="indexterm" id="ix_12-web-components-asciidoc17"/><a data-primary="disclosure web component" data-type="indexterm" id="ix_12-web-components-asciidoc18"/><a data-primary="web components" data-secondary="disclosure" data-type="indexterm" id="ix_12-web-components-asciidoc19"/>You want to show or hide some content by clicking a button. For example, you may have an “Advanced” section of a form that is collapsed by default, but can be expanded by clicking a button.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id566">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Build a disclosure web component. The component has two parts: the button that toggles the content, and the content itself. Each of these two parts will have a slot. The default slot will be for the content, and there will be a named slot for the button. This component can also be expanded or collapsed programmatically by changing the value of its <code>open</code> attribute.</p>&#13;
&#13;
<p>First, define the template for the disclosure component, as shown in <a data-type="xref" href="#example12-19">Example 12-19</a>.</p>&#13;
<div data-type="example" id="example12-19">&#13;
<h5><span class="label">Example 12-19. </span>The disclosure component template</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">template</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'template'</code><code class="p">);</code>&#13;
<code class="nx">template</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`</code>&#13;
<code class="sb">  &lt;div&gt;</code>&#13;
<code class="sb">    &lt;button type="button" class="toggle-button"&gt;</code>&#13;
<code class="sb">      &lt;slot name="title"&gt;&lt;/slot&gt;</code>&#13;
<code class="sb">    &lt;/button&gt;</code>&#13;
<code class="sb">    &lt;div class="content"&gt;</code>&#13;
<code class="sb">      &lt;slot&gt;&lt;/slot&gt;</code>&#13;
<code class="sb">    &lt;/div&gt;</code>&#13;
<code class="sb">  &lt;/div&gt;</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre></div>&#13;
&#13;
<p>The component implementation is shown in <a data-type="xref" href="#example12-20">Example 12-20</a>.</p>&#13;
<div data-type="example" id="example12-20">&#13;
<h5><span class="label">Example 12-20. </span>The disclosure component implementation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">Disclosure</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="c1">// Watch the 'open' attribute to react to changes.</code>&#13;
  <code class="kr">static</code> <code class="nx">observedAttributes</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'open'</code><code class="p">];</code>&#13;
&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code> <code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code> <code class="p">});</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">template</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">cloneNode</code><code class="p">(</code><code class="kc">true</code><code class="p">));</code>&#13;
&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">content</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'.content'</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">connectedCallback</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">hidden</code> <code class="o">=</code> <code class="o">!</code><code class="k">this</code><code class="p">.</code><code class="nx">hasAttribute</code><code class="p">(</code><code class="s1">'open'</code><code class="p">);</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'.toggle-button'</code><code class="p">)</code>&#13;
      <code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">hasAttribute</code><code class="p">(</code><code class="s1">'open'</code><code class="p">))</code> <code class="p">{</code>&#13;
          <code class="c1">// Content is currently showing; remove the 'open'</code>&#13;
          <code class="c1">// attribute and hide the content.</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">removeAttribute</code><code class="p">(</code><code class="s1">'open'</code><code class="p">);</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">hidden</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
        <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
          <code class="c1">// Content is currently hidden; add the 'open' attribute</code>&#13;
          <code class="c1">// and show the content.</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'open'</code><code class="p">,</code> <code class="s1">''</code><code class="p">);</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">hidden</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">});</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">attributeChangedCallback</code><code class="p">(</code><code class="nx">name</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">,</code> <code class="nx">newValue</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// Update the content's hidden state based on the new attribute value.</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">newValue</code> <code class="o">!==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">hidden</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">hidden</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// The element name must be hyphenated.</code>&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'x-disclosure'</code><code class="p">,</code> <code class="nx">Disclosure</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>One last thing—you need to add a small bit of CSS to the page. Otherwise, the child content will flicker on the page for a moment, then disappear. This is because before the custom element is registered, it has no behavior, and the browser isn’t aware of its slots. This means that any child content will be rendered in the page.</p>&#13;
&#13;
<p>Then, once the custom element is defined, the child content moves into the slot and disappears.</p>&#13;
&#13;
<p>To fix this, you can use CSS to hide the element’s content until it is registered by using the <code>:defined</code> pseudo-class.</p>&#13;
<div data-type="example" id="example12-21">&#13;
<h5><span class="label">Example 12-21. </span>Fixing the flicker issue</h5>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">x-disclosure</code><code class="nd">:not</code><code class="o">(</code><code class="nd">:defined</code><code class="o">)</code> <code class="p">{</code>&#13;
  <code class="k">display</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>This will initially hide the content. Once the custom element becomes defined, the element is shown. You won’t see the flicker because the content has already been moved to the slot.</p>&#13;
&#13;
<p>Finally, you can use the disclosure element, as shown in <a data-type="xref" href="#example12-22">Example 12-22</a>.</p>&#13;
<div data-type="example" id="example12-22">&#13;
<h5><span class="label">Example 12-22. </span>Using the disclosure element</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">x-disclosure</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"title"</code><code class="p">&gt;</code>Details<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  This is the detail child content that will be expanded or collapsed&#13;
  when clicking the title button.&#13;
<code class="p">&lt;/</code><code class="nt">x-disclosure</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>The toggle button will have the text “Details,” since that is placed in the <code>title</code> slot. The remaining content is placed in the default slot.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id179">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The disclosure component uses its <code>open</code> attribute to determine whether or not to show the child content. When the toggle button is clicked, it adds or removes the attribute depending on the current state, then conditionally applies the <code>hidden</code> attribute to the child content.</p>&#13;
&#13;
<p>You can also programmatically toggle the child content by adding or removing the <code>open</code> attribute. This works because the component is observing the <code>open</code> attribute. If you change it with JavaScript, or even in the browser developer tools, the browser calls the component’s <code>attributeChangedCallback</code> method with the new value.</p>&#13;
&#13;
<p>The <code>open</code> attribute does not have a value. If you want the content to be open by default, simply add the <code>open</code> attribute with no value, as shown in <a data-type="xref" href="#code_showContentDefault">Example 12-23</a>.</p>&#13;
<div data-type="example" id="code_showContentDefault">&#13;
<h5><span class="label">Example 12-23. </span>Showing the content by default</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">x-disclosure</code> <code class="na">open</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">slot</code><code class="o">=</code><code class="s">"title"</code><code class="p">&gt;</code>Details<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  This is the detail child content that will be expanded or collapsed&#13;
  when clicking the title button.&#13;
<code class="p">&lt;/</code><code class="nt">x-disclosure</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>If you remove the attribute, the <code>newValue</code> argument to <code>attributeChangedCallback</code> will be <code>null</code>. In that case, it will hide the child content by applying the <code>hidden</code> attribute. If you add the attribute with no value, as shown in <a data-type="xref" href="#code_showContentDefault">Example 12-23</a>, the <code>newValue</code> argument will be an empty string. If that’s the case, it will remove the <code>hidden</code> attribute<a data-startref="ix_12-web-components-asciidoc19" data-type="indexterm" id="id1103"/><a data-startref="ix_12-web-components-asciidoc18" data-type="indexterm" id="id1104"/><a data-startref="ix_12-web-components-asciidoc17" data-type="indexterm" id="id1105"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Styled Button Component" data-type="sect1"><div class="sect1" id="id567">&#13;
<h1>Creating a Styled Button Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id180">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="button component, styled" data-type="indexterm" id="ix_12-web-components-asciidoc20"/><a data-primary="styled button component" data-type="indexterm" id="ix_12-web-components-asciidoc21"/><a data-primary="web components" data-secondary="styled button component" data-type="indexterm" id="ix_12-web-components-asciidoc22"/>You want to create a reusable button component with different style options.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id568">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>There will be three variants of the button:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>the default variant, with a gray background</p>&#13;
</li>&#13;
<li>&#13;
<p>the “primary” variant, with a blue background</p>&#13;
</li>&#13;
<li>&#13;
<p>the “danger” variant, with a red background</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>First, create the template with the custom button styling, along with CSS classes for the “primary” and “danger” variants, as shown in <a data-type="xref" href="#example12-24">Example 12-24</a>.</p>&#13;
<div data-type="example" id="example12-24">&#13;
<h5><span class="label">Example 12-24. </span>The button template</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">template</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'template'</code><code class="p">);</code>&#13;
<code class="nx">template</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`</code>&#13;
<code class="sb">  &lt;style&gt;</code>&#13;
<code class="sb">    button {</code>&#13;
<code class="sb">      background: #333;</code>&#13;
<code class="sb">      padding: 0.5em 1.25em;</code>&#13;
<code class="sb">      font-size: 1rem;</code>&#13;
<code class="sb">      border: none;</code>&#13;
<code class="sb">      border-radius: 5px;</code>&#13;
<code class="sb">      color: white;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    button.primary {</code>&#13;
<code class="sb">      background: #2563eb;</code>&#13;
<code class="sb">    }</code>&#13;
&#13;
<code class="sb">    button.danger {</code>&#13;
<code class="sb">      background: #dc2626;</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  &lt;/style&gt;</code>&#13;
&#13;
<code class="sb">  &lt;button&gt;</code>&#13;
<code class="sb">    &lt;slot&gt;&lt;/slot&gt;</code>&#13;
<code class="sb">  &lt;/button&gt;</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre></div>&#13;
&#13;
<p>Most of this template is the CSS. The actual markup for the component itself is quite simple: just a button element with a default slot.</p>&#13;
&#13;
<p>The component itself will support two attributes:</p>&#13;
<dl>&#13;
<dt><code>variant</code></dt>&#13;
<dd>&#13;
<p>The name of the button variant (<code>primary</code> or <code>danger</code>)</p>&#13;
</dd>&#13;
<dt><code>type</code></dt>&#13;
<dd>&#13;
<p>The <code>type</code> attribute that is passed into the underlying <code>button</code> element. Set this to <code>button</code> to prevent submitting a form (see <a data-type="xref" href="#example12-25">Example 12-25</a>).</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="example" id="example12-25">&#13;
<h5><span class="label">Example 12-25. </span>The button component</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">class</code> <code class="nx">StyledButton</code> <code class="kr">extends</code> <code class="nx">HTMLElement</code> <code class="p">{</code>&#13;
  <code class="kr">static</code> <code class="nx">observedAttributes</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'variant'</code><code class="p">,</code> <code class="s1">'type'</code><code class="p">];</code>&#13;
&#13;
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">super</code><code class="p">();</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">attachShadow</code><code class="p">({</code> <code class="nx">mode</code><code class="o">:</code> <code class="s1">'open'</code> <code class="p">});</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">template</code><code class="p">.</code><code class="nx">content</code><code class="p">.</code><code class="nx">cloneNode</code><code class="p">(</code><code class="kc">true</code><code class="p">));</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">button</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">shadowRoot</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'button'</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">attributeChangedCallback</code><code class="p">(</code><code class="nx">name</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">,</code> <code class="nx">newValue</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">name</code> <code class="o">===</code> <code class="s1">'variant'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">button</code><code class="p">.</code><code class="nx">className</code> <code class="o">=</code> <code class="nx">newValue</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">name</code> <code class="o">===</code> <code class="s1">'type'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">this</code><code class="p">.</code><code class="nx">button</code><code class="p">.</code><code class="nx">type</code> <code class="o">=</code> <code class="nx">newValue</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">customElements</code><code class="p">.</code><code class="nx">define</code><code class="p">(</code><code class="s1">'styled-button'</code><code class="p">,</code> <code class="nx">StyledButton</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>To add a click listener, you actually don’t have to do any further work. You can add a click listener to the <code>styled-button</code> element and it will be triggered when you click the underlying button, thanks to event delegation. With event delegation, you can add an event listener to a parent element, and events on its children will also trigger the parent’s event listener.</p>&#13;
&#13;
<p>Finally, here is how you use the <code>styled-button</code> component (see <a data-type="xref" href="#example12-26">Example 12-26</a>).</p>&#13;
<div data-type="example" id="example12-26">&#13;
<h5><span class="label">Example 12-26. </span>Using the <code>styled-button</code> component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">style</code><code class="na">d-button</code> <code class="na">id</code><code class="o">=</code><code class="s">"default-button"</code> <code class="na">type</code><code class="o">=</code><code class="s">"button"</code><code class="p">&gt;</code><code class="err">Default&lt;/styled-button&gt;</code><code class="w"/>&#13;
<code class="p">&lt;</code><code class="nt">style</code><code class="na">d-button</code> <code class="na">id</code><code class="o">=</code><code class="s">"primary-button"</code> <code class="na">type</code><code class="o">=</code><code class="s">"button"</code> <code class="na">variant</code><code class="o">=</code><code class="s">"primary"</code><code class="p">&gt;</code><code class="w"/>&#13;
  Primary&#13;
<code class="p">&lt;/</code><code class="nt">styled-button</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">style</code><code class="na">d-button</code> <code class="na">id</code><code class="o">=</code><code class="s">"danger-button"</code> <code class="na">type</code><code class="o">=</code><code class="s">"button"</code> <code class="na">variant</code><code class="o">=</code><code class="s">"danger"</code><code class="p">&gt;</code><code class="w"/>&#13;
  Danger&#13;
<code class="p">&lt;/</code><code class="nt">styled-button</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id181">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The styling is applied by setting a class name on the button element equal to the variant name. This will cause the corresponding CSS rule to apply the desired background color.</p>&#13;
&#13;
<p>You don’t need to have any code in the <code>connectedCallback</code> to apply the class, because the browser will call the <code>attributeChangedCallback</code> with the initial values as well as any subsequently updated values.</p>&#13;
&#13;
<p>You can add a click event listener to the <code>styled-button</code> in the same way as you would a normal button (see <a data-type="xref" href="#example12-27">Example 12-27</a>)<a data-startref="ix_12-web-components-asciidoc22" data-type="indexterm" id="id1106"/><a data-startref="ix_12-web-components-asciidoc21" data-type="indexterm" id="id1107"/><a data-startref="ix_12-web-components-asciidoc20" data-type="indexterm" id="id1108"/>.<a data-startref="ix_12-web-components-asciidoc0" data-type="indexterm" id="id1109"/></p>&#13;
<div data-type="example" id="example12-27">&#13;
<h5><span class="label">Example 12-27. </span>Adding a click listener</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#default-button'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Clicked the default button'</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">style</code><code class="na">d-button</code> <code class="na">id</code><code class="o">=</code><code class="s">"default-button"</code> <code class="na">type</code><code class="o">=</code><code class="s">"button"</code><code class="p">&gt;</code><code class="err">Default&lt;/styled-button&gt;</code><code class="w"/></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>