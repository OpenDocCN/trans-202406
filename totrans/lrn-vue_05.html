<html><head></head><body><section data-pdf-bookmark="Chapter 5. Composition API" data-type="chapter" epub:type="chapter"><div class="chapter" id="unique_chapter_id_06">&#13;
<h1><span class="label">Chapter 5. </span>Composition API</h1>&#13;
&#13;
&#13;
<p>In the previous chapter, you learned how to compose Vue components using the classic Options API. Despite it being the most common API for composing Vue components since Vue 2, using Options API can lead to unnecessary code complexity, unreadability for large component code, and logic reusability between them. For such use cases, this chapter introduces an alternative approach for composing Vue components, the Composition API.</p>&#13;
&#13;
<p>In this chapter, we will explore the different composition hooks to create a functional stateful element in Vue. We also will learn how to combine Options API and Composition API for better reactive control and to compose our own reusable composable for our application.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Setting Up Components with Composition API" data-type="sect1"><div class="sect1" id="id148">&#13;
<h1>Setting Up Components with Composition API</h1>&#13;
&#13;
<p>Composing components using the Options API is a common practice in Vue. However, in many cases, we want to reuse part of the component logic without worrying about the overlapping data and methods like in mixins<sup><a data-type="noteref" href="ch05.html#id998" id="id998-marker">1</a></sup>, or a component that is more readable and organized. Composition API can be helpful in such scenarios<a data-primary="setup hook" data-secondary="Composition API and" data-type="indexterm" id="id999"/><a data-primary="Composition API" data-secondary="setup hook and" data-type="indexterm" id="id1000"/><a data-primary="Options API" data-secondary="disadvantages" data-type="indexterm" id="id1001"/>.</p>&#13;
&#13;
<p>Introduced in Vue 3.0, Composition API provides an alternative way to compose stateful and reactive components with the help of the <code>setup()</code> hook (<a data-type="xref" href="ch03.html#setup_hook_03">“setup”</a>) or <code>&lt;script setup&gt;</code> tag. The <code>setup()</code> hook is part of the component’s options object and runs <em>once</em> before initializing and creating the component instance (before <code>beforeCreate()</code> hook).</p>&#13;
&#13;
<p>You can <em>only</em> use Composition API functions or composables (<a data-type="xref" href="#reusable_hooks_06">“Creating Your Reusable Composables”</a>) within this hook or its equivalent syntax <code>&lt;script setup&gt;</code> tag. This combination creates a stateful functional component and provides an excellent place to define the component’s reactive state and methods and initialize other lifecycle hooks (see <a data-type="xref" href="#lifecycle_hooks_03">“Using the Lifecycle Hooks”</a>) with more straightforward code readability.</p>&#13;
&#13;
<p>Let’s explore the power of Composition API, starting with <code>ref()</code> and <code>reactive()</code> functions to handle your component’s reactive data.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Handling Data with ref() and reactive()" data-type="sect1"><div class="sect1" id="ref_function_06">&#13;
<h1>Handling Data with ref() and reactive()</h1>&#13;
&#13;
<p>In <a data-type="xref" href="ch02.html#unique_chapter_id_02">Chapter 2</a>, you learned about the <code>data()</code> function property in the Options API for initializing the component’s data (<a data-type="xref" href="ch02.html#local_state">“Creating Local State with Data Properties”</a>). All the data properties in the returned object from <code>data()</code> are reactive, meaning the Vue engine will automatically watch for changes on each declared data property. However, this default functionality may cause overhead in your component when you have many data properties, most of which are static. In such cases, the Vue engine still enables watchers for these static values, which is unnecessary. To limit the number of excessive data watchers and to have more control over which data properties to observe, Vue introduced the <code>ref()</code> and <code>reactive()</code> functions in the Composition API<a data-primary="Composition API" data-secondary="data handling with ref()" data-type="indexterm" id="ix-comp-api1"/><a data-primary="data" data-secondary="handling with ref()" data-type="indexterm" id="ix-comp-api1a"/><a data-primary="reactivity" data-secondary="ref() and" data-type="indexterm" id="ix-comp-api1b"/><a data-primary="ref()" data-secondary="handling data with" data-type="indexterm" id="ix-comp-api1c"/><a data-primary="ref object" data-type="indexterm" id="ix-comp-api1d"/><a data-primary="Composition API" data-secondary="data handling with reactive()" data-type="indexterm" id="id1002"/><a data-primary="data" data-secondary="handling with reactive()" data-type="indexterm" id="id1003"/><a data-primary="reactive()" data-type="indexterm" id="id1004"/>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using ref()" data-type="sect2"><div class="sect2" id="id67">&#13;
<h2>Using ref()</h2>&#13;
&#13;
<p><code>ref()</code> is a function that accepts a single argument and returns a reactive object with that argument as its initial value. We call this returned object the <code>ref</code> object:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="p">{</code>&#13;
  <code class="nx">setup</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">message</code> <code class="o">=</code> <code class="nx">ref</code><code class="p">(</code><code class="s2">"Hello World"</code><code class="p">)</code>&#13;
    <code class="k">return</code> <code class="p">{</code> <code class="nx">message</code> <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Or in <code>&lt;script setup&gt;</code>:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s2">"Hello World"</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>We then can access the return object’s current value through its single <code>value</code> property within the <code>script</code> section. For example, the code in <a data-type="xref" href="#example_01_06">Example 5-1</a> creates a reactive object with the initial value of 0<a data-primary="value property, accessing ref object" data-type="indexterm" id="id1005"/>.</p>&#13;
<div data-type="example" id="example_01_06">&#13;
<h5><span class="label">Example 5-1. </span>Using <code>ref()</code> to create a reactive message with an initial value of &#13;
<span class="keep-together">“Hello World”</span></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">message</code> <code class="o">=</code> <code class="nx">ref</code><code class="p">(</code><code class="s2">"Hello World"</code><code class="p">)</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code> <code class="c1">//Hello World</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you use Options API with <code>setup()</code> hook, you can access <code>message</code> in other part of component’s without <code>.value</code>, i.e., <code>message</code> is &#13;
<span class="keep-together">sufficient</span><a data-primary="setup hook" data-secondary="Options API and" data-type="indexterm" id="id1006"/>.</p>&#13;
</div>&#13;
&#13;
<p>However, in the <code>template</code> tag section, you can retrieve its value directly without the <code>value</code> property. For example, the code in <a data-type="xref" href="#example_02_06">Example 5-2</a> will print the same <code>message</code> as <a data-type="xref" href="#example_01_06">Example 5-1</a>, but to the browser.</p>&#13;
<div data-type="example" id="example_02_06">&#13;
<h5><span class="label">Example 5-2. </span>Accessing <code>message</code> value in the <code>template</code> section</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>{{ message }}<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s2">"Hello World"</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>ref()</code> function infers types for the return object from the initial value passed. If you explicitly want to define the type of the return object, you can use the TypeScript syntax <code>ref&lt;type&gt;()</code>, such as <code>ref&lt;string&gt;()</code><a data-primary="types" data-secondary="specifying return object type in ref()" data-type="indexterm" id="id1007"/><a data-primary="types" data-secondary="type inference and ref()" data-type="indexterm" id="id1008"/><a data-primary="TypeScript" data-secondary="specifying return object type in ref()" data-type="indexterm" id="id1009"/>.</p>&#13;
</div>&#13;
&#13;
<p>Since the ref object is reactive and mutable, we can change its value by assigning a new value to its <code>value</code> property. The Vue engine then will trigger the relevant watchers and update the component.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#example_03_06">Example 5-3</a>, we will re-create the <code>MyMessageComponent</code> (from <a data-type="xref" href="ch03.html#example_03_03">Example 3-3</a> with Options API), which accepts input from the user and changes the <code>message</code> displayed.</p>&#13;
<div data-type="example" id="example_03_06">&#13;
<h5><span class="label">Example 5-3. </span>Using <code>ref()</code> to create a reactive <code>MyMessageComponent</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">h2</code> <code class="na">class</code><code class="o">=</code><code class="s">"heading"</code><code class="p">&gt;</code>{{ message }}<code class="p">&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">v-model</code><code class="o">=</code><code class="s">"message"</code> <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s2">"Welcome to Vue 3!"</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>When we change the input field’s value, the browser will show the updated <code>message</code> value accordingly, as shown in <a data-type="xref" href="#figure_06_03_06">Figure 5-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_06_03_06">&#13;
<img alt="A screenshot of the browser showing the updated message value" src="assets/lvue_0501.png"/>&#13;
<h6><span class="label">Figure 5-1. </span>The value displayed changes when we change the input field’s value</h6>&#13;
</div></figure>&#13;
&#13;
<p>In the Vue tab of the browser’s Developer Tools, we can see ref object <code>message</code> listed under the <code>setup</code> section, with the indication <code>Ref</code> (<a data-type="xref" href="#figure_05_06a">Figure 5-2</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_05_06a">&#13;
<img alt="A screenshot of the browser's Vue tab showing the ref object" src="assets/lvue_0502.png"/>&#13;
<h6><span class="label">Figure 5-2. </span>The <code>message</code> ref object is listed under the <code>setup</code> section</h6>&#13;
</div></figure>&#13;
&#13;
<p>If we add another static data <code>title</code> to the component (<a data-type="xref" href="#example_05_06">Example 5-4</a>), the Vue tab will show the <code>title</code> data property without the indication (<a data-type="xref" href="#figure_05_06">Figure 5-3</a>).</p>&#13;
<div data-type="example" id="example_05_06">&#13;
<h5><span class="label">Example 5-4. </span>Adding static <code>title</code> to <code>MyMessageComponent</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code>{{ title }}<code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">h2</code> <code class="na">class</code><code class="o">=</code><code class="s">"heading"</code><code class="p">&gt;</code>{{ message }}<code class="p">&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">v-model</code><code class="o">=</code><code class="s">"message"</code> <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">title</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s2">"My Message Component"</code><code class="w"/>&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s2">"Welcome to Vue 3!"</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<figure><div class="figure" id="figure_05_06">&#13;
<img alt="A screenshot of the browser's Vue tab showing the data property without the indication" src="assets/lvue_0503.png"/>&#13;
<h6><span class="label">Figure 5-3. </span>The <code>title</code> data property is listed without the indication</h6>&#13;
</div></figure>&#13;
&#13;
<p>The previous code (<a data-type="xref" href="#example_05_06">Example 5-4</a>) is equivalent to <a data-type="xref" href="#example_06_06">Example 5-5</a> with <code>setup()</code> hook<a data-primary="Composition API" data-secondary="setup hook and" data-type="indexterm" id="id1010"/><a data-primary="set, Composition API and" data-type="indexterm" id="id1011"/>.</p>&#13;
<div data-type="example" id="example_06_06">&#13;
<h5><span class="label">Example 5-5. </span>Using <code>setup()</code> hook to create a reactive <code>MyMessageComponent</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">h2</code> <code class="na">class</code><code class="o">=</code><code class="s">"heading"</code><code class="p">&gt;</code>{{ message }}<code class="p">&lt;/</code><code class="nt">h2</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">v-model</code><code class="o">=</code><code class="s">"message"</code> <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setup</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s2">"Welcome to Vue 3!"</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">            </code><code class="nx">message</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>You can use the <code>ref()</code> function to create a reactive object for any primitive type (such as <code>string</code>, <code>number</code>, <code>boolean</code>, <code>null</code>, <code>undefined</code>, etc.) and any object type. However, for the object type such as array and object, the <code>ref()</code> returns an intensely reactive object, meaning both the ref object and its nested properties are mutable, as seen in <a data-type="xref" href="#example_07_06">Example 5-6</a>.</p>&#13;
<div data-type="example" id="example_07_06">&#13;
<h5><span class="label">Example 5-6. </span>Using <code>ref()</code> to create a deeply reactive object</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">ref</code><code class="p">({</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Maya"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">})</code>&#13;
&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Rachel"</code>&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Samuel"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code> <code class="c1">// { name: "Samuel", age: 20 }</code></pre></div>&#13;
&#13;
<p>In <a data-type="xref" href="#example_07_06">Example 5-6</a>, we can replace the property <code>name</code> of <code>user</code> and the entire <code>user</code> object with a new value. We consider this case a <em>bad practice</em> in Vue, which can lead to performance issues for large data structures, and unexpected behaviors. To avoid falling into such a situation, I would recommend that you use the <code>shallowRef()</code> and &#13;
<span class="keep-together"><code>reactive()</code></span> functions instead, depending on your use case<a data-primary="shallowRef()" data-type="indexterm" id="id1012"/><a data-primary="performance" data-secondary="ref()" data-type="indexterm" id="id1013"/>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>If you want to create a reactive object-type data and <em>replace it later on with new value</em>, use <code>shallowRef()</code>. A good example is integrating the component with asynchronous data fetching with the help of lifecycle composition hooks, as seen in <a data-type="xref" href="#example_08_06">Example 5-7</a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>If you want to create a reactive object-type data and <em>update its properties only</em>, use <code>reactive()</code>, which we will cover in the next section<a data-primary="Composition API" data-secondary="data handling with reactive()" data-type="indexterm" id="ix-comp-api2"/><a data-primary="data" data-secondary="handling with reactive()" data-type="indexterm" id="ix-comp-api2a"/><a data-primary="reactive()" data-type="indexterm" id="ix-comp-api2b"/>.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="example" id="example_08_06">&#13;
<h5><span class="label">Example 5-7. </span>Using <code>shallowRef()</code> to manage external data fetching</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code> </code><code class="na">setup</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">shallowRef</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"vue"</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="nx">type</code><code class="w"> </code><code class="nx">User</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
    </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="nx">string</code><code class="p">;</code><code class="w">&#13;
    </code><code class="nx">bio</code><code class="o">:</code><code class="w"> </code><code class="nx">string</code><code class="p">;</code><code class="w">&#13;
    </code><code class="nx">avatar_url</code><code class="o">:</code><code class="w"> </code><code class="nx">string</code><code class="p">;</code><code class="w">&#13;
    </code><code class="nx">twitter_username</code><code class="o">:</code><code class="w"> </code><code class="nx">string</code><code class="p">;</code><code class="w">&#13;
    </code><code class="nx">blog</code><code class="o">:</code><code class="w"> </code><code class="nx">string</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">}</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">shallowRef</code><code class="p">&lt;</code><code class="nt">User</code><code class="p">&gt;</code><code class="p">(</code><code class="p">{</code><code class="w"> </code><a class="co" href="#callout_composition_api_CO1-1" id="co_composition_api_CO1-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
    </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="s2">""</code><code class="p">,</code><code class="w">&#13;
    </code><code class="nx">bio</code><code class="o">:</code><code class="w"> </code><code class="s2">""</code><code class="p">,</code><code class="w">&#13;
    </code><code class="nx">avatar_url</code><code class="o">:</code><code class="w"> </code><code class="s2">""</code><code class="p">,</code><code class="w">&#13;
    </code><code class="nx">twitter_username</code><code class="o">:</code><code class="w"> </code><code class="s2">""</code><code class="p">,</code><code class="w">&#13;
    </code><code class="nx">blog</code><code class="o">:</code><code class="w"> </code><code class="s2">""</code><code class="p">,</code><code class="w">&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">error</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">shallowRef</code><code class="p">&lt;</code><code class="nt">Error</code><code> </code><code class="err">|</code><code> </code><code class="na">undefined</code><code class="p">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_composition_api_CO1-2" id="co_composition_api_CO1-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">fetchData</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="p">(</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
    </code><code class="k">try</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
        </code><code class="kd">const</code><code class="w"> </code><code class="nx">response</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.github.com/users/mayashavin"</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
&#13;
        </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">ok</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
            </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="k">await</code><code class="w"> </code><code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="w"> </code><code class="kr">as</code><code class="w"> </code><code class="nx">User</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_composition_api_CO1-3" id="co_composition_api_CO1-3"><img alt="3" src="assets/3.png"/></a><code class="w">&#13;
        </code><code class="p">}</code><code class="w">&#13;
    </code><code class="p">}</code><code class="w"> </code><code class="k">catch</code><code class="w"> </code><code class="p">(</code><code class="nx">e</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
        </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">e</code><code class="w"> </code><code class="kr">as</code><code class="w"> </code><code class="ne">Error</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_composition_api_CO1-4" id="co_composition_api_CO1-4"><img alt="4" src="assets/4.png"/></a><code class="w">&#13;
    </code><code class="p">}</code><code class="w">&#13;
</code><code class="p">}</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="nx">fetchData</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_composition_api_CO1-1" id="callout_composition_api_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a reactive <code>user</code> variable of type <code>User</code> with the initial data using <code>shallowRef</code>.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO1-2" id="callout_composition_api_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Create a reactive <code>error</code> variable that can be <code>undefined</code> or of type <code>Error</code> using <code>shallowRef</code>.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO1-3" id="callout_composition_api_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Replace the value of <code>user</code> with the response’s data, assuming it is of type <code>User</code>.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO1-4" id="callout_composition_api_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Update the value of <code>error</code> when an error occurred<a data-primary="" data-startref="ix-comp-api1" data-type="indexterm" id="id1014"/><a data-primary="" data-startref="ix-comp-api1a" data-type="indexterm" id="id1015"/><a data-primary="" data-startref="ix-comp-api1b" data-type="indexterm" id="id1016"/><a data-primary="" data-startref="ix-comp-api1c" data-type="indexterm" id="id1017"/><a data-primary="" data-startref="ix-comp-api1d" data-type="indexterm" id="id1018"/>.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using reactive()" data-type="sect2"><div class="sect2" id="id68">&#13;
<h2>Using reactive()</h2>&#13;
&#13;
<p>The <code>reactive()</code> function is similar to the <code>ref()</code> function, except<a data-primary="reactivity" data-secondary="reactive() and" data-type="indexterm" id="ix-comp-api3"/>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>It accepts object-type data as its argument.</p>&#13;
</li>&#13;
<li>&#13;
<p>You can directly access the reactive return object without <code>value</code> and its &#13;
<span class="keep-together">properties</span>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Only the return object’s nested properties are mutable, and trying to modify the return object’s value directly or using the <code>value</code> property will result in an error:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">({</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Maya"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">})</code>&#13;
&#13;
<code class="cm">/*</code>&#13;
<code class="cm">TypeScript error - property 'value' does not exist</code>&#13;
<code class="cm">on type '{ name: string; age: number; }'</code>&#13;
<code class="cm">*/</code>&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Samuel"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="cm">/*</code>&#13;
<code class="cm">TypeScript error - cannot reassign a read-only variable</code>&#13;
<code class="cm">*/</code>&#13;
<code class="nx">user</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Samuel"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>But you can modify <code>user</code> object’s properties, such as <code>name</code> and <code>age</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">({</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Maya"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">})</code>&#13;
&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Rachel"</code>&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">age</code> <code class="o">=</code> <code class="mi">30</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Behind the scenes, <code>ref()</code> triggers <code>reactive()</code><a data-primary="ref()" data-secondary="handling data with" data-type="indexterm" id="id1019"/>.</p>&#13;
</div>&#13;
&#13;
<p>One important note is that the <code>reactive()</code> function returns a reactive <code>proxy</code> version of the original passed object. Hence, if we make any change to the reactive return object, it would be reflected on the original object, and vice versa, as seen in <a data-type="xref" href="#example_08_06_01">Example 5-8</a><a data-primary="proxy and reactive()" data-type="indexterm" id="id1020"/>.</p>&#13;
<div data-type="example" id="example_08_06_01">&#13;
<h5><span class="label">Example 5-8. </span>Modify both the original object and the reactive object</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">defaultUser</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Maya"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">(</code><code class="nx">defaultUser</code><code class="p">)</code>&#13;
&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Rachel"</code>&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">age</code> <code class="o">=</code> <code class="mi">30</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">defaultUser</code><code class="p">)</code> <code class="c1">// { name: "Rachel", age: 30 }</code>&#13;
&#13;
<code class="nx">defaultUser</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Samuel"</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">user</code><code class="p">)</code> <code class="c1">// { name: "Samuel", age: 30 }</code></pre></div>&#13;
&#13;
<p>In this example, the properties of both <code>defaultValue</code> and <code>user</code> change when <code>user</code> changes and vice versa. Hence it will be best if you are extra cautious when using the <code>reactive()</code> function. You should use the spread syntax (<code>…​</code>) to create a new object before passing to the <code>reactive()</code> instead (<a data-type="xref" href="#example_09_06">Example 5-9</a>)<a data-primary="spread syntax (…​) for reactive()" data-type="indexterm" id="id1021"/>.</p>&#13;
<div data-type="example" id="example_09_06">&#13;
<h5><span class="label">Example 5-9. </span>Using <code>reactive()</code> with spread syntax</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">defaultUser</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">name</code><code class="o">:</code> <code class="s2">"Maya"</code><code class="p">,</code>&#13;
    <code class="nx">age</code><code class="o">:</code> <code class="mi">20</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">({</code> <code class="p">...</code><code class="nx">defaultUser</code> <code class="p">})</code>&#13;
&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Rachel"</code>&#13;
<code class="nx">user</code><code class="p">.</code><code class="nx">age</code> <code class="o">=</code> <code class="mi">30</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">defaultUser</code><code class="p">)</code> <code class="c1">// { name: "Maya", age: 20 }</code>&#13;
&#13;
<code class="nx">defaultUser</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="s2">"Samuel"</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">user</code><code class="p">)</code> <code class="c1">// { name: "Rachel", age: 30 }</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>reactive()</code> function enables profound reactivity conversion for the initial object. Thus, it can lead to undesired performance issues for the large data structure. In a scenario where you only want to observe the root object’s properties and not their descendant, you should use the <code>shallowReactive()</code> function instead<a data-primary="performance" data-secondary="reactive()" data-type="indexterm" id="id1022"/><a data-primary="shallowReactive()" data-type="indexterm" id="id1023"/>.</p>&#13;
</div>&#13;
&#13;
<p>You also can combine <code>ref()</code> and <code>reactive()</code>, though I don’t recommend it due to its complexity and the reactivity unwrapping mechanism. If there is a need to create a reactive object from another reactive object, you should use <code>computed()</code> instead (see <a data-type="xref" href="#computed_hook_06">“Using computed()”</a>)<a data-primary="Composition API" data-secondary="computed()" data-type="indexterm" id="id1024"/><a data-primary="Composition API" data-secondary="data handling with ref()" data-type="indexterm" id="id1025"/><a data-primary="computed()" data-type="indexterm" id="id1026"/><a data-primary="data" data-secondary="handling with ref()" data-type="indexterm" id="id1027"/><a data-primary="shallowRef()" data-type="indexterm" id="id1028"/>.</p>&#13;
&#13;
<p><a data-type="xref" href="#table_01_06">Table 5-1</a> summarizes the use cases for <code>ref()</code>, <code>reactive()</code>, <code>shallowRef()</code>, and &#13;
<span class="keep-together"><code>shallow</code></span><code>Reactive()</code>.</p>&#13;
<table id="table_01_06">&#13;
<caption><span class="label">Table 5-1. </span>Use cases for <code>ref()</code>, <code>reactive()</code>, <code>shallowRef()</code> and <code>shallowReactive()</code> functions</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Hook</th>&#13;
<th>When to use</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>ref()</code></p></td>&#13;
<td><p>Primitive data types for general cases or object-type when there is a need for reassigning both the object and its properties.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>shallowRef()</code></p></td>&#13;
<td><p>Object type only as a placeholder for later reassigning and no property observation.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>reactive()</code></p></td>&#13;
<td><p>For property observation of object-type data, including nested properties.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>&#13;
<span class="keep-together"><code>shallowReactive()</code></span></p></td>&#13;
<td><p>For property observation of object-type data, excluding nested properties.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Next, we will look at the lifecycle composition hooks and what they offer<a data-primary="" data-startref="ix-comp-api2" data-type="indexterm" id="id1029"/><a data-primary="" data-startref="ix-comp-api2a" data-type="indexterm" id="id1030"/><a data-primary="" data-startref="ix-comp-api2b" data-type="indexterm" id="id1031"/><a data-primary="" data-startref="ix-comp-api3" data-type="indexterm" id="id1032"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the Lifecycle Hooks" data-type="sect1"><div class="sect1" id="lifecycle_hooks_03">&#13;
<h1>Using the Lifecycle Hooks</h1>&#13;
&#13;
<p>In <a data-type="xref" href="ch03.html#component_lifecycle_03">“Component Lifecycle Hooks”</a>, we learned the component’s lifecycle hooks and how they look in the classic Vue’s Options API as properties of the component’s options object. With Composition API, the lifecycle hooks are separate functions that we need to import from the <code>vue</code> package before using them to execute logic at specific points in a component’s lifecycle<a data-primary="Composition API" data-secondary="lifecycle hooks and" data-type="indexterm" id="ix-comp-api4"/><a data-primary="lifecycle hooks" data-secondary="Composition API and" data-type="indexterm" id="ix-comp-api4a"/><a data-primary="lifecycle hooks" data-secondary="using" data-type="indexterm" id="ix-comp-api4b"/>.</p>&#13;
&#13;
<p>The Composition API’s lifecycle hooks are similar to the ones in the Options API, except the syntax now contains the prefix <code>on</code> (for example, <code>mounted</code> becomes &#13;
<span class="keep-together"><code>onMounted</code></span> in Composition API). <a data-type="xref" href="#table_02_06">Table 5-2</a> shows the mapping from Options API to Composition API for some lifecycle hooks<a data-primary="beforeMount() hook" data-type="indexterm" id="id1033"/><a data-primary="beforeUnmount() hook" data-type="indexterm" id="id1034"/><a data-primary="lifecycle hooks" data-secondary="table of" data-type="indexterm" id="id1035"/><a data-primary="mounted() hook" data-secondary="equivalent in Composition API" data-type="indexterm" id="id1036"/><a data-primary="mounting" data-secondary="lifecycle hooks" data-type="indexterm" id="id1037"/><a data-primary="onBeforeMounted() hook" data-type="indexterm" id="id1038"/><a data-primary="onBeforeMount() hook" data-type="indexterm" id="id1039"/><a data-primary="onBeforeUpdate() hook" data-type="indexterm" id="id1040"/><a data-primary="onMounted() hook" data-type="indexterm" id="id1041"/><a data-primary="onUnMounted() hook" data-type="indexterm" id="id1042"/><a data-primary="onUpdated() hook" data-type="indexterm" id="id1043"/><a data-primary="unmounted() hook" data-type="indexterm" id="id1044"/><a data-primary="updated() hook" data-type="indexterm" id="id1045"/>.</p>&#13;
<table id="table_02_06">&#13;
<caption><span class="label">Table 5-2. </span>Lifecycle hooks from Options API to Composition API</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Options API</th>&#13;
<th>Composition API</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>beforeMount()</code></p></td>&#13;
<td><p><code>onBeforeMount()</code></p></td>&#13;
<td><p>Call before the first render of the component.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>mounted()</code></p></td>&#13;
<td><p><code>onMounted()</code></p></td>&#13;
<td><p>Call after Vue renders and mounts the component to the DOM.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>beforeUpdate()</code></p></td>&#13;
<td><p><code>onBeforeUpdate()</code></p></td>&#13;
<td><p>Call after the component’s update process starts.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>updated()</code></p></td>&#13;
<td><p><code>onUpdated()</code></p></td>&#13;
<td><p>Call after Vue renders the updated component to the DOM.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>beforeUnmount()</code></p></td>&#13;
<td><p><code>onBeforeUnmount()</code></p></td>&#13;
<td><p>Call before unmounting the component.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>unmounted()</code></p></td>&#13;
<td><p><code>onUnmounted()</code></p></td>&#13;
<td><p>Call after Vue removes and destroys the component instance.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>You probably noticed here that not all Options API’s lifecycle hooks have an equivalent in Composition API, such as <code>beforeCreate()</code> and <code>created()</code>. Instead, we use <code>setup()</code> or <code>&lt;script setup&gt;</code> with other Composition API hooks to achieve the same result and even define the component’s logic in a more organized way.</p>&#13;
&#13;
<p>We use the above hooks to register callbacks that Vue will execute when appropriate by passing the callback function as its only argument. For example, to register a callback to <code>beforeMount()</code> hook, we can do this:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">setup</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">onBeforeMount</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="nx">onBeforeMount</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'beforeMount triggered'</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">})</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Since Vue triggers <code>setup()</code> before creating the component instance, there is no access to the <code>this</code> instance, both in <code>setup()</code> and in the hooks registered within it. The following code will print out <code>undefined</code> (<a data-type="xref" href="#figure_11_06">Figure 5-4</a>) when in use<a data-primary="setup hook" data-secondary="this and" data-type="indexterm" id="id1046"/><a data-primary="this" data-secondary="setup hook and" data-type="indexterm" id="id1047"/>:</p>&#13;
&#13;
<pre class="pagebreak-before" data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">onMounted</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
<code class="nx">onMounted</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'component instance: '</code><code class="p">,</code> <code class="k">this</code><code class="p">)</code>&#13;
<code class="p">})</code></pre>&#13;
&#13;
<figure><div class="figure" id="figure_11_06">&#13;
<img alt="A screenshot displaying a console log of undefined when accessing this in the Composition lifecycle hook" src="assets/lvue_0504.png"/>&#13;
<h6><span class="label">Figure 5-4. </span>Accessing <code>this</code> in the Composition lifecycle hook yields <code>undefined</code></h6>&#13;
</div></figure>&#13;
&#13;
<p>However, you can access the component’s DOM instance (like <code>this.$el</code> as in Options API) by using the <code>ref()</code> hook and <code>ref</code> directive, like how we define &#13;
<span class="keep-together"><code>input</code></span><code>Ref</code> in this example<a data-primary="DOM (Document Object Model)" data-secondary="accessing with Composition API hooks" data-type="indexterm" id="id1048"/><a data-primary="DOM (Document Object Model)" data-secondary="accessing with refs attribute" data-type="indexterm" id="id1049"/><a data-primary="ref()" data-secondary="handling data with" data-type="indexterm" id="id1050"/><a data-primary="ref attribute, accessing DOM" data-type="indexterm" id="id1051"/>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">inputRef</code> <code class="o">=</code> <code class="nx">ref</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code></pre>&#13;
&#13;
<p>Then bind it to the <code>ref</code> directive in the template:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">input</code>&#13;
        <code class="na">ref</code><code class="o">=</code><code class="s">"inputRef"</code>&#13;
        <code class="na">v-model</code><code class="o">=</code><code class="s">"message"</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">placeholder</code><code class="o">=</code><code class="s">"Enter your name"</code>&#13;
    <code class="p">/&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Finally, we can access the DOM instance in the <code>onMounted()</code> or <code>onUpdated()</code> hook:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">onUpdated</code><code class="p">,</code> <code class="nx">onMounted</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">onMounted</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'DOM instance: '</code><code class="p">,</code> <code class="nx">inputRef</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code>&#13;
<code class="p">})</code>&#13;
&#13;
<code class="nx">onUpdated</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'DOM instance after updated: '</code><code class="p">,</code> <code class="nx">inputRef</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code>&#13;
<code class="p">})</code></pre>&#13;
&#13;
<p>After mounting the component, <code>inputRef</code> will refer to the input element’s correct DOM instance. Every time the user changes the input field, Vue will trigger the &#13;
<span class="keep-together"><code>onUpdated()</code></span> hook and update the DOM instance accordingly. <a data-type="xref" href="#figure_12_06">Figure 5-5</a> shows the console log after mounting and the user typing in the input field<a data-primary="inputRef" data-type="indexterm" id="id1052"/>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_12_06">&#13;
<img alt="A screenshot displaying a console log after mounting and user typing in the input field" src="assets/lvue_0505.png"/>&#13;
<h6><span class="label">Figure 5-5. </span>Console log after mounting and the user making a change to the input field</h6>&#13;
</div></figure>&#13;
&#13;
<p>Composition API’s lifecycle hooks can be helpful in many cases compared to the Options API’s lifecycle hooks, especially when you want to keep your functional component’s logic concise and organized. You can also combine the lifecycle hooks with other Composition API hooks to achieve more complex logic and create your reusable custom hooks (see <a data-type="xref" href="#reusable_hooks_06">“Creating Your Reusable Composables”</a>). In the next section, we will look at other significant Composition API hooks, starting with <code>watch()</code><a data-primary="" data-startref="ix-comp-api4" data-type="indexterm" id="id1053"/><a data-primary="" data-startref="ix-comp-api4a" data-type="indexterm" id="id1054"/><a data-primary="" data-startref="ix-comp-api4b" data-type="indexterm" id="id1055"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Understanding Watchers in Composition API" data-type="sect1"><div class="sect1" id="id70">&#13;
<h1>Understanding Watchers in Composition API</h1>&#13;
&#13;
<p>Like the Options API’s <code>watch()</code>, the Composition API’s <code>watch()</code> hook is used to observe for changes and invoke the callback in reactive data. <code>watch()</code> accepts three arguments, as shown in this syntax<a data-primary="Composition API" data-secondary="watchers and" data-type="indexterm" id="ix-comp-api5"/><a data-primary="watchers" data-secondary="Composition API and" data-type="indexterm" id="ix-comp-api5a"/><a data-primary="watchers" data-secondary="using" data-type="indexterm" id="ix-comp-api5b"/><a data-primary="watch() hook" data-type="indexterm" id="ix-comp-api5c"/><a data-primary="callbacks" data-secondary="watchers and" data-type="indexterm" id="ix-comp-api5d"/>:</p>&#13;
&#13;
<pre data-type="programlisting">watch(&#13;
    sources: WatchSource,&#13;
    cb: (newValue: T, oldValue: T, cleanup: (func) =&gt; void)) =&gt; any,&#13;
    options?: WatchOptions&#13;
): WatchStopHandle</pre>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>sources</code> is the reactive data for Vue to observe. It can be a single piece of reactive data, a getter function that returns reactive data, or an array of those<a data-primary="sources, in watch() syntax" data-type="indexterm" id="id1056"/>.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>cb</code> is the callback function that Vue will execute when any of the <code>sources</code> changes. This function accepts two main arguments: <code>newValue</code> and <code>oldValue</code>, and an optional side effect cleanup function to trigger before the next invoke<a data-primary="cb, in watch() syntax" data-type="indexterm" id="id1057"/><a data-primary="options, in watch() syntax" data-type="indexterm" id="id1058"/><a data-primary="deep, watcher field" data-type="indexterm" id="id1059"/><a data-primary="newValue, watcher option field argument" data-type="indexterm" id="id1060"/><a data-primary="oldValue, watcher option field argument" data-type="indexterm" id="id1061"/><a data-primary="flush, watcher field" data-type="indexterm" id="id1062"/><a data-primary="immediate, watcher field" data-type="indexterm" id="id1063"/><a data-primary="onTrack, watcher field" data-type="indexterm" id="id1064"/><a data-primary="onTrigger, watcher field" data-type="indexterm" id="id1065"/>.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>options</code> are the options for the <code>watch()</code> hook, which is optional and contains the fields described in <a data-type="xref" href="#watch_options_fields_table">Table 5-3</a>.</p>&#13;
</li>&#13;
</ul>&#13;
<table id="watch_options_fields_table">&#13;
<caption><span class="label">Table 5-3. </span>The <code>watch()</code> options’ fields</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Property</th>&#13;
<th>Description</th>&#13;
<th>Accepted type</th>&#13;
<th>Default value</th>&#13;
<th>Required?</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>deep</code></p></td>&#13;
<td><p>Indicates whether Vue should observe changes in the nested properties of the target data (if any).</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p><code>false</code></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>immediate</code></p></td>&#13;
<td><p>Indicates whether to trigger the handler immediately after mounting the component.</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p><code>false</code></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>flush</code></p></td>&#13;
<td><p>Indicates the timing order of the handler’s execution. By default, Vue triggers the handler before updating the Vue component.</p></td>&#13;
<td><p><code>pre</code>,  <code>post</code>, <code>sync</code></p></td>&#13;
<td><p><code>pre</code></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>onTrack</code></p></td>&#13;
<td><p>For debugging when it tracks the reactive data, <em>only in development mode</em>.</p></td>&#13;
<td><p>Function</p></td>&#13;
<td><p>&#13;
<span class="keep-together"><code>undefined</code></span></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>onTrigger</code></p></td>&#13;
<td><p>For debugging when triggering the callback, <em>only in development mode</em>.</p></td>&#13;
<td><p>Function</p></td>&#13;
<td><p>&#13;
<span class="keep-together"><code>undefined</code></span></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>And it returns a <code>WatchStopHandle</code> function that we can use to stop the watcher &#13;
<span class="keep-together">anytime</span><a data-primary="watchers" data-secondary="stopping" data-type="indexterm" id="id1066"/>.</p>&#13;
&#13;
<p>Let’s look at the <code>UserWatcherComponent</code> component with the same template presented in <a data-type="xref" href="ch03.html#unique_chapter_id_03">Chapter 3</a>’s <a data-type="xref" href="ch03.html#example_03_10">Example 3-17</a>, where we allow modifying <code>user.name</code> and <code>user.age</code> based on a default <code>user</code> object. We will rewrite its <code>&lt;script&gt;</code> using Composition API, as in <a data-type="xref" href="#example_11_06">Example 5-10</a>.</p>&#13;
<div data-type="example" id="example_11_06">&#13;
<h5><span class="label">Example 5-10. </span><code>UserWatcherComponent</code> component using <code>setup()</code> and <code>ref()</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">setup</code> <code class="na">lang</code><code class="o">=</code><code class="s">'ts'</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">reactive</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="c1">//...</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">reactive</code><code class="p">&lt;</code><code class="nt">User</code><code class="p">&gt;({</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="s2">"John"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">age</code><code class="o">:</code><code class="w"> </code><code class="mf">30</code><code class="p">,</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Then, we add a watcher for the <code>user</code> object, as in <a data-type="xref" href="#example_12_06">Example 5-11</a>.</p>&#13;
<div data-type="example" id="example_12_06">&#13;
<h5><span class="label">Example 5-11. </span>Using the <code>watch()</code> hook for watching <code>user</code> data</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code><code class="p">,</code> <code class="nx">watch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">watch</code><code class="p">(</code><code class="nx">user</code><code class="p">,</code> <code class="p">(</code><code class="nx">newValue</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'user changed from: '</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">,</code> <code class="s1">' to: '</code><code class="p">,</code> <code class="nx">newValue</code><code class="p">)</code>&#13;
<code class="p">})</code></pre></div>&#13;
&#13;
<p>By default, Vue will trigger the callback function only when the <code>user</code> changes. In the previous example, because we use <code>reactive()</code> to create <code>user</code>, Vue will automatically enable <code>deep</code> to watch for its properties. In case you want Vue to only observe a specific property of <code>user</code>, such as <code>user.name</code>, we can create a getter function that returns that property and pass it as the <code>sources</code> argument to <code>watch()</code>, as in <a data-type="xref" href="#example_13_06">Example 5-12</a>.</p>&#13;
<div data-type="example" id="example_13_06">&#13;
<h5><span class="label">Example 5-12. </span>Using the <code>watch()</code> hook for watching a specific property of <code>user</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code><code class="p">,</code> <code class="nx">watch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">watch</code><code class="p">(</code>&#13;
    <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">user</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code>&#13;
    <code class="p">(</code><code class="nx">newValue</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'user.name changed from: '</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">,</code> <code class="s1">' to: '</code><code class="p">,</code> <code class="nx">newValue</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">)</code></pre></div>&#13;
&#13;
<p>When you make a change to the <code>user.name</code>, the console log will display the message shown in <a data-type="xref" href="#figure_13_06">Figure 5-6</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_13_06">&#13;
<img alt="A screenshot displaying a console log after changing user.name" src="assets/lvue_0506.png"/>&#13;
<h6><span class="label">Figure 5-6. </span>Console log after changing <code>user.name</code></h6>&#13;
</div></figure>&#13;
&#13;
<p>In case you need to trigger the watcher right after mounting the component, you can pass <code>{ immediate: true }</code> as the third argument to <code>watch()</code>, as in <a data-type="xref" href="#example_14_06">Example 5-13</a><a data-primary="mounting" data-secondary="watchers and" data-type="indexterm" id="id1067"/>.</p>&#13;
<div data-type="example" id="example_14_06">&#13;
<h5><span class="label">Example 5-13. </span>Using the <code>watch()</code> hook with <code>immediate</code> option</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code><code class="p">,</code> <code class="nx">watch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">watch</code><code class="p">(</code>&#13;
    <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">user</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code>&#13;
    <code class="p">(</code><code class="nx">newValue</code><code class="p">,</code> <code class="nx">oldValue</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code>&#13;
            <code class="s1">'user.name changed from: '</code><code class="p">,</code>&#13;
            <code class="nx">oldValue</code><code class="p">,</code>&#13;
            <code class="s1">' to: '</code><code class="p">,</code>&#13;
            <code class="nx">newValue</code>&#13;
        <code class="p">)</code>&#13;
    <code class="p">},</code>&#13;
    <code class="p">{</code> <code class="nx">immediate</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code>&#13;
<code class="p">)</code></pre></div>&#13;
&#13;
<p>The console log will display the change of <code>user.name</code> from <code>undefined</code> to <code>John</code> right after mounting the component.</p>&#13;
&#13;
<p>You can also pass a <code>sources</code> array of reactive data to <code>watch()</code>, and Vue will trigger the callback function with two collections of new and old values, each of which corresponds to the reactive data in the same order as the <code>sources</code> array, as shown in <a data-type="xref" href="#example_15_06">Example 5-14</a>.</p>&#13;
<div data-type="example" id="example_15_06">&#13;
<h5><span class="label">Example 5-14. </span>Using the <code>watch()</code> hook with an array of reactive data</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code><code class="p">,</code> <code class="nx">watch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">watch</code><code class="p">(</code>&#13;
    <code class="p">[()</code> <code class="o">=&gt;</code> <code class="nx">user</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">user</code><code class="p">.</code><code class="nx">age</code><code class="p">],</code>&#13;
    <code class="p">([</code><code class="nx">newName</code><code class="p">,</code> <code class="nx">newAge</code><code class="p">],</code> <code class="p">[</code><code class="nx">oldName</code><code class="p">,</code> <code class="nx">oldAge</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code>&#13;
            <code class="s1">'user changed from: '</code><code class="p">,</code>&#13;
            <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="nx">oldName</code><code class="p">,</code> <code class="nx">age</code><code class="o">:</code> <code class="nx">oldAge</code> <code class="p">},</code>&#13;
            <code class="s1">' to: '</code><code class="p">,</code>&#13;
            <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="nx">newName</code><code class="p">,</code> <code class="nx">age</code><code class="o">:</code> <code class="nx">newAge</code> <code class="p">}</code>&#13;
        <code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">)</code></pre></div>&#13;
&#13;
<p>The above watcher will be triggered when either <code>user.name</code> or <code>user.age</code> changes and the console log will display the difference accordingly.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you want to observe and trigger side action to multiple data changes, <code>watchEffect()</code> can be a better option. It will track the reactive dependencies used in the watcher’s function, run the function immediately right after the component renders, and rerun it whenever any dependencies change their value. However, you should be cautious using this API as it can lead to performance issues if the list of dependencies is extensive and the updating frequency between them is high<a data-primary="performance" data-secondary="watchEffect()" data-type="indexterm" id="id1068"/><a data-primary="watchEffect()" data-type="indexterm" id="id1069"/>.</p>&#13;
</div>&#13;
&#13;
<p>Using the <code>watch()</code> hook is a great way to create a dynamic observation on specific reactive data or its properties. But if we want to create new reactive data based on the existing ones, we should use <code>computed()</code>, which we will look at next<a data-primary="" data-startref="ix-comp-api5" data-type="indexterm" id="id1070"/><a data-primary="" data-startref="ix-comp-api5a" data-type="indexterm" id="id1071"/><a data-primary="" data-startref="ix-comp-api5b" data-type="indexterm" id="id1072"/><a data-primary="" data-startref="ix-comp-api5c" data-type="indexterm" id="id1073"/><a data-primary="" data-startref="ix-comp-api5d" data-type="indexterm" id="id1074"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using computed()" data-type="sect1"><div class="sect1" id="computed_hook_06">&#13;
<h1>Using computed()</h1>&#13;
&#13;
<p>Similar to computed properties, we use <code>computed()</code> to create a reactive and cached data value derived from other reactive data. Unlike <code>ref()</code> and <code>reactive()</code>, &#13;
<span class="keep-together"><code>computed()</code></span> returns a <em>read-only</em> reference object, meaning we can’t manually reassign value to it<a data-primary="Composition API" data-secondary="computed()" data-type="indexterm" id="ix-comp-api6"/><a data-primary="computed()" data-type="indexterm" id="ix-comp-api6a"/><a data-primary="data" data-secondary="creating reactive data from other reactive date with computed()" data-type="indexterm" id="ix-comp-api6b"/>.</p>&#13;
&#13;
<p>Let’s take the reserved message example written in Options API in <a data-type="xref" href="ch03.html#example_03_05">Example 3-11</a> and rewrite it using the <code>computed()</code> hook as in <a data-type="xref" href="#example_16_06">Example 5-15</a>.</p>&#13;
<div data-type="example" id="example_16_06">&#13;
<h5><span class="label">Example 5-15. </span><code>PalindromeCheck</code> component using <code>computed()</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="p">,</code><code class="w"> </code><code class="nx">computed</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">message</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="s1">'Hello World'</code><code class="p">)</code><code class="w"/>&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">reversedMessage</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">computed</code><code class="p">&lt;</code><code class="nt">string</code><code class="p">&gt;(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">message</code><code class="p">.</code><code class="nx">value</code><code class="p">.</code><code class="nx">split</code><code class="p">(</code><code class="s1">''</code><code class="p">).</code><code class="nx">reverse</code><code class="p">().</code><code class="nx">join</code><code class="p">(</code><code class="s1">''</code><code class="p">)</code><code class="w"/>&#13;
<code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Within the <code>script</code> section, we use the <code>value</code> property of the returned object &#13;
<span class="keep-together">(<code>reversedMessage.value</code>)</span>  to access its value, like <code>ref()</code> and <code>reactive()</code>.</p>&#13;
&#13;
<p>The code in <a data-type="xref" href="#example_17_06">Example 5-16</a> shows how we create another computed data point to check if the message is a palindrome based on the <code>reversedMessage</code>.</p>&#13;
<div data-type="example" id="example_17_06">&#13;
<h5><span class="label">Example 5-16. </span>Using <code>computed()</code> to create new reactive <code>isPalindrome</code> data</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="p">,</code><code class="w"> </code><code class="nx">computed</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w"/>&#13;
&#13;
<code class="c1">//...</code><code class="w"/>&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">isPalindrome</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">computed</code><code class="p">&lt;</code><code class="nt">boolean</code><code class="p">&gt;(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">message</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="nx">reversedMessage</code><code class="p">.</code><code class="nx">value</code><code class="w"/>&#13;
<code class="p">)</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Notice here we declare the types for <code>reservedMessage</code> and <code>isPalindrome</code> explicitly as <code>string</code> and <code>boolean</code> to avoid type inference errors. You can now use these computed data in your template (<a data-type="xref" href="#example_18_06">Example 5-17</a>).</p>&#13;
<div data-type="example" id="example_18_06">&#13;
<h5><span class="label">Example 5-17. </span>Using data created from <code>computed()</code> in the template</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">v-model</code><code class="o">=</code><code class="s">"message"</code> <code class="na">placeholder</code><code class="o">=</code><code class="s">"Enter your message"</code><code class="p">/&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Reversed message: {{ reversedMessage }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Is palindrome: {{ isPalindrome }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>This code results in the output shown in <a data-type="xref" href="#figure_09_06">Figure 5-7</a> when the user changes the message input.</p>&#13;
&#13;
<figure><div class="figure" id="figure_09_06">&#13;
<img alt="A screenshot showing the palindrome check for the input message of hello world" src="assets/lvue_0507.png"/>&#13;
<h6><span class="label">Figure 5-7. </span>Palindrome check component for the message using <code>computed()</code></h6>&#13;
</div></figure>&#13;
&#13;
<p>When you open the Vue tab in the browser’s Developer Tools, you can see these computed data values available under the <code>setup</code> section of the <code>PalindromeCheck</code> component (<a data-type="xref" href="#figure_10_06">Figure 5-8</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_10_06">&#13;
<img alt="A screenshot showing three data values presented under setup section of the component in the Vue tab of the browser developer tools" src="assets/lvue_0508.png"/>&#13;
<h6><span class="label">Figure 5-8. </span>Computed and reactive data shown in the developer tool for the &#13;
<span class="keep-together"><code>PalindromeCheck</code></span> component</h6>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>By default, <code>computed()</code> returns a <em>read-only</em> reactive data reference. Still, you can intentionally declare it as a <em>writable</em> object by passing an object of <code>{ get, set }</code> as the first argument to <code>computed()</code>. This mechanism stays consistent with <code>computed</code> properties in the Options API. However, I don’t recommend using this feature. You should combine it with <code>ref()</code> or <code>reactive()</code> instead.</p>&#13;
</div>&#13;
&#13;
<p>We have learned how to use <code>computed()</code> and <code>watch()</code> to achieve the same result as the classic <code>computed</code> and <code>watch</code> option properties. You can use either of them, depending on your preference. You also can use these hooks to create your own hooks, called composables, and reuse them in other components, which we will explore next<a data-primary="" data-startref="ix-comp-api6" data-type="indexterm" id="id1075"/><a data-primary="" data-startref="ix-comp-api6a" data-type="indexterm" id="id1076"/><a data-primary="" data-startref="ix-comp-api6b" data-type="indexterm" id="id1077"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating Your Reusable Composables" data-type="sect1"><div class="sect1" id="reusable_hooks_06">&#13;
<h1>Creating Your Reusable Composables</h1>&#13;
&#13;
<p>One of the most exciting features of Vue 3 is the ability to create reusable and stateful hooks, called composables,<sup><a data-type="noteref" href="ch05.html#id1078" id="id1078-marker">2</a></sup> from the available Composition API functions. We can divide and compose common logic into readable composables, then use them to manage specific data state changes in different components. This approach helps separate the state management logic and the component logic, reducing our components’ complexity<a data-primary="Composition API" data-secondary="composables" data-type="indexterm" id="ix-comp-api7"/><a data-primary="data" data-secondary="composables and" data-type="indexterm" id="ix-comp-api7a"/><a data-primary="composables" data-secondary="using" data-type="indexterm" id="ix-comp-api7b"/><a data-primary="state" data-secondary="composables and" data-type="indexterm" id="ix-comp-api7c"/>.</p>&#13;
&#13;
<p>To start composing, you can create a new TypeScript (<code>.ts</code>) file and export a function that returns a reactive data object as your composable, as shown in <a data-type="xref" href="#example_25_06">Example 5-18</a>.</p>&#13;
<div data-type="example" id="example_25_06">&#13;
<h5><span class="label">Example 5-18. </span>Creating an example composable, <code>useMyComposable</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// src/composables/useMyComposable.ts</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">useMyComposable</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">myComposableData</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">({</code>&#13;
        <code class="nx">title</code><code class="o">:</code> <code class="s1">'This is my composable data'</code><code class="p">,</code>&#13;
    <code class="p">})</code>&#13;
&#13;
    <code class="k">return</code> <code class="nx">myComposableData</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>In the previous code, we create a new TypeScript file named <code>useMyComposable.ts</code> under the <code>src/composables</code> folder and export a function called <code>useMyComposable</code>. The function returns a reactive data object named <code>myComposableData</code> created using the <code>reactive()</code> function.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You can place the composable file anywhere in your project, but I recommend putting it under the <code>src/composables</code> folder to keep it organized. Also, it’s a good practice to name the composable file with the <code>use</code> prefix, followed by the concise, descriptive name of the composable<a data-primary="composables" data-secondary="location of" data-type="indexterm" id="id1079"/><a data-primary="composables" data-secondary="names" data-type="indexterm" id="id1080"/><a data-primary="names" data-secondary="composables" data-type="indexterm" id="id1081"/><a data-primary="use prefix for composables" data-type="indexterm" id="id1082"/>.</p>&#13;
</div>&#13;
&#13;
<p>You can then import and use <code>useMyComposable</code> in your component as  shown in <a data-type="xref" href="#example_19_06">Example 5-19</a>.</p>&#13;
<div data-type="example" id="example_19_06">&#13;
<h5><span class="label">Example 5-19. </span>Using the <code>useMyComposable</code> composable in the a Vue component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code> <code class="na">setup</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useMyComposable</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'@/composables/useMyComposable'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">myComposableData</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useMyComposable</code><code class="p">()</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Now you can access the <code>myComposableData</code> in your component’s template, and other parts of the component logic, as its local reactive data.</p>&#13;
&#13;
<p>Let’s create a <code>useFetch</code> composable to query data from an external API using the <code>fetch</code> API, as shown in <a data-type="xref" href="#example_22_06">Example 5-20</a>.</p>&#13;
<div data-type="example" id="example_22_06">&#13;
<h5><span class="label">Example 5-20. </span>Create <code>useFetch</code> composable</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">ref</code><code class="p">,</code><code> </code><code class="kr">type</code><code> </code><code class="nx">Ref</code><code class="p">,</code><code> </code><code class="kr">type</code><code> </code><code class="nx">UnwrapRef</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s2">"vue"</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="kr">type</code><code> </code><code class="nx">FetchResponse</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">data</code><code class="o">:</code><code> </code><code class="nx">Ref</code><code class="o">&lt;</code><code class="nx">UnwrapRef</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code> </code><code class="o">|</code><code> </code><code class="kc">null</code><code class="o">&gt;</code><code class="p">;</code><code>&#13;
    </code><code class="nx">error</code><code class="o">:</code><code> </code><code class="nx">Ref</code><code class="o">&lt;</code><code class="nx">UnwrapRef</code><code class="o">&lt;</code><code class="nb">Error</code><code class="o">&gt;</code><code> </code><code class="o">|</code><code> </code><code class="kc">null</code><code class="o">&gt;</code><code class="p">;</code><code>&#13;
    </code><code class="nx">loading</code><code class="o">:</code><code> </code><code class="nx">Ref</code><code class="o">&lt;</code><code class="kr">boolean</code><code class="o">&gt;</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kr">export</code><code> </code><code class="kd">function</code><code> </code><code class="nx">useFetch</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">url</code><code class="o">:</code><code> </code><code class="kt">string</code><code class="p">)</code><code class="o">:</code><code> </code><code class="nx">FetchResponse</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="o">&lt;</code><code class="nx">T</code><code> </code><code class="o">|</code><code> </code><code class="kc">null</code><code class="o">&gt;</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="p">;</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">loading</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="o">&lt;</code><code class="kr">boolean</code><code class="o">&gt;</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code><code class="p">;</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">error</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="o">&lt;</code><code class="nb">Error</code><code> </code><code class="o">|</code><code> </code><code class="kc">null</code><code class="o">&gt;</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="p">;</code><code>&#13;
&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">fetchData</code><code> </code><code class="o">=</code><code> </code><code class="kr">async</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_composition_api_CO2-1" id="co_composition_api_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="k">try</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="nx">loading</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="kc">true</code><code class="p">;</code><code>&#13;
            </code><code class="kr">const</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="kr">await</code><code> </code><code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code><code class="p">;</code><code>&#13;
&#13;
            </code><code class="k">if</code><code> </code><code class="p">(</code><code class="o">!</code><code class="nx">response</code><code class="p">.</code><code class="nx">ok</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
                </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nb">Error</code><code class="p">(</code><code class="sb">`</code><code class="sb">Failed to fetch data for </code><code class="si">${</code><code class="nx">url</code><code class="si">}</code><code class="sb">`</code><code class="p">)</code><code class="p">;</code><code>&#13;
            </code><code class="p">}</code><code>&#13;
&#13;
            </code><code class="nx">data</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="kr">await</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>&#13;
        </code><code class="p">}</code><code> </code><code class="k">catch</code><code> </code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">err</code><code> </code><code class="kr">as</code><code> </code><code class="nb">Error</code><code class="p">)</code><code class="p">.</code><code class="nx">message</code><code class="p">;</code><code>&#13;
        </code><code class="p">}</code><code> </code><code class="k">finally</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="nx">loading</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="kc">false</code><code class="p">;</code><code>&#13;
        </code><code class="p">}</code><code>&#13;
    </code><code class="p">}</code><code class="p">;</code><code>&#13;
&#13;
    </code><code class="nx">fetchData</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_composition_api_CO2-2" id="co_composition_api_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
&#13;
    </code><code class="k">return</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_composition_api_CO2-3" id="co_composition_api_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
        </code><code class="nx">data</code><code class="p">,</code><code>&#13;
        </code><code class="nx">loading</code><code class="p">,</code><code>&#13;
        </code><code class="nx">error</code><code class="p">,</code><code>&#13;
    </code><code class="p">}</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code><code class="p">;</code></pre></div>&#13;
<dl class="calloutlist pagebreak-before">&#13;
<dt><a class="co" href="#co_composition_api_CO2-1" id="callout_composition_api_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Declare the internal logic for fetching data.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO2-2" id="callout_composition_api_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Trigger fetching data during the creation of the component and update the data automatically.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO2-3" id="callout_composition_api_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Return the declared reactive variables.</p></dd>&#13;
</dl>&#13;
&#13;
<p>You then can reuse <code>useFetch</code> to compose another asynchronous composable, such as <code>useGitHubRepos</code>, to query and manage user’s repositories data from the GitHub API (<a data-type="xref" href="#example_24_06">Example 5-21</a>).</p>&#13;
<div data-type="example" id="example_24_06">&#13;
<h5><span class="label">Example 5-21. </span>Create a <code>useGitHubRepos</code> composable</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// src/composables/useGitHubRepos.ts</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useFetch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@/composables/useFetch'</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="nx">type</code> <code class="nx">Repo</code> <code class="o">=</code> <code class="p">{</code> <code class="cm">/**... */</code> <code class="p">}</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">useGitHubRepos</code> <code class="o">=</code> <code class="p">(</code><code class="nx">username</code><code class="o">:</code> <code class="nx">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">useFetch</code><code class="o">&lt;</code><code class="nx">Repo</code><code class="p">[]</code><code class="o">&gt;</code><code class="p">(</code>&#13;
        <code class="sb">`https://api.github.com/users/</code><code class="si">${</code><code class="nx">username</code><code class="si">}</code><code class="sb">/repos`</code>&#13;
    <code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Once done, we can use <code>useGitHubRepos</code> in a <code>GitHubRepos.vue</code> component (<a data-type="xref" href="#example_24_08">Example 5-22</a>).</p>&#13;
<div data-type="example" id="example_24_08">&#13;
<h5><span class="label">Example 5-22. </span>Using <code>useGitHubRepos</code> in a <code>GitHubRepos</code> component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code> </code><code class="na">setup</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useGitHubRepos</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@/composables/useGitHubRepos"</code><code class="p">;</code><code class="w">&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">data</code><code class="o">:</code><code class="w"> </code><code class="nx">repos</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useGitHubRepos</code><code class="p">(</code><code class="s2">"mayashavin"</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_composition_api_CO3-1" id="co_composition_api_CO3-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">h2</code><code class="p">&gt;</code><code>Repos</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h2</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">li</code><code> </code><code class="na">v-for</code><code class="o">=</code><code class="s">"repo in repos"</code><code> </code><code class="na">:key</code><code class="o">=</code><code class="s">"repo.id"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_composition_api_CO3-2" id="co_composition_api_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
      </code><code class="p">&lt;</code><code class="nt">article</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">header</code><code class="p">&gt;</code><code>{{ repo.name }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">header</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>{{ repo.description }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>&#13;
      </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">article</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">li</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_composition_api_CO3-1" id="callout_composition_api_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Get the <code>data</code> and rename it <code>repos</code>.</p></dd>&#13;
<dt><a class="co" href="#co_composition_api_CO3-2" id="callout_composition_api_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Iterate <code>repos</code> and display each <code>repo</code>’s information.</p></dd>&#13;
</dl>&#13;
&#13;
<p>And on the browser, we will see a list of repos displayed after the fetching completes (<a data-type="xref" href="#screenshot_ch04_repos">Figure 5-9</a>).</p>&#13;
&#13;
<figure><div class="figure" id="screenshot_ch04_repos">&#13;
<img alt="A screenshot displaying a list of repositories retrieved from Maya Shavin's GitHub account with the dedicated composable" src="assets/lvue_0509.png"/>&#13;
<h6><span class="label">Figure 5-9. </span>Retrieve and display a list of repos using <code>useGitHubRepos</code> composable</h6>&#13;
</div></figure>&#13;
<div data-type="warning" epub:type="warning"><h1>Mapping Data Between Composables</h1>&#13;
<p>If you need to re-map any reactive data received from another composable, use <code>computed()</code> or <code>watch()</code> to preserve the reactivity. <a data-type="xref" href="#example_24_07">Example 5-23</a> demonstrates a <em>non-working</em> example of <code>useFetch</code> inside <code>useGitHubRepos</code><a data-primary="compute()" data-type="indexterm" id="id1083"/><a data-primary="watch()" data-secondary="mapping data between composables" data-type="indexterm" id="id1084"/>.</p>&#13;
</div>&#13;
<div data-type="example" id="example_24_07">&#13;
<h5><span class="label">Example 5-23. </span>Using <code>useFetch</code> in the wrong way within <code>useGitHubRepos</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">export</code> <code class="kr">const</code> <code class="nx">useGitHubRepos</code> <code class="o">=</code> <code class="p">(</code><code class="nx">username</code><code class="o">:</code> <code class="nx">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">useFetch</code><code class="o">&lt;</code><code class="nx">Repo</code><code class="p">[]</code><code class="o">&gt;</code><code class="p">(</code>&#13;
    <code class="sb">`https://api.github.com/users/</code><code class="si">${</code><code class="nx">username</code><code class="si">}</code><code class="sb">/repos`</code>&#13;
  <code class="p">);</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">repos</code><code class="o">:</code> <code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">,</code>&#13;
    <code class="nx">loading</code><code class="o">:</code> <code class="nx">response</code><code class="p">.</code><code class="nx">loading</code><code class="p">,</code>&#13;
    <code class="nx">error</code><code class="o">:</code> <code class="nx">response</code><code class="p">.</code><code class="nx">error</code><code class="p">,</code>&#13;
  <code class="p">};</code>&#13;
<code class="p">};</code></pre></div>&#13;
&#13;
<p>With composables, you can create your application’s state management logic in a modular and composable way. You can even build your library of composables to reuse in other Vue projects, such as theming control, data fetching, payment management for a store, etc. An excellent resource for composables is <a href="https://oreil.ly/pKJmK">VueUse</a>, where you can find many helpful, ready-to-use, and tested Vue composition utilities for your needs<a data-primary="composables" data-secondary="resources on" data-type="indexterm" id="id1085"/><a data-primary="VueUse" data-type="indexterm" id="id1086"/>.</p>&#13;
&#13;
<p>Since all the reactive states get initialized only when using the hook, we can avoid data overlapping issues like in mixins. Also, testing components have become more straightforward, whereby you can test each composable used in the element separately and keep the component’s logic small and maintainable<a data-primary="" data-startref="ix-comp-api7" data-type="indexterm" id="id1087"/><a data-primary="" data-startref="ix-comp-api7a" data-type="indexterm" id="id1088"/><a data-primary="" data-startref="ix-comp-api7b" data-type="indexterm" id="id1089"/><a data-primary="" data-startref="ix-comp-api7c" data-type="indexterm" id="id1090"/><a data-primary="composables" data-secondary="testing" data-type="indexterm" id="id1091"/><a data-primary="testing" data-secondary="composables" data-type="indexterm" id="id1092"/>.</p>&#13;
&#13;
<p>After learning about Composition API and composables, how about creating your own composables system and using them in your components?</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id359">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>This chapter explored how to rewrite our components from the Options API to use Composition API functions such as setup function, reactivity, and lifecycle hooks. We also learned to create our custom composable based on the existing ones, enhancing code reusability. Based on this foundation, we now understand the pros and cons of each API, hence their use cases for better development.</p>&#13;
&#13;
<p>You are ready to move to the next chapter, where you will learn how to incorporate external data from an API or database resource into your Vue application.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id998"><sup><a href="ch05.html#id998-marker">1</a></sup> When you use the mixin, you are writing a new component’s configurations.</p><p data-type="footnote" id="id1078"><sup><a href="ch05.html#id1078-marker">2</a></sup> In general, a composable is a custom hook.</p></div></div></section></body></html>