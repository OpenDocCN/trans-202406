<html><head></head><body><section data-pdf-bookmark="Chapter 7. Forms" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_forms">&#13;
<h1><span class="label">Chapter 7. </span>Forms</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id85">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="forms" data-type="indexterm" id="ix_07-forms-asciidoc0"/>Forms <a data-primary="forms" data-secondary="basics" data-type="indexterm" id="ix_07-forms-asciidoc1"/>collect user input that is submitted to a remote URL or API endpoint. Modern browsers have many built-in form input types for text, numbers, colors, and more. A form is one of the main ways you get input from your user.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="FormData" data-type="sect2"><div class="sect2" id="id86">&#13;
<h2>FormData</h2>&#13;
&#13;
<p><a data-primary="FormData API" data-type="indexterm" id="id902"/><a data-primary="forms" data-secondary="FormData API" data-type="indexterm" id="id903"/>The FormData API provides a data model for accessing form data. It saves you the trouble of having to look up individual DOM elements and get their values.</p>&#13;
&#13;
<p>Even better, once you have a <code>FormData</code> object, you can pass it directly to the Fetch API to submit the form. Before submission, you can alter or add to the data in the &#13;
<span class="keep-together"><code>FormData</code></span> object.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validation" data-type="sect2"><div class="sect2" id="id87">&#13;
<h2>Validation</h2>&#13;
&#13;
<p><a data-primary="forms" data-secondary="Validation API" data-type="indexterm" id="id904"/><a data-primary="Validation API" data-type="indexterm" id="id905"/>To prevent users from sending invalid data, you can (and should) add client-side validation for your forms. This could be something as simple as marking a field as required, or more complex validation logic that involves coordinating multiple form values or calling an API.</p>&#13;
&#13;
<p>In the past, a developer would usually need to reach for a JavaScript library to perform form validation. This could cause headaches due to data duplication; it exists in the form data and an in-memory object used by the validation library.</p>&#13;
&#13;
<p class="pagebreak-before">HTML5 added more built-in validation options, such as:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Marking a field as required</p>&#13;
</li>&#13;
<li>&#13;
<p>Specifying the minimum and maximum values in a number field</p>&#13;
</li>&#13;
<li>&#13;
<p>Specifying a regular expression to validate the field’s input</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These options are used as attributes on the <code>&lt;input&gt;</code> elements.</p>&#13;
&#13;
<p>The browser shows basic validation error messages (see <a data-type="xref" href="#browserValidation">Figure 7-1</a>), but the style may not look good with your app’s design. You can use the Constraint Validation API to inspect the built-in validation results as well as perform custom validation logic and set your own validation messages.</p>&#13;
&#13;
<figure class="width-75"><div class="figure" id="browserValidation">&#13;
<img alt="A built-in validation message in Chrome" src="assets/wacb_0701.png"/>&#13;
<h6><span class="label">Figure 7-1. </span>A built-in validation message in Chrome</h6>&#13;
</div></figure>&#13;
&#13;
<p>To validate a form, you call its <code>checkValidity</code> method. All of the fields within the form are validated. If all fields are valid, <code>checkValidity</code> returns <code>true</code>. If one or more fields are invalid, <code>checkValidity</code> returns <code>false</code> and each invalid field triggers an <code>invalid</code> event. You can also check a specific element by calling <code>checkValidity</code> on the form field itself.</p>&#13;
&#13;
<p>Every form field has a <code>validity</code> object that reflects the current validity state. It has a boolean <code>valid</code>, which indicates the form’s overall validity state. This object also has additional flags that tell you the nature of the validation error<a data-startref="ix_07-forms-asciidoc1" data-type="indexterm" id="id906"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Populating a Form Field from Local Storage" data-type="sect1"><div class="sect1" id="id465">&#13;
<h1>Populating a Form Field from Local Storage</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id282">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="form fields" data-secondary="populating from local storage" data-type="indexterm" id="ix_07-forms-asciidoc2"/><a data-primary="forms" data-secondary="populating a form field from local storage" data-type="indexterm" id="ix_07-forms-asciidoc3"/>You want to remember a form field’s value in local storage. For example, you may want to remember the user name entered in a login form.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id466">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>When submitting the form, use a <code>FormData</code> object to get the field value and set it in local storage (see <a data-type="xref" href="#code_rememberUsername">Example 7-1</a>). Then, when first loading the page, check for a remembered value. If you find a value, populate the form field.</p>&#13;
<div data-type="example" id="code_rememberUsername">&#13;
<h5><span class="label">Example 7-1. </span>Remembering the <code>username</code> field</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">form</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#login-form'</code><code class="p">);</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">username</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'username'</code><code class="p">);</code>&#13;
<code class="k">if</code> <code class="p">(</code><code class="nx">username</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">username</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">username</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'username'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'username'</code><code class="p">));</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id88">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When you pass a form to the <code>FormData</code> constructor, it is populated with the form’s current values. You can then use the <code>get</code> method to retrieve the desired field and set it in local storage.</p>&#13;
&#13;
<p>Populating the form on load is a little different. A <code>FormData</code> object is not kept in sync with the current form values; rather, it includes the form values at the time the &#13;
<span class="keep-together"><code>FormData</code></span> object was created. The opposite is also true—if you set a new value in the <code>FormData</code> object, it won’t be updated in the form itself. Given this, a <code>FormData</code> object won’t help when populating the form. <a data-type="xref" href="#code_rememberUsername">Example 7-1</a> uses the form’s <code>elements</code> property to look up the <code>username</code> field and set its value that way.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id907">&#13;
<h1>Looking Up Form Fields with the elements Property</h1>&#13;
<p><a data-primary="elements property, looking up form fields using" data-type="indexterm" id="id908"/><a data-primary="form fields" data-secondary="elements property for looking up" data-type="indexterm" id="id909"/>The <code>elements</code> property of a form lets you look up form fields by their names. Every field within this form that has a <code>name</code> property has a corresponding property in <code>form.elements</code>. For example, you can look up an input with the name <code>username</code> by referencing <code>form.elements.username</code>. Note that you need to specify the field’s <code>name</code> attribute, not its <code>id</code><a data-startref="ix_07-forms-asciidoc3" data-type="indexterm" id="id910"/><a data-startref="ix_07-forms-asciidoc2" data-type="indexterm" id="id911"/>.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Submitting a Form with Fetch and the FormData API" data-type="sect1"><div class="sect1" id="id467">&#13;
<h1>Submitting a Form with Fetch and the FormData API</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id89">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="submitting a form with Fetch and the FormData API" data-type="indexterm" id="ix_07-forms-asciidoc4"/><a data-primary="FormData API" data-type="indexterm" id="ix_07-forms-asciidoc5"/><a data-primary="forms" data-secondary="submitting a form with Fetch and the FormData API" data-type="indexterm" id="ix_07-forms-asciidoc6"/>You want to submit a form using the Fetch API. You might want to do this to add additional information to the form submission&#13;
that wouldn’t be included by the browser, or because the form submission might need an API token that is stored in memory&#13;
rather than entered in the form.</p>&#13;
&#13;
<p>Another reason you might want to do this is to prevent the browser from redirecting to a new page, or causing a full page refresh.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id468">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <code>FormData</code> object containing the data to be submitted. Add the additional required data, then submit the form with the Fetch API (see <a data-type="xref" href="#example7-2">Example 7-2</a>).</p>&#13;
<div data-type="example" id="example7-2">&#13;
<h5><span class="label">Example 7-2. </span>Adding data with the FormData API</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// In a real-world application, the API token would be stored somewhere and</code>&#13;
<code class="c1">// not hardcoded like this.</code>&#13;
<code class="kr">const</code> <code class="nx">apiToken</code> <code class="o">=</code> <code class="s1">'aBcD1234EfGh5678IjKlM'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// Important: Stop the browser from automatically submitting the form.</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
  <code class="c1">// Set up a FormData object and add the API token to it.</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">);</code>&#13;
  <code class="nx">data</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'apiToken'</code><code class="p">,</code> <code class="nx">apiToken</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Use the Fetch API to send this FormData object to the endpoint.</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/form'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">data</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id90">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Normally, when you click the Submit button, the browser gets the form data and submits it for you. Here you don’t want that because you need to add the API token.</p>&#13;
&#13;
<p>The first thing the submit handler does is call <code>preventDefault</code> on the <code>submit</code> event. This stops the browser from performing the default submit behavior so that you can provide your custom logic. The default behavior here is a full page refresh, which is probably not what you want.</p>&#13;
&#13;
<p>You can create a <code>FormData</code> object by passing the form object to the <code>FormData</code> constructor. The resulting object will have the existing form data in it, at which point you can add additional data like the API token.</p>&#13;
&#13;
<p>Finally, you can pass the <code>FormData</code> object as the body of a POST request using the Fetch API. When submitting a form this way, the body is <em>not</em> JSON; rather, the browser submits it with a content type of <code>multipart/form-data</code>.</p>&#13;
&#13;
<p>Consider an object representing your form data:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">username</code><code class="o">:</code> <code class="s1">'john.doe'</code><code class="p">,</code>&#13;
  <code class="nx">apiToken</code><code class="o">:</code> <code class="s1">'aBcD1234EfGh5678IjKlM'</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The equivalent request body looks something like this<a data-startref="ix_07-forms-asciidoc6" data-type="indexterm" id="id912"/><a data-startref="ix_07-forms-asciidoc5" data-type="indexterm" id="id913"/><a data-startref="ix_07-forms-asciidoc4" data-type="indexterm" id="id914"/>:</p>&#13;
&#13;
<pre data-type="programlisting">------WebKitFormBoundaryl6AuUOn9EbuYe9XO&#13;
Content-Disposition: form-data; name="username"&#13;
&#13;
john.doe&#13;
------WebKitFormBoundaryl6AuUOn9EbuYe9XO&#13;
Content-Disposition: form-data; name="apiToken"&#13;
&#13;
aBcD1234EfGh5678IjKlM&#13;
------WebKitFormBoundaryl6AuUOn9EbuYe9XO--</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Submitting a Form as JSON" data-type="sect1"><div class="sect1" id="id469">&#13;
<h1>Submitting a Form as JSON</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id283">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="sending form data as JSON" data-type="indexterm" id="ix_07-forms-asciidoc7"/><a data-primary="forms" data-secondary="submitting as JSON" data-type="indexterm" id="ix_07-forms-asciidoc8"/><a data-primary="JSON" data-secondary="submitting a form as" data-type="indexterm" id="ix_07-forms-asciidoc9"/>You want to submit a form to an endpoint that expects JSON data.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id470">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the FormData API to transform the form data into a JavaScript object, and use the Fetch API to send it as JSON (see <a data-type="xref" href="#example7-3">Example 7-3</a>).</p>&#13;
<div data-type="example" id="example7-3">&#13;
<h5><span class="label">Example 7-3. </span>Submitting a form as JSON using Fetch</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// Important: Stop the browser from automatically submitting the form.</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
  <code class="c1">// Create a new FormData containing this form's data, then add each</code>&#13;
  <code class="c1">// key/value pair to the response body.</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">body</code> <code class="o">=</code> <code class="p">{};</code>&#13;
  <code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="p">[</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">]</code> <code class="k">of</code> <code class="nx">data</code><code class="p">.</code><code class="nx">entries</code><code class="p">())</code> <code class="p">{</code>&#13;
    <code class="nx">body</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">value</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="c1">// Send the JSON body to the form endpoint.</code>&#13;
  <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/form'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
&#13;
    <code class="c1">// The object must be converted to a JSON string.</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">body</code><code class="p">),</code>&#13;
&#13;
    <code class="c1">// Tell the server you're sending JSON.</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="s1">'content-type'</code><code class="o">:</code> <code class="s1">'application/json'</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">body</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Got response:'</code><code class="p">,</code> <code class="nx">body</code><code class="p">));</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id91">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This approach is similar to sending the <code>FormData</code> object directly. The only differences are that you are converting the form data to JSON and sending it with the correct <code>Content-Type</code> header.</p>&#13;
&#13;
<p>You can perform the conversion by creating a new empty object and iterating over the key/value pairs in the <code>FormData</code>. Each pair is copied into the object.</p>&#13;
&#13;
<p>A disadvantage of this approach is that you can’t use it with <code>FormData</code> having multiple values bound to the same key. This happens when you have a group of checkboxes with the same name; there are multiple entries with the same key.</p>&#13;
&#13;
<p>You could enhance the conversion to detect this case and set an array of values, as shown in <a data-type="xref" href="#form_getAll">Example 7-4</a>.</p>&#13;
<div data-type="example" id="form_getAll">&#13;
<h5><span class="label">Example 7-4. </span>Handling array form values</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Converts a form's data into an object that can be sent as JSON.</code>&#13;
<code class="cm"> * @param form The form element</code>&#13;
<code class="cm"> * @returns An object containing all the mapped keys and values</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">toObject</code><code class="p">(</code><code class="nx">form</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">body</code> <code class="o">=</code> <code class="p">{};</code>&#13;
&#13;
  <code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">key</code> <code class="k">of</code> <code class="nx">data</code><code class="p">.</code><code class="nx">keys</code><code class="p">())</code> <code class="p">{</code>&#13;
    <code class="c1">// Returns an array of all values bound to a given key</code>&#13;
    <code class="kr">const</code> <code class="nx">values</code> <code class="o">=</code> <code class="nx">data</code><code class="p">.</code><code class="nx">getAll</code><code class="p">(</code><code class="nx">key</code><code class="p">);</code>&#13;
&#13;
    <code class="c1">// If there's only one element in the array, set that element directly.</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">values</code><code class="p">.</code><code class="nx">length</code> <code class="o">===</code> <code class="mi">1</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">body</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">values</code><code class="p">[</code><code class="mi">0</code><code class="p">];</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// Otherwise, set the array</code>&#13;
      <code class="nx">body</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">values</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">return</code> <code class="nx">body</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#form_getAll">Example 7-4</a> uses the <code>FormData</code>’s <code>getAll</code> function, which returns an array containing all values bound to the given key. This lets you collect all values for a given checkbox group into an array.</p>&#13;
&#13;
<p><code>getAll</code> always returns an array. If there’s only one value, it is an array with one element. <code>toObject</code> checks for this scenario, and if the array only has one element, it uses that element as the single value in the resulting object. Otherwise, it uses the array of values<a data-startref="ix_07-forms-asciidoc9" data-type="indexterm" id="id915"/><a data-startref="ix_07-forms-asciidoc8" data-type="indexterm" id="id916"/><a data-startref="ix_07-forms-asciidoc7" data-type="indexterm" id="id917"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Making a Form Field Required" data-type="sect1"><div class="sect1" id="id471">&#13;
<h1>Making a Form Field Required</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id284">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="form fields" data-secondary="making required" data-type="indexterm" id="id918"/><a data-primary="forms" data-secondary="making a form field required" data-type="indexterm" id="id919"/>You want to require a form field to have a value, causing a validation error if it is left blank.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id472">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>required</code> attribute on the <code>&lt;input&gt;</code> element (see <a data-type="xref" href="#example7-5">Example 7-5</a>).</p>&#13;
<div data-type="example" id="example7-5">&#13;
<h5><span class="label">Example 7-5. </span>A required field</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">label</code><code> </code><code class="na">for</code><code class="o">=</code><code class="s">"username"</code><code class="p">&gt;</code><code>Username</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">label</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">input</code><code> </code><code class="na">type</code><code class="o">=</code><code class="s">"text"</code><code> </code><code class="na">name</code><code class="o">=</code><code class="s">"username"</code><code> </code><code class="na">id</code><code class="o">=</code><code class="s">"username"</code><code> </code><code class="na">required</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_forms_CO1-1" id="co_forms_CO1-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_forms_CO1-1" id="callout_forms_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>required</code> attribute does not have a value.</p></dd>&#13;
</dl></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id473">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When a field is marked as <code>required</code>, it must have a value. If the field is blank, its <code>validity.valid</code> property is <code>false</code> and its <code>validity.valueMissing</code> property is <code>true</code>.</p>&#13;
&#13;
<p>A required field is only considered empty if the value is an empty string. It does not trim whitespace, so a value consisting of a few empty spaces is considered valid.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Constraining a Number Input" data-type="sect1"><div class="sect1" id="id474">&#13;
<h1>Constraining a Number Input</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id92">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="forms" data-secondary="constraining a number input" data-type="indexterm" id="id920"/><a data-primary="number input, constraining" data-type="indexterm" id="id921"/>You want to specify a range of allowed values for a number input (<code>&lt;input type=​"num⁠ber"&gt;</code>).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id475">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>min</code> and <code>max</code> properties to specify the allowed range (see <a data-type="xref" href="#example7-6">Example 7-6</a>). These values are inclusive, meaning that the minimum and maximum values themselves are allowed.</p>&#13;
<div data-type="example" id="example7-6">&#13;
<h5><span class="label">Example 7-6. </span>Specifying a range for a number field</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"quantity"</code><code class="p">&gt;</code>Quantity<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"number"</code> <code class="na">name</code><code class="o">=</code><code class="s">"quantity"</code> <code class="na">id</code><code class="o">=</code><code class="s">"quantity"</code> <code class="na">min</code><code class="o">=</code><code class="s">"1"</code> <code class="na">max</code><code class="o">=</code><code class="s">"10"</code><code class="p">&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id476">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If a number input’s value is below the minimum or above the maximum, its <code>validity.valid</code> property is <code>false</code>. If it’s below the minimum, the <code>rangeUnderflow</code> validity flag is set. Similarly, if it exceeds the maximum, the <code>rangeOverflow</code> flag is set instead.</p>&#13;
&#13;
<p>When you make an <code>input</code> of type <code>number</code>, the browser adds a spinner control—clickable up and down arrows to increase and decrease the value. This spinner control enforces the minimum and maximum values—it refuses to decrease the value if it’s already at the minimum or increase the value if it’s already at the maximum. However, a user is still free to type any value in the field. They can enter a number outside of the allowed range, at which point the validity state is set accordingly.</p>&#13;
&#13;
<p>If you want more fine-grained control over allowed values, you can also specify a <code>step</code> value. This limits the allowed values so that the increment must be a multiple of the step. Consider an input with a minimum of 0, a maximum of 4, and a step of 2. The only acceptable values for this field would be 0, 2, and 4.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Specifying a Validation Pattern" data-type="sect1"><div class="sect1" id="id477">&#13;
<h1>Specifying a Validation Pattern</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id285">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="forms" data-secondary="specifying a validation pattern" data-type="indexterm" id="id922"/><a data-primary="text fields" data-secondary="specifying validation patterns" data-type="indexterm" id="id923"/>You want to limit a text field’s value so that it matches a certain pattern.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id478">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>pattern</code> attribute of the <code>input</code> to specify a regular expression (see <a data-type="xref" href="#example7-7">Example 7-7</a>). The field is considered invalid unless its value matches the regular expression.</p>&#13;
<div data-type="example" id="example7-7">&#13;
<h5><span class="label">Example 7-7. </span>Limiting a field to alphanumeric characters only</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"username"</code><code class="p">&gt;</code>Enter a username<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">pattern</code><code class="o">=</code><code class="s">"[A-Za-z0-9]+"</code> <code class="na">id</code><code class="o">=</code><code class="s">"username"</code> <code class="na">name</code><code class="o">=</code><code class="s">"username"</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>The <code>username</code> field is invalid if it contains anything other than alphanumeric characters. When invalid, the validity state’s <code>patternMismatch</code> flag is set.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id479">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This is a flexible validation option, second only to using your own custom validation logic (see <a data-type="xref" href="#recipe_customValidation">“Using Custom Validation Logic”</a>).</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Creating a regular expression to validate URLs or email addresses can be tricky. To handle these cases, you can set the input’s <code>type</code> attribute to <code>url</code> or <code>email</code>, and the browser will validate that the field is a valid URL or email address for you.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validating Forms" data-type="sect1"><div class="sect1" id="id480">&#13;
<h1>Validating Forms</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id93">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="client-side validation of forms" data-type="indexterm" id="ix_07-forms-asciidoc10"/><a data-primary="Constraint Validation API" data-secondary="detecting/marking invalid fields with" data-type="indexterm" id="ix_07-forms-asciidoc11"/><a data-primary="forms" data-secondary="validating" data-type="indexterm" id="ix_07-forms-asciidoc12"/>You want to manage the form validation process and show your own error messages in the UI.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id481">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Constraint Validation API and the <code>invalid</code> event to detect and mark invalid fields.</p>&#13;
&#13;
<p>There are many ways to handle validation. Some websites are too eager and show an error message before the user gets a chance to enter a value. Consider an input of type <code>email</code>, which is considered invalid until a valid email address is entered. If validation occurs immediately, the user sees an error about an invalid email address before they’ve even finished typing it.</p>&#13;
&#13;
<p class="pagebreak-before">To avoid this, the validation approach shown here only validates a field under two conditions:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>When the form is submitted.</p>&#13;
</li>&#13;
<li>&#13;
<p>If the field has been focused and then lost focus. These fields are considered to have been “touched.”</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>First, you’ll need to disable the browser’s built-in validation UI by adding the <code>novalidate</code> attribute to the form, as shown in <a data-type="xref" href="#example7-8">Example 7-8</a>.</p>&#13;
<div data-type="example" id="example7-8">&#13;
<h5><span class="label">Example 7-8. </span>Disabling the browser validation UI</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="o">&lt;</code><code class="nx">form</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"my-form"</code> <code class="nx">novalidate</code><code class="o">&gt;</code>&#13;
  <code class="c">&lt;!--</code> <code class="nx">Form</code> <code class="nx">elements</code> <code class="nx">go</code> <code class="nx">here</code> <code class="o">--&gt;</code>&#13;
<code class="o">&lt;</code><code class="err">/form&gt;</code></pre></div>&#13;
&#13;
<p>Each field needs a placeholder element to contain the error message, as shown in <a data-type="xref" href="#example7-9">Example 7-9</a>.</p>&#13;
<div data-type="example" id="example7-9">&#13;
<h5><span class="label">Example 7-9. </span>Adding error message placeholders</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">label</code> <code class="na">for</code><code class="o">=</code><code class="s">"email"</code><code class="p">&gt;</code>Email<code class="p">&lt;/</code><code class="nt">label</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">input</code> <code class="na">required</code> <code class="na">type</code><code class="o">=</code><code class="s">"email"</code> <code class="na">id</code><code class="o">=</code><code class="s">"email"</code> <code class="na">name</code><code class="o">=</code><code class="s">"email"</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"error-message"</code> <code class="na">id</code><code class="o">=</code><code class="s">"email-error"</code><code class="p">&gt;&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>In this example, an error message is associated with an input field by its ID. The field with the ID <code>email</code> has an error message with ID <code>email-error</code>, a <code>name</code> field has an error message <code>name-error</code>, and so on.</p>&#13;
&#13;
<p>With this validation approach, each form element listens for three events:</p>&#13;
<dl>&#13;
<dt><code>invalid</code></dt>&#13;
<dd>&#13;
<p>Triggered when the form is validated and the field is marked invalid. This sets the error message.</p>&#13;
</dd>&#13;
<dt><code>input</code></dt>&#13;
<dd>&#13;
<p>Triggered when the value in the field changes. This performs revalidation if necessary and clears the error message if the field becomes valid.</p>&#13;
</dd>&#13;
<dt><code>blur</code></dt>&#13;
<dd>&#13;
<p>Triggered when the field loses focus. This sets a <code>data-should-validate</code> attribute to mark the field as touched, after which it is validated in the <code>input</code> event &#13;
<span class="keep-together">handler.</span></p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The validation code is shown in <a data-type="xref" href="#code_validationFramework">Example 7-10</a>.</p>&#13;
<div data-type="example" id="code_validationFramework">&#13;
<h5><span class="label">Example 7-10. </span>Setting up validation for a form field</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Adds necessary event listeners to an element to participate in form validation.</code>&#13;
<code class="cm"> * It handles setting and clearing error messages depending on the validation state.</code>&#13;
<code class="cm"> * @param element The input element to validate</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">addValidation</code><code class="p">(</code><code class="nx">element</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">errorElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">element</code><code class="p">.</code><code class="nx">id</code><code class="si">}</code><code class="sb">-error`</code><code class="p">);</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Fired when the form is validated and the field is not valid.</code>&#13;
<code class="cm">   * Sets the error message and style, and also sets the shouldValidate flag.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">element</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'invalid'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">errorElement</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">element</code><code class="p">.</code><code class="nx">validationMessage</code><code class="p">;</code>&#13;
    <code class="nx">element</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">shouldValidate</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Fired when user input occurs in the field. If the shouldValidate flag is set,</code>&#13;
<code class="cm">   * it will recheck the field's validity and clear the error message if it</code>&#13;
<code class="cm">   * becomes valid.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">element</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'input'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">element</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">shouldValidate</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">if</code> <code class="p">(</code><code class="nx">element</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">())</code> <code class="p">{</code>&#13;
        <code class="nx">errorElement</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Fired when the field loses focus, applying the shouldValidate flag.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">element</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'blur'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// This field has been touched; it will now be validated on subsequent</code>&#13;
    <code class="c1">// 'input' events.</code>&#13;
    <code class="c1">// This sets the input's data-should-validate attribute to true in the DOM.</code>&#13;
    <code class="nx">element</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">shouldValidate</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This example listens to the <code>input</code> event. If your form contains checkboxes or radio buttons, you may need to listen for the <code>change</code> event instead for those elements, depending on the browser. See the <a href="https://oreil.ly/cFIjY">article about <code>input</code> events from MDN</a>:</p>&#13;
<blockquote>&#13;
<p>For <code>&lt;input&gt;</code> elements with <code>type=checkbox</code> or <code>type=​radio</code>, the <code>input</code> event should fire whenever a user &#13;
<span class="keep-together">toggles</span>  the  control,  per  the  HTML  Living  Standard  specification. However, historically this has not always been the case. Check compatibility, or use the <code>change</code> event instead for elements of these types.</p></blockquote>&#13;
</div>&#13;
&#13;
<p>To complete the basic validation framework, add the listeners to the form fields, listen for the form’s <code>submit</code> event, and trigger validation (see <a data-type="xref" href="#example7-11">Example 7-11</a>).</p>&#13;
<div data-type="example" id="example7-11">&#13;
<h5><span class="label">Example 7-11. </span>Triggering form validation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Assuming the form has two inputs, 'name' and 'email'</code>&#13;
<code class="nx">addValidation</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">name</code><code class="p">);</code>&#13;
<code class="nx">addValidation</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">email</code><code class="p">);</code>&#13;
&#13;
<code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">())</code> <code class="p">{</code>&#13;
    <code class="c1">// Validation passed, submit the form</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id94">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This code sets up a good basic validation framework that handles the browser’s built-in validation. Before submitting the form, it calls <code>checkValidity</code>, which starts checking all of the inputs inside the form. The browser triggers an <code>invalid</code> event for any input that fails validation. To handle this, you can listen for the <code>invalid</code> event on the input elements themselves. From there, you can render an appropriate error &#13;
<span class="keep-together">message.</span></p>&#13;
&#13;
<p>Once the user has validation errors, you want to clear them as soon as the fields become valid. This is why <code>addValidation</code> listens for the <code>input</code> event—this is triggered as soon as the user types something in the input field. From there, you can immediately recheck the input’s validity. If it is now valid (<code>checkValidity</code> returns <code>true</code>), you can clear the error message. An input is only revalidated if the <code>data-should-validate</code> attribute is set to <code>true</code>. This attribute is added when validation fails during form submission, or when an element loses focus. This prevents validation errors from appearing before the user is done typing. Once the field loses focus, it starts revalidating on every change<a data-startref="ix_07-forms-asciidoc12" data-type="indexterm" id="id924"/><a data-startref="ix_07-forms-asciidoc11" data-type="indexterm" id="id925"/><a data-startref="ix_07-forms-asciidoc10" data-type="indexterm" id="id926"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Custom Validation Logic" data-type="sect1"><div class="sect1" id="recipe_customValidation">&#13;
<h1>Using Custom Validation Logic</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id95">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Constraint Validation API" data-secondary="performing validation check not supported by" data-type="indexterm" id="ix_07-forms-asciidoc13"/><a data-primary="forms" data-secondary="using custom validation logic" data-type="indexterm" id="ix_07-forms-asciidoc14"/><a data-primary="setCustomValidity method" data-type="indexterm" id="ix_07-forms-asciidoc15"/><a data-primary="validation logic, custom" data-type="indexterm" id="ix_07-forms-asciidoc16"/>You want to perform a validation check that is not supported by the Constraint Validation API. For example, you want to validate that a password and password confirmation field have the same value.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id483">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Perform the custom validation logic before calling <code>checkValidity</code> on the form. If the custom validation check fails, call the input’s <code>setCustomValidity</code> method to set an appropriate error message. If the check passes, clear any previously set validation message (see <a data-type="xref" href="#example7-12">Example 7-12</a>).</p>&#13;
<div data-type="example" id="example7-12">&#13;
<h5><span class="label">Example 7-12. </span>Using custom validation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Custom validation function that ensures the password and confirmPassword fields</code>&#13;
<code class="cm"> * have the same value.</code>&#13;
<code class="cm"> * @param form The form containing the two fields</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">validatePasswordsMatch</code><code class="p">(</code><code class="nx">form</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">password</code><code class="p">,</code> <code class="nx">confirmPassword</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">;</code>&#13;
&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">password</code><code class="p">.</code><code class="nx">value</code> <code class="o">!==</code> <code class="nx">confirmPassword</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">confirmPassword</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="s1">'Passwords do not match.'</code><code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="nx">confirmPassword</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="s1">''</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
  <code class="nx">validatePasswordsMatch</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">())</code> <code class="p">{</code>&#13;
    <code class="c1">// Validation passed, submit the form.</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you’re using the browser’s built-in validation UI, you need to call the form field’s <code>reportValidity</code> method after setting a custom validity message. If you are handling the validation UI yourself, this isn’t needed—but make sure to show the error message in the appropriate place.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id96">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When you call <code>setCustomValidity</code> on an element with a non-empty string, the element is now considered invalid.</p>&#13;
&#13;
<p>The <code>validatePasswordsMatch</code> function examines the values of the <code>password</code> and &#13;
<span class="keep-together"><code>confirmPassword</code></span> fields. If they don’t match, it calls <code>setCustomValidity</code> on the &#13;
<span class="keep-together"><code>confirmPassword</code></span> field to set a validation error message. If they do match, it sets it to an empty string, which marks the field as valid again.</p>&#13;
&#13;
<p>The form’s submit handler calls <code>validatePasswordsMatch</code> before performing the built-in validation. If the <code>validatePasswordsMatch</code> check fails, and a custom validity is set, <code>form.checkValidity</code> fails and the <code>invalid</code> event fires on the <code>confirmPassword</code> field just like any other invalid element<a data-startref="ix_07-forms-asciidoc16" data-type="indexterm" id="id927"/><a data-startref="ix_07-forms-asciidoc15" data-type="indexterm" id="id928"/><a data-startref="ix_07-forms-asciidoc14" data-type="indexterm" id="id929"/><a data-startref="ix_07-forms-asciidoc13" data-type="indexterm" id="id930"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validating a Checkbox Group" data-type="sect1"><div class="sect1" id="id484">&#13;
<h1>Validating a Checkbox Group</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id97">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="checkbox groups, validating" data-type="indexterm" id="ix_07-forms-asciidoc17"/><a data-primary="forms" data-secondary="validating a checkbox group" data-type="indexterm" id="ix_07-forms-asciidoc18"/>You want to enforce that at least one checkbox in a group of checkboxes must be checked. Setting the <code>required</code> attribute on checkboxes won’t help here because it applies to that individual input only, not the group. The browser checks if that input is checked and causes a validation error, even if other checkboxes in the group are checked.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id485">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a <code>FormData</code> object to get an array of all selected checkboxes, and set a custom validation error if the array is empty.</p>&#13;
&#13;
<p>When performing the custom validation, use the <code>FormData</code>’s <code>getAll</code> method to get an array of the selected checkbox values (see <a data-type="xref" href="#example7-13">Example 7-13</a>). If the array is empty, no checkboxes are selected, and this is a validation error.</p>&#13;
<div data-type="example" id="example7-13">&#13;
<h5><span class="label">Example 7-13. </span>Validating a checkbox group</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">validateCheckboxes</code><code class="p">(</code><code class="nx">form</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// To avoid setting the validation error on multiple elements,</code>&#13;
  <code class="c1">// choose the first checkbox and use that to hold the group's validation</code>&#13;
  <code class="c1">// message.</code>&#13;
  <code class="kr">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">option1</code><code class="p">;</code>&#13;
&#13;
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">data</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="s1">'options'</code><code class="p">))</code> <code class="p">{</code>&#13;
    <code class="nx">element</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="s1">'Please select at least one option.'</code><code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="nx">element</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="s1">''</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>To keep the validation state of the whole group in one place, set the custom validity message on the first checkbox only (assuming a name of <code>option1</code>). This first checkbox serves as a container for the group’s validation message, which is necessary because you can only set validity messages on actual <code>&lt;input&gt;</code> elements.</p>&#13;
&#13;
<p>Then, listen for the <code>invalid</code> and <code>change</code> events. On the <code>invalid</code> event, show the error message. On the <code>change</code> event (when a checkbox is toggled), perform the custom validation and clear the error message if validation succeeds (see <a data-type="xref" href="#example7-14">Example 7-14</a>).</p>&#13;
<div data-type="example" id="example7-14">&#13;
<h5><span class="label">Example 7-14. </span>Setting up checkbox validation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Adds necessary event listeners to an element to participate in form validation.</code>&#13;
<code class="cm"> * It handles setting and clearing error messages depending on the validation state.</code>&#13;
<code class="cm"> * @param element The input element to validate</code>&#13;
<code class="cm"> * @param errorId The ID of a placeholder element that will show the error message</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">addValidation</code><code class="p">(</code><code class="nx">element</code><code class="p">,</code> <code class="nx">errorId</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">errorElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="nx">errorId</code><code class="p">);</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Fired when the form is validated and the field is not valid.</code>&#13;
<code class="cm">   * Sets the error message and style.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">element</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'invalid'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">errorElement</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="nx">element</code><code class="p">.</code><code class="nx">validationMessage</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="cm">/**</code>&#13;
<code class="cm">   * Fired when user input occurs in the field.</code>&#13;
<code class="cm">   * It will recheck the field's validity and clear the error message if it</code>&#13;
<code class="cm">   * becomes valid.</code>&#13;
<code class="cm">   */</code>&#13;
  <code class="nx">element</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">validateCheckboxes</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">option1</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">())</code> <code class="p">{</code>&#13;
      <code class="nx">errorElement</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p class="pagebreak-before">Finally, add validation to each checkbox field and call the <code>validateCheckboxes</code> function before checking the form’s validity. <a data-type="xref" href="#example7-15">Example 7-15</a> expects that you have an element with the ID <code>checkbox-error</code>. If there is a checkbox validation error, the message will be set on that element.</p>&#13;
<div data-type="example" id="example7-15">&#13;
<h5><span class="label">Example 7-15. </span>Validating the checkbox form</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">addValidation</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">option1</code><code class="p">,</code> <code class="s1">'checkbox-error'</code><code class="p">);</code>&#13;
<code class="nx">addValidation</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">option2</code><code class="p">,</code> <code class="s1">'checkbox-error'</code><code class="p">);</code>&#13;
<code class="nx">addValidation</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">option3</code><code class="p">,</code> <code class="s1">'checkbox-error'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
  <code class="nx">validateCheckboxes</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">());</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id98">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Using the <code>required</code> attribute on the checkboxes in the group won’t have the desired effect. This is good for a single checkbox, like one requiring that a user accept a license agreement, but when used on a group, it would make each individual checkbox required, and form validation would fail unless <em>all</em> of them were checked. Because there is no HTML element for a “checkbox group,” you’ll need to do a little extra work to get the desired behavior.</p>&#13;
&#13;
<p>This example picks the first checkbox in the group as a “container” for the validation message. When the user toggles any of the checkboxes, the browser calls the change handler and it looks to see if any of the checkboxes are checked. If the selection array is empty, this is an error. The custom validity message is always set on the first checkbox only. This is to ensure the message is always shown and hidden when necessary.</p>&#13;
&#13;
<p>Let’s look at what would happen if you instead applied the custom validity to the checkbox being changed.</p>&#13;
&#13;
<p>If no options are checked and the user submits the form, each checkbox has a custom validity error message now. All three options are invalid. If you then go and check one of the checkboxes, the checkbox’s <code>change</code> event will fire and check the checkbox group. Now there is an option selected, so it clears the custom validity message. However, the other checkboxes are still in an error state. This is essentially now equivalent to having set the <code>required</code> attribute on all the checkboxes.</p>&#13;
&#13;
<p>You could get around this by setting the validation message in <em>all</em> checkboxes from the <code>validateCheckboxes</code> function, but it’s less work to just pick one and use that as the target for all custom validation messages. The group as a whole has a single error message element that gets populated with the validation error.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Since this example manages its own validation message, make sure to include the <code>novalidate</code> attribute on the containing form to avoid showing the browser’s default validation UI along with your custom validation error<a data-startref="ix_07-forms-asciidoc18" data-type="indexterm" id="id931"/><a data-startref="ix_07-forms-asciidoc17" data-type="indexterm" id="id932"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Validating a Field Asynchronously" data-type="sect1"><div class="sect1" id="id486">&#13;
<h1>Validating a Field Asynchronously</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id99">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="form fields" data-secondary="asynchronous validation" data-type="indexterm" id="ix_07-forms-asciidoc19"/><a data-primary="forms" data-secondary="validating a field asynchronously" data-type="indexterm" id="ix_07-forms-asciidoc20"/><a data-primary="passwords, asynchronous validation of" data-type="indexterm" id="ix_07-forms-asciidoc21"/>Your custom validation logic requires an asynchronous operation like making a network request. For example, a user signup form has a password field. The signup form must call an API to validate that the entered password meets password strength standards.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id487">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Perform the network request, then set a custom validity message. Do this in a function that returns a <code>Promise</code>. In the form’s submit handler, await this <code>Promise</code> before calling <code>checkValidity</code> on the form. If the asynchronous validation code set a custom validity message, the form validation triggered by <code>checkValidity</code> handles it.</p>&#13;
&#13;
<p><a data-type="xref" href="#code_asyncValidation">Example 7-16</a> has the validation logic itself. It calls a password strength check API and sets the custom validity message accordingly.</p>&#13;
<div data-type="example" id="code_asyncValidation">&#13;
<h5><span class="label">Example 7-16. </span>Performing asynchronous password strength validation</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Calls an API to validate that a password meets strength requirements.</code>&#13;
<code class="cm"> * @param form The form containing the password field</code>&#13;
<code class="cm"> */</code>&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">validatePasswordStrength</code><code class="p">(</code><code class="nx">form</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">password</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">;</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="sb">`/api/password-strength?password=</code><code class="si">${</code><code class="nx">password</code><code class="p">.</code><code class="nx">value</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
&#13;
  <code class="c1">// As before, remember to call reportValidity on the password field if you're using</code>&#13;
  <code class="c1">// the built-in browser validation UI.</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">result</code><code class="p">.</code><code class="nx">status</code> <code class="o">===</code> <code class="s1">'error'</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">password</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="nx">result</code><code class="p">.</code><code class="nx">error</code><code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="nx">password</code><code class="p">.</code><code class="nx">setCustomValidity</code><code class="p">(</code><code class="s1">''</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Make sure you only send passwords over a secure connection (HTTPS). Otherwise, you’re sending the user’s password out in plain text, and this is a dangerous practice.</p>&#13;
</div>&#13;
&#13;
<p>Because the function is marked as <code>async</code>, it returns a <code>Promise</code>. You just need to <code>await</code> this <code>Promise</code> in the form’s submit handler, as shown in <a data-type="xref" href="#example7-17">Example 7-17</a>.</p>&#13;
<div data-type="example" id="example7-17">&#13;
<h5><span class="label">Example 7-17. </span>The <code>async</code> form submit handler</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">form</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">async</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
  <code class="nx">await</code> <code class="nx">validatePasswordStrength</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">());</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>This marks the field as invalid on submission if the password doesn’t meet the requirements. You can rerun the validation logic when the field changes, only this time you’ll do it on the <code>blur</code> event rather than <code>input</code> as you did with synchronous custom validation (see <a data-type="xref" href="#example7-18">Example 7-18</a>).</p>&#13;
<div data-type="example" id="example7-18">&#13;
<h5><span class="label">Example 7-18. </span>Revalidating on <code>blur</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">form</code><code class="p">.</code><code class="nx">elements</code><code class="p">.</code><code class="nx">password</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'blur'</code><code class="p">,</code> <code class="nx">async</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">password</code> <code class="o">=</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">;</code>&#13;
  <code class="kr">const</code> <code class="nx">errorElement</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'password-error'</code><code class="p">);</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">password</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">shouldValidate</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">await</code> <code class="nx">validatePasswordStrength</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">password</code><code class="p">.</code><code class="nx">checkValidity</code><code class="p">())</code> <code class="p">{</code>&#13;
      <code class="nx">errorElement</code><code class="p">.</code><code class="nx">textContent</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>&#13;
      <code class="nx">password</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="s1">'border-danger'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id100">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If you did this check on the <code>input</code> event, you’d be sending a network request every time the user pressed a key. The <code>blur</code> event defers the revalidation until the field loses focus. It calls the validation API again and checks the new validity state.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>You could also use a debounced version of the validation function. This would revalidate on an input event, but only once the user has stopped typing for a certain period of time.</p>&#13;
&#13;
<p><a href="https://oreil.ly/kLRJa">This article from freeCodeCamp</a> goes into detail about how to create a debounced function. There are also npm packages available that will create a debounced version of a function<a data-startref="ix_07-forms-asciidoc21" data-type="indexterm" id="id933"/><a data-startref="ix_07-forms-asciidoc20" data-type="indexterm" id="id934"/><a data-startref="ix_07-forms-asciidoc19" data-type="indexterm" id="id935"/>.<a data-startref="ix_07-forms-asciidoc0" data-type="indexterm" id="id936"/></p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>