<html><head></head><body><section data-pdf-bookmark="Chapter 18. Modeling Our Library" data-type="chapter" epub:type="chapter"><div class="chapter" id="app_data_models">&#13;
<h1><span class="label">Chapter 18. </span>Modeling Our Library</h1>&#13;
&#13;
&#13;
<p>At this point, we’ve made a fair amount of headway on our library application; we’ve got some basic structural elements in place for the app, we’re transitioning between some screens, and we’re listing out some data. Unfortunately that data is static, hard-coded data—this won’t get us far for very long. In order to move forward with the rest of the app, we need to look at our data model. Paying attention to it now will allow us to make something a bit more maintainable and robust.</p>&#13;
&#13;
<p>Now, static data in and of itself is not a terrible thing. In fact, we’ll continue to use “static” data throughout this tutorial until we talk about networking in <a data-type="xref" href="ch09.html#topics_networking">Chapter 9</a>. A large part of the problem with the way we’re serving up a list of books right now is that it’s not very portable to other places inside the app.</p>&#13;
&#13;
<p>Right now, we’re only displaying books in a catalog view within the app. Later, however, we’ll be searching for books, saving books, and more. Let’s figure out a way to move forward that is a bit more adaptable for the future.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Dynamic Data in List Views" data-type="sect1"><div class="sect1" id="idm46177209207848">&#13;
<h1>Dynamic Data in List Views</h1>&#13;
&#13;
<p>Our list view of books is a great place to start looking at ways to make our display of data a bit more dynamic. If you’ll recall, the list of books is currently stored as a temporary property on our main object type, <code>Book</code>, as <code>sampleData</code> to make it a bit easier to find and use.</p>&#13;
&#13;
<p>As we add more views that display data to our application, however, we’ll find that this is a bit repetitive and cumbersome to maintain. Let’s make this a bit more robust by adding a layer between our UI controller and our list view.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Android" data-type="sect2"><div class="sect2" id="idm46177209204408">&#13;
<h2>Android</h2>&#13;
&#13;
<p>The<a data-primary="application data" data-secondary="dynamic data in list views" data-tertiary="Android" data-type="indexterm" id="ADddand18"/><a data-primary="Android" data-secondary="application data" data-tertiary="dynamic data in list views" data-type="indexterm" id="Aaddynam18"/><a data-primary="lists" data-secondary="dynamic data in list views" data-tertiary="Android" data-type="indexterm" id="Ldynamicand18"/> concept of a “data source” is present in Android and exists as just that in some components like the next-generation media player, <code>ExoPlayer</code>. Further, Android has a notion of “content provider” that can supply information about the contacts on your phone for management in your app. However, components that use the <code>Adapter</code> pattern tend to leave the data source arbitrary. You might have a compiled list of objects, XML files on the device, JSON strings in memory, or REST web services you communicate with across a network.</p>&#13;
&#13;
<p>For our first draft, we just added all our objects to a static <code>array</code> of <code>Book</code> objects. While this is fine, it’s certainly not easily maintainable—every time a book is added to our library, we’d have to update that data structure and publish a new version of the app and hope that all our users will diligent about updating. Probably in the long run, we’ll want to use a REST web service that can be updated by library administrators and update our book list with occasional calls to the appropriate service endpoints (URLs). We’ll certainly want to persist the data locally to the device, and if we want to be able to sort or filter using well-known and highly vetted SQL, we would probably want to convert the JSON responses of those web services to database rows.</p>&#13;
&#13;
<p>For now, let’s just create a simple interface the provides our <code>Adapter</code> the information it needs and update the <code>Adapter</code> to accommodate this contract, and then we can make changes as our requirements and capabilities evolve.</p>&#13;
&#13;
<p>Let’s take another look at our <code>Adapter</code> and see how we can fulfill its needs in an extensible, dynamic<a data-primary="Java" data-secondary="application data" data-tertiary="dynamic data in list views" data-type="indexterm" id="Jappdyn18"/><a data-primary="Kotlin" data-secondary="application data" data-tertiary="dynamic data in list views" data-type="indexterm" id="Kappdyn18"/> fashion:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177209189096">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code>&#13;
  <code class="nc">BrowseBooksAdapter</code> <code class="kd">extends</code> <code class="n">RecyclerView</code><code class="o">.</code><code class="na">Adapter</code><code class="o">&lt;</code><code class="n">BrowseBooksAdapter</code><code class="o">.</code><code class="na">ViewHolder</code><code class="o">&gt;</code> <code class="o">{</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="n">ViewHolder</code> <code class="nf">onCreateViewHolder</code><code class="o">(</code><code class="n">ViewGroup</code> <code class="n">parent</code><code class="o">,</code> <code class="kt">int</code> <code class="n">viewType</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="k">new</code> <code class="nf">ViewHolder</code><code class="o">(</code><code class="k">new</code> <code class="n">TextView</code><code class="o">(</code><code class="n">parent</code><code class="o">.</code><code class="na">getContext</code><code class="o">()));</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">onBindViewHolder</code><code class="o">(</code><code class="n">ViewHolder</code> <code class="n">holder</code><code class="o">,</code> <code class="kt">int</code> <code class="n">position</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">holder</code><code class="o">.</code><code class="na">mTextView</code><code class="o">.</code><code class="na">setText</code><code class="o">(</code><code class="n">Book</code><code class="o">.</code><code class="na">SAMPLE_DATA</code><code class="o">[</code><code class="n">position</code><code class="o">].</code><code class="na">getTitle</code><code class="o">());</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getItemCount</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">Book</code><code class="o">.</code><code class="na">SAMPLE_DATA</code><code class="o">.</code><code class="na">length</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">ViewHolder</code> <code class="kd">extends</code> <code class="n">RecyclerView</code><code class="o">.</code><code class="na">ViewHolder</code> <code class="o">{</code>&#13;
    <code class="kd">private</code> <code class="n">TextView</code> <code class="n">mTextView</code><code class="o">;</code>&#13;
    <code class="kd">public</code> <code class="nf">ViewHolder</code><code class="o">(</code><code class="nd">@NonNull</code> <code class="n">View</code> <code class="n">itemView</code><code class="o">)</code> <code class="o">{</code>&#13;
      <code class="kd">super</code><code class="o">(</code><code class="n">itemView</code><code class="o">);</code>&#13;
      <code class="n">mTextView</code> <code class="o">=</code> <code class="o">(</code><code class="n">TextView</code><code class="o">)</code> <code class="n">itemView</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">BrowseBooksAdapter</code> <code class="p">:</code>&#13;
  <code class="n">RecyclerView</code><code class="p">.</code><code class="n">Adapter</code><code class="p">&lt;</code><code class="n">BrowseBooksAdapter</code><code class="p">.</code><code class="n">ViewHolder</code><code class="p">&gt;()</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onCreateViewHolder</code><code class="p">(</code><code class="n">parent</code><code class="p">:</code> <code class="n">ViewGroup</code><code class="p">,</code> <code class="n">viewType</code><code class="p">:</code> <code class="n">Int</code><code class="p">):</code> <code class="n">ViewHolder</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="n">ViewHolder</code><code class="p">(</code><code class="n">TextView</code><code class="p">(</code><code class="n">parent</code><code class="p">.</code><code class="n">context</code><code class="p">))</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onBindViewHolder</code><code class="p">(</code><code class="n">holder</code><code class="p">:</code> <code class="n">ViewHolder</code><code class="p">,</code> <code class="n">position</code><code class="p">:</code> <code class="n">Int</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="n">holder</code><code class="p">.</code><code class="n">mTextView</code><code class="p">.</code><code class="n">text</code> <code class="p">=</code> <code class="n">Book</code><code class="p">.</code><code class="n">SAMPLE_DATA</code><code class="p">[</code><code class="n">position</code><code class="p">].</code><code class="n">title</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">getItemCount</code><code class="p">():</code> <code class="n">Int</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="n">Book</code><code class="p">.</code><code class="n">SAMPLE_DATA</code><code class="p">.</code><code class="n">size</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">class</code> <code class="nc">ViewHolder</code><code class="p">(</code><code class="n">itemView</code><code class="p">:</code> <code class="n">View</code><code class="p">)</code> <code class="p">:</code> <code class="n">RecyclerView</code><code class="p">.</code><code class="n">ViewHolder</code><code class="p">(</code><code class="n">itemView</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">private</code> <code class="k">val</code> <code class="py">mTextView</code><code class="p">:</code> <code class="n">TextView</code>&#13;
&#13;
    <code class="n">init</code> <code class="p">{</code>&#13;
      <code class="n">mTextView</code> <code class="p">=</code> <code class="n">itemView</code> <code class="k">as</code> <code class="n">TextView</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Hmm. Looks like we reference our static source of book data a couple times—once when a view is recycled and we want to update the visual properties of the row (for now, specifically the title of the book), and also to determine the total number of books in our source, so the <code>RecyclerView</code> can know when to stop scrolling. Sounds like a simple enough composition:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177208882328">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">BookDataSource</code> <code class="o">{</code>&#13;
  <code class="n">Book</code> <code class="nf">get</code><code class="o">(</code><code class="kt">int</code> <code class="n">index</code><code class="o">);</code>&#13;
  <code class="kt">int</code> <code class="nf">size</code><code class="o">();</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">interface</code> <code class="n">BookDataSource</code> <code class="p">{</code>&#13;
  <code class="n">operator</code> <code class="k">fun</code> <code class="nf">get</code><code class="p">(</code><code class="n">index</code><code class="p">:</code> <code class="n">Int</code><code class="p">):</code> <code class="n">Book</code>&#13;
  <code class="k">val</code> <code class="py">size</code><code class="p">:</code> <code class="n">Int</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Now let’s update the <code>Adapter</code> to accept any class that implements that interface:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177208713352">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code>&#13;
  <code class="nc">BrowseBooksAdapter</code> <code class="kd">extends</code> <code class="n">RecyclerView</code><code class="o">.</code><code class="na">Adapter</code><code class="o">&lt;</code><code class="n">BrowseBooksAdapter</code><code class="o">.</code><code class="na">ViewHolder</code><code class="o">&gt;</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">BookDataSource</code> <code class="n">mSource</code><code class="o">;</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">BrowseBooksAdapter</code><code class="o">(</code><code class="n">BookDataSource</code> <code class="n">source</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">();</code>&#13;
    <code class="n">mSource</code> <code class="o">=</code> <code class="n">source</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="n">ViewHolder</code> <code class="nf">onCreateViewHolder</code><code class="o">(</code><code class="n">ViewGroup</code> <code class="n">parent</code><code class="o">,</code> <code class="kt">int</code> <code class="n">viewType</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="k">new</code> <code class="nf">ViewHolder</code><code class="o">(</code><code class="k">new</code> <code class="n">TextView</code><code class="o">(</code><code class="n">parent</code><code class="o">.</code><code class="na">getContext</code><code class="o">()));</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">onBindViewHolder</code><code class="o">(</code><code class="n">ViewHolder</code> <code class="n">holder</code><code class="o">,</code> <code class="kt">int</code> <code class="n">position</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">Book</code> <code class="n">book</code> <code class="o">=</code> <code class="n">mSource</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">position</code><code class="o">);</code>&#13;
    <code class="n">holder</code><code class="o">.</code><code class="na">textView</code><code class="o">.</code><code class="na">setText</code><code class="o">(</code><code class="n">book</code><code class="o">.</code><code class="na">getTitle</code><code class="o">());</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getItemCount</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mSource</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">ViewHolder</code> <code class="kd">extends</code> <code class="n">RecyclerView</code><code class="o">.</code><code class="na">ViewHolder</code> <code class="o">{</code>&#13;
    <code class="kd">private</code> <code class="n">TextView</code> <code class="n">textView</code><code class="o">;</code>&#13;
    <code class="kd">public</code> <code class="nf">ViewHolder</code><code class="o">(</code><code class="nd">@NonNull</code> <code class="n">View</code> <code class="n">itemView</code><code class="o">)</code> <code class="o">{</code>&#13;
      <code class="kd">super</code><code class="o">(</code><code class="n">itemView</code><code class="o">);</code>&#13;
      <code class="n">textView</code> <code class="o">=</code> <code class="o">(</code><code class="n">TextView</code><code class="o">)</code> <code class="n">itemView</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">BrowseBooksAdapter</code><code class="p">(</code><code class="k">private</code> <code class="k">val</code> <code class="py">source</code><code class="p">:</code> <code class="n">BookDataSource</code><code class="p">)</code> <code class="p">:</code>&#13;
<code class="n">RecyclerView</code><code class="p">.</code><code class="n">Adapter</code><code class="p">&lt;</code><code class="n">BrowseBooksAdapter</code><code class="p">.</code><code class="n">ViewHolder</code><code class="p">&gt;()</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onCreateViewHolder</code><code class="p">(</code><code class="n">parent</code><code class="p">:</code> <code class="n">ViewGroup</code><code class="p">,</code> <code class="n">viewType</code><code class="p">:</code> <code class="n">Int</code><code class="p">):</code> <code class="n">ViewHolder</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="n">ViewHolder</code><code class="p">(</code><code class="n">TextView</code><code class="p">(</code><code class="n">parent</code><code class="p">.</code><code class="n">context</code><code class="p">))</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onBindViewHolder</code><code class="p">(</code><code class="n">holder</code><code class="p">:</code> <code class="n">ViewHolder</code><code class="p">,</code> <code class="n">position</code><code class="p">:</code> <code class="n">Int</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">val</code> <code class="py">book</code> <code class="p">=</code> <code class="n">source</code><code class="p">[</code><code class="n">position</code><code class="p">]</code>&#13;
    <code class="n">holder</code><code class="p">.</code><code class="n">textView</code><code class="p">.</code><code class="n">text</code> <code class="p">=</code> <code class="n">book</code><code class="p">.</code><code class="n">title</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">getItemCount</code><code class="p">():</code> <code class="n">Int</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="n">source</code><code class="p">.</code><code class="n">size</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">class</code> <code class="nc">ViewHolder</code><code class="p">(</code><code class="n">itemView</code><code class="p">:</code> <code class="n">View</code><code class="p">)</code> <code class="p">:</code> <code class="n">RecyclerView</code><code class="p">.</code><code class="n">ViewHolder</code><code class="p">(</code><code class="n">itemView</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">val</code> <code class="py">textView</code><code class="p">:</code> <code class="n">TextView</code> <code class="p">=</code> <code class="n">itemView</code> <code class="k">as</code> <code class="n">TextView</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Simple! If we wanted to keep using our static array, we could create a simple class that implemented <code>BookDataSource</code> but used the hardcoded corpus very easily:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177208445912">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">HardCodedBookDataSource</code> <code class="kd">implements</code> <code class="n">BookDataSource</code> <code class="o">{</code>&#13;
  <code class="kd">public</code> <code class="n">Book</code> <code class="nf">get</code><code class="o">(</code><code class="kt">int</code> <code class="n">index</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">Book</code><code class="o">.</code><code class="na">SAMPLE_DATA</code><code class="o">[</code><code class="n">index</code><code class="o">];</code>&#13;
  <code class="o">}</code>&#13;
  <code class="kd">public</code> <code class="kt">int</code> <code class="nf">size</code><code class="o">()</code> <code class="o">{</code>&#13;
   <code class="k">return</code> <code class="n">Book</code><code class="o">.</code><code class="na">SAMPLE_DATA</code><code class="o">.</code><code class="na">length</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">HardCodedBookDataSource</code> <code class="p">:</code> <code class="n">BookDataSource</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">val</code> <code class="py">size</code><code class="p">:</code> <code class="n">Int</code>&#13;
    <code class="k">get</code><code class="p">()</code> <code class="p">=</code> <code class="n">Book</code><code class="p">.</code><code class="n">SAMPLE_DATA</code><code class="p">.</code><code class="n">size</code>&#13;
&#13;
  <code class="k">override</code> <code class="n">operator</code> <code class="k">fun</code> <code class="nf">get</code><code class="p">(</code><code class="n">index</code><code class="p">:</code> <code class="n">Int</code><code class="p">):</code> <code class="n">Book</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="n">Book</code><code class="p">.</code><code class="n">SAMPLE_DATA</code><code class="p">[</code><code class="n">index</code><code class="p">]</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>You may not have noticed, but this <code>BookDataSource</code> interface contract is implicitly satisfied by all <code>List&lt;Book&gt;</code> implementations—you could provide a data source as simple as the following:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177208139128">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Books</code> <code class="kd">extends</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="kd">implements</code> <code class="n">BookDataSource</code> <code class="o">{}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">Books</code> <code class="p">:</code> <code class="n">ArrayList</code><code class="p">&lt;</code><code class="n">Book</code><code class="p">&gt;(),</code> <code class="n">BookDataSource</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>With this type of data source, you’d implicitly have at hand all the wondrous <code>List</code> APIs like <code>add</code> and <code>addAll</code>, <code>set</code>, <code>remove</code>, <code>subList</code>, etc.</p>&#13;
&#13;
<p>So while we’re still using the hardcoded book list for now, we won’t have to make any changes to our <code>RecyclerView</code> or <code>Adapter</code>, other than updating the <code>Adapter</code> with the new source—maybe one that reads from a web server or from a local database. Great! Our list view is now a bit more dynamic even if it’s using the same data as before. We’ll get a bit further with removing our static array of <code>Book</code>s later in the chapter. For now, let’s see how we can do the same thing on iOS.<a data-primary="" data-startref="Kappdyn18" data-type="indexterm" id="idm46177208117096"/><a data-primary="" data-startref="Aaddynam18" data-type="indexterm" id="idm46177208116120"/><a data-primary="" data-startref="Jappdyn18" data-type="indexterm" id="idm46177208115176"/><a data-primary="" data-startref="ADddand18" data-type="indexterm" id="idm46177208114232"/><a data-primary="" data-startref="Ldynamicand18" data-type="indexterm" id="idm46177208113288"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="iOS" data-type="sect2"><div class="sect2" id="idm46177209203784">&#13;
<h2>iOS</h2>&#13;
&#13;
<p>Like<a data-primary="lists" data-secondary="dynamic data in list views" data-tertiary="iOS" data-type="indexterm" id="Ldynios18"/><a data-primary="iOS" data-secondary="application data" data-tertiary="dynamic data in list views" data-type="indexterm" id="IOSappdyn18"/><a data-primary="application data" data-secondary="dynamic data in list views" data-tertiary="iOS" data-type="indexterm" id="ADdynios18"/> we did in Android using the <code>Adapter</code> pattern, we need to create some separation between our controller layer and our raw data. We can do this by adding a new object to interface directly with the controller. If you’ll recall in <code>CatalogViewController</code>, we’re making the view controller adhere to the <code>UITableViewDataSource</code> protocol to serve up data for the table view.</p>&#13;
&#13;
<p>This worked fine to start, but why not create a separate object to serve up that data to the table view directly? The controller can manage that data source object, and it can manage the table view object. This creates separation between the controller, the view—in this instance the table view—and the data layer.</p>&#13;
&#13;
<p>Let’s start by adding a new file to our project called <code>ListDataSource</code> by clicking File &gt; New &gt; File in the app menu. This new object will function as the data source for our table view. For now, this file be pretty basic. Here’s an example implementation:</p>&#13;
&#13;
<pre class="small" data-code-language="swift" data-type="programlisting"><code class="kd">import</code> <code class="nc">UIKit</code>&#13;
&#13;
<code class="kd">class</code> <code class="nc">ListDataSource</code><code class="p">:</code> <code class="bp">NSObject</code> <code class="p">{</code>&#13;
&#13;
<code class="p">}</code>&#13;
<code class="kd">extension</code> <code class="nc">ListDataSource</code><code class="p">:</code> <code class="bp">UITableViewDataSource</code> <code class="p">{</code>&#13;
    <code class="kd">func</code> <code class="nf">tableView</code><code class="p">(</code><code class="kc">_</code> <code class="n">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">,</code> <code class="n">numberOfRowsInSection</code> <code class="n">section</code><code class="p">:</code> <code class="nb">Int</code><code class="p">)</code> <code class="p">-&gt;</code> <code class="nb">Int</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">Book</code><code class="p">.</code><code class="n">sampleData</code><code class="p">.</code><code class="bp">count</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">func</code> <code class="nf">tableView</code><code class="p">(</code><code class="kc">_</code> <code class="n">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">,</code>&#13;
        <code class="n">cellForRowAt</code> <code class="n">indexPath</code><code class="p">:</code> <code class="n">IndexPath</code><code class="p">)</code> <code class="p">-&gt;</code> <code class="bp">UITableViewCell</code> <code class="p">{</code>&#13;
        <code class="c1">// Dequeue a table view cell</code>&#13;
        <code class="kd">let</code> <code class="nv">cell</code> <code class="p">=</code>&#13;
          <code class="n">tableView</code><code class="p">.</code><code class="n">dequeueReusableCell</code><code class="p">(</code><code class="n">withIdentifier</code><code class="p">:</code> <code class="s">"CatalogTableViewCell"</code><code class="p">,</code>&#13;
          <code class="k">for</code><code class="p">:</code> <code class="n">indexPath</code><code class="p">)</code>&#13;
&#13;
        <code class="c1">// Find the correct book based on the row being populated</code>&#13;
        <code class="kd">let</code> <code class="nv">book</code> <code class="p">=</code> <code class="n">Book</code><code class="p">.</code><code class="n">sampleData</code><code class="p">[</code><code class="n">indexPath</code><code class="p">.</code><code class="n">row</code><code class="p">]</code>&#13;
&#13;
        <code class="c1">// Populate the table view cell title label with the book title</code>&#13;
        <code class="n">cell</code><code class="p">.</code><code class="n">textLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="n">book</code><code class="p">.</code><code class="n">title</code>&#13;
&#13;
        <code class="k">return</code> <code class="n">cell</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>You might recognize some of this code—or, if you’ve been paying attention, all of it! This is the same code we used in <code>CatalogViewController</code> to display a list of books in our book catalog. In fact, by placing this code in a separate file, we can remove all the <code>UITableViewDataSource</code> code that currently resides in <code>CatalogViewController</code>. The <code>CatalogViewController</code> file now looks like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">CatalogViewController</code><code class="p">:</code> <code class="bp">UIViewController</code> <code class="p">{</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">func</code> <code class="nf">viewDidLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="n">viewDidLoad</code><code class="p">()</code>&#13;
&#13;
        <code class="c1">// Do any additional setup after loading the view</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>If you were to build and run our application, you might see that we’ve gone a bit too far. <code>CatalogViewController</code> doesn’t have the required methods necessary to fill in as the data source for the table view, and yet it’s still linked in <em>Main.Storyboard</em>. This causes a <code>SIGABORT</code>, which crashes the application.</p>&#13;
&#13;
<p>Oops. Let’s see if we can go back and fix this. In fact, while we’re fixing things, let’s see if we can make things even better by having the table view in <code>CatalogViewController</code> use our new <code>ListDataSource</code> as its data source directly.</p>&#13;
&#13;
<p>First things first, we have to remove the linkage in <em>Main.storyboard</em>. Open up the storyboard and click on the table view. In the right pane of Xcode, click on the Connections inspector. Inside you’ll see a connection that has been made for <code>dataSource</code>. Click the “x” to remove that connection from the storyboard.</p>&#13;
&#13;
<p>Now, let’s switch the table view to use a new, discrete data source object that we create. In order to do that, we need to expose the table view to the view controller. To do that, we’re going to add a new connection using<a data-primary="Assistant editor" data-type="indexterm" id="idm46177207863608"/><a data-primary="Xcode" data-secondary="Assistant editor" data-type="indexterm" id="idm46177207862904"/> the Assistant editor in Xcode. Click the Assistant editor button in the top right of the project window. This will automatically open up the corresponding <code>CatalogViewController</code> for the scene—some might say “magically.”</p>&#13;
&#13;
<p>Once the view controller is active in both displays, Control-click on the table view and drag a connection over to the code window similar to how you wired up our browsing button in a previous chapter. You’ll drag the connection directly underneath the <code>CatalogViewController</code> class definition here:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">CatalogViewController</code><code class="p">:</code> <code class="bp">UIViewController</code> <code class="p">{</code>&#13;
&#13;
    <code class="c1">// Drag the connection to this line</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">func</code> <code class="nf">viewDidLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="n">viewDidLoad</code><code class="p">()</code>&#13;
&#13;
        <code class="c1">// Do any additional setup after loading the view</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>A modal will come up asking you if you’re creating an <code>Outlet</code>, which is a connection from a view controller to a particular view, or if you’re creating an <code>Action</code>, which is a control event (like whenever a button is pressed, for example). Leave everything as is and name our new outlet <code>tableView</code>.</p>&#13;
&#13;
<p>At this point, <code>CatalogViewController</code> should look like this:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">CatalogViewController</code><code class="p">:</code> <code class="bp">UIViewController</code> <code class="p">{</code>&#13;
&#13;
    <code class="kr">@IBOutlet</code> <code class="kr">weak</code> <code class="kd">var</code> <code class="nv">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">!</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">func</code> <code class="nf">viewDidLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="n">viewDidLoad</code><code class="p">()</code>&#13;
&#13;
        <code class="c1">// Do any additional setup after loading the view</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>We’ve wired a connection from the storyboard to the view controller to expose our table view directly to the view controller. The reason for this connection was to enable us to set up the table view’s data source inside the view controller class. Take a look at how this is done:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">CatalogViewController</code><code class="p">:</code> <code class="bp">UIViewController</code> <code class="p">{</code>&#13;
&#13;
    <code class="kr">@IBOutlet</code> <code class="kr">weak</code> <code class="kd">var</code> <code class="nv">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">!</code>&#13;
    <code class="kr">lazy</code> <code class="kd">var</code> <code class="nv">dataSource</code><code class="p">:</code> <code class="n">ListDataSource</code> <code class="p">=</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">ListDataSource</code><code class="p">()</code>&#13;
    <code class="p">}()</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">func</code> <code class="nf">viewDidLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="n">viewDidLoad</code><code class="p">()</code>&#13;
        <code class="n">tableView</code><code class="p">.</code><code class="n">dataSource</code> <code class="p">=</code> <code class="n">dataSource</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Let’s walk through the code.</p>&#13;
&#13;
<p>The first thing to note is that we’ve added a new <code>lazy</code> property called <code>dataSource</code> inside <code>CatalogViewController</code>. The <code>lazy</code> operator makes it so this object isn’t instantiated until the property is accessed. This is generally considered a good practice for data sources due to the time required for spinning up the object occasionally. In our case, our data source is pretty lightweight, but it’s a good habit to get into. It also allows us to keep our initialization code contained. In this case, we’re simply creating a new instance of <code>ListDataSource</code>.</p>&#13;
&#13;
<p>Next, inside <code>viewDidLoad</code>, we’ve added some new code. This method is called as part of the life cycle of a view; when it’s called, we can safely assume that our outlets and actions are wired up and the view controller’s <code>view</code> is loaded. This method is only called once in the life cycle of a view, but that’s all right because we only need it once.</p>&#13;
&#13;
<p>Inside <code>viewDidLoad</code>, we’re setting the <code>dataSource</code> property of the table view to the data source we’ve created inside the view controller. If you build and run the application, you’ll notice the catalog loads the same as before.</p>&#13;
&#13;
<p>At this point, you might be asking yourself: why does this matter? It seems more complicated to create a full-blown data layer than to have the view controllers supply their data directly.</p>&#13;
&#13;
<p>Fair point.</p>&#13;
&#13;
<p>However, if you’ll recall, we’re still using static, hardcoded data in our app. Let’s see what happens when we transition to something more portable. You’ll see the full power of abstracting our data out of the view layer. Let’s go!<a data-primary="" data-startref="ADdynios18" data-type="indexterm" id="idm46177207685880"/><a data-primary="" data-startref="IOSappdyn18" data-type="indexterm" id="idm46177207684904"/><a data-primary="" data-startref="Ldynios18" data-type="indexterm" id="idm46177207683960"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="It’s Time for Our Model Objects to Get Real" data-type="sect1"><div class="sect1" id="idm46177208056424">&#13;
<h1>It’s Time for Our Model Objects to Get Real</h1>&#13;
&#13;
<p>All right. Our <code>Book</code> object has a few properties. But, let’s be honest. Most books have <em>much</em> more metadata other than what we’ve been showing so far. Additionally, if we want to change our data, we have to release a new version of our applications. And, those applications have to be in sync with each other. This gets harder as you add the ability to save books for later and as the application grows in complexity.</p>&#13;
&#13;
<p>As Dr. Phil (yes, that Dr. Phil) would say, “It’s time for our model objects to <em>get real</em>.”</p>&#13;
&#13;
<p>Fortunately, we can solve this in two ways:</p>&#13;
<ol>&#13;
<li>&#13;
<p>By switching from static, hardcoded data to something portable like JSON.</p>&#13;
</li>&#13;
<li>&#13;
<p>By switching from a static, hardcoded data source to something served up via a server, or another source of truth beyond the application.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>As mentioned earlier in this chapter, we’ll address number 2 in <a data-type="xref" href="ch06.html#topics_files">Chapter 6</a> of this book. However, let’s take a look at number 1: switching to JSON.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="JSON for One, JSON for All" data-type="sect1"><div class="sect1" id="idm46177207675608">&#13;
<h1>JSON for One, JSON for All</h1>&#13;
&#13;
<p>We’ve<a data-primary="application data" data-secondary="JSON model layer" data-tertiary="example of" data-type="indexterm" id="idm46177207674104"/> decided we’re going to use JSON. Here’s an example of what our <code>Book</code> objects could look like in JSON:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="p">{</code>&#13;
    <code class="s">"title"</code><code class="p">:</code> <code class="s">"..."</code><code class="p">,</code>&#13;
    <code class="s">"authors"</code><code class="p">:</code> <code class="p">[</code><code class="s">"..."</code><code class="p">],</code>&#13;
    <code class="s">"isbn"</code><code class="p">:</code> <code class="s">"..."</code><code class="p">,</code>&#13;
    <code class="s">"pageCount"</code><code class="p">:</code> <code class="mi">0</code><code class="p">,</code>&#13;
    <code class="s">"fiction"</code><code class="p">:</code> <code class="kc">true</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In fact, if we take the data in the <code>sampleData</code> property we added to our <code>Book</code> object earlier, transform it to JSON, and save it as a new file named <em>catalog.json</em>, we end up with a file that looks like so:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">[</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Fight Club"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Chuck Palahniuk"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0393039764"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">208</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"2001: A Space Odyssey"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Arthur C. Clarke"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0451457998"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">296</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Ulysses"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"James Joyce"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-1420953961"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">682</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Catch-22"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Joseph Heller"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-1451626650"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">544</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"The Stand"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Stephen King"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0307947307"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">1200</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"On The Road"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Jack Kerouac"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0143105466"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">416</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Heart of Darkness"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Joseph Conrad"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-1503275928"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">78</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"A Brief History of Time"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Stephen Hawking"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0553380163"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">212</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">false</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Dispatches"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Michael Herr"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0679735250"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">272</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">false</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Harry Potter and Prisoner of Azkaban"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"J.K. Rowling"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0439136365"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">448</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">},</code>&#13;
	<code class="p">{</code>&#13;
		<code class="s2">"title"</code><code class="o">:</code> <code class="s2">"Dragons Love Tacos"</code><code class="p">,</code>&#13;
		<code class="s2">"authors"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"Adam Rubin"</code><code class="p">,</code> <code class="s2">"Daniel Salmieri"</code><code class="p">],</code>&#13;
		<code class="s2">"isbn"</code><code class="o">:</code> <code class="s2">"978-0803736801"</code><code class="p">,</code>&#13;
		<code class="s2">"pageCount"</code><code class="o">:</code> <code class="mi">40</code><code class="p">,</code>&#13;
		<code class="s2">"fiction"</code><code class="o">:</code> <code class="kc">true</code>&#13;
	<code class="p">}</code>&#13;
<code class="p">]</code></pre>&#13;
&#13;
<p>Feel free to add additional books; this is the time for personal favorites and guilty pleasures.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Switch the Model Layer to JSON" data-type="sect1"><div class="sect1" id="idm46177207615640">&#13;
<h1>Switch the Model Layer to JSON</h1>&#13;
&#13;
<p>If you’ll recall, in our data layer code so far, we’re still using the <code>sampleData</code> provided by the <code>Book</code> object. Let’s remove that in both projects and switch to using our JSON directly.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Android" data-type="sect2"><div class="sect2" id="idm46177207613512">&#13;
<h2>Android</h2>&#13;
&#13;
<p>So, we’ve<a data-primary="Android" data-secondary="application data" data-tertiary="switching Android model layer to JSON" data-type="indexterm" id="Aadswitch18"/><a data-primary="JSON (JavaScript Object Notation)" data-secondary="switching Android model layer to JSON" data-type="indexterm" id="JSONswitch18"/><a data-primary="application data" data-secondary="JSON model layer" data-tertiary="switching Android to" data-type="indexterm" id="ADjsonswitch19"/> now got a file called <em>catalog.json</em> with all the JSON <code>Book</code> representations, saved on disk. Let’s assume, for the Android app, that it’s saved as an asset, in the project-level <em>/assets/</em> folder. This folder has special attributes and APIs to make operations just like the one we’re describing easier to use, and may not be available immediately—if you don’t see a folder named “assets” in your project’s source, make sure you’re in the “Android” project view from the drop-down directly above the file list in the lefthand window pane, then right-click the project name in<a data-primary="Android Studio" data-secondary="switching model layer to JSON" data-type="indexterm" id="idm46177206432856"/> Android Studio and select New, then Folder, then Assets Folder. You can create a new text file in this directory, copy the preceding JSON, and save the file as <em>catalog.json</em>.</p>&#13;
&#13;
<p>Let’s convert our <code>BookDataSource</code> to use that instead. To start off, we’ll read the file on the UI thread, but that’s just step one—any time you’re touching disk or the wire, make sure you’re working in a background thread.</p>&#13;
&#13;
<p>If we refer back to the sample code in <a data-type="xref" href="ch06.html#topics_files">Chapter 6</a>, you may remember how to read a file from disk. If you think back to the exercises in <a data-type="xref" href="ch12.html#topics_transports">Chapter 12</a>, you may remember a couple ways to parse JSON into valid Java object instances. We’ll use techniques from both.</p>&#13;
&#13;
<p>Let’s have our data source class provide this functionality, although in time you might find it more appropriate to separate out some of the logic. For now, let’s start out with that basic <code>List&lt;Book&gt;</code> data source, but we’ll dress it up so that on instantiation, it reads <em>catalog.json</em>, converts each JSON object to a Java <code>Book</code> instance, and<a data-primary="Java" data-secondary="switching Android model layer to JSON" data-type="indexterm" id="Jswitch18"/><a data-primary="Kotlin" data-secondary="switching Android model layer to JSON" data-type="indexterm" id="Kswitch18"/> adds all of those <code>Books</code> to itself (an <code>ArrayList</code>):</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177206422472">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Books</code> <code class="kd">extends</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="kd">implements</code> <code class="n">BookDataSource</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">Books</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">();</code>&#13;
    <code class="k">try</code> <code class="o">{</code>&#13;
      <code class="n">readBooksFromDisk</code><code class="o">(</code><code class="n">context</code><code class="o">);</code>&#13;
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
      <code class="n">Log</code><code class="o">.</code><code class="na">d</code><code class="o">(</code><code class="s">"MyApp"</code><code class="o">,</code> <code class="s">"There was a problem reading Books json from disk: "</code> <code class="o">+</code>&#13;
      <code class="n">e</code><code class="o">.</code><code class="na">getMessage</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">private</code> <code class="kt">void</code> <code class="nf">readBooksFromDisk</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
    <code class="k">try</code> <code class="o">{</code>&#13;
      <code class="n">InputStream</code> <code class="n">inputStream</code> <code class="o">=</code> <code class="n">context</code><code class="o">.</code><code class="na">getAssets</code><code class="o">().</code><code class="na">open</code><code class="o">(</code><code class="s">"catalog.json"</code><code class="o">);</code>&#13;
      <code class="n">StringBuilder</code> <code class="n">builder</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringBuilder</code><code class="o">();</code>&#13;
      <code class="kt">int</code> <code class="n">b</code> <code class="o">=</code> <code class="n">inputStream</code><code class="o">.</code><code class="na">read</code><code class="o">();</code>&#13;
      <code class="k">while</code> <code class="o">(</code><code class="n">b</code> <code class="o">!=</code> <code class="o">-</code><code class="mi">1</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">builder</code><code class="o">.</code><code class="na">append</code><code class="o">((</code><code class="kt">char</code><code class="o">)</code> <code class="n">b</code><code class="o">);</code>&#13;
        <code class="n">b</code> <code class="o">=</code> <code class="n">inputStream</code><code class="o">.</code><code class="na">read</code><code class="o">();</code>&#13;
      <code class="o">}</code>&#13;
      <code class="n">String</code> <code class="n">json</code> <code class="o">=</code> <code class="n">builder</code><code class="o">.</code><code class="na">toString</code><code class="o">();</code>&#13;
      <code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="n">books</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Gson</code><code class="o">().</code><code class="na">fromJson</code><code class="o">(</code><code class="n">json</code><code class="o">,</code>&#13;
      <code class="k">new</code> <code class="n">TypeToken</code><code class="o">&lt;</code><code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;&gt;()</code> <code class="o">{}.</code><code class="na">getType</code><code class="o">());</code> <code class="n">addAll</code><code class="o">(</code><code class="n">books</code><code class="o">);</code>&#13;
    <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>&#13;
      <code class="k">if</code> <code class="o">(</code><code class="n">inputStream</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">inputStream</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
      <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
   <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">Books</code><code class="p">(</code><code class="n">context</code><code class="p">:</code> <code class="n">Context</code><code class="p">)</code> <code class="p">:</code> <code class="n">ArrayList</code><code class="p">&lt;</code><code class="n">Book</code><code class="p">&gt;(),</code> <code class="n">BookDataSource</code> <code class="p">{</code>&#13;
&#13;
  <code class="n">init</code> <code class="p">{</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
      <code class="n">readBooksFromDisk</code><code class="p">(</code><code class="n">context</code><code class="p">)</code>&#13;
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="n">e</code><code class="p">:</code> <code class="n">Exception</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="n">Log</code><code class="p">.</code><code class="n">d</code><code class="p">(</code><code class="s">"MyApp"</code><code class="p">,</code> <code class="s">"There was a problem reading Books json from disk: "</code> <code class="p">+</code> <code class="n">e</code><code class="p">.</code><code class="n">message</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="n">@Throws</code><code class="p">(</code><code class="n">IOException</code><code class="o">::</code><code class="k">class</code><code class="p">)</code>&#13;
  <code class="k">private</code> <code class="k">fun</code> <code class="nf">readBooksFromDisk</code><code class="p">(</code><code class="n">context</code><code class="p">:</code> <code class="n">Context</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
      <code class="k">val</code> <code class="py">inputStream</code><code class="p">?</code> <code class="p">=</code> <code class="n">context</code><code class="p">.</code><code class="n">assets</code><code class="p">.</code><code class="k">open</code><code class="p">(</code><code class="s">"catalog.json"</code><code class="p">);</code>&#13;
      <code class="k">val</code> <code class="py">builder</code> <code class="p">=</code> <code class="n">StringBuilder</code><code class="p">()</code>&#13;
      <code class="k">var</code> <code class="py">b</code> <code class="p">=</code> <code class="n">inputStream</code><code class="p">.</code><code class="n">read</code><code class="p">()</code>&#13;
      <code class="k">while</code> <code class="p">(</code><code class="n">b</code> <code class="p">!=</code> <code class="p">-</code><code class="m">1</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="n">builder</code><code class="p">.</code><code class="n">append</code><code class="p">(</code><code class="n">b</code><code class="p">.</code><code class="n">toChar</code><code class="p">())</code>&#13;
        <code class="n">b</code> <code class="p">=</code> <code class="n">inputStream</code><code class="p">.</code><code class="n">read</code><code class="p">()</code>&#13;
      <code class="p">}</code>&#13;
      <code class="k">val</code> <code class="py">json</code> <code class="p">=</code> <code class="n">builder</code><code class="p">.</code><code class="n">toString</code><code class="p">()</code>&#13;
      <code class="k">val</code> <code class="py">books</code> <code class="p">=</code> <code class="n">Gson</code><code class="p">().</code><code class="n">fromJson</code><code class="p">(</code><code class="n">json</code><code class="p">,</code> <code class="k">object</code> <code class="err">: </code><code class="nc">TypeToken</code><code class="p">&lt;</code><code class="n">List</code><code class="p">&lt;</code><code class="n">Book</code><code class="p">&gt;&gt;()</code> <code class="p">{}.</code><code class="k">type</code><code class="p">)</code>&#13;
      <code class="n">addAll</code><code class="p">(</code><code class="n">books</code><code class="p">)</code>&#13;
    <code class="p">}</code> <code class="k">finally</code> <code class="p">{</code>&#13;
      <code class="n">inputStream</code><code class="o">?.</code><code class="n">close</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>If you run that, you will get an array of <code>Book</code> instances of a number equal to the JSON objects in <em>catalog.json</em>; however, if you used the Java implementation, those instances will be bare. Each property will be default. That’s because of the Hungarian notation we used when defining <code>Book</code> properties:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Book</code> <code class="o">{</code>&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">mTitle</code><code class="o">;</code>&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">mAuthors</code><code class="o">;</code>&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">mIsbn</code><code class="o">;</code>&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">mPageCount</code><code class="o">;</code>&#13;
  <code class="kd">private</code> <code class="kd">final</code> <code class="kt">boolean</code> <code class="n">mIsFiction</code><code class="o">;</code>&#13;
  <code class="o">...</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>When<a data-primary="Gson" data-type="indexterm" id="idm46177205637112"/> Gson looks at the <code>Book</code> class and tries to find properties to map from the JSON it’s handed, it’ll find that the <code>Book</code> class instance wants an “mTitle” and doesn’t care about “title”—on the other hand, the JSON has no reference to “mTitle” or “mIsbn” or “mAnything”—it’s using human-readable key names. Fortunately for us, this is a common issue in Android and one that’s easily fixed using Gson’s <code>SerializedName</code> annotation. Supply a <code>String</code> to this annotation, and Gson will check both that <code>String</code> and the actual property name. Make the following updates and run it again. In Java:</p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Book</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">Book</code><code class="o">[]</code> <code class="n">SAMPLE_DATA</code> <code class="o">=</code> <code class="o">{</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Fight Club"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Chuck Palahniuk"</code><code class="o">},</code> <code class="s">"978-0393039764"</code><code class="o">,</code> <code class="mi">208</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"2001: A Space Odyssey"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Arthur C. Clarke"</code><code class="o">},</code> <code class="s">"978-0451457998"</code><code class="o">,</code>&#13;
        <code class="mi">296</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Ulysses"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"James Joyce"</code><code class="o">},</code> <code class="s">"978-1420953961"</code><code class="o">,</code> <code class="mi">682</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Catch-22"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Joseph Heller"</code><code class="o">},</code> <code class="s">"978-1451626650"</code><code class="o">,</code> <code class="mi">544</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"The Stand"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Stephen King"</code><code class="o">},</code> <code class="s">"978-0307947307"</code><code class="o">,</code> <code class="mi">1200</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"On The Road"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Jack Kerouac"</code><code class="o">},</code> <code class="s">"978-0143105466"</code><code class="o">,</code> <code class="mi">416</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Heart of Darkness"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Joseph Conrad"</code><code class="o">},</code> <code class="s">"978-1503275928"</code><code class="o">,</code> <code class="mi">78</code><code class="o">,</code>&#13;
      <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"A Brief History of Time"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Stephen Hawking"</code><code class="o">},</code> <code class="s">"978-0553380163"</code><code class="o">,</code>&#13;
        <code class="mi">212</code><code class="o">,</code> <code class="kc">false</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Dispatches"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Michael Herr"</code><code class="o">},</code> <code class="s">"978-0679735250"</code><code class="o">,</code> <code class="mi">272</code><code class="o">,</code> <code class="kc">false</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Harry Potter and Prisoner of Azkaban"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"J.K. Rowling"</code><code class="o">},</code>&#13;
      <code class="s">"978-0439136365"</code><code class="o">,</code> <code class="mi">448</code><code class="o">,</code> <code class="kc">true</code><code class="o">),</code>&#13;
      <code class="k">new</code> <code class="nf">Book</code><code class="o">(</code><code class="s">"Dragons Love Tacos"</code><code class="o">,</code> <code class="k">new</code> <code class="n">String</code><code class="o">[]{</code><code class="s">"Adam Rubin"</code><code class="o">,</code> <code class="s">"Daniel Salmieri"</code><code class="o">},</code>&#13;
      <code class="s">"978-0803736801"</code><code class="o">,</code> <code class="mi">40</code><code class="o">,</code> <code class="kc">true</code><code class="o">)</code>&#13;
  <code class="o">};</code>&#13;
&#13;
  <code class="nd">@SerializedName</code><code class="o">(</code><code class="s">"title"</code><code class="o">)</code>&#13;
  <code class="kd">private</code> <code class="n">String</code> <code class="n">mTitle</code><code class="o">;</code>&#13;
  <code class="nd">@SerializedName</code><code class="o">(</code><code class="s">"authors"</code><code class="o">)</code>&#13;
  <code class="kd">private</code> <code class="n">String</code><code class="o">[]</code> <code class="n">mAuthors</code><code class="o">;</code>&#13;
  <code class="nd">@SerializedName</code><code class="o">(</code><code class="s">"isbn"</code><code class="o">)</code>&#13;
  <code class="kd">private</code> <code class="n">String</code> <code class="n">mIsbn</code><code class="o">;</code>&#13;
  <code class="nd">@SerializedName</code><code class="o">(</code><code class="s">"pageCount"</code><code class="o">)</code>&#13;
  <code class="kd">private</code> <code class="kt">int</code> <code class="n">mPageCount</code><code class="o">;</code>&#13;
  <code class="nd">@SerializedName</code><code class="o">(</code><code class="s">"fiction"</code><code class="o">)</code>&#13;
  <code class="kd">private</code> <code class="kt">boolean</code> <code class="n">mIsFiction</code><code class="o">;</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">Book</code><code class="o">(</code><code class="n">String</code> <code class="n">title</code><code class="o">,</code> <code class="n">String</code><code class="o">[]</code> <code class="n">authors</code><code class="o">,</code> <code class="n">String</code> <code class="n">isbn</code><code class="o">,</code> <code class="kt">int</code> <code class="n">pageCount</code><code class="o">,</code>&#13;
  <code class="kt">boolean</code> <code class="n">isFiction</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mTitle</code> <code class="o">=</code> <code class="n">title</code><code class="o">;</code>&#13;
    <code class="n">mAuthors</code> <code class="o">=</code> <code class="n">authors</code><code class="o">;</code>&#13;
    <code class="n">mIsbn</code> <code class="o">=</code> <code class="n">isbn</code><code class="o">;</code>&#13;
    <code class="n">mPageCount</code> <code class="o">=</code> <code class="n">pageCount</code><code class="o">;</code>&#13;
    <code class="n">mIsFiction</code> <code class="o">=</code> <code class="n">isFiction</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="n">String</code> <code class="nf">getTitle</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mTitle</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setTitle</code><code class="o">(</code><code class="n">String</code> <code class="n">title</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mTitle</code> <code class="o">=</code> <code class="n">title</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="n">String</code><code class="o">[]</code> <code class="nf">getAuthors</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mAuthors</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setAuthors</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">authors</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mAuthors</code> <code class="o">=</code> <code class="n">authors</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="n">String</code> <code class="nf">getIsbn</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mIsbn</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setIsbn</code><code class="o">(</code><code class="n">String</code> <code class="n">isbn</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mIsbn</code> <code class="o">=</code> <code class="n">isbn</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getPageCount</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mPageCount</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setPageCount</code><code class="o">(</code><code class="kt">int</code> <code class="n">pageCount</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mPageCount</code> <code class="o">=</code> <code class="n">pageCount</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">isFiction</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">mIsFiction</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setFiction</code><code class="o">(</code><code class="kt">boolean</code> <code class="n">fiction</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">mIsFiction</code> <code class="o">=</code> <code class="n">fiction</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>This time, your <code>Book</code> instances should be fully and appropriately populated. That’s it! You’ve got a working serialization protocol. Let’s examine a few of the features that might be under your radar. To start, one thing you might notice in the preceding code is this hard-to-read mouthful:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177205585432">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="n">books</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Gson</code><code class="o">().</code><code class="na">fromJson</code><code class="o">(</code><code class="n">json</code><code class="o">,</code> <code class="k">new</code> <code class="n">TypeToken</code><code class="o">&lt;</code><code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;&gt;()</code> <code class="o">{}.</code><code class="na">getType</code><code class="o">());</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="n">val</code> <code class="nl">books:</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="o">=</code> <code class="n">Gson</code><code class="o">().</code><code class="na">fromJson</code><code class="o">(</code><code class="n">json</code><code class="o">,</code> <code class="nl">object:</code><code class="n">TypeToken</code><code class="o">&lt;</code><code class="n">List</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;&gt;()</code> <code class="o">{}.</code><code class="na">type</code><code class="o">)</code></pre>&#13;
</div></aside>&#13;
&#13;
<p><code>Gson</code> can do a great job of converting a single <code>Book</code> instance to, and from, a JSON string, but when we start getting into collections, things become a little less straightforward. One option is to just create a class that has a generic:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177205100456">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Books</code> <code class="kd">extends</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="o">{}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">Books</code> <code class="p">:</code> <code class="n">ArrayList</code><code class="p">&lt;</code><code class="n">Book</code><code class="p">&gt;()</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>This could be called using the traditional Gson method <code>fromJson</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code> <code class="n">json</code> <code class="o">=</code> <code class="c1">// ... some string represetning multiple Book JSON objects</code>&#13;
<code class="n">Books</code> <code class="n">books</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Gson</code><code class="o">().</code><code class="na">fromJson</code><code class="o">(</code><code class="n">json</code><code class="o">,</code> <code class="n">Books</code><code class="o">.</code><code class="na">class</code><code class="o">);</code></pre>&#13;
&#13;
<p>Failing that, however, we can use the <code>TypeToken</code> class to dynamically generate the generics. You’re creating an instance of a new <code>TypeToken</code> subclass that then invokes its <code>getType</code> method, so the syntax is effectively:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="k">new</code> <code class="n">TypeToken</code><code class="o">&lt;</code><code class="n">GENERICIZED_DATA_TYPE</code><code class="o">&gt;()</code> <code class="o">{</code>&#13;
  <code class="c1">// no op</code>&#13;
<code class="o">}.</code><code class="na">getType</code><code class="o">();</code></pre>&#13;
&#13;
<p>In that example, “GENERICIZED_DATA_TYPE” is any number of data types including any number of generics; it might be as simple as <code>new TypeToken&lt;Date&gt;...</code>, or it could have several nested layers, like <code>new TypeToken&lt;List&lt;Map&lt;String, List&lt;Date&gt;&gt;&gt;...</code></p>&#13;
&#13;
<p>Back to the example at hand. Using this new data source will automatically update your <code>Adapter</code> and <code>RecyclerView</code>, and you don’t even need to change your adapter code at all; just make sure when you supply the data source to the <code>Adapter</code> class, the constructor includes a <code>Context</code> parameter, so we can get the right files directory:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177204927784">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">recyclerView</code><code class="o">.</code><code class="na">setAdapter</code><code class="o">(</code><code class="k">new</code> <code class="n">BrowseBooksAdapter</code><code class="o">(</code><code class="k">new</code> <code class="n">Books</code><code class="o">(</code><code class="n">context</code><code class="o">)));</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">recyclerView</code><code class="p">.</code><code class="n">adapter</code> <code class="p">=</code> <code class="n">BrowseBooksAdapter</code><code class="p">(</code><code class="n">Books</code><code class="p">(</code><code class="n">context</code><code class="p">))</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Another interesting trick here is that <code>Books</code> is itself a <code>List</code> of <code>Book</code> instances, so instead of the updated data source you see in the preceding code, you could read the file out using a utility method and use Gson to convert that string directly into the data source. Let’s assume we revert to the original <code>Books</code> class with no method:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177204836648">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Books</code> <code class="kd">extends</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="n">Book</code><code class="o">&gt;</code> <code class="kd">implements</code> <code class="n">BookDataSource</code> <code class="o">{}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">Books</code> <code class="p">:</code> <code class="n">ArrayList</code><code class="p">&lt;</code><code class="n">Book</code><code class="p">&gt;(),</code> <code class="n">BookDataSource</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Let’s also assume we have access to the methods in <a data-type="xref" href="ch06.html#topics_files">Chapter 6</a>. We might do something like this in the <code>Activity</code>’s <code>onCreate</code> method:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177204863560">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BrowseContentActivity</code> <code class="kd">extends</code> <code class="n">Activity</code> <code class="o">{</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">onCreate</code><code class="o">(</code><code class="n">Bundle</code> <code class="n">savedInstanceState</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">.</code><code class="na">onCreate</code><code class="o">(</code><code class="n">savedInstanceState</code><code class="o">);</code>&#13;
    <code class="n">setContentView</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">layout</code><code class="o">.</code><code class="na">activity_browse</code><code class="o">);</code>&#13;
    <code class="n">RecyclerView</code> <code class="n">recyclerView</code> <code class="o">=</code> <code class="n">findViewById</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">id</code><code class="o">.</code><code class="na">browse_content_recyclerview</code><code class="o">);</code>&#13;
    <code class="k">try</code> <code class="o">{</code>&#13;
      <code class="n">InputStream</code> <code class="n">stream</code> <code class="o">=</code> <code class="n">getAssets</code><code class="o">().</code><code class="na">open</code><code class="o">(</code><code class="s">"catalog.json"</code><code class="o">);</code>&#13;
      <code class="n">String</code> <code class="n">json</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">getStringFromStream</code><code class="o">();</code>&#13;
      <code class="n">Books</code> <code class="n">source</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Gson</code><code class="o">().</code><code class="na">fromJson</code><code class="o">(</code><code class="n">json</code><code class="o">,</code> <code class="n">Books</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>&#13;
      <code class="n">BrowseBooksAdapter</code> <code class="n">adapter</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BrowseBooksAdapter</code><code class="o">(</code><code class="n">source</code><code class="o">);</code>&#13;
      <code class="n">recyclerView</code><code class="o">.</code><code class="na">setAdapter</code><code class="o">(</code><code class="n">adapter</code><code class="o">);</code>&#13;
      <code class="n">recyclerView</code><code class="o">.</code><code class="na">setLayoutManager</code><code class="o">(</code><code class="k">new</code> <code class="n">LinearLayoutManager</code><code class="o">(</code><code class="k">this</code><code class="o">));</code>&#13;
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
      <code class="n">Log</code><code class="o">.</code><code class="na">d</code><code class="o">(</code><code class="s">"MyApp"</code><code class="o">,</code> <code class="s">"Oops! Something went wrong trying to read our catalog json"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
  <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">BrowseContentActivity</code> <code class="p">:</code> <code class="n">Activity</code><code class="p">()</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onCreate</code><code class="p">(</code><code class="n">savedInstanceState</code><code class="p">:</code> <code class="n">Bundle</code><code class="p">?)</code> <code class="p">{</code>&#13;
    <code class="k">super</code><code class="p">.</code><code class="n">onCreate</code><code class="p">(</code><code class="n">savedInstanceState</code><code class="p">)</code>&#13;
    <code class="n">setContentView</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">layout</code><code class="p">.</code><code class="n">activity_browse</code><code class="p">)</code>&#13;
    <code class="k">val</code> <code class="py">recyclerView</code> <code class="p">=</code> <code class="n">findViewById</code><code class="p">&lt;</code><code class="n">RecyclerView</code><code class="p">&gt;(</code><code class="n">R</code><code class="p">.</code><code class="n">id</code><code class="p">.</code><code class="n">browse_content_recyclerview</code><code class="p">)</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="k">val</code> <code class="py">stream</code> <code class="p">=</code> <code class="n">assets</code><code class="p">.</code><code class="k">open</code><code class="p">(</code><code class="s">"catalog.json"</code><code class="p">)</code>&#13;
    <code class="k">val</code> <code class="py">json</code> <code class="p">=</code> <code class="n">Files</code><code class="p">.</code><code class="n">getStringFromStream</code><code class="p">(</code><code class="n">stream</code><code class="p">)</code>&#13;
    <code class="k">val</code> <code class="py">source</code> <code class="p">=</code> <code class="n">Gson</code><code class="p">().</code><code class="n">fromJson</code><code class="p">&lt;</code><code class="n">Books</code><code class="p">&gt;(</code><code class="n">json</code><code class="p">,</code> <code class="n">Books</code><code class="o">::</code><code class="k">class</code><code class="p">)</code>&#13;
    <code class="k">val</code> <code class="py">adapter</code> <code class="p">=</code> <code class="n">BrowseBooksAdapter</code><code class="p">(</code><code class="n">source</code><code class="p">)</code>&#13;
    <code class="n">recyclerView</code><code class="p">.</code><code class="n">adapter</code> <code class="p">=</code> <code class="n">adapter</code>&#13;
    <code class="n">recyclerView</code><code class="p">.</code><code class="n">layoutManager</code> <code class="p">=</code> <code class="n">LinearLayoutManager</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>&#13;
    <code class="p">}</code> <code class="k">catch</code><code class="p">(</code><code class="n">e</code><code class="p">:</code> <code class="n">IOExeption</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="n">Log</code><code class="p">.</code><code class="n">d</code><code class="p">(</code><code class="s">"MyApp"</code><code class="p">,</code> <code class="s">"Oops! Something went wrong trying to read our catalog json"</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Since <code>Books</code> is also an <code>ArrayList</code>, it’ll be populated by each of the books in <em>catalog.json</em> and so be able to successfully satisfy the <code>get</code> and <code>size</code> contract requirements of <code>BookDataSource</code> implicitly.</p>&#13;
&#13;
<p>Now that we’ve got that set up, we no longer need the static data structure <code>SAMPLE_DATA</code> on the <code>Book</code> class and can safely delete it. One handy feature of<a data-primary="Android Studio" data-secondary="Refactor options" data-type="indexterm" id="idm46177204412856"/> Android Studio is the “Refactor” options. Besides having functions to rename methods or variables everywhere they appear in your project, it can also run a “Safe Delete” and only delete a variable if it’s no longer used in the project. Try this out on <code>Book.SAMPLE_DATA</code> after making the preceding updates and you should see it delete safely.<a data-primary="" data-startref="JSONswitch18" data-type="indexterm" id="idm46177204411096"/><a data-primary="" data-startref="Aadswitch18" data-type="indexterm" id="idm46177204410120"/><a data-primary="" data-startref="Kswitch18" data-type="indexterm" id="idm46177204409176"/><a data-primary="" data-startref="Jswitch18" data-type="indexterm" id="idm46177204408232"/><a data-primary="" data-startref="ADjsonswitch19" data-type="indexterm" id="idm46177204407288"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="iOS" data-type="sect2"><div class="sect2" id="idm46177207612568">&#13;
<h2>iOS</h2>&#13;
&#13;
<p>In<a data-primary="application data" data-secondary="JSON model layer" data-tertiary="switching iOS to" data-type="indexterm" id="idm46177204405192"/><a data-primary="JSON (JavaScript Object Notation)" data-secondary="switching model layer to iOS" data-type="indexterm" id="idm46177204403912"/><a data-primary="iOS" data-secondary="application data" data-tertiary="switching model layer to" data-type="indexterm" id="idm46177204403032"/> iOS, it’s remarkably easy to get started with JSON by using the built-in<a data-primary="Codable protocol" data-type="indexterm" id="idm46177204401720"/> <code>Codable</code> protocol. This a protocol composed of <code>Encodable</code> and <code>Decodable</code> protocols. They provide some understanding necessary for the Swift compiler to reason about the code.</p>&#13;
&#13;
<p>For more information on the details of <code>Codable</code>, read <a data-type="xref" href="ch12.html#topics_transports">Chapter 12</a>. For now, however, here’s an example of how <code>Codable</code> allows us to utilize JSON easily in our applications.</p>&#13;
&#13;
<p>Let’s add support for <code>Codable</code> inside the <code>Book</code> struct:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">struct</code> <code class="nc">Book</code><code class="p">:</code> <code class="n">Codable</code> <code class="p">{</code>&#13;
    <code class="kd">let</code> <code class="nv">title</code><code class="p">:</code> <code class="nb">String</code>&#13;
    <code class="kd">let</code> <code class="nv">authors</code><code class="p">:</code> <code class="p">[</code><code class="nb">String</code><code class="p">]</code>&#13;
    <code class="kd">let</code> <code class="nv">isbn</code><code class="p">:</code> <code class="nb">String</code>&#13;
    <code class="kd">let</code> <code class="nv">pageCount</code><code class="p">:</code> <code class="nb">Int</code>&#13;
    <code class="kd">let</code> <code class="nv">fiction</code><code class="p">:</code> <code class="nb">Bool</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>That’s it. You might notice that we’ve removed our <code>sampleData</code> property from our object as well. This is intentional because we’re now going to switch <code>ListDataSource</code> from using <code>sampleData</code> to using our newly created <em>catalog.json</em>, which contains the entirety of our catalog of books.</p>&#13;
&#13;
<p>Let’s take a look at <code>ListDataSource</code>:</p>&#13;
&#13;
<pre class="small" data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">ListDataSource</code><code class="p">:</code> <code class="bp">NSObject</code> <code class="p">{</code>&#13;
    <code class="kr">lazy</code> <code class="kd">var</code> <code class="nv">data</code><code class="p">:</code> <code class="p">[</code><code class="n">Book</code><code class="p">]</code> <code class="p">=</code> <code class="p">{</code>&#13;
        <code class="k">do</code> <code class="p">{</code>&#13;
            <code class="k">guard</code> <code class="kd">let</code> <code class="nv">rawCatalogData</code> <code class="p">=</code>&#13;
                <code class="k">try</code><code class="p">?</code> <code class="n">Data</code><code class="p">(</code><code class="n">contentsOf</code><code class="p">:</code>&#13;
                <code class="n">Bundle</code><code class="p">.</code><code class="n">main</code><code class="p">.</code><code class="n">bundleURL</code><code class="p">.</code><code class="n">appendingPathComponent</code><code class="p">(</code><code class="s">"catalog.json"</code><code class="p">))</code> <code class="k">else</code> <code class="p">{</code>&#13;
                <code class="k">return</code> <code class="p">[]</code>&#13;
            <code class="p">}</code>&#13;
            <code class="k">return</code> <code class="k">try</code> <code class="n">JSONDecoder</code><code class="p">().</code><code class="n">decode</code><code class="p">([</code><code class="n">Book</code><code class="p">].</code><code class="kc">self</code><code class="p">,</code> <code class="n">from</code><code class="p">:</code> <code class="n">rawCatalogData</code><code class="p">)</code>&#13;
        <code class="p">}</code> <code class="k">catch</code> <code class="p">{</code>&#13;
            <code class="bp">print</code><code class="p">(</code><code class="s">"Catalog.json was not found or is not decodable."</code><code class="p">)</code>&#13;
        <code class="p">}</code>&#13;
        <code class="k">return</code> <code class="p">[]</code>&#13;
    <code class="p">}()</code>&#13;
&#13;
<code class="p">}</code>&#13;
<code class="kd">extension</code> <code class="nc">ListDataSource</code><code class="p">:</code> <code class="bp">UITableViewDataSource</code> <code class="p">{</code>&#13;
    <code class="kd">func</code> <code class="nf">tableView</code><code class="p">(</code><code class="kc">_</code> <code class="n">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">,</code> <code class="n">numberOfRowsInSection</code> <code class="n">section</code><code class="p">:</code> <code class="nb">Int</code><code class="p">)</code> <code class="p">-&gt;</code> <code class="nb">Int</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">data</code><code class="p">.</code><code class="bp">count</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">func</code> <code class="nf">tableView</code><code class="p">(</code><code class="kc">_</code> <code class="n">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">,</code>&#13;
        <code class="n">cellForRowAt</code> <code class="n">indexPath</code><code class="p">:</code> <code class="n">IndexPath</code><code class="p">)</code> <code class="p">-&gt;</code> <code class="bp">UITableViewCell</code> <code class="p">{</code>&#13;
        <code class="c1">// Dequeue a table view cell</code>&#13;
        <code class="kd">let</code> <code class="nv">cell</code> <code class="p">=</code>&#13;
          <code class="n">tableView</code><code class="p">.</code><code class="n">dequeueReusableCell</code><code class="p">(</code><code class="n">withIdentifier</code><code class="p">:</code> <code class="s">"CatalogTableViewCell"</code><code class="p">,</code>&#13;
          <code class="k">for</code><code class="p">:</code> <code class="n">indexPath</code><code class="p">)</code>&#13;
&#13;
        <code class="c1">// Find the correct book based on the row being populated</code>&#13;
        <code class="kd">let</code> <code class="nv">book</code> <code class="p">=</code> <code class="n">data</code><code class="p">[</code><code class="n">indexPath</code><code class="p">.</code><code class="n">row</code><code class="p">]</code>&#13;
&#13;
        <code class="c1">// Populate the table view cell title label with the book title</code>&#13;
        <code class="n">cell</code><code class="p">.</code><code class="n">textLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="n">book</code><code class="p">.</code><code class="n">title</code>&#13;
&#13;
        <code class="k">return</code> <code class="n">cell</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>We’ve added a new <code>lazy</code> property called <code>data</code>. This property is an array of <code>Book</code>s. Whenever the property is accessed the first time, <em>catalog.json</em> is read into a object with a <code>Data</code> type called <code>rawCatalogData</code>. This property is passed to a <code>JSONDecoder</code> object that decodes the object for a type of <code>[Book]</code>.</p>&#13;
&#13;
<p>Notice that this is <code>[Book]</code> and not a raw <code>Book</code>. The reason for this declaration is because that JSON actually contains an array of JSON objects. The Swift compiler is smart to interpret what we’ve declared at the call site when dynamically converting <em>catalog.json</em> to objects inside Swift. If we don’t find our JSON file—or if it’s not decodable into something by the Swift compiler—we return an empty array, <code>[]</code>.</p>&#13;
&#13;
<p>Now, we’ve also updated some of the code that’s used to power our table view in the <code>UITableViewDataSource</code> protocol adherence. The lines to note are:</p>&#13;
&#13;
<pre class="small" data-code-language="swift" data-type="programlisting"><code class="kd">func</code> <code class="nf">tableView</code><code class="p">(</code><code class="kc">_</code> <code class="n">tableView</code><code class="p">:</code> <code class="bp">UITableView</code><code class="p">,</code> <code class="n">numberOfRowsInSection</code> <code class="n">section</code><code class="p">:</code> <code class="nb">Int</code><code class="p">)</code> <code class="p">-&gt;</code> <code class="nb">Int</code> <code class="p">{</code>&#13;
	<code class="k">return</code> <code class="n">data</code><code class="p">.</code><code class="bp">count</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Note also <code>data[indexPath.row]</code> inside the method <code>tableView(_:cellForRowAt:)</code>.</p>&#13;
&#13;
<p>Build and run the app and you’ll see it functions the same as it did before—it displays our list of all the books available in our library—however, now the books are dynamically supplied to the table view via a JSON file included in the application bundle.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What We’ve Learned" data-type="sect1"><div class="sect1" id="idm46177204064920">&#13;
<h1>What We’ve Learned</h1>&#13;
&#13;
<p>In the short span of this chapter we’ve learned:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>How to separate tightly coupled code out of the view layer into a new data layer</p>&#13;
</li>&#13;
<li>&#13;
<p>How to create a discrete object tailor-made for supplying data to our views</p>&#13;
</li>&#13;
<li>&#13;
<p>How to switch to a JSON file as a source for our application’s data</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In the next chapter, we’ll take this a bit further; we’ll use our new data layer to provide some additional functionality to save books we’ve found that we liked. Keep reading!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>