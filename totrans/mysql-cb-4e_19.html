<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 19. Working with JSON"><div class="chapter" id="nch-json"><h1><span class="label">Chapter 19. </span>Working with JSON</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820335626848"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="19.0 Introduction"><div class="sect1" id="nch-json-json-intro"><h1>19.0 Introduction</h1><p>
      Relational databases have proven to be effective for decades. They prevent duplicates and misses of data, and enable fast access to stored values. However, business continually invents new scenarios in which data needs to be more flexible than the relational model allows.
    </p><p>
      For example let’s consider a record for a user who can access subscription-only digital content and leave comments. For such a user, having only basic information - their name, email address, and password - is enough to get started. However, once the users start exploring more options (for example, requiring delivery), they may need their mailing address to be stored. Mailing address could be different from the billing address. The user may want to add a social network account or few of them.
    </p><p>
      One way of storing flexible data in the relational database would be to store additional pieces of data in the referenced table that shares details for each user. We discuss this technique in <a data-type="xref" href="ch16.xhtml#nch-multi-multi-one-to-many">Recipe 16.5</a> and <a data-type="xref" href="ch16.xhtml#nch-multi-multi-many-to-many">Recipe 16.6</a>.
    </p><p>
      However, this technique may be not the best in the following situations.
      </p><dl><dt>When only few items in the main table have details in the referenced table</dt><dd><p>
              If you still need to know about these details, when you query required fields in the main table you will need to join it with the referencing table every time. This will complicate queries and affect performance.
            </p></dd><dt>When most of the specific details could be missed</dt><dd><p>
              Details such as a user’s district, or building number are only necessary for users who requested physical delivery of items. For everyone else, these fields could be empty, still you need to reserve space in the database for those empty fields. This adds significant cost once the database grows.
            </p></dd><dt>When you may not know which additional data you need in future</dt><dd><p>
              Business may require adding additional details to the data collections. Appending such details in the relational model means creating new tables and columns to the existent table. This requires schema re-design and maintenance windows to implement the changes. This is not always possible and space/cost effective.
            </p></dd></dl><p>
    </p><p>
      To resolve these issues flexible data structures, such as JSON, are the best fit. MySQL always allowed to store JSON values in text fields using string data types. Since version 5.7 MySQL also supports JSON data type and functions that allow to manipulate JSON values in effective manner. MySQL combines advantages of both SQL and NoSQL worlds.
    </p></div></section><section data-type="sect1" data-pdf-bookmark="19.1 Choosing the Right Data Type"><div class="sect1" id="nch-json-json-data-type"><h1>19.1 Choosing the Right Data Type</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820335617280"><h2>Problem</h2><p>
        You want to store JSON values and do not know which data type to choose.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820335616192"><h2>Solution</h2><p>
        Use the data type JSON.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820335615200"><h2>Discussion</h2><p>
        JSON data can be stored in any text or binary column. JSON functions will work without issues but the special data type JSON has numerous advantages, particularly:
        </p><dl><dt>Optimized performance</dt><dd><p>
                JSON data is converted into a format that allows quick lookup for values in the document.
              </p></dd><dt>Partial updates</dt><dd><p>
                Updates to JSON elements happen in place, without need to rewrite full document.
              </p></dd><dt>Automatic data validation</dt><dd><p>
                When a value is inserted into column of JSON data type, MySQL automatically validates it and produces an error if the document is invalid JSON.
              </p></dd></dl><p>
      </p><p>
        The following will create a table with JSON column <code>author</code>.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">book_authors</code> <code class="p">(</code>
  <code class="n">id</code>     <code class="nb">INT</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="n">author</code> <code class="n">JSON</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">)</code>
<code class="p">);</code></pre><p>
      </p></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820335591760"><h2>See Also</h2><p>For additional information about data type JSON, 
      see <a href="https://dev.mysql.com/doc/refman/8.0/en/json.html">The JSON Data Type</a> in the MySQL User Reference Manual.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.2 Inserting JSON values"><div class="sect1" id="nch-json-json-insert"><h1>19.2 Inserting JSON values</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820335589392"><h2>Problem</h2><p>
        You want to store JSON documents in MySQL.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820335587264"><h2>Solution</h2><p>
        User regular <code>INSERT</code> statements.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820335585872"><h2>Discussion</h2><p>
        JSON is not different from other data types. Use regular <code>INSERT</code> statements to add your documents into the tables.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="o">`</code><code class="n">book_authors</code><code class="o">`</code><code> </code><code class="k">VALUES</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="s1">'{"id": 1, "name": "Paul", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>      </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">        "Software Portability with imake: Practical Software Engineering",</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>        </code><code class="ss">"Mysql: The Definitive Guide to Using, Programming,</code></strong><code class="ss"> ↩
                 </code><strong><code class="ss">and Administering Mysql 4 (Developer\'s Library)"</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">                "MySQL Certification Study Guide", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>                </code><code class="ss">"MySQL (OTHER NEW RIDERS)"</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">                "MySQL Cookbook", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>                </code><code class="ss">"MySQL 5.0 Certification Study Guide"</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">                "Using csh &amp; tcsh: Type Less, Accomplish More </code></strong><code class="s1">↩
                 </code><strong><code class="s1">(Nutshell Handbooks)", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>                </code><code class="ss">"MySQL (Developer\'s Library)"</code><code class="p">]</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">      "lastname": "DuBois"}'</code><code class="p">)</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="p">(</code><code class="mi">2</code><code class="p">,</code><code class="s1">'{"id": 2, "name": "Alkin", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>       </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="ss">"MySQL Cookbook"</code><code class="p">]</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">       "lastname": "Tezuysal"}'</code><code class="p">)</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="p">(</code><code class="mi">3</code><code class="p">,</code><code class="s1">'{"id": 3, "name": "Sveta", </code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code>       </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code> </code><code class="ss">"MySQL Cookbook"</code><code class="p">]</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">       "lastname": "Smirnova"}'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
</code><code class="n">Records</code><code class="p">:</code><code> </code><code class="mi">3</code><code>  </code><code class="n">Duplicates</code><code class="p">:</code><code> </code><code class="mi">0</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.3 Validating JSON"><div class="sect1" id="nch-json-json-validation"><h1>19.3 Validating JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820335396192"><h2>Problem</h2><p>
        You want to ensure that a given string is a valid JSON.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820335395136"><h2>Solution</h2><p>
        Use the JSON datatype to perform automatic validation. Use the function <code>JSON_VALID</code> to validate strings. Use the JSON Schema to define schema for the JSON documents.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820335393696"><h2>Discussion</h2><p>
        Function <code>JSON_VALID</code> checks if given document is valid JSON.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_VALID</code><code class="p">(</code><code class="s1">'"name": "Sveta"'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-------------------------------+
</code><code class="o">|</code><code> </code><code class="n">JSON_VALID</code><code class="p">(</code><code class="s1">'"name": "Sveta"'</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------------------+
</code><code class="o">|</code><code>                             </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_VALID</code><code class="p">(</code><code class="s1">'{"name": "Sveta"}'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------------------+
</code><code class="o">|</code><code> </code><code class="n">JSON_VALID</code><code class="p">(</code><code class="s1">'{"name": "Sveta"}'</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------+
</code><code class="o">|</code><code>                               </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        If a column defined as JSON MySQL will not allow you to insert invalid values. Additionally, error message will locate the first error, so you can fix it faster.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">book_authors</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">VALUES</code><code> </code><code class="p">(</code><code class="s1">'{"name": "Sveta" "lastname": "Smirnova"'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">ERROR</code><code> </code><code class="mi">3140</code><code> </code><code class="p">(</code><code class="mi">22032</code><code class="p">)</code><code class="p">:</code><code> </code><code class="n">Invalid</code><code> </code><code class="n">JSON</code><code> </code><code class="nb">text</code><code class="p">:</code><code> </code><code class="ss">"Missing a comma or '}' after an object↩
member."</code><code> </code><code class="k">at</code><code> </code><code class="k">position</code><code> </code><code class="mi">17</code><code> </code><code class="k">in</code><code> </code><code class="n">value</code><code> </code><code class="k">for</code><code> </code><code class="k">column</code><code> </code><code class="s1">'book_authors.author'</code><code class="p">.</code></pre><p>
      </p><p>
        If you want to not only validate a JSON document, but also want it to satisfy a schema, use the function <code>JSON_SCHEMA_VALID</code>. This function supports JSON schema as described in <a href="https://json-schema.org/specification-links.html#draft-4"> Draft 4 of the JSON Schema specification</a>. To use it you need to define a schema first and compare the JSON value with it.
      </p><p>
        The function <code>JSON_SCHEMA_VALIDATION_REPORT</code> not only checks a given document against the schema but also reports which particular part of the schema is violated.
      </p><p>
        For the table <code>book_authors</code> we may define a schema that require having <code>name</code> and <code>lastname</code> as required fields and array of book titles as optional element <code>books</code>. We can use following code for the schema:
        </p><pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w">
</code><code class="nt">"id"</code><code class="p">:</code><code class="w"> </code><code class="s2">"http://www.oreilly.com/mysqlcookbook"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-id_co" href="#callout_nch-json-json-validation-id_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="w">
</code><code class="nt">"$schema"</code><code class="p">:</code><code class="w"> </code><code class="s2">"http://json-schema.org/draft-04/schema#"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-schema_co" href="#callout_nch-json-json-validation-schema_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="w">
</code><code class="nt">"description"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Schema for the table book_authors"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-desc_co" href="#callout_nch-json-json-validation-desc_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code class="w">
</code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"object"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-type_co" href="#callout_nch-json-json-validation-type_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code class="w">
</code><code class="nt">"properties"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-props_co" href="#callout_nch-json-json-validation-props_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code class="w">
  </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"string"</code><code class="p">},</code><code class="w"> 
  </code><code class="nt">"lastname"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"string"</code><code class="p">},</code><code class="w"> 
  </code><code class="nt">"books"</code><code class="p">:</code><code class="w"> </code><code class="p">{</code><code class="nt">"type"</code><code class="p">:</code><code class="w"> </code><code class="s2">"array"</code><code class="p">}</code><code class="w">
</code><code class="p">},</code><code class="w"> 
</code><code class="nt">"required"</code><code class="p">:[</code><code class="s2">"name"</code><code class="p">,</code><code class="w"> </code><code class="s2">"lastname"</code><code class="p">]</code><code class="w"> </code><a class="co" id="co_nch-json-json-validation-req_co" href="#callout_nch-json-json-validation-req_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code class="w">
</code><code class="p">}</code></pre><p>

      </p><dl class="calloutlist"><dt><a class="co" id="callout_nch-json-json-validation-id_co" href="#co_nch-json-json-validation-id_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>Unique identifier of the schema</p></dd><dt><a class="co" id="callout_nch-json-json-validation-schema_co" href="#co_nch-json-json-validation-schema_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>JSON schema specification. Should always be <code>http://json-schema.org/draft-04/schema#</code></p></dd><dt><a class="co" id="callout_nch-json-json-validation-desc_co" href="#co_nch-json-json-validation-desc_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>Description of the schema</p></dd><dt><a class="co" id="callout_nch-json-json-validation-type_co" href="#co_nch-json-json-validation-type_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt><dd><p>Type of the root element</p></dd><dt><a class="co" id="callout_nch-json-json-validation-props_co" href="#co_nch-json-json-validation-props_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt><dd><p>List of properies. Each of properties should be described. They shoud have a defined type and can specify other validations, such as minimum and maximum.</p></dd><dt><a class="co" id="callout_nch-json-json-validation-req_co" href="#co_nch-json-json-validation-req_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt><dd><p>List of required fields</p></dd></dl><p>
      </p><p>
        If we assign just defined schema to a variable, say, <code>@schema</code>, we can check JSON data against this schema.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SET</code><code> </code><code class="o">@</code><code class="k">schema</code><code> </code><code class="o">=</code><code> </code><code class="s1">'{</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="ss">"http://www.oreilly.com/mysqlcookbook"</code><code class="p">,</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">"$schema": "http://json-schema.org/draft-04/schema#",</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"description"</code><code class="p">:</code><code> </code><code class="ss">"Schema for the table book_authors"</code><code class="p">,</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">"type": "object",</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"properties"</code><code class="p">:</code><code> </code><code class="err">{</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">"name": {"type": "string"},</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="err">{</code><code class="ss">"type"</code><code class="p">:</code><code> </code><code class="ss">"string"</code><code class="err">}</code><code class="p">,</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">"books": {"type": "array"}</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="err">}</code><code class="p">,</code></strong><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">"required":["name", "lastname"]</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code> </code><strong><code class="err">}</code><code class="s1">';</code></strong><code class="s1">
Query OK, 0 rows affected (0,00 sec)

mysql&gt; </code><strong><code class="s1">SELECT JSON_SCHEMA_VALIDATION_REPORT(@schema, </code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">'</code><code class="err">{</code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="err">}</code><code class="s1">')  AS '</code><code class="k">Valid</code><code class="o">?</code><code class="s1">'\G</code></strong><code class="s1">
*************************** 1. row ***************************
Valid?: {"valid": false, "reason": "The JSON document location '</code><code class="o">#</code><code class="s1">' failed requirement ↩
'</code><code class="n">required</code><code class="s1">' at JSON Schema location '</code><code class="o">#</code><code class="err">'</code><code class="ss">", "</code><code class="k">schema</code><code class="o">-</code><code class="n">location</code><code class="ss">": "</code><code class="o">#</code><code class="ss">", ↩
"</code><code class="n">document</code><code class="o">-</code><code class="n">location</code><code class="ss">": "</code><code class="o">#</code><code class="ss">", "</code><code class="k">schema</code><code class="o">-</code><code class="n">failed</code><code class="o">-</code><code class="n">keyword</code><code class="ss">": "</code><code class="n">required</code><code class="err">"</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        In this case validation is failed, because the document contains only <code>name</code> field and does not contain another required field <code>lastname</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_SCHEMA_VALIDATION_REPORT</code><code class="p">(</code><code class="o">@</code><code class="k">schema</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"name": "Sveta", "lastname": "Smirnova"}'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Valid?'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="o">|</code><code> </code><code class="k">Valid</code><code class="o">?</code><code>          </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="o">|</code><code> </code><code class="err">{</code><code class="ss">"valid"</code><code class="p">:</code><code> </code><code class="k">true</code><code class="err">}</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        In this case document is valid, because it contains all required fields. Field <code>books</code> is optional and not required.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_SCHEMA_VALIDATION_REPORT</code><code class="p">(</code><code class="o">@</code><code class="k">schema</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"name": "Sveta", "lastname": "Smirnova", </code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">"books": "MySQL Cookbook"}'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Valid?'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="k">Valid</code><code class="o">?</code><code class="p">:</code><code> </code><code class="err">{</code><code class="ss">"valid"</code><code class="p">:</code><code> </code><code class="k">false</code><code class="p">,</code><code> </code><code class="ss">"reason"</code><code class="p">:</code><code> </code><code class="ss">"The JSON document location '#/books' failed ↩
requirement 'type' at JSON Schema location '#/properties/books'"</code><code class="p">,</code><code> </code><code class="err">↩</code><code>
</code><code class="ss">"schema-location"</code><code class="p">:</code><code> </code><code class="ss">"#/properties/books"</code><code class="p">,</code><code> </code><code class="ss">"document-location"</code><code class="p">:</code><code> </code><code class="ss">"#/books"</code><code class="p">,</code><code> </code><code class="err">↩</code><code>
</code><code class="ss">"schema-failed-keyword"</code><code class="p">:</code><code> </code><code class="ss">"type"</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        In this case document is not valid, because member <code>books</code> has type <code>string</code> and not <code>array</code> as defined in the schema.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_SCHEMA_VALIDATION_REPORT</code><code class="p">(</code><code class="o">@</code><code class="k">schema</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"name": "Sveta", "lastname": "Smirnova",</code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">"books": ["MySQL Troubleshooting", "MySQL Cookbook"]}'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Valid?'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="o">|</code><code> </code><code class="k">Valid</code><code class="o">?</code><code>          </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="o">|</code><code> </code><code class="err">{</code><code class="ss">"valid"</code><code class="p">:</code><code> </code><code class="k">true</code><code class="err">}</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        This document fixes type error for the element <code>books</code>, thus valid.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_SCHEMA_VALID</code><code class="p">(</code><code class="o">@</code><code class="k">schema</code><code class="p">,</code><code> </code><code class="s1">'{"name": "Sveta", "lastname": "Smirnova", </code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">"vehicles": ["Honda CRF 250L"]}'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Valid 1?'</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_SCHEMA_VALID</code><code class="p">(</code><code class="o">@</code><code class="k">schema</code><code class="p">,</code><code> </code><code class="s1">'{"name": "Alkin", "lastname": "Tezuysal", </code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">"vehicles": "boat"}'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Valid 2?'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----------+----------+
</code><code class="o">|</code><code> </code><code class="k">Valid</code><code> </code><code class="mi">1</code><code class="o">?</code><code> </code><code class="o">|</code><code> </code><code class="k">Valid</code><code> </code><code class="mi">2</code><code class="o">?</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------+----------+
</code><code class="o">|</code><code>        </code><code class="mi">1</code><code> </code><code class="o">|</code><code>        </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------+----------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        These documents are also valid, because there is no requirement for the property <code>vehicles</code>: it may exist, may not exist and can be of any type.
      </p><p>
        If you want to automatically validate JSON field in a table against a defined schema use <code>CHECK</code> constraints.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">book_authors</code> 
<code class="k">ADD</code> <code class="k">CONSTRAINT</code> <code class="k">CHECK</code><code class="p">(</code><code class="n">JSON_SCHEMA_VALID</code><code class="p">(</code><code class="s1">'</code>
<code class="s1">{"id": "http://www.oreilly.com/mysqlcookbook", </code>
<code class="s1"> "$schema": "http://json-schema.org/draft-04/schema#", </code>
<code class="s1"> "description": "Schema for the table book_authors", </code>
<code class="s1"> "type": "object", </code>
<code class="s1"> "properties": {</code>
<code class="s1">     "name": {"type": "string"}, </code>
<code class="s1">     "lastname": {"type": "string"}, </code>
<code class="s1">     "books": {"type": "array"}},</code>
<code class="s1">  "required":["name", "lastname"]} '</code><code class="p">,</code> 
  <code class="n">author</code><code class="p">));</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.4 Formatting JSON Values"><div class="sect1" id="nch-json-json-formatting"><h1>19.4 Formatting JSON Values</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820334523488"><h2>Problem</h2><p>
        You want to print JSON nicely formatted.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820334522608"><h2>Solution</h2><p>
        Use fuction <code>JSON_PRETTY</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820334521280"><h2>Discussion</h2><p>
        By default JSON is printed as a long string that could be hard to read. If you want MySQL to print it in human-readable format use function <code>JSON_PRETTY</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Paul"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Software Portability with imake: Practical Software Engineering"</code><code class="p">,</code><code>
    </code><code class="ss">"Mysql: The Definitive Guide to Using, Programming, ↩
     and Administering Mysql 4 (Developer's Library)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Certification Study Guide"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL (OTHER NEW RIDERS)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL 5.0 Certification Study Guide"</code><code class="p">,</code><code>
    </code><code class="ss">"Using csh &amp; tcsh: Type Less, Accomplish More (Nutshell Handbooks)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL (Developer's Library)"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"DuBois"</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">2</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Alkin"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Tezuysal"</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.5 Extracting Values from JSON"><div class="sect1" id="nch-json-json-extract"><h1>19.5 Extracting Values from JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820334420032"><h2>Problem</h2><p>
        You want to extract values from the JSON document.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820334419152"><h2>Solution</h2><p>
        Use the function <code>JSON_EXTRACT</code>, or the operators <code>-&gt;</code> and <code>-&gt;&gt;</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820334416896"><h2>Discussion</h2><p>
        JSON by itself is no use if you cannot extract values from the documents. JSON in MySQL supports the JSON path that could be used to point to the specific element in JSON. The root element of the JSON document is represented by a <code>$</code> sign. Object members are accessed by the operator <code>.</code> and array members are accessed by an index, enclosed in the square brackets. Indexes start from zero. You can refer multiple array elements with keyword <code>to</code> (e.g. <code>$.[3 to 5]</code>. The <code>last</code> keyword is a synonym of the last element in the array.
      </p><p>
        The wildcard <code>*</code> represents either all values of all object members if used after a dot: <code>.*</code> or all array elements if enclosed in the square brackets: <code>[*]</code>.
      </p><p>
        Expression <code>[prefix]**suffix</code> represents all paths, beginning with the <code>prefix</code> and ending with the <code>suffix</code>. Note that while the <code>suffix</code> part is required, <code>prefix</code> is optional. In other words, JSON Path expression should not end with double asterisk sign.
      </p><p>
        To access JSON elements use function <code>JSON_EXTRACT</code>.
      </p><p>
        For example, to select names of the authors, use following SQL:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_EXTRACT</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'$.name'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code>  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="o">|</code><code> </code><code class="ss">"Paul"</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="ss">"Alkin"</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="ss">"Sveta"</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        To remove quotes from the values use function <code>JSON_UNQUOTE</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_UNQUOTE</code><code class="p">(</code><code class="n">JSON_EXTRACT</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'$.name'</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code>  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Operator <code>-&gt;</code> is an alias of the function <code>JSON_EXTRACT</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code>  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="o">|</code><code> </code><code class="ss">"Paul"</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="ss">"Alkin"</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="ss">"Sveta"</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>Operator <code>-&gt;&gt;</code> is an alias of <code>JSON_UNQUOTE(JSON_EXTRACT(...))</code>.</p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code>  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        To extract the first and the last books by the authors use array indexes <code>0</code> and <code>last</code> correspondingly.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">CONCAT</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code class="p">,</code><code> </code><code class="s1">' '</code><code class="p">,</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.lastname'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.books[0]'</code><code> </code><code class="k">AS</code><code> </code><code class="o">`</code><code class="k">First</code><code> </code><code class="n">Book</code><code class="o">`</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.books[last]'</code><code> </code><code class="k">AS</code><code> </code><code class="o">`</code><code class="k">Last</code><code> </code><code class="n">Book</code><code class="o">`</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
    </code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Paul</code><code> </code><code class="n">DuBois</code><code>
</code><code class="k">First</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">Software</code><code> </code><code class="n">Portability</code><code> </code><code class="k">with</code><code> </code><code class="n">imake</code><code class="p">:</code><code> </code><code class="n">Practical</code><code> </code><code class="n">Software</code><code> </code><code class="n">Engineering</code><code>
 </code><code class="k">Last</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">MySQL</code><code> </code><code class="p">(</code><code class="n">Developer</code><code class="err">'</code><code class="n">s</code><code> </code><code class="n">Library</code><code class="p">)</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
    </code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Alkin</code><code> </code><code class="n">Tezuysal</code><code>
</code><code class="k">First</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Cookbook</code><code>
 </code><code class="k">Last</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Cookbook</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
    </code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Sveta</code><code> </code><code class="n">Smirnova</code><code>
</code><code class="k">First</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Troubleshooting</code><code>
 </code><code class="k">Last</code><code> </code><code class="n">Book</code><code class="p">:</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Cookbook</code><code>
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
       JSON Path <code>$.books[*]</code> will return full array of books. Same will happen if you omit a wildcard and simply refer books array as <code>$.books</code>. Expression <code>$.*</code> will return all elements of the JSON object as an array.
     </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.*'</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Sveta'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-----------------------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.*'</code><code>                                                         </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="p">[</code><code class="mi">3</code><code class="p">,</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code> </code><code class="p">[</code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code> </code><code class="ss">"MySQL Cookbook"</code><code class="p">]</code><code class="p">,</code><code> </code><code class="ss">"Smirnova"</code><code class="p">]</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------------------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820334121504"><h2>See Also</h2><p>For additional information about JSON Path, 
      see <a href="https://dev.mysql.com/doc/refman/8.0/en/json.html#json-path-syntax">JSON Path Syntax</a> in the MySQL User Reference Manual.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.6 Searching inside JSON"><div class="sect1" id="nch-json-json-search"><h1>19.6 Searching inside JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820333520912"><h2>Problem</h2><p>
        You want to search for JSON documents, containing particular values.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820333535120"><h2>Solution</h2><p>
        Use function <code>JSON_SEARCH</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820333533728"><h2>Discussion</h2><p>
        Accessing by key works great but you may want to search for particular values in the JSON documents. MySQL allows you to do it. For example, to find all authors of the book “MySQL Cookbook”, run query:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">JSON_SEARCH</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'one'</code><code class="p">,</code><code> </code><code class="s1">'MySQL Cookbook'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>   </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code>  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code>  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">warning</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Function <code>JSON_SEARCH</code> takes a JSON document, keyword <code>one</code> or <code>all</code> and a search string as required arguments and returns found path of the element or elements that contain the searched value. It also supports optional escape character and JSON path arguments.
      </p><p>
        Similarly to the operator <code>LIKE</code> function <code>JSON_SEARCH</code> supports wildcards <code>%</code> and <code>_</code>.
      </p><p>
        Thus, to search all books, which names start from <code>MySQL</code>, use expression:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_SEARCH</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'all'</code><code class="p">,</code><code> </code><code class="s1">'MySQL%'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">books</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Paul</code><code>
 </code><code class="n">books</code><code class="p">:</code><code> </code><code class="p">[</code><code class="ss">"$.books[2]"</code><code class="p">,</code><code> </code><code class="ss">"$.books[3]"</code><code class="p">,</code><code> </code><code class="ss">"$.books[4]"</code><code class="p">,</code><code> </code><code class="ss">"$.books[5]"</code><code class="p">,</code><code> </code><code class="ss">"$.books[7]"</code><code class="p">]</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Alkin</code><code>
 </code><code class="n">books</code><code class="p">:</code><code> </code><code class="ss">"$.books[0]"</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">author</code><code class="p">:</code><code> </code><code class="n">Sveta</code><code>
 </code><code class="n">books</code><code class="p">:</code><code> </code><code class="p">[</code><code class="ss">"$.books[0]"</code><code class="p">,</code><code> </code><code class="ss">"$.books[1]"</code><code class="p">]</code><code>
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        When searching for single match you can use return value of the function <code>JSON_SEARCH</code> as an argument for the function <code>JSON_EXTRACT</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="k">AS</code><code> </code><code class="n">author</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_EXTRACT</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_UNQUOTE</code><code class="p">(</code><code class="n">JSON_SEARCH</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'one'</code><code class="p">,</code><code> </code><code class="s1">'MySQL%'</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">book</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------+-----------------------------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code> </code><code class="o">|</code><code> </code><code class="n">book</code><code>                              </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+-----------------------------------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>   </code><code class="o">|</code><code> </code><code class="ss">"MySQL Certification Study Guide"</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code>  </code><code class="o">|</code><code> </code><code class="ss">"MySQL Cookbook"</code><code>                  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code>  </code><code class="o">|</code><code> </code><code class="ss">"MySQL Troubleshooting"</code><code>           </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+-----------------------------------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.7 Inserting New Elements into a JSON Document"><div class="sect1" id="nch-json-json-add"><h1>19.7 Inserting New Elements into a JSON Document</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820333046464"><h2>Problem</h2><p>
        You want to insert new elements into a JSON document.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820333045584"><h2>Solution</h2><p>
        Use functions <code>JSON_INSERT</code>, <code>JSON_ARRAY_APPEND</code> and <code>JSON_ARRAY_INSERT</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820333015728"><h2>Discussion</h2><p>
        You may want to not only search inside JSON values but modify them. MySQL supports a number of functions which can modify JSON. The most wonderful thing about them is that they do not replace the JSON document as regular string functions do. They rather perform updates in place. This allows you to modify JSON values effectively.
      </p><p>
        MySQL functions allow you to append, remove, and replace parts of JSON as well as merge two or more documents into one. They all take the original document as an argument, a path that needs to be modified, and a new value.
      </p><p>
        To insert new value into a JSON object, use the function <code>JSON_INSERT</code>. Thus, to add information about current author’s work place call the function as follow.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_INSERT</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.work'</code><code class="p">,</code> <code class="s1">'Percona'</code><code class="p">)</code> 
<code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="k">IN</code> <code class="p">(</code><code class="s1">'Sveta'</code><code class="p">,</code> <code class="s1">'Alkin'</code><code class="p">);</code></pre><p>
        To add a book into the end of the <code>book</code> array use function <code>JSON_ARRAY_APPEND</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_ARRAY_APPEND</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.books'</code><code class="p">,</code> 
<code class="s1">'MySQL Performance Schema in Action'</code><code class="p">)</code> <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="o">=</code> <code class="s1">'Sveta'</code><code class="p">;</code></pre><p>
        This will add new book into the end of the array.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Sveta'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="ss">"Percona"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Performance Schema in Action"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        To add an element into a specific place, use the function <code>JSON_ARRAY_INSERT</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_ARRAY_INSERT</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.books[0]'</code><code class="p">,</code> 
<code class="s1">'MySQL for Absolute Beginners'</code><code class="p">)</code> <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="o">=</code> <code class="s1">'Alkin'</code><code class="p">;</code></pre><p>
        This will insert a new book into the beginning of the array.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Alkin'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">2</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Alkin"</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="ss">"Percona"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL for Absolute Beginners"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Tezuysal"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.8 Updating JSON"><div class="sect1" id="nch-json-json-update"><h1>19.8 Updating JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820332312464"><h2>Problem</h2><p>
        You want to update a JSON value.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820332311584"><h2>Solution</h2><p>
        Use the functions <code>JSON_REPLACE</code> and <code>JSON_SET</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820332309936"><h2>Discussion</h2><p>
        While we were working on this book, Alkin switched his work place. So the content of the table needs to be updated. The function <code>JSON_REPLACE</code> replaces a given path with the new value.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_REPLACE</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.work'</code><code class="p">,</code> <code class="s1">'PlanetScale'</code><code class="p">)</code> 
<code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="o">=</code> <code class="s1">'Alkin'</code><code class="p">;</code></pre><p>
        However, the function <code>JSON_REPLACE</code> will do nothing if a record, that needs to be replaced, does not exist in the document.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">UPDATE</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">SET</code><code> </code><code class="n">author</code><code> </code><code class="o">=</code><code> </code><code class="n">JSON_REPLACE</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'$.work'</code><code class="p">,</code><code> </code><code class="s1">'Oracle'</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">0</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="k">NULL</code><code>              </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        To resolve this problem, use the function <code>JSON_SET</code> to update the document if the path exists, or to insert a new value if the path does not.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">UPDATE</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">SET</code><code> </code><code class="n">author</code><code> </code><code class="o">=</code><code> </code><code class="n">JSON_SET</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'$.work'</code><code class="p">,</code><code> </code><code class="s1">'MySQL'</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="n">MySQL</code><code>             </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">UPDATE</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">SET</code><code> </code><code class="n">author</code><code> </code><code class="o">=</code><code> </code><code class="n">JSON_SET</code><code class="p">(</code><code class="n">author</code><code class="p">,</code><code> </code><code class="s1">'$.work'</code><code class="p">,</code><code> </code><code class="s1">'Oracle'</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Paul'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.work'</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="o">|</code><code> </code><code class="n">Oracle</code><code>            </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.9 Removing Elements from JSON"><div class="sect1" id="nch-json-json-remove"><h1>19.9 Removing Elements from JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820331860224"><h2>Problem</h2><p>
        You want to remove elements from a JSON document.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820331859344"><h2>Solution</h2><p>
        Use the function <code>JSON_REMOVE</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820331858080"><h2>Discussion</h2><p>
        The function <code>JSON_REMOVE</code> removes specified element from JSON.
      </p><p>
        For example, to remove unpublished books from the <code>book_authors</code> table use following code.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_REMOVE</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.books[0]'</code><code class="p">)</code> 
<code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="o">=</code> <code class="s1">'Alkin'</code><code class="p">;</code>
<code class="k">UPDATE</code> <code class="n">book_authors</code> <code class="k">SET</code> <code class="n">author</code> <code class="o">=</code> <code class="n">JSON_REMOVE</code><code class="p">(</code><code class="n">author</code><code class="p">,</code> <code class="s1">'$.books[last]'</code><code class="p">)</code> 
<code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code> <code class="o">=</code> <code class="s1">'Sveta'</code><code class="p">;</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.10 Merging Two or More JSON Documents into One"><div class="sect1" id="nch-json-json-merge"><h1>19.10 Merging Two or More JSON Documents into One</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820331746064"><h2>Problem</h2><p>
        You want to combine two or more JSON documents into one.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820331745184"><h2>Solution</h2><p>
        Use functions family <code>JSON_MERGE_*</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820331743888"><h2>Discussion</h2><p>
        Two functions: <code>JSON_MERGE_PATCH</code> and <code>JSON_MERGE_PRESERVE</code> are available for combining multiple JSON documents into one. <code>JSON_MERGE_PATCH</code> removes duplicates when merging two documents while <code>JSON_MERGE_PRESERVE</code> keeps them. Both functions take two or more arguments that should be valid JSON text.
      </p><p>
        For examples in this recipe we will store values of the <code>author</code> column in the table <code>book_authors</code> into user-defined variables: one for each author. Additionally we will store arrays of books for Sveta in a variable <code>sveta_books</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="n">author</code> <code class="k">INTO</code> <code class="o">@</code><code class="n">paul</code> <code class="k">FROM</code> <code class="n">book_authors</code> <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code><code class="o">=</code><code class="s1">'Paul'</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="n">author</code> <code class="k">INTO</code> <code class="o">@</code><code class="n">sveta</code> <code class="k">FROM</code> <code class="n">book_authors</code> <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code><code class="o">=</code><code class="s1">'Sveta'</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="n">author</code> <code class="k">INTO</code> <code class="o">@</code><code class="n">alkin</code> <code class="k">FROM</code> <code class="n">book_authors</code> <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code><code class="o">=</code><code class="s1">'Alkin'</code><code class="p">;</code>
<code class="k">SELECT</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.books'</code> <code class="k">INTO</code> <code class="o">@</code><code class="n">sveta_books</code> <code class="k">FROM</code> <code class="n">book_authors</code> 
  <code class="k">WHERE</code> <code class="n">author</code><code class="o">-&gt;&gt;</code><code class="s1">'$.name'</code><code class="o">=</code><code class="s1">'Sveta'</code><code class="p">;</code></pre><p>
        <code>JSON_MERGE_PRESERVE</code> combines documents, provided by its arguments, into a single object. You can use this function to add new elements to your objects or arrays. Thus, to add array of countries where the author lived you can just provide an object, containing such an array as an argument.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"places lived": ["Russia", "Turkey"]}'</code><code class="p">)</code><code class="p">)</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="s1">'{"places lived": ["Russia", "Turkey"]}'</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="ss">"Percona"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code class="p">,</code><code>
  </code><code class="ss">"places lived"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Russia"</code><code class="p">,</code><code>
    </code><code class="ss">"Turkey"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        To add a new book into the array <code>books</code> pass it as a part of the <code>books</code> array in the object as a second argument.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"books": ["MySQL Performance Schema in Action"]}'</code><code class="p">)</code><code class="p">)</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="err">↩</code><code>
</code><code class="s1">'{"books": ["MySQL Performance Schema in Action"]}'</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="ss">"Percona"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Performance Schema in Action"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Content of the array <code>books</code> in the second argument will be added to the end of the array with the same name in the first argument.
      </p><p>
        If two objects have scalar values with the same key they will be merged into an array.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">paul</code><code class="p">,</code><code> </code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="o">@</code><code class="n">alkin</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">authors</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">authors</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="mi">1</code><code class="p">,</code><code>
    </code><code class="mi">3</code><code class="p">,</code><code>
    </code><code class="mi">2</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Paul"</code><code class="p">,</code><code>
    </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
    </code><code class="ss">"Alkin"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Oracle"</code><code class="p">,</code><code>
    </code><code class="ss">"Percona"</code><code class="p">,</code><code>
    </code><code class="ss">"PlanetScale"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Software Portability with imake: Practical Software Engineering"</code><code class="p">,</code><code>
    </code><code class="ss">"Mysql: The Definitive Guide to Using, Programming, ↩
     and Administering Mysql 4 (Developer's Library)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Certification Study Guide"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL (OTHER NEW RIDERS)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL 5.0 Certification Study Guide"</code><code class="p">,</code><code>
    </code><code class="ss">"Using csh &amp; tcsh: Type Less, Accomplish More (Nutshell Handbooks)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL (Developer's Library)"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"DuBois"</code><code class="p">,</code><code>
    </code><code class="ss">"Smirnova"</code><code class="p">,</code><code>
    </code><code class="ss">"Tezuysal"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><div data-type="note" epub:type="note"><h6>Note</h6><p>
          Note that function <code>JSON_MERGE_PRESERVE</code> does not try to handle duplicates anyhow, so book title <code>MySQL Cookbook</code> repeats in the resulting array three times.
        </p></div><p>
        Function <code>JSON_MERGE_PATCH</code>, instead, removes duplicates in favor of its latest argument. Same combination of merging three authors will just return the one, specified as the last argument.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PATCH</code><code class="p">(</code><code class="o">@</code><code class="n">paul</code><code class="p">,</code><code> </code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="o">@</code><code class="n">alkin</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">authors</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">authors</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">2</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Alkin"</code><code class="p">,</code><code>
  </code><code class="ss">"work"</code><code class="p">:</code><code> </code><code class="ss">"PlanetScale"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Tezuysal"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        This feature could be used to remove unneeded elements from JSON. For example, if we decide that it does not matter in which company the author works, we can remove <code>work</code> element by passing it as an object with value <code>null</code>:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PATCH</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="s1">'{"work": null}'</code><code class="p">)</code><code class="p">)</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PATCH</code><code class="p">(</code><code class="o">@</code><code class="n">sveta</code><code class="p">,</code><code> </code><code class="s1">'{"work": null}'</code><code class="p">)</code><code class="p">)</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"id"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code>
  </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
  </code><code class="ss">"books"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
    </code><code class="ss">"MySQL Cookbook"</code><code>
  </code><code class="p">]</code><code class="p">,</code><code>
  </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        When the latest document of the function is not an object <code>JSON_MERGE_PRESERVE</code> will add it as a latest element of an array. For example, to add a new book to the array of books by Sveta you may use following code:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PRESERVE</code><code class="p">(</code><code class="o">@</code><code class="n">sveta_books</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'"MySQL Performance Schema in Action"'</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Books by Sveta'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">Books</code><code> </code><code class="k">by</code><code> </code><code class="n">Sveta</code><code class="p">:</code><code> </code><code class="p">[</code><code>
  </code><code class="ss">"MySQL Troubleshooting"</code><code class="p">,</code><code>
  </code><code class="ss">"MySQL Cookbook"</code><code class="p">,</code><code>
  </code><code class="ss">"MySQL Performance Schema in Action"</code><code>
</code><code class="p">]</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        <code>JSON_MERGE_PATCH</code>, instead, will replace elements in the original document with the new one:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_MERGE_PATCH</code><code class="p">(</code><code class="o">@</code><code class="n">sveta_books</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'"MySQL Performance Schema in Action"'</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Books by Sveta'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">Books</code><code> </code><code class="k">by</code><code> </code><code class="n">Sveta</code><code>                       </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------------------------+
</code><code class="o">|</code><code> </code><code class="ss">"MySQL Performance Schema in Action"</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.11 Creating JSON from Relational Data"><div class="sect1" id="nch-json-json-object"><h1>19.11 Creating JSON from Relational Data</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820330566976"><h2>Problem</h2><p>
        You have relational data and want to create JSON from it.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820330579024"><h2>Solution</h2><p>
        Use the function <code>JSON_OBJECT</code>, the function <code>JSON_ARRAY</code> and their aggregate variants <code>JSON_OBJECTAGG</code>, <code> JSON_ARRAYAGG</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820330576576"><h2>Discussion</h2><p>
        It could be useful to create JSON out of relational data. MySQL provides the function <code>JSON_OBJECT</code> that combines pairs of values into JSON object.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_OBJECT</code><code class="p">(</code><code class="ss">"string"</code><code class="p">,</code><code> </code><code class="ss">"Some String"</code><code class="p">,</code><code> </code><code class="ss">"number"</code><code class="p">,</code><code> </code><code class="mi">42</code><code class="p">,</code><code> </code><code class="ss">"null"</code><code class="p">,</code><code> </code><code class="k">NULL</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">my_object</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">my_object</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"null"</code><code class="p">:</code><code> </code><code class="k">null</code><code class="p">,</code><code>
  </code><code class="ss">"number"</code><code class="p">:</code><code> </code><code class="mi">42</code><code class="p">,</code><code>
  </code><code class="ss">"string"</code><code class="p">:</code><code> </code><code class="ss">"Some String"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        The function <code>JSON_ARRAY</code> creates a JSON array from its arguments.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_ARRAY</code><code class="p">(</code><code class="ss">"one"</code><code class="p">,</code><code> </code><code class="ss">"two"</code><code class="p">,</code><code> </code><code class="ss">"three"</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">my_array</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">my_array</code><code class="p">:</code><code> </code><code class="p">[</code><code>
  </code><code class="ss">"one"</code><code class="p">,</code><code>
  </code><code class="ss">"two"</code><code class="p">,</code><code>
  </code><code class="ss">"three"</code><code class="p">,</code><code>
  </code><code class="mi">4</code><code class="p">,</code><code>
  </code><code class="mi">5</code><code>
</code><code class="p">]</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        You can combine both functions, make nesting objects and arrays.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_OBJECT</code><code class="p">(</code><code class="ss">"Example"</code><code class="p">,</code><code> </code><code class="ss">"Nesting object and array"</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"Human"</code><code class="p">,</code><code> </code><code class="n">JSON_OBJECT</code><code class="p">(</code><code class="ss">"name"</code><code class="p">,</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code> </code><code class="ss">"lastname"</code><code class="p">,</code><code> </code><code class="ss">"Smirnova"</code><code class="p">)</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="ss">"Numbers"</code><code class="p">,</code><code> </code><code class="n">JSON_ARRAY</code><code class="p">(</code><code class="ss">"one"</code><code class="p">,</code><code> </code><code class="ss">"two"</code><code class="p">,</code><code> </code><code class="ss">"three"</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">my_object</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">my_object</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Human"</code><code class="p">:</code><code> </code><code class="err">{</code><code>
    </code><code class="ss">"name"</code><code class="p">:</code><code> </code><code class="ss">"Sveta"</code><code class="p">,</code><code>
    </code><code class="ss">"lastname"</code><code class="p">:</code><code> </code><code class="ss">"Smirnova"</code><code>
  </code><code class="err">}</code><code class="p">,</code><code>
  </code><code class="ss">"Example"</code><code class="p">:</code><code> </code><code class="ss">"Nesting object and array"</code><code class="p">,</code><code>
  </code><code class="ss">"Numbers"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"one"</code><code class="p">,</code><code>
    </code><code class="ss">"two"</code><code class="p">,</code><code>
    </code><code class="ss">"three"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        The functions <code>JSON_OBJECTAGG</code> and <code>JSON_ARRAYAGG</code> are aggregate versions of <code>JSON_OBJECT</code> and <code>JSON_ARRAY</code> that allow you to create JSON objects and arrays out of data, returned by <code>GROUP BY</code> queries.
      </p><p>
        The database <code>cookbook</code> has a table <code>movies_actors</code> that contains a list of movies and actors that were starred in them. The table has few rows for the single movie and few others for the single actor.
      </p><p>
        If you want to have a JSON object that will list a movie and all actors who starred in that movie in as an array, combine the functions <code>JSON_OBJECT</code> and <code>JSON_ARRAYAGG</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_OBJECT</code><code class="p">(</code><code class="s1">'Movie'</code><code class="p">,</code><code> </code><code class="n">movie</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'Starred'</code><code class="p">,</code><code> </code><code class="n">JSON_ARRAYAGG</code><code class="p">(</code><code class="n">actor</code><code class="p">)</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">starred</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">movies_actors</code><code> </code><code class="k">GROUP</code><code> </code><code class="k">BY</code><code> </code><code class="n">movie</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"Kingdom of Heaven"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Liam Neeson"</code><code class="p">,</code><code>
    </code><code class="ss">"Orlando Bloom"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"Red"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Helen Mirren"</code><code class="p">,</code><code>
    </code><code class="ss">"Bruce Willis"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"The Fellowship of the Ring"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Ian McKellen"</code><code class="p">,</code><code>
    </code><code class="ss">"Ian Holm"</code><code class="p">,</code><code>
    </code><code class="ss">"Orlando Bloom"</code><code class="p">,</code><code>
    </code><code class="ss">"Elijah Wood"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">4</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"The Fifth Element"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Bruce Willis"</code><code class="p">,</code><code>
    </code><code class="ss">"Gary Oldman"</code><code class="p">,</code><code>
    </code><code class="ss">"Ian Holm"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">5</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"The Phantom Menace"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Ewan McGregor"</code><code class="p">,</code><code>
    </code><code class="ss">"Liam Neeson"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">6</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">starred</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Movie"</code><code class="p">:</code><code> </code><code class="ss">"Unknown"</code><code class="p">,</code><code>
  </code><code class="ss">"Starred"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
    </code><code class="ss">"Diane Kruger"</code><code class="p">,</code><code>
    </code><code class="ss">"Liam Neeson"</code><code>
  </code><code class="p">]</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">6</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Function <code>JSON_OBJECTAGG</code> can take table values in one column as member names and values in another column as their arguments.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_PRETTY</code><code class="p">(</code><code class="n">JSON_OBJECTAGG</code><code class="p">(</code><code class="n">name</code><code class="p">,</code><code> </code><code class="n">website</code><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">websites</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">book_vendor</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">websites</code><code class="p">:</code><code> </code><code class="err">{</code><code>
  </code><code class="ss">"Amazon.com"</code><code class="p">:</code><code> </code><code class="ss">"www.amazon.com"</code><code class="p">,</code><code>
  </code><code class="ss">"Barnes &amp; Noble"</code><code class="p">:</code><code> </code><code class="ss">"www.barnesandnoble.com"</code><code class="p">,</code><code>
  </code><code class="ss">"O'Reilly Media"</code><code class="p">:</code><code> </code><code class="ss">"www.oreilly.com"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.12 Converting JSON into Relational Format"><div class="sect1" id="nch-json-json-table"><h1>19.12 Converting JSON into Relational Format</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820328665024"><h2>Problem</h2><p>
        You have JSON data and want to work with it in the same way as you do with relational structure.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820328664016"><h2>Solution</h2><p>
        Use function <code>JSON_TABLE</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820328662720"><h2>Discussion</h2><p>
        In the previous recipe we converted relational data into JSON. You may need to do the opposite: convert JSON into relational format. In this case, the function <code>JSON_TABLE</code> will help.
      </p><p>
        The function <code>JSON_TABLE</code> takes a JSON document and a list of columns with paths as its arguments. It returns a table as a result.
      </p><p>
        For example, for a document
        </p><pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"/>
<code class="w">  </code><code class="nt">"null"</code><code class="p">:</code><code class="w"> </code><code class="kc">null</code><code class="p">,</code><code class="w"/>
<code class="w">  </code><code class="nt">"number"</code><code class="p">:</code><code class="w"> </code><code class="mi">42</code><code class="p">,</code><code class="w"/>
<code class="w">  </code><code class="nt">"string"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Some String"</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
        <code>JSON_TABLE</code> can be called as:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_select_co" href="#callout_nch-json-json-table_select_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">JSON_TABLE</code><code class="p">(</code></strong><code> </code><a class="co" id="co_nch-json-json-table_from_co" href="#callout_nch-json-json-table_from_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'{"null": null, "number": 42, "string": "Some String"}'</code><code class="p">,</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_json_co" href="#callout_nch-json-json-table_json_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'$'</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_path_co" href="#callout_nch-json-json-table_path_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">COLUMNS</code><code class="p">(</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_columns_co" href="#callout_nch-json-json-table_columns_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="nb">number</code><code> </code><code class="nb">INT</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$.number'</code><code class="p">,</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_col_co" href="#callout_nch-json-json-table_col_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">string</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">255</code><code class="p">)</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$.string'</code><code> </code><code class="n">ERROR</code><code> </code><code class="k">ON</code><code> </code><code class="n">ERROR</code></strong><code> </code><a class="co" id="co_nch-json-json-table_error_co" href="#callout_nch-json-json-table_error_co"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">jt</code><code class="p">;</code></strong><code> </code><a class="co" id="co_nch-json-json-table_alias_co" href="#callout_nch-json-json-table_alias_co"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
</code><code class="o">+</code><code class="c1">--------+-------------+
</code><code class="o">|</code><code> </code><code class="nb">number</code><code> </code><code class="o">|</code><code> </code><code class="n">string</code><code>      </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+-------------+
</code><code class="o">|</code><code>     </code><code class="mi">42</code><code> </code><code class="o">|</code><code> </code><code class="k">Some</code><code> </code><code class="n">String</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------+-------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><dl class="calloutlist"><dt><a class="co" id="callout_nch-json-json-table_select_co" href="#co_nch-json-json-table_select_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>Start the query by selecting everything from the resulting table.</p></dd><dt><a class="co" id="callout_nch-json-json-table_from_co" href="#co_nch-json-json-table_from_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>The function <code>JSON_TABLE</code> can be used only in the <code>FROM</code> clause.</p></dd><dt><a class="co" id="callout_nch-json-json-table_json_co" href="#co_nch-json-json-table_json_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>The first argument to the function is a JSON document. In this example, the function takes a string. If you want to pass a column name in another table, you need to specify this table prior the <code>JSON_TABLE</code> call:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">mytable</code><code class="p">,</code> <code class="n">JSON_TABLE</code><code class="p">(</code><code class="n">mytable</code><code class="p">.</code><code class="n">mycolumn</code> <code class="p">...</code></pre><p>
        </p></dd><dt><a class="co" id="callout_nch-json-json-table_path_co" href="#co_nch-json-json-table_path_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt><dd><p>A path that will be used as a document root. In this example we are using the whole document but you can simplify expressions for the columns if you specify the path to the part of the JSON document here.</p></dd><dt><a class="co" id="callout_nch-json-json-table_columns_co" href="#co_nch-json-json-table_columns_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt><dd><p>Definition of columns.</p></dd><dt><a class="co" id="callout_nch-json-json-table_col_co" href="#co_nch-json-json-table_col_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt><dd><p>Column <code>number</code> has type <code>INT</code> and default error handling: the column set to <code>NULL</code> in case an error happens. We use JSON path <code>$.number</code> to set a value for this column.</p></dd><dt><a class="co" id="callout_nch-json-json-table_error_co" href="#co_nch-json-json-table_error_co"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt><dd><p>For the column <code>string</code> we decided to raise an error, therefore we used clause <code>ERROR ON ERROR</code>.</p></dd><dt><a class="co" id="callout_nch-json-json-table_alias_co" href="#co_nch-json-json-table_alias_co"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt><dd><p>Any function in the <code>FROM</code> clause should have an alias, so we used <code>jt</code> as an alias.</p></dd></dl><p>
        To call the function <code>JSON_TABLE</code> on an existing table add it to the query prior calling the function. Practically, perform a <code>CROSS JOIN</code> of two tables. The <code>COLUMNS</code> clause also supports nested paths, so you can expand arrays into multiple rows.
      </p><p>
       The column <code>author</code> in the table <code>book_authors</code> contains list of books in the array <code>books</code>. To expand each row into the own row use clause <code>NESTED PATH</code>.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">jt</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="n">ba</code><code class="p">,</code><code> </code></strong><code> </code><a class="co" id="co_nch-json-json-table_exttable_co" href="#callout_nch-json-json-table_exttable_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_TABLE</code><code class="p">(</code><code class="n">ba</code><code class="p">.</code><code class="n">author</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'$'</code><code> </code><code class="n">COLUMNS</code><code> </code><code class="p">(</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">name</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">255</code><code class="p">)</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$.name'</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">lastname</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">255</code><code class="p">)</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$.lastname'</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">NESTED</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$.books[*]'</code><code> </code><code class="n">COLUMNS</code><code> </code><code class="p">(</code></strong><code> </code><a class="co" id="co_nch-json-json-table_nested_co" href="#callout_nch-json-json-table_nested_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">book</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">255</code><code class="p">)</code><code> </code><code class="n">PATH</code><code> </code><code class="s1">'$'</code><code> </code><code class="p">)</code></strong><code> </code><a class="co" id="co_nch-json-json-table_nestedcol_co" href="#callout_nch-json-json-table_nestedcol_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">)</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="n">jt</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-------+----------+-----------------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">name</code><code>  </code><code class="o">|</code><code> </code><code class="n">lastname</code><code> </code><code class="o">|</code><code> </code><code class="n">book</code><code>                                                            </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------+----------+-----------------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>  </code><code class="o">|</code><code> </code><code class="n">DuBois</code><code>   </code><code class="o">|</code><code> </code><code class="n">Software</code><code> </code><code class="n">Portability</code><code> </code><code class="k">with</code><code> </code><code class="n">imake</code><code class="p">:</code><code> </code><code class="n">Practical</code><code> </code><code class="n">Software</code><code> </code><code class="n">Engineering</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code>  </code><code class="o">|</code><code> </code><code class="n">DuBois</code><code>   </code><code class="o">|</code><code> </code><code class="n">Mysql</code><code class="p">:</code><code> </code><code class="n">The</code><code> </code><code class="n">Definitive</code><code> </code><code class="n">Guide</code><code> </code><code class="k">to</code><code> </code><code class="k">Using</code><code class="p">,</code><code> </code><code class="n">Programming</code><code class="p">,</code><code> </code><code class="err">↩</code><code>
                     </code><code class="k">and</code><code> </code><code class="n">Administering</code><code> </code><code class="n">Mysql</code><code> </code><code class="mi">4</code><code> </code><code class="p">(</code><code class="n">Developer</code><code class="s1">'s Library)                 |
| Paul  | DuBois   | MySQL Certification Study Guide                                 |
| Paul  | DuBois   | MySQL (OTHER NEW RIDERS)                                        |
| Paul  | DuBois   | MySQL Cookbook                                                  |
| Paul  | DuBois   | MySQL 5.0 Certification Study Guide                             |
| Paul  | DuBois   | Using csh &amp; tcsh: Type Less, Accomplish More ↩
                     (Nutshell Handbooks)                                            |
| Paul  | DuBois   | MySQL (Developer'</code><code class="n">s</code><code> </code><code class="n">Library</code><code class="p">)</code><code>                                     </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code> </code><code class="o">|</code><code> </code><code class="n">Tezuysal</code><code> </code><code class="o">|</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Cookbook</code><code>                                                  </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code> </code><code class="o">|</code><code> </code><code class="n">Smirnova</code><code> </code><code class="o">|</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Troubleshooting</code><code>                                           </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code> </code><code class="o">|</code><code> </code><code class="n">Smirnova</code><code> </code><code class="o">|</code><code> </code><code class="n">MySQL</code><code> </code><code class="n">Cookbook</code><code>                                                  </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-------+----------+-----------------------------------------------------------------+
</code><code class="mi">11</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><dl class="calloutlist"><dt><a class="co" id="callout_nch-json-json-table_exttable_co" href="#co_nch-json-json-table_exttable_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>To use a column in the existing table put the table name before the <code>JSON_TABLE</code> call.</p></dd><dt><a class="co" id="callout_nch-json-json-table_nested_co" href="#co_nch-json-json-table_nested_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>The clause <code>NESTED PATH</code> expands the following path pattern into several columns. In our case the path is <code>$.books[*]</code> that points to the each element of the array <code>books</code>.</p></dd><dt><a class="co" id="callout_nch-json-json-table_nestedcol_co" href="#co_nch-json-json-table_nestedcol_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>Define the nested column as any other column. Note that <code>PATH</code> should be relative to the <code>NESTED PATH</code>.</p></dd></dl></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820328293168"><h2>See Also</h2><p>For additional information about function <code>JSON_TABLE</code>, 
      see <a href="https://dev.mysql.com/doc/refman/8.0/en/json-table-functions.html"> JSON Table Functions in the MySQL User Reference Manual</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.13 Investigating JSON"><div class="sect1" id="nch-json-json-attributes"><h1>19.13 Investigating JSON</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820329554928"><h2>Problem</h2><p>
        You want to know details about your JSON data structure, such as how deep the value is, how many children a particular element has, and so on.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820329553920"><h2>Solution</h2><p>
        Use JSON attribute functions.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820329552976"><h2>Discussion</h2><p>
        The function <code>JSON_LENGTH</code> returns a number of elements in the JSON document or a path, if specified. For scalars it is always 1, for objects and arrays this is the number of elements. You can use this function to perform such tasks as calculating number of books, written by a particular author:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">CONCAT</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code class="p">,</code><code> </code><code class="s1">' '</code><code class="p">,</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.lastname'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'author'</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_LENGTH</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.books'</code><code class="p">)</code><code> </code><code class="k">AS</code><code> </code><code class="s1">'Number of Books'</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----------------+-----------------+
</code><code class="o">|</code><code> </code><code class="n">author</code><code>         </code><code class="o">|</code><code> </code><code class="nb">Number</code><code> </code><code class="k">of</code><code> </code><code class="n">Books</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------+-----------------+
</code><code class="o">|</code><code> </code><code class="n">Paul</code><code> </code><code class="n">DuBois</code><code>    </code><code class="o">|</code><code>               </code><code class="mi">8</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Alkin</code><code> </code><code class="n">Tezuysal</code><code> </code><code class="o">|</code><code>               </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">Sveta</code><code> </code><code class="n">Smirnova</code><code> </code><code class="o">|</code><code>               </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------+-----------------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        Function <code>JSON_DEPTH</code> returns maximum depth of the JSON document. It returns one for a scalar, empty object or empty array. For objects and arrays with inner elements it counts all nested levels. For the <code>author</code> column in the <code>book_authors</code> table it returns three:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_DEPTH</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Sveta'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------------+
</code><code class="o">|</code><code> </code><code class="n">JSON_DEPTH</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+
</code><code class="o">|</code><code>                  </code><code class="mi">3</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        To understand why so let’s examine example value in detail:
        </p><pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code class="w"> </code><a class="co" id="co_nch-json-json-attributes_obj_co" href="#callout_nch-json-json-attributes_obj_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="w">
  </code><code class="nt">"id"</code><code class="p">:</code><code class="w"> </code><code class="mi">3</code><code class="p">,</code><code class="w">
  </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Sveta"</code><code class="p">,</code><code class="w">
  </code><code class="nt">"work"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Percona"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-attributes_el_co" href="#callout_nch-json-json-attributes_el_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="w">
  </code><code class="nt">"books"</code><code class="p">:</code><code class="w"> </code><code class="p">[</code><code class="w">
    </code><code class="s2">"MySQL Troubleshooting"</code><code class="p">,</code><code class="w"> </code><a class="co" id="co_nch-json-json-attributes_array_el_co" href="#callout_nch-json-json-attributes_array_el_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code class="w">
    </code><code class="s2">"MySQL Cookbook"</code><code class="w">
  </code><code class="p">],</code><code class="w">
  </code><code class="nt">"lastname"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Smirnova"</code><code class="w">
</code><code class="p">}</code></pre><p>

        </p><dl class="calloutlist"><dt><a class="co" id="callout_nch-json-json-attributes_obj_co" href="#co_nch-json-json-attributes_obj_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>Level one: the object that contains all the elements.</p></dd><dt><a class="co" id="callout_nch-json-json-attributes_el_co" href="#co_nch-json-json-attributes_el_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>Level two: object element.</p></dd><dt><a class="co" id="callout_nch-json-json-attributes_array_el_co" href="#co_nch-json-json-attributes_array_el_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>Level three: element of the nested array.</p></dd></dl><p>
      </p><p>
        Function <code>JSON_DEPTH</code> is useful when you need to understand how complex your JSON data is.
      </p><p>
        Function <code>JSON_STORAGE_SIZE</code> returns the number of bytes that the JSON data takes. It is useful to plan storage use for your data.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_STORAGE_SIZE</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------------+
</code><code class="o">|</code><code> </code><code class="n">JSON_STORAGE_SIZE</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------+
</code><code class="o">|</code><code>                       </code><code class="mi">475</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code>                       </code><code class="mi">144</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code>                       </code><code class="mi">171</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        The function <code>JSON_TYPE</code> returns the type of the JSON element. Thus, for the <code>author</code> column in the table <code>book_authors</code> the types are as shown:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.id'</code><code class="p">)</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.books'</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">book_authors</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'Sveta'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
           </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="p">)</code><code class="p">:</code><code> </code><code class="k">OBJECT</code><code>
   </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.id'</code><code class="p">)</code><code class="p">:</code><code> </code><code class="nb">INTEGER</code><code>
 </code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.name'</code><code class="p">)</code><code class="p">:</code><code> </code><code class="n">STRING</code><code>
</code><code class="n">JSON_TYPE</code><code class="p">(</code><code class="n">author</code><code class="o">-</code><code class="o">&gt;</code><code class="s1">'$.books'</code><code class="p">)</code><code class="p">:</code><code> </code><code class="nb">ARRAY</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          Note that we used operator <code>-&gt;</code> instead of <code>-&gt;&gt;</code> to preserve quotes in scalar values.
        </p></div></div></section></div></section><section data-type="sect1" data-pdf-bookmark="19.14 Working with JSON in MySQL as a Document Store"><div class="sect1" id="nch-json-json-nosql"><h1>19.14 Working with JSON in MySQL as a Document Store</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820328238160"><h2>Problem</h2><p>
        You want to work with JSON in MySQL in the same way as NoSQL databases do.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820328237168"><h2>Solution</h2><p>
        Use X DevAPI. The following clients and connectors support X DevAPI and can work with JSON as a Document Store.
        </p><ul class="simplelist"><li>MySQL Shell in JavaScript and Python mode</li><li>Connector/C++</li><li>Connector/J</li><li>Connector/Node.js</li><li>Connector/NET</li><li>Connector/Python</li></ul><p>
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820328258784"><h2>Discussion</h2><p>
        We will use MySQL Shell for examples in this recipe. We assume that you are connected to the MySQL server, thus have the default objects available. See <a data-type="xref" href="ch02.xhtml#nch-mysqlshell-mysqlshell-connecting">Recipe 2.1</a> for instructions on how to connect to MySQL Server via MySQL Shell.
      </p><p>
        MySQL Document Store is a collection, stored in a table, defined as
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">MyCollection</code><code class="o">`</code> <code class="p">(</code>
  <code class="o">`</code><code class="n">doc</code><code class="o">`</code> <code class="n">json</code> <code class="k">DEFAULT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="o">`</code><code class="n">_id</code><code class="o">`</code> <code class="n">varbinary</code><code class="p">(</code><code class="mi">32</code><code class="p">)</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="n">json_unquote</code><code class="p">(</code>
        <code class="n">json_extract</code><code class="p">(</code><code class="o">`</code><code class="n">doc</code><code class="o">`</code><code class="p">,</code><code class="n">_utf8mb4</code><code class="s1">'$._id'</code><code class="p">)))</code> <code class="n">STORED</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="o">`</code><code class="n">_json_schema</code><code class="o">`</code> <code class="n">json</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="n">_utf8mb4</code><code class="s1">'{"type":"object"}'</code><code class="p">)</code> <code class="n">VIRTUAL</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="o">`</code><code class="n">_id</code><code class="o">`</code><code class="p">),</code>
  <code class="k">CONSTRAINT</code> <code class="o">`</code><code class="err">$</code><code class="n">val_strict_2190F99D7C6BE98E2C1EFE4E110B46A3D43C9751</code><code class="o">`</code> 
  <code class="k">CHECK</code> <code class="p">(</code><code class="n">json_schema_valid</code><code class="p">(</code><code class="o">`</code><code class="n">_json_schema</code><code class="o">`</code><code class="p">,</code><code class="o">`</code><code class="n">doc</code><code class="o">`</code><code class="p">))</code> <code class="cm">/*!80016 NOT ENFORCED */</code>
<code class="p">)</code> <code class="n">ENGINE</code><code class="o">=</code><code class="n">InnoDB</code> <code class="k">DEFAULT</code> <code class="n">CHARSET</code><code class="o">=</code><code class="n">utf8mb4</code> <code class="k">COLLATE</code><code class="o">=</code><code class="n">utf8mb4_0900_ai_ci</code><code class="p">;</code></pre><p>
        where <code>doc</code> is a JSON column, storing the document. <code>_id</code> is unique identifier, generated by extracting value of the member <code>_id</code> and optional <code>_json_schema</code> is a schema which you can enforce when creating collection. See <a data-type="xref" href="ch02.xhtml#nch-mysqlshell-mysqlshell-js-collections">Recipe 2.9</a> for the details and example.
      </p><p>
        X DevAPI will create such a table when you call <code>createCollection</code> method.
      </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>session.getDefaultSchema().createCollection('MyCollection')</code></strong>
&lt;Collection:MyCollection&gt;</pre><div data-type="tip"><h6>Tip</h6><p>
          We use syntax which MySQL Shell in JavaScript mode understands for examples in this recipe. Syntax for different languages slightly differs. Refer to your implementation documentation for details.
        </p></div><p>
        Once the collection is created you can insert documents into it, update, remove and search them.
      </p><p>
        It is handy to store collection object in a variable.
      </p><pre data-type="programlisting" data-code-language="js">MySQL  cookbook  JS &gt; <strong><code>MyCollection = session.getDefaultSchema().</code></strong>
                   -&gt; <strong><code>getCollection('MyCollection')</code></strong>
&lt;Collection:MyCollection&gt;</pre><p>
        <code>Collection</code> class in X DevAPI supports four basic CRUD (Create, Read, Update, Delete) operations:
        </p><ul class="simplelist"><li><code>add</code></li><li><code>find</code></li><li><code>modify</code></li><li><code>remove</code></li></ul><p>
        We already showed them in action when we discussed MySQL Shell in <a data-type="xref" href="ch02.xhtml#nch-mysqlshell-mysqlshell-js-collections">Recipe 2.9</a> and <a data-type="xref" href="ch02.xhtml#nch-mysqlshell-mysqlshell-python-collections">Recipe 2.10</a>. In this recipe we will cover details, missed there.
      </p><section data-type="sect3" data-pdf-bookmark="Adding documents to the collection"><div class="sect3" id="nch-json-json-nosql-add"><h3>Adding documents to the collection</h3><p>
          To add documents into the collection, use a method <code>add</code> that accepts either a JSON object or an array of JSON objects, or a <code>mysqlx.expr</code> as an argument. The following code snippet demonstrates all three flavours of the syntax.
        </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>MyCollection.add({"document": "one"}).</code></strong>
                    -&gt; <strong><code>add([{"document": "two"}, {"document": "three"}]).</code></strong>
                    -&gt; <strong><code>add(mysqlx.expr('{"document": "four"}'))</code></strong>
                    -&gt; 
Query OK, 4 items affected (0.0083 sec)

Records: 4  Duplicates: 0  Warnings: 0</pre></div></section><section data-type="sect3" data-pdf-bookmark="Searching for documents"><div class="sect3" id="nch-json-json-nosql-find"><h3>Searching for documents</h3><p>
          To search for documents, use the method <code>find</code>. If called without arguments it will return a list of all documents in the collection.
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>MyCollection.find()</code></strong>
{
    "_id": "000060d5ab750000000000000012",
    "document": "one"
}
{
    "_id": "000060d5ab750000000000000013",
    "document": "two"
}
{
    "_id": "000060d5ab750000000000000014",
    "document": "three"
}
{
    "_id": "000060d5ab750000000000000015",
    "document": "four"
}
4 documents in set (0.0007 sec)</pre><p>
        </p><p>
          Each of the documents contains an automatically generated <code>_id</code> that is also a primary key for the collection.
        </p><p>
          The method <code>find</code>  narrows a result set by using search conditions, limiting the number of the documents, and grouping, sorting, and modifying the resulting values. These are basic methods, available to modify result of any SQL <code>SELECT</code> operation. However, it is not possible to join two collections like you can do with SQL tables.
        </p><p>
          To search for a particular document pass a condition as an argument of the method <code>find</code>. You can use the operator <code>LIKE</code> and others to perform creative comparisons.
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>MyCollection.find("document LIKE 't%'")</code></strong>
{
    "_id": "000060d5ab750000000000000013",
    "document": "two"
}
{
    "_id": "000060d5ab750000000000000014",
    "document": "three"
}
2 documents in set (0.0009 sec)</pre><p>
        </p><p>
          To modify the result, pass the expression to the method <code>fields</code>:
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>MyCollection.find("document LIKE 't%'").</code></strong>
                    -&gt; <strong><code>fields(mysqlx.expr('{"Document": upper(document)}'))</code></strong>
                    -&gt; 
{
    "Document": "TWO"
}
{
    "Document": "THREE"
}
2 documents in set (0.0009 sec)</pre><p>
        </p><p>
          To group documents, use the method <code>groupBy</code> and narrow the result with the method <code>having</code>. To illustrate how they work we will use collection <code>CollectionLimbs</code>.
        </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>limbs = session.getDefaultSchema().getCollection('CollectionLimbs')</code></strong>
&lt;Collection:CollectionLimbs&gt;

 MySQL  cookbook  JS &gt; <strong><code>limbs.find().fields('arms', 'COUNT(thing)').groupBy('arms')</code></strong>
{
    "arms": 2,
    "COUNT(thing)": 3
}
{
    "arms": 0,
    "COUNT(thing)": 5
}
{
    "arms": 10,
    "COUNT(thing)": 1
}
{
    "arms": 1,
    "COUNT(thing)": 1
}
{
    "arms": null,
    "COUNT(thing)": 1
}
5 documents in set (0.0010 sec)</pre><p>
          The code above prints the number of things with a specific number of arms. To limit this list to only things that have both arms and legs, we can use the method <code>having</code>:
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>limbs.find().fields('arms', 'COUNT(thing)').</code></strong>
                   -&gt; <strong><code>groupBy('arms').having('MIN(legs) &gt; 0')</code></strong>
{
    "arms": 2,
    "COUNT(thing)": 3
}
1 document in set (0.0006 sec)</pre><p>
        </p><p>
          To print the three things with the highest number of legs, use the method <code>sort</code> with the keyword <code>DESC</code> and <code>limit</code>:
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>limbs.find().sort('legs DESC').limit(3)</code></strong>
{
    "_id": "000060d5ab75000000000000001a",
    "arms": 0,
    "legs": 99,
    "thing": "centipede"
}
{
    "_id": "000060d5ab750000000000000017",
    "arms": 0,
    "legs": 6,
    "thing": "insect"
}
{
    "_id": "000060d5ab75000000000000001b",
    "arms": 0,
    "legs": 4,
    "thing": "table"
}
3 documents in set (0.0006 sec)</pre><p>
        </p><p>
          You may also bind values if you pass the parameter name after a colon sign in the method <code>find</code> and pass values in the method <code>bind</code>. You may bind as many arguments as you want.
          </p><pre data-type="programlisting" data-code-language="js"> MySQL  cookbook  JS &gt; <strong><code>limbs.find('legs = :legs').bind('legs', 4)</code></strong>
{
    "_id": "000060d5ab75000000000000001b",
    "arms": 0,
    "legs": 4,
    "thing": "table"
}
{
    "_id": "000060d5ab75000000000000001c",
    "arms": 2,
    "legs": 4,
    "thing": "armchair"
}
2 documents in set (0.0008 sec)

 MySQL  cookbook  JS &gt; <strong><code>limbs.find('legs = :legs and arms = :arms').</code></strong>
                    -&gt; <strong><code>bind('legs', 4).bind('arms', 2)</code></strong>
{
    "_id": "000060d5ab75000000000000001c",
    "arms": 2,
    "legs": 4,
    "thing": "armchair"
}
1 document in set (0.0005 sec)</pre><p>
        </p></div></section><section data-type="sect3" data-pdf-bookmark="Modifying documents"><div class="sect3" id="nch-json-json-nosql-modify"><h3>Modifying documents</h3><p>
          To modify documents in the collection, use the method <code>modify</code>. It accepts search condition and allows you to bind parameters similarly to the method <code>find</code>. To modify found elements use the methods <code>set</code> and <code>unset</code> to set or unset values of the object member. Use the methods <code>arrayInsert</code>, <code>arrayAppend</code> and <code>arrayDelete</code> to modify arrays, and use the method <code>patch</code> to merge JSON documents.
        </p><p>
          For the illustrations we will use the collection <code>MyCollection</code>.
          </p><pre data-type="programlisting" data-code-language="sql"><code> </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code> </code><a class="co" id="co_nch-json-json-nosql-modify_init_co" href="#callout_nch-json-json-nosql-modify_init_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0005</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code></strong><code>
                    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">set</code><code class="p">(</code><code class="s1">'array'</code><code class="p">,</code><code> </code><code class="p">[</code><code class="mi">2</code><code class="p">,</code><code> </code><code class="mi">3</code><code class="p">,</code><code> </code><code class="mi">4</code><code class="p">]</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_set_co" href="#callout_nch-json-json-nosql-modify_set_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0054</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"array"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="mi">2</code><code class="p">,</code><code>
        </code><code class="mi">3</code><code class="p">,</code><code>
        </code><code class="mi">4</code><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0005</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code><code class="n">arrayAppend</code><code class="p">(</code><code class="s1">'array'</code><code class="p">,</code><code> </code><code class="mi">5</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_arrayAppend_co" href="#callout_nch-json-json-nosql-modify_arrayAppend_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0073</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"array"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="mi">2</code><code class="p">,</code><code>
        </code><code class="mi">3</code><code class="p">,</code><code>
        </code><code class="mi">4</code><code class="p">,</code><code>
        </code><code class="mi">5</code><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0007</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code></strong><code>
                    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">arrayInsert</code><code class="p">(</code><code class="s1">'array[0]'</code><code class="p">,</code><code> </code><code class="mi">1</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_arrayInsert_co" href="#callout_nch-json-json-nosql-modify_arrayInsert_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0072</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"array"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="mi">1</code><code class="p">,</code><code>
        </code><code class="mi">2</code><code class="p">,</code><code>
        </code><code class="mi">3</code><code class="p">,</code><code>
        </code><code class="mi">4</code><code class="p">,</code><code>
        </code><code class="mi">5</code><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0008</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code><code class="n">arrayDelete</code><code class="p">(</code><code class="s1">'array[2]'</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_arrayDelete_co" href="#callout_nch-json-json-nosql-modify_arrayDelete_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0059</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"array"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="mi">1</code><code class="p">,</code><code>
        </code><code class="mi">2</code><code class="p">,</code><code>
        </code><code class="mi">4</code><code class="p">,</code><code>
        </code><code class="mi">5</code><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0009</code><code> </code><code class="n">sec</code><code class="p">)</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code><code class="n">unset</code><code class="p">(</code><code class="s1">'array'</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_unset_co" href="#callout_nch-json-json-nosql-modify_unset_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0080</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0007</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="k">modify</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code><code class="p">.</code></strong><code>
                    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">patch</code><code class="p">(</code><code class="err">{</code><code class="s1">'number'</code><code class="p">:</code><code> </code><code class="mi">42</code><code class="p">,</code><code> </code><code class="s1">'array'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]</code><code class="err">}</code><code class="p">)</code><code class="p">.</code></strong><code>
                    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">patch</code><code class="p">(</code><code class="err">{</code><code class="s1">'array'</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">4</code><code class="p">,</code><code class="mi">5</code><code class="p">]</code><code class="err">}</code><code class="p">)</code></strong><a class="co" id="co_nch-json-json-nosql-modify_patch_co" href="#callout_nch-json-json-nosql-modify_patch_co"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="n">item</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0063</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="k">Rows</code><code> </code><code class="n">matched</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Changed</code><code class="p">:</code><code> </code><code class="mi">1</code><code>  </code><code class="n">Warnings</code><code class="p">:</code><code> </code><code class="mi">0</code><code>
 </code><code class="n">MySQL</code><code>  </code><code class="n">cookbook</code><code>  </code><code class="n">JS</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="n">MyCollection</code><code class="p">.</code><code class="n">find</code><code class="p">(</code><code class="s1">'document = "one"'</code><code class="p">)</code></strong><code>
</code><code class="err">{</code><code>
    </code><code class="ss">"_id"</code><code class="p">:</code><code> </code><code class="ss">"000060d5ab750000000000000012"</code><code class="p">,</code><code>
    </code><code class="ss">"array"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="mi">4</code><code class="p">,</code><code>
        </code><code class="mi">5</code><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="ss">"number"</code><code class="p">:</code><code> </code><code class="mi">42</code><code class="p">,</code><code>
    </code><code class="ss">"document"</code><code class="p">:</code><code> </code><code class="ss">"one"</code><code>
</code><code class="err">}</code><code>
</code><code class="mi">1</code><code> </code><code class="n">document</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">0007</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>

          </p><dl class="calloutlist"><dt><a class="co" id="callout_nch-json-json-nosql-modify_init_co" href="#co_nch-json-json-nosql-modify_init_co"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt><dd><p>We will experiment with this document from the collection.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_set_co" href="#co_nch-json-json-nosql-modify_set_co"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt><dd><p>The mehtod <code>set</code> adds or changes an element in the object.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_arrayAppend_co" href="#co_nch-json-json-nosql-modify_arrayAppend_co"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt><dd><p>The method <code>arrayAppend</code> adds new element to the end of the array.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_arrayInsert_co" href="#co_nch-json-json-nosql-modify_arrayInsert_co"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt><dd><p>For the method <code>arrayInsert</code> you can specify the position in the array where you want to add new element.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_arrayDelete_co" href="#co_nch-json-json-nosql-modify_arrayDelete_co"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt><dd><p>The method <code>arrayDelete</code> removes an element from the specified position.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_unset_co" href="#co_nch-json-json-nosql-modify_unset_co"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt><dd><p>The method <code>unset</code> removes an element from the object.</p></dd><dt><a class="co" id="callout_nch-json-json-nosql-modify_patch_co" href="#co_nch-json-json-nosql-modify_patch_co"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt><dd><p>The method <code>patch</code> works similarly to the JSON function <code>JSON_MERGE_PATCH</code>. In our case it first added two elements: <code>number</code> and <code>array</code> to the original document, then replaced content of the element <code>array</code> with the content of the element with the same name in the object, passed as a parameter to the second invocation of the method <code>patch</code>.</p></dd></dl><p>
        </p></div></section><section data-type="sect3" data-pdf-bookmark="Removing documents and collections."><div class="sect3" id="nch-json-json-nosql-remove"><h3>Removing documents and collections.</h3><p>
          To remove documents use the method <code>remove</code>.
          
          </p><pre data-type="programlisting" data-code-language="js"><code class="nx">MyCollection</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="s1">'document = :number'</code><code class="p">).</code><code class="nx">bind</code><code class="p">(</code><code class="s1">'number'</code><code class="p">,</code> <code class="s1">'one'</code><code class="p">)</code></pre><p>
        </p><p>
          To drop a collection, use the method <code>dropCollection</code> in your API.
          </p><pre data-type="programlisting" data-code-language="js"><code class="nx">session</code><code class="p">.</code><code class="nx">getSchema</code><code class="p">(</code><code class="s1">'cookbook'</code><code class="p">).</code><code class="nx">dropCollection</code><code class="p">(</code><code class="s1">'MyCollection'</code><code class="p">)</code></pre><p>
        </p></div></section></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820328258480"><h2>See Also</h2><p>For additional information about X DevAPI, 
      see <a href="https://dev.mysql.com/doc/dev/mysqlsh-api-javascript/8.0/group___x_dev_a_p_i.html">X DevAPI Reference Manual</a>.</p></div></section></div></section></div></section></div></body></html>