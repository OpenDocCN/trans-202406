<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Backup and Recovery with rsync and cp"><div class="chapter" id="cha-backup-recovery">
<h1><span class="label">Chapter 7. </span>Backup and Recovery with rsync and cp</h1>


<p>You know<a data-type="indexterm" data-primary="files" data-secondary="backups" data-see="backups" id="idm46466160056408"/><a data-type="indexterm" data-primary="directories" data-secondary="backups" data-see="backups" id="idm46466160055320"/> you need to make good backups of your computer files and to test them
periodically to see if you can restore your files. But how do you do this on
Linux? Fear not, for backups and restores on Linux are quite understandable,
and your backup files are easy to search and restore.</p>

<p>It is helpful to have a couple of USB sticks for practicing the commands in this
chapter and a few directories full of files that you won’t mind losing, should
anything go wrong.</p>

<p>We will use <em>rsync</em> and <em>cp</em>. Both are essential Linux tools, and you can
count on them being well maintained and available.</p>

<p><em>cp</em> is <a data-type="indexterm" data-primary="cp command" data-secondary="purpose of" id="idm46466160052184"/>the copy command included in the GNU <em>coreutils</em> package, which is
installed by default on nearly every Linux distribution. <em>cp</em> is for simple
copying. It may be all you need to maintain regular backups.</p>

<p><em>rsync</em> is <a data-type="indexterm" data-primary="rsync command" data-secondary="purpose of" id="idm46466160049208"/>an efficient file-transfer program, and its main purpose is
keeping filesystems in sync with each other. When you use it for making
backups, it keeps your local files in sync with your backup device. It is fast
and efficient because it transfers only the changes in files. Unlike a lot of
backup software, which never want you to delete anything, it even mirrors
deletions. Because of these features, rsync is the tool of choice for updating
and mirroring user home directories, websites, git repositories, and other
large complex file trees.</p>

<p>There are two ways to use rsync over a network: over SSH, for authenticated
login and transport, or by running it as a daemon. Using SSH requires users
to have login accounts on every machine for which they need rsync access. When
rsync is run in daemon mode, you can use its built-in authentication methods to
control access 
<span class="keep-together">so that</span> users do not need login accounts on the rsync server.
Daemon mode is 
<span class="keep-together">well-suited</span> for a LAN backup server. It is not safe to
access over untrusted networks, unless you use a VPN (see <a data-type="xref" href="ch13.xhtml#cha-openvpn">Chapter 13</a>).</p>

<p>What <a data-type="indexterm" data-primary="backups" data-secondary="devices for" id="idm46466160038920"/>sort of device do you store your backups on? This depends on your needs. I
am a fan of USB storage media for a single user. Suppose you have a desktop
Linux PC, a laptop, a tablet, and a smartphone. Back up your phone and tablet
to your PC, then back up the PC to a USB hard drive. Super-important files
could go to an online backup service.</p>

<p>For multiple users, a good solution is a central backup server. This can be any
Linux PC.</p>

<p>Consider longevity. You cannot count on longevity with digital storage media,
because even if the medium (hard disk, USB storage drive, CD/DVD) survives,
there is no guarantee that the tools to read it will endure. Hardware and file
formats change. Can you still read floppy disks? Remember Zip disks? How about
those archives of old Microsoft Word and Powerpoint documents? With open source
file formats you can always find a way to recover them. Good luck with
proprietary formats when the vendor decides to stop supporting them.</p>

<p>Paper is still the long-term storage champion, and worth considering for your
most important documents and photos.</p>

<p>For long-term digital storage, plan to transfer your archives to new media
periodically, possibly with new commands and to new filesystem formats.</p>

<p>What about backing up your backup server? No problem. Setting up a remote rsync
mirror for backing up the backups is a common strategy, if your internet
connection is robust enough to handle the traffic. But before you build a
massive backup infrastructure, think about how many levels of redundancy you
really need. Offsite backups are insurance against a disaster at your site.
This can be a remote backup server at a site you control, or a friend’s site,
or rented space in a datacenter. Maybe regular drops of an external hard
drive to a bank safe-deposit box would be enough for your needs. Also think
about recovery: can you get to your backups quickly?</p>

<p>Always remember that the purpose of backups is <em>recovery</em>. Test your backups
regularly to avoid learning the hard way that your backup method failed.</p>

<p>In this chapter you will learn about simple copying to USB storage devices with
<em>cp</em>. For some users this is all they will ever need.</p>

<p>Most of the chapter is about using the <em>rsync</em> command for faster and more
efficient copying. You can use <em>rsync</em> to back up your files to local
media or remote servers. You will learn which files you should back up, how to
fine-tune your file selection, maintain the same file permissions and
timestamps on your files, how to build an rsync backup server for multiple
users, and how to make secure remote backups.</p>






<section data-type="sect1" data-pdf-bookmark="7.1 Selecting Which Files to Back Up"><div class="sect1" id="idm46466160035800">
<h1>7.1 Selecting Which Files to Back Up</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160030296">
<h2>Problem</h2>

<p>You’re <a data-type="indexterm" data-primary="backups" data-secondary="selecting files" id="backup-files-select"/><a data-type="indexterm" data-primary="files" data-secondary="selecting" data-tertiary="for backups" data-tertiary-sortas="backups" id="file-select-backup"/><a data-type="indexterm" data-primary="selecting" data-secondary="files" data-tertiary="for backups" data-tertiary-sortas="backups" id="select-files-backup"/>not sure which files you should back up. Do you need to make backups of
your system files? Do you really need to back up all of your personal files? Are
there files you should not back up?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160026952">
<h2>Solution</h2>

<p>Any file that you would be sorry to lose is a file you need to back up. Your
personal files and system data files are the most important. Restoring system
files such as commands, applications, and libraries is less important because
you can always download and reinstall these.</p>

<p>The following directories contain files such as configurations; data files for
servers such as web, FTP, and mail servers; log files; applications installed in nonstandard locations; and shared directories, all of which should be backed up:</p>

<ul>
<li>
<p><em>/boot/grub</em>, if <a data-type="indexterm" data-primary="/boot/grub/" id="idm46466160022488"/>it contains any customizations such as themes, background
images, or fonts.</p>
</li>
<li>
<p><em>/etc</em> contains<a data-type="indexterm" data-primary="/etc" data-secondary="backups" id="idm46466160021032"/> system configuration files.</p>
</li>
<li>
<p><em>/home</em>, users’ personal <a data-type="indexterm" data-primary="/home" data-secondary="backups" id="idm46466160017064"/>files.</p>
</li>
<li>
<p><em>/mnt</em>, temporary<a data-type="indexterm" data-primary="/mnt" data-secondary="backups" id="idm46466160014792"/> filesystem mountpoints. Back this up if you have mountpoints
you want to preserve.</p>
</li>
<li>
<p><em>/opt</em>, for <a data-type="indexterm" data-primary="/opt, backups" id="idm46466160012440"/>proprietary or other applications not installed the
standard way.</p>
</li>
<li>
<p><em>/root</em>, the <a data-type="indexterm" data-primary="/root, backups" id="idm46466160010312"/>root user’s personal files.</p>
</li>
<li>
<p><em>/srv</em>, data for <a data-type="indexterm" data-primary="/srv, backups" id="idm46466160008264"/>servers such as web, FTP, and rsync servers.</p>
</li>
<li>
<p><em>/tmp</em> holds<a data-type="indexterm" data-primary="/tmp" data-secondary="backups" id="idm46466160006280"/> temporary data that is automatically updated or deleted as
needed. Some of the data in <em>/tmp</em> is persistent, for example user-created files
and some system services, and they should be backed up.</p>
</li>
<li>
<p><em>/var</em> stores many <a data-type="indexterm" data-primary="/var" data-secondary="backups" id="idm46466160004408"/>types of data such as log files, mail spools, cron jobs,
and data for system services, though most distros have migrated to using <em>/srv</em>
for system services.</p>
</li>
</ul>

<p>If you have any shared directories, custom commands and scripts, or any data files
or directories not listed previously, back them up.</p>

<p><em>/proc</em>, <em>/sys</em>, and <em>/dev</em> are <a data-type="indexterm" data-primary="/proc" id="idm46466160000936"/><a data-type="indexterm" data-primary="/sys" id="idm46466160000328"/><a data-type="indexterm" data-primary="/dev" data-secondary="backups" id="idm46466159998248"/>pseudofilesystems that exist only in
memory and should not be backed up.</p>

<p><em>/media</em> is <a data-type="indexterm" data-primary="/media" data-secondary="backups" id="idm46466159996168"/>for mounting removable storage media and should be managed by the
system, so there is no need to back it up. If you are manually creating mountpoints
in 
<span class="keep-together"><em>/media</em></span>, they really need to be moved to <em>/mnt</em>.</p>

<p>Many databases should not be backed up <a data-type="indexterm" data-primary="database backups" id="idm46466159993448"/>with simple copying because they have special
utilities and procedures for making copies and backups, and for restoring from backups.
Use the tools made for your databases. Some examples are PostrgreSQL, MariaDB, and
MySQL.</p>
<div data-type="tip"><h1>Restoring From Backup</h1>
<p>Some files should not be restored from backup; see <a data-type="xref" href="#rec-restore-from-backup">Recipe 7.2</a>.</p>
</div>

<p>Copying everything is the easy way if your backup storage is large enough. You
also have the option of fine-tuning your file selection by creating lists of
files to copy or to exclude; see Recipes <a data-xrefstyle="select:labelnumber" data-type="xref" href="#rec-exclude-files-backup">7.8</a> and
<a data-xrefstyle="select:labelnumber" data-type="xref" href="#rec-include-files">7.9</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160026328">
<h2>Discussion</h2>

<p>Storage media is so cheap now you may not have to care about conserving storage
space. If you need to be mindful of storage limitations, see the recipes in this
chapter on<a data-type="indexterm" data-primary="backups" data-secondary="selecting files" data-startref="backup-files-select" id="idm46466159985592"/><a data-type="indexterm" data-primary="files" data-secondary="selecting" data-tertiary="for backups" data-tertiary-sortas="backups" data-startref="file-select-backup" id="idm46466159984376"/><a data-type="indexterm" data-primary="selecting" data-secondary="files" data-tertiary="for backups" data-tertiary-sortas="backups" data-startref="select-files-backup" id="idm46466159982200"/> file selection.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159980008">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/y1pJs">Filesystem Hierarchy Standard</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.2 Selecting Files to Restore from Backups"><div class="sect1" id="rec-restore-from-backup">
<h1>7.2 Selecting Files to Restore from Backups</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159975704">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="selecting" data-tertiary="for restores" data-tertiary-sortas="restores" id="file-select-restore"/><a data-type="indexterm" data-primary="selecting" data-secondary="files" data-tertiary="for restores" data-tertiary-sortas="restores" id="select-file-restore"/><a data-type="indexterm" data-primary="restoring files, what to restore" id="restore-what-to-restore"/>are restoring files from backup, and you want to know if there are files
that should not be restored.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159969784">
<h2>Solution</h2>

<p>Some files should not be restored, depending on the circumstances.</p>

<p>Do not <a data-type="indexterm" data-primary="/etc/fstab" id="idm46466159967784"/>restore <em>/etc/fstab</em> after reinstalling Linux (the file that
configures your static filesystem mounts). Every time you install
Linux, all the filesystems get new Universal Unique Identifiers (UUIDs), so they
will not be recognized and your new installation will fail.</p>

<p>Be careful <a data-type="indexterm" data-primary="/etc" data-secondary="restoring" id="idm46466159966264"/><a data-type="indexterm" data-primary="dot files" data-secondary="restoring" id="idm46466159965032"/>restoring any file in <em>/etc</em> or the dotfiles (such as
<em>/home/.config</em> or 
<span class="keep-together"><em>/home/.local</em></span>) in your home directory. If you
are restoring from backup to a new installation of a different release, or a
different Linux distribution, there may be incompatibilities in configuration
options or file locations. Restore them one at a time so you can quickly spot any<a data-type="indexterm" data-primary="files" data-secondary="selecting" data-tertiary="for restores" data-tertiary-sortas="restores" data-startref="file-select-restore" id="idm46466159961912"/><a data-type="indexterm" data-primary="selecting" data-secondary="files" data-tertiary="for restores" data-tertiary-sortas="restores" data-startref="select-file-restore" id="idm46466159959864"/><a data-type="indexterm" data-primary="restoring files, what to restore" data-startref="restore-what-to-restore" id="idm46466159958072"/> problems.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159966136">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch01.xhtml#cha-install-linux">Chapter 1</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.3 Using the Simplest Local Backup Method"><div class="sect1" id="idm46466159953592">
<h1>7.3 Using the Simplest Local Backup Method</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159952408">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with cp command" data-tertiary="manual" data-secondary-sortas="cp command" id="idm46466159950936"/><a data-type="indexterm" data-primary="cp command" data-secondary="manual backups" id="idm46466159949608"/><a data-type="indexterm" data-primary="manual backups with cp command" id="idm46466159948696"/><a data-type="indexterm" data-primary="copying" data-secondary="as backup method" data-tertiary="manual copying" data-secondary-sortas="backup method" id="idm46466159947928"/>want to know the easiest, simplest way to make regular backups to a local USB
storage device.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159945976">
<h2>Solution</h2>

<p>The answer is to use simple copying. Get yourself a nice USB hard drive or USB
stick. Plug it in and use your file manager to copy your files. Easy peasey, no
muss, no fuss, and it is dead simple to restore your files. Or, use the <em>cp</em>
command (see <a data-type="xref" href="#rec-automate-cp">Recipe 7.4</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159943112">
<h2>Discussion</h2>

<p>Simple copying doesn’t scale all that well, but for a few devices, like a PC,
laptop, and phone, it works fine. The important part is making regular backups,
verifying that you can restore files from your backups, and not worrying if you’re being nerdy enough.</p>

<p>Back in olden times, backups were more complicated because storage was
expensive, so backup programs used a lot of tricks to save space. Now you can
buy multi-terabyte external USB 3.0 hard drives for less than $200.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159939864">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 cp</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.4 Automating Simple Local Backups"><div class="sect1" id="rec-automate-cp">
<h1>7.4 Automating Simple Local Backups</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159935896">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="backups" data-secondary="with cp command" data-tertiary="automatic" data-secondary-sortas="cp command" id="backup-cp-auto"/><a data-type="indexterm" data-primary="cp command" data-secondary="automatic backups" id="cp-auto"/><a data-type="indexterm" data-primary="automatic backups" data-secondary="with cp command" id="auto-cp"/><a data-type="indexterm" data-primary="copying" data-secondary="as backup method" data-tertiary="automatic copying" data-secondary-sortas="backup method" id="copy-backup-auto"/><a data-type="indexterm" data-primary="crontab command" data-secondary="automatic backups" id="crontab-auto-backup"/> like using simple copying for making your backups to an external USB
storage drive, and you want to automate the process.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159926664">
<h2>Solution</h2>

<p>This calls for the <em>cp</em> command and <em>crontab</em> to schedule your backups.</p>

<p>You may list individual files and directories to copy with <em>cp</em>, separated by
spaces:</p>
<pre>duchess@pc:~$ <strong>cp -auv Pictures/cat-desk.jpg Pictures/cat-chair.png \
  ~/cat-pics /media/duchess/2tbdisk/backups/</strong></pre>

<p>The following example copies Duchess’s entire home directory to the <em>backups</em>
directory on an external USB drive named <em>2tbdisk</em>:</p>
<pre>duchess@pc:~$ <strong>cp -auv ~ /media/duchess/2tbdisk/backups/</strong></pre>

<p>This creates <em>/media/duchess/2tbdisk/backups/duchess/</em> on the backup device.</p>

<p>Copy the contents of a directory without copying the directory itself:</p>
<pre>duchess@pc:~$ <strong>cp -auv /home/duchess/* /media/duchess/2tbdisk/backups/</strong>
</pre>

<p>Create a personal cron job to run your backup every night at 10:30 P.M.:</p>
<pre>duchess@pc:~$ <strong>crontab -e</strong>
# m h  dom mon dow   command
<strong>30 22  *   *   *   /bin/cp -au /home/duchess /media/duchess/2tbdisk/backups/</strong>
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159926248">
<h2>Discussion</h2>

<p>If you want to preserve file attributes such as ownership and permissions, format
your backup drive with a Linux filesystem that supports file attributes, such as
Ext4, XFS, or Btrfs (see <a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a>). The FAT filesystems do not
preserve ownership or permissions.</p>

<p>Keep an eye on how long it takes your backup to run. If it takes longer than your
scheduled backup interval, cron will start the next backup on schedule, and then
you have a mess.</p>

<p>The first run takes the longest because all the files are new. Subsequent
backups will go faster as only new files and files with newer timestamps will be copied.</p>

<p>The tilde, ~, is a shortcut for the current user’s home directory, so in this
recipe it is short for <em>/home/duchess</em>.</p>

<p>The asterisk in <em>/home/duchess/*</em> means copy all the files in <em>/home/duchess</em>,
but not the directory <em>/home/duchess</em>.</p>

<p>The <em>-a</em>, <em>-u</em>, and <em>-v</em> options for <em>cp</em> mean:</p>

<ul>
<li>
<p><em>-a, --archive</em> recursively copies and preserves all file attributes:
mode, ownership, timestamps, and extended attributes.</p>
</li>
<li>
<p><em>-u, --update</em> tells <em>cp</em> to copy only files with newer timestamps than the
copies in the backup directory, or new files that have not been backed up yet.</p>
</li>
<li>
<p><em>-v, --verbose</em> prints activity messages during the copy operation.</p>
</li>
</ul>

<p>Some other useful options:</p>

<ul>
<li>
<p><em>-R, -r</em> recursive; use this to copy directories when you do not use
the <em>-a</em> option. <em>-a</em> preserves file attributes, <em>-R, -r</em> does not. FAT
and exFAT filesystems do not support file attributes, so use <em>-R, -r</em> with these.</p>
</li>
<li>
<p><em>--parents</em> creates missing parent directories on the destination.</p>
</li>
<li>
<p><em>-x, --one-file-system</em> This prevents recursing into other partitions and
mounted network filesystems. For example, if you have an NFS share mounted you
may not want to add it to your backup.</p>
</li>
</ul>

<p>Most Linux distributions mount USB devices in <em>/run/media</em> or <em>/media</em>. The
easy way to find the filepath for your USB drive is to look in your file
manager or use<a data-type="indexterm" data-primary="backups" data-secondary="with cp command" data-tertiary="automatic" data-secondary-sortas="cp command" data-startref="backup-cp-auto" id="idm46466159891800"/><a data-type="indexterm" data-primary="cp command" data-secondary="automatic backups" data-startref="cp-auto" id="idm46466159890904"/><a data-type="indexterm" data-primary="automatic backups" data-secondary="with cp command" data-startref="auto-cp" id="idm46466159890264"/><a data-type="indexterm" data-primary="copying" data-secondary="as backup method" data-tertiary="automatic copying" data-secondary-sortas="backup method" data-startref="copy-backup-auto" id="idm46466159889624"/><a data-type="indexterm" data-primary="crontab command" data-secondary="automatic backups" data-startref="crontab-auto-backup" id="idm46466159888280"/><a data-type="indexterm" data-primary="lsblk command" id="idm46466159887192"/> the <em>lsblk</em> command:</p>
<pre>$ <strong>lsblk</strong>
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
[...]
sdb      8:16   0  1.8T  0 disk
└─sdb1   8:17   0  1.5T  0 part /media/duchess/backups
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159886488">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch03.xhtml#rec-scheduled-shutdowns-cron">Recipe 3.7</a> to learn more about using <em>cron</em></p>
</li>
<li>
<p><em>man 1 crontab</em></p>
</li>
<li>
<p><em>man 1 cp</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.5 Using rsync for Local Backups"><div class="sect1" id="idm46466159878984">
<h1>7.5 Using rsync for Local Backups</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159878088">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="local backups" data-secondary-sortas="rsync command" id="backup-rsync-local"/><a data-type="indexterm" data-primary="rsync command" data-secondary="local backups" id="rsync-local"/>want to make backups to a USB stick or USB hard drive, and you want
something that is faster and more efficient than simple copying. You also want
simple file restorations that you can make with standard Linux tools, without
needing special software.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159873640">
<h2>Solution</h2>

<p><em>rsync</em> is what you want. It keeps filesystems synchronized, both local and
remote. <em>rsync</em> is fast and efficient, as it transfers only the changes in files,
and you can restore files with the <em>rsync</em> command, the <em>cp</em> command, your
file manager, or whatever copying tool you prefer.</p>

<p>The following example shows how to back up a home directory. First, name your
source directory, which is the directory you want to back up, then name the
destination directory. This example copies Duchess’s <em>/home</em> to a USB drive
named <em>2tbdisk</em>:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~ /media/duchess/2tbdisk/</strong>
sending incremental file list
duchess/
duchess/Documents/
duchess/Downloads/
duchess/Music/
[...]

sent 27,708,209 bytes  received 20,948 bytes  11,091,662.80 bytes/sec
total size is 785,103,770,793  speedup is 28,313.29</pre>

<p>You can specify two or more directories, in a space-delimited list, to transfer to
the destination directory:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~/arias ~/overtures /media/duchess/2tbdisk/duchess/</strong>
</pre>

<p>Copy files from your backup device to your computer by reversing the source and
destination:</p>
<pre>duchess@pc:~$ <strong>rsync -av /media/duchess/2tbdisk/duchess/arias /home/duchess/</strong>
</pre>

<p>You may safely test your <em>rsync</em> command, without copying any files, with the
<em>--dry-run</em> option:</p>
<pre>duchess@pc:~$ <strong>rsync -av --dry-run \
~/Music/scores ~/Music/woodwinds /media/duchess/2tbdisk/duchess/</strong>
</pre>

<p>If any files are deleted from a source directory, <em>rsync</em> will not delete
them from the destination directory unless you explicitly tell it to with the
<em>delete</em> option:</p>
<pre>duchess@pc:~$ <strong>rsync -av --delete /home/duchess /media/duchess/2tbdisk/</strong>
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159859352">
<h2>Discussion</h2>

<p>The<a contenteditable="false" data-primary="/home" data-secondary="tilde (~) shortcut" data-type="indexterm" id="idm46466159857704"/><a contenteditable="false" data-primary="~ (tilde), for /home directory" data-type="indexterm" id="idm46466159856216"/><a contenteditable="false" data-primary="tilde (~), for /home directory" data-type="indexterm" id="idm46466159855064"/> tilde, <em>~</em>, is a shortcut for your home directory, so in the examples
it means <em>/home/duchess</em>.</p>

<p>Command examples with line breaks use a slash, \, to indicate that the command
continues on the next line. You can copy the whole command, with the slashes, and
it should work.</p>

<p>If you have networked filesystems mounted on your PC, such as NFS or Samba, use
the <em>-x</em> option to copy only from your local filesystem, and not recurse into
the remote filesystems.</p>

<p>Adding a <a data-type="indexterm" data-primary="slash (/), in copying directories" id="idm46466159849688"/><a data-type="indexterm" data-primary="/ (slash), in copying directories" id="idm46466159850344"/>trailing slash, <em>~/</em>, (<em>/home/duchess/</em>) copies only the contents
of the <em>duchess/</em> directory, but not the directory itself, resulting in
<em>/media/duchess/2tbdisk/[files]</em>. Omitting the trailing slash transfers the
contents of <em>/home/duchess</em> and the <em>duchess</em> directory, resulting in
<em>/media/duchess/2tbdisk/duchess/[files]</em>. The trailing slash only matters on
the source directory, and it makes no difference on the destination 
<span class="keep-together">directory</span>.</p>

<p>Don’t feel bad if you have to count on your fingers or make a lot of test
runs to remind yourself how the trailing slash behaves, because this vexes
everyone. It might help to think of the trailing slash as a little fence that
prevents the source directory from escaping.</p>

<p>The <em>-a</em> and <em>-v</em> options for <em>rsync</em> mean:</p>

<ul>
<li>
<p><em>-a, --archive</em> retains the mode, timestamps, permissions, and ownership,
and copies recursively. This is the same as <em>*-rlptgoD*</em>, which copies recursively,
copies symlinks, preserves permissions, preserves file modification times,
preserves file ownership, and preserves special files, such as device files.</p>
</li>
<li>
<p><em>-v, --verbose</em> displays activity messages.</p>
</li>
</ul>

<p>You may wish to use some of these options:</p>

<ul>
<li>
<p><em>-q, --quiet</em> suppresses nonerror messages.</p>
</li>
<li>
<p><em>--progress</em> shows information on each file as it is transferred.</p>
</li>
<li>
<p><em>-A, --als</em> preserves access control lists (ACLs).</p>
</li>
<li>
<p><em>-X, --xattrs</em> preserves extended file attributes (xattrs).</p>
</li>
</ul>

<p>Your filenames, of course, will be different than the examples. <em>2tbdisk</em> is a
filesystem label created by the user (see <a data-type="xref" href="ch09.xhtml#rec-new-partition-gparted">Recipe 9.4</a>). It is
an abbreviation for “2 terabyte disk.” If you do not create a label, <em>udev</em> creates one, for example <em>/media/duchess/488B-7971/</em>.</p>

<p>You may use the normal Linux tools, such as <em>rsync</em>, your file manager, or the
<em>cp</em> command, to restore<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="local backups" data-secondary-sortas="rsync command" data-startref="backup-rsync-local" id="idm46466159828456"/><a data-type="indexterm" data-primary="rsync command" data-secondary="local backups" data-startref="rsync-local" id="idm46466159826888"/> files.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159858552">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.6 Making Secure Remote File Transfers with rsync over SSH"><div class="sect1" id="rec-rsync-over-ssh">
<h1>7.6 Making Secure Remote File Transfers with rsync over SSH</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159821496">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="securing with SSH" data-secondary-sortas="rsync command" id="backup-rsync-ssh"/><a data-type="indexterm" data-primary="rsync command" data-secondary="secure backups with SSH" id="rsync-ssh"/><a data-type="indexterm" data-primary="OpenSSH" data-secondary="rsync backups" id="openssh-rsync"/> want to use <em>rsync</em> to copy files to another computer on your local
network or over the internet, and you want encrypted transport and
authentication.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159815800">
<h2>Solution</h2>

<p><em>rsync</em> uses SSH by default when you transfer files to another machine. The remote
machine must be running an SSH server, and the source machine must have an SSH
client already set up (see <a data-type="xref" href="ch12.xhtml#cha-ssh">Chapter 12</a>).</p>

<p>This example transfers files over the local network from Duchess’s PC to her
laptop. Duchess’s username on her laptop is Empress, and she is copying files from
her home directory on her PC to her home directory on her laptop:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~/Music/arias empress@laptop:songs/</strong>
duchess@laptop's password:
building file list ... done
arias/
arias/o-mio-babbino-caro.ogg
arias/deh-vieni-non-tardar.ogg
arias/mi-chiamano-mimi.ogg
wrote 25984 bytes  read 68 bytes  7443.43 bytes/sec
total size is 25666  speedup is 0.99</pre>

<p>If the destination directory does not exist, <em>rsync</em> will create it.</p>

<p>To upload files over the internet, use the fully qualified domain name of the
server you are logging in to:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~/Music/woodwinds \
 empress@remote.example.com:/backups/</strong></pre>

<p class="pagebreak-before less_space">The syntax for copying files from a remote host is reversed. This example copies
the 
<span class="keep-together"><em>/woodwinds</em></span> directory and its contents from the remote host to Duchess’s
home directory:</p>
<pre>duchess@pc:~$ <strong>rsync -av empress@remote.example.com:/backups/woodwinds \
 /home/duchess/Music/</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159807880">
<h2>Discussion</h2>

<p>You might remember when the SSH option had to be explicit—for example,
<em>rsync -a -e ssh [options]</em>. This is no longer necessary.</p>

<p>You may find some of these options to be useful:</p>

<ul>
<li>
<p><em>--partial</em> preserves partially downloaded files when the network
connection is interrupted, and resumes the file transfer from where it left off
when the connection is restored.</p>
</li>
<li>
<p><em>-h, --human-readable</em> displays file sizes in kilobytes, megabytes, and
gigabytes, rather than bytes.</p>
</li>
<li>
<p><em>--log-file=</em> stores a complete record of each transfer in a text file. Put
them all together like this:</p>
</li>
</ul>
<pre>duchess@pc:~$ <strong>rsync --partial --progress \
 --log-file=/home/duchess/rsynclog.txt \
 -hav ~/Music/arias empress@remote.example.com:/backups/</strong></pre>

<p>Both authentication and transport are encrypted by SSH. Users need shell accounts
on all machines they are going to transfer files to. See <a data-type="xref" href="ch12.xhtml#cha-ssh">Chapter 12</a> to learn about
secure remote administration with SSH.</p>

<p>Consider setting up a central backup server for simplifying administration. Your users have their own accounts with their own <em>/home</em> directories and can manage their own backups and restores without bothering you.</p>

<p>Another option for a backup server is to run <em>rsync</em> as a service. The advantage of
this is your <em>rsync</em> users do not need login accounts on the server. One disadvantage
is it does not support encrypted transfers. See <a data-type="xref" href="#rec-rsyncd-backup-server">Recipe 7.13</a> to
learn about<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="securing with SSH" data-secondary-sortas="rsync command" data-startref="backup-rsync-ssh" id="idm46466159793960"/><a data-type="indexterm" data-primary="rsync command" data-secondary="secure backups with SSH" data-startref="rsync-ssh" id="idm46466159790936"/><a data-type="indexterm" data-primary="OpenSSH" data-secondary="rsync backups" data-startref="openssh-rsync" id="idm46466159789848"/> this.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159796040">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
<li>
<p><a data-type="xref" href="ch12.xhtml#rec-host-key-auth">Recipe 12.5</a></p>
</li>
<li>
<p><a data-type="xref" href="ch12.xhtml#rec-public-key-auth">Recipe 12.7</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.7 Automating rsync Transfers with cron and SSH"><div class="sect1" id="idm46466159782680">
<h1>7.7 Automating rsync Transfers with cron and SSH</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159781672">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="automatic" data-secondary-sortas="rsync command" id="idm46466159780200"/><a data-type="indexterm" data-primary="rsync command" data-secondary="automatic backups" id="idm46466159778872"/><a data-type="indexterm" data-primary="automatic backups" data-secondary="with rsync command" data-secondary-sortas="rsync command" id="idm46466159777992"/><a data-type="indexterm" data-primary="crontab command" data-secondary="automatic backups" id="idm46466159776648"/> want to create crontabs to automatically run your secure <em>rsync</em> transfers.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159776520">
<h2>Solution</h2>

<p>You need SSH set up for passwordless authentication on the destination
machine (see Recipes <a data-xrefstyle="select:labelnumber" data-type="xref" href="ch12.xhtml#rec-keychain">12.10</a> and <a data-xrefstyle="select:labelnumber" data-type="xref" href="ch12.xhtml#rec-keychain-cron">12.11</a>) and network access to
the destination machine for the 
<span class="keep-together">clients</span>.</p>

<p>Then use <em>/etc/crontab</em> for transfers that require root permissions. The following
example makes a backup of <em>/etc</em> every night at 10 P.M. to a LAN server named
<em>server1</em>:</p>
<pre># m h dom mon dow user  command
<strong>00 22 * * * root /usr/bin/rsync -a /etc server1:/system-backups</strong>
</pre>

<p>Use personal crontabs for transferring your own files (see
<a data-type="xref" href="ch03.xhtml#rec-scheduled-shutdowns-cron">Recipe 3.7</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159774792">
<h2>Discussion</h2>

<p>OpenSSH is a lovely tool that provides secure network transfers for a host of
tasks. Anything that you run over a network can probably run over SSH.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159764216">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch12.xhtml#cha-ssh">Chapter 12</a></p>
</li>
<li>
<p><a data-type="xref" href="ch12.xhtml#rec-keychain">Recipe 12.10</a></p>
</li>
<li>
<p><a data-type="xref" href="ch12.xhtml#rec-keychain-cron">Recipe 12.11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.8 Excluding Files from Backup"><div class="sect1" id="rec-exclude-files-backup">
<h1>7.8 Excluding Files from Backup</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159756456">
<h2>Problem</h2>

<p>So <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="excluding files" data-secondary-sortas="rsync command" id="backup-rsync-exclude"/><a data-type="indexterm" data-primary="rsync command" data-secondary="excluding files" id="rsync-exclude"/><a data-type="indexterm" data-primary="files" data-secondary="excluding from backups" id="file-exclude"/><a data-type="indexterm" data-primary="excluding files from backups" id="exclude-file"/>far the examples have shown how to transfer entire directories. You want to
know how to exclude files and directories from being copied.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159752040">
<h2>Solution</h2>

<p>For simplicity, the following examples demonstrate local transfers to a USB
drive, but they also work for remote transfers over SSH; see
<a data-type="xref" href="#rec-rsync-over-ssh">Recipe 7.6</a>.</p>

<p class="pagebreak-before less_space">When it’s just a few files, you can list them on the command line using
<em>--exclude=</em>. This example excludes one file from
<em>/home/duchess/Music/arias</em>:</p>
<pre>duchess@pc:~$ <strong>rsync -av --exclude=lho-perduta.wav \
 ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>This is nice and easy and reliable. However, there is a gotcha: if there are
multiple files in your source directory with the same name as your excluded
file, all of them will be excluded. If you do not want the duplicates to be
excluded, you need to specify which one is to be excluded. In the following
example you want to exclude only the copy in the <em>arias/</em> source
directory:</p>
<pre>duchess@pc:~$ <strong>rsync -av --exclude=arias/lho-perduta.wav \
 ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>Exclude more than one file by enclosing them in curly braces, separated with
single quotes and commas. There must be no spaces between the equals sign and the
curly brace, and no spaces between the commas and single quotes:</p>
<pre>duchess@pc:~$ <strong>rsync -av \
--exclude={'arias/lho-perduta.wav','non-mi-dir.wav','un-bel-di-vedremo.flac'} \
~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>Excluding directories works the same way as excluding files, and you can mix
files and directories in your exclude list:</p>
<pre>duchess@pc:~$ <strong>rsync -av \
--exclude={'soprano/','tenor/','non-mi-dir.wav'} \
~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>See <a data-type="xref" href="#rec-includes-excludes">Recipe 7.11</a> to learn how to put your excludes list in a file.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159749096">
<h2>Discussion</h2>

<p>The root directory in an <em>rsync</em> transfer is the top-level directory you are
transferring files from. In the examples in this recipe, that is <em>~/Music/arias</em>.
<em>rsync</em> checks all the files and directories in your root directory, and compares
them to your exclude directives,<a data-type="indexterm" data-primary="patterns" id="idm46466159735160"/> which <em>rsync</em> calls <em>patterns</em>. Patterns are
checked against the files and directories in your root directory, starting at the
root and proceeding down through the directory hierarchy.
Every time a pattern is matched, it is excluded from the transfer. If the pattern
<em>arias/lho-perduta.wav</em> is duplicated in another location, such as
<em>2arias/lho-perduta.wav</em>, it will also be excluded.
When a pattern ends with a slash (<em>/</em>), <em>rsync</em> will match only <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="excluding files" data-secondary-sortas="rsync command" data-startref="backup-rsync-exclude" id="idm46466159731064"/><a data-type="indexterm" data-primary="rsync command" data-secondary="excluding files" data-startref="rsync-exclude" id="idm46466159729464"/><a data-type="indexterm" data-primary="files" data-secondary="excluding from backups" data-startref="file-exclude" id="idm46466159727912"/><a data-type="indexterm" data-primary="excluding files from backups" data-startref="exclude-file" id="idm46466159726792"/>directories.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159736392">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-simple-include">Recipe 7.10</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.9 Including Selected Files to Backup"><div class="sect1" id="rec-include-files">
<h1>7.9 Including Selected Files to Backup</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159720072">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="including files" data-secondary-sortas="rsync command" id="backup-rsync-include"/><a data-type="indexterm" data-primary="rsync command" data-secondary="including files" id="rsync-include"/><a data-type="indexterm" data-primary="files" data-secondary="including in backups" id="file-include"/><a data-type="indexterm" data-primary="including files in backups" id="include-file"/>want to include a selected set of files in your backup, rather than
defining a list of files to exclude.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159714408">
<h2>Solution</h2>

<p>When you want to back up just a few files, you can do this on the command line.

<span class="keep-together"><em>--include=</em></span> operates differently than 
<span class="keep-together"><em>--exclude=</em></span> because it doesn’t really
mean “include,” it means “do not exclude.” It needs two additional options,
<span class="keep-together"><em>--include=*/</em></span> and <span class="keep-together"><em>--exclude='*'</em></span>, as this
example of transferring a single file shows:</p>
<pre>duchess@pc:~$ <strong>rsync -av --include=*/ --include=lho-perduta.wav \
 --exclude='*' ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>You may transfer a list of files:</p>
<pre>duchess@pc:~$ <strong>rsync -av --include=*/ \
--include={'lho-perduta.wav','non-mi-dir.wav','un-bel-di-vedremo.flac'} \
--exclude='*' ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong></pre>

<p>There must be no spaces between the equals sign and the curly brace, and no
spaces between the commas and single quotes.</p>

<p>If there are multiple files with the same name in different locations in your
source directory, <em>rsync</em> will transfer all of them. In this example only
<em>/home/duchess/Music/arias/sopranos/lho-perduta.wav</em> is transferred because
the pattern <em>soprano/lho-perduta.wav</em> is unique in <em>/Music/arias</em>:</p>
<pre>duchess@pc:~$ <strong>rsync -av --include=*/ --include=soprano/lho-perduta.wav
--exclude='*' ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong>
Music/
Music/arias/
Music/arias/baritone/
Music/arias/soprano/
Music/arias/soprano/lho-perduta.wav
Music/arias/tenor/
[...]</pre>

<p>That transfers only a single file, but all the subdirectories in
<em>~/Music/arias</em> are copied. Use the <em>-m, --prune-empty-dirs</em> option to prevent
copying empty directories, like this example:</p>
<pre>duchess@pc:~$ <strong>rsync -avm --include=*/ --include=soprano/lho-perduta.wav
--exclude='*' ~/Music/arias /media/duchess/2tbdisk/duchess/Music/</strong>
Music/
Music/arias/soprano/
Music/arias/soprano/lho-perduta.wav</pre>

<p>When you have more than a few files to include, store your list in a plain-text
file (see Recipes <a data-xrefstyle="select:labelnumber" data-type="xref" href="#rec-simple-include">7.10</a> and <a data-xrefstyle="select:labelnumber" data-type="xref" href="#rec-includes-excludes">7.11</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159712664">
<h2>Discussion</h2>

<p><em>--include=*/</em> tells <em>rsync</em> to traverse your entire source directory.</p>

<p><em>--include=[files]</em> means do not exclude these files.</p>

<p><em>--exclude='*'</em> tells <em>rsync</em> to exclude everything not included.</p>

<p>Remember that all filepaths are relative to your source directory and not your
system’s root directory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159691208">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-simple-include">Recipe 7.10</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-includes-excludes">Recipe 7.11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.10 Managing Includes with a Simple Include File"><div class="sect1" id="rec-simple-include">
<h1>7.10 Managing Includes with a Simple Include File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159684296">
<h2>Problem</h2>

<p>Your includes are too many for a command-line incantation, and you want
to maintain your list in a file that <em>rsync</em> can read. You also want
this to be simple, if possible, thanks to past experience with <em>rsync</em>
include/exclude files that never would work right.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159681160">
<h2>Solution</h2>

<p>The simplest way to maintain a list, without going crazy over figuring out
<em>rsync</em>’s include/exclude syntax, is to create a plain list of files that you
provide to the 
<span class="keep-together"><em>--files-from=</em></span> option. You don’t have to worry about getting them
in the right order, or using <em>rsync</em>’s filter notation, just a plain list with
whatever files and directories you want. The only gotcha is every item in your
list must be relative to your source directory. In the following example, all
list items are relative to <em>/home/duchess</em>:</p>

<pre data-type="programlisting"># include file list
#
/Documents/compositions/jazz/
/Documents/schedule.odt
/Videos/concerts/
.config
.local
/Music/courses/bassoon.avi&lt;/strong&gt;
[...]</pre>

<p>Then use the list with the <em>--files-from</em> option:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~ --files-from ~/include-list.txt \
 duchess@remote.example.com:/backups/</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159674712">
<h2>Discussion</h2>

<p>This is the easiest way to maintain a list of files and directories to back up.
There are no excludes, no wildcards, no funny syntax, just a nice clean
understandable list.</p>

<p>When you use the tilde to indicate your home directory, leave off the equals
sign from 
<span class="keep-together"><em>--files-from</em></span>, like the last example in the<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="including files" data-secondary-sortas="rsync command" data-startref="backup-rsync-include" id="idm46466159671320"/><a data-type="indexterm" data-primary="rsync command" data-secondary="including files" data-startref="rsync-include" id="idm46466159669544"/><a data-type="indexterm" data-primary="files" data-secondary="including in backups" data-startref="file-include" id="idm46466159668456"/><a data-type="indexterm" data-primary="including files in backups" data-startref="include-file" id="idm46466159667304"/> recipe.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159666168">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-include-files">Recipe 7.9</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-includes-excludes">Recipe 7.11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.11 Managing Includes and Excludes with an Exclude File"><div class="sect1" id="rec-includes-excludes">
<h1>7.11 Managing Includes and Excludes with an Exclude File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159659080">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="excluding files" data-secondary-sortas="rsync command" id="backup-rsync-exclude2"/><a data-type="indexterm" data-primary="rsync command" data-secondary="excluding files" id="rsync-exclude2"/><a data-type="indexterm" data-primary="files" data-secondary="excluding from backups" id="file-exclude2"/><a data-type="indexterm" data-primary="excluding files from backups" id="exclude-file2"/>like the simple include file concept in <a data-type="xref" href="#rec-simple-include">Recipe 7.10</a>, but you
really want to have both includes and excludes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159650120">
<h2>Solution</h2>

<p>What you want is an <em>rsync</em> exclude file. An exclude file provides more
flexibility and contains both includes and excludes. The following example
illustrates a basic configuration. Every item must start by including the
source root, which in this example is 
<span class="keep-together"><em>/home/duchess</em>,</span> and end with excluding
the source root:</p>

<pre data-type="programlisting"># exclude file list
#
# include home directory
+ /duchess/
#
# include .config and .local, exclude all other dotfiles
+ /duchess/.config
+ /duchess/.local
- /duchess/.*
#
# include jazz/, exclude all other files in Documents
+ /duchess/Documents/
+ /duchess/Documents/compositions/
+ /duchess/Documents/compositions/jazz/
- /duchess/Documents/compositions/*
- /duchess/Documents/*
#
# include schedule.odt, include all .ogg files in
# arias/, exclude all other files in Music
+ /duchess/Music/
+ /duchess/Music/schedule.odt
+ /duchess/Music/arias/*.ogg
- /duchess/Music/arias/*
- /duchess/Music/*
#
# includes courses/, exclude all other files in Videos
+ /duchess/Videos/
+ /duchess/Videos/courses/
- /duchess/Videos/*
#
# exclude everything else
- /duchess/*</pre>

<p>Feed it to <em>rsync</em> with the <em>exclude-from=</em> option:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~ \
 --exclude-from=/home/duchess/exclude-list.txt \
 /media/duchess/2tbdisk/</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159644072">
<h2>Discussion</h2>

<p>The <em>exclude-list.txt</em> example demonstrates backing up:</p>

<ul>
<li>
<p>Two dotfiles, <em>.config</em> and <em>.local</em></p>
</li>
<li>
<p>A single subdirectory of <em>/Documents</em>, <em>/jazz</em></p>
</li>
<li>
<p>A single file in <em>/Music</em>, <em>schedule.odt</em>, and only <em>.ogg</em> files in
<em>/Music/arias/</em></p>
</li>
<li>
<p>A single directory in <em>/Videos</em>, <em>/courses</em></p>
</li>
</ul>

<p>There must be no spaces between lines, and comments (#) are useful for reminding
you of the purpose of each section, and for adding a bit of whitespace. Preface
your includes with the plus sign and the excludes with the minus sign.</p>

<p>All other files in <em>/home/duchess</em> are excluded from backup.
Includes must always come first. As the example file shows, you have to be
precise in defining each include/exclude. Includes must be listed in their
directory hierarchy order, with all subdirectories. For example, this will fail
with all files excluded:</p>

<pre data-type="programlisting">+ /duchess/Documents/compositions/
- /duchess/*</pre>

<p class="pagebreak-before less_space">Try including <em>/Documents</em>:</p>

<pre data-type="programlisting">+ /duchess/Documents/
+ /duchess/Documents/compositions/
- /duchess/*</pre>

<p>Now all the subdirectories and their contents in <em>/Documents</em> are transferred,
and not just <em>/compositions</em>. To copy only <em>/compositions</em> you have to
exclude <em>/Documents</em>; it is not enough to exclude only <em>/duchess</em>. The
following example copies only <em>/duchess/Documents/compositions/</em> and nothing
else:</p>

<pre data-type="programlisting">+ /duchess/Documents/
+ /duchess/Documents/compositions/
- /duchess/Documents/*
- /duchess/*</pre>

<p>You may use wildcards to include or exclude files by type. For example, include
all <em>.ogg</em> and <em>.flac</em> files, exclude all <em>.wav</em> files, and exclude all
<em>cache</em> and <em>temp</em> directories:</p>

<pre data-type="programlisting"># include home directory
+ /duchess/
#
# include all ogg and flac files
+ *.ogg
+ *.flac
#
# exclude wav files, all cache and temp dirs
- *.wav
- cache*
- temp*</pre>

<p>You may have multiple source directories.</p>

<p>There is always just one destination <a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="excluding files" data-secondary-sortas="rsync command" data-startref="backup-rsync-exclude2" id="idm46466159620872"/><a data-type="indexterm" data-primary="rsync command" data-secondary="excluding files" data-startref="rsync-exclude2" id="idm46466159619048"/><a data-type="indexterm" data-primary="files" data-secondary="excluding from backups" data-startref="file-exclude2" id="idm46466159617960"/><a data-type="indexterm" data-primary="excluding files from backups" data-startref="exclude-file2" id="idm46466159616712"/>directory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See also"><div class="sect2" id="idm46466159643608">
<h2>See also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-simple-include">Recipe 7.10</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.12 Limiting rsync’s Bandwidth Use"><div class="sect1" id="idm46466159611352">
<h1>7.12 Limiting rsync’s Bandwidth Use</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159610248">
<h2>Problem</h2>

<p>Large<a data-type="indexterm" data-primary="backups" data-secondary="with rsync command" data-tertiary="bandwidth limitations" data-secondary-sortas="rsync command" id="idm46466159608728"/><a data-type="indexterm" data-primary="rsync command" data-secondary="bandwidth limitations" id="idm46466159607512"/><a data-type="indexterm" data-primary="bandwidth limitations with rsync command" id="idm46466159606568"/> file transfers can use a lot of network bandwidth and slow down
everything. You want a simple way to restrict <em>rsync</em>’s bandwidth use without
implementing something complex like traffic shaping.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159603800">
<h2>Solution</h2>

<p>Use <em>rsync</em>’s <em>--bwlimit</em> option. This example limits it to 512 Kbps:</p>
<pre>$ <strong>rsync --bwlimit=512 -ave ssh ~/Music/arias empress@laptop:songs/</strong>
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159601032">
<h2>Discussion</h2>

<p><em>--bwlimit</em> only accepts values in kilobits.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159599048">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rsync</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.13 Building an rsyncd Backup Server"><div class="sect1" id="rec-rsyncd-backup-server">
<h1>7.13 Building an rsyncd Backup Server</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159595016">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="building server" data-secondary-sortas="rsyncd servers" id="backup-rsyncd-build"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="building" id="rsyncd-build"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="building" id="server-rsyncd-build"/>want your users to back up their own data on a central backup server, but you
don’t want to give them shell accounts on your backup server.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159589096">
<h2>Solution</h2>

<p>Set up a central backup server, and run <em>rsync</em> in daemon mode. You should
have name services already set up, and the hosts on your network have
access to the backup server. Users will not need login accounts on the server because
you will use <em>rsync</em>’s own access controls and user authorization to control
access to the <em>rsync</em> archives.</p>
<div data-type="note" epub:type="note"><h1>For LAN Use Only</h1>
<p>This is suitable for LAN use only, and not over untrusted networks, because the
<em>rsync</em> daemon does not encrypt the authentication or file transfers. For
encrypted transfers you need OpenVPN (<a data-type="xref" href="ch13.xhtml#cha-openvpn">Chapter 13</a>).</p>
</div>

<p><em>rsync</em> must be installed on all machines. <em>rsyncd</em> runs on the backup server,
and clients will use the <em>rsync</em> command to connect to the server.</p>

<p>On the backup server, edit or create <em>/etc/rsyncd.conf</em> to create an <em>rsync</em>
module defining the archive:</p>
<pre># modules
[<i>backup_dir1</i>]
   path = <i>/backups</i>
   comment = <i>"server1 public archive"</i>
   list = yes
   read only = no
   use chroot = no
   uid = 0
   gid = 0
</pre>

<p>Create your <em>/backups</em> directory, mode 0700, owned by root, to prevent
unauthorized access from anyone who has access to the server:</p>
<pre>$ <strong>sudo mkdir /backups/</strong>
$ <strong>sudo chmod 0700 /backups/</strong>
</pre>

<p>Start <em>rsyncd</em> on the server in daemon mode with systemd:</p>
<pre>$ <strong>sudo systemctl start rsyncd.service</strong></pre>

<p>On Debian/Ubuntu it is <em>rsync.service</em>.</p>

<p>If your Linux does not have systemd, start it with the <em>rsync</em> command:</p>
<pre>admin@server1:~$ <strong>sudo rsync --daemon</strong></pre>

<p>On the backup server, test that <em>rsyncd</em> is listening and accepting connections:</p>
<pre>admin@server1:~$ <strong>rsync server1::</strong>
backup_dir1     "server1 public archive"</pre>

<p>Then test from another PC on your network using the server’s hostname or IP
address:</p>
<pre>duchess@pc:~$ <strong>rsync server1::</strong>
backup_dir1     "server1 public archive"

duchess@pc:~$ <strong>rsync 192.168.10.15::</strong>
backup_dir1     "server1 public archive"</pre>

<p>Now you know that it is ready to transfer files. Test that you can copy files to
your new <em>rsyncd</em> server:</p>
<pre>duchess@pc:~$ <strong>rsync -av ~/drawings server1::backup_dir1</strong>
building file list.....done
drawings/
drawings/aug_03
drawings/sept_03

wrote 1126399 bytes  read 104 bytes  1522.0 bytes/sec
total size is 1130228  speedup is 0.94</pre>

<p>Now view the nice new uploaded files:</p>
<pre>duchess@pc:~$ <strong>rsync server1::backup_dir1/drawings/</strong>
drwx------    4,096  2021/01/04  06:06:55    .
-rw-r--r--   21,560  2021/09/17  08:53:18    aug_03
-rw-r--r--   21,560  2021/10/14  16:42:16    sept_03</pre>

<p>Upload a few more files to the server, then download files to a different
computer from the <em>rsyncd</em> server:</p>
<pre>madmax@buntu:~$ <strong>rsync -av server1::backup_dir1/drawings ~/downloads</strong>
receiving incremental file list
created directory /home/madmax/downloads
drawings/
drawings/aug_03
drawings/sept_03

sent 123 bytes  received 11562479 bytes  1755.00 bytes/sec
total size is 1141776 speedup is 1.00</pre>

<p>Everything works. Take a break and enjoy your success.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159588152">
<h2>Discussion</h2>

<p>This is not a secure form of file transfer because there is no encryption, and
anyone on the network can access the files. It is suitable to use on your local
network for easy archiving and file sharing.</p>

<p><em>rsync [hostname]::</em> needs double colons when connecting to an <em>rsync</em> server
running in daemon mode. This tells <em>rsync</em> to look for a module name.</p>

<p>These are the command options in the <em>/etc/rsyncd.conf</em> example:</p>
<dl>
<dt><em>[backup_dir1]</em></dt>
<dd>
<p>The module name can be anything you want.</p>
</dd>
<dt><em>path =</em></dt>
<dd>
<p>Defines the directory for the module to use.</p>
</dd>
<dt><em>comment =</em></dt>
<dd>
<p>This is a brief description to remind you who the module belongs to, or what it is for.</p>
</dd>
<dt><em>list=yes</em></dt>
<dd>
<p>Permits users to see a list of files in the module. <em>no</em> hides the
module.</p>
</dd>
<dt><em>read only = no</em></dt>
<dd>
<p>This allows users to upload files to the server.</p>
</dd>
<dt><em>use chroot = no</em></dt>
<dd>
<p>Overrides the default of <em>use chroot = yes</em>. <em>chroot</em> is <em>change root</em>, sometimes <a data-type="indexterm" data-primary="chroot jail" id="idm46466159544712"/>called a <em>chroot jail</em>. A <em>chroot jail</em> is a separate environment inside your filesystem that contains its own root filesystem, commands, libraries, and everything else it needs to function. This is not a secure environment, though it is commonly thought of as a security tool. For <em>rsync</em>, the man page describes this as useful protection from configuration errors. The trade-off is <em>rsync</em> is blocked from following symlinks to files outside of the chroot environment, and it complicates preserving UIDs and GIDs by name. As they say, your mileage may vary, and it may be a good option for you. See the <em>use chroot</em> section of <em>rsyncd.conf (5)</em>.</p>
</dd>
</dl>

<p>Set both <em>uid</em> and <em>gid</em> to <em>root</em> or <em>0</em>. This preserves UIDs and
GIDs, and manages permissions correctly.</p>

<p>If any of your transfers fail, look at the <em>rsync</em> error messages. They will tell
you if you made a mistake in your filepaths, misspelled something, or couldn’t
connect to the server, and give useful hints for correcting the problem.</p>

<p>If you are running a Linux without systemd, consult its documentation to learn
how to start and stop rsyncd.</p>

<p>See <a data-type="xref" href="#rec-access-control">Recipe 7.14</a> to learn how to set up access <a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="building server" data-secondary-sortas="rsyncd servers" data-startref="backup-rsyncd-build" id="idm46466159534632"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="building" data-startref="rsyncd-build" id="idm46466159533864"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="building" data-startref="server-rsyncd-build" id="idm46466159532776"/>controls.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159530984">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 rsyncd.conf</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.14 Limiting Access to rsyncd Modules"><div class="sect1" id="rec-access-control">
<h1>7.14 Limiting Access to rsyncd Modules</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159526920">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="access control" data-secondary-sortas="rsyncd servers" id="backup-rsyncd-access"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="access control" id="rsyncd-access"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="access control" id="server-rsyncd-access"/><a data-type="indexterm" data-primary="authentication" data-secondary="on rsyncd servers" data-secondary-sortas="rsyncd servers" id="access-rsyncd"/>don’t want an open <em>rsyncd</em> server, and you want users to have their own
protected modules that other users cannot access.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159519800">
<h2>Solution</h2>

<p><em>rsyncd</em> comes with its own simple authentication and access controls. Create a
new file containing username/password pairs, and add <em>auth users</em> and
<em>secrets file</em> directives to <em>/etc/rsyncd.conf</em>.</p>

<p>First create the password file. In the following example, <em>/etc/rsyncd-users</em> sets up three users and their passwords:</p>

<pre data-type="programlisting"># rsync-users for server1
duchess:12345
madmax:23456
stash:34567</pre>

<p>Set permissions to read-write for root-only:</p>
<pre>$ <strong>sudo chmod 0600 /etc/rsyncd-users</strong></pre>

<p class="pagebreak-before less_space">Now create a module for one of your users in <em>/etc/rsyncd.conf</em>. This example
creates a module for Duchess, using the <em>/backups/duchess</em> directory on the
<em>rsync</em> server:</p>
<pre>[<i>duchess_backup</i>]
   path = <i>/backups/duchess</i>
   comment = <i>Duchess's private archive</i>
   list = yes
   read only = no
   auth users = <i>duchess</i>
   secrets file =<i>/etc/rsyncd-users</i>
   use chroot = no
   strict modes = yes
   uid = root
   gid = root
   </pre>

<p>Create your user’s backup directory, like this example for Duchess, with mode 0700:</p>
<pre>$ <strong>sudo mkdir <i>/backups/duchess/</i></strong>
$ <strong>sudo chmod -R 0700 <i>/backups/duchess/</i></strong></pre>

<p>Now try logging in:</p>
<pre>$ <strong>rsync <i>duchess@server1::duchess_backup</i></strong>
Password: <strong><i>12345</i></strong>
drwxr-xr-x      4,096 2020/06/29   18:24:43 .</pre>

<p>Try transferring some files:</p>
<pre>$ <strong>rsync -av ~/logs <i>duchess@server1::duchess_backup</i></strong>
Password:
sending incremental file list
logs/
logs/irc.log
logs/irc_#core-standup.log
logs/irc_#core.log
logs/irc_#desktop.log
logs/irc_#engineering.log
logs/irc_#mobile.log

sent 130,507 bytes  received 305 bytes  37,374.86 bytes/sec
total size is 129,383  speedup is 0.99</pre>

<p>It worked! If the file transfer fails, check the <em>rsync</em> log to learn why. On
systemd Linuxes, read the most recent log entries in the status output:</p>
<pre>$ <strong>systemctl status rsyncd.service</strong></pre>

<p>On other Linux distributions the rsyncd log should be in <em>/var/log</em>.</p>
</div></section>













<section data-type="sect2" class="pagebreak-before less_space" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159496584">
<h2>Discussion</h2>

<p>The username/password pairs are arbitrary and are not related to system user
accounts. <em>rsyncd</em> users have no access to the host system outside of their <em>rsync</em>
shares.</p>

<p>For additional security, add these directives to <em>/etc/rsyncd.conf</em>:</p>
<dl>
<dt><em>hosts allow</em></dt>
<dd>
<div class="openblock">
<p>Use this to list hosts that are allowed to access the
<em>rsyncd</em> archives. For example, you can limit access to hosts on a single subnet:</p>
<pre>hosts allow = <i>*.local.net</i>
hosts allow = <i>192.168.1.</i></pre>

<p>All hosts not allowed are denied, so you don’t need a <em>hosts deny</em> directive.</p>
</div>

</dd>
<dt><em>hosts deny</em></dt>
<dd>
<div class="openblock">
<p>This usually isn’t needed, if you use <em>hosts allow</em>. It is
useful for denying access to specific hosts that cause annoyance.</p>

<p>The password file is in cleartext, so it must be restricted to the <a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="access control" data-secondary-sortas="rsyncd servers" data-startref="backup-rsyncd-access" id="idm46466159484600"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="access control" data-startref="rsyncd-access" id="idm46466159483032"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="access control" data-startref="server-rsyncd-access" id="idm46466159481944"/><a data-type="indexterm" data-primary="authentication" data-secondary="on rsyncd servers" data-secondary-sortas="rsyncd servers" data-startref="access-rsyncd" id="idm46466159480616"/>superuser.</p>
</div>

</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159479032">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 rsyncd.conf</em></p>
</li>
<li>
<p>The Discussion in <a data-type="xref" href="#rec-rsyncd-backup-server">Recipe 7.13</a> to learn about the command
options.</p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="7.15 Creating a Message of the Day for rsyncd"><div class="sect1" id="idm46466159475032">
<h1>7.15 Creating a Message of the Day for rsyncd</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159474024">
<h2>Problem</h2>

<p>You’re <a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="MOTD files" data-secondary-sortas="rsyncd servers" id="backup-rsyncd-motd"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="MOTD files" id="rsyncd-motd"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="MOTD files" id="server-rsyncd-motd"/><a data-type="indexterm" data-primary="MOTD (message of the day) files on rsyncd servers" id="motd-rsyncd"/><a data-type="indexterm" data-primary="message of the day (MOTD) files on rsyncd servers" id="message-rsyncd"/>running an <em>rsyncd</em> server, and you think it would be nice to greet users
with a cheerful message.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159465864">
<h2>Solution</h2>

<p>Create your message of the day (MOTD) in a plain-text file, such as
<em>/etc/rsync-motd</em>:</p>
<pre><i>Welcome to your local backup server! Please remember to actually back up
your files!</i></pre>

<p>Then configure the MOTD file location at the top of <em>/etc/rsyncd.conf</em>:</p>
<pre>[global]
motd file = <i>/etc/rsync-motd</i></pre>

<p class="pagebreak-before less_space">When users connect to your server, they will see your message:</p>
<pre>$ <strong>rsync <i>server1::backup_dir1/</i></strong>
Welcome to your local backup server! Please remember to actually backup your
files!

drwx------          4,096 2020/06/29 18:24:43 .
-rwxr-xr-x          6,400 2015/03/13 08:21:21 keytool
drwx------          4,096 2020/06/17 06:07:41 WIP
drwx------          4,096 2020/06/17 06:06:55 bin
drwxr-xr-x          4,096 2020/06/30 09:47:42 duchess
[...]</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159458280">
<h2>Discussion</h2>

<p>A message of the day is an old Unix tradition. Use it for cheery greetings,
maintenance downtime announcements, security tips, backup tips, or anything you
think is<a data-type="indexterm" data-primary="backups" data-secondary="with rsyncd servers" data-tertiary="MOTD files" data-secondary-sortas="rsyncd servers" data-startref="backup-rsyncd-motd" id="idm46466159457240"/><a data-type="indexterm" data-primary="rsyncd servers" data-secondary="MOTD files" data-startref="rsyncd-motd" id="idm46466159455752"/><a data-type="indexterm" data-primary="servers" data-secondary="rsyncd" data-tertiary="MOTD files" data-startref="server-rsyncd-motd" id="idm46466159454120"/><a data-type="indexterm" data-primary="MOTD (message of the day) files on rsyncd servers" data-startref="motd-rsyncd" id="idm46466159452696"/><a data-type="indexterm" data-primary="message of the day (MOTD) files on rsyncd servers" data-startref="message-rsyncd" id="idm46466159451720"/> important.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159450296">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 rsyncd.conf</em></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>