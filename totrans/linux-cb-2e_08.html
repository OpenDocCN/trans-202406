<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Managing Disk Partitioning with parted"><div class="chapter" id="cha-partitioning-parted">
<h1><span class="label">Chapter 8. </span>Managing Disk Partitioning with parted</h1>


<p>All mass storage drives—SATA hard disks, solid state drives, USB drives,
SD (Secure Digital), NVMe (Non-Volatile Memory Express), and CompactFlash cards—must be partitioned and formatted with filesystems before you can use them.
They all ship with some kind of partitioning and filesystems, which may not be
what you want. As your needs change, you will want to repartition your
disks and use different filesystems. In this chapter you will learn about using
<em>parted</em> (partition editor) to manage partitioning.</p>






<section data-type="sect1" class="orm:non-recipe" data-pdf-bookmark="Overview"><div class="sect1" id="idm46466159438168">
<h1>Overview</h1>

<p><em>parted</em> only manages partitioning; see <a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a> to learn
about filesystems. <a data-type="xref" href="ch09.xhtml#cha-partitioning-gparted">Chapter 9</a> covers the graphical frontend
to <em>parted</em>, GParted, which manages both partitioning and filesystems.</p>

<p>You will also learn about the modern replacement for the Master Boot Record
(MBR), which is the elderly and inadequate legacy partition table. The MBR
has been supplanted by the new Globally Unique Identifier Partition Table
(GUID Partition Table or GPT).</p>

<p><em>parted</em> shows <a data-type="indexterm" data-primary="parted command" data-secondary="purpose of" id="idm46466159436392"/>partition information and adds, removes, and resizes
partitions. <em>parted</em> has just one gotcha: it writes your changes to disk
immediately, so you must be careful. GParted does not apply changes until you
click a button.</p>

<p>It is a common convenience to call all mass <a data-type="indexterm" data-primary="disks" data-secondary="terminology" id="idm46466159440216"/>storage devices <em>disks</em>, even
though many of them are not disks anymore, but solid-state devices, like USB
sticks. Why not, when we still dial telephones, and make tape recordings and
film videos with our smartphones?</p>

<p>A disk partition<a data-type="indexterm" data-primary="partitions" data-secondary="purpose of" id="idm46466159441176"/><a data-type="indexterm" data-primary="disks" data-secondary="partitions" data-see="partitions" id="idm46466159433992"/> is a logical division of a storage disk, a way of dividing the
disk into one or more independent regions. A disk must have at least one
partition. The number of partitions depends on your needs and whims. After
partitioning a disk, you must put a filesystem on each partition, and then you
can use it. A single disk may have multiple partitions, and each partition may
have a different filesystem.</p>

<p>The <a data-type="indexterm" data-primary="disks" data-secondary="naming" id="idm46466159432136"/><a data-type="indexterm" data-primary="naming" data-secondary="disks" id="idm46466159431032"/><a data-type="indexterm" data-primary="/dev" data-secondary="disk names" id="idm46466159430184"/>disk name on Linux is always <em>/dev</em> something, which is short for device.
For example, <em>/dev/sda</em> for a hard disk, and <em>/dev/sr0</em> for an optical drive.
Partitions are the disk name plus a number. If <em>/dev/sda</em> has three partitions,
they are <em>/dev/sda1</em>, <em>/dev/sda2</em>, and <em>/dev/sda3</em>.</p>








<section data-type="sect2" class="orm:non-recipe" data-pdf-bookmark="Partitioning Schemes"><div class="sect2" id="idm46466159425016">
<h2>Partitioning Schemes</h2>

<p>The<a data-type="indexterm" data-primary="Linux" data-secondary="installing" data-tertiary="with custom partitioning" data-tertiary-sortas="custom partitioning" id="idm46466159423336"/><a data-type="indexterm" data-primary="installing" data-secondary="Linux" data-tertiary="with custom partitioning" data-tertiary-sortas="custom partitioning" id="idm46466159422008"/><a data-type="indexterm" data-primary="custom partitioning, installing Linux with" id="idm46466159420680"/><a data-type="indexterm" data-primary="partitions" data-secondary="creating" data-tertiary="with Linux install" data-tertiary-sortas="Linux install" id="idm46466159419784"/> default partitioning scheme on some Linux distributions is to stuff the
whole installation into a single partition. This works fine, but setting up
a few more partitions during installation has some advantages:</p>

<ul>
<li>
<p>Giving <em>/boot</em> its<a data-type="indexterm" data-primary="/boot, partition for" id="idm46466159416008"/> own partition makes managing multiboot systems easier because the boot files are independent of whatever operating systems you install or remove.</p>
</li>
<li>
<p>Put <em>/home</em> on <a data-type="indexterm" data-primary="/home" data-secondary="partition for" id="idm46466159413896"/>its own partition to isolate it from the root filesystem, so
you can replace your Linux installation without touching <em>/home</em>. <em>/home</em>
could even be on a separate drive.</p>
</li>
<li>
<p><em>/var</em> and <em>/tmp</em> can <a data-type="indexterm" data-primary="/var" data-secondary="partition for" id="idm46466159409976"/><a data-type="indexterm" data-primary="/tmp" data-secondary="partition for" id="idm46466159409240"/>fill up from runaway processes. Putting them on
their own partitions prevents them from interfering with the other filesystems.</p>
</li>
<li>
<p>Putting <a data-type="indexterm" data-primary="swap files, partition for" id="idm46466159407112"/>the swap file on its own partition enables suspend-to-disk.</p>
</li>
</ul>

<p>See <a data-type="xref" href="ch01.xhtml#cha-install-linux">Chapter 1</a> to learn more about designing your partitioning
layouts.</p>
</div></section>













<section data-type="sect2" class="orm:non-recipe" data-pdf-bookmark="Partition Tables: GPT and MBR"><div class="sect2" id="idm46466159404728">
<h2>Partition Tables: GPT and MBR</h2>

<p>The<a data-type="indexterm" data-primary="partition tables" id="partition-table"/><a data-type="indexterm" data-primary="GPT (GUID Partition Table)" id="gpt"/><a data-type="indexterm" data-primary="MBR (Master Boot Record)" id="mbr"/><a data-type="indexterm" data-primary="GUID Partition Table" data-see="GPT" id="idm46466159399960"/> GUID Partition Table (GPT), first released in 2010,
is the modern replacement for the antique PC-DOS Master Boot Record (MBR). If
your only experience is with the MBR, prepare yourself for a treat, because the
GPT is a big improvement.</p>

<p>The MBR was created for IBM PCs way back in the last millennium in the early
1980s, during the exciting era of 10-megabyte (MB) hard disks. The MBR goes on the
first 512 bytes of the first sector of your disk, preceding the first
partition, and holds the bootloader and partition table. The bootloader
occupies 446 bytes, the partition table uses 64 bytes, and the remaining 2
bytes store the boot signature.</p>

<p>64 bytes is not much room to store much of anything, so the MBR is limited to
four primary partitions. One primary partition may hold an extended partition,
which can then be divided into logical partitions. Linux supports
(theoretically) an unlimited number of logical partitions. Even with great
thundering herds of logical partitions, the MBR is limited to addressing a
maximum disk size of 2.2 TiB, which these days is barely enough to hold your
cat memes. Why this limitation? You can do the math yourself: the MBR is limited
to 32 bits of addressing, and can address 2<sup>32</sup> number of blocks (we’ll discuss
blocks and sectors in a moment), so the equation for disks with 512-byte blocks
is 2<sup>32</sup> x 512 = 2.199023256×10<sup>12</sup> bytes.</p>
</div></section>













<section data-type="sect2" class="orm:non-recipe" data-pdf-bookmark="BIOS and UEFI"><div class="sect2" id="idm46466159390056">
<h2>BIOS and UEFI</h2>

<p>The<a data-type="indexterm" data-primary="BIOS/UEFI setup" data-secondary="GPT versus MBR" id="BIOS-UEFI-GPT-MBR"/> GPT is part of the UEFI (Unified Extensible Firmware Interface)
specification. UEFI replaces your computer’s Basic Input Output System, better
known as the PC BIOS, or just plain BIOS. <a data-type="xref" href="#fig-legacy-bios">Figure 8-1</a> is the old legacy
BIOS, and <a data-type="xref" href="#fig-uefi-setup">Figure 8-2</a> is a modern UEFI, all full of shiny whizbang
features, just like a little operating system.</p>

<p>GPT has many advantages over the MBR:</p>

<ul>
<li>
<p>Up to 128 partitions on Linux, numbered 1–128, and no messing with
primary and extended partitions</p>
</li>
<li>
<p>Fault-tolerance: copies of the partition table are stored in multiple
locations</p>
</li>
<li>
<p>Unique IDs for disks and partitions</p>
</li>
<li>
<p>Legacy BIOS/MBR boot mode</p>
</li>
<li>
<p>Verifies its own integrity and the partition table</p>
</li>
<li>
<p>Secure Boot</p>
</li>
</ul>

<figure><div id="fig-legacy-bios" class="figure">
<img src="Images/lcb2_0801.png" alt="Legacy BIOS setup" width="1200" height="664"/>
<h6><span class="label">Figure 8-1. </span>Legacy BIOS setup</h6>
</div></figure>

<figure><div id="fig-uefi-setup" class="figure">
<img src="Images/lcb2_0802.png" alt="UEFI setup" width="900" height="503"/>
<h6><span class="label">Figure 8-2. </span>UEFI setup</h6>
</div></figure>

<p>The MBR is nearly obsolete, and you should use the GPT. In GPT, the first sector
of the disk is reserved for a protective MBR that supports GPT on a BIOS computer,
so we can use the GPT on older systems that have a BIOS instead of UEFI. The
bootloader and operating system must both be GPT-aware, which has been the
case with Linux for years. The only reason to use the MBR is on old computers
with old operating systems that do not support the GPT.</p>

<p>If you have an older system with a BIOS, you cannot upgrade it to UEFI, but must
replace the motherboard to get UEFI. Both UEFI and BIOS are integrated<a data-type="indexterm" data-primary="BIOS/UEFI setup" data-secondary="GPT versus MBR" data-startref="BIOS-UEFI-GPT-MBR" id="idm46466159376248"/><a data-type="indexterm" data-primary="partition tables" data-startref="partition-table" id="idm46466159377928"/><a data-type="indexterm" data-primary="GPT (GUID Partition Table)" data-startref="gpt" id="idm46466159377080"/><a data-type="indexterm" data-primary="MBR (Master Boot Record)" data-startref="mbr" id="idm46466159375208"/> into the
motherboard.</p>
</div></section>













<section data-type="sect2" class="orm:non-recipe" data-pdf-bookmark="Blocks and Sectors"><div class="sect2" id="idm46466159374072">
<h2>Blocks and Sectors</h2>

<p>Now we<a data-type="indexterm" data-primary="partitions" data-secondary="blocks and sectors" id="partition-block-sector"/><a data-type="indexterm" data-primary="files" data-secondary="blocks and sectors" id="file-block-sector"/><a data-type="indexterm" data-primary="blocks" id="blocks"/><a data-type="indexterm" data-primary="sectors" id="sectors"/><a data-type="indexterm" data-primary="disks" data-secondary="blocks and sectors" id="disks-block-sector"/><a data-type="indexterm" data-primary="bytes" data-secondary="in disk capacity" data-secondary-sortas="disk capacity" id="bytes-disk-capacity"/> will talk about blocks and sectors, and how they affect the maximum
sizes of your disks, files, and partitions. <em>Blocks</em> are the smallest storage
units on a disk that a filesystem can use. These are logical, not physical,
divisions. The smallest physical unit of storage is a <em>sector</em>. Blocks can
span multiple sectors, and a file can span multiple blocks.</p>

<p>When a file spans multiple blocks, there is a certain amount of waste because
files rarely match block sizes. For example, a file that is one byte larger than
four blocks uses five blocks. The fifth block holds just that one byte, and that
block is exclusive to the file. Because of this you might think that 512-byte
blocks are less wasteful. But there is more information stored in a block than
just the file.</p>

<p>Every block, in addition to your file data, stores timestamps, the filename,
ownership, permissions, the block ID, and its correct order with other
blocks, the inode, and other metadata.</p>

<p>4096-byte blocks use one-eighth the metadata of 512-byte blocks. On a 4
TiB hard disk, you need 8,000,000,000 512-byte blocks. With a 4096-byte block
size there are only 1,000,000,000 blocks, which represents quite a lot of
metadata savings.</p>

<p>The sector size limits the size of storage volumes. The standard sector size for
hard disks has been 512 bytes for some years, and now 4096 bytes is the standard
because hard disks have grown so large.</p>

<p>The GPT provides 64-bit addressing, supporting 2<sup>64</sup> total blocks on a single
disk, so a hard disk with 512-byte blocks can be as large as 9 zettabytes.
With 4096-byte blocks, your maximum disk size is 64 zettabytes, which I daresay
is sufficient for even the most dedicated cat meme collector. These are
theoretical maximums, limited by available hardware, operating system limits,
and filesystem support for large volumes. For example, the Ext4 filesystem maxes
out at 1 EiB for a single filesystem, and a maximum 16 TiB file size with a
4096-byte block size. XFS supports a maximum filesystem and file size of 8 EiB
minus 1 byte.</p>

<p>CDs and DVDs have 2048-byte sectors. Solid-state devices such as USB sticks, SD
cards, CompactFlash, and Solid State Drives (SSDs) also have sectors and
blocks. The smallest unit on an SSD is called a <em>page</em>. Common page sizes are 2
KB, 4 KB, 8 KB, and larger. Blocks contain 128 to 256 pages, and block size is
typically 256 KB to 
<span class="keep-together">4 MB.</span></p>

<p>All of these enormous numbers are a bit dizzying. <a data-type="xref" href="#table-decimal-binary-bytes">Table 8-1</a>
summarizes the decimal and binary measurements used to measure disk capacity.</p>
<table id="table-decimal-binary-bytes">
<caption><span class="label">Table 8-1. </span>Decimal and binary multiples of bytes</caption>
<thead>
<tr>
<th>Value</th>
<th>Decimal</th>
<th>Value</th>
<th>Binary</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>1</p></td>
<td><p>B byte</p></td>
<td><p>1</p></td>
<td><p>B byte</p></td>
</tr>
<tr>
<td><p>1000</p></td>
<td><p>kB kilobyte</p></td>
<td><p>1024</p></td>
<td><p>KiB kibibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>2</sup></p></td>
<td><p>MB megabyte</p></td>
<td><p>1024<sup>2</sup></p></td>
<td><p>MiB mebibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>3</sup></p></td>
<td><p>GB gigabyte</p></td>
<td><p>1024<sup>3</sup></p></td>
<td><p>GiB gibibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>4</sup></p></td>
<td><p>TB terabyte</p></td>
<td><p>1024<sup>4</sup></p></td>
<td><p>TiB tebibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>5</sup></p></td>
<td><p>PB petabyte</p></td>
<td><p>1024<sup>5</sup></p></td>
<td><p>PiB pebibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>6</sup></p></td>
<td><p>EB exabyte</p></td>
<td><p>1024<sup>6</sup></p></td>
<td><p>EiB exbibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>7</sup></p></td>
<td><p>ZB zettabyte</p></td>
<td><p>1024<sup>7</sup></p></td>
<td><p>ZiB zebibyte</p></td>
</tr>
<tr>
<td><p>1000<sup>8</sup></p></td>
<td><p>YB yottabyte</p></td>
<td><p>1024<sup>8</sup></p></td>
<td><p>YiB yobibyte</p></td>
</tr>
</tbody>
</table>

<p>The<a data-type="indexterm" data-primary="bytes" data-secondary="decimal versus binary values" id="idm46466159321624"/> decimal values are powers of 10; for example, a kilobyte is 1000 bytes, or
10<sup>3</sup>. The binary values are powers of two, so a kibibyte is 2<sup>10</sup>, 1024 bytes.
Hard disk manufacturers like to use the decimal format to make their drives
look bigger.</p>

<p>Whoever came up with the weird “bibyte” naming scheme just about guaranteed
that nobody would ever want to say the names. It’s all a mishmash anyway, as
people like to use them interchangeably. At any rate, now you know the<a data-type="indexterm" data-primary="partitions" data-secondary="blocks and sectors" data-startref="partition-block-sector" id="idm46466159320136"/><a data-type="indexterm" data-primary="files" data-secondary="blocks and sectors" data-startref="file-block-sector" id="idm46466159319064"/><a data-type="indexterm" data-primary="blocks" data-startref="blocks" id="idm46466159316856"/><a data-type="indexterm" data-primary="sectors" data-startref="sectors" id="idm46466159316008"/><a data-type="indexterm" data-primary="disks" data-secondary="blocks and sectors" data-startref="disks-block-sector" id="idm46466159315064"/><a data-type="indexterm" data-primary="bytes" data-secondary="in disk capacity" data-secondary-sortas="disk capacity" data-startref="bytes-disk-capacity" id="idm46466159313560"/>
difference.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.1 Unmounting Your Partitions Before Using parted"><div class="sect1" id="idm46466159372968">
<h1>8.1 Unmounting Your Partitions Before Using parted</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159310600">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="partitions" data-secondary="unmounting" id="partition-unmount"/><a data-type="indexterm" data-primary="unmounting partitions" id="unmount-partition"/><a data-type="indexterm" data-primary="umount command" id="umount-command"/>know you must unmount your partition, or partitions, before you can make
any changes with <em>parted</em>, and you need to know how.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159306488">
<h2>Solution</h2>

<p>Unmount a partition from your graphical file manager, or use the <em>umount</em> command.
The following example unmounts <em>/dev/sdc2</em>:</p>
<pre>$ <strong>sudo umount /dev/sdc2</strong></pre>

<p>How do you know the correct device name? See <a data-type="xref" href="#rec-list-partitions">Recipe 8.3</a> to learn
how to list your attached disks and partitions.</p>

<p>If you are creating a new partition table on a disk, you should unmount all the
partitions on it.</p>
<div data-type="tip"><h1>Changing a Running System</h1>
<p>It is risky to unmount filesystems attached to the active root filesystem, such
as <em>/home</em>, <em>/var</em>, or <em>/tmp</em>, if they are on separate partitions. It is
safer to perform partitioning operations from another Linux instance, such as
SystemRescue (<a data-type="xref" href="Images/ch19.html#cha-rescue-recovery">Chapter 19</a>), or a second Linux on the same machine
(<a data-type="xref" href="ch01.xhtml#cha-install-linux">Chapter 1</a>).</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159296616">
<h2>Discussion</h2>

<p>Technically, you mount and unmount filesystems rather than partitions. However,
I shall not hold it against you if you say “partitions.”</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159293576">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><a href="https://oreil.ly/SNyLL">Parted User’s Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.2 Choosing the Command Mode for parted"><div class="sect1" id="idm46466159289288">
<h1>8.2 Choosing the Command Mode for parted</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159288232">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="parted command" data-secondary="command modes" id="parted-command-modes"/><a data-type="indexterm" data-primary="command modes (parted), selecting" id="command-mode-select"/><a data-type="indexterm" data-primary="selecting" data-secondary="command modes (parted)" id="select-command-mode"/><a data-type="indexterm" data-primary="choosing" data-see="selecting" id="idm46466159283688"/> know you can start the <em>parted</em> command in interactive mode, launching the
<em>parted</em> command shell, or run it as an ordinary command, and you want to know
how to do both.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159282616">
<h2>Solution</h2>

<p>Running <em>parted</em> with no options launches the interactive <em>parted</em> shell. You
need root privileges:</p>
<pre>$ <strong>sudo parted</strong>
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted)</pre>

<p>When your normal command prompt changes to <em>(parted)</em>, you are in
the <em>parted</em> shell. Type <strong><code>help</code></strong> to see a list of commands and their
descriptions. There is also help for the individual <em>parted</em> commands, for
example, <em>help print</em>. Type <em>quit</em> to exit parted. Most <em>parted</em>
commands can be abbreviated to their first letter, like <em>h</em> and <em>q</em>.</p>

<p>Enter a complete command to run <em>parted</em> as a normal command in your regular
shell, like this example that lists all of your disks:</p>
<pre>$ <strong>sudo parted /dev/sdb print devices</strong>
/dev/sdb (2000GB)
/dev/sda (4001GB)
/dev/sdc (4010MB)
/dev/sdd (15.7GB)
/dev/sr0 (425MB)
</pre>

<p>The command runs and exits, and returns to your normal command prompt.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159270584">
<h2>Discussion</h2>

<p>Be careful in both modes, because <em>parted</em> applies your changes
immediately. Always have good backups before doing anything with <em>parted</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159267672">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><a href="https://oreil.ly/SNyLL">Parted User’s Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.3 Viewing Your Existing Disks and Partitions"><div class="sect1" id="rec-list-partitions">
<h1>8.3 Viewing Your Existing Disks and Partitions</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159262168">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="displaying existing" id="parted-existing-partitions"/><a data-type="indexterm" data-primary="partitions" data-secondary="displaying existing" id="partition-display"/><a data-type="indexterm" data-primary="disks" data-secondary="displaying existing" id="disks-display"/><a data-type="indexterm" data-primary="displaying" data-secondary="existing partitions/disks" id="display-partition"/><a data-type="indexterm" data-primary="existing partitions/disks, displaying" id="existing-partition-display"/> want to see your existing partitions, their sizes, and what filesystems
are on them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159254008">
<h2>Solution</h2>

<p>If you don’t know the names of the disks on your system, run <em>parted</em>
with no options:</p>
<pre>$ <strong>sudo parted</strong>
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted)</pre>

<p>When you have not selected a device, <em>parted</em>  guesses which one you want,
usually the first one, and tells you which one it has selected (see
<em>Using /dev/sda</em> in the preceding example).</p>

<p><em>print devices</em> lists your disk names and sizes:</p>
<pre>(parted) <strong>print devices</strong>
/dev/sda (256GB)
/dev/sdb (1000GB)
/dev/sdc (4010MB)</pre>

<p>Select which device you want to look at, then display its information:</p>
<pre>(parted) <strong>select /dev/sdb</strong>
Using /dev/sdb
(parted) <strong>print</strong>
Model: ATA ST1000DM003-1SB1 (scsi)
Disk /dev/sdb: 1000GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system     Name  Flags
 1      1049kB  525MB   524MB   fat16                 boot, esp
 2      525MB   344GB   343GB   btrfs
 3      344GB   998GB   654GB   xfs
 4      998GB   1000GB  2148MB  linux-swap(v1)        swap

(parted)</pre>

<p>Type <strong><code>quit</code></strong> to exit.</p>

<p>You can open the <em>parted</em> shell to a specific disk:</p>
<pre>$ <strong>sudo parted /dev/sda</strong>
GNU Parted 3.2
Using /dev/sdb
Welcome to GNU Parted! Type 'help' to view a list of commands.</pre>

<p>Enter <strong><code>print</code></strong> with no options to see information about this
disk:</p>
<pre>(parted) <strong>print</strong>
 Model: ATA SAMSUNG SSD SM87 (scsi)
Disk /dev/sda: 256GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
[...]</pre>

<p><em>print all</em> lists all partitions on all devices:</p>
<pre>(parted) <strong>print all</strong>
 Model: ATA SAMSUNG SSD SM87 (scsi)
Disk /dev/sda: 256GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End    Size    File system  Name                    Flags
 1      1049kB  524MB  523MB   fat16        EFI system              legacy_boot,
                                            partition               msftdata

 2      524MB   659MB  134MB                Microsoft reserved      msftres
                                            partition
 3      659MB   253GB  253GB   ntfs         Basic data partition    msftdata

 4      253GB   256GB  2561MB  ntfs                                 diag

Model: ATA ST1000DM003-1SB1 (scsi)
Disk /dev/sdb: 1000GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system     Name  Flags
 1      1049kB  525MB   524MB   fat16                 boot, esp
 2      525MB   344GB   343GB   btrfs
 3      344GB   998GB   654GB   xfs
 4      998GB   1000GB  2148MB  linux-swap(v1)        swap

Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  4010MB  4009MB  primary  fat32</pre>

<p class="pagebreak-before less_space">Find any unpartitioned free space on any disk:</p>
<pre>(parted) <strong>print free</strong>
Model: ATA ST4000DM000-1F21 (scsi)
Disk /dev/sda: 4001GB
Sector size (logical/physical): 512B/4096B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system     Name  Flags
        17.4kB  1049kB  1031kB  Free Space
 1      1049kB  500MB   499MB   ext4
 2      500MB   60.5GB  60.0GB  ext4
 3      60.5GB  2061GB  2000GB  xfs
 4      2061GB  2069GB  8000MB  linux-swap(v1)
        2069GB  4001GB  1932GB  Free Space</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159253464">
<h2>Discussion</h2>

<p>Let’s take a look at what all of this output means:</p>

<ul>
<li>
<p><em>Model</em> is the manufacturer’s name for the device.</p>
</li>
<li>
<p><em>Disk</em> gives the device name and size.</p>
</li>
<li>
<p><em>Sector size</em> gives both the logical and physical block size. A logical
block size of 512B is for backward compatibility with older disk controllers
and software.</p>
</li>
<li>
<p><em>Partition table</em> tells you the partition type, either <em>msdos</em> or <em>gpt</em>.</p>
</li>
<li>
<p><em>Flags</em> matter more to Windows than Linux. They identify the partition types,
and in some cases are necessary so Windows gets less confused. The full list is
in the
<a href="https://oreil.ly/SNyLL"><em>Parted User’s Manual</em></a>.</p>
</li>
</ul>

<p>These are the partition flags in the examples:</p>

<ul>
<li>
<p><em>legacy_boot</em> marks a GPT partition as bootable.</p>
</li>
<li>
<p><em>msftdata</em> labels GPT partitions that contain Microsoft filesystems, either
NTFS or FAT.</p>
</li>
<li>
<p><em>msftres</em> is a Microsoft reserved partition. This is a special partition
that is required by Microsoft on GPT partitions, for use by the operating
system. On partitions less than 16 GB in size, the MSR is 32 MB, and on larger
drives it is 128 MB.</p>
</li>
<li>
<p><em>diag</em> is a Windows recovery partition.</p>
</li>
<li>
<p><em>boot, esp</em> both mark the partition as a boot partition. <em>boot</em> is an MBR
label, and <em>esp</em> is a GPT label.</p>
</li>
<li>
<p><em>swap</em> marks swap<a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="displaying existing" data-startref="parted-existing-partitions" id="idm46466159215896"/><a data-type="indexterm" data-primary="partitions" data-secondary="displaying existing" data-startref="partition-display" id="idm46466159214568"/><a data-type="indexterm" data-primary="disks" data-secondary="displaying existing" data-startref="disks-display" id="idm46466159213480"/><a data-type="indexterm" data-primary="displaying" data-secondary="existing partitions/disks" data-startref="display-partition" id="idm46466159212392"/><a data-type="indexterm" data-primary="existing partitions/disks, displaying" data-startref="existing-partition-display" id="idm46466159211240"/> partitions.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159235144">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/SNyLL"><em>Parted User’s Manual</em></a></p>
</li>
<li>
<p><em>man 8 parted</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.4 Creating GPT Partitions on a Nonbooting Disk"><div class="sect1" id="rec-create-gpt">
<h1>8.4 Creating GPT Partitions on a Nonbooting Disk</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159204504">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="partitions" data-secondary="GPT, creating on nonbootable disks" id="partition-gpt-create"/><a data-type="indexterm" data-primary="GPT (GUID Partition Table)" data-secondary="creating partitions on nonbootable disks" id="gpt-create-nonbootable"/><a data-type="indexterm" data-primary="disks" data-secondary="nonbootable, creating GPT partitions on" id="disks-nonbootable-create-partition"/><a data-type="indexterm" data-primary="nonbootable disks, creating GPT partitions on" id="nonboot-create-gpt-partition"/><a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="creating on nonbootable disks" id="parted-create-nonbootable"/>want to repartition a disk, removing all data and starting over
with a new GUID Partition Table (GPT). This is not a bootable disk with an
operating system, but is only for data storage.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159196088">
<h2>Solution</h2>

<p>First, create the new partition table, then create your partitions, then verify
that all were created correctly. Be very certain that you select the correct
disk; see <a data-type="xref" href="#rec-list-partitions">Recipe 8.3</a> to learn how to list your disks and partitions.</p>

<p>In the following example, there is a USB stick at <em>/dev/sdc</em>, which is used for
data storage. It is not a bootable disk with an operating system on it. You must
unmount your devices before running <em>parted</em>. The first step is to unmount it,
then create a new GPT partition table:</p>
<pre>$ <strong>sudo umount /dev/sdc</strong>
$ <strong>sudo parted /dev/sdc</strong>
GNU Parted 3.2
Using /dev/sdc
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) <strong>mklabel gpt</strong>
Warning: The existing disk label on /dev/sdc will be destroyed and all data on
this disk will be lost. Do you want to continue?
Yes/No? <strong>Yes</strong>
(parted) <strong>p</strong>
Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start  End  Size  File system  Name  Flags</pre>

<p>Now you can create new partitions. The following example creates two
partitions that are about the same size. You must specify a name for the
partition, and the start and end locations for both partitions:</p>
<pre>(parted) <strong>mkpart "images" ext4 1MB 2004MB</strong>
(parted) <strong>mkpart "audio files" xfs 2005MB 100%</strong></pre>

<p>Then check your work, and exit:</p>
<pre>(parted) <strong>print</strong>
Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name         Flags
 1      1049kB  2005MB  2004MB  ext4         images
 2      2006MB  4009MB  2003MB  xfs          audio files

(parted) <strong>q</strong>
Information: You may need to update /etc/fstab.</pre>

<p>If your start or end points are too close to another partition, you will see an
error message. In the following example, the start of the second partition is the
same as the end of the first partition:</p>
<pre>(parted) <strong>mkpart "images" ext4 2004MB 100%</strong>
Warning: You requested a partition from 2004MB to 4010MB (sectors
3914062..7831551).
The closest location we can manage is 2005MB to 4010MB (sectors
3915776..7831518).
Is this still acceptable to you?
Yes/No? <strong>Yes</strong></pre>

<p>Changing it to 200 5MB fixes the error.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159181352">
<h2>Discussion</h2>

<p><em>start</em> sets the beginning of the new partition. This is always a number value.
The <code>1MB</code> value in the example means one megabyte from the beginning of the
disk. You cannot start at zero because the first 33 sectors are reserved for
the EFI label, so the first partition starts at the 34th sector or higher. I
start at the one megabyte mark because it is easy to remember.</p>

<p><em>end</em> can take a size value or a percentage. In the example,
the end of first partition is 200 5MB from the start of the first partition. The
second partition ends at 100% of the remaining space.
Creating a new partition table wipes out all data on the disk.</p>

<p>You must put filesystems on your new partitions before they are usable
(see 
<span class="keep-together"><a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a></span>).</p>

<p>The warning “You may need to update /etc/fstab” applies only if you change
partitions that are in your <em>/etc/fstab</em> file.</p>

<p>The syntax for creating new GPT partitions is <em>mkpart name fs-type start
end</em>.</p>

<p><em>name</em> is required. This is anything you want, so you can make it a name that
helps you remember what the partition is for.</p>

<p>The <em>fs-type</em> label is not required, but you should specify it so that the
partition is assigned the correct filesystem type code. Run <em>help mkpart</em> in
the <em>parted</em> shell to see a list of filesystem labels.</p>

<p>Even though you created filesystem labels, there are no filesystems on your
disk. Creating filesystems is a separate step.</p>

<p>The filesystem labels sometimes disappear. After you put a filesystem on the
partition, they will stay put.</p>

<p>The <em>parted</em> help and documentation are a bit confusing on the differences
between creating GPT partitions and MS-DOS partitions. When you create a GPT
partition, you must create a <em>name</em> for it. When you create an MS-DOS
partition you must specify a <em>part-type</em>, which is one of <em>primary</em>,
<em>extended</em>, or <em>logical</em>. There is a fair bit of confusion about this, and
the result is admins creating GPT partition names of <em>primary</em>, <em>extended</em>,
and <em>logical</em>. This is not correct and you should create <em>names</em> for GPT

<span class="keep-together">partitions</span>.</p>

<p>At any rate, you should not create MS-DOS partition tables because they are
obsolete, except on old computers with old software that does not<a data-type="indexterm" data-primary="partitions" data-secondary="GPT, creating on nonbootable disks" data-startref="partition-gpt-create" id="idm46466159175176"/><a data-type="indexterm" data-primary="GPT (GUID Partition Table)" data-secondary="creating partitions on nonbootable disks" data-startref="gpt-create-nonbootable" id="idm46466159163352"/><a data-type="indexterm" data-primary="disks" data-secondary="nonbootable, creating GPT partitions on" data-startref="disks-nonbootable-create-partition" id="idm46466159162136"/><a data-type="indexterm" data-primary="nonbootable disks, creating GPT partitions on" data-startref="nonboot-create-gpt-partition" id="idm46466159160664"/><a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="creating on nonbootable disks" data-startref="parted-create-nonbootable" id="idm46466159159816"/> support GPT.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159157992">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/SNyLL"><em>Parted User’s Manual</em></a></p>
</li>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.5 Creating Partitions for Installing Linux"><div class="sect1" id="idm46466159152360">
<h1>8.5 Creating Partitions for Installing Linux</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159151352">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="Linux" data-secondary="installing" data-tertiary="with custom partitioning" data-tertiary-sortas="custom partitioning" id="idm46466159149896"/><a data-type="indexterm" data-primary="installing" data-secondary="Linux" data-tertiary="with custom partitioning" data-tertiary-sortas="custom partitioning" id="idm46466159148568"/><a data-type="indexterm" data-primary="custom partitioning, installing Linux with" id="idm46466159147240"/><a data-type="indexterm" data-primary="partitions" data-secondary="creating" data-tertiary="with Linux install" data-tertiary-sortas="Linux install" id="idm46466159146504"/> want to install Linux on a disk and need to know how to partition it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159144104">
<h2>Solution</h2>

<p>Use the partition manager in the Linux installer. You can set up your
partitions before running the installer, but using the installer’s partition
manager ensures that it will be done correctly, and you will see warnings for
any errors. See <a data-type="xref" href="ch01.xhtml#rec-install-partition">Recipe 1.8</a> for a suggested partitioning scheme.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159142120">
<h2>Discussion</h2>

<p>Most Linux installers provide guidance for partitioning for a new installation
and also allow manual customizations.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159140392">
<h2>See Also</h2>

<ul>
<li>
<p>The introduction to this chapter for partitioning suggestions</p>
</li>
<li>
<p><a data-type="xref" href="ch01.xhtml#cha-install-linux">Chapter 1</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.6 Removing Partitions"><div class="sect1" id="rec-parted-delete-partition">
<h1>8.6 Removing Partitions</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159134360">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="deleting" id="parted-delete"/><a data-type="indexterm" data-primary="partitions" data-secondary="deleting" data-tertiary="with parted command" data-tertiary-sortas="parted command" id="partition-delete2"/><a data-type="indexterm" data-primary="deleting" data-secondary="partitions" data-tertiary="with parted command" data-tertiary-sortas="parted command" id="delete-partition2"/>want to delete some partitions.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159128280">
<h2>Solution</h2>

<p>Start <em>parted</em> in interactive mode for the disk you want to make changes on,
then print the partition table:</p>
<pre>$ <strong>sudo parted /dev/sdc</strong>
GNU Parted 3.2
Using /dev/sdc
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) <strong>p</strong>

Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  2005MB  2004MB  primary
 2      2005MB  4010MB  2005MB  primary</pre>

<p>In this example, delete the second partition by typing <em>rm 2</em>. The partition
will be immediately removed, and there will not be a confirmation. Then type
<em>p</em> to verify:</p>
<pre>(parted) <strong>rm 2</strong>
(parted) <strong>p</strong>
Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  2005MB  2004MB  primary</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159120424">
<h2>Discussion</h2>

<p>Be very certain you are deleting the correct partitions. It is OK to make
written notes and check many times before you start.</p>

<p>If you try to delete a mounted partition, <em>parted</em> will warn you with “Warning:
Partition /dev/sdc2 is being used. Are you sure you want to continue?” You may
go ahead and delete it. Any open files will remain in memory until you reboot or
close 
<span class="keep-together">them, which</span> is kind of fun because you can still read and save the files to
a different<a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="deleting" data-startref="parted-delete" id="idm46466159117336"/><a data-type="indexterm" data-primary="partitions" data-secondary="deleting" data-tertiary="with parted command" data-tertiary-sortas="parted command" data-startref="partition-delete2" id="idm46466159114760"/><a data-type="indexterm" data-primary="deleting" data-secondary="partitions" data-tertiary="with parted command" data-tertiary-sortas="parted command" data-startref="delete-partition2" id="idm46466159112824"/> 
<span class="keep-together">partition</span>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159119128">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><a href="https://oreil.ly/SNyLL">Parted User’s Manual</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.7 Recovering a Deleted Partition"><div class="sect1" id="rec-parted-recover-deleted-partition">
<h1>8.7 Recovering a Deleted Partition</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159105896">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="recovering deleted" id="idm46466159104264"/><a data-type="indexterm" data-primary="partitions" data-secondary="recovering deleted" id="idm46466159103176"/><a data-type="indexterm" data-primary="recovering" data-secondary="deleted partitions" id="idm46466159102328"/><a data-type="indexterm" data-primary="rescue command" id="idm46466159101384"/><a data-type="indexterm" data-primary="deleting" data-secondary="partitions" data-tertiary="recovering deleted" id="idm46466159100648"/>deleted a partition, and now you wish you hadn’t, and you want to get it back.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159098488">
<h2>Solution</h2>

<p>If you accidentally deleted a new empty partition, don’t bother trying to
recover it, just create it again. If your partition had a filesystem and data
on it, then your best chance is to try immediate recovery. In the <em>parted</em> shell, use the <em>rescue</em> command, and give it the partition’s start and end locations.
These can be approximate:</p>
<pre>(parted) <strong>rescue 2000MB 4010MB</strong>
searching for file systems... 40%       (time left 00:01)Information: A ext4
primary partition was found at 2005MB -&gt; 4010MB.  Do you want to add it to the
partition table?
Yes/No/Cancel? <strong>Yes</strong></pre>

<p><em>parted</em> won’t give you any feedback, so print the partition table to see if
the lost partition came back:</p>
<pre>(parted) <strong>p</strong>
Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name    Flags
 1      1049kB  2005MB  2004MB  xfs          images
 2      2005MB  4010MB  2005MB  ext4</pre>

<p>And there it is. With a little luck all of your files are intact.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159091880">
<h2>Discussion</h2>

<p>The longer you wait to try to restore a partition, the more likely it will not
be restorable because it may be unintentionally overwritten. If you need to delay
rescue operations until a later time, put it away in a safe place, if
possible.</p>

<p>As always, your best practice is to always maintain good backups.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159090056">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/SNyLL"><em>Parted User’s Manual</em></a></p>
</li>
<li>
<p><em>man 8 parted</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.8 Increasing Partition Size"><div class="sect1" id="rec-resize-partition-fs">
<h1>8.8 Increasing Partition Size</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159083800">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="resizing" id="parted-resize"/><a data-type="indexterm" data-primary="partitions" data-secondary="resizing" id="partition-resize"/><a data-type="indexterm" data-primary="resizing" data-secondary="partitions" id="resize-partition"/><a data-type="indexterm" data-primary="filesystems" data-secondary="resizing" id="filesystem-resize"/><a data-type="indexterm" data-primary="resizing" data-secondary="filesystems" id="resize-filesystem"/> want to increase the size of an existing partition, which has a filesystem
on it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159075544">
<h2>Solution</h2>

<p>The following example increases the size of a partition with a filesystem on
it. There are two steps: first resize the partition, then resize the filesystem
to match. Every filesystem has its own set of tools, and you must use the
correct tool for increasing the size. In this recipe, we will resize the Ext4,
XFS, Btrfs, and FAT16/32 partitions.</p>

<p>Ext4, XFS, and Btrfs can all be enlarged online or offline. FAT16/32 can be resized
only offline and must be unmounted first.</p>

<p>There must be free space at the end of the partition you want to increase. Open
the <em>parted</em> shell to your selected disk, and look for free space:</p>
<pre>$ <strong>sudo parted /dev/sdc</strong>
GNU Parted 3.2
Using /dev/sdc
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) <strong>print free</strong>
Model: General USB Flash Disk (scsi)
Disk /dev/sdc: 4010MB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name    Flags
[...]
        1024MB  2005MB  981MB   Free Space
 2      2005MB  3500MB  1495MB  ext4         audio
        3500MB  4010MB  510MB   Free Space</pre>

<p>This shows 981 MB of free space preceding Partition 2, and 510 MB of free
space following. You can only change the end point of a partition, so the
following examples expand Partition 2 to use all of the 510 MB of free space at
the end.</p>

<p>First, expand the partition to its new end point:</p>
<pre>(parted) <strong>resizepart 2 4010MB</strong></pre>

<p>You will not see a success message, but if you make a mistake, you will see an
error message. Type <strong><code>p</code></strong> to see the partition table and verify that
<em>resizepart</em> did what you want.</p>

<p>Now you must expand the filesystem to fit the new partition size with the
appropriate command for the filesystem. <a data-type="xref" href="#command-increase-fs-size">Table 8-2</a> shows the commands
to use for each filesystem, expanding them to fill their partitions.</p>
<table id="command-increase-fs-size">
<caption><span class="label">Table 8-2. </span>Commands to increase filesystem sizes</caption>
<thead>
<tr>
<th>Filesystem</th>
<th>Resize command</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Ext4</p></td>
<td><p>sudo resize2fs /dev/sd<em>c2</em></p></td>
</tr>
<tr>
<td><p>XFS</p></td>
<td><p>sudo xfs_growfs -d /dev/sd<em>c2</em></p></td>
</tr>
<tr>
<td><p>Btrfs</p></td>
<td><p>sudo btrfs filesystem resize max /dev/sd<em>c2</em></p></td>
</tr>
<tr>
<td><p>FAT16/32</p></td>
<td><p>sudo fatresize -i  /dev/sd<em>c2</em></p></td>
</tr>
</tbody>
</table>

<p>Remember that FAT16/32 must be unmounted first.</p>

<p>Print the partition table in <em>parted</em> to check your work.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159074952">
<h2>Discussion</h2>

<p>The examples in this chapter and in <a data-type="xref" href="#rec-shrink-partition">Recipe 8.9</a> are small, using a
4 GB USB stick. This is great for testing, but in real life you will likely
be using larger disks. The commands are the same, except for partition
sizes.</p>

<p>As always, you should have current backups before you start.</p>

<p>You could resize a filesystem to be smaller than the partition, but that
doesn’t make sense. Check out <a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a> to learn all about
creating and managing filesystems.</p>

<p>If you are wondering “Where is my favorite filesystem?” I chose Ext4,
Btrfs, XFS, and FAT16/32 because those are the most commonly used Linux
filesystems, and they are all <a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="resizing" data-startref="parted-resize" id="idm46466159047880"/><a data-type="indexterm" data-primary="partitions" data-secondary="resizing" data-startref="partition-resize" id="idm46466159048440"/><a data-type="indexterm" data-primary="resizing" data-secondary="partitions" data-startref="resize-partition" id="idm46466159045304"/><a data-type="indexterm" data-primary="filesystems" data-secondary="resizing" data-startref="filesystem-resize" id="idm46466159043928"/><a data-type="indexterm" data-primary="resizing" data-secondary="filesystems" data-startref="resize-filesystem" id="idm46466159042840"/>well maintained.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466159040632">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a></p>
</li>
<li>
<p><em>man 8 resize2fs</em></p>
</li>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><em>man 8 xfs_growfs</em></p>
</li>
<li>
<p><em>man 8 btrfs</em></p>
</li>
<li>
<p><em>man 8 fsck.vfat</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="8.9 Shrinking a Partition"><div class="sect1" id="rec-shrink-partition">
<h1>8.9 Shrinking a Partition</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466159031384">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="shrinking" id="parted-shrink"/><a data-type="indexterm" data-primary="partitions" data-secondary="shrinking" id="partition-shrink"/><a data-type="indexterm" data-primary="shrinking" data-secondary="partitions" id="shrink-partition"/><a data-type="indexterm" data-primary="filesystems" data-secondary="shrinking" id="filesystem-shrink"/><a data-type="indexterm" data-primary="shrinking" data-secondary="filesystems" id="shrink-filesystem"/>have a partition with a filesystem on it, and you want to shrink it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466159023096">
<h2>Solution</h2>

<p>XFS filesystems cannot be reduced in size, only increased. You can shrink
Ext4, Btrfs, and FAT16/32. Ext4 and FAT16/32 must be unmounted before shrinking
them. Btrfs can be shrunken online, but it is safer to unmount it first.</p>

<p>Make sure that the used portion of the filesystem you want to shrink is smaller
than the size you want to shrink it to. Use <a data-type="indexterm" data-primary="du command" id="idm46466159018776"/>the <em>du</em> command to see how much
space your files occupy:</p>
<pre>$ <strong>du -sh /media/duchess/shrinkme</strong>
922.6M    /media/duchess/shrinkme</pre>

<p>You should allow about 40% extra room for metadata, wasted block space, and
for just in case, so in this example the new size should not be smaller than
1.4 GB. If you need room to add more files, then account for that as well.</p>

<p>Shrinking partitions is a little more complicated than expanding them. There
are more steps, and the filesystems must be shrunk offline. If the partition is
on an external storage device, such as a USB stick, unmount it and then shrink
it. If it is a partition that belongs to your running system, then you must run
<em>parted</em> from a bootable rescue disk, or a second Linux on a multiboot system,
so that you can unmount the filesystem you want to shrink.</p>

<p>After your selected filesystem is unmounted, follow these steps:</p>

<ul>
<li>
<p>Run a filesystem check</p>
</li>
<li>
<p>Shrink the filesystem</p>
</li>
<li>
<p>Shrink the partition</p>
</li>
</ul>

<p>Run the following command to check the health of an Ext4 filesystem:</p>
<pre>$ <strong>sudo e2fsck -f /dev/sdc2</strong></pre>

<p>Check a Btrfs filesystem:</p>
<pre>$ <strong>sudo btrfs check /dev/sdc2</strong></pre>

<p>Check a FAT16/32 filesystem:</p>
<pre>$ <strong>sudo fsck.vfat -v /dev/sdc2</strong></pre>

<p>When everything checks out, shrink your filesystem. The examples in <a data-type="xref" href="#cmd-decrease-fs-size">Table 8-3</a>
shrink the filesystems to 2000 MB.</p>
<table id="cmd-decrease-fs-size">
<caption><span class="label">Table 8-3. </span>Commands to decrease filesystem sizes</caption>
<thead>
<tr>
<th>Filesystem</th>
<th>Resize command</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Ext4</p></td>
<td><p>sudo resize2fs /dev/sd<em>c2</em> 2g</p></td>
</tr>
<tr>
<td><p>Btrfs</p></td>
<td><p>sudo btrfs filesystem resize 2g /dev/sd<em>c2</em></p></td>
</tr>
<tr>
<td><p>FAT16/32</p></td>
<td><p>sudo fatresize -s 2G  /dev/sd<em>c2</em></p></td>
</tr>
</tbody>
</table>

<p>Now you can shrink your partition to match the filesystem size. Open the
<em>parted</em> shell to your device and then run<a data-type="indexterm" data-primary="resize command" id="idm46466158997176"/> the <em>resize</em> command. Specify the
partition number and the end point:</p>
<pre>(parted) <strong>resizepart 1 2000MB</strong>
Warning: Shrinking a partition can cause data loss, are you sure you want to
continue?
Yes/No? <strong>y</strong></pre>

<p>Check your work by printing the partition table in <em>parted</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466159022472">
<h2>Discussion</h2>

<p>Storage media is large and cheap. In the olden days, fiddling with partitions
was necessary for cramming the most files onto a disk. Now we have the luxury
of customizing their sizes for our <a data-type="indexterm" data-primary="parted command" data-secondary="partitions" data-tertiary="shrinking" data-startref="parted-shrink" id="idm46466158992712"/><a data-type="indexterm" data-primary="partitions" data-secondary="shrinking" data-startref="partition-shrink" id="idm46466158991384"/><a data-type="indexterm" data-primary="shrinking" data-secondary="partitions" data-startref="shrink-partition" id="idm46466158990296"/><a data-type="indexterm" data-primary="filesystems" data-secondary="shrinking" data-startref="filesystem-shrink" id="idm46466158988808"/><a data-type="indexterm" data-primary="shrinking" data-secondary="filesystems" data-startref="shrink-filesystem" id="idm46466158987624"/>convenience.</p>
</div></section>













<section data-type="sect2" class="pagebreak-before less_space" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466158985304">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch11.xhtml#cha-create-filesystems">Chapter 11</a></p>
</li>
<li>
<p><em>man 8 resize2fs</em></p>
</li>
<li>
<p><em>man 8 parted</em></p>
</li>
<li>
<p><em>man 8 btrfs</em></p>
</li>
<li>
<p><em>man 8 fsck.vfat</em></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>