<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 12. React.js Design Patterns"><div class="chapter" id="reactjs-design-patterns">
<h1><span class="label">Chapter 12. </span>React.js Design Patterns</h1>


<p>Over the years, there has been an increased<a data-type="indexterm" data-primary="React (React.js)" data-secondary="about" id="idm45017690368640"/><a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="React" data-see="React (React.js)" id="idm45017690367792"/> demand for straightforward ways to compose UIs using JavaScript. Frontend developers look for out-of-the-box solutions provided by many different libraries and frameworks. React’s popularity in this area has persevered for a long time now since its original release in 2013. This chapter will look at design patterns that are helpful in the React universe.</p>

<p><a href="https://oreil.ly/7Z-65">React</a>, also referred to as React.js, is an open source JavaScript library designed by Facebook to build UIs or UI components. It is, of course, not the only UI library out there.<a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="Preact" id="idm45017690365264"/><a data-type="indexterm" data-primary="Preact" id="idm45017690364416"/><a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="Vue" id="idm45017690363744"/><a data-type="indexterm" data-primary="Vue" id="idm45017690362832"/><a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="Angular" id="idm45017690362160"/><a data-type="indexterm" data-primary="Angular" id="idm45017690361248"/><a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="Svelte" id="idm45017690360576"/><a data-type="indexterm" data-primary="Svelte" id="idm45017690359664"/><a data-type="indexterm" data-primary="UIs composed using JavaScript" data-secondary="Lit" id="idm45017690358992"/><a data-type="indexterm" data-primary="Lit" id="idm45017690358032"/> <a href="https://oreil.ly/jXmKM">Preact</a>, <a href="https://oreil.ly/fMoMp">Vue</a>, <a href="https://oreil.ly/G_Oyv">Angular</a>, <a href="https://oreil.ly/scSoT">Svelte</a>, <a href="https://oreil.ly/5UgxC">Lit</a>, and many others are also great for composing interfaces from reusable elements. Given React’s popularity, however, we have chosen it for our discussion on design patterns for the current decade.</p>






<section data-type="sect1" data-pdf-bookmark="An Introduction to React"><div class="sect1" id="introduction-to-react">
<h1>An Introduction to React</h1>

<p>When frontend developers talk about code,<a data-type="indexterm" data-primary="React (React.js)" data-secondary="introduction to" id="idm45017690352112"/> it’s most often in the context of designing interfaces for the web. And the way we think of interface composition is in elements like buttons, lists, navigation, etc. React provides an optimized and simplified way of expressing interfaces in these elements. It also helps build complex and tricky interfaces by organizing your interface into three key concepts: components, props, and state.</p>

<p>Because React is composition-focused, it can perfectly map to the elements of your design system. <a data-type="indexterm" data-primary="componentization" id="idm45017690350512"/>So, designing for React rewards you for thinking in a modular way. It allows you to develop individual components before putting together a page or view so that you fully understand each component’s scope and purpose—a process referred to as componentization.</p>








<section data-type="sect2" data-pdf-bookmark="Terminology Used"><div class="sect2" id="idm45017690349552">
<h2>Terminology Used</h2>

<p>We will use the following terms frequently in this chapter. Let’s quickly look at what each of them means:<a data-type="indexterm" data-primary="React (React.js)" data-secondary="introduction to" data-tertiary="terminology" id="idm45017690348128"/></p>
<dl>
<dt>React/React.js/ReactJS</dt>
<dd>
<p>React library, created by Facebook in 2013</p>
</dd>
<dt>ReactDOM</dt>
<dd>
<p>The <code>react-dom</code> package providing DOM-specific methods for client and server rendering<a data-type="indexterm" data-primary="DOM" data-secondary="ReactDOM" id="idm45017690343200"/></p>
</dd>
<dt>JSX</dt>
<dd>
<p>Syntax extension to JavaScript</p>
</dd>
<dt>Redux</dt>
<dd>
<p>Centralized state container<a data-type="indexterm" data-primary="Redux" data-secondary="centralized state container library" id="idm45017690339584"/></p>
</dd>
<dt>Hooks</dt>
<dd>
<p>A new way to use state and other React features without writing a class<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="about" data-tertiary="definition" id="idm45017690337264"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="about" data-tertiary="definition" id="idm45017690336016"/></p>
</dd>
<dt>ReactNative</dt>
<dd>
<p>The library to develop cross-platform native apps with JavaScript<a data-type="indexterm" data-primary="ReactNative" id="idm45017690333520"/></p>
</dd>
<dt>webpack</dt>
<dd>
<p>JavaScript module bundler, popular in React community<a data-type="indexterm" data-primary="webpack" id="idm45017690331472"/></p>
</dd>
<dt>Single-page application (SPA)</dt>
<dd>
<p>A web app that loads new content on the same page without a full page refresh/reload.<a data-type="indexterm" data-primary="single-page applications (SPA)" id="idm45017690329520"/><a data-type="indexterm" data-primary="SPA (single-page applications)" id="idm45017690328752"/></p>
</dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Basic Concepts"><div class="sect2" id="idm45017690327808">
<h2>Basic Concepts</h2>

<p>Before we discuss React design patterns, it would be helpful to understand some basic concepts used in React:<a data-type="indexterm" data-primary="React (React.js)" data-secondary="introduction to" data-tertiary="basic concepts" id="ch11-basic"/></p>
<dl>
<dt>JSX</dt>
<dd>
<p>JSX is an extension to JavaScript<a data-type="indexterm" data-primary="JSX (JavaScript Syntax Extension)" id="idm45017690322864"/> that embeds template HTML in JS using XML-like syntax. It is meant to be transformed into valid JavaScript, though the semantics of that transformation are implementation-specific. JSX rose to popularity with the React library but has also seen other implementations.</p>
</dd>
<dt>Components</dt>
<dd>
<p>Components are the building blocks<a data-type="indexterm" data-primary="React (React.js)" data-secondary="components" id="idm45017690320784"/> of any React app. They are like JavaScript functions that accept arbitrary input (Props) and return React elements describing what should be displayed on the screen. Everything on screen in a React app is part of a component. Essentially, a React app is just components within 
<span class="keep-together">components</span> within components. So developers don’t build pages in React; they build components. Components let you split your UI into independent, reusable pieces. If you’re used to designing pages, thinking from a component perspective might seem like a significant change. But if you use a design system or style guide, this might be a smaller paradigm shift than it looks.</p>
</dd>
<dt>Props</dt>
<dd>
<p>Props are a short form for properties,<a data-type="indexterm" data-primary="React (React.js)" data-secondary="props" id="idm45017690317664"/> and they refer to the internal data of a component in React. They are written inside component calls and are passed into components. They also use the same syntax as HTML attributes, e.g., <code>prop = value</code>. Two things worth remembering about props are: (1) we determine the value of a prop and use it as part of the blueprint before the component is built, and (2) the value of a prop will never change, i.e., props are read-only once passed into components. You access a prop by referencing it via the <code>this.props</code> property that every component can access.</p>
</dd>
<dt>State</dt>
<dd>
<p>State is an object that holds information<a data-type="indexterm" data-primary="React (React.js)" data-secondary="state management" data-tertiary="State object" id="idm45017690314320"/> that may change over the component’s lifetime. It is the current snapshot of data stored in a component’s props. The data can change over time, so techniques to manage  data changes become necessary to ensure the component looks the way engineers want it to, at just the right time—this is called state management.</p>
</dd>
<dt>Client-side rendering</dt>
<dd>
<p>In client-side rendering (CSR), the<a data-type="indexterm" data-primary="client-side rendering (CSR)" data-secondary="React" id="idm45017690311616"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="client-side rendering" id="idm45017690310576"/><a data-type="indexterm" data-primary="CSR (client-side rendering)" data-secondary="React" id="idm45017690309360"/><a data-type="indexterm" data-primary="single-page applications (SPA)" data-secondary="via client-side rendering" id="idm45017690308400"/><a data-type="indexterm" data-primary="Rendering patterns" data-secondary="client-side rendering" data-tertiary="React" id="idm45017690307424"/><a data-type="indexterm" data-primary="SPA (single-page applications)" data-secondary="via client-side rendering" id="idm45017690306208"/> server renders only the bare bones HTML container for a page. The logic, data fetching, templating, and routing required to display content on the page are handled by JavaScript code that executes on the client. CSR became popular as a method of building SPAs. It helped to blur the difference between websites and installed applications and works best for highly interactive applications. With React by default, most of the application logic is executed on the client. It interacts with the server through API calls to fetch or save data.</p>
</dd>
<dt>Server-side rendering</dt>
<dd>
<p>SSR is one of the oldest methods<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="server-side rendering" id="idm45017690303824"/><a data-type="indexterm" data-primary="server-side rendering (SSR)" data-secondary="React" id="idm45017690302576"/><a data-type="indexterm" data-primary="SSR (server-side rendering)" data-secondary="React" id="idm45017690301568"/> of rendering web content. SSR generates the complete HTML for the page content to be rendered in response to a user request. The content may include data from a data store or external API. React can be rendered isomorphically, which means that it can function both on the browser and other platforms like the server. Thus, UI elements may be rendered on the server using React.</p>
</dd>
</dl>
<dl class="less_space pagebreak-before">
<dt>Hydration</dt>
<dd>
<p>In a server-rendered application,<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="hydration" id="idm45017690298464"/><a data-type="indexterm" data-primary="hydration" id="idm45017690297216"/> HTML for the current navigation is generated on the server and sent to the client. Since the server generated the markup, the client can quickly parse this and display it on the screen. The JavaScript required to make the UI interactive is loaded after this. The event handlers that will make UI elements like buttons interactive get attached only once the JavaScript bundle is loaded and processed. This process is called hydration. React checks the current DOM nodes and hydrates them with the corresponding JavaScript.</p>
</dd>
<dt>Creating a new app</dt>
<dd>
<p>Older documentation suggests<a data-type="indexterm" data-primary="Create React App (CRA)" id="idm45017690295088"/> using Create React App (CRA) to build a new client-only SPA for learning React. It is a CLI tool to create a scaffolding React app for bootstrapping a project. However, CRA offers a restricted development experience, which is too limiting for many modern web applications. React recommends using a production-grade React-powered framework such as Next.js or Remix to build new web apps or websites. These frameworks provide features that most apps and sites eventually need, such as static HTML generation, file-based routing, SPA navigations, and real client code.</p>
</dd>
</dl>

<p>React has evolved over the years. Different features introduced to the library gave rise to various ways of solving common problems. Here are some popular design patterns for React that we will look into in detail in the following sections:<a data-type="indexterm" data-startref="ch11-basic" id="idm45017690293616"/></p>

<ul>
<li>
<p><a data-type="xref" href="#higher-order-components">“Higher-Order Components”</a></p>
</li>
<li>
<p><a data-type="xref" href="#render-props-pattern">“Render Props Pattern”</a></p>
</li>
<li>
<p><a data-type="xref" href="#hooks-pattern">“Hooks Pattern”</a></p>
</li>
<li>
<p><a data-type="xref" href="#static-import">“Static Import”</a></p>
</li>
<li>
<p><a data-type="xref" href="#dynamic-import">“Dynamic Import”</a></p>
</li>
<li>
<p><a data-type="xref" href="#code-splitting">“Code-Splitting”</a></p>
</li>
<li>
<p><a data-type="xref" href="#prpl-pattern">“PRPL Pattern”</a></p>
</li>
<li>
<p><a data-type="xref" href="#loading-prioritization">“Loading Prioritization”</a></p>
</li>
</ul>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Higher-Order Components"><div class="sect1" id="higher-order-components">
<h1>Higher-Order Components</h1>

<p>We may often want to use the same logic<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="Higher Order Component pattern" id="ch12-hoc"/><a data-type="indexterm" data-primary="Higher Order Component pattern" id="ch12-hoc2"/> in multiple components within our application. This logic can include applying specific styling to components, requiring authorization, or adding a global state. One way to reuse the same logic in multiple components is by using the Higher-Order Component (HOC) pattern. This pattern allows us to reuse component logic throughout our application.</p>

<p>An HOC is a<a data-type="indexterm" data-primary="Higher-Order Components (HOCs)" id="idm45017690275840"/><a data-type="indexterm" data-primary="Higher Order Component pattern" data-secondary="about Higher-Order Components" id="idm45017690275136"/> component that receives another component. The HOC can contain a specific feature that can be applied to a component we pass to it as a parameter. The HOC returns the component with the additional feature applied to it.</p>

<p>Say that we always wanted to add particular styling to multiple components in our application. Instead of creating a style object locally each time, we can create an HOC that adds the style objects to the component it received as a parameter:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Component</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">style</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">padding</code><code class="o">:</code> <code class="s1">'0.2rem'</code><code class="p">,</code> <code class="nx">margin</code><code class="o">:</code> <code class="s1">'1rem'</code> <code class="p">}</code>
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Component</code> <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">Button</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=</code> <code class="o">&lt;</code><code class="nx">button</code><code class="o">&gt;</code><code class="nx">Click</code> <code class="nx">me</code><code class="o">!&lt;</code><code class="err">/button&gt;</code>
<code class="kr">const</code> <code class="nx">Text</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Hello</code> <code class="nx">World</code><code class="o">!&lt;</code><code class="err">/p&gt;</code>

<code class="kr">const</code> <code class="nx">StyledButton</code> <code class="o">=</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Button</code><code class="p">)</code>
<code class="kr">const</code> <code class="nx">StyledText</code> <code class="o">=</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Text</code><code class="p">)</code></pre>

<p>We just created a <code>StyledButton</code> and <code>StyledText</code> component, the modified versions of the <code>Button</code> and <code>Text</code> component. They now both contain the style that got added in the <code>withStyles</code> HOC.</p>

<p>To take it further, let us look at an application that renders a list of dog images fetched from an API. <a data-type="indexterm" data-primary="React (React.js)" data-secondary="“Loading…​” screen" data-secondary-sortas="Loading" id="idm45017690184576"/><a data-type="indexterm" data-primary="“Loading…​” screen via React" data-primary-sortas="Loading" id="idm45017690183360"/>When fetching the data, we want to show the user a “Loading…​” screen. Instead of adding it to the <code>DogImages</code> component directly, we can use an HOC that adds this logic.</p>

<p>Let’s create an HOC called <code>withLoader</code>. An HOC should receive a component and return that component. In this case, the <code>withLoader</code> HOC should receive the element which should display <code>Loading…</code> until the data is fetched. To make the <code>withLoader</code> HOC very reusable, we won’t hardcode the Dog API URL in that component. Instead, we can pass the URL as an argument to the <code>withLoader</code> HOC, so this loader can be used on any component that needs a loading indicator while fetching data from a different API endpoint:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">withLoader</code><code class="p">(</code><code class="nx">Element</code><code class="p">,</code> <code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{};</code>
<code class="p">}</code></pre>

<p>An HOC returns an element, a functional component <code>props ⇒ {}</code> in this case, to which we want to add the logic that allows us to display a text with <code>Loading…</code> as the data is still being fetched. Once the data has been fetched, the component should pass the fetched data as a prop. The complete code for <code>withLoader</code> looks like this:</p>

<pre data-type="programlisting" data-code-language="javascript" class="pagebreak-before"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code><code class="p">,</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>

<code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">withLoader</code><code class="p">(</code><code class="nx">Element</code><code class="p">,</code> <code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">[</code><code class="nx">data</code><code class="p">,</code> <code class="nx">setData</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>

    <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="nx">async</code> <code class="kd">function</code> <code class="nx">getData</code><code class="p">()</code> <code class="p">{</code>
        <code class="kr">const</code> <code class="nx">res</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
        <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
        <code class="nx">setData</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
      <code class="p">}</code>

      <code class="nx">getData</code><code class="p">();</code>
    <code class="p">},</code> <code class="p">[]);</code>

    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">return</code> <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/div&gt;;</code>
    <code class="p">}</code>

    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Element</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>
  <code class="p">};</code>
<code class="p">}</code></pre>

<p>We just created an HOC that can receive any component and URL:</p>

<ul>
<li>
<p>In the <code>useEffect</code> hook, the <code>withLoader</code> HOC fetches<a data-type="indexterm" data-primary="Higher Order Component pattern" data-secondary="useEffect hook" id="idm45017689976752"/> the data from the API endpoint that we pass as the value of <code>url</code>. While the data is being fetched, we return the element containing the <code>Loading…​</code> text.</p>
</li>
<li>
<p>Once the data has been fetched, we set data equal to the data that has been fetched. Since data is no longer <code>null</code>, we can display the element that we passed to the HOC.</p>
</li>
</ul>

<p>Now to show the <code>Loading…​</code> indicator on the <code>DogImages</code> list, we will export the 
<span class="keep-together">“wrapped”</span> <code>withLoading</code> HOC around the <code>DogImages</code> component. The <code>withLoader</code> HOC also expects the <code>url</code> to know which endpoint to fetch the data from. In this case, we want to add the Dog API endpoint. Since the <code>withLoader</code> HOC returned the element with an extra data prop, <code>DogImages</code> in this case, we can access the data prop in the <code>DogImages</code> component:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">withLoader</code> <code class="nx">from</code> <code class="s2">"./withLoader"</code><code class="p">;</code>

<code class="kd">function</code> <code class="nx">DogImages</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">props</code><code class="p">.</code><code class="nx">data</code><code class="p">.</code><code class="nx">message</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">dog</code><code class="p">,</code> <code class="nx">index</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">dog</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Dog"</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">index</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="p">));</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">withLoader</code><code class="p">(</code>
  <code class="nx">DogImages</code><code class="p">,</code>
  <code class="s2">"https://dog.ceo/api/breed/labrador/images/random/6"</code>
<code class="p">);</code></pre>

<p>The HOC pattern allows us to provide the same logic to multiple components while keeping all the logic in one place. The <code>withLoader</code> HOC doesn’t care about the component or URL it receives; as long as it’s a valid component and a valid API endpoint, it’ll simply pass the data from that API endpoint to the component that we pass.<a data-type="indexterm" data-startref="ch12-hoc" id="idm45017689866928"/><a data-type="indexterm" data-startref="ch12-hoc2" id="idm45017689892672"/></p>








<section data-type="sect2" data-pdf-bookmark="Composing"><div class="sect2" id="idm45017689891904">
<h2>Composing</h2>

<p>We can also compose multiple HOCs.<a data-type="indexterm" data-primary="Higher Order Component pattern" data-secondary="multiple HOCs" id="idm45017689890368"/> Let’s say we also want to add functionality that shows a hovering text box when the user hovers over the <code>DogImages</code> list.</p>

<p>We must create a HOC that provides a hovering prop to the element we pass. Based on that prop, we can conditionally render the text box based on whether the user is hovering over the <code>DogImages</code> list.</p>

<p>We can now wrap the <code>withHover</code> HOC around the <code>withLoader</code> HOC:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">export</code> <code class="k">default</code> <code class="nx">withHover</code><code class="p">(</code>
  <code class="nx">withLoader</code><code class="p">(</code><code class="nx">DogImages</code><code class="p">,</code> <code class="s2">"https://dog.ceo/api/breed/labrador/images/random/6"</code><code class="p">)</code>
<code class="p">);</code></pre>

<p>The <code>DogImages</code> element now contains all props we passed from <code>withHover</code> and 
<span class="keep-together"><code>withLoader</code>.</span></p>

<p>We can also use the Hooks pattern<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="Hooks pattern" id="idm45017689830256"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="Higher Order Components pattern similar results" id="idm45017689829008"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="Higher Order Components pattern similar results" id="idm45017689828096"/> to achieve similar results in some cases. We will discuss this pattern in detail later in this chapter, but for now, let’s just say that using Hooks can reduce the depth of the component tree, while using the HOC pattern, it’s easy to end up with a deeply nested component tree. The best use cases for HOC are those where the following are true:</p>

<ul>
<li>
<p>The same uncustomized behavior needs to be used by many components throughout the application.</p>
</li>
<li>
<p>The component can work standalone without the added custom logic.</p>
</li>
</ul>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Pros"><div class="sect2" id="idm45017689824608">
<h2>Pros</h2>

<p>Using the HOC pattern allows us to keep<a data-type="indexterm" data-primary="Higher Order Component pattern" data-secondary="advantages and disadvantages" id="idm45017689798672"/> logic we want to reuse all in one place. This reduces the risk of accidentally spreading bugs throughout the application by duplicating code repeatedly, potentially introducing new bugs. By keeping the logic in one place, we can keep our code DRY and efficiently enforce the separation of concerns.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Cons"><div class="sect2" id="idm45017689797440">
<h2>Cons</h2>

<p>The prop’s name that a HOC can pass to an element can cause a naming collision. For example:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Component</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">style</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">padding</code><code class="o">:</code> <code class="s1">'0.2rem'</code><code class="p">,</code> <code class="nx">margin</code><code class="o">:</code> <code class="s1">'1rem'</code> <code class="p">}</code>
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Component</code> <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">Button</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=</code> <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">style</code><code class="o">=</code><code class="p">{{</code> <code class="nx">color</code><code class="o">:</code> <code class="s1">'red'</code> <code class="p">}}</code><code class="o">&gt;</code><code class="nx">Click</code> <code class="nx">me</code><code class="o">!&lt;</code><code class="err">/button&gt;</code>
<code class="kr">const</code> <code class="nx">StyledButton</code> <code class="o">=</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Button</code><code class="p">)</code></pre>

<p>In this case, the <code>withStyles</code> HOC adds a prop called <code>style</code> to the element we pass to it. However, the <code>Button</code> component already had a prop called <code>style</code>, which will be overwritten! Make sure the HOC can handle accidental name collision by either renaming or merging the props:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Component</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">style</code> <code class="o">=</code> <code class="p">{</code>
      <code class="nx">padding</code><code class="o">:</code> <code class="s1">'0.2rem'</code><code class="p">,</code>
      <code class="nx">margin</code><code class="o">:</code> <code class="s1">'1rem'</code><code class="p">,</code>
      <code class="p">...</code><code class="nx">props</code><code class="p">.</code><code class="nx">style</code>
    <code class="p">}</code>

    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Component</code> <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">Button</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=</code> <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">style</code><code class="o">=</code><code class="p">{{</code> <code class="nx">color</code><code class="o">:</code> <code class="s1">'red'</code> <code class="p">}}</code><code class="o">&gt;</code><code class="nx">Click</code> <code class="nx">me</code><code class="o">!&lt;</code><code class="err">/button&gt;</code>
<code class="kr">const</code> <code class="nx">StyledButton</code> <code class="o">=</code> <code class="nx">withStyles</code><code class="p">(</code><code class="nx">Button</code><code class="p">)</code></pre>

<p>When using multiple composed HOCs that all pass props to the element wrapped within them, it can be challenging to figure out which HOC is responsible for which prop. This can hinder debugging and scaling an application easily.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Render Props Pattern"><div class="sect1" id="render-props-pattern">
<h1>Render Props Pattern</h1>

<p>In the section on HOCs, we saw that reusing<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="Render Props pattern" id="ch12-rop"/><a data-type="indexterm" data-primary="Render Props pattern" id="ch12-rop2"/> component logic can be convenient if multiple components need access to the same data or contain the same logic.</p>

<p>Another way of making components reusable is by using the Render Prop pattern. <a data-type="indexterm" data-primary="Render Props pattern" data-secondary="about render props" id="idm45017689600096"/><a data-type="indexterm" data-primary="JSX (JavaScript Syntax Extension)" data-secondary="render props returning JSX elements" id="idm45017689599120"/>A render prop is a prop on a component whose value is a function that returns a JSX element. The component itself does not render anything besides the render prop. It simply calls the render prop instead of implementing its own rendering logic.</p>

<p>Imagine that we have a <code>Title</code> component that should just render the value we pass. We can use a render prop for this. Let’s pass the value we want the <code>Title</code> component to render to the render prop:</p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">Title</code> <code class="na">render</code><code class="o">=</code><code class="s">{()</code> <code class="err">=</code><code class="p">&gt;</code> <code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code>I am a render prop!<code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code>} /&gt;</pre>

<p>We can render this data within the <code>Title</code> component by returning the invoked render prop:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">Title</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="nx">props</code><code class="p">.</code><code class="nx">render</code><code class="p">();</code></pre>

<p>We have to pass a prop called <code>render</code> to the Component element, which is a function that returns a React element:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">render</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react-dom"</code><code class="p">;</code>

<code class="kr">import</code> <code class="s2">"./styles.css"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">Title</code> <code class="o">=</code> <code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">props</code><code class="p">.</code><code class="nx">render</code><code class="p">();</code>

<code class="nx">render</code><code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Title</code>
      <code class="nx">render</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">role</code><code class="o">=</code><code class="s2">"img"</code> <code class="nx">aria</code><code class="o">-</code><code class="nx">label</code><code class="o">=</code><code class="s2">"emoji"</code><code class="o">&gt;</code>
            <code class="err">✨</code>
          <code class="o">&lt;</code><code class="err">/span&gt;</code>
          <code class="nx">I</code> <code class="nx">am</code> <code class="nx">a</code> <code class="nx">render</code> <code class="nx">prop</code><code class="o">!</code><code class="p">{</code><code class="s2">" "</code><code class="p">}</code>
          <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">role</code><code class="o">=</code><code class="s2">"img"</code> <code class="nx">aria</code><code class="o">-</code><code class="nx">label</code><code class="o">=</code><code class="s2">"emoji"</code><code class="o">&gt;</code>
            <code class="err">✨</code>
          <code class="o">&lt;</code><code class="err">/span&gt;</code>
        <code class="o">&lt;</code><code class="err">/h1&gt;</code>
      <code class="p">)}</code>
    <code class="o">/&gt;</code>
  <code class="o">&lt;</code><code class="err">/div&gt;,</code>
  <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"root"</code><code class="p">)</code>
<code class="p">);</code></pre>

<p>The cool thing about render props is that the component receiving the prop is reusable. We can use it multiple times, passing different values to the render prop each time.</p>

<p>Although they’re called render props,<a data-type="indexterm" data-primary="Render Props pattern" data-secondary="about render props" id="idm45017689335600"/><a data-type="indexterm" data-primary="JSX (JavaScript Syntax Extension)" data-secondary="render props returning JSX elements" id="idm45017689475360"/> a render prop doesn’t have to be called render. Any prop that renders JSX is considered a render prop. Thus we have three render props in the following example:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">Title</code> <code class="o">=</code> <code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;&gt;</code>
    <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">renderFirstComponent</code><code class="p">()}</code>
    <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">renderSecondComponent</code><code class="p">()}</code>
    <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">renderThirdComponent</code><code class="p">()}</code>
  <code class="o">&lt;</code><code class="err">/&gt;</code>
<code class="p">);</code>

<code class="nx">render</code><code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Title</code>
      <code class="nx">renderFirstComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">First</code> <code class="nx">render</code> <code class="nx">prop</code><code class="o">!&lt;</code><code class="err">/h1&gt;}</code>
      <code class="nx">renderSecondComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code> <code class="nx">Second</code> <code class="nx">render</code> <code class="nx">prop</code><code class="o">!&lt;</code><code class="err">/h2&gt;}</code>
      <code class="nx">renderThirdComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="nx">Third</code> <code class="nx">render</code> <code class="nx">prop</code><code class="o">!&lt;</code><code class="err">/h3&gt;}</code>
    <code class="err">/&gt;</code>
  <code class="o">&lt;</code><code class="err">/div&gt;,</code>
  <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"root"</code><code class="p">)</code>
<code class="p">);</code></pre>

<p>We’ve just seen that we can use render props to make a component reusable, as we can pass different data to the render prop each time.</p>

<p>A component that takes a render prop usually does much more than simply invoking the render prop. Instead, we typically want to pass data from the component that takes the render prop to the element we pass as a render prop:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Component</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>

  <code class="k">return</code> <code class="nx">props</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>
<code class="p">}</code></pre>

<p>The render prop can now receive this value that we passed as its argument:</p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">Component</code> <code class="na">render</code><code class="o">=</code><code class="s">{data</code> <code class="err">=</code><code class="p">&gt;</code> <code class="p">&lt;</code><code class="nt">ChildComponent</code> <code class="na">data</code><code class="o">=</code><code class="s">{data}</code> <code class="p">/&gt;</code>}</pre>








<section data-type="sect2" data-pdf-bookmark="Lifting State"><div class="sect2" id="idm45017689173120">
<h2>Lifting State</h2>

<p>Before we look at another use case<a data-type="indexterm" data-primary="Render Props pattern" data-secondary="lifting state" id="idm45017689165056"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="state management" data-tertiary="lifting state" id="idm45017689164080"/> for the Render Props pattern, let’s understand the concept of “Lifting state up” in React.</p>

<p>Let’s say we have a temperature converter where you can provide the input in Celsius in one stateful input element. The corresponding <code>Fahrenheit</code> and <code>Kelvin</code> values are reflected instantly in two other components. For the input element to be able to share its state with other components, we will have to move the state up to the closest common ancestor of the components that need it. This is called “Lifting state up”:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Input</code><code class="p">({</code> <code class="nx">value</code><code class="p">,</code> <code class="nx">handleChange</code> <code class="p">})</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">handleChange</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code> <code class="o">/&gt;</code><code class="p">;</code>
<code class="p">}</code>
<code class="kd">function</code> <code class="nx">Kelvin</code><code class="p">({</code> <code class="nx">value</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">})</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"temp"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">value</code> <code class="o">+</code> <code class="mf">273.15</code><code class="p">}</code><code class="nx">K</code><code class="o">&lt;</code><code class="err">/div&gt;;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">Fahrenheit</code><code class="p">({</code> <code class="nx">value</code> <code class="o">=</code> <code class="mi">0</code> <code class="p">})</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"temp"</code><code class="o">&gt;</code><code class="p">{(</code><code class="nx">value</code> <code class="o">*</code> <code class="mi">9</code><code class="p">)</code> <code class="o">/</code> <code class="mi">5</code> <code class="o">+</code> <code class="mi">32</code><code class="p">}</code><code class="err">°</code><code class="nx">F</code><code class="o">&lt;</code><code class="err">/div&gt;;</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">value</code><code class="p">,</code> <code class="nx">setValue</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Temperature</code> <code class="nx">Converter</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
      <code class="o">&lt;</code><code class="nx">Input</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="nx">handleChange</code><code class="o">=</code><code class="p">{</code><code class="nx">setValue</code><code class="p">}</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">Kelvin</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">Fahrenheit</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>Lifting state is a valuable React state management pattern because sometimes we want a component to be able to share its state with sibling components. In the case of small applications with a few components, we can avoid using a state management library like Redux or React Context and use this pattern instead to lift the state up to the closest common ancestor.</p>

<p>Although this is a valid solution, lifting the state in larger applications with components that handle many children can be tricky. Each state change could cause a re-render of all the children, even those that don’t handle the data, which could negatively affect your app’s performance. We can use the Render Props pattern to work around this problem. We will change the <code>Input</code> component such that it can receive render props:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Input</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">value</code><code class="p">,</code> <code class="nx">setValue</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code>
        <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code>
        <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Temp in °C"</code>
      <code class="o">/&gt;</code>
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">value</code><code class="p">)}</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Temperature</code> <code class="nx">Converter</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
      <code class="o">&lt;</code><code class="nx">Input</code>
        <code class="nx">render</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code> <code class="o">=&gt;</code> <code class="p">(</code>
          <code class="o">&lt;&gt;</code>
            <code class="o">&lt;</code><code class="nx">Kelvin</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
            <code class="o">&lt;</code><code class="nx">Fahrenheit</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="err">/&gt;</code>
        <code class="p">)}</code>
      <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Children as a Function"><div class="sect2" id="idm45017689021936">
<h2>Children as a Function</h2>

<p>Besides regular JSX components,<a data-type="indexterm" data-primary="Render Props pattern" data-secondary="children as a function" id="idm45017689020560"/><a data-type="indexterm" data-primary="Render Props pattern" data-secondary="about render props" data-tertiary="children prop" id="idm45017689019584"/> we can pass functions as children to React components. This function is available to us through the children prop, which is technically also a render prop.</p>

<p>Let’s change the <code>Input</code> component. Instead of explicitly passing the render prop, we’ll pass a function as a child for the <code>Input</code> component:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Temperature</code> <code class="nx">Converter</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
      <code class="o">&lt;</code><code class="nx">Input</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">value</code> <code class="o">=&gt;</code> <code class="p">(</code>
          <code class="o">&lt;&gt;</code>
            <code class="o">&lt;</code><code class="nx">Kelvin</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
            <code class="o">&lt;</code><code class="nx">Fahrenheit</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code> <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="err">/&gt;</code>
        <code class="p">)}</code>
      <code class="o">&lt;</code><code class="err">/Input&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>We have access to this function through the <code>props.children</code> prop that’s available on the <code>Input</code> component. Instead of calling <code>props.render</code> with the user input value, we’ll call <code>props.children</code> with the value of the user input:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Input</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">value</code><code class="p">,</code> <code class="nx">setValue</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">value</code><code class="p">}</code>
        <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">setValue</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code>
        <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Temp in °C"</code>
      <code class="o">/&gt;</code>
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">children</code><code class="p">(</code><code class="nx">value</code><code class="p">)}</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>This way, the <code>Kelvin</code> and <code>Fahrenheit</code> components have access to the value without worrying about the name of the render prop.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Pros"><div class="sect2" id="idm45017688620208">
<h2>Pros</h2>

<p>Sharing logic and data among several<a data-type="indexterm" data-primary="Render Props pattern" data-secondary="advantages" id="idm45017688618912"/> components is straightforward with the Render Props pattern. Components can be made reusable by using a render or children prop. Although the HOC pattern mainly solves the same issues, namely reusability and sharing data, the Render Props pattern solves some problems we could encounter using the HOC pattern.</p>

<p>The issue of naming collisions that we can run into by using the HOC pattern no longer applies by using the Render Props pattern since we don’t automatically merge props. We explicitly pass the props down to the child components with the value provided by the parent component.</p>

<p>Since we explicitly pass props, we solve the HOC’s implicit props issue. The props that should get passed down to the element are all visible in the render prop’s arguments list. This way, we know exactly where specific props come from. We can separate our app’s logic from rendering components through render props. The stateful component that receives a render prop can pass the data onto stateless components, which merely render the data.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Cons"><div class="sect2" id="idm45017688616752">
<h2>Cons</h2>

<p>React Hooks have mostly resolved<a data-type="indexterm" data-primary="Render Props pattern" data-secondary="disadvantages" id="idm45017688615424"/> the issues we tried to solve with render props. As Hooks changed how we can add reusability and data sharing to components, they can replace the Render Props pattern in many cases.</p>

<p>Since we can’t add lifecycle methods to a render prop, we can use it only on components that don’t need to alter the data they receive.<a data-type="indexterm" data-startref="ch12-rop" id="idm45017688613936"/><a data-type="indexterm" data-startref="ch12-rop2" id="idm45017688568448"/></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Hooks Pattern"><div class="sect1" id="hooks-pattern">
<h1>Hooks Pattern</h1>

<p>React 16.8 introduced a new feature called<a data-type="indexterm" data-primary="React (React.js)" data-secondary="Hooks" data-seealso="React Hooks (Hooks)" id="ch12-hook"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" id="ch12-hook2"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" id="ch12-hook3"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="about" id="idm45017688563328"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="about" id="idm45017688562384"/> <a href="https://oreil.ly/6qnHk">Hooks</a>. Hooks make it possible to use React state and lifecycle methods without using an ES2015 class component. Although Hooks is not necessarily a design pattern, Hooks plays a vital role in your application design. Hooks can replace many traditional design 
<span class="keep-together">patterns.</span></p>

<p>Let’s see how class components enabled the addition of state and lifecycle methods.</p>








<section data-type="sect2" data-pdf-bookmark="Class Components"><div class="sect2" id="idm45017688559488">
<h2>Class Components</h2>

<p>Before Hooks were introduced in React,<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="alternative to classes" data-tertiary="class components prior to Hooks" id="ch12-class"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="alternative to classes" data-tertiary="class components prior to Hooks" id="ch12-class2"/><a data-type="indexterm" data-primary="classes" data-secondary="React class components prior to Hooks" id="ch12-class3"/> we had to use class components to add state and lifecycle methods to components. A typical class component in React can look something like this:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">MyComponent</code> <code class="kr">extends</code> <code class="nx">React</code><code class="p">.</code><code class="nx">Component</code> <code class="p">{</code>
  <code class="c1">// Adding state and binding custom methods</code>
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
    <code class="kr">super</code><code class="p">()</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">customMethodOne</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">customMethodOne</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">customMethodTwo</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">customMethodTwo</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>
  <code class="p">}</code>

  <code class="c1">// Lifecycle Methods</code>
  <code class="nx">componentDidMount</code><code class="p">()</code> <code class="p">{</code> <code class="p">...}</code>
  <code class="nx">componentWillUnmount</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>

  <code class="c1">// Custom methods</code>
  <code class="nx">customMethodOne</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>
  <code class="nx">customMethodTwo</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>

  <code class="nx">render</code><code class="p">()</code> <code class="p">{</code> <code class="k">return</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}}</code>
<code class="p">}</code></pre>

<p>A class component can contain the following:</p>

<ul>
<li>
<p>A state in its constructor</p>
</li>
<li>
<p>Lifecycle methods such as <code>componentDidMount</code> and <code>componentWillUnmount</code> to perform side effects based on a component’s lifecycle</p>
</li>
<li>
<p>Custom methods to add extra logic to a class</p>
</li>
</ul>

<p>Although we can still use class components after the introduction of React Hooks, using class components can have some downsides. For example, consider the following example where a simple <code>div</code> functions as a button:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Button</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"btn"</code><code class="o">&gt;</code><code class="nx">disabled</code><code class="o">&lt;</code><code class="err">/div&gt;;</code>
<code class="p">}</code></pre>

<p>Instead of always displaying disabled, we want to change it to enabled and add some extra CSS styling to the button when the user clicks on it. To do that, we need to add state to the component to know whether the status is enabled or disabled. This means we’d have to refactor the functional component entirely and make it a class component that keeps track of the button’s state:</p>

<pre data-type="programlisting" data-code-language="javascript" class="pagebreak-before"><code class="kr">export</code> <code class="k">default</code> <code class="kr">class</code> <code class="nx">Button</code> <code class="kr">extends</code> <code class="nx">React</code><code class="p">.</code><code class="nx">Component</code> <code class="p">{</code>
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
    <code class="kr">super</code><code class="p">();</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">enabled</code><code class="o">:</code> <code class="kc">false</code> <code class="p">};</code>
  <code class="p">}</code>

  <code class="nx">render</code><code class="p">()</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">{</code> <code class="nx">enabled</code> <code class="p">}</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">;</code>
    <code class="kr">const</code> <code class="nx">btnText</code> <code class="o">=</code> <code class="nx">enabled</code> <code class="o">?</code> <code class="s2">"enabled"</code> <code class="o">:</code> <code class="s2">"disabled"</code><code class="p">;</code>

    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">div</code>
        <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="sb">`btn enabled-</code><code class="si">${</code><code class="nx">enabled</code><code class="si">}</code><code class="sb">`</code><code class="p">}</code>
        <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">({</code> <code class="nx">enabled</code><code class="o">:</code> <code class="o">!</code><code class="nx">enabled</code> <code class="p">})}</code>
      <code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">btnText</code><code class="p">}</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>In this example, the component is minimal, and refactoring didn’t need much effort. However, your real-life components probably consist of many more lines of code, making refactoring the component much more difficult.</p>

<p>Besides ensuring you don’t accidentally change any behavior while refactoring the component, you must also understand how ES2015+ classes work. Knowing how to refactor a component properly without accidentally changing the data flow can be challenging.<a data-type="indexterm" data-startref="ch12-class" id="idm45017688287632"/><a data-type="indexterm" data-startref="ch12-class2" id="idm45017688297392"/><a data-type="indexterm" data-startref="ch12-class3" id="idm45017688296752"/></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Restructuring"><div class="sect2" id="idm45017688558864">
<h2>Restructuring</h2>

<p>The standard way to share code among several<a data-type="indexterm" data-primary="classes" data-secondary="React class components prior to Hooks" data-tertiary="restructuring “wrapper hell”" id="idm45017688259520"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="alternative to classes" data-tertiary="restructuring “wrapper hell”" id="idm45017688258544"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="alternative to classes" data-tertiary="restructuring “wrapper hell”" id="idm45017688257456"/> components is using the HOC or Render Props pattern. Although both patterns are valid and using them is a good practice, adding those patterns at a later point in time requires you to restructure your application.</p>

<p>Besides restructuring your app, which is trickier the bigger your components are, having many wrapping components to share code among deeper nested components can lead to something that’s best referred to as a “wrapper hell.” It’s not uncommon to open your dev tools and see a structure similar to the following:</p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">WrapperOne</code><code class="p">&gt;</code>
  <code class="p">&lt;</code><code class="nt">WrapperTwo</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">WrapperThree</code><code class="p">&gt;</code>
      <code class="p">&lt;</code><code class="nt">WrapperFour</code><code class="p">&gt;</code>
        <code class="p">&lt;</code><code class="nt">WrapperFive</code><code class="p">&gt;</code>
          <code class="p">&lt;</code><code class="nt">Component</code><code class="p">&gt;</code>
            <code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code>Finally in the component!<code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code>
          <code class="p">&lt;/</code><code class="nt">Component</code><code class="p">&gt;</code>
        <code class="p">&lt;/</code><code class="nt">WrapperFive</code><code class="p">&gt;</code>
      <code class="p">&lt;/</code><code class="nt">WrapperFour</code><code class="p">&gt;</code>
    <code class="p">&lt;/</code><code class="nt">WrapperThree</code><code class="p">&gt;</code>
  <code class="p">&lt;/</code><code class="nt">WrapperTwo</code><code class="p">&gt;</code>
<code class="p">&lt;/</code><code class="nt">WrapperOne</code><code class="p">&gt;</code></pre>

<p>The wrapper hell can make it difficult to understand how data flows through your application, making it harder to figure out why unexpected behavior is happening.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Complexity"><div class="sect2" id="idm45017688238512">
<h2>Complexity</h2>

<p>As we add more logic to class components,<a data-type="indexterm" data-primary="classes" data-secondary="React class components prior to Hooks" data-tertiary="complexity" id="idm45017688229952"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="alternative to classes" data-tertiary="complexity" id="idm45017688228736"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="alternative to classes" data-tertiary="complexity" id="idm45017688227520"/> the size of the component increases fast. Logic within that component can get tangled and unstructured, making it difficult for developers to understand where certain logic is used in the class component. This can make debugging and optimizing performance more difficult. Lifecycle methods also require quite a lot of duplication in the code.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Hooks"><div class="sect2" id="idm45017688225920">
<h2>Hooks</h2>

<p>Class components aren’t always<a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="alternative to classes" id="idm45017688224624"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="alternative to classes" id="idm45017688223648"/><a data-type="indexterm" data-primary="classes" data-secondary="React class components prior to Hooks" data-tertiary="Hooks instead" id="idm45017688222704"/> a great feature in React. To solve the common issues that React developers can run into when using class components, React introduced React Hooks. React Hooks are functions you can use to manage a component’s state and lifecycle methods. React Hooks make it possible to:</p>

<ul>
<li>
<p>Add state to a functional component</p>
</li>
<li>
<p>Manage a component’s lifecycle without having to use lifecycle methods such as <code>componentDidMount</code> and <code>componentWillUnmount</code></p>
</li>
<li>
<p>Reuse the same stateful logic among multiple components throughout the app</p>
</li>
</ul>

<p>First, let’s look at how we can add state to a functional component using React Hooks.<a data-type="indexterm" data-startref="ch12-hook" id="idm45017688168512"/><a data-type="indexterm" data-startref="ch12-hook2" id="idm45017688167904"/><a data-type="indexterm" data-startref="ch12-hook3" id="idm45017688167296"/></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="State Hook"><div class="sect1" id="idm45017688166368">
<h1>State Hook</h1>

<p>React provides a Hook called <code>useState</code> that manages state within a functional<a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useState Hook" id="idm45017688164032"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useState Hook" id="idm45017688163056"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="state management" data-tertiary="useState Hook" id="idm45017688162112"/><a data-type="indexterm" data-primary="useState Hook (React)" id="idm45017688160896"/> 
<span class="keep-together">component.</span></p>

<p>Let’s see how a class component can be restructured into a functional component using the <code>useState</code> Hook. We have a class component called <code>Input</code>, which renders an input field. The value of input in the state updates whenever the user types anything in the input field:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">Input</code> <code class="kr">extends</code> <code class="nx">React</code><code class="p">.</code><code class="nx">Component</code> <code class="p">{</code>
  <code class="nx">constructor</code><code class="p">()</code> <code class="p">{</code>
    <code class="kr">super</code><code class="p">();</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">input</code><code class="o">:</code> <code class="s2">""</code> <code class="p">};</code>

    <code class="k">this</code><code class="p">.</code><code class="nx">handleInput</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">handleInput</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="nx">handleInput</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">({</code> <code class="nx">input</code><code class="o">:</code> <code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code> <code class="p">});</code>
  <code class="p">}</code>

  <code class="nx">render</code><code class="p">()</code> <code class="p">{</code>
    <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">handleInput</code><code class="p">}</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">input</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>To use the <code>useState</code> Hook, we need<a data-type="indexterm" data-primary="useState() method (React)" id="idm45017688154608"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="useState() method" id="idm45017688101392"/> to access React’s <code>useState</code> method. The 
<span class="keep-together"><code>useState</code></span> method expects an argument: this is the initial value of the state, an empty string in this case.</p>

<p>We can destructure two values from the <code>useState</code> method:</p>

<ul>
<li>
<p>The <em>current value</em> of the state</p>
</li>
<li>
<p>The <em>method with which we can update</em> the state:</p>
</li>
</ul>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="p">[</code><code class="nx">value</code><code class="p">,</code> <code class="nx">setValue</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="nx">initialValue</code><code class="p">);</code></pre>

<p>You can compare the first value to a class component’s <code>this.state.[value]</code>. The second value can be compared to a class component’s <code>this.setState</code> method.</p>

<p>Since we’re dealing with the value of an input, let’s call the current value of the state input and the method to update the state <code>setInput</code>. The initial value should be an empty string:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="p">[</code><code class="nx">input</code><code class="p">,</code> <code class="nx">setInput</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code></pre>

<p>We can now refactor the <code>Input</code> class component into a stateful functional 
<span class="keep-together">component:</span></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">Input</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">input</code><code class="p">,</code> <code class="nx">setInput</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">onChange</code><code class="o">=</code><code class="p">{(</code><code class="nx">e</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">setInput</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">input</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>The input field’s value is equal to the current value of the input state, just like in the class component example. When the user types in the input field, the value of the input state updates accordingly using the <code>setInput</code> method:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>

  <code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">Input</code><code class="p">()</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">[</code><code class="nx">input</code><code class="p">,</code> <code class="nx">setInput</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">setInput</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code>
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">input</code><code class="p">}</code>
        <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type something..."</code>
      <code class="o">/&gt;</code>
    <code class="p">);</code>
  <code class="p">}</code></pre>








<section data-type="sect2" data-pdf-bookmark="Effect Hook"><div class="sect2" id="idm45017687859856">
<h2>Effect Hook</h2>

<p>We’ve seen we can use<a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useEffect Hook" id="idm45017687836064"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useEffect Hook" id="idm45017687835056"/><a data-type="indexterm" data-primary="useEffect Hook (React)" id="idm45017687834112"/> the <code>useState</code> component to handle state within a functional component. Still, another benefit of class components was the possibility of adding lifecycle methods to a component.</p>

<p>With the <code>useEffect</code> Hook, we can “hook into” a component’s lifecycle. The 
<span class="keep-together"><code>useEffect</code></span> Hook effectively combines the <code>componentDidMount</code>, <code>componentDidUpdate</code>, and 
<span class="keep-together"><code>componentWillUnmount</code></span> lifecycle methods:<a data-type="indexterm" data-primary="componentDidMount() method" id="idm45017687789104"/><a data-type="indexterm" data-primary="componentDidUpdate() method" id="idm45017687788432"/><a data-type="indexterm" data-primary="componentWillUnmount() method" id="idm45017687787760"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">componentDidMount</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>
<code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="p">...</code> <code class="p">},</code> <code class="p">[])</code>

<code class="nx">componentWillUnmount</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>
<code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="k">return</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code> <code class="p">},</code> <code class="p">[])</code>

<code class="nx">componentDidUpdate</code><code class="p">()</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>
<code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="p">...</code> <code class="p">})</code></pre>

<p>Let’s use the input example we used in the state Hook section. Whenever the user is typing anything in the input field, the value should also be logged to the console.</p>

<p>We need a <code>useEffect</code> Hook that “listens” to the input value.<a data-type="indexterm" data-primary="useEffect Hook (React)" data-secondary="dependency array argument" id="idm45017687741344"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useEffect Hook" data-tertiary="dependency array argument" id="idm45017687740464"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useEffect Hook" data-tertiary="dependency array argument" id="idm45017687708912"/> We can do so by adding input to the dependency array of the <code>useEffect</code> Hook. The dependency array is the second argument that the <code>useEffect</code> Hook receives:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code><code class="p">,</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>

<code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">Input</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">input</code><code class="p">,</code> <code class="nx">setInput</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>

  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The user typed </code><code class="si">${</code><code class="nx">input</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
  <code class="p">},</code> <code class="p">[</code><code class="nx">input</code><code class="p">]);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">input</code>
      <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">setInput</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code>
      <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">input</code><code class="p">}</code>
      <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type something..."</code>
    <code class="o">/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>The value of the input now gets logged to the console whenever the user types a value.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Custom Hooks"><div class="sect2" id="idm45017687626064">
<h2>Custom Hooks</h2>

<p>Besides the built-in Hooks that React provides<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="about" data-tertiary="other built-in Hooks" id="idm45017687652496"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="about" data-tertiary="other built-in Hooks" id="idm45017687650864"/> (<code>useState</code>, <code>useEffect</code>, <code>useReducer</code>, <code>useRef</code>, <code>useContext</code>, <code>useMemo</code>, <code>useImperativeHandle</code>, <code>useLayoutEffect</code>, <code>useDebugValue</code>, <code>useCallback</code>), we can easily create our own custom Hooks.<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="custom Hooks" id="ch12-cushoo"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="custom Hooks" id="ch12-cushoo2"/></p>

<p>You may have noticed that all Hooks start with “use.” It’s essential to begin your Hooks with “use” for React to check if it violates the rules of Hooks.<a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="custom Hooks" data-tertiary="“use” prefix" data-tertiary-sortas="use prefix" id="idm45017687579792"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="custom Hooks" data-tertiary="“use” prefix" data-tertiary-sortas="use prefix" id="idm45017687578336"/></p>

<p>Let’s say we want to keep track of specific keys the user may press when writing the input. Our custom Hook should be able to receive the key we want to target as its argument.<a data-type="indexterm" data-primary="keypress custom Hooks" id="ch12-custkey"/></p>

<p>We want to add a <code>keydown</code> and <code>keyup</code> event listener to the key that the user passed as an argument. If the user presses that key, meaning the <code>keydown</code> event gets triggered, the state within the Hook should toggle to true. Otherwise, when the user stops pressing that button, the <code>keyup</code> event gets triggered and the state toggles to false:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">useKeyPress</code><code class="p">(</code><code class="nx">targetKey</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">keyPressed</code><code class="p">,</code> <code class="nx">setKeyPressed</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>

  <code class="kd">function</code> <code class="nx">handleDown</code><code class="p">({</code> <code class="nx">key</code> <code class="p">})</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="nx">targetKey</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">setKeyPressed</code><code class="p">(</code><code class="kc">true</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="kd">function</code> <code class="nx">handleUp</code><code class="p">({</code> <code class="nx">key</code> <code class="p">})</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="nx">targetKey</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">setKeyPressed</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="nx">React</code><code class="p">.</code><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"keydown"</code><code class="p">,</code> <code class="nx">handleDown</code><code class="p">);</code>
    <code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"keyup"</code><code class="p">,</code> <code class="nx">handleUp</code><code class="p">);</code>

    <code class="k">return</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="nb">window</code><code class="p">.</code><code class="nx">removeEventListener</code><code class="p">(</code><code class="s2">"keydown"</code><code class="p">,</code> <code class="nx">handleDown</code><code class="p">);</code>
      <code class="nb">window</code><code class="p">.</code><code class="nx">removeEventListener</code><code class="p">(</code><code class="s2">"keyup"</code><code class="p">,</code> <code class="nx">handleUp</code><code class="p">);</code>
    <code class="p">};</code>
  <code class="p">},</code> <code class="p">[]);</code>

  <code class="k">return</code> <code class="nx">keyPressed</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>We can use this custom Hook in our input application. Let’s log to the console whenever the user presses the q, l, or w key:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">useKeyPress</code> <code class="nx">from</code> <code class="s2">"./useKeyPress"</code><code class="p">;</code>

<code class="kr">export</code> <code class="k">default</code> <code class="kd">function</code> <code class="nx">Input</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">input</code><code class="p">,</code> <code class="nx">setInput</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="s2">""</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">pressQ</code> <code class="o">=</code> <code class="nx">useKeyPress</code><code class="p">(</code><code class="s2">"q"</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">pressW</code> <code class="o">=</code> <code class="nx">useKeyPress</code><code class="p">(</code><code class="s2">"w"</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">pressL</code> <code class="o">=</code> <code class="nx">useKeyPress</code><code class="p">(</code><code class="s2">"l"</code><code class="p">);</code>

  <code class="nx">React</code><code class="p">.</code><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The user pressed Q!`</code><code class="p">);</code>
  <code class="p">},</code> <code class="p">[</code><code class="nx">pressQ</code><code class="p">]);</code>

  <code class="nx">React</code><code class="p">.</code><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The user pressed W!`</code><code class="p">);</code>
  <code class="p">},</code> <code class="p">[</code><code class="nx">pressW</code><code class="p">]);</code>

  <code class="nx">React</code><code class="p">.</code><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`The user pressed L!`</code><code class="p">);</code>
  <code class="p">},</code> <code class="p">[</code><code class="nx">pressL</code><code class="p">]);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">input</code>
      <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="nx">setInput</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code><code class="p">)}</code>
      <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">input</code><code class="p">}</code>
      <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type something..."</code>
    <code class="o">/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>Instead of keeping the key press logic local to the <code>Input</code> component, we can reuse the <code>useKeyPress</code> Hook with multiple components without having to rewrite the same code repeatedly.<a data-type="indexterm" data-startref="ch12-custkey" id="idm45017687351472"/></p>

<p>Another great advantage of Hooks is that the community can build and share Hooks. We wrote the <code>useKeyPress</code> Hook ourselves, but that wasn’t necessary. The Hook was already built by someone else and ready to use in our application if we had just installed it.</p>

<p>The following are some websites that list all the Hooks built by the community and ready to use in your application:<a data-type="indexterm" data-startref="ch12-cushoo" id="idm45017687264880"/><a data-type="indexterm" data-startref="ch12-cushoo2" id="idm45017687264176"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="custom Hooks" data-tertiary="websites containing" id="idm45017687263504"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="custom Hooks" data-tertiary="websites containing" id="idm45017687262288"/><a data-type="indexterm" data-primary="resources online" data-secondary="custom React Hooks" id="idm45017687261072"/></p>

<ul>
<li>
<p><a href="https://oreil.ly/Ya94L">React Use</a></p>
</li>
<li>
<p><a href="https://oreil.ly/ZMTcR">useHooks</a></p>
</li>
<li>
<p><a href="https://oreil.ly/jlksC">Collection of React Hooks</a></p>
</li>
</ul>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Additional Hooks Guidance"><div class="sect2" id="idm45017687625472">
<h2>Additional Hooks Guidance</h2>

<p>Like other components, special functions<a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="further information on Hooks" id="idm45017687217808"/><a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="further information on Hooks" id="idm45017687216928"/> are used when you want to add Hooks to the code you have written. Here’s a brief overview of some common Hook functions:</p>
<dl>
<dt><code>useState</code></dt>
<dd>
<p>The <code>useState</code> Hook enables developers<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useState Hook" id="idm45017687213488"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="state management" data-tertiary="useState Hook" id="idm45017687212512"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useState Hook" id="idm45017687211296"/><a data-type="indexterm" data-primary="useState Hook (React)" id="idm45017687210352"/> to update and manipulate state inside function components without needing to convert it to a class component. One advantage of this Hook is that it is simple and does not require as much complexity as other React Hooks.</p>
</dd>
<dt><code>useEffect</code></dt>
<dd>
<p>The <code>useEffect</code> Hook is used<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useEffect Hook" id="idm45017687207472"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useEffect Hook" id="idm45017687206464"/><a data-type="indexterm" data-primary="useEffect Hook (React)" id="idm45017687205520"/> to run code during major lifecycle events in a function component. The main body of a function component does not allow mutations, subscriptions, timers, logging, and other side effects. It could lead to confusing bugs and inconsistencies within the UI if they are allowed. 
<span class="keep-together">The <code>useEffect</code></span> Hook prevents all of these “side effects” and allows the UI 
<span class="keep-together">to run smoothly.</span> It combines <code>componentDidMount</code>, <code>componentDidUpdate</code>, and 
<span class="keep-together"><code>componentWillUnmount</code>,</span> all in one place.</p>
</dd>
<dt><code>useContext</code></dt>
<dd>
<p>The <code>useContext</code> Hook accepts<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useContext Hook" id="idm45017687199168"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useContext Hook" id="idm45017687198160"/><a data-type="indexterm" data-primary="useContext Hook (React)" id="idm45017687197216"/> a context object, the value returned from <code>React.createcontext</code>, and returns the current context value for that context. The <code>useContext</code> Hook also works with the React Context API to share data throughout the app without passing your app props down through various levels. Note that the argument passed to the <code>useContext</code> Hook must be the context object itself and any component calling the <code>useContext</code> always rerenders whenever the context value changes.</p>
</dd>
<dt><code>useReducer</code></dt>
<dd>
<p>The <code>useReducer</code> Hook gives<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="useReducer Hook" id="idm45017687192608"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="useReducer Hook" id="idm45017687191600"/><a data-type="indexterm" data-primary="useReducer Hook (React)" id="idm45017687190656"/> an alternative to <code>setState</code>. It is especially preferable when you have complex state logic that involves multiple subvalues or when the next state depends on the previous one. It takes on a reducer function and an initial state input and returns the current state and a dispatch function as output using array destructuring. <code>useReducer</code> also optimizes the performance of components that trigger deep updates.</p>
</dd>
</dl>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Pros and Cons of Using Hooks"><div class="sect2" id="idm45017687188768">
<h2>Pros and Cons of Using Hooks</h2>

<p>Here are some benefits of making use of Hooks:<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="advantages" id="ch12-hookpro"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="advantages" id="ch12-hookpro2"/></p>
<dl>
<dt>Fewer lines of code</dt>
<dd>
<p>Hooks allow you to group code by concern and functionality, not by lifecycle. This makes the code not only cleaner and concise but also shorter. What follows is a comparison of a simple stateful component of a searchable product data table using React and how it looks in Hooks after using the <code>useState</code> keyword.</p>

<p>Stateful component:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">class</code> <code class="nx">TweetSearchResults</code> <code class="kr">extends</code> <code class="nx">React</code><code class="p">.</code><code class="nx">Component</code> <code class="p">{</code>
    <code class="nx">constructor</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
      <code class="kr">super</code><code class="p">(</code><code class="nx">props</code><code class="p">);</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">state</code> <code class="o">=</code> <code class="p">{</code>
        <code class="nx">filterText</code><code class="o">:</code> <code class="s1">''</code><code class="p">,</code>
        <code class="nx">inThisLocation</code><code class="o">:</code> <code class="kc">false</code>
      <code class="p">};</code>

      <code class="k">this</code><code class="p">.</code><code class="nx">handleFilterTextChange</code> <code class="o">=</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">handleFilterTextChange</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">);</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">handleInThisLocationChange</code> <code class="o">=</code>
                <code class="k">this</code><code class="p">.</code><code class="nx">handleInThisLocationChange</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="k">this</code><code class="p">);</code>
    <code class="p">}</code>

    <code class="nx">handleFilterTextChange</code><code class="p">(</code><code class="nx">filterText</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">({</code>
        <code class="nx">filterText</code><code class="o">:</code> <code class="nx">filterText</code>
      <code class="p">});</code>
    <code class="p">}</code>

    <code class="nx">handleInThisLocationChange</code><code class="p">(</code><code class="nx">inThisLocation</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">({</code>
        <code class="nx">inThisLocation</code><code class="o">:</code> <code class="nx">inThisLocation</code>
      <code class="p">})</code>
    <code class="p">}</code>

    <code class="nx">render</code><code class="p">()</code> <code class="p">{</code>
      <code class="k">return</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">SearchBar</code>
            <code class="nx">filterText</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">filterText</code><code class="p">}</code>
            <code class="nx">inThisLocation</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">inThisLocation</code><code class="p">}</code>
            <code class="nx">onFilterTextChange</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">handleFilterTextChange</code><code class="p">}</code>
            <code class="nx">onInThisLocationChange</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">handleInThisLocationChange</code><code class="p">}</code>
          <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="nx">TweetList</code>
            <code class="nx">tweets</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">tweets</code><code class="p">}</code>
            <code class="nx">filterText</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">filterText</code><code class="p">}</code>
            <code class="nx">inThisLocation</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">inThisLocation</code><code class="p">}</code>
          <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/div&gt;</code>
      <code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code></pre>

<p>Here’s the same component with Hooks:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">TweetSearchResults</code> <code class="o">=</code> <code class="p">({</code><code class="nx">tweets</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">filterText</code><code class="p">,</code> <code class="nx">setFilterText</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s1">''</code><code class="p">);</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">inThisLocation</code><code class="p">,</code> <code class="nx">setInThisLocation</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">SearchBar</code>
        <code class="nx">filterText</code><code class="o">=</code><code class="p">{</code><code class="nx">filterText</code><code class="p">}</code>
        <code class="nx">inThisLocation</code><code class="o">=</code><code class="p">{</code><code class="nx">inThisLocation</code><code class="p">}</code>
        <code class="nx">setFilterText</code><code class="o">=</code><code class="p">{</code><code class="nx">setFilterText</code><code class="p">}</code>
        <code class="nx">setInThisLocation</code><code class="o">=</code><code class="p">{</code><code class="nx">setInThisLocation</code><code class="p">}</code>
      <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">TweetList</code>
        <code class="nx">tweets</code><code class="o">=</code><code class="p">{</code><code class="nx">tweets</code><code class="p">}</code>
        <code class="nx">filterText</code><code class="o">=</code><code class="p">{</code><code class="nx">filterText</code><code class="p">}</code>
        <code class="nx">inThisLocation</code><code class="o">=</code><code class="p">{</code><code class="nx">inThisLocation</code><code class="p">}</code>
      <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>
</dd>
<dt>Simplifies complex components</dt>
<dd>
<p>JavaScript classes can be challenging to manage, can be hard to use with hot reloading, and may need to be minified better. React Hooks solves these problems and ensures functional programming is made easy. With the implementation of Hooks, we don’t need to have class components.</p>
</dd>
<dt>Reusing stateful logic</dt>
<dd>
<p>Classes in JavaScript encourage multiple levels of inheritance that quickly increase overall complexity and potential for errors. However, Hooks allow you to use state and other React features without writing a class. With React, you can always reuse stateful logic without needing to rewrite the code repeatedly. This reduces the chances of errors and allows for composition with plain functions.</p>
</dd>
<dt>Sharing nonvisual logic</dt>
<dd>
<p>Until the implementation of Hooks, React had no way of extracting and sharing nonvisual logic. This eventually led to more complexities, such as the HOC patterns and Render Props, to solve a common problem. The introduction of Hooks has solved this problem because it allows for extracting stateful logic to a simple JavaScript function.<a data-type="indexterm" data-startref="ch12-hookpro" id="idm45017686853296"/><a data-type="indexterm" data-startref="ch12-hookpro2" id="idm45017686852592"/></p>
</dd>
</dl>

<p>There are, of course, some potential downsides to Hooks worth keeping in mind:<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="disadvantages" id="idm45017686851408"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="disadvantages" id="idm45017686850432"/></p>

<ul>
<li>
<p>Have to respect its rules. With a linter plug-in, knowing which rule has been broken is easier.</p>
</li>
</ul>

<ul class="less_space pagebreak-before">
<li>
<p>Need considerable time practicing to use correctly (e.g., <code>useEffect</code>).</p>
</li>
<li>
<p>Need to be aware of the wrong use (e.g., <code>useCallback</code>, <code>useMemo</code>).</p>
</li>
</ul>
</div></section>








<section data-type="sect2" data-pdf-bookmark="React Hooks Versus Classes"><div class="sect2" id="idm45017686822512">
<h2>React Hooks Versus Classes</h2>

<p>When Hooks were introduced to React,<a data-type="indexterm" data-primary="Hooks (React Hooks)" data-secondary="alternative to classes" data-tertiary="Hooks versus classes" id="idm45017686821216"/><a data-type="indexterm" data-primary="React Hooks (Hooks)" data-secondary="alternative to classes" data-tertiary="Hooks versus classes" id="idm45017686819968"/><a data-type="indexterm" data-primary="classes" data-secondary="React class components prior to Hooks" data-tertiary="Hooks versus classes" id="idm45017686818752"/> it created a new problem: how do we know when to use function components with Hooks and class components? With the help of Hooks, it is possible to get state and partial lifecycle Hooks even in function components. Hooks allow you to use local state and other React features without writing a class.
Here are some differences between Hooks and classes to help you decide:</p>

<ul>
<li>
<p>Hooks help avoid multiple hierarchies and make the code clearer. With classes, generally, when you use HOC or Render Props, you have to restructure your app with multiple hierarchies when you try to see it in DevTools.</p>
</li>
<li>
<p>Hooks provide uniformity across React components. Classes confuse humans and machines due to the need to understand binding and the context in which functions are called.</p>
</li>
</ul>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Static Import"><div class="sect1" id="static-import">
<h1>Static Import</h1>

<p>The <code>import</code> keyword allows<a data-type="indexterm" data-primary="import declarations for modules" data-secondary="about import keyword" id="idm45017686813152"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="static imports" id="ch12-stimp"/><a data-type="indexterm" data-primary="static imports" data-secondary="React design pattern" id="ch12-stimp2"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="static imports" id="ch12-stimp3"/> us to import code that another module has exported. By default, all modules we’re statically importing get added to the initial bundle. A module imported using the default ES2015+ import syntax, <code>import module from 
<span class="keep-together">[module]</span></code>, is statically imported. In this section, we will learn the use of static imports in the React.js context.</p>

<p>Let’s look at an example. <a data-type="indexterm" data-primary="chat app with static import" id="idm45017686806672"/>A simple chat app contains a <code>Chat</code> component, in 
<span class="keep-together">which we are</span> statically importing and rendering three components: <code>UserProfile</code>, a <code>ChatList</code>, and a <code>ChatInput</code> to type and send messages. Within the <code>ChatInput</code> module, we’re statically importing an <code>EmojiPicker</code> component to show the emoji picker when the user toggles the emoji. <a data-type="indexterm" data-primary="webpack" data-secondary="bundling module dependencies" id="idm45017686802272"/>We will use <a href="https://oreil.ly/37e9F">webpack</a> to bundle our module 
<span class="keep-together">dependencies:</span></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>

<code class="c1">// Statically import Chatlist, ChatInput and UserInfo</code>
<code class="kr">import</code> <code class="nx">UserInfo</code> <code class="nx">from</code> <code class="s2">"./components/UserInfo"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">ChatList</code> <code class="nx">from</code> <code class="s2">"./components/ChatList"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">ChatInput</code> <code class="nx">from</code> <code class="s2">"./components/ChatInput"</code><code class="p">;</code>

<code class="kr">import</code> <code class="s2">"./styles.css"</code><code class="p">;</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"App loading"</code><code class="p">,</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">());</code>

<code class="kr">const</code> <code class="nx">App</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">UserInfo</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">ChatList</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="nx">ChatInput</code> <code class="o">/&gt;</code>
  <code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">);</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">App</code><code class="p">;</code></pre>

<p>The modules get executed as soon as the engine reaches the line on which we import them. When you open the console, you can see the order in which the modules were loaded.</p>

<p>Since the components were statically imported, webpack bundled the modules into the initial bundle. We can see the bundle that webpack creates after building the application:</p>
<table class="horizontal">

<tbody>
<tr>
<td><p>Asset</p></td>
<td><p>main.bundle.js</p></td>
</tr>
<tr>
<td><p>Size</p></td>
<td><p>1.5 MiB</p></td>
</tr>
<tr>
<td><p>Chunks</p></td>
<td><p>main  [emitted]</p></td>
</tr>
<tr>
<td><p>Chunk Names</p></td>
<td><p>main</p></td>
</tr>
</tbody>
</table>

<p>Our chat application’s source code gets bundled into one bundle: <em>main.bundle.js</em>. A large bundle size can significantly affect our application’s loading time depending on the user’s device and network connection. Before the <code>App</code> component can render its contents to the user’s screen, it must first load and parse all modules.</p>

<p>Luckily, there are many ways to speed up the loading time! We don’t always have to import all modules at once: there may be modules that should only get rendered based on user interaction, like the EmojiPicker in this case, or rendered further down the page. Instead of importing all components statically, we can dynamically import the modules after the <code>App</code> component has rendered its contents, and the user can interact with our application.<a data-type="indexterm" data-startref="ch12-stimp" id="idm45017686685312"/><a data-type="indexterm" data-startref="ch12-stimp2" id="idm45017686684704"/><a data-type="indexterm" data-startref="ch12-stimp3" id="idm45017686684096"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Dynamic Import"><div class="sect1" id="dynamic-import">
<h1>Dynamic Import</h1>

<p>The chat application discussed in the previous<a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="React design pattern" id="ch12-rdi"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="dynamic imports" id="ch12-rdi2"/><a data-type="indexterm" data-primary="dynamic imports" data-secondary="React design pattern" id="ch12-rdi3"/><a data-type="indexterm" data-primary="dynamic imports" id="ch12-rdi4"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" id="ch12-rdi5"/><a data-type="indexterm" data-primary="JavaScript" data-secondary="modern syntax and features" data-tertiary="dynamic imports" id="ch12-rdi6"/><a data-type="indexterm" data-primary="chat app with static import" data-secondary="dynamic import" id="idm45017686673808"/> section on Static Imports had four key components: <code>UserInfo</code>, <code>ChatList</code>, <code>ChatInput</code>, and <code>EmojiPicker</code>. However, only three of these components are used instantly on the initial page load: <code>UserInfo</code>, <code>ChatList</code>, and <code>ChatInput</code>. The EmojiPicker isn’t directly visible and may only be rendered if the user clicks on the Emoji to toggle the EmojiPicker. This implies that we unnecessarily added the EmojiPicker module to our initial bundle, potentially increasing the loading time.</p>

<p>To solve this, we can dynamically import the <code>EmojiPicker</code> component. Instead of statically importing it, we’ll import it only when we want to show the EmojiPicker. <a data-type="indexterm" data-primary="dynamic imports" data-secondary="React.Suspense for" id="idm45017686668768"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="React.Suspense for" id="idm45017686667760"/><a data-type="indexterm" data-primary="React Suspense for dynamic imports" id="idm45017686666576"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary=".Suspense for dynamic imports" data-secondary-sortas="Suspense" id="idm45017686665936"/>An easy way to dynamically import components in React is by using React Suspense. The <code>React.Suspense</code> component receives the component that should be dynamically loaded, making it possible for the <code>App</code> component to render its contents faster by suspending the import of the EmojiPicker module. When the user clicks on the Emoji, the <code>EmojiPicker</code> component gets rendered for the first time. The <code>EmojiPicker</code> component renders a <code>Suspense</code> component, which receives the lazily imported module: the EmojiPicker in this case. The <code>Suspense</code> component accepts a fallback prop, which receives the component that should get rendered while the suspended component is still loading!</p>

<p>Instead of unnecessarily adding EmojiPicker to the initial bundle, we can split it up into its own bundle and reduce the size of the initial bundle.</p>

<p>A smaller initial bundle size means a faster initial load: the user doesn’t have to stare at a blank loading screen for as long. The fallback component lets the user know that our application hasn’t frozen: they need to wait a little while for the module to be processed and executed.</p>
<table class="horizontal">

<thead>
<tr>
<th>Asset</th>
<th>Size</th>
<th>Chunks</th>
<th>Chunk names</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><em>emoji-picker.bundle.js</em></p></td>
<td><p>1.48 KiB</p></td>
<td><p>1    [emitted]</p></td>
<td><p>emoji-picker</p></td>
</tr>
<tr>
<td><p><em>main.bundle.js</em></p></td>
<td><p>1.33 MiB</p></td>
<td><p>main [emitted]</p></td>
<td><p>main</p></td>
</tr>
<tr>
<td><p><em>vendors~emoji-picker.bundle.js</em></p></td>
<td><p>171 KiB</p></td>
<td><p>2    [emitted]</p></td>
<td><p>vendors~emoji-picker</p></td>
</tr>
</tbody>
</table>

<p>Whereas previously, the initial bundle was 1.5 MiB, we’ve reduced it to 1.33 MiB by suspending the import of the EmojiPicker. In the console, you can see that the EmojiPicker gets executed once we’ve toggled the EmojiPicker:<a data-type="indexterm" data-primary="webpack" data-secondary="bundling module dependencies" id="idm45017686648064"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">Suspense</code><code class="p">,</code> <code class="nx">lazy</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
  <code class="c1">// import Send from "./icons/Send";</code>
  <code class="c1">// import Emoji from "./icons/Emoji";</code>
  <code class="kr">const</code> <code class="nx">Send</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code>
    <code class="kr">import</code><code class="p">(</code><code class="cm">/*webpackChunkName: "send-icon" */</code> <code class="s2">"./icons/Send"</code><code class="p">)</code>
  <code class="p">);</code>
  <code class="kr">const</code> <code class="nx">Emoji</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code>
    <code class="kr">import</code><code class="p">(</code><code class="cm">/*webpackChunkName: "emoji-icon" */</code> <code class="s2">"./icons/Emoji"</code><code class="p">)</code>
  <code class="p">);</code>
  <code class="c1">// Lazy load EmojiPicker  when &lt;EmojiPicker /&gt; renders</code>
  <code class="kr">const</code> <code class="nx">Picker</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code>
    <code class="kr">import</code><code class="p">(</code><code class="cm">/*webpackChunkName: "emoji-picker" */</code> <code class="s2">"./EmojiPicker"</code><code class="p">)</code>
  <code class="p">);</code>

  <code class="kr">const</code> <code class="nx">ChatInput</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">[</code><code class="nx">pickerOpen</code><code class="p">,</code> <code class="nx">togglePicker</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useReducer</code><code class="p">(</code><code class="nx">state</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="nx">state</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>

    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">Suspense</code> <code class="nx">fallback</code><code class="o">=</code><code class="p">{</code><code class="o">&lt;</code><code class="nx">p</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"loading"</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/p&gt;}&gt;</code>
        <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"chat-input-container"</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type a message..."</code> <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="nx">Emoji</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">togglePicker</code><code class="p">}</code> <code class="o">/&gt;</code>
          <code class="p">{</code><code class="nx">pickerOpen</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">Picker</code> <code class="o">/&gt;</code><code class="p">}</code>
          <code class="o">&lt;</code><code class="nx">Send</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/div&gt;</code>
      <code class="o">&lt;</code><code class="err">/Suspense&gt;</code>
    <code class="p">);</code>
  <code class="p">};</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"ChatInput loaded"</code><code class="p">,</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">());</code>

  <code class="kr">export</code> <code class="k">default</code> <code class="nx">ChatInput</code><code class="p">;</code></pre>

<p>When building the application, we can see the different bundles that webpack created. By dynamically importing the <code>EmojiPicker</code> component, we reduced the initial bundle size from 1.5 MiB to 1.33 MiB! Although the user may still have to wait a while until the EmojiPicker has been fully loaded, we have improved the UX by making sure the application is rendered and interactive while the user waits for the component to load.</p>








<section data-type="sect2" data-pdf-bookmark="Loadable Components"><div class="sect2" id="idm45017686516736">
<h2>Loadable Components</h2>

<p>SSR doesn’t support React Suspense (yet).<a data-type="indexterm" data-primary="server-side rendering (SSR)" data-secondary="React Suspense not supported" id="idm45017686484896"/><a data-type="indexterm" data-primary="SSR (server-side rendering)" data-secondary="React Suspense not supported" id="idm45017686483984"/><a data-type="indexterm" data-primary="React Suspense for dynamic imports" data-secondary="server-side rendering not supporting" id="idm45017686483104"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="server-side rendering" id="idm45017686482128"/><a data-type="indexterm" data-primary="dynamic imports" data-secondary="loadable-components library" id="idm45017686480912"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="loadable-components library" id="idm45017686479952"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary=".Suspense for dynamic imports" data-tertiary="loadable-components library instead" data-secondary-sortas="Suspense" id="idm45017686478704"/><a data-type="indexterm" data-primary="React Suspense for dynamic imports" data-secondary="server-side rendering not supporting" data-tertiary="loadable-components library instead" id="idm45017686477184"/><a data-type="indexterm" data-primary="SSR (server-side rendering)" data-secondary="React Suspense not supported" data-tertiary="loadable-components library instead" id="idm45017686475920"/><a data-type="indexterm" data-primary="server-side rendering (SSR)" data-secondary="React Suspense not supported" data-tertiary="loadable-components library instead" id="idm45017686474656"/> An excellent alternative to React Suspense is the <em>loadable-components</em> library, which you can use in SSR  applications:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">loadable</code> <code class="nx">from</code> <code class="s2">"@loadable/component"</code><code class="p">;</code>

<code class="kr">import</code> <code class="nx">Send</code> <code class="nx">from</code> <code class="s2">"./icons/Send"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">Emoji</code> <code class="nx">from</code> <code class="s2">"./icons/Emoji"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">EmojiPicker</code> <code class="o">=</code> <code class="nx">loadable</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="kr">import</code><code class="p">(</code><code class="s2">"./EmojiPicker"</code><code class="p">),</code> <code class="p">{</code>
  <code class="nx">fallback</code><code class="o">:</code> <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"loading"</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">});</code>

<code class="kr">const</code> <code class="nx">ChatInput</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">pickerOpen</code><code class="p">,</code> <code class="nx">togglePicker</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useReducer</code><code class="p">(</code><code class="nx">state</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="nx">state</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"chat-input-container"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type a message..."</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">Emoji</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">togglePicker</code><code class="p">}</code> <code class="o">/&gt;</code>
      <code class="p">{</code><code class="nx">pickerOpen</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">EmojiPicker</code> <code class="o">/&gt;</code><code class="p">}</code>
      <code class="o">&lt;</code><code class="nx">Send</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">};</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">ChatInput</code><code class="p">;</code></pre>

<p>Like React Suspense, we can pass the lazily imported module to the loadable, which will import the module only once the EmojiPicker module is requested. While the module is loaded, we can render a fallback component.</p>

<p>Although loadable components are a great alternative to React Suspense for SSR applications,<a data-type="indexterm" data-primary="CSR (client-side rendering)" data-secondary="loadable-components library" id="idm45017686347584"/><a data-type="indexterm" data-primary="client-side rendering (CSR)" data-secondary="loadable-components library" id="idm45017686346736"/><a data-type="indexterm" data-primary="Rendering patterns" data-secondary="client-side rendering" data-tertiary="loadable-components library" id="idm45017686251744"/> they’re also helpful in CSR applications to suspend module imports:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
  <code class="kr">import</code> <code class="nx">Send</code> <code class="nx">from</code> <code class="s2">"./icons/Send"</code><code class="p">;</code>
  <code class="kr">import</code> <code class="nx">Emoji</code> <code class="nx">from</code> <code class="s2">"./icons/Emoji"</code><code class="p">;</code>
  <code class="kr">import</code> <code class="nx">loadable</code> <code class="nx">from</code> <code class="s2">"@loadable/component"</code><code class="p">;</code>

  <code class="kr">const</code> <code class="nx">EmojiPicker</code> <code class="o">=</code> <code class="nx">loadable</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="kr">import</code><code class="p">(</code><code class="s2">"./components/EmojiPicker"</code><code class="p">),</code> <code class="p">{</code>
    <code class="nx">fallback</code><code class="o">:</code> <code class="o">&lt;</code><code class="nx">p</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"loading"</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/p&gt;</code>
  <code class="p">});</code>

  <code class="kr">const</code> <code class="nx">ChatInput</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">[</code><code class="nx">pickerOpen</code><code class="p">,</code> <code class="nx">togglePicker</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useReducer</code><code class="p">(</code><code class="nx">state</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="nx">state</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>

    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"chat-input-container"</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type a message..."</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="nx">Emoji</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">togglePicker</code><code class="p">}</code> <code class="o">/&gt;</code>
        <code class="p">{</code><code class="nx">pickerOpen</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">EmojiPicker</code> <code class="o">/&gt;</code><code class="p">}</code>
        <code class="o">&lt;</code><code class="nx">Send</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="p">);</code>
  <code class="p">};</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"ChatInput loaded"</code><code class="p">,</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">());</code>

  <code class="kr">export</code> <code class="k">default</code> <code class="nx">ChatInput</code><code class="p">;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Import on Interaction"><div class="sect2" id="idm45017686165712">
<h2>Import on Interaction</h2>

<p>In the chat application example,<a data-type="indexterm" data-primary="dynamic imports" data-secondary="Import on Interaction" id="idm45017686164576"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="Import on Interaction" id="idm45017686163600"/><a data-type="indexterm" data-primary="Import on Interaction pattern" id="idm45017686112016"/> we dynamically imported the <code>EmojiPicker</code> component when the user clicked on the Emoji. This type of dynamic import is called <em>Import on Interaction</em>. We triggered the component import on interaction by the user.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Import on Visibility"><div class="sect2" id="idm45017686110192">
<h2>Import on Visibility</h2>

<p>Besides user interaction, we often<a data-type="indexterm" data-primary="Import on Visibility pattern" id="idm45017686108864"/><a data-type="indexterm" data-primary="dynamic imports" data-secondary="Import on Visibility" id="idm45017686108144"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="Import on Visibility" id="idm45017686107200"/><a data-type="indexterm" data-primary="visibility of components" data-secondary="dynamic import on visibility" id="idm45017686105968"/> have components that need not be visible on the initial page load. An excellent example of this is lazy-loading images or components that aren’t directly visible in the viewport and get loaded only once the user scrolls down. Triggering a dynamic import when the user scrolls down to a component and it becomes visible is called <em>Import on Visibility</em>.</p>

<p>To know whether components are currently in our viewport,<a data-type="indexterm" data-primary="APIs" data-secondary="IntersectionObserver detecting component visibility" id="idm45017686103808"/><a data-type="indexterm" data-primary="IntersectionObserver API detecting component visibility" id="idm45017686102864"/><a data-type="indexterm" data-primary="visibility of components" data-secondary="IntersectionObserver API detecting component visibility" id="idm45017686102224"/><a data-type="indexterm" data-primary="chat app with static import" data-secondary="dynamic import" id="idm45017686055216"/> we can use 
<span class="keep-together">the IntersectionObserver</span> API or libraries such as 
<span class="keep-together"><code>react-loadable-visibility</code></span> or 
<span class="keep-together"><code>react-lazyload</code></span> to add Import on Visibility to our application quickly. We can now look at the chat application example where the EmojiPicker is imported and loaded when it becomes visible to the user:<a data-type="indexterm" data-startref="ch12-rdi" id="idm45017686052112"/><a data-type="indexterm" data-startref="ch12-rdi2" id="idm45017686051504"/><a data-type="indexterm" data-startref="ch12-rdi3" id="idm45017686050896"/><a data-type="indexterm" data-startref="ch12-rdi4" id="idm45017686050288"/><a data-type="indexterm" data-startref="ch12-rdi5" id="idm45017686049680"/><a data-type="indexterm" data-startref="ch12-rdi6" id="idm45017686049072"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">Send</code> <code class="nx">from</code> <code class="s2">"./icons/Send"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">Emoji</code> <code class="nx">from</code> <code class="s2">"./icons/Emoji"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">LoadableVisibility</code> <code class="nx">from</code> <code class="s2">"react-loadable-visibility/react-loadable"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">EmojiPicker</code> <code class="o">=</code> <code class="nx">LoadableVisibility</code><code class="p">({</code>
  <code class="nx">loader</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="kr">import</code><code class="p">(</code><code class="s2">"./EmojiPicker"</code><code class="p">),</code>
  <code class="nx">loading</code><code class="o">:</code> <code class="o">&lt;</code><code class="nx">p</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"loading"</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="o">&lt;</code><code class="err">/p&gt;</code>
<code class="p">});</code>

<code class="kr">const</code> <code class="nx">ChatInput</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">pickerOpen</code><code class="p">,</code> <code class="nx">togglePicker</code><code class="p">]</code> <code class="o">=</code> <code class="nx">React</code><code class="p">.</code><code class="nx">useReducer</code><code class="p">(</code><code class="nx">state</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="nx">state</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"chat-input-container"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Type a message..."</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">Emoji</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">togglePicker</code><code class="p">}</code> <code class="o">/&gt;</code>
      <code class="p">{</code><code class="nx">pickerOpen</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">EmojiPicker</code> <code class="o">/&gt;</code><code class="p">}</code>
      <code class="o">&lt;</code><code class="nx">Send</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">};</code>

<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"ChatInput loading"</code><code class="p">,</code> <code class="nb">Date</code><code class="p">.</code><code class="nx">now</code><code class="p">());</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">ChatInput</code><code class="p">;</code></pre>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Code-Splitting"><div class="sect1" id="code-splitting">
<h1>Code-Splitting</h1>

<p>In the previous section, we saw how<a data-type="indexterm" data-primary="code-splitting patterns" data-secondary="about" id="idm45017686032224"/> we could dynamically import components when needed. In a complex application with multiple routes and components, we must ensure that our code is bundled and split optimally to allow for a mix of static and dynamic imports at the right time.</p>

<p>You can use the route-based splitting pattern to split your code or rely on modern bundlers such as webpack or Rollup to split and bundle your application’s source code.</p>








<section data-type="sect2" data-pdf-bookmark="Route-based Splitting"><div class="sect2" id="idm45017685974096">
<h2>Route-based Splitting</h2>

<p>Specific resources may be required<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="route-based code splitting" id="idm45017685972880"/><a data-type="indexterm" data-primary="code-splitting patterns" data-secondary="route-based splitting" id="idm45017685971664"/><a data-type="indexterm" data-primary="route-based code splitting" id="idm45017685970720"/> only on certain pages or routes, and we can request resources that are needed only for particular routes by adding route-based splitting. By combining React Suspense or <em>loadable-components</em> with libraries such as <code>react-router</code>, we can dynamically load components based on the current route. For example:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">lazy</code><code class="p">,</code> <code class="nx">Suspense</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">render</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react-dom"</code><code class="p">;</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Switch</code><code class="p">,</code> <code class="nx">Route</code><code class="p">,</code> <code class="nx">BrowserRouter</code> <code class="nx">as</code> <code class="nx">Router</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react-router-dom"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">App</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="kr">import</code><code class="p">(</code><code class="cm">/* webpackChunkName: "home" */</code> <code class="s2">"./App"</code><code class="p">));</code>
<code class="kr">const</code> <code class="nx">Overview</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code>
  <code class="kr">import</code><code class="p">(</code><code class="cm">/* webpackChunkName: "overview" */</code> <code class="s2">"./Overview"</code><code class="p">)</code>
<code class="p">);</code>
<code class="kr">const</code> <code class="nx">Settings</code> <code class="o">=</code> <code class="nx">lazy</code><code class="p">(()</code> <code class="o">=&gt;</code>
  <code class="kr">import</code><code class="p">(</code><code class="cm">/* webpackChunkName: "settings" */</code> <code class="s2">"./Settings"</code><code class="p">)</code>
<code class="p">);</code>

<code class="nx">render</code><code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">Router</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Suspense</code> <code class="nx">fallback</code><code class="o">=</code><code class="p">{</code><code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/div&gt;}&gt;</code>
      <code class="o">&lt;</code><code class="nx">Switch</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">exact</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/"</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/Route&gt;</code>
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/overview"</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">Overview</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/Route&gt;</code>
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/settings"</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">Settings</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/Route&gt;</code>
      <code class="o">&lt;</code><code class="err">/Switch&gt;</code>
    <code class="o">&lt;</code><code class="err">/Suspense&gt;</code>
  <code class="o">&lt;</code><code class="err">/Router&gt;,</code>
  <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"root"</code><code class="p">)</code>
<code class="p">);</code>

<code class="nx">module</code><code class="p">.</code><code class="nx">hot</code><code class="p">.</code><code class="nx">accept</code><code class="p">();</code></pre>

<p>By lazily loading the components per route, we’re only requesting the bundle that contains the code necessary for the current route. Since most people are used to the fact that there may be some loading time during a redirect, it’s the perfect place to load components lazily.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Bundle Splitting"><div class="sect2" id="idm45017685642784">
<h2>Bundle Splitting</h2>

<p>When building a modern web application,<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="bundle splitting" id="idm45017685641184"/><a data-type="indexterm" data-primary="code-splitting patterns" data-secondary="bundle splitting" id="idm45017685776080"/><a data-type="indexterm" data-primary="bundle splitting" id="idm45017685775136"/> bundlers such as webpack or Rollup take an application’s source code and bundle this together into one or more bundles. When a user visits a website, the bundles required to display the data and features to the user are requested and loaded.</p>

<p>JavaScript engines such as V8 can parse and compile data requested by the user as it’s being loaded. Although modern browsers have evolved to parse and compile the code as quickly and efficiently as possible, the developer is still in charge of optimizing the loading and execution time of the requested data. We want to keep the execution time as short as possible to prevent blocking the main thread.</p>

<p>Even though modern browsers can stream the bundle as it arrives, it can still take a significant time before the first pixel is painted on the user’s device. The bigger the bundle, the longer it can take before the engine reaches the line on which the first rendering call is made. Until then, the user has to stare at a blank screen, which can be frustrating.</p>

<p>We want to display data to the user as quickly as possible. A larger bundle leads to an increased amount of loading time, processing time, and execution time. It would be great if we could reduce the size of this bundle to speed things up. Instead of requesting one giant bundle
that contains unnecessary code, we can split the bundle into multiple smaller bundles. There are some essential metrics that we need to consider when deciding the size of our bundles.</p>

<p>By bundle-splitting the application, we can reduce the time it takes to load, process, and execute a bundle. This, in turn, reduces the time it takes for the first content to be painted on the user’s screen, known as the First Contentful Paint (FCP). It also reduces the time for the largest component to be rendered to the screen or the Largest Contentful Paint (LCP) metric.</p>

<p>Although seeing data on our screen is excellent, we want to see more than just the content. To have a fully functioning application, we want users to be able to interact with it as well. The UI becomes interactive only after the bundle has been loaded and executed. The time it takes for all content to be painted on the screen and become interactive is called the Time to Interactive (TTI).</p>

<p>A larger bundle doesn’t necessarily mean a longer execution time. It could happen that we loaded a ton of code that the user may not even use. Some parts of the bundle will get executed on only a specific user interaction, which the user may or may not do.</p>

<p>The engine still has to load, parse, and compile code that’s not even used on the initial render before the user can see anything on their screen. Although the parsing and compilation costs can be practically ignored due to the browser’s performant way of handling these two steps, fetching a larger bundle than necessary can hurt the performance of your application. Users on low-end devices or slower networks will see a significant increase in loading time before the bundle is fetched.</p>

<p>Instead of initially requesting parts of the code that don’t have a high priority in the current navigation, we can separate this code from the code needed to render the initial page.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="PRPL Pattern"><div class="sect1" id="prpl-pattern">
<h1>PRPL Pattern</h1>

<p>Making applications accessible to a global<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="PRPL pattern" id="ch12-prpl"/><a data-type="indexterm" data-primary="PRPL (Push Render Pre-cache Lazy-load) pattern" id="ch12-prpl2"/><a data-type="indexterm" data-primary="Push Render Pre-cache Lazy-load (PRPL) pattern" id="ch12-prpl3"/><a data-type="indexterm" data-primary="dynamic imports" data-secondary="PRPL pattern" id="ch12-prpl4"/><a data-type="indexterm" data-primary="import declarations for modules" data-secondary="dynamic imports" data-tertiary="PRPL pattern" id="ch12-prpl5"/> user base can be a challenge. The application should be performant on low-end devices and in regions with poor internet connectivity. To make sure our application can load as efficiently as possible under challenging conditions, we can use the Push Render Pre-cache Lazy-load (PRPL) 
<span class="keep-together">pattern.</span></p>

<p>The PRPL pattern focuses on four primary performance considerations:</p>

<ul>
<li>
<p><em>Pushing</em> critical resources efficiently minimizes the number of roundtrips to the server and reduces loading time.</p>
</li>
<li>
<p><em>Rendering</em> the initial route as soon as possible to improve the UX.</p>
</li>
<li>
<p><em>Pre-caching</em> assets in the background for frequently visited routes to minimize the number of requests to the server and enable a better offline experience.</p>
</li>
<li>
<p><em>Lazily loading</em> routes or assets that aren’t requested as frequently.</p>
</li>
</ul>

<p>When we visit a website, the browser requests the server for the required resources. The file the entry point points to gets returned from the server, usually our application’s initial HTML file. The browser’s HTML parser starts to parse this data as soon as it starts receiving it from the server. If the parser discovers that more resources are needed, such as stylesheets or scripts, additional HTTP requests are sent to the server to get those resources.</p>

<p>Requesting resources repeatedly isn’t optimal, as we are trying to minimize the number of round trips between the client and the server.</p>

<p>We used HTTP/1.1 for a long time<a data-type="indexterm" data-primary="HTTP/1.0, HTTP/1.1, HTTP/2 comparison" id="idm45017685630032"/><a data-type="indexterm" data-primary="TCP connections in HTTP versions" id="idm45017685629360"/> to communicate between the client and the server. Although HTTP/1.1 introduced many improvements compared to HTTP/1.0, such as keeping the TCP connection between the client and the server alive before a new HTTP request gets sent with the keep-alive header, there were still some issues that had to be solved. HTTP/2 introduced significant changes compared to HTTP/1.1, allowing us to optimize the message exchange between the client and the server.</p>

<p>Whereas HTTP/1.1 used a newline delimited plaintext protocol in the requests and responses, HTTP/2 splits the requests and responses into smaller frames. An HTTP request that contains headers and a body field gets split into at least two frames: a headers frame and a data frame.</p>

<p>HTTP/1.1 had a maximum amount of six TCP connections between the client and the server. Before you can send a new request over the same TCP connection, the previous request must be resolved. If the last request takes a long time to resolve, this request is blocking the other requests from being sent. This common issue is called head-of-line blocking and can increase the loading time of specific resources.</p>

<p>HTTP/2 uses bidirectional streams. A single TCP connection with multiple bidirectional streams can carry multiple request and response frames between the client and the server. Once the server has received all request frames for that specific request, it reassembles them and generates response frames. These response frames are sent back to the client, which reassembles them. Since the stream is bidirectional, we can send both request and response frames over the same stream.</p>

<p>HTTP/2 solves head-of-line blocking by allowing multiple requests to get sent on the same TCP connection before the previous request resolves! HTTP/2 also introduced a more optimized way of fetching data, called server push. Instead of explicitly asking for resources each time by sending an HTTP request, the server can send the additional resources automatically by “pushing” these resources.</p>

<p>After the client has received the additional resources, the resources will get stored in the browser cache. When the resources are discovered while parsing the entry file, the browser can quickly get the resources from the cache instead of making an HTTP request to the server.</p>

<p>Although pushing resources reduces the time to receive additional resources, server push is not HTTP cache-aware. The pushed resources won’t be available to us the next time we visit the website and will have to be requested again. To solve this, the PRPL pattern uses service workers after the initial load to cache those resources to ensure the client isn’t making unnecessary requests.</p>

<p>As site authors, we usually know what resources are critical to fetch early on, while browsers do their best to guess this. We can help the browser by adding a preload resource hint to the critical resources.</p>

<p>By telling the browser that you’d like to preload a specific resource, you’re telling the browser that you would like to fetch it sooner than the browser would otherwise discover it. Preloading is a great way to optimize the time it takes to load resources critical for the current route.</p>

<p>Although preloading resources is a great way to reduce the number of roundtrips and optimize loading time, pushing too many files can be harmful. The browser’s cache is limited, and you may unnecessarily use bandwidth by requesting resources the client didn’t need. The PRPL pattern focuses on optimizing the initial load. No other resources get loaded before the initial route is completely rendered.</p>

<p>We can achieve this by code-splitting our application into small, performant bundles. These bundles should allow users to load only the resources they need when they need them while also maximizing cache use.</p>

<p>Caching larger bundles can be an issue. Multiple bundles may share the same resources.</p>

<p>A browser needs help identifying which parts of the bundle are shared between multiple routes and cannot cache these resources. Caching resources is vital to reducing the number of round trips to the server and to making our application offline-friendly.</p>

<p>When working with the PRPL pattern, we need to ensure that the bundles we’re requesting contain the minimal amount of resources we need at that time and are cachable by the browser. In some cases, this could mean that having no bundles at all would be more performant, and we could simply work with unbundled modules.</p>

<p>The benefit of dynamically requesting minimal resources by bundling an application can easily be mocked by configuring the browser and server to support HTTP/2 push and caching the resources efficiently. For browsers that don’t support HTTP/2 server push, we can create an optimized build to minimize the number of roundtrips. The client doesn’t have to know whether it’s receiving a bundled or unbundled resource: the server delivers the appropriate build for each browser.</p>

<p>The PRPL pattern often uses an app shell as its main entry point, a minimal file containing most of the application’s logic and shared between routes. It also includes the application’s router, which can dynamically request the necessary resources.</p>

<p>The PRPL pattern ensures that no other resources get requested or rendered before the initial route is visible on the user’s device. Once the initial route has been loaded successfully, a service worker can get installed to fetch the resources for the other frequently visited routes in the background.</p>

<p>Since this data is being fetched in the background, the user won’t experience any delays. If a user wants to navigate to a frequently visited route cached by the service worker, the service worker can quickly get the required resources from the cache instead of sending a request to the server.</p>

<p>Resources for routes that aren’t as frequently visited can be dynamically imported.<a data-type="indexterm" data-startref="ch12-prpl" id="idm45017685621136"/><a data-type="indexterm" data-startref="ch12-prpl2" id="idm45017685620432"/><a data-type="indexterm" data-startref="ch12-prpl3" id="idm45017685619760"/><a data-type="indexterm" data-startref="ch12-prpl4" id="idm45017685619088"/><a data-type="indexterm" data-startref="ch12-prpl5" id="idm45017685618416"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Loading Prioritization"><div class="sect1" id="loading-prioritization">
<h1>Loading Prioritization</h1>

<p>The Loading Prioritization pattern <a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="Loading Prioritization pattern" id="idm45017685616224"/><a data-type="indexterm" data-primary="Loading Prioritization pattern" id="idm45017685614912"/>encourages you to explicitly prioritize the requests for specific resources you know will be required earlier.</p>

<p>Preload (<code>&lt;link rel="preload"&gt;</code>) is a browser<a data-type="indexterm" data-primary="preload browser optimization" id="idm45017685613136"/><a data-type="indexterm" data-primary="browsers" data-secondary="preload optimization" id="idm45017685612384"/> optimization that allows critical resources (that browsers may discover late) to be requested earlier. If you are comfortable thinking about how to order the loading of your key resources manually, it can have a positive impact on loading performance and metrics in the Core Web Vitals (CWV). That said, preload is not a panacea and requires an awareness of some 
<span class="keep-together">trade-offs:</span></p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">href</code><code class="o">=</code><code class="s">"emoji-picker.js"</code> <code class="na">as</code><code class="o">=</code><code class="s">"script"</code><code class="p">&gt;</code>
  ...
  <code class="p">&lt;/</code><code class="nt">head</code><code class="p">&gt;</code>
  <code class="p">&lt;</code><code class="nt">body</code><code class="p">&gt;</code>
    ...
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"stickers.js"</code> <code class="na">defer</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"video-sharing.js"</code> <code class="na">defer</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>
    <code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"emoji-picker.js"</code> <code class="na">defer</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>

<p>When optimizing for metrics like Time to Interactive (TTI) or First Input Delay (FID), preload can be helpful to load JavaScript bundles (or chunks) necessary for interactivity. Remember that great care is needed when using preload because you want to avoid improving interactivity at the cost of delaying resources (like hero images or fonts) necessary for First Contentful Paint (FCP) or Largest Contentful Paint (LCP).</p>

<p>If you’re trying to optimize the loading<a data-type="indexterm" data-primary="JavaScript" data-secondary="script defer in head versus body" id="idm45017685564816"/><a data-type="indexterm" data-primary="script defer in head versus body" id="idm45017685563968"/> of first-party JavaScript, consider using <code>&lt;script defer&gt;</code> in the document <code>&lt;head&gt;</code> versus <code>&lt;body&gt;</code> to help with the early discovery of these resources.</p>








<section data-type="sect2" data-pdf-bookmark="Preload in Single-Page Apps"><div class="sect2" id="idm45017685561824">
<h2>Preload in Single-Page Apps</h2>

<p>While prefetching is a great way to cache<a data-type="indexterm" data-primary="Loading Prioritization pattern" data-secondary="preload in single-page apps" id="idm45017685560288"/> resources that may be requested sometime soon, we can preload resources that need to be used instantly. It could be a specific font used on the initial render or certain images the user sees immediately.</p>

<p>Say our <code>EmojiPicker</code> component should be visible instantly on the initial render. Although you should not include it in the main bundle, it should get loaded in parallel. Like prefetch, we can add a magic comment to inform webpack that this module should be preloaded:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">EmojiPicker</code> <code class="o">=</code> <code class="kr">import</code><code class="p">(</code><code class="cm">/* webpackPreload: true */</code> <code class="s2">"./EmojiPicker"</code><code class="p">);</code></pre>

<p>After building the application, we can see that the <code>EmojiPicker</code> will be prefetched. The actual output is visible as a <code>link</code> tag with <code>rel="preload"</code> in the head of our document:</p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"prefetch"</code> <code class="na">href</code><code class="o">=</code><code class="s">"emoji-picker.bundle.js"</code> <code class="na">as</code><code class="o">=</code><code class="s">"script"</code> <code class="p">/&gt;</code>
<code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"prefetch"</code> <code class="na">href</code><code class="o">=</code><code class="s">"vendors~emoji-picker.bundle.js"</code> <code class="na">as</code><code class="o">=</code><code class="s">"script"</code> <code class="p">/&gt;</code></pre>

<p>The preloaded <code>EmojiPicker</code> could be loaded in parallel with the initial bundle. Unlike prefetch, where the browser still had a say in whether it’s got a good enough internet connection and bandwidth to prefetch the resource, a preloaded resource will get preloaded no matter what.</p>

<p>Instead of waiting until the <code>EmojiPicker</code> gets loaded after the initial render, the resource will be available to us instantly. As we’re loading assets with more thoughtful ordering, the initial loading time may increase significantly depending on your user’s device and internet connection. Only preload the resources that must be visible approximately 1 second after the initial render.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Preload + the async Hack"><div class="sect2" id="idm45017685440560">
<h2>Preload + the async Hack</h2>

<p>Should you wish for browsers to download<a data-type="indexterm" data-primary="Loading Prioritization pattern" data-secondary="preload plus async hack" id="idm45017685439296"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="preload plus async hack" id="idm45017685438352"/> a script as high priority but not block the parser waiting for a script, you can take advantage of the preload + <code>async</code> hack shown here. The preload, in this case, may delay the download of other resources, but this is a trade-off a developer has to make:</p>

<pre data-type="programlisting" data-code-language="html"><code class="p">&lt;</code><code class="nt">link</code> <code class="na">rel</code><code class="o">=</code><code class="s">"preload"</code> <code class="na">href</code><code class="o">=</code><code class="s">"emoji-picker.js"</code> <code class="na">as</code><code class="o">=</code><code class="s">"script"</code> <code class="p">/&gt;</code>

<code class="p">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"emoji-picker.js"</code> <code class="na">async</code><code class="p">&gt;&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Preload in Chrome 95+"><div class="sect2" id="idm45017685415248">
<h2>Preload in Chrome 95+</h2>

<p>The feature is slightly safer thanks<a data-type="indexterm" data-primary="Loading Prioritization pattern" data-secondary="preload in Chrome 95+" id="idm45017685458112"/><a data-type="indexterm" data-primary="Meenan, Pat" id="idm45017685457168"/><a data-type="indexterm" data-primary="browsers" data-secondary="Chrome" data-tertiary="preload in Chrome 95+" id="idm45017685456496"/><a data-type="indexterm" data-primary="browsers" data-secondary="preload optimization" data-tertiary="preload in Chrome 95+" id="idm45017685455280"/><a data-type="indexterm" data-primary="Chrome" data-secondary="preload in Chrome 95+" id="idm45017685454064"/> to some fixes to preload’s queue-jumping behavior in Chrome 95+. Pat Meenan of Chrome’s new recommendations for preload suggests the following:</p>

<ul>
<li>
<p>Putting it in HTTP headers will jump ahead of everything else.</p>
</li>
<li>
<p>Generally, preloads will load in the order the parser gets to them for anything greater than or equal to Medium, so be careful putting preloads at the beginning of the HTML.</p>
</li>
<li>
<p>Font preloads are probably best toward the end of the head or the beginning of the body.</p>
</li>
<li>
<p>Import preloads should be done after the <code>script</code> tag that needs the import (so the actual script gets loaded/parsed first).</p>
</li>
<li>
<p>Image preloads will have a low priority and should be ordered relative to <code>async</code> scripts and other low/lowest priority tags.</p>
</li>
</ul>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="List Virtualization"><div class="sect1" id="list-virtualization">
<h1>List Virtualization</h1>

<p>List virtualization helps improve<a data-type="indexterm" data-primary="React (React.js)" data-secondary="design patterns" data-tertiary="list virtualization" id="ch12-list"/><a data-type="indexterm" data-primary="list virtualization" id="ch12-list2"/><a data-type="indexterm" data-primary="list virtualization" data-secondary="about" id="idm45017685397600"/> the rendering performance of large lists of data. You render only visible rows of content in a dynamic list instead of the entire list. The rows rendered are only a small subset of the full list, with what is visible (the window) moving as the user scrolls. <a data-type="indexterm" data-primary="Vaughn, Brian" id="idm45017685396528"/><a data-type="indexterm" data-primary="React (React.js)" data-secondary="react-virtualized library for list virtualization" id="idm45017685395856"/><a data-type="indexterm" data-primary="react-virtualized library for list virtualization" id="idm45017685369040"/>In React, you can achieve this using <a href="https://oreil.ly/3XThZ"><code>react-virtualized</code></a>. It’s a windowing library by <a href="https://oreil.ly/hCqQq">Brian Vaughn</a> that renders only the items currently visible in a list (within a scrolling viewport). This means you don’t need to pay the cost of thousands of rows of data being rendered at once.</p>








<section data-type="sect2" data-pdf-bookmark="How Does Windowing/Virtualization Work?"><div class="sect2" id="idm45017685366928">
<h2>How Does Windowing/Virtualization Work?</h2>

<p>Virtualizing a list of items involves maintaining<a data-type="indexterm" data-primary="list virtualization" data-secondary="about windowing and virtualization" id="idm45017685365552"/> and moving a window around your list. Windowing in <code>react-virtualized</code> works by:</p>

<ul>
<li>
<p>Having a small container DOM element (e.g., <code>&lt;ul&gt;</code>) with relative positioning (window).</p>
</li>
<li>
<p>Having a big DOM element for scrolling.</p>
</li>
<li>
<p>Absolutely positioning children inside the container, setting their styles for top, left, width, and height.</p>
</li>
<li>
<p>Rather than rendering thousands of elements from a list at once (which can cause slower initial rendering or impact scroll performance), virtualization focuses on rendering just items visible to the user.</p>
</li>
</ul>

<p>This can help keep list rendering fast on mid- to low-end devices. You can fetch/display more items as the user scrolls, unloading previous entries and replacing them with new ones.</p>

<p><a href="https://oreil.ly/H_Rx7"><code>react-window</code></a> is a rewrite<a data-type="indexterm" data-primary="React (React.js)" data-secondary="react-virtualized library for list virtualization" data-tertiary="react-window rewrite" id="idm45017685357872"/><a data-type="indexterm" data-primary="react-virtualized library for list virtualization" data-secondary="react-window rewrite" id="idm45017685356528"/> of
<code>react-virtualized</code> by the same author aiming to be smaller, faster, and more tree-shakeable. In a tree-shakeable library, size is a function of which API surfaces you choose to use. I’ve seen approximately 20 to 30 KB (gzipped) savings using it in place of <code>react-virtualized</code>. The APIs for both packages are similar; <code>react-window</code> tends to be simpler where they 
<span class="keep-together">differ.</span></p>

<p>The following are the main components in the case of <code>react-window</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Lists"><div class="sect2" id="idm45017685352720">
<h2>Lists</h2>

<p>Lists render a windowed list (row) of <a data-type="indexterm" data-primary="list virtualization" data-secondary="lists" id="ch12-rlis"/>elements meaning that only the visible rows are displayed to users. Lists use a Grid (internally) to render rows, relaying props to that inner Grid. The following code snippets show the difference between rendering lists in React versus using <code>react-window</code>.</p>

<p>Rendering a list of simple data (<code>itemsArray</code>) using React:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">ReactDOM</code> <code class="nx">from</code> <code class="s2">"react-dom"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">itemsArray</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Drake"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Halsey"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Camila Cabello"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Travis Scott"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Bazzi"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Flume"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Nicki Minaj"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Kodak Black"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Tyga"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Bruno Mars"</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">name</code><code class="o">:</code> <code class="s2">"Lil Wayne"</code> <code class="p">},</code> <code class="p">...</code>
<code class="p">];</code> <code class="c1">// our data</code>

<code class="kr">const</code> <code class="nx">Row</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">index</code><code class="p">,</code> <code class="nx">style</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">index</code> <code class="o">%</code> <code class="mi">2</code> <code class="o">?</code> <code class="s2">"ListItemOdd"</code> <code class="o">:</code> <code class="s2">"ListItemEven"</code><code class="p">}</code> <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">itemsArray</code><code class="p">[</code><code class="nx">index</code><code class="p">].</code><code class="nx">name</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">);</code>

<code class="kr">const</code> <code class="nx">Example</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code>
    <code class="nx">style</code><code class="o">=</code>
    <code class="kr">class</code><code class="o">=</code><code class="s2">"List"</code>
  <code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">itemsArray</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">item</code><code class="p">,</code> <code class="nx">index</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">Row</code><code class="p">({</code> <code class="nx">index</code> <code class="p">}))}</code>
  <code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">);</code>

<code class="nx">ReactDOM</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="o">&lt;</code><code class="nx">Example</code> <code class="o">/&gt;</code><code class="p">,</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"root"</code><code class="p">));</code></pre>

<p>Rendering a list using <code>react-window</code>:<a data-type="indexterm" data-startref="ch12-rlis" id="idm45017685345312"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s2">"react"</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">ReactDOM</code> <code class="nx">from</code> <code class="s2">"react-dom"</code><code class="p">;</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">FixedSizeList</code> <code class="nx">as</code> <code class="nx">List</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react-window"</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">itemsArray</code> <code class="o">=</code> <code class="p">[...];</code> <code class="c1">// our data</code>

<code class="kr">const</code> <code class="nx">Row</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">index</code><code class="p">,</code> <code class="nx">style</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">index</code> <code class="o">%</code> <code class="mi">2</code> <code class="o">?</code> <code class="s2">"ListItemOdd"</code> <code class="o">:</code> <code class="s2">"ListItemEven"</code><code class="p">}</code> <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">itemsArray</code><code class="p">[</code><code class="nx">index</code><code class="p">].</code><code class="nx">name</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">);</code>

<code class="kr">const</code> <code class="nx">Example</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">List</code>
    <code class="nx">className</code><code class="o">=</code><code class="s2">"List"</code>
    <code class="nx">height</code><code class="o">=</code><code class="p">{</code><code class="mi">150</code><code class="p">}</code>
    <code class="nx">itemCount</code><code class="o">=</code><code class="p">{</code><code class="nx">itemsArray</code><code class="p">.</code><code class="nx">length</code><code class="p">}</code>
    <code class="nx">itemSize</code><code class="o">=</code><code class="p">{</code><code class="mi">35</code><code class="p">}</code>
    <code class="nx">width</code><code class="o">=</code><code class="p">{</code><code class="mi">300</code><code class="p">}</code>
  <code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">Row</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="err">/List&gt;</code>
<code class="p">);</code>

<code class="nx">ReactDOM</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="o">&lt;</code><code class="nx">Example</code> <code class="o">/&gt;</code><code class="p">,</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"root"</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Grid"><div class="sect2" id="idm45017685102528">
<h2>Grid</h2>

<p>Grid renders tabular data with virtualization<a data-type="indexterm" data-primary="list virtualization" data-secondary="Grid" id="idm45017685101360"/> along the vertical and horizontal axes. It only renders the <code>Grid</code> cells needed to fill itself based on current horizontal/vertical scroll positions.</p>

<p>If we wanted to render the same list as earlier with a grid layout, assuming our input is a multidimensional array, we could accomplish this using <code>FixedSizeGrid</code> as 
<span class="keep-together">follows:</span></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">ReactDOM</code> <code class="nx">from</code> <code class="s1">'react-dom'</code><code class="p">;</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">FixedSizeGrid</code> <code class="nx">as</code> <code class="nx">Grid</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-window'</code><code class="p">;</code>

<code class="kr">const</code> <code class="nx">itemsArray</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">[{},{},{},...],</code>
  <code class="p">[{},{},{},...],</code>
  <code class="p">[{},{},{},...],</code>
  <code class="p">[{},{},{},...],</code>
<code class="p">];</code>

<code class="kr">const</code> <code class="nx">Cell</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">columnIndex</code><code class="p">,</code> <code class="nx">rowIndex</code><code class="p">,</code> <code class="nx">style</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code>
    <code class="nx">className</code><code class="o">=</code><code class="p">{</code>
      <code class="nx">columnIndex</code> <code class="o">%</code> <code class="mi">2</code>
        <code class="o">?</code> <code class="nx">rowIndex</code> <code class="o">%</code> <code class="mi">2</code> <code class="o">===</code> <code class="mi">0</code>
          <code class="o">?</code> <code class="s1">'GridItemOdd'</code>
          <code class="o">:</code> <code class="s1">'GridItemEven'</code>
        <code class="o">:</code> <code class="nx">rowIndex</code> <code class="o">%</code> <code class="mi">2</code>
          <code class="o">?</code> <code class="s1">'GridItemOdd'</code>
          <code class="o">:</code> <code class="s1">'GridItemEven'</code>
    <code class="p">}</code>
    <code class="nx">style</code><code class="o">=</code><code class="p">{</code><code class="nx">style</code><code class="p">}</code>
  <code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">itemsArray</code><code class="p">[</code><code class="nx">rowIndex</code><code class="p">][</code><code class="nx">columnIndex</code><code class="p">].</code><code class="nx">name</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="err">/div&gt;</code>
<code class="p">);</code>

<code class="kr">const</code> <code class="nx">Example</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">Grid</code>
    <code class="nx">className</code><code class="o">=</code><code class="s2">"Grid"</code>
    <code class="nx">columnCount</code><code class="o">=</code><code class="p">{</code><code class="mi">5</code><code class="p">}</code>
    <code class="nx">columnWidth</code><code class="o">=</code><code class="p">{</code><code class="mi">100</code><code class="p">}</code>
    <code class="nx">height</code><code class="o">=</code><code class="p">{</code><code class="mi">150</code><code class="p">}</code>
    <code class="nx">rowCount</code><code class="o">=</code><code class="p">{</code><code class="mi">5</code><code class="p">}</code>
    <code class="nx">rowHeight</code><code class="o">=</code><code class="p">{</code><code class="mi">35</code><code class="p">}</code>
    <code class="nx">width</code><code class="o">=</code><code class="p">{</code><code class="mi">300</code><code class="p">}</code>
  <code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">Cell</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="err">/Grid&gt;</code>
<code class="p">);</code>

<code class="nx">ReactDOM</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="o">&lt;</code><code class="nx">Example</code> <code class="o">/&gt;</code><code class="p">,</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'root'</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Improvements in the Web Platform"><div class="sect2" id="idm45017684831264">
<h2>Improvements in the Web Platform</h2>

<p>Some modern browsers now support<a data-type="indexterm" data-primary="list virtualization" data-secondary="CSS content-visibility in browsers" id="idm45017684830128"/><a data-type="indexterm" data-primary="browsers" data-secondary="CSS content-visibility support" id="idm45017684829216"/><a data-type="indexterm" data-primary="CSS (Cascading Style Sheets)" data-secondary="content-visibility support in browsers" id="idm45017684741840"/><a data-type="indexterm" data-primary="Cascading Style Sheets" data-see="CSS" id="idm45017684740960"/> <a href="https://oreil.ly/l-B70">CSS <code>content-visibility</code></a>. <code>content-visibility:auto</code> allows you to skip rendering and painting off-screen content until needed. Consider trying the property out if you have a lengthy HTML document with costly rendering.</p>

<p>For rendering lists of dynamic content, I still recommend using a library like 
<span class="keep-together"><code>react-window</code>.</span> It would be hard to have a <code>content-visbility:hidden</code> version of such a library that beats a version aggressively using <code>display:none</code> or removing DOM nodes when off-screen like many list virtualization libraries may do today.<a data-type="indexterm" data-startref="ch12-list" id="idm45017684736160"/><a data-type="indexterm" data-startref="ch12-list2" id="idm45017684735456"/></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Conclusions"><div class="sect1" id="idm45017684734400">
<h1>Conclusions</h1>

<p>Again, use preload sparingly<a data-type="indexterm" data-primary="Loading Prioritization pattern" data-secondary="preload used sparingly" id="idm45017684710096"/> and always measure its impact on production. If the preload for your image is earlier in the document than it is, this can help browsers discover it (and order relative to other resources). When misused, preloading can cause your image to delay FCP (e.g., CSS, fonts)—the opposite of what you want. Also note that for such reprioritization efforts to be effective, it also depends on servers prioritizing requests correctly.</p>

<p>You may also find <code>&lt;link rel="preload"&gt;</code> helpful<a data-type="indexterm" data-primary="preload browser optimization" data-secondary="web.dev article links" id="idm45017684708352"/><a data-type="indexterm" data-primary="Loading Prioritization pattern" data-secondary="web.dev article links" id="idm45017684707504"/><a data-type="indexterm" data-primary="resources online" data-secondary="preload articles" id="idm45017684706656"/> for cases where you need to fetch scripts without executing them.
A variety of the following <a href="https://oreil.ly/kgnfa">web.dev articles</a> touch on how to use preload to:</p>

<ul>
<li>
<p><a href="https://oreil.ly/bwZC9">Preload key scripts required for interactivity</a></p>
</li>
<li>
<p><a href="https://oreil.ly/4N3VO">Preload your LCP image</a></p>
</li>
<li>
<p><a href="https://oreil.ly/Up2iQ">Load fonts while preventing layout shifts</a></p>
</li>
</ul>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm45017684700736">
<h1>Summary</h1>

<p>In this chapter, we discussed some essential considerations that drive the architecture and design of modern web applications. We also saw the different ways in which React.js design patterns address these concerns.</p>

<p>Earlier in this chapter, we introduced the concepts of CSR, SSR, and hydration. JavaScript can have a significant impact on page performance. The choice of rendering techniques can affect how and when the JavaScript is loaded or executed in the page lifecycle. A discussion on Rendering patterns is thus significant when discussing JavaScript patterns and the topic of our next chapter.</p>
</div></section>
</div></section></div></body></html>