<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. Routing" class="calibre4"><div class="preface" id="chapter02">
<h1 class="calibre9"><span class="label">Chapter 2. </span>Routing</h1>


<p class="author1">This chapter looks at recipes using React routes and the <code class="calibre21">react-router-dom</code> library.<a data-type="indexterm" data-primary="routing" id="ix_route" class="calibre6"/></p>

<p class="author1"><code class="calibre21">react-router-dom</code> uses <em class="calibre7">declarative routing</em>, which means you treat routes as you would any other React component. <a data-type="indexterm" data-primary="declarative routing" id="idm46634432173240" class="calibre6"/>Unlike buttons,
text fields, and blocks of text, React routes have no visual appearance. But in most other ways, they are similar to buttons
and blocks of text. Routes live in the virtual DOM tree of components. They listen for changes in the current browser location and
allow you to switch on and switch off parts of the interface. They are what give SPAs the appearance of multipage applications.</p>

<p class="author1">Used well, they can make your application feel like any other website. Users will be able to bookmark sections of your application,
as they might bookmark a page from Wikipedia. They can go backward and forward in their browser history, and your interface will
behave properly. If you are new to React, then it is well worth your time to look deeply into the power of routing.</p>






<section data-type="sect1" data-pdf-bookmark="Create Interfaces with Responsive Routes" class="calibre4"><div class="preface" id="ch02-01">
<h1 class="calibre17">Create Interfaces with Responsive Routes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634432169624">
<h2 class="calibre27">Problem</h2>

<p class="author1">People use most applications on both mobile and laptop computers, which means you probably want your React application to work well
across all screen sizes. <a data-type="indexterm" data-primary="routing" data-secondary="creating interfaces with responsive routes" id="ix_rtecrint" class="calibre6"/>Making your application responsive involves relatively simple CSS changes to adjust the sizing of text and
screen layout, and more substantial changes, which can give mobile and desktop users very different experiences when navigating
around your site.</p>

<p class="author1">Our example application shows the names and addresses of a list of people. In <a data-type="xref" href="#ch02_image_1" class="calibre6">Figure 2-1</a>, you can see the application running on a
desktop machine.</p>

<figure class="calibre29"><div id="ch02_image_1" class="figure">
<img src="Images/recb_0201.png" alt="" class="calibre52"/>
<h6 class="calibre30"><span class="firstname">Figure 2-1. </span>The desktop view of the app</h6>
</div></figure>

<p class="author1">But this layout won’t work very well on a mobile device, which might have space to display either the list of people or the
details of one person, but not both.</p>

<p class="author1">What can we do in React to provide a custom navigation experience for both mobile and desktop users without creating two completely
separate versions of the 
<span class="firstname">application</span>?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634432140536">
<h2 class="calibre27">Solution</h2>

<p class="author1">We’re going to use <em class="calibre7">responsive routes</em>. A responsive route changes according to the size of the user’s display.<a data-type="indexterm" data-primary="responsive routes" id="ix_resrt" class="calibre6"/> Our existing
application uses a single route for displaying the information for a person: <em class="calibre7">/people/:id</em>.</p>

<p class="author1">When you navigate to this route, the browser shows the page in <a data-type="xref" href="#ch02_image_1" class="calibre6">Figure 2-1</a>. You can see the people listed down the left side.
The page highlights the selected person and displays their details on the right.</p>

<p class="author1">We’re going to modify our application to cope with an additional route at <em class="calibre7">/people</em>. Then we will make the routes responsive so
that the user will see different things on different devices:</p>
<table class="calibre10">

<thead class="calibre11">
<tr class="calibre12">
<th class="calibre13">Route</th>
<th class="calibre13">Mobile</th>
<th class="calibre13">Desktop</th>
</tr>
</thead>
<tbody class="calibre14">
<tr class="calibre12">
<td class="calibre15"><p class="author1">/people</p></td>
<td class="calibre15"><p class="author1">Shows list of people</p></td>
<td class="calibre15"><p class="author1">Redirects to <em class="calibre7">people</em>:someId</p></td>
</tr>
<tr class="calibre16">
<td class="calibre15"><p class="author1"><em class="calibre7">people</em>:id</p></td>
<td class="calibre15"><p class="author1">Shows details for :id</p></td>
<td class="calibre15"><p class="author1">Shows list of people and details of :id</p></td>
</tr>
</tbody>
</table>

<p class="author1">What ingredients will we need to do this? <a data-type="indexterm" data-primary="DOM" data-secondary="react-router-dom" id="idm46634432125160" class="calibre6"/><a data-type="indexterm" data-primary="react-router-dom" id="idm46634432124184" class="calibre6"/>First, we need to install <code class="calibre21">react-router-dom</code> if our application does not already have it:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install react-router-dom</code></pre>

<p class="author1">The <code class="calibre21">react-router-dom</code> library allows us to coordinate the browser’s current location with the state of our application.<a data-type="indexterm" data-primary="react-media" id="idm46634432099720" class="calibre6"/> Next, we
will install the <code class="calibre21">react-media</code> library, which allows us to create React components that respond to changes in the display screen
size:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install react-media</code></pre>

<p class="author1">Now we’re going to create a responsive <code class="calibre21">PeopleContainer</code> component that will manage the routes we want to create. On small screens,
our component will display <em class="calibre7">either</em> a list of people or the details of a single person. On large screens, it will show a combined
view of a list of people on the left and the details of a single person on the right.</p>

<p class="author1">The <code class="calibre21">PeopleContainer</code> will use the <code class="calibre21">Media</code> component from <code class="calibre21">react-media</code>.<a data-type="indexterm" data-primary="Media component" id="idm46634432120104" class="calibre6"/> The <code class="calibre21">Media</code> component performs a similar job to the CSS
<code class="calibre21">@media</code> rule: it allows you to generate output for a specified range of screen sizes. The <code class="calibre21">Media</code> component accepts a <code class="calibre21">queries</code>
property that allows you to specify a set of screen sizes. We’re going to define a single screen size—small—that we’ll use as the
break between mobile and desktop screens:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Media</code> <code class="na">queries</code><code class="o">=</code><code class="go">{{</code>
        <code class="nx">small</code><code class="o">:</code> <code class="s">"(max-width: 700px)"</code>
    <code class="go">}}&gt;</code>
  <code class="go">...</code>
<code class="go">&lt;/</code><code class="nt">Media</code><code class="go">&gt;</code></pre>

<p class="author1">The <code class="calibre21">Media</code> component takes a single child component, which it expects to be a function. This function is given a <code class="calibre21">size</code> object
that can be used to tell what the current screen size is. In our example, the <code class="calibre21">size</code> object will have a <code class="calibre21">small</code> attribute, which we
can use to decide what other components to display:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Media</code> <code class="na">queries</code><code class="o">=</code><code class="go">{{</code>
        <code class="nx">small</code><code class="o">:</code> <code class="s">"(max-width: 700px)"</code>
    <code class="go">}}&gt;</code>
  <code class="go">{</code>
    <code class="nx">size</code> <code class="o">=&gt;</code> <code class="nx">size</code><code class="go">.</code><code class="nx">small</code> <code class="o">?</code> <code class="go">[</code><code class="nx">SMALL</code> <code class="nx">SCREEN</code> <code class="nx">COMPONENTS</code><code class="go">]</code> <code class="o">:</code> <code class="go">[</code><code class="nx">BIG</code> <code class="nx">SCREEN</code> <code class="nx">COMPONENTS</code><code class="go">]</code>
  <code class="go">}</code>
<code class="go">&lt;/</code><code class="nt">Media</code><code class="go">&gt;</code></pre>

<p class="author1">Before we look at the details of what code we are going to return for large and small screens, it’s worth taking a look at how we
will mount the <code class="calibre21">PeopleContainer</code> in our application. The following code is going to be our main <code class="calibre21">App</code> component:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">BrowserRouter</code><code class="go">,</code> <code class="nx">Link</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">PeopleContainer</code> <code class="nx">from</code> <code class="s">'./PeopleContainer'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/people"</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">PeopleContainer</code> <code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Link</code> <code class="na">to</code><code class="o">=</code><code class="s">"/people"</code><code class="go">&gt;</code><code class="nx">People</code><code class="go">&lt;/</code><code class="nt">Link</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">We are using the <code class="calibre21">BrowserRouter</code> from <code class="calibre21">react-router-dom</code>, which links our code and the HTML5 history API in the browser.<a data-type="indexterm" data-primary="react-router-dom" data-secondary="BrowserRouter" id="idm46634432000632" class="calibre6"/><a data-type="indexterm" data-primary="BrowserRouter" id="idm46634431906312" class="calibre6"/> We need to
wrap all of our routes in a <code class="calibre21">Router</code> to give them access to the browser’s current address.</p>

<p class="author1">Inside the <code class="calibre21">BrowserRouter</code>, we have a <code class="calibre21">Switch</code>. The <code class="calibre21">Switch</code> looks at the components inside it, looking for a <code class="calibre21">Route</code> that matches
the current location. Here we have a single <code class="calibre21">Route</code> matching paths that begin with <em class="calibre7">/people</em>. If that’s true, we display the <code class="calibre21">PeopleCon⁠tainer</code>. <a data-type="indexterm" data-primary="PeopleContainer" id="idm46634431901192" class="calibre6"/>If no route matches, we fall through to the end of the <code class="calibre21">Switch</code> and render a <code class="calibre21">Link</code> to the <em class="calibre7">/people</em> path. So
when someone goes to the front page of the application, they see only a link to the <code class="calibre21">People</code> page.</p>
<div data-type="note" epub:type="note" class="calibre25">
<p class="author1">The code will match routes beginning with the specified <code class="calibre21">path</code>, unless the <code class="calibre21">exact</code> attribute is specified, in which case a
route will be displayed only if the entire path matches.</p>
</div>

<p class="author1">So we know if we’re in the <code class="calibre21">PeopleContainer</code>, we’re already on a route that begins with <em class="calibre7">/people/…</em>. If we’re on a small
screen, we need to either show a list of people or display the details of a single person, but not both. We can do this with
<code class="calibre21">Switch</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Media</code> <code class="na">queries</code><code class="o">=</code><code class="go">{{</code>
        <code class="nx">small</code><code class="o">:</code> <code class="s">"(max-width: 700px)"</code>
    <code class="go">}}&gt;</code>
  <code class="go">{</code>
    <code class="nx">size</code> <code class="o">=&gt;</code> <code class="nx">size</code><code class="go">.</code><code class="nx">small</code> <code class="o">?</code> <code class="go">[</code><code class="nx">SMALL</code> <code class="nx">SCREEN</code> <code class="nx">COMPONENTS</code><code class="go">]</code>
        <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/people/:id'</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Person</code><code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">PeopleList</code><code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="o">:</code> <code class="go">[</code><code class="nx">BIG</code> <code class="nx">SCREEN</code> <code class="nx">COMPONENTS</code><code class="go">]</code>
  <code class="go">}</code>
<code class="go">&lt;/</code><code class="nt">Media</code><code class="go">&gt;</code></pre>

<p class="author1">On a small device, the <code class="calibre21">Media</code> component will call its child function with a value that means <code class="calibre21">size.small</code> is <code class="calibre21">true</code>. Our code will
render a <code class="calibre21">Switch</code> that will show a <code class="calibre21">Person</code> component if the current path contains an <code class="calibre21">id</code>. Otherwise, the <code class="calibre21">Switch</code> will fail to
match that <code class="calibre21">Route</code> and will instead render a <code class="calibre21">PeopleList</code>.</p>

<p class="author1">Ignoring the fact that we’ve yet to write the code for large screens, if we were to run this code right now on a mobile device and
hit the <code class="calibre21">People</code> link on the front page, we would navigate to <em class="calibre7">people</em>, which could cause the application to render the
<code class="calibre21">PeopleList</code> component.<a data-type="indexterm" data-primary="PeopleList component" id="idm46634431791000" class="calibre6"/> The <code class="calibre21">PeopleList</code> component displays a set of links to people with paths of the form <em class="calibre7">/people/id</em>.<sup class="calibre34"><a data-type="noteref" id="idm46634431789304-marker" href="ch02.xhtml#idm46634431789304" class="calibre35">1</a></sup> When someone selects a person from the list, our components are re-rendered, and this
time <code class="calibre21">PeopleContainer</code> displays the details of a single person (see <a data-type="xref" href="#ch02_image_2" class="calibre6">Figure 2-2</a>).</p>

<figure class="calibre29"><div id="ch02_image_2" class="figure">
<img src="Images/recb_0202.png" alt="" class="calibre53"/>
<h6 class="calibre30"><span class="firstname">Figure 2-2. </span>In mobile view: the list of people (left) that links to a person’s details (right)</h6>
</div></figure>

<p class="author1">So far, so good. Now we need to make sure that our application still works for larger screens. We need to generate responsive routes
in <code class="calibre21">PeopleContainer</code> for when <code class="calibre21">size.small</code> is <code class="calibre21">false</code>. If the current route is of the form <em class="calibre7">/people/id</em>, we can display the
<code class="calibre21">PeopleList</code> component on the left and the <code class="calibre21">Person</code> component on the right:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">div</code> <code class="na">style</code><code class="o">=</code><code class="go">{{</code><code class="nx">display</code><code class="o">:</code> <code class="s">'flex'</code><code class="go">}}&gt;</code>
  <code class="go">&lt;</code><code class="nt">PeopleList</code><code class="go">/&gt;</code>
  <code class="go">&lt;</code><code class="nt">Person</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code></pre>

<p class="author1">Unfortunately, that doesn’t handle the case where the current path is <em class="calibre7">/people</em>. We need another <code class="calibre21">Switch</code> that either will
display the details for a single person or will <em class="calibre7">redirect</em> to <em class="calibre7">/people/first-person-id</em> for the first person in the list of
people.</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">div</code> <code class="na">style</code><code class="o">=</code><code class="go">{{</code><code class="nx">display</code><code class="o">:</code> <code class="s">'flex'</code><code class="go">}}&gt;</code>
    <code class="go">&lt;</code><code class="nt">PeopleList</code><code class="go">/&gt;</code>
    <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/people/:id'</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Person</code><code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="go">{</code><code class="err">`</code><code class="o">/</code><code class="nx">people</code><code class="o">/</code><code class="nx">$</code><code class="go">{</code><code class="nx">people</code><code class="go">[</code><code class="mi">0</code><code class="go">].</code><code class="nx">id</code><code class="go">}</code><code class="err">`</code><code class="go">}/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code></pre>

<p class="author1">The <code class="calibre21">Redirect</code> component doesn’t perform an <em class="calibre7">actual</em> browser redirect.<a data-type="indexterm" data-primary="Redirect component" id="idm46634431653976" class="calibre6"/> It simply updates the current path to
<em class="calibre7">/people/first-person-id</em>, which causes the <code class="calibre21">PeopleContainer</code> to re-render. It’s similar to making a call to
<code class="calibre21">history.push()</code> in JavaScript, except it doesn’t add an extra page to the browser history. If a person navigates to <em class="calibre7">/people</em>,
the browser will simply change its location to <em class="calibre7">/people/first-person-id</em>.</p>

<p class="author1">If we were now to go to <em class="calibre7">/people</em> on a laptop or larger tablet, we would see the list of people next to the details for the
first person (<a data-type="xref" href="#ch02_image_3" class="calibre6">Figure 2-3</a>).</p>

<figure class="calibre29"><div id="ch02_image_3" class="figure">
<img src="Images/recb_0203.png" alt="" class="calibre54"/>
<h6 class="calibre30"><span class="firstname">Figure 2-3. </span>What you see at <span class="firstname">http://localhost:3000/people</span> on a large display</h6>
</div></figure>

<p class="author1">Here is the final version of our <code class="calibre21">PeopleContainer</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">Media</code> <code class="nx">from</code> <code class="s">'react-media'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">Redirect</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">Person</code> <code class="nx">from</code> <code class="s">'./Person'</code>
<code class="kr">import</code> <code class="nx">PeopleList</code> <code class="nx">from</code> <code class="s">'./PeopleList'</code>
<code class="kr">import</code> <code class="nx">people</code> <code class="nx">from</code> <code class="s">'./people'</code>

<code class="kr">const</code> <code class="nx">PeopleContainer</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">Media</code>
      <code class="na">queries</code><code class="o">=</code><code class="go">{{</code>
        <code class="nx">small</code><code class="o">:</code> <code class="s">'(max-width: 700px)'</code><code class="go">,</code>
      <code class="go">}}</code>
    <code class="go">&gt;</code>
      <code class="go">{(</code><code class="nx">size</code><code class="go">)</code> <code class="o">=&gt;</code>
        <code class="nx">size</code><code class="go">.</code><code class="nx">small</code> <code class="o">?</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/people/:id"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Person</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">PeopleList</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="go">)</code> <code class="o">:</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code> <code class="na">style</code><code class="o">=</code><code class="go">{{</code> <code class="nx">display</code><code class="o">:</code> <code class="s">'flex'</code> <code class="go">}}&gt;</code>
            <code class="go">&lt;</code><code class="nt">PeopleList</code> <code class="go">/&gt;</code>
            <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/people/:id"</code><code class="go">&gt;</code>
                <code class="go">&lt;</code><code class="nt">Person</code> <code class="go">/&gt;</code>
              <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="go">{</code><code class="err">`</code><code class="o">/</code><code class="nx">people</code><code class="o">/</code><code class="nx">$</code><code class="go">{</code><code class="nx">people</code><code class="go">[</code><code class="mi">0</code><code class="go">].</code><code class="nx">id</code><code class="go">}</code><code class="err">`</code><code class="go">}</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
          <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">)</code>
      <code class="go">}</code>
    <code class="go">&lt;/</code><code class="nt">Media</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">PeopleContainer</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634432139592">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Declarative routing inside components can seem an odd thing when you first meet it. Suppose you’ve used a centralized routing model
before. In that case, declarative routes may at first seem messy because they spread the wiring of your application across several
components rather than in a single file. Instead of creating clean components that know nothing of the outside world, you are
suddenly giving the intimate knowledge of the paths used in the application, which might make them less portable.</p>

<p class="author1">However, responsive routes show the real power of declarative routing. If you’re concerned about your components knowing too much
about the paths in your application, consider extracting the path strings into a shared file. That way, you will have the best of
both worlds: components that modify their behavior based upon the current path and a centralized set of path configurations.<a data-type="indexterm" data-primary="responsive routes" data-startref="ix_resrt" id="idm46634431641400" class="calibre6"/></p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/tZzMD" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="routing" data-secondary="creating interfaces with responsive routes" data-startref="ix_rtecrint" id="idm46634431431800" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Move State into Routes" class="calibre4"><div class="preface" id="ch02-02">
<h1 class="calibre17">Move State into Routes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634431428744">
<h2 class="calibre27">Problem</h2>

<p class="author1">It is often helpful to manage the internal state of a component using the route that displays it.<a data-type="indexterm" data-primary="state" data-secondary="moving into routes" id="ix_stmvrt" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-secondary="moving state into routes" id="ix_rtemvst" class="calibre6"/> For example, this is a React
component that displays two tabs of information: one for <em class="calibre7">/people</em> and one for <em class="calibre7">/offices</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">People</code> <code class="nx">from</code> <code class="s">'./People'</code>
<code class="kr">import</code> <code class="nx">Offices</code> <code class="nx">from</code> <code class="s">'./Offices'</code>

<code class="kr">import</code> <code class="s">'./About.css'</code>

<code class="kr">const</code> <code class="nx">OldAbout</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">tabId</code><code class="go">,</code> <code class="nx">setTabId</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="s">'people'</code><code class="go">)</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About-tabs"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">div</code>
          <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setTabId</code><code class="go">(</code><code class="s">'people'</code><code class="go">)}</code>
          <code class="na">className</code><code class="o">=</code><code class="go">{</code>
            <code class="nx">tabId</code> <code class="o">===</code> <code class="s">'people'</code> <code class="o">?</code> <code class="s">'About-tab active'</code> <code class="o">:</code> <code class="s">'About-tab'</code>
          <code class="go">}</code>
        <code class="go">&gt;</code>
          <code class="nx">People</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">div</code>
          <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setTabId</code><code class="go">(</code><code class="s">'offices'</code><code class="go">)}</code>
          <code class="na">className</code><code class="o">=</code><code class="go">{</code>
            <code class="nx">tabId</code> <code class="o">===</code> <code class="s">'offices'</code> <code class="o">?</code> <code class="s">'About-tab active'</code> <code class="o">:</code> <code class="s">'About-tab'</code>
          <code class="go">}</code>
        <code class="go">&gt;</code>
          <code class="nx">Offices</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">'people'</code> <code class="o">&amp;&amp;</code> <code class="go">&lt;</code><code class="nt">People</code> <code class="go">/&gt;}</code>
      <code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">'offices'</code> <code class="o">&amp;&amp;</code> <code class="go">&lt;</code><code class="nt">Offices</code> <code class="go">/&gt;}</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">OldAbout</code></pre>

<p class="author1">When a user clicks a tab, an internal <code class="calibre21">tabId</code> variable is updated, and the <code class="calibre21">People</code> or <code class="calibre21">Offices</code> component is displayed (see <a data-type="xref" href="#ch02_image_4" class="calibre6">Figure 2-4</a>).</p>

<figure class="calibre29"><div id="ch02_image_4" class="figure">
<img src="Images/recb_0204.png" alt="" class="calibre55"/>
<h6 class="calibre30"><span class="firstname">Figure 2-4. </span>By default, the OldAbout component shows people’s details</h6>
</div></figure>

<p class="author1">What’s the problem? The component works, but if we select the Offices tab and then refresh the page, the component resets to the
People tab. Likewise, we can’t bookmark the page when it’s on the Offices tab. We can’t create a link anywhere else in the
application, which takes us directly to Offices. Accessibility hardware is less likely to notice that the tabs are working as
hyperlinks because they are not rendered in that way.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634431217720">
<h2 class="calibre27">Solution</h2>

<p class="author1">We are going to move the <code class="calibre21">tabId</code> state from the component into the current browser location. So instead of rendering the component
at <em class="calibre7">/about</em> and then using <code class="calibre21">onClick</code> events to change the internal state, we are instead going to have routes to
<em class="calibre7">/about/people</em> and <em class="calibre7">/about/offices</em>, which display one tab or the other. The tab selection will survive a browser
refresh. We can bookmark the page on a given tab or create a link to a given tab.<a data-type="indexterm" data-primary="react-router-dom" id="idm46634431213272" class="calibre6"/><a data-type="indexterm" data-primary="DOM" data-secondary="react-router-dom" id="idm46634431212568" class="calibre6"/> And we make the tabs actual hyperlinks, which will
be recognized as such by anyone navigating with a keyboard or screen reader.</p>

<p class="author1">What ingredients do we need? Just one: <code class="calibre21">react-router-dom</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install react-router-dom</code></pre>

<p class="author1"><code class="calibre21">react-router-dom</code> will allow us to synchronize the current browser URL with the components that we render on the screen.</p>

<p class="author1">Our existing application is already using <code class="calibre21">react-router-dom</code> to display the <code class="calibre21">OldAbout</code> component at path <em class="calibre7">/oldabout</em> as you can
see from this fragment of code from the <em class="calibre7">App.js</em> file:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/oldabout"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">OldAbout</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Choose</code> <code class="nx">an</code> <code class="nx">option</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code></pre>

<p class="author1">You can see the complete code for this file at the <a href="https://oreil.ly/WmZ18" class="calibre6">GitHub repository</a>.</p>

<p class="author1">We’re going to create a new version of the <code class="calibre21">OldAbout</code> component called <code class="calibre21">About</code>, and we’re going to mount it at its own route:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/oldabout"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">OldAbout</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/:tabId?"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">About</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Choose</code> <code class="nx">an</code> <code class="nx">option</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code></pre>

<p class="author1">This addition allows us to open both versions of the code in the example application.</p>

<p class="author1">Our new version is going to appear to be virtually identical to the old component. We’ll extract the <code class="calibre21">tabId</code> from the component and
move it into the current path.</p>

<p class="author1">Setting the path of the <code class="calibre21">Route</code> to <em class="calibre7">/about/:tabId?</em> means that  
<span class="firstname"><em class="calibre7">/about</em></span>, 
<span class="firstname"><em class="calibre7">/about/offices</em></span>, and 
<span class="firstname"><em class="calibre7">/about/people</em></span> will all mount our component. The <code class="calibre21">?</code> indicates that the <code class="calibre21">tabId</code> parameter is optional.</p>

<p class="author1">We’ve now done the first part: we’ve put the component’s state into the path that displays it. We now need to update the component
to interact with the route rather than an internal state variable.</p>

<p class="author1">In the <code class="calibre21">OldAbout</code> component, we had <code class="calibre21">onClick</code> listeners on each of the tabs:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">div</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setTabId</code><code class="go">(</code><code class="s">"people"</code><code class="go">)}</code>
     <code class="na">className</code><code class="o">=</code><code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">"people"</code> <code class="o">?</code> <code class="s">"About-tab active"</code> <code class="o">:</code> <code class="s">"About-tab"</code><code class="go">}</code>
<code class="go">&gt;</code>
    <code class="nx">People</code>
<code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
<code class="go">&lt;</code><code class="nt">div</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setTabId</code><code class="go">(</code><code class="s">"offices"</code><code class="go">)}</code>
     <code class="na">className</code><code class="o">=</code><code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">"offices"</code> <code class="o">?</code> <code class="s">"About-tab active"</code> <code class="o">:</code> <code class="s">"About-tab"</code><code class="go">}</code>
<code class="go">&gt;</code>
    <code class="nx">Offices</code>
<code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code></pre>

<p class="author1">We’re going to convert these into <code class="calibre21">Link</code> components, going to <em class="calibre7">/about/people</em> and 
<span class="firstname"><em class="calibre7">/about/offices</em></span>.<a data-type="indexterm" data-primary="Link components" data-secondary="NavLink" id="idm46634430968136" class="calibre6"/><a data-type="indexterm" data-primary="NavLink components" id="idm46634430967160" class="calibre6"/> In fact, we’re
going to convert them into <code class="calibre21">NavLink</code> components. A <code class="calibre21">NavLink</code> is like a link, except it has the ability to set an additional class
name, if the place it’s linking to is the current location. This means we don’t need the <code class="calibre21">className</code> logic in the original code:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">NavLink</code> <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code>
         <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
         <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code><code class="go">&gt;</code>
    <code class="nx">People</code>
<code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
<code class="go">&lt;</code><code class="nt">NavLink</code> <code class="na">to</code><code class="o">=</code><code class="s">"/about/offices"</code>
         <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
         <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code><code class="go">&gt;</code>
    <code class="nx">Offices</code>
<code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code></pre>

<p class="author1">We no longer set the value of a <code class="calibre21">tabId</code> variable. We instead go to a new location with a new <code class="calibre21">tabId</code> value in the path.</p>

<p class="author1">But what do we do to read the <code class="calibre21">tabId</code> value? The <code class="calibre21">OldAbout</code> code displays the current tab contents like this:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">"people"</code> <code class="o">&amp;&amp;</code> <code class="go">&lt;</code><code class="nt">People</code><code class="go">/&gt;}</code>
<code class="go">{</code><code class="nx">tabId</code> <code class="o">===</code> <code class="s">"offices"</code> <code class="o">&amp;&amp;</code> <code class="go">&lt;</code><code class="nt">Offices</code><code class="go">/&gt;}</code></pre>

<p class="author1">This code can be replaced with a <code class="calibre21">Switch</code> and a couple of <code class="calibre21">Route</code> components:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/about/people'</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">People</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/about/offices'</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Offices</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code></pre>

<p class="author1">We’re now <em class="calibre7">almost</em> finished. There’s just one step remaining: deciding what to do if the path is <em class="calibre7">/about</em> and contains no
<code class="calibre21">tabId</code>.</p>

<p class="author1">The <code class="calibre21">OldAbout</code> sets a default value for <code class="calibre21">tabId</code> when it first creates the state:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">const</code> <code class="go">[</code><code class="nx">tabId</code><code class="go">,</code> <code class="nx">setTabId</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="s">"people"</code><code class="go">)</code></pre>

<p class="author1">We can achieve the same effect by adding a <code class="calibre21">Redirect</code> to the end of our <code class="calibre21">Switch</code>. <a data-type="indexterm" data-primary="Redirect component" data-secondary="adding to end of Switch" id="idm46634430736728" class="calibre6"/>The <code class="calibre21">Switch</code> will process its child components in order until it finds a matching <code class="calibre21">Route</code>. If no <code class="calibre21">Route</code> matches the current path, it will reach the <code class="calibre21">Redirect</code>, which will
change the address to <em class="calibre7">/about/people</em>. This will cause a re-render of the <code class="calibre21">About</code> component, and the People tab will be
selected by default:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/about/people'</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">People</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/about/offices'</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Offices</code><code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="s">'/about/people'</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code></pre>
<div data-type="note" epub:type="note" class="calibre25">
<p class="author1">You can make <code class="calibre21">Redirect</code> conditional on the current path by giving it a <code class="calibre21">from</code> attribute. In this case, we could set <code class="calibre21">from</code> to
<code class="calibre21">/about</code> so that only routes matching <code class="calibre21">/about</code> are redirected to <code class="calibre21">/about/people</code>.</p>
</div>

<p class="author1">This is our completed <code class="calibre21">About</code> component:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">NavLink</code><code class="go">,</code> <code class="nx">Redirect</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="s">'./About.css'</code>
<code class="kr">import</code> <code class="nx">People</code> <code class="nx">from</code> <code class="s">'./People'</code>
<code class="kr">import</code> <code class="nx">Offices</code> <code class="nx">from</code> <code class="s">'./Offices'</code>

<code class="kr">const</code> <code class="nx">About</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About"</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About-tabs"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">NavLink</code>
        <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code>
        <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
        <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
      <code class="go">&gt;</code>
        <code class="nx">People</code>
      <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">NavLink</code>
        <code class="na">to</code><code class="o">=</code><code class="s">"/about/offices"</code>
        <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
        <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
      <code class="go">&gt;</code>
        <code class="nx">Offices</code>
      <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/people"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">People</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/offices"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Offices</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code> <code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
  <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
<code class="go">)</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">About</code></pre>

<p class="author1">We no longer need an internal <code class="calibre21">tabId</code> variable, and we now have a purely declarative component (see <a data-type="xref" href="#ch02_image_5" class="calibre6">Figure 2-5</a>).</p>

<figure class="calibre29"><div id="ch02_image_5" class="figure">
<img src="Images/recb_0205.png" alt="" class="calibre56"/>
<h6 class="calibre30"><span class="firstname">Figure 2-5. </span>Going to <span class="firstname">http://localhost/about/offices</span> with the new component</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634431216776">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Moving state out of your components and into the address bar can simplify your code, but this is merely a fortunate side effect. The
real value is that your application starts to behave less like an application and more like a website. We can bookmark pages, and
the browser’s Back and Forward buttons work correctly. Managing more state in routes is not an abstract design decision; it’s a way
of making your application less surprising to users.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/myAGj" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="state" data-secondary="moving into routes" data-startref="ix_stmvrt" id="idm46634430511432" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-secondary="moving state into routes" data-startref="ix_rtemvst" id="idm46634430510152" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Use MemoryRouter for Unit Testing" class="calibre4"><div class="preface" id="ch02-03">
<h1 class="calibre17">Use MemoryRouter for Unit Testing</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634430507240">
<h2 class="calibre27">Problem</h2>

<p class="author1">We use routes in React applications so that we make more of the facilities of the browser. <a data-type="indexterm" data-primary="testing" data-secondary="using MemoryRouter for unit testing" id="ix_tstMemRt" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-secondary="using MemoryRouter for unit testing" id="ix_rteMemRt" class="calibre6"/><a data-type="indexterm" data-primary="MemoryRouter, using for unit testing" id="ix_MemRte" class="calibre6"/>We can bookmark pages, create deep links
into an app, and go backward and forward in history.</p>

<p class="author1">However, once we use routes, we make the component dependent upon something outside itself: the browser location. That might not
seem like too big an issue, but it does have consequences.</p>

<p class="author1">Let’s say we want to unit test a route-aware component. As an example, let’s create a unit test for the <code class="calibre21">About</code> component we built
in <a data-type="xref" href="#ch02-02" class="calibre6">“Move State into Routes”</a>:<sup class="calibre34"><a data-type="noteref" id="idm46634430499464-marker" href="ch02.xhtml#idm46634430499464" class="calibre35">2</a></sup></p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">describe</code><code class="go">(</code><code class="s">'About component'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">it</code><code class="go">(</code><code class="s">'should show people'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">render</code><code class="go">(&lt;</code><code class="nt">About</code> <code class="go">/&gt;)</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">screen</code><code class="go">.</code><code class="nx">getByText</code><code class="go">(</code><code class="s">'Kip Russel'</code><code class="go">)).</code><code class="nx">toBeInTheDocument</code><code class="go">()</code>
  <code class="go">})</code>
<code class="go">})</code></pre>

<p class="author1">This unit test renders the component and then checks that it can find the name “Kip Russel” appearing in the output. When we run
this test, we get the following error:</p>

<pre data-type="programlisting" data-code-language="text" class="calibre28">console.error node_modules/jsdom/lib/jsdom/virtual-console.js:29
    Error: Uncaught [Error: Invariant failed: You should not use &lt;NavLink&gt;
        outside a &lt;Router&gt;]</pre>

<p class="author1">The error occurred because a <code class="calibre21">NavLink</code> could not find a <code class="calibre21">Router</code> higher in the component tree. That means we need to wrap the
component in a <code class="calibre21">Router</code> before we test it.</p>

<p class="author1">Also, we might want to write a unit test that checks that the <code class="calibre21">About</code> component works when we mount it on a specific route. Even if
we provide a <code class="calibre21">Router</code> component, how will we fake a particular route?</p>

<p class="author1">It’s not just an issue with unit tests. If we’re using a library tool like Storybook,<sup class="calibre34"><a data-type="noteref" id="idm46634430461864-marker" href="ch02.xhtml#idm46634430461864" class="calibre35">3</a></sup> we might
want to show an example of how a component appears when we mount it on a given path.</p>

<p class="author1">We need something like an actual browser router but that allows us to specify its behavior.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634430506616">
<h2 class="calibre27">Solution</h2>

<p class="author1">The <code class="calibre21">react-router-dom</code> library provides just such a router: <code class="calibre21">MemoryRouter</code>. The 
<span class="firstname"><code class="calibre21">MemoryRouter</code></span> appears <a data-type="indexterm" data-primary="react-router-dom" data-secondary="MemoryRouter" id="idm46634430436760" class="calibre6"/>to the outside world just
like <code class="calibre21">BrowserRouter</code>. The difference is that while the <code class="calibre21">BrowserRouter</code> is an interface to the underlying browser history API, the
<code class="calibre21">MemoryRouter</code> has no such dependency.<a data-type="indexterm" data-primary="BrowserRouter" data-secondary="MemoryRouter versus" id="idm46634430434440" class="calibre6"/> It can keep track of the current location, and it can go backward and forward in history, but
it achieves this through simple memory structures.</p>

<p class="author1">Let’s take another look at that failing unit test. Instead of just rendering the <code class="calibre21">About</code> component, let’s wrap it in a
<code class="calibre21">MemoryRouter</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">describe</code><code class="go">(</code><code class="s">'About component'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">it</code><code class="go">(</code><code class="s">'should show people'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">render</code><code class="go">(</code>
      <code class="go">&lt;</code><code class="nt">MemoryRouter</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">About</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">MemoryRouter</code><code class="go">&gt;</code>
    <code class="go">)</code>

    <code class="nx">expect</code><code class="go">(</code><code class="nx">screen</code><code class="go">.</code><code class="nx">getByText</code><code class="go">(</code><code class="s">'Kip Russel'</code><code class="go">)).</code><code class="nx">toBeInTheDocument</code><code class="go">()</code>
  <code class="go">})</code>
<code class="go">})</code></pre>

<p class="author1">Now, when we run the test, it works. That’s because the <code class="calibre21">MemoryRouter</code> injects a mocked-up version of the API into the context. That
makes it available to all of its child components. The <code class="calibre21">About</code> component can now render a <code class="calibre21">Link</code> or <code class="calibre21">Route</code> because the history is
available.<a data-type="indexterm" data-primary="Link components" id="idm46634430341496" class="calibre6"/></p>

<p class="author1">But the <code class="calibre21">MemoryRouter</code> has an additional advantage.<a data-type="indexterm" data-primary="history" data-secondary="MemoryRouter faking browser history API" id="idm46634430339960" class="calibre6"/> Because it’s faking the browser history API, it can be given a completely fake
history, using the <code class="calibre21">initialEntries</code> property. The <code class="calibre21">initialEntries</code> property should be set to an array of history entries. If you
pass a single value array, it will be interpreted as the current location. That allows you to write unit tests that check for
component behavior when it’s mounted on a given route:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">describe</code><code class="go">(</code><code class="s">'About component'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">it</code><code class="go">(</code><code class="s">'should show offices if in route'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">render</code><code class="go">(</code>
      <code class="go">&lt;</code><code class="nt">MemoryRouter</code> <code class="na">initialEntries</code><code class="o">=</code><code class="go">{[{</code> <code class="nx">pathname</code><code class="o">:</code> <code class="s">'/about/offices'</code> <code class="go">}]}&gt;</code>
        <code class="go">&lt;</code><code class="nt">About</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">MemoryRouter</code><code class="go">&gt;</code>
    <code class="go">)</code>

    <code class="nx">expect</code><code class="go">(</code><code class="nx">screen</code><code class="go">.</code><code class="nx">getByText</code><code class="go">(</code><code class="s">'South Dakota'</code><code class="go">)).</code><code class="nx">toBeInTheDocument</code><code class="go">()</code>
  <code class="go">})</code>
<code class="go">})</code></pre>

<p class="author1">We can use a real <code class="calibre21">BrowserRouter</code> inside<a data-type="indexterm" data-primary="Storybook" data-secondary="using BrowserMemory in" id="idm46634430263112" class="calibre6"/> Storybook because we’re in a real browser, but the <code class="calibre21">MemoryRouter</code> also allows us to fake the current location, as we do in the 
<span class="firstname"><code class="calibre21">ToAboutOffices</code></span> Storybook story (see <a data-type="xref" href="#ch02_image_6" class="calibre6">Figure 2-6</a>).</p>

<figure class="calibre29"><div id="ch02_image_6" class="figure">
<img src="Images/recb_0206.png" alt="" class="calibre44"/>
<h6 class="calibre30"><span class="firstname">Figure 2-6. </span>Using MemoryRouter, we can fake the 
<span class="firstname">/about/offices</span> route</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634430257384">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Routers let you separate the details of <em class="calibre7">where</em> you want to go from <em class="calibre7">how</em> you’re going to get there. In this recipe, we see one
advantage of this separation: we can create a fake browser location to examine component behavior on different routes. This
separation allows you to change the way the application follows links without breaking.<a data-type="indexterm" data-primary="server-side rendering" data-secondary="converting SPA to SSR application" id="idm46634430254680" class="calibre6"/> If you convert your SPA
to an SSR application, you swap your <code class="calibre21">BrowserRouter</code> for a 
<span class="firstname"><code class="calibre21">StaticRouter</code></span>.<a data-type="indexterm" data-primary="StaticRouter" id="idm46634430252344" class="calibre6"/> The links used to make calls into the
browser’s history API will become native hyperlinks that cause the browser to make native page loads. Routers are an excellent
example of the advantages of splitting policy (what you want to do) from mechanisms (how you’re going to do it).</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/1NW8e" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="routing" data-secondary="using MemoryRouter for unit testing" data-startref="ix_rteMemRt" id="idm46634430250200" class="calibre6"/><a data-type="indexterm" data-primary="MemoryRouter, using for unit testing" data-startref="ix_MemRte" id="idm46634430248952" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Use Prompt for Page Exit Confirmations" class="calibre4"><div class="preface" id="ch02-04">
<h1 class="calibre17">Use Prompt for Page Exit Confirmations</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634430246360">
<h2 class="calibre27">Problem</h2>

<p class="author1">Sometimes you need to ask a user to confirm that they want to leave a page if they’re in the middle of editing something.<a data-type="indexterm" data-primary="routing" data-secondary="using Prompt for page exit confirmations" id="ix_rtePrmpt" class="calibre6"/><a data-type="indexterm" data-primary="page exit confirmations, using Prompt for" id="ix_pgeexit" class="calibre6"/><a data-type="indexterm" data-primary="Prompt component, using for page exit confirmations" id="ix_prmpt" class="calibre6"/> This
seemingly simple task can be complicated because it relies on spotting when the user clicks the Back button and then finding a way
to intercept the move back through history and potentially canceling it (see <a data-type="xref" href="#ch02_image_7" class="calibre6">Figure 2-7</a>).</p>

<figure class="calibre29"><div id="ch02_image_7" class="figure">
<img src="Images/recb_0207.png" alt="" class="calibre57"/>
<h6 class="calibre30"><span class="firstname">Figure 2-7. </span>Asking for a confirmation before leaving</h6>
</div></figure>

<p class="author1">What if there are several pages in the application that need the same feature? Is there a simple way to create this feature across
any component that needs it?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634430237592">
<h2 class="calibre27">Solution</h2>

<p class="author1">The <code class="calibre21">react-router-dom</code> library includes a component called <code class="calibre21">Prompt</code>, which asks users to confirm that they want to leave a page.<a data-type="indexterm" data-primary="react-router-dom" data-secondary="Prompt component" id="idm46634430234680" class="calibre6"/></p>

<p class="author1">The only ingredient we need for this recipe is the <code class="calibre21">react-router-dom</code> library itself:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">npm</code> <code class="nx">install</code> <code class="nx">react</code><code class="o">-</code><code class="nx">router</code><code class="o">-</code><code class="nx">dom</code></pre>

<p class="author1">Let’s say we have a component called <code class="calibre21">Important</code> mounted at <em class="calibre7">/important</em>, which allows a user to edit a piece of text:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code><code class="go">,</code> <code class="go">{</code> <code class="nx">useEffect</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">Important</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="nx">initialValue</code> <code class="o">=</code> <code class="s">'Initial value'</code>

  <code class="kr">const</code> <code class="go">[</code><code class="nx">data</code><code class="go">,</code> <code class="nx">setData</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="nx">initialValue</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">dirty</code><code class="go">,</code> <code class="nx">setDirty</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>

  <code class="nx">useEffect</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">if</code> <code class="go">(</code><code class="nx">data</code> <code class="o">!==</code> <code class="nx">initialValue</code><code class="go">)</code> <code class="go">{</code>
      <code class="nx">setDirty</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
    <code class="go">}</code>
  <code class="go">},</code> <code class="go">[</code><code class="nx">data</code><code class="go">,</code> <code class="nx">initialValue</code><code class="go">])</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"Important"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">textarea</code>
        <code class="na">onChange</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setData</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">)}</code>
        <code class="na">cols</code><code class="o">=</code><code class="go">{</code><code class="mi">40</code><code class="go">}</code>
        <code class="na">rows</code><code class="o">=</code><code class="go">{</code><code class="mi">12</code><code class="go">}</code>
      <code class="go">&gt;</code>
        <code class="go">{</code><code class="nx">data</code><code class="go">}</code>
      <code class="go">&lt;/</code><code class="nt">textarea</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">br</code> <code class="go">/&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setDirty</code><code class="go">(</code><code class="kr">false</code><code class="go">)}</code> <code class="na">disabled</code><code class="o">=</code><code class="go">{</code><code class="o">!</code><code class="nx">dirty</code><code class="go">}&gt;</code>
        <code class="nx">Save</code>
      <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">Important</code></pre>

<p class="author1"><code class="calibre21">Important</code> is already tracking whether the text in the <code class="calibre21">textarea</code> has changed from the original value. If the text is different,
the value of <code class="calibre21">dirty</code> is <code class="calibre21">true</code>. How do we ask the user to confirm they want to leave the page if they click the Back button when
<code class="calibre21">dirty</code> is <code class="calibre21">true</code>?</p>

<p class="author1">We add a <code class="calibre21">Prompt</code> component:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">return</code> <code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"Important"</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">textarea</code>
      <code class="na">onChange</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setData</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">)}</code>
      <code class="na">cols</code><code class="o">=</code><code class="go">{</code><code class="mi">40</code><code class="go">}</code>
      <code class="na">rows</code><code class="o">=</code><code class="go">{</code><code class="mi">12</code><code class="go">}</code>
    <code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">data</code><code class="go">}</code>
    <code class="go">&lt;/</code><code class="nt">textarea</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">br</code> <code class="go">/&gt;</code>
    <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setDirty</code><code class="go">(</code><code class="kr">false</code><code class="go">)}</code> <code class="na">disabled</code><code class="o">=</code><code class="go">{</code><code class="o">!</code><code class="nx">dirty</code><code class="go">}&gt;</code>
      <code class="nx">Save</code>
    <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Prompt</code>
      <code class="na">when</code><code class="o">=</code><code class="go">{</code><code class="nx">dirty</code><code class="go">}</code>
      <code class="na">message</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="s">'Do you really want to leave?'</code><code class="go">}</code>
    <code class="go">/&gt;</code>
  <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
<code class="go">)</code></pre>

<p class="author1">If the user edits the text and then hits the Back button, the <code class="calibre21">Prompt</code> appears (see <a data-type="xref" href="#ch02_image_8" class="calibre6">Figure 2-8</a>).</p>

<figure class="calibre29"><div id="ch02_image_8" class="figure">
<img src="Images/recb_0207.png" alt="" class="calibre57"/>
<h6 class="calibre30"><span class="firstname">Figure 2-8. </span>The <code class="calibre21">Prompt</code> asks the user to confirm they want to leave</h6>
</div></figure>

<p class="author1">Adding the confirmation is easy, but the default prompt interface is a simple JavaScript dialog. It would be helpful to decide for
ourselves how we want the user to confirm they’re leaving.</p>

<p class="author1">To demonstrate how we can do this, let’s add the Material-UI component library to the application:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install '@material-ui/core'</code></pre>

<p class="author1">The Material-UI library is a React implementation of Google’s Material Design standard.<a data-type="indexterm" data-primary="Material-UI library" id="idm46634429935736" class="calibre6"/> We’ll use it as an example of how to replace
the standard <code class="calibre21">Prompt</code> interface with something more customized.</p>

<p class="author1">The <code class="calibre21">Prompt</code> component does not render any UI. Instead, the <code class="calibre21">Prompt</code> component asks the current <code class="calibre21">Router</code> to show the confirmation.
By default, <code class="calibre21">BrowserRouter</code> shows the default JavaScript dialog, but you can replace this with your own code.</p>

<p class="author1">When the <code class="calibre21">BrowserRouter</code> is added to the component tree, we can pass it a property called <code class="calibre21">getUserConfirmation</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">BrowserRouter</code>
        <code class="na">getUserConfirmation</code><code class="o">=</code><code class="go">{(</code><code class="nx">message</code><code class="go">,</code> <code class="nx">callback</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="c">// Custom code goes here</code>
        <code class="go">}}</code>
    <code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">'/important'</code><code class="go">&gt;</code>
                <code class="go">&lt;</code><code class="nt">Important</code><code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code></pre>

<p class="author1">The <code class="calibre21">getUserConfirmation</code> property is a function that accepts two parameters: the message it should display and a callback function.</p>

<p class="author1">When the user clicks the Back button, the <code class="calibre21">Prompt</code> component will run <code class="calibre21">getUserCon⁠firmation</code> and then wait for the callback function
to be called with the value <code class="calibre21">true</code> or <code class="calibre21">false</code>.</p>

<p class="author1">The callback function returns the user’s response asynchronously. The <code class="calibre21">Prompt</code> component will wait while we ask the user what they
want to do. That allows us to create a custom interface.</p>

<p class="author1">Let’s create a custom Material-UI dialog called <code class="calibre21">Alert</code>.<a data-type="indexterm" data-primary="Alert component" id="idm46634429743624" class="calibre6"/><a data-type="indexterm" data-primary="Material-UI library" data-secondary="creating custom Alert dialog" id="idm46634429743000" class="calibre6"/> We’ll show this instead of the default JavaScript modal:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s">'@material-ui/core/Button'</code>
<code class="kr">import</code> <code class="nx">Dialog</code> <code class="nx">from</code> <code class="s">'@material-ui/core/Dialog'</code>
<code class="kr">import</code> <code class="nx">DialogActions</code> <code class="nx">from</code> <code class="s">'@material-ui/core/DialogActions'</code>
<code class="kr">import</code> <code class="nx">DialogContent</code> <code class="nx">from</code> <code class="s">'@material-ui/core/DialogContent'</code>
<code class="kr">import</code> <code class="nx">DialogContentText</code> <code class="nx">from</code> <code class="s">'@material-ui/core/DialogContentText'</code>
<code class="kr">import</code> <code class="nx">DialogTitle</code> <code class="nx">from</code> <code class="s">'@material-ui/core/DialogTitle'</code>

<code class="kr">const</code> <code class="nx">Alert</code> <code class="o">=</code> <code class="go">({</code> <code class="nx">open</code><code class="go">,</code> <code class="nx">title</code><code class="go">,</code> <code class="nx">message</code><code class="go">,</code> <code class="nx">onOK</code><code class="go">,</code> <code class="nx">onCancel</code> <code class="go">})</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">Dialog</code>
      <code class="na">open</code><code class="o">=</code><code class="go">{</code><code class="nx">open</code><code class="go">}</code>
      <code class="na">onClose</code><code class="o">=</code><code class="go">{</code><code class="nx">onCancel</code><code class="go">}</code>
      <code class="na">aria</code><code class="err">-</code><code class="na">labelledby</code><code class="o">=</code><code class="s">"alert-dialog-title"</code>
      <code class="na">aria</code><code class="err">-</code><code class="na">describedby</code><code class="o">=</code><code class="s">"alert-dialog-description"</code>
    <code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">DialogTitle</code> <code class="na">id</code><code class="o">=</code><code class="s">"alert-dialog-title"</code><code class="go">&gt;{</code><code class="nx">title</code><code class="go">}&lt;/</code><code class="nt">DialogTitle</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">DialogContent</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">DialogContentText</code> <code class="na">id</code><code class="o">=</code><code class="s">"alert-dialog-description"</code><code class="go">&gt;</code>
          <code class="go">{</code><code class="nx">message</code><code class="go">}</code>
        <code class="go">&lt;/</code><code class="nt">DialogContentText</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">DialogContent</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">DialogActions</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">onCancel</code><code class="go">}</code> <code class="na">color</code><code class="o">=</code><code class="s">"primary"</code><code class="go">&gt;</code>
          <code class="nx">Cancel</code>
        <code class="go">&lt;/</code><code class="nt">Button</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">onOK</code><code class="go">}</code> <code class="na">color</code><code class="o">=</code><code class="s">"primary"</code> <code class="na">autoFocus</code><code class="go">&gt;</code>
          <code class="nx">OK</code>
        <code class="go">&lt;/</code><code class="nt">Button</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">DialogActions</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Dialog</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">Alert</code></pre>

<p class="author1">Of course, there is no reason why we need to display a dialog. We could show a countdown timer or a snackbar message or
automatically save the user’s changes. But we will display a custom <code class="calibre21">Alert</code> dialog.</p>

<p class="author1">How will we use the <code class="calibre21">Alert</code> component in our interface? The first thing we’ll need to do is create our own <code class="calibre21">getUserConfirmation</code>
function.<a data-type="indexterm" data-primary="getUserConfirmation function" id="idm46634429737480" class="calibre6"/> We’ll store the message and the callback function and then set a Boolean value saying that we want to open the <code class="calibre21">Alert</code>
dialog:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">const</code> <code class="go">[</code><code class="nx">confirmOpen</code><code class="go">,</code> <code class="nx">setConfirmOpen</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
<code class="kr">const</code> <code class="go">[</code><code class="nx">confirmMessage</code><code class="go">,</code> <code class="nx">setConfirmMessage</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>
<code class="kr">const</code> <code class="go">[</code><code class="nx">confirmCallback</code><code class="go">,</code> <code class="nx">setConfirmCallback</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>

<code class="kr">return</code> <code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">BrowserRouter</code>
      <code class="na">getUserConfirmation</code><code class="o">=</code><code class="go">{(</code><code class="nx">message</code><code class="go">,</code> <code class="nx">callback</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="nx">setConfirmMessage</code><code class="go">(</code><code class="nx">message</code><code class="go">)</code>
        <code class="c">// Use this setter form because callback is a function</code>
        <code class="nx">setConfirmCallback</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="nx">callback</code><code class="go">)</code>
        <code class="nx">setConfirmOpen</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
      <code class="go">}}</code>
    <code class="go">&gt;</code>
  <code class="go">.....</code></pre>

<p class="author1">It’s worth noting that when we store the callback function, we use <code class="calibre21">setConfirmCallback(() =&gt; callback)</code> instead of simply writing <code class="calibre21">setConfirmCallback(callback)</code>. <a data-type="indexterm" data-primary="setConfirmCallback function" id="idm46634429547416" class="calibre6"/>That’s because the setters returned by the <code class="calibre21">useState</code> hook will execute any function passed to them,
rather than store them.</p>

<p class="author1">We can then use the values of <code class="calibre21">confirmMessage</code>, <code class="calibre21">confirmCallback</code>, and <code class="calibre21">confirmOpen</code> to render the <code class="calibre21">Alert</code> in the interface.</p>

<p class="author1">This is the complete <em class="calibre7">App.js</em> file:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">BrowserRouter</code><code class="go">,</code> <code class="nx">Link</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">Important</code> <code class="nx">from</code> <code class="s">'./Important'</code>
<code class="kr">import</code> <code class="nx">Alert</code> <code class="nx">from</code> <code class="s">'./Alert'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">confirmOpen</code><code class="go">,</code> <code class="nx">setConfirmOpen</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">confirmMessage</code><code class="go">,</code> <code class="nx">setConfirmMessage</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">confirmCallback</code><code class="go">,</code> <code class="nx">setConfirmCallback</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">BrowserRouter</code>
        <code class="na">getUserConfirmation</code><code class="o">=</code><code class="go">{(</code><code class="nx">message</code><code class="go">,</code> <code class="nx">callback</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="nx">setConfirmMessage</code><code class="go">(</code><code class="nx">message</code><code class="go">)</code>
          <code class="c">// Use this setter form because callback is a function</code>
          <code class="nx">setConfirmCallback</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="nx">callback</code><code class="go">)</code>
          <code class="nx">setConfirmOpen</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
        <code class="go">}}</code>
      <code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Alert</code>
          <code class="na">open</code><code class="o">=</code><code class="go">{</code><code class="nx">confirmOpen</code><code class="go">}</code>
          <code class="na">title</code><code class="o">=</code><code class="s">"Leave page?"</code>
          <code class="na">message</code><code class="o">=</code><code class="go">{</code><code class="nx">confirmMessage</code><code class="go">}</code>
          <code class="na">onOK</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
            <code class="nx">confirmCallback</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
            <code class="nx">setConfirmOpen</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
          <code class="go">}}</code>
          <code class="na">onCancel</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
            <code class="nx">confirmCallback</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
            <code class="nx">setConfirmOpen</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
          <code class="go">}}</code>
        <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/important"</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Important</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">div</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Home</code> <code class="nx">page</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Link</code> <code class="na">to</code><code class="o">=</code><code class="s">"/important"</code><code class="go">&gt;</code><code class="nx">Go</code> <code class="nx">to</code> <code class="nx">important</code> <code class="nx">page</code><code class="go">&lt;/</code><code class="nt">Link</code><code class="go">&gt;</code>
          <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">Now when a user backs out of an edit, they see the custom dialog, as shown in <a data-type="xref" href="#ch02_image_9" class="calibre6">Figure 2-9</a>.</p>

<figure class="calibre29"><div id="ch02_image_9" class="figure">
<img src="Images/recb_0209.png" alt="" class="calibre58"/>
<h6 class="calibre30"><span class="firstname">Figure 2-9. </span>The custom Alert appears when the user clicks the Back button</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634430236648">
<h2 class="calibre27">Discussion</h2>

<p class="author1">In this recipe, we have re-implemented the <code class="calibre21">Prompt</code> modal using a component library, but you don’t need to be limited to just
replacing one dialog box with another. There is no reason why, if someone leaves a page, that you couldn’t do something else: such
as store the work-in-progress somewhere so that they could return to it later. The asynchronous nature of the <code class="calibre21">getUserConfirmation</code>
function allows this flexibility. It’s another example of how <code class="calibre21">react-router-dom</code> abstracts away a cross-cutting concern.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/1FyoE" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="routing" data-secondary="using Prompt for page exit confirmations" data-startref="ix_rtePrmpt" id="idm46634429165704" class="calibre6"/><a data-type="indexterm" data-primary="page exit confirmations, using Prompt for" data-startref="ix_pgeexit" id="idm46634429164328" class="calibre6"/><a data-type="indexterm" data-primary="Prompt component, using for page exit confirmations" data-startref="ix_prmpt" id="idm46634429163352" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create Transitions with React Transition Group" class="calibre4"><div class="preface" id="ch02-05">
<h1 class="calibre17">Create Transitions with React Transition Group</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634429160696">
<h2 class="calibre27">Problem</h2>

<p class="author1">Native and desktop applications often use animation to connect different elements visually. <a data-type="indexterm" data-primary="routing" data-secondary="creating transitions with react-transition-group" id="ix_rtetransit" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="creating transitions with react-transition-group" id="ix_animetrans" class="calibre6"/><a data-type="indexterm" data-primary="transitions" data-secondary="creating with react-transition-group" id="ix_transits" class="calibre6"/>If you tap an item in a list, it expands
to show you the details. Swiping left or right can be used to indicate whether a user accepts or rejects an option.</p>

<p class="author1">Animations, therefore, are often used to indicate a location change. They zoom in on the details. They take you to the next person
on the list. We reflect a change in the URL with a matching animation.</p>

<p class="author1">But how do we create an animation when we move from one location to another?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634429153848">
<h2 class="calibre27">Solution</h2>

<p class="author1">For this recipe, we’re going to need the <code class="calibre21">react-router-dom</code> library and the <code class="calibre21">react-transition-group</code> library:<a data-type="indexterm" data-primary="react-transition-group" id="idm46634429150936" class="calibre6"/></p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install react-router-dom</code>
<code class="go">$ npm install react-transition-group</code></pre>

<p class="author1">We’re going to animate the <code class="calibre21">About</code> component that we’ve used previously.<sup class="calibre34"><a data-type="noteref" id="idm46634429149288-marker" href="ch02.xhtml#idm46634429149288" class="calibre35">4</a></sup> The <code class="calibre21">About</code>
component has two tabs called People and Offices, which are displayed for the routes <em class="calibre7">/about/people</em> and <em class="calibre7">/about/offices</em>.</p>

<p class="author1">When someone clicks one of the tabs, we’re going to fade out the old tab’s content and then fade in the content of the new tab.
Although we’re using a fade, there’s no reason why we couldn’t use a more complex animation, such as sliding the tab contents left
or right.<sup class="calibre34"><a data-type="noteref" id="idm46634429145480-marker" href="ch02.xhtml#idm46634429145480" class="calibre35">5</a></sup> However, a simple fade animation will more clearly demonstrate how it works.</p>

<p class="author1">Inside the <code class="calibre21">About</code> component, the tab contents are rendered by <code class="calibre21">People</code> and <code class="calibre21">Offices</code> components within distinct routes:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">NavLink</code><code class="go">,</code> <code class="nx">Redirect</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="s">'./About.css'</code>
<code class="kr">import</code> <code class="nx">People</code> <code class="nx">from</code> <code class="s">'./People'</code>
<code class="kr">import</code> <code class="nx">Offices</code> <code class="nx">from</code> <code class="s">'./Offices'</code>

<code class="kr">const</code> <code class="nx">About</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About"</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About-tabs"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">NavLink</code>
        <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code>
        <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
        <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
      <code class="go">&gt;</code>
        <code class="nx">People</code>
      <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">NavLink</code>
        <code class="na">to</code><code class="o">=</code><code class="s">"/about/offices"</code>
        <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
        <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
      <code class="go">&gt;</code>
        <code class="nx">Offices</code>
      <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/people"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">People</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/offices"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Offices</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code> <code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
  <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
<code class="go">)</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">About</code></pre>

<p class="author1">We need to animate the components inside the <code class="calibre21">Switch</code> component. We’ll need two things to do this:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">Something to track when the location has changed</p>
</li>
<li class="calibre8">
<p class="author1">Something to animate the tab contents when that happens</p>
</li>
</ul>

<p class="author1">How do we know when the location has changed? We can get the current location from the <code class="calibre21">useLocation</code> hook from <code class="calibre21">react-router-dom</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">const</code> <code class="nx">location</code> <code class="o">=</code> <code class="nx">useLocation</code><code class="go">()</code></pre>

<p class="author1">Now on to the more complex task: the animation itself. What follows is quite a complex sequence of events, but taking time to
understand it is worth it.</p>

<p class="author1">When we are animating from one component to another, we need to keep both components on the page. As the <code class="calibre21">Offices</code> component fades
out, the <code class="calibre21">People</code> component fades in.<sup class="calibre34"><a data-type="noteref" id="idm46634428965384-marker" href="ch02.xhtml#idm46634428965384" class="calibre35">6</a></sup> We can do this by keeping both components in a <em class="calibre7">transition group</em>. A transition group is a set of components, some
of which are appearing and others are 
<span class="firstname">disappearing</span>.</p>

<p class="author1">We can create a transition group by wrapping our animation in a <code class="calibre21">TransitionGroup</code> component.<a data-type="indexterm" data-primary="CSSTransition components" id="ix_CSSTrans" class="calibre6"/><a data-type="indexterm" data-primary="TransitionGroup components" id="idm46634428960024" class="calibre6"/> We also need a <code class="calibre21">CSSTransition</code>
component to coordinate the details of the CSS animation.</p>

<p class="author1">Our updated code wraps the <code class="calibre21">Switch</code> in both a <code class="calibre21">TransitionGroup</code> and a 
<span class="firstname"><code class="calibre21">CSSTransition</code></span>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code>
  <code class="nx">NavLink</code><code class="go">,</code>
  <code class="nx">Redirect</code><code class="go">,</code>
  <code class="nx">Route</code><code class="go">,</code>
  <code class="nx">Switch</code><code class="go">,</code>
  <code class="nx">useLocation</code><code class="go">,</code>
<code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">People</code> <code class="nx">from</code> <code class="s">'./People'</code>
<code class="kr">import</code> <code class="nx">Offices</code> <code class="nx">from</code> <code class="s">'./Offices'</code>
<code class="kr">import</code> <code class="go">{</code>
  <code class="nx">CSSTransition</code><code class="go">,</code>
  <code class="nx">TransitionGroup</code><code class="go">,</code>
<code class="go">}</code> <code class="nx">from</code> <code class="s">'react-transition-group'</code>

<code class="kr">import</code> <code class="s">'./About.css'</code>
<code class="kr">import</code> <code class="s">'./fade.css'</code>

<code class="kr">const</code> <code class="nx">About</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="nx">location</code> <code class="o">=</code> <code class="nx">useLocation</code><code class="go">()</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"About-tabs"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">NavLink</code>
          <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code>
          <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
          <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
        <code class="go">&gt;</code>
          <code class="nx">People</code>
        <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">NavLink</code>
          <code class="na">to</code><code class="o">=</code><code class="s">"/about/offices"</code>
          <code class="na">className</code><code class="o">=</code><code class="s">"About-tab"</code>
          <code class="na">activeClassName</code><code class="o">=</code><code class="s">"active"</code>
        <code class="go">&gt;</code>
          <code class="nx">Offices</code>
        <code class="go">&lt;/</code><code class="nt">NavLink</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">TransitionGroup</code> <code class="na">className</code><code class="o">=</code><code class="s">"About-tabContent"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">CSSTransition</code>
          <code class="na">key</code><code class="o">=</code><code class="go">{</code><code class="nx">location</code><code class="go">.</code><code class="nx">key</code><code class="go">}</code>
          <code class="na">classNames</code><code class="o">=</code><code class="s">"fade"</code>
          <code class="na">timeout</code><code class="o">=</code><code class="go">{</code><code class="mi">500</code><code class="go">}</code>
        <code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Switch</code> <code class="na">location</code><code class="o">=</code><code class="go">{</code><code class="nx">location</code><code class="go">}&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/people"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">People</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/about/offices"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Offices</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Redirect</code> <code class="na">to</code><code class="o">=</code><code class="s">"/about/people"</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">CSSTransition</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">TransitionGroup</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">About</code></pre>

<p class="author1">Notice that we pass the <code class="calibre21">location.key</code> to the <code class="calibre21">key</code> of the <code class="calibre21">CSSTransition</code> group, and we pass the <code class="calibre21">location</code> to the <code class="calibre21">Switch</code>
component. The <code class="calibre21">location.key</code> is a hash value of the current location. Passing the <code class="calibre21">location.key</code> to the transition group will keep
the <code class="calibre21">CSSTransition</code> in the virtual DOM until the animation is complete. When the user clicks one of the tabs, the location changes,
which refreshes the <code class="calibre21">About</code> component. The <code class="calibre21">TransitionGroup</code> will keep the existing <code class="calibre21">CSSTransition</code> in the tree of components until
its timeout occurs: in 500 milliseconds. But it will now also have a second <code class="calibre21">CSSTransition</code> component.</p>

<p class="author1">Each of these <code class="calibre21">CSSTransition</code> components will keep their child components alive (see <a data-type="xref" href="#ch02_image_10" class="calibre6">Figure 2-10</a>).</p>

<figure class="calibre29"><div id="ch02_image_10" class="figure">
<img src="Images/recb_0210.png" alt="" class="calibre59"/>
<h6 class="calibre30"><span class="firstname">Figure 2-10. </span>The TransitionGroup keeps both the old and new components in the virtual DOM</h6>
</div></figure>

<p class="author1">We need to pass the <code class="calibre21">location</code> value to the <code class="calibre21">Switch</code> components: we need the <code class="calibre21">Switch</code> for the old tab, and we need the <code class="calibre21">Switch</code> for the new
tab to keep rendering their routes.</p>

<p class="author1">So now, on to the animation itself. The <code class="calibre21">CSSTransition</code> component accepts a property called <code class="calibre21">classNames</code>, which we have set to the
value <code class="calibre21">fade</code>. Note that <code class="calibre21">classNames</code> is a plural to distinguish it from the standard <code class="calibre21">className</code> attribute.</p>

<p class="author1"><code class="calibre21">CSSTransition</code> will use <code class="calibre21">classNames</code> to generate four distinct class names:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1"><code class="calibre21">fade-enter</code></p>
</li>
<li class="calibre8">
<p class="author1"><code class="calibre21">fade-enter-active</code></p>
</li>
<li class="calibre8">
<p class="author1"><code class="calibre21">fade-exit</code></p>
</li>
<li class="calibre8">
<p class="author1"><code class="calibre21">fade-exit-active</code></p>
</li>
</ul>

<p class="author1">The <code class="calibre21">fade-enter</code> class is for components that are about to start to animate into view. The <code class="calibre21">fade-enter-active</code> class is applied to
components that are actually animating. <code class="calibre21">fade-exit</code> and <code class="calibre21">fade-exit-active</code> are for components that are beginning or animating their
disappearance.</p>

<p class="author1">The <code class="calibre21">CSSTransition</code> component will add these class names to their immediate children. If we are animating from the Offices tab to
the People tab, then the old 
<span class="firstname"><code class="calibre21">CSSTransition</code></span> will add the <code class="calibre21">fade-enter-active</code> class to the <code class="calibre21">People</code> HTML and will add the
<code class="calibre21">fade-exit-active</code> to the <code class="calibre21">Offices</code> HTML.</p>

<p class="author1">All that’s left to do is define the CSS animations themselves:</p>

<pre data-type="programlisting" data-code-language="css" class="calibre28"><code class="nc">.fade-enter</code> <code class="go">{</code>
    <code class="kr">opacity</code><code class="o">:</code> <code class="mi">0</code><code class="go">;</code>
<code class="go">}</code>
<code class="nc">.fade-enter-active</code> <code class="go">{</code>
    <code class="kr">opacity</code><code class="o">:</code> <code class="mi">1</code><code class="go">;</code>
    <code class="kr">transition</code><code class="o">:</code> <code class="nx">opacity</code> <code class="mi">250ms</code> <code class="nx">ease</code><code class="o">-</code><code class="nx">in</code><code class="go">;</code>
<code class="go">}</code>
<code class="nc">.fade-exit</code> <code class="go">{</code>
    <code class="kr">opacity</code><code class="o">:</code> <code class="mi">1</code><code class="go">;</code>
<code class="go">}</code>
<code class="nc">.fade-exit-active</code> <code class="go">{</code>
    <code class="kr">opacity</code><code class="o">:</code> <code class="mi">0</code><code class="go">;</code>
    <code class="kr">transition</code><code class="o">:</code> <code class="nx">opacity</code> <code class="mi">250ms</code> <code class="nx">ease</code><code class="o">-</code><code class="nx">in</code><code class="go">;</code>
<code class="go">}</code></pre>

<p class="author1">The <code class="calibre21">fade-enter-</code> classes use CSS transitions to change the opacity of the component from 0 to 1. The <code class="calibre21">fade-exit-</code> classes animate
the opacity from 1 back to 0. It’s generally a good idea to keep the animation class definitions in a separate CSS file. That way,
we can reuse them for other animations.</p>

<p class="author1">The animation is complete. When the user clicks a tab, they see the contents cross-fade from the old data to the new data (<a data-type="xref" href="#ch02_image_11" class="calibre6">Figure 2-11</a>).</p>

<figure class="calibre29"><div id="ch02_image_11" class="figure">
<img src="Images/recb_0211.png" alt="" class="calibre60"/>
<h6 class="calibre30"><span class="firstname">Figure 2-11. </span>The contents of the tab fade from offices to people</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634429152904">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Animations can be pretty irritating when used poorly. Each animation you add should have some intent. If you find that you want to
add an animation just because you think it will be attractive, you will almost certainly find users will dislike it. Generally, it
is best to ask a few questions before adding an animation:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">Will this animation clarify the relationship between the two routes? Are you zooming in to see more detail or moving across to
look at a related item?</p>
</li>
<li class="calibre8">
<p class="author1">How short should the animation be? Any longer than half a second is probably too much.</p>
</li>
<li class="calibre8">
<p class="author1">What is the impact on performance? CSS transitions usually have minimal effect if the browser hands the work off to the GPU. But
what happens in an old browser on a mobile device?<a data-type="indexterm" data-primary="CSSTransition components" data-startref="ix_CSSTrans" id="idm46634428579256" class="calibre6"/></p>
</li>
</ul>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/UCu75" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="routing" data-secondary="creating transitions with react-transition-group" data-startref="ix_rtetransit" id="idm46634428576920" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="creating transitions with react-transition-group" data-startref="ix_animetrans" id="idm46634428575544" class="calibre6"/><a data-type="indexterm" data-primary="transitions" data-secondary="creating with react-transition-group" data-startref="ix_transits" id="idm46634428574296" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create Secured Routes" class="calibre4"><div class="preface" id="ch02-06">
<h1 class="calibre17">Create Secured Routes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634428571432">
<h2 class="calibre27">Problem</h2>

<p class="author1">Most applications need to prevent access to particular routes until a person logs in.<a data-type="indexterm" data-primary="security" data-secondary="creating secured routes" id="ix_securte" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-secondary="creating secured routes" id="ix_rtesecu" class="calibre6"/> But how do you secure some routes and not
others?<a data-type="indexterm" data-primary="login/logout" data-secondary="for secured routes" data-secondary-sortas="secured" id="ix_lginout" class="calibre6"/> Is it possible to separate the security mechanisms from the user interface elements for logging in and logging out? And how
do you do it without writing a vast amount of code?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634428565416">
<h2 class="calibre27">Solution</h2>

<p class="author1">Let’s look at one way to implement route-based security in a React application. This application contains a home page (/), it has a public
page with no security (<em class="calibre7">/public</em>), and it also has two private pages (<em class="calibre7">/private1</em> and <em class="calibre7">/private2</em>) that we need to
secure:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">BrowserRouter</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">Public</code> <code class="nx">from</code> <code class="s">'./Public'</code>
<code class="kr">import</code> <code class="nx">Private1</code> <code class="nx">from</code> <code class="s">'./Private1'</code>
<code class="kr">import</code> <code class="nx">Private2</code> <code class="nx">from</code> <code class="s">'./Private2'</code>
<code class="kr">import</code> <code class="nx">Home</code> <code class="nx">from</code> <code class="s">'./Home'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">exact</code> <code class="na">path</code><code class="o">=</code><code class="s">"/"</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Home</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/private1"</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Private1</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">path</code><code class="o">=</code><code class="s">"/private2"</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Private2</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">exact</code> <code class="na">path</code><code class="o">=</code><code class="s">"/public"</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Public</code> <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">We’re going to build the security system using a context. A context is where data can be stored by a component and made available to
the component’s children. A <code class="calibre21">BrowserRouter</code> uses a context to pass routing information to the <code class="calibre21">Route</code> components within it.</p>

<p class="author1">We’re going to create a custom context called <code class="calibre21">SecurityContext</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">SecurityContext</code> <code class="o">=</code> <code class="nx">React</code><code class="go">.</code><code class="nx">createContext</code><code class="go">({})</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">SecurityContext</code></pre>

<p class="author1">The default value of our context is an empty object. We need something that will add functions into the context for logging in and
logging out. We’ll do that by creating a <code class="calibre21">SecurityProvider</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">SecurityContext</code> <code class="nx">from</code> <code class="s">'./SecurityContext'</code>

<code class="kr">const</code> <code class="nx">SecurityProvider</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">loggedIn</code><code class="go">,</code> <code class="nx">setLoggedIn</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">SecurityContext</code><code class="go">.</code><code class="na">Provider</code>
      <code class="na">value</code><code class="o">=</code><code class="go">{{</code>
        <code class="nx">login</code><code class="o">:</code> <code class="go">(</code><code class="nx">username</code><code class="go">,</code> <code class="nx">password</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="c">// Note to engineering team:</code>
          <code class="c">// Maybe make this more secure...</code>
          <code class="kr">if</code> <code class="go">(</code><code class="nx">username</code> <code class="o">===</code> <code class="s">'fred'</code> <code class="o">&amp;&amp;</code> <code class="nx">password</code> <code class="o">===</code> <code class="s">'password'</code><code class="go">)</code> <code class="go">{</code>
            <code class="nx">setLoggedIn</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
          <code class="go">}</code>
        <code class="go">},</code>
        <code class="nx">logout</code><code class="o">:</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="nx">setLoggedIn</code><code class="go">(</code><code class="kr">false</code><code class="go">),</code>
        <code class="nx">loggedIn</code><code class="go">,</code>
      <code class="go">}}</code>
    <code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">children</code><code class="go">}</code>
    <code class="go">&lt;/</code><code class="nt">SecurityContext</code><code class="go">.</code><code class="na">Provider</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">SecurityProvider</code></pre>

<p class="author1">The code would be very different in a real system. You would probably create a component that logged in and logged out using a web
service or third-party security 
<span class="firstname">system</span>. But in our example, the <code class="calibre21">SecurityProvider</code> keeps track of whether we have logged in using a
simple <code class="calibre21">loggedIn</code> Boolean value. <a data-type="indexterm" data-primary="SecurityProvider components" id="idm46634428100248" class="calibre6"/>The <code class="calibre21">SecurityProvider</code> puts three things into the context:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">A function for logging in (<code class="calibre21">login</code>)</p>
</li>
<li class="calibre8">
<p class="author1">A function for logging out (<code class="calibre21">logout</code>)</p>
</li>
<li class="calibre8">
<p class="author1">A Boolean value saying whether we have logged in or out (<code class="calibre21">loggedIn</code>)</p>
</li>
</ul>

<p class="author1">These three things will be available to any components placed inside a <code class="calibre21">SecurityPro⁠vider</code> component. To allow any component inside a
<code class="calibre21">SecurityProvider</code> to access these functions, we’ll add a custom hook called <code class="calibre21">useSecurity</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">SecurityContext</code> <code class="nx">from</code> <code class="s">'./SecurityContext'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">useContext</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">useSecurity</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="nx">useContext</code><code class="go">(</code><code class="nx">SecurityContext</code><code class="go">)</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">useSecurity</code></pre>

<p class="author1">Now that we have a <code class="calibre21">SecurityProvider</code>, we need to use it to secure a subset of the routes. <a data-type="indexterm" data-primary="SecureRoute components" id="idm46634428075240" class="calibre6"/>We’ll create another component, called
<code class="calibre21">SecureRoute</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">Login</code> <code class="nx">from</code> <code class="s">'./Login'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">Route</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">useSecurity</code> <code class="nx">from</code> <code class="s">'./useSecurity'</code>

<code class="kr">const</code> <code class="nx">SecureRoute</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">{</code> <code class="nx">loggedIn</code> <code class="go">}</code> <code class="o">=</code> <code class="nx">useSecurity</code><code class="go">()</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">Route</code> <code class="go">{</code><code class="na">...props</code><code class="go">}&gt;{</code><code class="nx">loggedIn</code> <code class="o">?</code> <code class="nx">props</code><code class="go">.</code><code class="nx">children</code> <code class="o">:</code> <code class="go">&lt;</code><code class="nt">Login</code> <code class="go">/&gt;}&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">SecureRoute</code></pre>

<p class="author1">The <code class="calibre21">SecureRoute</code> component gets the current <code class="calibre21">loggedIn</code> status from the <code class="calibre21">SecurityCon⁠text</code> (using the <code class="calibre21">useSecurity</code> hook), and if the user is logged in, it renders the contents of the route.<a data-type="indexterm" data-primary="SecurityContext" id="idm46634427921640" class="calibre6"/> If the user is not logged in, it displays a login form.<sup class="calibre34"><a data-type="noteref" id="idm46634427920808-marker" href="ch02.xhtml#idm46634427920808" class="calibre35">7</a></sup></p>

<p class="author1">The <code class="calibre21">LoginForm</code> calls the <code class="calibre21">login</code> function, which—if successful—will re-render the <code class="calibre21">SecureRoute</code> and then show the secured data.</p>

<p class="author1">How do we use all of these new components? Here is an updated version of the <em class="calibre7">App.js</em> file:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">BrowserRouter</code><code class="go">,</code> <code class="nx">Route</code><code class="go">,</code> <code class="nx">Switch</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">Public</code> <code class="nx">from</code> <code class="s">'./Public'</code>
<code class="kr">import</code> <code class="nx">Private1</code> <code class="nx">from</code> <code class="s">'./Private1'</code>
<code class="kr">import</code> <code class="nx">Private2</code> <code class="nx">from</code> <code class="s">'./Private2'</code>
<code class="kr">import</code> <code class="nx">Home</code> <code class="nx">from</code> <code class="s">'./Home'</code>
<code class="kr">import</code> <code class="nx">SecurityProvider</code> <code class="nx">from</code> <code class="s">'./SecurityProvider'</code>
<code class="kr">import</code> <code class="nx">SecureRoute</code> <code class="nx">from</code> <code class="s">'./SecureRoute'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">SecurityProvider</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">Switch</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">exact</code> <code class="na">path</code><code class="o">=</code><code class="s">"/"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Home</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">SecureRoute</code> <code class="na">path</code><code class="o">=</code><code class="s">"/private1"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Private1</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">SecureRoute</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">SecureRoute</code> <code class="na">path</code><code class="o">=</code><code class="s">"/private2"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Private2</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">SecureRoute</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">Route</code> <code class="na">exact</code> <code class="na">path</code><code class="o">=</code><code class="s">"/public"</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">Public</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">Route</code><code class="go">&gt;</code>
          <code class="go">&lt;/</code><code class="nt">Switch</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">SecurityProvider</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">BrowserRouter</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">The <code class="calibre21">SecurityProvider</code> wraps our whole routing system, making <code class="calibre21">login()</code>, <code class="calibre21">logout()</code>, and <code class="calibre21">loggedIn</code> available to each <code class="calibre21">SecureRoute</code>.</p>

<p class="author1">You can see the application running in <a data-type="xref" href="#ch02_image_12" class="calibre6">Figure 2-12</a>.</p>

<figure class="calibre29"><div id="ch02_image_12" class="figure">
<img src="Images/recb_0212.png" alt="" class="calibre61"/>
<h6 class="calibre30"><span class="firstname">Figure 2-12. </span>The home page has links to the other pages</h6>
</div></figure>

<p class="author1">If we click the <em class="calibre7">Public Page</em> link, the page appears (see <a data-type="xref" href="#ch02_image_13" class="calibre6">Figure 2-13</a>).</p>

<figure class="calibre29"><div id="ch02_image_13" class="figure">
<img src="Images/recb_0213.png" alt="" class="calibre62"/>
<h6 class="calibre30"><span class="firstname">Figure 2-13. </span>The public page is available without logging in</h6>
</div></figure>

<p class="author1">But if we click <em class="calibre7">Private Page 1</em>, we’re presented with the login screen (<a data-type="xref" href="#ch02_image_14" class="calibre6">Figure 2-14</a>).</p>

<figure class="calibre29"><div id="ch02_image_14" class="figure">
<img src="Images/recb_0214.png" alt="" class="calibre63"/>
<h6 class="calibre30"><span class="firstname">Figure 2-14. </span>You need to log in before you can see Private Page 1</h6>
</div></figure>

<p class="author1">If you log in with the username <em class="calibre7">fred</em> and password <em class="calibre7">password</em>, you will then see the private content (see <a data-type="xref" href="#ch02_image_15" class="calibre6">Figure 2-15</a>).</p>

<figure class="calibre29"><div id="ch02_image_15" class="figure">
<img src="Images/recb_0215.png" alt="" class="calibre64"/>
<h6 class="calibre30"><span class="firstname">Figure 2-15. </span>The content of Private Page 1 after login</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634428464472">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Real security is only ever provided by secured backend services. However, secured routes prevent a user from stumbling into a page
that can’t read data from the server.</p>

<p class="author1">A better implementation of the <code class="calibre21">SecurityProvider</code> would defer to some third-party OAuth tool or other security services. But by
splitting the <code class="calibre21">SecurityProvider</code> from the security UI (<code class="calibre21">Login</code> and <code class="calibre21">Logout</code>) and the main application, you can modify the security
mechanisms over time without changing a lot of code in your application.</p>

<p class="author1">If you want to see how your components behave when people log in and out, you can always create a mocked version of the
<code class="calibre21">SecurityProvider</code> for use in unit tests.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/Kut73" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="login/logout" data-secondary="for secured routes" data-secondary-sortas="secured" data-startref="ix_lginout" id="idm46634427720264" class="calibre6"/><a data-type="indexterm" data-primary="security" data-secondary="creating secured routes" data-startref="ix_securte" id="idm46634427718712" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-secondary="creating secured routes" data-startref="ix_rtesecu" id="idm46634427717496" class="calibre6"/><a data-type="indexterm" data-primary="routing" data-startref="ix_route" id="idm46634427716280" class="calibre6"/></p>
</div></section>





</div></section>







<div data-type="footnotes" class="calibre49"><p data-type="footnote" id="idm46634431789304" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634431789304-marker" class="calibre35">1</a></sup> We won’t show the code for the <code class="calibre21">PeopleList</code> here, but it is available on <a href="https://oreil.ly/tZzMD" class="calibre6">GitHub</a>.</p><p data-type="footnote" id="idm46634430499464" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634430499464-marker" class="calibre35">2</a></sup> We are using the React Testing Library in this example.</p><p data-type="footnote" id="idm46634430461864" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634430461864-marker" class="calibre35">3</a></sup> See <a data-type="xref" href="ch01_split_000.xhtml#ch01-09" class="calibre6">“Use Storybook for Component Development”</a>.</p><p data-type="footnote" id="idm46634429149288" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634429149288-marker" class="calibre35">4</a></sup> See Recipes <a href="#ch02-02" class="calibre6">2.2</a> and <a href="#ch02-03" class="calibre6">2.3</a>.</p><p data-type="footnote" id="idm46634429145480" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634429145480-marker" class="calibre35">5</a></sup> This is a common feature of third-party tabbed components. The animation reinforces in the user’s mind that they are moving left and right through the tabs.</p><p data-type="footnote" id="idm46634428965384" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634428965384-marker" class="calibre35">6</a></sup> The code uses relative positioning to place both components in the same position during the fade.</p><p data-type="footnote" id="idm46634427920808" class="calibre50"><sup class="calibre51"><a href="ch02.xhtml#idm46634427920808-marker" class="calibre35">7</a></sup> We’ll omit the contents of the <code class="calibre21">Login</code> component here, but the code is available on the GitHub repository.</p></div></div></section></div></body></html>