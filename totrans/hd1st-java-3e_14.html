<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 12. Lambdas and Streams: What, Not How: Lambdas and Streams"><div class="chapter" id="lambdas_and_streams_whatcomma_not_how_la">
<h1><span class="label">Chapter 12. </span>Lambdas and Streams: What, Not How: Lambdas and Streams</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0369-01.png" alt="image" width="735" height="497"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="streams (Streams API)" id="idm46038391383952"/><strong>What if...you didn’t need to tell the computer HOW to do something?</strong> Programming involves a lot of telling the computer how to do something: <strong>while</strong> this is true <strong>do</strong> this thing; <strong>for</strong> all these items <strong>if</strong> it looks like this <strong>then</strong> do this; and so on.</p>
<p>We’ve also seen that we don’t have to do everything ourselves. The JDK contains library code, like the Collections API we saw in the previous chapter, that we can use instead of writing everything from scratch. This library code isn’t just limited to collections to put data into; there are methods that will do common tasks for us, so we just need to tell them <strong>what</strong> we want and not <strong>how</strong> to do it.</p>
<p>In this chapter we’ll look at the Streams API. You’ll see how helpful lambda expressions can be when you’re using streams, and you’ll learn how to use the Streams API to query and transform the data in a collection.</p>
<section data-type="sect1" data-pdf-bookmark="Tell the computer WHAT you want"><div class="sect1" id="tell_the_computer_what_you_want">
<h1>Tell the computer WHAT you want</h1>
<p><a data-type="indexterm" data-primary="forEach()" id="idm46038392046592"/><a data-type="indexterm" data-primary="for loops" data-secondary="versus forEach()" id="idm46038391538816"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="forEach method" id="idm46038391536752"/><a data-type="indexterm" data-primary="loops" data-secondary="for" id="idm46038391556816"/>Imagine you have a list of colors, and you wanted to print out all the colors. You could use a for loop to do this.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0370-01.png" alt="image" width="807" height="270"/>
<h6/>
</div></figure>
<p>But doing something to every item in a list is a really common thing to want to do. So instead of creating a for loop every time we want to do something “for each” item in the list, we can call the <strong><code>forEach</code></strong> method from the Iterable interface—remember, List implements Iterable so it has all the methods from the Iterable interface.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0370-02.png" alt="image" width="667" height="183"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0370-03.png" alt="image" width="287" height="170"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">The forEach method of a list takes a lambda expression, which we saw for the first time in the previous chapter. This is a way for you to pass behavior (“follow these instructions”) into a method, instead of passing an object containing data (“here is an object for you to use”).</span></strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fireside Chats"><div class="sect1" id="fireside_chats-id00002">
<h1>Fireside Chats</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0304-01.png" alt="image" width="395" height="169"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Fireside Chats" id="idm46038392361344"/><a data-type="indexterm" data-primary="Fireside Chats" data-secondary="for loop versus forEach method" id="idm46038392359968"/>Tonight’s Talk: <strong>The for loop and forEach method battle over the question, “Which is better?”</strong></p>
<table class="border">
<thead>
<tr>
<th>forEach()</th>
<th>for loop</th>
</tr>
</thead>
<tbody>
<tr>
<td>I am the default! The for loop is so important that loads of programming languages have me. It’s one of the first things a programmer learns! If someone needs to loop a set number of times to do something, they’re going to reach for their trusty for loop.</td>
<td/>
</tr>
<tr>
<td/>
<td>Pff. Please. You are <em>so old</em>; that’s why you’re in all the programming languages. But things change, languages evolve. There’s a better way. A more modern way. Me.</td>
</tr>
<tr>
<td>Sure, fashions change. But sometimes it’s just a fad; things fall out of fashion too. A classic like me will be easy to read and write forever, even for non-Java programmers.</td>
<td/>
</tr>
<tr>
<td/>
<td>But look how much work developers need to do to write you! They have to control when to start, increment, and stop the loop, as well as writing the code that needs to be run inside the loop. All sorts of things could go wrong! If they use me, they just have to think about what needs to happen to each item, they don’t have to worry about how to loop to find each item.</td>
</tr>
<tr>
<td>So much work?! Ha! A developer isn’t scared of a little syntax to clearly specify what to do and how to do it. At least with me, someone reading my code can clearly see what’s going on.</td>
<td/>
</tr>
<tr>
<td/>
<td>Dude, they shouldn’t <em>have</em> to see what’s going on. It says very clearly in my method name exactly what I do—“for each” element I will apply the logic they specify. Job done.</td>
</tr>
<tr>
<td>Well I’m faster. Everyone knows that.</td>
<td/>
</tr>
<tr>
<td/>
<td>Well actually, under the covers I’m using a for loop myself, but if something is invented later that’s even faster, I can use that, and developers don’t have to change a single thing to get faster code. In fact we’re out of time now so....</td>
</tr>
<tr>
<td>I said you would disappear soon.</td>
<td/>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="When for loops go wrong"><div class="sect1" id="when_for_loops_go_wrong">
<h1>When for loops go wrong</h1>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Mixed Messages" id="idm46038391348688"/>Using <strong><code>forEach</code></strong> instead of a for loop means a bit less typing, and it’s also nice to focus on telling the compiler <em>what</em> you want to do and not <em>how</em> to do it. There’s another advantage to letting the libraries take care of routine code like this—it can mean fewer accidental errors.</p>
<section data-type="sect2" data-pdf-bookmark="Mixed Messages"><div class="sect2" id="mixed_messages-id00004">
<h2>Mixed Messages</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0372-01.png" alt="image" width="138" height="93"/>
<h6/>
</div></figure>
<p>A short Java program is listed below. One block of the program is missing.  We expect the output of the program should be “1 2 3 4 5” but sometimes it’s difficult to get a for loop just right.</p>
<p>Your challenge is to <strong>match the candidate block of code</strong> (on the left) <strong>with the output</strong> that you’d see if the block were inserted. Not all the lines of output will be used, and some of the lines of output might be used more than once.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0372-02.png" alt="image" width="654" height="319"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0372-03.png" alt="image" width="1365" height="527"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#mixed_messages_left_parenthesisf-id00001">“Mixed Messages”</a>.</strong></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Small errors in common code can be hard to spot"><div class="sect1" id="small_errors_in_common_code_can_be_hard">
<h1>Small errors in common code can be hard to spot</h1>
<p><a data-type="indexterm" data-primary="streams (Streams API)" id="idm46038391333008"/>The for loops from the previous exercise all look quite similar, and at first glance they all look like they would print out all the values in the List in order. Compiler errors can be easiest to spot, because your IDE or compiler will tell you the code is wrong, and Exceptions (which we’ll see in <a data-type="xref" href="ch13.xhtml#risky_behavior_exception_handling">Chapter 13</a>, <em>Risky Behavior</em>) can also point to a problem in the code. But it can be trickier to spot code that produces incorrect output just by looking at the code.</p>
<p>Using a method like <strong><code>forEach</code></strong> takes care of the “boilerplate,” the repetitive and common code like the for loop. Using forEach, passing in only the thing we want to do, can reduce accidental errors in our code.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0373-01.png" alt="image" width="597" height="382"/>
<h6/>
</div></figure>
<p><strong>Yes absolutely, in fact Java 8 introduced a whole API just for this.</strong></p>
<p>Java 8 introduced the <em>Streams API</em>, a new set of methods that can be used on many classes, including the Collections classes we looked at in the previous chapter.</p>
<p>The Streams API isn’t just a bunch of helpful methods, but also a slightly different way of working. It lets us build up a whole set of requirements, a recipe if you like, of what we want to know about our data.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_barbell-id00003">
<h5>Brain Barbell</h5>
<figure class="informal"><div class="figure">
<img src="Images/barbell.png" alt="image" width="163" height="95"/>
<h6/>
</div></figure>
<p>Can you think of more examples of the types of things we might want to do to a collection? Are you going to want to ask similar questions about what’s inside different types of collections? Can you think of different types of information you might want to output from a collection?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Building blocks of common operations"><div class="sect1" id="building_blocks_of_common_operations">
<h1>Building blocks of common operations</h1>
<p><a data-type="indexterm" data-primary="collections" data-secondary="common operations" id="idm46038397213664"/><a data-type="indexterm" data-primary="exercises" data-secondary="Who Does What?" id="idm46038392335104"/><a data-type="indexterm" data-primary="objects" data-secondary="and collections" id="idm46038392333472"/>The ways we search our collections, and the types of information we want to output from those collections, can be quite similar even on different types of collections containing different types of Objects.</p>
<p>Imagine what you might want do to with a Collection: “give me just the items that meet some criteria,” “change all the items using these steps,” “remove all duplicates,” and the example we worked through in the previous chapter: “sort the elements in this way.”</p>
<p>It’s not too hard to go one step further and assume each of these collection operations could be given a name that tells us what will happen to our collection.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_barbell-id00200">
<h5>WHO DOES WHAT?</h5>
<p>We know this is all new, but have a go at matching each operation name to the description of what it does. Try not to look at the next page as you complete it, as that will give the game away!</p>
<table class="border">
<tbody>
<tr>
<td>filter</td>
<td>Changes the current element in the stream into something else</td>
</tr>
<tr>
<td>skip</td>
<td>Sets the maximum number of elements that can be output from this Stream</td>
</tr>
<tr>
<td>limit</td>
<td>While a given criteria is true, will not process elements</td>
</tr>
<tr>
<td>distinct</td>
<td>Only allows elements that match the given criteria to remain in the Stream</td>
</tr>
<tr>
<td>sorted</td>
<td>Will only process elements while the given criteria is true</td>
</tr>
<tr>
<td>map</td>
<td>States the result of the stream should be ordered in some way</td>
</tr>
<tr>
<td>dropWhile</td>
<td>This is the number of elements at the start of the Stream that will not be processed</td>
</tr>
<tr>
<td>takeWhile</td>
<td>Use this to make sure duplicates are removed</td>
</tr>
</tbody>
</table>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#who_does_whatquestion_mark_left_parenthe">“Who Does What?”</a>.</strong></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Introducing the Streams API"><div class="sect1" id="introducing_the_streams_api">
<h1>Introducing the Streams API</h1>
<p><a data-type="indexterm" data-primary="distinct(), Stream" id="idm46038391306032"/><a data-type="indexterm" data-primary="generics" data-secondary="methods" id="idm46038391305296"/><a data-type="indexterm" data-primary="limit(), Stream" id="idm46038391304320"/><a data-type="indexterm" data-primary="map(), Stream" id="idm46038391303584"/><a data-type="indexterm" data-primary="Predicate" id="idm46038391302848"/><a data-type="indexterm" data-primary="skip(), Stream" id="idm46038391302080"/><a data-type="indexterm" data-primary="sorted()" id="idm46038391301248"/><a data-type="indexterm" data-primary="streams (Streams API)" id="idm46038391300416"/>The Streams API is a set of operations we can perform on a collection, so when we read these operations in our code, we can understand what we’re trying to do with the collection data. If you were successful in the “Who Does What?” exercise on the previous page (the complete answers are at the end of this chapter), you should have seen that the names of the operations describe what they do.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0375-01.png" alt="image" width="946" height="724"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">Streams, and lambda expressions, were introduced in Java 8.</span></strong></p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-id0002">
<h5>Relax</h5>
<figure class="informal"><div class="figure">
<img src="Images/cup.png" alt="image" width="70" height="106"/>
<h6/>
</div></figure>
<p><strong>You don’t need to worry too much about the generic types on the Stream methods; you’ll see that using Streams “just works” the way you’d expect.</strong></p>
<p>In case you are interested:</p>
<ul>
<li><p><strong><code>&lt;T&gt;</code></strong> is usually the Type of the object in the stream.</p></li>
<li><p><strong><code>&lt;R&gt;</code></strong> is usually the type of the Result of the method.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Getting started with Streams"><div class="sect1" id="getting_started_with_streams">
<h1>Getting started with Streams</h1>
<p><a data-type="indexterm" data-primary="Collection API" id="idm46038391279584"/><a data-type="indexterm" data-primary="intermediate operations" id="idm46038391278848"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="stream()" id="idm46038391278112"/>Before we start going into detail about what the Streams API is, what it does, and how to use it, we’re going to give you some very basic tools to start experimenting.</p>
<p>To use the Streams methods, we need a Stream object (obviously). If we have a collection like a List, this doesn’t implement Stream. However, the Collection interface has a method, <strong><code>stream</code></strong>, which returns a Stream object for the Collection.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0376-01.png" alt="image" width="828" height="184"/>
<h6/>
</div></figure>
<p>Now we can call the methods of the Streams API. For example, we could use <strong>limit</strong> to say we want a maximum of four elements.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0376-02.png" alt="image" width="709" height="155"/>
<h6/>
</div></figure>
<p>What happens if we try to print out the result of calling limit()?</p>
<pre data-type="programlisting"><strong>System.out.println("limit = " + limit);</strong></pre>
<figure class="informal"><div class="figure">
<img src="Images/f0376-03.png" alt="image" width="977" height="174"/>
<h6/>
</div></figure>
<p>Like everything in Java, the stream variables in the example are Objects. But a stream does <strong><em>not</em></strong> contain the elements in the collection. It’s more like the set of instructions for the operations to perform on the Collection data.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#646466;">Stream methods that return another Stream are called <u>Intermediate Operations</u>. These are instructions of things to do, but they don’t actually perform the operation on their own.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0377-01.png" alt="image" width="482" height="522"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Streams are like recipes: nothing’s going to happen until someone actually cooks them"><div class="sect1" id="streams_are_like_recipes_nothingapostrop">
<h1>Streams are like recipes: nothing’s going to happen until someone actually cooks them</h1>
<p><a data-type="indexterm" data-primary="Boolean anyMatch" id="idm46038391260032"/><a data-type="indexterm" data-primary="collect()" id="idm46038391259520"/><a data-type="indexterm" data-primary="findFirst(), Optional" id="idm46038391258784"/><a data-type="indexterm" data-primary="long count()" id="idm46038391258048"/><a data-type="indexterm" data-primary="terminal operations" id="idm46038391257216"/>A recipe in a book only tells someone <em>how</em> to cook or bake something. Opening the recipe doesn’t automatically present you with a freshly baked chocolate cake. You need to gather the ingredients according to the recipe and follow the instructions exactly to come up with the result you want.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0377-02.png" alt="image" width="243" height="198"/>
<h6/>
</div></figure>
<p>Collections are not ingredients, and a list limited to four entries is not a chocolate cake (sadly). But you do need to call one of the Stream’s “do it” methods in order to get the result you want. These “do it” methods are called <strong>Terminal Operations</strong>, and these are the methods that will actually return something to you.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0377-03.png" alt="image" width="934" height="554"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Getting a result from a Stream"><div class="sect1" id="getting_a_result_from_a_stream">
<h1>Getting a result from a Stream</h1>
<p><a data-type="indexterm" data-primary="collect()" id="idm46038391356000"/><a data-type="indexterm" data-primary="Collectors class" id="idm46038391252176"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="getting results from" id="idm46038391251440"/>Yes, we’ve thrown a <strong>lot</strong> of new words at you: <em>streams</em>; <em>intermediate operations</em>; <em>terminal operations</em>... And we still haven’t told you what streams can do!</p>
<p>To start to get a feel for what we can do with streams, we going to show code for a simple use of the Streams API. After that, we’ll step back and learn more about what we’re seeing here.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0378-01.png" alt="image" width="793" height="152"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0378-02.png" alt="image" width="694" height="113"/>
<h6/>
</div></figure>
<p>This works, but it’s not very useful. One of the most common things to do with Streams is put the results into another type of collection. The API documentation for this method might seem intimidating with all the generic types, but the simplest case is straightforward:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0378-03.png" alt="image" width="860" height="290"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0378-04.png" alt="image" width="446" height="112"/>
<h6/>
</div></figure>
<p>Finally, we have a result that looks like something we would have expected: we had a List of Strings, and we asked to <strong>limit</strong> that list to the first four items and then <strong>collect</strong> those four items into a new List.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-id0003">
<h5>Relax</h5>
<figure class="informal"><div class="figure">
<img src="Images/cup.png" alt="image" width="70" height="106"/>
<h6/>
</div></figure>
<p><strong>We’ll see collect() and the Collectors in more detail later.</strong></p>
<p>For now, <strong><code>collect(Collectors.toList)</code></strong> is a magic incantation to get the output of the stream pipeline in a List.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Stream operations are building blocks"><div class="sect1" id="stream_operations_are_building_blocks">
<h1>Stream operations are building blocks</h1>
<p><a data-type="indexterm" data-primary="chained streams" id="idm46038391237888"/><a data-type="indexterm" data-primary="filter streams" data-see="chained streams" id="idm46038391234592"/><a data-type="indexterm" data-primary="intermediate operations" data-secondary="creating stream pipeline" id="idm46038391233488"/><a data-type="indexterm" data-primary="pipelines, stream" data-see="stream pipeline" id="idm46038391232416"/><a data-type="indexterm" data-primary="stream pipeline" id="idm46038391231312"/><a data-type="indexterm" data-primary="stream pipeline" data-secondary="creating" id="idm46038391230480"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="building blocks" id="idm46038391229376"/><a data-type="indexterm" data-primary="terminal operations" data-secondary="in stream operations" id="idm46038391228400"/>We wrote a lot of code just to output the first four elements in the list. We also introduced a lot of new terminology: streams, intermediate operations, and terminal operations. Let’s put all this together: you create a <strong>stream p</strong><strong>i</strong><strong>peline</strong><strong><code/></strong> from three different types of building blocks.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> Get the Stream from a <strong>source</strong> collection.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0379-01.png" alt="image" width="392" height="74"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> Call zero or more <strong>intermediate operations</strong> on the Stream.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0379-02.png" alt="image" width="228" height="108"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> Output the results with a <strong>terminal operation</strong>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0379-03.png" alt="image" width="384" height="85"/>
<h6/>
</div></figure></li>
</ul>
<p>You need at least the <strong><em>first</em></strong> and <strong><em>last</em></strong> pieces of the puzzle to use the Streams API. However, you don’t need to assign each step to its own variable (which we were doing on the last page). In fact, the operations are designed to be <strong>chained</strong>, so you can call one stage straight after the previous one, without putting each stage in its own variable.</p>
<p>On the last page, all the building blocks for the stream were highlighted (stream, limit, count, collect). We can take these building blocks and rewrite the limit-and-collect operation in this way:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0379-04.png" alt="image" width="793" height="291"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Building blocks can be stacked and combined"><div class="sect1" id="building_blocks_can_be_stacked_and_combi">
<h1>Building blocks can be stacked and combined</h1>
<p><a data-type="indexterm" data-primary="intermediate operations" data-secondary="chaining operations" id="idm46038391207392"/><a data-type="indexterm" data-primary="queries" data-secondary="stream pipelines as queries on collection" id="idm46038391205968"/><a data-type="indexterm" data-primary="terminal operations" data-secondary="stacking" id="idm46038391204896"/>Every intermediate operation acts on a Stream and returns a Stream. That means you can stack together as many of these operations as you want, before calling a terminal operation to output the results.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0380-01.png" alt="image" width="170" height="304"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">The source, the intermediate operation(s), and the terminal operation all combine to form a <u>Stream Pipeline</u>. This pipeline represents a query on the original collection.</span></strong></p>
</div>
<p>This is where the Streams API becomes really useful. In the earlier example, we needed three building blocks (stream, limit, collect) to create a shorter version of the original List, which may seem like a lot of work for a simple operation.</p>
<p>But to do something more complicated, we can stack together multiple operations in a single <strong>stream pipeline</strong>.</p>
<p>For example, we can sort the elements in the stream before we apply the limit:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0380-02.png" alt="image" width="794" height="228"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0380-03.png" alt="image" width="862" height="112"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Customizing the building blocks"><div class="sect1" id="customizing_the_building_blocks">
<h1>Customizing the building blocks</h1>
<p><a data-type="indexterm" data-primary="limit(), Stream" id="idm46038391191696"/><a data-type="indexterm" data-primary="sorted()" id="idm46038391190752"/>We can stack together operations to create a more advanced query on our collection. We can also customize what the blocks do too. For example, we customized the <strong><code>limit</code></strong> method by passing in the maximum number of items to return (four).</p>
<p>If we didn’t want to use the natural ordering to sort our Strings, we could define a specific way to sort them. It’s possible to set the sort criteria for the <strong><code>sorted</code></strong> method (remember, we did something similar in the previous chapter when we sorted Lou’s song list).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0381-01.png" alt="image" width="966" height="316"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0381-02.png" alt="image" width="507" height="112"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create complex pipelines block by block"><div class="sect1" id="create_complex_pipelines_block_by_block">
<h1>Create complex pipelines block by block</h1>
<p>Each new operation you add to the pipeline changes the output from the pipeline. Each operations tell the Streams API <em>what</em> it is you want to do.</p>
<pre data-type="programlisting">List&lt;String&gt; result = strings.stream()
                             .sorted((s1, s2) -&gt; s1.compareToIgnoreCase(s2))
                             <strong>.skip(2)</strong>
                             .limit(4)
                             .collect(Collectors.toList());</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0381-04.png" alt="image" width="863" height="112"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0382-01.png" alt="image" width="659" height="475"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Yes, because Streams are lazy"><div class="sect1" id="yescomma_because_streams_are_lazy">
<h1>Yes, because Streams are <u>lazy</u></h1>
<p><a data-type="indexterm" data-primary="terminal operations" data-secondary="as eager" id="idm46038391175072"/>That doesn’t mean they’re slow or useless! It means that each intermediate operation is just the instruction about what to do; it doesn’t perform the instruction itself. Intermediate operations are <em>lazily evaluated</em>.</p>
<p>The terminal operation is responsible for looking at the whole list of instructions, all those intermediate operations in the pipeline, and then running the whole set together in one go. Terminal operations are <em>eager</em>; they are run as soon as they’re called.</p>
<p>This means that in theory it’s possible to run the combination of instructions in the most efficient way. Instead of having to iterate over the original collection for each and every intermediate operation, it may be possible to do all the operations while only going through the data once.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0382-02.png" alt="image" width="629" height="499"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Terminal operations do all the work"><div class="sect1" id="terminal_operations_do_all_the_work">
<h1>Terminal operations do all the work</h1>
<p><a data-type="indexterm" data-primary="Collectors class" id="idm46038391163824"/><a data-type="indexterm" data-primary="intermediate operations" data-secondary="as lazily evaluated" id="idm46038391163008"/><a data-type="indexterm" data-primary="List interface" data-secondary="collecting to" id="idm46038391162000"/>Since intermediate operations are <em>lazy</em>, it’s up to the terminal operation to do everything.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1circlea.png" alt="Images" width="23" height="23"/></span> Perform all the intermediate operations as efficiently as possible. Ideally, just going through the original data once.</p></li>
<li><p><span class="inlineimage"><img src="Images/1circleb.png" alt="Images" width="23" height="23"/></span> Work out the result of the operation, which is defined by the terminal operation itself. For example, this could be a list of values, a single value, or a boolean (true/false).</p></li>
<li><p><span class="inlineimage"><img src="Images/1circlec.png" alt="Images" width="23" height="23"/></span> Return the result.</p></li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Collecting to a List"><div class="sect1" id="collecting_to_a_list">
<h1>Collecting to a List</h1>
<p>Now that we know more about what’s going on in a terminal operation, let’s take a closer look at the “magic incantation” that returns a list of results.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0383-01.png" alt="image" width="796" height="357"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0383-02.png" alt="image" width="413" height="171"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Guidelines for working with streams"><div class="sect1" id="guidelines_for_working_with_streams">
<h1>Guidelines for working with streams</h1>
<p><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="inability to reuse" id="idm46038391146000"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="stream()" id="idm46038391144912"/>Like any puzzle or game, there are rules for getting the stream building blocks to work properly.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>You need at least the first and last pieces to create a stream pipeline.</strong></p>
<p>Without the <strong><code>stream</code></strong><strong><code>()</code></strong> piece, you don’t get a Stream at all, and without the terminal operation, you’re not going to get any results.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0384-01.png" alt="image" width="470" height="247"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>You can’t reuse Streams.</strong></p>
<p>It might seem useful to store a Stream representing a query, and reuse it in multiple places, either because the query itself is useful or because you want to build on it and add to it. But once a terminal operation has been called on a stream, you can’t reuse any parts of that stream; you have to create a new one. Once a pipeline has executed, that stream is closed and can’t be used in another pipeline, even if you stored part of it in a variable for reusing elsewhere. If you try to reuse a stream in any way, you’ll get an Exception.</p>
<pre data-type="programlisting"><strong>Stream&lt;String&gt; limit = strings.stream()</strong>
                              <strong>.limit(4);</strong>
<strong>List&lt;String&gt; result = limit.collect(Collectors.toList());</strong>
<strong>List&lt;String&gt; result2 = limit.collect(Collectors.toList());</strong></pre>
<figure class="informal"><div class="figure">
<img src="Images/f0384-04.png" alt="image" width="947" height="188"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>You can’t change the underlying collection while the stream is operating.</strong></p>
<p>If you do this, you’ll see strange results, or exceptions. Think about it—if someone asked you a question about what was in a shopping list and then someone else was scribbling on that shopping list at the same time, you’d give confusing answers too.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0384-05.png" alt="image" width="374" height="382"/>
<h6/>
</div></figure></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0385-01.png" alt="image" width="460" height="332"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Correct! Stream operations don’t change the original collection."><div class="sect2" id="correctexclamation_mark_stream_operation">
<h2>Correct! Stream operations <u>don’t</u> change the original collection.</h2>
<p><a data-type="indexterm" data-primary="collections" data-secondary="streams as queries" id="idm46038391116336"/><a data-type="indexterm" data-primary="queries" data-secondary="stream pipelines as queries on collection" id="idm46038391115360"/>The Streams API is a way to query a collection, but it <strong>doesn’t make changes</strong> to the collection itself. You can use the Streams API to look through that collection and return results based on the contents of the collection, but your original collection will remain the same as it was.</p>
<p>This is actually very helpful. It means you can query collections and output the results from anywhere in your program and know that the data in your original collection is safe; it will not be changed (“mutated”) by any of these queries.</p>
<p>You can see this in action by printing out the contents of the original collection after using the Streams API to query it.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0385-02.png" alt="image" width="846" height="179"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0385-03.png" alt="image" width="775" height="221"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000018">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Code Magnets"><div class="sect2" id="code_magnets-id000004">
<h2>Code Magnets</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0386-02.png" alt="image" width="100" height="146"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Code Magnets" id="idm46038391102848"/>A Java program is all scrambled up on the fridge. Can you reconstruct the code snippets to make a working Java program that produces the output listed below?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0386-03.png" alt="image" width="1054" height="986"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#code_magnets_left_parenthesisfrom_page_3">“Code Magnets”</a>.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00035">
<h5>there are no Dumb Questions</h5>
<p><a data-type="indexterm" data-primary="collections" data-secondary="streams as queries" id="idm46038391095136"/><a data-type="indexterm" data-primary="Collectors class" id="idm46038391093104"/><a data-type="indexterm" data-primary="Collectors.toList" id="idm46038391092304"/><a data-type="indexterm" data-primary="Collectors.toUnmodifiableList" id="idm46038391091472"/><a data-type="indexterm" data-primary="convenience methods" id="idm46038391090672"/><a data-type="indexterm" data-primary="factory methods" id="idm46038391089840"/><a data-type="indexterm" data-primary="List interface" data-secondary="unmodifiable output" id="idm46038391089008"/><strong>Q: Is there a limit to the number of intermediate operations I can put in a stream pipeline?</strong></p>
<p><strong>A:</strong> No, you can keep chaining these operations as much as you like. But do remember that it’s not just computers that have to read and understand this code; it’s humans too! If the stream pipeline is really long, it might be too complicated to understand. That’s when you might want to split it up and assign sections to variables, so you can give these variables useful names.</p>
<p><strong>Q: Is there any point in having a stream pipeline <em>without</em> intermediate operations?</strong></p>
<p><strong>A:</strong> Yes, you might find that there’s a terminal operation that outputs the original collection in some new shape, which is just right for what you need. Be aware, however, that some of the terminal operations are similar to methods that exist on the collection; you don’t always need to use streams. For example, if you’re just using <strong><code>count</code></strong> on a Stream, you could probably use <strong><code>size</code></strong> instead, if your original collection is a List. Similarly, anything that is Iterable (like List) already has a <strong><code>forEach</code></strong> method; you don’t need to use <strong><code>stream().forEach()</code></strong>.</p>
<p><strong>Q: You said not to change the source collection while the stream operation is in progress. How is it possible to change the collection from my code, if my code is doing a stream operation?</strong></p>
<p><strong>A:</strong> Great question! It’s possible to write programs that run different bits of code at the same time. We’ll learn about this in <a data-type="xref" href="ch17.xhtml#make_a_connection_networking_and_threads">Chapter 17</a> and <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a>, which cover concurrency. To be safe, it’s usually best (not just for Streams, but in general) to create collections that can’t be changed if you know they don’t need to be changed.</p>
<p><strong>Q: How can I output a List that can’t be changed from the collect terminal operation?</strong></p>
<p><strong>A:</strong> If you’re using Java 10 or higher, you can use <strong><code>Collectors.toUnmodifiableList</code></strong>, instead of using <strong><code>Collectors.toList</code></strong>, when you call <strong><code>collect</code></strong>.</p>
<p><strong>Q: Can I get the results of the stream pipeline in a collection that isn’t a List?</strong></p>
<p><strong>A:</strong> Yes! In the previous chapter we learned that there are a few different kinds of collections for different purposes. The Collectors class has convenience methods for collecting <strong><code>toList</code></strong>, <strong><code>toSet</code></strong>, and <strong><code>toMap</code></strong>, as well as (since Java 10) <strong><code>toUnmodifiableList</code></strong>, <strong><code>toUnmodifiableSet</code></strong>, and <strong><code>toUnmodifiableMap</code></strong>.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00012">
<h5>Bullet Points</h5>
<ul>
<li><p>You don’t have to write detailed code telling the JVM exactly what to do and how to do it. You can use library methods, including the Streams API, to query collections and output the results.</p></li>
<li><p>Use  <code><strong>forEach</strong></code> on a collection instead of creating a <em>for</em> loop. Pass the method a lambda expression of the operation to perform on each element of the collection.</p></li>
<li><p>Create a stream from a collection (a <strong>source</strong>) by calling the  <code><strong>stream</strong></code> method.</p></li>
<li><p>Configure the query you want to run on the collection by calling one or more <strong>intermediate operations</strong> on the stream.</p></li>
<li><p>You won’t get any results until you call a terminal operation. There are a number of different <strong>terminal operations</strong> depending upon what you want your query to output.</p></li>
<li><p>To output the results into a new List, use <code><strong>collect(Collectors.toList)</strong></code> as the terminal operation.</p></li>
<li><p>The combination of the source collection, intermediate operations, and terminal operations is a <strong>stream pipeline</strong>.</p></li>
<li><p>Stream operations do not change the original collection; they are a way to query the collection and return a different Object, which is a result of the query.</p></li>
</ul>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Hello Lambda, my (not so) old friend"><div class="sect1" id="hello_lambdacomma_my_left_parenthesisnot">
<h1>Hello Lambda, my (not so) old friend</h1>
<p><a data-type="indexterm" data-primary="-&gt; (arrow operator) for lambda expressions" id="idm46038391048992"/><a data-type="indexterm" data-primary="forEach()" id="idm46038391048480"/><a data-type="indexterm" data-primary="lambda expressions" id="idm46038391047968"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="lambda expressions" id="idm46038391047456"/>Lambda expressions have cropped up in the streams examples so far, and you can bet your bottom dollar (or euro, or currency of your choice) that you’re going to see more of them before this chapter is done.</p>
<p>Having a better understanding of what lambda expressions are will make it easier to work with the Streams API, so let’s take a closer look at lambdas.</p>
<section data-type="sect2" data-pdf-bookmark="Passing behavior around"><div class="sect2" id="passing_behavior_around">
<h2>Passing behavior around</h2>
<p>If you wrote a <strong><code>forEach</code></strong> method, it might look something like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0388-01.png" alt="image" width="635" height="149"/>
<h6/>
</div></figure>
<p>What would you put in the place where “?????” is? It would need to somehow <strong>be</strong> the block of code that’s going to go into that nice, blank square.</p>
<p>Then you want someone calling the method to be able to say:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0388-02.png" alt="image" width="706" height="210"/>
<h6/>
</div></figure>
<p>Now, we need to replace the <em>do this</em> with some sort of symbol to represent that this code isn’t to be run straightaway, but instead needs to be passed into the method. We could use, oh, let’s see... “<strong><code>-&gt;</code></strong>” as this symbol.</p>
<p>Then we need a way to say “look, this code is going to need to work on values from elsewhere.” We could put the things the code needs on the left side of the “do this” symbol....</p>
<figure class="informal"><div class="figure">
<img src="Images/f0388-03.png" alt="image" width="484" height="57"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0388-04.png" alt="image" width="427" height="317"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0389-01.png" alt="image" width="528" height="335"/>
<h6/>
</div></figure>
<section data-type="sect3" data-pdf-bookmark="Lambda expressions are objects, and you run them by calling their Single Abstract Method"><div class="sect3" id="lambda_expressions_are_objectscomma_and">
<h3>Lambda expressions are objects, and you run them by calling their Single Abstract Method</h3>
<p><a data-type="indexterm" data-primary="classes" data-secondary="lambda expressions as" id="idm46038391034608"/><a data-type="indexterm" data-primary="functional interface, lambda expression" id="idm46038391033600"/><a data-type="indexterm" data-primary="interfaces" data-secondary="functional interface" id="idm46038391033024"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="calling Single Abstract Method" id="idm46038391032256"/><a data-type="indexterm" data-primary="objects" data-secondary="lambda expressions as" id="idm46038391031520"/><a data-type="indexterm" data-primary="SAM (Single Abstract Method)" id="idm46038391030752"/>Remember, everything in Java is an Object (well, except for the primitive types), and lambdas are no exception.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">A lambda expression implements a Functional Interface.</span></strong></p>
</div>
<p>This means the reference to the lambda expression is going to be a Functional Interface. So, if you want your method to accept a lambda expression, you need to have a parameter whose type is a functional interface. That functional interface needs to be the right “shape” for your lambda.</p>
<p>Back to our imaginary <strong><code>forEach</code></strong> example; our parameter needs to implement a Functional Interface. We also need to call that lambda expression somehow, passing in the list element.</p>
<p>Remember, Functional Interfaces have a Single Abstract Method (SAM). It’s this method, whatever its name is, that gets called when we want to run the lambda code.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0389-02.png" alt="image" width="752" height="322"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">Lambdas aren’t magic; they’re just classes like everything else.</span></strong></p>
</div>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The shape of lambda expressions"><div class="sect1" id="the_shape_of_lambda_expressions">
<h1>The shape of lambda expressions</h1>
<p><a data-type="indexterm" data-primary="Comparator interface" data-secondary="lambda expressions with" id="idm46038391017216"/><a data-type="indexterm" data-primary="return keyword, lambda expression" id="idm46038391014352"/><a data-type="indexterm" data-primary="sorted()" id="idm46038391013552"/>We’ve seen two lambda expressions that implement the Comparator interface: the example for sorting Lou’s songs in the previous chapter, and the lambda expression we passed into the <strong><code>sorted</code></strong><strong><code>()</code></strong> stream operation in <a data-type="xref" href="#customizing_the_building_blocks">“Customizing the building blocks”</a>. Look at this last example side by side with the Comparator Functional Interface.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0390-01.png" alt="image" width="994" height="372"/>
<h6/>
</div></figure>
<p>You might be wondering where the <strong>return</strong> keyword is in the lambda expression. The short version is: you don’t need it. The longer version is, if the lambda expression is a single line, and if the functional interface’s method signature requires a returned value, the compiler just assumes that your one line of code will generate the value that is to be returned.</p>
<p>The lambda expression can also be written like this, if you want to add all the parts a lambda expression can have:</p>
<pre data-type="programlisting"><strong>(String s1, String s2) -&gt; {</strong>
  <strong>return s1.compareToIgnoreCase(s2);</strong>
<strong>}</strong></pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Anatomy of a lambda expression"><div class="sect1" id="anatomy_of_a_lambda_expression">
<h1>Anatomy of a lambda expression</h1>
<p><a data-type="indexterm" data-primary="lambda expressions" data-secondary="anatomy of" id="idm46038391003872"/>If you take a closer look at this expanded version of the lambda expression that implements <code>Comparator&lt;String&gt;</code>, you’ll see it’s not so different from a standard Java method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0391-01.png" alt="image" width="1007" height="733"/>
<h6/>
</div></figure>
<p>The shape of the lambda (its parameters, return type, and what it can reasonably be expected to do) is dictated by the Functional Interface it implements.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Variety is the spice of life"><div class="sect1" id="variety_is_the_spice_of_life">
<h1>Variety is the spice of life</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0392-01.png" alt="image" width="394" height="375"/>
<h6/>
</div></figure>
<p>Lambda expressions can come in all shapes and sizes, and still conform to the same basic rules that we’ve seen.</p>
<section data-type="sect2" data-pdf-bookmark="A lambda might have more than one line"><div class="sect2" id="a_lambda_might_have_more_than_one_line">
<h2>A lambda might have more than one line</h2>
<p>A lambda expression is effectively a method, and can have as many lines as any other method. Multiline lambda expressions <strong><em>must</em></strong> be inside curly braces. Then, like any other method code, every line <strong><em>must</em></strong> end in a semicolon, and if the method is supposed to return something, the lambda body <strong><em>must</em></strong> include the word “return” like any normal method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0392-02.png" alt="image" width="760" height="262"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Single-line lambdas don’t need ceremony"><div class="sect2" id="single-line_lambdas_donapostrophet_need">
<h2>Single-line lambdas don’t need ceremony</h2>
<p>If your lambda expression is a single line, it makes it much easier for the compiler to guess what’s going on. Therefore, we can leave out a lot of the “boilerplate” syntax. If we shrink the lambda expression from the last example into a single line, it looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0392-03.png" alt="image" width="567" height="109"/>
<h6/>
</div></figure>
<p>This is the same Functional Interface (Comparator) and performs the same operation. Whether you use multiline lambdas or single-line lambdas is completely up to you. It will probably depend upon how complicated the logic in the lambda expression is, and how easy you think it is to read—sometimes longer code can be more descriptive.</p>
<p>Later, we’ll see another approach for handling long lambda expressions.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="A lambda might not return anything"><div class="sect2" id="a_lambda_might_not_return_anything">
<h2>A lambda might not return anything</h2>
<p><a data-type="indexterm" data-primary="forEach()" id="idm46038391070256"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="parameters" id="idm46038390979584"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="void return in" id="idm46038390978480"/><a data-type="indexterm" data-primary="methods" data-secondary="parameters" data-see="parameters" id="idm46038390977376"/>The Functional Interface’s method might be declared void; i.e., it doesn’t return anything. In these cases, the code inside the lambda is simply run, and you don’t need to return any values from the lambda body.</p>
<p>This is the case for lambda expressions in a <strong><code>forEach</code></strong> method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0393-01.png" alt="image" width="859" height="236"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="A lambda might have zero, one, or many parameters"><div class="sect2" id="a_lambda_might_have_zerocomma_onecomma_o">
<h2>A lambda might have zero, one, or many parameters</h2>
<p>The number of parameters the lambda expression needs is dependent upon the number of parameters the Functional Interface’s method takes. The parameter types (e.g., the name “String”) are not usually required, but you can add them if you think it makes it easier to understand the code. You may need to add the types if the compiler can’t automatically work out which Functional Interface your lambda implements.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0393-02.png" alt="image" width="950" height="506"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How can I tell if a method takes a lambda?"><div class="sect1" id="how_can_i_tell_if_a_method_takes_a_lambd">
<h1>How can I tell if a method takes a lambda?</h1>
<p><a data-type="indexterm" data-primary="assignment" data-secondary="lambda expression variables" id="idm46038391910752"/><a data-type="indexterm" data-primary="SAM (Single Abstract Method)" id="idm46038390959360"/><a data-type="indexterm" data-primary="types" id="idm46038390958560"/><a data-type="indexterm" data-primary="types" data-secondary="for lambda expression" id="idm46038390957936"/>By now you’ve seen that lambda expressions are implementations of a functional interface—that is, an Interface with a Single Abstract Method. That means the <strong>type</strong> of a lambda expression is this interface.</p>
<p>Go ahead and create a lambda expression. Instead of passing this into some method, as we have been doing so far, assign it to a variable. You’ll see it can be treated just like any other Object in Java, because everything in Java is an Object. The variable’s type is the Functional Interface.</p>
<pre data-type="programlisting"><strong>Comparator&lt;String&gt; comparator = (s1, s2) -&gt; s1.compareToIgnoreCase(s2);</strong>

<strong>Runnable runnable = () -&gt; System.out.println("Hello!");</strong>

<strong>Consumer&lt;String&gt; consumer = str -&gt; System.out.println(str);</strong></pre>
<p>How does this help us see if a method takes a lambda expression? Well, the method’s parameter type will be a Functional Interface. Take a look at some examples from the Streams API:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0394-01.png" alt="image" width="736" height="598"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000019">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="BE the Compiler, advanced"><div class="sect2" id="be_the_compilercomma_advanced-id0001">
<h2>BE the Compiler, advanced</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0395-01.png" alt="image" width="226" height="261"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Be the..." id="idm46038390944688"/><strong>Your job is to play compiler and determine which of these statements would compile. But some of this code wasn’t covered in the chapter, so you need to work out the answers based on what you DID learn, applying the “rules” to these new situations.</strong></p>
<p><strong>The signatures of the functional interfaces are on the right, for your convenience.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0395-02.png" alt="image" width="416" height="397"/>
<h6/>
</div></figure>
<p><strong>Check the box if the statement would compile.</strong></p>
<table class="border">
<tbody>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Runnable r = () -&gt; System.out.println("Hi!");</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Consumer&lt;String&gt; c = s -&gt; System.out.println(s);</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Supplier&lt;String&gt; s = () -&gt; System.out.println("Some string");</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Consumer&lt;String&gt; c = (s1, s2) -&gt; System.out.println(s1 + s2);</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Runnable r = (String str) -&gt; System.out.println(str);</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Function&lt;String, Integer&gt; f = s -&gt; s.length();</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Supplier&lt;String&gt; s = () -&gt; "Some string";</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Consumer&lt;String&gt; c = s -&gt; "String" + s;</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Function&lt;String, Integer&gt; f = (int i) -&gt; "i = " + i;</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Supplier&lt;String&gt; s = s -&gt; "Some string: " + s;</strong></code></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><code><strong>Function&lt;String, Integer&gt; f = (String s) -&gt; s.length();</strong></code></td>
</tr>
</tbody>
</table>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#be_the_compiler_left_parenthesis-id00001">“BE the Compiler”</a>.</strong></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Spotting Functional Interfaces"><div class="sect1" id="spotting_functional_interfaces">
<h1>Spotting Functional Interfaces</h1>
<p><a data-type="indexterm" data-primary="abstract methods" id="idm46038390902624"/><a data-type="indexterm" data-primary="default method" id="idm46038390902112"/><a data-type="indexterm" data-primary="@FunctionalInterface annotation" id="idm46038390901488"/><a data-type="indexterm" data-primary="methods" data-secondary="abstract" id="idm46038390900752"/><a data-type="indexterm" data-primary="static methods" id="idm46038390899776"/>So far we’ve seen Functional Interfaces that are marked with a <strong><code>@FunctionalInterface</code></strong> <em>annotation</em> (we’ll cover annotations in <a data-type="xref" href="app02.xhtml#appendix_b_the_top_ten-ish_topics_that_d">Appendix B</a>), which conveniently tells us this interface has a Single Abstract Method and can be implemented with a lambda expression.</p>
<p>Not all functional interfaces are tagged this way, particularly in older code, so it’s useful to understand how to spot a functional interface for yourself.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0396-01.png" alt="image" width="640" height="404"/>
<h6/>
</div></figure>
<p><strong>Not so fast!</strong></p>
<p>Originally, the only kind of methods allowed in interfaces were <strong>abstract</strong> methods, methods that need to be <em>overridden</em> by any class that <em>implements</em> this interface. But as of Java 8, interfaces can also contain <strong><code>default</code></strong> and <strong><code>static</code></strong> methods.</p>
<p>You saw static methods in <a data-type="xref" href="ch10.xhtml#numbers_matter_numbers_and_statics">Chapter 10</a>, <em>Numbers Matter</em>, and you’ll see them later in this chapter too. These are methods that don’t need to belong to an instance, and are often used as helper methods.</p>
<p>Default methods are slightly different. Remember abstract classes from <a data-type="xref" href="ch08.xhtml#serious_polymorphism_interfaces_and_abst">Chapter 8</a>, <em>Serious Polymorphism</em>? They had abstract methods that need to be overridden, and standard methods with a body. On an interface, a default method works a bit like a standard method in an abstract class—they have a body, and will be inherited by subclasses.</p>
<p>Both default and static methods have a method body, with defined behavior. With interfaces, any method that is not defined as <strong><code>default</code></strong> or <strong><code>static</code></strong> is an abstract method that <em>must</em> be overridden.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Functional interfaces in the wild"><div class="sect1" id="functional_interfaces_in_the_wild">
<h1>Functional interfaces in the wild</h1>
<p><a data-type="indexterm" data-primary="Comparator interface" id="idm46038390885232"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="as SAM type" id="idm46038390884720"/><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038390884080"/>Now that we know interfaces can have <strong>non</strong>-abstract methods, we can see there’s a bit more of a trick to identifying interfaces with just one abstract method. Take a look at our old friend, Comparator. It has a <strong>lot</strong> of methods! And yet it’s still a SAM-type; it has only one Single Abstract Method. It’s a Functional Interface we can implement as a lambda expression.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0397-01.png" alt="image" width="887" height="383"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00030">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>Which of these interfaces has a Single Abstract Method and can therefore be implemented as a lambda expression?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0397-02.png" alt="image" width="757" height="456"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#sharpen_your_pencil_left_parenthe-id0001">“Sharpen your pencil”</a>.</strong></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="Images/f0398-01.png" alt="image" width="351" height="550"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Lou’s back!"><div class="sect1" id="louapostrophes_backexclamation_mark">
<h1>Lou’s back!</h1>
<p><a data-type="indexterm" data-primary="Ready-Bake Code" data-secondary="Songs class" id="idm46038390869360"/>Lou’s been running his new jukebox management software from the last chapter for some time now, and he wants to learn so much more about the songs played on the diner’s jukebox. Now that he has the data, he wants to slice-and-dice it and put it together in a new shape, just as he does with the ingredients of his famous Special Omelette!</p>
<p>He’s thinking there are all kinds of information he could learn about the songs that are played, like:</p>
<ul>
<li><p>What are the top five most-played songs?</p></li>
<li><p>What sort of genres are played?</p></li>
<li><p>Are there any songs with the same name by different artists?</p></li>
</ul>
<p>We <em>could</em> find these things out writing a for loop to look at our song data, performing checks using if statements, and perhaps putting songs, titles, or artists into different collections to find the answers to these questions.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">But now that we know about the Streams API, we know there’s an easier way....</span></strong></p>
</div>
<p>The code on the next page is your <strong>mock</strong> code; calling <strong><code>Songs.getSongs()</code></strong> will give you a List of Song objects that you can assume looks just like the real data from Lou’s jukebox.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000020">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<p>Type in the Ready-Bake Code on the next page, including filling out the rest of the Song class. When you’ve done that, create a main method that prints out all the songs.</p>
<p>What do you expect the output to look like?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Ready-Bake Code"><div class="sect1" id="ready_bake_code">
<h1>Ready-Bake Code</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0399-01.png" alt="image" width="97" height="106"/>
<h6/>
</div></figure>
<p>Here’s an updated “mock” method. It will return some test data that we can use on to try out some of the reports Lou wants to create for the jukebox system. There’s also an updated Song class.</p>
<pre data-type="programlisting"><strong>class Songs {</strong>
  <strong>public List&lt;Song&gt; getSongs() {</strong>
    <strong>return List.of(</strong>
      <strong>new Song("$10", "Hitchhiker", "Electronic", 2016, 183),</strong>
      <strong>new Song("Havana", "Camila Cabello", "R&amp;B", 2017, 324),</strong>
      <strong>new Song("Cassidy", "Grateful Dead", "Rock", 1972, 123),</strong>
      <strong>new Song("50 ways", "Paul Simon", "Soft Rock", 1975, 199),</strong>
      <strong>new Song("Hurt", "Nine Inch Nails", "Industrial Rock", 1995, 257),</strong>
      <strong>new Song("Silence", "Delerium", "Electronic", 1999, 134),</strong>
      <strong>new Song("Hurt", "Johnny Cash", "Soft Rock", 2002, 392),</strong>
      <strong>new Song("Watercolour", "Pendulum", "Electronic", 2010, 155),</strong>
      <strong>new Song("The Outsider", "A Perfect Circle", "Alternative Rock", 2004, 312),</strong>
      <strong>new Song("With a Little Help from My Friends", "The Beatles", "Rock", 1967, 168),</strong>
      <strong>new Song("Come Together", "The Beatles", "Blues rock", 1968, 173),</strong>
      <strong>new Song("Come Together", "Ike &amp; Tina Turner", "Rock", 1970, 165),</strong>
      <strong>new Song("With a Little Help from My Friends", "Joe Cocker", "Rock", 1968, 46),</strong>
      <strong>new Song("Immigrant Song", "Karen O", "Industrial Rock", 2011, 12),</strong>
      <strong>new Song("Breathe", "The Prodigy", "Electronic", 1996, 337),</strong>
      <strong>new Song("What's Going On", "Gaye", "R&amp;B", 1971, 420),</strong>
      <strong>new Song("Hallucinate", "Dua Lipa", "Pop", 2020, 75),</strong>
      <strong>new Song("Walk Me Home", "P!nk", "Pop", 2019, 459),</strong>
      <strong>new Song("I am not a woman, I'm a god", "Halsey", "Alternative Rock", 2021, 384),</strong>
      <strong>new Song("Pasos de cero", "Pablo Alborán", "Latin", 2014, 117),</strong>
      <strong>new Song("Smooth", "Santana", "Latin", 1999, 244),</strong>
      <strong>new Song("Immigrant song", "Led Zeppelin", "Rock", 1970, 484));</strong>
  <strong>}</strong>
<strong>}</strong>
<strong>public class Song {</strong>
  <strong>private final String title;</strong>
  <strong>private final String artist;</strong>
  <strong>private final String genre;</strong>
  <strong>private final int year;</strong>
  <strong>private final int timesPlayed;</strong>
  // Practice for you! Create a constructor, all the getters and a toString()
<strong>}</strong></pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Lou’s Challenge #1: Find all the “rock” songs"><div class="sect1" id="louapostrophes_challenge_hash1_find_all">
<h1>Lou’s Challenge #1: Find all the “rock” songs</h1>
<p><a data-type="indexterm" data-primary="filter()" id="idm46038390824608"/><a data-type="indexterm" data-primary="List interface" data-secondary="collecting to" id="idm46038390823680"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="filtering" id="idm46038390822880"/>The data in the updated song list contains the <em>genre</em> of the song. Lou’s noticed that the diner’s clientele seem to prefer variations on rock music, and he wants to see a list of all the songs that fall under some genre of “rock.”</p>
<p>This is the Streams chapter, so clearly the solution is going to involve the Streams API. Remember, there are three types of pieces we can put together to form a solution.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0400-01.png" alt="image" width="793" height="418"/>
<h6/>
</div></figure>
<p>Fortunately, there are hints about how to create a Streams API call based on the requirements Lou gave us: he wants to <strong><code>filter</code></strong> for just the Songs with a particular genre, and he wants to <strong><code>collect</code></strong> them into a new List<code>.</code></p>
<figure class="informal"><div class="figure">
<img src="Images/f0400-02.png" alt="image" width="1000" height="397"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Filter a stream to keep certain elements"><div class="sect1" id="filter_a_stream_to_keep_certain_elements">
<h1>Filter a stream to keep certain elements</h1>
<p>Let’s see how a filter operation might work on the list of songs.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0401-01.png" alt="image" width="840" height="732"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Let’s Rock!"><div class="sect1" id="letapostrophes_rockexclamation_mark">
<h1>Let’s Rock!</h1>
<p><a data-type="indexterm" data-primary="lambda expressions" data-secondary="implementing Predicate" id="idm46038390834192"/><a data-type="indexterm" data-primary="parameters" data-secondary="lambda expressions" id="idm46038390813072"/><a data-type="indexterm" data-primary="Predicate" id="idm46038390812096"/>So adding a <strong><code>filter</code></strong> operation filters out elements that we don’t want, and the stream continues with just the elements that meet our criteria. It should come as no surprise to find that you can use a lambda expression to state which elements we want to keep in the stream.</p>
<p>The filter method takes a <strong><code>Predicate</code></strong>.</p>
<p>Given what we know about the shapes of lambda expressions, we should be able to work out how to write a lambda expression that implements Predicate.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0402-01.png" alt="image" width="803" height="347"/>
<h6/>
</div></figure>
<p>We’ll know what the type of the single parameter is when we plug it into the Stream operation, since the input type to the lambda will be determined by the types in the stream.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0402-02.png" alt="image" width="1012" height="541"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Getting clever with filters"><div class="sect1" id="getting_clever_with_filters">
<h1>Getting clever with filters</h1>
<p><a data-type="indexterm" data-primary="contains()" id="idm46038390803632"/>The <strong><code>filter</code></strong> method, with its “simple” true or false return value, can contain sophisticated logic to filter elements in, or out, of the stream. Let’s take our filter one step further and actually do what Lou asked:</p>
<p><em>He wants to see a list of all the songs that fall under</em> <strong><em>some genre</em></strong> <em>of “rock.</em><em>”</em></p>
<p>He doesn’t want to see just the songs that are classed as “Rock,” but any genre that is kinda Rock-like. We should search for any genre that has the word “Rock” in it somewhere.</p>
<p>There’s a method in String that can help us with this, it’s called <strong><code>contains</code></strong>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0403-01.png" alt="image" width="856" height="141"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0403-02.png" alt="image" width="835" height="317"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_barbell-id00004">
<h5>Brain Barbell</h5>
<figure class="informal"><div class="figure">
<img src="Images/barbell.png" alt="image" width="163" height="95"/>
<h6/>
</div></figure>
<p>Can you write a filter operation that can select songs:</p>
<ul>
<li><p>By The Beatles</p></li>
<li><p>That start with “H”</p></li>
<li><p>More recent than 1995</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Lou’s Challenge #2: List all the genres"><div class="sect1" id="louapostrophes_challenge_hash2_list_all">
<h1>Lou’s Challenge #2: List all the genres</h1>
<p>Lou now senses that the genres of music that the diners are listening to are more complicated than he thought. He wants a list of all the genres of the songs that have been played.</p>
<p>So far, all of our streams have returned the same types that they started with. The earlier examples were Streams of Strings, and returned Lists of Strings. Lou’s previous challenge started with a List of Songs and ended up with a (smaller) List of Songs.</p>
<p>Lou now wants a list of genres, which means we need to somehow turn the song elements in the stream into genre (String) elements. This is what <strong><code>map</code></strong> is for. The map operation states how to map <em>from</em> one type <em>to</em> another type.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0404-01.png" alt="image" width="767" height="513"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Mapping from one type to another"><div class="sect1" id="mapping_from_one_type_to_another">
<h1>Mapping from one type to another</h1>
<p><a data-type="indexterm" data-primary="Function, in map method" id="idm46038390810000"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="map operation" id="idm46038390809040"/><a data-type="indexterm" data-primary="stream pipeline" data-secondary="map operation" id="idm46038390790512"/>The map method takes a <strong><code>Function</code></strong>. The generics by definition are a bit vague, which makes it a little tricky to understand, but Functions do one thing: they take something of one type and return something of a different type. Exactly what’s needed for mapping varies from one type to another.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0405-01.png" alt="image" width="621" height="181"/>
<h6/>
</div></figure>
<p>Let’s see what it looks like when we use <strong><code>map</code></strong> in a stream pipeline.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0405-02.png" alt="image" width="863" height="317"/>
<h6/>
</div></figure>
<p>The map’s lambda expression is similar to the one for filter; it takes a song and turns it into something else. Instead of returning a boolean, it returns some other object, in this case a String containing the song’s genre.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0405-03.png" alt="image" width="592" height="235"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Removing duplicates"><div class="sect1" id="removing_duplicates">
<h1>Removing duplicates</h1>
<p><a data-type="indexterm" data-primary="distinct(), Stream" id="idm46038390859184"/><a data-type="indexterm" data-primary="duplicate results, removing" id="idm46038390858368"/>We’ve got a list of all the genres in our test data, but Lou probably doesn’t want to wade through all these duplicate genres. The <strong><code>map</code></strong> operation on its own will result in an output List that’s the same size as the input List. Since stream operations are designed to be stacked together, perhaps there’s another operation we can use to get just one of every element in the stream?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0406-01.png" alt="image" width="801" height="740"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Only one of every genre"><div class="sect1" id="only_one_of_every_genre">
<h1>Only one of every genre</h1>
<p>All we need to do is to add a distinct operation to the stream pipeline, and we’ll get just one of each genre.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0407-01.png" alt="image" width="968" height="281"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Just keep building!"><div class="sect1" id="just_keep_buildingexclamation_mark">
<h1>Just keep building!</h1>
<p>A stream pipeline can have any number of intermediate operations. The power of the Streams API is that we can build up complex queries with understandable building blocks. The library will take care of running this in a way that is as efficient as possible. For example, we could create a query that returns a list of all the artists that have covered a specific song, excluding the original artists, by using a map operation and multiple filters.</p>
<pre data-type="programlisting"><strong>String songTitle = "With a Little Help from My Friends";</strong>
<strong>List&lt;String&gt; result = allSongs.stream()</strong>
                              <strong>.filter(song -&gt; song.getTitle().equals(songTitle))</strong>
                              <strong>.map(song -&gt; song.getArtist())</strong>
                              <strong>.filter(artist -&gt; !artist.equals("The Beatles"))</strong>
                              <strong>.collect(Collectors.toList());</strong></pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00031">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>Try annotating this code yourself. What do each of the filters do? What does the map do?</p>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Yours to solve.</strong></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Sometimes you don’t even need a lambda expression"><div class="sect1" id="sometimes_you_donapostrophet_even_need_a">
<h1>Sometimes you don’t even need a lambda expression</h1>
<p><a data-type="indexterm" data-primary=":: (method reference)" id="idm46038390763424"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="and method reference" id="idm46038390762720"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="map operation" id="idm46038390761616"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="method reference replacement for" id="idm46038390760512"/><a data-type="indexterm" data-primary="method reference, stream" id="idm46038390759440"/><a data-type="indexterm" data-primary="static helper method" id="idm46038390758640"/>Some lambda expressions do something simple and predictable, given the type of the parameter or the shape of the functional interface. Look again at the lambda expression for the <strong><code>map</code></strong> operation.</p>
<pre data-type="programlisting">Function&lt;Song, String&gt; getGenre = <strong>song -&gt; song.getGenre();</strong></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">Method references can replace lambda expressions, but you don’t have to use them.</span></strong></p>
<p><strong><span style="color:#646466;">Sometimes method references make the code easier to understand.</span></strong></p>
</div>
<p>Instead of spelling this whole thing out, you can point the compiler to a method that does the operation we want, using a <strong>method reference</strong>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0408-02.png" alt="image" width="827" height="313"/>
<h6/>
</div></figure>
<p>Method references can replace lambda expressions in a number of different cases. Generally, we might use a method reference if it makes the code easier to read.</p>
<p>Take our old friend the Comparator, for example. There are a lot of helper methods on the Comparator interface that, when combined with a method reference, let you see which value is being used for sorting and in which direction. Instead of doing this, to order the songs from oldest to newest:</p>
<pre data-type="programlisting">List&lt;Song&gt; result = allSongs.stream()
                            .sorted(<strong>(o1, o2) -&gt; o1.getYear() - o2.getYear())</strong>
                            .collect(toList());</pre>
<p>Use a method reference combined with a <strong><code>static</code></strong> helper method from Comparator to state what the comparison should be:</p>
<pre data-type="programlisting">List&lt;Song&gt; result = allSongs.stream()
                            .sorted(<strong>Comparator.comparingInt(Song::getYear)</strong>)
                            .collect(toList());</pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-id0004">
<h5>Relax</h5>
<figure class="informal"><div class="figure">
<img src="Images/cup.png" alt="image" width="70" height="106"/>
<h6/>
</div></figure>
<p>You don’t need to use method references if you don’t feel comfortable with them. What’s important is to be able to recognize the “::” syntax, especially in a stream pipeline.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Collecting results in different ways"><div class="sect1" id="collecting_results_in_different_ways">
<h1>Collecting results in different ways</h1>
<p><a data-type="indexterm" data-primary="collections" data-secondary="Map" id="idm46038390739776"/><a data-type="indexterm" data-primary="Collectors class" id="idm46038390738800"/><a data-type="indexterm" data-primary="Collectors.joining" id="idm46038390738064"/><a data-type="indexterm" data-primary="Collectors.toList" id="idm46038390737328"/><a data-type="indexterm" data-primary="Collectors.toMap" id="idm46038390736528"/><a data-type="indexterm" data-primary="Collectors.toSet" id="idm46038390735696"/><a data-type="indexterm" data-primary="Collectors.toUnmodifiableList" id="idm46038390734864"/><a data-type="indexterm" data-primary="Collectors.toUnmodifiableMap" id="idm46038390734064"/><a data-type="indexterm" data-primary="Collectors.toUnmodifiableSet" id="idm46038390733264"/><a data-type="indexterm" data-primary="List interface" data-secondary="collecting to" id="idm46038390732464"/><a data-type="indexterm" data-primary="Map interface" data-secondary="and collections" id="idm46038390731360"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="collecting results" id="idm46038390730256"/>While <strong><code>Collectors.toList</code></strong> is the most commonly used Collector, there are other useful Collectors. For example, instead of using <strong><code>distinct</code></strong> to solve the last challenge, we could collect the results into a Set, which does not allow duplicates. The advantage of using this approach is that anything else that uses the results knows that because it’s a Set, <em>by definition</em> there will be no duplicates.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-01.png" alt="image" width="912" height="128"/>
<h6/>
</div></figure>
<p><strong>Collectors.toList and Collectors.toUnmodifiableList</strong></p>
<p>You’ve already seen <strong><code>toList</code></strong>. Alternatively, you can get a List that can’t be changed (no elements can be added, replaced or removed) by using <strong><code>Collectors.toUnmodifableList</code></strong> instead. This is only available from Java 10 onward.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-02.png" alt="image" width="275" height="121"/>
<h6/>
</div></figure>
<p><strong>Collectors.toSet and Collectors.toUnmodifiableSet</strong></p>
<p>Use these to put the results into a Set, rather than a List. Remember that a Set cannot contain duplicates, and is not usually ordered. If you’re using Java 10 or higher, you can use <strong><code>Collectors.toUnmodifiableSet</code></strong> if you want to make sure your results aren’t changed by anything.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-03.png" alt="image" width="230" height="151"/>
<h6/>
</div></figure>
<p><strong>Collectors.toMap and Collectors.toUnmodifiableMap</strong></p>
<p>You can collect your stream into a Map of key/value pairs. You will need to provide some functions to tell the collector what will be the key and what will be the value. You can use <strong><code>Collectors.toUnmodifiableMap</code></strong> to create a map that can’t be changed, from Java 10 onward.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-04.png" alt="image" width="269" height="118"/>
<h6/>
</div></figure>
<p><strong>Collectors.joining</strong></p>
<p>You can create a String result from the stream. It will join together all the stream elements into a single String. You can optionally define the <em>delimiter</em>, the character to use to separate each element. This can be very useful if you want to turn your stream into a String of Comma Separated Values (CSV).</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But wait, there’s more!"><div class="sect1" id="but_waitcomma_thereapostrophes_moreexcla">
<h1>But wait, there’s more!</h1>
<p><a data-type="indexterm" data-primary="Boolean expressions" data-secondary="querying collection for values" id="idm46038390710352"/><a data-type="indexterm" data-primary="collect()" id="idm46038390709344"/><a data-type="indexterm" data-primary="collections" data-secondary="count operation on" id="idm46038390708512"/><a data-type="indexterm" data-primary="count operation, on collections" id="idm46038390707408"/><a data-type="indexterm" data-primary="Optional value, returning from collection query" id="idm46038390706608"/><a data-type="indexterm" data-primary="queries" id="idm46038390705808"/><a data-type="indexterm" data-primary="queries" data-secondary="returning Optional value" id="idm46038390704976"/><a data-type="indexterm" data-primary="queries" data-secondary="terminal operation options" id="idm46038390703904"/><a data-type="indexterm" data-primary="terminal operations" data-secondary="collection query options" id="idm46038390702832"/><a data-type="indexterm" data-primary="wrappers" data-secondary="Optional as" id="idm46038390701760"/>Collecting the results is not the only game in town; <strong><code>collect</code></strong> is just one of many terminal operations.</p>
<section data-type="sect2" data-pdf-bookmark="Checking if something exists"><div class="sect2" id="checking_if_something_exists">
<h2>Checking if something exists</h2>
<p>You can use terminal operations that return a boolean value to look for certain things in the stream. For example, we can see if any R&amp;B songs have been played in the diner.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0410-01.png" alt="image" width="1014" height="137"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Find a specific thing"><div class="sect2" id="find_a_specific_thing">
<h2>Find a specific thing</h2>
<p>Terminal operations that return an <strong><code>Optional</code></strong> value look for certain things in the stream. For example, we can find the first song played that was released in 1995.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0410-02.png" alt="image" width="1023" height="211"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Count the items"><div class="sect2" id="count_the_items">
<h2>Count the items</h2>
<p>There’s a count operation that you can use to find out the number of elements in your stream. We could find the number of unique artists, for example.</p>
<pre data-type="programlisting"><strong>long result =</strong>
    <strong>songs.stream()</strong>
         <strong>.map(Song::getArtist)</strong>
         <strong>.distinct()</strong>
         <strong>.count();</strong></pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000035">
<pre data-type="programlisting"><strong>long count();</strong></pre>
</div></aside>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">There are even more terminal operations, and some of them depend upon the type of Stream you’re working with.</span></strong></p>
<p><strong><span style="color:#646466;">Remember, the API documentation can help you figure out if there’s a built-in operation that does what you want.</span></strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0411-01.png" alt="image" width="521" height="357"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Well, some operations may return something, or may not return anything at all"><div class="sect2" id="wellcomma_some_operations_may_return_som">
<h2>Well, some operations <u>may</u> return something, or <u>may not</u> return anything at all</h2>
<p>It might seem weird that a method <em>may</em> or <em>may not</em> return a value, but it happens all the time in real life.</p>
<p>Imagine you’re at an ice-cream stand, and you ask for strawberry ice cream.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0411-02.png" alt="image" width="975" height="238"/>
<h6/>
</div></figure>
<p>Easy, right? But what if they don’t have any strawberry? The ice-cream person is likely to tell you “we don’t have that flavor.”</p>
<figure class="informal"><div class="figure">
<img src="Images/f0411-03.png" alt="image" width="269" height="109"/>
<h6/>
</div></figure>
<p>It’s then up to you what you do next—perhaps order chocolate instead, find another ice-cream place, or maybe just go home and sulk about your lack of ice cream.</p>
<p>Imagine trying to do this in the Java world. In the first example, you get an ice-cream instance. In the second, you get...a String message? But a message doesn’t fit into an ice-cream-shaped variable. A null? But what does null really mean?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0411-04.png" alt="image" width="266" height="137"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0411-05.png" alt="image" width="144" height="261"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Optional is a wrapper"><div class="sect1" id="optional_is_a_wrapper">
<h1>Optional is a wrapper</h1>
<p>Since Java 8, the normal way for a method to declare that <em>sometimes it might not return a resu</em><em>lt</em> is to return an <strong>Optional</strong>. This is an object that <em>wraps</em> the result, so you can ask “Did I get a result? Or is it empty?” Then you can make a decision about what to do next.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0412-01.png" alt="image" width="965" height="246"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0412-02.png" alt="image" width="941" height="260"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0412-03.png" alt="image" width="999" height="286"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0413-01.png" alt="image" width="459" height="335"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Yes, but now we have a way to ask if we have a result"><div class="sect2" id="yescomma_but_now_we_have_a_way_to_ask_if">
<h2>Yes, but now we have a way to <u>ask</u> if we have a result</h2>
<p>Optional gives us a way to find out about, and deal with, the times when you don’t get an ice cream.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0413-02.png" alt="image" width="843" height="242"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0413-03.png" alt="image" width="834" height="374"/>
<h6/>
</div></figure>
<p>In the past, methods might have thrown Exceptions for this case, or return “null”, or a special type of “Not Found” ice-cream instance. Returning an <em>Optional</em> from a method makes it really clear that anything calling the method <em><strong>needs</strong></em> to check if there’s a result first, and <em><strong>then</strong></em> make their own decision about what to do if there isn’t one.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Don’t forget to talk to the Optional wrapper"><div class="sect1" id="donapostrophet_forget_to_talk_to_the_opt">
<h1>Don’t forget to talk to the Optional wrapper</h1>
<p>The important thing about Optional results is that <strong>they can be empty</strong>. If you don’t check first to see if there’s a value present and the result is empty, you will get an exception.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0414-01.png" alt="image" width="911" height="243"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0414-02.png" alt="image" width="920" height="200"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0414-03.png" alt="image" width="996" height="519"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="The Unexpected Coffee"><div class="sect2" id="the_unexpected_coffee">
<h2>The Unexpected Coffee</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0415-01.png" alt="image" width="100" height="67"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="puzzles" data-secondary="Five-Minute Mystery" id="idm46038390634736"/>Alex was programming her mega-ultra-clever (Java-powered) coffee machine to give her the types of coffee that suited her best at different times of day.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Five-Minute Mystery"><div class="sect2" id="five_minute_mystery-id000500">
<h2>Five-Minute Mystery</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0415-02.png" alt="image" width="150" height="114"/>
<h6/>
</div></figure>
<p>In the afternoons, Alex wanted the machine to give her the weakest coffee it had available (she had enough to keep her up at night; she didn’t need caffeine adding to her problems!). As an experienced software developer, she knew the Streams API would give her the best stream of coffee at the right time.</p>
<p>The coffees would automatically be sorted from the weakest to the strongest using natural ordering, so she gave the coffee machine these instructions:</p>
<pre data-type="programlisting">Optional&lt;String&gt; afternoonCoffee = coffees.stream()
                                          .map(Coffee::getName)
                                          .sorted()
                                          .findFirst();</pre>
<p>The very next day, she asked for an afternoon coffee. To her horror, the machine presented her with an Americano, not the Decaf Cappuccino she was expecting.</p>
<p>“I can’t drink that!! I’ll be up all night worrying about my latest software project!”</p>
<p><strong><em>What happened? Why did the coffee machine give Alex an Americano?</em></strong></p>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#five-minute_mystery_left_parent-id0001">“Five-Minute Mystery”</a>.</strong></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Pool Puzzle"><div class="sect2" id="pool_puzzle-id00005">
<h2>Pool Puzzle</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0416-01.png" alt="image" width="138" height="93"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0416-02.png" alt="image" width="175" height="157"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="puzzles" data-secondary="Pool Puzzle" id="idm46038390612464"/>Your <strong><em>job</em></strong> is to take code snippets from the pool and place them into the blank lines in the code. You may <strong><em>not</em></strong> use the same snippet more than once, and you won’t need to use all the snippets. Your <em><strong>goal</strong></em> is to make a class that will compile and run and produce the output listed.</p>
<p><strong>Output</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-03.png" alt="image" width="453" height="212"/>
<h6/>
</div></figure>
<p><strong>Note: each thing from the pool can be used only once!</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-05.png" alt="image" width="946" height="374"/>
<h6/>
</div></figure>
<pre data-type="programlisting">public class StreamPuzzle {
  public static void main(String[] args) {
    SongSearch songSearch = _____________;
    songSearch.___________;
    __________.search("The Beatles");
    ________________________________;
  }
}
class _____________ {
  private final List&lt;Song&gt; songs = 
      new JukeboxData.Songs().getSongs();

  void printTopFiveSongs() {
    List&lt;String&gt; topFive = songs.stream()
                         .______________
                         .______________
                         .______________
                         .collect(_________);
    System.out.println(topFive);
  }
  void search(String artist) {
    ________ = songs.stream()
                    ._______________
                    ._______________;
    if (_______________) {
      System.out.println(______________);
    } else {
      System.out.println(______________);
    }
  }
}</pre>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#pool_puzzle_left_parenthesisfrom_page_41">“Pool Puzzle”</a>.</strong></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Mixed Messages"><div class="sect2" id="mixed_messages_left_parenthesisf-id00001">
<h2>Mixed Messages</h2>
<p>(from <a data-type="xref" href="#when_for_loops_go_wrong">“When for loops go wrong”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0415-01.png" alt="image" width="100" height="67"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0417-01.png" alt="image" width="752" height="376"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Who Does What?"><div class="sect2" id="who_does_whatquestion_mark_left_parenthe">
<h2>Who Does What?</h2>
<p>(from <a data-type="xref" href="#brain_barbell-id00200">“WHO DOES WHAT?”</a>)</p>
<figure class="informal"><div class="figure"><img src="Images/f0417-02.png" alt="image" width="761" height="524"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise Solutions"><div class="sect1" id="exercise_solutions-id000100">
<h1>Exercise Solutions</h1>
<section data-type="sect2" data-pdf-bookmark="Code Magnets"><div class="sect2" id="code_magnets_left_parenthesisfrom_page_3">
<h2>Code Magnets</h2>
<p>(from <a data-type="xref" href="#code_magnets-id000004">“Code Magnets”</a>)</p>
<figure class="informal"><div class="figure"><img src="Images/f0418-01.png" alt="image" width="100" height="85"/>
<h6/>
</div></figure>
<pre data-type="programlisting">import java.util.*;
import java.util.stream.*;

public class CoffeeOrder {
  public static void main(String[] args) {
    List&lt;String&gt; coffees = List.of("Cappuccino",
            "Americano", "Espresso", "Cortado", "Mocha",
            "Cappuccino", "Flat White", "Latte");

    List&lt;String&gt; coffeesEndingInO = coffees.stream()
                                           .filter(s -&gt; s.endsWith("o"))
                                           .sorted()
                                           .distinct()
                                           .collect(Collectors.toList());
    System.out.println(coffeesEndingInO);
  }
}</pre>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000036">
<p><strong>What would happen if the stream operations were in a different order? Does it matter?</strong></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="Images/f0418-02-01.png" alt="image" width="307" height="136"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="BE the Compiler"><div class="sect2" id="be_the_compiler_left_parenthesis-id00001">
<h2>BE the Compiler</h2>
<p>(from <a data-type="xref" href="#be_the_compilercomma_advanced-id0001">“BE the Compiler, advanced”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0418-04.png" alt="image" width="2013" height="1178"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sharpen your pencil"><div class="sect2" id="sharpen_your_pencil_left_parenthe-id0001">
<h2>Sharpen your pencil</h2>
<p>(from <a data-type="xref" href="#sharpen_your_pencil-id00030">“Sharpen your pencil”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0419-01.png" alt="image" width="781" height="157"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0419-02.png" alt="image" width="770" height="449"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Five-Minute Mystery"><div class="sect2" id="five-minute_mystery_left_parent-id0001">
<h2>Five-Minute Mystery</h2>
<p>(from <a data-type="xref" href="#five-minute_mystery_left_parent-id0001">“Five-Minute Mystery”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0419-03.png" alt="image" width="148" height="113"/>
<h6/>
</div></figure>
<p>Alex didn’t pay attention to the order of the stream operations. She first mapped the coffee objects to a stream of Strings, and then ordered that. Strings are naturally ordered alphabetically, so when the coffee machine got the “first” of these results for Alex’s afternoon coffee, it was brewing a fresh “Americano.”</p>
<p>If Alex wanted to order the coffees by strength, with the weakest (1 out of 5) first, she needed to order the stream of coffees first, before mapping it to a String name,</p>
<pre data-type="programlisting">afternoonCoffee = coffees.stream()
                         .sorted()
                         .map(Coffee::getName)
                         .findFirst();</pre>
<p>Then the coffee machine will brew her a decaf instead of an Americano.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Pool Puzzle"><div class="sect2" id="pool_puzzle_left_parenthesisfrom_page_41">
<h2>Pool Puzzle</h2>
<p>(from <a data-type="xref" href="#pool_puzzle-id00005">“Pool Puzzle”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0415-01.png" alt="image" width="100" height="67"/>
<h6/>
</div></figure>
<pre data-type="programlisting">public class StreamPuzzle {
  public static void main(String[] args) {
    SongSearch songSearch = <strong>new SongSearch()</strong>;
    songSearch.<strong>printTopFiveSongs()</strong>;
    <strong>songSearch</strong>.search("The Beatles");
    <strong>songSearch.search("The Beach Boys")</strong>;
  }
}
class <strong>SongSearch</strong> {
  private final List&lt;Song&gt; songs = 
      new JukeboxData.Songs().getSongs();

  void printTopFiveSongs() {
    List&lt;String&gt; topFive = songs.stream()
                         .<strong>sorted(Comparator.comparingInt(Song::getTimesPlayed))</strong>
                         <strong>.map(song -&gt; song.getTitle())</strong>
                         <strong>.limit(5)</strong>
                         .collect(<strong>Collectors.toList()</strong>);
    System.out.println(topFive);
  }
  void search(String artist) {
    <strong>Optional&lt;Song&gt; result</strong> = songs.stream()
                    <strong>.filter(song -&gt; song.getArtist().equals(artist))</strong>
                    <strong>.findFirst()</strong>;
    if (<strong>result.isPresent()</strong>) {
      System.out.println(<strong>result.get().getTitle()</strong>);
    } else {
      System.out.println(<strong>"No songs found by: " + artist</strong>);
    }
  }
}</pre>
</div></section>
</div></section>
</div></section></div></body></html>