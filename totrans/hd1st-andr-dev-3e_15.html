<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 13. Data Binding: Building Smart Layouts"><div class="chapter" id="data_bindingcolon_building_smart_layouts">
<h1><span class="label">Chapter 13. </span>Data Binding: <em>Building Smart Layouts</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0519-01.png" alt="image" width="600" height="531"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Android Jetpack" data-secondary="data binding" data-see="data binding" id="idm46053736769568"/><a data-type="indexterm" data-primary="data binding" id="idm46053736768096"/><a data-type="indexterm" data-primary="Guessing Game app" data-secondary="data binding" data-see="data binding" id="idm46053736767264"/><a data-type="indexterm" data-primary="layouts" data-secondary="data binding" data-see="data binding" id="idm46053736765888"/><strong>Layouts can do more than control your app’s appearance.</strong></p>
<p>All of the layouts you’ve written so far have been told how they should behave by activity or fragment code. But just imagine if <strong>the layouts could think for themselves</strong>, and <strong>make their own decisions</strong>. In this chapter, we’ll introduce you to <strong>data binding</strong>: a way of <strong>boosting your layout’s IQ</strong>. You’ll find out <strong>how to make views get values</strong> directly from the view model. You’ll use <strong>listener binding</strong> to make buttons call their methods. You’ll even discover how <strong>one simple line of code lets views respond to live data updates</strong>. Soon, your layouts will be more powerful than ever before.</p>
<section data-type="sect1" data-pdf-bookmark="Back to the Guessing Game app"><div class="sect1" id="back_to_the_guessing_game_app">
<h1>Back to the Guessing Game app</h1>
<p><a data-type="indexterm" data-primary="GameFragment" data-secondary="function in game" id="idm46053736760352"/><a data-type="indexterm" data-primary="GameViewModel" data-secondary="function in game" id="idm46053736757312"/><a data-type="indexterm" data-primary="Guessing Game app" id="idm46053736756208"/><a data-type="indexterm" data-primary="ResultFragment" data-secondary="function in game" id="idm46053736755376"/><a data-type="indexterm" data-primary="ResultViewModel" data-secondary="function in game" id="idm46053736754272"/>In the previous two chapters, you built a Guessing Game app that lets the user guess which letters are included in a secret word. When the user guesses all the letters or runs out of lives, the game ends.</p>
<p>The app uses two view models—<code>GameViewModel</code> and <code>ResultViewModel</code>—which hold the app’s game logic and data, and maintain its state when the app is rotated. <code>GameViewModel</code> is used by <code>GameFragment</code>, and <code>ResultViewModel</code> is used by <code>ResultFragment</code>:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0520-01.png" alt="image" width="600" height="430"/>
<h6/>
</div></figure>
<p>The first screen the user sees is <code>GameFragment</code>, and she interacts with it to play the game. It displays information—such as the number of lives left and any incorrect guesses the user has made—and lets the user make guesses.</p>
<p>When the game is over, the app navigates to <code>ResultFragment</code>. This screen tells the user whether she has won or lost the game, and what the secret word was.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The fragments update the views in their layouts"><div class="sect1" id="the_fragments_update_the_views_in_their">
<h1>The fragments update the views in their layouts</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="updating views in layouts directly" id="idm46053736742928"/><a data-type="indexterm" data-primary="view models" data-secondary="data binding to get values from" id="idm46053736741856"/>Each of the app’s fragments are responsible for updating the views in their layouts. <code>ResultFragment</code>, for example, sets the text in its <code>won_lost</code> text view to the value of <code>ResultViewModel</code>’s <code>result</code> property:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0521-01.png" alt="image" width="600" height="200"/>
<h6/>
</div></figure>
<p>But while this approach works, it has a downside. When you make fragments responsible for keeping views up-to-date in this way, it can make your Kotlin code more complicated, and harder to read and maintain.</p>
<p>So what’s the alternative?</p>
<section data-type="sect2" data-pdf-bookmark="We can make the views update themselves instead"><div class="sect2" id="we_can_make_the_views_update_themselves">
<h2>We can make the views update themselves instead</h2>
<p>The alternative is to use a technique called <strong>data binding</strong>. With data binding, <strong>views can get their values directly from the view model</strong>, so the fragment code no longer has to keep them updated. Instead of using code in <code>ResultFragment</code> to update the text in the <code>won_lost</code> text view, for example, we can use data binding to make the view get its text directly from <code>ResultViewModel</code>’s <code>result</code> property.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0521-02.png" alt="image" width="321" height="147"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0521-03.png" alt="image" width="600" height="162"/>
<h6/>
</div></figure>
<p>In this chapter, you’ll learn how to use data binding by implementing it in the Guessing Game app. Let’s go through the steps we’ll take to do this.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s what we’re going to do"><div class="sect1" id="hereapostrophes_what_weapostroph-id00194">
<h1>Here’s what we’re going to do</h1>
<p>Here are the steps that we’ll go through to make the Guessing Game app use data binding:</p>
<ol>
<li><p><strong>Implement data binding for ResultFragment.</strong></p>
<p>We’ll update <code>ResultFragment</code> so that its layout uses data binding to display the value of the <code>result</code> property directly from <code>ResultViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0522-01.png" alt="image" width="417" height="123"/>
<h6/>
</div></figure></li>
<li><p><strong>Implement data binding for GameFragment.</strong></p>
<p>We’ll then change up <code>GameFragment</code> so that its layout uses data binding to display property values from <code>GameViewModel</code>. Along the way, we’ll also make the layout dynamically respond to any live data updates.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0522-02.png" alt="image" width="415" height="124"/>
<h6/>
</div></figure></li>
<li><p><strong>Add a Finish Game button to GameFragment.</strong></p>
<p>Finally, we’ll add a new button to <code>GameFragment</code>’s layout that, when clicked, immediately finishes the game.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0522-03.png" alt="image" width="582" height="203"/>
<h6/>
</div></figure></li>
</ol>
<figure class="informal"><div class="figure">
<img src="Images/f0522-04.png" alt="image" width="315" height="297"/>
<h6/>
</div></figure>
<p>Let’s get started.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Enable data binding in the app build.gradle file"><div class="sect1" id="enable_data_binding_in_the_app_builddotg">
<h1>Enable data binding in the <u>app</u> build.gradle file</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0523-01.png" alt="image" width="284" height="92"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="buildFeatures section, build.gradle file" id="idm46053736706256"/>Just like with view binding, you need to enable data binding in the <code>android</code> section of the app’s <em>build.gradle</em> file before you can use it in your app. The code to enable data binding looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0523-02.png" alt="image" width="542" height="184"/>
<h6/>
</div></figure>
<p>We’ve already enabled view binding in the Guessing Game app, so let’s enable data binding too. Open the file <em>GuessingGame/app/build.gradle</em>, and update the <code>buildFeatures</code> section so that it looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0523-03.png" alt="image" width="508" height="200"/>
<h6/>
</div></figure>
<p>Then choose the Sync Now option to sync this change with the rest of your project.</p>
<p>Now that we’ve enabled data binding, let’s implement it in <code>ResultFragment</code>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00195">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: I see that in the Guessing Game app, both view binding <em>and</em> data binding are enabled. Do you always need to enable view binding in order to use data binding?</strong></p>
<p><strong>A:</strong> No, you don’t. It’s quite common to enable data binding without enabling view binding, and you’ll find out more about this later in the chapter.</p>
<p>For now, all you really need to know is that we’re keeping the view binding option enabled so that all the app’s existing code continues to work.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="ResultFragment updates the text in its layout"><div class="sect1" id="resultfragment_updates_the_text_in_its_l">
<h1>ResultFragment updates the text in its layout</h1>
<p><a data-type="indexterm" data-primary="ResultFragment" data-secondary="updating text in layout" id="idm46053736691856"/><a data-type="indexterm" data-primary="result property, data binding approach" id="idm46053736689328"/><a data-type="indexterm" data-primary="won_lost ID, ResultFragment" id="idm46053736688464"/>As you may recall, <code>ResultFragment</code>’s layout contains a text view with an ID of <code>won_lost</code>, which is defined like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0524-02.png" alt="image" width="600" height="220"/>
<h6/>
</div></figure>
<p>When the app navigates to <code>ResultFragment</code>, the fragment gets the value of the <code>result</code> property from its view model, and displays it in the text view using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0524-03.png" alt="image" width="600" height="261"/>
<h6/>
</div></figure>
<p>We’re going to change the fragment and its layout so that it uses data binding. Instead of getting <code>ResultFragment</code> to update the text view, we’ll make the text view get its value directly from the view model.</p>
<section data-type="sect2" data-pdf-bookmark="How we’ll implement data binding"><div class="sect2" id="how_weapostrophell_implement_data_bindin">
<h2>How we’ll implement data binding</h2>
<p>To make the text view get its text from <code>ResultViewModel</code>, we need to update the code for <code>ResultFragment</code> and its layout. We’ll do this by going through the following steps:</p>
<ol>
<li><p><strong>Add &lt;layout&gt; and &lt;data&gt; elements to the layout.</strong></p>
<p>The <code>&lt;layout&gt;</code> element is required for data binding, and the <code>&lt;data&gt;</code> element is used to set up a data binding variable that links the layout to the view model.</p></li>
<li><p><strong>Set the layout’s data binding variable to an instance of the view model.</strong></p>
<p>We’ll do this using fragment code.</p></li>
<li><p><strong>Use the data binding variable to access the view model’s properties.</strong></p>
<p>We’ll update the <code>won_lost</code> text view so that it gets its text value directly from the view model.</p></li>
</ol>
<p>Let’s begin by updating the layout code.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="1. Add &lt;layout&gt; and &lt;data&gt; elements"><div class="sect1" id="onedot_add_less_thanlayoutgreater_than_a">
<h1>1. Add &lt;layout&gt; and &lt;data&gt; elements</h1>
<p><a data-type="indexterm" data-primary="data binding variable, setting" data-secondary="resultViewModel" id="idm46053736672032"/><a data-type="indexterm" data-primary="data element" data-secondary="ResultFragment layout" id="idm46053736669072"/><a data-type="indexterm" data-primary="layout element" data-secondary="ResultFragment" id="idm46053736667968"/><a data-type="indexterm" data-primary="resultViewModel property, data binding variable" id="idm46053736666864"/><a data-type="indexterm" data-primary="variable element, ResultFragment layout" id="idm46053736665936"/><a data-type="indexterm" data-primary="views" data-secondary="data binding" id="idm46053736665136"/>Every layout that uses data binding takes the following form:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0525-02.png" alt="image" width="600" height="290"/>
<h6/>
</div></figure>
<p>The above layout has a <code><strong>&lt;layout&gt;</strong></code> element as its root element. This enables data binding in the layout, so it’s required by <em>all</em> layouts that need to use data binding.</p>
<p>Within the <code>&lt;layout&gt;</code> element sits a <code><strong>&lt;data&gt;</strong></code> element. This is used to specify any variables—defined using the <code><strong>&lt;variable&gt;</strong></code> element—that are needed for data binding, such as the view model you want the layout’s views to gets their data from. The above code, for example, uses:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0525-03.png" alt="image" width="600" height="99"/>
<h6/>
</div></figure>
<p>to specify a data binding variable named <code>resultViewModel</code> whose type is <code>ResultViewModel</code>.</p>
<p>The <code>&lt;layout&gt;</code> element also includes a view or view group for the layout’s view hierarchy. If you want to display views in a linear layout, for example, you’d put the <code>&lt;LinearLayout&gt;</code> element and its views inside the <code>&lt;layout&gt;</code> element along with all of its views. You’ll see how this is done a few pages ahead.</p>
<p>Once you’ve defined a data binding variable, you need to set it. We’ll see how to do this next.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="2. Set the layout’s data binding variable"><div class="sect1" id="twodot_set_the_layoutapostrophes_data_bi">
<h1>2. Set the layout’s data binding variable</h1>
<p><a data-type="indexterm" data-primary="binding property" data-secondary="fragment" id="idm46053736649696"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" data-secondary="data binding" id="idm46053736648368"/>You set the layout’s data binding variable using Kotlin code.</p>
<p>On the previous page, we showed you the code to add a data binding variable (named <code>resultViewModel</code>) to <code>ResultFragment</code>’s layout file <em>fragment_result.xml</em>:</p>
<pre data-type="programlisting">&lt;data&gt;
    &lt;variable
        name="resultViewModel"
        type="com.hfad.guessinggame.ResultViewModel" /&gt;
&lt;/data&gt;</pre>
<p>The variable’s type is <code>ResultViewModel</code>, so we need to set it to an object with a matching type.</p>
<p>As you may recall, <code>ResultFragment</code> includes code in its <code>onCreateView()</code> method that gets a <code>ResultViewModel</code> object like so:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0526-02.png" alt="image" width="600" height="195"/>
<h6/>
</div></figure>
<p>We can assign this view model to the layout’s <code>resultViewModel</code> data binding variable by adding the following line to the <code>onCreateView()</code> code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0526-03.png" alt="image" width="600" height="24"/>
<h6/>
</div></figure>
<p>This uses the fragment’s <code>binding</code> property to set the layout’s <code>resultViewModel</code> property to the fragment’s view model object:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0526-04.png" alt="image" width="600" height="139"/>
<h6/>
</div></figure>
<p>Once you’ve set the data binding variable, the layout can use it to access the view model’s properties and methods. Let’s see how.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="3. Use the layout’s data binding variable to access the view model"><div class="sect1" id="threedot_use_the_layoutapostrophes_data">
<h1>3. Use the layout’s data binding variable to access the view model</h1>
<p><a data-type="indexterm" data-primary="result property, data binding approach" id="idm46053736631136"/><a data-type="indexterm" data-primary="won_lost text view, ResultFragment" id="idm46053736630144"/><code>ResultFragment</code>’s layout defines a <code>won_lost</code> text view that needs to display the value of <code>ResultViewModel</code>’s <code>result</code> property. Its text is set in the fragment code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0527-02.png" alt="image" width="600" height="39"/>
<h6/>
</div></figure>
<p>Now that we’ve set a data binding variable for this view model in the layout code, we can use data binding to set its text instead. The code to do so looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0527-03.png" alt="image" width="600" height="178"/>
<h6/>
</div></figure>
<p>The above code uses the <code>resultViewModel</code> variable to get the value of the view model’s <code>result</code> property. It then sets the text view’s text to the value of this property.</p>
<p>That’s everything that you need to know in order to implement data binding for <code>ResultFragment</code>. We’ll show you the full code for <em>result_fragment.xml</em> and <em>ResultFragment.kt</em> over the next couple pages.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00196">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: All of the other elements we’ve added to layouts, like <code>&lt;LinearLayout&gt;</code> and <code>&lt;Button&gt;</code>, have all had an initial capital letter. Why are <code>&lt;layout&gt;</code>, <code>&lt;data&gt;</code>, and <code>&lt;variable&gt;</code> all lowercase?</strong></p>
<p><strong>A:</strong> All of the other elements you’ve learned about so far have had initial capital letters because they are class names for types of <code>View</code>. The <code>&lt;LinearLayout&gt;</code> element, for example, refers to the <code>LinearLayout</code> class found in the <code>android.view</code> package.</p>
<p><code>&lt;layout&gt;</code>, <code>&lt;data&gt;</code>, and <code>&lt;variable&gt;</code> are all lowercase because they’re instructions, not <code>View</code>s. When Android sees the <code>&lt;variable&gt;</code> element, for example, it treats it as an instruction to create a variable.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for fragment_result.xml"><div class="sect1" id="the_full_code_for_fragmentunderscoreresu">
<h1>The full code for fragment_result.xml</h1>
<p><a data-type="indexterm" data-primary="data binding" data-secondary="code for" id="idm46053736611104"/><a data-type="indexterm" data-primary="ResultFragment" data-secondary="code for" id="idm46053736607920"/>Here’s the full code for <code>ResultFragment</code>’s layout; update the code for <em>fragment_result.xml</em> to include the changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0528-02.png" alt="image" width="600" height="645"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for ResultFragment.kt"><div class="sect1" id="the_full_code_for_resultfragmentdotkt">
<h1>The full code for ResultFragment.kt</h1>
<p>You need to update the fragment code too. Update the code for <em>ResultFragment.kt</em> so that it includes the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0529-02.png" alt="image" width="600" height="630"/>
<h6/>
</div></figure>
<p>Let’s go through what happens when the app runs.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs-id00197">
<h1>What happens when the app runs</h1>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>When the user completes a game, the app navigates to ResultFragment.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0530-02.png" alt="image" width="363" height="127"/>
<h6/>
</div></figure></li>
<li><p><strong>ResultFragment gets a reference to its ResultViewModel object.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0530-03.png" alt="image" width="397" height="124"/>
<h6/>
</div></figure></li>
<li><p><strong>ResultFragment assigns the ResultViewModel object to the layout’s resultViewModel data binding variable.</strong></p>
<p>The layout’s views can now use the variable to access the view model’s properties and methods.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0530-04.png" alt="image" width="600" height="154"/>
<h6/>
</div></figure></li>
<li><p><strong>The won_lost view’s text is set to the value of the ResultViewModel object’s result property.</strong></p>
<p>The text is displayed on the device screen.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0530-05.png" alt="image" width="368" height="180"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00198">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, it works in the same way as before. This time, however, <code>ResultFragment</code>’s layout is getting the game’s result directly from <code>ResultViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0531-02.png" alt="image" width="600" height="547"/>
<h6/>
</div></figure>
<p>We’ve now implemented data binding in <code>ResultFragment</code>. Before we apply it to <code>GameFragment</code>, let’s take a closer look at the <code>&lt;layout&gt;</code> element, and why it’s necessary for data binding.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="less_thanlayoutgreater_than_up_close">
<h5><span class="inlineimage"><img src="Images/zooml.png" alt="Images" width="135" height="81"/></span> &lt;layout&gt; Up Close</h5>
<p><a data-type="indexterm" data-primary="layout element" data-secondary="data binding" id="idm46053736573264"/><a data-type="indexterm" data-primary="layouts" data-secondary="view binding" id="idm46053736572192"/><a data-type="indexterm" data-primary="view binding" data-secondary="versus data binding" id="idm46053736571184"/>As we said earlier, every layout that uses data binding <em>must</em> have a <code>&lt;layout&gt;</code> element as its root element like this:</p>
<pre data-type="programlisting"><strong>&lt;layout ... &gt;</strong>
    ...
<strong>&lt;/layout&gt;</strong></pre>
<p>When you enable data binding in an app’s <em>build.gradle</em> file, it generates a binding class for each layout with a <code>&lt;layout&gt;</code> element at its root. <strong>This is the same binding class that gets generated when you enable view binding</strong>.</p>
<p>In the Guessing Game app, the layout file <em>fragment_result.xml</em> has a <code>&lt;layout&gt;</code> element as its root element. This means that its binding class <code>FragmentResultBinding</code> will still get generated by data binding even if view binding is switched off:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0532-01.png" alt="image" width="574" height="160"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>View binding and data binding generate the same binding classes, but in different situations.</strong></p>
</blockquote>
<p>You add one or more data binding variables to the layout using the <code>&lt;data&gt;</code> and <code>&lt;variable&gt;</code> elements:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0532-02.png" alt="image" width="511" height="293"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>View binding generates a binding class for every layout, while data binding generates one for every layout with a &lt;layout&gt; element.</strong></p>
</blockquote>
<p>You set each variable to an object with a matching type in Kotlin code. Once set, the layout’s views can use the data binding variable to access its object’s properties and methods.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Layout Magnets"><div class="sect1" id="layout_magnets-id00199">
<h1>Layout Magnets</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Magnets" id="idm46053736552384"/>Somebody wrote the code for a layout using fridge magnets, but some of them fell off when we shut the fridge door too firmly. Can you piece the code back together again?</p>
<p>The layout needs to use data binding to display the <code>welcomeText</code> property from a <code>MyViewModel</code> object in its <code>welcome</code> text view. The view model resides in a package named <code>com.hfad.myapp.MyViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0533-01.png" alt="image" width="600" height="501"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Layout Magnets Solution"><div class="sect1" id="layout_magnets_solution-id00200">
<h1>Layout Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p>Somebody wrote the code for a layout using fridge magnets, but some of them fell off when we shut the fridge door too firmly. Can you piece the code back together again?</p>
<p>The layout needs to use data binding to display the <code>welcomeText</code> property from a <code>MyViewModel</code> object in its <code>welcome</code> text view. The view model resides in a package named <code>com.hfad.myapp.MyViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0534-01.png" alt="image" width="600" height="566"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="GameFragment can use data binding too"><div class="sect1" id="gamefragment_can_use_data_binding_too">
<h1>GameFragment can use data binding too</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0535-01.png" alt="image" width="284" height="90"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="GameFragment" data-secondary="data binding" id="idm46053736535152"/><a data-type="indexterm" data-primary="GameViewModel" data-secondary="data binding" id="idm46053736533792"/>You’ve now implemented data binding for <code>ResultFragment</code> so that the text view in its layout gets its text directly from <code>ResultViewModel</code>’s result property.</p>
<p>Next, we’ll do a similar thing with <code>GameFragment</code>: we’ll implement data binding so that the text views in its layout get their values directly from <code>GameViewModel</code>:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0535-02.png" alt="image" width="600" height="635"/>
<h6/>
</div></figure>
<p>To do this, we need to update the code for <code>GameFragment</code> and its layout. We’ll begin with the layout code.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add &lt;layout&gt; and &lt;data&gt; elements to fragment_game.xml"><div class="sect1" id="add_less_thanlayoutgreater_than_and_less">
<h1>Add &lt;layout&gt; and &lt;data&gt; elements to fragment_game.xml</h1>
<p><a data-type="indexterm" data-primary="data element" id="idm46053736524496"/><a data-type="indexterm" data-primary="data element" data-secondary="GameFragment layout" id="idm46053736523472"/><a data-type="indexterm" data-primary="layout element" data-secondary="GameFragment" id="idm46053736522368"/>Just as we did with <code>ResultFragment</code>, we’ll begin by adding <code>&lt;layout&gt;</code> and <code>&lt;data&gt;</code> elements to <code>GameFragment</code>’s layout. These elements specify that the layout uses data binding, and define a data binding variable. The code looks like this; update the code in <em>fragment_game.xml</em> to include these changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0536-02.png" alt="image" width="600" height="493"/>
<h6/>
</div></figure>
<p>As you can see, the code defines a data binding variable named <code>gameViewModel</code> whose type is <code>GameViewModel</code>. Before we set this variable in the fragment’s Kotlin code, let’s update the layout’s views so that they get their values from the view model.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use the data binding variable to set the layout’s text"><div class="sect1" id="use_the_data_binding_variable_to_set_the">
<h1>Use the data binding variable to set the layout’s text</h1>
<p><a data-type="indexterm" data-primary="data binding variable, setting" data-secondary="secretWordDisplay" id="idm46053736513360"/><a data-type="indexterm" data-primary="incorrect_guesses text view" id="idm46053736512096"/><a data-type="indexterm" data-primary="lives text view" id="idm46053736511296"/><a data-type="indexterm" data-primary="secretWordDisplay property, GameViewModel" id="idm46053736510464"/>As you learned earlier, views can get data directly from the view model using the layout’s data binding variable. <em>fragment_game.xml</em>’s <code>word</code> text view, for example, can display the value of <code>GameViewModel</code>’s <code>secretWordDisplay</code> property using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0537-01.png" alt="image" width="600" height="178"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Two of the views need to show extra text"><div class="sect2" id="two_of_the_views_need_to_show_extra_text">
<h2>Two of the views need to show extra text</h2>
<p>The <code>lives</code> and <code>incorrect_guesses</code> text views, however, don’t just display the property values: <strong>they include extra text</strong>. The <code>GameFragment</code> code, for example, currently sets the <code>incorrectGuesses</code> view’s text using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0537-02.png" alt="image" width="600" height="77"/>
<h6/>
</div></figure>
<p>so we can’t simply use the view model’s <code>incorrectGuesses</code> property using the code below, or the extra text won’t be displayed:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0537-03.png" alt="image" width="600" height="245"/>
<h6/>
</div></figure>
<p>To get around this problem, we’ll use <code>String</code> formatting to pass the property value to a <code>String</code> resource. Let’s find out how.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="String resources revisited"><div class="sect1" id="string_resources_revisited">
<h1>String resources revisited</h1>
<p><a data-type="indexterm" data-primary="incorrect guesses, GameFragment" id="idm46053736494544"/><a data-type="indexterm" data-primary="lives_left String resource" id="idm46053736493680"/><a data-type="indexterm" data-primary="String resources" data-secondary="for GameFragment’s extra text" id="idm46053736492880"/>As you learned earlier in the book, you can add <code>String</code> resources to your app’s <code>String</code> resource file to avoid using hardcoded text. The following code, for example, defines a <code>String</code> resource named <code>my_string</code> that displays the text “This is a String resource”:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0538-02.png" alt="image" width="600" height="190"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="String resources can have arguments"><div class="sect2" id="string_resources_can_have_arguments">
<h2>String resources can have arguments</h2>
<p>You can also define <code>String</code> resources that accept one or more arguments, which is useful if you want to display more complex text. The following resource, for example, uses a <code><strong>%s</strong></code> placeholder to specify where to place a <code>String</code> argument that’s passed to it:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0538-03.png" alt="image" width="600" height="59"/>
<h6/>
</div></figure>
<p>and this one uses <code><strong>%d</strong></code> to say where a number argument should go:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0538-04.png" alt="image" width="600" height="81"/>
<h6/>
</div></figure>
<p>You can pass multiple arguments to a <code>String</code> resource by numbering each one. The following resource, for example, takes a <code>String</code> as its first argument, and a number as its second:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0538-05.png" alt="image" width="600" height="49"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>Use %s for String arguments and %d for numbers.</strong></p>
</blockquote>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Add two new String resources to strings.xml"><div class="sect2" id="add_two_new_string_resources_to_stringsd">
<h2>Add two new String resources to strings.xml</h2>
<p>In the Guessing Game app, we’ll define two new <code>String</code> resources: one for the number of lives left, and another for the incorrect guesses the user has made. Open the <em>strings.xml</em> file in the <em>app/src/main/res/values</em> folder, and add the two resources shown here:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0538-06.png" alt="image" width="600" height="185"/>
<h6/>
</div></figure>
<p>Now that we’ve defined the two <code>String</code> resources, let’s use them in <code>GameFragment</code>’s layout.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The layout can pass parameters to String resources"><div class="sect1" id="the_layout_can_pass_parameters_to_string">
<h1>The layout can pass parameters to String resources</h1>
<p><a data-type="indexterm" data-primary="incorrect_guesses text view" id="idm46053736465520"/><a data-type="indexterm" data-primary="lives_left String resource" id="idm46053736464464"/>In order to use the two <code>String</code> resources we just created, we need to pass each one a parameter.</p>
<p>You pass parameters to <code>String</code> resources in your layout code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0539-01.png" alt="image" width="600" height="54"/>
<h6/>
</div></figure>
<p>where <code>string_name</code> is the name of the <code>String</code> resource, and <code>arg1</code> and <code>arg2</code> are two parameter values. <code>arg1</code> is passed to the <code>String</code>’s first argument, and <code>arg2</code> is passed to its second.</p>
<p>In the Guessing Game app, the <code>lives_left String</code> resource is defined using:</p>
<pre data-type="programlisting">&lt;string name="lives_left"&gt;You have %d lives left&lt;/string&gt;</pre>
<p>so we can use it to display the <code>livesLeft</code> property from <code>GameViewModel</code> using the following code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0539-02.png" alt="image" width="600" height="147"/>
<h6/>
</div></figure>
<p>Similarly, the <code>incorrect_guesses String</code> resource is defined using:</p>
<pre data-type="programlisting">&lt;string name="incorrect_guesses"&gt;Incorrect guesses: %s&lt;/string&gt;</pre>
<p>so we display the value of the <code>incorrectGuesses</code> property like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0539-03.png" alt="image" width="600" height="227"/>
<h6/>
</div></figure>
<p>That’s everything that we need to know in order to change <code>GameFragment</code>’s layout so that it uses data binding. Let’s see what the full code looks like.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for fragment_game.xml"><div class="sect1" id="the_full_code_for_fragmentunderscoregame">
<h1>The full code for fragment_game.xml</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0540-01.png" alt="image" width="285" height="87"/>
<h6/>
</div></figure>
<p>Here’s the full code for <code>GameFragment</code>’s layout; update the code for <em>fragment_game.xml</em> to include the changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0540-02.png" alt="image" width="600" height="604"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0541-02.png" alt="image" width="600" height="578"/>
<h6/>
</div></figure>
<p>That’s all the code we need to change in the layout file. Before we take the app for a test drive, however, we first need to update the corresponding fragment code in <em>GameFragment.kt</em>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We need to set the gameViewModel variable"><div class="sect1" id="we_need_to_set_the_gameviewmodel_variabl">
<h1>We need to set the gameViewModel variable</h1>
<p><a data-type="indexterm" data-primary="data binding variable, setting" id="idm46053736434752"/><a data-type="indexterm" data-primary="data binding variable, setting" data-secondary="gameViewModel" id="idm46053736436368"/><a data-type="indexterm" data-primary="GameViewModel" data-secondary="live data with" id="idm46053736433632"/><a data-type="indexterm" data-primary="gameViewModel data binding variable" id="idm46053736432432"/><a data-type="indexterm" data-primary="live data" data-secondary="GameViewModel" id="idm46053736431632"/>The first change we need to make to the <code>GameFragment</code> code is to set the layout’s data binding variable <code>gameViewModel</code> to an instance of the fragment’s view model.</p>
<p><code>GameFragment</code> currently includes the following line in its <code>onCreateView()</code> method, which uses the view model provider to get a <code>GameViewModel</code> object:</p>
<pre data-type="programlisting">viewModel = ViewModelProvider(this).get(GameViewModel::class.java)</pre>
<p>We can therefore assign this view model to the <code>gameViewModel</code> data binding variable by adding the following line:</p>
<pre data-type="programlisting"><strong>binding.gameViewModel = viewModel</strong></pre>
<p>Once the <code>gameViewModel</code> variable is linked to the view model in this way, the layout’s views can use it to get their values.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0542-02.png" alt="image" width="371" height="154"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We also need to make the data binding use live data"><div class="sect2" id="we_also_need_to_make_the_data_binding_us">
<h2>We also need to make the data binding use live data</h2>
<p>As well as setting the <code>gameViewModel</code> variable, we need to make the layout’s data binding work with live data.</p>
<p>Unlike <code>ResultViewModel</code>, the <code>GameViewModel</code> code uses live data so that when its property values are updated, the <code>GameFragment</code> code responds. The following code in <em>GameFragment.kt</em>, for example, observes the <code>incorrectGuesses</code> property, and updates the <code>incorrect_guesses</code> view when it’s updated:</p>
<pre data-type="programlisting">viewModel.incorrectGuesses.observe(viewLifecycleOwner, Observer { newValue -&gt;
    binding.incorrectGuesses.text = "Incorrect guesses: $newValue"
})</pre>
<p>As we’re now using data binding, we can make each view respond to live data changes by adding the following line to the fragment code:</p>
<pre data-type="programlisting"><strong>binding.lifecycleOwner = viewLifecycleOwner</strong></pre>
<p>Each time a live data property value in the view model gets updated, the layout no longer has to rely on the fragment code updating its views. The layout can respond to any updates without any further intervention from the fragment.</p>
<p>That’s everything that we need to know in order to update the <code>GameFragment</code> code. Let’s see what it looks like.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0542-03.png" alt="image" width="299" height="283"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for GameFragment.kt"><div class="sect1" id="the_full_code_for_gamefragmentdo-id00201">
<h1>The full code for GameFragment.kt</h1>
<p>Here’s the full code for <code>GameFragment</code>; update the code for <em>GameFragment.kt</em> so that it includes the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0543-02.png" alt="image" width="600" height="590"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0544-02.png" alt="image" width="600" height="558"/>
<h6/>
</div></figure>
<p>Those are all the changes we need to make to <code>GameFragment</code>. Let’s run through what happens when the code runs, and take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs-id00202">
<h1>What happens when the app runs</h1>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>GameFragment gets a reference to its GameViewModel object.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0545-02.png" alt="image" width="395" height="123"/>
<h6/>
</div></figure></li>
<li><p><strong>GameFragment assigns the GameViewModel object to the layout’s gameViewModel data binding variable.</strong></p>
<p>The layout’s views can now use this variable to access the view model’s properties and methods.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0545-03.png" alt="image" width="600" height="156"/>
<h6/>
</div></figure></li>
<li><p><strong>GameFragment sets the layout’s lifecycle owner.</strong></p>
<p>The layout can now observe the view model’s live data properties and respond to any changes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0545-04.png" alt="image" width="600" height="145"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user makes a correct guess, the GameViewModel object’s secretWordDisplay property gets updated.</strong></p>
<p>The layout observes this change and its <code>word</code> view displays the new text.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0546-02.png" alt="image" width="600" height="264"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user makes an incorrect guess, the GameViewModel object’s livesLeft and incorrectGuesses properties are updated.</strong></p>
<p>The layout observes the changes and its corresponding views display the new text.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0546-03.png" alt="image" width="600" height="262"/>
<h6/>
</div></figure></li>
<li><p><strong>When the game is over, GameFragment navigates to ResultFragment.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0546-04.png" alt="image" width="600" height="177"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00203">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, it works in the same way as before. This time, however, <code>GameFragment</code> uses data binding to get property values directly from <code>GameViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0547-02.png" alt="image" width="600" height="324"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00204">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Can you use data binding to make views update properties in the view model?</strong></p>
<p><strong>A:</strong> Yes! Views can update mutable properties using <code>@=</code> instead of <code>@</code>. We’ll show you an example of this in the next chapter.</p>
<p><strong>Q: You’re setting the <code>word</code> view’s text to <code>"@{gameViewModel.secretWordDisplay}"</code>. As <code>secretWordDisplay</code>‘s type is <code>LiveData</code>, shouldn’t you use <code>secretWordDisplay.value</code> instead?</strong></p>
<p><strong>A:</strong> No. The layout will automatically use the <code>value</code> property without you telling it to.</p>
<p><strong>Q: I tried to set the text of the <code>lives</code> view to <code>"@{gameViewModel.livesLeft}"</code> but the app crashed. Any idea why?</strong></p>
<p><strong>A:</strong> The <code>livesLeft.value</code> property is an <code>Int?</code>, and the view’s <code>text</code> property needs to be a <code>String</code>. Try converting the property to a <code>String</code> using: <code>"@{gameViewModel.livesLeft.toString()}"</code> That should stop the app from crashing.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00205">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil</h5>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen your pencil" id="idm46053736359504"/><a data-type="indexterm" data-primary="String resources" data-secondary="text display exercise" id="idm46053736358528"/>The layout below needs to use a <code>String</code> resource (named <code>msg</code>) to display this text in a text view: “Hello, <code>user</code>. The numbers are <code>numbersText</code>. You guessed <code>numberGuessed</code> right.”</p>
<p><code>user</code>, <code>numbersText</code>, and <code>numberGuessed</code> are properties in <code>LotteryViewModel</code> where <code>user</code> is a <code>String</code>, <code>numbersText</code> is a <code>String</code>, and <code>numberGuessed</code> is an <code>Int</code>.</p>
<p>Can you write the code for the <code>String</code> resource?</p>
<p>The layout is:</p>
<pre data-type="programlisting">&lt;layout
    
    
    tools:context=".LotteryFragment"&gt;

    &lt;data&gt;
        &lt;variable
            name="vm"
            type="com.hfad.lottery.LotteryViewModel" /&gt;
    &lt;/data&gt;

    &lt;LinearLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"&gt;

        &lt;TextView
            android:id="@+id/message"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:textSize="16sp"
            android:text="@{@string/msg(vm.user, vm.numbersText, vm.numberGuessed)}" /&gt;
    &lt;/LinearLayout&gt;
&lt;/layout&gt;</pre>
<p>The <code>String</code> resource is:</p>
<pre data-type="programlisting">&lt;string name="msg"&gt;..........................................................&lt;/string&gt;</pre>
</div></aside>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="101" height="9"/></span> <strong>Answers in <a data-type="xref" href="#sharpen_your_pencil_solution-id00212">“<span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil Solution”</a>.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="You can use data binding to call methods"><div class="sect1" id="you_can_use_data_binding_to_call_methods">
<h1>You can use data binding to call methods</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0549-01.png" alt="image" width="284" height="88"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Button view" data-secondary="finishing the Guessing Game" id="idm46053736338768"/><a data-type="indexterm" data-primary="data binding" data-secondary="calling methods" id="idm46053736337408"/><a data-type="indexterm" data-primary="_gameOver backing property, GameViewModel" id="idm46053736336304"/>So far, you’ve implemented data binding so that views get their values directly from the view model instead of relying on fragment code.</p>
<p>Another way in which you can use data binding is to make a button call a method in the view model <em>without writing any extra fragment code</em>. To see how this works, we’re going to add a new Finish Game button to <code>GameFragment</code>’s layout that, when clicked, will finish the game.</p>
<p>Here’s what the new version of the screen will look like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0549-02.png" alt="image" width="524" height="599"/>
<h6/>
</div></figure>
<p>To make the new button finish the game, we’ll do the following:</p>
<ol>
<li><p><strong>Add a new finishGame() method to GameViewModel.</strong></p>
<p>This method will set the view model’s <code>_gameOver</code> property to <em>true</em>. When this happens, the existing code in <code>GameFragment</code> will respond by navigating to <code>ResultFragment</code>.</p></li>
<li><p><strong>Add the new button to the layout and make it call finishGame().</strong></p>
<p>The button will call the method using data binding.</p></li>
</ol>
<p>We’ll begin by updating the <code>GameViewModel</code> code.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add finishGame() to GameViewModel.kt"><div class="sect1" id="add_finishgameleft_parenthesisright_pare">
<h1>Add finishGame() to GameViewModel.kt</h1>
<p><a data-type="indexterm" data-primary="finishGame() method, GameViewModel" id="idm46053736324000"/><a data-type="indexterm" data-primary="GameViewModel" data-secondary="finishGame() method" id="idm46053736323264"/><a data-type="indexterm" data-primary="Guessing Game app" data-secondary="adding button" id="idm46053736322208"/>We need to add a new <code>finishGame()</code> method to the <code>GameViewModel</code> code that sets the value of <code>_gameOver</code> to <em>true</em>.</p>
<p>You already know how to do this, so here’s the new code for <em>GameViewModel.kt</em>; make sure that you update the code to include the new method (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0550-02.png" alt="image" width="600" height="578"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0551-02.png" alt="image" width="600" height="637"/>
<h6/>
</div></figure>
<p>That’s all the <code>GameViewModel</code> code we need to add. Next, we’ll add the new Finish Game button to <code>GameFragment</code>’s layout, and make it call the <code>finishGame()</code> method.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use data binding to make a button call a method when clicked"><div class="sect1" id="use_data_binding_to_make_a_button_call_a">
<h1>Use data binding to make a button call a method when clicked</h1>
<p><a data-type="indexterm" data-primary="click response" data-secondary="data binding" id="idm46053736309808"/><a data-type="indexterm" data-primary="listener binding" id="idm46053736308416"/><a data-type="indexterm" data-primary="onClick attribute, adding to button" id="idm46053736307584"/>As we said earlier, you can use data binding to make a button call a method in its view model without writing any extra fragment code. To do this, you add an <code><strong>android:onClick</strong></code> attribute to the button, and set its value to an expression that calls the method.</p>
<p>In the Guessing Game app, we want to add a new button to <code>GameFragment</code>’s layout that calls <code>GameViewModel</code>’s <code>finishGame()</code> method when clicked. The code for this button looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0552-02.png" alt="image" width="600" height="177"/>
<h6/>
</div></figure>
<p>The line:</p>
<pre data-type="programlisting"><strong>android:onClick="@{() -&gt; gameViewModel.finishGame()}"</strong></pre>
<p>is just like adding the following code to your fragment:</p>
<pre data-type="programlisting">binding.finishGameButton.setOnClickListener() {
    viewModel.finishGame()
}</pre>
<p>except that this time, no fragment code is required. Behind the scenes, data binding uses the line:</p>
<pre data-type="programlisting">android:onClick="@{() -&gt; gameViewModel.finishGame()}"</pre>
<p>to create an <code>onClickListener</code> for the button. When the user clicks the button, the code is executed, which calls the view model’s <code>finishGame()</code> method.</p>
<p>When you use a binding expression to call a method such as:</p>
<pre data-type="programlisting">"@{() -&gt; gameViewModel.finishGame()}"</pre>
<p>the binding expression is sometimes known as a <strong>listener binding</strong>.</p>
<p>That’s everything that we need to know in order to add the button to <code>GameFragment</code>’s layout and make it respond to clicks. Let’s see what the full code looks like.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="serious_coding-id00206">
<h5><span class="inlineimage"><img src="Images/cap.png" alt="Images" width="91" height="93"/></span> Serious Coding</h5>
<p>There are lots of other things you can do with binding expressions. Find out more here:</p>
<p><em><a href="https://developer.android.com/topic/libraries/data-binding/expressions">https://developer.android.com/topic/libraries/data-binding/expressions</a></em></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for fragment_game.xml"><div class="sect1" id="the_full_code_for_fragmentunders-id00207">
<h1>The full code for fragment_game.xml</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0553-01.png" alt="image" width="285" height="90"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="data binding" data-secondary="code for" id="idm46053736287136"/><a data-type="indexterm" data-primary="GameFragment" data-secondary="code for" id="idm46053736285728"/>Here’s the full code for <code>GameFragment</code>’s layout; update the code for <em>fragment_game.xml</em> to include the new button (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0553-02.png" alt="image" width="600" height="691"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0554-02.png" alt="image" width="600" height="586"/>
<h6/>
</div></figure>
<p>Let’s see what happens when the code runs.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs-id00208">
<h1>What happens when the app runs</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0555-01.png" alt="image" width="284" height="88"/>
<h6/>
</div></figure>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>GameFragment assigns the GameViewModel object to the layout’s gameViewModel data binding variable.</strong></p>
<p>The layout’s views can now use the variable to access the view model’s properties and methods.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0555-02.png" alt="image" width="600" height="155"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks on the Finish Game button.</strong></p>
<p>The button calls the <code>finishGame()</code> method in the <code>GameViewModel</code> object, which sets its <code>_gameOver</code> property to <em>true</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0555-03.png" alt="image" width="600" height="120"/>
<h6/>
</div></figure></li>
<li><p><strong>GameFragment observes that _gameOver has a new value.</strong></p>
<p>It responds by navigating to <code>ResultFragment</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0555-04.png" alt="image" width="417" height="124"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00209">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0556-01.png" alt="image" width="284" height="87"/>
<h6/>
</div></figure>
<p>When we run the app, <code>GameFragment</code>’s layout includes a new Finish Game button. When we click on the button, the app navigates to <code>ResultFragment</code>, which displays the secret word.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0556-02.png" alt="image" width="600" height="767"/>
<h6/>
</div></figure>
<p>There’s just one more tweak we’re going to make to the Guessing Game app. Before we show you what that is, try the following exercise.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle"><div class="sect1" id="pool_puzzle-id00210">
<h1>Pool Puzzle</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Button view" data-secondary="calling method with data binding" id="idm46053736250496"/><a data-type="indexterm" data-primary="exercises" data-secondary="Pool Puzzle" id="idm46053736249248"/>Your <strong>goal</strong> is to update the layout code below so that its button, when clicked, calls the <code>eatIceCream()</code> method in <code>MyViewModel</code>. Take code snippets from the pool and place them into the blank lines in the code. You may <strong>not</strong> use the same snippet more than once, and you won’t need to use all the snippets.</p>
<pre data-type="programlisting">&lt;layout ...&gt;
    &lt;data&gt;
        &lt;variable
            name="myViewModel"
            type="com.hfad.myapp.MyViewModel" /&gt;
    &lt;/data&gt;

    &lt;LinearLayout ...&gt;

       &lt;Button
            android:id="@+id/button"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Eat Ice Cream"
            ...................................................................../&gt;

    &lt;/LinearLayout&gt;
&lt;/layout&gt;</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0557-01.png" alt="image" width="600" height="265"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Note: each thing from the pool can only be used once!</strong></p>
</div>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="101" height="9"/></span> <strong>Answers in <a data-type="xref" href="#pool_puzzle_solution-id00213">“Pool Puzzle Solution”</a>.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fireside Chats"><div class="sect1" id="fireside_chats">
<h1>Fireside Chats</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0558-01.png" alt="image" width="389" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="data binding" data-secondary="versus view binding" id="idm46053736235808"/><a data-type="indexterm" data-primary="view binding" data-secondary="versus data binding" id="idm46053736234432"/>Tonight’s talk: <strong>View Binding and Data Binding air their differences</strong></p>
<table class="border">
<tbody>
<tr>
<td><strong>Data Binding:</strong></td>
<td><strong>View Binding:</strong></td>
</tr>
<tr>
<td>View Binding, we need to talk.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>We do? Why?</td>
</tr>
<tr>
<td>Surely you’ve noticed how people keep getting the two of us confused. I mean, just because we both have Binding in our names, it doesn’t mean we’re the same thing.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>You’ve got to admit our names sound similar. Besides, we have a lot in common.</td>
</tr>
<tr>
<td>You think so?</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Yes! We both generate binding classes. The <em>same</em> binding classes. Don’t pretend that’s not true.</td>
</tr>
<tr>
<td>Maybe we do, but under completely different circumstances.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>It’s true that I’m much more convenient and helpful than you. I generate a binding class for every layout, and most of the time, that’s exactly what’s needed. Developers thank me for it. I even get fan mail. “Oh, View Binding, I’m your biggest fan! Thank you for eliminating <code>findViewById</code>. I thought my pain would never end!”</td>
</tr>
<tr>
<td>You can’t claim sole responsibility for getting rid of <code>findViewById</code>. That’s down to the binding class, not you. The binding class that <em>I</em> generate, too.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Whatever.</td>
</tr>
<tr>
<td>Besides, generating a binding class for every single layout is such a waste of space.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Strictly speaking, I ignore any layouts with a <code>viewBindingIgnore</code> attribute that’s set to <em>true</em>. That’s way less complicated than your approach.</td>
</tr>
<tr>
<td><a data-type="indexterm" data-primary="Fireside Chats, view binding versus data binding" id="idm46053736208784"/>Complicated? I’m just more discerning than you are. I only generate binding classes for layouts with a <code>&lt;layout&gt;</code> element. That way, the developer gets to decide exactly where I’m needed.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Yes, complicated! Who really wants to add even more XML to their layout code? That’s so much extra typing!</td>
</tr>
<tr>
<td>So it means a bit of extra code, but I can do things that you can only dream of. I let views get their values directly from the view model, for instance.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>I can do that too. Using fragment code.</td>
</tr>
<tr>
<td>But that’s the point. You rely on fragment code to tell the views what they should do, but when I’m involved, that’s not necessary. I let the views get the values directly, which means simpler fragment code. I even let them use live data properties so that they can keep themselves up to date.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Huh. But what about updating property values? I bet you still need fragment code for that.</td>
</tr>
<tr>
<td>No, I don’t. I have two-way data binding where views can update values <em>and</em> respond to changes. Look it up. It’ll change your life.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Huh. You’ll be telling me next you let views call methods.</td>
</tr>
<tr>
<td>But of course. And why not?</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>It makes the layout code overly complicated. I just can’t believe you’d be so irresponsible.</td>
</tr>
<tr>
<td>I hardly call simple method calls irresponsible, and it saves the developer from writing yet more fragment code. But I accept that for more complex things, the code really belongs in the fragment, not the layout.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>So even you admit you have your limitations.</td>
</tr>
<tr>
<td>You’re just jealous.</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>Riiiiiight. You keep telling yourself that…</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We can switch off view binding"><div class="sect1" id="we_can_switch_off_view_binding">
<h1>We can switch off view binding</h1>
<p><a data-type="indexterm" data-primary="view binding" data-secondary="switching off when data binding will do" id="idm46053736188016"/>We’ve nearly finished updating the Guessing Game app, but there’s one more tweak we can make so that only the binding classes we’re using for data binding will get generated.</p>
<p>As you know, data binding and view binding generate the same binding classes, but under different circumstances: view binding generates a binding class for <em>every</em> layout, while data binding generates the class for every layout with a <code>&lt;layout&gt;</code> element at its root.</p>
<p>In the Guessing Game app, we’re only using the binding classes for <em>fragment_game.xml</em> and <em>fragment_result.xml</em>. Since both of these files include a <code>&lt;layout&gt;</code> element, we can safely switch off the view binding option, and their binding classes will continue to get generated via data binding:</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">The only layout file that data binding won’t generate a binding class for is activity_main.xml because it doesn’t include a &lt;layout&gt; element. We don’t need to use this binding class, so view binding can be safely switched off.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0560-02.png" alt="image" width="600" height="159"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Switch off view binding in the app’s build.gradle file"><div class="sect2" id="switch_off_view_binding_in_the_appapostr">
<h2>Switch off view binding in the app’s build.gradle file</h2>
<p>To switch off view binding, open the <em>GuessingGame/app/build.gradle</em> file, and remove the view binding line from the <code>buildFeatures</code> section like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0560-03.png" alt="image" width="600" height="196"/>
<h6/>
</div></figure>
<p>Then choose the Sync Now option to sync this change with the rest of the project.</p>
<p>Let’s take the app for a quick test drive and make sure that it still works.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00211">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, the game works in the same way as before. Switching off view binding has made no difference because data binding has generated all the binding classes that the app needs.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0561-02.png" alt="image" width="600" height="714"/>
<h6/>
</div></figure>
<p>Congratulations! You’ve now learned how to use data binding, and used it in conjunction with view models and live data. This approach can be used to simplify your fragment code and build reactive, responsive apps.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Binding-Cross"><div class="sect1" id="binding-cross">
<h1><span class="inlineimage"><img src="Images/f0562-01.png" alt="Images" width="132" height="103"/></span> Binding-Cross</h1>
<p><a data-type="indexterm" data-primary="binding expression exercise" id="idm46053736163056"/><a data-type="indexterm" data-primary="exercises" data-secondary="crosswords" id="idm46053736162000"/>Each of the clues for the crossword below is a binding expression that’s used for a TextView’s android:text property. Can you solve the crossword using the output for each clue?</p>
<p>Hint: Each binding expression uses a String resource and a view model. You’ll find the code for these on the next page, along with a layout that includes the TextView.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0562-02.png" alt="image" width="600" height="599"/>
<h6/>
</div></figure>
<p><strong>Across</strong></p>
<p><strong>2</strong> “@{@string/string2(vm.d[1])}”</p>
<p><strong>3</strong> “@{@string/string3(vm.d[2], vm.g[0])}”</p>
<p><strong>6</strong> “@{@string/string1(vm.a)}”</p>
<p><strong>7</strong> “@{@string/string3(vm.f[1], vm.h[0])}”</p>
<p><strong>8</strong> “@{@string/string1(vm.d[vm.i[1]])}”</p>
<p><strong>Down</strong></p>
<p><strong>1</strong> “@{@string/string3(vm.e[2], vm.g[0])}”</p>
<p><strong>4</strong> “@{@string/string4(vm.h[2], vm.a)}”</p>
<p><strong>5</strong> “@{@string/string4(vm.h[1], vm.g[2])}”</p>
<p><strong>Layout:</strong></p>
<pre data-type="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;layout...&gt;

    &lt;data&gt;
        &lt;variable
            name="vm"
            type="com.hfad.crossword.CrosswordViewModel" /&gt;
    &lt;/data&gt;

    &lt;LinearLayout...&gt;
        &lt;TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text=............................................../&gt;
    &lt;/LinearLayout&gt;
&lt;/layout&gt;</pre>
<p><strong>View model:</strong></p>
<pre data-type="programlisting">...
class CrosswordViewModel : ViewModel() {
    val a = "STRAW"
    val b = "RASP"
    val c = "CRAN"
    val d = listOf("BLUE", "BLACK", "RED")
    val e = listOf("GOOSE", "MOOSE", "ELDER")
    val f = listOf("LINGON", "WATTLE", "WEAVER")
    val g = listOf("FISH", "FLY", "BIRD", "HORSE")
    val h = listOf("SONG", "SEED", "HOUSE")
    val i = listOf(2,0,1,2,0)
}</pre>
<p><strong>String resource file:</strong></p>
<pre data-type="programlisting">&lt;resources&gt;
    &lt;string name="app_name"&gt;Crossword&lt;/string&gt;
    &lt;string name="string1"&gt;%sBERRY&lt;/string&gt;
    &lt;string name="string2"&gt;%sBIRD&lt;/string&gt;
    &lt;string name="string3"&gt;%1$s%2$s&lt;/string&gt;
    &lt;string name="string4"&gt;%2$s%1$s&lt;/string&gt;
&lt;/resources&gt;</pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Binding-Cross Solution"><div class="sect1" id="binding-cross_solution">
<h1><span class="inlineimage"><img src="Images/common05.png" alt="Images" width="161" height="100"/></span> Binding-Cross Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0564-01.png" alt="image" width="600" height="600"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00212">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil Solution</h5>
<p>The layout below needs to use a <code>String</code> resource (named <code>msg</code>) to display this text in a text view: “Hello, <code>user</code>. The numbers are <code>numbersText</code>. You guessed <code>numberGuessed</code> right.”</p>
<p><code>user</code>, <code>numbersText</code>, and <code>numberGuessed</code> are properties in <code>LotteryViewModel</code> where <code>user</code> is a <code>String</code>, <code>numbersText</code> is a <code>String</code>, and <code>numberGuessed</code> is an <code>Int</code>.</p>
<p>Can you write the code for the <code>String</code> resource?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0565-01.png" alt="image" width="600" height="488"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle Solution"><div class="sect1" id="pool_puzzle_solution-id00213">
<h1>Pool Puzzle Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Button view" data-secondary="calling method with data binding" id="idm46053736125632"/>Your <strong>goal</strong> is to update the layout code below so that its button, when clicked, calls the <code>eatIceCream()</code> method in <code>MyViewModel</code>. Take code snippets from the pool and place them into the blank lines in the code. You may <strong>not</strong> use the same snippet more than once, and you won’t need to use all the snippets.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0566-01.png" alt="image" width="600" height="322"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0566-02.png" alt="image" width="600" height="255"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00214">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#data_bindingcolon_building_smart_layouts">Chapter 13</a> under your belt and now you’ve added data binding to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0567-01.png" alt="image" width="233" height="211"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00215">
<h5>Bullet Points</h5>
<ul>
<li><p>Data binding gives layouts direct access to properties and methods.</p></li>
<li><p>Enable data binding in the app’s <em>build.gradle</em> file.</p></li>
<li><p>Add a <code>&lt;layout&gt;</code> element to the root of each layout that needs to use data binding.</p></li>
<li><p>Data binding generates a binding class for each layout with a <code>&lt;layout&gt;</code> element. This is the same binding class that gets generated with view binding.</p></li>
<li><p>Use <code>&lt;data&gt;</code> and <code>&lt;variable&gt;</code> elements to define variables.</p></li>
<li><p><code>String</code> resources can accept arguments.</p></li>
<li><p>Data binding lets views respond to when a live data property’s value gets updated.</p></li>
</ul>
</div></aside>
</div></section>
</div></section></div></body></html>