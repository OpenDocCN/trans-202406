<html><head></head><body><section data-pdf-bookmark="Chapter 3. Custom Components" data-type="chapter" epub:type="chapter"><div class="chapter" id="custom_views">&#13;
<h1><span class="label">Chapter 3. </span>Custom Components</h1>&#13;
&#13;
&#13;
<p>While<a data-primary="custom components" data-secondary="applications of" data-type="indexterm" id="idm46177241875960"/> both Android and iOS provide a large number of widgets and components out of the box, there’s not always parity, and it’s very likely you’ll want to create your own at some point. You might want a date or color picker with custom look or behavior, a switch or toggle with a built-in label, data visualization components like charts and graphs, or something as simple as a configurable label and icon that’s suited just for your app.</p>&#13;
&#13;
<p>Whatever the need, there’s a pretty good chance you can create it in either framework—but the process is very different and can be surprisingly arcane.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Tasks" data-type="sect1"><div class="sect1" id="idm46177241873672">&#13;
<h1>Tasks</h1>&#13;
&#13;
<p>In<a data-primary="custom components" data-secondary="task overview" data-type="indexterm" id="idm46177241872344"/> this chapter, you’ll learn:</p>&#13;
<ol>&#13;
<li>&#13;
<p>How to create a custom view.</p>&#13;
</li>&#13;
<li>&#13;
<p>How to use a custom view.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Android" data-type="sect1"><div class="sect1" id="idm46177241868808">&#13;
<h1>Android</h1>&#13;
&#13;
<p>Since<a data-primary="custom components" data-secondary="Android" data-tertiary="overview of" data-type="indexterm" id="idm46177241867240"/><a data-primary="Android" data-secondary="custom components" data-tertiary="overview of" data-type="indexterm" id="idm46177241865960"/> most layouts in Android apps are created with XML data, getting your custom component to accept and react appropriately to arbitrary properties is something you’ll probably want to offer. For example, if you were to create a custom color picker, you’d probably want to offer a default color to start with, or perhaps even a specific color space like HSL or RGB.</p>&#13;
&#13;
<p>Since XML resources are compiled, you’ll need to make sure the system recognizes the extra properties you allow on your component and what values are valid. For example, if you add a <code>color</code> attribute, you wouldn’t want to accept a dimension value—you’d want only valid colors, or perhaps color resource IDs, to be accepted. If a user tries to enter an invalid value format, the program will fail to compile, and<a data-primary="Android Studio" data-secondary="custom components" data-type="indexterm" id="idm46177241862984"/> Android Studio will notify the user, as we’d expect.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Create a Custom View" data-type="sect2"><div class="sect2" id="idm46177241861752">&#13;
<h2>How to Create a Custom View</h2>&#13;
&#13;
<p>The<a data-primary="custom components" data-secondary="Android" data-tertiary="creating custom views" data-type="indexterm" id="CCAview03"/><a data-primary="Android" data-secondary="custom components" data-tertiary="creating custom views" data-type="indexterm" id="ACview03"/> basic premise of a custom <code>View</code> class is probably pretty close to what you’d expect: subclass either <code>View</code> or <code>ViewGroup</code>, or an existing subclass, and offer your own functionality however you see fit. A custom <code>View</code> is somewhat limited—it can really only modify what it draws (text, colors, shapes) or how large it is reported. The former can be accomplished using the <code>onDraw</code> method of the <code>View</code>. The method accepts a single parameter, a <code>Canvas</code> instance that will always be populated for you and has the same dimensions of the <code>View</code> itself. Check out the dev docs on the <code>Canvas</code> object, but really you’re pretty free to do whatever you’d like here. There are methods for drawing text and shapes. You can use geometric classes like <code>Rect</code> or <code>Path</code> to draw more complicated structures, and <code>Paint</code> objects to customize the color, fill, or texture.</p>&#13;
&#13;
<p>For<a data-primary="Java" data-secondary="custom components" data-tertiary="creating custom views" data-type="indexterm" id="JCview03"/><a data-primary="Kotlin" data-secondary="custom components" data-tertiary="creating custom views" data-type="indexterm" id="KCview03"/> example, the following simple <code>View</code> class will draw a red circle (or oval) that will fill the frame of the <code>View</code>:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177241819752">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Oval</code> <code class="kd">extends</code> <code class="n">View</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">private</code> <code class="n">Paint</code> <code class="n">mPaint</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Paint</code><code class="o">();</code>&#13;
  <code class="o">{</code>&#13;
    <code class="n">mPaint</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">RED</code><code class="o">);</code>&#13;
    <code class="n">mPaint</code><code class="o">.</code><code class="na">setStyle</code><code class="o">(</code><code class="n">Paint</code><code class="o">.</code><code class="na">Style</code><code class="o">.</code><code class="na">FILL</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">Oval</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">Oval</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">,</code> <code class="n">AttributeSet</code> <code class="n">attrs</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">Oval</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">,</code> <code class="n">AttributeSet</code> <code class="n">attrs</code><code class="o">,</code> <code class="kt">int</code> <code class="n">defStyleAttr</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">,</code> <code class="n">defStyleAttr</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">onDraw</code><code class="o">(</code><code class="n">Canvas</code> <code class="n">canvas</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">canvas</code><code class="o">.</code><code class="na">drawOval</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">getWidth</code><code class="o">(),</code> <code class="n">getHeight</code><code class="o">(),</code> <code class="n">mPaint</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">class</code> <code class="nc">Oval</code> <code class="nd">@JvmOverloads</code> <code class="n">constructor</code><code class="o">(</code><code class="nl">context:</code> <code class="n">Context</code><code class="o">,</code> <code class="nl">attrs:</code> <code class="n">AttributeSet</code><code class="o">?</code> <code class="o">=</code> <code class="kc">null</code><code class="o">,</code>&#13;
  <code class="nl">defStyleAttr:</code> <code class="n">Int</code> <code class="o">=</code> <code class="mi">0</code><code class="o">,</code> <code class="nl">defStyleRes:</code> <code class="n">Int</code> <code class="o">=</code> <code class="mi">0</code><code class="o">)</code> <code class="o">:</code> <code class="n">View</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">,</code> <code class="n">defStyleAttr</code><code class="o">,</code>&#13;
  <code class="n">defStyleRes</code><code class="o">)</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">private</code> <code class="n">val</code> <code class="n">paint</code> <code class="o">=</code> <code class="n">Paint</code><code class="o">()</code>&#13;
&#13;
  <code class="n">init</code> <code class="o">{</code>&#13;
    <code class="n">paint</code><code class="o">.</code><code class="na">color</code> <code class="o">=</code> <code class="n">Color</code><code class="o">.</code><code class="na">RED</code>&#13;
    <code class="n">paint</code><code class="o">.</code><code class="na">style</code> <code class="o">=</code> <code class="n">Paint</code><code class="o">.</code><code class="na">Style</code><code class="o">.</code><code class="na">FILL</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="n">override</code> <code class="n">fun</code> <code class="nf">onDraw</code><code class="o">(</code><code class="nl">canvas:</code> <code class="n">Canvas</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">canvas</code><code class="o">.</code><code class="na">drawOval</code><code class="o">(</code><code class="mi">0</code><code class="n">f</code><code class="o">,</code> <code class="mi">0</code><code class="n">f</code><code class="o">,</code> <code class="n">width</code><code class="o">.</code><code class="na">toFloat</code><code class="o">(),</code> <code class="n">height</code><code class="o">.</code><code class="na">toFloat</code><code class="o">(),</code> <code class="n">paint</code><code class="o">)</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>As you can see, you could provide setters to customize color or provide a custom <code>Paint</code> to tile bitmaps, create shadow layers, or mix gradients.</p>&#13;
&#13;
<p>Similarly, you could subclass <code>TextView</code> so that it always has a single border along the bottom edge, perhaps for use in a <code>LinearLayout</code> or <code>RecyclerView</code>:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177241668616">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BottomBorderTextView</code> <code class="kd">extends</code> <code class="n">TextView</code> <code class="o">{</code>&#13;
&#13;
  <code class="kd">private</code> <code class="n">Paint</code> <code class="n">mPaint</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Paint</code><code class="o">();</code>&#13;
  <code class="o">{</code>&#13;
    <code class="n">mPaint</code><code class="o">.</code><code class="na">setStyle</code><code class="o">(</code><code class="n">Paint</code><code class="o">.</code><code class="na">Style</code><code class="o">.</code><code class="na">STROKE</code><code class="o">);</code>&#13;
    <code class="n">mPaint</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">BLACK</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">BottomBorderTextView</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">BottomBorderTextView</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">,</code> <code class="nd">@Nullable</code> <code class="n">AttributeSet</code> <code class="n">attrs</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="kd">public</code> <code class="nf">BottomBorderTextView</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">,</code> <code class="nd">@Nullable</code> <code class="n">AttributeSet</code> <code class="n">attrs</code><code class="o">,</code>&#13;
  <code class="kt">int</code> <code class="n">defStyleAttr</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">,</code> <code class="n">defStyleAttr</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">onDraw</code><code class="o">(</code><code class="n">Canvas</code> <code class="n">canvas</code><code class="o">)</code> <code class="o">{</code>&#13;
  <code class="c1">// remember to call super.onDraw for text, background, adjacent drawables, etc.</code>&#13;
   <code class="kd">super</code><code class="o">.</code><code class="na">onDraw</code><code class="o">(</code><code class="n">canvas</code><code class="o">);</code>&#13;
   <code class="n">canvas</code><code class="o">.</code><code class="na">drawLine</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">getHeight</code><code class="o">(),</code> <code class="n">getWidth</code><code class="o">(),</code> <code class="n">getHeight</code><code class="o">(),</code> <code class="n">mPaint</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">BottomBorderTextView</code> <code class="n">@JvmOverloads</code> <code class="n">constructor</code><code class="p">(</code><code class="n">context</code><code class="p">:</code> <code class="n">Context</code><code class="p">,</code>&#13;
<code class="n">attrs</code><code class="p">:</code> <code class="n">AttributeSet</code><code class="p">?</code> <code class="p">=</code> <code class="k">null</code><code class="p">,</code>&#13;
  <code class="n">defStyleAttr</code><code class="p">:</code> <code class="n">Int</code> <code class="p">=</code> <code class="m">0</code><code class="p">,</code> <code class="n">defStyleRes</code><code class="p">:</code> <code class="n">Int</code> <code class="p">=</code> <code class="m">0</code><code class="p">)</code> <code class="p">:</code>&#13;
  <code class="n">TextView</code><code class="p">(</code><code class="n">context</code><code class="p">,</code> <code class="n">attrs</code><code class="p">,</code> <code class="n">defStyleAttr</code><code class="p">,</code> <code class="n">defStyleRes</code><code class="p">)</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">private</code> <code class="k">val</code> <code class="py">paint</code> <code class="p">=</code> <code class="n">Paint</code><code class="p">()</code>&#13;
  <code class="n">init</code> <code class="p">{</code>&#13;
    <code class="n">paint</code><code class="p">.</code><code class="n">style</code> <code class="p">=</code> <code class="n">Paint</code><code class="p">.</code><code class="n">Style</code><code class="p">.</code><code class="n">FILL</code>&#13;
    <code class="n">paint</code><code class="p">.</code><code class="n">color</code> <code class="p">=</code> <code class="n">Color</code><code class="p">.</code><code class="n">RED</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onDraw</code><code class="p">(</code><code class="n">canvas</code><code class="p">:</code> <code class="n">Canvas</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// remember to call super.onDraw for text, background, adjacent drawables, etc.</code>&#13;
   <code class="k">super</code><code class="p">.</code><code class="n">onDraw</code><code class="p">(</code><code class="n">canvas</code><code class="p">)</code>&#13;
   <code class="n">canvas</code><code class="p">.</code><code class="n">drawLine</code><code class="p">(</code><code class="m">0</code><code class="p">,</code> <code class="n">height</code><code class="p">,</code> <code class="n">width</code><code class="p">,</code> <code class="n">height</code><code class="p">,</code> <code class="n">paint</code><code class="p">)</code>&#13;
  <code class="p">}</code>&#13;
&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>You might add a new method to change the color of the border and redraw it:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177241402056">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">setBorderColor</code><code class="o">(</code><code class="kt">int</code> <code class="n">color</code><code class="o">)</code> <code class="o">{</code>&#13;
  <code class="n">mPaint</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">color</code><code class="o">);</code>&#13;
  <code class="c1">// invalidate lets the system know to redraw the View in the next frame</code>&#13;
  <code class="n">invalidate</code><code class="o">();</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">fun</code> <code class="nf">setBorderColor</code><code class="p">(</code><code class="n">color</code><code class="p">:</code> <code class="n">Int</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="n">paint</code><code class="p">.</code><code class="n">color</code> <code class="p">=</code> <code class="n">color</code>&#13;
  <code class="c1">// invalidate lets the system know to redraw the View in the next frame</code>&#13;
  <code class="n">invalidate</code><code class="p">()</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>A custom <code>ViewGroup</code>, on the other hand, might represent a new layout strategy or encompass a set of child <code>View</code> and <code>ViewGroup</code> instances that make up a sophisticated component like a date picker or media player. Using <code>ViewGroup</code> in this fashion is generally referred to as creating a custom “component” and requires a much deeper dive. We’ll touch on it here, but be sure to check out <a href="https://oreil.ly/ugTKF">the documentation</a> for a more dedicated and thorough write-up.</p>&#13;
&#13;
<p>The<a data-primary="Android commands and methods" data-secondary="onMeasure" data-type="indexterm" id="idm46177241103896"/><a data-primary="Android commands and methods" data-secondary="onLayout" data-type="indexterm" id="idm46177241102920"/> main points to consider can be summed up in two methods: <code>onMeasure</code> and <code>onLayout</code>. <code>onMeasure</code> tells the parent how much space the custom component <em>wants</em>. Sometimes that’s all the available space; sometimes it’s only as much space as its contents require, or it might be a mix.</p>&#13;
&#13;
<p><code>onMeasure</code> is passed two <code>int</code> parameters: the <code>widthMeasureSpec</code> parameter and <code>heightMeasureSpec</code>. These values include bits that indicate a “mode” (like a flag to indicate the dimension should consume the same space as its parent, called <code>MATCH_PARENT</code>), as well as a pixel dimension, potentially.</p>&#13;
&#13;
<p>You can use <code>MeasureSpec.getMode</code> and <code>MeasureSpec.getSize</code> to read those values from a masked measure spec.</p>&#13;
&#13;
<p>The second method to know is <code>onLayout</code>. Various events trigger a request for a view tree to lay itself out, like the size of the parent or child changing, or when a child is added, removed, or reordered. In addition, as a developer you can explicitly request a new layout pass with <code>View.requestLayout</code>.</p>&#13;
&#13;
<p>The default implementation of <code>onLayout</code> does nothing (although concrete subclasses of <code>ViewGroup</code> like <code>FrameLayout</code> and <code>Linearlayout</code> do define this method). It’s up to you to define how a <code>ViewGroup</code> lays out its children. For example, a vertically oriented <code>LinearLayout</code> first measures all its children (in <code>onMeasure</code>); then in <code>onLayout</code>, it positions its first child at the top, the second child just beneath that, the third just beneath the second, and so on. The vertical space it reports as required will be the sum total of those heights. A <code>FrameLayout</code> is a simpler (and more efficient) mechanism: all children are laid out independent of one another, with explicit margin values being provided to each child’s <code>LayoutParams</code> that indicate the top and left values of the child’s position.</p>&#13;
&#13;
<p>For example, the following code would use a <code>FrameLayout</code> as the content view for an <code>Activity</code>, and position a <code>TextView</code> at one hundred pixels from the top and left. Adding other child <code>View</code> instances to that container would have no bearing on the position of the <code>TextView</code>, since the <code>FrameLayout</code> only examines the margin values of the <code><span class="keep-together">LayoutParams</span></code> of children when performing its <code>onLayout</code> operation:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177241172024">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">MyActivity</code> <code class="kd">extends</code> <code class="n">Activity</code> <code class="o">{</code>&#13;
&#13;
  <code class="nd">@Override</code>&#13;
  <code class="kd">public</code> <code class="kt">void</code> <code class="nf">onCreate</code><code class="o">(</code><code class="n">Bundle</code> <code class="n">savedInstanceState</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">FrameLayout</code> <code class="n">container</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FrameLayout</code><code class="o">(</code><code class="k">this</code><code class="o">);</code>&#13;
    <code class="n">setContentView</code><code class="o">(</code><code class="n">container</code><code class="o">);</code>&#13;
    <code class="n">FrameLayout</code><code class="o">.</code><code class="na">LayoutParams</code> <code class="n">lp</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FrameLayout</code><code class="o">.</code><code class="na">LayoutParams</code><code class="o">(</code><code class="n">LayoutParams</code><code class="o">.</code><code class="na">WRAP_CONTENT</code><code class="o">,</code>&#13;
    <code class="n">LayoutParams</code><code class="o">.</code><code class="na">WRAP_CONTENT</code><code class="o">);</code>&#13;
    <code class="n">lp</code><code class="o">.</code><code class="na">leftMargin</code> <code class="o">=</code> <code class="mi">100</code><code class="o">;</code>&#13;
    <code class="n">lp</code><code class="o">.</code><code class="na">topMargin</code> <code class="o">=</code> <code class="mi">100</code><code class="o">;</code>&#13;
    <code class="n">TextView</code> <code class="n">textView</code> <code class="o">=</code> <code class="k">new</code> <code class="n">TextView</code><code class="o">(</code><code class="k">this</code><code class="o">);</code>&#13;
    <code class="n">textView</code><code class="o">.</code><code class="na">setText</code><code class="o">(</code><code class="s">"Hello world!"</code><code class="o">);</code>&#13;
    <code class="n">container</code><code class="o">.</code><code class="na">addView</code><code class="o">(</code><code class="n">textView</code><code class="o">,</code> <code class="n">lp</code><code class="o">);</code>&#13;
  <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">MyActivity</code> <code class="p">:</code> <code class="n">Activity</code><code class="p">()</code> <code class="p">{</code>&#13;
&#13;
  <code class="k">override</code> <code class="k">fun</code> <code class="nf">onCreate</code><code class="p">(</code><code class="n">savedInstanceState</code><code class="p">:</code> <code class="n">Bundle</code><code class="p">?)</code> <code class="p">{</code>&#13;
    <code class="k">val</code> <code class="py">container</code> <code class="p">=</code> <code class="n">FrameLayout</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>&#13;
    <code class="n">setContentView</code><code class="p">(</code><code class="n">container</code><code class="p">)</code>&#13;
    <code class="k">val</code> <code class="py">lp</code> <code class="p">=</code> <code class="n">FrameLayout</code><code class="p">.</code><code class="n">LayoutParams</code><code class="p">(</code><code class="n">LayoutParams</code><code class="p">.</code><code class="n">WRAP_CONTENT</code><code class="p">,</code>&#13;
      <code class="n">LayoutParams</code><code class="p">.</code><code class="n">WRAP_CONTENT</code><code class="p">)</code>&#13;
    <code class="n">lp</code><code class="p">.</code><code class="n">leftMargin</code> <code class="p">=</code> <code class="m">100</code>&#13;
    <code class="n">lp</code><code class="p">.</code><code class="n">topMargin</code> <code class="p">=</code> <code class="m">100</code>&#13;
    <code class="k">val</code> <code class="py">textView</code> <code class="p">=</code> <code class="n">TextView</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>&#13;
    <code class="n">textView</code><code class="p">.</code><code class="n">text</code> <code class="p">=</code> <code class="s">"Hello world!"</code>&#13;
    <code class="n">container</code><code class="p">.</code><code class="n">addView</code><code class="p">(</code><code class="n">textView</code><code class="p">,</code> <code class="n">lp</code><code class="p">)</code>&#13;
  <code class="p">}</code>&#13;
&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Here’s an <code>onLayout</code> implementation that will position its children in order horizontally until there is no more available space, at which point it will wrap to the next line. This is sometimes known as a “FlowLayout”:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177240995144">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="nd">@Override</code>&#13;
<code class="kd">protected</code> <code class="kt">void</code> <code class="nf">onLayout</code><code class="o">(</code><code class="kt">boolean</code> <code class="n">changed</code><code class="o">,</code> <code class="kt">int</code> <code class="n">left</code><code class="o">,</code> <code class="kt">int</code> <code class="n">top</code><code class="o">,</code> <code class="kt">int</code> <code class="n">right</code><code class="o">,</code> <code class="kt">int</code> <code class="n">bottom</code><code class="o">)</code> <code class="o">{</code>&#13;
  <code class="kt">int</code> <code class="n">x</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
  <code class="kt">int</code> <code class="n">y</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
  <code class="kt">int</code> <code class="n">tallest</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
  <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">getChildCount</code><code class="o">();</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
    <code class="n">View</code> <code class="n">child</code> <code class="o">=</code> <code class="n">getChildAt</code><code class="o">(</code><code class="n">i</code><code class="o">);</code>&#13;
    <code class="kt">int</code> <code class="n">childWidth</code> <code class="o">=</code> <code class="n">child</code><code class="o">.</code><code class="na">getMeasuredWidth</code><code class="o">();</code>&#13;
    <code class="kt">int</code> <code class="n">childHeight</code> <code class="o">=</code> <code class="n">child</code><code class="o">.</code><code class="na">getMeasuredHeight</code><code class="o">();</code>&#13;
    <code class="n">tallest</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">max</code><code class="o">(</code><code class="n">tallest</code><code class="o">,</code> <code class="n">childHeight</code><code class="o">);</code>&#13;
    <code class="k">if</code> <code class="o">(</code><code class="n">childWidth</code> <code class="o">+</code> <code class="n">x</code> <code class="o">&gt;</code> <code class="n">getWidth</code><code class="o">())</code> <code class="o">{</code>&#13;
      <code class="n">x</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
      <code class="n">y</code> <code class="o">+=</code> <code class="n">tallest</code><code class="o">;</code>&#13;
      <code class="n">tallest</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
    <code class="n">child</code><code class="o">.</code><code class="na">layout</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">,</code> <code class="n">c</code> <code class="o">+</code> <code class="n">childWidth</code><code class="o">,</code> <code class="n">y</code> <code class="o">+</code> <code class="n">childHeight</code><code class="o">);</code>&#13;
    <code class="n">x</code> <code class="o">+=</code> <code class="n">childWidth</code><code class="o">;</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="n">override</code> <code class="n">fun</code> <code class="nf">onLayout</code><code class="o">(</code><code class="nl">changed:</code> <code class="n">Boolean</code><code class="o">,</code> <code class="nl">left:</code> <code class="n">Int</code><code class="o">,</code> <code class="nl">top:</code> <code class="n">Int</code><code class="o">,</code> <code class="nl">right:</code> <code class="n">Int</code><code class="o">,</code> <code class="nl">bottom:</code> <code class="n">Int</code><code class="o">)</code> <code class="o">{</code>&#13;
  <code class="n">var</code> <code class="n">x</code> <code class="o">=</code> <code class="mi">0</code>&#13;
  <code class="n">var</code> <code class="n">y</code> <code class="o">=</code> <code class="mi">0</code>&#13;
  <code class="n">var</code> <code class="n">tallest</code> <code class="o">=</code> <code class="mi">0</code>&#13;
  <code class="k">for</code> <code class="o">(</code><code class="n">i</code> <code class="n">in</code> <code class="mi">0</code> <code class="n">until</code> <code class="n">childCount</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="n">val</code> <code class="n">child</code> <code class="o">=</code> <code class="n">getChildAt</code><code class="o">(</code><code class="n">i</code><code class="o">)</code>&#13;
    <code class="n">val</code> <code class="n">childWidth</code> <code class="o">=</code> <code class="n">child</code><code class="o">.</code><code class="na">measuredWidth</code>&#13;
    <code class="n">val</code> <code class="n">childHeight</code> <code class="o">=</code> <code class="n">child</code><code class="o">.</code><code class="na">measuredHeight</code>&#13;
    <code class="n">tallest</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">max</code><code class="o">(</code><code class="n">tallest</code><code class="o">,</code> <code class="n">childHeight</code><code class="o">)</code>&#13;
    <code class="k">if</code> <code class="o">(</code><code class="n">childWidth</code> <code class="o">+</code> <code class="n">x</code> <code class="o">&gt;</code> <code class="n">width</code><code class="o">)</code> <code class="o">{</code>&#13;
      <code class="n">x</code> <code class="o">=</code> <code class="mi">0</code>&#13;
      <code class="n">y</code> <code class="o">+=</code> <code class="n">tallest</code>&#13;
      <code class="n">tallest</code> <code class="o">=</code> <code class="mi">0</code>&#13;
    <code class="o">}</code>&#13;
    <code class="n">child</code><code class="o">.</code><code class="na">layout</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">,</code> <code class="n">x</code> <code class="o">+</code> <code class="n">childWidth</code><code class="o">,</code> <code class="n">y</code> <code class="o">+</code> <code class="n">childHeight</code><code class="o">)</code>&#13;
    <code class="n">x</code> <code class="o">+=</code> <code class="n">childWidth</code>&#13;
  <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Other than that, feel free to add your own methods and properties to create whatever functionality your custom component requires.<a data-primary="" data-startref="KCview03" data-type="indexterm" id="idm46177240725304"/><a data-primary="" data-startref="JCview03" data-type="indexterm" id="idm46177240724568"/><a data-primary="" data-startref="ACview03" data-type="indexterm" id="idm46177240723656"/><a data-primary="" data-startref="CCAview03" data-type="indexterm" id="idm46177240526872"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Use a Custom View" data-type="sect2"><div class="sect2" id="idm46177241860840">&#13;
<h2>How to Use a Custom View</h2>&#13;
&#13;
<p>So<a data-primary="custom components" data-secondary="Android" data-tertiary="using custom views" data-type="indexterm" id="idm46177240524728"/><a data-primary="Android" data-secondary="custom components" data-tertiary="using custom views" data-type="indexterm" id="idm46177240523560"/> far, we’ve presented a lot of information about custom <code>Views</code> and components, but for the most part, that information has been orderly and reasonably logical. What follows is mostly framework-specific mechanics and might not make sense immediately. For the application layer to do its magic requires that we jump through some hoops—don’t feel bad if this doesn’t make sense to you right away (or ever, really); we still find ourselves looking this up occasionally.</p>&#13;
&#13;
<p>First, let’s make some assumptions. We’ve got the <code>TextView</code> subclass from the preceding example: <code>BottomBorderTextView</code>. It’s going to be presented in XML just like any <code>TextView</code> would, with <code>android</code> namespace properties like <code>android:text</code> and <code>android:textSize</code>. But now we want to add a property: <code>borderColor</code>.</p>&#13;
&#13;
<p>This new attribute is not part of the <code>android</code> namespace but is rather part of your application’s XML namespace (<code>http://schemas.android.com/apk/res/com.yourapp</code>). Fortunately, in the previous chapter on <code>Views</code>, we saw that we could use the “auto” namespace <code>http://schemas.android.com/apk/res/auto</code> and have that mapped directly to the current app’s namespace.</p>&#13;
&#13;
<p>First, we have to define this custom attribute as a compiled <code>values</code> value. This is traditionally put in <em>res/values/attrs.xml</em>, but it can really be in any <em>res/values</em> <span class="keep-together">subdirectory</span>.</p>&#13;
&#13;
<p>The attribute must be within a <code>declare-styleable</code> node, which should have a <code>name</code> attribute equal to the simple name of your custom component within a <code>resource</code> node. Each attribute (in this example, just the single <code>borderColor</code> attribute) is represented as an <code>attr</code> node with the name equal to the property name, and a format representing acceptable data types (<code>color</code>, <code>boolean</code>, <code>dimension</code>, <code>integer</code>, and many more).</p>&#13;
&#13;
<p>All together, our example would look something like this:</p>&#13;
&#13;
<pre data-code-language="xml" data-type="programlisting"><code class="nt">&lt;resources&gt;</code>&#13;
   <code class="nt">&lt;declare-styleable</code> <code class="na">name=</code><code class="s">"BottomBorderTextView"</code><code class="nt">&gt;</code>&#13;
       <code class="nt">&lt;attr</code> <code class="na">name=</code><code class="s">"borderColor"</code> <code class="na">format=</code><code class="s">"color"</code> <code class="nt">/&gt;</code>&#13;
   <code class="nt">&lt;/declare-styleable&gt;</code>&#13;
<code class="nt">&lt;/resources&gt;</code></pre>&#13;
&#13;
<p>You could then reference your custom attribute in the XML layout for your custom component:</p>&#13;
&#13;
<pre data-code-language="xml" data-type="programlisting"><code class="nt">&lt;com.myapp.BottomBorderTextView</code>&#13;
  <code class="na">xmlns:android=</code><code class="s">"http://schemas.android.com/apk/res/android"</code>&#13;
  <code class="na">xmlns:app=</code><code class="s">"http://schemas.android.com/apk/res-auto"</code>&#13;
  <code class="na">android:layout_width=</code><code class="s">"match_parent"</code>&#13;
  <code class="na">android:layout_height=</code><code class="s">"wrap_content"</code>&#13;
  <code class="na">android:text=</code><code class="s">"Hello world!"</code>&#13;
  <code class="na">app:borderColor=</code><code class="s">"#FFFF9900"</code> <code class="nt">/&gt;</code></pre>&#13;
&#13;
<p>Next, you have to pull the value of the custom attribute during the <code>View</code>’s construction. This<a data-primary="Java" data-secondary="custom components" data-tertiary="using custom views" data-type="indexterm" id="idm46177240484216"/><a data-primary="Kotlin" data-secondary="custom components" data-tertiary="using custom views" data-type="indexterm" id="idm46177240483064"/> requires some highly unintuitive code. Let’s let the code sample explain what English cannot:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177240481480">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="nf">BottomBorderTextView</code><code class="o">(</code><code class="n">Context</code> <code class="n">context</code><code class="o">,</code> <code class="nd">@Nullable</code> <code class="n">AttributeSet</code> <code class="n">attrs</code><code class="o">,</code>&#13;
  <code class="kt">int</code> <code class="n">defStyleAttr</code><code class="o">)</code> <code class="o">{</code>&#13;
  <code class="kd">super</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="n">attrs</code><code class="o">,</code> <code class="n">defStyleAttr</code><code class="o">);</code>&#13;
  <code class="n">TypedArray</code> <code class="n">a</code> <code class="o">=</code> <code class="n">context</code><code class="o">.</code><code class="na">getTheme</code><code class="o">().</code><code class="na">obtainStyledAttributes</code><code class="o">(</code>&#13;
        <code class="n">attrs</code><code class="o">,</code>&#13;
        <code class="n">R</code><code class="o">.</code><code class="na">styleable</code><code class="o">.</code><code class="na">BottomBorderTextView</code><code class="o">,</code>&#13;
        <code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code>&#13;
   <code class="k">try</code> <code class="o">{</code>&#13;
       <code class="kt">int</code> <code class="n">color</code> <code class="o">=</code> <code class="n">a</code><code class="o">.</code><code class="na">getBoolean</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">styleable</code><code class="o">.</code><code class="na">BottomBorderTextView_borderColor</code><code class="o">,</code>&#13;
       <code class="n">Color</code><code class="o">.</code><code class="na">BLACK</code><code class="o">);</code>&#13;
       <code class="n">setBorderColor</code><code class="o">(</code><code class="n">color</code><code class="o">);</code>&#13;
   <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>&#13;
       <code class="n">a</code><code class="o">.</code><code class="na">recycle</code><code class="o">();</code>&#13;
   <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="n">constructor</code><code class="p">(</code><code class="n">context</code><code class="p">:</code> <code class="n">Context</code><code class="p">,</code> <code class="n">attrs</code><code class="p">:</code> <code class="n">AttributeSet</code><code class="p">,</code> <code class="n">defStyleAttr</code><code class="p">:</code> <code class="n">Int</code><code class="p">)</code> <code class="p">:</code>&#13;
  <code class="k">super</code><code class="p">(</code><code class="n">context</code><code class="p">,</code> <code class="n">attrs</code><code class="p">,</code> <code class="n">defStyleAttr</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">val</code> <code class="py">a</code> <code class="p">=</code> <code class="n">context</code><code class="p">.</code><code class="n">theme</code><code class="p">.</code><code class="n">obtainStyledAttributes</code><code class="p">(</code><code class="n">attrs</code><code class="p">,</code>&#13;
        <code class="n">R</code><code class="p">.</code><code class="n">styleable</code><code class="p">.</code><code class="n">BottomBorderTextView</code><code class="p">,</code> <code class="m">0</code><code class="p">,</code> <code class="m">0</code><code class="p">)</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
      <code class="n">borderColor</code> <code class="p">=</code> <code class="n">a</code><code class="p">.</code><code class="n">getInt</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">styleable</code><code class="p">.</code><code class="n">BottomBorderTextView_borderColor</code><code class="p">,</code> <code class="n">Color</code><code class="p">.</code><code class="n">BLACK</code><code class="p">)</code>&#13;
    <code class="p">}</code> <code class="k">finally</code> <code class="p">{</code>&#13;
      <code class="n">a</code><code class="p">.</code><code class="n">recycle</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Where did <code>R.styleable.BottomBorderTextView</code> come from? How about this mouthful: <code>R.styleable.BottomBorderTextView_borderColor</code>? The answer is: magic. The system does Magic Things behind the scenes, but you can be (roughly) assured that by creating that <code>resource</code> XML earlier, these values were added to the global <code>R</code> instance. The name of the <code>declare-styleable</code> node generates the name of the property with an underscore appended, and then appends the name of the <code>attr</code> node to that. The <code>TypedArray</code> is a bit magical itself, and we highly doubt you’ll ever use <code>context.getTheme().obtainStyledAttributes</code> in any other setting. As always, we encourage you to read the dev docs and even check out the source code, but in this case (as happens frequently with framework-level compilation operations), you might just want to trust us.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>You will probably want to wrap that custom attribute logic in an <span class="keep-together"><code>initialize</code></span> method and call it for every constructor signature for your custom view, or you can use the handy trick of each constructor calling the next level up with default or <code>null</code> values.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="iOS" data-type="sect1"><div class="sect1" id="idm46177240525672">&#13;
<h1>iOS</h1>&#13;
&#13;
<p>You can configure<a data-primary="custom components" data-secondary="iOS" data-tertiary="overview of" data-type="indexterm" id="idm46177240163064"/><a data-primary="iOS" data-secondary="custom components" data-tertiary="overview of" data-type="indexterm" id="idm46177240161784"/> a custom view on iOS and build in a scene within a storyboard or directly within a<a data-primary="XML Interface Builder (XIB)" data-type="indexterm" id="idm46177240160440"/> XIB file inside of Xcode. Unfortunately, that approach can quickly become unsustainable due to the complexity in reusing such a view. Typically, when “custom views” are referenced in iOS, a custom class that inherits from the root view class in iOS is what’s being implied. These views are often reusable and typically contain a great deal more functionality than what’s possible without violating single-responsibility principles and stuffing that functionality into a view controller directly. Let’s learn a bit more about some best practices in creating custom views within iOS and UIKit.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Create a Custom View" data-type="sect2"><div class="sect2" id="idm46177240158920">&#13;
<h2>How to Create a Custom View</h2>&#13;
&#13;
<p>Fundamentally, on<a data-primary="UIKit" data-secondary="UIView" data-type="indexterm" id="idm46177240157032"/><a data-primary="custom components" data-secondary="iOS" data-tertiary="creating custom views" data-type="indexterm" id="idm46177240156024"/><a data-primary="iOS" data-secondary="custom components" data-tertiary="creating custom views" data-type="indexterm" id="idm46177240154808"/> iOS a view is a <code>UIView</code> instance. This can be either a direct instance of <code>UIView</code>, or a subclass of <code>UIView</code>. In order to create a custom view, it’s not much harder than subclassing <code>UIView</code> like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">SomeView</code><code class="p">:</code> <code class="bp">UIView</code> <code class="p">{</code>&#13;
    <code class="kr">required</code> <code class="kd">init</code><code class="p">?(</code><code class="n">coder</code> <code class="n">aDecoder</code><code class="p">:</code> <code class="bp">NSCoder</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">coder</code><code class="p">:</code> <code class="n">aDecoder</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="c1">// Customization goes here</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>There are two initializers that need to be present if you plan on adding more properties and want the object to be ready to go whenever it’s initialized. These are <code>init(coder:)</code> and <code>init(frame:)</code>. You can add any setup code necessary to prepare the object for use inside these methods.</p>&#13;
&#13;
<p>If, for example, we wanted a view with a red background that contained a button reading “Click Me!” we could set this up with an object like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">SomeView</code><code class="p">:</code> <code class="bp">UIView</code> <code class="p">{</code>&#13;
    <code class="kr">required</code> <code class="kd">init</code><code class="p">?(</code><code class="n">coder</code> <code class="n">aDecoder</code><code class="p">:</code> <code class="bp">NSCoder</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">coder</code><code class="p">:</code> <code class="n">aDecoder</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">func</code> <code class="nf">setupView</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="n">backgroundColor</code> <code class="p">=</code> <code class="p">.</code><code class="n">red</code>&#13;
&#13;
        <code class="kd">let</code> <code class="nv">button</code> <code class="p">=</code> <code class="bp">UIButton</code><code class="p">(</code><code class="n">type</code><code class="p">:</code> <code class="p">.</code><code class="n">custom</code><code class="p">)</code>&#13;
        <code class="n">button</code><code class="p">.</code><code class="n">titleLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="s">"Click Me!"</code>&#13;
&#13;
        <code class="n">addSubview</code><code class="p">(</code><code class="n">button</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The<a data-primary="iOS methods" data-secondary="setupView" data-type="indexterm" id="idm46177244883304"/> <code>setupView</code> method is shared between both initializers and is called whenever the view is created. This allows a consistent setup process to happen. Inside <code>setupView</code>, the view’s <code>backgroundColor</code> is set to a <code>UIColor</code> instance of <code>.red</code>, and a new button instance is created and added as a subview.</p>&#13;
&#13;
<p>It’s also possible to add properties to our view. For example, let’s make the text inside the button configurable like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">SomeView</code><code class="p">:</code> <code class="bp">UIView</code> <code class="p">{</code>&#13;
    <code class="kd">var</code> <code class="nv">buttonText</code><code class="p">:</code> <code class="nb">String</code> <code class="p">=</code> <code class="s">"Click Me!"</code> <code class="p">{</code>&#13;
        <code class="kr">didSet</code> <code class="p">{</code>&#13;
            <code class="n">button</code><code class="p">.</code><code class="n">titleLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="kc">self</code><code class="p">.</code><code class="n">buttonText</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
    <code class="kr">lazy</code> <code class="kd">var</code> <code class="nv">button</code><code class="p">:</code> <code class="bp">UIButton</code> <code class="p">=</code> <code class="p">{</code>&#13;
        <code class="kd">let</code> <code class="nv">button</code> <code class="p">=</code> <code class="bp">UIButton</code><code class="p">(</code><code class="n">type</code><code class="p">:</code> <code class="p">.</code><code class="n">custom</code><code class="p">)</code>&#13;
        <code class="n">addSubview</code><code class="p">(</code><code class="n">button</code><code class="p">)</code>&#13;
        <code class="k">return</code> <code class="n">button</code>&#13;
    <code class="p">}()</code>&#13;
&#13;
    <code class="kr">required</code> <code class="kd">init</code><code class="p">?(</code><code class="n">coder</code> <code class="n">aDecoder</code><code class="p">:</code> <code class="bp">NSCoder</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">coder</code><code class="p">:</code> <code class="n">aDecoder</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">convenience</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">,</code> <code class="n">buttonText</code><code class="p">:</code> <code class="nb">String</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">self</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
        <code class="kc">self</code><code class="p">.</code><code class="n">buttonText</code> <code class="p">=</code> <code class="n">buttonText</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">func</code> <code class="nf">setupView</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="n">backgroundColor</code> <code class="p">=</code> <code class="p">.</code><code class="n">red</code>&#13;
        <code class="n">button</code><code class="p">.</code><code class="n">titleLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="n">buttonText</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">noClicky</code> <code class="p">=</code> <code class="n">SomeView</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">.</code><code class="n">zero</code><code class="p">,</code> <code class="n">buttonText</code><code class="p">:</code> <code class="s">"Don't click me!"</code><code class="p">)</code></pre>&#13;
&#13;
<p>We’ve added a new property, <code>buttonText</code>, to store our button’s title label text in a variable that we can use to populate it. That will allow us to initialize the button and pass in the correct text at the same time. In addition, we’ve transformed our <code>setupView</code> method a bit: we took the button initialization out of there and added it to a <code>lazy</code> property that’s stored so we can change it later and not have it added to the view again as a new button.</p>&#13;
&#13;
<p>Let’s take a look at how we can use our new custom view.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Use a Custom View" data-type="sect2"><div class="sect2" id="idm46177239959160">&#13;
<h2>How to Use a Custom View</h2>&#13;
&#13;
<p>It<a data-primary="custom components" data-secondary="iOS" data-tertiary="using custom views" data-type="indexterm" id="idm46177239774424"/><a data-primary="iOS" data-secondary="custom components" data-tertiary="using custom views" data-type="indexterm" id="idm46177239773144"/> could be as simple as the following:</p>&#13;
&#13;
<pre class="small" data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">SomeViewController</code><code class="p">:</code> <code class="bp">UIViewController</code> <code class="p">{</code>&#13;
    <code class="kr">override</code> <code class="kd">func</code> <code class="nf">viewDidLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="n">viewDidLoad</code><code class="p">()</code>&#13;
        <code class="kd">let</code> <code class="nv">clickMeButton</code> <code class="p">=</code>&#13;
          <code class="n">SomeView</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">(</code><code class="n">x</code><code class="p">:</code> <code class="mf">0.0</code><code class="p">,</code> <code class="n">y</code><code class="p">:</code> <code class="mf">0.0</code><code class="p">,</code> <code class="n">width</code><code class="p">:</code> <code class="mf">100.0</code><code class="p">,</code> <code class="n">height</code><code class="p">:</code> <code class="mf">50.0</code><code class="p">),</code>&#13;
          <code class="n">buttonText</code><code class="p">:</code> <code class="s">"Click Me!"</code><code class="p">)</code>&#13;
        <code class="n">view</code><code class="p">.</code><code class="n">addSubview</code><code class="p">(</code><code class="n">clickMeButton</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This code creates a new custom view controller and instantiates an instance of the view. Then, it adds it to the view controllers view. Pretty simple!</p>&#13;
&#13;
<p>We can, however, use Interface Builder to add an instance of the button directly. In<a data-primary="XML Interface Builder (XIB)" data-type="indexterm" id="idm46177239718744"/> a storyboard or XIB file, add a new View object from the Library. Then, use the Identity inspector to set the object’s custom class to “SomeView” to change the class mapped to the view.</p>&#13;
&#13;
<p>This is good, but we can do even better with a few custom flags relevant to Interface Builder called <code>@IBInspectable</code> and <code>@IBDesignable</code>. These flags enable Interface Builder to configure and display the view like it’ll be displayed inside a running app as much as possible.</p>&#13;
&#13;
<p>To use them, decorate the custom view in code like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kr">@IBDesignable</code> <code class="kd">class</code> <code class="nc">SomeView</code><code class="p">:</code> <code class="bp">UIView</code> <code class="p">{</code>&#13;
    <code class="kr">@IBInspectable</code> <code class="kd">var</code> <code class="nv">buttonText</code><code class="p">:</code> <code class="nb">String</code> <code class="p">=</code> <code class="s">"Click Me!"</code> <code class="p">{</code>&#13;
        <code class="kr">didSet</code> <code class="p">{</code>&#13;
            <code class="n">button</code><code class="p">.</code><code class="n">titleLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="kc">self</code><code class="p">.</code><code class="n">buttonText</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
    <code class="kr">lazy</code> <code class="kd">var</code> <code class="nv">button</code><code class="p">:</code> <code class="bp">UIButton</code> <code class="p">=</code> <code class="p">{</code>&#13;
        <code class="kd">let</code> <code class="nv">button</code> <code class="p">=</code> <code class="bp">UIButton</code><code class="p">(</code><code class="n">type</code><code class="p">:</code> <code class="p">.</code><code class="n">custom</code><code class="p">)</code>&#13;
        <code class="n">addSubview</code><code class="p">(</code><code class="n">button</code><code class="p">)</code>&#13;
        <code class="k">return</code> <code class="n">button</code>&#13;
    <code class="p">}()</code>&#13;
&#13;
    <code class="kr">required</code> <code class="kd">init</code><code class="p">?(</code><code class="n">coder</code> <code class="n">aDecoder</code><code class="p">:</code> <code class="bp">NSCoder</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">coder</code><code class="p">:</code> <code class="n">aDecoder</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">override</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">super</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
        <code class="n">setupView</code><code class="p">()</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">convenience</code> <code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="bp">CGRect</code><code class="p">,</code> <code class="n">buttonText</code><code class="p">:</code> <code class="nb">String</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kc">self</code><code class="p">.</code><code class="kd">init</code><code class="p">(</code><code class="n">frame</code><code class="p">:</code> <code class="n">frame</code><code class="p">)</code>&#13;
        <code class="kc">self</code><code class="p">.</code><code class="n">buttonText</code> <code class="p">=</code> <code class="n">buttonText</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">func</code> <code class="nf">setupView</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="n">backgroundColor</code> <code class="p">=</code> <code class="p">.</code><code class="n">red</code>&#13;
        <code class="n">button</code><code class="p">.</code><code class="n">titleLabel</code><code class="p">?.</code><code class="n">text</code> <code class="p">=</code> <code class="n">buttonText</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Now, if you go back to the storyboard or view, you can see in the Attributes inspector for the view there is now a new field called “Button Text” where you can set the text for the button. If you change it, Interface Builder will update the button text displayed on-screen (see <a data-type="xref" href="#topics_custom_views_some_view">Figure 3-1</a>)!</p>&#13;
&#13;
<p>Interface Builder, UIKit, and Xcode are a powerful combination. You can really create any number of different views and variations—the only limit is your imagination. The options available are vast and impossible to enumerate in a single chapter of a book. For more information, certainly check out Apple’s <a href="https://oreil.ly/QtOVC">developer documentation on <code>UIView</code></a>.</p>&#13;
&#13;
<figure><div class="figure" id="topics_custom_views_some_view">&#13;
<img alt="Custom view with editable fields in Interface Builder" src="assets/nmdv_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>Custom view with editable fields in Interface Builder</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="What We’ve Learned" data-type="sect1"><div class="sect1" id="idm46177239442888">&#13;
<h1>What We’ve Learned</h1>&#13;
&#13;
<p>This chapter wraps up our coverage on UI controllers (<a data-type="xref" href="ch01.html#topics_ui_controllers">Chapter 1</a>), views (<a data-type="xref" href="ch02.html#topics_views">Chapter 2</a>), and custom views. We’ve covered a lot of ground.</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>We showed that creating a custom view requires some subclassing and customization in both Android and iOS.</p>&#13;
</li>&#13;
<li>&#13;
<p>There are differences in how to configure the views, set them up, and instantiate them for use.</p>&#13;
</li>&#13;
<li>&#13;
<p>We discussed the approaches and ways in which custom views can be used to build custom interfaces.</p>&#13;
</li>&#13;
<li>&#13;
<p>Both platforms have a vast and powerful set of tools to build interfaces that can delight and surprise users.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>