- en: Chapter 2\. Creating a Kubernetes Cluster
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章 创建 Kubernetes 集群
- en: In this chapter we discuss multiple ways to set up a full-blown Kubernetes cluster.
    We cover low-level, standardized tooling (`kubeadm`) that also serves as the basis
    for other installers and show you where to find the relevant binaries for the
    control plane, as well as for worker nodes. We demonstrate how to write systemd
    unit files to supervise Kubernetes components and finally show how to set up clusters
    on Google Cloud Platform and Azure.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们讨论了多种设置完整 Kubernetes 集群的方法。我们涵盖了低级别的标准化工具（`kubeadm`），这些工具也是其他安装程序的基础，并向您展示了控制平面和工作节点的相关二进制文件位置。我们演示了如何编写
    systemd 单元文件以监控 Kubernetes 组件，并最终展示了如何在 Google Cloud 平台和 Azure 上设置集群。
- en: 2.1 Preparing a New Node for a Kubernetes Cluster
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.1 为 Kubernetes 集群准备新节点
- en: Problem
  id: totrans-3
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You want to prepare a new node with all the required tooling to create a new
    Kubernetes cluster or add to an existing cluster.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 您希望为创建新的Kubernetes集群或将其添加到现有集群的节点准备一个新的节点，并配置所有必需的工具。
- en: Solution
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'To prepare an Ubuntu-based host for a Kubernetes cluster, you first need to
    turn on IPv4 forwarding and enable iptables to see bridged traffic:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 要为基于 Ubuntu 的主机准备 Kubernetes 集群，首先需要启用 IPv4 转发并启用 iptables 以查看桥接流量：
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'For compatibility with the `kubeadm` tool, the swap needs to be turned off
    on the node:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 为了与`kubeadm`工具兼容，节点上需要关闭交换分区：
- en: '[PRE1]'
  id: totrans-9
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Cluster nodes require an implementation of the Kubernetes Container Runtime
    Interface (CRI). [cri-o](https://cri-o.io) is one such implementation. The cri-o
    version should match the Kubernetes version. For example, if you are bootstrapping
    a Kubernetes 1.27 cluster, configure the `VERSION` variable accordingly:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 集群节点需要实现 Kubernetes 容器运行时接口（CRI）。[cri-o](https://cri-o.io) 就是其中之一。cri-o 的版本应与
    Kubernetes 版本匹配。例如，如果您要引导一个 Kubernetes 1.27 集群，请相应地配置 `VERSION` 变量：
- en: '[PRE2]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then reload the systemd configurations and enable cri-o:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 然后重新加载 systemd 配置并启用 cri-o：
- en: '[PRE3]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The `kubeadm` tool is required to bootstrap a Kubernetes cluster from scratch
    as well as to join an existing cluster. Enable its software repository with this:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`kubeadm` 工具用于从头开始引导 Kubernetes 集群，以及加入现有集群。使用以下命令启用其软件仓库：'
- en: '[PRE4]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now you can install all the tools required to bootstrap a Kubernetes cluster
    node. You will need the following:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您可以安装所有引导 Kubernetes 集群节点所需的工具。您将需要以下工具：
- en: The `kubelet` binary
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubelet` 二进制文件'
- en: The `kubeadm` CLI
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubeadm` 命令行界面'
- en: The `kubectl` client
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`kubectl` 客户端'
- en: 'Run this command to install them:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 运行此命令以安装它们：
- en: '[PRE5]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Then mark these packages as held back, which will prevent them from being automatically
    upgraded:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将这些软件包标记为被拒绝更新，以防止它们被自动升级：
- en: '[PRE6]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Your Ubuntu host is now ready to be part of a Kubernetes cluster.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 您的Ubuntu主机现在已准备好成为Kubernetes集群的一部分。
- en: Discussion
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: '`kubeadm` is a setup tool that provides `kubeadm init` and `kubeadm join`.
    `kubeadm init` is used to bootstrap a Kubernetes control-plane node, while `kubeadm
    join` is used to bootstrap a worker node and join it to the cluster. In essence,
    `kubeadm` provides the actions necessary to get a minimum viable cluster up and
    running. `kubelet` is the *node agent* that runs on each node.'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '`kubeadm` 是一个设置工具，提供了 `kubeadm init` 和 `kubeadm join`。`kubeadm init` 用于引导 Kubernetes
    控制平面节点，而 `kubeadm join` 用于引导工作节点并将其加入集群。实质上，`kubeadm` 提供了使得最小可行集群运行起来所需的动作。`kubelet`
    是在每个节点上运行的 *节点代理*。'
- en: In addition to cri-o, other container runtimes worth investigating are [containerd](https://oreil.ly/M1kDx),
    [Docker Engine](https://oreil.ly/P5_l_), and [Mirantis Container Runtime](https://oreil.ly/BEWaG).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 cri-o 外，还有其他容器运行时值得研究的是 [containerd](https://oreil.ly/M1kDx)、[Docker Engine](https://oreil.ly/P5_l_)
    和 [Mirantis Container Runtime](https://oreil.ly/BEWaG)。
- en: 2.2 Bootstrapping a Kubernetes Control-Plane Node
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.2 引导 Kubernetes 控制平面节点
- en: Problem
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have initialized an Ubuntu host for Kubernetes (see [Recipe 2.1](#kubeadm_install))
    and now need to bootstrap a new Kubernetes control-plane node.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经为Kubernetes初始化了一个Ubuntu主机（见[配方 2.1](#kubeadm_install)），现在需要引导一个新的Kubernetes控制平面节点。
- en: Solution
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'With the `kubeadm` binary installed, you are ready to start bootstrapping your
    Kubernetes cluster. Initialize the control plane on the node with the following:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 安装了`kubeadm`二进制文件后，您已准备好开始引导Kubernetes集群。在节点上初始化控制平面，使用以下命令：
- en: '[PRE7]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Warning
  id: totrans-34
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 警告
- en: The control-plane node should have a minimum of two vCPUs and 2 GB RAM.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 控制平面节点应至少具有两个虚拟CPU和2 GB内存。
- en: 'Now initialize the control-plane node using `kubeadm`:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在使用 `kubeadm` 初始化控制平面节点：
- en: '[PRE8]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The output of the `init` command contains the configuration for setting up
    `kubectl` to talk to your cluster. Once `kubectl` has been configured, you can
    verify the cluster component health status using the following command:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`init`命令的输出包含配置信息，用于设置`kubectl`与您的集群通信。一旦配置了`kubectl`，您可以使用以下命令验证集群组件的健康状态：'
- en: '[PRE9]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To get the cluster information, use:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取集群信息，请使用：
- en: '[PRE10]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Discussion
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: 'User workloads are not scheduled to execute on the control-plane node. If you
    are creating an experimental single-node cluster, then you would need to taint
    the control-plane node to schedule user workloads on the control-plane node:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 用户工作负载不会安排在控制平面节点上执行。如果您正在创建一个实验性的单节点集群，那么您需要对控制平面节点进行标记，以便在控制平面节点上安排用户工作负载：
- en: '[PRE11]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: See Also
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '[Creating a cluster with `kubeadm`](https://oreil.ly/q9nwI)'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[使用 `kubeadm` 创建集群](https://oreil.ly/q9nwI)'
- en: 2.3 Installing a Container Network Add-on for Cluster Networking
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.3 安装用于集群网络的容器网络插件
- en: Problem
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have bootstrapped a Kubernetes control-plane node (see [Recipe 2.2](#kube_control_plane))
    and now need to install a pod network add-on so that pods can communicate with
    each other.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经引导了一个 Kubernetes 控制平面节点（参见[配方 2.2](#kube_control_plane)），现在需要安装一个 pod 网络插件，以便
    pod 可以彼此通信。
- en: Solution
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'You can install the Calico network add-on with the following command on the
    control-plane node:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在控制平面节点上使用以下命令安装 Calico 网络插件：
- en: '[PRE12]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Discussion
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: You must use a Container Network Interface (CNI) add-on that is compatible with
    your cluster and that suits your needs. There are a number of add-ons that implement
    the CNI. Take a look at the nonexhaustive list of [available add-ons in the Kubernetes
    documentation](https://oreil.ly/HosU6).
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须使用与您的集群兼容并且符合您需求的容器网络接口（CNI）插件。有许多插件实现了 CNI。查看 Kubernetes 文档中关于[可用插件的非详尽列表](https://oreil.ly/HosU6)。
- en: 2.4 Adding Worker Nodes to a Kubernetes Cluster
  id: totrans-55
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.4 向 Kubernetes 集群添加工作节点
- en: Problem
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have initialized your Kubernetes control-plane node (see [Recipe 2.2](#kube_control_plane))
    and installed a CNI add-on (see [Recipe 2.3](#kube_cni)), and now you want to
    add worker nodes to your cluster.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经初始化了 Kubernetes 控制平面节点（参见[配方 2.2](#kube_control_plane)），并安装了一个 CNI 插件（参见[配方
    2.3](#kube_cni)），现在您想要向集群添加工作节点。
- en: Solution
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'With the Ubuntu host initialized for Kubernetes, as shown in [Recipe 2.1](#kubeadm_install),
    execute the following command on the control-plane node to display the cluster
    `join` command:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Ubuntu 主机初始化 Kubernetes，如[配方 2.1](#kubeadm_install)所示，在控制平面节点上执行以下命令以显示集群`join`命令：
- en: '[PRE13]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Now, execute the `join` command on the worker node:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在工作节点上执行`join`命令：
- en: '[PRE14]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Warning
  id: totrans-63
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 警告
- en: The worker node should have a minimum of one vCPU and 2 GB RAM.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 工作节点应至少具有一个 vCPU 和 2 GB RAM。
- en: 'Head back to your control-plane node terminal session and you will see your
    nodes join:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 返回到您的控制平面节点终端会话，您将看到您的节点加入：
- en: '[PRE15]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: You can repeat these steps to add more worker nodes to the Kubernetes cluster.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以重复这些步骤以向 Kubernetes 集群添加更多的工作节点。
- en: Discussion
  id: totrans-68
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: Worker nodes are where your workloads run. When your cluster starts running
    out of resources, you will begin noticing the *Pending* status of new pods. At
    this point you should consider adding more resources to the cluster by adding
    more worker nodes.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 工作节点是您的工作负载运行的地方。当集群开始耗尽资源时，您会开始注意到新 pod 的*挂起*状态。此时，您应该考虑通过添加更多的工作节点来增加集群资源。
- en: 2.5 Deploying the Kubernetes Dashboard
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.5 部署 Kubernetes 仪表板
- en: Problem
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have created a Kubernetes cluster, and now you want to create, view, and
    manage containerized workloads on the cluster using a user interface.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经创建了一个 Kubernetes 集群，现在您想要使用用户界面在集群上创建、查看和管理容器化工作负载。
- en: Solution
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: Use the [Kubernetes dashboard](https://oreil.ly/n7WQw), which is a web-based
    user interface to deploy containerized applications to a Kubernetes cluster and
    to manage the cluster resources.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 [Kubernetes 仪表板](https://oreil.ly/n7WQw)，这是一个基于 Web 的用户界面，用于将容器化应用程序部署到 Kubernetes
    集群，并管理集群资源。
- en: Tip
  id: totrans-75
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: 'If you’re using Minikube, you can install the Kubernetes dashboard simply by
    enabling the `dashboard` add-on:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用 Minikube，可以通过启用`dashboard`插件简单地安装 Kubernetes 仪表板：
- en: '[PRE16]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'To deploy the v2.7.0 Kubernetes dashboard, do this:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署 v2.7.0 Kubernetes 仪表板，请执行以下操作：
- en: '[PRE17]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Then verify that the deployment is ready:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 然后验证部署是否准备就绪：
- en: '[PRE18]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 2.6 Accessing the Kubernetes Dashboard
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.6 访问 Kubernetes 仪表板
- en: Problem
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have installed the Kubernetes dashboard (see [Recipe 2.5](#kubernetes_dashboard))
    on your cluster, and you want to access the dashboard from a web browser.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 您已在集群上安装了Kubernetes仪表板（参见[Recipe 2.5](#kubernetes_dashboard)），并希望从Web浏览器访问仪表板。
- en: Solution
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'You need to create a [`ServiceAccount`](https://oreil.ly/pXErB) with privileges
    to administer the cluster. Create a file named *sa.yaml* with the following contents:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要创建一个[`ServiceAccount`](https://oreil.ly/pXErB)，具有管理集群权限。创建名为*sa.yaml*的文件，并包含以下内容：
- en: '[PRE19]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Create the `ServiceAccount` with this:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此命令创建`ServiceAccount`：
- en: '[PRE20]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'To access the Kubernetes dashboard, you need to create an authentication token
    associated with this account. Save the token printed in the output of the following
    command:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问Kubernetes仪表板，您需要创建与此帐户关联的认证令牌。保存在以下命令的输出中打印的令牌：
- en: '[PRE21]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Since the Kubernetes dashboard is a cluster-local service, you need to set
    up a proxy connection to the cluster:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 由于Kubernetes仪表板是集群本地服务，您需要设置与集群的代理连接：
- en: '[PRE22]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: By visiting the site [*http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads?namespace=_all*](http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads?namespace=_all)
    you are now able to open the Kubernetes dashboard and authenticate yourself using
    the authentication token created earlier.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 访问[*http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads?namespace=_all*](http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/workloads?namespace=_all)，您现在可以打开Kubernetes仪表板并使用之前创建的认证令牌进行身份验证。
- en: In the UI that opens in your browser, you will see the page depicted in [Figure 2-1](#dashboard_create).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在浏览器中打开的UI中，您将看到[图 2-1](#dashboard_create)中所示的页面。
- en: '![Snapshot of the dashboard application create view](assets/kcb2_0201.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![仪表板应用程序创建视图的快照](assets/kcb2_0201.png)'
- en: Figure 2-1\. Snapshot of the dashboard application create view
  id: totrans-97
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-1\. 仪表板应用程序创建视图的快照
- en: Tip
  id: totrans-98
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: 'If you are using Minikube, all you need to do is:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用Minikube，您只需执行以下操作：
- en: '[PRE23]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Discussion
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: To create an application, click the plus sign (+) at the top-right corner, select
    the “Create from form” tab, give the application a name, and specify the container
    image you want to use. Then click the Deploy button and you will be presented
    with a new view that shows deployments, pods, and replica sets. In Kubernetes
    there are dozens of important resource types, such as deployments, pods, replica
    sets, services, and so on, that we will explore in greater detail in the rest
    of the book.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个应用程序，请点击右上角的加号（+），选择“从表单创建”选项卡，给应用程序命名，并指定您要使用的容器镜像。然后点击部署按钮，您将看到一个新视图，显示部署、pod和副本集。在Kubernetes中有数十种重要的资源类型，例如部署、pod、副本集、服务等，我们将在本书的其余部分详细探讨。
- en: The snapshot in [Figure 2-2](#redis-dashboard) presents a typical dashboard
    view after having created a single application using the Redis container.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建Redis容器后，[图 2-2](#redis-dashboard)中的快照展示了典型的仪表板视图。
- en: '![A dashboard overview with a Redis application](assets/kcb2_0202.png)'
  id: totrans-104
  prefs: []
  type: TYPE_IMG
  zh: '![带有Redis应用程序的仪表板概览](assets/kcb2_0202.png)'
- en: Figure 2-2\. A dashboard overview with a Redis application
  id: totrans-105
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-2\. 带有Redis应用程序的仪表板概览
- en: 'If you go back to a terminal session and use the command-line client, you will
    see the same thing:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您返回到终端会话并使用命令行客户端，则会看到相同的内容：
- en: '[PRE24]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Your Redis pod will be running the Redis server, as the following logs show:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您的Redis pod将运行Redis服务器，如下面的日志所示：
- en: '[PRE25]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 2.7 Deploying the Kubernetes Metrics Server
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.7 部署Kubernetes Metrics Server
- en: Problem
  id: totrans-111
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have deployed the Kubernetes dashboard (see [Recipe 2.5](#kubernetes_dashboard))
    but don’t see the CPU and memory usage information in the dashboard.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经部署了Kubernetes仪表板（参见[Recipe 2.5](#kubernetes_dashboard)），但在仪表板中看不到CPU和内存使用信息。
- en: Solution
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: The Kubernetes dashboard requires the [Kubernetes Metrics Server](https://oreil.ly/BEHwR)
    to visualize the CPU and memory usage.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: Kubernetes仪表板需要[Kubernetes Metrics Server](https://oreil.ly/BEHwR)来可视化CPU和内存使用情况。
- en: Tip
  id: totrans-115
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: 'If you are using Minikube, you can install the Kubernetes Metrics Server simply
    by enabling the `metrics-server` add-on:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用Minikube，只需启用`metrics-server`附加组件即可安装Kubernetes Metrics Server：
- en: '[PRE26]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'To deploy the latest release of the Kubernetes Metrics Server, do this:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要部署最新版本的Kubernetes Metrics Server，请执行以下操作：
- en: '[PRE27]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Then verify that the deployment is ready:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 然后验证部署是否就绪：
- en: '[PRE28]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'If you see that the deployment is not entering the ready state, check the pod
    logs:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 如果看到部署未进入就绪状态，请检查pod日志：
- en: '[PRE29]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'If you see the error message “cannot validate certificate,” you need to append
    the flag `--kubelet-insecure-tls` to the Metrics Server deployment:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你看到错误消息“无法验证证书”，则需要将标志 `--kubelet-insecure-tls` 添加到Metrics Server部署中：
- en: '[PRE30]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Tip
  id: totrans-126
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: It can take several minutes for the Metrics Server to become available after
    having started it. If it is not yet in the ready state, then requests for metrics
    might produce errors.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: Metrics Server启动后，可能需要几分钟才能使其可用。如果还没有准备好状态，则请求指标可能会产生错误。
- en: Once the Metrics Server has started, the Kubernetes dashboard will display the
    CPU and memory usage statistics, as shown in [Figure 2-3](#dashboard_nodes).
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Metrics Server启动，Kubernetes仪表板将显示CPU和内存使用统计信息，如 [Figure 2-3](#dashboard_nodes)
    所示。
- en: '![Snapshot of the dashboard nodes view](assets/kcb2_0203.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![仪表板节点视图快照](assets/kcb2_0203.png)'
- en: Figure 2-3\. Dashboard cluster nodes view
  id: totrans-130
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: Figure 2-3\. 仪表板集群节点视图
- en: Discussion
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: 'The node and pod metrics can also be viewed in the command line using the `kubectl
    top` command:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `kubectl top` 命令也可以在命令行中查看节点和Pod的指标：
- en: '[PRE31]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Similarly, to view the node metrics, do this:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，要查看节点指标，请执行以下操作：
- en: '[PRE32]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: See Also
  id: totrans-136
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '[Kubernetes Metrics Server GitHub repository](https://oreil.ly/C_O6W)'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Kubernetes Metrics Server GitHub仓库](https://oreil.ly/C_O6W)'
- en: '[Resource metrics pipeline documentation](https://oreil.ly/ODZCr)'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[资源指标流水线文档](https://oreil.ly/ODZCr)'
- en: 2.8 Downloading a Kubernetes Release from GitHub
  id: totrans-139
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.8 从GitHub下载Kubernetes版本
- en: Problem
  id: totrans-140
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You want to download an official Kubernetes release instead of compiling from
    source.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 你想要下载官方发布的Kubernetes版本，而不是从源代码编译。
- en: Solution
  id: totrans-142
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: The Kubernetes project publishes an archive for every release. The link to the
    archive can be found in the CHANGELOG file of the particular release. Go to the
    *CHANGELOG* folder of the [project page](https://oreil.ly/MMwRs) and open the
    CHANGELOG file for the release of your choice. Within the file you will find a
    link to download the *kubernetes.tar.gz* file of that release.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: Kubernetes项目为每个版本发布一个归档。你可以在特定版本的CHANGELOG文件中找到归档的链接。转到项目页面的 *CHANGELOG* 文件夹，并打开你选择的版本的CHANGELOG文件。在文件中，你会找到一个链接，用于下载该版本的
    *kubernetes.tar.gz* 文件。
- en: For example, if you want to download the v1.28.0 release, go ahead and open
    *CHANGELOG-1.28.md*, and in the section titled “Downloads for v1.28.0” you will
    find the link to *kubernetes.tar.gz* (*[*https://dl.k8s.io/v1.28.0/kubernetes.tar.gz*](https://dl.k8s.io/v1.28.0/kubernetes.tar.gz)*).
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你想要下载v1.28.0版本，可以打开 *CHANGELOG-1.28.md*，在标题为“Downloads for v1.28.0”的部分中，你将找到下载
    *kubernetes.tar.gz* 的链接（[*https://dl.k8s.io/v1.28.0/kubernetes.tar.gz*](https://dl.k8s.io/v1.28.0/kubernetes.tar.gz)）。
- en: '[PRE33]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: If you want to compile Kubernetes from source, see [Recipe 15.1](ch15.html#compiling_source).
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想从源代码编译Kubernetes，请参见[Recipe 15.1](ch15.html#compiling_source)。
- en: Discussion
  id: totrans-147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: 'The CHANGELOG file also lists the `sha512 hash` of the *kubernetes.tar.gz*
    archive. It is recommended that you verify the integrity of the *kubernetes.tar.gz*
    archive to ensure that it has not been tampered with in any way. To do this, generate
    the `sha512` hash of the downloaded archive locally and compare it with that of
    the one listed in the CHANGELOG:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: CHANGELOG文件还列出了 *kubernetes.tar.gz* 归档的 `sha512哈希值`。建议你验证本地下载的 *kubernetes.tar.gz*
    归档的完整性，以确保其未被任何方式篡改。为此，请生成本地下载归档的 `sha512` 哈希值，并与CHANGELOG中列出的哈希值进行比较：
- en: '[PRE34]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 2.9 Downloading Client and Server Binaries
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.9 下载客户端和服务器二进制文件
- en: Problem
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have downloaded a release archive (see [Recipe 2.8](#release_download)),
    but it does not contain the actual binaries.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经下载了一个发布归档（参见[Recipe 2.8](#release_download)），但它不包含实际的二进制文件。
- en: Solution
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'The release archive does not contain the release binaries (for the purpose
    of keeping the release archive small). Thus, you need to download the binaries
    separately. To do so, run the *get-kube-binaries.sh* script, as shown here:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 发布归档不包含发布二进制文件（为了保持发布归档的小巧性）。因此，你需要单独下载二进制文件。为此，请运行 *get-kube-binaries.sh* 脚本，如下所示：
- en: '[PRE35]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Once complete, you will have the client binaries in *client/bin*:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 完成后，你将在 *client/bin* 中获得客户端二进制文件：
- en: '[PRE36]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'and an archive containing the server binaries in *server/kubernetes*:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 并且包含服务器二进制文件的归档位于 *server/kubernetes* 文件夹中：
- en: '[PRE37]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Discussion
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: If you want to skip downloading the entire release archive and quickly download
    the client and server binaries, you can get them directly from [Download Kubernetes](https://oreil.ly/tdN0P).
    On this page you will find direct links to binaries for various operating system
    and architecture combinations, as shown in [Figure 2-4](#download-k8s-com).
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想跳过下载整个发布存档并快速下载客户端和服务器二进制文件，您可以直接从[下载Kubernetes](https://oreil.ly/tdN0P)获取它们。在此页面上，您将找到各种操作系统和架构组合的二进制文件的直接链接，如
    [Figure 2-4](#download-k8s-com) 所示。
- en: '![Screenshot of the downloadkubernetes.com, listing binaries of the k8s v1.28.0
    release for the darwin operating system](assets/kcb2_0204.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![下载kubernetes.com的屏幕截图，列出了适用于Darwin操作系统的k8s v1.28.0版本的二进制文件](assets/kcb2_0204.png)'
- en: Figure 2-4\. downloadkubernetes.com, listing binaries of the Kubernetes v1.28.0
    release for the Darwin operating system
  id: totrans-163
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图2-4\. downloadkubernetes.com，列出了适用于Darwin操作系统的Kubernetes v1.28.0版本的二进制文件
- en: 2.10 Using systemd Unit Files for Running Kubernetes Components
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.10 使用systemd单元文件运行Kubernetes组件
- en: Problem
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have used Minikube (see [Recipe 1.2](ch01.html#minikube_install)) for learning
    and know how to bootstrap a Kubernetes cluster using `kubeadm` (see [Recipe 2.2](#kube_control_plane)),
    but you want to install a cluster from scratch.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经使用了Minikube（参见 [Recipe 1.2](ch01.html#minikube_install)）进行学习，并且知道如何使用`kubeadm`引导一个Kubernetes集群（参见
    [Recipe 2.2](#kube_control_plane)），但你想要从头开始安装一个集群。
- en: Solution
  id: totrans-167
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: To do so, you need to run the Kubernetes components using systemd unit files.
    You are looking only for basic examples to run the `kubelet` via `systemd`.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 为此，您需要使用systemd单元文件运行Kubernetes组件。您只寻找通过systemd运行`kubelet`的基本示例。
- en: Inspecting how `kubeadm` configures the Kubernetes daemons to launch using systemd
    unit files helps you understand how to do it on your own. If you look closely
    at the `kubeadm` configuration, you will see that the `kubelet` is running on
    every node in your cluster, including the control-plane node.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 检查`kubeadm`如何通过systemd单元文件配置Kubernetes守护进程的启动方式，可以帮助你理解如何自行操作。如果你仔细查看`kubeadm`的配置，你会发现`kubelet`在集群中的每个节点上（包括控制平面节点）都在运行。
- en: 'Here is an example, which you can reproduce by logging in to any node of a
    cluster built with `kubeadm` (see [Recipe 2.2](#kube_control_plane)):'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个示例，您可以通过登录到任何使用`kubeadm`构建的集群节点（参见 [Recipe 2.2](#kube_control_plane)）来复制：
- en: '[PRE38]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: This gives you a link to the systemd unit file in */lib/systemd/system/kubelet.service*
    and its configuration in */etc/systemd/system/kubelet.service.d/10-kubeadm.conf*.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 这为你提供了systemd单元文件在 */lib/systemd/system/kubelet.service* 中的链接以及在 */etc/systemd/system/kubelet.service.d/10-kubeadm.conf*
    中的配置。
- en: 'The unit file is straightforward—​it points to the `kubelet` binary installed
    in */usr/bin*:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 单元文件很简单——它指向了 */usr/bin* 中安装的 `kubelet` 二进制文件：
- en: '[PRE39]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The configuration file tells you how the `kubelet` binary is started:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件告诉您如何启动`kubelet`二进制文件：
- en: '[PRE40]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: All the options specified, such as `--kubeconfig`, defined by the environment
    variable `$KUBELET_CONFIG_ARGS`, are start-up [options](https://oreil.ly/quccc)
    of the `kubelet` binary.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 所有指定的选项，如`--kubeconfig`，由环境变量`$KUBELET_CONFIG_ARGS`定义，都是`kubelet`二进制文件的启动选项。
- en: Discussion
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: '[systemd](https://oreil.ly/RmuZp) is a system and services manager, sometimes
    referred to as an *init system*. It is now the default services manager on Ubuntu
    and CentOS.'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '[systemd](https://oreil.ly/RmuZp) 是一个系统和服务管理器，有时被称为*初始化系统*。现在已成为Ubuntu和CentOS上的默认服务管理器。'
- en: The unit file just shown deals only with the `kubelet`. You can write your own
    unit files for all the other components of a Kubernetes cluster (i.e., API server,
    controller manager, scheduler, proxy). [Kubernetes the Hard Way](https://oreil.ly/AWnxD)
    has examples of unit files for each component.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 刚才展示的单元文件仅处理`kubelet`。您可以为Kubernetes集群的所有其他组件（即API服务器、控制器管理器、调度器、代理）编写自己的单元文件。[Kubernetes
    the Hard Way](https://oreil.ly/AWnxD) 提供了每个组件的单元文件示例。
- en: However, you only need to run the `kubelet`. Indeed, note that the configuration
    option `--pod-manifest-path` allows you to pass a directory where the `kubelet`
    will look for manifests that it will automatically start. With `kubeadm`, this
    directory is used to pass the manifests of the API server, scheduler, etcd, and
    controller manager. Hence, Kubernetes manages itself, and the only thing managed
    by systemd is the `kubelet` process.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，你只需要运行`kubelet`。确实，注意到配置选项 `--pod-manifest-path` 允许你传递一个目录，kubelet 将在其中查找并自动启动manifests。使用
    `kubeadm`，这个目录用于传递API服务器、调度器、etcd和控制器管理器的manifests。因此，Kubernetes自行管理，并且systemd仅管理`kubelet`进程。
- en: 'To illustrate this, you can list the contents of the */etc/kubernetes/manifests*
    directory in your `kubeadm`-based cluster:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这一点，您可以列出基于 `kubeadm` 的集群中 */etc/kubernetes/manifests* 目录的内容：
- en: '[PRE41]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Looking at the details of the *etcd.yaml* manifest, you can see that it is
    a `Pod` with a single container that runs etcd:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 查看 *etcd.yaml* 清单的详细信息，您可以看到它是一个运行 etcd 的单容器 `Pod`：
- en: '[PRE42]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '[PRE43]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: See Also
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '[`kubelet` configuration options](https://oreil.ly/E95yp)'
  id: totrans-188
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[`kubelet` 配置选项](https://oreil.ly/E95yp)'
- en: 2.11 Creating a Kubernetes Cluster on Google Kubernetes Engine
  id: totrans-189
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.11 在 Google Kubernetes Engine 上创建 Kubernetes 集群
- en: Problem
  id: totrans-190
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You want to create a Kubernetes cluster on Google Kubernetes Engine (GKE).
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 您想在 Google Kubernetes Engine (GKE) 上创建一个 Kubernetes 集群。
- en: Solution
  id: totrans-192
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'To use GKE, you first need a few things:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 GKE，您首先需要几件事：
- en: A [Google Cloud Platform (GCP)](https://oreil.ly/CAiDf) account with billing
    enabled
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个启用了结算的[Google 云平台 (GCP)](https://oreil.ly/CAiDf) 账户
- en: A GCP project with [GKE](https://oreil.ly/eGX2n) enabled
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个启用了[GKE](https://oreil.ly/eGX2n) 的 GCP 项目
- en: '[Google Cloud SDK](https://oreil.ly/Y00rC) installed'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了[Google Cloud SDK](https://oreil.ly/Y00rC)
- en: 'The Google Cloud SDK contains the `gcloud` CLI tool for interacting with GCP
    services from the command line. After the SDK has been installed, authenticate
    `gcloud` to access your GCP project:'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: Google Cloud SDK 包含用于从命令行与 GCP 服务交互的 `gcloud` CLI 工具。安装 SDK 后，使用身份验证 `gcloud`
    访问您的 GCP 项目：
- en: '[PRE44]'
  id: totrans-198
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Using the `gcloud` command-line interface, create a Kubernetes cluster with
    the `container clusters create` command, like so:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `gcloud` 命令行界面，使用 `container clusters create` 命令创建 Kubernetes 集群，如下所示：
- en: '[PRE45]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: By default this will create a Kubernetes cluster with three worker nodes in
    the zone or region specified. The master node is being managed by the GKE service
    and cannot be accessed.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，这将在指定的区域或区域中创建一个具有三个工作节点的 Kubernetes 集群。主节点由 GKE 服务管理，无法访问。
- en: Tip
  id: totrans-202
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: If you’re unsure what [zone or region](https://oreil.ly/4Bvua) to use for the
    `--zone` or `--region` argument, execute `gcloud compute zones list` or `gcloud
    compute regions list` and pick one near you. Zones are typically less resource
    hungry than regions.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不确定用于 `--zone` 或 `--region` 参数的[区域或地区](https://oreil.ly/4Bvua)，执行 `gcloud
    compute zones list` 或 `gcloud compute regions list` 并选择附近的一个。通常，区域比地区需要的资源更少。
- en: 'Once you are done using your cluster, do not forget to delete it to avoid being
    charged:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 使用完集群后，请不要忘记将其删除以避免收费：
- en: '[PRE46]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Discussion
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: You can skip the `gcloud` CLI installation by using the [Google Cloud Shell](https://oreil.ly/E-Qcr),
    a pure online browser-based solution.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过使用[Google Cloud Shell](https://oreil.ly/E-Qcr)，一个纯在线基于浏览器的解决方案，跳过 `gcloud`
    CLI 的安装。
- en: 'You can list your existing GKE clusters using this command:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此命令列出您现有的 GKE 集群：
- en: '[PRE47]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: Note
  id: totrans-210
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: 'The `gcloud` CLI allows you to resize your cluster, update it, and upgrade
    it:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '`gcloud` CLI 允许您调整、更新和升级您的集群：'
- en: '[PRE48]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: See Also
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: GKE [quickstart](https://oreil.ly/WMDSx)
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GKE [快速入门](https://oreil.ly/WMDSx)
- en: Google Cloud Shell [quickstart](https://oreil.ly/_w0va)
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google Cloud Shell [快速入门](https://oreil.ly/_w0va)
- en: 2.12 Creating a Kubernetes Cluster on Azure Kubernetes Service
  id: totrans-216
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.12 在 Azure Kubernetes 服务上创建 Kubernetes 集群
- en: Problem
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You want to create a Kubernetes cluster on Azure Kubernetes Service (AKS).
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 您想在 Azure Kubernetes Service (AKS) 上创建一个 Kubernetes 集群。
- en: Solution
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'To create an AKS cluster, you will need the following:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建 AKS 集群，您需要以下内容：
- en: A [Microsoft Azure portal account](https://oreil.ly/PyUA0)
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个[Microsoft Azure 门户账户](https://oreil.ly/PyUA0)
- en: '[Azure CLI](https://oreil.ly/An7xM) installed'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装了[Azure CLI](https://oreil.ly/An7xM)
- en: 'First, make sure that you have Azure CLI version 2.0 or higher installed and
    then log in to Azure:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 首先确保安装了 Azure CLI 版本 2.0 或更高，并登录到 Azure：
- en: '[PRE49]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Create an Azure resource group named `k8s` to hold all your AKS resources,
    such as VMs and networking components, and to make it easy to clean up and tear
    down later:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 创建名为 `k8s` 的 Azure 资源组，以容纳所有您的 AKS 资源，如 VM 和网络组件，并且便于稍后进行清理和拆除：
- en: '[PRE50]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Tip
  id: totrans-227
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: If you’re unsure what [region](https://oreil.ly/fdGdc) to use for the `--location`
    argument, execute `az account list-locations` and pick one near you.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不确定用于 `--location` 参数的[区域](https://oreil.ly/fdGdc)，执行 `az account list-locations`
    并选择附近的一个。
- en: 'Now that you have the resource group `k8s` set up, you can create the cluster
    with one worker node (*agent* in Azure terminology), like so:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您已设置了资源组 `k8s`，可以像这样创建具有一个工作节点（在 Azure 术语中称为 *agent*）的集群：
- en: '[PRE51]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Note that the `az aks create` command might take several minutes to complete.
    Once completed, the command returns a JSON object with information about the created
    cluster.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，`az aks create` 命令可能需要几分钟才能完成。完成后，该命令将返回一个包含有关已创建集群信息的 JSON 对象。
- en: As a result, in the Azure portal you should see something like [Figure 2-5](#azure-portal).
    Start by finding the `k8s` resource group and then navigate your way to the Deployments
    tab.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在 Azure 门户中，您应该看到类似于 [Figure 2-5](#azure-portal) 的东西。首先找到 `k8s` 资源组，然后导航到部署选项卡。
- en: '![Screen shot of the Azure Portal, showing an AKS cluster in the k8s resource
    group](assets/kcb2_0205.png)'
  id: totrans-233
  prefs: []
  type: TYPE_IMG
  zh: '![Azure 门户的屏幕截图，显示位于 `k8s` 资源组中的 AKS 集群](assets/kcb2_0205.png)'
- en: Figure 2-5\. Azure portal, showing an AKS cluster in the k8s resource group
  id: totrans-234
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 2-5\. Azure 门户，显示位于 `k8s` 资源组中的 AKS 集群
- en: 'You’re now in a position to connect to the cluster:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以连接到集群：
- en: '[PRE52]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'You can now poke around in the environment and verify the setup:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以在环境中四处查看并验证设置：
- en: '[PRE53]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: Indeed, as you can see from the output, we have created a single-node cluster.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，正如您从输出中所见，我们已经创建了一个单节点集群。
- en: Tip
  id: totrans-240
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: If you don’t want to or cannot install the Azure CLI, an alternative is to use
    the [Azure Cloud Shell](https://oreil.ly/IUFJQ) from your browser.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不想或无法安装 Azure CLI，则可以使用来自浏览器的 [Azure Cloud Shell](https://oreil.ly/IUFJQ)
    作为替代方案。
- en: 'When you’re done discovering AKS, don’t forget to shut down the cluster and
    remove all the resources by deleting the resource group `k8s`:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 当你完成发现 AKS 后，请不要忘记通过删除资源组 `k8s` 来关闭集群并删除所有资源：
- en: '[PRE54]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Although the `az group delete` command returns immediately, due to the presence
    of the `--no-wait` flag, it can take up to 10 minutes for all the resources to
    be removed and the resource group to actually be destroyed. You might want to
    check in the Azure portal to make sure everything went according to plan.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 `az group delete` 命令立即返回，由于存在 `--no-wait` 标志，但可能需要长达 10 分钟才能删除所有资源并实际销毁资源组。您可能需要在
    Azure 门户中检查以确保一切按计划进行。
- en: See Also
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '[“Quickstart: Deploy an Azure Kubernetes Service cluster using Azure CLI”](https://oreil.ly/YXv3B)
    in the Microsoft Azure documentation'
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在 Microsoft Azure 文档中的 [“快速入门：使用 Azure CLI 部署 Azure Kubernetes Service 集群”](https://oreil.ly/YXv3B)
- en: 2.13 Creating a Kubernetes Cluster on Amazon Elastic Kubernetes Service
  id: totrans-247
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.13 在 Amazon Elastic Kubernetes Service 上创建 Kubernetes 集群
- en: Problem
  id: totrans-248
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You want to create a Kubernetes cluster on Amazon Elastic Kubernetes Service
    (EKS).
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 您想要在 Amazon Elastic Kubernetes Service (EKS) 上创建一个 Kubernetes 集群。
- en: Solution
  id: totrans-250
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'To create a cluster in Amazon EKS, you need the following:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Amazon EKS 中创建集群，您需要以下内容：
- en: An [Amazon Web Services](https://aws.amazon.com) account
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 [Amazon Web Services](https://aws.amazon.com) 帐户
- en: '[AWS CLI](https://aws.amazon.com/cli) installed'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[AWS CLI](https://aws.amazon.com/cli) 已安装'
- en: '[eksctl](https://eksctl.io) CLI tool installed'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[eksctl](https://eksctl.io) 已安装的 CLI 工具'
- en: 'After you’ve installed the AWS CLI, [authenticate the client](https://oreil.ly/_6VMv)
    to access your AWS account:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 AWS CLI 后，请[验证客户端身份](https://oreil.ly/_6VMv)以访问您的 AWS 帐户：
- en: '[PRE55]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'The eksctl tool is the official CLI for Amazon EKS. It uses the AWS credentials
    you’ve configured to authenticate with AWS. Using eksctl, create the cluster:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: eksctl 工具是 Amazon EKS 的官方 CLI。它使用您配置的 AWS 凭据来验证 AWS。使用 eksctl，创建集群：
- en: '[PRE56]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: By default, eksctl creates a cluster with two worker nodes in the specified
    region. You can adjust this paramater by specifying the `--nodes` flag.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，eksctl 在指定区域创建一个具有两个工作节点的集群。您可以通过指定 `--nodes` 标志来调整此参数。
- en: Tip
  id: totrans-260
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 提示
- en: For the lowest latency, choose the [AWS region](https://oreil.ly/Kc9GZ) that’s
    nearest to you.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 为了获得最低的延迟，请选择距离您最近的 [AWS 区域](https://oreil.ly/Kc9GZ)。
- en: 'When you no longer need the EKS cluster, delete it to avoid being charged for
    unused resources:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 当您不再需要 EKS 集群时，请将其删除以避免为未使用的资源收费：
- en: '[PRE57]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: See Also
  id: totrans-264
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: eksctl [Introduction](https://eksctl.io/getting-started)
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: eksctl [介绍](https://eksctl.io/getting-started)
- en: '[Amazon Elastic Kubernetes Service](https://aws.amazon.com/eks)'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Amazon Elastic Kubernetes Service](https://aws.amazon.com/eks)'
