<html><head></head><body><section data-pdf-bookmark="Chapter 3. Deploying Linkerd" data-type="chapter" epub:type="chapter" class="preface"><div class="preface" id="LUAR_deploying_linkerd">
<h1 class="calibre7"><span class="calibre">Chapter 3. </span>Deploying Linkerd</h1>


<p class="author1">Now that you understand what Linkerd is and a bit about how it works, it’s time to dig into deploying Linkerd in your environment. We’re going to dive into the whats, whys, and hows of installing Linkerd in this chapter. <a data-primary="deploying Linkerd" data-secondary="getting started guide URL" data-type="indexterm" id="id610" class="calibre4"/><a data-primary="resources online" data-secondary="Linkerd documentation" data-tertiary="getting started guide" data-type="indexterm" id="id611" class="calibre4"/><a data-primary="Linkerd" data-secondary="documentation URL" data-tertiary="getting started guide" data-type="indexterm" id="id612" class="calibre4"/><a data-primary="documentation for Linkerd online" data-secondary="getting started guide" data-type="indexterm" id="id613" class="calibre4"/><a data-primary="Linkerd" data-secondary="deploying" data-see="deploying Linkerd" data-type="indexterm" id="id614" class="calibre4"/>You can also check out the official Linkerd docs to review the <a href="https://oreil.ly/Pyiwx" class="calibre4">getting started guide</a>.</p>






<section data-pdf-bookmark="Considerations" data-type="sect1" class="preface"><div class="preface" id="id124">
<h1 class="calibre8">Considerations</h1>

<p class="author1">Installing Linkerd can often be quick, easy, and painless.<a data-primary="deploying Linkerd" data-secondary="considerations" data-type="indexterm" id="id615" class="calibre4"/> Unfortunately, some
of that ease of use can mask real pitfalls that you’ll want to avoid. We’ll
dive more into the specifics when we get to the install section—for now,
suffice it to say that <a data-primary="deploying Linkerd" data-secondary="considerations" data-tertiary="TLS certificate generation and storage" data-type="indexterm" id="id616" class="calibre4"/><a data-primary="TLS (Transport Layer Security)" data-secondary="X.509 certificates" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id617" class="calibre4"/><a data-primary="private keys" data-secondary="Linkerd deployment planning" data-type="indexterm" id="id618" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="TLS" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id619" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="deployment of Linkerd" data-tertiary="planning" data-type="indexterm" id="id620" class="calibre4"/><a data-primary="certificates" data-secondary="deployment of Linkerd" data-tertiary="planning" data-type="indexterm" id="id621" class="calibre4"/><a data-primary="certificates" data-secondary="TLS" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id622" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="considerations" data-tertiary="protocol discovery for non-HTTP ports" data-type="indexterm" id="id623" class="calibre4"/><a data-primary="installation of Linkerd" data-see="deploying Linkerd" data-type="indexterm" id="id624" class="calibre4"/><a data-primary="authentication" data-secondary="X.509 certificates" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id625" class="calibre4"/>when you install Linkerd in your actual non-demo
environments, you’ll want to be sure to plan for generating and storing the
TLS certificates we briefly described in <a data-type="xref" href="ch02.html#LUAR_intro_to_linkerd" class="calibre4">Chapter 2</a>. You’ll
also want to be sure you have a good understanding of all non-HTTP ports being
used by your applications, so that you can configure <em class="hyperlink">protocol discovery</em>
correctly for them (this is covered in more detail in
<a data-type="xref" href="ch04.html#LUAR_meshing_workloads" class="calibre4">Chapter 4</a>).</p>








<section data-pdf-bookmark="Linkerd Versioning" data-type="sect2" class="preface"><div class="preface" id="id22">
<h2 class="calibre27">Linkerd Versioning</h2>

<p class="author1">We mentioned in <a data-type="xref" href="ch02.html#LUAR_intro_to_linkerd" class="calibre4">Chapter 2</a> that<a data-primary="Linkerd2 as Linkerd" data-secondary="Linkerd versioning system" data-type="indexterm" id="id626" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="considerations" data-tertiary="Linkerd versioning system" data-type="indexterm" id="id627" class="calibre4"/><a data-primary="Linkerd" data-secondary="versioning system" data-type="indexterm" id="id628" class="calibre4"/><a data-primary="versioning system for Linkerd" data-type="indexterm" id="id629" class="calibre4"/><a data-primary="Linkerd" data-secondary="documentation URL" data-tertiary="versioning system" data-type="indexterm" id="id630" class="calibre4"/><a data-primary="documentation for Linkerd online" data-secondary="versioning system" data-type="indexterm" id="id631" class="calibre4"/><a data-primary="resources online" data-secondary="Linkerd documentation" data-tertiary="versioning system" data-type="indexterm" id="id632" class="calibre4"/><a data-primary="resources online" data-secondary="semantic versioning documentation" data-type="indexterm" id="id633" class="calibre4"/> this book is focused exclusively on Linkerd2, the second major version of Linkerd, which is effectively a rewrite of the project. In recognition of that, Linkerd uses a versioning system that looks like <a href="https://semver.org" class="calibre4">semantic versioning</a> but is, in fact, distinct. Linkerd has two major release channels: <em class="hyperlink">stable</em> and <em class="hyperlink">edge</em>. You can read more about this versioning scheme and release model in the <a href="https://oreil.ly/7igL_" class="calibre4">official Linkerd documentation</a>.</p>










<section data-pdf-bookmark="Stable" data-type="sect3" class="preface"><div class="preface" id="id23">
<h3 class="calibre33">Stable</h3>

<p class="author1">The stable channel is used for vendor releases, such as Buoyant Enterprise for Linkerd (from, unsurprisingly, Buoyant). This channel uses a modified semantic versioning scheme:<a data-primary="Linkerd" data-secondary="versioning system" data-tertiary="stable" data-type="indexterm" id="id634" class="calibre4"/><a data-primary="stable release channel" data-type="indexterm" id="id635" class="calibre4"/><a data-primary="versioning system for Linkerd" data-secondary="stable" data-type="indexterm" id="id636" class="calibre4"/></p>

<pre data-code-language="text" data-type="programlisting" class="calibre36"><code class="calibre9">stable-2.</code><em class="calibre37"><code class="calibre15">&lt;major&gt;</code></em><code class="calibre9">.</code><em class="calibre37"><code class="calibre15">&lt;minor&gt;</code></em><code class="calibre9">.</code><em class="calibre37"><code class="calibre15">&lt;patch&gt;</code></em></pre>

<p class="author1">This means that when you see, for example, “Linkerd 2.12.3,” the major version is 12 and the minor version is 3. This release has no patch number.</p>

<p class="author1">The rules of semantic versioning<a data-primary="semantic versioning" data-type="indexterm" id="id637" class="calibre4"/> are that a change to the major version means that Linkerd has introduced breaking changes or significant new capabilities, while a change to only the minor version indicates that the new release is fully backward compatible with the previous version and includes improvements or bug fixes. Patch releases are rare and indicate a security fix has been issued for a given minor version.</p>
</div></section>










<section data-pdf-bookmark="Edge" data-type="sect3" class="preface"><div class="preface" id="id24">
<h3 class="calibre33">Edge</h3>

<p class="author1">The edge release channel is where you’ll find releases of pure open source Linkerd, built from the latest changes to Linkerd available when they’re released.<a data-primary="edge release channel" data-type="indexterm" id="id638" class="calibre4"/><a data-primary="Linkerd" data-secondary="versioning system" data-tertiary="edge" data-type="indexterm" id="id639" class="calibre4"/><a data-primary="versioning system for Linkerd" data-secondary="edge" data-type="indexterm" id="id640" class="calibre4"/> Edge releases are generally provided on a weekly basis with the following versioning scheme:</p>

<pre data-code-language="text" data-type="programlisting" class="calibre36"><code class="calibre9">edge-</code><em class="calibre37"><code class="calibre15">&lt;two digit year&gt;</code></em><code class="calibre9">.</code><em class="calibre37"><code class="calibre15">&lt;month&gt;</code></em><code class="calibre9">.</code><em class="calibre37"><code class="calibre15">&lt;number within the month&gt;</code></em></pre>

<p class="author1">For example, <code class="calibre9">edge-24.1.1</code> would be the first edge release of the first month of the year 2024.</p>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Edge Releases Do Not Use Semantic Versioning</h1>
<p class="author1">It’s probably obvious that the edge release channel does <em class="hyperlink">not</em> use semantic versioning, but it’s worth reiterating that point. It’s extremely important that you read the release notes for any edge release you install, and that you provide feedback to the Linkerd team about your experiences.</p>
</div>
</div></section>
</div></section>








<section data-pdf-bookmark="Workloads, Pods, and Services" data-type="sect2" class="preface"><div class="preface" id="id125">
<h2 class="calibre27">Workloads, Pods, and Services</h2>

<p class="author1">Linkerd is a service mesh <a data-primary="Kubernetes" data-secondary="Linkerd exclusive support for" data-tertiary="workloads, Pods, and services" data-type="indexterm" id="id641" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="considerations" data-tertiary="workloads, Pods, and services" data-type="indexterm" id="id642" class="calibre4"/><a data-primary="workloads" data-secondary="deploying Linkerd" data-type="indexterm" id="id643" class="calibre4"/><a data-primary="Pods" data-secondary="deploying Linkerd" data-type="indexterm" id="id644" class="calibre4"/><a data-primary="services" data-secondary="deployment consideration" data-type="indexterm" id="id645" class="calibre4"/><a data-primary="Linkerd" data-secondary="Kubernetes exclusively" data-tertiary="workloads, Pods, and services" data-type="indexterm" id="id646" class="calibre4"/>that is designed around Kubernetes. This means that,
unlike many other service mesh options, you can use Linkerd without ever
interacting with any of its custom resource definitions. Linkerd uses
Kubernetes constructs like workloads, Pods, and services to manage the
majority of its routing and configuration options—so if you have something
that runs in Kubernetes today, you can add Linkerd to it and it should behave
the same, just with the benefits of Linkerd added to it. (See <a data-type="xref" href="#kubernetes-app-with-and-without-linkerd" class="calibre4">Figure 3-1</a>.) There are some
exceptions to this that we’ll detail in <a data-type="xref" href="ch04.html#LUAR_meshing_workloads" class="calibre4">Chapter 4</a>.</p>

<figure class="calibre23"><div class="figure" id="kubernetes-app-with-and-without-linkerd">
<img alt="luar 0301" src="assets/luar_0301.png" class="calibre24"/>
<h6 class="calibre25"><span class="calibre">Figure 3-1. </span>Adding Linkerd should never break your application</h6>
</div></figure>
</div></section>








<section data-pdf-bookmark="TLS certificates" data-type="sect2" class="preface"><div class="preface" id="id25">
<h2 class="calibre27">TLS certificates</h2>

<p class="author1">As we mentioned in <a data-type="xref" href="ch02.html#LUAR_intro_to_linkerd" class="calibre4">Chapter 2</a>, Linkerd <a data-primary="TLS (Transport Layer Security)" data-secondary="X.509 certificates" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id647" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="deployment of Linkerd" data-tertiary="planning" data-type="indexterm" id="id648" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="TLS" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id649" class="calibre4"/><a data-primary="authentication" data-secondary="X.509 certificates" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id650" class="calibre4"/><a data-primary="certificates" data-secondary="deployment of Linkerd" data-tertiary="planning" data-type="indexterm" id="id651" class="calibre4"/><a data-primary="certificates" data-secondary="TLS" data-tertiary="Linkerd deployment planning" data-type="indexterm" id="id652" class="calibre4"/><a data-primary="private keys" data-secondary="Linkerd deployment planning" data-type="indexterm" id="id653" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="considerations" data-tertiary="TLS certificate generation and storage" data-type="indexterm" id="id654" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="TLS certificates" data-type="indexterm" id="id655" class="calibre4"/><a data-primary="certificates" data-secondary="Linkerd and" data-tertiary="certificates that are required" data-type="indexterm" id="id656" class="calibre4"/><a data-primary="private keys" data-secondary="certificates" data-tertiary="required by Linkerd" data-type="indexterm" id="id657" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="Linkerd and" data-tertiary="certificates that are required" data-type="indexterm" id="id658" class="calibre4"/><a data-primary="trust anchor certificate" data-type="indexterm" id="id659" class="calibre4"/><a data-primary="identity controller of control plane" data-secondary="identity issuer certificate" data-type="indexterm" id="id660" class="calibre4"/><a data-primary="identity issuer certificate" data-type="indexterm" id="id661" class="calibre4"/><a data-primary="workload certificates" data-type="indexterm" id="id662" class="calibre4"/><a data-primary="workloads" data-secondary="deploying Linkerd" data-tertiary="workload certificates" data-type="indexterm" id="id663" class="calibre4"/><a data-primary="certificates" data-secondary="Linkerd and" data-tertiary="workload certificates" data-type="indexterm" id="id664" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="Linkerd and" data-tertiary="workload certificates" data-type="indexterm" id="id665" class="calibre4"/>relies on TLS
certificates in a particular hierarchy to provide identity within the mesh.
Specifically, Linkerd requires a single <em class="hyperlink">trust anchor</em> certificate, which
signs an <em class="hyperlink">identity issuer</em> certificate, which signs <em class="hyperlink">workload certificates</em>
(one per workload in the mesh). This is shown in <a data-type="xref" href="#linkerd-trust-diagram-1" class="calibre4">Figure 3-2</a>.</p>

<figure class="calibre23"><div class="figure" id="linkerd-trust-diagram-1">
<img alt="luar 0302" src="assets/luar_0302.png" class="calibre24"/>
<h6 class="calibre25"><span class="calibre">Figure 3-2. </span>The Linkerd trust hierarchy</h6>
</div></figure>

<p class="author1">Linkerd manages workload certificates for you, but you’ll need to work with a
certifying authority to manage the trust anchor and identity issuer
certificates. In this chapter, we’ll describe how this works with CLI
and Helm installs.</p>
</div></section>








<section data-pdf-bookmark="Linkerd Viz" data-type="sect2" class="preface"><div class="preface" id="id313">
<h2 class="calibre27">Linkerd Viz</h2>

<p class="author1">We mentioned Linkerd Viz briefly in <a data-type="xref" href="ch02.html#LUAR_intro_to_linkerd" class="calibre4">Chapter 2</a>: it’s Linkerd’s open source dashboard component, providing an easy-to-use metrics collection and presentation system for Linkerd. It can collect useful metrics about all meshed workloads and present them in a simple web UI. The dashboard can provide the following details about your Linkerd environment:</p>

<ul class="printings">
<li class="calibre6">
<p class="author1">Detailed application metrics, broken down by:</p>

<ul class="printings">
<li class="calibre6">
<p class="author1">Namespace</p>
</li>
<li class="calibre6">
<p class="author1">Workload</p>
</li>
<li class="calibre6">
<p class="author1">Pod</p>
</li>
<li class="calibre6">
<p class="author1">Service</p>
</li>
</ul>
</li>
<li class="calibre6">
<p class="author1">Information about connections between your workloads, including:</p>

<ul class="printings">
<li class="calibre6">
<p class="author1">TLS status</p>
</li>
<li class="calibre6">
<p class="author1">Meshed status</p>
</li>
<li class="calibre6">
<p class="author1">Workload identity</p>
</li>
<li class="calibre6">
<p class="author1">Paths and headers in use (via Viz Tap)</p>
</li>
<li class="calibre6">
<p class="author1">Metrics breakdowns on a path-by-path basis</p>
</li>
</ul>
</li>
</ul>

<p class="author1">We’ll discuss using Linkerd Viz in more detail in <a data-type="xref" href="ch10.html#LUAR_observability" class="calibre4">Chapter 10</a>, and we’ll discuss production concerns for Linkerd Viz in <a data-type="xref" href="ch14.html#LUAR_production_ready" class="calibre4">Chapter 14</a>.</p>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">The Linkerd Viz Dashboard Is Unauthenticated</h1>
<p class="author1">As discussed in <a data-type="xref" href="ch02.html#LUAR_intro_to_linkerd" class="calibre4">Chapter 2</a>, the Linkerd Viz dashboard doesn’t do user authentication. It’s up to you to be careful about how you make it available to users.</p>
</div>

<p class="author1">Linkerd Viz is considered part of the Linkerd core, but it must be installed separately since some Linkerd installations completely replace Viz with custom-built systems. In general, we strongly recommend installing Viz unless you have a strong reason not to. In the following instructions, we will include installing Viz.</p>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Always Use Your Own Prometheus</h1>
<p class="author1">By default, installing Linkerd Viz will install an internal Prometheus
instance. <em class="hyperlink">Do not use this Prometheus in production</em>, as it does not have
persistent storage configured; instead, see the <a href="https://oreil.ly/hI6eF" class="calibre4">Linkerd documentation</a> and <a data-type="xref" href="ch10.html#EX12-production-prometheus" class="calibre4">Example 10-9</a> for information about using an external Prometheus instance.</p>
</div>
</div></section>
</div></section>






<section data-pdf-bookmark="Deploying Linkerd" data-type="sect1" class="preface"><div class="preface" id="id26">
<h1 class="calibre8">Deploying Linkerd</h1>

<p class="author1">To deploy Linkerd, you’ll need<a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="about Kubernetes cluster needed" data-type="indexterm" id="id666" class="calibre4"/><a data-primary="Kubernetes" data-secondary="k3s cluster for Linkerd deployment" data-type="indexterm" id="id667" class="calibre4"/><a data-primary="k3s cluster for Linkerd deployment" data-type="indexterm" id="id668" class="calibre4"/><a data-primary="Kubernetes" data-secondary="k3s cluster for Linkerd deployment" data-tertiary="k3d tool" data-type="indexterm" id="id669" class="calibre4"/><a data-primary="k3s cluster for Linkerd deployment" data-secondary="k3d tool" data-type="indexterm" id="id670" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="about tools needed" data-type="indexterm" id="id671" class="calibre4"/> to have a Kubernetes cluster available. This guide will use a <a href="https://k3s.io" class="calibre4">k3s</a> cluster deployed locally using the <a href="https://k3d.io" class="calibre4">k3d</a> tool. If you’re already comfortable installing and deploying Linkerd, feel free to skip ahead to <a data-type="xref" href="ch04.html#LUAR_meshing_workloads" class="calibre4">Chapter 4</a>.</p>








<section data-pdf-bookmark="Required Tools" data-type="sect2" class="preface"><div class="preface" id="id27">
<h2 class="calibre27">Required Tools</h2>

<p class="author1">For the rest of this book, we’re going to assume you have the following tools available:<a data-primary="kubectl" data-secondary="Linkerd deployment" data-type="indexterm" id="id672" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-type="indexterm" id="id673" class="calibre4"/><a data-primary="Linkerd CLI" data-secondary="deployment tool" data-type="indexterm" id="id674" class="calibre4"/><a data-primary="step CLI deployment tool" data-type="indexterm" id="id675" class="calibre4"/><a data-primary="Smallstep CLI to generate certificates" data-secondary="step as deployment tool" data-type="indexterm" id="id676" class="calibre4"/></p>

<ul class="printings">
<li class="calibre6">
<p class="author1"><a href="https://oreil.ly/WPcEB" class="calibre4"><code class="calibre9">kubectl</code></a></p>
</li>
<li class="calibre6">
<p class="author1"><a href="https://oreil.ly/HMIQw" class="calibre4">Helm</a></p>
</li>
<li class="calibre6">
<p class="author1">The <a href="https://oreil.ly/OjxD2" class="calibre4"><code class="calibre9">linkerd</code> CLI</a></p>
</li>
<li class="calibre6">
<p class="author1"><a href="https://k3d.io" class="calibre4">k3d</a></p>
</li>
<li class="calibre6">
<p class="author1">The <a href="https://oreil.ly/Y40gA" class="calibre4"><code class="calibre9">step</code> CLI</a></p>
</li>
</ul>
</div></section>








<section data-pdf-bookmark="Provisioning a Kubernetes Cluster" data-type="sect2" class="preface"><div class="preface" id="id202">
<h2 class="calibre27">Provisioning a Kubernetes Cluster</h2>

<p class="author1">Start by creating a k3d cluster:<a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="provisioning a Kubernetes cluster" data-type="indexterm" id="id677" class="calibre4"/><a data-primary="k3s cluster for Linkerd deployment" data-secondary="k3d tool" data-tertiary="provisioning a Kubernetes cluster" data-type="indexterm" id="id678" class="calibre4"/><a data-primary="Kubernetes" data-secondary="k3s cluster for Linkerd deployment" data-tertiary="provisioning a Kubernetes cluster" data-type="indexterm" id="id679" class="calibre4"/></p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>k3d<code class="w"> </code>cluster<code class="w"> </code>create<code class="w"> </code>linkerd<code class="w"/></pre>

<p class="author1">k3d will provision your Kubernetes cluster and update your <code class="calibre9">KUBECONFIG</code>. You can test your connection to your new cluster by running:<a data-primary="kubectl" data-secondary="Linkerd deployment" data-tertiary="testing connection to new cluster" data-type="indexterm" id="id680" class="calibre4"/></p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>kubectl<code class="w"> </code>get<code class="w"> </code>nodes<code class="w"/></pre>

<p class="author1">You should also validate that the cluster is configured correctly and that you have the appropriate permissions for the install by running a preinstall check via the Linkerd CLI:<a data-primary="linkerd" data-secondary="check command" data-tertiary="--pre preinstall check" data-type="indexterm" id="id681" class="calibre4"/><a data-primary="Linkerd CLI" data-secondary="deployment tool" data-tertiary="preinstall check" data-type="indexterm" id="id682" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="linkerd check command" data-tertiary="--pre for preinstall check" data-type="indexterm" id="id683" class="calibre4"/></p>

<pre class="calibre36" data-code-language="bash" data-type="programlisting">$<code class="w"> </code>linkerd<code class="w"> </code>check<code class="w"> </code>--pre<code class="w"/></pre>
</div></section>








<section class="preface" data-pdf-bookmark="Installing Linkerd via the CLI" data-type="sect2"><div class="preface" id="id126">
<h2 class="calibre27">Installing Linkerd via the CLI</h2>

<p class="author1">The Linkerd CLI makes it easy<a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="installing Linkerd via CLI" data-type="indexterm" id="id684" class="calibre4"/><a data-primary="Linkerd CLI" data-secondary="deployment tool" data-tertiary="installing Linkerd via CLI" data-type="indexterm" id="id685" class="calibre4"/><a data-primary="linkerd" data-secondary="install command" data-type="indexterm" id="id686" class="calibre4"/> to get started with a Linkerd install. It will generate the Kubernetes manifests required to install Linkerd and allow you to easily apply them to your cluster.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre38"><div class="sidebar" id="id687">
<h1 class="calibre39">The linkerd install Command and Certificates</h1>
<p class="author1">When you install Linkerd from the CLI,<a data-primary="certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in CLI install" data-type="indexterm" id="id688" class="calibre4"/><a data-primary="rotating the keys" data-secondary="Linkerd install from CLI" data-type="indexterm" id="id689" class="calibre4"/><a data-primary="keypairs of public and private keys" data-secondary="rotating the keys" data-tertiary="Linkerd install from CLI" data-type="indexterm" id="id690" class="calibre4"/><a data-primary="trust anchor certificate" data-secondary="Linkerd install from CLI" data-type="indexterm" id="id691" class="calibre4"/><a data-primary="private keys" data-secondary="rotating the keys" data-tertiary="Linkerd install from CLI" data-type="indexterm" id="id692" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in CLI install" data-type="indexterm" id="id693" class="calibre4"/><a data-primary="identity issuer certificate" data-secondary="Linkerd install from CLI" data-type="indexterm" id="id694" class="calibre4"/><a data-primary="private keys" data-secondary="certificates" data-tertiary="specifying in CLI install" data-type="indexterm" id="id695" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="certificates in CLI install" data-type="indexterm" id="id696" class="calibre4"/> you have the option of specifying
certificates for it to use. If you don’t, it will silently create certificates
for you, as shown in <a data-type="xref" href="#trust-hierarchy-with-linkerd-install" class="calibre4">Figure 3-3</a>. This makes
Linkerd very easy to deploy, but it causes some operational headaches when the
time comes to rotate certificates, <em class="hyperlink">because <code class="calibre15">linkerd install</code> does not save
the trust anchor’s private key—anywhere</em>. We’ll talk about this in more
detail in <a data-type="xref" href="ch07.html#LUAR_mtls_and_certs" class="calibre4">Chapter 7</a>.</p>

<figure class="calibre23"><div class="figure" id="trust-hierarchy-with-linkerd-install">
<img alt="luar 0303" src="assets/luar_0303.png" class="calibre24"/>
<h6 class="calibre25"><span class="calibre">Figure 3-3. </span>The trust hierarchy created with the <code class="calibre9">linkerd install</code> command</h6>
</div></figure>
</div></aside>

<p class="author1">Run the following commands to install Linkerd via the CLI:<a data-primary="CRDs (custom resource definitions)" data-secondary="installing Linkerd CRDs" data-type="indexterm" id="id697" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="installing Linkerd CRDs" data-type="indexterm" id="id698" class="calibre4"/></p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>linkerd<code class="w"> </code>install<code class="w"> </code>--crds<code class="w"> </code><code class="p">|</code><code class="w"> </code>kubectl<code class="w"> </code>apply<code class="w"> </code>-f<code class="w"> </code>-<code class="w"/></pre>

<p class="author1">This will install the Linkerd CRDs in your cluster. As of Linkerd 2.12, installing Linkerd’s CRDs is done using a separate chart and requires its own command when running an install. <a data-primary="control plane of Linkerd" data-secondary="Linkerd install from CLI" data-type="indexterm" id="id699" class="calibre4"/>Following the CRD install, you’ll need to continue the installation by installing the core Linkerd control plane:</p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>linkerd<code class="w"> </code>install<code class="w"> </code><code class="p">|</code><code class="w"> </code>kubectl<code class="w"> </code>apply<code class="w"> </code>-f<code class="w"> </code>-<code class="w"/></pre>

<p class="author1">With this complete, the Linkerd control plane will begin setting itself up in your cluster. You’ll soon have access to all the tools you need to run a minimal Linkerd service mesh. You can confirm the install has completed successfully by running:<a data-primary="linkerd" data-secondary="check command" data-tertiary="installation check" data-type="indexterm" id="id700" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="linkerd check command" data-tertiary="installation check" data-type="indexterm" id="id701" class="calibre4"/></p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>linkerd<code class="w"> </code>check<code class="w"/></pre>
<div class="calibre18" data-type="warning" epub:type="warning"><h1 class="calibre35">Production Clusters Need Production Certificates</h1>
<p class="author1">Again, if you don’t explicitly say otherwise,<a data-primary="production" data-secondary="certificates from linkerd install" data-type="indexterm" id="id702" class="calibre4"/> <code class="calibre9">linkerd install</code> will silently
create certificates for you. This is OK for a demo, but <em class="hyperlink">not</em> for production.</p>
</div>

<p class="author1">After installing the core Linkerd control plane, you can install Linkerd Viz:</p>

<pre data-type="programlisting" class="calibre36">$ linkerd viz install | kubectl apply -f -</pre>

<p class="author1">As with Linkerd itself, this will start the install and then immediately return. To wait for it to finish and confirm that installation was successful, run:</p>

<pre data-type="programlisting" class="calibre36">$ linkerd check</pre>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Always Use Your Own Prometheus</h1>
<p class="author1">By default, installing Linkerd Viz will install an internal Prometheus
instance. <em class="hyperlink">Do not use this Prometheus in production</em>, as it does not have
persistent storage configured; instead, see the <a href="https://oreil.ly/hI6eF" class="calibre4">Linkerd documentation</a> and <a data-type="xref" href="ch10.html#EX12-production-prometheus" class="calibre4">Example 10-9</a> for information about using an external Prometheus instance.</p>
</div>
</div></section>








<section class="preface" data-pdf-bookmark="Installing Linkerd via Helm" data-type="sect2"><div class="preface" id="id127">
<h2 class="calibre27">Installing Linkerd via Helm</h2>

<p class="author1">The folks at Buoyant, the makers<a data-primary="Buoyant, Inc." data-secondary="Helm for Linkerd in production" data-type="indexterm" id="id703" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="Helm for Linkerd in production" data-type="indexterm" id="id704" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="installing Linkerd via Helm" data-type="indexterm" id="ch03-helm" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="installing Linkerd via Helm" data-type="indexterm" id="ch03-helm2" class="calibre4"/><a data-primary="Linkerd" data-secondary="documentation URL" data-tertiary="production runbook guide" data-type="indexterm" id="id705" class="calibre4"/><a data-primary="documentation for Linkerd online" data-secondary="production runbook guide" data-type="indexterm" id="id706" class="calibre4"/><a data-primary="resources online" data-secondary="Linkerd documentation" data-tertiary="production runbook guide" data-type="indexterm" id="id707" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="installing Linkerd via Helm" data-tertiary="about" data-type="indexterm" id="id708" class="calibre4"/> of Linkerd, recommend in their
<a href="https://oreil.ly/ZjDzr" class="calibre4">production runbook guide</a> that you
use Helm to install and manage Linkerd in production. Helm provides a well
tested, documented, and supported path for installing and upgrading Linkerd
(and in fact, the Linkerd CLI actually uses Helm templates under the hood to
generate its Kubernetes manifests).</p>

<p class="author1">Using the Helm-based install also requires you to think more about certificate
management up front, which simplifies the process of renewing your
certificates later. We’ll cover certificates in (much) more detail in
<a data-type="xref" href="ch07.html#LUAR_mtls_and_certs" class="calibre4">Chapter 7</a>; for now, let’s walk through a simple Helm
installation with manually generated certificates.</p>










<section data-pdf-bookmark="Generate Linkerd certificates" data-type="sect3" class="preface"><div class="preface" id="id28">
<h3 class="calibre33">Generate Linkerd certificates</h3>

<p class="author1">The simplest way to install Linkerd<a data-primary="Helm for Linkerd deployment" data-secondary="installing Linkerd via Helm" data-tertiary="generating Linkerd certificates" data-type="indexterm" id="id709" class="calibre4"/><a data-primary="certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in Helm install" data-type="indexterm" id="id710" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in Helm install" data-type="indexterm" id="id711" class="calibre4"/><a data-primary="trust anchor certificate" data-secondary="Linkerd install via Helm" data-type="indexterm" id="id712" class="calibre4"/><a data-primary="identity issuer certificate" data-secondary="Linkerd install via Helm" data-type="indexterm" id="id713" class="calibre4"/><a data-primary="Smallstep CLI to generate certificates" data-type="indexterm" id="id714" class="calibre4"/><a data-primary="step CLI deployment tool" data-secondary="generating certificates" data-type="indexterm" id="id715" class="calibre4"/><a data-primary="private keys" data-secondary="certificates" data-tertiary="specifying in Helm install" data-type="indexterm" id="id716" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="certificates for Helm install" data-type="indexterm" id="id717" class="calibre4"/> with Helm is to manually generate the two certificates that every Linkerd installation requires: the trust anchor and the identity issuer. We’ll use the Smallstep CLI, <code class="calibre9">step</code>, to do this, as illustrated in <a data-type="xref" href="#EX1" class="calibre4">Example 3-1</a>.</p>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Certificates and Security</h1>
<p class="author1">We’re generating certificates here without giving any real thought to how to
safely manage the private keys. This is OK for a demo, but <em class="hyperlink">not</em> for
production use. We’ll get into this more in <a data-type="xref" href="ch07.html#LUAR_mtls_and_certs" class="calibre4">Chapter 7</a>.</p>
</div>
<div data-type="example" id="EX1" class="calibre40">
<h5 class="calibre41"><span class="calibre">Example 3-1. </span>Creating certificates for Linkerd</h5>

<pre data-code-language="bash" data-type="programlisting" class="calibre42"><code class="c"># Start by creating your root certificate, which Linkerd refers to</code>
<code class="c"># as the trust anchor certificate.</code>
$<code class="w"> </code>step<code class="w"> </code>certificate<code class="w"> </code>create<code class="w"> </code>root.linkerd.cluster.local<code class="w"> </code>ca.crt<code class="w"> </code>ca.key<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--profile<code class="w"> </code>root-ca<code class="w"> </code>--no-password<code class="w"> </code>--insecure<code class="w"/>

<code class="c"># Next, create the intermediary certificate. Linkerd refers to this</code>
<code class="c"># as the identity issuer certificate.</code>
$<code class="w"> </code>step<code class="w"> </code>certificate<code class="w"> </code>create<code class="w"> </code>identity.linkerd.cluster.local<code class="w"> </code>issuer.crt<code class="w"> </code>issuer.key<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--profile<code class="w"> </code>intermediate-ca<code class="w"> </code>--not-after<code class="w"> </code>8760h<code class="w"> </code>--no-password<code class="w"> </code>--insecure<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--ca<code class="w"> </code>ca.crt<code class="w"> </code>--ca-key<code class="w"> </code>ca.key<code class="w"/></pre></div>

<p class="author1">After running these commands, you’ll have the trust hierarchy shown in
<a data-type="xref" href="#trust-hierarchy-step-before-install" class="calibre4">Figure 3-4</a>. Your laptop will be holding both the
public and private keys for the trust anchor and the identity issuer, and the
identity issuer’s cert will be signed by the trust anchor. (There aren’t any
workload certs yet: Linkerd will create those when it’s installed in
the cluster.)</p>

<figure class="calibre23"><div class="figure" id="trust-hierarchy-step-before-install">
<img alt="luar 0304" src="assets/luar_0304.png" class="calibre24"/>
<h6 class="calibre25"><span class="calibre">Figure 3-4. </span>The trust hierarchy created with the <code class="calibre9">step</code> command</h6>
</div></figure>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Keep the Keys!</h1>
<p class="author1">Remember, in the real world,<a data-primary="private keys" data-secondary="important to keep safe" data-type="indexterm" id="id718" class="calibre4"/> it’s <em class="hyperlink">very important</em> to keep the private key
safe. Even for our more academic use here, keep it around—you’ll want it
when we talk about certificate rotation in <a data-type="xref" href="ch07.html#LUAR_mtls_and_certs" class="calibre4">Chapter 7</a>.</p>
</div>

<p class="author1">The Linkerd docs cover <a data-primary="Linkerd" data-secondary="documentation URL" data-tertiary="creating certificates" data-type="indexterm" id="id719" class="calibre4"/><a data-primary="documentation for Linkerd online" data-secondary="creating certificates" data-type="indexterm" id="id720" class="calibre4"/><a data-primary="resources online" data-secondary="Linkerd documentation" data-tertiary="creating certificates" data-type="indexterm" id="id721" class="calibre4"/>creating certificates in
<a href="https://oreil.ly/BPO3F" class="calibre4">some detail</a>. Please refer
to the latest version of the docs if you run into any difficulty.</p>
</div></section>










<section data-pdf-bookmark="Helm install" data-type="sect3" class="preface"><div class="preface" id="id29">
<h3 class="calibre33">Helm install</h3>

<p class="author1">After generating certificates,<a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="helm install command" data-type="indexterm" id="id722" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="installing Linkerd via Helm" data-tertiary="helm install command" data-type="indexterm" id="id723" class="calibre4"/> you can install Linkerd with Helm using the commands in <a data-type="xref" href="#EX2" class="calibre4">Example 3-2</a>. Once
again, the official docs have the most up-to-date instructions; however,
it’s very important to understand what the <code class="calibre9">--set-file</code> arguments shown in
<a data-type="xref" href="#EX2" class="calibre4">Example 3-2</a> do:<a data-primary="CRDs (custom resource definitions)" data-secondary="installing Linkerd CRDs" data-tertiary="Helm install of Linkerd" data-type="indexterm" id="id724" class="calibre4"/></p>

<ul class="printings">
<li class="calibre6">
<p class="author1"><code class="calibre9">--set-file identityTrustAnchorsPEM</code> tells Helm the file from which to copy
the trust anchor’s public key. This is the only key we need for the trust
anchor.</p>
</li>
<li class="calibre6">
<p class="author1"><code class="calibre9">--set-file identity.issuers.tls.crtPEM</code> and <code class="calibre9">--set-file
identity.issu⁠ers.tls.keyPEM</code> tell Helm the files from which to copy the
identity issuer’s public and private keys, respectively. Both are required.</p>
</li>
</ul>
<div data-type="example" id="EX2" class="calibre40">
<h5 class="calibre41"><span class="calibre">Example 3-2. </span>Installing Linkerd with Helm</h5>

<pre data-code-language="bash" data-type="programlisting" class="calibre42"><code class="c"># Add the Linkerd stable repo</code>
$<code class="w"> </code>helm<code class="w"> </code>repo<code class="w"> </code>add<code class="w"> </code>linkerd<code class="w"> </code>https://helm.linkerd.io/stable<code class="w"/>

<code class="c"># Update your Helm repositories</code>
$<code class="w"> </code>helm<code class="w"> </code>repo<code class="w"> </code>update<code class="w"/>

<code class="c"># Install the Linkerd CRDs</code>
$<code class="w"> </code>helm<code class="w"> </code>install<code class="w"> </code>linkerd-crds<code class="w"> </code>linkerd/linkerd-crds<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>-n<code class="w"> </code>linkerd<code class="w"> </code>--create-namespace<code class="w"/>

<code class="c"># Install the Linkerd control plane</code>
$<code class="w"> </code>helm<code class="w"> </code>install<code class="w"> </code>linkerd-control-plane<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>-n<code class="w"> </code>linkerd<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--set-file<code class="w"> </code><code class="nv">identityTrustAnchorsPEM</code><code class="o">=</code>ca.crt<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--set-file<code class="w"> </code>identity.issuer.tls.crtPEM<code class="o">=</code>issuer.crt<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>--set-file<code class="w"> </code>identity.issuer.tls.keyPEM<code class="o">=</code>issuer.key<code class="w"> </code><code class="se">\</code>
<code class="w">  </code>linkerd/linkerd-control-plane<code class="w"/>

<code class="c"># Ensure your install was successful</code>
$<code class="w"> </code>linkerd<code class="w"> </code>check<code class="w"/></pre></div>

<p class="author1">The <code class="calibre9">linkerd check</code> command <a data-primary="linkerd" data-secondary="check command" data-tertiary="installation check" data-type="indexterm" id="id725" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="linkerd check command" data-tertiary="installation check" data-type="indexterm" id="id726" class="calibre4"/>will let you know the current state of Linkerd in your cluster. It’s useful for ensuring your install completed successfully.</p>

<p class="author1">Once <code class="calibre9">helm install</code> completes,<a data-primary="deploying Linkerd" data-secondary="deploying on Kubernetes" data-tertiary="certificates for Helm install" data-type="indexterm" id="id727" class="calibre4"/><a data-primary="certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in Helm install" data-type="indexterm" id="id728" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="installing Linkerd via Helm" data-tertiary="generating Linkerd certificates" data-type="indexterm" id="id729" class="calibre4"/><a data-primary="private keys" data-secondary="certificates" data-tertiary="specifying in Helm install" data-type="indexterm" id="id730" class="calibre4"/><a data-primary="trust anchor certificate" data-secondary="Linkerd install via Helm" data-type="indexterm" id="id731" class="calibre4"/><a data-primary="X.509 certificates" data-secondary="deployment of Linkerd" data-tertiary="specifying in Helm install" data-type="indexterm" id="id732" class="calibre4"/><a data-primary="identity issuer certificate" data-secondary="Linkerd install via Helm" data-type="indexterm" id="id733" class="calibre4"/> the cluster will have copies of the keys
Linkerd needs to run, as shown in <a data-type="xref" href="#trust-hierarchy-step-after-install" class="calibre4">Figure 3-5</a>. <a data-primary="private keys" data-secondary="important to keep safe" data-type="indexterm" id="id734" class="calibre4"/>The
keys will, of course, still be present on your laptop, so be careful with
them!</p>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Permissions Matter!</h1>
<p class="author1">Note that the trust anchor’s private key is <em class="hyperlink">not</em> present in the cluster, but the identity issuer’s private key <em class="hyperlink">is</em> present in the cluster. This is required for Linkerd to work.<a data-primary="permissions" data-secondary="identity issuer private key in cluster" data-type="indexterm" id="id735" class="calibre4"/><a data-primary="private keys" data-secondary="important to keep safe" data-tertiary="identity issuer private key in cluster" data-type="indexterm" id="id736" class="calibre4"/><a data-primary="security" data-secondary="Transport Layer Security" data-tertiary="identity issuer private key in cluster" data-type="indexterm" id="id737" class="calibre4"/> In the real world, you’ll want to make sure that Linkerd itself is the only thing that can see that key. This is covered in more detail in
<a data-type="xref" href="ch07.html#LUAR_mtls_and_certs" class="calibre4">Chapter 7</a>.<a data-startref="ch03-helm" data-type="indexterm" id="id738" class="calibre4"/><a data-startref="ch03-helm2" data-type="indexterm" id="id739" class="calibre4"/></p>
</div>

<figure class="calibre23"><div class="figure" id="trust-hierarchy-step-after-install">
<img alt="luar 0305" src="assets/luar_0305.png" class="calibre24"/>
<h6 class="calibre25"><span class="calibre">Figure 3-5. </span>The trust hierarchy created after <code class="calibre9">helm install</code></h6>
</div></figure>

<p class="author1">Finally, we can install Linkerd Viz using its Helm chart:</p>

<pre data-type="programlisting" class="calibre36">$ helm install linkerd-viz linkerd/linkerd-viz \
-n linkerd-viz --create-namespace</pre>

<p class="author1">As before, we’ll monitor the installation to make sure that it succeeds:</p>

<pre data-type="programlisting" class="calibre36">$ linkerd check</pre>
<div data-type="warning" epub:type="warning" class="calibre18"><h1 class="calibre35">Always Use Your Own Prometheus</h1>
<p class="author1">By default, installing Linkerd Viz will install an internal Prometheus
instance. <em class="hyperlink">Do not use this Prometheus in production</em>, as it does not have
persistent storage configured; instead, see the <a href="https://oreil.ly/hI6eF" class="calibre4">Linkerd documentation</a> and <a data-type="xref" href="ch10.html#EX12-production-prometheus" class="calibre4">Example 10-9</a> for information about using an external Prometheus instance.</p>
</div>
</div></section>
</div></section>
</div></section>






<section data-pdf-bookmark="Configuring Linkerd" data-type="sect1" class="preface"><div class="preface" id="id30">
<h1 class="calibre8">Configuring Linkerd</h1>

<p class="author1">Now that you’ve completed an<a data-primary="deploying Linkerd" data-secondary="configuration" data-type="indexterm" id="ch03-conf" class="calibre4"/><a data-primary="configuring Linkerd" data-type="indexterm" id="ch03-conf2" class="calibre4"/> install of Linkerd’s core control plane, we’re
going to pause and take a look at what options you have for configuring the
Linkerd control plane in your cluster. This is necessarily going to be a
summary of common configuration points for the control plane, not an
exhaustive list.</p>

<p class="author1">As of Linkerd 2.12, the control plane<a data-primary="configuring Linkerd" data-secondary="control plane" data-type="indexterm" id="ch03-cp" class="calibre4"/><a data-primary="deploying Linkerd" data-secondary="configuration" data-tertiary="control plane" data-type="indexterm" id="ch03-cp2" class="calibre4"/><a data-primary="control plane of Linkerd" data-secondary="configuration" data-type="indexterm" id="ch03-cp3" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="configuration of Linkerd" data-type="indexterm" id="ch03-cp4" class="calibre4"/> is managed and configured via the <code class="calibre9">linkerd-control-plane</code> Helm chart. The following settings provide important configuration points for Linkerd. The particular settings can be found by reviewing the current Helm chart values using the following command:</p>

<pre data-code-language="bash" data-type="programlisting" class="calibre36">$<code class="w"> </code>helm<code class="w"> </code>show<code class="w"> </code>values<code class="w"> </code>linkerd/linkerd-control-plane<code class="w"/></pre>

<p class="author1">We’ll talk about the general settings, and you’ll need to map them to the appropriate locations in your values file. See <a data-type="xref" href="ch14.html#LUAR_production_ready" class="calibre4">Chapter 14</a> for some examples of Linkerd Helm values files.</p>








<section data-pdf-bookmark="Cluster Networks" data-type="sect2" class="preface"><div class="preface" id="id203">
<h2 class="calibre27">Cluster Networks</h2>

<p class="author1">Linkerd doesn’t have a way<a data-primary="deploying Linkerd" data-secondary="configuration" data-tertiary="cluster networks" data-type="indexterm" id="id740" class="calibre4"/><a data-primary="configuring Linkerd" data-secondary="control plane" data-tertiary="cluster networks" data-type="indexterm" id="id741" class="calibre4"/><a data-primary="control plane of Linkerd" data-secondary="configuration" data-tertiary="cluster networks" data-type="indexterm" id="id742" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="configuration of Linkerd" data-tertiary="cluster networks" data-type="indexterm" id="id743" class="calibre4"/> to read your cluster network settings at install
time, so the <code class="calibre9">linkerd-control-plane</code> Helm chart assumes that your cluster is using
one of the common network ranges for its cluster network. If your
cluster’s IP addresses are not in one of the following ranges, you’ll need to
override the IP range at install time:</p>

<pre data-code-language="text" data-type="programlisting" class="calibre36">10.0.0.0/8, 100.64.0.0/10, 172.16.0.0/12, 192.168.0.0/16</pre>
</div></section>








<section data-pdf-bookmark="Linkerd Control Plane Resources" data-type="sect2" class="preface"><div class="preface" id="id204">
<h2 class="calibre27">Linkerd Control Plane Resources</h2>

<p class="author1">The default install of Linkerd doesn’t <a data-primary="deploying Linkerd" data-secondary="configuration" data-tertiary="control plane resources" data-type="indexterm" id="id744" class="calibre4"/><a data-primary="configuring Linkerd" data-secondary="control plane" data-tertiary="control plane resources" data-type="indexterm" id="id745" class="calibre4"/><a data-primary="control plane of Linkerd" data-secondary="configuration" data-tertiary="control plane resources" data-type="indexterm" id="id746" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="configuration of Linkerd" data-tertiary="control plane resources" data-type="indexterm" id="id747" class="calibre4"/>set resource requests or limits. You should consider setting requests and limits for your control plane components to aid in scheduling Pods and ensuring Linkerd has the resources it needs to function. Be cautious: as of Linkerd 2.12 the Linkerd destination component has a fairly fixed memory footprint that scales with the number of endpoints in your cluster. If the memory limit you set is too low, you may find yourself in a loop of destination components being “out of memory killed,” or OOMKilled.</p>
</div></section>








<section data-pdf-bookmark="Opaque and Skip Ports" data-type="sect2" class="preface"><div class="preface" id="id31">
<h2 class="calibre27">Opaque and Skip Ports</h2>

<p class="author1">Opaque ports and skip ports are <a data-primary="deploying Linkerd" data-secondary="configuration" data-tertiary="opaque and skip ports" data-type="indexterm" id="id748" class="calibre4"/><a data-primary="configuring Linkerd" data-secondary="control plane" data-tertiary="opaque and skip ports" data-type="indexterm" id="id749" class="calibre4"/><a data-primary="control plane of Linkerd" data-secondary="configuration" data-tertiary="opaque and skip ports" data-type="indexterm" id="id750" class="calibre4"/><a data-primary="ports" data-secondary="opaque and skip ports" data-tertiary="configuration" data-type="indexterm" id="id751" class="calibre4"/><a data-primary="Helm for Linkerd deployment" data-secondary="configuration of Linkerd" data-tertiary="opaque and skip ports" data-type="indexterm" id="id752" class="calibre4"/><a data-primary="opaque ports" data-secondary="configuration" data-type="indexterm" id="id753" class="calibre4"/><a data-primary="opaque ports" data-secondary="configuration" data-tertiary="documentation URL" data-type="indexterm" id="id754" class="calibre4"/><a data-primary="skip ports" data-secondary="configuration" data-type="indexterm" id="id755" class="calibre4"/><a data-primary="skip ports" data-secondary="configuration" data-tertiary="documentation URL" data-type="indexterm" id="id756" class="calibre4"/><a data-primary="Linkerd" data-secondary="documentation URL" data-tertiary="opaque and skip port configuration" data-type="indexterm" id="id757" class="calibre4"/><a data-primary="documentation for Linkerd online" data-secondary="opaque and skip port configuration" data-type="indexterm" id="id758" class="calibre4"/><a data-primary="ports" data-secondary="opaque and skip ports" data-tertiary="configuration documentation URL" data-type="indexterm" id="id759" class="calibre4"/><a data-primary="resources online" data-secondary="Linkerd documentation" data-tertiary="opaque and skip port configuration" data-type="indexterm" id="id760" class="calibre4"/>Linkerd names for ports to which special rules are applied. You’ll want to review the
<a href="https://oreil.ly/_H929" class="calibre4">relevant Linkerd docs</a> for
the most up-to-date information on the topic. We’ll give a brief overview of
the concepts here; you’ll find many more details in
<a data-type="xref" href="ch04.html#LUAR_meshing_workloads" class="calibre4">Chapter 4</a>.</p>

<p class="author1">An <em class="hyperlink">opaque</em> port in Linkerd is a port that should be treated as a generic TCP
connection. Linkerd will still use mTLS on opaque traffic, but it will <em class="hyperlink">not</em>
perform protocol detection or any kind of protocol-specific logic, so the end
result will be similar to the way simple, connection-oriented network load
balancing works. A port should be marked as opaque at install time if you know
it will be part of the mesh and serving non-HTTP TCP traffic.</p>

<p class="author1">Remember, there is <em class="hyperlink">no</em> protocol detection, and thus <em class="hyperlink">no</em> request metrics
or per-request load balancing, on opaque ports.</p>

<p class="author1">This section is dedicated to discussing global, install-time Linkerd configuration values. Any opaque port set at install time will be applied globally to all workloads.</p>
<div data-type="note" epub:type="note" id="default-opaque-ports" class="calibre16"><h1 class="calibre26">Default Opaque Ports</h1>
<p class="author1">The following ports are the defaults configured at install time:</p>

<ul class="calibre43">
<li class="calibre6">
<p class="author1">SMTP: 25 and 587</p>
</li>
<li class="calibre6">
<p class="author1">MySQL: 3306 and, when used with Galera, 4444. (Ports 4567 and 4568 might also be used by Galera, but they’re not opaque by default.)</p>
</li>
<li class="calibre6">
<p class="author1">PostgreSQL: 5432</p>
</li>
<li class="calibre6">
<p class="author1">Redis: 6379</p>
</li>
<li class="calibre6">
<p class="author1">Elasticsearch: 9300</p>
</li>
<li class="calibre6">
<p class="author1">Memcached: 11211</p>
</li>
</ul>
</div>

<p class="author1">By contrast, a <em class="hyperlink">skip</em> port is one that you instruct Linkerd to completely
ignore. Skipped traffic will completely bypass the proxy; the mesh will not
handle it at all. Notably, <em class="hyperlink">Linkerd cannot encrypt traffic over skip
ports.</em></p>

<p class="author1">Unlike opaque ports, you need to tell Linkerd whether skip ports refer to
inbound traffic, outbound traffic, or both.</p>
<div data-type="note" epub:type="note" class="calibre16"><h1 class="calibre26">Default Skip Ports</h1>
<p class="author1">Ports 4567 and 4568 (Galera) are ignored by default in a standard Linkerd install.<a data-startref="ch03-conf" data-type="indexterm" id="id761" class="calibre4"/><a data-startref="ch03-conf2" data-type="indexterm" id="id762" class="calibre4"/><a data-startref="ch03-cp" data-type="indexterm" id="id763" class="calibre4"/><a data-startref="ch03-cp2" data-type="indexterm" id="id764" class="calibre4"/><a data-startref="ch03-cp3" data-type="indexterm" id="id765" class="calibre4"/><a data-startref="ch03-cp4" data-type="indexterm" id="id766" class="calibre4"/></p>
</div>
</div></section>
</div></section>






<section data-pdf-bookmark="Summary" data-type="sect1" class="preface"><div class="preface" id="id314">
<h1 class="calibre8">Summary</h1>

<p class="author1">You should now have a good sense of how to install Linkerd as well as an understanding of the major configuration points in Linkerd. You should also have a good grasp of the potential points of friction with installing Linkerd: specifically, generating certificates and handling non-HTTP traffic. While you can use either the Linkerd CLI or the Linkerd Helm charts to install Linkerd, we recommend that you default to using Helm.</p>
</div></section>
</div></section></body></html>