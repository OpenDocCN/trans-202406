<html><head></head><body><section data-pdf-bookmark="Chapter 3. Installing Docker" data-type="chapter" epub:type="chapter"><div class="chapter" id="installing_docker">&#13;
<h1><span class="label">Chapter 3. </span>Installing Docker</h1>&#13;
&#13;
&#13;
<p>We’re now at the point where<a data-primary="installing Docker" data-secondary="about" data-type="indexterm" id="idm46803169259568"/><a data-primary="Docker" data-primary-sortas="docker-a" data-secondary="installation" data-see="installing Docker" data-type="indexterm" id="idm46803169258592"/><a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="about" data-type="indexterm" id="idm46803169257104"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="about" data-type="indexterm" id="idm46803169255888"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="about" data-type="indexterm" id="idm46803169254672"/> you hopefully understand roughly what Docker is and what it isn’t, and it’s time for some hands-on work. Let’s get Docker installed so we can work with it. The steps required to install Docker vary depending on the platform you use for development and the Linux distribution you use to host your applications in production.</p>&#13;
&#13;
<p>In this chapter, we discuss the steps required to get a fully working Docker development environment set up on most modern desktop operating systems. First, we’ll install the Docker client on your native development platform, and then we’ll get a Docker server running on Linux. Finally, we’ll test out the installation to make sure it works as expected.</p>&#13;
&#13;
<p>Although the Docker client can run on Windows and macOS to control a Docker server,<a data-primary="Linux containers" data-secondary="Linux required" data-type="indexterm" id="idm46803169252144"/><a data-primary="Windows running Docker" data-secondary="about" data-type="indexterm" id="idm46803169251168"/><a data-primary="macOS running Docker" data-secondary="about" data-type="indexterm" id="idm46803169250224"/><a data-primary="Linux" data-secondary="Docker requiring" data-type="indexterm" id="idm46803167844704"/> Linux containers can only be built and launched on a Linux system. Therefore, non-Linux systems will require a virtual machine or remote server to host the Linux-based Docker server. Docker Community Edition, Docker Desktop, and Vagrant, which are all discussed later in this chapter, provide some approaches to address this issue. It is also possible to run Windows containers natively on Windows systems, and we will specifically discuss this in <a data-type="xref" href="ch05.html#windows_containers">“Windows Containers”</a>, but most of the book’s focus will be on Linux containers.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The Docker ecosystem is changing very rapidly as the technology evolves to become more robust and solve a broader range of problems. Some features discussed in this book and elsewhere may become deprecated. <a data-primary="documentation" data-secondary="Docker" data-tertiary="deprecation" data-type="indexterm" id="idm46803167841776"/><a data-primary="resources online" data-secondary="Docker documentation" data-tertiary="deprecation" data-type="indexterm" id="idm46803167840528"/><a data-primary="Docker" data-primary-sortas="docker-a" data-secondary="documentation" data-tertiary="deprecation" data-type="indexterm" id="idm46803167839312"/>To see what has been tagged for deprecation and eventual removal, refer to the <a href="https://docs.docker.com/engine/deprecated">documentation</a>.</p>&#13;
</div>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>We assume that you are using<a data-primary="Unix traditional shell assumed" data-type="indexterm" id="idm46803167835712"/><a data-primary="PowerShell" data-secondary="command adjustments for" data-type="indexterm" id="idm46803167835040"/><a data-primary="shell assumed to be traditional Unix" data-type="indexterm" id="idm46803167834096"/> a traditional Unix shell in most of the code examples in the book. You can use PowerShell, but be aware that some commands will need adjusting to work in that environment.</p>&#13;
&#13;
<p>If you are in an environment that<a data-primary="proxy servers" data-type="indexterm" id="idm46803167832704"/> requires you to use a proxy, make sure that it is <a href="https://docs.docker.com/network/proxy">properly configured for Docker</a>.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Docker Client" data-type="sect1"><div class="sect1" id="docker_client">&#13;
<h1>Docker Client</h1>&#13;
&#13;
<p>The Docker client natively supports 64-bit versions of Linux, Windows, and macOS.<a data-primary="installing Docker" data-secondary="client" data-tertiary="about" data-type="indexterm" id="idm46803167828896"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="about" data-type="indexterm" id="idm46803167827648"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="ch03-lincli"/><a data-primary="installing Docker" data-secondary="client" data-tertiary="Linux" data-type="indexterm" id="ch03-lincli2"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Linux" data-type="indexterm" id="idm46803167823184"/></p>&#13;
&#13;
<p>The majority of popular Linux distributions<a data-primary="Debian distributions" data-type="indexterm" id="idm46803167821312"/><a data-primary="Red Hat" data-secondary="distributions" data-type="indexterm" id="idm46803167820224"/> can trace their origins to either Debian or Red Hat. <a data-primary="apt (Advanced Package Tool)" data-type="indexterm" id="idm46803167819088"/><a data-primary="Advanced Package Tool (apt)" data-type="indexterm" id="idm46803167818400"/><a data-primary="Red Hat" data-secondary="Package Manager" data-type="indexterm" id="idm46803167817712"/><a data-primary="Yellowdog Updater, Modified (yum)" data-type="indexterm" id="idm46803167816768"/><a data-primary="Dandified yum (dnf)" data-type="indexterm" id="idm46803167816080"/><a data-primary="dnf (Dandified yum)" data-type="indexterm" id="idm46803167815408"/><a data-primary="Alpine Package Keeper (apk)" data-type="indexterm" id="idm46803167814736"/>Debian systems utilize the deb package format and <a href="https://wiki.debian.org/AptCLI">Advanced Package Tool (<code>apt</code>)</a> to install most prepackaged software. <a data-primary="RPM Package Manager" data-type="indexterm" id="idm46803167812736"/>On the other hand, Red Hat systems rely on RPM Package Manager (<code>rpm</code>) files and <a href="https://en.wikipedia.org/wiki/Yum_(software)">Yellowdog Updater, Modified (<code>yum</code>)</a>, or <a href="https://goo.gl/TdkGRS">Dandified <code>yum</code> (<code>dnf</code>)</a> to install similar software packages. Alpine Linux, which is often used in environments that require a very small Linux footprint, relies on the <a href="https://wiki.alpinelinux.org/wiki/Package_management">Alpine Package Keeper (<code>apk</code>)</a> to manage software packages.</p>&#13;
&#13;
<p>On macOS and Microsoft Windows,<a data-primary="Homebrew for macOS" data-type="indexterm" id="idm46803167806816"/><a data-primary="Chocolatey for Windows" data-type="indexterm" id="idm46803167806112"/><a data-primary="Windows running Docker" data-secondary="Chocolatey" data-type="indexterm" id="idm46803167805440"/><a data-primary="macOS running Docker" data-secondary="Homebrew" data-type="indexterm" id="idm46803167804496"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="idm46803167803552"/><a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="idm46803167802336"/><a data-primary="installing Docker" data-secondary="client" data-tertiary="macOS" data-type="indexterm" id="idm46803167801120"/><a data-primary="installing Docker" data-secondary="client" data-tertiary="Windows" data-type="indexterm" id="idm46803167799904"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="macOS" data-type="indexterm" id="idm46803167798688"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Windows" data-type="indexterm" id="idm46803167797200"/> native GUI installers provide the easiest method to install and maintain prepackaged software. <a href="https://brew.sh">Homebrew for macOS</a>  and <a href="https://chocolatey.org">Chocolatey for Windows</a> are also very popular options among technical users.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>We will be discussing a few approaches to installing Docker in this section. Make sure that you pick the first one in this list that best matches your needs. Installing more than one may cause problems if you are not well versed in how to switch between them properly.</p>&#13;
&#13;
<p>Choose one of these: Docker Desktop, Docker Community Edition, OS package manager, or Vagrant.</p>&#13;
</div>&#13;
&#13;
<p>You can always find the most recent<a data-primary="Docker" data-primary-sortas="docker-a" data-secondary="documentation" data-tertiary="installation" data-type="indexterm" id="idm46803167792096"/><a data-primary="documentation" data-secondary="Docker" data-tertiary="installation" data-type="indexterm" id="idm46803167790576"/><a data-primary="resources online" data-secondary="Docker documentation" data-tertiary="installation" data-type="indexterm" id="idm46803167789360"/> <a href="https://docs.docker.com/get-docker">installation documentation </a> on the Docker website.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Linux" data-type="sect2"><div class="sect2" id="client_linux">&#13;
<h2>Linux</h2>&#13;
&#13;
<p>It is strongly recommended that you run Docker on a modern release of your preferred Linux distribution. It is possible to run Docker on some older releases, but stability may be a significant issue. <a data-primary="Linux" data-secondary="kernel" data-tertiary="version 3.8 or later" data-type="indexterm" id="idm46803167100032"/>Generally, a 3.8 or later kernel is required, and we advise you to use the newest stable version of your chosen distribution. The &#13;
<span class="keep-together">following directions</span> assume you are using a recent stable release of the Ubuntu or Fedora Linux distributions.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Although we are not covering it here,<a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="Docker Desktop for Linux" data-type="indexterm" id="idm46803167096688"/> <a href="https://docs.docker.com/desktop/linux/install">Docker Desktop for Linux</a> has been released and can be used on Linux if you would prefer running the Docker daemon on a local virtual machine instead of directly on your system.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Ubuntu Linux 22.04 (64-bit)" data-type="sect3"><div class="sect3" id="client_ubuntu">&#13;
<h3>Ubuntu Linux 22.04 (64-bit)</h3>&#13;
&#13;
<p>Let’s take a look at the steps<a data-primary="installing Docker" data-secondary="client" data-tertiary="Ubuntu Linux" data-type="indexterm" id="idm46803167092304"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="Ubuntu Linux" data-type="indexterm" id="idm46803167091056"/><a data-primary="Ubuntu Linux" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="idm46803167089840"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Ubuntu Linux" data-type="indexterm" id="idm46803167088624"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="Ubuntu installation" data-type="indexterm" id="idm46803167087136"/><a data-primary="Linux" data-secondary="distributions" data-see="Ubuntu Linux" data-tertiary="Ubuntu" data-type="indexterm" id="idm46803167085856"/> required to install Docker on the 64-bit version of Ubuntu Linux 22.04.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>For up-to-date instructions or coverage<a data-primary="Ubuntu Linux" data-secondary="installing Docker" data-tertiary="documentation" data-type="indexterm" id="idm46803167083264"/><a data-primary="documentation" data-secondary="Docker" data-tertiary="installation on Ubuntu Linux" data-type="indexterm" id="idm46803167082016"/><a data-primary="resources online" data-secondary="Docker documentation" data-tertiary="installation on Ubuntu Linux" data-type="indexterm" id="idm46803167080736"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="Ubuntu installation" data-tertiary="documentation" data-type="indexterm" id="idm46803167079504"/> of other versions of Ubuntu, see the <a href="https://dockr.ly/2NwNbuw">Docker Community Edition for Ubuntu</a>.</p>&#13;
</div>&#13;
&#13;
<p>These first two commands will ensure that you aren’t running older versions of Docker. The packages have been renamed a few times, so you’ll need to specify several possibilities here:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>remove<code class="w"> </code>docker<code class="w"> </code>docker.io<code class="w"> </code>containerd<code class="w"> </code>runc<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>remove<code class="w"> </code>docker-engine<code class="w"/></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>It is safe to ignore <code>apt-get</code> errors that say “Unable to locate package” or “Package is not installed.”</p>&#13;
</div>&#13;
&#13;
<p>Next, you will need to add the required software dependencies and <em>apt</em> repository for Docker Community Edition. This lets us fetch and install packages for Docker and validate that they are signed:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>update<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>install<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>ca-certificates<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>curl<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>gnupg<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>lsb-release<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>mkdir<code class="w"> </code>-p<code class="w"> </code>/etc/apt/keyrings<code class="w"/>&#13;
<code class="gp">$ </code>curl<code class="w"> </code>-fsSL<code class="w"> </code>https://download.docker.com/linux/ubuntu/gpg<code class="w"> </code><code class="p">|</code><code class="se">\</code>&#13;
<code class="w">    </code>sudo<code class="w"> </code>gpg<code class="w"> </code>--dearmor<code class="w"> </code>-o<code class="w"> </code>/etc/apt/keyrings/docker.gpg<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>chmod<code class="w"> </code>a+r<code class="w"> </code>/etc/apt/keyrings/docker.gpg<code class="w"/>&#13;
<code class="gp">$ </code><code class="nb">echo</code><code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code><code class="s2">"deb [arch=</code><code class="k">$(</code>dpkg<code class="w"> </code>--print-architecture<code class="k">)</code><code class="s2"> \</code>&#13;
<code class="s2">    signed-by=/etc/apt/keyrings/docker.gpg] \</code>&#13;
<code class="s2">    https://download.docker.com/linux/ubuntu \</code>&#13;
<code class="gp">    $</code><code class="s2">(lsb_release -cs) stable"</code><code class="w"> </code><code class="p">|</code><code class="se">\</code>&#13;
<code class="w">    </code>sudo<code class="w"> </code>tee<code class="w"> </code>/etc/apt/sources.list.d/docker.list<code class="w"> </code>&gt;<code class="w"> </code>/dev/null<code class="w"/></pre>&#13;
&#13;
<p>Now that you have the repository set up, run the following commands to install Docker:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>update<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>apt-get<code class="w"> </code>install<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-ce<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-ce-cli<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>containerd.io<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-compose-plugin<code class="w"/></pre>&#13;
&#13;
<p>Assuming you don’t get any error messages, you now have Docker installed!</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fedora Linux 36 (64-bit)" data-type="sect3"><div class="sect3" id="client_fedora">&#13;
<h3>Fedora Linux 36 (64-bit)</h3>&#13;
&#13;
<p>Now let’s take a look at the steps needed to install Docker on the 64-bit version of Fedora Linux 36.<a data-primary="installing Docker" data-secondary="client" data-tertiary="Fedora Linux" data-type="indexterm" id="idm46803157089632"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Fedora Linux" data-type="indexterm" id="idm46803157074768"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="idm46803157073440"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="Fedora installation" data-type="indexterm" id="idm46803157072352"/></p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>For up-to-date instructions or coverage<a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="Fedora installation" data-tertiary="documentation" data-type="indexterm" id="idm46803157070384"/><a data-primary="documentation" data-secondary="Docker" data-tertiary="installation on Fedora Linux" data-type="indexterm" id="idm46803157069056"/> of other versions of Fedora, see the <a href="https://dockr.ly/2NwNdTa">Docker Community Edition for Fedora</a>.</p>&#13;
</div>&#13;
&#13;
<p>This first command will ensure that you aren’t running older versions of Docker. As on Ubuntu systems, the package has been renamed a few times, so you’ll need to specify several possibilities here:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>dnf<code class="w"> </code>remove<code class="w"> </code>-y<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-client<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-client-latest<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-common<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-latest<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-latest-logrotate<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-logrotate<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-selinux<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-engine-selinux<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-engine<code class="w"/></pre>&#13;
&#13;
<p>Next, you will need to add the required software dependencies and <em>dnf</em> repository for Docker Community Edition:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>dnf<code class="w"> </code>-y<code class="w"> </code>install<code class="w"> </code>dnf-plugins-core<code class="w"/>&#13;
<code class="gp">$ </code>sudo<code class="w"> </code>dnf<code class="w"> </code>config-manager<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>--add-repo<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>https://download.docker.com/linux/fedora/docker-ce.repo<code class="w"/></pre>&#13;
&#13;
<p>Now you can install the current version of Docker Community Edition:<a data-startref="ch03-lincli" data-type="indexterm" id="idm46803156970736"/><a data-startref="ch03-lincli2" data-type="indexterm" id="idm46803156966640"/><a data-startref="ch03-lincli2" data-type="indexterm" id="idm46803156966032"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>dnf<code class="w"> </code>install<code class="w"> </code>-y<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-ce<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-ce-cli<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>containerd.io<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">    </code>docker-compose-plugin<code class="w"/></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="macOS, Mac OS X" data-type="sect2"><div class="sect2" id="client_osx">&#13;
<h2>macOS, Mac OS X</h2>&#13;
&#13;
<p>To install Docker on macOS, you should use the official Docker Desktop installer.<a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="idm46803156960720"/><a data-primary="installing Docker" data-secondary="client" data-tertiary="macOS" data-type="indexterm" id="idm46803156959472"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="macOS" data-type="indexterm" id="idm46803156958256"/></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GUI installer" data-type="sect3"><div class="sect3" id="idm46803156918832">&#13;
<h3>GUI installer</h3>&#13;
&#13;
<p>Download the <a href="https://dockr.ly/2wyTpCO">latest Docker Desktop for Mac installer</a>, and<a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="macOS" data-type="indexterm" id="idm46803156916624"/> then double-click on the downloaded program icon. Follow all of the installer’s prompts until the installation is finished. Docker Desktop for macOS relies<a data-primary="xhyve" data-type="indexterm" id="idm46803156915248"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="macOS" data-tertiary="xhyve" data-type="indexterm" id="idm46803156914576"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="macOS" data-tertiary="hypervisor framework" data-type="indexterm" id="idm46803156913088"/><a data-primary="Hypervisor framework (Apple)" data-secondary="Docker Desktop relying on" data-type="indexterm" id="idm46803156911600"/><a data-primary="Hypervisor framework (Apple)" data-secondary="documentation" data-type="indexterm" id="idm46803156910720"/><a data-primary="documentation" data-secondary="Hypervisor framework" data-type="indexterm" id="idm46803156909808"/><a data-primary="resources online" data-secondary="Hypervisor framework documentation" data-type="indexterm" id="idm46803156908864"/> on the <a href="https://github.com/machyve/xhyve">xhyve</a> project and Apple’s <a href="https://developer.apple.com/documentation/hypervisor">Hypervisor framework</a> to provide a native lightweight virtualization layer for the Linux server component, which is required to launch Linux virtual machines that can build Docker images and run containers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Homebrew installation" data-type="sect3"><div class="sect3" id="idm46803156906224">&#13;
<h3>Homebrew installation</h3>&#13;
&#13;
<p>You can also install the Docker CLI tools<a data-primary="Homebrew for macOS" data-type="indexterm" id="idm46803156904896"/> using the popular <a href="https://docs.brew.sh/Installation">Homebrew</a> package management system for macOS. If you take this approach, you should consider installing Vagrant for creating and managing your Linux VM. We’ll discuss that shortly in <a data-type="xref" href="#vm_server">“Non-Linux VM-Based Server”</a>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Microsoft Windows 11" data-type="sect2"><div class="sect2" id="client_windows">&#13;
<h2>Microsoft Windows 11</h2>&#13;
&#13;
<p>Here are the steps required to install Docker Desktop on Windows 11.<a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="client" data-type="indexterm" id="ch03-wincli"/><a data-primary="installing Docker" data-secondary="client" data-tertiary="Windows" data-type="indexterm" id="ch03-wincli2"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Windows" data-type="indexterm" id="ch03-wincli3"/></p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>It is highly recommended that you<a data-primary="Windows Subsystem for Linux (WSL 2)" data-type="indexterm" id="idm46803156878816"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="Windows" data-tertiary="Windows Subsystem for Linux (WSL 2)" data-type="indexterm" id="idm46803156878096"/> set up the <a href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux (WSL2)</a> <em>before</em> installing Docker Desktop, and then select any available options in the Docker Desktop installer to enable and default to WSL2.</p>&#13;
&#13;
<p>Docker Desktop for Windows can leverage<a data-primary="Hyper-V" data-type="indexterm" id="idm46803156874864"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="Windows" data-tertiary="Hyper-V" data-type="indexterm" id="idm46803156874160"/><a data-primary="Windows running Docker" data-secondary="Hyper-V" data-type="indexterm" id="idm46803156872672"/> <a href="https://oreil.ly/vt6-o">Hyper-V</a><sup><a data-type="noteref" href="ch03.html#idm46803156871040" id="idm46803156871040-marker">1</a></sup> to provide a native virtualization layer for the Linux server components, but <a href="https://docs.microsoft.com/en-us/windows/wsl/install">WSL2</a> should provide you with the smoothest experience when working with Linux containers.</p>&#13;
</div>&#13;
&#13;
<p>Download the <a href="https://dockr.ly/2C0n7H0">latest Docker Desktop for Windows installer</a>, and then double-click on the downloaded program icon. Follow all of the installer prompts until the installation is finished.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46803156867008">&#13;
<h1>Enabling Linux Container Mode for Windows</h1>&#13;
<p>By default, your Docker Desktop installation on Windows should be set up for Linux containers, but if you ever get a message that says something like “no matching manifest for windows/amd64,” then Docker Desktop is likely configured for Windows containers.</p>&#13;
&#13;
<p>Linux containers are still the most common type of Linux container, and this book requires Linux container support. You can easily change your Windows setup by right-clicking on the Docker icon in the Windows taskbar and selecting “Switch to Linux containers…,” as shown in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#figure3-1">3-1</a> and&#13;
<a data-type="xref" data-xrefstyle="select:labelnumber" href="#figure3-2">3-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure3-1">&#13;
<img alt="Switch to Linux containers" src="assets/dur3_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>Switch to Linux containers</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="figure3-2">&#13;
<img alt="Switch to Linux containers confirmation" src="assets/dur3_0302.png"/>&#13;
<h6><span class="label">Figure 3-2. </span>Switch to Linux containers confirmation</h6>&#13;
</div></figure>&#13;
&#13;
<p>You can easily switch back and forth if you need to use both Linux and Windows containers.</p>&#13;
</div></aside>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Chocolatey installation" data-type="sect3"><div class="sect3" id="idm46803156857888">&#13;
<h3>Chocolatey installation</h3>&#13;
&#13;
<p>You can also install the Docker CLI tools<a data-primary="Chocolatey for Windows" data-type="indexterm" id="idm46803156856496"/><a data-primary="Windows running Docker" data-secondary="Chocolatey" data-type="indexterm" id="idm46803156855792"/> using the popular <a href="https://docs.chocolatey.org/en-us/choco/setup">Chocolatey</a> package management system for Windows. If you take this approach, you should consider installing Vagrant for creating and managing your Linux VM. We’ll discuss that shortly in <a data-type="xref" href="#vm_server">“Non-Linux VM-Based Server”</a>.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <a href="https://docs.docker.com/engine/install">Docker website</a> has installation directions for additional environments<a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="documentation" data-type="indexterm" id="idm46803156851168"/><a data-primary="documentation" data-secondary="Docker" data-tertiary="installation on Windows" data-type="indexterm" id="idm46803156849920"/><a data-primary="resources online" data-secondary="Docker documentation" data-tertiary="installation on Windows" data-type="indexterm" id="idm46803156848704"/> online.<a data-startref="ch03-wincli" data-type="indexterm" id="idm46803156847360"/><a data-startref="ch03-wincli2" data-type="indexterm" id="idm46803156846656"/><a data-startref="ch03-wincli3" data-type="indexterm" id="idm46803156845984"/></p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Docker Server" data-type="sect1"><div class="sect1" id="docker_server">&#13;
<h1>Docker Server</h1>&#13;
&#13;
<p>The Docker server is a separate binary<a data-primary="installing Docker" data-secondary="server" data-tertiary="about" data-type="indexterm" id="idm46803156843408"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="server" data-type="indexterm" id="ch03-servinst"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="about" data-type="indexterm" id="idm46803156840672"/> from the client and is used to manage most of the work for which Docker is typically used. Next we will explore the most common ways to manage the Docker server.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Docker Desktop and Docker Community Edition already<a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="server installed" data-type="indexterm" id="idm46803156838048"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="server installed" data-type="indexterm" id="idm46803156836512"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="installing Docker" data-tertiary="server" data-type="indexterm" id="idm46803156835280"/><a data-primary="Ubuntu Linux" data-secondary="installing Docker" data-tertiary="server" data-type="indexterm" id="idm46803156834064"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Docker Community Edition" data-type="indexterm" id="idm46803156832848"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="server via Docker Community Edition" data-type="indexterm" id="idm46803156831616"/><a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="server" data-type="indexterm" id="ch03-docwin"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Ubuntu" data-type="indexterm" id="idm46803156828896"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Fedora" data-type="indexterm" id="idm46803156827680"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="macOS on Docker Community Edition" data-type="indexterm" id="idm46803156826464"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="server installed" data-tertiary="Fedora or Ubuntu" data-type="indexterm" id="idm46803156825232"/><a data-primary="Docker Community Edition" data-primary-sortas="docker-a" data-secondary="server installed" data-tertiary="Windows or macOS" data-type="indexterm" id="idm46803156823728"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Windows on Docker Community Edition" data-type="indexterm" id="idm46803156822224"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Docker Community Edition" data-type="indexterm" id="idm46803156820992"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Fedora" data-type="indexterm" id="idm46803156819488"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="macOS on Docker Community Edition" data-type="indexterm" id="idm46803156818000"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Ubuntu" data-type="indexterm" id="idm46803156816496"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Windows on Docker Community Edition" data-type="indexterm" id="idm46803156815008"/> set up the server for you, so if you took that route, you do not need to do anything else besides ensuring that the server (<code>dockerd</code>) is running. On Windows and macOS, this typically just means starting the Docker application. <a data-primary="systemctl to start Docker server" data-type="indexterm" id="idm46803156812880"/>On Linux, you may need to run the following <code>systemctl</code> commands to start the server.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="systemd-Based Linux" data-type="sect2"><div class="sect2" id="systemd_service">&#13;
<h2>systemd-Based Linux</h2>&#13;
&#13;
<p>Current Fedora and Ubuntu releases use<a data-primary="Linux" data-secondary="systemd" data-tertiary="starting Docker" data-type="indexterm" id="idm46803156809648"/> <a href="https://www.freedesktop.org/wiki/Software/systemd"><code>systemd</code></a> to manage processes on the system. Because you have already installed Docker, you can ensure that the server starts every time you boot the system by typing this:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>systemctl<code class="w"> </code><code class="nb">enable</code><code class="w"> </code>docker<code class="w"/></pre>&#13;
&#13;
<p>This tells <code>systemd</code> to enable the <code>docker</code> service and start it when the system boots or switches into the default run level. To start the Docker server, type the following:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>systemctl<code class="w"> </code>start<code class="w"> </code>docker<code class="w"/></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Non-Linux VM-Based Server" data-type="sect2"><div class="sect2" id="vm_server">&#13;
<h2>Non-Linux VM-Based Server</h2>&#13;
&#13;
<p>If you are using Microsoft Windows<a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="server via VM" data-type="indexterm" id="idm46803156790912"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="macOS VM via Docker Desktop" data-type="indexterm" id="idm46803156767200"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Windows VM via Docker Desktop" data-type="indexterm" id="idm46803156766128"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="macOS" data-tertiary="VM-based Linux server" data-type="indexterm" id="idm46803156764944"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="Windows" data-tertiary="VM-based Linux server" data-type="indexterm" id="idm46803156763456"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="macOS VM via Docker Desktop" data-type="indexterm" id="idm46803156761968"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Windows VM via Docker Desktop" data-type="indexterm" id="idm46803156760512"/> or macOS in your Docker workflow, you will need a VM so that you can set up a Docker server for testing. Docker Desktop is convenient because it sets up this VM for you using the native virtualization technology on these platforms. <a data-primary="Vagrant" data-secondary="about" data-type="indexterm" id="idm46803156738480"/>If you are running an older version of Windows or cannot use Docker Desktop for other reasons, you should investigate <a href="https://www.vagrantup.com">Vagrant</a> to help you create and manage your Docker server Linux VM.</p>&#13;
&#13;
<p>In addition to using Vagrant, you can also use other virtualization tools, like <a href="https://github.com/lima-vm/lima">Lima on macOS</a> or any standard hypervisor, to set up a local Docker server, depending on your preferences and needs.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Vagrant" data-type="sect3"><div class="sect3" id="vagrant">&#13;
<h3>Vagrant</h3>&#13;
&#13;
<p>Vagrant provides support for multiple hypervisors and can often be leveraged to mimic even the most complex environments.<a data-primary="Vagrant" data-secondary="Docker server VM" data-type="indexterm" id="ch03-vag"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag2"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag3"/><a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag4"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag5"/><a data-primary="Ubuntu Linux" data-secondary="installing Docker" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag6"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="installing Docker" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag7"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="Vagrant for server VM" data-type="indexterm" id="ch03-vag8"/></p>&#13;
&#13;
<p>A common use case for leveraging Vagrant during Docker development is to support testing on images that match your production environment. <a data-primary="Red Hat Enterprise Linux" data-secondary="Vagrant supporting" data-type="indexterm" id="idm46803156720720"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="Vagrant supporting" data-type="indexterm" id="idm46803156719776"/>Vagrant supports everything from broad distributions like <a href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux">Red Hat Enterprise Linux</a> and <a href="https://ubuntu.com">Ubuntu</a> to finely focused atomic host distributions like <a href="https://getfedora.org/en/coreos">Fedora CoreOS</a>.</p>&#13;
&#13;
<p>You can easily install Vagrant on most platforms by <a href="https://www.vagrantup.com/downloads.html">downloading a self-contained package</a>.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>This Vagrant example is not secure and is not intended to be a recommendation. Instead, it is simply a demonstration of the basic requirements needed to set up a <em>remote</em> Docker server VM and make use of it. Securing the server is of critical importance.</p>&#13;
&#13;
<p>Using Docker Desktop for development is often a better option, when possible.<a data-primary="Vagrant" data-secondary="about" data-tertiary="Docker Desktop instead" data-type="indexterm" id="idm46803156713696"/></p>&#13;
</div>&#13;
&#13;
<p>You will need to have a hypervisor, like one of the following, fully installed on your system:<a data-primary="Hypervisor framework (Apple)" data-secondary="hypervisors for Vagrant" data-type="indexterm" id="idm46803156711472"/><a data-primary="VirtualBox" data-type="indexterm" id="idm46803156710432"/><a data-primary="VMware Workstation Pro/Fusion" data-type="indexterm" id="idm46803156709760"/><a data-primary="Hyper-V" data-type="indexterm" id="idm46803156709072"/><a data-primary="KVM" data-type="indexterm" id="idm46803156708400"/><a data-primary="Windows running Docker" data-secondary="Hyper-V" data-type="indexterm" id="idm46803156707728"/><a data-primary="virtual machines (VM)" data-secondary="VirtualBox" data-type="indexterm" id="idm46803156706784"/><a data-primary="virtual machines (VM)" data-secondary="KVM" data-type="indexterm" id="idm46803156705840"/><a data-primary="virtual machines (VM)" data-secondary="Hyper-V" data-see="Hyper-V" data-type="indexterm" id="idm46803156704896"/><a data-primary="virtual machines (VM)" data-secondary="VMware Workstation Pro/Fusion" data-type="indexterm" id="idm46803156703680"/></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Freely available</p>&#13;
</li>&#13;
<li>&#13;
<p>Supports multiplatforms on most architectures</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/4uNsR">VMware Workstation Pro/Fusion</a><sup><a data-type="noteref" href="ch03.html#idm46803156697792" id="idm46803156697792-marker">2</a></sup></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Commercial software</p>&#13;
</li>&#13;
<li>&#13;
<p>Supports multiplatforms on most architectures</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/agPTI">HyperV</a><sup><a data-type="noteref" href="ch03.html#idm46803156692368" id="idm46803156692368-marker">3</a></sup></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Commercial software</p>&#13;
</li>&#13;
<li>&#13;
<p>Supports Windows on most architectures</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.linux-kvm.org">KVM</a></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Freely available</p>&#13;
</li>&#13;
<li>&#13;
<p>Supports Linux on most architectures</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>By default, Vagrant assumes that you are using the VirtualBox hypervisor, but you can change it by using the <a href="https://learn.hashicorp.com/tutorials/vagrant/getting-started-providers"><code>--provider</code> flag</a> when using the <code>vagrant</code> command.</p>&#13;
&#13;
<p>In the following example, you will create a Ubuntu-based Docker host running the Docker daemon. Then you will create a host directory with a name similar to <em>docker-host</em> and move into that directory:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>mkdir<code class="w"> </code>docker-host<code class="w"/>&#13;
<code class="gp">$ </code><code class="nb">cd</code><code class="w"> </code>docker-host<code class="w"/></pre>&#13;
&#13;
<p>In order to use Vagrant, you need to <a href="https://app.vagrantup.com/boxes/search">find a Vagrant Box (VM image)</a> that is compatible with your provisioner and architecture. In this example, we will use a Vagrant Box for the Virtual Box hypervisor.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Virtual Box only works on Intel/AMD x86(64) systems, and the Vagrant Box we are using is specifically built for AMD64 systems.</p>&#13;
</div>&#13;
&#13;
<p>Go ahead and create a new file called <em>Vagrantfile</em> with the following contents in it:<a data-primary="Vagrant" data-secondary="Docker server VM" data-tertiary="Vagrantfile" data-type="indexterm" id="idm46803156677040"/><a data-primary="Linux" data-secondary="systemd" data-tertiary="starting Docker" data-type="indexterm" id="idm46803156675792"/></p>&#13;
&#13;
<pre data-code-language="ruby" data-type="programlisting"><code class="nb">puts</code><code class="w"> </code><code class="p">(</code><code class="o">&lt;&lt;-</code><code class="dl">EOT</code><code class="p">)</code><code class="w"/>&#13;
<code class="sh">  -----------------------------------------------------------------</code>&#13;
<code class="sh">  [WARNING] This exposes an unencrypted Docker TCP port on the VM!!</code>&#13;
&#13;
<code class="sh">  This is NOT secure and may expose your system to significant risk</code>&#13;
<code class="sh">  if left running and exposed to the broader network.</code>&#13;
<code class="sh">  -----------------------------------------------------------------</code>&#13;
&#13;
<code class="dl">EOT</code>&#13;
&#13;
<code class="vg">$script</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="o">&lt;&lt;-</code><code class="dl">SCRIPT</code><code class="w"/>&#13;
<code class="sh">echo \'{"hosts": ["tcp://0.0.0.0:2375", "unix:///var/run/docker.sock"]}\' | \</code>&#13;
<code class="sh">sudo tee /etc/docker/daemon.json</code>&#13;
<code class="sh">sudo mkdir -p /etc/systemd/system/docker.service.d</code>&#13;
<code class="sh">echo -e \"[Service]\nExecStart=\nExecStart=/usr/bin/dockerd\" | \</code>&#13;
<code class="sh">sudo tee /etc/systemd/system/docker.service.d/docker.conf</code>&#13;
<code class="sh">sudo systemctl daemon-reload</code>&#13;
<code class="sh">sudo systemctl restart docker</code>&#13;
<code class="dl">SCRIPT</code>&#13;
&#13;
<code class="no">Vagrant</code><code class="o">.</code><code class="n">configure</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code><code class="w"> </code><code class="k">do</code><code class="w"> </code><code class="o">|</code><code class="n">config</code><code class="o">|</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1"># Pick a compatible Vagrant Box</code><code class="w"/>&#13;
<code class="w">  </code><code class="n">config</code><code class="o">.</code><code class="n">vm</code><code class="o">.</code><code class="n">box</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s1">'bento/ubuntu-20.04'</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1"># Install Docker if it is not already on the VM image</code><code class="w"/>&#13;
<code class="w">  </code><code class="n">config</code><code class="o">.</code><code class="n">vm</code><code class="o">.</code><code class="n">provision</code><code class="w"> </code><code class="ss">:docker</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1"># Configure Docker to listen on an unencrypted local port</code><code class="w"/>&#13;
<code class="w">  </code><code class="n">config</code><code class="o">.</code><code class="n">vm</code><code class="o">.</code><code class="n">provision</code><code class="w"> </code><code class="s2">"shell"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">inline</code><code class="p">:</code><code class="w"> </code><code class="vg">$script</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">run</code><code class="p">:</code><code class="w"> </code><code class="s2">"always"</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1"># Port-forward the Docker port to</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1"># 12375 (or another open port) on our host machine</code><code class="w"/>&#13;
<code class="w">  </code><code class="n">config</code><code class="o">.</code><code class="n">vm</code><code class="o">.</code><code class="n">network</code><code class="w"> </code><code class="s2">"forwarded_port"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">guest</code><code class="p">:</code><code class="w"> </code><code class="mi">2375</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">host</code><code class="p">:</code><code class="w"> </code><code class="mi">12375</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">protocol</code><code class="p">:</code><code class="w"> </code><code class="s2">"tcp"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="ss">auto_correct</code><code class="p">:</code><code class="w"> </code><code class="kp">true</code><code class="w"/>&#13;
&#13;
<code class="k">end</code><code class="w"/></pre>&#13;
&#13;
<p>You can retrieve a complete copy of this file by running this:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>git<code class="w"> </code>clone<code class="w"> </code>https://github.com/bluewhalebook/<code class="se">\</code>&#13;
docker-up-and-running-3rd-edition.git<code class="w"> </code>--config<code class="w"> </code>core.autocrlf<code class="o">=</code>input<code class="w"/>&#13;
<code class="gp">$ </code><code class="nb">cd</code><code class="w"> </code>docker-up-and-running-3rd-edition/chapter_03/vagrant<code class="w"/>&#13;
<code class="gp">$ </code>ls<code class="w"> </code>Vagrantfile<code class="w"/></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>You may need to remove the “\” in the <code>git clone</code> command and reassemble the URL into a single line. It is there because the command is too long for the standard printed page, and this should work in a standard Unix shell as long as there are no leading or trailing spaces in either line.</p>&#13;
</div>&#13;
&#13;
<p>Ensure that you are in the directory with the <em>Vagrantfile</em>, and then run the following command to start the Vagrant VM.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>This setup is provided as a simple example. It is not secure and should not be left running without ensuring that the server cannot be accessed from the broader network.</p>&#13;
&#13;
<p>Docker maintains<a data-primary="security" data-secondary="SSH or TLS client certificate documentation" data-type="indexterm" id="idm46803156337360"/><a data-primary="SSH" data-secondary="client certificate documentation" data-type="indexterm" id="idm46803156336384"/><a data-primary="TLS client certificate documentation" data-type="indexterm" id="idm46803156335472"/><a data-primary="documentation" data-secondary="Docker" data-tertiary="SSH or TLS client certificates" data-type="indexterm" id="idm46803156334832"/><a data-primary="resources online" data-secondary="Docker documentation" data-tertiary="SSH or TLS client certificate" data-type="indexterm" id="idm46803156333648"/><a data-primary="client certificate documentation" data-type="indexterm" id="idm46803156332464"/><a data-primary="Docker daemon" data-primary-sortas="docker-a" data-secondary="attack surface documentation" data-type="indexterm" id="idm46803156331824"/><a data-primary="security" data-secondary="Docker daemon" data-tertiary="attack surface documentation" data-type="indexterm" id="idm46803156330592"/> <a href="https://docs.docker.com/engine/security/protect-access">documentation on how to secure your Docker endpoint with SSH or TLS client certificates</a> and provides some additional information about the <a href="https://docs.docker.com/engine/security/#docker-daemon-attack-surface">attack surface of the Docker daemon</a>.</p>&#13;
</div>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>vagrant<code class="w"> </code>up<code class="w"/>&#13;
<code class="go">…</code>&#13;
<code class="go">Bringing machine 'default' up with 'virtualbox' provider…</code>&#13;
<code class="go">==&gt; default: Importing base box 'bento/ubuntu-20.04'…</code>&#13;
<code class="go">==&gt; default: Matching MAC address for NAT networking…</code>&#13;
<code class="go">==&gt; default: Checking if box 'bento/ubuntu-20.04' version '…' is up to date…</code>&#13;
<code class="go">==&gt; default: A newer version of the box 'bento/ubuntu-20.04' for provider…</code>&#13;
<code class="go">==&gt; default: available! You currently have version '…'. The latest is version</code>&#13;
<code class="go">==&gt; default: '202206.03.0'. Run `vagrant box update` to update.</code>&#13;
<code class="go">==&gt; default: Setting the name of the VM: vagrant_default_1654970697417_18732</code>&#13;
<code class="go">==&gt; default: Clearing any previously set network interfaces…</code>&#13;
<code class="go">…</code>&#13;
<code class="go">==&gt; default: Running provisioner: docker…</code>&#13;
<code class="go">    default: Installing Docker onto machine…</code>&#13;
<code class="go">==&gt; default: Running provisioner: shell…</code>&#13;
<code class="go">    default: Running: inline script</code>&#13;
<code class="go">    default: {"hosts": ["tcp://0.0.0.0:2375", "unix:///var/run/docker.sock"]}</code>&#13;
<code class="go">    default: [Service]</code>&#13;
<code class="go">    default: ExecStart=</code>&#13;
<code class="go">    default: ExecStart=/usr/bin/dockerd</code></pre>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>On macOS, you may see an error like this:</p>&#13;
&#13;
<p><code>VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component MachineWrap, interface IMachine</code></p>&#13;
&#13;
<p>This is due to the security features in macOS. A quick search should lead you to an <a href="https://scriptcrunch.com/solved-vboxmanage-error-component-machinewrap">online post that describes the fix</a>.</p>&#13;
</div>&#13;
&#13;
<p>Once the VM is running,<a data-primary="docker version" data-primary-sortas="docker-z" data-secondary="-H with Vagrant VM" data-type="indexterm" id="idm46803156285408"/><a data-primary="docker commands" data-primary-sortas="docker-z" data-secondary="-H for remote docker server" data-secondary-sortas="H" data-type="indexterm" id="idm46803156284128"/> you should be able to connect to the Docker server by running the following command and telling the Docker client where it should connect to with the <code>-H</code> argument:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>-H<code class="w"> </code><code class="m">127</code>.0.0.1:12375<code class="w"> </code>version<code class="w"/>&#13;
<code class="go">Client:</code>&#13;
<code class="go"> Cloud integration: v1.0.24</code>&#13;
<code class="go"> Version:           20.10.14</code>&#13;
<code class="go"> API version:       1.41</code>&#13;
<code class="go">…</code>&#13;
&#13;
<code class="go">Server: Docker Engine - Community</code>&#13;
<code class="go"> Engine:</code>&#13;
<code class="go">  Version:          20.10.17</code>&#13;
<code class="go">  API version:      1.41 (minimum version 1.12)</code>&#13;
<code class="go">…</code></pre>&#13;
&#13;
<p>The output will provide you with version information about the various components that make up the Docker client and server.</p>&#13;
&#13;
<p>Passing in the IP address and port every time<a data-primary="docker context" data-primary-sortas="docker-z" data-secondary="Vagrant server VM" data-type="indexterm" id="idm46803156269920"/><a data-primary="Vagrant" data-secondary="Docker server VM" data-tertiary="IP address and port" data-type="indexterm" id="idm46803156268800"/> you want to run a Docker command is not ideal, but luckily Docker can be set up to know about multiple Docker servers by using the <code>docker context</code> command. To start, let’s check and see what context is currently in use. Take note of the entry that has an asterisk (*) next to it, which designates the current context:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>context<code class="w"> </code>list<code class="w"/>&#13;
<code class="go">NAME       TYPE … DOCKER ENDPOINT             …</code>&#13;
<code class="go">default *  moby … unix:///var/run/docker.sock …</code>&#13;
<code class="go">…</code></pre>&#13;
&#13;
<p>You can create a new context for the Vagrant VM and then make it active by running the following sequence of commands:<a data-primary="docker context" data-primary-sortas="docker-z" data-secondary="create" data-type="indexterm" id="idm46803156233040"/><a data-primary="docker context" data-primary-sortas="docker-z" data-secondary="use" data-type="indexterm" id="idm46803156231952"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>context<code class="w"> </code>create<code class="w"> </code>vagrant<code class="w"> </code>--docker<code class="w"> </code><code class="nv">host</code><code class="o">=</code>tcp://127.0.0.1:12375<code class="w"/>&#13;
<code class="go">vagrant</code>&#13;
<code class="go">Successfully created context "vagrant"</code>&#13;
&#13;
<code class="gp">$ </code>docker<code class="w"> </code>context<code class="w"> </code>use<code class="w"> </code>vagrant<code class="w"/>&#13;
<code class="go">vagrant</code></pre>&#13;
&#13;
<p>If you re-list all the contexts now, you should see something like this:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>context<code class="w"> </code>list<code class="w"/>&#13;
<code class="go">NAME       TYPE … DOCKER ENDPOINT             …</code>&#13;
<code class="go">default    moby … unix:///var/run/docker.sock …</code>&#13;
<code class="go">vagrant *  moby … tcp://127.0.0.1:12375       …</code>&#13;
<code class="go">…</code></pre>&#13;
&#13;
<p>With your current context set to <code>vagrant</code>, running <code>docker version</code> without the additional <code>-H</code> argument will still connect to the correct Docker server and return the same information as before.</p>&#13;
&#13;
<p>To connect to a shell on the Vagrant-based VM, you can run the following:<a data-primary="system calls" data-secondary="exit" data-type="indexterm" id="idm46803156143552"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>vagrant<code class="w"> </code>ssh<code class="w"/>&#13;
<code class="go">…</code>&#13;
<code class="go">Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)</code>&#13;
<code class="go">…</code>&#13;
<code class="gp">vagrant@vagrant:~$ </code><code class="nb">exit</code><code class="w"/></pre>&#13;
&#13;
<p>Until you have time to secure this setup,<a data-primary="Vagrant" data-secondary="Docker server VM" data-tertiary="shutting down" data-type="indexterm" id="idm46803156106752"/> it is best to go ahead and shut down the VM and set your context back to its original state:</p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>vagrant<code class="w"> </code>halt<code class="w"/>&#13;
<code class="go">…</code>&#13;
<code class="go">==&gt; default: Attempting graceful shutdown of VM…</code>&#13;
&#13;
<code class="gp">$ </code>docker<code class="w"> </code>version<code class="w"/>&#13;
<code class="go">Cannot connect to … daemon at tcp://127.0.0.1:12375. Is the … daemon running?</code>&#13;
&#13;
<code class="gp">$ </code>docker<code class="w"> </code>context<code class="w"> </code>use<code class="w"> </code>default<code class="w"/>&#13;
<code class="go">default</code></pre>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>If you are using macOS, you might<a data-primary="Colima for macOS" data-type="indexterm" id="idm46803156078144"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="Colima for server VM" data-type="indexterm" id="idm46803156077504"/><a data-primary="virtual machines (VM)" data-secondary="Colima for macOS" data-type="indexterm" id="idm46803156076288"/> want to take a look at <a href="https://github.com/abiosoft/colima">Colima</a>, which makes it very easy to spin up and manage a flexible Docker or Kubernetes VM.<a data-startref="ch03-servinst" data-type="indexterm" id="idm46803156044352"/><a data-startref="ch03-docwin" data-type="indexterm" id="idm46803156043680"/><a data-startref="ch03-vag" data-type="indexterm" id="idm46803156043008"/><a data-startref="ch03-vag2" data-type="indexterm" id="idm46803156042336"/><a data-startref="ch03-vag3" data-type="indexterm" id="idm46803156041664"/><a data-startref="ch03-vag4" data-type="indexterm" id="idm46803156040992"/><a data-startref="ch03-vag5" data-type="indexterm" id="idm46803156040320"/><a data-startref="ch03-vag6" data-type="indexterm" id="idm46803156039648"/><a data-startref="ch03-vag7" data-type="indexterm" id="idm46803156038976"/><a data-startref="ch03-vag8" data-type="indexterm" id="idm46803156038304"/></p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Testing the Setup" data-type="sect1"><div class="sect1" id="test_install">&#13;
<h1>Testing the Setup</h1>&#13;
&#13;
<p>Once you have a working client<a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156036176"/><a data-primary="installing Docker" data-secondary="testing the installation" data-type="indexterm" id="idm46803156034688"/><a data-primary="Docker client" data-primary-sortas="docker-a" data-secondary="installing" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156006176"/><a data-primary="macOS running Docker" data-secondary="installing Docker" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156004848"/><a data-primary="Windows running Docker" data-secondary="installing Docker" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156003760"/><a data-primary="Linux" data-secondary="installing Docker" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156002672"/><a data-primary="Ubuntu Linux" data-secondary="installing Docker" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156001584"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="installing Docker" data-tertiary="testing the installation" data-type="indexterm" id="idm46803156000496"/> and server set up, you are ready to test that everything is working. You should be able to run any one of the following commands on your local system to tell the Docker daemon to download the latest official container for that distribution and then launch it with a running Unix shell process.</p>&#13;
&#13;
<p>This step is important to ensure that all the pieces are properly installed and communicating with one another as expected. <a data-primary="Linux containers" data-secondary="running from any distribution" data-type="indexterm" id="idm46803155998848"/><a data-primary="docker container" data-primary-sortas="docker-z" data-secondary="run" data-tertiary="containers of various distributions" data-type="indexterm" id="idm46803155997856"/>It shows off one of the features of Docker: we can run containers based on any Linux distribution we like. In the next few steps, we’ll run Linux containers based on Ubuntu, Fedora, and Alpine Linux. You don’t need to run them all to prove that this works; running one of them will suffice.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you are using the Docker client<a data-primary="Linux" data-secondary="sudo before docker commands" data-type="indexterm" id="idm46803155995024"/><a data-primary="Ubuntu Linux" data-secondary="sudo before docker commands" data-type="indexterm" id="idm46803155994032"/><a data-primary="Fedora CoreOS (Red Hat)" data-secondary="sudo before docker commands" data-type="indexterm" id="idm46803155993072"/><a data-primary="sudo before docker commands" data-type="indexterm" id="idm46803155992112"/><a data-primary="docker commands" data-primary-sortas="docker-z" data-secondary="sudo before docker commands" data-type="indexterm" id="idm46803155991424"/> on a Linux system, you may need to prepend each <code>docker</code> command with <code>sudo</code> since the <em>root</em> user may be the only one with Docker access, by default.</p>&#13;
&#13;
<p>Most Docker installs create a <code>docker</code> group<a data-primary="installing Docker" data-secondary="docker group" data-type="indexterm" id="idm46803155987856"/><a data-primary="docker (Unix group)" data-primary-sortas="docker-z" data-type="indexterm" id="idm46803155986848"/><a data-primary="Unix group" data-see="docker (Unix group)" data-type="indexterm" id="idm46803155985904"/><a data-primary="Unix sockets of Docker" data-secondary="docker group to manage access" data-type="indexterm" id="idm46803155984960"/><a data-primary="dockerd" data-primary-sortas="docker-z" data-secondary="docker group to manage access to Unix socket" data-type="indexterm" id="idm46803155984048"/> that can be used to manage who has access to the <code>dockerd</code> Unix socket. You can add your user to that group so that you no longer need to use the<a data-primary="sudo before docker commands" data-secondary="man page" data-type="indexterm" id="idm46803155982288"/><a data-primary="docker commands" data-primary-sortas="docker-z" data-secondary="sudo before docker commands" data-tertiary="man page" data-type="indexterm" id="idm46803155981376"/><a data-primary="documentation" data-secondary="sudo man page" data-type="indexterm" id="idm46803155979968"/> <a href="https://man7.org/linux/man-pages/man8/sudo.8.html"><code>sudo</code> command</a>.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Ubuntu" data-type="sect2"><div class="sect2" id="test_ubuntu">&#13;
<h2>Ubuntu</h2>&#13;
&#13;
<p>Let’s try launching a container using the latest Ubuntu Linux base image:<a data-primary="Ubuntu Linux" data-secondary="launching container containing base image" data-type="indexterm" id="idm46803155975824"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>container<code class="w"> </code>run<code class="w"> </code>--rm<code class="w"> </code>-ti<code class="w"> </code>docker.io/ubuntu:latest<code class="w"> </code>/bin/bash<code class="w"/>&#13;
&#13;
<code class="gp">root@aa9b72ae1fea:/#</code></pre>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Using <code>docker container run</code> is functionally the same as using <code>docker run</code>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fedora" data-type="sect2"><div class="sect2" id="test_fedora">&#13;
<h2>Fedora</h2>&#13;
&#13;
<p>In this example, we launch a container using the latest Fedora Linux base image:<a data-primary="Fedora CoreOS (Red Hat)" data-secondary="launching container containing base image" data-type="indexterm" id="idm46803155947424"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>container<code class="w"> </code>run<code class="w"> </code>--rm<code class="w"> </code>-ti<code class="w"> </code>docker.io/fedora:latest<code class="w"> </code>/bin/bash<code class="w"/>&#13;
&#13;
<code class="gp">[root@5c97201e827b /]# </code><code class="nb">exit</code><code class="w"/></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Alpine Linux" data-type="sect2"><div class="sect2" id="test_alpine">&#13;
<h2>Alpine Linux</h2>&#13;
&#13;
<p>And then finally, we can test launching a container using the latest Alpine Linux base image:<a data-primary="Alpine Linux" data-secondary="launching container containing base image" data-type="indexterm" id="idm46803155918208"/><a data-primary="Linux" data-secondary="distributions" data-see="Alpine Linux" data-tertiary="Alpine" data-type="indexterm" id="idm46803155917264"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>container<code class="w"> </code>run<code class="w"> </code>--rm<code class="w"> </code>-ti<code class="w"> </code>docker.io/alpine:latest<code class="w"> </code>/bin/sh<code class="w"/>&#13;
&#13;
<code class="go">/ # exit</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><code>docker.io/ubuntu:latest</code>, <code>docker.io/fedora:latest</code>, and <code>docker.io/alpine:latest</code> all represent a Docker image repository, followed by an image name and an image tag.<a data-primary="repositories for Docker images" data-type="indexterm" id="idm46803155881984"/><a data-primary="OCI images" data-secondary="repositories" data-type="indexterm" id="idm46803155881312"/><a data-primary="image tags" data-secondary="docker container run command" data-type="indexterm" id="idm46803155880368"/><a data-primary="OCI images" data-secondary="docker container run with image tags" data-type="indexterm" id="idm46803155879456"/><a data-primary="docker container" data-primary-sortas="docker-z" data-secondary="run" data-tertiary="image tags" data-type="indexterm" id="idm46803155878544"/></p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exploring the Docker Server" data-type="sect1"><div class="sect1" id="idm46803155876928">&#13;
<h1>Exploring the Docker Server</h1>&#13;
&#13;
<p>Although the Docker server is often installed,<a data-primary="installing Docker" data-secondary="exploring Docker server" data-type="indexterm" id="idm46803155875264"/><a data-primary="installing Docker" data-secondary="server" data-tertiary="exploring" data-type="indexterm" id="idm46803155851648"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="exploring" data-type="indexterm" id="idm46803155850560"/><a data-primary="Docker daemon" data-primary-sortas="docker-a" data-secondary="running manually" data-type="indexterm" id="idm46803155849472"/><a data-primary="dockerd" data-primary-sortas="docker-z" data-secondary="running manually" data-type="indexterm" id="idm46803155848384"/> enabled, and run automatically, it’s useful to see that <a href="https://docs.docker.com/engine/reference/commandline/dockerd">running the Docker daemon manually on a Linux system</a> can be as simple as typing something like this:<a data-primary="daemon.json configuration file" data-secondary="--config-file to specify" data-secondary-sortas="config-file" data-type="indexterm" id="idm46803155846544"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>sudo<code class="w"> </code>dockerd<code class="w"> </code>-H<code class="w"> </code>unix:///var/run/docker.sock<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">  </code>--config-file<code class="w"> </code>/etc/docker/daemon.json<code class="w"/></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This section assumes that you are<a data-primary="dockerd" data-primary-sortas="docker-z" data-secondary="about Docker server" data-tertiary="Docker Desktop needs trick to interact" data-type="indexterm" id="idm46803155835744"/> on the actual Linux server or VM that is running the Docker daemon. If you are using Docker Desktop on Windows or Mac, you won’t be able to easily interact with the <code>dockerd</code> executable, as it is intentionally hidden from the end user, but we’ll show you a trick in just a moment.</p>&#13;
</div>&#13;
&#13;
<p>This command starts the Docker daemon, creates and listens to a Unix domain socket (<code>-H unix:///var/run/docker.sock</code>), and reads in the rest of the configuration from <em>/etc/docker/daemon.json</em>. You’re not likely to have to start the Docker server yourself, but that’s what’s going on behind the scenes. On non-Linux systems, you will typically have a Linux-based VM that hosts the Docker server. Docker Desktop sets up this VM for you in the background.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you already have Docker running, executing the daemon again will fail because it can’t use the same network port twice.</p>&#13;
</div>&#13;
&#13;
<p>In most cases, it is very easy<a data-primary="SSH" data-secondary="Docker server exploration" data-type="indexterm" id="idm46803155830784"/> to SSH into your new Docker server and take a look around, but the seamless experience of Docker Desktop on a non-Linux system means it is often not apparent that Docker Desktop is leveraging a local VM on which to run the Docker daemon. <a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="nsenter for Docker server access" data-type="indexterm" id="idm46803155829712"/>Because the Docker Desktop VM is designed to be very small and very stable, it does not run an SSH daemon and is, therefore, a bit tricky to access.</p>&#13;
&#13;
<p>If you are curious or just ever have a <a data-primary="docker container" data-primary-sortas="docker-z" data-secondary="run" data-tertiary="nsenter for Docker server access" data-type="indexterm" id="idm46803155828016"/><a data-primary="nsenter for Docker server access" data-type="indexterm" id="idm46803155803856"/>need to access the underlying VM, you can do it, but it requires a little advanced knowledge. We will talk about the command <code>nsenter</code> in much more detail in <a data-type="xref" href="ch11.html#nsenter">“nsenter”</a>, but for now, if you would like to see the VM (or underlying host), you can run these commands:<a data-primary="Linux containers" data-secondary="privileged" data-tertiary="VM or underlying host exposed" data-type="indexterm" id="idm46803155801664"/><a data-primary="privileged containers" data-secondary="VM or underlying host exposed" data-type="indexterm" id="idm46803155800384"/></p>&#13;
&#13;
<pre data-code-language="console" data-type="programlisting"><code class="gp">$ </code>docker<code class="w"> </code>container<code class="w"> </code>run<code class="w"> </code>--rm<code class="w"> </code>-it<code class="w"> </code>--privileged<code class="w"> </code>--pid<code class="o">=</code>host<code class="w"> </code>debian<code class="w"> </code><code class="se">\</code>&#13;
<code class="w">  </code>nsenter<code class="w"> </code>-t<code class="w"> </code><code class="m">1</code><code class="w"> </code>-m<code class="w"> </code>-u<code class="w"> </code>-n<code class="w"> </code>-i<code class="w"> </code>sh<code class="w"/>&#13;
&#13;
<code class="go">/ # cat /etc/os-release</code>&#13;
<code class="go">PRETTY_NAME="Docker Desktop"</code>&#13;
&#13;
<code class="go">/ # ps | grep dockerd</code>&#13;
<code class="go"> 1540 root      1:05 /usr/local/bin/dockerd</code>&#13;
<code class="go">                      --containerd /var/run/desktop-containerd/containerd.sock</code>&#13;
<code class="go">                      --pidfile /run/desktop/docker.pid</code>&#13;
<code class="go">                      --swarm-default-advertise-addr=eth0</code>&#13;
<code class="go">                      --host-gateway-ip 192.168.65.2</code>&#13;
&#13;
<code class="go">/ # exit</code></pre>&#13;
&#13;
<p>This command uses a privileged Debian container that contains the <code>nsenter</code> command to manipulate the Linux kernel namespaces so that we can navigate the filesystem of the underlying VM or host.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>This container is privileged to allow us to navigate the underlying host, but you should not get into the habit of using privileged containers when adding individual capabilities or system call privileges will suffice. We discuss this more in <a data-type="xref" href="ch11.html#security">“Security”</a>.</p>&#13;
&#13;
<p>If you can use a Docker server endpoint, this command will give you access to the underlying host.</p>&#13;
</div>&#13;
&#13;
<p>The Docker daemon configuration<a data-primary="Docker daemon" data-primary-sortas="docker-a" data-secondary="configuration file" data-seealso="daemon.json configuration file" data-type="indexterm" id="idm46803155759232"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="daemon.json configuration file location" data-type="indexterm" id="idm46803155757744"/><a data-primary="Docker Desktop" data-primary-sortas="docker-a" data-secondary="daemon.json file editing" data-type="indexterm" id="idm46803155756560"/><a data-primary="virtual machines (VM)" data-secondary="Docker Desktop" data-see="Docker Desktop" data-type="indexterm" id="idm46803155755376"/><a data-primary="virtual machines (VM)" data-secondary="Vagrant" data-see="Vagrant" data-type="indexterm" id="idm46803155754160"/><a data-primary="VM" data-see="virtual machines" data-type="indexterm" id="idm46803155752944"/><a data-primary="daemon.json configuration file" data-secondary="location of" data-type="indexterm" id="idm46803155752000"/><a data-primary="daemon.json configuration file" data-secondary="location of" data-tertiary="Docker Desktop" data-type="indexterm" id="idm46803155751088"/><a data-primary="Docker server" data-primary-sortas="docker-a" data-secondary="daemon.json configuration file location" data-tertiary="Docker Desktop" data-type="indexterm" id="idm46803155749904"/> is typically stored in <em>/etc/docker/daemon.json</em>, but you may notice that it exists somewhere like <em>/containers/services/docker/rootfs/etc/docker/daemon.json</em> in the Docker Desktop VM. Docker uses reasonable defaults for all its settings, so this file may be very small or even completely absent. If you are using Docker Desktop, you can edit this file by clicking on the Docker icon and selecting Preferences… → Docker Engine, as shown in <a data-type="xref" href="#figure3-3">Figure 3-3</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure3-3">&#13;
<img alt="Docker Desktop Server Configuration" src="assets/dur3_0303.png"/>&#13;
<h6><span class="label">Figure 3-3. </span>Docker Desktop server configuration</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Wrap-Up" data-type="sect1"><div class="sect1" id="idm46803155876336">&#13;
<h1>Wrap-Up</h1>&#13;
&#13;
<p>Now that you have a running Docker setup, you can start to look at more than the basic mechanics of getting it installed. In the next chapter, you’ll explore how to build and manage Docker images, which provide the basis for every container you will ever launch with Docker.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>In the rest of the book, when you see <code>docker</code> on the command line, assume you will need to have the correct configuration in place either as a Docker context, environment variables, or via the <code>-H</code> command-line flag to tell the <code>docker</code> client how to connect to the <code>dockerd</code> server process.</p>&#13;
</div>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm46803156871040"><sup><a href="ch03.html#idm46803156871040-marker">1</a></sup> Full URL: <a class="bare" href="https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about"><em class="hyperlink">https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about</em></a></p><p data-type="footnote" id="idm46803156697792"><sup><a href="ch03.html#idm46803156697792-marker">2</a></sup> Full URL: <a class="bare" href="https://www.vmware.com/products/workstation-pro.html"><em class="hyperlink">https://www.vmware.com/products/workstation-pro.html</em></a></p><p data-type="footnote" id="idm46803156692368"><sup><a href="ch03.html#idm46803156692368-marker">3</a></sup> Full URL: <a class="bare" href="https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v"><em class="hyperlink">https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v</em></a></p></div></div></section></body></html>