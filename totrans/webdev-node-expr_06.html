<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. The Request and Response Objects"><div class="chapter" id="ch_the_request_and_response_objects">
<h1><span class="label">Chapter 6. </span>The Request and Response Objects</h1>


<p>In this chapter, we’ll learn the important details of the request and
response objects—which are very much the beginning and end of everything
that happens in an Express application. When you’re building a web server with Express, most of what you’ll be
doing starts with a request object and ends with a response
object.</p>

<p>These two objects originate in Node and are
extended by Express. Before we delve into what these objects offer us,
let’s establish a little background on how a client (a browser, usually)
requests a page from a server and how that page is returned.</p>






<section data-type="sect1" data-pdf-bookmark="The Parts of a URL"><div class="sect1" id="idm45053596990136">
<h1>The Parts of a URL</h1>

<p><a data-type="indexterm" data-primary="request objects" data-secondary="URL components and" id="idm45053596988936"/><a data-type="indexterm" data-primary="URLs" data-secondary="components of" id="idm45053596987960"/>We see URLs all the time, but we don’t often stop to think about their component parts. Let’s consider three URLs and examine their component parts:</p>

<figure><div class="figure">
<img src="Images/bwne_06in01.png" alt="Parts of a URL" width="1550" height="417"/>
<h6/>
</div></figure>
<dl>
<dt>Protocol</dt>
<dd>
<p> <a data-type="indexterm" data-primary="protocol, in URL" id="idm45053596983064"/>The protocol determines how the request will be
transmitted. We will be dealing exclusively with
<em>http</em> and <em>https</em>. Other common protocols include <em>file</em> and <em>ftp</em>.</p>
</dd>
<dt>Host</dt>
<dd>
<p>  <a data-type="indexterm" data-primary="host, in URL" id="idm45053596978952"/>The host identifies the server. Servers on your computer (localhost) or a local
network may be identified simply be one word or by a numeric IP
address. On the internet, the host will
end in a top-level domain (TLD) like <em>.com</em> or <em>.net</em>. <a data-type="indexterm" data-primary="subdomains, in URL" id="idm45053596952488"/>Additionally, there
may be <em>subdomains</em>, which prefix the hostname. <em>www</em> is a common
subdomain, though it can be anything. Subdomains are
optional.</p>
</dd>
<dt>Port</dt>
<dd>
<p>  <a data-type="indexterm" data-primary="ports" data-secondary="HTTP" id="idm45053596949864"/>Each server has a collection of numbered ports. Some port numbers are special,
like 80 and 443. <a data-type="indexterm" data-primary="HTTP" data-secondary="default port for" id="idm45053596948616"/><a data-type="indexterm" data-primary="HTTPS (HTTP Secure)" data-secondary="default port for" id="idm45053596947672"/>If you omit the port, port 80 is assumed for HTTP and 443
for HTTPS. In general, if you aren’t using port 80 or 443, you should use
a port number greater than
1023.<sup><a data-type="noteref" id="idm45053596946424-marker" href="ch06.xhtml#idm45053596946424">1</a></sup> It’s
common to use easy-to-remember port numbers like 3000, 8080, and 8088.
Only one server can be associated with a given port, and even though there
are plenty of numbers to choose from, you may have to change the port
number if you’re using a commonly used port number.</p>
</dd>
<dt>Path</dt>
<dd>
<p>  <a data-type="indexterm" data-primary="path(s)" data-secondary="in URL" id="idm45053596943320"/>The path is generally the first part of the URL that your app cares
about (it is possible to make decisions based on protocol, host, and port,
but it’s not good practice). The
path should be used to uniquely identify pages or other resources in your
app.</p>
</dd>
<dt>Querystring</dt>
<dd>
<p>  <a data-type="indexterm" data-primary="querystring" data-secondary="in URL" id="idm45053596940408"/>The querystring is an optional collection of name/value
pairs. The
querystring starts with a question mark (<em>?</em>), and name/value pairs are
separated by ampersands (<em>&amp;</em>). Both names and values should be <em>URL
encoded</em>. JavaScript provides a built-in function to do that:
<code>encodeURIComponent</code>. For example, spaces will be replaced with plus signs
(<em>+</em>). Other special characters will be replaced with numeric character
references. Sometimes the querystring will be referred to as the <em>search
string</em> or simply the <em>search</em>.</p>
</dd>
<dt>Fragment</dt>
<dd>
<p>  <a data-type="indexterm" data-primary="fragment, in URL" id="idm45053596934744"/><a data-type="indexterm" data-primary="hash, in URL" id="idm45053596934008"/>The fragment (or <em>hash</em>) is not passed to the server at all; it is
strictly for use by the browser. Some single-page applications use the
fragment to control application navigation. Originally, the fragment’s
sole purpose was to cause the browser to display a specific part of the
document, marked by an anchor tag (for example: <code>&lt;a id="chapter06"&gt;</code>).</p>
</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="HTTP Request Methods"><div class="sect1" id="idm45053596931800">
<h1>HTTP Request Methods</h1>

<p><a data-type="indexterm" data-primary="HTTP" data-secondary="request methods" id="idm45053596930424"/><a data-type="indexterm" data-primary="request objects" data-secondary="HTTP request methods" id="idm45053596929224"/>The HTTP protocol defines a collection of <em>request methods</em> (often referred
to as <em>HTTP verbs</em>) that a client uses to communicate with a server.
 Far and away, the most common methods are <code>GET</code> and
<code>POST</code>.</p>

<p><a data-type="indexterm" data-primary="GET request" id="idm45053596926120"/>When you type a URL into a browser (or click a link), the browser issues an
HTTP <code>GET</code> request to the server. The important information passed to the
server is the URL path and querystring. The combination of method, path,
and querystring is what your app uses to determine how to respond.</p>

<p>For a website, most of your pages will respond to <code>GET</code> requests. <a data-type="indexterm" data-primary="POST request" id="idm45053596923528"/><code>POST</code>
requests are usually reserved for sending information back to the server
(form processing, for example). It’s quite common for
<code>POST</code> requests to respond with the same HTML as the corresponding <code>GET</code>
request after the server has processed any information included in the
request (like a form). Browsers will primarily use the <code>GET</code> and <code>POST</code>
methods when communicating with your server. The Ajax requests your
application makes, however, may use any HTTP verb. For example, there’s an
HTTP method called <code>DELETE</code> that is useful for, well,
an API call that deletes things.</p>

<p>With Node and Express, you are fully in charge of what methods you respond
to. In Express, you’ll usually be writing handlers for specific methods.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Request Headers"><div class="sect1" id="idm45053596919288">
<h1>Request Headers</h1>

<p><a data-type="indexterm" data-primary="headers" data-secondary="request headers" id="idm45053596918088"/><a data-type="indexterm" data-primary="request headers" id="idm45053596917112"/><a data-type="indexterm" data-primary="request objects" data-secondary="request headers" id="idm45053596916440"/>The URL isn’t the only thing that’s passed to the server when you navigate
to a page. Your browser is sending a lot
of “invisible” information every time you visit a website. I’m not talking
about spooky personal information (though if your browser is infected by
malware, that can happen). The browser will tell the server what language
it prefers to receive the page in (for example, if you download Chrome in
Spain, it will request the Spanish version of pages you visit, if they
exist). It will also send information about the <em>user agent</em> (the browser,
operating system, and hardware) and other bits of information. All this
information is sent as a request header, which is made available to you
through the request object’s <code>headers</code> property. If you’re curious to see the information your browser
is sending, you can create a simple Express route to display that
information (<em>ch06/00-echo-headers.js</em> in the companion repo):</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/headers'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">type</code><code class="p">(</code><code class="s1">'text/plain'</code><code class="p">)</code>
  <code class="kr">const</code> <code class="nx">headers</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">entries</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">headers</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">map</code><code class="p">(([</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="sb">`</code><code class="si">${</code><code class="nx">key</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">value</code><code class="si">}</code><code class="sb">`</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">headers</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="s1">'\n'</code><code class="p">))</code>
<code class="p">})</code></pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Response Headers"><div class="sect1" id="idm45053596910552">
<h1>Response Headers</h1>

<p><a data-type="indexterm" data-primary="response headers" id="idm45053596856232"/>Just as your browser sends hidden information to the server in the form of
request headers, when the server responds, it also sends information back
that is not necessarily rendered or displayed by the browser. The
information typically included in response headers is metadata and server
information. <a data-type="indexterm" data-primary="Content-Type headers" id="idm45053596854856"/>We’ve already seen the <code>Content-Type</code> header,
which tells the browser what kind of content is
being transmitted (HTML, an image, CSS, JavaScript, etc.). Note that the browser will respect the
<code>Content-Type</code> header regardless of what the URL path is. So you could
serve HTML from a path of <em class="keep-together">/image.jpg</em>
or an image from a path of <em>/text.html</em>. (There’s no legitimate reason to
do this; it’s just important to understand that paths are abstract, and the
browser uses <code>Content-Type</code> to determine how to render content.) In
addition to <code>Content-Type</code>, headers can indicate whether the response is
compressed and what kind of encoding it’s using. Response headers can also
contain hints for the browser about how long it can cache the resource.
This is an important consideration for optimizing your website, and we’ll
be discussing that in detail in <a data-type="xref" href="ch17.xhtml#ch_static_content">Chapter 17</a>.</p>

<p>It is also common
for response headers to contain some information about the server,
indicating what type of server it is and sometimes even details about the
operating system. The downside about returning server information is that
it gives hackers a starting point to compromise your site. Extremely
security-conscious servers often omit this information or even provide
false information. <span class="keep-together">Disabling</span> Express’s
default <code>X-Powered-By</code> header is easy (<em>ch06/01-disable-x-powered-by.js</em> in
the companion repo):</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">disable</code><code class="p">(</code><code class="s1">'x-powered-by'</code><code class="p">)</code></pre>

<p>If you want to see the response headers, they can be found in your
browser’s developer tools. <a data-type="indexterm" data-primary="Chrome" data-secondary="response headers in" id="idm45053596820024"/>To
see the response headers in Chrome, for example:</p>
<ol>
<li>
<p>Open the JavaScript console.</p>
</li>
<li>
<p>Click the Network tab.</p>
</li>
<li>
<p>Reload the page.</p>
</li>
<li>
<p>Pick the HTML from the list of requests (it will be the first one).</p>
</li>
<li>
<p>Click the Headers tab; you will see all response headers.</p>
</li>

</ol>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Internet Media Types"><div class="sect1" id="idm45053596809768">
<h1>Internet Media Types</h1>

<p><a data-type="indexterm" data-primary="internet media types" id="idm45053596808680"/><a data-type="indexterm" data-primary="response headers" id="idm45053596807752"/>The <code>Content-Type</code> header is critically important; without it, the client
would have to painfully guess how to render the content. The format of
the <code>Content-Type</code> header is an <em>internet media type</em>, which consists of a
type, subtype, and optional parameters. For example, <code>text/html;
charset=UTF-8</code> specifies a type of “text,” a subtype of “html,” and a
character encoding of UTF-8. The Internet Assigned Numbers Authority
maintains an
<a href="https://www.iana.org/assignments/media-types/media-types.xhtml">official list
of internet media types</a>. Often, you will hear “content type,” “Internet
media type,” and “MIME type” used interchangeably. MIME (Multipurpose Internet Mail
Extensions) was a precursor of internet media types and, for the most part,
is equivalent.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Request Body"><div class="sect1" id="idm45053596839336">
<h1>Request Body</h1>

<p><a data-type="indexterm" data-primary="request body" id="idm45053596838168"/><a data-type="indexterm" data-primary="request objects" data-secondary="request body" id="idm45053596837064"/>In addition to the request headers, a request can have a <em>body</em> (just like
the body of a response is the actual content that’s being
returned). <a data-type="indexterm" data-primary="POST request" data-secondary="bodies" id="idm45053596832408"/>Normal
<code>GET</code> requests don’t have bodies, but <code>POST</code> requests usually do. The most common media type for
<code>POST</code> bodies is <code>application/x-www-form-urlencoded</code>, which is simply
encoded name/value pairs separated by ampersands (essentially the same
format as a querystring). If the <code>POST</code> needs to support file uploads, the
media type is <code>multipart/form-data</code>, which is a more complicated format.
Lastly, Ajax requests can use <code>application/json</code> for the body. We’ll learn
more about request bodies in <a data-type="xref" href="ch08.xhtml#ch_form_handling">Chapter 8</a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Request Object"><div class="sect1" id="idm45053596827336">
<h1>The Request Object</h1>

<p><a data-type="indexterm" data-primary="request objects" data-secondary="properties and methods" id="idm45053596826136"/>The <em>request object</em> (which is passed as the first parameter of a request
handler, meaning you can name it whatever you want; it is common to name it
<code>req</code> or <code>request</code>) starts its life as an instance of
<code>http.IncomingMessage</code>, a core Node object. Express adds
further functionality. Let’s look at the most useful properties and
methods of the request object (all of these methods are added by Express,
except for <code>req.headers</code> and <code>req.url</code>, which originate in Node):</p>
<dl>
<dt><code>req.params</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.params array" id="idm45053596756120"/>An array containing the <em>named route parameters</em>. We’ll
learn more about this in <a data-type="xref" href="ch14.xhtml#ch_routing">Chapter 14</a>.</p>
</dd>
<dt><code>req.query</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.query object" id="idm45053596752856"/>An object containing querystring parameters (sometimes called
<code>GET</code> parameters) as name/value pairs.</p>
</dd>
<dt><code>req.body</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.body object" id="idm45053596749864"/>An object containing <code>POST</code> parameters. It is so named
because <code>POST</code> parameters are passed in the body of the request, not in
the URL as querystring parameters are. To make <code>req.body</code> available, you’ll
need middleware that can parse the body content type, which we will learn
about in <a data-type="xref" href="ch10.xhtml#ch_middleware">Chapter 10</a>.</p>
</dd>
<dt><code>req.route</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.route parameter" id="idm45053596745352"/>Information about the currently matched route. This is primarily
useful for route <span class="keep-together">debugging.</span></p>
</dd>
<dt><code>req.cookies</code>/<code>req.signedCookies</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.cookies object" id="idm45053596742072"/><a data-type="indexterm" data-primary="req.signedCookies object" id="idm45053596741336"/>Objects containing cookie
values passed from the client. See <a data-type="xref" href="ch09.xhtml#ch_cookies_and_sessions">Chapter 9</a>.</p>
</dd>
<dt><code>req.headers</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.headers object" id="idm45053596738184"/>The request headers received from the client. This is an object whose
keys are the header names and whose values are the header values. Note that
this comes from the underlying <code>http.IncomingMessage</code> object, so you won’t
find it listed in the Express documentation.</p>
</dd>
<dt><code>req.accepts(types)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.accepts() method" id="idm45053596735224"/>A convenience method to determine whether the
client accepts a given type or types (optional <code>types</code> can be a single MIME
type, such as <code>application/json</code>, a comma-delimited list, or an array).
This method is of primary interest to those writing public APIs; it is
assumed that browsers will always accept HTML by default.</p>
</dd>
<dt><code>req.ip</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="req.ip parameter" id="idm45053596731944"/>The IP address of the client.</p>
</dd>
<dt><code>req.path</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.path parameter" id="idm45053596729656"/>The request path (without protocol, host, port, or
querystring).</p>
</dd>
<dt><code>req.hostname</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.hostname method" id="idm45053596727304"/>A convenience method that returns the hostname reported by the
client. This information can be spoofed and should not be used for
security purposes.</p>
</dd>
<dt><code>req.xhr</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.xhr property" id="idm45053596724872"/>A convenience property that returns <code>true</code> if the request
originated from an Ajax call.</p>
</dd>
<dt><code>req.protocol</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.protocol property" id="idm45053596722072"/>The protocol used in making this request (for our
purposes, it will be either <code>http</code> or <code>https</code>).</p>
</dd>
<dt><code>req.secure</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.secure property" id="idm45053596718904"/>A convenience property that returns <code>true</code> if the connection
is secure. This is equivalent to <code>req.protocol === 'https'</code>.</p>
</dd>
<dt><code>req.url</code>/<code>req.originalUrl</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="req.originalUrl property" id="idm45053596715192"/><a data-type="indexterm" data-primary="req.url property" id="idm45053596714392"/>A bit of a misnomer, these properties return
the path and querystring (they do not include protocol, host, or port).
<code>req.url</code> can be rewritten for internal routing <span class="keep-together">purposes</span>, but <code>req.originalUrl</code> is designed
to remain the original request and querystring.</p>
</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Response Object"><div class="sect1" id="idm45053596756904">
<h1>The Response Object</h1>

<p><a data-type="indexterm" data-primary="response objects" data-secondary="properties and methods" id="ix_ch-06-the_request_and_response_objects-asciidoc0"/>The <a data-type="indexterm" data-primary="http.ServerResponse object" id="idm45053596709096"/><em>response object</em> (which is passed as the second parameter of a request
handler, meaning you can name it whatever you want; it is common to name it
<code>res</code>, <code>resp</code>, or <code>response</code>) starts its life as an instance of
<code>http.ServerResponse</code>, a core Node object. Express adds
further functionality. Let’s look at the most useful properties and
methods of the response object (all of these are added by Express):</p>
<dl>
<dt><code>res.status(code)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.status()" id="idm45053596703752"/>Sets the HTTP status code. Express defaults to 200
(OK), so you will have to use this method to return a status of 404 (Not
Found) or 500 (Server Error), or any other status code you want to use.
For redirects (status codes 301, 302, 303, and 307), there is a method
<code>redirect</code>, which is preferable. Note that <code>res.status</code> returns the
response object, meaning you can chain calls: <code>res.status(404).send('Not found')</code>.</p>
</dd>
<dt><code>res.set(name, value)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.set()" id="idm45053596699816"/>Sets a response header. This is not something you
will normally be doing manually. You can also set multiple headers at once
by passing a single object argument whose keys are the header names and
whose values are the header values.</p>
</dd>
<dt><code>res.cookie(name, value, [options])</code>, <code>res.clearCookie(name, [options])</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.cookie()" id="idm45053596696808"/>Sets or clears cookies that will be stored on the client. This requires
some middleware support; see <a data-type="xref" href="ch09.xhtml#ch_cookies_and_sessions">Chapter 9</a>.</p>
</dd>
<dt><code>res.redirect([status], url)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.redirect()" id="idm45053596693560"/>Redirects the browser. The default redirect code is 302 (Found). In
general, you should minimize redirection unless you are permanently moving
a page, in which case you should use the code 301 (Moved Permanently).</p>
</dd>
<dt><code>res.send(body)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.send()" id="idm45053596690840"/>Sends a response to the client. Express defaults to a content type of
<code>text/html</code>, so if you want to change it to <code>text/plain</code> (for example),
you’ll have to call <code>res.type('text/plain’)</code> before calling <code>res.send</code>.
If <code>body</code> is an object or an array, the response is sent as JSON
(with the content type being set appropriately), though if you want to send
JSON, I recommend doing so explicitly by calling <code>res.json</code> instead.</p>
</dd>
<dt><code>res.json(json)</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="res.json()" id="idm45053596685896"/>Sends JSON to the client.</p>
</dd>
<dt><code>res.jsonp(json)</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="res.jsonp()" id="idm45053596683784"/>Sends JSONP to the client.</p>
</dd>
<dt><code>res.end()</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.end()" id="idm45053596681272"/>Ends the connection without sending a response. To learn more about the
differences between <code>res.send</code>, <code>res.json</code>, and <code>res.end</code>, see <a href="https://blog.fullstacktraining.com/res-json-vs-res-send-vs-res-end-in-express/">this article</a>
by Tamas Piros.</p>
</dd>
<dt><code>res.type(type)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.type()" id="idm45053596676760"/>A convenience method to set the <code>Content-Type</code> header. This is essentially
equivalent to <code>res.set(\'Content-Type ', type)</code>, except that it will also
attempt to map file extensions to an internet media type if you provide a
string without a slash in it. For example, <code>res.type(\'txt  ')</code> will result
in a <code>Content-Type</code> of <code>text/plain</code>. There are areas where this
functionality could be useful (for example, automatically serving disparate
multimedia files), but in general, you should avoid it in favor of
explicitly setting the correct internet media type.</p>
</dd>
<dt><code>res.format(object)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.format()" id="idm45053596672104"/>This method allows you to send different content depending on the
<code>Accept</code> request header. This is of primary use in APIs, and we will
discuss this more in <a data-type="xref" href="ch15.xhtml#ch_rest_apis_and_json">Chapter 15</a>. Here’s a simple
example: <code>res.format({'text/plain': 'hi there', 'text/html': '&lt;b&gt;hi
there&lt;/b&gt;'})</code>.</p>
</dd>
<dt><code>res.attachment([filename])</code>, <code>res.download(path, [filename], [callback])</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.attachment()" id="idm45053596667176"/><a data-type="indexterm" data-primary="res.download()" id="idm45053596666472"/>Both of these methods set a response header called <code>Content-Disposition</code>
to <code>attachment</code>; this will prompt the browser to download the content
instead of displaying it in a browser. You may specify <code>filename</code> as a
hint to the browser. With <code>res.download</code>, you can specify the file to
download, whereas <code>res.attachment</code> just sets the header; you still have to
send content to the client.</p>
</dd>
<dt><code>res.sendFile(path, [options], [callback])</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.sendFile()" id="idm45053596661880"/>This method will read a file specified by <code>path</code> and send its contents to
the client. There should be little need for this method; it’s easier to
use the <code>static</code> middleware and put files you want available to the client
in the <em>public</em> directory. However, if you want to have a different
resource served from the same URL depending on some condition, this method
could come in handy.</p>
</dd>
<dt><code>res.links(links)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.links()" id="idm45053596657928"/>Sets the <code>Links</code> response header. This is a
specialized header that has little use in most applications.</p>
</dd>
<dt><code>res.locals</code>, <code>res.render(view, [locals], callback)</code></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="res.locals object" id="idm45053596654680"/><code>res.locals</code> is an object containing <em>default</em>
context for rendering views. <a data-type="indexterm" data-primary="res.render()" id="idm45053596652712"/><code>res.render</code> will render a view using the
configured templating engine (the <code>locals</code> parameter to <code>res.render</code> shouldn’t be confused
with <code>res.locals</code>: it will override the context in <code>res.locals</code>, but
context not overridden will still be available). Note that <code>res.render</code>
will default to a response code of 200; use <code>res.status</code> to specify a
different response code. Rendering views will be covered in depth in
<a data-type="xref" href="ch07.xhtml#ch_templating">Chapter 7</a>.<a data-type="indexterm" data-startref="ix_ch-06-the_request_and_response_objects-asciidoc0" id="idm45053596647944"/></p>
</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Getting More Information"><div class="sect1" id="idm45053596704888">
<h1>Getting More Information</h1>

<p>Because of JavaScript’s prototypal inheritance, knowing exactly what you’re
dealing with can sometimes be challenging. Node provides you with objects that
Express extends, and packages that you add may also extend those. Figuring
out exactly what’s available to you can be challenging sometimes. In
general, I recommend working <span class="keep-together">backward:</span> if you’re looking for some
functionality, first check the <a href="http://expressjs.com/api.html">Express API
documentation</a>. The Express
API is pretty complete, and chances are, you’ll find what you’re looking
for there.</p>

<p>If you need information that isn’t documented, sometimes you have to dive
into the <a href="https://github.com/expressjs/express">Express source</a>. I encourage you to do this! You’ll probably find that
it’s a lot less intimidating than you might think. Here’s a quick roadmap
to where you’ll find things in the Express source:</p>
<dl>
<dt><em>lib/application.js</em></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="lib/application.js (Express source code)" id="idm45053596640856"/>The main Express interface. If you want to understand how middleware is linked in or how
views are rendered, this is the place to look.</p>
</dd>
<dt><em>lib/express.js</em></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="lib/express.js (Express source code)" id="idm45053596638344"/>A relatively short file that primarily provides the
<code>createApplication</code> function (the default export of this file), which
creates an Express application instance.</p>
</dd>
<dt><em>lib/request.js</em></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="lib/request.js (Express source code)" id="idm45053596635480"/>Extends Node’s <code>http.IncomingMessage</code> object to provide a robust request
object. For information about
all the request object properties and methods, this is where to look.</p>
</dd>
<dt><em>lib/response.js</em></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="lib/response.js (Express source code)" id="idm45053596632600"/>Extends Node’s <code>http.ServerResponse</code> object to provide the response
object. For information about response object properties and methods, this
is where to look.</p>
</dd>
<dt><em>lib/router/route.js</em></dt>
<dd>
<p>  <a data-type="indexterm" data-primary="lib/router/route.js (Express source code)" id="idm45053596629720"/>Provides basic routing support. While
routing is central to your app, this file is less than 230 lines long;
you’ll find that it’s quite simple and elegant.</p>
</dd>
</dl>

<p>As you dig into the Express source code, you’ll probably want to refer to
the <a href="https://nodejs.org/en/docs/">Node documentation</a>, especially the section
on the <code>HTTP</code> module.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Boiling It Down"><div class="sect1" id="idm45053596627032">
<h1>Boiling It Down</h1>

<p>This chapter has provided an overview of the request and response
objects, which are the meat and potatoes of an Express
application. However, the chances are that you will be
using a small subset of this functionality most of the time. So let’s
break it down by functionality you’ll be using most frequently.</p>








<section data-type="sect2" data-pdf-bookmark="Rendering Content"><div class="sect2" id="idm45053596625064">
<h2>Rendering Content</h2>

<p><a data-type="indexterm" data-primary="request objects" data-secondary="rendering content" id="idm45053596623528"/><a data-type="indexterm" data-primary="res.render()" id="idm45053596622216"/><a data-type="indexterm" data-primary="response objects" data-secondary="rendering content" id="idm45053596621544"/>When you’re rendering content, you’ll be using <code>res.render</code> most often,
which renders views within layouts, providing maximum value. <a data-type="indexterm" data-primary="res.send()" id="idm45053596620088"/>Occasionally, you may want to write a quick test page, so you might use
<code>res.send</code> if you just want a test page. <a data-type="indexterm" data-primary="req.cookies object" id="idm45053596618728"/><a data-type="indexterm" data-primary="req.query object" id="idm45053596618024"/><a data-type="indexterm" data-primary="req.signedCookies object" id="idm45053596617352"/>You may use <code>req.query</code> to
get querystring values, <code>req.session</code> to get session values, or
<code>req.cookie</code>/<code>req.signedCookies</code> to get
cookies. <a data-type="xref" href="#rendering_content_1">Example 6-1</a> to <a data-type="xref" href="#rendering_content_8">Example 6-8</a> demonstrate common
content rendering tasks.</p>
<div id="rendering_content_1" data-type="example">
<h5><span class="label">Example 6-1. </span>Basic usage (<em>ch06/02-basic-rendering.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// basic usage</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/about'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'about'</code><code class="p">)</code>
<code class="p">})</code></pre></div>
<div id="rendering_content_2" data-type="example">
<h5><span class="label">Example 6-2. </span>Response codes other than 200 (<em>ch06/03-different-response-codes.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/error'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">500</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'error'</code><code class="p">)</code>
<code class="p">})</code>

<code class="c1">// or on one line...</code>

<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/error'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">500</code><code class="p">).</code><code class="nx">render</code><code class="p">(</code><code class="s1">'error'</code><code class="p">))</code></pre></div>
<div id="rendering_content_3" data-type="example">
<h5><span class="label">Example 6-3. </span>Passing a context to a view, including querystring, cookie, and session values (<em>ch06/04-view-with-content.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/greeting'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'greeting'</code><code class="p">,</code> <code class="p">{</code>
    <code class="nx">message</code><code class="o">:</code> <code class="s1">'Hello esteemed programmer!'</code><code class="p">,</code>
    <code class="nx">style</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">query</code><code class="p">.</code><code class="nx">style</code><code class="p">,</code>
    <code class="nx">userid</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">cookies</code><code class="p">.</code><code class="nx">userid</code><code class="p">,</code>
    <code class="nx">username</code><code class="o">:</code> <code class="nx">req</code><code class="p">.</code><code class="nx">session</code><code class="p">.</code><code class="nx">username</code>
  <code class="p">})</code>
<code class="p">})</code></pre></div>
<div id="rendering_content_4" data-type="example">
<h5><span class="label">Example 6-4. </span>Rendering a view without a layout (<em>ch06/05-view-without-layout.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// the following layout doesn't have a layout file, so</code>
<code class="c1">// views/no-layout.handlebars must include all necessary HTML</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/no-layout'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'no-layout'</code><code class="p">,</code> <code class="p">{</code> <code class="nx">layout</code><code class="o">:</code> <code class="kc">null</code> <code class="p">})</code>
<code class="p">)</code></pre></div>
<div id="rendering_content_5" data-type="example">
<h5><span class="label">Example 6-5. </span>Rendering a view with a custom layout (<em>ch06/06-custom-layout.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// the layout file views/layouts/custom.handlebars will be used</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/custom-layout'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="s1">'custom-layout'</code><code class="p">,</code> <code class="p">{</code> <code class="nx">layout</code><code class="o">:</code> <code class="s1">'custom'</code> <code class="p">})</code>
<code class="p">)</code></pre></div>
<div id="rendering_content_6" data-type="example">
<h5><span class="label">Example 6-6. </span>Rendering plain text output (<em>ch06/07-plaintext-output.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/text'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">type</code><code class="p">(</code><code class="s1">'text/plain'</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s1">'this is a test'</code><code class="p">)</code>
<code class="p">})</code></pre></div>
<div id="rendering_content_7" data-type="example">
<h5><span class="label">Example 6-7. </span>Adding an error handler (<em>ch06/08-error-handler.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// this should appear AFTER all of your routes</code>
<code class="c1">// note that even if you don't need the "next" function, it must be</code>
<code class="c1">// included for Express to recognize this as an error handler</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">((</code><code class="nx">err</code><code class="p">,</code> <code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">,</code> <code class="nx">next</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s1">'** SERVER ERROR: '</code> <code class="o">+</code> <code class="nx">err</code><code class="p">.</code><code class="nx">message</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">500</code><code class="p">).</code><code class="nx">render</code><code class="p">(</code><code class="s1">'08-error'</code><code class="p">,</code>
    <code class="p">{</code> <code class="nx">message</code><code class="o">:</code> <code class="s2">"you shouldn't have clicked that!"</code> <code class="p">})</code>
<code class="p">})</code></pre></div>
<div id="rendering_content_8" data-type="example">
<h5><span class="label">Example 6-8. </span>Adding a 404 handler (<em>ch06/09-custom-404.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="c1">// this should appear AFTER all of your routes</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">((</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">404</code><code class="p">).</code><code class="nx">render</code><code class="p">(</code><code class="s1">'404'</code><code class="p">)</code>
<code class="p">)</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Processing Forms"><div class="sect2" id="idm45053596120056">
<h2>Processing Forms</h2>

<p><a data-type="indexterm" data-primary="form handling" data-secondary="processing" id="idm45053596116104"/><a data-type="indexterm" data-primary="processing forms" id="idm45053596114936"/><a data-type="indexterm" data-primary="req.body object" id="idm45053596114264"/><a data-type="indexterm" data-primary="request objects" data-secondary="processing forms" id="idm45053596113592"/>When you’re processing forms, the information from the forms will usually
be in <code>req.body</code> (or occasionally in <code>req.query</code>). <a data-type="indexterm" data-primary="req.xhr property" id="idm45053596111688"/>You may use
<code>req.xhr</code> to determine whether the request was an Ajax request or a browser
request (this will be covered in depth in <a data-type="xref" href="ch08.xhtml#ch_form_handling">Chapter 8</a>). See <a data-type="xref" href="#ajax_or_browser_1">Example 6-9</a> and <a data-type="xref" href="#ajax_or_browser_2">Example 6-10</a>. For the
following examples, you’ll need to have body parser middleware linked in:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">bodyParser</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'body-parser'</code><code class="p">)</code>
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">bodyParser</code><code class="p">.</code><code class="nx">urlencoded</code><code class="p">({</code> <code class="nx">extended</code><code class="o">:</code> <code class="kc">false</code> <code class="p">}))</code></pre>

<p>We’ll learn more about body parser middleware in <a data-type="xref" href="ch08.xhtml#ch_form_handling">Chapter 8</a>.</p>
<div id="ajax_or_browser_1" data-type="example">
<h5><span class="label">Example 6-9. </span>Basic form processing (<em>ch06/10-basic-form-processing.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">post</code><code class="p">(</code><code class="s1">'/process-contact'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`received contact from </code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb"> &lt;</code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">email</code><code class="si">}</code><code class="sb">&gt;`</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">redirect</code><code class="p">(</code><code class="mi">303</code><code class="p">,</code> <code class="s1">'10-thank-you'</code><code class="p">)</code>
<code class="p">})</code></pre></div>
<div id="ajax_or_browser_2" data-type="example">
<h5><span class="label">Example 6-10. </span>More robust form processing (<em>ch06/11-more-robust-form-processing.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">post</code><code class="p">(</code><code class="s1">'/process-contact'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="c1">// here's where we would try to save contact to database or other</code>
    <code class="c1">// persistence mechanism...for now, we'll just simulate an error</code>
    <code class="k">if</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">simulateError</code><code class="p">)</code> <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s2">"error saving contact!"</code><code class="p">)</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`contact from </code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb"> &lt;</code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">email</code><code class="si">}</code><code class="sb">&gt;`</code><code class="p">)</code>
    <code class="nx">res</code><code class="p">.</code><code class="nx">format</code><code class="p">({</code>
      <code class="s1">'text/html'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">redirect</code><code class="p">(</code><code class="mi">303</code><code class="p">,</code> <code class="s1">'/thank-you'</code><code class="p">),</code>
      <code class="s1">'application/json'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">({</code> <code class="nx">success</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}),</code>
    <code class="p">})</code>
  <code class="p">}</code> <code class="k">catch</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">// here's where we would handle any persistence failures</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="sb">`error processing contact from </code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb"> `</code> <code class="o">+</code>
      <code class="sb">`&lt;</code><code class="si">${</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">email</code><code class="si">}</code><code class="sb">&gt;`</code><code class="p">)</code>
    <code class="nx">res</code><code class="p">.</code><code class="nx">format</code><code class="p">({</code>
      <code class="s1">'text/html'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code>  <code class="nx">res</code><code class="p">.</code><code class="nx">redirect</code><code class="p">(</code><code class="mi">303</code><code class="p">,</code> <code class="s1">'/contact-error'</code><code class="p">),</code>
      <code class="s1">'application/json'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">500</code><code class="p">).</code><code class="nx">json</code><code class="p">({</code>
        <code class="nx">error</code><code class="o">:</code> <code class="s1">'error saving contact information'</code> <code class="p">}),</code>
    <code class="p">})</code>
  <code class="p">}</code>
<code class="p">})</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Providing an API"><div class="sect2" id="idm45053596009352">
<h2>Providing an API</h2>

<p><a data-type="indexterm" data-primary="APIs" data-secondary="providing" id="idm45053596008040"/><a data-type="indexterm" data-primary="request objects" data-secondary="providing an API" id="idm45053595806328"/>When you’re providing an API, much like processing forms, the parameters
will usually be in <code>req.query</code>, though you can also use
<code>req.body</code>. What’s different about APIs is that you’ll usually be returning
JSON, XML, or even plain text, instead of HTML, and you’ll often be using
less common HTTP methods like <code>PUT</code>, <code>POST</code>, and <code>DELETE</code>. Providing an
API will be covered in <a data-type="xref" href="ch15.xhtml#ch_rest_apis_and_json">Chapter 15</a>.
<a data-type="xref" href="#products_array_2">Example 6-11</a> and <a data-type="xref" href="#products_array_3">Example 6-12</a> use the following “products”
array (which would normally be retrieved from a database):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">tours</code> <code class="o">=</code> <code class="p">[</code>
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'Hood River'</code><code class="p">,</code> <code class="nx">price</code><code class="o">:</code> <code class="mf">99.99</code> <code class="p">},</code>
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="nx">name</code><code class="o">:</code> <code class="s1">'Oregon Coast'</code><code class="p">,</code> <code class="nx">price</code><code class="o">:</code> <code class="mf">149.95</code> <code class="p">},</code>
<code class="p">]</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The term <em>endpoint</em> is often used to describe a single function
in an API.</p>
</div>
<div id="products_array_2" data-type="example">
<h5><span class="label">Example 6-11. </span>Simple GET endpoint returning only JSON (<em>ch06/12-api.get.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/api/tours'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="nx">tours</code><code class="p">))</code></pre></div>

<p><a data-type="indexterm" data-primary="res.format()" id="idm45053595669224"/><a data-type="xref" href="#products_array_3">Example 6-12</a> uses the <code>res.format</code> method in Express to respond
according to the preferences of the client.</p>
<div id="products_array_3" data-type="example">
<h5><span class="label">Example 6-12. </span>GET endpoint that returns JSON, XML, or text (<em>ch06/13-api-json-xml-text.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/api/tours'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">toursXml</code> <code class="o">=</code> <code class="s1">'&lt;?xml version="1.0"?&gt;&lt;tours&gt;'</code> <code class="o">+</code>
    <code class="nx">tours</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">p</code> <code class="o">=&gt;</code>
      <code class="sb">`&lt;tour price="</code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">price</code><code class="si">}</code><code class="sb">" id="</code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">id</code><code class="si">}</code><code class="sb">"&gt;</code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb">&lt;/tour&gt;`</code>
    <code class="p">).</code><code class="nx">join</code><code class="p">(</code><code class="s1">''</code><code class="p">)</code> <code class="o">+</code> <code class="s1">'&lt;/tours&gt;'</code>
  <code class="kr">const</code> <code class="nx">toursText</code> <code class="o">=</code> <code class="nx">tours</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">p</code> <code class="o">=&gt;</code>
      <code class="sb">`</code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">id</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">name</code><code class="si">}</code><code class="sb"> (</code><code class="si">${</code><code class="nx">p</code><code class="p">.</code><code class="nx">price</code><code class="si">}</code><code class="sb">)`</code>
    <code class="p">).</code><code class="nx">join</code><code class="p">(</code><code class="s1">'\n'</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">format</code><code class="p">({</code>
    <code class="s1">'application/json'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="nx">tours</code><code class="p">),</code>
    <code class="s1">'application/xml'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">type</code><code class="p">(</code><code class="s1">'application/xml'</code><code class="p">).</code><code class="nx">send</code><code class="p">(</code><code class="nx">toursXml</code><code class="p">),</code>
    <code class="s1">'text/xml'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">type</code><code class="p">(</code><code class="s1">'text/xml'</code><code class="p">).</code><code class="nx">send</code><code class="p">(</code><code class="nx">toursXml</code><code class="p">),</code>
    <code class="s1">'text/plain'</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">type</code><code class="p">(</code><code class="s1">'text/plain'</code><code class="p">).</code><code class="nx">send</code><code class="p">(</code><code class="nx">toursXml</code><code class="p">),</code>
  <code class="p">})</code>
<code class="p">})</code></pre></div>

<p>In <a data-type="xref" href="#products_array_4">Example 6-13</a>, the PUT endpoint updates a product and returns
JSON. Parameters are passed in the request body (the <code>:id</code> in the route
string tells Express to add an <code>id</code> property to <code>req.params</code>).</p>
<div id="products_array_4" data-type="example">
<h5><span class="label">Example 6-13. </span>PUT endpoint for updating (<em>ch06/14-api-put.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="nx">put</code><code class="p">(</code><code class="s1">'/api/tour/:id'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">p</code> <code class="o">=</code> <code class="nx">tours</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="nx">p</code> <code class="o">=&gt;</code> <code class="nx">p</code><code class="p">.</code><code class="nx">id</code> <code class="o">===</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">id</code><code class="p">))</code>
  <code class="k">if</code><code class="p">(</code><code class="o">!</code><code class="nx">p</code><code class="p">)</code> <code class="k">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">status</code><code class="p">(</code><code class="mi">404</code><code class="p">).</code><code class="nx">json</code><code class="p">({</code> <code class="nx">error</code><code class="o">:</code> <code class="s1">'No such tour exists'</code> <code class="p">})</code>
  <code class="k">if</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">name</code><code class="p">)</code> <code class="nx">p</code><code class="p">.</code><code class="nx">name</code> <code class="o">=</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">name</code>
  <code class="k">if</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">price</code><code class="p">)</code> <code class="nx">p</code><code class="p">.</code><code class="nx">price</code> <code class="o">=</code> <code class="nx">req</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">price</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">({</code> <code class="nx">success</code><code class="o">:</code> <code class="kc">true</code> <code class="p">})</code>
<code class="p">})</code></pre></div>

<p>Finally, <a data-type="xref" href="#products_array_5">Example 6-14</a> shows a DELETE endpoint.</p>
<div id="products_array_5" data-type="example">
<h5><span class="label">Example 6-14. </span>DELETE endpoint for deleting (<em>ch06/15-api-del.js</em>)</h5>

<pre data-type="programlisting" data-code-language="js"><code class="nx">app</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="s1">'/api/tour/:id'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">idx</code> <code class="o">=</code> <code class="nx">tours</code><code class="p">.</code><code class="nx">findIndex</code><code class="p">(</code><code class="nx">tour</code> <code class="o">=&gt;</code> <code class="nx">tour</code><code class="p">.</code><code class="nx">id</code> <code class="o">===</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">id</code><code class="p">))</code>
  <code class="k">if</code><code class="p">(</code><code class="nx">idx</code> <code class="o">&lt;</code> <code class="mi">0</code><code class="p">)</code> <code class="k">return</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">({</code> <code class="nx">error</code><code class="o">:</code> <code class="s1">'No such tour exists.'</code> <code class="p">})</code>
  <code class="nx">tours</code><code class="p">.</code><code class="nx">splice</code><code class="p">(</code><code class="nx">idx</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>
  <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">({</code> <code class="nx">success</code><code class="o">:</code> <code class="kc">true</code> <code class="p">})</code>
<code class="p">})</code></pre></div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45053596008760">
<h1>Conclusion</h1>

<p>I hope the micro-examples in this chapter gave you a feel for the kind
of functionality that is common in an Express application. These examples
are intended to be a quick reference you can revisit in the future.</p>

<p>In the next chapter, we’ll dig deeper into templating, which we touched on
in the rendering examples in this chapter.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45053596946424"><sup><a href="ch06.xhtml#idm45053596946424-marker">1</a></sup> Ports 0–1023 are “well-known ports” reserved for <a href="http://bit.ly/33InJu7">common services</a>.</p></div></div></section></div>



  </body></html>