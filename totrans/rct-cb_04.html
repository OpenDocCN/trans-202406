<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Interaction Design" class="calibre4"><div class="preface" id="chapter04">
<h1 class="calibre9"><span class="label">Chapter 4. </span>Interaction Design</h1>


<p class="author1">In this chapter, we look at some recipes that address a bunch of typical interface problems.<a data-type="indexterm" data-primary="interaction design" id="ix_intdes" class="calibre6"/><a data-type="indexterm" data-primary="UIs (user interfaces)" data-seealso="interaction design" id="idm46634420505784" class="calibre6"/> How do you deal with errors? How do you
help people use your system? How do you create complex input sequences without writing a bunch of spaghetti code?</p>

<p class="author1">This is a collection of tips that we’ve found useful, time and again. At the end of the chapter, we look at various ways of adding
animation to your application. We take a low-tech approach where possible, and ideally, the recipes we include will add meaning to
your interface designs with a minimum of fuss.</p>






<section data-type="sect1" data-pdf-bookmark="Build a Centralized Error Handler" class="calibre4"><div class="preface" id="ch04-01">
<h1 class="calibre17">Build a Centralized Error Handler</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634420502248">
<h2 class="calibre27">Problem</h2>

<p class="author1">It’s hard to define precisely what makes good software good.<a data-type="indexterm" data-primary="interaction design" data-secondary="centralized error handler" id="ix_intdeserr" class="calibre6"/><a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" id="ix_errhnd" class="calibre6"/> But one thing that most excellent software has in common is how it
responds to errors and exceptions. There will always be exceptional, unexpected situations when people are running your code: the
network can disappear, the server can crash, the storage can become corrupted. It’s important to consider how you should deal with
these situations when they occur.</p>

<p class="author1">One approach that is almost certain to fail is to ignore the fact that error conditions occur and to hide the gory details of what
went wrong. Somewhere, somehow, you need to leave a trail of evidence that you can use to prevent that error from happening again.</p>

<p class="author1">When we’re writing server code, we might log the error details and return an appropriate message to a request. But if we’re writing
client code, we need a plan for how we’ll deal with local errors. We might choose to display the crash’s details to the user and ask
them to file an error report. We might use a third-party service like <a href="https://sentry.io" class="calibre6">Sentry.io</a> to log the details remotely.</p>

<p class="author1">Whatever our code does, it should be consistent. But how can we handle exceptions consistently in a React application?<a data-type="indexterm" data-primary="exceptions" data-secondary="handling consistently in React applications" id="idm46634420495064" class="calibre6"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634420493992">
<h2 class="calibre27">Solution</h2>

<p class="author1">In this recipe, we’re going to look at one way of creating a centralized error handler. To be clear: this code won’t automatically
capture all exceptions. It still needs to be added explicitly to JavaScript <code class="calibre21">catch</code> blocks. It’s also not a replacement for dealing
with any error from which we can otherwise recover. If an order fails because the server is down for maintenance, it is much better
to ask the user to try again later.</p>

<p class="author1">But this technique helps catch any errors for which we have not previously planned.</p>

<p class="author1">As a general principle, when something goes wrong, there are three things that you should<a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="information to pass on to end user" id="idm46634420490280" class="calibre6"/> tell the user:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">What happened</p>
</li>
<li class="calibre8">
<p class="author1">Why it happened</p>
</li>
<li class="calibre8">
<p class="author1">What they should do about it</p>
</li>
</ul>

<p class="author1">In the example we show here, we’re going to handle errors by displaying a dialog box that shows the details of a JavaScript <code class="calibre21">Error</code>
object and asks the user to email the contents to systems support. We want a simple error-handler function that we can call when an
error happens:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">setVisibleError</code><code class="go">(</code><code class="s">'Cannot do that thing'</code><code class="go">,</code> <code class="nx">errorObject</code><code class="go">)</code></pre>

<p class="author1">If we want to make the function readily available across the entire application, the usual way is by using a <em class="calibre7">context</em>.<a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="ErrorHandlerContext" id="idm46634420480808" class="calibre6"/><a data-type="indexterm" data-primary="contexts" id="idm46634420478104" class="calibre6"/> A context is
a kind of scope that we can wrap around a set of React components. Anything we put into that context is available to all the child
components. We will use our context to store the error-handler function that we can run when an error occurs.<a data-type="indexterm" data-primary="contexts" data-secondary="ErrorHandlerContext example" id="idm46634420477032" class="calibre6"/></p>

<p class="author1">We’ll call our context <code class="calibre21">ErrorHandlerContext</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">ErrorHandlerContext</code> <code class="o">=</code> <code class="nx">React</code><code class="go">.</code><code class="nx">createContext</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{})</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">ErrorHandlerContext</code></pre>

<p class="author1">To allow us to make the context available to a set of components, let’s create an 
<span class="firstname"><code class="calibre21">ErrorHandlerProvider</code></span> component<a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="ErrorHandlerProvider component" id="idm46634420432424" class="calibre6"/><a data-type="indexterm" data-primary="Provider context" data-secondary="ErrorHandlerProvider component" id="idm46634420431304" class="calibre6"/> that will create
an instance of the context and make it available to any child components we pass to it:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">ErrorHandlerContext</code> <code class="nx">from</code> <code class="s">'./ErrorHandlerContext'</code>

<code class="kr">let</code> <code class="nx">setError</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{}</code>

<code class="kr">const</code> <code class="nx">ErrorHandlerProvider</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">if</code> <code class="go">(</code><code class="nx">props</code><code class="go">.</code><code class="nx">callback</code><code class="go">)</code> <code class="go">{</code>
    <code class="nx">setError</code> <code class="o">=</code> <code class="nx">props</code><code class="go">.</code><code class="nx">callback</code>
  <code class="go">}</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">ErrorHandlerContext</code><code class="go">.</code><code class="na">Provider</code> <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">setError</code><code class="go">}&gt;</code>
      <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">children</code><code class="go">}</code>
    <code class="go">&lt;/</code><code class="nt">ErrorHandlerContext</code><code class="go">.</code><code class="na">Provider</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">ErrorHandlerProvider</code></pre>

<p class="author1">Now we need some code that says what to do when we call the error-handler function. In our case, we need some code that will respond
to an error report by displaying a dialog box containing all of the error details.<a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="ErrorContainer" id="idm46634420428264" class="calibre6"/> If you want to handle errors differently, this is
the code you need to modify:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useCallback</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">ErrorHandlerProvider</code> <code class="nx">from</code> <code class="s">'./ErrorHandlerProvider'</code>
<code class="kr">import</code> <code class="nx">ErrorDialog</code> <code class="nx">from</code> <code class="s">'./ErrorDialog'</code>

<code class="kr">const</code> <code class="nx">ErrorContainer</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">error</code><code class="go">,</code> <code class="nx">setError</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">errorTitle</code><code class="go">,</code> <code class="nx">setErrorTitle</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">action</code><code class="go">,</code> <code class="nx">setAction</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>

  <code class="kr">if</code> <code class="go">(</code><code class="nx">error</code><code class="go">)</code> <code class="go">{</code>
    <code class="nx">console</code><code class="go">.</code><code class="nx">error</code><code class="go">(</code>
      <code class="s">'An error has been thrown'</code><code class="go">,</code>
      <code class="nx">errorTitle</code><code class="go">,</code>
      <code class="nx">JSON</code><code class="go">.</code><code class="nx">stringify</code><code class="go">(</code><code class="nx">error</code><code class="go">)</code>
    <code class="go">)</code>
  <code class="go">}</code>

  <code class="kr">const</code> <code class="nx">callback</code> <code class="o">=</code> <code class="nx">useCallback</code><code class="go">((</code><code class="nx">title</code><code class="go">,</code> <code class="nx">err</code><code class="go">,</code> <code class="nx">action</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">console</code><code class="go">.</code><code class="nx">error</code><code class="go">(</code><code class="s">'ERROR RAISED '</code><code class="go">)</code>
    <code class="nx">console</code><code class="go">.</code><code class="nx">error</code><code class="go">(</code><code class="s">'Error title: '</code><code class="go">,</code> <code class="nx">title</code><code class="go">)</code>
    <code class="nx">console</code><code class="go">.</code><code class="nx">error</code><code class="go">(</code><code class="s">'Error content'</code><code class="go">,</code> <code class="nx">JSON</code><code class="go">.</code><code class="nx">stringify</code><code class="go">(</code><code class="nx">err</code><code class="go">))</code>
    <code class="nx">setError</code><code class="go">(</code><code class="nx">err</code><code class="go">)</code>
    <code class="nx">setErrorTitle</code><code class="go">(</code><code class="nx">title</code><code class="go">)</code>
    <code class="nx">setAction</code><code class="go">(</code><code class="nx">action</code><code class="go">)</code>
  <code class="go">},</code> <code class="go">[])</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">ErrorHandlerProvider</code> <code class="na">callback</code><code class="o">=</code><code class="go">{</code><code class="nx">callback</code><code class="go">}&gt;</code>
      <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">children</code><code class="go">}</code>

      <code class="go">{</code><code class="nx">error</code> <code class="o">&amp;&amp;</code> <code class="go">(</code>
        <code class="go">&lt;</code><code class="nt">ErrorDialog</code>
          <code class="na">title</code><code class="o">=</code><code class="go">{</code><code class="nx">errorTitle</code><code class="go">}</code>
          <code class="na">onClose</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
            <code class="nx">setError</code><code class="go">(</code><code class="kr">null</code><code class="go">)</code>
            <code class="nx">setErrorTitle</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
          <code class="go">}}</code>
          <code class="na">action</code><code class="o">=</code><code class="go">{</code><code class="nx">action</code><code class="go">}</code>
          <code class="na">error</code><code class="o">=</code><code class="go">{</code><code class="nx">error</code><code class="go">}</code>
        <code class="go">/&gt;</code>
      <code class="go">)}</code>
    <code class="go">&lt;/</code><code class="nt">ErrorHandlerProvider</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">ErrorContainer</code></pre>

<p class="author1">The <code class="calibre21">ErrorContainer</code> displays the details using an <code class="calibre21">ErrorDialog</code>. We won’t go into the details of the code for <code class="calibre21">ErrorDialog</code>
here as this is the code that you are most likely to replace with your implementation.<sup class="calibre34"><a data-type="noteref" id="idm46634420299832-marker" href="ch04.xhtml#idm46634420299832" class="calibre35">1</a></sup></p>

<p class="author1">We need to wrap the bulk of our application in an <code class="calibre21">ErrorContainer</code>. <a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="wrapping bulk of application in ErrorContainer" id="idm46634420046024" class="calibre6"/>Any components inside the <code class="calibre21">ErrorContainer</code> will be able to call
the error handler:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="nx">ErrorContainer</code> <code class="nx">from</code> <code class="s">'./ErrorContainer'</code>
<code class="kr">import</code> <code class="nx">ClockIn</code> <code class="nx">from</code> <code class="s">'./ClockIn'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">ErrorContainer</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">ClockIn</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">ErrorContainer</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">How does a component use the error handler? We’ll create a custom hook called <code class="calibre21">useErrorHandler()</code>, which will <a data-type="indexterm" data-primary="useErrorHandler hook" id="idm46634419911160" class="calibre6"/><a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-tertiary="useErrorHandler hook" id="idm46634419910552" class="calibre6"/>get the error-handler
function out of the context and return it:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">ErrorHandlerContext</code> <code class="nx">from</code> <code class="s">'./ErrorHandlerContext'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">useContext</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">useErrorHandler</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="nx">useContext</code><code class="go">(</code><code class="nx">ErrorHandlerContext</code><code class="go">)</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">useErrorHandler</code></pre>

<p class="author1">That’s quite a complex set of code, but now we come to use the error handler; it’s very simple. This example code makes a
network request when a user clicks a button. If the network request fails, then the details of the error are passed to the error
handler:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">useErrorHandler</code> <code class="nx">from</code> <code class="s">'./useErrorHandler'</code>
<code class="kr">import</code> <code class="nx">axios</code> <code class="nx">from</code> <code class="s">'axios'</code>

<code class="kr">const</code> <code class="nx">ClockIn</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="nx">setVisibleError</code> <code class="o">=</code> <code class="nx">useErrorHandler</code><code class="go">()</code>

  <code class="kr">const</code> <code class="nx">doClockIn</code> <code class="o">=</code> <code class="nx">async</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">try</code> <code class="go">{</code>
      <code class="nx">await</code> <code class="nx">axios</code><code class="go">.</code><code class="nx">put</code><code class="go">(</code><code class="s">'/clockTime'</code><code class="go">)</code>
    <code class="go">}</code> <code class="kr">catch</code> <code class="go">(</code><code class="nx">err</code><code class="go">)</code> <code class="go">{</code>
      <code class="nx">setVisibleError</code><code class="go">(</code><code class="s">'Unable to record work start time'</code><code class="go">,</code> <code class="nx">err</code><code class="go">)</code>
    <code class="go">}</code>
  <code class="go">}</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;&gt;</code>
      <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Click</code> <code class="nx">Button</code> <code class="nx">to</code> <code class="nx">Record</code> <code class="nx">Start</code> <code class="nx">Time</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">doClockIn</code><code class="go">}&gt;</code><code class="nx">Start</code> <code class="nx">work</code><code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
    <code class="go">&lt;/&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">ClockIn</code></pre>

<p class="author1">You can see what the app looks like in <a data-type="xref" href="#ch04_image_1" class="calibre6">Figure 4-1</a>.</p>

<figure class="calibre29"><div id="ch04_image_1" class="figure">
<img src="Images/recb_0401.png" alt="" class="calibre80"/>
<h6 class="calibre30"><span class="firstname">Figure 4-1. </span>The time-recording app</h6>
</div></figure>

<p class="author1">When you click the button, the network request fails because the server code doesn’t exist. <a data-type="xref" href="#ch04_image_2" class="calibre6">Figure 4-2</a> shows the error dialog that
appears. Notice that it shows what went wrong, why it went wrong, and what the user should do about it.<a data-type="indexterm" data-primary="exceptions" data-secondary="network request throwing exception" id="idm46634419769624" class="calibre6"/></p>

<figure class="calibre29"><div id="ch04_image_2" class="figure">
<img src="Images/recb_0402.png" alt="" class="calibre81"/>
<h6 class="calibre30"><span class="firstname">Figure 4-2. </span>When the network request throws an exception, we pass it to the error 
<span class="firstname">handler</span></h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634420493080">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Of all the recipes that we’ve created over the years, this one has saved the most time. During development, code often breaks,
and if the only evidence of a failure is a stack trace hidden away inside the JavaScript console, you are likely to miss it.</p>

<p class="author1">Significantly, when some piece of infrastructure (networks, gateways, servers, databases) fails, this small amount of code can save
you untold hours tracking down the cause.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/wUM7Q" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="centralized error handler" data-startref="ix_intdeserr" id="idm46634419763240" class="calibre6"/><a data-type="indexterm" data-primary="error handlers" data-secondary="building centralized error handler" data-startref="ix_errhnd" id="idm46634419761992" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create an Interactive Help Guide" class="calibre4"><div class="preface" id="ch04-02">
<h1 class="calibre17">Create an Interactive Help Guide</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634419759128">
<h2 class="calibre27">Problem</h2>

<p class="author1">Tim Berners-Lee deliberately designed the web to have very few features.<a data-type="indexterm" data-primary="interaction design" data-secondary="creating interactive help guide" id="ix_intdeshelp" class="calibre6"/> It has a simple protocol (HTTP), and it originally had a
straightforward markup language (HTML).<a data-type="indexterm" data-primary="help system, interactive" id="ix_help" class="calibre6"/> The lack of complexity meant that new users of websites immediately knew how to use them. If
you saw something that looked like a hyperlink, you could click on it and go to another page.</p>

<p class="author1">But rich JavaScript applications have changed all that. No longer are web applications a collection of hyperlinked web pages.
Instead, they resemble old desktop applications; they are more powerful and feature-rich, but the downside is that they are now far
more complex to use.</p>

<p class="author1">How do you build an interactive guide into your application?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634419753656">
<h2 class="calibre27">Solution</h2>

<p class="author1">We’re going to build a simple help system that you can overlay onto an existing application.<a data-type="indexterm" data-primary="help system, interactive" data-secondary="showing sequence of help messages when user asks" id="idm46634419751816" class="calibre6"/> When the user opens the help, they will
see a series of pop-up notes that describe how to use the various features they can see on the page, as shown in <a data-type="xref" href="#ch04_image_3" class="calibre6">Figure 4-3</a>.</p>

<figure class="calibre29"><div id="ch04_image_3" class="figure">
<img src="Images/recb_0403.png" alt="" class="calibre81"/>
<h6 class="calibre30"><span class="firstname">Figure 4-3. </span>Show a sequence of help messages when the user asks</h6>
</div></figure>

<p class="author1">We want something that will be easy to maintain and will provide help only for visible components. That sounds like quite a big
task, so let’s begin by first constructing a component that will display a pop-up help <a data-type="indexterm" data-primary="help system, interactive" data-secondary="HelpBubble component, displaying pop-up help message" id="idm46634419747032" class="calibre6"/>message:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">Popper</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'@material-ui/core'</code>
<code class="kr">import</code> <code class="s">'./HelpBubble.css'</code>

<code class="kr">const</code> <code class="nx">HelpBubble</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="nx">props</code><code class="go">.</code><code class="nx">forElement</code>
    <code class="o">?</code> <code class="nb">document</code><code class="go">.</code><code class="nx">querySelector</code><code class="go">(</code><code class="nx">props</code><code class="go">.</code><code class="nx">forElement</code><code class="go">)</code>
    <code class="o">:</code> <code class="kr">null</code>

  <code class="kr">return</code> <code class="nx">element</code> <code class="o">?</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">Popper</code>
      <code class="na">className</code><code class="o">=</code><code class="s">"HelpBubble-container"</code>
      <code class="na">open</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">open</code><code class="go">}</code>
      <code class="na">anchorEl</code><code class="o">=</code><code class="go">{</code><code class="nx">element</code><code class="go">}</code>
      <code class="na">placement</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">placement</code> <code class="o">||</code> <code class="s">'bottom-start'</code><code class="go">}</code>
    <code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"HelpBubble-close"</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code><code class="go">}&gt;</code>
        <code class="nx">Close</code> <code class="go">[</code><code class="nx">X</code><code class="go">]</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">content</code><code class="go">}</code>
      <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"HelpBubble-controls"</code><code class="go">&gt;</code>
        <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">previousLabel</code> <code class="o">?</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code>
            <code class="na">className</code><code class="o">=</code><code class="s">"HelpBubble-control HelpBubble-previous"</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">onPrevious</code><code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="o">&amp;</code><code class="nx">lt</code><code class="go">;</code> <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">previousLabel</code><code class="go">}</code>
          <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">)</code> <code class="o">:</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code><code class="go">&gt;</code><code class="o">&amp;</code><code class="nx">nbsp</code><code class="go">;&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">)}</code>
        <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">nextLabel</code> <code class="o">?</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code>
            <code class="na">className</code><code class="o">=</code><code class="s">"HelpBubble-control HelpBubble-next"</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">onNext</code><code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">nextLabel</code><code class="go">}</code> <code class="o">&amp;</code><code class="nx">gt</code><code class="go">;</code>
          <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">)</code> <code class="o">:</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code><code class="go">&gt;</code><code class="o">&amp;</code><code class="nx">nbsp</code><code class="go">;&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">)}</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">Popper</code><code class="go">&gt;</code>
  <code class="go">)</code> <code class="o">:</code> <code class="kr">null</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">HelpBubble</code></pre>

<p class="author1">We’re using the <code class="calibre21">Popper</code> component from the <code class="calibre21">@material-ui</code> library.<a data-type="indexterm" data-primary="Popper component" id="idm46634419742056" class="calibre6"/><a data-type="indexterm" data-primary="Material-UI library" data-secondary="Popper component" id="idm46634419741352" class="calibre6"/> The <code class="calibre21">Popper</code> component can be anchored on the page, next to
some other component. Our <code class="calibre21">HelpBub⁠ble</code> takes a <code class="calibre21">forElement</code> string, which will represent a CSS selector such as 
<span class="firstname"><code class="calibre21">.class-name</code></span> or <code class="calibre21">#some-id</code>. <a data-type="indexterm" data-primary="selectors" data-secondary="associating screen events with pop-up help messages" id="idm46634419486552" class="calibre6"/>We will use selectors to associate things on the screen with pop-up messages.</p>

<p class="author1">Now that we have a pop-up message component, we’ll need something that coordinates a sequence of <code class="calibre21">HelpBubbles</code>. <a data-type="indexterm" data-primary="help system, interactive" data-secondary="HelpSequence, coordinating HelpBubbles" id="idm46634419484536" class="calibre6"/>We’ll call this the
<code class="calibre21">HelpSequence</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useEffect</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">import</code> <code class="nx">HelpBubble</code> <code class="nx">from</code> <code class="s">'./HelpBubble'</code>

<code class="kr">function</code> <code class="nx">isVisible</code><code class="go">(</code><code class="nx">e</code><code class="go">)</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="o">!!</code><code class="go">(</code>
    <code class="nx">e</code><code class="go">.</code><code class="nx">offsetWidth</code> <code class="o">||</code>
    <code class="nx">e</code><code class="go">.</code><code class="nx">offsetHeight</code> <code class="o">||</code>
    <code class="nx">e</code><code class="go">.</code><code class="nx">getClientRects</code><code class="go">().</code><code class="nx">length</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">const</code> <code class="nx">HelpSequence</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">position</code><code class="go">,</code> <code class="nx">setPosition</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">sequence</code><code class="go">,</code> <code class="nx">setSequence</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>

  <code class="nx">useEffect</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">if</code> <code class="go">(</code><code class="nx">props</code><code class="go">.</code><code class="nx">sequence</code><code class="go">)</code> <code class="go">{</code>
      <code class="kr">const</code> <code class="nx">filter</code> <code class="o">=</code> <code class="nx">props</code><code class="go">.</code><code class="nx">sequence</code><code class="go">.</code><code class="nx">filter</code><code class="go">((</code><code class="nx">i</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="kr">if</code> <code class="go">(</code><code class="o">!</code><code class="nx">i</code><code class="go">.</code><code class="nx">forElement</code><code class="go">)</code> <code class="go">{</code>
          <code class="kr">return</code> <code class="kr">false</code>
        <code class="go">}</code>
        <code class="kr">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="nb">document</code><code class="go">.</code><code class="nx">querySelector</code><code class="go">(</code><code class="nx">i</code><code class="go">.</code><code class="nx">forElement</code><code class="go">)</code>
        <code class="kr">if</code> <code class="go">(</code><code class="o">!</code><code class="nx">element</code><code class="go">)</code> <code class="go">{</code>
          <code class="kr">return</code> <code class="kr">false</code>
        <code class="go">}</code>
        <code class="kr">return</code> <code class="nx">isVisible</code><code class="go">(</code><code class="nx">element</code><code class="go">)</code>
      <code class="go">})</code>
      <code class="nx">setSequence</code><code class="go">(</code><code class="nx">filter</code><code class="go">)</code>
    <code class="go">}</code> <code class="kr">else</code> <code class="go">{</code>
      <code class="nx">setSequence</code><code class="go">(</code><code class="kr">null</code><code class="go">)</code>
    <code class="go">}</code>
  <code class="go">},</code> <code class="go">[</code><code class="nx">props</code><code class="go">.</code><code class="nx">sequence</code><code class="go">,</code> <code class="nx">props</code><code class="go">.</code><code class="nx">open</code><code class="go">])</code>

  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">sequence</code> <code class="o">&amp;&amp;</code> <code class="nx">sequence</code><code class="go">[</code><code class="nx">position</code><code class="go">]</code>

  <code class="nx">useEffect</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">setPosition</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>
  <code class="go">},</code> <code class="go">[</code><code class="nx">props</code><code class="go">.</code><code class="nx">open</code><code class="go">])</code>

  <code class="kr">const</code> <code class="nx">onNext</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code>
    <code class="nx">setPosition</code><code class="go">((</code><code class="nx">p</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="kr">if</code> <code class="go">(</code><code class="nx">p</code> <code class="o">===</code> <code class="nx">sequence</code><code class="go">.</code><code class="nx">length</code> <code class="o">-</code> <code class="mi">1</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code> <code class="o">&amp;&amp;</code> <code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code><code class="go">()</code>
      <code class="go">}</code>
      <code class="kr">return</code> <code class="nx">p</code> <code class="o">+</code> <code class="mi">1</code>
    <code class="go">})</code>

  <code class="kr">const</code> <code class="nx">onPrevious</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code>
    <code class="nx">setPosition</code><code class="go">((</code><code class="nx">p</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="kr">if</code> <code class="go">(</code><code class="nx">p</code> <code class="o">===</code> <code class="mi">0</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code> <code class="o">&amp;&amp;</code> <code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code><code class="go">()</code>
      <code class="go">}</code>
      <code class="kr">return</code> <code class="nx">p</code> <code class="o">-</code> <code class="mi">1</code>
    <code class="go">})</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"HelpSequence-container"</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">data</code> <code class="o">&amp;&amp;</code> <code class="go">(</code>
        <code class="go">&lt;</code><code class="nt">HelpBubble</code>
          <code class="na">open</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">open</code><code class="go">}</code>
          <code class="na">forElement</code><code class="o">=</code><code class="go">{</code><code class="nx">data</code><code class="go">.</code><code class="nx">forElement</code><code class="go">}</code>
          <code class="na">placement</code><code class="o">=</code><code class="go">{</code><code class="nx">data</code><code class="go">.</code><code class="nx">placement</code><code class="go">}</code>
          <code class="na">onClose</code><code class="o">=</code><code class="go">{</code><code class="nx">props</code><code class="go">.</code><code class="nx">onClose</code><code class="go">}</code>
          <code class="na">previousLabel</code><code class="o">=</code><code class="go">{</code><code class="nx">position</code> <code class="o">&gt;</code> <code class="mi">0</code> <code class="o">&amp;&amp;</code> <code class="s">'Previous'</code><code class="go">}</code>
          <code class="na">nextLabel</code><code class="o">=</code><code class="go">{</code>
            <code class="nx">position</code> <code class="o">&lt;</code> <code class="nx">sequence</code><code class="go">.</code><code class="nx">length</code> <code class="o">-</code> <code class="mi">1</code> <code class="o">?</code> <code class="s">'Next'</code> <code class="o">:</code> <code class="s">'Finish'</code>
          <code class="go">}</code>
          <code class="na">onPrevious</code><code class="o">=</code><code class="go">{</code><code class="nx">onPrevious</code><code class="go">}</code>
          <code class="na">onNext</code><code class="o">=</code><code class="go">{</code><code class="nx">onNext</code><code class="go">}</code>
          <code class="na">content</code><code class="o">=</code><code class="go">{</code><code class="nx">data</code><code class="go">.</code><code class="nx">text</code><code class="go">}</code>
        <code class="go">/&gt;</code>
      <code class="go">)}</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">HelpSequence</code></pre>

<p class="author1">The <code class="calibre21">HelpSequence</code> takes an array of JavaScript objects like this:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">[</code>
    <code class="go">{</code><code class="nx">forElement</code><code class="o">:</code> <code class="s">"p"</code><code class="go">,</code>
        <code class="nx">text</code><code class="o">:</code> <code class="s">"This is some introductory text telling you how to start"</code><code class="go">},</code>
    <code class="go">{</code><code class="nx">forElement</code><code class="o">:</code> <code class="s">".App-link"</code><code class="go">,</code> <code class="nx">text</code><code class="o">:</code> <code class="s">"This will show you how to use React"</code><code class="go">},</code>
    <code class="go">{</code><code class="nx">forElement</code><code class="o">:</code> <code class="s">".App-nowhere"</code><code class="go">,</code> <code class="nx">text</code><code class="o">:</code> <code class="s">"This help text will never appear"</code><code class="go">},</code>
<code class="go">]</code></pre>

<p class="author1">and converts it into a dynamic sequence of <code class="calibre21">HelpBubbles</code>. It will show a <code class="calibre21">HelpBubble</code> only if it can find an element that matches
the <code class="calibre21">forElement</code> selector. It then places the <code class="calibre21">HelpBubble</code> next to the element and shows the help text.</p>

<p class="author1">Let’s add a <code class="calibre21">HelpSequence</code> to the default <em class="calibre7">App.js</em> code <a data-type="indexterm" data-primary="help system, interactive" data-secondary="HelpSequence, adding to default App.js code" id="idm46634419056776" class="calibre6"/><a data-type="indexterm" data-primary="create-react-app tool" data-secondary="HelpSequence, adding to default App.js code" id="idm46634419055704" class="calibre6"/>generated by <code class="calibre21">create-react-app</code>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s">'./logo.svg'</code>
<code class="kr">import</code> <code class="nx">HelpSequence</code> <code class="nx">from</code> <code class="s">'./HelpSequence'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">showHelp</code><code class="go">,</code> <code class="nx">setShowHelp</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">header</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-header"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="go">{</code><code class="nx">logo</code><code class="go">}</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-logo"</code> <code class="na">alt</code><code class="o">=</code><code class="s">"logo"</code> <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="nx">Edit</code> <code class="go">&lt;</code><code class="nt">code</code><code class="go">&gt;</code><code class="nx">src</code><code class="o">/</code><code class="nx">App</code><code class="go">.</code><code class="nx">js</code><code class="go">&lt;/</code><code class="nt">code</code><code class="go">&gt;</code> <code class="nx">and</code> <code class="nx">save</code> <code class="nx">to</code> <code class="nx">reload</code><code class="go">.</code>
        <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">a</code>
          <code class="na">className</code><code class="o">=</code><code class="s">"App-link"</code>
          <code class="na">href</code><code class="o">=</code><code class="s">"https://reactjs.org"</code>
          <code class="na">target</code><code class="o">=</code><code class="s">"_blank"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"noopener noreferrer"</code>
        <code class="go">&gt;</code>
          <code class="nx">Learn</code> <code class="nx">React</code>
        <code class="go">&lt;/</code><code class="nt">a</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">header</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setShowHelp</code><code class="go">(</code><code class="kr">true</code><code class="go">)}&gt;</code><code class="nx">Show</code> <code class="nx">help</code><code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">HelpSequence</code>
        <code class="na">sequence</code><code class="o">=</code><code class="go">{[</code>
          <code class="go">{</code>
            <code class="nx">forElement</code><code class="o">:</code> <code class="s">'p'</code><code class="go">,</code>
            <code class="nx">text</code><code class="o">:</code> <code class="s">'This is some introductory text telling you how to start'</code><code class="go">,</code>
          <code class="go">},</code>
          <code class="go">{</code>
            <code class="nx">forElement</code><code class="o">:</code> <code class="s">'.App-link'</code><code class="go">,</code>
            <code class="nx">text</code><code class="o">:</code> <code class="s">'This will show you how to use React'</code><code class="go">,</code>
          <code class="go">},</code>
          <code class="go">{</code>
            <code class="nx">forElement</code><code class="o">:</code> <code class="s">'.App-nowhere'</code><code class="go">,</code>
            <code class="nx">text</code><code class="o">:</code> <code class="s">'This help text will never appear'</code><code class="go">,</code>
          <code class="go">},</code>
        <code class="go">]}</code>
        <code class="na">open</code><code class="o">=</code><code class="go">{</code><code class="nx">showHelp</code><code class="go">}</code>
        <code class="na">onClose</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setShowHelp</code><code class="go">(</code><code class="kr">false</code><code class="go">)}</code>
      <code class="go">/&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">To begin with, we cannot see anything different other than a help button (see <a data-type="xref" href="#ch04_image_4" class="calibre6">Figure 4-4</a>).</p>

<figure class="calibre29"><div id="ch04_image_4" class="figure">
<img src="Images/recb_0404.png" alt="" class="calibre81"/>
<h6 class="calibre30"><span class="firstname">Figure 4-4. </span>The application, when it first loads</h6>
</div></figure>

<p class="author1">When the user clicks the help button, the first help topic appears, as shown in <a data-type="xref" href="#ch04_image_5" class="calibre6">Figure 4-5</a>.</p>

<figure class="calibre29"><div id="ch04_image_5" class="figure">
<img src="Images/recb_0403.png" alt="" class="calibre81"/>
<h6 class="calibre30"><span class="firstname">Figure 4-5. </span>When the user clicks the help button, the help bubble appears for the first match</h6>
</div></figure>

<p class="author1"><a data-type="xref" href="#ch04_image_6" class="calibre6">Figure 4-6</a> shows the help moving to the next element when the user clicks Next. The user can continue to move from item to item
until there are no more matching elements visible.</p>

<figure class="calibre29"><div id="ch04_image_6" class="figure">
<img src="Images/recb_0406.png" alt="" class="calibre81"/>
<h6 class="calibre30"><span class="firstname">Figure 4-6. </span>The final element has a <em class="calibre7">Finish</em> button</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634419753032">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Adding interactive help to your application makes your user interface <em class="calibre7">discoverable</em>.<a data-type="indexterm" data-primary="UIs (user interfaces)" data-secondary="making discoverable" id="idm46634418714696" class="calibre6"/><a data-type="indexterm" data-primary="discoverable UI" id="idm46634418713688" class="calibre6"/> Developers spend a lot of their time adding
functionality to applications that people might never use, simply because they don’t know that it’s there.<a data-type="indexterm" data-primary="user interfaces" data-see="UIs" id="idm46634418712712" class="calibre6"/></p>

<p class="author1">The implementation in this recipe displays the help as simple plain text. You might consider<a data-type="indexterm" data-primary="Markdown" data-secondary="using to display help messages" id="idm46634418711272" class="calibre6"/> using Markdown, as that will allow for
a richer experience, and help topics can then include links to other more expansive help pages.<sup class="calibre34"><a data-type="noteref" id="idm46634418710008-marker" href="ch04.xhtml#idm46634418710008" class="calibre35">2</a></sup></p>

<p class="author1">The help topics are automatically limited to just those elements that are visible on the page. You could choose to create either a
separate help sequence for each page or a single large help sequence that will automatically adapt to the user’s
current view of the interface.</p>

<p class="author1">Finally, a help system like this is ideally suited for storage in a headless CMS, which will allow you to update help dynamically,
without the need to create a new deployment each time.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/CsiMN" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="creating interactive help guide" data-startref="ix_intdeshelp" id="idm46634418706184" class="calibre6"/><a data-type="indexterm" data-primary="help system, interactive" data-startref="ix_help" id="idm46634418704888" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Use Reducers for Complex Interactions" class="calibre4"><div class="preface" id="ch04-03">
<h1 class="calibre17">Use Reducers for Complex Interactions</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634418702376">
<h2 class="calibre27">Problem</h2>

<p class="author1">Applications frequently need users to follow a sequence of actions.<a data-type="indexterm" data-primary="deletion sequence, using reducers to manage" id="ix_delred" class="calibre6"/><a data-type="indexterm" data-primary="interaction design" data-secondary="using reducers for complex interactions" id="ix_intdesred" class="calibre6"/><a data-type="indexterm" data-primary="reducers" data-secondary="using for complex interactions" id="ix_redint" class="calibre6"/> They might be completing the steps in a wizard, or they might need to log in and confirm some dangerous operation (see <a data-type="xref" href="#ch04_image_7" class="calibre6">Figure 4-7</a>).</p>

<figure class="calibre29"><div id="ch04_image_7" class="figure">
<img src="Images/recb_0407.png" alt="" class="calibre82"/>
<h6 class="calibre30"><span class="firstname">Figure 4-7. </span>This deletion process requires logging in and then confirming the deletion</h6>
</div></figure>

<p class="author1">Not only will the user need to perform a sequence of steps, but the steps might be conditional. If the user has logged in recently,
they perhaps don’t need to log in again. They might want to cancel partway through the sequence.</p>

<p class="author1">If you model the complex sequences inside your components, you can soon find your application is full of spaghetti code.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634418692760">
<h2 class="calibre27">Solution</h2>

<p class="author1">We are going to use a reducer to manage a complex sequence of operations. We introduced reducers for managing state in <a data-type="xref" href="ch03.xhtml#chapter03" class="calibre6">Chapter 3</a>. A
<em class="calibre7">reducer</em> is a function that accepts a state object and an action. The reducer uses the action to decide how to change the state,
and it must have no side effects.</p>

<p class="author1">Because reducers have no user-interface code, they are perfect for managing gnarly pieces of interrelated state without worrying
about the visual appearance. They are particularly amenable to unit testing.</p>

<p class="author1">For example, let’s say we implement the deletion sequence mentioned at the start of this recipe.<a data-type="indexterm" data-primary="state" data-secondary="complex, managing with reducers" id="idm46634418688248" class="calibre6"/><a data-type="indexterm" data-primary="test-driven development (TDD)" id="idm46634418687304" class="calibre6"/><a data-type="indexterm" data-primary="reducers" data-secondary="using for complex interactions" data-tertiary="deletionReducer example" id="ix_redintdel" class="calibre6"/> We can begin in classic test-driven
style by writing a unit test:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">deletionReducer</code> <code class="nx">from</code> <code class="s">'./deletionReducer'</code>

<code class="nx">describe</code><code class="go">(</code><code class="s">'deletionReducer'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">it</code><code class="go">(</code><code class="s">'should show the login dialog if we are not logged in'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">const</code> <code class="nx">actual</code> <code class="o">=</code> <code class="nx">deletionReducer</code><code class="go">({},</code> <code class="go">{</code> <code class="nx">type</code><code class="o">:</code> <code class="s">'START_DELETION'</code> <code class="go">})</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">actual</code><code class="go">.</code><code class="nx">showLogin</code><code class="go">).</code><code class="nx">toBe</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">actual</code><code class="go">.</code><code class="nx">message</code><code class="go">).</code><code class="nx">toBe</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">actual</code><code class="go">.</code><code class="nx">deleteButtonDisabled</code><code class="go">).</code><code class="nx">toBe</code><code class="go">(</code><code class="kr">true</code><code class="go">)</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">actual</code><code class="go">.</code><code class="nx">loginError</code><code class="go">).</code><code class="nx">toBe</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
    <code class="nx">expect</code><code class="go">(</code><code class="nx">actual</code><code class="go">.</code><code class="nx">showConfirmation</code><code class="go">).</code><code class="nx">toBe</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>
  <code class="go">})</code>
<code class="go">})</code></pre>

<p class="author1">Here our reducer function is going to be called <code class="calibre21">deletionReducer</code>. We pass it an empty object (<code class="calibre21">{}</code>) and<a data-type="indexterm" data-primary="empty object ({})" id="idm46634418601512" class="calibre6"/><a data-type="indexterm" data-primary="objects" data-secondary="empty" id="idm46634418600984" class="calibre6"/> an action that says we want
to start the deletion process (<code class="calibre21">{type: 'START_DELETION'}</code>). We then say that we expect the new version of the state to have a
<code class="calibre21">showLogin</code> value of <code class="calibre21">true</code>, a <code class="calibre21">showConfirmation</code> value of <code class="calibre21">false</code>, and so on.</p>

<p class="author1">We can then implement the code for a reducer to do just that:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">function</code> <code class="nx">deletionReducer</code><code class="go">(</code><code class="nx">state</code><code class="go">,</code> <code class="nx">action</code><code class="go">)</code> <code class="go">{</code>
  <code class="kr">switch</code> <code class="go">(</code><code class="nx">action</code><code class="go">.</code><code class="nx">type</code><code class="go">)</code> <code class="go">{</code>
    <code class="kr">case</code> <code class="s">'START_DELETION'</code><code class="o">:</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showLogin</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
        <code class="nx">message</code><code class="o">:</code> <code class="s">''</code><code class="go">,</code>
        <code class="nx">deleteButtonDisabled</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
        <code class="nx">loginError</code><code class="o">:</code> <code class="s">''</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">default</code><code class="o">:</code>
      <code class="kr">return</code> <code class="kr">null</code> <code class="c">// Or anything</code>
  <code class="go">}</code>
<code class="go">}</code></pre>

<p class="author1">At first, we are merely setting the state attributes to values that pass the test. As we add more and more tests, our reducer
improves as it handles more situations.</p>

<p class="author1">Eventually, we get something that looks like this:<sup class="calibre34"><a data-type="noteref" id="idm46634418414536-marker" href="ch04.xhtml#idm46634418414536" class="calibre35">3</a></sup></p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">function</code> <code class="nx">deletionReducer</code><code class="go">(</code><code class="nx">state</code><code class="go">,</code> <code class="nx">action</code><code class="go">)</code> <code class="go">{</code>
  <code class="kr">switch</code> <code class="go">(</code><code class="nx">action</code><code class="go">.</code><code class="nx">type</code><code class="go">)</code> <code class="go">{</code>
    <code class="kr">case</code> <code class="s">'START_DELETION'</code><code class="o">:</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showLogin</code><code class="o">:</code> <code class="o">!</code><code class="nx">state</code><code class="go">.</code><code class="nx">loggedIn</code><code class="go">,</code>
        <code class="nx">message</code><code class="o">:</code> <code class="s">''</code><code class="go">,</code>
        <code class="nx">deleteButtonDisabled</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
        <code class="nx">loginError</code><code class="o">:</code> <code class="s">''</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="o">!!</code><code class="nx">state</code><code class="go">.</code><code class="nx">loggedIn</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">case</code> <code class="s">'CANCEL_DELETION'</code><code class="o">:</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showLogin</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">showResult</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">message</code><code class="o">:</code> <code class="s">'Deletion canceled'</code><code class="go">,</code>
        <code class="nx">deleteButtonDisabled</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">case</code> <code class="s">'LOGIN'</code><code class="o">:</code>
      <code class="kr">const</code> <code class="nx">passwordCorrect</code> <code class="o">=</code> <code class="nx">action</code><code class="go">.</code><code class="nx">payload</code> <code class="o">===</code> <code class="s">'swordfish'</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showLogin</code><code class="o">:</code> <code class="o">!</code><code class="nx">passwordCorrect</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="nx">passwordCorrect</code><code class="go">,</code>
        <code class="nx">loginError</code><code class="o">:</code> <code class="nx">passwordCorrect</code> <code class="o">?</code> <code class="s">''</code> <code class="o">:</code> <code class="s">'Invalid password'</code><code class="go">,</code>
        <code class="nx">loggedIn</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">case</code> <code class="s">'CONFIRM_DELETION'</code><code class="o">:</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">showResult</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
        <code class="nx">message</code><code class="o">:</code> <code class="s">'Widget deleted'</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">case</code> <code class="s">'FINISH'</code><code class="o">:</code>
      <code class="kr">return</code> <code class="go">{</code>
        <code class="go">...</code><code class="nx">state</code><code class="go">,</code>
        <code class="nx">showLogin</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">showConfirmation</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">showResult</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
        <code class="nx">deleteButtonDisabled</code><code class="o">:</code> <code class="kr">false</code><code class="go">,</code>
      <code class="go">}</code>
    <code class="kr">default</code><code class="o">:</code>
      <code class="kr">throw</code> <code class="kr">new</code> <code class="nb">Error</code><code class="go">(</code><code class="s">'Unknown action: '</code> <code class="o">+</code> <code class="nx">action</code><code class="go">.</code><code class="nx">type</code><code class="go">)</code>
  <code class="go">}</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">deletionReducer</code></pre>

<p class="author1">Although this code is complicated, you can write it quickly if you create the tests first.</p>

<p class="author1">Now that we have the reducer, we can use it in our application:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useReducer</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="nx">deletionReducer</code> <code class="nx">from</code> <code class="s">'./deletionReducer'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">state</code><code class="go">,</code> <code class="nx">dispatch</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useReducer</code><code class="go">(</code><code class="nx">deletionReducer</code><code class="go">,</code> <code class="go">{})</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">password</code><code class="go">,</code> <code class="nx">setPassword</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">()</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code>
        <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="nx">dispatch</code><code class="go">({</code> <code class="nx">type</code><code class="o">:</code> <code class="s">'START_DELETION'</code> <code class="go">})</code>
        <code class="go">}}</code>
        <code class="na">disabled</code><code class="o">=</code><code class="go">{</code><code class="nx">state</code><code class="go">.</code><code class="nx">deleteButtonDisabled</code><code class="go">}</code>
      <code class="go">&gt;</code>
        <code class="nx">Delete</code> <code class="nx">Widget</code><code class="o">!</code>
      <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-message"</code><code class="go">&gt;{</code><code class="nx">state</code><code class="go">.</code><code class="nx">message</code><code class="go">}&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">state</code><code class="go">.</code><code class="nx">showLogin</code> <code class="o">&amp;&amp;</code> <code class="go">(</code>
        <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-dialog"</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Enter</code> <code class="nx">your</code> <code class="nx">password</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">input</code>
            <code class="na">type</code><code class="o">=</code><code class="s">"password"</code>
            <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">password</code><code class="go">}</code>
            <code class="na">onChange</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">)}</code>
          <code class="go">/&gt;</code>
          <code class="go">&lt;</code><code class="nt">button</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code>
              <code class="nx">dispatch</code><code class="go">({</code> <code class="nx">type</code><code class="o">:</code> <code class="s">'LOGIN'</code><code class="go">,</code> <code class="nx">payload</code><code class="o">:</code> <code class="nx">password</code> <code class="go">})</code>
            <code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="nx">Login</code>
          <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">button</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">dispatch</code><code class="go">({</code> <code class="nx">type</code><code class="o">:</code> <code class="s">'CANCEL_DELETION'</code> <code class="go">})}</code>
          <code class="go">&gt;</code>
            <code class="nx">Cancel</code>
          <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-error"</code><code class="go">&gt;{</code><code class="nx">state</code><code class="go">.</code><code class="nx">loginError</code><code class="go">}&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">)}</code>
      <code class="go">{</code><code class="nx">state</code><code class="go">.</code><code class="nx">showConfirmation</code> <code class="o">&amp;&amp;</code> <code class="go">(</code>
        <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-dialog"</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Are</code> <code class="nx">you</code> <code class="nx">sure</code> <code class="nx">you</code> <code class="nx">want</code> <code class="nx">to</code> <code class="kr">delete</code> <code class="nx">the</code> <code class="nx">widget</code><code class="o">?</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">button</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code>
              <code class="nx">dispatch</code><code class="go">({</code>
                <code class="nx">type</code><code class="o">:</code> <code class="s">'CONFIRM_DELETION'</code><code class="go">,</code>
              <code class="go">})</code>
            <code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="nx">Yes</code>
          <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">button</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code>
              <code class="nx">dispatch</code><code class="go">({</code>
                <code class="nx">type</code><code class="o">:</code> <code class="s">'CANCEL_DELETION'</code><code class="go">,</code>
              <code class="go">})</code>
            <code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="nx">No</code>
          <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">)}</code>
      <code class="go">{</code><code class="nx">state</code><code class="go">.</code><code class="nx">showResult</code> <code class="o">&amp;&amp;</code> <code class="go">(</code>
        <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-dialog"</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">The</code> <code class="nx">widget</code> <code class="nx">was</code> <code class="nx">deleted</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">button</code>
            <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code>
              <code class="nx">dispatch</code><code class="go">({</code>
                <code class="nx">type</code><code class="o">:</code> <code class="s">'FINISH'</code><code class="go">,</code>
              <code class="go">})</code>
            <code class="go">}</code>
          <code class="go">&gt;</code>
            <code class="nx">Done</code>
          <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
      <code class="go">)}</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">Most of this code is purely creating the user interface for each of the dialogs in the sequence. There is virtually no logic in this
component. It just does what the reducer tells it. It will take the user through the <em class="calibre7">happy path</em> of logging in and confirming the
deletion (see <a data-type="xref" href="#ch04_image_8" class="calibre6">Figure 4-8</a>).</p>

<figure class="calibre29"><div id="ch04_image_8" class="figure">
<img src="Images/recb_0407.png" alt="" class="calibre82"/>
<h6 class="calibre30"><span class="firstname">Figure 4-8. </span>The final result</h6>
</div></figure>

<p class="author1">But <a data-type="xref" href="#ch04_image_9" class="calibre6">Figure 4-9</a> shows it also handles all of the edge cases, such as invalid passwords and cancellation.</p>

<figure class="calibre29"><div id="ch04_image_9" class="figure">
<img src="Images/recb_0409.png" alt="" class="calibre83"/>
<h6 class="calibre30"><span class="firstname">Figure 4-9. </span>The edge cases are all handled by the reducer</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634418692136">
<h2 class="calibre27">Discussion</h2>

<p class="author1">There are times when reducers can make your code convoluted; if you have few pieces of state with few interactions between
them, you probably don’t need a reducer.<a data-type="indexterm" data-primary="reducers" data-secondary="using for complex interactions" data-tertiary="deletionReducer example" data-startref="ix_redintdel" id="idm46634417942360" class="calibre6"/> But if you find yourself drawing a flowchart or a state diagram to describe a sequence of
user interactions, that’s a sign that you might need a reducer.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/hfqLn" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="deletion sequence, using reducers to manage" data-startref="ix_delred" id="idm46634417939432" class="calibre6"/><a data-type="indexterm" data-primary="interaction design" data-secondary="using reducers for complex interactions" data-startref="ix_intdesred" id="idm46634417938328" class="calibre6"/><a data-type="indexterm" data-primary="reducers" data-secondary="using for complex interactions" data-startref="ix_redint" id="idm46634417937144" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Add Keyboard Interaction" class="calibre4"><div class="preface" id="ch04-04">
<h1 class="calibre17">Add Keyboard Interaction</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634417934280">
<h2 class="calibre27">Problem</h2>

<p class="author1">Power users like to use keyboards for frequently used operations. <a data-type="indexterm" data-primary="interaction design" data-secondary="adding keyboard interaction" id="ix_intdeskey" class="calibre6"/><a data-type="indexterm" data-primary="keyboard interaction, adding to application" id="ix_keybd" class="calibre6"/>React components can respond to keyboard events, but only when
they (or their children) have focus. What do you do if you want your component to respond to events at the document level?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634417930168">
<h2 class="calibre27">Solution</h2>

<p class="author1">We’re going to create a key-listener hook to listen for <code class="calibre21">keydown</code> events at the <code class="calibre21">document</code> level.<a data-type="indexterm" data-primary="useKeyListener hook" id="idm46634417927736" class="calibre6"/><a data-type="indexterm" data-primary="keyboard interaction, adding to application" data-secondary="useKeyListener hook" id="idm46634417927000" class="calibre6"/> Still, it could be easily modified
to listen for any other JavaScript event in the DOM. This is the hook:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useEffect</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">const</code> <code class="nx">useKeyListener</code> <code class="o">=</code> <code class="go">(</code><code class="nx">callback</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">useEffect</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">const</code> <code class="nx">listener</code> <code class="o">=</code> <code class="go">(</code><code class="nx">e</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="nx">e</code> <code class="o">=</code> <code class="nx">e</code> <code class="o">||</code> <code class="nb">window</code><code class="go">.</code><code class="nx">event</code>
      <code class="kr">const</code> <code class="nx">tagName</code> <code class="o">=</code> <code class="nx">e</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">localName</code> <code class="o">||</code> <code class="nx">e</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">tagName</code>
      <code class="c">// Only accept key-events that originated at the body level</code>
      <code class="c">// to avoid key-strokes in e.g. text-fields being included</code>
      <code class="kr">if</code> <code class="go">(</code><code class="nx">tagName</code><code class="go">.</code><code class="nx">toUpperCase</code><code class="go">()</code> <code class="o">===</code> <code class="s">'BODY'</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">callback</code><code class="go">(</code><code class="nx">e</code><code class="go">)</code>
      <code class="go">}</code>
    <code class="go">}</code>
    <code class="nb">document</code><code class="go">.</code><code class="nx">addEventListener</code><code class="go">(</code><code class="s">'keydown'</code><code class="go">,</code> <code class="nx">listener</code><code class="go">,</code> <code class="kr">true</code><code class="go">)</code>
    <code class="kr">return</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="nb">document</code><code class="go">.</code><code class="nx">removeEventListener</code><code class="go">(</code><code class="s">'keydown'</code><code class="go">,</code> <code class="nx">listener</code><code class="go">,</code> <code class="kr">true</code><code class="go">)</code>
    <code class="go">}</code>
  <code class="go">},</code> <code class="go">[</code><code class="nx">callback</code><code class="go">])</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">useKeyListener</code></pre>

<p class="author1">The hook accepts a callback function and registers it for <code class="calibre21">keydown</code> events on the 
<span class="firstname"><code class="calibre21">document</code></span> object. <a data-type="indexterm" data-primary="useEffect hook" id="idm46634417842264" class="calibre6"/>At the end of the <code class="calibre21">useEffect</code>,
it returns a function that will unregister the callback.<a data-type="indexterm" data-primary="keyboard interaction, adding to application" data-secondary="registering callback for keydown events on document" id="idm46634417841016" class="calibre6"/> If the callback function we pass in changes, we will first unregister the
old function before registering the new one.</p>

<p class="author1">How do we use the hook? Here is an example. See if you notice the little coding wrinkle we have to deal with:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useCallback</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>
<code class="kr">import</code> <code class="nx">useKeyListener</code> <code class="nx">from</code> <code class="s">'./useKeyListener'</code>

<code class="kr">const</code> <code class="nx">RIGHT_ARROW</code> <code class="o">=</code> <code class="mi">39</code>
<code class="kr">const</code> <code class="nx">LEFT_ARROW</code> <code class="o">=</code> <code class="mi">37</code>
<code class="kr">const</code> <code class="nx">ESCAPE</code> <code class="o">=</code> <code class="mi">27</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">angle</code><code class="go">,</code> <code class="nx">setAngle</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">lastKey</code><code class="go">,</code> <code class="nx">setLastKey</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>

  <code class="kr">let</code> <code class="nx">onKeyDown</code> <code class="o">=</code> <code class="nx">useCallback</code><code class="go">(</code>
    <code class="go">(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="kr">if</code> <code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">keyCode</code> <code class="o">===</code> <code class="nx">LEFT_ARROW</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">setAngle</code><code class="go">((</code><code class="nx">c</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nb">Math</code><code class="go">.</code><code class="nx">max</code><code class="go">(</code><code class="o">-</code><code class="mi">360</code><code class="go">,</code> <code class="nx">c</code> <code class="o">-</code> <code class="mi">10</code><code class="go">))</code>
        <code class="nx">setLastKey</code><code class="go">(</code><code class="s">'Left'</code><code class="go">)</code>
      <code class="go">}</code> <code class="kr">else</code> <code class="kr">if</code> <code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">keyCode</code> <code class="o">===</code> <code class="nx">RIGHT_ARROW</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">setAngle</code><code class="go">((</code><code class="nx">c</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nb">Math</code><code class="go">.</code><code class="nx">min</code><code class="go">(</code><code class="mi">360</code><code class="go">,</code> <code class="nx">c</code> <code class="o">+</code> <code class="mi">10</code><code class="go">))</code>
        <code class="nx">setLastKey</code><code class="go">(</code><code class="s">'Right'</code><code class="go">)</code>
      <code class="go">}</code> <code class="kr">else</code> <code class="kr">if</code> <code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">keyCode</code> <code class="o">===</code> <code class="nx">ESCAPE</code><code class="go">)</code> <code class="go">{</code>
        <code class="nx">setAngle</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>
        <code class="nx">setLastKey</code><code class="go">(</code><code class="s">'Escape'</code><code class="go">)</code>
      <code class="go">}</code>
    <code class="go">},</code>
    <code class="go">[</code><code class="nx">setAngle</code><code class="go">]</code>
  <code class="go">)</code>
  <code class="nx">useKeyListener</code><code class="go">(</code><code class="nx">onKeyDown</code><code class="go">)</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="nx">Angle</code><code class="o">:</code> <code class="go">{</code><code class="nx">angle</code><code class="go">}</code> <code class="nx">Last</code> <code class="nx">key</code><code class="o">:</code> <code class="go">{</code><code class="nx">lastKey</code><code class="go">}</code>
      <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">svg</code>
        <code class="na">width</code><code class="o">=</code><code class="s">"400px"</code>
        <code class="na">height</code><code class="o">=</code><code class="s">"400px"</code>
        <code class="na">title</code><code class="o">=</code><code class="s">"arrow"</code>
        <code class="na">fill</code><code class="o">=</code><code class="s">"none"</code>
        <code class="na">strokeWidth</code><code class="o">=</code><code class="s">"10"</code>
        <code class="na">stroke</code><code class="o">=</code><code class="s">"black"</code>
        <code class="na">style</code><code class="o">=</code><code class="go">{{</code>
          <code class="nx">transform</code><code class="o">:</code> <code class="err">`</code><code class="nx">rotate</code><code class="go">(</code><code class="nx">$</code><code class="go">{</code><code class="nx">angle</code><code class="go">}</code><code class="nx">deg</code><code class="go">)</code><code class="err">`</code><code class="go">,</code>
        <code class="go">}}</code>
      <code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">polyline</code> <code class="na">points</code><code class="o">=</code><code class="s">"100,200 200,0 300,200"</code> <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">polyline</code> <code class="na">points</code><code class="o">=</code><code class="s">"200,0 200,400"</code> <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">svg</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">This code listens for the user pressing the left/right cursor keys. Our <code class="calibre21">onKeyDown</code> function <a data-type="indexterm" data-primary="onKeyDown function" id="idm46634417831592" class="calibre6"/>says what should happen when those key
clicks occur, but notice<a data-type="indexterm" data-primary="useCallback hook" id="idm46634417830792" class="calibre6"/> that we’ve wrapped it in a <code class="calibre21">useCallback</code>. If we <em class="calibre7">didn’t</em> do that, the browser would re-create the
<code class="calibre21">onKeyDown</code> function each time it rendered the <code class="calibre21">App</code> component. The new function would do the same as the old <code class="calibre21">onKeyDown</code> function,
but it would live in a different place in memory, and the <code class="calibre21">useKeyListener</code> would keep unregistering and re-registering it.</p>
<div data-type="warning" epub:type="warning" class="calibre26">
<p class="author1">If you forget to wrap your callback function in a <code class="calibre21">useCallback</code>, it may result in a blizzard of render calls, which might
slow your application down.</p>
</div>

<p class="author1">By using <code class="calibre21">useCallback</code>, we can ensure that we only create the function if <code class="calibre21">setAngle</code> changes.</p>

<p class="author1">If you run the application, you will see an arrow on the screen. If you press the left/right cursor keys (<a data-type="xref" href="#ch04_image_10" class="calibre6">Figure 4-10</a>), you can
rotate the image.<a data-type="indexterm" data-primary="keyboard interaction, adding to application" data-secondary="pressing keys causing arrow to rotate" id="idm46634417366600" class="calibre6"/> If you press the Escape key, you can reset it to vertical.</p>

<figure class="calibre29"><div id="ch04_image_10" class="figure">
<img src="Images/recb_0410.png" alt="" class="calibre84"/>
<h6 class="calibre30"><span class="firstname">Figure 4-10. </span>Pressing the left/right/Escape keys causes the arrow to rotate</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634417929576">
<h2 class="calibre27">Discussion</h2>

<p class="author1">We are careful in the <code class="calibre21">useKeyListener</code> function to only listen to events that originated at the <code class="calibre21">body</code> level. <a data-type="indexterm" data-primary="useKeyListener hook" data-secondary="only listening for events at body level" id="idm46634417361320" class="calibre6"/>If the user clicks the
arrow keys in a text field, the browser won’t send those events to your code.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/VIY1O" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="adding keyboard interaction" data-startref="ix_intdeskey" id="idm46634417359032" class="calibre6"/><a data-type="indexterm" data-primary="keyboard interaction, adding to application" data-startref="ix_keybd" id="idm46634417357784" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Use Markdown for Rich Content" class="calibre4"><div class="preface" id="ch04-05">
<h1 class="calibre17">Use Markdown for Rich Content</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634417355064">
<h2 class="calibre27">Problem</h2>

<p class="author1">If your application allows users to provide large blocks of text content, it would be helpful if that content could also include
formatted text, links, and so forth.<a data-type="indexterm" data-primary="interaction design" data-secondary="using Markdown for rich content" id="ix_intdesrch" class="calibre6"/><a data-type="indexterm" data-primary="rich content, using Markdown for" id="ix_richcnt" class="calibre6"/><a data-type="indexterm" data-primary="Markdown" data-secondary="using for rich content" id="ix_Mkdwn" class="calibre6"/> However, allowing users to pass in such horrors as raw HTML can lead to security flaws and
untold misery for developers.</p>

<p class="author1">How do you allow users to post rich content without undermining the security of your application?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634417349096">
<h2 class="calibre27">Solution</h2>

<p class="author1">Markdown is an excellent way of allowing users to post rich content into your application safely.<a data-type="indexterm" data-primary="timestamps" data-secondary="messages posted to a list" id="idm46634417347256" class="calibre6"/> To see how to use Markdown in your
application, let’s consider this simple application, which allows a user to post a timestamped series of messages into a list:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="s">'./Forum.css'</code>

<code class="kr">const</code> <code class="nx">Forum</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">text</code><code class="go">,</code> <code class="nx">setText</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">messages</code><code class="go">,</code> <code class="nx">setMessages</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">([])</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">section</code> <code class="na">className</code><code class="o">=</code><code class="s">"Forum"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">textarea</code>
        <code class="na">cols</code><code class="o">=</code><code class="go">{</code><code class="mi">80</code><code class="go">}</code>
        <code class="na">rows</code><code class="o">=</code><code class="go">{</code><code class="mi">20</code><code class="go">}</code>
        <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">text</code><code class="go">}</code>
        <code class="na">onChange</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setText</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">)}</code>
      <code class="go">/&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code>
        <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="nx">setMessages</code><code class="go">((</code><code class="nx">msgs</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">[</code>
            <code class="go">{</code>
              <code class="nx">body</code><code class="o">:</code> <code class="nx">text</code><code class="go">,</code>
              <code class="nx">timestamp</code><code class="o">:</code> <code class="kr">new</code> <code class="nb">Date</code><code class="go">().</code><code class="nx">toISOString</code><code class="go">(),</code>
            <code class="go">},</code>
            <code class="go">...</code><code class="nx">msgs</code><code class="go">,</code>
          <code class="go">])</code>
          <code class="nx">setText</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
        <code class="go">}}</code>
      <code class="go">&gt;</code>
        <code class="nx">Post</code>
      <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">messages</code><code class="go">.</code><code class="nx">map</code><code class="go">((</code><code class="nx">msg</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="kr">return</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">dl</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">dt</code><code class="go">&gt;{</code><code class="nx">msg</code><code class="go">.</code><code class="nx">timestamp</code><code class="go">}&lt;/</code><code class="nt">dt</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">dd</code><code class="go">&gt;{</code><code class="nx">msg</code><code class="go">.</code><code class="nx">body</code><code class="go">}&lt;/</code><code class="nt">dd</code><code class="go">&gt;</code>
          <code class="go">&lt;/</code><code class="nt">dl</code><code class="go">&gt;</code>
        <code class="go">)</code>
      <code class="go">})}</code>
    <code class="go">&lt;/</code><code class="nt">section</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">Forum</code></pre>

<p class="author1">When you run the application (<a data-type="xref" href="#ch04_image_11" class="calibre6">Figure 4-11</a>), you see a large text area. When you post a plain-text message, the app preserves white
space and line breaks.</p>

<figure class="calibre29"><div id="ch04_image_11" class="figure">
<img src="Images/recb_0411.png" alt="" class="calibre85"/>
<h6 class="calibre30"><span class="firstname">Figure 4-11. </span>A user enters text into a text area, and it gets posted as a plain-text message</h6>
</div></figure>

<p class="author1">If your application contains a text area, it’s worth considering allowing the user to enter Markdown content.</p>

<p class="author1">There <a data-type="indexterm" data-primary="react-markdown" id="idm46634416996968" class="calibre6"/>are many, many Markdown libraries available, but most of them are wrappers for <code class="calibre21">react-markdown</code> or a syntax highlighter<a data-type="indexterm" data-primary="syntax highlighters" id="idm46634416995720" class="calibre6"/> like <a href="https://prismjs.com" class="calibre6">PrismJS</a> or <a href="https://codemirror.net" class="calibre6">CodeMirror</a>.</p>

<p class="author1">We’ll look at a <a data-type="indexterm" data-primary="react-md-editor library" id="idm46634416993160" class="calibre6"/>library called <code class="calibre21">react-md-editor</code> that adds extra features to <code class="calibre21">react-markdown</code> and allows you to display Markdown and
edit it. We will begin by installing the library:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install @uiw/react-md-editor</code></pre>

<p class="author1">We’ll now convert our plain-text area to a Markdown editor and convert the posted messages <a data-type="indexterm" data-primary="HTML" data-secondary="converting Markdown to" id="idm46634416967224" class="calibre6"/>from Markdown to HTML:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">MDEditor</code> <code class="nx">from</code> <code class="s">'@uiw/react-md-editor'</code>

<code class="kr">const</code> <code class="nx">MarkdownForum</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">text</code><code class="go">,</code> <code class="nx">setText</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">messages</code><code class="go">,</code> <code class="nx">setMessages</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">([])</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">section</code> <code class="na">className</code><code class="o">=</code><code class="s">"Forum"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">MDEditor</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">300</code><code class="go">}</code> <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">text</code><code class="go">}</code> <code class="na">onChange</code><code class="o">=</code><code class="go">{</code><code class="nx">setText</code><code class="go">}</code> <code class="go">/&gt;</code>
      <code class="go">&lt;</code><code class="nt">button</code>
        <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="go">{</code>
          <code class="nx">setMessages</code><code class="go">((</code><code class="nx">msgs</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">[</code>
            <code class="go">{</code>
              <code class="nx">body</code><code class="o">:</code> <code class="nx">text</code><code class="go">,</code>
              <code class="nx">timestamp</code><code class="o">:</code> <code class="kr">new</code> <code class="nb">Date</code><code class="go">().</code><code class="nx">toISOString</code><code class="go">(),</code>
            <code class="go">},</code>
            <code class="go">...</code><code class="nx">msgs</code><code class="go">,</code>
          <code class="go">])</code>
          <code class="nx">setText</code><code class="go">(</code><code class="s">''</code><code class="go">)</code>
        <code class="go">}}</code>
      <code class="go">&gt;</code>
        <code class="nx">Post</code>
      <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
      <code class="go">{</code><code class="nx">messages</code><code class="go">.</code><code class="nx">map</code><code class="go">((</code><code class="nx">msg</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="kr">return</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">dl</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">dt</code><code class="go">&gt;{</code><code class="nx">msg</code><code class="go">.</code><code class="nx">timestamp</code><code class="go">}&lt;/</code><code class="nt">dt</code><code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">dd</code><code class="go">&gt;</code>
              <code class="go">&lt;</code><code class="nt">MDEditor</code><code class="go">.</code><code class="na">Markdown</code> <code class="na">source</code><code class="o">=</code><code class="go">{</code><code class="nx">msg</code><code class="go">.</code><code class="nx">body</code><code class="go">}</code> <code class="go">/&gt;</code>
            <code class="go">&lt;/</code><code class="nt">dd</code><code class="go">&gt;</code>
          <code class="go">&lt;/</code><code class="nt">dl</code><code class="go">&gt;</code>
        <code class="go">)</code>
      <code class="go">})}</code>
    <code class="go">&lt;/</code><code class="nt">section</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">MarkdownForum</code></pre>

<p class="author1">Converting plain text to Markdown is a small change with a significant return. As you can see in <a data-type="xref" href="#ch04_image_12" class="calibre6">Figure 4-12</a>, the user can apply
rich formatting to a message and choose to edit it full-screen before posting it.</p>

<figure class="calibre29"><div id="ch04_image_12" class="figure">
<img src="Images/recb_0412.png" alt="" class="calibre86"/>
<h6 class="calibre30"><span class="firstname">Figure 4-12. </span>The Markdown editor shows a preview as you type and also allows you to work full-screen</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634417348472">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Adding Markdown to an application is quick and improves the user’s experience with minimal effort.<a data-type="indexterm" data-primary="Markdown" data-secondary="using for rich content" data-tertiary="John Gruber's original guide" id="idm46634416730104" class="calibre6"/><a data-type="indexterm" data-primary="John Gruber's original guide (to Markdown)" id="idm46634416728888" class="calibre6"/><a data-type="indexterm" data-primary="Gruber, John, guide to Markdown" id="idm46634416728120" class="calibre6"/> For more details on Markdown, see <a href="https://oreil.ly/2EE9x" class="calibre6">John Gruber’s original guide</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/S0n7x" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="using Markdown for rich content" data-startref="ix_intdesrch" id="idm46634416725496" class="calibre6"/><a data-type="indexterm" data-primary="rich content, using Markdown for" data-startref="ix_richcnt" id="idm46634416724248" class="calibre6"/><a data-type="indexterm" data-primary="Markdown" data-secondary="using for rich content" data-startref="ix_Mkdwn" id="idm46634416723336" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Animate with CSS Classes" class="calibre4"><div class="preface" id="ch04-06">
<h1 class="calibre17">Animate with CSS Classes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634416720440">
<h2 class="calibre27">Problem</h2>

<p class="author1">You want to add a small amount of simple animation to your application, but you don’t want to increase your application size by
installing a third-party library.<a data-type="indexterm" data-primary="interaction design" data-secondary="animating with CSS classes" id="ix_intdesaniCSS" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" id="ix_CSSanim" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="animating with CSS classes" id="ix_animCSS" class="calibre6"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634416715240">
<h2 class="calibre27">Solution</h2>

<p class="author1">Most of the animation you are ever likely to need in a React application will probably not require a third-party animation library.
That’s because CSS animation now gives browsers the native ability to animate CSS properties with minimal effort. It takes very
little code, and the animation is smooth because the graphics hardware will generate it. GPU animation uses less power, making it
more appropriate for mobile 
<span class="firstname">devices</span>.</p>
<div data-type="tip" class="calibre25">
<p class="author1">If you are looking to add animation to your React application, begin with CSS animation before looking elsewhere.</p>
</div>

<p class="author1">How does CSS animation work? It uses a CSS property called <code class="calibre21">transition</code>.<a data-type="indexterm" data-primary="transitions" data-secondary="CSS transition property" id="idm46634416710296" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-secondary="transition property" id="idm46634416709288" class="calibre6"/> Let’s say we want to create an expandable information
panel. When the user clicks the button, the panel opens smoothly. When they click it again, it closes smoothly, as shown in <a data-type="xref" href="#ch04_image_13" class="calibre6">Figure 4-13</a>.</p>

<figure class="calibre29"><div id="ch04_image_13" class="figure">
<img src="Images/recb_0413.png" alt="" class="calibre87"/>
<h6 class="calibre30"><span class="firstname">Figure 4-13. </span>Simple CSS animation will smoothly expand and contract the panel</h6>
</div></figure>

<p class="author1">We can create this effect using the CSS <code class="calibre21">transition</code> property:</p>

<pre data-type="programlisting" data-code-language="css" class="calibre28"><code class="nc">.InfoPanel-details</code> <code class="go">{</code>
    <code class="kr">height</code><code class="o">:</code> <code class="mi">350px</code><code class="go">;</code>
    <code class="kr">transition</code><code class="o">:</code> <code class="kr">height</code> <code class="mi">0.5s</code><code class="go">;</code>
<code class="go">}</code></pre>

<p class="author1">This CSS specifies a <code class="calibre21">height</code>, as well as a <code class="calibre21">transition</code> property.<a data-type="indexterm" data-primary="height property (CSS)" id="idm46634416693672" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-secondary="height property" id="idm46634416692968" class="calibre6"/> This combination translates to “Whatever your current height,
animate to my preferred height during the next half-second.”</p>

<p class="author1">The animation will occur whenever the <code class="calibre21">height</code> of the element changes, such as when an additional CSS rule becomes valid. For
example, if we have an extra CSS class-name with a different height, the transition property will animate the height change when an element switches to a different class:</p>

<pre data-type="programlisting" data-code-language="css" class="calibre28"><code class="nc">.InfoPanel-details</code> <code class="go">{</code>
    <code class="kr">height</code><code class="o">:</code> <code class="mi">350px</code><code class="go">;</code>
    <code class="kr">transition</code><code class="o">:</code> <code class="kr">height</code> <code class="mi">0.5s</code><code class="go">;</code>
<code class="go">}</code>
<code class="nc">.InfoPanel-details.InfoPanel-details-closed</code> <code class="go">{</code>
    <code class="kr">height</code><code class="o">:</code> <code class="mi">0</code><code class="go">;</code>
<code class="go">}</code></pre>
<div data-type="tip" class="calibre25">
<p class="author1">This class name structure is an example of block element modifier (BEM) naming.<a data-type="indexterm" data-primary="CSS animations" data-secondary="block element modifier class names" id="idm46634416644456" class="calibre6"/><a data-type="indexterm" data-primary="block element modifier (BEM) naming" id="idm46634416643608" class="calibre6"/> The <em class="calibre7">block</em> is the component (<code class="calibre21">InfoPanel</code>), the
<em class="calibre7">element</em> is a thing inside the block (<code class="calibre21">details</code>), and the <em class="calibre7">modifier</em> says something about the element’s current state (<code class="calibre21">closed</code>).<a data-type="indexterm" data-primary="element (block element modifier naming)" id="idm46634416640184" class="calibre6"/><a data-type="indexterm" data-primary="modifier (block element modifier naming)" id="idm46634416639480" class="calibre6"/>
The BEM convention reduces the chances of name clashes in your code.</p>
</div>

<p class="author1">If an <code class="calibre21">InfoPanel-details</code> element suddenly acquires an additional <code class="calibre21">.InfoPanel-details-closed</code> class, the <code class="calibre21">height</code> will change from
<code class="calibre21">350px</code> to <code class="calibre21">0</code>, and the <code class="calibre21">transition</code> property will smoothly shrink the element. Conversely, if the component <em class="calibre7">loses</em> the
<code class="calibre21">.InfoPanel-details-closed</code> class, the element will expand again.</p>

<p class="author1">That means that we can defer the hard work to CSS, and all we need to do in our React code is add or remove the class to an element:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">import</code> <code class="s">'./InfoPanel.css'</code>

<code class="kr">const</code> <code class="nx">InfoPanel</code> <code class="o">=</code> <code class="go">({</code> <code class="nx">title</code><code class="go">,</code> <code class="nx">children</code> <code class="go">})</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">open</code><code class="go">,</code> <code class="nx">setOpen</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="kr">false</code><code class="go">)</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">section</code> <code class="na">className</code><code class="o">=</code><code class="s">"InfoPanel"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code>
        <code class="go">{</code><code class="nx">title</code><code class="go">}</code>
        <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setOpen</code><code class="go">((</code><code class="nx">v</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="o">!</code><code class="nx">v</code><code class="go">)}&gt;</code>
          <code class="go">{</code><code class="nx">open</code> <code class="o">?</code> <code class="s">'^'</code> <code class="o">:</code> <code class="s">'v'</code><code class="go">}</code>
        <code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">div</code>
        <code class="na">className</code><code class="o">=</code><code class="go">{</code><code class="err">`</code><code class="nx">InfoPanel</code><code class="o">-</code><code class="nx">details</code> <code class="nx">$</code><code class="go">{</code>
          <code class="nx">open</code> <code class="o">?</code> <code class="s">''</code> <code class="o">:</code> <code class="s">'InfoPanel-details-closed'</code>
        <code class="go">}</code><code class="err">`</code><code class="go">}</code>
      <code class="go">&gt;</code>
        <code class="go">{</code><code class="nx">children</code><code class="go">}</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">section</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">InfoPanel</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634416714648">
<h2 class="calibre27">Discussion</h2>

<p class="author1">We have frequently seen many projects bundle in third-party component libraries to use some small widget that expands or contracts
its contents. As you can see, such animation is trivial to include.</p>

<p class="author1">You can download the source for this recipe from
the <a href="https://oreil.ly/FKnIc" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="animating with CSS classes" data-startref="ix_intdesaniCSS" id="idm46634416628184" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-startref="ix_CSSanim" id="idm46634416455160" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="animating with CSS classes" data-startref="ix_animCSS" id="idm46634416454216" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Animate with React Animation" class="calibre4"><div class="preface" id="ch04-07">
<h1 class="calibre17">Animate with React Animation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634416451304">
<h2 class="calibre27">Problem</h2>

<p class="author1">CSS animations are very low-tech and will be appropriate for most animations that you are likely to need.<a data-type="indexterm" data-primary="interaction design" data-secondary="animating with React Animations" id="ix_intdesaniRA" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-secondary="benefits and limitations of" id="idm46634416448584" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="using React Animations" id="ix_animRea" class="calibre6"/></p>

<p class="author1">However, they require you to understand a lot about the various CSS properties and the effects of animating them. If you want to
illustrate an item being deleted by it rapidly expanding and becoming transparent, how do you do that?</p>

<p class="author1">Libraries such as <a href="https://animate.style" class="calibre6">Animate.css</a> contain a whole host of pre-canned CSS animations, but they often require more
advanced CSS animation concepts like keyframes and are not particularly tuned for React. How can we add CSS library animations to a
React application?<a data-type="indexterm" data-primary="React Animations library" id="ix_ReactAnim" class="calibre6"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634416443160">
<h2 class="calibre27">Solution</h2>

<p class="author1">The React Animations library is a React wrapper for the Animate.css library. It will efficiently add animated styling to your
components without generating unnecessary renders or significantly increasing the size of the generated DOM.</p>

<p class="author1">It’s able to work so efficiently because React Animations works with a CSS-in-JS library.<a data-type="indexterm" data-primary="JavaScript" data-secondary="CSS-in-JS libraries" id="idm46634416440680" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-secondary="CSS-in-JS libraries" id="idm46634416439704" class="calibre6"/> CSS-in-JS is a technique for coding your
style information directly in your JavaScript code. React will let you add your style attributes as React components, but CSS-in-JS
does this more efficiently, dynamically creating shared style elements in the <code class="calibre21">head</code> of the page.</p>

<p class="author1">There are several CSS-in-JS <a data-type="indexterm" data-primary="Radium library" id="idm46634416437528" class="calibre6"/>libraries to choose from, but in this recipe, we’re going to use one called
<a href="https://oreil.ly/oNBEl" class="calibre6">Radium</a>.</p>

<p class="author1">Let’s begin by installing Radium <a data-type="indexterm" data-primary="animations" data-secondary="using React Animations" data-tertiary="installing Radium and React Animations" id="idm46634416435544" class="calibre6"/>and React Animations:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install radium</code>
<code class="go">$ npm install react-animations</code></pre>

<p class="author1">Our example application (<a data-type="xref" href="#ch04_image_14" class="calibre6">Figure 4-14</a>) will run an animation each time we add an image item to the collection.</p>

<figure class="calibre29"><div id="ch04_image_14" class="figure">
<img src="Images/recb_0414.png" alt="" class="calibre88"/>
<h6 class="calibre30"><span class="firstname">Figure 4-14. </span>Clicking the Add button will load a new image from picsum.photos</h6>
</div></figure>

<p class="author1">Likewise, when a user clicks an image, it <a data-type="indexterm" data-primary="fade-out animations" id="idm46634416429416" class="calibre6"/>shows a fade-out animation before removing the images from the list, as shown in <a data-type="xref" href="#ch04_image_15" class="calibre6">Figure 4-15</a>.<sup class="calibre34"><a data-type="noteref" id="idm46634416427016-marker" href="ch04.xhtml#idm46634416427016" class="calibre35">4</a></sup></p>

<figure class="calibre29"><div id="ch04_image_15" class="figure">
<img src="Images/recb_0415.png" alt="" class="calibre88"/>
<h6 class="calibre30"><span class="firstname">Figure 4-15. </span>If we click the fifth image, it will fade out from the list and disappear</h6>
</div></figure>

<p class="author1">We’ll begin by importing some <a data-type="indexterm" data-primary="Radium library" data-secondary="importing animations and helper code from" id="idm46634416422728" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="using React Animations" data-tertiary="importing animations and helper code from Radium" id="idm46634416419672" class="calibre6"/>animations and helper code from Radium:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">pulse</code><code class="go">,</code> <code class="nx">zoomOut</code><code class="go">,</code> <code class="nx">shake</code><code class="go">,</code> <code class="nx">merge</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-animations'</code>
<code class="kr">import</code> <code class="nx">Radium</code><code class="go">,</code> <code class="go">{</code> <code class="nx">StyleRoot</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'radium'</code>

<code class="kr">const</code> <code class="nx">styles</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">created</code><code class="o">:</code> <code class="go">{</code>
    <code class="nx">animation</code><code class="o">:</code> <code class="s">'x 0.5s'</code><code class="go">,</code>
    <code class="nx">animationName</code><code class="o">:</code> <code class="nx">Radium</code><code class="go">.</code><code class="nx">keyframes</code><code class="go">(</code><code class="nx">pulse</code><code class="go">,</code> <code class="s">'pulse'</code><code class="go">),</code>
  <code class="go">},</code>
  <code class="nx">deleted</code><code class="o">:</code> <code class="go">{</code>
    <code class="nx">animation</code><code class="o">:</code> <code class="s">'x 0.5s'</code><code class="go">,</code>
    <code class="nx">animationName</code><code class="o">:</code> <code class="nx">Radium</code><code class="go">.</code><code class="nx">keyframes</code><code class="go">(</code><code class="nx">merge</code><code class="go">(</code><code class="nx">zoomOut</code><code class="go">,</code> <code class="nx">shake</code><code class="go">),</code> <code class="s">'zoomOut'</code><code class="go">),</code>
  <code class="go">},</code>
<code class="go">}</code></pre>

<p class="author1">From React Animations we get <code class="calibre21">pulse</code>, <code class="calibre21">zoomOut</code>, and <code class="calibre21">shake</code> animations. We are going to use the <code class="calibre21">pulse</code> animation when we add an
image.<a data-type="indexterm" data-primary="pulse animations" id="idm46634416287336" class="calibre6"/><a data-type="indexterm" data-primary="zoomOut animations" id="idm46634416286744" class="calibre6"/><a data-type="indexterm" data-primary="shake animations" id="idm46634416286072" class="calibre6"/> We’ll use a <em class="calibre7">combined</em> animation of <code class="calibre21">zoomOut</code> and <code class="calibre21">shake</code> when we remove an image.<a data-type="indexterm" data-primary="combined animations" id="idm46634416283960" class="calibre6"/> We can combine animations using React
Animations’ <code class="calibre21">merge</code> function.<a data-type="indexterm" data-primary="React Animations library" data-secondary="combining animations with merge function" id="idm46634416282680" class="calibre6"/></p>

<p class="author1">The <code class="calibre21">styles</code> generate all of the CSS styles needed to run each of these half-second animations.<a data-type="indexterm" data-primary="CSS animations" data-secondary="generating styles for" id="idm46634416281096" class="calibre6"/> The call to <code class="calibre21">Radium.keyframes()</code>
handles all of the animation details for us.<a data-type="indexterm" data-primary="Radium library" data-secondary="keyframes method" id="idm46634416279576" class="calibre6"/></p>

<p class="author1">We must know when an animation has completely ended. If we delete an image before the deletion-animation completes, there would be
no image to animate.</p>

<p class="author1">We can keep track of CSS animations by passing an <code class="calibre21">onAnimationEnd</code> callback to any element we are going to animate.<a data-type="indexterm" data-primary="onAnimationEnd callback" id="idm46634416277096" class="calibre6"/><a data-type="indexterm" data-primary="CSS animations" data-secondary="keeping track of" id="idm46634416276392" class="calibre6"/> For each item in
our image collection, we are going to track three things:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">The URL of the image it represents</p>
</li>
<li class="calibre8">
<p class="author1">A Boolean value that will be true while the “created” animation is running</p>
</li>
<li class="calibre8">
<p class="author1">A Boolean value that will be true while the “deleted” animation is running</p>
</li>
</ul>

<p class="author1">Here is the example code to animate images into and out of the collection:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">pulse</code><code class="go">,</code> <code class="nx">zoomOut</code><code class="go">,</code> <code class="nx">shake</code><code class="go">,</code> <code class="nx">merge</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react-animations'</code>
<code class="kr">import</code> <code class="nx">Radium</code><code class="go">,</code> <code class="go">{</code> <code class="nx">StyleRoot</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'radium'</code>

<code class="kr">import</code> <code class="s">'./App.css'</code>

<code class="kr">const</code> <code class="nx">styles</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">created</code><code class="o">:</code> <code class="go">{</code>
    <code class="nx">animation</code><code class="o">:</code> <code class="s">'x 0.5s'</code><code class="go">,</code>
    <code class="nx">animationName</code><code class="o">:</code> <code class="nx">Radium</code><code class="go">.</code><code class="nx">keyframes</code><code class="go">(</code><code class="nx">pulse</code><code class="go">,</code> <code class="s">'pulse'</code><code class="go">),</code>
  <code class="go">},</code>
  <code class="nx">deleted</code><code class="o">:</code> <code class="go">{</code>
    <code class="nx">animation</code><code class="o">:</code> <code class="s">'x 0.5s'</code><code class="go">,</code>
    <code class="nx">animationName</code><code class="o">:</code> <code class="nx">Radium</code><code class="go">.</code><code class="nx">keyframes</code><code class="go">(</code><code class="nx">merge</code><code class="go">(</code><code class="nx">zoomOut</code><code class="go">,</code> <code class="nx">shake</code><code class="go">),</code> <code class="s">'zoomOut'</code><code class="go">),</code>
  <code class="go">},</code>
<code class="go">}</code>

<code class="kr">function</code> <code class="nx">getStyleForItem</code><code class="go">(</code><code class="nx">item</code><code class="go">)</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="nx">item</code><code class="go">.</code><code class="nx">deleting</code>
    <code class="o">?</code> <code class="nx">styles</code><code class="go">.</code><code class="nx">deleted</code>
    <code class="o">:</code> <code class="nx">item</code><code class="go">.</code><code class="nx">creating</code>
    <code class="o">?</code> <code class="nx">styles</code><code class="go">.</code><code class="nx">created</code>
    <code class="o">:</code> <code class="kr">null</code>
<code class="go">}</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">data</code><code class="go">,</code> <code class="nx">setData</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">([])</code>

  <code class="kr">let</code> <code class="nx">deleteItem</code> <code class="o">=</code> <code class="go">(</code><code class="nx">i</code><code class="go">)</code> <code class="o">=&gt;</code>
    <code class="nx">setData</code><code class="go">((</code><code class="nx">d</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
      <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="go">[...</code><code class="nx">d</code><code class="go">]</code>
      <code class="nx">result</code><code class="go">[</code><code class="nx">i</code><code class="go">].</code><code class="nx">deleting</code> <code class="o">=</code> <code class="kr">true</code>
      <code class="kr">return</code> <code class="nx">result</code>
    <code class="go">})</code>
  <code class="kr">let</code> <code class="nx">createItem</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">setData</code><code class="go">((</code><code class="nx">d</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">[</code>
      <code class="go">...</code><code class="nx">d</code><code class="go">,</code>
      <code class="go">{</code>
        <code class="nx">url</code><code class="o">:</code> <code class="err">`</code><code class="nx">https</code><code class="o">:</code><code class="c">//picsum.photos/id/${d.length * 3}/200`,</code>
        <code class="nx">creating</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
      <code class="go">},</code>
    <code class="go">])</code>
  <code class="go">}</code>
  <code class="kr">let</code> <code class="nx">completeAnimation</code> <code class="o">=</code> <code class="go">(</code><code class="nx">d</code><code class="go">,</code> <code class="nx">i</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="kr">if</code> <code class="go">(</code><code class="nx">d</code><code class="go">.</code><code class="nx">deleting</code><code class="go">)</code> <code class="go">{</code>
      <code class="nx">setData</code><code class="go">((</code><code class="nx">d</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="go">[...</code><code class="nx">d</code><code class="go">]</code>
        <code class="nx">result</code><code class="go">.</code><code class="nx">splice</code><code class="go">(</code><code class="nx">i</code><code class="go">,</code> <code class="mi">1</code><code class="go">)</code>
        <code class="kr">return</code> <code class="nx">result</code>
      <code class="go">})</code>
    <code class="go">}</code> <code class="kr">else</code> <code class="kr">if</code> <code class="go">(</code><code class="nx">d</code><code class="go">.</code><code class="nx">creating</code><code class="go">)</code> <code class="go">{</code>
      <code class="nx">setData</code><code class="go">((</code><code class="nx">d</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="go">[...</code><code class="nx">d</code><code class="go">]</code>
        <code class="nx">result</code><code class="go">[</code><code class="nx">i</code><code class="go">].</code><code class="nx">creating</code> <code class="o">=</code> <code class="kr">false</code>
        <code class="kr">return</code> <code class="nx">result</code>
      <code class="go">})</code>
    <code class="go">}</code>
  <code class="go">}</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">StyleRoot</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="nx">Images</code> <code class="nx">from</code><code class="o">&amp;</code><code class="nx">nbsp</code><code class="go">;</code>
          <code class="go">&lt;</code><code class="nt">a</code> <code class="na">href</code><code class="o">=</code><code class="s">"https://picsum.photos/"</code><code class="go">&gt;</code><code class="nx">Lorem</code> <code class="nx">Picsum</code><code class="go">&lt;/</code><code class="nt">a</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{</code><code class="nx">createItem</code><code class="go">}&gt;</code><code class="nx">Add</code><code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
        <code class="go">{</code><code class="nx">data</code><code class="go">.</code><code class="nx">map</code><code class="go">((</code><code class="nx">d</code><code class="go">,</code> <code class="nx">i</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">(</code>
          <code class="go">&lt;</code><code class="nt">div</code>
            <code class="na">style</code><code class="o">=</code><code class="go">{</code><code class="nx">getStyleForItem</code><code class="go">(</code><code class="nx">d</code><code class="go">)}</code>
            <code class="na">onAnimationEnd</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">completeAnimation</code><code class="go">(</code><code class="nx">d</code><code class="go">,</code> <code class="nx">i</code><code class="go">)}</code>
          <code class="go">&gt;</code>
            <code class="go">&lt;</code><code class="nt">img</code>
              <code class="na">id</code><code class="o">=</code><code class="go">{</code><code class="err">`</code><code class="nx">image$</code><code class="go">{</code><code class="nx">i</code><code class="go">}</code><code class="err">`</code><code class="go">}</code>
              <code class="na">src</code><code class="o">=</code><code class="go">{</code><code class="nx">d</code><code class="go">.</code><code class="nx">url</code><code class="go">}</code>
              <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">200</code><code class="go">}</code>
              <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">200</code><code class="go">}</code>
              <code class="na">alt</code><code class="o">=</code><code class="s">"Random"</code>
              <code class="na">title</code><code class="o">=</code><code class="s">"Click to delete"</code>
              <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">deleteItem</code><code class="go">(</code><code class="nx">i</code><code class="go">)}</code>
            <code class="go">/&gt;</code>
          <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">))}</code>
      <code class="go">&lt;/</code><code class="nt">StyleRoot</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634416442568">
<h2 class="calibre27">Discussion</h2>

<p class="author1">When choosing which animation to use, we should first ask: what will this animation mean?<a data-type="indexterm" data-primary="animations" data-secondary="using React Animations" data-tertiary="choosing which animation to use" id="idm46634416262680" class="calibre6"/></p>

<p class="author1">All animation should have meaning. It can show something existential (creation or deletion). It might indicate a change of state
(becoming enabled or disabled). It might zoom in to show detail or zoom out to reveal a broader context. Or it might illustrate a
limit or boundary (a spring-back animation at the end of a long list) or allow a user to express a preference (swiping left or
right).</p>

<p class="author1">Animation should also be short. Most animations should probably be over in half a second so that the user can experience the meaning
of the animation without being consciously aware of its appearance.</p>

<p class="author1">An animation should never be merely <em class="calibre7">attractive</em>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/rRK8F" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="interaction design" data-secondary="animating with React Animations" data-startref="ix_intdesaniRA" id="idm46634415789192" class="calibre6"/><a data-type="indexterm" data-primary="React Animations library" data-startref="ix_ReactAnim" id="idm46634415787896" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="using React Animations" data-startref="ix_animRea" id="idm46634415786936" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Animate Infographics with TweenOne" class="calibre4"><div class="preface" id="ch04-08">
<h1 class="calibre17">Animate Infographics with TweenOne</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634415784168">
<h2 class="calibre27">Problem</h2>

<p class="author1">CSS animations are smooth and highly efficient.<a data-type="indexterm" data-primary="infographics, animating with TweenOne" id="ix_infogani" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="animating infographics using TweenOne" id="ix_animinfgr" class="calibre6"/><a data-type="indexterm" data-primary="TweenOne, animating infographics with" id="ix_TwnO" class="calibre6"/> Browsers might defer CSS animations to the graphics hardware at the compositing stage, which means that not only are the animations running at machine-code speeds, but the machine-code itself is not running on the CPU.</p>

<p class="author1">However, the downside to running CSS animations on graphics hardware is that your application code won’t know what’s happening
<em class="calibre7">during</em> an animation. You can track when an animation has started, ended, or is repeated (<code class="calibre21">onAnimationStart</code>, <code class="calibre21">onAni⁠ma⁠tionEnd</code>,
<code class="calibre21">onAnimationIteration</code>), but everything that happens in between is a 
<span class="firstname">mystery</span>.</p>

<p class="author1">If you are animating an infographic, you may want to animate the numbers on a bar chart as the bars grow or shrink. Or, if you are
writing an application to track cyclists, you might want to show the current altitude as the bicycle animates its way up and down
the terrain.</p>

<p class="author1">But how do you create animations that you can <em class="calibre7">listen</em> to while they are happening?</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634415774232">
<h2 class="calibre27">Solution</h2>

<p class="author1">The TweenOne library creates animations with JavaScript, which means you can track them as they happen, frame by frame.</p>

<p class="author1">Let’s begin by installing the TweenOne library:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install rc-tween-one</code></pre>

<p class="author1">TweenOne works with CSS, but it doesn’t use CSS animations.<a data-type="indexterm" data-primary="CSS animations" data-secondary="TweenOne and" id="idm46634415748488" class="calibre6"/> Instead, it generates CSS transforms, which it updates many times each
second.<a data-type="indexterm" data-primary="transforms (CSS)" id="idm46634415747512" class="calibre6"/></p>

<p class="author1">You need to wrap the thing you want to animate in a <code class="calibre21">&lt;TweenOne/&gt;</code> element. For example, let’s say we want to animate a <code class="calibre21">rect</code> inside
an<a data-type="indexterm" data-primary="SVG path animations, using TweenOne" id="idm46634415770024" class="calibre6"/> SVG:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">TweenOne</code> <code class="na">component</code><code class="o">=</code><code class="s">'g'</code> <code class="na">animation</code><code class="o">=</code><code class="go">{...</code><code class="nx">details</code> <code class="nx">here</code><code class="go">}&gt;</code>
    <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="s">"2"</code> <code class="na">height</code><code class="o">=</code><code class="s">"6"</code> <code class="na">x</code><code class="o">=</code><code class="s">"3"</code> <code class="na">y</code><code class="o">=</code><code class="s">"-3"</code> <code class="na">fill</code><code class="o">=</code><code class="s">"white"</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">TweenOne</code><code class="go">&gt;</code></pre>

<p class="author1"><code class="calibre21">TweenOne</code> takes an element name and an object that will describe the animation to perform. We’ll come to what that animation object
looks like shortly.</p>

<p class="author1">TweenOne will use the element name (<code class="calibre21">g</code> in this case) to generate a wrapper around the animated thing. This wrapper will have a
style attribute that will include a set of CSS transforms to move and rotate the contents somewhere.</p>

<p class="author1">So in our example, at some point in the animation, the DOM might look like this:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">g</code> <code class="na">style</code><code class="o">=</code><code class="s">"transform: translate(881.555px, 489.614px) rotate(136.174deg);"</code><code class="go">&gt;</code>
  <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="s">"2"</code> <code class="na">height</code><code class="o">=</code><code class="s">"6"</code> <code class="na">x</code><code class="o">=</code><code class="s">"3"</code> <code class="na">y</code><code class="o">=</code><code class="s">"-3"</code> <code class="na">fill</code><code class="o">=</code><code class="s">"white"</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">g</code><code class="go">&gt;</code></pre>

<p class="author1">Although you can create similar effects to CSS animations, the TweenOne library works differently. Instead of handing the
animation to the hardware, the TweenOne library uses JavaScript to create each frame, which has two consequences.<a data-type="indexterm" data-primary="JavaScript" data-secondary="use by TweenOne, consequences of" id="idm46634415677880" class="calibre6"/><a data-type="indexterm" data-primary="CPU usage, TweenOne using JavaScript" id="idm46634415677032" class="calibre6"/> First, it uses
more CPU power (bad), and second, we can track the animation while it’s happening (good).</p>

<p class="author1">If we pass <code class="calibre21">TweenOne</code> an <code class="calibre21">onUpdate</code> callback, we will be sent information about the animation on every single frame:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">TweenOne</code> <code class="na">component</code><code class="o">=</code><code class="s">'g'</code> <code class="na">animation</code><code class="o">=</code><code class="go">{...</code><code class="nx">details</code> <code class="nx">here</code><code class="go">}</code> <code class="na">onUpdate</code><code class="o">=</code><code class="go">{</code><code class="nx">info</code><code class="o">=&gt;</code><code class="go">{...}}&gt;</code>
    <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="s">"2"</code> <code class="na">height</code><code class="o">=</code><code class="s">"6"</code> <code class="na">x</code><code class="o">=</code><code class="s">"3"</code> <code class="na">y</code><code class="o">=</code><code class="s">"-3"</code> <code class="na">fill</code><code class="o">=</code><code class="s">"white"</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">TweenOne</code><code class="go">&gt;</code></pre>

<p class="author1">The <code class="calibre21">info</code> object passed to <code class="calibre21">onUpdate</code> has a <code class="calibre21">ratio</code> value between 0 and 1, representing the proportion of the way the TweenOne
element is through an animation. We can use the <code class="calibre21">ratio</code> to animate text that is associated with the graphics.</p>

<p class="author1">For example, if we build an animated dashboard that shows vehicles on a race track, we can use <code class="calibre21">onUpdate</code> to show each car’s speed
and distance as it animates.</p>

<p class="author1">We’ll create the visuals for this example in SVG. First, let’s create a string containing an SVG path, which represents the track:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">export</code> <code class="kr">default</code> <code class="s">'m 723.72379,404.71306 ...  -8.30851,-3.00521 z'</code></pre>

<p class="author1">This is a greatly truncated version of the actual path that we’ll use. We can import the path string from <em class="calibre7">track.js</em> like this:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">path</code> <code class="nx">from</code> <code class="s">'./track'</code></pre>

<p class="author1">To display the track inside a React component, we can render an <code class="calibre21">svg</code> element:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">svg</code> <code class="na">height</code><code class="o">=</code><code class="s">"600"</code> <code class="na">width</code><code class="o">=</code><code class="s">"1000"</code> <code class="na">viewBox</code><code class="o">=</code><code class="s">"0 0 1000 600"</code>
     <code class="na">style</code><code class="o">=</code><code class="go">{{</code><code class="nx">backgroundColor</code><code class="o">:</code> <code class="s">'black'</code><code class="go">}}&gt;</code>
  <code class="go">&lt;</code><code class="nt">path</code> <code class="na">stroke</code><code class="o">=</code><code class="s">'#444'</code> <code class="na">strokeWidth</code><code class="o">=</code><code class="go">{</code><code class="mi">10</code><code class="go">}</code>
        <code class="na">fill</code><code class="o">=</code><code class="s">'none'</code> <code class="na">d</code><code class="o">=</code><code class="go">{</code><code class="nx">path</code><code class="go">}/&gt;</code>
<code class="go">&lt;/</code><code class="nt">svg</code><code class="go">&gt;</code></pre>

<p class="author1">We can add a couple of rectangles for the vehicle—a red one for the body and a white one for the windshield:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">svg</code> <code class="na">height</code><code class="o">=</code><code class="s">"600"</code> <code class="na">width</code><code class="o">=</code><code class="s">"1000"</code> <code class="na">viewBox</code><code class="o">=</code><code class="s">"0 0 1000 600"</code>
     <code class="na">style</code><code class="o">=</code><code class="go">{{</code><code class="nx">backgroundColor</code><code class="o">:</code> <code class="s">'black'</code><code class="go">}}&gt;</code>
  <code class="go">&lt;</code><code class="nt">path</code> <code class="na">stroke</code><code class="o">=</code><code class="s">'#444'</code> <code class="na">strokeWidth</code><code class="o">=</code><code class="go">{</code><code class="mi">10</code><code class="go">}</code>
        <code class="na">fill</code><code class="o">=</code><code class="s">'none'</code> <code class="na">d</code><code class="o">=</code><code class="go">{</code><code class="nx">path</code><code class="go">}/&gt;</code>
  <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">24</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">16</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">12</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">8</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">'red'</code><code class="go">/&gt;</code>
  <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">2</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">6</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="mi">3</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">3</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">'white'</code><code class="go">/&gt;</code>
<code class="go">&lt;/</code><code class="nt">svg</code><code class="go">&gt;</code></pre>

<p class="author1"><a data-type="xref" href="#ch04_image_16" class="calibre6">Figure 4-16</a> shows the track with the vehicle at the top-left corner.</p>

<figure class="calibre29"><div id="ch04_image_16" class="figure">
<img src="Images/recb_0416.png" alt="" class="calibre89"/>
<h6 class="calibre30"><span class="firstname">Figure 4-16. </span>The static image with a tiny vehicle at the top left</h6>
</div></figure>

<p class="author1">But how do we animate the vehicle around the track? TweenOne makes this easy because it contains a plugin to generate
animations that follow SVG path strings.</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">PathPlugin</code> <code class="nx">from</code> <code class="s">'rc-tween-one/lib/plugin/PathPlugin'</code>

<code class="nx">TweenOne</code><code class="go">.</code><code class="nx">plugins</code><code class="go">.</code><code class="nx">push</code><code class="go">(</code><code class="nx">PathPlugin</code><code class="go">)</code></pre>

<p class="author1">We’ve configured TweenOne for use with SVG path animations. That means we can look at how to describe an animation for TweenOne. We
do it with a simple JavaScript object:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">path</code> <code class="nx">from</code> <code class="s">'./track'</code>

<code class="kr">const</code> <code class="nx">followAnimation</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">path</code><code class="o">:</code> <code class="go">{</code> <code class="nx">x</code><code class="o">:</code> <code class="nx">path</code><code class="go">,</code> <code class="nx">y</code><code class="o">:</code> <code class="nx">path</code><code class="go">,</code> <code class="nx">rotate</code><code class="o">:</code> <code class="nx">path</code> <code class="go">},</code>
  <code class="nx">repeat</code><code class="o">:</code> <code class="o">-</code><code class="mi">1</code><code class="go">,</code>
<code class="go">}</code></pre>

<p class="author1">We tell TweenOne two things with this object: first, we’re telling it to generate translates and rotations that follow the <code class="calibre21">path</code>
string that we’ve imported from <em class="calibre7">track.js</em>. Second, we’re saying that we want the animation to loop infinitely by setting the
<code class="calibre21">repeat</code> count to –1.</p>

<p class="author1">We can use this as the basis of animation for our vehicle:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">svg</code> <code class="na">height</code><code class="o">=</code><code class="s">"600"</code> <code class="na">width</code><code class="o">=</code><code class="s">"1000"</code> <code class="na">viewBox</code><code class="o">=</code><code class="s">"0 0 1000 600"</code>
     <code class="na">style</code><code class="o">=</code><code class="go">{{</code><code class="nx">backgroundColor</code><code class="o">:</code> <code class="s">'black'</code><code class="go">}}&gt;</code>
  <code class="go">&lt;</code><code class="nt">path</code> <code class="na">stroke</code><code class="o">=</code><code class="s">'#444'</code> <code class="na">strokeWidth</code><code class="o">=</code><code class="go">{</code><code class="mi">10</code><code class="go">}</code>
        <code class="na">fill</code><code class="o">=</code><code class="s">'none'</code> <code class="na">d</code><code class="o">=</code><code class="go">{</code><code class="nx">path</code><code class="go">}/&gt;</code>
  <code class="go">&lt;</code><code class="nt">TweenOne</code> <code class="na">component</code><code class="o">=</code><code class="s">'g'</code> <code class="na">animation</code><code class="o">=</code><code class="go">{{...</code><code class="nx">followAnimation</code><code class="go">,</code> <code class="nx">duration</code><code class="o">:</code> <code class="mi">16000</code><code class="go">}}&gt;</code>
    <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">24</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">16</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">12</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">8</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">'red'</code><code class="go">/&gt;</code>
    <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">2</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">6</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="mi">3</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">3</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">'white'</code><code class="go">/&gt;</code>
  <code class="go">&lt;/</code><code class="nt">TweenOne</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">svg</code><code class="go">&gt;</code></pre>

<p class="author1">Notice that we’re using the spread operator to provide an additional animation parameter: <code class="calibre21">duration</code>. A value of 16000 means we want
the animation to take 16 
<span class="firstname">seconds</span>.<a data-type="indexterm" data-primary="duration parameter" id="idm46634415270312" class="calibre6"/></p>

<p class="author1">We can add a second vehicle and use the <code class="calibre21">onUpdate</code> callback method to create a very rudimentary set of faked telemetry statistics
for each one as they move around the track. Here is the completed code:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">TweenOne</code> <code class="nx">from</code> <code class="s">'rc-tween-one'</code>
<code class="kr">import</code> <code class="nx">Details</code> <code class="nx">from</code> <code class="s">'./Details'</code>
<code class="kr">import</code> <code class="nx">path</code> <code class="nx">from</code> <code class="s">'./track'</code>
<code class="kr">import</code> <code class="nx">PathPlugin</code> <code class="nx">from</code> <code class="s">'rc-tween-one/lib/plugin/PathPlugin'</code>
<code class="kr">import</code> <code class="nx">grid</code> <code class="nx">from</code> <code class="s">'./grid.svg'</code>

<code class="kr">import</code> <code class="s">'./App.css'</code>

<code class="nx">TweenOne</code><code class="go">.</code><code class="nx">plugins</code><code class="go">.</code><code class="nx">push</code><code class="go">(</code><code class="nx">PathPlugin</code><code class="go">)</code>

<code class="kr">const</code> <code class="nx">followAnimation</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">path</code><code class="o">:</code> <code class="go">{</code> <code class="nx">x</code><code class="o">:</code> <code class="nx">path</code><code class="go">,</code> <code class="nx">y</code><code class="o">:</code> <code class="nx">path</code><code class="go">,</code> <code class="nx">rotate</code><code class="o">:</code> <code class="nx">path</code> <code class="go">},</code>
  <code class="nx">repeat</code><code class="o">:</code> <code class="o">-</code><code class="mi">1</code><code class="go">,</code>
<code class="go">}</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">redTelemetry</code><code class="go">,</code> <code class="nx">setRedTelemetry</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">({</code>
    <code class="nx">dist</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
    <code class="nx">speed</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
    <code class="nx">lap</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
  <code class="go">})</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">blueTelemetry</code><code class="go">,</code> <code class="nx">setBlueTelemetry</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">({</code>
    <code class="nx">dist</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
    <code class="nx">speed</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
    <code class="nx">lap</code><code class="o">:</code> <code class="mi">0</code><code class="go">,</code>
  <code class="go">})</code>

  <code class="kr">const</code> <code class="nx">trackVehicle</code> <code class="o">=</code> <code class="go">(</code><code class="nx">info</code><code class="go">,</code> <code class="nx">telemetry</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">({</code>
    <code class="nx">dist</code><code class="o">:</code> <code class="nx">info</code><code class="go">.</code><code class="nx">ratio</code><code class="go">,</code>
    <code class="nx">speed</code><code class="o">:</code> <code class="nx">info</code><code class="go">.</code><code class="nx">ratio</code> <code class="o">-</code> <code class="nx">telemetry</code><code class="go">.</code><code class="nx">dist</code><code class="go">,</code>
    <code class="nx">lap</code><code class="o">:</code>
      <code class="nx">info</code><code class="go">.</code><code class="nx">ratio</code> <code class="o">&lt;</code> <code class="nx">telemetry</code><code class="go">.</code><code class="nx">dist</code> <code class="o">?</code> <code class="nx">telemetry</code><code class="go">.</code><code class="nx">lap</code> <code class="o">+</code> <code class="mi">1</code> <code class="o">:</code> <code class="nx">telemetry</code><code class="go">.</code><code class="nx">lap</code><code class="go">,</code>
  <code class="go">})</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Nürburgring</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Details</code>
        <code class="na">redTelemetry</code><code class="o">=</code><code class="go">{</code><code class="nx">redTelemetry</code><code class="go">}</code>
        <code class="na">blueTelemetry</code><code class="o">=</code><code class="go">{</code><code class="nx">blueTelemetry</code><code class="go">}</code>
      <code class="go">/&gt;</code>
      <code class="go">&lt;</code><code class="nt">svg</code>
        <code class="na">height</code><code class="o">=</code><code class="s">"600"</code>
        <code class="na">width</code><code class="o">=</code><code class="s">"1000"</code>
        <code class="na">viewBox</code><code class="o">=</code><code class="s">"0 0 1000 600"</code>
        <code class="na">style</code><code class="o">=</code><code class="go">{{</code> <code class="nx">backgroundColor</code><code class="o">:</code> <code class="s">'black'</code> <code class="go">}}</code>
      <code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">image</code> <code class="na">href</code><code class="o">=</code><code class="go">{</code><code class="nx">grid</code><code class="go">}</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">1000</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">600</code><code class="go">}</code> <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">path</code> <code class="na">stroke</code><code class="o">=</code><code class="s">"#444"</code> <code class="na">strokeWidth</code><code class="o">=</code><code class="go">{</code><code class="mi">10</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">"none"</code> <code class="na">d</code><code class="o">=</code><code class="go">{</code><code class="nx">path</code><code class="go">}</code> <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">path</code>
          <code class="na">stroke</code><code class="o">=</code><code class="s">"#c0c0c0"</code>
          <code class="na">strokeWidth</code><code class="o">=</code><code class="go">{</code><code class="mi">2</code><code class="go">}</code>
          <code class="na">strokeDasharray</code><code class="o">=</code><code class="s">"3 4"</code>
          <code class="na">fill</code><code class="o">=</code><code class="s">"none"</code>
          <code class="na">d</code><code class="o">=</code><code class="go">{</code><code class="nx">path</code><code class="go">}</code>
        <code class="go">/&gt;</code>

        <code class="go">&lt;</code><code class="nt">TweenOne</code>
          <code class="na">component</code><code class="o">=</code><code class="s">"g"</code>
          <code class="na">animation</code><code class="o">=</code><code class="go">{{</code>
            <code class="go">...</code><code class="nx">followAnimation</code><code class="go">,</code>
            <code class="nx">duration</code><code class="o">:</code> <code class="mi">16000</code><code class="go">,</code>
            <code class="nx">onUpdate</code><code class="o">:</code> <code class="go">(</code><code class="nx">info</code><code class="go">)</code> <code class="o">=&gt;</code>
              <code class="nx">setRedTelemetry</code><code class="go">((</code><code class="nx">telemetry</code><code class="go">)</code> <code class="o">=&gt;</code>
                <code class="nx">trackVehicle</code><code class="go">(</code><code class="nx">info</code><code class="go">,</code> <code class="nx">telemetry</code><code class="go">)</code>
              <code class="go">),</code>
          <code class="go">}}</code>
        <code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">24</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">16</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">12</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">8</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">"red"</code> <code class="go">/&gt;</code>
          <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">2</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">6</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="mi">3</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">3</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">"white"</code> <code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">TweenOne</code><code class="go">&gt;</code>

        <code class="go">&lt;</code><code class="nt">TweenOne</code>
          <code class="na">component</code><code class="o">=</code><code class="s">"g"</code>
          <code class="na">animation</code><code class="o">=</code><code class="go">{{</code>
            <code class="go">...</code><code class="nx">followAnimation</code><code class="go">,</code>
            <code class="nx">delay</code><code class="o">:</code> <code class="mi">3000</code><code class="go">,</code>
            <code class="nx">duration</code><code class="o">:</code> <code class="mi">15500</code><code class="go">,</code>
            <code class="nx">onUpdate</code><code class="o">:</code> <code class="go">(</code><code class="nx">info</code><code class="go">)</code> <code class="o">=&gt;</code>
              <code class="nx">setBlueTelemetry</code><code class="go">((</code><code class="nx">telemetry</code><code class="go">)</code> <code class="o">=&gt;</code>
                <code class="nx">trackVehicle</code><code class="go">(</code><code class="nx">info</code><code class="go">,</code> <code class="nx">telemetry</code><code class="go">)</code>
              <code class="go">),</code>
          <code class="go">}}</code>
        <code class="go">&gt;</code>
          <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">24</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">16</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">12</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">8</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">"blue"</code> <code class="go">/&gt;</code>
          <code class="go">&lt;</code><code class="nt">rect</code> <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">2</code><code class="go">}</code> <code class="na">height</code><code class="o">=</code><code class="go">{</code><code class="mi">6</code><code class="go">}</code> <code class="na">x</code><code class="o">=</code><code class="go">{</code><code class="mi">3</code><code class="go">}</code> <code class="na">y</code><code class="o">=</code><code class="go">{</code><code class="o">-</code><code class="mi">3</code><code class="go">}</code> <code class="na">fill</code><code class="o">=</code><code class="s">"white"</code> <code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">TweenOne</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">svg</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1"><a data-type="xref" href="#ch04_image_17" class="calibre6">Figure 4-17</a> shows the animation. The vehicles follow the path of the race track, rotating to face the direction of travel.</p>

<figure class="calibre29"><div id="ch04_image_17" class="figure">
<img src="Images/recb_0417.png" alt="" class="calibre90"/>
<h6 class="calibre30"><span class="firstname">Figure 4-17. </span>Our final animation with telemetry generated from the current animation state</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634415773288">
<h2 class="calibre27">Discussion</h2>

<p class="author1">CSS animations are what you should use for most UI animation. However, in the case of infographics, you often need to synchronize
the text and the graphics. TweenOne makes that possible, at the cost of greater CPU usage.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/8l7Vp" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="infographics, animating with TweenOne" data-startref="ix_infogani" id="idm46634414825768" class="calibre6"/><a data-type="indexterm" data-primary="TweenOne, animating infographics with" data-startref="ix_TwnO" id="idm46634414824792" class="calibre6"/><a data-type="indexterm" data-primary="animations" data-secondary="animating infographics using TweenOne" data-startref="ix_animinfgr" id="idm46634414823880" class="calibre6"/><a data-type="indexterm" data-primary="interaction design" data-startref="ix_intdes" id="idm46634414822648" class="calibre6"/></p>
</div></section>





</div></section>







<div data-type="footnotes" class="calibre49"><p data-type="footnote" id="idm46634420299832" class="calibre50"><sup class="calibre51"><a href="ch04.xhtml#idm46634420299832-marker" class="calibre35">1</a></sup> You can download all source code for this recipe on the <a href="https://oreil.ly/wUM7Q" class="calibre6">GitHub repository</a>.</p><p data-type="footnote" id="idm46634418710008" class="calibre50"><sup class="calibre51"><a href="ch04.xhtml#idm46634418710008-marker" class="calibre35">2</a></sup> See <a data-type="xref" href="#ch04-05" class="calibre6">“Use Markdown for Rich Content”</a> for details on how to use Markdown in your application.</p><p data-type="footnote" id="idm46634418414536" class="calibre50"><sup class="calibre51"><a href="ch04.xhtml#idm46634418414536-marker" class="calibre35">3</a></sup> See the <a href="https://oreil.ly/DCGIv" class="calibre6">GitHub repository</a> for the tests we used to drive out this code.</p><p data-type="footnote" id="idm46634416427016" class="calibre50"><sup class="calibre51"><a href="ch04.xhtml#idm46634416427016-marker" class="calibre35">4</a></sup> Paper books are beautiful things, but to fully experience the animation effect, see the complete code on <a href="https://oreil.ly/OcAqo" class="calibre6"> <span class="firstname">GitHub</span></a>.</p></div></div></section></div></body></html>