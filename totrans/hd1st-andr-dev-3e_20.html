<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. Recycler View Navigation: Pick a Card"><div class="chapter" id="recycler_view_navigationcolon_pick_a_car">
<h1><span class="label">Chapter 17. </span>Recycler View Navigation: <em>Pick a Card</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0705-01.png" alt="image" width="348" height="591"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="recycler view navigation" id="idm46053734195088"/><strong>Some apps rely on the user selecting an item from a list.</strong></p>
<p>And in this chapter, you’ll learn <strong>how to make recycler views a core part of your app design</strong> by <strong>making their items clickable</strong>. You’ll discover how to <strong>implement recycler view navigation</strong> by making the app navigate to a new screen each time the user clicks on a record. You’ll find out <strong>how to show the user extra information</strong> about their chosen record, and update it in the database. By the end of this chapter, you’ll have all the tools you need to <strong>transform your awesome ideas into the app of your dreams</strong>…</p>
<section data-type="sect1" data-pdf-bookmark="Recycler views can be used for navigation"><div class="sect1" id="recycler_views_can_be_used_for_navigatio">
<h1>Recycler views can be used for navigation</h1>
<p><a data-type="indexterm" data-primary="Tasks app" id="idm46053734188352"/>In the previous two chapters, you learned how to build a recycler view that displays a scrollable list of data, and used <code>DiffUtil</code> to make it more efficient. But this isn’t the end of the story.</p>
<p>Recycler views are a major component of many Android apps because, in addition to displaying lists of data, you can use them to navigate through the app. When the user clicks on an item in the recycler view, you can make the app navigate to a new fragment, which displays further details of that record.</p>
<p>To see how this works, we’re going to change up the Tasks app so that when the user clicks on one of the tasks in its recycler view, it navigates to a new fragment. This fragment will display the record that’s been selected, and let the user update or delete it:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0706-01.png" alt="image" width="600" height="499"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How the Tasks app is currently structured"><div class="sect1" id="how_the_tasks_app_is_currently_structure">
<h1>How the Tasks app is currently structured</h1>
<p><a data-type="indexterm" data-primary="Tasks app" data-secondary="structure" id="idm46053734183056"/>Before we look at how we need to change the Tasks app, let’s remind ourselves of its current structure.</p>
<p>The app is comprised of a single activity (<code>MainActivity</code>), which displays a fragment named <code>TasksFragment</code>. This fragment is the app’s main screen, and its layout includes a recycler view that displays a grid of tasks. The recycler view uses an adapter named <code>TaskItemAdapter</code>, and its items are arranged using the layout file.</p>
<p><code>TasksFragment</code> uses a view model named <code>TasksViewModel</code>. The view model is responsible for the fragment’s business logic, and gets its data from a Room database using an interface named <code>TaskDao</code>.</p>
<p>Here’s how these components fit together:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0707-01.png" alt="image" width="600" height="569"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’re going to make the recycler view navigate to a new fragment"><div class="sect1" id="weapostrophere_going_to_make_the_recycle">
<h1>We’re going to make the recycler view navigate to a new fragment</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" id="idm46053734171872"/>We’re going to update the Tasks app so that when the user clicks on a task in the recycler view, it displays a fragment named <code>EditTaskFragment</code>. Here’s what the new fragment will look like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0708-01.png" alt="image" width="600" height="230"/>
<h6/>
</div></figure>
<p>As you can see, <code>EditTaskFragment</code> includes an edit text and a checkbox that let the user edit the task. The edit text displays the name of the task, and the checkbox shows whether the task has been completed.</p>
<p>The fragment also includes an Update Task button, which, when clicked, updates the record in the database, and a Delete Task button, which deletes the record. When either of these are clicked, the app navigates back to <code>TasksFragment</code>, which displays an updated list of tasks in its recycler view:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0708-02.png" alt="image" width="600" height="231"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s what we’re going to do"><div class="sect1" id="hereapostrophes_what_weapostroph-id00267">
<h1>Here’s what we’re going to do</h1>
<p>We’re going to build the new version of the app in the following three stages:</p>
<ol>
<li><p><strong>Make items in the recycler view respond to clicks.</strong></p>
<p>We’ll update the app so that when we click on a task in the recycler view, its ID is displayed in a toast.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0709-01.png" alt="image" width="600" height="162"/>
<h6/>
</div></figure></li>
<li><p><strong>Navigate to EditTaskFragment when an item is clicked.</strong></p>
<p>We’ll create <code>EditTaskFragment</code>, and use the Navigation component to navigate to it when the user clicks on a task record. We’ll display the task’s ID in the new fragment.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0709-02.png" alt="image" width="600" height="132"/>
<h6/>
</div></figure></li>
<li><p><strong>Display the task record in EditTaskFragment, and let the user update or delete the record.</strong></p>
<p>We’ll create a view model for <code>EditTaskFragment</code>, which will use the <code>TaskDao</code> interface to interact with the database.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0709-03.png" alt="image" width="375" height="301"/>
<h6/>
</div></figure></li>
</ol>
<figure class="informal"><div class="figure">
<img src="Images/f0709-04.png" alt="image" width="314" height="296"/>
<h6/>
</div></figure>
<p>We’ll begin by making the recycler view respond to clicks.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Make each item clickable"><div class="sect1" id="make_each_item_clickable">
<h1>Make each item clickable</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0710-01.png" alt="image" width="305" height="87"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="bind() method, TaskItemViewHolder" id="idm46053734146000"/><a data-type="indexterm" data-primary="click response" data-secondary="recycler view navigation" id="idm46053734145040"/><a data-type="indexterm" data-primary="OnClickListener" data-secondary="adding to Task items" id="idm46053734143968"/><a data-type="indexterm" data-primary="recycler view navigation" data-secondary="click response" id="idm46053734142864"/><a data-type="indexterm" data-primary="setOnClickListener() method, activity" id="idm46053734141792"/><a data-type="indexterm" data-primary="TaskItemViewHolder inner class" data-secondary="OnClickListener" id="idm46053734140992"/>The first change we’re going to make to the Tasks app is to make it display a toast when the user clicks on one of the items in the recycler view.</p>
<p>We can make each item respond to clicks by adding an <code>OnClickListener</code> to each item’s root view. To do this, we’ll call each item’s <code>setOnClickListener()</code> method immediately after each item’s data gets added to its layout.</p>
<p>The best place to add each <code>OnClickListener</code> is in the <code>TaskItemViewHolder</code>’s <code>bind()</code> method, since this is where the layout’s data binding variable gets set to a <code>Task</code> item. As you may recall, the <code>bind()</code> method gets called by <code>TaskItemAdapter</code>’s <code>onBindViewHolder()</code> method, which fires each time the recycler view needs to display an item’s data.</p>
<p>Here’s the code to add an <code>OnClickListener</code> to the root view of each item’s layout; we’ll add this to <em>TaskItemAdapter.kt</em> a few pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0710-02.png" alt="image" width="185" height="322"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0710-03.png" alt="image" width="600" height="359"/>
<h6/>
</div></figure>
<p>Now that you know how to add an <code>OnClickListener</code> to each item, let’s make it display a toast when an item is clicked.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Where should we create the toast?"><div class="sect1" id="where_should_we_create_the_toastquestion">
<h1>Where should we create the toast?</h1>
<p><a data-type="indexterm" data-primary="setOnClickListener() method, activity" id="idm46053734128560"/><a data-type="indexterm" data-primary="TaskItemAdapter" data-secondary="passing of Toast to TaskItemViewHolder via" id="idm46053734125632"/><a data-type="indexterm" data-primary="TaskItemViewHolder inner class" data-secondary="passing of Toast to" id="idm46053734124432"/><a data-type="indexterm" data-primary="TasksFragment" data-secondary="passing Toast code in lambda" id="idm46053734123360"/><a data-type="indexterm" data-primary="toast, popup message" id="idm46053734122288"/>To display a toast each time an item’s clicked, we <em>could</em> simply add the following code (in bold) to the view holder’s <code>setOnClickListener()</code> method:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0711-02.png" alt="image" width="600" height="354"/>
<h6/>
</div></figure>
<p>This approach, however, would mean that we’d be putting code that describes the app’s behavior in the view holder code. This code is responsible for binding data to each item’s layout, so it’s not an appropriate place for us to put this kind of code.</p>
<p>Adding the toast code to the view holder would also make the view holder code less flexible. It would mean that each time the user clicks on an item, it could only display a toast, and couldn’t be reused elsewhere.</p>
<p>So what’s the alternative?</p>
<section data-type="sect2" data-pdf-bookmark="We’ll make TasksFragment pass the toast code in a lambda"><div class="sect2" id="weapostrophell_make_tasksfragment_pass_t">
<h2>We’ll make TasksFragment pass the toast code in a lambda</h2>
<p>An alternative is to define the code each item needs to execute in <code>TasksFragment</code>, and pass it to <code>TaskItemViewHolder</code>—via <code>TaskItemAdapter</code>—in a lambda. Doing so means that the <em>fragment</em> controls what happens when an item is clicked instead of the view holder.</p>
<p>Before we look at the code, let’s run through how it will work.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How the code will work"><div class="sect1" id="how_the_code_will_work">
<h1>How the code will work</h1>
<p>Here’s what the code we’re going to write will do:</p>
<ol>
<li><p><strong>TasksFragment will pass a lambda to TaskItemAdapter’s constructor.</strong></p>
<p>The lambda includes the code to display a toast.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0712-02.png" alt="image" width="447" height="126"/>
<h6/>
</div></figure></li>
<li><p><strong>When the TaskItemAdapter’s onBindViewHolder() method is called, it calls the TaskItemViewHolder’s bind() method, and passes it the lambda.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0712-03.png" alt="image" width="600" height="100"/>
<h6/>
</div></figure></li>
<li><p><strong>The TaskItemViewHolder adds the lambda to each item’s OnClickListener.</strong></p>
<p>When the user clicks on each item (a <code>CardView</code>), it executes the lambda and displays the toast.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0712-04.png" alt="image" width="571" height="116"/>
<h6/>
</div></figure></li>
</ol>
<p>So that’s how the code will work.</p>
<p>To implement this, we need to update the <code>TasksFragment</code>, <code>TaskItemAdapter</code>, and <code>TaskItemViewHolder</code> code. We’ll begin by updating the <code>TaskItemAdapter</code> and <code>TaskItemViewHolder</code> code so that the adapter is able to accept the lambda, and pass it to the view holder.</p>
<p>We’ll show you the code for this on the next page.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for TaskItemAdapter.kt"><div class="sect1" id="the_full_code_for_taskitemadapte-id00268">
<h1>The full code for TaskItemAdapter.kt</h1>
<p><a data-type="indexterm" data-primary="TaskItemAdapter" data-secondary="code for" id="idm46053734096928"/>Here’s the <code>TaskItemAdapter</code> and <code>TaskItemViewHolder</code> code; update <em>TaskItemAdapter.kt</em> to include all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0713-02.png" alt="image" width="600" height="670"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ll pass a lambda to TaskItemAdapter"><div class="sect1" id="weapostrophell_pass_a_lambda_to_taskitem">
<h1>We’ll pass a lambda to TaskItemAdapter</h1>
<p>Now that <code>TaskItemAdapter</code> includes a lambda parameter in its constructor, we need to pass one to it in the <code>TasksFragment</code> code where it gets created.</p>
<p>As you may recall, <code>TasksFragment</code> creates a <code>TaskItemAdapter</code> object in its <code>onCreateView()</code> method, which it then assigns to the recycler view like so:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0714-02.png" alt="image" width="600" height="229"/>
<h6/>
</div></figure>
<p>As we want to display a toast each time an item in the recycler view is clicked, we can update this code so that it passes the following lambda to <code>TaskItemAdapter</code>’s constructor:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0714-03.png" alt="image" width="600" height="191"/>
<h6/>
</div></figure>
<p>The adapter passes the lambda to <code>TaskItemViewHolder</code>’s <code>bind()</code> method, which uses the lambda in the <code>OnClickListener</code> code it assigns to each item’s root view. When the user clicks on an item in the recycler view, the lambda is executed.</p>
<p>You’ve now learned everything that you need to know to make an item in the recycler view display a toast when it’s clicked. Let’s see what the full code for <code>TasksFragment</code> looks like.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0714-04.png" alt="image" width="513" height="298"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for TasksFragment.kt"><div class="sect1" id="the_full_code_for_tasksfragmentd-id00269">
<h1>The full code for TasksFragment.kt</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0715-01.png" alt="image" width="305" height="87"/>
<h6/>
</div></figure>
<p>Here’s the updated <code>TasksFragment</code> code; make sure that the code in <em>TasksFragment.kt</em> includes all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0715-02.png" alt="image" width="600" height="566"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0716-02.png" alt="image" width="600" height="342"/>
<h6/>
</div></figure>
<p>Let’s see what happens when the code runs.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00270">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: In the <code>TaskItemAdapter</code> code, you defined the <code>clickListener</code> argument’s type as (<code>taskId: Long) -&gt; Unit</code>. Can you remind me what that means?</strong></p>
<p><strong>A:</strong> It means that the argument can be passed a piece of code called a lambda. The code accepts a <code>Long</code> argument named <code>taskId</code>, and returns <code>Unit</code>.</p>
<p><strong>Q: I see. So it’s really just a way of passing code to a method?</strong></p>
<p><strong>A:</strong> Yes. It means that we can make <code>TasksFragment</code> specify what code should run, instead of hardcoding it in the <code>TaskItemAdapter</code> code.</p>
<p><strong>Q: Would adding it to the <code>TaskItemAdapter</code> code really be so bad?</strong></p>
<p><strong>A:</strong> It would make the adapter code less flexible, and the app’s components wouldn’t have such a clear separation of concerns.</p>
<p><strong>Q: I think I’ve seen other ways of making a recycler view respond to clicks. Are these ways wrong?</strong></p>
<p><strong>A:</strong> There are many different ways of making a recycler view respond to clicks. We chose this approach because it’s pretty flexible, and easier to learn than some other methods.</p>
<p>We suggest that you get to grips with the approach we’re using in this chapter before exploring other approaches.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the code runs"><div class="sect1" id="what_happens_when_the_code_runs-id00271">
<h1>What happens when the code runs</h1>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>TasksFragment creates a TaskItemAdapter object, and assigns it to the recycler view as its adapter.</strong></p>
<p>The fragment passes a lambda (named <code>clickListener</code>) to the adapter, telling it to display a toast when it’s executed.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0717-02.png" alt="image" width="600" height="111"/>
<h6/>
</div></figure></li>
<li><p><strong>TasksFragment submits a List&lt;Task&gt; to the TaskItemAdapter.</strong></p>
<p>The <code>List&lt;Task&gt;</code> contains an up-to-date list of records from the database.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0717-03.png" alt="image" width="429" height="306"/>
<h6/>
</div></figure></li>
<li><p><strong>TaskItemAdapter’s onCreateViewHolder() method is called for each item that needs to be displayed in the recycler view.</strong></p>
<p>This creates a set of <code>TaskItemViewHolder</code>s.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0717-04.png" alt="image" width="592" height="230"/>
<h6/>
</div></figure></li>
<li><p><strong>TaskItemAdapter’s onBindViewHolder() method is called for each TaskItemViewHolder.</strong></p>
<p>This calls the <code>TaskItemViewHolder</code>’s <code>bind()</code> method, passing it the item that was clicked and the <code>clickListener</code> lambda.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0718-02.png" alt="image" width="600" height="187"/>
<h6/>
</div></figure></li>
<li><p><strong>The TaskItemViewHolder’s bind() method adds an OnClickListener to the root view of each view holder’s layout.</strong></p>
<p>In this example, the root view is a <code>CardView</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0718-03.png" alt="image" width="600" height="112"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user clicks on an item in the recycler view, the OnClickListener registers the click.</strong></p>
<p>It executes the <code>clickListener</code> lambda, which displays a toast.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0718-04.png" alt="image" width="275" height="305"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00272">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>TasksFragment</code> displays a grid of cards in the recycler view as before. If we click on one of the tasks, the app displays its ID in a toast.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0719-02.png" alt="image" width="600" height="554"/>
<h6/>
</div></figure>
<p>You’ve now learned how to make a recycler view’s items respond to click events. We’ll use this knowledge to make the app navigate to a new fragment when an item is clicked.</p>
<p>Before we do this, try the following exercise.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Adapter Magnets"><div class="sect1" id="adapter_magnets-id00273">
<h1>Adapter Magnets</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="adapter, recycler view" data-secondary="exercises" id="idm46053734018896"/><a data-type="indexterm" data-primary="Bits and Pizzas app" data-secondary="exercises" id="idm46053734017648"/><a data-type="indexterm" data-primary="exercises" data-secondary="Magnets" id="idm46053734016544"/>The Bits and Pizzas app includes a recycler view that uses a layout named <em>pizza_item.xml</em> to display <code>Pizza</code> objects. The <code>Pizza</code> data class looks like this:</p>
<pre data-type="programlisting">package com.hfad.bitsandpizzas

data class Pizza(
    var pizzaId: Long = 0L,
    var pizzaName: String = "",
    var pizzaDescription: String = "",
    var pizzaImageId: Int = 0
)</pre>
<p>The recycler view uses an adapter named <code>PizzaAdapter</code>, shown below. See if you can complete the code for this adapter so that when one of its items is clicked, it executes a lambda that’s passed to the adapter in its constructor.</p>
<p>Hint: The lambda should accept a <code>pizzaId</code> argument, and return <code>Unit</code>.</p>
<pre data-type="programlisting">package com.hfad.bitsandpizzas

import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.recyclerview.widget.ListAdapter
import androidx.recyclerview.widget.RecyclerView
import com.hfad.bitsandpizzas.databinding.PizzaItemBinding

class PizzaAdapter(val clickListener:..................................................)

    : ListAdapter&lt;Pizza, PizzaAdapter.PizzaViewHolder&gt;(PizzaDiffItemCallback) {

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int)
                         : PizzaViewHolder = PizzaViewHolder.inflateFrom(parent)

    override fun onBindViewHolder(holder: PizzaViewHolder, position: Int) {
        val item = getItem(position)

        holder.bind(item,........................)
    }
    class PizzaViewHolder(val binding: PizzaItemBinding)
                                         : RecyclerView.ViewHolder(binding.root) {

        companion object {
            fun inflateFrom(parent: ViewGroup): PizzaViewHolder {
                val layoutInflater = LayoutInflater.from(parent.context)

                val binding = PizzaItemBinding.inflate(layoutInflater, parent, false)
                return PizzaViewHolder(binding)
            }
        }

        fun bind(item: Pizza,

                ................................................................) {

            binding.pizza = item

            binding.root..............................

              ........................................

            .......................
        }
    }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0721-01.png" alt="image" width="600" height="151"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Adapter Magnets Solution"><div class="sect1" id="adapter_magnets_solution-id00274">
<h1>Adapter Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p>The Bits and Pizzas app includes a recycler view that uses a layout named <em>pizza_item.xml</em> to display <code>Pizza</code> objects. The <code>Pizza</code> data class looks like this:</p>
<pre data-type="programlisting">package com.hfad.bitsandpizzas

data class Pizza(
    var pizzaId: Long = 0L,
    var pizzaName: String = "",
    var pizzaDescription: String = "",
    var pizzaImageId: Int = 0
)</pre>
<p>The recycler view uses an adapter named <code>PizzaAdapter</code>, shown below. See if you can complete the code for this adapter so that when one of its items is clicked, it executes a lambda that’s passed to the adapter in its constructor.</p>
<p>Hint: The lambda should accept a <code>pizzaId</code> argument, and return <code>Unit</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0722-01.png" alt="image" width="600" height="359"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0723-01.png" alt="image" width="600" height="650"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We want to use the recycler view to navigate to a new fragment"><div class="sect1" id="we_want_to_use_the_recycler_view_to_navi">
<h1>We want to use the recycler view to navigate to a new fragment</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0724-01.png" alt="image" width="305" height="86"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="recycler view navigation" data-secondary="navigating to new fragment" id="idm46053733989856"/>So far, you’ve learned how to make items in a recycler view respond to click events. When the user clicks on a task in the Tasks app’s recycler view, for example, it displays a toast.</p>
<p>Next, we’re going to change this behavior so that when the user clicks on an item, the app navigates to a new fragment (which we’ll create) and displays the task’s ID. Here’s what the new version of the app will look like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0724-02.png" alt="image" width="600" height="536"/>
<h6/>
</div></figure>
<p>To get this working, we’ll use the Navigation component to navigate to the new fragment, and the Safe Args plug-in to pass the fragment the task’s ID. This means that we needs to update the project and the app’s <em>build.gradle</em> files to include these components.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update the project build.gradle file…"><div class="sect1" id="update_the_project_builddotgradl-id00275">
<h1>Update the <u>project</u> build.gradle file…</h1>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="updating for Tasks app interactivity" id="idm46053733983728"/><a data-type="indexterm" data-primary="Safe Args plug-in" data-secondary="Bits and Pizzas app" id="idm46053733982112"/>We’ll begin by updating the project’s <em>build.gradle</em> file so that it specifies which version of the Navigation component we want to use, and adds a classpath for the Safe Args plug-in.</p>
<p>To do this, open the file <em>Tasks/build.gradle</em>, and add the following lines (in bold) to the relevant sections:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0725-02.png" alt="image" width="600" height="155"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="…then update the app build.gradle file"><div class="sect2" id="hellipthen_update_the_app_builddotgradle">
<h2>…then update the <u>app</u> build.gradle file</h2>
<p>We also need to add the Safe Args plug-in to the app’s <em>build.gradle</em> file, along with a dependency for the Navigation component.</p>
<p>Open the file <em>Tasks/app/build.gradle</em>, and add the following lines (in bold) to the appropriate sections</p>
<figure class="informal"><div class="figure">
<img src="Images/f0725-03.png" alt="image" width="600" height="207"/>
<h6/>
</div></figure>
<p>Once you’ve made these changes, click on the Sync Now option to sync the changes you’ve made with the rest of your project.</p>
<p>Now that we’ve enabled the Navigation component and the Safe Args plug-in, let’s create the new fragment that we want the app to be able to navigate to.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create EditTaskFragment…"><div class="sect1" id="create_edittaskfragmenthellip">
<h1>Create EditTaskFragment…</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="creating" id="idm46053733970288"/><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="navigation graph" id="idm46053733967648"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" data-tertiary="EditTaskFragment" id="idm46053733966544"/><a data-type="indexterm" data-primary="TasksFragment" data-secondary="EditTaskFragment navigation" id="idm46053733965168"/>We’re going to create a new fragment named <code>EditTaskFragment</code> that the app will navigate to when the user clicks an item in the recycler view.</p>
<p>To do this, highlight the <em>com.hfad.tasks</em> package in the <em>app/src/main/java</em> folder, then choose File→New→Fragment→Fragment (Blank). Name the fragment “EditTaskFragment”, name its layout “fragment_edit_task”, and make sure the language is set to Kotlin.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0726-02.png" alt="image" width="374" height="230"/>
<h6/>
</div></figure>
<p>We’ll update the code for <code>EditTaskFragment</code> and its layout a few pages ahead. Before that, let’s create a navigation graph that will tell the app how to navigate between the app’s fragments.</p>
<section data-type="sect2" data-pdf-bookmark="…and create a navigation graph"><div class="sect2" id="hellipand_create_a_navigation_graph">
<h2>…and create a navigation graph</h2>
<p>We’ll add a navigation graph to the project in the same way that we did for the other apps we created.</p>
<p>Select the <em>Tasks/app/src/main/res</em> folder in the project explorer, and then choose File→New→Android Resource File. When prompted, enter a file name of “nav_graph”, choose a resource type of “Navigation”, and click on the OK button. This creates a navigation graph named <em>nav_graph.xml</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0726-03.png" alt="image" width="213" height="165"/>
<h6/>
</div></figure>
<p>The navigation graph needs to describe how the user will navigate between <code>TasksFragment</code> and <code>EditTaskFragment</code>. Here’s how the navigation needs to work:</p>
<ol>
<li><p><strong>The app displays TasksFragment.</strong></p>
<p>This is the first fragment the user needs to see, so it needs to be the navigation graph’s start destination.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0726-04.png" alt="image" width="412" height="214"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user clicks an item in TasksFragment’s recycler view, the app navigates to EditTaskFragment.</strong></p>
<p><code>TasksFragment</code> will pass <code>EditTaskFragment</code> a <code>Long</code> parameter containing the task ID for the clicked item.</p></li>
<li><p><strong>When the user clicks a button in EditTaskFragment (which we’ll add to the fragment later in the chapter), the app navigates back to TasksFragment.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0726-05.png" alt="image" width="412" height="188"/>
<h6/>
</div></figure></li>
</ol>
<p>We’ll show you the full code for this on the next page.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update the navigation graph"><div class="sect1" id="update_the_navigation_graph-id00276">
<h1>Update the navigation graph</h1>
<p>Here’s the full code for the navigation graph; update <em>nav_graph.xml</em> to include the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0727-02.png" alt="image" width="600" height="583"/>
<h6/>
</div></figure>
<p>Next, let’s link the navigation graph to <code>MainActivity</code> so that it displays each fragment when we navigate to it.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a NavHostFragment to MainActivity’s layout"><div class="sect1" id="add_a_navhostfragment_to_mainactivityapo">
<h1>Add a NavHostFragment to MainActivity’s layout</h1>
<p><a data-type="indexterm" data-primary="FragmentContainerView" data-secondary="navigation host" id="idm46053733934464"/><a data-type="indexterm" data-primary="NavHostFragment" id="idm46053733933168"/>To link the navigation graph we just created to <code>MainActivity</code>, we need to add a navigation host to its layout, and tell it to use <em>nav_graph.xml</em> as its navigation graph. This will let <code>MainActivity</code> display the correct fragment as the user navigates through the app.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0728-02.png" alt="image" width="334" height="314"/>
<h6/>
</div></figure>
<p>We’ll add the navigation host to the layout in the same way that we did in previous chapters: by adding a <code>NavHostFragment</code> to <em>activity_main.xml</em>’s <code>FragmentContainerView</code>. Update <em>activity_main.xml</em> so that it includes the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0728-03.png" alt="image" width="600" height="268"/>
<h6/>
</div></figure>
<p>That’s all the code we need to change for <code>MainActivity</code>’s layout. Next, let’s make <code>TasksFragment</code> navigate to <code>EditTaskFragment</code> when the user clicks an item in its recycler view.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Make TasksFragment navigate to EditTaskFragment"><div class="sect1" id="make_tasksfragment_navigate_to_edittaskf">
<h1>Make TasksFragment navigate to EditTaskFragment</h1>
<p><a data-type="indexterm" data-primary="TasksFragmentDirections class" id="idm46053733920912"/>Each time the user clicks on an item in <code>TasksFragment</code>’s recycler view, we want the app to navigate to <code>EditTaskFragment</code>, passing it the ID of the <code>Task</code> that was clicked.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0729-01.png" alt="image" width="342" height="121"/>
<h6/>
</div></figure>
<p>One way of doing this would be to update the lambda that <code>TasksFragment</code> passes to its <code>TaskItemAdapter</code> so that it includes all the necessary navigation code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0729-02.png" alt="image" width="600" height="325"/>
<h6/>
</div></figure>
<p>As you can see, this uses the <code>TasksFragmentDirections</code> class (generated by the Safe Args plug-in) to pass the item’s task ID to <code>EditTaskFragment</code>, and navigate to that fragment.</p>
<p>This approach, however, means that we’re adding business logic—deciding when <code>TasksFragment</code> should navigate to <code>EditTaskFragment</code>—to the fragment code, instead of adding it to <code>TasksViewModel</code>. As you learned in <a data-type="xref" href="ch13.xhtml#data_bindingcolon_building_smart_layouts">Chapter 13</a>, the view model code should make this kind of decision instead of the fragment.</p>
<p>To address this, we’ll use a similar approach to the one we used for the Guessing Game app in <a data-type="xref" href="ch13.xhtml#data_bindingcolon_building_smart_layouts">Chapter 13</a>. We’ll add a new live data property to <code>TasksViewModel</code>, which will hold the ID for the task the user clicks on. When this property changes value, <code>TasksFragment</code> will respond by navigating to <code>EditTaskFragment</code>, passing it the ID.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0729-03.png" alt="image" width="522" height="331"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a new property to TasksViewModel"><div class="sect1" id="add_a_new_property_to_tasksviewmodel">
<h1>Add a new property to TasksViewModel</h1>
<p><a data-type="indexterm" data-primary="click response" data-secondary="Tasks app" id="idm46053733903376"/><a data-type="indexterm" data-primary="live data" data-secondary="recycler view navigation" id="idm46053733901968"/><a data-type="indexterm" data-primary="navigateToTask property, TasksViewModel" id="idm46053733900896"/><a data-type="indexterm" data-primary="onTaskClicked() method, TasksViewModel" id="idm46053733900096"/><a data-type="indexterm" data-primary="onTaskNavigated() method, TasksViewModel" id="idm46053733899296"/><a data-type="indexterm" data-primary="TasksViewModel" data-secondary="passing task ID to EditTaskFragment" id="idm46053733898368"/>We’ll begin by adding a new live data property to <code>TasksViewModel</code> that specifies the task ID that <code>TasksFragment</code> needs to pass to <code>EditTaskFragment</code>. We’ll name this property <code>navigateToTask</code>, and define it using the following code (we’ll add this to <em>TasksViewModel.kt</em> on the next page):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0730-02.png" alt="image" width="600" height="197"/>
<h6/>
</div></figure>
<p>As you can see, the <code>navigateToTask</code> property uses a mutable backing property marked as <code>private</code>, which means that only <code>TasksViewModel</code> can set it. This protects the property from unwanted updates by other classes.</p>
<section data-type="sect2" data-pdf-bookmark="Add methods to update the new property"><div class="sect2" id="add_methods_to_update_the_new_property">
<h2>Add methods to update the new property</h2>
<p>Each time the user clicks on a task in the recycler view, we want <code>TasksFragment</code> to navigate to <code>EditTaskFragment</code>, and pass it the task’s ID.</p>
<p>To enable this, we’ll add two methods to the <code>TasksViewModel</code>—<code>onTaskClicked()</code> and <code>onTaskNavigated()</code>—which will be used to set the value of <code>navigateToTask</code>’s backing property. <code>onTaskClicked()</code> will set the property to the task’s ID, and <code>onTaskNavigated()</code> will set it to <code>null</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0730-03.png" alt="image" width="256" height="279"/>
<h6/>
</div></figure>
<p>Here’s the code for the two methods:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0730-04.png" alt="image" width="580" height="202"/>
<h6/>
</div></figure>
<p>Those are all the changes we need to make to <code>TasksViewModel</code>. We’ll show you the full code on the next page.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for TasksViewModel.kt"><div class="sect1" id="the_full_code_for_tasksviewmodeldotkt">
<h1>The full code for TasksViewModel.kt</h1>
<p>Here’s the updated <code>TasksViewModel</code> code; make sure that the code in <em>TasksViewModel.kt</em> includes all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0731-02.png" alt="image" width="600" height="649"/>
<h6/>
</div></figure>
<p>Now that we’ve updated <code>TasksViewModel</code>, let’s see what changes we need to make to the <code>TasksFragment</code> code.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Make TasksFragment navigate to EditTaskFragment"><div class="sect1" id="make_tasksfragment_navigate_to_e-id00277">
<h1>Make TasksFragment navigate to EditTaskFragment</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="TasksFragment code to navigate to" id="idm46053733870528"/><a data-type="indexterm" data-primary="navigateToTask property, TasksViewModel" id="idm46053733869072"/><a data-type="indexterm" data-primary="onTaskClicked() method, TasksViewModel" id="idm46053733868272"/><a data-type="indexterm" data-primary="TasksFragment" data-secondary="EditTaskFragment navigation" id="idm46053733867472"/>We need to update the code for <code>TasksFragment</code> so that when the user clicks on a task, it navigates to <code>EditTaskFragment</code>, passing it the task’s ID.</p>
<p>To do this, we’ll call <code>TasksViewModel</code>’s <code>onTaskClicked()</code> method when the user clicks on a task, and navigate to <code>EditTaskFragment</code> when its <code>navigateToTask</code> property gets updated to a new task ID.</p>
<section data-type="sect2" data-pdf-bookmark="Call onTaskClicked() when the user clicks a task"><div class="sect2" id="call_ontaskclickedleft_parenthesisright">
<h2>Call onTaskClicked() when the user clicks a task</h2>
<p>To call the <code>onTaskClicked()</code> method, we’ll pass the lambda below (in bold) to <code>TaskItemAdapter</code>’s constructor:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0732-01.png" alt="image" width="599" height="105"/>
<h6/>
</div></figure>
<p>Each time the user clicks on a task, the lambda will get executed: it will call <code>TasksViewModel</code>’s <code>onTaskClicked()</code> method, setting the <code>navigateToTask</code> property to the task’s ID.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0732-02.png" alt="image" width="395" height="332"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Navigate to EditTaskFragment when navigateToTask gets updated"><div class="sect2" id="navigate_to_edittaskfragment_when_naviga">
<h2>Navigate to EditTaskFragment when navigateToTask gets updated</h2>
<p>To make <code>TasksFragment</code> navigate to <code>EditTaskFragment</code>, we’ll make it observe <code>TaskViewModel</code>’s <code>navigateToTask</code> property. When this property is set to a <code>Long</code> task ID, the fragment will navigate to <code>EditTaskFragment</code>, passing it the ID. We’ll then set the <code>navigateToTask</code> property back to null by calling the view model’s <code>onTaskNavigated()</code> method.</p>
<p>Here’s the code to do this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0732-03.png" alt="image" width="600" height="353"/>
<h6/>
</div></figure>
<p>Let’s update the <code>TasksFragment</code> code.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for TasksFragment.kt"><div class="sect1" id="the_full_code_for_tasksfragmentd-id00278">
<h1>The full code for TasksFragment.kt</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0733-01.png" alt="image" width="304" height="87"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="TasksFragment" data-secondary="code for" id="idm46053733842784"/>Here’s the updated <code>TasksFragment</code> code; make sure that the code in includes all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0733-02.png" alt="image" width="600" height="575"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0734-02.png" alt="image" width="600" height="536"/>
<h6/>
</div></figure>
<p>We’ve now updated the code for <code>TasksViewModel</code> and <code>TasksFragment</code> so that when the user clicks on a task in the recycler view, <code>TasksFragment</code> navigates to <code>EditTaskFragment</code> and passes it the task’s ID.</p>
<p>The next thing we need to do is display the task ID in <code>EditTaskFragment</code>’s layout. Let’s do this now.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Make EditTaskFragment display the task ID"><div class="sect1" id="make_edittaskfragment_display_the_task_i">
<h1>Make EditTaskFragment display the task ID</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="displaying task ID" id="idm46053733831360"/>We’re going to make <code>EditTaskFragment</code> display the task ID by updating the fragment’s layout and Kotlin code. We’ll add a text view to the layout, and then use Kotlin code to retrieve the task’s ID and add it to the text view.</p>
<p>We’ll begin by adding the text view to the fragment’s layout; update <em>fragment_edit_task.xml</em> so that it matches the code shown here:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0735-01.png" alt="image" width="600" height="345"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We also need to update EditTaskFragment.kt"><div class="sect2" id="we_also_need_to_update_edittaskfragmentd">
<h2>We also need to update EditTaskFragment.kt</h2>
<p>Now that we’ve added a text view to <code>EditTaskFragment</code>’s layout, we need to set its text to the task ID. To do this, we’ll add the following code to the fragment’s <code>onCreateView()</code> method:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0735-02.png" alt="image" width="600" height="98"/>
<h6/>
</div></figure>
<p>As you can see, this uses the <code>EditTaskFragmentArgs</code> class (generated by the Safe Args plug-in) to get the value of the <code>taskId</code> argument that’s been passed to <code>EditTaskFragment</code>. It then uses this to set the text view’s text.</p>
<p>Let see what the full code for <code>EditTaskFragment</code> looks like.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0735-03.png" alt="image" width="444" height="183"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for EditTaskFragment.kt"><div class="sect1" id="the_full_code_for_edittaskfragmentdotkt">
<h1>The full code for EditTaskFragment.kt</h1>
<p>Here’s the full code for <code>EditTaskFragment</code>; replace the code in <em>EditTaskFragment.kt</em> so that it matches the code shown here:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0736-02.png" alt="image" width="600" height="384"/>
<h6/>
</div></figure>
<p>Let’s go through what happens when the code runs.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00279">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: In the <code>EditTaskFragment</code> code, I see that you’re using the <code>findViewById()</code> method to get a reference to the layout’s text view. Why aren’t you using view binding or data binding?</strong></p>
<p><strong>A:</strong> We’re using <code>findViewById()</code> here because it’s the quickest way of testing whether the task ID has been successfully passed to <code>EditTaskFragment</code>.</p>
<p>We’ll update the code to use data binding once we’re sure this version of the code works.</p>
<p><strong>Q: When I tried to update my Kotlin code, Android Studio told me that it couldn’t find the <code>TasksFragmentDirections</code> or <code>EditTaskFragmentArgs</code> classes. Any idea why that might be?</strong></p>
<p><strong>A:</strong> These classes are generated by the Safe Args plug-in, so make sure you’ve updated your <em>build.gradle</em> files to include it. Then double-check your navigation graph to make sure <code>EditTaskFragment</code> accepts an argument.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the code runs"><div class="sect1" id="what_happens_when_the_code_runs-id00280">
<h1>What happens when the code runs</h1>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>TasksFragment creates a TaskItemAdapter object, and assigns it to the recycler view as its adapter.</strong></p>
<p>The fragment passes a <code>clickListener</code> lambda to the adapter, telling it to call <code>TasksViewModel</code>’s <code>onTaskClicked()</code> method when it’s executed.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0737-02.png" alt="image" width="600" height="100"/>
<h6/>
</div></figure></li>
<li><p><strong>TasksFragment submits a List&lt;Task&gt; to the TaskItemAdapter.</strong></p>
<p>The <code>List&lt;Task&gt;</code> contains an up-to-date list of records from the database.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0737-03.png" alt="image" width="427" height="303"/>
<h6/>
</div></figure></li>
<li><p><strong>TaskItemAdapter creates a set of TaskItemViewHolders, and an OnClickListener is set to each view holder’s root view.</strong></p>
<p>In this example, the root view is a <code>CardView</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0737-04.png" alt="image" width="600" height="183"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user clicks on a task in the recycler view, the OnClickListener registers the click, and executes the lambda.</strong></p>
<p>It calls <code>TasksViewModel</code>’s <code>onTaskClicked()</code> method, which sets its <code>_navigateToTask</code> property to the ID of the task that was clicked.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0738-02.png" alt="image" width="600" height="104"/>
<h6/>
</div></figure></li>
<li><p><strong>TasksFragment is notified that TasksViewModel’s navigateToTask property—which uses _navigateToTask as its backing property—has been updated.</strong></p>
<p>It navigates to <code>EditTaskFragment</code>, passing it the value of the <code>navigateToTask</code> property.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0738-03.png" alt="image" width="420" height="120"/>
<h6/>
</div></figure></li>
<li><p><strong>EditTaskFragment gets the value of the taskId that’s been passed to it, and displays it in its layout.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0738-04.png" alt="image" width="511" height="180"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00281">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>TasksFragment</code> displays a grid of cards in the recycler view as before.</p>
<p>When we click on one of the tasks, the app navigates to <code>EditTaskFragment</code>, which displays the task’s ID.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0739-02.png" alt="image" width="600" height="536"/>
<h6/>
</div></figure>
<p>You’ve now learned how to use a recycler view to navigate to a new fragment, and tell it which item was clicked.</p>
<p>Next, we’ll update the Tasks app so that when the user clicks on an item, <code>EditTaskFragment</code> displays the task’s complete details, and lets her update or delete the record in the database.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We want to use EditTaskFragment to update task records"><div class="sect1" id="we_want_to_use_edittaskfragment_to_updat">
<h1>We want to use EditTaskFragment to update task records</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0740-01.png" alt="image" width="305" height="87"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="updating task records with" id="idm46053733765312"/><a data-type="indexterm" data-primary="recycler view navigation" data-secondary="updating Task records with EditTaskFragment" id="idm46053733763952"/><a data-type="indexterm" data-primary="Task records" data-secondary="updating with EditTaskFragment" id="idm46053733762912"/>We’ve now updated the Tasks app so that when the user clicks on a task in the recycler view, it navigates to <code>EditTaskFragment</code>, which displays the task’s ID.</p>
<p>What we <em>really</em> want, however, is for <code>EditTaskFragment</code> to display the complete task record, and let the user update or delete it in the database.</p>
<p>To do this, we’re going to update <code>EditTaskFragment</code> so that it looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0740-02.png" alt="image" width="600" height="198"/>
<h6/>
</div></figure>
<p>The new version of the fragment will work as follows:</p>
<ol>
<li><p><strong>When the user clicks on a task in the recycler view, EditTaskFragment displays its details.</strong></p>
<p>It gets the task record from the database, and displays the task name and whether it has been completed.</p></li>
<li><p><strong>When the user updates the task’s details and clicks on the Update Task button, the changes are saved.</strong></p>
<p>It updates the record in the database, and navigates back to <code>TasksFragment</code>.</p></li>
<li><p><strong>When the user clicks on the Delete Task button, the task is deleted.</strong></p>
<p>It deletes the task record from the database, and navigates to <code>TasksFragment</code>.</p></li>
</ol>
<p>For each of these actions, the fragment needs to interact with the app’s Room database, which means that it needs to use the <code>TaskDao</code> interface we defined in <a data-type="xref" href="ch14.xhtml#room_databasescolon_room_with_a_view">Chapter 14</a>. Before we update the app, let’s have a quick reminder of what <code>TaskDao</code> does.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use TaskDao to interact with database records"><div class="sect1" id="use_taskdao_to_interact_with_database_re">
<h1>Use TaskDao to interact with database records</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="EditTaskViewModel" id="idm46053733746624"/><a data-type="indexterm" data-primary="Room persistence library" data-secondary="accessing Task records" id="idm46053733745360"/><a data-type="indexterm" data-primary="TaskDao interface" data-secondary="accessing methods for Task record editing" id="idm46053733744288"/><a data-type="indexterm" data-primary="Task records" id="idm46053733743216"/><a data-type="indexterm" data-primary="Task records" data-secondary="in database" id="idm46053733742384"/><a data-type="indexterm" data-primary="view models" data-secondary="EditTaskViewModel" id="idm46053733741280"/>As you learned in <a data-type="xref" href="ch14.xhtml#room_databasescolon_room_with_a_view">Chapter 14</a>, you interact with records held in a Room database using a DAO interface. The Tasks app, for example, includes a DAO named <code>TaskDao</code> that lets us interact with task records.</p>
<p>Here’s a reminder of what the <code>TaskDao</code> code looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0741-01.png" alt="image" width="600" height="315"/>
<h6/>
</div></figure>
<p>As you can see, the interface includes methods to get one or more records from the database, and suspendable coroutines to insert, update, and delete records in a background thread.</p>
<section data-type="sect2" data-pdf-bookmark="We’ll create a view model to access TaskDao’s methods"><div class="sect2" id="weapostrophell_create_a_view_model_to_ac">
<h2>We’ll create a view model to access TaskDao’s methods</h2>
<p>We need to use <code>TaskDao</code>’s methods to let <code>EditTaskFragment</code> get a task record from the database, update its details, or delete it. Instead of adding the code for this to <code>EditTaskFragment</code>, we’ll create a new view model (named <code>EditTaskViewModel</code>), which will take care of the fragment’s business logic and data.<code>EditTaskViewModel</code> will access <code>TaskDao</code>’s methods, and pass the results to <code>EditTaskFragment</code>.</p>
<p>Let’s go and create <code>EditTaskViewModel</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0741-02.png" alt="image" width="429" height="161"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create EditTaskViewModel"><div class="sect1" id="create_edittaskviewmodel">
<h1>Create EditTaskViewModel</h1>
<p><a data-type="indexterm" data-primary="coroutines, for data access in background" id="idm46053733726208"/><a data-type="indexterm" data-primary="delete() coroutine, TaskDao" id="idm46053733725104"/><a data-type="indexterm" data-primary="deleteTask() method, EditTaskViewModel" id="idm46053733724304"/><a data-type="indexterm" data-primary="get() method, TaskDao" id="idm46053733723504"/><a data-type="indexterm" data-primary="LiveData&lt;Task&gt; property, EditTaskViewModel" id="idm46053733722672"/><a data-type="indexterm" data-primary="TaskDao interface" data-secondary="coroutines" id="idm46053733721808"/><a data-type="indexterm" data-primary="TaskDao interface" data-secondary="get() method" id="idm46053733720704"/><a data-type="indexterm" data-primary="update() coroutine, TaskDao" id="idm46053733719600"/><a data-type="indexterm" data-primary="updateTask() method, EditTaskViewModel" id="idm46053733718800"/>To create <code>EditTaskViewModel</code>, highlight the <em>com.hfad.tasks</em> package in the <em>app/src/main/java</em> folder, then go to File→New→Kotlin Class/File. Name the file “EditTaskViewModel” and choose the Class option.</p>
<section data-type="sect2" data-pdf-bookmark="The view model needs to get a task record…"><div class="sect2" id="the_view_model_needs_to_get_a_task_recor">
<h2>The view model needs to get a task record…</h2>
<p>The first thing that <code>EditTaskViewModel</code> needs to do is get a task record from the app’s database so that it can be displayed in <code>EditTaskFragment</code>’s layout. To enable this, we’ll pass the view model two things in its constructor: a task ID to tell it which task to get, and a <code>TaskDao</code> object that it will use to interact with the database.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0742-02.png" alt="image" width="332" height="235"/>
<h6/>
</div></figure>
<p>We’ll also add a <code>LiveData&lt;Task&gt;</code> property to the view model (named <code>task)</code>, which we’ll set using <code>TaskDao</code>’s <code>get()</code> method. This will set the property to the task record the user wants to see.</p>
<p>Here’s the code to do this; we’ll show you the full <code>EditTaskViewModel</code> code a couple pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0742-03.png" alt="image" width="600" height="113"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="…and include methods to update and delete the task"><div class="sect2" id="hellipand_include_methods_to_update_and">
<h2>…and include methods to update and delete the task</h2>
<p>We’ll also add <code>updateTask()</code> and <code>deleteTask()</code> methods to <code>EditTaskViewModel</code>, which <code>EditTaskFragment</code> will use to update or delete task records. These methods will call <code>TaskDao</code>’s <code>update()</code> and <code>delete()</code> coroutines like so:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0742-04.png" alt="image" width="600" height="241"/>
<h6/>
</div></figure>
<p>Before we add this code to <code>EditTaskViewModel</code>, let’s see what else the view model code needs to do.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="EditTaskViewModel will tell EditTaskFragment when to navigate"><div class="sect1" id="edittaskviewmodel_will_tell_edittaskfrag">
<h1>EditTaskViewModel will tell EditTaskFragment when to navigate</h1>
<p><a data-type="indexterm" data-primary="LiveData&lt;Boolean&gt; property, EditTaskViewModel" id="idm46053733694384"/><a data-type="indexterm" data-primary="_navigateToList backing property, LiveData" id="idm46053733693264"/><a data-type="indexterm" data-primary="navigateToList property, LiveData" id="idm46053733692400"/><a data-type="indexterm" data-primary="TasksFragment" data-secondary="EditTaskFragment navigation" id="idm46053733691600"/>The final thing <code>EditTaskViewModel</code> needs to do is tell <code>EditTaskFragment</code> when it should navigate back to <code>TasksFragment</code>. To enable this, we’ll add a new <code>LiveData&lt;Boolean&gt;</code> property (named <code>navigateToList</code>) to the view model, along with a backing property named <code>_navigateToList</code>. <code>EditTaskFragment</code> will observe <code>navigateToList</code> so that when it’s value becomes <em>true</em>, it navigates to <code>TasksFragment</code>.</p>
<p>We’ll set <code>_navigateToList</code> to <em>true</em> in the view model’s <code>updateTask()</code> and <code>deleteTask()</code> methods. This means that as soon as a task record has been updated or deleted, the app will navigate to <code>TasksFragment</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0743-02.png" alt="image" width="524" height="303"/>
<h6/>
</div></figure>
<p>Here’s the updated code for these methods:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0743-03.png" alt="image" width="600" height="236"/>
<h6/>
</div></figure>
<p>We’ll also add a new method to <code>EditTaskViewModel</code> named <code>onNavigatedToList()</code>, which sets <code>_navigateToList</code> back to <em>false</em>.</p>
<p>Here’s the code for this method:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0743-04.png" alt="image" width="600" height="63"/>
<h6/>
</div></figure>
<p>We’ll show you the entire code for <code>EditTaskViewModel</code> on the next page.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for EditTaskViewModel.kt"><div class="sect1" id="the_full_code_for_edittaskviewmodeldotkt">
<h1>The full code for EditTaskViewModel.kt</h1>
<p><a data-type="indexterm" data-primary="EditTaskViewModel" id="idm46053733673536"/>Here’s the full <code>EditTaskViewModel</code> code; make sure that the code in <em>EditTaskViewModel.kt</em> includes all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0744-02.png" alt="image" width="600" height="617"/>
<h6/>
</div></figure>
<p>That’s all the code we need for <code>EditTaskViewModel</code>. So what’s next?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="EditTaskViewModel needs a view model factory"><div class="sect1" id="edittaskviewmodel_needs_a_view_model_fac">
<h1>EditTaskViewModel needs a view model factory</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0745-01.png" alt="image" width="305" height="90"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="updating layout" id="idm46053733663584"/><a data-type="indexterm" data-primary="EditTaskViewModelFactory" id="idm46053733662384"/><a data-type="indexterm" data-primary="view model factory" id="idm46053733661584"/>The next thing we’ll do is define a view model factory named <code>EditTaskViewModelFactory</code>, which <code>EditTaskFragment</code> will use to create an instance of <code>EditTaskViewModel</code>. As you learned in <a data-type="xref" href="ch11.xhtml#view_modelscolon_model_behavior">Chapter 11</a>, a view model factory is needed for all view models that—like <code>EditTaskViewModel</code>—don’t include a no-argument constructor.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0745-02.png" alt="image" width="386" height="387"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Create EditTaskViewModelFactory"><div class="sect2" id="create_edittaskviewmodelfactory">
<h2>Create EditTaskViewModelFactory</h2>
<p>To create the factory, highlight the <em>com.hfad.tasks</em> package in the <em>app/src/main/java</em> folder, then go to File→New→Kotlin Class/File. Name the file “EditTaskViewModelFactory” and choose the Class option.</p>
<p>Once you’ve created the file, update the code in <em>EditTaskViewModelFactory.kt</em> so that it looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0745-03.png" alt="image" width="600" height="362"/>
<h6/>
</div></figure>
<p>Now that we’ve written the code for <code>EditTaskViewModel</code> and its factory, let’s update the code for <code>EditTaskFragment</code> and its layout. We’ll begin with the layout.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="fragment_edit_task.xml needs to display the task"><div class="sect1" id="fragmentunderscoreeditunderscoretaskdotx">
<h1>fragment_edit_task.xml needs to display the task</h1>
<p>We’re going to update <em>fragment_edit_task.xml</em> so that it includes an edit text and a checkbox, which will be used to display <code>Task</code> data. We’ll use data binding to bind these views to the <code>taskName</code> and <code>taskDone</code> properties in <code>EditTaskViewModel</code>’s <code>task</code>.</p>
<p>We’ll also add two buttons to the layout, which will call <code>EditTaskViewModel</code>’s <code>deleteTask()</code> and <code>updateTask()</code> methods, and let the user update or delete the task record.</p>
<p>Here’s the updated code for the layout; update the code for <em>fragment_edit_task.xml</em> so that it includes these changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0746-01.png" alt="image" width="600" height="489"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0747-02.png" alt="image" width="600" height="387"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We need to update EditTaskFragment.kt too"><div class="sect2" id="we_need_to_update_edittaskfragmentdotkt">
<h2>We need to update EditTaskFragment.kt too</h2>
<p>The final change that we need to make to the Tasks app is to update <code>EditTaskFragment</code>’s Kotlin code. The code needs to do three things:</p>
<ol>
<li><p><strong>Set the layout’s viewModel data binding variable.</strong></p>
<p>We’ll set it to an instance of <code>EditTaskViewModel</code>, which the fragment will create.</p></li>
<li><p><strong>Set the layout’s lifecycle owner.</strong></p>
<p>This is so that the layout can interact with live data properties.</p></li>
<li><p><strong>Observe the view model’s navigateToList property.</strong></p>
<p>When this becomes <em>true</em>, the fragment will navigate to <code>TasksFragment</code>, and call <code>EditTaskViewModel</code>’s <code>onNavigatedToList()</code> method.</p></li>
</ol>
<p>As you’re already familiar with all the code to do this, we’ll show you the updated code for <code>EditTaskFragment</code> on the next page.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for EditTaskFragment.kt"><div class="sect1" id="the_full_code_for_edittaskfragme-id00282">
<h1>The full code for EditTaskFragment.kt</h1>
<p><a data-type="indexterm" data-primary="EditTaskFragment" data-secondary="code for" id="idm46053733626384"/>Here’s the full <code>EditTaskFragment</code> code: make sure that the code in <em>EditTaskFragment.kt</em> includes all the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0748-02.png" alt="image" width="600" height="595"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0749-02.png" alt="image" width="600" height="391"/>
<h6/>
</div></figure>
<p>That’s everything that we need to make <code>EditTaskFragment</code> display a <code>Task</code> in its layout, and let the user update or delete it. Let’s go through what the code does when it runs.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00283">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: You said that the <code>updateTask()</code> and <code>deleteTask()</code> methods in <code>EditTaskViewModel</code> use coroutines to update and delete task records in a background thread. Is this necessary?</strong></p>
<p><strong>A:</strong> Yes. If you try to run potentially time-consuming database code like this in the main thread, you’ll get compiler errors.</p>
<p><strong>Q: Could I add Up button navigation to the app too?</strong></p>
<p><strong>A:</strong> Yes! This is a great idea, as it will give the user a simple way of navigating from <code>EditTaskFragment</code> to <code>TasksFragment</code> without making any record updates.</p>
<p>We’re not including the code to do this here, but by all means have a go at adding it yourself. If you need a reminder of how to implement Up navigation, we suggest referring back to <a data-type="xref" href="ch08.xhtml#navigation_uicolon_going_places">Chapter 8</a>.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the code runs"><div class="sect1" id="what_happens_when_the_code_runs-id00284">
<h1>What happens when the code runs</h1>
<p>The following things happen when the app runs:</p>
<ol style="list-style-type:none;">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="23" height="23"/></span> <strong>When the user clicks on a task, TasksFragment navigates to EditTaskFragment, passing it the task ID.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0750-02.png" alt="image" width="418" height="120"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="23" height="23"/></span> <strong>EditTaskFragment gets a reference to its EditTaskViewModel object.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0750-03.png" alt="image" width="414" height="120"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="23" height="24"/></span> <strong>EditTaskViewModel calls the TaskDao object’s get() method, passing it the task ID.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0750-04.png" alt="image" width="396" height="146"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="23" height="24"/></span> <strong>The TaskDao’s get() method returns a LiveData&lt;Task&gt;, which is assigned to EditTaskViewModel’s task property.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0750-05.png" alt="image" width="439" height="115"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/5a.png" alt="Images" width="23" height="24"/></span> <strong>When the user clicks on the Update Task button, it calls EditTaskViewModel’s updateTask() method.</strong></p>
<p>This method uses <code>TaskDao</code>’s <code>update()</code> method to update the record in the database.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0751-02.png" alt="image" width="600" height="127"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/5b.png" alt="Images" width="23" height="24"/></span> <strong>When the user clicks on the Delete Task button, it calls EditTaskViewModel’s deleteTask() method.</strong></p>
<p>This method uses <code>TaskDao</code>’s <code>delete()</code> method to delete the record.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0751-03.png" alt="image" width="600" height="127"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/6.png" alt="Images" width="23" height="24"/></span> <strong>The app navigates to TasksFragment.</strong></p>
<p>Any changes that have been made to the task record are reflected in the recycler view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0751-04.png" alt="image" width="339" height="120"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00285">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>TasksFragment</code> displays a grid of cards in the recycler view as before.</p>
<p>When we click on one of the tasks, the app navigates to <code>EditTaskFragment</code>, which displays the task’s record.</p>
<p>When we make changes to the task and click on the Update Task button, the changes are saved to the database and displayed in <code>TasksFragment</code>’s recycler view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0752-02.png" alt="image" width="600" height="476"/>
<h6/>
</div></figure>
<p>That’s what happens when we try to update a task. What about when we delete one?</p>
<p>When we click on a task, the app navigates to <code>EditTaskFragment</code> and displays the task record as before.</p>
<p>When we click on the Delete Task button, the record is deleted from the database. When the app navigates to <code>TasksFragment</code>, the record no longer appears in the recycler view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0753-02.png" alt="image" width="600" height="490"/>
<h6/>
</div></figure>
<p>Congratulations! You’ve now learned how to build an app that uses a recycler view to navigate to records, which you can then update or delete. This technique gives you a powerful and flexible way of organizing the data in your app.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00286">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#recycler_view_navigationcolon_pick_a_car">Chapter 17</a> under your belt and now you’ve added recycler view navigation to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0754-01.png" alt="image" width="234" height="210"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00287">
<h5>Bullet Points</h5>
<ul>
<li><p>You can make a recycler view’s items clickable. You can use this feature to make the recycler view navigate to another fragment, which shows details of the clicked item.</p></li>
<li><p>You can make a recycler view respond to clicks by adding an <code>OnClickListener</code> to the root view of the layout it uses for its items.</p></li>
<li><p>You can tell the <code>OnClickListener</code> how to respond to clicks by passing it a lambda. The lambda will get executed when the <code>OnClickListener</code> registers a click.</p></li>
<li><p>The lambda can be defined in fragment code, and passed to the <code>OnClickListener</code> via the adapter’s constructor.</p></li>
</ul>
</div></aside>
</div></section>
</div></section></div></body></html>