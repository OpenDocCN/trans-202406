<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Chart Repositories"><div class="chapter" id="chart_repositories">
<h1><span class="label">Chapter 7. </span>Chart Repositories</h1>


<p class="lead">No package manager is complete without a way to share and distribute the packages themselves. Organizations and vendors must have a way to publish packages for end users to download and consume. Likewise, end users must have a common way to fetch packages from a variety of sources.</p>

<p>Helm enables package distribution though a system called chart repositories. <a data-type="indexterm" data-primary="Helm" data-secondary="chart repositories" id="idm46125985835624"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="about" id="idm46125985834648"/>Chart repositories are simple HTTP(S) web services from which users can discover and download available charts. Conceptually, chart repositories are similar in design to Debian package repositories, Fedora package databases, or the Comprehensive Perl Archive Network (CPAN).</p>

<p>In this chapter, we will first dive deep into the internals of a chart repository. We will discuss the repository index and how to update it with new chart versions. After that, we will show how to set up a chart repository from scratch, how to secure one, and also show a real-world example of how to host a public chart repository using GitHub Pages for open source projects. After this, we will walk through the various <code>helm repo</code> commands and how to use them effectively.</p>

<p>Toward the end of the chapter, we will cover the next generation of chart repositories using Helm’s experimental Open Container Initiative (OCI) support. This bleeding-edge functionality added in Helm 3 allows users to store Helm charts in container registries alongside their container images.</p>

<p>Lastly, we will briefly describe some of the projects in the Helm ecosystem related to chart repositories.</p>






<section data-type="sect1" data-pdf-bookmark="The Repository Index"><div class="sect1" id="idm46125985830584">
<h1>The Repository Index</h1>

<p>All chart repositories contain a special repository index file called <em>index.yaml</em>, which <a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" id="ch07-indx"/><a data-type="indexterm" data-primary="YAML" data-secondary="index.yaml of chart repositories" data-seealso="index.yaml" id="ch07-indx2"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" id="ch07-indx3"/>lists all available charts and their respective download locations.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>See <a data-type="xref" href="app02.xhtml#appendix_b_chart_respoitory_api">Appendix B</a> for more details describing the format of <em>index.yaml</em>.</p>
</div>

<p>Here’s an example of a very basic <em>index.yaml</em> file:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">entries</code><code class="p">:</code>
  <code class="nt">superapp</code><code class="p">:</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v2</code>
    <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">1.16.0</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-04-27T17:46:52.60919-05:00"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for Kubernetes</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">cd1f8d949aeb6a7a3c6720bfe71688d4add794881b78ad9715017581f7867db4</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">superapp</code>
    <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">application</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">superapp-0.1.0.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">0.1.0</code>
<code class="nt">generated</code><code class="p">:</code> <code class="s">"2020-04-27T17:46:52.607943-05:00"</code></pre>

<p>Note the <code>entries</code> section, which lists all charts and chart versions. This <em>index.yaml</em> example lists a just single chart, <em>superapp</em>, with a single version, 0.1.0.</p>








<section data-type="sect2" data-pdf-bookmark="An Example of a Chart Repository Index"><div class="sect2" id="idm46125985775320">
<h2>An Example of a Chart Repository Index</h2>

<p>Usually, chart repositories list many charts and all their available versions. This allows users to download a specific version of the chart they wish to install. The following is a more real-world example of a chart repository index, containing multiple charts and chart versions:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">entries</code><code class="p">:</code>
  <code class="nt">cert-manager</code><code class="p">:</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
    <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v0.14.2</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-04-08T11:38:26.281Z"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for cert-manager</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">160e1bd4906855b91c8ba42afe10af2d0443b184916e4534175890b1a7278f4e</code>
    <code class="nt">home</code><code class="p">:</code> <code class="l-Scalar-Plain">https://github.com/jetstack/cert-manager</code>
    <code class="nt">icon</code><code class="p">:</code> <code class="l-Scalar-Plain">https://raw.githubusercontent.com/jetstack/cert-manager/master/logo/</code>
          <code class="l-Scalar-Plain">logo.png</code>
    <code class="nt">keywords</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">cert-manager</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">kube-lego</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">letsencrypt</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">tls</code>
    <code class="nt">maintainers</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="nt">email</code><code class="p">:</code> <code class="l-Scalar-Plain">dev@jetstack.io</code>
      <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">jetstack-dev</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">cert-manager</code>
    <code class="nt">sources</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">https://github.com/jetstack/cert-manager</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">charts/cert-manager-v0.14.2.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">v0.14.2</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
    <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v0.14.1</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-03-25T18:30:16.354Z"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for cert-manager</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">629150400487df41af6c7acf2a3bfd8e691f657a930bc81e1dcf3b9d23329baf</code>
    <code class="nt">home</code><code class="p">:</code> <code class="l-Scalar-Plain">https://github.com/jetstack/cert-manager</code>
    <code class="nt">icon</code><code class="p">:</code> <code class="l-Scalar-Plain">https://raw.githubusercontent.com/jetstack/cert-manager/master/logo/</code>
          <code class="l-Scalar-Plain">logo.png</code>
    <code class="nt">keywords</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">cert-manager</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">kube-lego</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">letsencrypt</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">tls</code>
    <code class="nt">maintainers</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="nt">email</code><code class="p">:</code> <code class="l-Scalar-Plain">dev@jetstack.io</code>
      <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">jetstack-dev</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">cert-manager</code>
    <code class="nt">sources</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">https://github.com/jetstack/cert-manager</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">charts/cert-manager-v0.14.1.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">v0.14.1</code>
  <code class="nt">tor-proxy</code><code class="p">:</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2018-11-16T09:23:13.538Z"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for Kubernetes</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">1d2fd11e22ba58bf0a263c39777f0f18855368b099aed7b03123ca91e55343e4</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">tor-proxy</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">charts/tor-proxy-0.1.1.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">0.1.1</code>
<code class="nt">generated</code><code class="p">:</code> <code class="s">"2020-04-23T17:43:41Z"</code></pre>

<p>The preceding example shows two available charts: <em>cert-manager</em> and <em>tor-proxy</em>. There are a total of three available chart versions: <em>cert-manager</em> v0.14.1, <em>cert-manager</em> v0.14.2 (latest), and <em>tor-proxy</em> 0.1.1 (latest). The latest versions of each chart in the repo are displayed when running a <code>helm search</code>.</p>

<p>Typically chart archives (<em>.tgz</em> files) themselves are served from the same <a data-type="indexterm" data-primary="archive file from packaging chart" data-secondary="index.yaml for repository" id="idm46125985534168"/><a data-type="indexterm" data-primary="charts" data-secondary="packaging" data-tertiary="index.yaml for repository" id="idm46125985533112"/><a data-type="indexterm" data-primary="packages" data-secondary="packaging a chart" data-tertiary="index.yaml for repository" id="idm46125985531880"/>location as the repository index, but the index may also link to remote locations on entirely different domains. Here is a snippet from an <em>index.yaml</em> referencing chart archives located on a separate domain (note the absolute URL):</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nn">...</code><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">appVersion</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">2.10.1</code><code>
</code><code>    </code><code class="nt">created</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">2019-01-14T23:25:37.125126859Z</code><code>
</code><code>    </code><code class="nt">description</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">A</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">simple,</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">powerful</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">publishing</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">platform</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">that</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">allows</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">you</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">to</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">share</code><code>
</code><code>      </code><code class="l-Scalar-Plain">your</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">stories</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">with</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">the</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">world</code><code>
</code><code>    </code><code class="nt">digest</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">dcadf39f81253a9a016fcab1b74aba1d470e015197152affdaeb1b337221cc5c</code><code>
</code><code>    </code><code class="nt">engine</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">gotpl</code><code>
</code><code>    </code><code class="nt">home</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">http://www.ghost.org/</code><code>
</code><code>    </code><code class="nt">icon</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">https://bitnami.com/assets/stacks/ghost/img/ghost-stack-220x234.png</code><code>
</code><code>    </code><code class="nt">keywords</code><code class="p">:</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">ghost</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">blog</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">http</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">web</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">application</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">nodejs</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">javascript</code><code>
</code><code>    </code><code class="nt">maintainers</code><code class="p">:</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="nt">email</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">containers@bitnami.com</code><code>
</code><code>      </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">Bitnami</code><code>
</code><code>    </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">ghost</code><code>
</code><code>    </code><code class="nt">sources</code><code class="p">:</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">https://github.com/bitnami/bitnami-docker-ghost</code><code>
</code><code>    </code><code class="nt">urls</code><code class="p">:</code><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">https://charts.example.com/ghost-6.2.3.tgz</code><code> </code><a class="co" id="co_chart_repositories_CO1-1" href="#callout_chart_repositories_CO1-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code>    </code><code class="nt">version</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">6.2.3</code><code>
</code><code class="nn">...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_chart_repositories_CO1-1" href="#co_chart_repositories_CO1-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>Absolute chart URL</p></dd>
</dl>

<p>Other fields found in each entry include the metadata for a chart as described in <em>Chart.yaml</em>, such as <code>description</code>, as well as an added digest field containing the Secure Hash Algorithm (SHA-256) checksum of the chart archive. In <a data-type="xref" href="ch04.xhtml#building_a_chart">Chapter 4</a> we covered chart metadata and <em>Chart.yaml</em> in detail.</p>

<p>Additionally, at the top level is a <code>generated</code> field describing when the index was created (in RFC 3339 format), as well as an <code>apiVersion</code> describing the API version of the index. At the time of writing, there is currently only one API version for chart repositories. This field should always be <code>v1</code>.<a data-type="indexterm" data-startref="ch07-indx" id="idm46125985154792"/><a data-type="indexterm" data-startref="ch07-indx2" id="idm46125985154056"/><a data-type="indexterm" data-startref="ch07-indx3" id="idm46125985183848"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Generating an Index"><div class="sect2" id="generating_an_index">
<h2>Generating an Index</h2>

<p>The repository index can be generated by a custom program, or typed out manually. <a data-type="indexterm" data-primary="archive file from packaging chart" data-secondary="index.yaml for repository" data-tertiary="generating" id="idm46125985164712"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="generating" id="idm46125985163432"/><a data-type="indexterm" data-primary="charts" data-secondary="packaging" data-tertiary="index.yaml generated" id="idm46125985170984"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="generating" id="idm46125985169768"/><a data-type="indexterm" data-primary="packages" data-secondary="packaging a chart" data-tertiary="index.yaml generated" id="idm46125985522248"/><a data-type="indexterm" data-primary="YAML" data-secondary="index.yaml of chart repositories" data-tertiary="generating" id="idm46125985521032"/>Helm also provides built-in functionality to generate the repository index for you.</p>

<p>Let’s create an empty directory, <em>charts/</em>, which will serve as the root of our chart repository:</p>
<pre>$ mkdir -p charts/</pre>

<p>To generate a repository index inside the <em>charts/</em> directory, run the following:</p>
<pre>$ helm repo index charts/</pre>

<p>This will create a file at <em>charts/index.yaml</em>. Let’s take a look:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="l-Scalar-Plain">$ cat charts/index.yaml</code>
<code class="l-Scalar-Plain">apiVersion</code><code class="p-Indicator">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">entries</code><code class="p">:</code> <code class="p-Indicator">{}</code>
<code class="nt">generated</code><code class="p">:</code> <code class="s">"2020-04-28T09:55:29.517285-05:00"</code></pre>

<p>You’ll notice that the <code>entries</code> are empty. This is expected because we do not yet have any charts in the <em>charts/</em> directory.</p>

<p>Let’s create a sample chart, and package it into the <em>charts/</em> directory:</p>

<pre data-type="programlisting">$ helm create superapp
Creating superapp
$ helm package superapp/ --destination charts/
Successfully packaged chart and saved it to: charts/superapp-0.1.0.tgz</pre>

<p>Now let’s try generating the index again:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="l-Scalar-Plain">$ helm repo index charts/</code>
<code class="l-Scalar-Plain">$ cat charts/index.yaml</code>
<code class="l-Scalar-Plain">apiVersion</code><code class="p-Indicator">:</code> <code class="l-Scalar-Plain">v1</code>
  <code class="l-Scalar-Plain">entries</code><code class="p-Indicator">:</code>
    <code class="nt">superapp</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v2</code>
      <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">1.16.0</code>
      <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-04-28T10:12:22.507943-05:00"</code>
      <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for Kubernetes</code>
      <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">46f9ddeca12ec0bc257a702dac7d069af018aed2a87314d86b230454ac033672</code>
      <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">superapp</code>
      <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">application</code>
      <code class="nt">urls</code><code class="p">:</code>
      <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">superapp-0.1.0.tgz</code>
      <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">0.1.0</code>
<code class="nt">generated</code><code class="p">:</code> <code class="s">"2020-04-28T10:12:22.507289-05:00"</code></pre>

<p>Now we see our chart listed in the <code>entries</code> section.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Adding to an Existing Index"><div class="sect2" id="idm46125985182456">
<h2>Adding to an Existing Index</h2>

<p>In some scenarios (continuous integration/continuous deployment<a data-type="indexterm" data-primary="archive file from packaging chart" data-secondary="index.yaml for repository" data-tertiary="adding to an existing" id="idm46125985281464"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="adding to an existing" id="idm46125985280184"/><a data-type="indexterm" data-primary="charts" data-secondary="packaging" data-tertiary="index.yaml added to" id="idm46125985295528"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="adding to an existing" id="idm46125985294312"/><a data-type="indexterm" data-primary="packages" data-secondary="packaging a chart" data-tertiary="index.yaml added to" id="idm46125985293352"/><a data-type="indexterm" data-primary="YAML" data-secondary="index.yaml of chart repositories" data-tertiary="adding to existing" id="idm46125985292136"/> [CI/CD], for example), you may only have access to an existing <em>index.yaml</em> file and a newly packaged chart archive. Helm provides a mechanism for building upon the contents of an existing index with the <code>--merge</code> option.</p>

<p>Let’s simulate this scenario. Create a new directory called <em>workspace/</em>, which will represent a new working directory in a CI/CD pipeline:</p>
<pre>$ mkdir -p workspace/</pre>

<p>Copy the existing index file into the <em>workspace/</em> directory with a new name, such as <em>index-old.yaml</em>:</p>
<pre>$ cp charts/index.yaml workspace/index-old.yaml</pre>

<p>In a real-world scenario, you might source the existing index file from some remote location (e.g., Amazon S3).</p>

<p>Next let’s create another Helm chart and package it into the <em>workspace/</em> directory:</p>

<pre data-type="programlisting">$ helm create duperapp
Creating duperapp
$ helm package duperapp/ --destination workspace/
Successfully packaged chart and saved it to: workspace/duperapp-0.1.0.tgz</pre>

<p>Run the following command, which will create a new <em>index.yaml</em> file based on the combination of the existing entries found in <em>index-old.yaml</em>, as well as any <em>.tgz</em> files in the <em>workspace/</em> directory:</p>
<pre>$ helm repo index workspace/ --merge workspace/index-old.yaml</pre>

<p>Finally, move the files from the <em>workspace/</em> directory into the <em>charts/</em> directory, overwriting the old index file with the new one:</p>

<pre data-type="programlisting">$ mv workspace/duperapp-0.1.0.tgz charts/
$ mv workspace/index.yaml charts/</pre>

<p>The new version of the index file should now contain entries for both charts:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="l-Scalar-Plain">$ cat charts/index.yaml</code>
<code class="l-Scalar-Plain">apiVersion</code><code class="p-Indicator">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">entries</code><code class="p">:</code>
  <code class="nt">duperapp</code><code class="p">:</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v2</code>
    <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">1.16.0</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-04-28T11:34:26.780267-05:00"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for Kubernetes</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">30ea14a4ce92e0d1aea7626cb30dfbac68a87dca360d0d76a55460b004d62f52</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">duperapp</code>
    <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">application</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">duperapp-0.1.0.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">0.1.0</code>
  <code class="nt">superapp</code><code class="p">:</code>
  <code class="p-Indicator">-</code> <code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v2</code>
    <code class="nt">appVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">1.16.0</code>
    <code class="nt">created</code><code class="p">:</code> <code class="s">"2020-04-28T10:12:22.507943-05:00"</code>
    <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">A Helm chart for Kubernetes</code>
    <code class="nt">digest</code><code class="p">:</code> <code class="l-Scalar-Plain">46f9ddeca12ec0bc257a702dac7d069af018aed2a87314d86b230454ac033672</code>
    <code class="nt">name</code><code class="p">:</code> <code class="l-Scalar-Plain">superapp</code>
    <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">application</code>
    <code class="nt">urls</code><code class="p">:</code>
    <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">superapp-0.1.0.tgz</code>
    <code class="nt">version</code><code class="p">:</code> <code class="l-Scalar-Plain">0.1.0</code>
<code class="nt">generated</code><code class="p">:</code> <code class="s">"2020-04-28T11:34:26.779758-05:00"</code></pre>

<p>This method is useful in environments where you do not necessarily have access to a directory containing all of the chart archives.</p>

<p>Keep in mind, however, that if this merge occurs on multiple systems at the same time, you may run into a race condition where one or more charts goes missing from the index. This can be mitigated by ensuring that this process is only performed synchronously (e.g., a single CI job responsible for creating <em>index.yaml</em> for the repository). Another way to address this problem is to use a dynamic web server that is responsible for generating the contents of <em>index.yaml</em>. The <em>ChartMuseum</em> project, which is described later in this chapter in <a data-type="xref" href="#related_projects">“Related Projects”</a>, is one such example of a dynamic chart repository server you can use for this purpose.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Setting Up a Chart Repository"><div class="sect1" id="idm46125985346104">
<h1>Setting Up a Chart Repository</h1>

<p>One of the benefits of chart repositories is that they can be entirely <a data-type="indexterm" data-primary="chart repositories" data-secondary="setting up" data-tertiary="about" id="idm46125984966520"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="about" data-tertiary="simplicity of serving" id="idm46125984965272"/>static—meaning you can place the files behind a simple web server such as Apache or Nginx and serve them as is. You can even use object storage providers, such as Amazon S3. No significant computation needs to occur on the server side when a client requests <em>index.yaml</em>, for example. The static web server just opens the file as it exists on the filesystem and sends the raw contents back to the client.</p>








<section data-type="sect2" data-pdf-bookmark="A Simple Chart Repository with Python"><div class="sect2" id="idm46125984963000">
<h2>A Simple Chart Repository with Python</h2>

<p>For the sake of this example, we will use Python’s built-in static web server<a data-type="indexterm" data-primary="chart repositories" data-secondary="setting up" data-tertiary="Python repository" id="idm46125984961256"/><a data-type="indexterm" data-primary="Python chart repository" id="idm46125984960008"/> to start up a local test repository. Note that almost all programming languages have some support in their standard libraries to start a web server and serve static files. Python is chosen simply because it comes preinstalled on most Unix-based systems, and because it provides an easy one-line command to start a static web server.</p>

<p>Follow the instructions in the previous section (<a data-type="xref" href="#generating_an_index">“Generating an Index”</a>) to create the <em>charts/</em> directory, containing the files <em>index.yaml</em>, <em>superapp-0.1.0.tgz</em>, and <em>duperapp-0.1.0.tgz</em>. Run one of the following commands to start a local web server at <em><a href="http://localhost:8080"><em class="hyperlink">http://localhost:8080</em></a></em>.</p>

<p>Using Python 3 (try this first):</p>
<pre>$ ( cd charts/ &amp;&amp; python3 -m http.server --bind 127.0.0.1 8080 )</pre>

<p>Using Python 2:</p>
<pre>$ ( ch charts/ &amp;&amp; python -m SimpleHTTPServer 8080 )</pre>
<div data-type="caution"><h6>Caution</h6>
<p>The Python 2 version of this command listens on all interfaces (<code>0.0.0.0</code>) versus just the loopback interface (<code>127.0.0.1</code>). Depending on your system, this will allow other devices on your network to connect. Be mindful of which files are present in the <em>charts/</em> directory before running this command.</p>
</div>

<p>Now, in another terminal window, try fetching <em>index.yaml</em> using <code>curl</code>:</p>

<pre data-type="programlisting">$ curl -sO http://localhost:8080/index.yaml
$ ls *.yaml
index.yaml</pre>

<p>Now let’s verify that we can fetch chart archives:</p>

<pre data-type="programlisting">$ curl -sO http://localhost:8080/superapp-0.1.0.tgz
$ curl -sO http://localhost:8080/duperapp-0.1.0.tgz
$ ls *.tgz
duperapp-0.1.0.tgz	superapp-0.1.0.tgz</pre>

<p>If the <code>curl</code> commands succeed, your chart repository is ready to be used with Helm.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Securing a Chart Repository"><div class="sect2" id="idm46125984962376">
<h2>Securing a Chart Repository</h2>

<p>In many cases, you may wish to limit access to a chart repository or maintain an audit trail of which users are accessing which resources. Helm has built-in support to allow users to authenticate themselves against chart repositories protected by either basic auth or mTLS.</p>










<section data-type="sect3" data-pdf-bookmark="Basic auth"><div class="sect3" id="idm46125984944424">
<h3>Basic auth</h3>

<p>Chart repositories can be protected by basic access authentication, or <em>basic auth</em>. <a data-type="indexterm" data-primary="chart repositories" data-secondary="setting up" data-tertiary="securing" id="ch07-sec"/><a data-type="indexterm" data-primary="security" data-secondary="chart repository" id="ch07-sec2"/><a data-type="indexterm" data-primary="security" data-secondary="chart repository" data-tertiary="basic auth" id="idm46125985513128"/><a data-type="indexterm" data-primary="basic auth (basic access authentication)" data-secondary="chart repository" id="idm46125985511912"/><a data-type="indexterm" data-primary="security" data-secondary="basic auth" id="idm46125985510936"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="security" id="ch07-sec3"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="security" data-tertiary="basic auth" id="idm46125985508776"/>This requires that users provide a valid username/password combination to access resources on the server.</p>

<p>Basic auth can be implemented by a server by first checking the <code>Authorization</code> header prior to processing a request. An incoming basic auth header resembles the following:</p>

<pre data-type="programlisting">Authorization: Basic bXl1c2VyOm15cGFzcw== <a class="co" id="co_chart_repositories_CO2-1" href="#callout_chart_repositories_CO2-1"><img src="Images/1.png" alt="1"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_chart_repositories_CO2-1" href="#co_chart_repositories_CO2-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>The opaque string here is the Base64 encoding of <em><code>username</code></em> + “:” + <em><code>password</code></em>.</p></dd>
</dl>
<div data-type="caution"><h6>Caution</h6>
<p>The contents of the <code>Authorization</code> header are <em>not</em> encrypted, so you are strongly encouraged to also use HTTPS when supplying basic auth credentials.</p>
</div>

<p>When adding a repository for the first time, you can supply a username and password combination on the command line, which will instruct Helm to use basic auth when making requests against this repository:</p>

<pre data-type="programlisting">$ helm repo add mycharts http://localhost:8080 --username myuser \
    --password mypass
"mycharts" has been added to your repositories</pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Client certificates"><div class="sect3" id="idm46125985495944">
<h3>Client certificates</h3>

<p>Most client-server communication over HTTPS allows the client to verify the <a data-type="indexterm" data-primary="security" data-secondary="chart repository" data-tertiary="client certificates" id="idm46125985494216"/><a data-type="indexterm" data-primary="client certificates for chart repositories" id="idm46125985492968"/><a data-type="indexterm" data-primary="security" data-secondary="client certificates" id="idm46125985492264"/><a data-type="indexterm" data-primary="mutual TLS authentication (mTLS)" id="idm46125985491320"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="security" data-tertiary="client certificates" id="idm46125985490680"/>identity of the server based on the SSL certificate provided by the server. With mutual TLS authentication (mTLS), servers can also verify the identity of the client based on a separate SSL certificate presented by the client during the TLS handshake.</p>

<p>Here is a simple Nginx server configuration enabling mTLS for a chart repository,<a data-type="indexterm" data-primary="Nginx" data-secondary="mTLS for chart repository" id="idm46125985488680"/> assuming static files (i.e., <em>index.yaml</em>, <em>.tgz</em> files) are located in the directory <em>/chartrepo</em> on the server:</p>

<pre data-type="programlisting">events { }
http {
    server {
        root /chartrepo;
        listen 443 ssl;
        server_name charts.example.com;
        ssl_certificate /certs/server.crt; <a class="co" id="co_chart_repositories_CO3-1" href="#callout_chart_repositories_CO3-1"><img src="Images/1.png" alt="1"/></a>
        ssl_certificate_key /certs/server.key; <a class="co" id="co_chart_repositories_CO3-2" href="#callout_chart_repositories_CO3-2"><img src="Images/2.png" alt="2"/></a>
        ssl_client_certificate /certs/client-ca.pem; <a class="co" id="co_chart_repositories_CO3-3" href="#callout_chart_repositories_CO3-3"><img src="Images/3.png" alt="3"/></a>
        ssl_verify_client on;
        proxy_set_header SSL_CLIENT_CERT $ssl_client_cert;
    }
}</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_chart_repositories_CO3-1" href="#co_chart_repositories_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Server’s SSL certificate</p></dd>
<dt><a class="co" id="callout_chart_repositories_CO3-2" href="#co_chart_repositories_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Server’s private key</p></dd>
<dt><a class="co" id="callout_chart_repositories_CO3-3" href="#co_chart_repositories_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Certificate authority (CA) for client authentication—only requests from clients with a certificate signed by this CA will be accepted</p></dd>
</dl>

<p>The first step in obtaining a client certificate is to generate a new private key and certificate signing request (CSR):<a data-type="indexterm" data-primary="certificate signing request (CSR)" id="idm46125985470760"/></p>

<pre data-type="programlisting">$ mkdir -p ~/client-certs/
$ cd ~/client-certs/
$ openssl genrsa -out francis.key 4096
$ openssl req -new -key francis.key -out francis.csr</pre>

<p>When prompted for a “Common Name” when generating the CSR, you must enter a value. Use something that identifies the client (e.g., “francis”). Other fields can technically be left blank, although you are encouraged to fill them out.</p>

<p>Next, using the certificate authority configured on the server (<code>client-ca.pem</code>) and the associated private key (<code>client-ca.key</code>), generate a new client certificate from the CSR:</p>

<pre data-type="programlisting">$ openssl x509 -req -in francis.csr \
    -CA /certs/client-ca.pem -CAkey /certs/client-ca.key \
    -out francis.crt -sha256</pre>

<p>Now you can use this certificate to authenticate by specifying the <code>--cert-file</code> and 
<span class="keep-together"><code>--key-file</code></span> options upon adding a new chart repository:</p>

<pre data-type="programlisting">$ helm repo add client-cert-repo https://charts.example.com \
    --cert-file ~/client-certs/francis.crt --key-file ~/client-certs/francis.key
"client-cert-repo" has been added to your repositories</pre>

<p>In the case that your server is using a self-signed certificate, you can also specify the <code>--ca-file</code> option pointing to a trusted certificate or certificate bundle:</p>

<pre data-type="programlisting">$ helm repo add client-cert-repo-selfsigned https://charts.example.com \
    --cert-file ~/client-certs/francis.crt --key-file ~/client-certs/francis.key
    --ca-file /certs/server.crt
"client-cert-repo-selfsigned" has been added to your repositories</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The paths used for <code>--cert-file</code>, <code>--key-file</code>, and <code>--ca-file</code> are all stored in the Helm cache tied to the repository. It is important not to move these files; otherwise, future requests to the repository will fail due to missing files needed for the client to authenticate.</p>
</div>

<p>For more information on mTLS, please see Internet Engineering Task Force (IETF) RFC 8446, “The Transport Layer Security (TLS) Protocol Version 1.3.”<a data-type="indexterm" data-startref="ch07-sec" id="idm46125984932632"/><a data-type="indexterm" data-startref="ch07-sec2" id="idm46125984932024"/><a data-type="indexterm" data-startref="ch07-sec3" id="idm46125984931416"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Real-World Example: Using GitHub Pages"><div class="sect2" id="idm46125984930680">
<h2>Real-World Example: Using GitHub Pages</h2>

<p>GitHub has a free, static hosting solution called GitHub Pages. If you don’t <a data-type="indexterm" data-primary="security" data-secondary="chart repository" data-tertiary="real-world example" id="idm46125984929304"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="security" data-tertiary="real-world example" id="idm46125984928216"/><a data-type="indexterm" data-primary="GitHub Pages for chart repository" id="ch07-git"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" id="ch07-git2"/>mind making your charts public to the world, GitHub Pages is a great option for hosting a chart repository as you incur zero cost.</p>

<p>What’s even better is that GitHub Pages allows you to use a custom domain name that points to your GitHub Pages site. In this section we will show how to easily set up a public Helm chart repository using GitHub Pages.</p>

<p>There are some limitations on GitHub Pages (such as bandwidth), so before using this method, enumerate the performance requirements for your chart repository compared to GitHub’s documentation of GitHub Pages’ features.</p>










<section data-type="sect3" data-pdf-bookmark="Create a new Git repo"><div class="sect3" id="idm46125984923544">
<h3>Create a new Git repo</h3>

<p>The first step is to create a brand-new Git repo on GitHub dedicated <a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="creating new repository" id="idm46125984922168"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="creating new repository" id="idm46125984921192"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="setting up" data-tertiary="creating new GitHub repository" id="idm46125984919976"/>to your chart repository. You could technically host the chart repo alongside other content, but for the sake of simplicity, we will use a dedicated Git repo. <a data-type="xref" href="#chapter_7_githubpages1">Figure 7-1</a> shows how to set up a new repository.</p>

<figure><div id="chapter_7_githubpages1" class="figure">
<img src="Images/lehe_0701.png" alt="GitHub Pages" width="500"/>
<h6><span class="label">Figure 7-1. </span>Creating a new public repository in GitHub</h6>
</div></figure>

<p>Once you’re logged in to GitHub, click the top right of the screen and select “New repository.” Name the Git repo whatever you want. We will use the name <em>mycharts</em> for this example. Make sure to select the option for marking the repository as “Public,” which is a prerequisite for using GitHub Pages. Select the box for “Initialize this repository with a README,” which will allow us to clone the repo immediately. Feel free to select a license such as “MIT License” to indicate that the source code in this repo is free to use and repurpose. Finally, click “Create repository.”</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>It’s important to note in this context the difference between a Helm repo (or chart repository) and a Git repo hosted on GitHub, which is used for version control.</p>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Enable GitHub Pages"><div class="sect3" id="idm46125984912472">
<h3>Enable GitHub Pages</h3>

<p>Navigate to the Settings panel on the repository. In the main settings, scroll <a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="enabling GitHub Pages" id="idm46125984911144"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="enabling GitHub Pages" id="idm46125984910152"/>down to the section titled GitHub Pages (see <a data-type="xref" href="#chapter_7_githubpages2">Figure 7-2</a>). For the Source option, select “main branch.” This will cause GitHub to redeploy your GitHub Pages site every time you make a new commit to the main branch. Click Save.</p>

<figure><div id="chapter_7_githubpages2" class="figure">
<img src="Images/lehe_0702.png" alt="GitHub Pages" width="500"/>
<h6><span class="label">Figure 7-2. </span>Enabling GitHub Pages on your repository</h6>
</div></figure>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Optional: Use a custom domain"><div class="sect3" id="idm46125984905224">
<h3>Optional: Use a custom domain</h3>

<p>Sites on GitHub Pages, by default, are hosted as a subdomain on the <code>github.io</code> domain.<a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="custom domain option" id="idm46125984903256"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="custom domain option" id="idm46125984902184"/><a data-type="indexterm" data-primary="custom domain for GitHub Pages" id="idm46125984900968"/><a data-type="indexterm" data-primary="domain for GitHub Pages" id="idm46125984900280"/> For example, the URL to your site would resemble something like <em>https://<code>yourusername</code>.github.io/mycharts/</em>.</p>

<p>If you have a custom domain name to use, in your registrar’s web console (or alternatively, in the console for the service you have set up to use for your authoritative nameservers), create a new DNS record pointing to <em><code>yourusername</code>.github.io</em>. If using the root domain, use an <code>ALIAS</code> record type; otherwise, for subdomains, use a <code>CNAME</code> record type.</p>

<p>Go back to your repository settings in GitHub. As in <a data-type="xref" href="#chapter_7_githubpages3">Figure 7-3</a>, in the “Custom domain” input, enter your domain that you set up a DNS record for.</p>

<figure><div id="chapter_7_githubpages3" class="figure">
<img src="Images/lehe_0703.png" alt="GitHub Pages, 500" width="1526" height="1410"/>
<h6><span class="label">Figure 7-3. </span>Using a custom domain for GitHub Pages</h6>
</div></figure>

<p>It may take up to an hour for GitHub to generate a TLS certificate for your domain. <a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="HTTPS option enabled" id="idm46125984892536"/><a data-type="indexterm" data-primary="security" data-secondary="GitHub Pages HTTPS option enabled" id="idm46125984891496"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="HTTPS option enabled" id="idm46125984890536"/>Once it is ready, you should see some text displayed in the settings such as “Your site is published at https://example.com.” Once you see this, make sure to enable the Enforce HTTPS option so that your site is only ever accessed over HTTPS versus just plain HTTP.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Adding chart repository files"><div class="sect3" id="idm46125984888776">
<h3>Adding chart repository files</h3>

<p>Locate the clone URL for your repo in the GitHub UI (typically on the right side of the screen).<a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="adding chart repository files" id="idm46125984887064"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="adding chart repository files" id="idm46125984886056"/> Clone your new GitHub repository to your local system so that we can add some files to turn it into a real chart repository:</p>

<pre data-type="programlisting">$ git clone git@github.com:youruser/mycharts.git
Cloning into 'mycharts'...
remote: Enumerating objects: 7, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 7 (delta 0), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (7/7), done.</pre>

<p>Enter the directory of your Git repository:</p>
<pre>$ cd mycharts/</pre>

<p>Next, let’s create a chart called <em>pineapple</em> in a new <em>src/</em> directory, package it into an archive in the root of the repo, and create an <em>index.yaml</em> file:</p>

<pre data-type="programlisting">$ mkdir -p src/
$ helm create src/pineapple
Creating src/pineapple
$ helm package src/pineapple/
Successfully packaged chart and saved it to: /home/user/mycharts/
  pineapple-0.1.0.tgz
$ helm repo index .</pre>

<p>Once that’s done, let’s commit and push all these new files back to GitHub:</p>

<pre data-type="programlisting">$ git add .</pre>

<pre data-type="programlisting">$ git commit -m "Add pineapple chart v0.1.0"
[main 9bba19d] Add pineapple chart v0.1.0
 13 files changed, 395 insertions(+)
 create mode 100644 index.yaml
 create mode 100644 pineapple-0.1.0.tgz
 create mode 100644 src/pineapple/.helmignore
 create mode 100644 src/pineapple/Chart.yaml
 create mode 100644 src/pineapple/templates/NOTES.txt
 create mode 100644 src/pineapple/templates/_helpers.tpl
 create mode 100644 src/pineapple/templates/deployment.yaml
 create mode 100644 src/pineapple/templates/hpa.yaml
 create mode 100644 src/pineapple/templates/ingress.yaml
 create mode 100644 src/pineapple/templates/service.yaml
 create mode 100644 src/pineapple/templates/serviceaccount.yaml
 create mode 100644 src/pineapple/templates/tests/test-connection.yaml
 create mode 100644 src/pineapple/values.yaml</pre>

<pre data-type="programlisting">$ git push origin main
Enumerating objects: 20, done.
Counting objects: 100% (20/20), done.
Delta compression using up to 12 threads
Compressing objects: 100% (17/17), done.
Writing objects: 100% (19/19), 9.29 KiB | 4.64 MiB/s, done.
Total 19 (delta 0), reused 0 (delta 0)
To github.com:youruser/mycharts.git
   4964b76..9bba19d  main -&gt; main</pre>

<p>Go back to GitHub in the browser. There is a small delay between the time you push a change and those changes becoming avaiable on your GitHub Pages site. Click the Environments item in the right sidebar. This will tell you the last time your site was deployed. If you see a reference to the commit you just pushed (<code>9bba19d</code> in the preceding example), your GitHub Pages site is ready to use.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Using your GitHub Pages site as a chart repository"><div class="sect3" id="idm46125984888184">
<h3>Using your GitHub Pages site as a chart repository</h3>

<p>Once you have pushed an <em>index.yaml</em> file up to your Git repo, and the <a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="GitHub Pages repository" id="idm46125984873096"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="GitHub Pages repository" id="idm46125984871848"/><a data-type="indexterm" data-primary="GitHub Pages for chart repository" data-secondary="using the GitHub Pages site" id="idm46125984870840"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="GitHub Pages for" data-tertiary="using the GitHub Pages site" id="idm46125984869864"/>site is live with the latest commit, you can use it exactly as you would any other chart repository.</p>

<p>Add your GitHub Pages chart repository to your local repositories:<a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" data-tertiary="GitHub Pages repository" id="idm46125984868008"/></p>

<pre data-type="programlisting">$ helm repo add gh-pages https://yourusername.github.io/mycharts/</pre>

<p>Or, if you’re using a custom domain:<a data-type="indexterm" data-startref="ch07-git" id="idm46125984865512"/><a data-type="indexterm" data-startref="ch07-git2" id="idm46125984864808"/></p>

<pre data-type="programlisting">$ helm repo add gh-pages https://example.com</pre>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Using Chart Repositories"><div class="sect1" id="idm46125984863288">
<h1>Using Chart Repositories</h1>

<p>Once you have a working chart repository (see previous section), you can then leverage it using the Helm CLI.</p>

<p>Several commands are available under the top-level <code>helm repo</code> subcommand for working with chart repositories. This section will focus on how to use each of these commands effectively.</p>








<section data-type="sect2" data-pdf-bookmark="Adding a Repository"><div class="sect2" id="idm46125984860552">
<h2>Adding a Repository</h2>

<p>The very first step in using a chart repository is to assign a unique <a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" id="idm46125984859048"/>name to it (such as <code>mycharts</code>) and add it to a list of repositories known by Helm. When you first add a repository, Helm fetches <em>index.yaml</em> from the URL provided and stores it locally.</p>

<p>Use the <code>helm repo add</code> command to add your repository:</p>

<pre data-type="programlisting">$ helm repo add mycharts http://localhost:8080
"mycharts" has been added to your repositories</pre>

<p>If you are running the Python example, check out the logs for your chart repository and you should see the incoming request for <code>GET /index.yaml</code>:</p>

<pre data-type="programlisting">127.0.0.1 - - [06/May/2020 15:31:07] "GET /index.yaml HTTP/1.1" 200 -</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Downloading Charts"><div class="sect2" id="idm46125984853352">
<h2>Downloading Charts</h2>

<p>To download a chart directly from a repository, use the <code>helm pull</code> command:<a data-type="indexterm" data-primary="chart repositories" data-secondary="downloading charts" id="idm46125984851112"/><a data-type="indexterm" data-primary="pull command" id="idm46125984850104"/></p>

<pre data-type="programlisting">$ helm pull mycharts/superapp</pre>

<p>Helm will automatically find the latest version based on Semantic Versioning. You can also specify a version:</p>

<pre data-type="programlisting">$ helm pull mycharts/superapp --version 0.1.0</pre>

<p>This will result in a new chart archive (<em>.tgz</em> file) in your workspace:</p>

<pre data-type="programlisting">$ ls *.tgz
superapp-0.1.0.tgz</pre>

<p>This archive can be then be installed directly:<a data-type="indexterm" data-primary="install command" data-secondary="chart repository files" id="idm46125984845320"/></p>

<pre data-type="programlisting">$ helm install superapp-dev superapp-0.1.0.tgz</pre>

<p>You can also install charts directly from added repositories:</p>

<pre data-type="programlisting">$ helm install superapp-dev mycharts/superapp</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Listing Repositories"><div class="sect2" id="idm46125984852680">
<h2>Listing Repositories</h2>

<p>It’s oftentimes helpful to know which chart repositories have already been added on your system.<a data-type="indexterm" data-primary="chart repositories" data-secondary="listing" id="idm46125984840824"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" data-tertiary="listing added repositories" id="idm46125984839848"/> Knowing this may help you decide whether you want to use one of them to download charts or to remove one of them from the system completely.</p>

<p>Use the <code>helm repo list</code> command to list all chart repositories added to your system:</p>

<pre data-type="programlisting">$ helm repo list
NAME    	URL
mycharts	http://localhost:8080</pre>

<p>You can also leverage the <code>--output</code> / <code>-o</code> option to get this in machine-readable format, if needed.</p>

<p>Get the list as YAML by adding <code>-o yaml</code>:<a data-type="indexterm" data-primary="YAML" data-secondary="chart repositories listed as" id="idm46125984834344"/></p>

<pre data-type="programlisting" data-code-language="yaml"><code class="l-Scalar-Plain">$ helm repo list -o yaml</code>
<code class="l-Scalar-Plain">- name</code><code class="p-Indicator">:</code> <code class="l-Scalar-Plain">mycharts</code>
  <code class="l-Scalar-Plain">url</code><code class="p-Indicator">:</code> <code class="l-Scalar-Plain">http://localhost:8080</code></pre>

<p>Get the list as JSON by adding <code>-o json</code>:<a data-type="indexterm" data-primary="JSON (JavaScript Object Notation)" data-secondary="chart repositories listed as" id="idm46125984825736"/></p>

<pre data-type="programlisting" data-code-language="json"><code class="err">$</code> <code class="err">helm</code> <code class="err">repo</code> <code class="err">list</code> <code class="err">-o</code> <code class="err">json</code>
<code class="p">[{</code><code class="nt">"name"</code><code class="p">:</code><code class="s2">"mycharts"</code><code class="p">,</code><code class="nt">"url"</code><code class="p">:</code><code class="s2">"http://localhost:8080"</code><code class="p">}]</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Updating Repositories"><div class="sect2" id="idm46125984802888">
<h2>Updating Repositories</h2>

<p>Once new chart versions are released, repository owners add the <em>.tgz</em> package<a data-type="indexterm" data-primary="chart repositories" data-secondary="updating added" id="idm46125984810040"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="updating added repositories" id="idm46125984809032"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" data-tertiary="updating added repositories" id="idm46125984807848"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="updating added repositories" id="idm46125984806696"/> to the repo storage and update <em>index.yaml</em> with a new entry.</p>

<p>In order to fetch the latest version of the repository index, use the <code>helm repo update</code> command:</p>

<pre data-type="programlisting">$ helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "mycharts" chart repository
Update Complete. Happy Helming!</pre>

<p>If you are running the Python example, once again, you should notice an incoming request for <code>GET /index.yaml</code> in the output logs from your chart repository:</p>

<pre data-type="programlisting">127.0.0.1 - - [06/May/2020 15:31:07] "GET /index.yaml HTTP/1.1" 200 -</pre>

<p>Whether or not the repository index has changed contents (we haven’t added any more charts to <code>myrepo</code>), the file is fetched and downloaded into the cache, overwriting the previously saved version.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Removing a Repository"><div class="sect2" id="idm46125984777192">
<h2>Removing a Repository</h2>

<p>In order to remove a repository, you can use <code>helm repo remove</code>:<a data-type="indexterm" data-primary="chart repositories" data-secondary="removing a repository" id="idm46125984775384"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" data-tertiary="removing a repository" id="idm46125984774376"/></p>

<pre data-type="programlisting">$ helm repo remove mycharts
"mycharts" has been removed from your repositories</pre>

<p>This will remove all references to this repository stored in the Helm cache.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Experimental OCI Support"><div class="sect1" id="idm46125984771864">
<h1>Experimental OCI Support</h1>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a href="https://oreil.ly/eH4KE">Helm’s OCI support</a> is still considered highly experimental. While <a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="about" data-tertiary="experimental status" id="idm46125984768696"/>development in this area is still active, the syntax described in this section may soon become outdated.<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="online information source" id="idm46125984767096"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="OCI information" id="idm46125984766152"/></p>
</div>

<p>The chart repository system was designed to be easy to use. In most cases, <a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="history of" id="idm46125984764696"/>this system has proven to be sufficient—enabling organizations around the globe to share and distribute their Helm charts.</p>

<p>Chart repositories do, however, present a few key challenges:<a data-type="indexterm" data-primary="chart repositories" data-secondary="about" data-tertiary="challenges of" id="idm46125984739496"/></p>

<ul>
<li>
<p>They have no concept of namespaces; all charts for a repo are listed in a single index</p>
</li>
<li>
<p>They have no fine-grained access control; you either have access to all charts in the repo or none of them</p>
</li>
<li>
<p>Chart packages with different names but the exact same raw contents are stored twice</p>
</li>
<li>
<p>The repository index can become extremely large, causing Helm to consume a lot of memory</p>
</li>
</ul>

<p>Rather than trying to add features to address all of these issues with the current chart repository model, it made much more sense to build the next generation of chart repositories on top of registries that conform to the <em>OCI Distribution Specification</em>.<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="about" id="idm46125984733064"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="OCI registries" data-seealso="OCI (open container initiative) registries" id="idm46125984732056"/></p>

<p>OCI stands for the <em>Open Container Initiative</em>. Taken from the website at <a href="https://opencontainers.org"><em class="hyperlink">https://opencontainers.org</em></a>, OCI is defined as the following:</p>
<blockquote>
<p>An open governance structure for the express purpose of creating open industry standards around container formats and runtimes.</p></blockquote>

<p>One of the standards defined by OCI is the <em>distribution specification</em>. <a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="distribution specification" id="idm46125984727016"/>This spec describes an HTTP API used for distributing container images. Interestingly enough, this API is general-purpose and can apply to all sorts of things that <em>aren’t</em> container images—things such as Helm charts!</p>

<p>Starting in Helm 3.0.0, experimental support was added to push and pull charts to and from OCI-based container registries.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46125984724504">
<h5>History of the OCI Distribution Spec</h5>
<p>Docker introduced its own container engine in 2013, which was challenged in 2014 <a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="history of" id="idm46125984722984"/><a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" id="idm46125984721912"/><a data-type="indexterm" data-primary="CoreOS rkt" id="idm46125984720968"/><a data-type="indexterm" data-primary="rkt (CoreOS)" id="idm46125984720296"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="pods" data-tertiary="rkt as historical origin" id="idm46125984719624"/><a data-type="indexterm" data-primary="pods" data-secondary="rkt as historical origin" id="idm46125984718392"/>by CoreOS when it introduced <em>rkt</em>, an alternative engine with an open standard. Fun fact: the concept of the Kubernetes <code>Pod</code> comes directly from <em>rkt</em>. In an effort to bridge the divide, the Open Container Initiative was formed in 2015 to collaborate on open standards for container runtimes and images.</p>

<p>Meanwhile, Docker had also been working on v2 of its registry API. If you have ever used <code>docker pull</code> or <code>docker push</code>, the underlying HTTP calls are based upon this API. Docker registries began to see massive industry adoption, giving birth to companies such as <a href="https://www.quay.io">Quay.io</a>. Cloud providers such as Amazon Web Services began offering their own hosted options.</p>

<p>In 2018, Docker donated its registry v2 specification to OCI under the <a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" data-tertiary="donated to OCI" data-seealso="OCI" id="idm46125984713160"/>name <a href="https://oreil.ly/JWYFv"><em>distribution spec</em></a>, enabling a broader community to continue to build on top of Docker’s efforts. The spec continues to evolve today as a general-purpose storage solution with a strong API.<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="history of" data-tertiary="distribution spec homepage" id="idm46125984710280"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="OCI information" data-tertiary="distribution spec" id="idm46125984709016"/></p>
</div></aside>








<section data-type="sect2" data-pdf-bookmark="Enabling OCI Support"><div class="sect2" id="idm46125984707544">
<h2>Enabling OCI Support</h2>

<p>At the time of writing, Helm’s OCI support is still considered experimental.<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="enabling OCI support" id="idm46125984706248"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="about" data-tertiary="experimental status" id="idm46125984705240"/></p>

<p>For now, set the following in your environment to enable OCI support:</p>
<pre>$ export HELM_EXPERIMENTAL_OCI=1</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Running a Local Registry"><div class="sect2" id="idm46125984702936">
<h2>Running a Local Registry</h2>

<p>The Docker Distribution project (also known as the Docker registry) <a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" data-tertiary="local registry via" id="idm46125984701256"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="local registry creation" id="idm46125984699928"/>was the original implementation of Docker’s Registry v2 API. It supports Helm charts out of the box.</p>

<p>If you have <code>docker</code> installed, you can easily run a local registry in a container on port 5000 with the following command:</p>

<pre data-type="programlisting">$ docker run -d --name oci-registry -p 5000:5000 registry</pre>

<p>To tail the logs for you registry, run the following (press Ctrl-C to exit):</p>

<pre data-type="programlisting">$ docker logs -f oci-registry</pre>

<p>To stop your registry, run the following:</p>

<pre data-type="programlisting">$ docker rm -f oci-registry</pre>

<p>The Docker registry has <a href="https://oreil.ly/CBb0F">several configuration options</a> related to authentication, storage, etc.<a data-type="indexterm" data-primary="resources for learning" data-secondary="Docker Distribution" data-tertiary="Docker registry configuration" id="idm46125984693432"/><a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" data-tertiary="configuration documentation" id="idm46125984692152"/></p>

<p>If you wish to configure basic auth with a single <a data-type="indexterm" data-primary="basic auth (basic access authentication)" data-secondary="Docker local registry" id="idm46125984690472"/><a data-type="indexterm" data-primary="security" data-secondary="basic auth" data-tertiary="Docker local registry" id="idm46125984689400"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="security" data-tertiary="basic auth for Docker local registry" id="idm46125984688184"/>username-password combo, first create a <em>.htpasswd</em> file:</p>

<pre data-type="programlisting">$ htpasswd -cB -b auth.htpasswd myuser mypass</pre>

<p>Then start the registry, mounting the <em>.htpasswd</em> file and setting the <code>REGISTRY_AUTH</code> environment variable:</p>

<pre data-type="programlisting">$ docker run -d --name oci-registry -p 5000:5000 \
    -v $(pwd)/auth.htpasswd:/etc/docker/registry/auth.htpasswd \
    -e REGISTRY_AUTH="{htpasswd: {realm: localhost, path: /etc/docker/registry \
    auth.htpasswd}}" registry</pre>

<p>For more information about Docker Distribution, visit the <a href="https://oreil.ly/Q8Omf">project GitHub page</a>.<a data-type="indexterm" data-primary="resources for learning" data-secondary="Docker Distribution" id="idm46125984682232"/><a data-type="indexterm" data-primary="Docker" data-secondary="Docker registries" data-tertiary="Docker Distribution project GitHub page" id="idm46125984681224"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Logging In to a Registry"><div class="sect2" id="idm46125984702312">
<h2>Logging In to a Registry</h2>

<p>In order to authenticate against a registry, use the <code>helm registry login</code> command (you will be prompted to manually enter a password):<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="logging in to" id="idm46125984678056"/></p>

<pre data-type="programlisting">$ helm registry login -u myuser localhost:5000
Password:
Login succeeded</pre>

<p>This makes a simple <code>GET</code> request to the path <code>/v2/</code> on the registry using the credentials to determine if they are valid. If they are, the credentials will be stored in a Helm config file. If you have any Docker credential stores enabled (such as <code>osxkeychain</code> on macOS), the username and password will be stored there securely.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The example of running a local registry at <code>localhost:5000</code> uses no authentication. If you haven’t enabled authentication on your registry, any combination of login credentials will be accepted.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Logging Out of a Registry"><div class="sect2" id="idm46125984672200">
<h2>Logging Out of a Registry</h2>

<p>In order to remove credentials for a given registry from your system, use the <code>helm registry logout</code> command:<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="logging out of" id="idm46125984670360"/></p>

<pre data-type="programlisting">$ helm registry logout localhost:5000
Logout succeeded</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Storing a Chart in the Cache"><div class="sect2" id="idm46125984668232">
<h2>Storing a Chart in the Cache</h2>

<p>Prior to uploading a chart to a registry, you must first save it into the cache.<a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="saving chart into" id="idm46125984666760"/><a data-type="indexterm" data-primary="cache for chart" data-secondary="saving chart into" id="idm46125984665416"/> This converts a chart from its normal state into content-addressable blobs and also gives it a unique identifier.</p>

<p>Use <code>helm chart save</code> to store a chart in the cache:</p>

<pre data-type="programlisting">$ helm chart save mychart/ localhost:5000/myrepo/mychart
ref:     localhost:5000/myrepo/mychart:2.7.0
digest:  1b251d38cfe948dfc0a5745b7af5ca574ecb61e52aed10b19039db39af6e1617
size:    2.4 KiB
name:    mychart
version: 2.7.0
2.7.0: saved</pre>

<p>Notice that the tag used on the chart reference is based upon the chart’s version in <em>Chart.yaml</em> (<code>2.7.0</code>).<a data-type="indexterm" data-primary="charts" data-secondary="versions" data-tertiary="chart repositories" id="idm46125984661160"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="chart versions" id="idm46125984659880"/></p>

<p>You can also use a custom tag, such as <code>stable</code>, by specifying it after a colon (<code>:</code>) on the chart reference:</p>

<pre data-type="programlisting">$ helm chart save mychart/ localhost:5000/myrepo/mychart:stable
ref:     localhost:5000/myrepo/mychart:stable
digest:  1b251d38cfe948dfc0a5745b7af5ca574ecb61e52aed10b19039db39af6e1617
size:    2.4 KiB
name:    mychart
version: 2.7.0
stable: saved</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Listing Charts in the Cache"><div class="sect2" id="idm46125984656472">
<h2>Listing Charts in the Cache</h2>

<p>Use <code>helm</code> <code>chart</code> <code>list</code> to display all charts currently stored in the cache:<a data-type="indexterm" data-primary="cache for chart" data-secondary="listing charts in" id="idm46125984653736"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="listing charts in" id="idm46125984652760"/></p>

<pre data-type="programlisting">$ helm chart list
REF                                               VERSION DIGEST  SIZE
localhost:5000/myrepo/mychart:2.7.0               2.7.0   84059d7 454 B
localhost:5000/stable/acs-engine-autoscaler:2.2.2 2.2.2   d8d6762 4.3 KiB
localhost:5000/stable/aerospike:0.2.1             0.2.1   4aff638 3.7 KiB
localhost:5000/stable/airflow:0.13.0              0.13.0  c46cc43 28.1 KiB
localhost:5000/stable/anchore-engine:0.10.0       0.10.0  3f3dcd7 34.3 KiB</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Exporting a Chart from the Cache"><div class="sect2" id="idm46125984650056">
<h2>Exporting a Chart from the Cache</h2>

<p>If you wish to extract the source files of a chart once it is in the cache, <a data-type="indexterm" data-primary="cache for chart" data-secondary="exporting chart from" id="idm46125984648712"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="exporting chart from" id="idm46125984647736"/>it must first be exported to a local directory. Use the <code>helm chart export</code> command to export the chart:</p>

<pre data-type="programlisting">$ helm chart export localhost:5000/myrepo/mychart:2.7.0
ref:     localhost:5000/myrepo/mychart:2.7.0
digest:  1b251d38cfe948dfc0a5745b7af5ca574ecb61e52aed10b19039db39af6e1617
size:    2.4 KiB
name:    mychart
version: 2.7.0
Exported chart to mychart/</pre>

<p>The name of the chart will be used to determine the output path (e.g., <code>mychart/</code>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Pushing a Chart to the Registry"><div class="sect2" id="idm46125984643624">
<h2>Pushing a Chart to the Registry</h2>

<p>Pushing (a.k.a. uploading) a chart to the registry allows for it to be used by others.<a data-type="indexterm" data-primary="cache for chart" data-secondary="pushing chart to registry" id="idm46125984642248"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="pushing chart to registry" id="idm46125984641208"/> Once you are already logged in to the registry and the chart you want to push has been saved to the cache, use the <code>helm chart push</code> command to push a chart:</p>

<pre data-type="programlisting">$ helm chart push localhost:5000/myrepo/mychart:2.7.0
The push refers to repository [localhost:5000/myrepo/mychart]
ref:     localhost:5000/myrepo/mychart:2.7.0
digest:  1b251d38cfe948dfc0a5745b7af5ca574ecb61e52aed10b19039db39af6e1617
size:    2.4 KiB
name:    mychart
version: 2.7.0
2.7.0: pushed to remote (1 layer, 2.4 KiB total)</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Pulling a Chart from the Registry"><div class="sect2" id="idm46125984637912">
<h2>Pulling a Chart from the Registry</h2>

<p>Once charts have been pushed to a registry, other users can then pull (a.k.a. download) <a data-type="indexterm" data-primary="cache for chart" data-secondary="pulling chart from registry" id="idm46125984636456"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="pulling chart from registry" id="idm46125984635416"/>them. Pulling charts from a registry places them into the local cache. To pull an existing chart from a registry, use the <code>helm chart pull</code> command:</p>

<pre data-type="programlisting">$ helm chart pull localhost:5000/myrepo/mychart:2.7.0
2.7.0: Pulling from localhost:5000/myrepo/mychart
ref:     localhost:5000/myrepo/mychart:2.7.0
digest:  1b251d38cfe948dfc0a5745b7af5ca574ecb61e52aed10b19039db39af6e1617
size:    2.4 KiB
name:    mychart
version: 2.7.0
Status: Downloaded newer chart for localhost:5000/myrepo/mychart:2.7.0</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Removing a Chart from the Cache"><div class="sect2" id="idm46125984632168">
<h2>Removing a Chart from the Cache</h2>

<p>To remove a chart from the local cache, use the <code>helm chart remove</code> command:<a data-type="indexterm" data-primary="cache for chart" data-secondary="removing chart from" id="idm46125984630456"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="removing chart from" id="idm46125984629448"/></p>

<pre data-type="programlisting">$ helm chart remove localhost:5000/myrepo/mychart:2.7.0
2.7.0: removed</pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Related Projects"><div class="sect1" id="related_projects">
<h1>Related Projects</h1>

<p>Helm’s chart repository system has spawned a collection of open source tools to further enhance this experience. The following subsections cover some of the projects related to chart repositories.</p>








<section data-type="sect2" data-pdf-bookmark="ChartMuseum"><div class="sect2" id="idm46125984625544">
<h2>ChartMuseum</h2>

<p><em>Project homepage: <a href="https://github.com/helm/chartmuseum"><em class="hyperlink">https://github.com/helm/chartmuseum</em></a></em></p>

<p><em>ChartMuseum</em> is a simple chart repository web server. Configure<a data-type="indexterm" data-primary="open source tools" data-secondary="ChartMuseum web server" id="idm46125984622136"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="ChartMuseum web server" id="idm46125984621192"/><a data-type="indexterm" data-primary="ChartMuseum chart repository web server" id="idm46125984619976"/> it to point to a storage location containing chart packages and it will dynamically generate <em>index.yaml</em>. It also exposes an HTTP API for uploading, querying, and deleting chart packages from storage. Additionally, it has a number of other configuration settings for auth, multitenancy, and caching that make it a popular choice for users hosting private or internal chart repositories.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46125984618184">
<h5>ChartMuseum’s Supported Backends</h5>
<p>ChartMuseum supports a wide array of storage backends, including the following:</p>

<ul>
<li>
<p>Alibaba Cloud OSS Storage</p>
</li>
<li>
<p>Amazon S3</p>
</li>
<li>
<p>Baidu Cloud BOS Storage</p>
</li>
<li>
<p>DigitalOcean Spaces</p>
</li>
<li>
<p>etcd</p>
</li>
<li>
<p>Google Cloud Storage</p>
</li>
<li>
<p>Local filesystem</p>
</li>
<li>
<p>Microsoft Azure Blob Storage</p>
</li>
<li>
<p>Minio</p>
</li>
<li>
<p>Netease Cloud NOS Storage</p>
</li>
<li>
<p>Openstack Object Storage</p>
</li>
<li>
<p>Oracle Cloud Infrastructure Object Storage</p>
</li>
<li>
<p>Tencent Cloud Object Storage</p>
</li>
</ul>
</div></aside>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Harbor"><div class="sect2" id="idm46125984604216">
<h2>Harbor</h2>

<p><em>Project homepage: <a href="https://github.com/goharbor/harbor"><em class="hyperlink">https://github.com/goharbor/harbor</em></a></em></p>

<p><em>Harbor</em> is a full-featured registry with added security and management features.<a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="Harbor full-featured registry" id="idm46125984600968"/><a data-type="indexterm" data-primary="Harbor full-featured chart registry" id="idm46125984599688"/><a data-type="indexterm" data-primary="open source tools" data-secondary="Harbor full-featured registry" id="idm46125984599000"/> It provides a UI for Helm charts and leverages ChartMuseum on the backend as a multitenant chart respository. It also provides support for Helm’s experimental OCI feature set.</p>

<p>Similar to Helm, <em>Harbor</em> is a graduated, top-level CNCF project.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Chart Releaser"><div class="sect2" id="idm46125984596568">
<h2>Chart Releaser</h2>

<p><em>Project homepage: <a href="https://github.com/helm/chart-releaser"><em class="hyperlink">https://github.com/helm/chart-releaser</em></a></em></p>

<p><em>Chart Releaser</em>, or <code>cr</code>, is a command-line tool that leverages GitHub <a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="Chart Releaser chart package host" id="idm46125984592824"/><a data-type="indexterm" data-primary="Chart Releaser chart package host" id="idm46125984591512"/><a data-type="indexterm" data-primary="open source tools" data-secondary="Chart Releaser chart package host" id="idm46125984590824"/>releases for hosting chart packages. It has the ability to detect charts in a Git repo, package them, and upload each of them as artifacts to GitHub releases named after the unique chart 
<span class="keep-together">version</span>.</p>

<p>Once charts have been uploaded using <code>cr</code>, the tool can also be used to generate an <em>index.yaml</em> file based on the contents of GitHub releases and associated artifacts. This repository index can then be hosted statically, on GitHub Pages or elsewhere.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="S3 Plugin"><div class="sect2" id="idm46125984587096">
<h2>S3 Plugin</h2>

<p><em>Project homepage: <a href="https://github.com/hypnoglow/helm-s3"><em class="hyperlink">https://github.com/hypnoglow/helm-s3</em></a></em></p>

<p>The S3 plugin is a Helm plugin that allows you to use a private <a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="S3 plugin" id="idm46125984584136"/><a data-type="indexterm" data-primary="plugins" data-secondary="S3 as repository" id="idm46125984582872"/><a data-type="indexterm" data-primary="S3 plugin for chart repository" id="idm46125984581928"/><a data-type="indexterm" data-primary="Amazon S3 plugin for chart repository" id="idm46125984581192"/><a data-type="indexterm" data-primary="open source tools" data-secondary="S3 repository plugin" id="idm46125984580504"/>Amazon S3 bucket as a chart repository.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="GCS Plugin"><div class="sect2" id="idm46125984579176">
<h2>GCS Plugin</h2>

<p><em>Project homepage: <a href="https://github.com/hayorov/helm-gcs"><em class="hyperlink">https://github.com/hayorov/helm-gcs</em></a></em></p>

<p>The GCS plugin is a Helm plugin that allows you to use a private Google Cloud Storage bucket as a chart repository.<a data-type="indexterm" data-primary="open source tools" data-secondary="GCS repository plugin" id="idm46125984576120"/><a data-type="indexterm" data-primary="plugins" data-secondary="GCS as repository" id="idm46125984575208"/><a data-type="indexterm" data-primary="GCS repository plugin" id="idm46125984574264"/><a data-type="indexterm" data-primary="Google Cloud Storage as repository" id="idm46125984573592"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="GCS plugin" id="idm46125984572856"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Git Plugin"><div class="sect2" id="idm46125984571384">
<h2>Git Plugin</h2>

<p><em>Project homepage: <a href="https://github.com/aslafy-z/helm-git"><em class="hyperlink">https://github.com/aslafy-z/helm-git</em></a></em></p>

<p>The Git plugin is a Helm plugin that allows you to use a Git repository containing<a data-type="indexterm" data-primary="open source tools" data-secondary="Git repository plugin" id="idm46125984568504"/><a data-type="indexterm" data-primary="plugins" data-secondary="Git as repository" id="idm46125984567592"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="open source tools" data-tertiary="Git repository plugin" id="idm46125984566648"/><a data-type="indexterm" data-primary="Git repository plugin" id="idm46125984565432"/> chart source files as a chart repository. It supports subpaths, custom references, and both HTTPS and SSH Git URLs.</p>
</div></section>





</div></section>







</div></section></div></body></html>