<html><head></head><body><section data-pdf-bookmark="Chapter 9. State Management with Pinia" data-type="chapter" epub:type="chapter"><div class="chapter" id="unique_chapter_id_08">&#13;
<h1><span class="label">Chapter 9. </span>State Management with Pinia</h1>&#13;
&#13;
&#13;
<p>The previous chapter guided us through building our application’s routings using Vue Router, including nested routes, route guards, and dynamic route navigation.</p>&#13;
&#13;
<p>In this chapter, we will learn state management and how to manage the data flow within our Vue application using Pinia, the officially recommended state management library for Vue. We will also explore how to build our application’s reusable and efficient data state management system.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Understanding State Management in Vue" data-type="sect1"><div class="sect1" id="id102">&#13;
<h1>Understanding State Management in Vue</h1>&#13;
&#13;
<p>Data makes an application come to life and connects components. And components interact with users and with others using data states. State management is crucial for building an application that works with actual data, regardless of size and complexity. For example, we can display only a gallery of product cards with a list of pizzas and their details. Once a user adds a product to the cart within this gallery component, we need to update the cart’s data and display the updated cart’s data in the cart component at the same time as updating the chosen product’s remaining stock<a data-primary="carts" data-secondary="state management and data flow" data-type="indexterm" id="ix-state-pin1"/><a data-primary="data" data-secondary="data flow and state management" data-type="indexterm" id="ix-state-pin1a"/><a data-primary="state" data-secondary="data flow and state management" data-type="indexterm" id="ix-state-pin1b"/><a data-primary="state" data-secondary="management with Pinia" data-type="indexterm" id="ix-state-pin2"/><a data-primary="state management systems" data-secondary="Pinia" data-type="indexterm" id="ix-state-pin2a"/><a data-primary="state" data-primary-sortas="lifecycle hooks" data-type="indexterm" id="id1391"/>.</p>&#13;
&#13;
<p>Take our Pizza House application, for example. In the main view (<code>App.vue</code>), we have a header component (<code>HeaderView</code>) and a gallery of pizza cards (<code>PizzasView</code>). The header contains a cart icon that displays the number of items in the cart, while the gallery includes a list of pizza cards, each with a button allowing the user to add the selected item to the cart. <a data-type="xref" href="#figure_ch08_diagram">Figure 9-1</a> illustrates the hierarchical structure of the components from the main view.</p>&#13;
&#13;
<figure><div class="figure" id="figure_ch08_diagram">&#13;
<img alt="Screenshot showing the tree structure of the App component, where the header component and the gallery component are the children of the App and sibling to each other" src="assets/lvue_0901.png"/>&#13;
<h6><span class="label">Figure 9-1. </span>Hierarchy structure of the components from the main view of Pizza House</h6>&#13;
</div></figure>&#13;
&#13;
<p>When a user adds a pizza to the cart, the cart icon will display the updated number of items. To enable data communication between the header component and the gallery component, we can have the <code>App</code> manage the <code>cart</code> data and pass its data to the header as props while communicating with the gallery using an event <code>updateCart</code>, as seen in <a data-type="xref" href="#figure_ch08_dataflow">Figure 9-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_ch08_dataflow">&#13;
<img alt="Screenshot showing the data flow between the components, where the App component manages the cart data and passes it to the header component as props, and communicates with the gallery component using an event updateCart" src="assets/lvue_0902.png"/>&#13;
<h6><span class="label">Figure 9-2. </span>Data flow between the gallery and header with the App as the middleman</h6>&#13;
</div></figure>&#13;
&#13;
<p>This approach works well for small applications. However, suppose we want to split <code>PizzasView</code> into subcomponents, such as <code>PizzasGallery</code>, and have <code>PizzasGallery</code> render the <code>PizzaCard</code> component for each pizza. For each new parent-child layer, we will need to propagate the <code>updateCart</code> event to ensure the propagation of the data flow between the gallery and the header, as in <a data-type="xref" href="#figure_ch08_dataflow2">Figure 9-3</a>.</p>&#13;
&#13;
<p>It will become more complicated when we have more components and layers, leaving a lot of unnecessary props and events. As a result, this approach could be less scalable and maintainable when our application grows.</p>&#13;
&#13;
<p>To reduce this overhead and manage the state flows within the application, we need a global state management system, a centralized place to store and manage the data states of the application. This system is responsible for managing the data states and distributing the data to the necessary components.</p>&#13;
&#13;
<p>One of the most popular approaches to provide developers with a smooth experience is using a state management library, such as Pinia<a data-primary="" data-startref="ix-state-pin1" data-type="indexterm" id="id1392"/><a data-primary="" data-startref="ix-state-pin1a" data-type="indexterm" id="id1393"/><a data-primary="" data-startref="ix-state-pin1b" data-type="indexterm" id="id1394"/>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_ch08_dataflow2">&#13;
<img alt="Screenshot showing the data flow between the components, where the App component manages the cart data and passes it to the header component as props, and communicates with the gallery component using an event updateCart" src="assets/lvue_0903.png"/>&#13;
<h6><span class="label">Figure 9-3. </span>Data flow between the gallery with children and header, with the App as the middleman</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Understanding Pinia" data-type="sect1"><div class="sect1" id="id103">&#13;
<h1>Understanding Pinia</h1>&#13;
&#13;
<p>Inspired by Vuex<sup><a data-type="noteref" href="ch09.html#id1395" id="id1395-marker">1</a></sup> and Vue Composition API, Pinia is Vue’s current official state management library. Nevertheless, you can always use other state management JavaScript libraries that support Vue, such as Vuex, MobX and XState<a data-primary="Pinia" data-secondary="state management with" data-type="indexterm" id="ix-state-pin2b"/><a data-primary="state management systems" data-secondary="tools for" data-type="indexterm" id="id1396"/><a data-primary="MobX" data-type="indexterm" id="id1397"/><a data-primary="Vuex" data-type="indexterm" id="id1398"/><a data-primary="XState" data-type="indexterm" id="id1399"/>.</p>&#13;
&#13;
<p>Pinia follows the store pattern of Vuex but with a more flexible and scalable approach.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The official Pinia documentation is available at the <a href="https://oreil.ly/JoOwm">Pinia website</a>, with information on installation, APIs, and primary use cases for reference<a data-primary="Pinia" data-secondary="resources on" data-type="indexterm" id="id1400"/>.</p>&#13;
</div>&#13;
&#13;
<p>Instead of having a single system for all data sets used across the application, with Pinia, we can split each data set into its state module (or store). We then can access relevant data in a store from any component using a custom composable, following the Composition API pattern<a data-primary="stores" data-secondary="state management role" data-type="indexterm" id="id1401"/>.</p>&#13;
&#13;
<p class="pagebreak-before">When creating a Vue project from scratch using Vite, we can choose to install Pinia as the state management during the scaffolding process (see <a data-type="xref" href="ch01.html#chapter_01_newVueApp">“Create a New Vue Application”</a>). Vite will create our project with Pinia installed and configured with an example <code>counter</code> store, exposed as <code>useCounterStore</code>, located in <code>src/stores/counter.ts</code><a data-primary="Vite.js" data-secondary="installing Pinia" data-type="indexterm" id="id1402"/><a data-primary="installing" data-secondary="Pinia" data-type="indexterm" id="id1403"/><a data-primary="Pinia" data-secondary="installing" data-type="indexterm" id="id1404"/>.</p>&#13;
&#13;
<p>However, to fully understand how Pinia works, we will skip the scaffolding option and add Pinia manually using the following command:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">yarn<code class="w"> </code>add<code class="w"> </code>pinia<code class="w"/></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In this book, we use Pinia 2.1.3, the latest version at the time of writing. You can replace the version number after <code>@</code> with the newest version from the <a href="https://oreil.ly/zCUCg">Pinia NPM page</a>.</p>&#13;
</div>&#13;
&#13;
<p>Once Pinia is installed, navigate to <code>src/main.ts</code> and import <code>createPinia</code> from the <code>pinia</code> package, use it to create a new Pinia instance, and plug it into the application<a data-primary="createPinia" data-type="indexterm" id="id1405"/><a data-primary="Pinia" data-secondary="creating instances" data-type="indexterm" id="id1406"/><a data-primary="versions" data-secondary="Pinia" data-type="indexterm" id="id1407"/><a data-primary="Pinia" data-secondary="version" data-type="indexterm" id="id1408"/>:</p>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">createApp</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'vue'</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">createPinia</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'pinia'</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO1-1" id="co_state_management_with_pinia_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
&#13;
</code><code class="kr">import</code><code> </code><code class="nx">App</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'./App.vue'</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="nx">router</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'./router'</code><code>&#13;
&#13;
</code><code class="kr">const</code><code> </code><code class="nx">app</code><code> </code><code class="o">=</code><code> </code><code class="nx">createApp</code><code class="p">(</code><code class="nx">App</code><code class="p">)</code><code>&#13;
</code><code class="kr">const</code><code> </code><code class="nx">pinia</code><code> </code><code class="o">=</code><code> </code><code class="nx">createPinia</code><code class="p">(</code><code class="p">)</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO1-2" id="co_state_management_with_pinia_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
&#13;
</code><code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">pinia</code><code class="p">)</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO1-3" id="co_state_management_with_pinia_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
&#13;
</code><code class="nx">app</code><code class="p">.</code><code class="nx">mount</code><code class="p">(</code><code class="s1">'#app'</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO1-1" id="callout_state_management_with_pinia_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Import <code>createPinia</code> from the <code>pinia</code> package</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO1-2" id="callout_state_management_with_pinia_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Create a new Pinia instance</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO1-3" id="callout_state_management_with_pinia_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Plug the Pinia instance into the application for use</p></dd>&#13;
</dl>&#13;
&#13;
<p>With Pinia installed and plugged in, we will create the first store for our application: a <code>pizzas</code> store to manage the available pizzas for the application.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Pizzas Store for Pizza House" data-type="sect1"><div class="sect1" id="id104">&#13;
<h1>Creating a Pizzas Store for Pizza House</h1>&#13;
&#13;
<p>As Pinia follows the store pattern of Vuex, a store in Pinia contains the following fundamental properties<a data-primary="stores" data-secondary="properties of" data-type="indexterm" id="id1409"/><a data-primary="Pinia" data-secondary="stores, creating" data-type="indexterm" id="ix-state-pin3"/><a data-primary="stores" data-secondary="creating" data-type="indexterm" id="ix-state-pin3a"/>:</p>&#13;
<dl>&#13;
<dt>State</dt>&#13;
<dd>&#13;
<p>The reactive data (state) of the store, created by using <code>ref()</code> or <code>reactive()</code> methods from Composition API<a data-primary="state, store property" data-type="indexterm" id="id1410"/>.</p>&#13;
</dd>&#13;
<dt>Getters</dt>&#13;
<dd>&#13;
<p>The computed and read-only properties of the store, created by using the &#13;
<span class="keep-together"><code>computed()</code></span> method<a data-primary="getters" data-secondary="stores" data-type="indexterm" id="id1411"/><a data-primary="Composition API" data-secondary="computed()" data-type="indexterm" id="id1412"/><a data-primary="computed()" data-type="indexterm" id="id1413"/>.</p>&#13;
</dd>&#13;
<dt>Actions</dt>&#13;
<dd>&#13;
<p>The methods to update the store’s state or perform custom logic on the store’s data (state)<a data-primary="actions, stores" data-type="indexterm" id="id1414"/>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Pinia provides a <code>defineStore</code> function to create a new store, which accepts two arguments: the store’s name and properties, and the methods available for use in other components. The store’s properties and methods can be an object with the key fields <code>state</code>, <code>getters</code>, <code>actions</code> following Options API (<a data-type="xref" href="#example_ch8_01">Example 9-1</a>), or a function that uses Composable API and return an object with the fields to expose (<a data-type="xref" href="#example_ch8_02">Example 9-2</a>)<a data-primary="names" data-secondary="stores" data-type="indexterm" id="id1415"/><a data-primary="stores" data-secondary="names" data-type="indexterm" id="id1416"/><a data-primary="defineStore()" data-type="indexterm" id="id1417"/>.</p>&#13;
<div data-type="example" id="example_ch8_01">&#13;
<h5><span class="label">Example 9-1. </span>Defining a store using an object configuration</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">defineStore</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'pinia'</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">useStore</code> <code class="o">=</code> <code class="nx">defineStore</code><code class="p">(</code><code class="s1">'storeName'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="p">{</code>&#13;
        <code class="nx">state</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">({</code>&#13;
            <code class="c1">// state properties</code>&#13;
            <code class="nx">myData</code><code class="o">:</code> <code class="p">{</code> <code class="cm">/**... */</code><code class="p">}</code>&#13;
        <code class="p">}),</code>&#13;
        <code class="nx">getters</code><code class="o">:</code> <code class="p">{</code>&#13;
            <code class="c1">// getters properties</code>&#13;
            <code class="nx">computedData</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="cm">/**... */</code> <code class="p">}</code>&#13;
        <code class="p">},</code>&#13;
        <code class="nx">actions</code><code class="o">:</code> <code class="p">{</code>&#13;
            <code class="c1">// actions methods</code>&#13;
            <code class="nx">myAction</code><code class="p">(){</code> <code class="cm">/**... */</code> <code class="p">}</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">})</code></pre></div>&#13;
<div data-type="example" id="example_ch8_02">&#13;
<h5><span class="label">Example 9-2. </span>Defining a store using a function</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">defineStore</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'pinia'</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">reactive</code><code class="p">,</code> <code class="nx">computed</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">useStore</code> <code class="o">=</code> <code class="nx">defineStore</code><code class="p">(</code><code class="s1">'storeName'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">//state properties</code>&#13;
    <code class="kr">const</code> <code class="nx">myData</code> <code class="o">=</code> <code class="nx">reactive</code><code class="p">({</code> <code class="cm">/**... */</code> <code class="p">})</code>&#13;
&#13;
    <code class="c1">// getters properties</code>&#13;
    <code class="kr">const</code> <code class="nx">computedData</code> <code class="o">=</code> <code class="nx">computed</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="cm">/**... */</code><code class="p">})</code>&#13;
&#13;
    <code class="c1">// actions methods</code>&#13;
    <code class="kr">const</code> <code class="nx">myAction</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code> <code class="cm">/**... */</code> <code class="p">}</code>&#13;
&#13;
    <code class="k">return</code> <code class="p">{</code>&#13;
        <code class="nx">myData</code><code class="p">,</code>&#13;
        <code class="nx">computedData</code><code class="p">,</code>&#13;
        <code class="nx">myAction</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">})</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This chapter will focus on using Pinia stores with Vue 3.x Composition API, usually known as <em>setup stores</em><a data-primary="Composition API" data-secondary="setup stores" data-type="indexterm" id="id1418"/><a data-primary="setup stores" data-type="indexterm" id="id1419"/><a data-primary="functions" data-secondary="defining stores with" data-type="indexterm" id="id1420"/><a data-primary="stores" data-secondary="setup stores" data-type="indexterm" id="id1421"/>.</p>&#13;
</div>&#13;
&#13;
<p>Let’s go back to our <code>pizzas</code> store. We add a new file, <code>src/stores/pizzas.ts</code>, with the code shown in <a data-type="xref" href="#pizzas_store">Example 9-3</a>.</p>&#13;
<div data-type="example" id="pizzas_store">&#13;
<h5><span class="label">Example 9-3. </span>Pizzas store</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="cm">/** src/stores/pizzas.ts */</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">defineStore</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'pinia'</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="kr">type</code><code> </code><code class="p">{</code><code> </code><code class="nx">Pizza</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'../types/Pizza'</code><code class="p">;</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">ref</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'vue'</code><code>&#13;
&#13;
</code><code class="kr">export</code><code> </code><code class="kr">const</code><code> </code><code class="nx">usePizzasStore</code><code> </code><code class="o">=</code><code> </code><code class="nx">defineStore</code><code class="p">(</code><code class="s1">'pizzas'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO2-1" id="co_state_management_with_pinia_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">pizzas</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="o">&lt;</code><code class="nx">Pizza</code><code class="p">[</code><code class="p">]</code><code class="o">&gt;</code><code class="p">(</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO2-2" id="co_state_management_with_pinia_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">fetchPizzas</code><code> </code><code class="o">=</code><code> </code><code class="kr">async</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO2-3" id="co_state_management_with_pinia_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="kr">await</code><code> </code><code class="nx">fetch</code><code class="p">(</code><code>&#13;
            </code><code class="s1">'http://exploringvue.com/.netlify/functions/pizzas'</code><code>&#13;
        </code><code class="p">)</code><code class="p">;</code><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">data</code><code> </code><code class="o">=</code><code> </code><code class="kr">await</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>&#13;
        </code><code class="nx">pizzas</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">data</code><code class="p">;</code><code>&#13;
    </code><code class="p">}</code><code>&#13;
&#13;
    </code><code class="k">return</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">pizzas</code><code class="p">,</code><code>&#13;
        </code><code class="nx">fetchPizzas</code><code>&#13;
    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code></pre></div>&#13;
&#13;
<p>Then in <code>PizzasView</code> (based on the previous chapter’s <a data-type="xref" href="ch08.html#pizza_view_component">Example 8-2</a> component), we will use the <code>pizzas</code> and <code>fetchPizzas</code> properties from the <code>pizzas</code> store to fetch and display the list of pizzas from our API as in <a data-type="xref" href="#pizza_view_component_store">Example 9-4</a>.</p>&#13;
<div data-type="example" id="pizza_view_component_store">&#13;
<h5><span class="label">Example 9-4. </span><code>PizzasView</code> component using the pizzas store</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizzas-view--container"</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code>Pizzas</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
      </code><code class="p">&lt;</code><code class="nt">li</code><code> </code><code class="na">v-for</code><code class="o">=</code><code class="s">"pizza in pizzasStore.pizzas"</code><code> </code><code class="na">:key</code><code class="o">=</code><code class="s">"pizza.id"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO2-1" id="co_state_management_with_pinia_CO2-4"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">PizzaCard</code><code> </code><code class="na">:pizza</code><code class="o">=</code><code class="s">"pizza"</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>&#13;
      </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">li</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code> </code><code class="na">setup</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="cm">/**.... */</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">watch</code><code class="p">,</code><code class="w"> </code><code class="nx">type</code><code class="w"> </code><code class="nx">Ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"vue"</code><code class="p">;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">usePizzasStore</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@/stores/pizzas"</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="c1">//...</code><code class="w">&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">pizzasStore</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">usePizzasStore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO2-2" id="co_state_management_with_pinia_CO2-5"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
&#13;
</code><code class="nx">pizzasStore</code><code class="p">.</code><code class="nx">fetchPizzas</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO2-3" id="co_state_management_with_pinia_CO2-6"><img alt="3" src="assets/3.png"/></a><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO2-1" id="callout_state_management_with_pinia_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Render the list of pizzas using <code>pizzasStore.pizzas</code>.</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO2-2" id="callout_state_management_with_pinia_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Import the <code>usePizzasStore</code> function from the <code>pizzas</code> store and use it to get the <code>pizzasStore</code> instance.</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO2-3" id="callout_state_management_with_pinia_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Fetch the pizzas from the API when the component is mounted asynchronously.</p></dd>&#13;
</dl>&#13;
&#13;
<p>With the previous code, our <code>PizzasView</code> component is now using the <code>pizzas</code> store to fetch and display the list of pizzas from our API (<a data-type="xref" href="#figure_ch8_pizzasview">Figure 9-4</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_ch8_pizzasview">&#13;
<img alt="Screenshot showing a list of pizzas" src="assets/lvue_0904.png"/>&#13;
<h6><span class="label">Figure 9-4. </span><code>PizzasView</code> component using the pizzas store</h6>&#13;
</div></figure>&#13;
&#13;
<p>Great. Nevertheless, notice that we no longer have the search functionality, which uses the <code>useSearch()</code> composable from the previous chapter’s <a data-type="xref" href="ch08.html#useSearch_hook">Example 8-3</a>. If we pass <code>pizzasStore.pizzas</code> directly to the <code>useSearch()</code> composable as <code>items</code>, it will lose the reactivity, and <code>searchResults</code> won’t get recalculated after <code>pizzasStore.fetchPizzas()</code> resolves. To fix this issue, we use <code>storeToRefs()</code> from <code>pinia</code> to extract <code>pizzas</code> from the <code>pizzasStore</code> and keep its reactivity when passing to <code>useSearch()</code> (<a data-type="xref" href="#useSearch_working">Example 9-5</a>)<a data-primary="storeToRefs()" data-type="indexterm" id="id1422"/><a data-primary="useSearch()" data-type="indexterm" id="id1423"/>.</p>&#13;
<div data-type="example" id="useSearch_working">&#13;
<h5><span class="label">Example 9-5. </span><code>useSearch()</code> composable working with pizzas store</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="cm">/** src/views/PizzasView.vue */</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useSearch</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@/composables/useSearch'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">storeToRefs</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'pinia'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">//...</code>&#13;
<code class="kr">const</code> <code class="nx">pizzasStore</code> <code class="o">=</code> <code class="nx">usePizzasStore</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="p">{</code> <code class="nx">pizzas</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">storeToRefs</code><code class="p">(</code><code class="nx">pizzasStore</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="p">{</code> <code class="nx">search</code><code class="p">,</code> <code class="nx">searchResults</code> <code class="p">}</code><code class="o">:</code> <code class="nx">PizzaSearch</code> <code class="o">=</code> <code class="nx">useSearch</code><code class="p">({</code>&#13;
  <code class="nx">items</code><code class="o">:</code> <code class="nx">pizzas</code><code class="p">,</code>&#13;
  <code class="nx">defaultSearch</code><code class="o">:</code> <code class="nx">props</code><code class="p">.</code><code class="nx">searchTerm</code><code class="p">,</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">//...</code></pre></div>&#13;
&#13;
<p>Now our template uses the <code>searchResults</code> instead of <code>pizzasStore.pizzas</code> and we can bring the search <code>input</code> field back (<a data-type="xref" href="#pizzasview_search">Example 9-6</a>).</p>&#13;
<div data-type="example" id="pizzasview_search">&#13;
<h5><span class="label">Example 9-6. </span><code>PizzasView</code> component with a search using the pizzas store</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"pizzas-view--container"</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code>Pizzas<code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">input</code> <code class="na">v-model</code><code class="o">=</code><code class="s">"search"</code> <code class="na">placeholder</code><code class="o">=</code><code class="s">"Search for a pizza"</code> <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code>&#13;
      <code class="p">&lt;</code><code class="nt">li</code> <code class="na">v-for</code><code class="o">=</code><code class="s">"pizza in searchResults"</code> <code class="na">:key</code><code class="o">=</code><code class="s">"pizza.id"</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">PizzaCard</code> <code class="na">:pizza</code><code class="o">=</code><code class="s">"pizza"</code> <code class="p">/&gt;</code>&#13;
      <code class="p">&lt;/</code><code class="nt">li</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>Next, we will create a cart store to manage the current user’s cart data, including the list of items added.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Cart Store for Pizza House" data-type="sect1"><div class="sect1" id="id105">&#13;
<h1>Creating a Cart Store for Pizza House</h1>&#13;
&#13;
<p>To create our <code>cart</code> store, we define our <code>cart</code> store with the following properties<a data-primary="stores" data-secondary="with Pinia" data-secondary-sortas="Pinia" data-type="indexterm" id="ix-state-pin4"/><a data-primary="carts" data-secondary="stores with Pinia" data-type="indexterm" id="ix-state-pin4a"/><a data-primary="Pinia" data-secondary="shopping carts with" data-type="indexterm" id="ix-state-pin4b"/>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A list of <code>items</code> added to the cart; each item contains the <code>id</code> and <code>quantity</code> of the pizza</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>total</code> items of the cart</p>&#13;
</li>&#13;
<li>&#13;
<p>An <code>add</code> method to add an item from the cart</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>To create our <code>cart</code> store, we add a new file, <code>src/stores/cart.ts</code>, with the code shown in <a data-type="xref" href="#cart_store">Example 9-7</a>.</p>&#13;
<div data-type="example" id="cart_store">&#13;
<h5><span class="label">Example 9-7. </span>Cart store</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">defineStore</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'pinia'</code><code>&#13;
&#13;
</code><code class="kr">type</code><code> </code><code class="nx">CartItem</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO3-1" id="co_state_management_with_pinia_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
    </code><code class="nx">id</code><code class="o">:</code><code> </code><code class="kt">string</code><code class="p">;</code><code>&#13;
    </code><code class="nx">quantity</code><code class="o">:</code><code> </code><code class="kt">number</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kr">export</code><code> </code><code class="kr">const</code><code> </code><code class="nx">useCartStore</code><code> </code><code class="o">=</code><code> </code><code class="nx">defineStore</code><code class="p">(</code><code class="s1">'cart'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">items</code><code> </code><code class="o">=</code><code> </code><code class="nx">reactive</code><code class="o">&lt;</code><code class="nx">CartItem</code><code class="p">[</code><code class="p">]</code><code class="o">&gt;</code><code class="p">(</code><code class="p">[</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO3-2" id="co_state_management_with_pinia_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">total</code><code> </code><code class="o">=</code><code> </code><code class="nx">computed</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO3-3" id="co_state_management_with_pinia_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
        </code><code class="k">return</code><code> </code><code class="nx">items</code><code class="p">.</code><code class="nx">reduce</code><code class="p">(</code><code class="p">(</code><code class="nx">acc</code><code class="p">,</code><code> </code><code class="nx">item</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="k">return</code><code> </code><code class="nx">acc</code><code> </code><code class="o">+</code><code> </code><code class="nx">item</code><code class="p">.</code><code class="nx">quantity</code><code>&#13;
        </code><code class="p">}</code><code class="p">,</code><code> </code><code class="mi">0</code><code class="p">)</code><code>&#13;
    </code><code class="p">}</code><code class="p">)</code><code>&#13;
&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">add</code><code> </code><code class="o">=</code><code> </code><code class="p">(</code><code class="nx">item</code><code class="o">:</code><code> </code><code class="nx">CartItem</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO3-4" id="co_state_management_with_pinia_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">index</code><code> </code><code class="o">=</code><code> </code><code class="nx">items</code><code class="p">.</code><code class="nx">findIndex</code><code class="p">(</code><code class="nx">i</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="nx">i</code><code class="p">.</code><code class="nx">id</code><code> </code><code class="o">===</code><code> </code><code class="nx">item</code><code class="p">.</code><code class="nx">id</code><code class="p">)</code><code>&#13;
        </code><code class="k">if</code><code> </code><code class="p">(</code><code class="nx">index</code><code> </code><code class="o">&gt;</code><code> </code><code class="o">-</code><code class="mi">1</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="nx">items</code><code class="p">[</code><code class="nx">index</code><code class="p">]</code><code class="p">.</code><code class="nx">quantity</code><code> </code><code class="o">+=</code><code> </code><code class="nx">item</code><code class="p">.</code><code class="nx">quantity</code><code>&#13;
        </code><code class="p">}</code><code> </code><code class="k">else</code><code> </code><code class="p">{</code><code>&#13;
            </code><code class="nx">items</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">item</code><code class="p">)</code><code>&#13;
        </code><code class="p">}</code><code>&#13;
    </code><code class="p">}</code><code>&#13;
&#13;
    </code><code class="k">return</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">items</code><code class="p">,</code><code>&#13;
        </code><code class="nx">total</code><code class="p">,</code><code>&#13;
        </code><code class="nx">add</code><code>&#13;
    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO3-1" id="callout_state_management_with_pinia_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Define the type of the cart item</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO3-2" id="callout_state_management_with_pinia_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Initialize the <code>items</code> state with an empty array</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO3-3" id="callout_state_management_with_pinia_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Create a <code>total</code> getter to calculate the total items in the cart</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO3-4" id="callout_state_management_with_pinia_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Create an <code>add</code> action to add an item to the cart. If the item is already in the cart, the quantity will update instead of adding a new item<a data-primary="actions, stores" data-type="indexterm" id="id1424"/><a data-primary="components" data-secondary="stores" data-type="indexterm" id="id1425"/><a data-primary="getters" data-secondary="stores" data-type="indexterm" id="id1426"/>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>With the <code>cart</code> store created, we can now use it in our application<a data-primary="" data-startref="ix-state-pin3" data-type="indexterm" id="id1427"/><a data-primary="" data-startref="ix-state-pin3a" data-type="indexterm" id="id1428"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the Cart Store in a Component" data-type="sect1"><div class="sect1" id="id152">&#13;
<h1>Using the Cart Store in a Component</h1>&#13;
&#13;
<p>Let’s create a new component, <code>src/components/Cart.vue</code>, to display the cart’s total items. Within the <code>&lt;script setup()&gt;</code> section, we import the <code>useCartStore()</code> method and call it to get the <code>cart</code> instance. Then in the template, we display the total items in the cart by using the <code>cart.total</code> getter, as seen in <a data-type="xref" href="#cart_component">Example 9-8</a><a data-primary="stores" data-secondary="adding items to cart" data-type="indexterm" id="ix-state-pin5"/><a data-primary="stores" data-secondary="using in cart component" data-type="indexterm" id="id1429"/>.</p>&#13;
<div data-type="example" id="cart_component">&#13;
<h5><span class="label">Example 9-8. </span>Cart component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"cart"</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">span</code> <code class="na">class</code><code class="o">=</code><code class="s">"cart__total"</code><code class="p">&gt;</code>Cart: {{ cart.total }}<code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">script</code> <code class="na">setup</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useCartStore</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'@/stores/cart'</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">cart</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useCartStore</code><code class="p">();</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">style</code> <code class="na">scoped</code><code class="p">&gt;</code>&#13;
<code class="nc">.cart__total</code> <code class="p">{</code>&#13;
    <code class="k">cursor</code><code class="o">:</code> <code class="nb">pointer</code><code class="p">;</code>&#13;
    <code class="k">text-decoration</code><code class="o">:</code> <code class="nb">underline</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nt">&lt;/style&gt;</code></pre></div>&#13;
&#13;
<p>We then see the cart displayed with the initial value of <code>0</code> (<a data-type="xref" href="#figure_08_app_cart">Figure 9-5</a>) when we use the <code>&lt;Cart /&gt;</code> component in our <code>App.vue</code> as in the following code:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cm">&lt;!-- App.vue --&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">header</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>Pizza House<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">Cart</code> <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">header</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">RouterView</code> <code class="p">/&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre>&#13;
&#13;
<figure><div class="figure" id="figure_08_app_cart">&#13;
<img alt="Cart component displayed in the application" src="assets/lvue_0905.png"/>&#13;
<h6><span class="label">Figure 9-5. </span>Cart component displayed in the header of the application</h6>&#13;
</div></figure>&#13;
&#13;
<p>Next, let’s enable adding items to the cart from our pizzas gallery for each pizza rendered by <code>PizzaCard</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Adding Items to the Cart from the Pizzas Gallery" data-type="sect1"><div class="sect1" id="id106">&#13;
<h1>Adding Items to the Cart from the Pizzas Gallery</h1>&#13;
&#13;
<p>In <code>PizzaCard</code>, we will add a button with the <code>click</code> event handler calling the <code>cart.add()</code> action to add the pizza to the cart. The <code>PizzaCard</code> component will look like <a data-type="xref" href="#ch8_pizza_card_component">Example 9-9</a>.</p>&#13;
<div data-type="example" id="ch8_pizza_card_component">&#13;
<h5><span class="label">Example 9-9. </span><code>PizzaCard</code> component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="nt">article</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--details-wrapper"</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">img</code><code> </code><code class="na">:src</code><code class="o">=</code><code class="s">"pizza.image"</code><code> </code><code class="na">:alt</code><code class="o">=</code><code class="s">"pizza.title"</code><code> </code><code class="na">height</code><code class="o">=</code><code class="s">"200"</code><code> </code><code class="na">width</code><code class="o">=</code><code class="s">"300"</code><code> </code><code class="p">/</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>{{ pizza.description }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--inventory"</code><code class="p">&gt;</code><code>&#13;
      </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--inventory-price"</code><code class="p">&gt;</code><code>$ {{ pizza.price }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--add"</code><code> </code><code class="err">@</code><code class="na">click</code><code class="o">=</code><code class="s">"addToCart"</code><code class="p">&gt;</code><code>Add to cart</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO4-1" id="co_state_management_with_pinia_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">article</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">setup</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useCartStore</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@/stores/cart"</code><code class="p">;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="nx">type</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">Pizza</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@/types/Pizza"</code><code class="p">;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="nx">type</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">PropType</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"vue"</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">props</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">defineProps</code><code class="p">(</code><code class="p">{</code><code class="w">&#13;
  </code><code class="nx">pizza</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
    </code><code class="nx">type</code><code class="o">:</code><code class="w"> </code><code class="nb">Object</code><code class="w"> </code><code class="kr">as</code><code class="w"> </code><code class="nx">PropType</code><code class="p">&lt;</code><code class="nt">Pizza</code><code class="p">&gt;</code><code class="p">,</code><code class="w">&#13;
    </code><code class="nx">required</code><code class="o">:</code><code class="w"> </code><code class="kc">true</code><code class="p">,</code><code class="w">&#13;
  </code><code class="p">}</code><code class="p">,</code><code class="w">&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">cart</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useCartStore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO4-2" id="co_state_management_with_pinia_CO4-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">addToCart</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
  </code><code class="nx">cart</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="p">{</code><code class="w"> </code><code class="nx">id</code><code class="o">:</code><code class="w"> </code><code class="nx">props</code><code class="p">.</code><code class="nx">pizza</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code><code class="w"> </code><code class="nx">quantity</code><code class="o">:</code><code class="w"> </code><code class="mf">1</code><code class="w"> </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO4-3" id="co_state_management_with_pinia_CO4-3"><img alt="3" src="assets/3.png"/></a><code class="w">&#13;
</code><code class="p">}</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO4-1" id="callout_state_management_with_pinia_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Add a button to add the pizza to the cart</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO4-2" id="callout_state_management_with_pinia_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Get the <code>cart</code> instance from the <code>useCartStore()</code> method</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO4-3" id="callout_state_management_with_pinia_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Call the <code>cart.add()</code> action to add the pizza to the cart within the <code>addToCart()</code> method</p></dd>&#13;
</dl>&#13;
&#13;
<p>With the previous code, in the browser, we can add a pizza to the cart by clicking on the “Add to cart” button and see the cart’s total items updated (<a data-type="xref" href="#figure_08_cart_total">Figure 9-6</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_total">&#13;
<img alt="Pizza card with adding option and updated cart total" src="assets/lvue_0906.png"/>&#13;
<h6><span class="label">Figure 9-6. </span>Pizza card with adding option and updated cart total</h6>&#13;
</div></figure>&#13;
&#13;
<p>We can also use the <code>cart.items</code> to detect whether the current pizza is already in the cart, and display its status on the pizza card, as in <a data-type="xref" href="#ch8_pizza_card_component_2">Example 9-10</a>.</p>&#13;
<div data-type="example" id="ch8_pizza_card_component_2">&#13;
<h5><span class="label">Example 9-10. </span><code>PizzaCard</code> component with status</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="nt">article</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--details-wrapper"</code><code class="p">&gt;</code><code>&#13;
    </code><code class="cm">&lt;!--...--&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--inventory"</code><code class="p">&gt;</code><code>&#13;
      </code><code class="cm">&lt;!--...--&gt;</code><code>&#13;
      </code><code class="p">&lt;</code><code class="nt">span</code><code> </code><code class="na">v-if</code><code class="o">=</code><code class="s">"isInCart"</code><code class="p">&gt;</code><code>In cart</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO5-1" id="co_state_management_with_pinia_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"pizza--add"</code><code> </code><code class="err">@</code><code class="na">click</code><code class="o">=</code><code class="s">"addToCart"</code><code class="p">&gt;</code><code>&#13;
        Add to cart&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code>&#13;
  </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">article</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">setup</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="c1">//...</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">isInCart</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">computed</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code class="o">:</code><code class="kr">boolean</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO5-2" id="co_state_management_with_pinia_CO5-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
  </code><code class="k">return</code><code class="w"> </code><code class="o">!</code><code class="o">!</code><code class="nx">cart</code><code class="p">.</code><code class="nx">items</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="p">(</code><code class="nx">item</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">item</code><code class="p">.</code><code class="nx">id</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="nx">props</code><code class="p">.</code><code class="nx">pizza</code><code class="p">.</code><code class="nx">id</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>The “In cart” status is displayed on the pizza card if the pizza is already in the cart (<a data-type="xref" href="#figure_08_cart_status">Figure 9-7</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_status">&#13;
<img alt="Pizza card with status" src="assets/lvue_0907.png"/>&#13;
<h6><span class="label">Figure 9-7. </span>Pizza card with status</h6>&#13;
</div></figure>&#13;
&#13;
<p>We have successfully created a cart store and used it in our Pizza House. The <code>Cart</code> and the <code>PizzaCard</code> component now synchronize and communicate through the <code>cart</code> store.</p>&#13;
&#13;
<p>At this point, the <code>Cart</code> component currently displays only the total items in the cart, which, most of the time, is not enough for users to understand what they have added. In the next section, we will improve this experience by displaying the cart items when users click on the cart<a data-primary="" data-startref="ix-state-pin5" data-type="indexterm" id="id1430"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Displaying Cart Items with Actions" data-type="sect1"><div class="sect1" id="id107">&#13;
<h1>Displaying Cart Items with Actions</h1>&#13;
&#13;
<p>In <code>Cart.vue</code>, we will add a section displaying the list of cart items and a <code>showCart</code>&#13;
<span class="keep-together"><code>Details</code></span> variable to control the list’s visibility. We will toggle the visibility of the list when users click on the cart text, as shown in <a data-type="xref" href="#ch8_cart_component_2">Example 9-11</a><a data-primary="stores" data-secondary="displaying cart items with actions" data-type="indexterm" id="ix-state-pin6"/><a data-primary="actions, stores" data-type="indexterm" id="ix-state-pin7"/><a data-primary="toggling" data-secondary="cart" data-type="indexterm" id="ix-state-pin7b"/>.</p>&#13;
<div data-type="example" id="ch8_cart_component_2">&#13;
<h5><span class="label">Example 9-11. </span>Cart component with cart items</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart"</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">span</code><code>&#13;
            </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__total"</code><code>&#13;
            </code><code class="err">@</code><code class="na">click</code><code class="o">=</code><code class="s">"showCartDetails.value = !showCartDetails.value;"</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO5-1" id="co_state_management_with_pinia_CO5-3"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="p">&gt;</code><code>&#13;
            Cart: {{ cart.total }}&#13;
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">ul</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list"</code><code> </code><code class="na">v-show</code><code class="o">=</code><code class="s">"showCartDetails"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO5-2" id="co_state_management_with_pinia_CO5-4"><img alt="2" src="assets/2.png"/></a><code>&#13;
            </code><code class="p">&lt;</code><code class="nt">li</code><code> </code><code class="na">v-for</code><code class="o">=</code><code class="s">"item in cart.items"</code><code> </code><code class="na">:key</code><code class="o">=</code><code class="s">"item.id"</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list-item"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO5-3" id="co_state_management_with_pinia_CO5-5"><img alt="3" src="assets/3.png"/></a><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>Id: {{ item.id }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code> |&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>Quantity: {{ item.quantity }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">li</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">setup</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useCartStore</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'@/stores/cart'</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">cart</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useCartStore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">showCartDetails</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code><code class="p">;</code><code class="w"> </code><a class="co" href="#callout_state_management_with_pinia_CO5-4" id="co_state_management_with_pinia_CO5-6"><img alt="4" src="assets/4.png"/></a><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO5-1" id="callout_state_management_with_pinia_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Toggle the visibility of the cart items list when users click on the cart text</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO5-2" id="callout_state_management_with_pinia_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Display the cart items list when <code>showCartDetails</code> is <code>true</code></p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO5-5" id="callout_state_management_with_pinia_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Loop through the cart items and display the item id and quantity</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO5-6" id="callout_state_management_with_pinia_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Initialize a <code>showCartDetails</code> variable using the <code>ref()</code> method</p></dd>&#13;
</dl>&#13;
&#13;
<p>We also add some CSS styles to the <code>Cart</code> component to position the list to look like a dropdown:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.cart</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="k">position</code><code class="o">:</code><code> </code><code class="nb">relative</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO6-1" id="co_state_management_with_pinia_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="nc">.cart__list</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="k">position</code><code class="o">:</code><code> </code><code class="nb">absolute</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO6-2" id="co_state_management_with_pinia_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
    </code><code class="k">list-style</code><code class="o">:</code><code> </code><code class="nb">none</code><code class="p">;</code><code>&#13;
    </code><code class="k">border</code><code class="o">:</code><code> </code><code class="m">1px</code><code> </code><code class="nb">solid</code><code> </code><code class="m">#e3e0e0</code><code class="p">;</code><code>&#13;
    </code><code class="k">padding</code><code class="o">:</code><code> </code><code class="m">10px</code><code class="p">;</code><code>&#13;
    </code><code class="nb">inset</code><code class="o">-</code><code class="nb">inline</code><code class="o">-</code><code class="n">end</code><code class="o">:</code><code> </code><code class="m">0</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO6-3" id="co_state_management_with_pinia_CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
    </code><code class="k">box-shadow</code><code class="o">:</code><code> </code><code class="m">2px</code><code> </code><code class="m">2px</code><code> </code><code class="m">3px</code><code> </code><code class="m">#e3e0e0</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO6-4" id="co_state_management_with_pinia_CO6-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
    </code><code class="k">background-color</code><code class="o">:</code><code> </code><code class="nb">white</code><code class="p">;</code><code>&#13;
    </code><code class="k">min-width</code><code class="o">:</code><code> </code><code class="m">200px</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO6-1" id="callout_state_management_with_pinia_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Set the position of the <code>.cart</code> container to <code>relative</code> to make the <code>absolute</code> list container float within the container.</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO6-2" id="callout_state_management_with_pinia_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Set the position of the list container to <code>absolute</code> to make it float concerning the <code>relative</code> positioned <code>.cart</code> container.</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO6-3" id="callout_state_management_with_pinia_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Set the <code>inset-inline-end</code> property to <code>0</code> to make the list container float to the right of the <code>.cart</code> container.</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO6-4" id="callout_state_management_with_pinia_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Add box shadow and border to the list container to make it look like a &#13;
<span class="keep-together">dropdown</span>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>When we click on the cart text, the cart items list will be displayed (<a data-type="xref" href="#figure_08_cart_items">Figure 9-8</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_items">&#13;
<img alt="Cart items list displayed when clicking on the cart text" src="assets/lvue_0908.png"/>&#13;
<h6><span class="label">Figure 9-8. </span>Cart items list displayed when clicking on the cart text</h6>&#13;
</div></figure>&#13;
&#13;
<p>But wait, there is a problem. The list displays only the items <code>id</code> and <code>quantity</code>, which needs to be more descriptive for users to understand what item they have added as well as the total cost. We also need to display the item’s name and price. To do so, we can modify the <code>cart.items</code> to keep the item’s title and price, but this would make the <code>cart</code> store’s structure complex and would require additional logic fixes.</p>&#13;
&#13;
<p>Instead, we can create a computed <code>detailedItems</code> list with the help of the pizzas store.</p>&#13;
&#13;
<p>Within the <code>cart.ts</code> store, we will add a <code>detailedItems</code> computed property, which will be the joined array from <code>items</code> and from the <code>pizzasStore.pizzas</code> of the pizzas store, as in <a data-type="xref" href="#ch8_cart_store_2">Example 9-12</a>.</p>&#13;
<div data-type="example" id="ch8_cart_store_2">&#13;
<h5><span class="label">Example 9-12. </span>Cart store with <code>detailedItems</code> computed property</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">defineStore</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'pinia'</code><code class="p">;</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">usePizzasStore</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'./pizzas'</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="kr">export</code><code> </code><code class="kr">const</code><code> </code><code class="nx">useCartStore</code><code> </code><code class="o">=</code><code> </code><code class="nx">defineStore</code><code class="p">(</code><code class="s1">'cart'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="c1">//...&#13;
</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">detailedItems</code><code> </code><code class="o">=</code><code> </code><code class="nx">computed</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">pizzasStore</code><code> </code><code class="o">=</code><code> </code><code class="nx">usePizzasStore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO7-1" id="co_state_management_with_pinia_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
&#13;
        </code><code class="k">return</code><code> </code><code class="nx">items</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">item</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO7-2" id="co_state_management_with_pinia_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
            </code><code class="kr">const</code><code> </code><code class="nx">pizza</code><code> </code><code class="o">=</code><code> </code><code class="nx">pizzasStore</code><code class="p">.</code><code class="nx">pizzas</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code>&#13;
                </code><code class="nx">pizza</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="nx">pizza</code><code class="p">.</code><code class="nx">id</code><code> </code><code class="o">===</code><code> </code><code class="nx">item</code><code class="p">.</code><code class="nx">id</code><code>&#13;
            </code><code class="p">)</code><code>&#13;
&#13;
            </code><code class="kr">const</code><code> </code><code class="nx">pizzaPrice</code><code> </code><code class="o">=</code><code> </code><code class="nx">pizza</code><code class="o">?</code><code class="p">.</code><code class="nx">price</code><code> </code><code class="o">?</code><code> </code><code class="o">+</code><code class="p">(</code><code class="nx">pizza</code><code class="o">?</code><code class="p">.</code><code class="nx">price</code><code class="p">)</code><code> </code><code class="o">:</code><code> </code><code class="mi">0</code><code class="p">;</code><code>&#13;
&#13;
            </code><code class="k">return</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO7-3" id="co_state_management_with_pinia_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
                </code><code class="p">.</code><code class="p">.</code><code class="p">.</code><code class="nx">item</code><code class="p">,</code><code>&#13;
                </code><code class="nx">title</code><code class="o">:</code><code> </code><code class="nx">pizza</code><code class="o">?</code><code class="p">.</code><code class="nx">title</code><code class="p">,</code><code>&#13;
                </code><code class="nx">price</code><code class="o">:</code><code> </code><code class="nx">pizza</code><code class="o">?</code><code class="p">.</code><code class="nx">price</code><code class="p">,</code><code>&#13;
                </code><code class="nx">total</code><code class="o">:</code><code> </code><code class="nx">pizzaPrice</code><code> </code><code class="o">*</code><code> </code><code class="nx">item</code><code class="p">.</code><code class="nx">quantity</code><code>&#13;
            </code><code class="p">}</code><code>&#13;
        </code><code class="p">}</code><code class="p">)</code><code>&#13;
    </code><code class="p">}</code><code class="p">)</code><code>&#13;
&#13;
    </code><code class="k">return</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="c1">//...&#13;
</code><code>        </code><code class="nx">detailedItems</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO7-4" id="co_state_management_with_pinia_CO7-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO7-1" id="callout_state_management_with_pinia_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Get the initial list of pizzas from the store using <code>usePizzaStore</code></p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO7-2" id="callout_state_management_with_pinia_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Filter the relevant pizzas presented in the cart</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO7-3" id="callout_state_management_with_pinia_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Format the cart items’ information to return</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO7-4" id="callout_state_management_with_pinia_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Return the filtered and formatted array <code>detailedItems</code></p></dd>&#13;
</dl>&#13;
&#13;
<p>In <code>Cart.vue</code>, we will replace the <code>cart.items</code> with <code>cart.detailedItems</code> in the <code>v-for</code> loop, as shown in <a data-type="xref" href="#ch8_cart_component_3">Example 9-13</a>.</p>&#13;
<div data-type="example" id="ch8_cart_component_3">&#13;
<h5><span class="label">Example 9-13. </span>Using <code>detailedItems</code> to display more information</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">ul</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list"</code><code> </code><code class="na">v-show</code><code class="o">=</code><code class="s">"showCartDetails"</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">li</code><code>&#13;
        </code><code class="na">v-for</code><code class="o">=</code><code class="s">"(item, index) in cart.detailedItems"</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO8-1" id="co_state_management_with_pinia_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="na">:key</code><code class="o">=</code><code class="s">"item.id"</code><code>&#13;
        </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list-item"</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>{{index + 1}}. {{ item.title }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>${{ item.price }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code> x&#13;
        </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>{{ item.quantity }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>= ${{ item.total }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">li</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">ul</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO8-1" id="callout_state_management_with_pinia_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Iterate the <code>cart.detailedItems</code> array to display cart’s items</p></dd>&#13;
</dl>&#13;
&#13;
<p>Now, when we click on the cart text, the cart items list will display the item’s name, price, quantity, and total cost per item (<a data-type="xref" href="#figure_08_cart_items_2">Figure 9-9</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_items_2">&#13;
<img alt="Cart items list displayed with more information" src="assets/lvue_0909.png"/>&#13;
<h6><span class="label">Figure 9-9. </span>Cart items list displayed with more information</h6>&#13;
</div></figure>&#13;
&#13;
<p>We have successfully displayed the cart items’ details. Next we can add the ability to be able to remove items from the cart<a data-primary="" data-startref="ix-state-pin6" data-type="indexterm" id="id1431"/><a data-primary="" data-startref="ix-state-pin7" data-type="indexterm" id="id1432"/><a data-primary="" data-startref="ix-state-pin7b" data-type="indexterm" id="id1433"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Removing Items from the Cart Store" data-type="sect1"><div class="sect1" id="id108">&#13;
<h1>Removing Items from the Cart Store</h1>&#13;
&#13;
<p>For each item in the cart’s list, we will add a <em>Remove</em> button to be able to remove it from the cart. We will also add a <em>Remove all</em> button to remove all items from the cart. The <code>template</code> section of <code>Cart.vue</code> will look like <a data-type="xref" href="#ch8_cart_component_4">Example 9-14</a><a data-primary="Pinia" data-secondary="stores, removing items from" data-type="indexterm" id="ix-state-pin8"/><a data-primary="stores" data-secondary="removing items from" data-type="indexterm" id="ix-state-pin8a"/>.</p>&#13;
<div data-type="example" id="ch8_cart_component_4">&#13;
<h5><span class="label">Example 9-14. </span>Cart component with Remove and Remove all buttons</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list"</code><code> </code><code class="na">v-show</code><code class="o">=</code><code class="s">"showCartDetails"</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">v-if</code><code class="o">=</code><code class="s">"cart.total === 0"</code><code class="p">&gt;</code><code>No items in cart</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">v-else</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
            </code><code class="p">&lt;</code><code class="nt">li</code><code>&#13;
                </code><code class="na">v-for</code><code class="o">=</code><code class="s">"(item, index) in cart.detailedItems"</code><code>&#13;
                </code><code class="na">:key</code><code class="o">=</code><code class="s">"item.id"</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"cart__list-item"</code><code>&#13;
            </code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>{{index + 1}}. {{ item.title }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>${{ item.price }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code> x&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>{{ item.quantity }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code>= ${{ item.total }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">span</code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="err">@</code><code class="na">click</code><code class="o">=</code><code class="s">"cart.remove(item.id)"</code><code class="p">&gt;</code><code>Remove</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO9-1" id="co_state_management_with_pinia_CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">li</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">ul</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">button</code><code> </code><code class="err">@</code><code class="na">click</code><code class="o">=</code><code class="s">"cart.clear"</code><code class="p">&gt;</code><code>Remove all</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">button</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO9-2" id="co_state_management_with_pinia_CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO9-1" id="callout_state_management_with_pinia_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The Remove button binds to the <code>cart.remove</code> method, which takes the item’s <code>id</code> as an argument</p></dd>&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO9-2" id="callout_state_management_with_pinia_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The Remove all button binds to the <code>cart.clear</code> method</p></dd>&#13;
</dl>&#13;
&#13;
<p>In <code>cart.ts</code>, we will add the <code>remove</code> and <code>clear</code> methods, as shown in <a data-type="xref" href="#ch8_cart_store_3">Example 9-15</a>.</p>&#13;
<div class="pagebreak-before" data-type="example" id="ch8_cart_store_3">&#13;
<h5><span class="label">Example 9-15. </span>Cart store with <code>remove</code> and <code>clear</code> methods</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="c1">//...</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">useCartStore</code> <code class="o">=</code> <code class="nx">defineStore</code><code class="p">(</code><code class="s1">'cart'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">//...</code>&#13;
    <code class="kr">const</code> <code class="nx">remove</code> <code class="o">=</code> <code class="p">(</code><code class="nx">id</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="kr">const</code> <code class="nx">index</code> <code class="o">=</code> <code class="nx">items</code><code class="p">.</code><code class="nx">findIndex</code><code class="p">(</code><code class="nx">item</code> <code class="o">=&gt;</code> <code class="nx">item</code><code class="p">.</code><code class="nx">id</code> <code class="o">===</code> <code class="nx">id</code><code class="p">)</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="nx">index</code> <code class="o">&gt;</code> <code class="o">-</code><code class="mi">1</code><code class="p">)</code> <code class="p">{</code>&#13;
            <code class="nx">items</code><code class="p">.</code><code class="nx">splice</code><code class="p">(</code><code class="nx">index</code><code class="p">,</code> <code class="mi">1</code><code class="p">)</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kr">const</code> <code class="nx">clear</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">items</code><code class="p">.</code><code class="nx">length</code> <code class="o">=</code> <code class="mi">0</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">return</code> <code class="p">{</code>&#13;
        <code class="c1">//...</code>&#13;
        <code class="nx">remove</code><code class="p">,</code>&#13;
        <code class="nx">clear</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">})</code></pre></div>&#13;
&#13;
<p>And that’s it! Vue removes the item from the cart when we click the <em>Remove</em> button. And it will empty the cart when we click the <em>Remove all</em> button; see <a data-type="xref" href="#figure_08_cart_remove">Figure 9-10</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_remove">&#13;
<img alt="Cart items with remove and remove all buttons" src="assets/lvue_0910.png"/>&#13;
<h6><span class="label">Figure 9-10. </span>Cart items with Remove and Remove all buttons</h6>&#13;
</div></figure>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you are building the <code>cart</code> store using Options API, you can use <code>cart.$reset()</code> to reset the store’s state to its initial state. Otherwise, you must manually reset the store’s state, as we did in the <code>clear</code> method<a data-primary="$reset()" data-primary-sortas="reset()" data-type="indexterm" id="id1434"/><a data-primary="stores" data-secondary="resetting state" data-type="indexterm" id="id1435"/>.</p>&#13;
</div>&#13;
&#13;
<p>We can also use the Vue Devtool tab (<a data-type="xref" href="ch01.html#vue_devtools_ch1">“Vue Developer Tools”</a>) in the browser’s Developer Tools to inspect the <code>cart</code> store’s state and getters. The <code>cart</code> and <code>pizzas</code> store will be listed under the <code>Pinia</code> tab (<a data-type="xref" href="#figure_08_cart_devtools">Figure 9-11</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_devtools">&#13;
<img alt="Cart and pizzas stores in Vue Devtools" src="assets/lvue_0911.png"/>&#13;
<h6><span class="label">Figure 9-11. </span>Cart and pizzas stores in Vue Devtools</h6>&#13;
</div></figure>&#13;
&#13;
<p>We have explored how to build stores using Pinia and Composition API. We have also explored different approaches, such as combining stores and using the store’s state in external composables. What about testing Pinia stores? Let’s explore that in the next section<a data-primary="" data-startref="ix-state-pin8" data-type="indexterm" id="id1436"/><a data-primary="" data-startref="ix-state-pin8a" data-type="indexterm" id="id1437"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Unit Testing Pinia Stores" data-type="sect1"><div class="sect1" id="id109">&#13;
<h1>Unit Testing Pinia Stores</h1>&#13;
&#13;
<p>Unit testing a store is similar to regular unit testing a function. For Pinia, before running the actual tests, we need to create a Pinia instance using <code>createPinia</code> and activate it with the <code>setActivePinia()</code> method from the <code>pinia</code> package. <a data-type="xref" href="#ch8_cart_store_test_1">Example 9-16</a> shows how we write the test of adding an item to a cart for our <code>cart</code> store<a data-primary="Pinia" data-secondary="stores, unit testing" data-type="indexterm" id="id1438"/><a data-primary="stores" data-secondary="testing" data-type="indexterm" id="id1439"/><a data-primary="setActivePinia()" data-type="indexterm" id="id1440"/><a data-primary="stores" data-secondary="activating" data-type="indexterm" id="id1441"/><a data-primary="stores" data-secondary="creating" data-type="indexterm" id="id1442"/><a data-primary="testing" data-secondary="stores" data-type="indexterm" id="id1443"/><a data-primary="unit testing" data-secondary="stores" data-type="indexterm" id="id1444"/>.</p>&#13;
<div data-type="example" id="ch8_cart_store_test_1">&#13;
<h5><span class="label">Example 9-16. </span>Cart store test suite for adding items</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">setActivePinia</code><code class="p">,</code><code> </code><code class="nx">createPinia</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'pinia'</code><code class="p">;</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">useCartStore</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'@/stores/cart'</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="nx">describe</code><code class="p">(</code><code class="s1">'Cart store'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="kd">let</code><code> </code><code class="nx">cartStore</code><code class="p">;</code><code>&#13;
&#13;
    </code><code class="nx">beforeEach</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_state_management_with_pinia_CO10-1" id="co_state_management_with_pinia_CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="nx">setActivePinia</code><code class="p">(</code><code class="nx">createPinia</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code>&#13;
        </code><code class="nx">cartStore</code><code> </code><code class="o">=</code><code> </code><code class="nx">useCartStore</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>&#13;
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>&#13;
&#13;
    </code><code class="nx">it</code><code class="p">(</code><code class="s1">'should add item to cart'</code><code class="p">,</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">cartStore</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="p">{</code><code> </code><code class="nx">id</code><code class="o">:</code><code> </code><code class="s1">'1'</code><code class="p">,</code><code> </code><code class="nx">quantity</code><code class="o">:</code><code> </code><code class="mi">1</code><code> </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>&#13;
        </code><code class="nx">expect</code><code class="p">(</code><code class="nx">cartStore</code><code class="p">.</code><code class="nx">items</code><code class="p">)</code><code class="p">.</code><code class="nx">toEqual</code><code class="p">(</code><code class="p">[</code><code class="p">{</code><code> </code><code class="nx">id</code><code class="o">:</code><code> </code><code class="s1">'1'</code><code class="p">,</code><code> </code><code class="nx">quantity</code><code class="o">:</code><code> </code><code class="mi">1</code><code> </code><code class="p">}</code><code class="p">]</code><code class="p">)</code><code class="p">;</code><code>&#13;
    </code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_state_management_with_pinia_CO10-1" id="callout_state_management_with_pinia_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create and activate a new Pinia instance before each test run.</p></dd>&#13;
</dl>&#13;
&#13;
<p>This code follows the common testing syntax supported by Jest and <code>Vitest</code> testing frameworks. We will explore more details on writing and running unit tests in <a data-type="xref" href="ch11.html#vitest_chap10">“Vitest as a Unit Testing Tool”</a>. For now, we will explore how to subscribe to store changes and add side effects to store actions.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Subscribing Side Effects on Store Changes" data-type="sect1"><div class="sect1" id="id110">&#13;
<h1>Subscribing Side Effects on Store Changes</h1>&#13;
&#13;
<p>One significant advantage of Pinia is the ability to extend the store’s functionalities and implement side effects using plugins. With this ability, we can easily subscribe to changes in all the stores or in a specific store to perform additional actions like synchronizing data with the server when needed<a data-primary="Pinia" data-secondary="side effects" data-type="indexterm" id="id1445"/><a data-primary="plugins" data-secondary="store side effects" data-type="indexterm" id="id1446"/><a data-primary="side effects" data-secondary="subscribing stores" data-type="indexterm" id="id1447"/><a data-primary="stores" data-secondary="side effects" data-type="indexterm" id="id1448"/>.</p>&#13;
&#13;
<p>Take the following <code>cartPlugin</code>, for instance:</p>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="c1">//main.ts</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">cartPlugin</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@/plugins/cartPlugin'</code>&#13;
<code class="c1">//...</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">pinia</code> <code class="o">=</code> <code class="nx">createPinia</code><code class="p">()</code>&#13;
<code class="nx">pinia</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">cartPlugin</code><code class="p">)</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">pinia</code><code class="p">)</code>&#13;
<code class="c1">//...</code></pre>&#13;
&#13;
<p>The <code>cartPlugin</code> is a function that receives an object containing a reference to the <code>app</code> instance, the <code>pinia</code> instance, the <code>store</code> instance, and an options object. Vue will trigger this function once for every store in our application. To make sure we are subscribing only to the <code>cart</code> store, we can check the store’s id (see <a data-type="xref" href="#ch8_cart_plugin_1">Example 9-17</a>).</p>&#13;
<div data-type="example" id="ch8_cart_plugin_1">&#13;
<h5><span class="label">Example 9-17. </span>Cart plugin</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="c1">//src/plugins/cartPlugin.ts</code>&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">cartPlugin</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">store</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">store</code><code class="p">.</code><code class="nx">$id</code> <code class="o">===</code> <code class="s1">'cart'</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">//...</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>Then we can subscribe to the cart store changes using the <code>store.$subscribe</code> method, as in <a data-type="xref" href="#ch8_cart_plugin_2">Example 9-18</a>.</p>&#13;
<div data-type="example" id="ch8_cart_plugin_2">&#13;
<h5><span class="label">Example 9-18. </span>Cart plugin subscribing to store changes</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="c1">//src/plugins/cartPlugin.ts</code>&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">cartPlugin</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">store</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">store</code><code class="p">.</code><code class="nx">$id</code> <code class="o">===</code> <code class="s1">'cart'</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">store</code><code class="p">.</code><code class="nx">$subscribe</code><code class="p">((</code><code class="nx">options</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
            <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'cart changed'</code><code class="p">,</code> <code class="nx">options</code><code class="p">)</code>&#13;
        <code class="p">})</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>When we add an item to the cart, the <code>cartPlugin</code> will log the message to the console (<a data-type="xref" href="#figure_08_cart_plugin">Figure 9-12</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_plugin">&#13;
<img alt="Cart plugin logging store changes" src="assets/lvue_0912.png"/>&#13;
<h6><span class="label">Figure 9-12. </span>Log the store changes using plugin</h6>&#13;
</div></figure>&#13;
&#13;
<p>The <code>options</code> object received by the <code>$subscribe</code> method contains the <code>events</code> object, which contains the current event’s type (<code>add</code>), the previous value (<code>oldValue</code>), the current values passed to the event (<code>newValue</code>), the <code>storeId</code>, and the type of the event (<code>direct</code>)<a data-primary="carts" data-secondary="subscribing side effects to" data-type="indexterm" id="id1449"/><a data-primary="$subscribe" data-primary-sortas="subscribe" data-type="indexterm" id="id1450"/>.</p>&#13;
&#13;
<p>Similarly, we can add a side effect to the <code>cart</code> store’s <code>add</code> action using <code>store.$on</code>&#13;
<span class="keep-together"><code>Action</code></span> (<a data-type="xref" href="#ch8_cart_plugin_3">Example 9-19</a>)<a data-primary="actions, stores" data-type="indexterm" id="id1451"/><a data-primary="$onAction" data-primary-sortas="onAction" data-type="indexterm" id="id1452"/>.</p>&#13;
<div data-type="example" id="ch8_cart_plugin_3">&#13;
<h5><span class="label">Example 9-19. </span>Cart plugin subscribing to store’s adding action</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="c1">//src/plugins/cartPlugin.ts</code>&#13;
&#13;
<code class="kr">export</code> <code class="kr">const</code> <code class="nx">cartPlugin</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">store</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">store</code><code class="p">.</code><code class="nx">$id</code> <code class="o">===</code> <code class="s1">'cart'</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">store</code><code class="p">.</code><code class="nx">$onAction</code><code class="p">(({</code> <code class="nx">name</code><code class="p">,</code> <code class="nx">args</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
            <code class="k">if</code> <code class="p">(</code><code class="nx">name</code> <code class="o">===</code> <code class="s1">'add'</code><code class="p">)</code> <code class="p">{</code>&#13;
                <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'item added to cart'</code><code class="p">,</code> <code class="nx">args</code><code class="p">)</code>&#13;
            <code class="p">}</code>&#13;
        <code class="p">})</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>When we add an item to the cart, the <code>cartPlugin</code> will log the new item added to the cart (<a data-type="xref" href="#figure_08_cart_plugin_action">Figure 9-13</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_08_cart_plugin_action">&#13;
<img alt="Cart plugin logging store's adding action" src="assets/lvue_0913.png"/>&#13;
<h6><span class="label">Figure 9-13. </span>Cart plugin logging store’s adding action</h6>&#13;
</div></figure>&#13;
&#13;
<p>With <code>$subscribe</code> and <code>$onAction</code>, we can add side effects such as logging and communicating with external API services such as updating the user’s cart in the server, etc. Additionally, if we have an <code>$onAction</code> and <code>$subscribe</code> in the same plugin, Vue will trigger the <code>$onAction</code> first, followed by the relevant <code>$subscribe</code><a data-primary="logging with side effects" data-type="indexterm" id="id1453"/><a data-primary="order" data-secondary="side effects" data-type="indexterm" id="id1454"/><a data-primary="side effects" data-secondary="order of" data-type="indexterm" id="id1455"/>.</p>&#13;
<div data-type="warning" epub:type="warning"><h1>Using Side Effects</h1>&#13;
<p>It’s crucial to note that Vue triggers every side effect we add to the store. For example, for <a data-type="xref" href="#ch8_cart_plugin_3">Example 9-19</a>, Vue will activate the side effect function for every action executed in the store. Hence, we must be very cautious when adding side effects to the store to avoid performance issues<a data-primary="performance" data-secondary="side effects" data-type="indexterm" id="id1456"/><a data-primary="side effects" data-secondary="performance" data-type="indexterm" id="id1457"/><a data-primary="" data-startref="ix-state-pin2" data-type="indexterm" id="id1458"/><a data-primary="" data-startref="ix-state-pin2a" data-type="indexterm" id="id1459"/><a data-primary="" data-startref="ix-state-pin2b" data-type="indexterm" id="id1460"/><a data-primary="" data-startref="ix-state-pin4" data-type="indexterm" id="id1461"/><a data-primary="" data-startref="ix-state-pin4a" data-type="indexterm" id="id1462"/><a data-primary="" data-startref="ix-state-pin4b" data-type="indexterm" id="id1463"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id364">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>In this chapter, we learned how to use Pinia to build stores and use them in our application with the help of Composition API. We also learned how to destructure and pass the store’s state to external composables with reactivity and how to subscribe to store changes and add side effects to store actions. You are now ready to create a complete data flow from building a centralized data store, using it in different components, and connecting between components through the store.</p>&#13;
&#13;
<p>The next chapter will explore a different aspect of Vue’s capabilities in enhancing the user experience: adding animations and transitions to our application and components.</p>&#13;
</div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="id1395"><sup><a href="ch09.html#id1395-marker">1</a></sup> Vuex was previously the official state management for Vue applications.</p></div></div></section></body></html>