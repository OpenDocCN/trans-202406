<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 13. Risky Behavior: Exception Handling"><div class="chapter" id="risky_behavior_exception_handling">
<h1><span class="label">Chapter 13. </span>Risky Behavior: Exception Handling</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0421-01.png" alt="image" width="623" height="560"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exception handling" id="idm46038390535488"/><a data-type="indexterm" data-primary="JavaSound API" id="idm46038390534592"/><strong>Stuff happens. The file isn’t there. The server is down.</strong> No matter how good a programmer you are, you can’t control everything. Things can go wrong. <em>Very</em> wrong. When you write a risky method, you need code to handle the bad things that might happen. But how do you <em>know</em> when a method is risky? And where do you put the code to <em>handle</em> the <em><strong>exceptional</strong></em> situation? So far in this book, we haven’t <em>really</em> taken any risks. We’ve certainly had things go wrong at runtime, but the problems were mostly flaws in our own code. Bugs. And those we should fix at development time. No, the problem-handling code we’re talking about here is for code that you <em>can’t</em> guarantee will work at runtime. Code that expects the file to be in the right directory, the server to be running, or the Thread to stay asleep. And we have to do this <em>now</em>. Because in <em>this</em> chapter, we’re going to build something that uses the risky JavaSound API. We’re going to build a MIDI Music Player.</p>
<section data-type="sect1" data-pdf-bookmark="Let’s make a Music Machine"><div class="sect1" id="letapostrophes_make_a_music_machine">
<h1>Let’s make a Music Machine</h1>
<p><a data-type="indexterm" data-primary="BeatBox app" id="idm46038390661888"/>Over the next three chapters, we’ll build a few different sound applications, including a BeatBox Drum Machine. In fact, before the book is done, we’ll have a multiplayer version so you can send your drum loops to another player, kind of like sharing over social media. You’re going to write the whole thing, although you can choose to use Ready-Bake Code for the GUI parts. OK, so not every IT department is looking for a new BeatBox server, but we’re doing this to learn more about Java. Building a BeatBox is just a way to have fun <em>while</em> we’re learning Java.</p>
<section data-type="sect2" data-pdf-bookmark="The finished BeatBox looks something like this:"><div class="sect2" id="the_finished_beatbox_looks_something_lik">
<h2>The finished BeatBox looks something like this:</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0422-01.png" alt="image" width="1039" height="1047"/>
<h6/>
</div></figure>
<p>Notice the check marks in the boxes for each of the 16 “beats.” For example, on beat 1 (of 16) the Bass drum and the Maracas will play, on beat 2 nothing, and on beat 3 the Maracas and Closed Hi-Hat...you get the idea. When you hit Start, it plays your pattern in a loop until you hit Stop. At any time, you can “capture” one of your own patterns by sending it to the BeatBox server (which means any other players can listen to it). You can also load any of the incoming patterns by clicking on the message that goes with it.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ll start with the basics"><div class="sect1" id="weapostrophell_start_with_the_basics">
<h1>We’ll start with the basics</h1>
<p><a data-type="indexterm" data-primary="BeatBox app" data-secondary="MIDI Music Player" id="idm46038395341440"/><a data-type="indexterm" data-primary="JavaSound API" id="idm46038395339808"/><a data-type="indexterm" data-primary="MIDI Music Player" id="idm46038395338240"/>Obviously we’ve got a few things to learn before the whole program is finished, including how to build a GUI, how to <em>connect</em> to another machine via networking, and a little I/O so we can <em>send</em> something to the other machine.</p>
<p>Oh yeah, and the JavaSound API. <em>That’s</em> where we’ll start in this chapter. For now, you can forget the GUI, forget the networking and the I/O, and focus only on getting some MIDI-generated sound to come out of your computer. And don’t worry if you don’t know a thing about MIDI or a thing about reading or making music. Everything you need to learn is covered here. You can almost smell the record deal.</p>
<section data-type="sect2" data-pdf-bookmark="The JavaSound API"><div class="sect2" id="the_javasound_api">
<h2>The JavaSound API</h2>
<p>JavaSound is a collection of classes and interfaces added to Java way back in version 1.3. These aren’t special add-ons; they’re part of the standard Java SE class library. JavaSound is split into two parts: MIDI and Sampled. We use only MIDI in this book. MIDI stands for Musical Instrument Digital Interface, and is a standard protocol for getting different kinds of electronic sound equipment to communicate. But for our BeatBox app, you can think of MIDI as <em>a kind of sheet music</em> that you feed into some device like a high-tech “player piano.” In other words, MIDI data doesn’t actually include any <em>sound</em>, but it does include the <em>instructions</em> that a MIDI-reading instrument can play back. Or for another analogy, you can think of a MIDI file like an HTML document, and the instrument that renders the MIDI file (i.e., <em>plays</em> it) is like the web browser.</p>
<p>MIDI data says <em>what</em> to do (play middle C, and here’s how hard to hit it, and here’s how long to hold it, etc.), but it doesn’t say anything at all about the actual <em>sound</em> you hear. MIDI doesn’t know how to make a flute, piano, or Jimi Hendrix guitar sound. For the actual sound, we need an instrument (a MIDI device) that can read and play a MIDI file. But the device is usually more like an <em>entire band or orchestra</em> of instruments. And that instrument might be a physical device, like a keyboard, or it could even be an instrument built entirely in software, living in your computer.</p>
<p>For our BeatBox, we use only the built-in, software-only instrument that you get with Java. It’s called a <em>synthesizer</em> (some folks refer to it as a <em>software synth</em>) because it <em>creates</em> sound. Sound that you <em>hear</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0423-01.png" alt="image" width="485" height="864"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="First we need a Sequencer"><div class="sect1" id="first_we_need_a_sequencer">
<h1>First we need a Sequencer</h1>
<p><a data-type="indexterm" data-primary="classes" data-secondary="Sequencer" id="idm46038390478896"/><a data-type="indexterm" data-primary="Sequencer class" id="idm46038390477920"/>Before we can get any sound to play, we need a Sequencer object. The sequencer is the object that takes all the MIDI data and sends it to the right instruments. It’s the thing that <em>plays</em> the music. A sequencer can do a lot of different things, but in this book, we’re using it strictly as a playback device. It’s like a device that streams music, but with a few added features. The Sequencer class is in the javax.sound.midi package. So let’s start by making sure we can make (or get) a Sequencer object.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0424-01.png" alt="image" width="988" height="480"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Something’s wrong!"><div class="sect2" id="somethingapostrophes_wrongexclamation_ma">
<h2>Something’s wrong!</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0424-02.png" alt="image" width="813" height="448"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when a method you want to call (probably in a class you didn’t write) is risky?"><div class="sect1" id="what_happens_when_a_method_you_want_to_c">
<h1>What happens when a method you want to call (probably in a class you didn’t write) is risky?</h1>
<ul style="list-style-type:none">
<li><p><a data-type="indexterm" data-primary="exceptions" data-secondary="methods" id="idm46038390466768"/><a data-type="indexterm" data-primary="methods" data-secondary="exception handling" id="idm46038390466128"/><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <span style="color:#636466;"><strong>Let’s say you want to call a method in a class that you didn’t write.</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-01.png" alt="image" width="535" height="226"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <span style="color:#636466;"><strong>That method does something risky, something that might not work at runtime.</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-02.png" alt="image" width="380" height="131"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <span style="color:#636466;"><strong>You need to <em>know</em> that the method you’re calling is risky.</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-03.png" alt="image" width="528" height="359"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> <span style="color:#636466;"><strong>You then write code that can handle the failure if it <em>does</em> happen. You need to be prepared, just in case.</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-04.png" alt="image" width="300" height="310"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Methods in Java use exceptions to tell the calling code, “Something Bad Happened. I failed.”"><div class="sect1" id="methods_in_java_use_exceptions_to_tell_t">
<h1>Methods in Java use <em>exceptions</em> to tell the calling code, “Something Bad Happened. I failed.”</h1>
<p><a data-type="indexterm" data-primary="declarations" id="idm46038390444496"/><a data-type="indexterm" data-primary="declarations" data-secondary="exceptions" id="idm46038390443760"/><a data-type="indexterm" data-primary="exception handling" id="idm46038390442656"/><a data-type="indexterm" data-primary="getSequencer()" id="idm46038390441824"/><a data-type="indexterm" data-primary="throw clause, exceptions" id="idm46038390440992"/>Java’s exception-handling mechanism is a clean, well-lighted way to handle “exceptional situations” that pop up at runtime; it lets you put all your error-handling code in one easy-to-read place. It’s based on the method you’re calling <em>telling you</em> it’s risky (i.e., that the method <em>might</em> generate an exception), so that you can write code to deal with that possibility. If you <em>know</em> you might get an exception when you call a particular method, you can be <em>prepared</em> for—possibly even <em>recover</em> from—the problem that caused the exception.</p>
<p>So, how does a method tell you it might throw an exception? You find a <code><strong>throws</strong></code> clause in the risky method’s declaration.</p>
<p><strong>The</strong> <code><strong>getSequencer ()</strong></code> <strong>method takes a risk. It can fail at runtime. So it must “declare” the risk <em>you</em> take when you call it.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0426-01.png" alt="image" width="1003" height="649"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;"><strong>Risky methods that could fail at runtime declare the exceptions that might happen using “throws SomeKindOfException” on their method declaration.</strong></span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The compiler needs to know that YOU know you’re calling a risky method"><div class="sect1" id="the_compiler_needs_to_know_that_you_know">
<h1>The compiler needs to know that YOU know you’re calling a risky method</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0427-01.png" alt="image" width="999" height="1039"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="catch blocks" data-see="try/catch blocks" id="idm46038390428608"/><a data-type="indexterm" data-primary="exception handling" data-secondary="try/catch blocks" data-see="try/catch blocks" id="idm46038390427408"/><a data-type="indexterm" data-primary="exceptions" data-secondary="catching" data-see="try/catch blocks" id="idm46038390426032"/><a data-type="indexterm" data-primary="try/catch blocks" id="idm46038390424656"/>If you wrap the risky code in something called a <strong>try/catch</strong>, the compiler will relax.</p>
<p>A try/catch block tells the compiler that you <em>know</em> an exceptional thing could happen in the method you’re calling, and that you’re prepared to handle it. That compiler doesn’t care <em>how</em> you handle it; it cares only that you say you’re taking care of it.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0428-01.png" alt="image" width="589" height="646"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="An exception is an object... of type Exception"><div class="sect1" id="an_exception_is_an_objecthellip_of_type">
<h1>An exception is an object... of type Exception</h1>
<p><a data-type="indexterm" data-primary="arguments" data-secondary="catch" id="idm46038390431984"/><a data-type="indexterm" data-primary="catch argument" id="idm46038390417248"/>This is fortunate, because it would be much harder to remember if exceptions were of type Broccoli.</p>
<p>Remember from the polymorphism (<a data-type="xref" href="ch07.xhtml#better_living_in_objectville_inheritance">Chapter 7</a> and <a data-type="xref" href="ch08.xhtml#serious_polymorphism_interfaces_and_abst">Chapter 8</a>) that an object of type Exception <em>can</em> be an instance of any <em>subclass</em> of Exception.</p>
<p>Because an <em>Exception</em> is an object, what you <em>catch</em> is an object. In the following code, the <strong><code>catch</code></strong> argument is declared as type Exception, and the parameter reference variable is <em>ex</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0428-03.png" alt="image" width="475" height="276"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0428-02.png" alt="image" width="485" height="483"/>
<h6/>
</div></figure>
<p>What you write in a catch block depends on the exception that was thrown. For example, if a server is down, you might use the catch block to try another server. If the file isn’t there, you might ask the user for help finding it.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="If it’s your code that catches the exception, then whose code throws it?"><div class="sect1" id="if_itapostrophes_your_code_that_catches">
<h1>If it’s your code that <u>catches</u> the exception, then whose code <u>throws</u> it?</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0429-01.png" alt="image" width="333" height="222"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exceptions" data-secondary="throwing" id="idm46038390406192"/><a data-type="indexterm" data-primary="printStackTrace()" id="idm46038390405136"/><a data-type="indexterm" data-primary="throw clause, exceptions" id="idm46038390404304"/>You’ll spend much more of your Java coding time <em>handling</em> exceptions than you’ll spend <em>creating</em> and <em>throwing</em> them yourself. For now, just know that when your code <em>calls</em> a risky method—a method that declares an exception—it’s the risky method that <em>throws</em> the exception back to <em>you</em>, the caller.</p>
<p>In reality, it might be you who wrote both classes. It really doesn’t matter who writes the code...what matters is knowing which method <em>throws</em> the exception and which method <em>catches</em> it.</p>
<p>When somebody writes code that could throw an exception, they must <em>declare</em> the exception.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <span style="color:#636466;"><strong>Risky, exception-throwing code:</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0429-02.png" alt="image" width="798" height="322"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <span style="color:#636466;"><strong>Your code that <em>calls</em> the risky method:</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0429-03.png" alt="image" width="899" height="238"/>
<h6/>
</div></figure>
</li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000037">
<p>One method will <u>catch</u> what another method <u>throws</u>. An exception is always thrown back to the caller.</p>
<p>The method that throws has to <u>declare</u> that it might throw the exception.</p>
</div></aside>
<p><a data-type="indexterm" data-primary="checked versus runtime exceptions" id="idm46038390384784"/><a data-type="indexterm" data-primary="exceptions" data-secondary="checked versus runtime" id="idm46038390383792"/><a data-type="indexterm" data-primary="RuntimeExceptions" id="idm46038390382688"/><a data-type="indexterm" data-primary="runtime versus checked exceptions" id="idm46038390381856"/><span style="color:#636466;"><strong>The compiler checks for everything except RuntimeExceptions.</strong></span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0430-01.png" alt="image" width="973" height="603"/>
<h6/>
</div></figure>
<p><span style="color:#636466;"><strong>The compiler guarantees:</strong></span></p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> If you <em>throw</em> an exception in your code, you <em>must</em> declare it using the <em>throws</em> keyword in your method declaration.</p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> If you <em>call</em> a method that throws an exception (in other words, a method that <em>declares</em> it throws an exception), you must <em>acknowledge</em> that you’re aware of the exception possibility. One way to satisfy the compiler is to wrap the call in a try/catch. (There’s a second way we’ll look at a little later in this chapter.)</p></li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00036">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Wait just a minute! How come this is the FIRST time we’ve had to try/catch an Exception? What about the exceptions I’ve already gotten like NullPointerException and the exception for DivideByZero? I even got a NumberFormatException from the Integer.parseInt() method. How come we didn’t have to catch those?</strong></p>
<p><strong>A:</strong> The compiler cares about all subclasses of Exception, <em>unless</em> they are a special type, RuntimeException. Any exception class that extends RuntimeException gets a free pass. RuntimeExceptions can be thrown anywhere, with or without throws declarations or try/catch blocks. The compiler doesn’t bother checking whether a method declares that it throws a RuntimeException, or whether the caller acknowledges that they might get that exception at runtime.</p>
<p><strong>Q: I’ll bite. WHY doesn’t the compiler care about those runtime exceptions? Aren’t they just as likely to bring the whole show to a stop?</strong></p>
<p><strong>A:</strong> Most RuntimeExceptions come from a problem in your code logic, rather than a condition that fails at runtime in ways that you cannot predict or prevent. You <em>cannot</em> guarantee the file is there. You <em>cannot</em> guarantee the server is up. But you <em>can</em> make sure your code doesn’t index off the end of an array (that’s what the .length attribute is for).</p>
<p>You WANT RuntimeExceptions to happen at development and testing time. You don’t want to code in a try/catch, for example, and have the overhead that goes with it, to catch something that shouldn’t happen in the first place.</p>
<p>A try/catch is for handling exceptional situations, not flaws in your code. Use your catch blocks to try to recover from situations you can’t guarantee will succeed. Or at the very least, print out a message to the user and a stack trace so somebody can figure out what happened.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00013">
<h5>Bullet Points</h5>
<ul>
<li><p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038390951840"/>A method can throw an exception when something fails at runtime.</p></li>
<li><p>An exception is always an object of type Exception. (This, as you remember from the polymorphism chapters (<a data-type="xref" href="ch07.xhtml#better_living_in_objectville_inheritance">Chapter 7</a> and <a data-type="xref" href="ch08.xhtml#serious_polymorphism_interfaces_and_abst">Chapter 8</a>), means the object is from a class that has Exception somewhere up its inheritance tree.)</p></li>
<li><p>The compiler does NOT pay attention to exceptions that are of type <strong>RuntimeException</strong>. A RuntimeException does not have to be declared or wrapped in a try/catch (although you’re free to do either or both of those things).</p></li>
<li><p>All Exceptions the compiler cares about are called “checked exceptions,” which really means <em>compiler</em>-checked exceptions. Only RuntimeExceptions are excluded from compiler checking. All other exceptions must be acknowledged in your code.</p></li>
<li><p>A method throws an exception with the keyword <strong><code>throw</code></strong>, followed by a new exception object:</p>
<pre data-type="programlisting"><strong>throw new NoCaffeineException();</strong></pre></li>
<li><p>Methods that <em>might</em> throw a checked exception <em><strong>must</strong></em> announce it with a <code><strong>throws SomeException</strong></code> declaration.</p></li>
<li><p>If your code calls a checked-exception-throwing method, it must reassure the compiler that precautions have been taken.</p></li>
<li><p>If you’re prepared to handle the exception, wrap the call in a try/catch, and put your exception handling/recovery code in the catch block.</p></li>
<li><p>If you’re not prepared to handle the exception, you can still make the compiler happy by officially “ducking” the exception. We’ll talk about ducking a little later in this chapter.</p></li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="metacognitive_tip-id00002a">
<h5>Metacognitive Tip</h5>
<p>If you’re trying to learn something new, make that the <em>last</em> thing you try to learn before going to sleep. So, once you put this book down (assuming you can tear yourself away from it), don’t read anything else more challenging than the back of a Cheerios™ box. Your brain needs time to process what you’ve read and learned. That could take a few <em>hours</em>. If you try to shove something new in right on top of your Java, some of the Java might not “stick.”</p>
<p>Of course, this doesn’t rule out learning a physical skill. Working on your latest Ballroom KickBoxing routine probably won’t affect your Java learning.</p>
<p>For the best results, read this book (or at least look at the pictures) right before going to sleep.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0431-01.png" alt="image" width="149" height="192"/>
<h6/>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00032">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<table class="border">
<thead>
<tr>
<th/>
<th>Things you want to do</th>
<th>What might go wrong</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Which of these do you think might throw an exception that the compiler should care about? These are things that you CAN’T control in your code. We did the first one.</strong><br/>(Because it was the easiest.)</td>
<td><strong><u>✓</u></strong> Connect to a remote server<br/>__ Access an array beyond its length<br/>__ Display a window on the screen<br/>__ Retrieve data from a database<br/>__ See if a text file is where you <em>think</em> it is<br/>__ Create a new file<br/>__ Read a character from the command line</td>
<td><span style="color:#636466;"><u>The server is down</u></span><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong><br/><strong>__________________________________</strong></td>
</tr>
</tbody>
</table>
</div></aside>
<p><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Yours to solve.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Flow control in try/catch blocks"><div class="sect1" id="flow_control_in_trysoliduscatch_blocks">
<h1>Flow control in try/catch blocks</h1>
<p><a data-type="indexterm" data-primary="exception handling" data-secondary="flow control" id="idm46038390314512"/><a data-type="indexterm" data-primary="flow control, exceptions" id="idm46038390313536"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="flow control" id="idm46038390312800"/>When you call a risky method, one of two things can happen. The risky method either succeeds, and the try block completes, or the risky method throws an exception back to your calling method.</p>
<p><strong>If the try succeeds</strong></p>
<p><strong>(doRiskyThing() does <em>not</em> throw an exception)</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0432-01.png" alt="image" width="940" height="251"/>
<h6/>
</div></figure>
<p><strong>If the try fails</strong></p>
<p><strong>(because doRiskyThing() <em>does</em> throw an exception)</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0432-02.png" alt="image" width="1028" height="313"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Finally: for the things you want to do no matter what"><div class="sect1" id="finally_for_the_things_you_want_to_do_no">
<h1>Finally: for the things you want to do no matter what</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0433-01.png" alt="image" width="543" height="618"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exception handling" data-secondary="finally block" id="idm46038390302000"/><a data-type="indexterm" data-primary="finally block" id="idm46038390300608"/>If you try to cook something, you start by turning on the oven.</p>
<p>If the thing you try is a complete <strong>failure, <em>you have to turn off the oven.</em></strong></p>
<p>If the thing you try <strong>succeeds, <em>you have to turn off the oven.</em></strong></p>
<p><strong><em>You have to turn off the oven no matter what!</em></strong></p>
<p><strong>A finally block is where you put code that must run <em>regardless</em> of an exception.</strong></p>
<pre data-type="programlisting"><strong>try {</strong>
  turnOvenOn();
  x.bake();
<strong>} catch</strong> (BakingException e) {
  e.printStackTrace();
<strong>} finally {</strong>
  turnOvenOff();
<strong>}</strong></pre>
<p>Without finally, you have to put the turnOvenOff() in <em>both</em> the try and the catch because <strong><em>you have to turn off the oven no matter what.</em></strong> A finally block lets you put all your important cleanup code­ in <em>one</em> place instead of duplicating it like this:</p>
<pre data-type="programlisting"><strong>try {</strong>
  turnOvenOn();
  x.bake();
  turnOvenOff();
<strong>} catch</strong> (BakingException e) <strong>{</strong>
  e.printStackTrace();
  turnOvenOff();
<strong>}</strong></pre>
<p><span style="color:#636466;"><strong>If the try block fails (an exception),</strong></span> flow control immediately moves to the catch block. When the catch block completes, the finally block runs. When the finally block completes, the rest of the method continues on.</p>
<p><span style="color:#636466;"><strong>If the try block succeeds (<em>no</em> exception),</strong></span> flow control skips over the catch block and moves to the finally block. When the finally block completes, the rest of the method continues on.</p>
<p><span style="color:#636466;"><strong>If the try or catch block has a return statement, finally will still run!</strong></span> Flow jumps to the finally, then back to the return.</p>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Flow Control"><div class="sect1" id="flow_control">
<h1>Flow Control</h1>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038390287376"/><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Yours to solve.</strong></p>
<p><strong>Look at the code to the left. What do you think the output of this program would be? What do you think it would be if the third line of the program were changed to</strong> <code>String test = "yes";</code><strong>? Assume ScaryException extends Exception.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0434-01.png" alt="image" width="997" height="425"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0434-02.png" alt="image" width="995" height="389"/>
<h6/>
</div></figure>
<p>When test = “no”: start try - start risky - end risky - end try - finally - end of main</p>
<p>When test = “yes”: start try - start risky - scary exception - finally - end of main</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Did we mention that a method can throw more than one exception?"><div class="sect1" id="did_we_mention_that_a_method_can_throw_m">
<h1>Did we mention that a method can throw more than one exception?</h1>
<p><a data-type="indexterm" data-primary="exceptions" data-secondary="multiple" id="idm46038390269216"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="catching multiple exceptions" id="idm46038390268576"/>A method can throw multiple exceptions if it darn well needs to. But a method’s declaration must declare <em>all</em> the checked exceptions it can throw (although if two or more exceptions have a common superclass, the method can declare just the superclass).</p>
<section data-type="sect2" data-pdf-bookmark="Catching multiple exceptions"><div class="sect2" id="catching_multiple_exceptions">
<h2>Catching multiple exceptions</h2>
<p>The compiler will make sure that you’ve handled <em>all</em> the checked exceptions thrown by the method you’re calling. Stack the <em>catch</em> blocks under the <em>try</em>, one after the other. Sometimes the order in which you stack the catch blocks matters, but we’ll get to that a little later.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0435-01.png" alt="image" width="906" height="258"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0435-02.png" alt="image" width="821" height="365"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exceptions are polymorphic"><div class="sect1" id="exceptions_are_polymorphic">
<h1>Exceptions are polymorphic</h1>
<p><a data-type="indexterm" data-primary="exceptions" data-secondary="declaring" id="idm46038390258288"/><a data-type="indexterm" data-primary="exceptions" data-secondary="as polymorphic" id="idm46038390257200"/><a data-type="indexterm" data-primary="polymorphism" data-secondary="and exceptions" id="idm46038390256096"/><a data-type="indexterm" data-primary="superclass" data-secondary="in exception declaration and catch" id="idm46038390254992"/><a data-type="indexterm" data-primary="throw clause, exceptions" id="idm46038390253920"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="as polymorphic" id="idm46038390253120"/>Exceptions are objects, remember. There’s nothing all that special about one, except that it is <em>a thing that can be <strong>thrown</strong></em>. So like all good objects, Exceptions can be referred to polymorphically. A LingerieException <em>object</em>, for example, could be assigned to a ClothingException <em>reference</em>. A PantsException could be assigned to an Exception reference. You get the idea. The benefit for exceptions is that a method doesn’t have to explicitly declare every possible exception it might throw; it can declare a superclass of the exceptions. Same thing with catch blocks—you don’t have to write a catch for each possible exception as long as the catch (or catches) you have can handle any exception thrown.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0436-01.png" alt="image" width="438" height="673"/>
<h6/>
</div></figure>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>You can DECLARE exceptions using a superclass of the exceptions you throw.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0436-02.png" alt="image" width="583" height="313"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>You can CATCH exceptions using a superclass of the exception thrown.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0436-03.png" alt="image" width="1471" height="359"/>
<h6/>
</div></figure>
</li>
</ul>
<p><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="order of multiple" id="idm46038390231088"/><strong>Just because you CAN catch everything with one big super polymorphic catch, doesn’t always mean you SHOULD.</strong></p>
<p>You <em>could</em> write your exception-handling code so that you specify only <em>one</em> catch block, using the superclass Exception in the catch clause, so that you’ll be able to catch <em>any</em> exception that might be thrown.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0437-01.png" alt="image" width="701" height="132"/>
<h6/>
</div></figure>
<p><strong>Write a different catch block for each exception that you need to handle uniquely.</strong></p>
<p>For example, if your code deals with (or recovers from) a TeeShirtException differently than it handles a LingerieException, write a catch block for each. But if you treat all other types of ClothingException in the same way, then add a ClothingException catch to handle the rest.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0437-02.png" alt="image" width="749" height="424"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Multiple catch blocks must be ordered from smallest to biggest"><div class="sect1" id="multiple_catch_blocks_must_be_ordered_fr">
<h1>Multiple catch blocks must be ordered from smallest to biggest</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0438-01.png" alt="image" width="448" height="149"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0438-02.png" alt="image" width="430" height="205"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0438-03.png" alt="image" width="483" height="240"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0438-04.png" alt="image" width="497" height="551"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exception handling" data-secondary="multiple exceptions" id="idm46038390214016"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="catching multiple exceptions" id="idm46038390212816"/>The higher up the inheritance tree, the bigger the catch “basket.” As you move down the inheritance tree, toward more and more specialized Exception classes, the catch “basket” is smaller. It’s just plain old polymorphism.</p>
<p>A ShirtException catch is big enough to take a TeeShirtException or a DressShirtException (and any future subclass of anything that extends ShirtException). A ClothingException is even bigger (i.e., there are more things that can be referenced using a ClothingException type). It can take an exception of type ClothingException (duh) and any ClothingException subclasses: PantsException, UniformException, LingerieException, and ShirtException. The mother of all catch arguments is type <strong>Exception</strong>; it will catch <em>any</em> exception, including runtime (unchecked) exceptions, so you probably won’t use it outside of testing.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="You can’t put bigger baskets above smaller baskets"><div class="sect1" id="you_canapostrophet_put_bigger_baskets_ab">
<h1>You can’t put bigger baskets above smaller baskets</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0439-02.png" alt="image" width="490" height="653"/>
<h6/>
</div></figure>
<p>Well, you <em>can,</em> but it won’t compile. Catch blocks are not like overloaded methods where the best match is picked. With catch blocks, the JVM simply starts at the first one and works its way down until it finds a catch that’s broad enough (in other words, high enough on the inheritance tree) to handle the exception. If your first catch block is <code><strong>catch(Exception ex)</strong></code>, the compiler knows there’s no point in adding any others—they’ll never be reached.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0439-01.png" alt="image" width="441" height="678"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">Siblings (exceptions at the same level of the hierarchy tree, like PantsException and LingerieException) can be in any order, because they can’t catch one another’s exceptions.</span></p>
</div>
<p>You could put ShirtException above LingerieException, and nobody would mind. Because even though ShirtException is a bigger (broader) type because it can catch other classes (its own subclasses), ShirtException can’t catch a LingerieException, so there’s no problem.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00034">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038391677616"/>Assume the try/catch block here is legally coded. Your task is to draw two different class diagrams that can accurately reflect the Exception classes. In other words, what class inheritance structures would make the try/catch blocks in the sample code legal?</p>
<pre data-type="programlisting"><strong>try {</strong>
  <strong>x.doRisky();</strong>
<strong>} catch(AlphaEx a) {</strong>
  // recovery from AlphaEx
<strong>} catch(BetaEx b) {</strong>
  // recovery from BetaEx
<strong>} catch(GammaEx c) {</strong>
  // recovery from GammaEx
<strong>} catch(DeltaEx d) {</strong>
  // recovery from DeltaEx
<strong>}</strong></pre>
<hr/>
<p>Your task is to create two different <em>legal</em> try/catch structures (similar to the one above left) to accurately represent the class diagram shown on the left. Assume ALL of these exceptions might be thrown by the method with the try block.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0440-02.png" alt="image" width="393" height="546"/>
<h6/>
</div></figure>
</div></aside>
<p><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Both answers in <a data-type="xref" href="#sharpen_your_pencil-id00035">“Sharpen your pencil”</a>.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="When you don’t want to handle an exception..."><div class="sect1" id="when_you_donapostrophet_want_to_handle_a">
<h1>When you don’t want to handle an exception...</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0441-02.png" alt="image" width="461" height="687"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0441-01.png" alt="image" width="497" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="declarations" data-secondary="exceptions" id="idm46038390196752"/><a data-type="indexterm" data-primary="ducking exceptions" id="idm46038390195552"/><a data-type="indexterm" data-primary="exceptions" data-secondary="declaring" id="idm46038390194720"/><a data-type="indexterm" data-primary="exceptions" data-secondary="ducking" id="idm46038390193616"/><a data-type="indexterm" data-primary="methods" data-secondary="declaring or ducking" id="idm46038390192512"/><strong>If you don’t want to handle an exception, you can</strong> <span style="color:#636466;"><strong>duck</strong></span> <strong>it by</strong> <span style="color:#636466;"><strong>declaring</strong></span> <strong>it.</strong></p>
<p>When you call a risky method, the compiler needs you to acknowledge it. Most of the time, that means wrapping the risky call in a try/catch. But you have another alternative: simply duck it and let the method that called you catch the exception.</p>
<p>It’s easy—all you have to do is <em>declare</em> that <em>you</em> throw the exceptions. Even though, technically, <em>you</em> aren’t the one doing the throwing, it doesn’t matter. You’re still the one letting the exception whiz right on by.</p>
<p>But if you duck an exception, then you don’t have a try/catch, so what happens when the risky method (doLaundry()) <em>does</em> throw the exception?</p>
<p>When a method throws an exception, that method is popped off the stack immediately, and the exception is thrown to the next method down the stack—the <em>caller</em>. But if the <em>caller</em> is a <em>ducker</em>, then there’s no catch for it, so the <em>caller</em> pops off the stack immediately, and the exception is thrown to the next method and so on...where does it end? You’ll see a little later.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0441-03.png" alt="image" width="972" height="218"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Ducking (by declaring) only delays the inevitable"><div class="sect1" id="ducking_left_parenthesisby_declaringrigh">
<h1>Ducking (by declaring) only delays the inevitable</h1>
<p><a data-type="indexterm" data-primary="main()" data-secondary="ducking exception" id="idm46038390179312"/><strong>Sooner or later, <em>somebody</em> has to deal with it. But what if main() ducks the exception?</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0442-01.png" alt="image" width="928" height="324"/>
<h6/>
</div></figure>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1circle.png" alt="Images" width="20" height="20"/></span> doLaundry() throws a ClothingException</p>
<figure class="informal"><div class="figure">
<img src="Images/f0442-02.png" alt="image" width="259" height="138"/>
<h6/>
</div></figure>
<pre data-type="programlisting">main() calls foo()

foo() calls doLaundry()

doLaundry() is
running and throws a
ClothingException</pre></li>
<li><p><span class="inlineimage"><img src="Images/2circle.png" alt="Images" width="23" height="23"/></span> foo() ducks the exception</p>
<figure class="informal"><div class="figure">
<img src="Images/f0442-03.png" alt="image" width="265" height="99"/>
<h6/>
</div></figure>
<pre data-type="programlisting">doLaundry() pops off the
stack immediately, and
the exception is thrown
back to foo().

But foo() doesn’t have a
try/catch, so...</pre></li>
<li><p><span class="inlineimage"><img src="Images/3circle.png" alt="Images" width="23" height="23"/></span> main() ducks the exception</p>
<figure class="informal"><div class="figure">
<img src="Images/f0442-04.png" alt="image" width="202" height="59"/>
<h6/>
</div></figure>
<pre data-type="programlisting">foo() pops off the
stack, and the excep-
tion is thrown back
to main(). But main()
doesn’t have a try/
catch, so the excep-
tion is thrown back to…
who? What? There’s
nobody left but the
JVM, and it’s thinking,
“Don’t expect ME to
get you out of this.”</pre></li>
<li><p><span class="inlineimage"><img src="Images/4circle.png" alt="Images" width="20" height="19"/></span> The JVM shuts down</p></li>
</ul>
<p><span class="inlineimage"><img src="Images/f0442-05.png" alt="Images" width="37" height="35"/></span> <span style="color:#636466;">We’re using the T-shirt to represent a Clothing Exception. We know, we know...you would have preferred the blue jeans.</span></p>
<p><a data-type="indexterm" data-primary="methods" data-secondary="exception handling" id="idm46038390157760"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="exception handling role" id="idm46038390155104"/><strong>Handle or Declare. It’s the law.</strong></p>
<p><strong>So now we’ve seen both ways to satisfy the compiler when you call a risky (exception-throwing) method.</strong></p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>HANDLE</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0443-01.png" alt="image" width="774" height="162"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>DECLARE (duck it)</strong></p>
<p>Declare that YOUR method throws the same exceptions as the risky method you’re calling.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0443-02.png" alt="image" width="810" height="148"/>
<h6/>
</div></figure>
<p>But now this means that whoever calls the foo() method has to follow the Handle or Declare law. If foo() ducks the exception (by declaring it) and main() calls foo(), then main() has to deal with the exception.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0443-03.png" alt="image" width="832" height="393"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Getting back to our music code..."><div class="sect1" id="getting_back_to_our_music_codehellip">
<h1>Getting back to our music code...</h1>
<p><a data-type="indexterm" data-primary="exception handling" data-secondary="finally block" id="idm46038390139536"/><a data-type="indexterm" data-primary="finally block" id="idm46038390138448"/><a data-type="indexterm" data-primary="Sequencer class" id="idm46038390137616"/><a data-type="indexterm" data-primary="try/catch blocks" data-secondary="wrapping call in" id="idm46038390136784"/>Now that you’ve completely forgotten, we started this chapter with a first look at some JavaSound code. We created a Sequencer object, but it wouldn’t compile because the method Midi.getSequencer() declares a checked exception (MidiUnavailableException). But we can fix that now by wrapping the call in a try/catch.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0444-01.png" alt="image" width="965" height="494"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Exception Rules"><div class="sect2" id="exception_rules">
<h2>Exception Rules</h2>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>You cannot have a catch or finally without a try.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0444-02.png" alt="image" width="428" height="142"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>You cannot put code between the try and the catch.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0444-03.png" alt="image" width="452" height="146"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>A try MUST be followed by either a catch or a finally.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0444-04.png" alt="image" width="383" height="167"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> <strong>A try with only a finally (no catch) must still declare the exception.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0444-05.png" alt="image" width="415" height="126"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Code Kitchen"><div class="sect1" id="code_kitchen">
<h1>Code Kitchen</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0445-01.png" alt="image" width="1011" height="1137"/>
<h6/>
</div></figure>
<blockquote>
<p><a data-type="indexterm" data-primary="Code Kitchens" data-secondary="playing sound" id="idm46038390110976"/><strong>You don’t have to do it yourself, but it’s a lot more fun if you do.</strong></p>
<p><strong>The rest of this chapter is optional; you can use Ready-Bake Code for all the music apps.</strong></p>
<p><strong>But if you want to learn more about JavaSound, turn the page.</strong></p>
</blockquote>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Making actual sound"><div class="sect1" id="making_actual_sound">
<h1>Making actual sound</h1>
<p><a data-type="indexterm" data-primary="MIDI Music Player" id="idm46038390109632"/><a data-type="indexterm" data-primary="Sequence" id="idm46038390104352"/><a data-type="indexterm" data-primary="Sequencer class" id="idm46038390103840"/><a data-type="indexterm" data-primary="Track" id="idm46038390103328"/>Remember near the beginning of the chapter, we looked at how MIDI data holds the instructions for <em>what</em> should be played (and <em>how</em> it should be played) and we also said that MIDI data doesn’t actually <em>create any sound that you hear.</em> For sound to come out of the speakers, the MIDI data has to be sent through some kind of MIDI device that takes the MIDI instructions and renders them in sound, by triggering either a hardware instrument or a “virtual” instrument (software synthesizer). In this book, we’re using only software devices, so here’s how it works in JavaSound:</p>
<p><strong>You need FOUR things:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0446-01.png" alt="image" width="1037" height="760"/>
<h6/>
</div></figure>
<p><strong>And you need FIVE steps:</strong></p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> Get a <code><strong>Sequencer</strong></code> and open it</p>
<pre data-type="programlisting">Sequencer player = MidiSystem.getSequencer();
player.open();</pre></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> Make a new <code><strong>Sequence</strong></code></p>
<pre data-type="programlisting">Sequence seq = new Sequence(timing,4);</pre></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> Get a new <code><strong>Track</strong></code> from the Sequence</p>
<pre data-type="programlisting">Track t = seq.createTrack();</pre></li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> Fill the Track with <code><strong>MidiEvents</strong></code> and give the Sequence to the Sequencer</p>
<pre data-type="programlisting">t.add(myMidiEvent1);
player.setSequence(seq);</pre></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0447-04.png" alt="image" width="916" height="526"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Version 1: Your very first sound player app"><div class="sect1" id="version_1_your_very_first_sound_player_a">
<h1>Version 1: Your very first sound player app</h1>
<p>Type it in and run it. You’ll hear the sound of someone playing a single note on a piano! (OK, maybe not some<em>one</em>, but some<em>thing</em>.)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0448-01.png" alt="image" width="962" height="300"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0448-02.png" alt="image" width="1004" height="853"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Making a MidiEvent (song data)"><div class="sect1" id="making_a_midievent_left_parenthesissong">
<h1>Making a MidiEvent (song data)</h1>
<p><a data-type="indexterm" data-primary="event handling" data-secondary="MIDIEvents" id="idm46038390072704"/><a data-type="indexterm" data-primary="Message, MIDIEvent" id="idm46038390071728"/><a data-type="indexterm" data-primary="MIDIEvents" id="idm46038390070992"/>A MidiEvent is an instruction for part of a song. A series of MidiEvents is kind of like sheet music, or a player piano roll. Most of the MidiEvents we care about describe <strong><em>a thing to do</em></strong> and the <strong><em>moment in time to do it</em></strong>. The moment in time part matters, since timing is everything in music. This note follows this note and so on. And because MidiEvents are so detailed, you have to say at what moment to <em>start</em> playing the note (a NOTE ON event) and at what moment to <em>stop</em> playing the notes (NOTE OFF event). So you can imagine that firing the “stop playing note G” (NOTE OFF message) <em>before</em> the “start playing Note G” (NOTE ON) message wouldn’t work.</p>
<p>The MIDI instruction actually goes into a Message object; the MidiEvent is a combination of the Message plus the moment in time when that message should “fire.” In other words, the Message might say, “Start playing Middle C,” while the MidiEvent would say, “Trigger this message at beat 4.”</p>
<p>So we always need a Message and a MidiEvent.</p>
<p>The Message says <em>what</em> to do, and the MidiEvent says <em>when</em> to do it.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;"><strong>A MidiEvent says <u>what</u> to do and <u>when</u> to do it.</strong></span></p>
<p><span style="color:#636466;"><strong>Every instruction must include the <u>timing</u> for that instruction.</strong></span></p>
<p><span style="color:#636466;"><strong>In other words, at which <u>beat</u> that thing should happen.</strong></span></p>
</div>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> Make a <strong>Message</strong></p>
<p><code>ShortMessage msg = new ShortMessage();</code></p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> Put the <strong>Instruction</strong> in the Message</p>
<figure class="informal"><div class="figure">
<img src="Images/f0449-01.png" alt="image" width="819" height="128"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> Make a new <strong>MidiEvent</strong> using the Message</p>
<figure class="informal"><div class="figure">
<img src="Images/f0449-02.png" alt="image" width="918" height="133"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> Add the MidiEvent to the <strong>Track</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0449-03.png" alt="image" width="713" height="233"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="MIDI message: the heart of a MidiEvent"><div class="sect1" id="midi_message_the_heart_of_a_midievent">
<h1>MIDI message: the heart of a MidiEvent</h1>
<p><a data-type="indexterm" data-primary="ShortMessage instance" id="idm46038390038848"/><a data-type="indexterm" data-primary="ShortMessage.setMessage()" id="idm46038390038224"/>A MIDI message holds the part of the event that says <em>what</em> to do. It’s the actual instruction you want the sequencer to execute. The first argument of an instruction is always the type of the message. The values you pass to the other three arguments depend on the type of message. For example, a message of type 144 means “NOTE ON.” But in order to carry out a NOTE ON, the sequencer needs to know a few things. Imagine the sequencer saying, “OK, I’ll play a note, but <em>which channel</em>? In other words, do you want me to play a Drum note or a Piano note? And <em>which note</em>? Middle-C? D Sharp? And while we’re at it, at <em>which velocity</em> should I play the note?</p>
<p>To make a MIDI message, make a ShortMessage instance and invoke setMessage(), passing in the four arguments for the message. But remember, the message says only <em>what</em> to do, so you still need to stuff the message into an event that adds <em>when</em> that message should “fire.”</p>
<section data-type="sect2" data-pdf-bookmark="Anatomy of a message"><div class="sect2" id="anatomy_of_a_message">
<h2>Anatomy of a message</h2>
<p>The <em>first</em> argument to setMessage() always represents the message “type,” while the <em>other t</em>hree arguments represent different things depending on the message type.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;"><strong>The Message says <u>what</u> to do; the MidiEvent says <u>when</u> to do it.</strong></span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0450-01.png" alt="image" width="540" height="226"/>
<h6/>
</div></figure>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>Message type</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0450-02.png" alt="image" width="544" height="412"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>Channel</strong></p>
<p>Think of a channel like a musician in a band. Channel 1 is musician 1 (the keyboard player), channel 9 is the drummer, etc.</p></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>Note to play</strong></p>
<p>A number from 0 to 127, going from low to high notes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0450-03.png" alt="image" width="369" height="193"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> <strong>Velocity</strong></p>
<p>How fast and hard did you press the key? 0 is so soft you probably won’t hear anything, but 100 is a good default.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0450-04.png" alt="image" width="177" height="157"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Change a message"><div class="sect1" id="change_a_message">
<h1>Change a message</h1>
<p>Now that you know what’s in a MIDI message, you can start experimenting. You can change the note that’s played, how long the note is held, add more notes, and even change the instrument.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>Change the note</strong></p>
<p>Try a number between 0 and 127 in the note on and note off messages.</p>
<pre data-type="programlisting">msg.setMessage(144, 1, <u><code><strong>20</strong></code></u>, 100);</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0451-01.png" alt="image" width="258" height="137"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>Change the duration of the note</strong></p>
<p>Change the note off event (not the <em>message</em>) so that it happens at an earlier or later beat.</p>
<pre data-type="programlisting">msg.setMessage(128, 1, 44, 100);
MidiEvent noteOff = new MidiEvent(b, <u><strong>3</strong></u> );</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0451-02.png" alt="image" width="303" height="212"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>Change the instrument</strong></p>
<p>Add a new message, BEFORE the note-playing message, that sets the instrument in channel 1 to something other than the default piano. The change-instrument message is “192,” and the third argument represents the actual instrument (try a number between 0 and 127).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0451-03.png" alt="image" width="179" height="206"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0451-04.png" alt="image" width="412" height="166"/>
<h6/>
</div></figure>
</li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Version 2: Using command-line args to experiment with sounds"><div class="sect1" id="version_2_using_command-line_args_to_exp">
<h1>Version 2: Using command-line args to experiment with sounds</h1>
<p><a data-type="indexterm" data-primary="command-line arguments, MIDIEvent" id="idm46038389988112"/>This version still plays just a single note, but you get to use command-line arguments to change the instrument and note. Experiment by passing in two int values from 0 to 127. The first int sets the instrument; the second int sets the note to play.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0452-01.png" alt="image" width="1422" height="1474"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Where we’re headed with the rest of the CodeKitchens"><div class="sect2" id="where_weapostrophere_headed_with_the_res">
<h2>Where we’re headed with the rest of the CodeKitchens</h2>
<table class="border">
<tbody>
<tr>
<td><strong><a data-type="xref" href="ch17.xhtml#make_a_connection_networking_and_threads">Chapter 17</a>: the goal</strong><br/>When we’re done, we’ll have a working BeatBox that’s also a Drum Chat Client. We’ll need to learn about GUIs (including event handling), I/O, networking, and threads. The next three (<a data-type="xref" href="ch14.xhtml#a_very_graphic_story_getting_gui">Chapter 14</a>, <a data-type="xref" href="ch15.xhtml#work_on_your_swing_using_swing">Chapter 15</a>, and <a data-type="xref" href="ch16.xhtml#saving_objects_left_parenthesisand_textr">Chapter 16</a>) will get us there.</td>
<td><figure class="informal"><div class="figure">
<img src="Images/f0453-01.png" alt="image" width="602" height="334"/>
<h6/>
</div></figure>
</td>
</tr>
<tr>
<td><strong><a data-type="xref" href="ch14.xhtml#a_very_graphic_story_getting_gui">Chapter 14</a>: MIDI events</strong><br/>This CodeKitchen lets us build a little “music video” (bit of a stretch to call it that...) that draws random rectangles to the beat of the MIDI music. We’ll learn how to construct and play a lot of MIDI events (instead of just a couple, as we do in the current chapter).</td>
<td><figure class="informal"><div class="figure">
<img src="Images/f0453-02.png" alt="image" width="605" height="163"/>
<h6/>
</div></figure>
</td>
</tr>
<tr>
<td><strong><a data-type="xref" href="ch15.xhtml#work_on_your_swing_using_swing">Chapter 15</a>: Standalone BeatBox</strong><br/>Now we’ll actually build the real BeatBox, GUI and all. But it’s limited—as soon as you change a pattern, the previous one is lost. There’s no Save and Restore feature, and it doesn’t communicate with the network. (But you can still use it to work on your drum pattern skills.)</td>
<td><figure class="informal"><div class="figure">
<img src="Images/f0453-03.png" alt="image" width="513" height="306"/>
<h6/>
</div></figure>
</td>
</tr>
<tr>
<td><strong><a data-type="xref" href="ch16.xhtml#saving_objects_left_parenthesisand_textr">Chapter 16</a>: Save and Restore</strong><br/>You’ve made the perfect pattern, and now you can save it to a file and reload it when you want to play it again. This gets us ready for the final version (<a data-type="xref" href="ch15.xhtml#work_on_your_swing_using_swing">Chapter 15</a>), where instead of writing the pattern to a file, we send it over a network to the chat server.</td>
<td><figure class="informal"><div class="figure">
<img src="Images/f0453-04.png" alt="image" width="515" height="330"/>
<h6/>
</div></figure>
</td>
</tr>
</tbody>
</table>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000021">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="True or False" id="idm46038389958304"/>This chapter explored the wonderful world of exceptions. Your job is to decide whether each of the following exception-related statements is true or false.</p>
<section data-type="sect2" data-pdf-bookmark="True or False"><div class="sect2" id="true_or_false-id000040">
<h2>True or False</h2>
<figure class="informal"><div class="figure">
<img src="Images/hand.png" alt="image" width="22" height="27"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/hand1.png" alt="image" width="22" height="27"/>
<h6/>
</div></figure>
<ol>
<li><p>A try block must be followed by a catch and a finally block.</p></li>
<li><p>If you write a method that might cause a compiler-checked exception, you must wrap that risky code in a try/catch block.</p></li>
<li><p>Catch blocks can be polymorphic.</p></li>
<li><p>Only “compiler checked” exceptions can be caught.</p></li>
<li><p>If you define a try/catch block, a matching finally block is optional.</p></li>
<li><p>If you define a try block, you can pair it with a matching catch or finally block, or both.</p></li>
<li><p>If you write a method that declares that it can throw a compiler-checked exception, you must also wrap the exception throwing code in a try/catch block.</p></li>
<li><p>The main( ) method in your program must handle all unhandled exceptions thrown to it.</p></li>
<li><p>A single try block can have many different catch blocks.</p></li>
<li><p>A method can throw only one kind of exception.</p></li>
<li><p>A finally block will run regardless of whether an exception is thrown.</p></li>
<li><p>A finally block can exist without a try block.</p></li>
<li><p>A try block can exist by itself, without a catch block or a finally block.</p></li>
<li><p>Handling an exception is sometimes referred to as “ducking.”</p></li>
<li><p>The order of catch blocks never matters.</p></li>
<li><p>A method with a try block and a finally block can optionally declare a checked exception.</p></li>
<li><p>Runtime exceptions must be handled or declared.</p></li>
</ol>
<p><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Answers in <a data-type="xref" href="#true_or_false_left_parenthesisfrom_page">“True or False”</a>.</strong></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Code Magnets"><div class="sect2" id="code_magnets-id000005">
<h2>Code Magnets</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0455-02.png" alt="image" width="99" height="145"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Code Magnets" id="idm46038389933840"/>A working Java program is scrambled up on the fridge. Can you reconstruct all the code snippets to make a working Java program that produces the output listed below? Some of the curly braces fell on the floor and they were too small to pick up, so feel free to add as many of those as you need!</p>
<figure class="informal"><div class="figure">
<img src="Images/f0455-05.png" alt="image" width="1300" height="1301"/>
<h6/>
</div></figure>
<p><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Answers in <a data-type="xref" href="ch02.xhtml#code_magnets_left_parenthesisfrom_page_4">“Code Magnets”</a>.</strong></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="JavaCross"><div class="sect2" id="javacross-id00003">
<h2>JavaCross</h2>
<p><a data-type="indexterm" data-primary="puzzles" data-secondary="JavaCross" id="idm46038389925712"/><img class="inlineimage" src="Images/arr.png" alt="image" width="60" height="12"/> <strong>Answers in <a data-type="xref" href="#javacross_left_parenthesisfrom_page_456r">“JavaCross”</a>.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0456-01.png" alt="image" width="114" height="76"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0456-02.png" alt="image" width="733" height="550"/>
<h6/>
</div></figure>
<p>You know what to do!</p>
<p><strong>Across</strong></p>
<p>1. To give value</p>
<p>4. Flew off the top</p>
<p>6. All this and more!</p>
<p>8. Start</p>
<p>10. The family tree</p>
<p>13. No ducking</p>
<p>15. Problem objects</p>
<p>18. One of Java’s ‘49’</p>
<p>20. Class hierarchy</p>
<p>21. Too hot to handle</p>
<p>24. Common primitive</p>
<p>25. Code recipe</p>
<p>27. Unruly method action</p>
<p>28. No Picasso here</p>
<p>29. Start a chain of events</p>
<p><strong>Down</strong></p>
<p>2. Currently usable</p>
<p>3. Template’s creation</p>
<p>4. Don’t show the kids</p>
<p>5. Mostly static API class</p>
<p>7. Not about behavior</p>
<p>9. The template</p>
<p>11. Roll another one off the line</p>
<p>12. Javac saw it coming</p>
<p>14. Attempt risk</p>
<p>16. Automatic acquisition</p>
<p>17. Changing method</p>
<p>19. Announce a duck</p>
<p>22. Deal with it</p>
<p>23. Create bad news</p>
<p>26. One of my roles</p>
<p><strong>More Hints:</strong></p>
<p><strong>Across</strong></p>
<p>6. A Java child</p>
<p>8. Start a method</p>
<p>13. Instead of declare</p>
<p>20. Also a type of collection</p>
<p>21. Quack</p>
<p>27. Starts a problem</p>
<p>28. Not Abstract</p>
<p><strong>Down</strong></p>
<p>2. Or a mouthwash</p>
<p>3. For ______ (not example)</p>
<p>5. Numbers . . .</p>
<p>9. Only public or default</p>
<p>16. _____ the family fortune</p>
<p>17. Not a ‘getter’</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sharpen your pencil"><div class="sect2" id="sharpen_your_pencil-id00035">
<h2>Sharpen your pencil</h2>
<p>(from <a data-type="xref" href="#sharpen_your_pencil-id00034">“Sharpen your pencil”</a>)</p>
<p/>
<figure class="informal"><div class="figure"><img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0457-01.png" alt="image" width="616" height="546"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise Solution"><div class="sect1" id="exercise_solution-id00004">
<h1>Exercise Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="True or False"><div class="sect2" id="true_or_false_left_parenthesisfrom_page">
<h2>True or False</h2>
<p>(from <a data-type="xref" href="#true_or_false-id000040">“True or False”</a>)</p>
<ol>
<li><p>False, either or both.</p></li>
<li><p>False, you can declare the exception.</p></li>
<li><p>True.</p></li>
<li><p>False, runtime exception can be caught.</p></li>
<li><p>True.</p></li>
<li><p>True, both are acceptable.</p></li>
<li><p>False, the declaration is sufficient.</p></li>
<li><p>False, but if it doesn’t, the JVM may shut down.</p></li>
<li><p>True.</p></li>
<li><p>False.</p></li>
<li><p>True. It’s often used to clean up partially completed tasks.</p></li>
<li><p>False.</p></li>
<li><p>False.</p></li>
<li><p>False, ducking is synonymous with declaring.</p></li>
<li><p>False, broadest exceptions must be caught by the last catch blocks.</p></li>
<li><p>False, if you don’t have a catch block, you must declare.</p></li>
<li><p>False.</p></li>
</ol>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Code Magnets"><div class="sect2" id="code_magnets_left_parenthesisfrom_page_5">
<h2>Code Magnets</h2>
<p>(from <a data-type="xref" href="#code_magnets-id000005">“Code Magnets”</a>)</p>
<pre data-type="programlisting">class MyEx extends Exception { }

public class ExTestDrive {
  public static void main(String[] args) {
    String test = args[0];
    try {
      System.out.print("t");
      doRisky(test);
      System.out.print("o");
    } catch (MyEx e) {
      System.out.print("a");
    } finally {
      System.out.print("w");
    }
    System.out.println("s");
  }

  static void doRisky(String t) throws MyEx {
    System.out.print("h");

    if ("yes".equals(t)) {
      throw new MyEx();
    }

    System.out.print("r");
  }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0458-02.png" alt="image" width="407" height="239"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="JavaCross"><div class="sect2" id="javacross_left_parenthesisfrom_page_456r">
<h2>JavaCross</h2>
<p>(from <a data-type="xref" href="#javacross-id00003">“JavaCross”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0456-01.png" alt="image" width="114" height="76"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0459-01.png" alt="image" width="733" height="550"/>
<h6/>
</div></figure>
</div></section>
</div></section>
</div></section></div></body></html>