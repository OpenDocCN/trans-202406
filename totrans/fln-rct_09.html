<html><head></head><body><section data-pdf-bookmark="Chapter 8. Frameworks" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch08">&#13;
<h1><span class="label">Chapter 8. </span>Frameworks</h1>&#13;
&#13;
&#13;
<p>In our journey<a data-primary="frameworks" data-type="indexterm" id="ix_frameworks.08.4.15"/> through React thus far, we have uncovered an extensive&#13;
range of features and principles that contribute to its power and&#13;
versatility. The previous chapter delved into the fascinating world of&#13;
asynchronous<a data-primary="asynchronous rendering" data-secondary="and frameworks in React" data-secondary-sortas="frameworks in React" data-type="indexterm" id="id959"/> React, which empowers us with tools like <code>useTransition</code>&#13;
and <code>useDeferredValue</code> to create highly responsive and user-friendly&#13;
interfaces. We explored how these tools utilize the sophisticated&#13;
scheduling and prioritization mechanisms of React, made possible by the&#13;
Fiber reconciler, to achieve optimal performance. The understanding of&#13;
these asynchronous patterns is critical as we venture into the realm of&#13;
React frameworks in this chapter.</p>&#13;
&#13;
<p>React by itself is incredibly powerful, but as applications grow in&#13;
complexity, we often find ourselves repeating similar patterns or&#13;
needing more streamlined solutions for common challenges. This is where&#13;
frameworks come in. React frameworks are software libraries or toolkits&#13;
built on top of React, providing additional abstractions to handle&#13;
common tasks more efficiently and enforce best practices.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Why We Need a Framework" data-type="sect1"><div class="sect1" id="id118">&#13;
<h1>Why We Need a Framework</h1>&#13;
&#13;
<p>While React provides the building blocks to create interactive user&#13;
interfaces, it leaves many important architectural decisions up to the&#13;
developers. React is unopinionated in this regard, giving developers the&#13;
flexibility to structure their applications in the way they see fit.&#13;
However, as applications scale, this freedom can turn into a burden. You&#13;
might find yourself reinventing the wheel, dealing with common&#13;
challenges such as routing, data fetching, and server-side rendering&#13;
again and again.</p>&#13;
&#13;
<p>This is where React frameworks come in. They provide a predefined&#13;
structure and solutions to common problems, allowing developers to focus&#13;
on what’s unique about their application, rather than getting bogged&#13;
down with boilerplate code. This can significantly accelerate the&#13;
development process and improve the quality of the codebase by adhering&#13;
to best practices enforced by the framework.</p>&#13;
&#13;
<p>To fully understand this, let’s try to write our own minimal framework<a data-primary="frameworks" data-secondary="writing sample framework" data-type="indexterm" id="ix_frameworkswritingsampleframework.08.40.71"/>.&#13;
In order to do this, we need to identify a few key features that we get&#13;
from frameworks that we do not get as easily from plain React. For the&#13;
sake of brevity, we’ll identify three key features along these lines that we get from&#13;
frameworks . It’s worth noting that frameworks do far&#13;
more, but this subset will help us form the basis of a great discussion:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Server rendering</p>&#13;
</li>&#13;
<li>&#13;
<p>Routing</p>&#13;
</li>&#13;
<li>&#13;
<p>Data fetching</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Let’s take a preexisting imaginary React application and incrementally&#13;
add these features to understand what frameworks do for us. The React&#13;
app we’re “framework-ifying” has the following structure:</p>&#13;
<pre>- index.js&#13;
- List.js&#13;
- Detail.js&#13;
- dist/&#13;
  - clientBundle.js</pre>&#13;
&#13;
<p>Here’s what each file looks like:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// index.js</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">React</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">createRoot</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom/client"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">Router</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./Router"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">root</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">createRoot</code><code class="p">(</code><code class="nb">document</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">params</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="nx">URLSearchParams</code><code class="p">();</code><code class="w"/>&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">thingId</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">params</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"id"</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="nx">root</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">  </code><code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">pathname</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="s2">"/"</code><code class="w"> </code><code class="o">?</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">List</code> <code class="p">/&gt;</code><code class="w"> </code><code class="o">:</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">Detail</code> <code class="na">thingId</code><code class="o">=</code><code class="p">{</code><code class="nx">thingId</code><code class="p">}</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="c1">// List.js</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="kd">const</code><code class="w"> </code><code class="nx">List</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">things</code><code class="p">,</code><code class="w"> </code><code class="nx">setThings</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">([]);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">requestState</code><code class="p">,</code><code class="w"> </code><code class="nx">setRequestState</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="s2">"initial"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">error</code><code class="p">,</code><code class="w"> </code><code class="nx">setError</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="nx">useEffect</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"loading"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-list"</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setThings</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"success"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="k">catch</code><code class="p">((</code><code class="nx">e</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"error"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setError</code><code class="p">(</code><code class="nx">e</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">},</code><code class="w"> </code><code class="p">[]);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">things</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">thing</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">label</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">};</code><code class="w"/>&#13;
&#13;
<code class="c1">// Detail.js</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="kd">const</code><code class="w"> </code><code class="nx">Detail</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">({</code><code class="w"> </code><code class="nx">thingId</code><code class="w"> </code><code class="p">})</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">thing</code><code class="p">,</code><code class="w"> </code><code class="nx">setThing</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">([]);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">requestState</code><code class="p">,</code><code class="w"> </code><code class="nx">setRequestState</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="s2">"initial"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">error</code><code class="p">,</code><code class="w"> </code><code class="nx">setError</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="nx">useEffect</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"loading"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-thing/"</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="nx">thingId</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setThings</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"success"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="k">catch</code><code class="p">((</code><code class="nx">e</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"error"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setError</code><code class="p">(</code><code class="nx">e</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">},</code><code class="w"> </code><code class="p">[]);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">The</code><code class="w"> </code><code class="nx">thing</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">{</code><code class="nx">thing</code><code class="p">}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">};</code><code class="w"/></pre>&#13;
&#13;
<p class="pagebreak-before">There are a few issues with this that affect all <a data-primary="client-side rendering (CSR)" data-type="indexterm" id="id960"/><a data-primary="CSR (client-side rendering)" data-type="indexterm" id="id961"/><a data-primary="rendering" data-secondary="client-side" data-type="indexterm" id="id962"/>client-only rendered&#13;
React applications:</p>&#13;
<dl>&#13;
<dt>We ship an empty page to a user with only code to load, then parse and execute &#13;
<span class="keep-together">JavaScript.</span></dt>&#13;
<dd>&#13;
<p>A user downloads a blank page until JavaScript kicks&#13;
in, and then they get our app. If the user is a search engine, they may&#13;
see nothing. If the search engine crawler does not support JavaScript,&#13;
the search engine will not index our website.</p>&#13;
</dd>&#13;
<dt>We start fetching data too late.</dt>&#13;
<dd>&#13;
<p>Our app falls prey to a&#13;
user-experience curse <a data-primary="network waterfalls" data-type="indexterm" id="id963"/>called <em>network waterfalls</em>: a phenomenon that&#13;
occurs when network requests happen in succession and slow down&#13;
applications. Our application has to make multiple requests to a server&#13;
for basic functionality. For instance, it executes like so:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Download, parse, and execute JavaScript.</p>&#13;
</li>&#13;
<li>&#13;
<p>Render and commit React components.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>useEffect</code> starts fetching data.</p>&#13;
</li>&#13;
<li>&#13;
<p>Render and commit spinners, etc.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>useEffect</code> finishes fetching data.</p>&#13;
</li>&#13;
<li>&#13;
<p>Render and commit data. All of this can be avoided if we serve a page&#13;
with data straight to the browser: if we send HTML markup as covered in&#13;
<a data-type="xref" href="ch07.html#ch07">Chapter 7</a> on server-side React.</p>&#13;
</li>&#13;
</ul>&#13;
</dd>&#13;
<dt>Our router is purely client based.</dt>&#13;
<dd>&#13;
<p>If a browser requests&#13;
<a class="bare" href="https://our-app.com/detail?thingId=24"><em class="hyperlink">https://our-app.com/detail?thingId=24</em></a>, the server responds with a 404&#13;
page because there is no such file on the server. A common hack used to&#13;
remedy this is to render an HTML file when a 404 is encountered that&#13;
loads JavaScript and has the client-side router take over. This hack&#13;
doesn’t work for search engines or environments where JavaScript support&#13;
is limited<a data-startref="ix_frameworkswritingsampleframework.08.40.71" data-type="indexterm" id="id964"/>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Frameworks help resolve all these issues and more. Let’s explore how&#13;
exactly they do this.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Server Rendering" data-type="sect2"><div class="sect2" id="id119">&#13;
<h2>Server Rendering</h2>&#13;
&#13;
<p>To start with, frameworks usually give us server rendering out of the&#13;
box. To add server rendering<a data-primary="server-side rendering (SSR)" data-secondary="with frameworks" data-secondary-sortas="frameworks" data-type="indexterm" id="ix_serversiderenderingSSRwithframeworks.08.188.29"/><a data-primary="frameworks" data-secondary="server-side rendering with" data-type="indexterm" id="ix_frameworksserversiderenderingwith.08.188.29"/> to this application, we need a server. We&#13;
can write one ourselves using a package like Express.js. We would then&#13;
deploy this server and we’re in business. Let’s explore the code that&#13;
would power such a server.</p>&#13;
&#13;
<p>Before we do, please be aware that we’re using <code>renderToString</code> merely&#13;
for simplicity<a data-primary="renderToString API" data-type="indexterm" id="id965"/> and to illustrate the underlying mechanisms behind how&#13;
frameworks implement these features. In a real production use case, it’s&#13;
almost always better to rely on more powerful asynchronous APIs for&#13;
server rendering like <code>renderToPipeableStream</code>, as covered in <a data-type="xref" href="ch06.html#ch06">Chapter 6</a>.</p>&#13;
&#13;
<p>With that out of the way, let’s do this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// ./server.js</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">express</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"express"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">renderToString</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom/server"</code><code class="p">;</code><code class="w"> </code><code class="c1">// Covered in Chapter 6</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">List</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./List"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">Detail</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./Detail"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">app</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">express</code><code class="p">();</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="k">static</code><code class="p">(</code><code class="s2">"./dist"</code><code class="p">));</code><code class="w"> </code><code class="c1">// Get static files like client JS, etc.</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">createLayout</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="nx">children</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="sb">`&lt;html lang="en"&gt;</code>&#13;
<code class="sb">&lt;head&gt;</code>&#13;
<code class="sb">  &lt;title&gt;My page&lt;/title&gt;</code>&#13;
<code class="sb">&lt;/head&gt;</code>&#13;
<code class="sb">&lt;body&gt;</code>&#13;
<code class="sb">  </code><code class="si">${</code><code class="nx">children</code><code class="si">}</code><code class="sb"/>&#13;
<code class="sb">  &lt;script src="/clientBundle.js"&gt;&lt;/script&gt;</code>&#13;
<code class="sb">&lt;/body&gt;</code>&#13;
<code class="sb">&lt;html&gt;`</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"/"</code><code class="p">,</code><code class="w"> </code><code class="p">(</code><code class="nx">req</code><code class="p">,</code><code class="w"> </code><code class="nx">res</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="nx">createLayout</code><code class="p">(</code><code class="nx">renderToString</code><code class="p">(&lt;</code><code class="nt">List</code> <code class="p">/&gt;)));</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"/detail"</code><code class="p">,</code><code class="w"> </code><code class="p">(</code><code class="nx">req</code><code class="p">,</code><code class="w"> </code><code class="nx">res</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">createLayout</code><code class="p">(</code><code class="nx">renderToString</code><code class="p">(&lt;</code><code class="nt">Detail</code> <code class="na">thingId</code><code class="o">=</code><code class="p">{</code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">thingId</code><code class="p">}</code> <code class="p">/&gt;))</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mf">3000</code><code class="p">,</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s2">"App is listening!"</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/></pre>&#13;
&#13;
<p>This code is all we need to add server rendering to our application.&#13;
Notice how <code>index.js</code> on the client side has its own client router, and&#13;
how we essentially just added another one for the server. Frameworks&#13;
ship <em>isomorphic routers</em>, which are routers<a data-primary="isomorphic routers" data-type="indexterm" id="id966"/> that work on both the&#13;
client and the server<a data-startref="ix_serversiderenderingSSRwithframeworks.08.188.29" data-type="indexterm" id="id967"/><a data-startref="ix_frameworksserversiderenderingwith.08.188.29" data-type="indexterm" id="id968"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Routing" data-type="sect2"><div class="sect2" id="id120">&#13;
<h2>Routing</h2>&#13;
&#13;
<p>While this server is <em>OK</em>, it doesn’t scale well: for each route<a data-primary="frameworks" data-secondary="routing" data-type="indexterm" id="ix_frameworksrouting.08.250.65"/><a data-primary="routing, frameworks" data-type="indexterm" id="ix_routingframeworks.08.250.65"/><a data-primary="filesystem-based routing" data-type="indexterm" id="ix_filesystembasedrouting.08.250.65"/> we&#13;
add, we’ll have to manually add more <code>req.get</code> calls. Let’s make this a&#13;
little more scalable. We can solve this in a number of ways, like with a configuration object that maps routes to&#13;
components, or with filesystem-based routing. For the sake of education&#13;
(and frankly, fun) let’s explore <em>filesystem-based routing</em>. This is&#13;
where the reasoning for and mechanism behind the conventions and&#13;
opinions of frameworks like Next.js become more clear. When we enforce a&#13;
convention such that all pages must go in a <em>./pages</em> directory and all&#13;
filenames in this directory become router paths, then our server can&#13;
rely on the convention as an assumption and become more scalable.</p>&#13;
&#13;
<p>Let’s illustrate this with an example. First, we’ll augment our&#13;
directory structure. The new directory structure looks like this:</p>&#13;
<pre>- index.js&#13;
- pages/&#13;
  - list.js&#13;
  - detail.js&#13;
- dist/&#13;
  - clientBundle.js</pre>&#13;
&#13;
<p>Now, we can assume that everything in <code>pages</code> becomes a route. Let’s&#13;
update our server to match this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// ./server.js</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">express</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"express"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">join</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"path"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">renderToString</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom/server"</code><code class="p">;</code><code class="w"> </code><code class="c1">// Covered in Chapter 6</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">app</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">express</code><code class="p">();</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="k">static</code><code class="p">(</code><code class="s2">"./dist"</code><code class="p">));</code><code class="w"> </code><code class="c1">// Get static files like client JS, etc.</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">createLayout</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="nx">children</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="sb">`&lt;html lang="en"&gt;</code>&#13;
<code class="sb">&lt;head&gt;</code>&#13;
<code class="sb">  &lt;title&gt;My page&lt;/title&gt;</code>&#13;
<code class="sb">&lt;/head&gt;</code>&#13;
<code class="sb">&lt;body&gt;</code>&#13;
<code class="sb">  </code><code class="si">${</code><code class="nx">children</code><code class="si">}</code><code class="sb"/>&#13;
<code class="sb">  &lt;script src="/clientBundle.js"&gt;&lt;/script&gt;</code>&#13;
<code class="sb">&lt;/body&gt;</code>&#13;
<code class="sb">&lt;html&gt;`</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"/:route"</code><code class="p">,</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="p">(</code><code class="nx">req</code><code class="p">,</code><code class="w"> </code><code class="nx">res</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// Import the route's component from the pages directory</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">exportedStuff</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="k">import</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">join</code><code class="p">(</code><code class="nx">process</code><code class="p">.</code><code class="nx">cwd</code><code class="p">(),</code><code class="w"> </code><code class="s2">"pages"</code><code class="p">,</code><code class="w"> </code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">route</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// We can no longer have named exports because we need predictability</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// so we opt for default exports instead.</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// `.default` is standardized and therefore we can rely on it.</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">Page</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">exportedStuff</code><code class="p">.</code><code class="k">default</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// We can infer props from the query string maybe?</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">props</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">req</code><code class="p">.</code><code class="nx">query</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="nx">createLayout</code><code class="p">(</code><code class="nx">renderToString</code><code class="p">(&lt;</code><code class="nt">Page</code> <code class="p">{</code><code class="na">...props</code><code class="p">}</code> <code class="p">/&gt;)));</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mf">3000</code><code class="p">,</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s2">"App is listening!"</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/></pre>&#13;
&#13;
<p>Now, our server scales far better because of the new <em>./pages</em> directory&#13;
convention we’ve adopted! Great! However, we’re now forced to have each&#13;
page’s component be a default export since our approach is more general&#13;
and there would otherwise be no way to predict what name to import. This&#13;
is one of the trade-offs of working with frameworks. In this case, the&#13;
trade-off seems to be worth it<a data-startref="ix_frameworksrouting.08.250.65" data-type="indexterm" id="id969"/><a data-startref="ix_routingframeworks.08.250.65" data-type="indexterm" id="id970"/><a data-startref="ix_filesystembasedrouting.08.250.65" data-type="indexterm" id="id971"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data Fetching" data-type="sect2"><div class="sect2" id="id121">&#13;
<h2>Data Fetching</h2>&#13;
&#13;
<p>Great! We’re 2 for 3. We’ve got server rendering and filesystem-based&#13;
routing, but we’re still suffering from network waterfalls. Let’s fix&#13;
the data fetching<a data-primary="data fetching, frameworks" data-type="indexterm" id="ix_datafetchingframeworks.08.332.18"/><a data-primary="frameworks" data-secondary="data fetching" data-type="indexterm" id="ix_frameworksdatafetching.08.332.18"/> story. To start with, we’ll update our components to&#13;
receive initial data through props. For simplicity, we’ll deal with just&#13;
the <code>List</code> component and leave the <code>Detail</code> component for you to do as&#13;
homework:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// ./pages/list.jsx</code><code class="w"/>&#13;
<code class="c1">// Note the default export for filesystem-based routing.</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">List</code><code class="p">({</code><code class="w"> </code><code class="nx">initialThings</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="cm">/* &lt;- adding initial prop */</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">things</code><code class="p">,</code><code class="w"> </code><code class="nx">setThings</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="nx">initialThings</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">requestState</code><code class="p">,</code><code class="w"> </code><code class="nx">setRequestState</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="s2">"initial"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">error</code><code class="p">,</code><code class="w"> </code><code class="nx">setError</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// This can still run to fetch data if we need it to.</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">useEffect</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">initialThings</code><code class="p">)</code><code class="w"> </code><code class="k">return</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"loading"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-list"</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setThings</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"success"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="k">catch</code><code class="p">((</code><code class="nx">e</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"error"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setError</code><code class="p">(</code><code class="nx">e</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">},</code><code class="w"> </code><code class="p">[</code><code class="nx">initialThings</code><code class="p">]);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">things</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">thing</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">label</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Great. Now that we’ve added an initial prop, we need some way to fetch&#13;
the data this page needs on the server, and then pass it to the&#13;
component before rendering it. Let’s explore how we can do that. Ideally, what we&#13;
want to do is this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// ./server.js</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">express</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"express"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">join</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"path"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">renderToString</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom/server"</code><code class="p">;</code><code class="w"> </code><code class="c1">// Covered in Chapter 6</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">app</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">express</code><code class="p">();</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="k">static</code><code class="p">(</code><code class="s2">"./dist"</code><code class="p">));</code><code class="w"> </code><code class="c1">// Get static files like client JS, etc.</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">createLayout</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="nx">children</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="sb">`&lt;html lang="en"&gt;</code>&#13;
<code class="sb">&lt;head&gt;</code>&#13;
<code class="sb">  &lt;title&gt;My page&lt;/title&gt;</code>&#13;
<code class="sb">&lt;/head&gt;</code>&#13;
<code class="sb">&lt;body&gt;</code>&#13;
<code class="sb">  </code><code class="si">${</code><code class="nx">children</code><code class="si">}</code><code class="sb"/>&#13;
<code class="sb">  &lt;script src="/clientBundle.js"&gt;&lt;/script&gt;</code>&#13;
<code class="sb">&lt;/body&gt;</code>&#13;
<code class="sb">&lt;html&gt;`</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"/:route"</code><code class="p">,</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="p">(</code><code class="nx">req</code><code class="p">,</code><code class="w"> </code><code class="nx">res</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">exportedStuff</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="k">import</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">join</code><code class="p">(</code><code class="nx">process</code><code class="p">.</code><code class="nx">cwd</code><code class="p">(),</code><code class="w"> </code><code class="s2">"pages"</code><code class="p">,</code><code class="w"> </code><code class="nx">req</code><code class="p">.</code><code class="nx">params</code><code class="p">.</code><code class="nx">route</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">Page</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">exportedStuff</code><code class="p">.</code><code class="k">default</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// Get component's data</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">data</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">exportedStuff</code><code class="p">.</code><code class="nx">getData</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">props</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">req</code><code class="p">.</code><code class="nx">query</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// Pass props and data</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="nx">createLayout</code><code class="p">(</code><code class="nx">renderToString</code><code class="p">(&lt;</code><code class="nt">Page</code> <code class="p">{</code><code class="na">...props</code><code class="p">}</code> <code class="p">{</code><code class="na">...data.props</code><code class="p">}</code> <code class="p">/&gt;)));</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mf">3000</code><code class="p">,</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">console</code><code class="p">.</code><code class="nx">info</code><code class="p">(</code><code class="s2">"App is listening!"</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">});</code><code class="w"/></pre>&#13;
&#13;
<p>This means we’ll need to export a fetcher function<a data-primary="getData function" data-type="indexterm" id="id972"/> called <code>getData</code> from&#13;
any page components that need data! Let’s adjust the list to do this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// ./pages/list.jsx</code><code class="w"/>&#13;
&#13;
<code class="c1">// We'll call this on the server and pass these props to the component</code><code class="w"/>&#13;
<code class="k">export</code><code class="w"> </code><code class="kd">const</code><code class="w"> </code><code class="nx">getData</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">initialThings</code><code class="o">:</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-list"</code><code class="p">).</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">()</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">),</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">};</code><code class="w"/>&#13;
<code class="p">};</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">List</code><code class="p">({</code><code class="w"> </code><code class="nx">initialThings</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="cm">/* &lt;- adding initial prop */</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">things</code><code class="p">,</code><code class="w"> </code><code class="nx">setThings</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="nx">initialThings</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">requestState</code><code class="p">,</code><code class="w"> </code><code class="nx">setRequestState</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="s2">"initial"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">error</code><code class="p">,</code><code class="w"> </code><code class="nx">setError</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="c1">// This can still run to fetch data if we need it to.</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">useEffect</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">initialThings</code><code class="p">)</code><code class="w"> </code><code class="k">return</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"loading"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">getData</code><code class="p">()</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setThings</code><code class="p">)</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="nx">then</code><code class="p">(()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"success"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">.</code><code class="k">catch</code><code class="p">((</code><code class="nx">e</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setRequestState</code><code class="p">(</code><code class="s2">"error"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">setError</code><code class="p">(</code><code class="nx">e</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">},</code><code class="w"> </code><code class="p">[</code><code class="nx">initialThings</code><code class="p">]);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">things</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">thing</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">thing</code><code class="p">.</code><code class="nx">label</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Done! Now we’re:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Fetching data as early as possible on the server for each route per&#13;
file</p>&#13;
</li>&#13;
<li>&#13;
<p>Rendering a full page as an HTML string</p>&#13;
</li>&#13;
<li>&#13;
<p>Sending this to a client</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>We’ve successfully added and understood the three features we’ve identified&#13;
from various frameworks and implemented a basic version of them. By&#13;
doing this, we’ve learned and now understand the underlying mechanism by&#13;
which frameworks do what they do. Specifically, we learned how frameworks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Give us server rendering</p>&#13;
</li>&#13;
<li>&#13;
<p>Have isomorphic routing, influenced by the filesystem</p>&#13;
</li>&#13;
<li>&#13;
<p>Fetch data through exported functions</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>If you’ve used Next.js versions before 13, the reasoning for its various&#13;
patterns should become abundantly clear at this point, specifically&#13;
patterns around:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <em>./pages</em> directory</p>&#13;
</li>&#13;
<li>&#13;
<p>All page exports are default exports</p>&#13;
</li>&#13;
<li>&#13;
<p><code>getServerSideProps</code> and <code>getStaticProps</code></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Now that we understand the mechanism behind frameworks at the code level&#13;
and the reasons for some of their conventions, let’s zoom out and&#13;
summarize the benefits of using a framework<a data-startref="ix_datafetchingframeworks.08.332.18" data-type="indexterm" id="id973"/><a data-startref="ix_frameworksdatafetching.08.332.18" data-type="indexterm" id="id974"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Benefits of Using a Framework" data-type="sect1"><div class="sect1" id="id122">&#13;
<h1>Benefits of Using a Framework</h1>&#13;
&#13;
<p>The benefits<a data-primary="frameworks" data-secondary="benefits" data-type="indexterm" id="id975"/> of using a framework include:</p>&#13;
<dl>&#13;
<dt>Structure and consistency</dt>&#13;
<dd>&#13;
<p>Frameworks enforce a certain structure&#13;
and pattern to organize the codebase. This leads to consistency, making&#13;
it easier for new developers to understand the flow of the application.&#13;
It also enables us to focus on our products and features without&#13;
worrying about the minutiae of how to structure our code.</p>&#13;
</dd>&#13;
<dt>Best practices</dt>&#13;
<dd>&#13;
<p>Frameworks often come with baked-in best practices&#13;
that developers are encouraged to follow. This can lead to better code&#13;
quality and fewer bugs. For example, frameworks might encourage you to&#13;
fetch data early—i.e., on the server—rather than waiting for the client&#13;
to fetch it. This can lead to better performance and user experience.</p>&#13;
</dd>&#13;
<dt>Abstractions</dt>&#13;
<dd>&#13;
<p>Frameworks provide higher-level abstractions<a data-primary="abstractions, analysis to choose framework" data-seealso="declarative programming" data-type="indexterm" id="id976"/> to handle&#13;
common tasks such as routing, data fetching, server rendering, and more.&#13;
This can make your code cleaner, more readable, and easier to maintain,&#13;
while leaning on the broader community to ensure the quality of these&#13;
abstractions. An example of this is the <code>useRouter</code> hook provided by&#13;
Next.js, which makes it easy to access the router in your components.</p>&#13;
</dd>&#13;
<dt>Performance optimizations</dt>&#13;
<dd>&#13;
<p>Many frameworks come with out-of-the-box&#13;
optimizations<a data-primary="performance" data-secondary="frameworks for optimizing" data-type="indexterm" id="id977"/> such as code splitting, server-side rendering, and static&#13;
site generation. These can significantly improve the performance of your&#13;
application. For example, Next.js automatically code-splits your&#13;
application and preloads the code for the next page when the user hovers&#13;
over a link, leading to faster page transitions.</p>&#13;
</dd>&#13;
<dt>Community and ecosystem</dt>&#13;
<dd>&#13;
<p>Popular frameworks have a large community&#13;
and a rich ecosystem<a data-primary="ecosystems and tooling" data-secondary="frameworks" data-type="indexterm" id="id978"/> of plug-ins and libraries. This means you can often&#13;
find a solution or get help quickly if you run into a problem.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Trade-Offs of Using a Framework" data-type="sect1"><div class="sect1" id="id123">&#13;
<h1>Trade-Offs of Using a Framework</h1>&#13;
&#13;
<p>While frameworks<a data-primary="frameworks" data-secondary="trade-offs in using" data-type="indexterm" id="id979"/> come with many advantages, they are not without their&#13;
trade-offs. Understanding these can help you make an informed decision&#13;
about whether to use a framework and which one to choose:</p>&#13;
<dl>&#13;
<dt>Learning curve</dt>&#13;
<dd>&#13;
<p>Every framework comes with its own set of concepts,&#13;
APIs, and conventions that you need to learn. If you’re new to React,&#13;
trying to learn a framework at the same time can be overwhelming but is&#13;
still recommended. If you’re already familiar with React, you’ll need to&#13;
invest time in learning the framework’s specific features and APIs.</p>&#13;
</dd>&#13;
<dt>Flexibility versus convention</dt>&#13;
<dd>&#13;
<p>While the enforced structure and&#13;
conventions of a framework can be a boon, they can also be constraining.&#13;
If your application has unique requirements that don’t fit into the&#13;
framework’s model, you might find yourself fighting against the&#13;
framework rather than being helped by it. There are some cases where&#13;
you’re building for a specific user group with fast internet and a&#13;
modern browser, and you don’t need server-side rendering or data&#13;
fetching. In these cases, a framework might be overkill.</p>&#13;
</dd>&#13;
<dt>Dependency and commitment</dt>&#13;
<dd>&#13;
<p>Choosing a framework is a commitment.&#13;
You’re tying your application to the fate of the framework. If the&#13;
framework stops being maintained or if it takes a direction that doesn’t&#13;
align with your needs, you may face difficult decisions about whether to&#13;
undertake a costly migration to a different framework or to maintain the&#13;
existing framework code yourself.</p>&#13;
</dd>&#13;
<dt>Abstraction overhead</dt>&#13;
<dd>&#13;
<p>While abstractions<a data-primary="abstractions, analysis to choose framework" data-type="indexterm" id="id980"/> can simplify development by&#13;
hiding complexity, they can also create “magic” that makes it&#13;
difficult to understand what’s happening under the hood. This can make&#13;
debugging and performance tuning challenging. Furthermore, every&#13;
abstraction comes with some overhead, which might impact performance. An example of this is server actions in Next.js,&#13;
where the <code>"use server"</code> directive somehow magically makes the action&#13;
run on the server. This is a great abstraction, but it can be difficult&#13;
to understand how it works.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Now that we understand why we might want to use a React framework, and&#13;
the benefits and trade-offs involved, we can delve into specific&#13;
frameworks in the React ecosystem. In the upcoming sections of this&#13;
chapter, we’ll explore some of the popular choices, such as Next.js and&#13;
Remix. Each framework offers unique features and advantages,&#13;
and understanding them will equip you with the knowledge to choose the&#13;
right tool for your specific needs.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Popular React Frameworks" data-type="sect1"><div class="sect1" id="id251">&#13;
<h1>Popular React Frameworks</h1>&#13;
&#13;
<p>Let’s explore some of the popular React frameworks and discuss their&#13;
features, advantages, and trade-offs. We’ll start with a brief overview&#13;
of each framework, followed by a detailed comparison of their features&#13;
and performance. We’ll also discuss some of the factors to consider when&#13;
choosing a framework for your project.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Remix" data-type="sect2"><div class="sect2" id="id124">&#13;
<h2>Remix</h2>&#13;
&#13;
<p>Remix<a data-primary="Remix" data-type="indexterm" id="ix_Remix.08.595.6"/><a data-primary="frameworks" data-secondary="Remix" data-type="indexterm" id="ix_frameworksRemix.08.595.6"/> is a powerful modern web framework that leverages React and the&#13;
features of the web platform. Let’s get started with some practical&#13;
examples to understand how it works.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A basic Remix application" data-type="sect3"><div class="sect3" id="id252">&#13;
<h3>A basic Remix application</h3>&#13;
&#13;
<p>First, we’ll set up a basic Remix application. You can install Remix&#13;
using <code>npm</code>:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">npm<code class="w"> </code>create<code class="w"> </code>remix@2.2.0<code class="w"/></pre>&#13;
&#13;
<p>This will create a new Remix project in your current directory. Let’s&#13;
look around and see what’s inside. To start with, we’ve got an <em>app</em> directory with <em>entry.client.tsx</em> and <em>entry.server.tsx</em>. We’ve also got&#13;
a <em>root.tsx</em> in this directory.</p>&#13;
&#13;
<p>Off the bat, we can immediately see that Remix supports client and&#13;
server entry points out of the box. Moreover, the <em>root.tsx</em> contains a&#13;
shared layout component that is rendered on every page. This is a great&#13;
example of how Remix provides a predefined structure to help you get&#13;
started quickly.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Server rendering" data-type="sect3"><div class="sect3" id="id125">&#13;
<h3>Server rendering</h3>&#13;
&#13;
<p>Remix provides server rendering<a data-primary="server-side rendering (SSR)" data-secondary="with frameworks" data-secondary-sortas="frameworks" data-type="indexterm" id="ix_serversiderenderingSSRwithframeworks.08.621.32"/><a data-primary="frameworks" data-secondary="server-side rendering with" data-type="indexterm" id="ix_frameworksserversiderenderingwith.08.621.32"/> out of the box through its&#13;
<em>entry.server.tsx</em>. The file<a data-primary="entry.server.tsx file, Remix" data-type="indexterm" id="ix_entryservertsxfileRemix.08.622.29"/> is generated for us, but let’s understand&#13;
it a little bit. Here’s what it looks like:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">PassThrough</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"node:stream"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">type</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">AppLoadContext</code><code class="p">,</code><code class="w"> </code><code class="nx">EntryContext</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/node"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">createReadableStreamFromReadable</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/node"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">RemixServer</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/react"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">isbot</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"isbot"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">renderToPipeableStream</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom/server"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">const</code><code class="w"> </code><code class="nx">ABORT_DELAY</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">5</code><code class="nx">_000</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">handleRequest</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">request</code><code class="o">:</code><code class="w"> </code><code class="nx">Request</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseStatusCode</code><code class="o">:</code><code class="w"> </code><code class="nx">number</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseHeaders</code><code class="o">:</code><code class="w"> </code><code class="nx">Headers</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">remixContext</code><code class="o">:</code><code class="w"> </code><code class="nx">EntryContext</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">loadContext</code><code class="o">:</code><code class="w"> </code><code class="nx">AppLoadContext</code><code class="w"/>&#13;
<code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">isbot</code><code class="p">(</code><code class="nx">request</code><code class="p">.</code><code class="nx">headers</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"user-agent"</code><code class="p">))</code><code class="w"/>&#13;
<code class="w">    </code><code class="o">?</code><code class="w"> </code><code class="nx">handleBotRequest</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">request</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">responseStatusCode</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">responseHeaders</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">remixContext</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">)</code><code class="w"/>&#13;
<code class="w">    </code><code class="o">:</code><code class="w"> </code><code class="nx">handleBrowserRequest</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">request</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">responseStatusCode</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">responseHeaders</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">remixContext</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">handleBotRequest</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">request</code><code class="o">:</code><code class="w"> </code><code class="nx">Request</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseStatusCode</code><code class="o">:</code><code class="w"> </code><code class="nx">number</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseHeaders</code><code class="o">:</code><code class="w"> </code><code class="nx">Headers</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">remixContext</code><code class="o">:</code><code class="w"> </code><code class="nx">EntryContext</code><code class="w"/>&#13;
<code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code><code class="w"> </code><code class="nx">reject</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">let</code><code class="w"> </code><code class="nx">shellRendered</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="kc">false</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">const</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">pipe</code><code class="p">,</code><code class="w"> </code><code class="nx">abort</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">renderToPipeableStream</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">RemixServer</code>&#13;
        <code class="na">context</code><code class="o">=</code><code class="p">{</code><code class="nx">remixContext</code><code class="p">}</code>&#13;
        <code class="na">url</code><code class="o">=</code><code class="p">{</code><code class="nx">request</code><code class="p">.</code><code class="nx">url</code><code class="p">}</code>&#13;
        <code class="na">abortDelay</code><code class="o">=</code><code class="p">{</code><code class="nx">ABORT_DELAY</code><code class="p">}</code>&#13;
      <code class="p">/&gt;,</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onAllReady</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">shellRendered</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="kc">true</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">          </code><code class="kd">const</code><code class="w"> </code><code class="nx">body</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="nx">PassThrough</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">          </code><code class="kd">const</code><code class="w"> </code><code class="nx">stream</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">createReadableStreamFromReadable</code><code class="p">(</code><code class="nx">body</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">responseHeaders</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">resolve</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">            </code><code class="ow">new</code><code class="w"> </code><code class="nx">Response</code><code class="p">(</code><code class="nx">stream</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">              </code><code class="nx">headers</code><code class="o">:</code><code class="w"> </code><code class="nx">responseHeaders</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">              </code><code class="nx">status</code><code class="o">:</code><code class="w"> </code><code class="nx">responseStatusCode</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">            </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">pipe</code><code class="p">(</code><code class="nx">body</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onShellError</code><code class="p">(</code><code class="nx">error</code><code class="o">:</code><code class="w"> </code><code class="nx">unknown</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onError</code><code class="p">(</code><code class="nx">error</code><code class="o">:</code><code class="w"> </code><code class="nx">unknown</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">responseStatusCode</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">500</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// Log streaming rendering errors from inside the shell.  Don't log</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// errors encountered during initial shell rendering since they'll</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// reject and get logged in handleDocumentRequest.</code><code class="w"/>&#13;
<code class="w">          </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">shellRendered</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">            </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">    </code><code class="nx">setTimeout</code><code class="p">(</code><code class="nx">abort</code><code class="p">,</code><code class="w"> </code><code class="nx">ABORT_DELAY</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">});</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">handleBrowserRequest</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">request</code><code class="o">:</code><code class="w"> </code><code class="nx">Request</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseStatusCode</code><code class="o">:</code><code class="w"> </code><code class="nx">number</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">responseHeaders</code><code class="o">:</code><code class="w"> </code><code class="nx">Headers</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">  </code><code class="nx">remixContext</code><code class="o">:</code><code class="w"> </code><code class="nx">EntryContext</code><code class="w"/>&#13;
<code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code><code class="w"> </code><code class="nx">reject</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">let</code><code class="w"> </code><code class="nx">shellRendered</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="kc">false</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">const</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">pipe</code><code class="p">,</code><code class="w"> </code><code class="nx">abort</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">renderToPipeableStream</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">RemixServer</code>&#13;
        <code class="na">context</code><code class="o">=</code><code class="p">{</code><code class="nx">remixContext</code><code class="p">}</code>&#13;
        <code class="na">url</code><code class="o">=</code><code class="p">{</code><code class="nx">request</code><code class="p">.</code><code class="nx">url</code><code class="p">}</code>&#13;
        <code class="na">abortDelay</code><code class="o">=</code><code class="p">{</code><code class="nx">ABORT_DELAY</code><code class="p">}</code>&#13;
      <code class="p">/&gt;,</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onShellReady</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">shellRendered</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="kc">true</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">          </code><code class="kd">const</code><code class="w"> </code><code class="nx">body</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="nx">PassThrough</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">          </code><code class="kd">const</code><code class="w"> </code><code class="nx">stream</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">createReadableStreamFromReadable</code><code class="p">(</code><code class="nx">body</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">responseHeaders</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"Content-Type"</code><code class="p">,</code><code class="w"> </code><code class="s2">"text/html"</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">resolve</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">            </code><code class="ow">new</code><code class="w"> </code><code class="nx">Response</code><code class="p">(</code><code class="nx">stream</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">              </code><code class="nx">headers</code><code class="o">:</code><code class="w"> </code><code class="nx">responseHeaders</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">              </code><code class="nx">status</code><code class="o">:</code><code class="w"> </code><code class="nx">responseStatusCode</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">            </code><code class="p">})</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">          </code><code class="nx">pipe</code><code class="p">(</code><code class="nx">body</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onShellError</code><code class="p">(</code><code class="nx">error</code><code class="o">:</code><code class="w"> </code><code class="nx">unknown</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">onError</code><code class="p">(</code><code class="nx">error</code><code class="o">:</code><code class="w"> </code><code class="nx">unknown</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">responseStatusCode</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">500</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// Log streaming rendering errors from inside the shell.  Don't log</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// errors encountered during initial shell rendering since they'll</code><code class="w"/>&#13;
<code class="w">          </code><code class="c1">// reject and get logged in handleDocumentRequest.</code><code class="w"/>&#13;
<code class="w">          </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">shellRendered</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">            </code><code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">},</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">    </code><code class="nx">setTimeout</code><code class="p">(</code><code class="nx">abort</code><code class="p">,</code><code class="w"> </code><code class="nx">ABORT_DELAY</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">});</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>The great thing about Remix is that this file is used internally, but is exposed here for us to customize. If we delete this file, Remix will&#13;
defer to its internal default implementation of the same file. This is&#13;
a nice escape hatch that allows us to customize the server rendering&#13;
behavior if we need to, while not locking us into the framework’s&#13;
“magic.”</p>&#13;
&#13;
<p>This file is defining how HTTP responses should be&#13;
generated and handled in our Remix application, particularly concerning&#13;
how requests are managed differently for bots and regular browsers.&#13;
Remix is a framework for building modern React applications, and this&#13;
file is a part of the server-side logic of a Remix app.</p>&#13;
&#13;
<p>Initially, the file imports necessary modules and types from various&#13;
libraries, such as the <code>node:stream</code>, <code>@remix-run/node</code>,&#13;
<code>@remix-run/react</code>, <code>isbot</code>, and <code>react-dom/server</code>. It defines a&#13;
constant <code>ABORT_DELAY</code> with a value of 5,000 milliseconds, which is used&#13;
as a timeout period for rendering operations.</p>&#13;
&#13;
<p>The file exports a default <a data-primary="handleRequest function, Remix" data-type="indexterm" id="id981"/>function <code>handleRequest</code> that takes several&#13;
arguments, including the HTTP request, response status code, response&#13;
headers, and contexts for Remix and the application’s load process.&#13;
Inside <code>handleRequest</code>, it checks the user-agent of the incoming request&#13;
to determine if it’s coming from a bot using the <code>isbot</code> library.&#13;
Depending on whether the request is from a bot or a browser, it&#13;
delegates &#13;
<span class="keep-together">the handling</span> to <a data-primary="handleBotRequest function, Remix" data-type="indexterm" id="id982"/><a data-primary="handleBrowserRequest function, Remix" data-type="indexterm" id="id983"/>either <code>handleBotRequest</code> or&#13;
<code>handleBrowserRequest</code> functions, &#13;
<span class="keep-together">respectively.</span></p>&#13;
&#13;
<p>This helps with SEO and performance. For example, if a request comes&#13;
from a bot, it’s important to ensure that the response contains the&#13;
rendered HTML content of the page, which is what <code>handleBotRequest</code>&#13;
does. On the other hand, if the request comes from a regular browser,&#13;
it’s important to ensure that the response contains the rendered HTML&#13;
content of the page along with the necessary JavaScript code to hydrate&#13;
the page, which is what <code>handleBrowserRequest</code> does. It’s pretty cool&#13;
that Remix handles this for us automatically.</p>&#13;
&#13;
<p>Both <code>handleBotRequest</code> and <code>handleBrowserRequest</code> functions are fairly&#13;
similar in structure but have different handlers for when the rendering&#13;
shell is ready or encounters an error. They return a promise that&#13;
resolves to an HTTP response. They initiate a rendering operation to a&#13;
pipeable stream with <code>renderToPipeableStream</code>, passing in a&#13;
<code>RemixServer</code> component along with the necessary context and URL from&#13;
the request. They define a timeout to abort the rendering operation if&#13;
it takes longer than <code>ABORT_DELAY</code>.</p>&#13;
&#13;
<p>In the event handlers for the rendering operation, they create a&#13;
<code>PassThrough</code> stream and a readable stream from it. They set the&#13;
<code>Content-Type</code> header to <code>text/html</code> for the response. They resolve the&#13;
promise with a new <code>Response</code> object that encapsulates the stream,&#13;
response headers, and status code. In case of errors during rendering,&#13;
they either reject the promise or log the error to the console,&#13;
depending on the rendering stage where the error occurred.</p>&#13;
&#13;
<p>This file essentially ensures that the HTTP responses are correctly&#13;
generated and returned, with different rendering logic applied based on&#13;
whether the request comes from a bot or a regular browser, which is&#13;
crucial for SEO and performance considerations in modern web&#13;
applications<a data-startref="ix_serversiderenderingSSRwithframeworks.08.621.32" data-type="indexterm" id="id984"/><a data-startref="ix_entryservertsxfileRemix.08.622.29" data-type="indexterm" id="id985"/><a data-startref="ix_frameworksserversiderenderingwith.08.621.32" data-type="indexterm" id="id986"/>.</p>&#13;
&#13;
<p>If we have no customizations to make, we can simply delete this file, and&#13;
Remix will handle the server rendering for us. Let’s keep it for now and&#13;
explore how Remix handles routes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Routing" data-type="sect3"><div class="sect3" id="id126">&#13;
<h3>Routing</h3>&#13;
&#13;
<p>In Remix, each route<a data-primary="routing, frameworks" data-type="indexterm" id="id987"/> is represented by a file in the <em>routes</em> directory.&#13;
If we create &#13;
<span class="keep-together"><em>./routes/cheese.tsx</em>,</span> whose default export is:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>and then run the local development server with <code>npm run dev</code>, we’ll see&#13;
a page with a funny heading. Once again, we see how Remix provides a&#13;
predefined structure to help you get started quickly, and the value of&#13;
default exports in this convention is similar to our own implementation of&#13;
filesystem-based routing earlier. When combined with the shared layout&#13;
component in <em>./app/root.tsx</em> and both the server and client entry&#13;
points, this forms the basis of most websites. However, we’re still&#13;
missing one crucial component for a modern web application: data&#13;
fetching. Let’s look at how Remix handles this.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data fetching" data-type="sect3"><div class="sect3" id="id127">&#13;
<h3>Data fetching</h3>&#13;
&#13;
<p>The Remix data fetching<a data-primary="data fetching, frameworks" data-type="indexterm" id="id988"/><a data-primary="frameworks" data-secondary="data fetching" data-type="indexterm" id="id989"/> story at the time of writing involves the use of&#13;
functions<a data-primary="loader functions, Remix" data-type="indexterm" id="id990"/> called <em>loaders</em>. When you export an async function called&#13;
<code>loader</code> that returns some value, this value becomes available to your&#13;
page component through the <code>useLoaderData</code> hook<a data-primary="useLoaderData hook" data-type="indexterm" id="id991"/>. Let’s see how this&#13;
works with an example.</p>&#13;
&#13;
<p>To go back to our cheese page, let’s say we want to fetch a list of&#13;
cheeses from an API and display them on the page. We can do this by&#13;
exporting a <code>loader</code> function from &#13;
<span class="keep-together"><em>./routes/cheese.tsx</em>:</span></p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// Get some utils</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">json</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/node"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/react"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="c1">// The loader</code><code class="w"/>&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">loader</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">data</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-cheeses"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">json</code><code class="p">(</code><code class="k">await</code><code class="w"> </code><code class="nx">data</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">cheeses</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">cheeses</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">cheese</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">name</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>With this, we see a recurrence in our own earlier implementation of data&#13;
fetching. We can see how the Remix <code>loader</code> function is similar to&#13;
our own <code>getData</code> function. We can also see how the <code>useLoaderData</code> hook&#13;
is similar to our own <code>initialThings</code> prop. Ideally, at this time we’re&#13;
able to glean the common patterns and underlying mechanisms behind how&#13;
frameworks implement these features.</p>&#13;
&#13;
<p>So far, we’ve covered:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Server rendering</p>&#13;
</li>&#13;
<li>&#13;
<p>Routing</p>&#13;
</li>&#13;
<li>&#13;
<p>Data fetching</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>But there’s one more Remix feature that we haven’t covered&#13;
yet: forms and server actions, or mutations—that is, mutating data on&#13;
the server, like creating, updating, or deleting data. Let’s explore&#13;
this next.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Mutating data" data-type="sect3"><div class="sect3" id="id128">&#13;
<h3>Mutating data</h3>&#13;
&#13;
<p>Remix was responsible for bringing the web back to its fundamentals,&#13;
leaning heavily on native web platform conventions and behavior. This is&#13;
best seen around data mutations<a data-primary="mutating data" data-type="indexterm" id="ix_mutatingdata.08.906.32"/> and Remix’s usage of forms. Let’s&#13;
explore this with an example, extending our previous cheese example:&#13;
let’s make the cheese list mutable. To do so, let’s start by updating&#13;
our <em>./routes/cheese.tsx</em> file:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// Get some utils</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">json</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/node"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/react"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="c1">// The loader</code><code class="w"/>&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">loader</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">data</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-cheeses"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">json</code><code class="p">(</code><code class="k">await</code><code class="w"> </code><code class="nx">data</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">cheeses</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">cheeses</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">cheese</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">name</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="s">"/cheese"</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Notice we’ve added a new <code>form</code> element to the page. This form has an&#13;
action of &#13;
<span class="keep-together"><code>/cheese</code></span> and a method of <code>post</code>. This is a standard HTML form&#13;
that will submit a POST request to the <code>/cheese</code> route. Moreover, the&#13;
<code>input</code> has a <code>name</code> attribute and no <code>useState</code> or <code>onChange</code> handler:&#13;
Remix lets the browser manage the state and behavior of the form. This&#13;
is a great example of how Remix leans on the web platform to provide a&#13;
great developer experience, and doesn’t try to reinvent the wheel having&#13;
React manage everything.</p>&#13;
&#13;
<p>Given that the form’s action property is <code>/cheese</code> and we’re already in&#13;
the <em>./routes/cheese.tsx</em> file, we can assume that the form will submit&#13;
to the same route. When this route is accessed with a <code>POST</code> method,&#13;
 we know that the form has been submitted. When this route is&#13;
accessed with the <code>GET</code> method by default, we know that the form&#13;
has not been submitted and we instead show the initial UI.</p>&#13;
&#13;
<p>Let’s update our <em>./routes/cheese.tsx</em> file to handle this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// Get some utils</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">json</code><code class="p">,</code><code class="w"> </code><code class="nx">ActionFunctionArgs</code><code class="p">,</code><code class="w"> </code><code class="nx">redirect</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/node"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"@remix-run/react"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="c1">// The loader</code><code class="w"/>&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">loader</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">data</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-cheeses"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">json</code><code class="p">(</code><code class="k">await</code><code class="w"> </code><code class="nx">data</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="c1">// The form action</code><code class="w"/>&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">action</code><code class="p">({</code><code class="w"> </code><code class="nx">params</code><code class="p">,</code><code class="w"> </code><code class="nx">request</code><code class="w"> </code><code class="p">}</code><code class="o">:</code><code class="w"> </code><code class="nx">ActionFunctionArgs</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">formData</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">request</code><code class="p">.</code><code class="nx">formData</code><code class="p">();</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/add-cheese"</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">method</code><code class="o">:</code><code class="w"> </code><code class="s2">"POST"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">body</code><code class="o">:</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"cheese"</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}),</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">redirect</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"> </code><code class="c1">// Come back to this page, but with GET this time.</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">cheeses</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useLoaderData</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">cheeses</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">cheese</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">name</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="s">"/cheese"</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Notice how we’ve added a new <code>action</code> function that takes a <code>params</code> and&#13;
<code>request</code> argument. The <code>params</code> argument is an object that contains the&#13;
parameters of the route. The <code>request</code> argument is an object that&#13;
contains the request object. We can use this to get the form data from&#13;
the request and then use it to make a request to our API to add a new&#13;
cheese.</p>&#13;
&#13;
<p>We then return a redirect to the same route, but this time with a <code>GET</code>&#13;
method. This will cause the page to be reloaded, and the <code>loader</code>&#13;
function will be called again to fetch the updated list of cheeses.</p>&#13;
&#13;
<p>This is how Remix fully leans on the web platform to enable JavaScript&#13;
to be used where it’s needed, and to let the browser handle the rest. If&#13;
this page was visited without JavaScript, it would just work because it&#13;
leans on the web platform. If the page does use JavaScript, Remix&#13;
progressively enhances the experience by adding interactivity and a&#13;
better user experience<a data-startref="ix_mutatingdata.08.906.32" data-type="indexterm" id="id992"/>.</p>&#13;
&#13;
<p>So far, we’ve covered how Remix:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Provides server rendering</p>&#13;
</li>&#13;
<li>&#13;
<p>Handles routing</p>&#13;
</li>&#13;
<li>&#13;
<p>Handles data fetching</p>&#13;
</li>&#13;
<li>&#13;
<p>Handles data mutations</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>At this point, we should be seeing strong parallels between our own&#13;
implementation of these features and Remix’s implementation. This is a&#13;
great sign that we’re understanding the underlying mechanisms behind how&#13;
frameworks implement these &#13;
<span class="keep-together">features</span><a data-startref="ix_Remix.08.595.6" data-type="indexterm" id="id993"/><a data-startref="ix_frameworksRemix.08.595.6" data-type="indexterm" id="id994"/>.</p>&#13;
&#13;
<p>Now let’s consider Next.js and how it does very similar things to&#13;
isolate the commonalities behind the way these features are implemented.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Next.js" data-type="sect2"><div class="sect2" id="id129">&#13;
<h2>Next.js</h2>&#13;
&#13;
<p>Next.js<a data-primary="Next.js" data-secondary="frameworks" data-type="indexterm" id="ix_Nextjsframeworks.08.1040.8"/>, a popular React framework by Vercel, is well-known for its rich&#13;
features and simplicity in creating server-side rendered (SSR) and&#13;
static websites<a data-primary="static site generation (SSG)" data-type="indexterm" id="id995"/><a data-primary="SSG (static site generation)" data-type="indexterm" id="id996"/>. It follows the convention over configuration principle,&#13;
reducing the amount of boilerplate and decision-making necessary to&#13;
start a project. With the release of Next.js 13, a significant addition&#13;
has been the introduction of the Next.js App Router.</p>&#13;
&#13;
<p>Let’s walk through a basic Next.js application to understand how it&#13;
works. To start, let’s run the following command to create a new Next.js&#13;
project:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">npm<code class="w"> </code>create<code class="w"> </code>next-app@14<code class="w"/></pre>&#13;
&#13;
<p>This will ask us some questions, but ultimately we’ll arrive at a basic&#13;
Next.js project. Let’s look around and see what’s inside. To start with,&#13;
we’ve got an <em>app</em> directory with <em>page.tsx</em>, <em>layout.tsx</em>, <em>error.tsx</em>,&#13;
and <em>loading.tsx</em>.</p>&#13;
&#13;
<p>One thing we immediately notice is that Next.js does not expose server&#13;
configuration like Remix does, but instead hides away a large number of&#13;
complexities with the intention of “getting out of the way” and&#13;
letting developers focus on building their applications. This is a great&#13;
example of how different frameworks have different philosophies and&#13;
approaches to solving the same problems.</p>&#13;
&#13;
<p>Let’s explore Next.js in the context of the three key features we identified&#13;
earlier: server rendering, routing, and data fetching.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Server rendering" data-type="sect3"><div class="sect3" id="id130">&#13;
<h3>Server rendering</h3>&#13;
&#13;
<p>Next.js not only provides server rendering<a data-primary="server-side rendering (SSR)" data-secondary="with frameworks" data-secondary-sortas="frameworks" data-type="indexterm" id="id997"/><a data-primary="frameworks" data-secondary="server-side rendering with" data-type="indexterm" id="id998"/> but is also server-first. Every&#13;
page and component in Next.js is a server component. We dive quite deep&#13;
into server components in <a data-type="xref" href="ch09.html#ch09">Chapter 9</a>, but for now, suffice it to&#13;
say that server components<a data-primary="server components" data-seealso="React Server Components" data-type="indexterm" id="id999"/> are components rendered exclusively on the&#13;
server. This level of understanding is fine for now, as the focus is on&#13;
Next.js, not server components. For server components, <a data-type="xref" href="ch09.html#ch09">Chapter 9</a> should be sufficient.</p>&#13;
&#13;
<p>What does this mean in the context of Next.js, though? In essence, we are&#13;
to operate on the basis that all the code we write executes on the&#13;
server exclusively unless otherwise specified by adding a <code>"use client"</code>&#13;
directive<a data-primary="use client directive" data-type="indexterm" id="id1000"/> to the top of a given route or component. Without this&#13;
directive, all code is assumed to be server code.</p>&#13;
&#13;
<p>However, Next.js also is static-first: at build time, the server&#13;
components are rendered to as much static content as possible and then&#13;
deployed. This combination of server-first and static-first is what&#13;
makes Next.js so powerful and prioritizes performance pretty&#13;
significantly, with static content being arguably the fastest to reach&#13;
users as there’s no runtime or server-side processing required; it’s&#13;
just text (HTML). The next step from static is server rendered content,&#13;
which can be highly optimized and cached, but still requires a server to&#13;
render the content. The final step is client-rendered content through&#13;
hydration for interactive portions of the page.</p>&#13;
&#13;
<p>With this approach, Next.js lends itself well to have smaller JavaScript&#13;
bundles shipped to users, with the bulk of the content being some mix of&#13;
static and server rendered markup. The level of granularity with which&#13;
not just pages but components can be rendered on the server is a&#13;
powerful feature of Next.js, enabling some very powerful data fetching&#13;
and rendering patterns. Before we get to those patterns, let’s explore&#13;
how Next.js handles routing.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Routing" data-type="sect3"><div class="sect3" id="id131">&#13;
<h3>Routing</h3>&#13;
&#13;
<p>What we see in our new<a data-primary="routing, frameworks" data-type="indexterm" id="id1001"/> Next.js project is an <em>app</em> directory with&#13;
<em>layout.tsx</em> and <em>page.tsx</em>. Next.js follows this pattern: the path your&#13;
users see in their browser, the URL of your page, is the name of the&#13;
directory where <em>app</em> is equivalent to the root (<em>/</em>), and every&#13;
directory under it becomes a subpath.</p>&#13;
&#13;
<p>To understand this, let’s create a directory <em>cheese</em> and add a&#13;
<em>page.tsx</em> file to it. When a directory under <em>./app</em> has a <em>page.tsx</em>&#13;
file, that directory becomes a route. Let’s add some content to&#13;
<em>./app/cheese/page.tsx</em>:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Now, if we run the development server and navigate to <em>/cheese</em>, we’ll&#13;
see a page with a funny heading. It’s worth noting here that Next.js&#13;
also has a concept of shared layouts, similar to Remix, where you can&#13;
define a layout component in <em>./app/layout.tsx</em> and it will be rendered&#13;
on every page. Then, <em>./app/cheese/layout.tsx</em> will be rendered on every&#13;
page under the <em>/cheese</em> route. Layouts are typically portions of routes&#13;
that are shared across multiple pages, such as a header or footer, or&#13;
other fixed elements.</p>&#13;
&#13;
<p>Great, this is how Next.js handles routing. It’s sort of similar to&#13;
Remix and our own implementation of filesystem-based routing, but with&#13;
a slight difference that it’s not a single file that becomes a page but&#13;
instead an entire directory, and that the actual page is expected to&#13;
called <em>page.tsx</em> all the time. Besides this, it’s pretty similar.</p>&#13;
&#13;
<p>Let’s talk about data fetching.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Data fetching" data-type="sect3"><div class="sect3" id="id132">&#13;
<h3>Data fetching</h3>&#13;
&#13;
<p>Because every component<a data-primary="data fetching, frameworks" data-type="indexterm" id="ix_datafetchingframeworks.08.1144.24"/><a data-primary="frameworks" data-secondary="data fetching" data-type="indexterm" id="ix_frameworksdatafetching.08.1144.24"/> is a server component, every component in&#13;
Next.js is capable of being asynchronous and thus, <code>await</code>-ing data.&#13;
Let’s try to fetch cheeses like we did in our previous Remix example, but&#13;
this time in Next.js:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">cheeses</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-cheeses"</code><code class="p">).</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">()</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">cheeses</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">cheese</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">name</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>If you’re reading that and are impressed—yes. This syntax is what React&#13;
engineers have hoped for for years, and is quite natural to reason&#13;
about. This is possible because <code>CheesePage</code> here is a <a data-primary="server components" data-type="indexterm" id="id1002"/>server component:&#13;
it is not included in the client bundle and is instead rendered on the&#13;
server. This means that we can <code>await</code> data and render it directly to&#13;
the page.</p>&#13;
&#13;
<p>Since all components are server components, we can further increase the&#13;
granularity and not fetch at the page level, but at the component level&#13;
too if we want to. Consider breaking this page into smaller components&#13;
where <code>CheeseList</code> is reusable and is used in this page, but may be used&#13;
elsewhere too.</p>&#13;
&#13;
<p>Our page would become this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">CheeseList</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./CheeseList"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">CheeseList</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>and our <code>CheeseList</code> component would be this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheeseList</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">cheeses</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/get-cheeses"</code><code class="p">).</code><code class="nx">then</code><code class="p">((</code><code class="nx">r</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">r</code><code class="p">.</code><code class="nx">json</code><code class="p">()</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">{</code><code class="nx">cheeses</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">cheese</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">li</code> <code class="na">key</code><code class="o">=</code><code class="p">{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;{</code><code class="nx">cheese</code><code class="p">.</code><code class="nx">name</code><code class="p">}&lt;/</code><code class="nt">li</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">))}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">ul</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>The true power of this approach is that we can fetch data at the&#13;
component level, and then render it to the page. We don’t export a&#13;
function from the page level like <code>loader</code>, <code>getData</code>,&#13;
<code>getServerSideProps</code>, <code>getStaticProps</code>, or anything like that. Instead,&#13;
we just fetch data at the component level and render it to the page.</p>&#13;
&#13;
<p>What happens to this data? Next.js uses it to statically generate<a data-primary="static site generation (SSG)" data-type="indexterm" id="id1003"/><a data-primary="SSG (static site generation)" data-type="indexterm" id="id1004"/> the&#13;
first load of our page when we deploy, and server renders it on&#13;
subsequent loads<a data-startref="ix_datafetchingframeworks.08.1144.24" data-type="indexterm" id="id1005"/><a data-startref="ix_frameworksdatafetching.08.1144.24" data-type="indexterm" id="id1006"/>. Next.js also has a number of caching and deduplication&#13;
mechanisms that ensure data integrity and &#13;
<span class="keep-together">performance.</span></p>&#13;
&#13;
<p>Finally, let’s round out the comparison by exploring how Next.js handles&#13;
data &#13;
<span class="keep-together">mutations.</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Mutating data" data-type="sect3"><div class="sect3" id="id133">&#13;
<h3>Mutating data</h3>&#13;
&#13;
<p>Next.js<a data-primary="mutating data" data-type="indexterm" id="ix_mutatingdata.08.1231.8"/> has a concept of <em>server actions</em>, which are functions<a data-primary="server actions" data-type="indexterm" id="ix_serveractions.08.1231.63"/> that run on&#13;
the server. These are functions that are called when a form is&#13;
submitted, a user clicks a button, or a user navigates to a&#13;
page. They are functions that run on the server, and are not included in&#13;
the client bundle.</p>&#13;
&#13;
<p>Let’s look at adding a cheese to the list like we did in our Remix&#13;
example. To do this, we’ll add a form to our page:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">CheeseList</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./CheeseList"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">redirect</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/navigation"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">revalidatePath</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/cache"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">CheeseList</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">form</code>&#13;
        <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="k">async</code><code class="w"> </code><code class="p">(</code><code class="nx">formData</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">          </code><code class="s2">"use server"</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">          </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/add-cheese"</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">            </code><code class="nx">method</code><code class="o">:</code><code class="w"> </code><code class="s2">"POST"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">            </code><code class="nx">body</code><code class="o">:</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code><code class="w"/>&#13;
<code class="w">              </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"cheese"</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">            </code><code class="p">}),</code><code class="w"/>&#13;
<code class="w">          </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">          </code><code class="nx">revalidatePath</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">          </code><code class="k">return</code><code class="w"> </code><code class="nx">redirect</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">}}</code>&#13;
        <code class="na">method</code><code class="o">=</code><code class="s">"post"</code>&#13;
      <code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>We’re using a standard-ish HTML form here similar to Remix,&#13;
except the <code>action</code> attribute is a function this time. This function is&#13;
a server action, and it is called when the form is submitted. This function&#13;
is not included in the client bundle and is instead run on the server.&#13;
This is enforced by the <code>"use server"</code> directive at the top.</p>&#13;
&#13;
<p>We could move this function wherever we want, including into the body of&#13;
the server component, like so:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">redirect</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/navigation"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">revalidatePath</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/cache"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">addCheese</code><code class="p">(</code><code class="nx">formData</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="s2">"use server"</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/add-cheese"</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">method</code><code class="o">:</code><code class="w"> </code><code class="s2">"POST"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">body</code><code class="o">:</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"cheese"</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">}),</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="w">    </code><code class="nx">revalidatePath</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">redirect</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">CheeseList</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="nx">addCheese</code><code class="p">}</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>or even into a separate module, like so:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">addCheeseAction</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./addCheeseAction"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">CheeseList</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="nx">addCheese</code><code class="p">}</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>In this case, <code>addCheeseAction</code> would be in its own file and read like&#13;
so:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use server"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">redirect</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/navigation"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">revalidatePath</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"next/cache"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">addCheeseAction</code><code class="p">(</code><code class="nx">formData</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">await</code><code class="w"> </code><code class="nx">fetch</code><code class="p">(</code><code class="s2">"https://api.com/add-cheese"</code><code class="p">,</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">method</code><code class="o">:</code><code class="w"> </code><code class="s2">"POST"</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">body</code><code class="o">:</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">name</code><code class="o">:</code><code class="w"> </code><code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"cheese"</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}),</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">});</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="nx">revalidatePath</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">redirect</code><code class="p">(</code><code class="s2">"/cheese"</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>There’s an inherent problem here though, because unlike Remix where all&#13;
components are client components, server components do not support&#13;
interactivity at all since they are not included in the client bundle&#13;
and never loaded by the browser; thus, <code>onClick</code> handlers never actually&#13;
make it to users. To solve this problem, Next.js has a concept of <a data-primary="client components" data-secondary="Next.js" data-type="indexterm" id="ix_clientcomponentsNextjs.08.1362.67"/>client&#13;
components, which are included in the client bundle&#13;
and are loaded by the browser. These components are not server&#13;
components, and thus cannot be asynchronous or have server actions<a data-startref="ix_serveractions.08.1231.63" data-type="indexterm" id="id1007"/>.</p>&#13;
&#13;
<p>Let’s explore adding a cheese, but this time with a mix of server and&#13;
client components. This will also help us react to the form submission&#13;
by immediately providing feedback with a spinner or similar. To do this,&#13;
we’ll create a new component, <em>./app/AddCheeseForm.tsx</em>:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">addCheeseAction</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./addCheeseAction"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">AddCheeseForm</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="nx">addCheeseAction</code><code class="p">}</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Add</code><code class="w"> </code><code class="nx">Cheese</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p class="pagebreak-before">Now that it’s a client component, we can do interactive things—like&#13;
respond to form state changes. Let’s update our <code>AddCheeseForm</code> to do&#13;
that:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">addCheeseAction</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./addCheeseAction"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useFormStatus</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react-dom"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">AddCheeseForm</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">pending</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useFormStatus</code><code class="p">();</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="nx">addCheeseAction</code><code class="p">}</code> <code class="na">method</code><code class="o">=</code><code class="s">"post"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">disabled</code><code class="o">=</code><code class="p">{</code><code class="nx">pending</code><code class="p">}</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"cheese"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code> <code class="na">disabled</code><code class="o">=</code><code class="p">{</code><code class="nx">pending</code><code class="p">}&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">{</code><code class="nx">pending</code><code class="w"> </code><code class="o">?</code><code class="w"> </code><code class="s2">"Loading..."</code><code class="w"> </code><code class="o">:</code><code class="w"> </code><code class="s2">"Add Cheese"</code><code class="p">}</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Because our <code>AddCheeseForm</code> is a client component, we can use the&#13;
<code>useFormStatus</code> to get the status of the form. This is a hook&#13;
provided by React. This hook returns an object with a <code>pending</code> property&#13;
that is <code>true</code> when the form is submitting, and <code>false</code> when the form is&#13;
not submitting. We can use this to disable the form while it’s&#13;
submitting, and to show a loading indicator.</p>&#13;
&#13;
<p>Now, we can use this form in our page, which is a server component, like&#13;
so:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">CheeseList</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./CheeseList"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">AddCheeseForm</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./AddCheeseForm"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">CheesePage</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">This</code><code class="w"> </code><code class="nx">might</code><code class="w"> </code><code class="nx">sound</code><code class="w"> </code><code class="nx">cheesy</code><code class="p">,</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">think</code><code class="w"> </code><code class="nx">you</code><code class="err">'</code><code class="nx">re</code><code class="w"> </code><code class="nx">really</code><code class="w"> </code><code class="nx">grate</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">CheeseList</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">AddCheeseForm</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>As a result, we’ve got a mix of server and client components. The&#13;
<code>CheesePage</code> and <code>CheeseList</code> are server components, and the&#13;
<code>AddCheeseForm</code> is a client component. Both components are reusable and&#13;
can be used elsewhere in our application<a data-startref="ix_mutatingdata.08.1231.8" data-type="indexterm" id="id1008"/><a data-startref="ix_clientcomponentsNextjs.08.1362.67" data-type="indexterm" id="id1009"/>. There are some rules and&#13;
considerations around client and server components, but we’ll explore&#13;
those in <a data-type="xref" href="ch09.html#ch09">Chapter 9</a>.</p>&#13;
&#13;
<p>For now, if we zoom out we can see that Next.js solves similar&#13;
problems as Remix and our own implementation of filesystem-based&#13;
routing, data fetching, and data mutations. It does so in a slightly&#13;
different way, but the underlying mechanisms are somewhat similar.</p>&#13;
&#13;
<p>Ideally, by exploring both of these frameworks, we’re able to understand&#13;
why we would reach for frameworks, the problems they solve, and how&#13;
they solve them for our benefit<a data-startref="ix_Nextjsframeworks.08.1040.8" data-type="indexterm" id="id1010"/>.</p>&#13;
&#13;
<p>Let’s wrap up by talking about how to choose a framework.</p>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Choosing a Framework" data-type="sect1"><div class="sect1" id="id183">&#13;
<h1>Choosing a Framework</h1>&#13;
&#13;
<p>Deciding<a data-primary="frameworks" data-secondary="factors in choosing" data-type="indexterm" id="ix_frameworksfactorsinchoosing.08.1457.9"/> which React framework to use for your project can be a&#13;
challenging decision, as each offers a distinct set&#13;
of features, advantages, and trade-offs. In this section, we will&#13;
attempt to provide some insight into what makes popular React frameworks&#13;
a viable option for developers today, and discuss factors such as&#13;
learning curve, flexibility, and performance, which can guide you in&#13;
choosing the most suitable framework for your specific needs.</p>&#13;
&#13;
<p>It’s worth noting that one framework is not inherently better or worse&#13;
than another. Each framework has its own set of strengths and&#13;
weaknesses, and the best framework for your project will depend on your&#13;
specific requirements and preferences.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Understanding Your Project Needs" data-type="sect2"><div class="sect2" id="id253">&#13;
<h2>Understanding Your Project Needs</h2>&#13;
&#13;
<p>Before we dive into the details of each framework, it’s important to&#13;
understand your project’s specific needs. Here are some critical&#13;
questions to consider:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>What is the scope of your project? Is it a small personal project, a&#13;
medium-sized application with several features, or a large-scale,&#13;
complex application?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are the main functionalities and features you want to include in&#13;
your project?</p>&#13;
</li>&#13;
<li>&#13;
<p>Do you require server-side rendering (SSR), site generation&#13;
(SSG), or a combination of both?</p>&#13;
</li>&#13;
<li>&#13;
<p>Are you building a content-heavy site like a blog or ecommerce site&#13;
that might benefit from excellent SEO?</p>&#13;
</li>&#13;
<li>&#13;
<p>Is real-time data or highly dynamic content a critical part of your&#13;
application?</p>&#13;
</li>&#13;
<li>&#13;
<p>How much flexibility do you require in terms of customization and&#13;
control over the build process?</p>&#13;
</li>&#13;
<li>&#13;
<p>How important are the performance and speed of your application?</p>&#13;
</li>&#13;
<li>&#13;
<p>What is your proficiency level with React and general web development&#13;
&#13;
<span class="keep-together">concepts?</span></p>&#13;
</li>&#13;
<li>&#13;
<p>Who are your target users? Enterprise folks sitting at desks with fast&#13;
internet? Or the general public with a wide range of devices and&#13;
internet speeds?</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Understanding the answers to these questions will give you a clearer&#13;
picture of what you need from a framework.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Next.js" data-type="sect2"><div class="sect2" id="id184">&#13;
<h2>Next.js</h2>&#13;
&#13;
<p>Let’s explore some of these parameters in the context of Next.js<a data-primary="Next.js" data-secondary="in choosing framework" data-secondary-sortas="choosing framework" data-type="indexterm" id="id1011"/>:</p>&#13;
<dl>&#13;
<dt>Learning curve</dt>&#13;
<dd>&#13;
<p>Next.js uses the bleeding edge of React under the&#13;
hood, often making use of canary releases of React. This means that&#13;
Next.js is often ahead of the curve and can be a bit more challenging&#13;
to learn. However, the Next.js team does a great job of documenting the&#13;
framework and providing clear guides for various features, which can&#13;
help you get started quickly.</p>&#13;
</dd>&#13;
<dt>Flexibility</dt>&#13;
<dd>&#13;
<p>Next.js is designed with flexibility in mind between&#13;
static and server rendered content. It also supports entirely&#13;
client-side applications, though this is not its primary use case.&#13;
Next.js also provides a rich ecosystem<a data-primary="ecosystems and tooling" data-secondary="Next.js" data-type="indexterm" id="id1012"/> of plug-ins and integrations,&#13;
which can significantly speed up the development process.</p>&#13;
</dd>&#13;
<dt>Performance</dt>&#13;
<dd>&#13;
<p>Next.js aggressively prioritizes performance<a data-primary="performance" data-secondary="Next.js’s focus on" data-type="indexterm" id="id1013"/>, with a&#13;
focus on static generation and server-side rendering, as well as&#13;
caching. Next.js ships with four distinct purpose-driven caches at the time&#13;
of writing, each tailored to provide the best performance for a number&#13;
of use cases. This performance, though, can come at a cost of friction&#13;
around the boundaries between client/server and the decision-making&#13;
around when to use which.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>It is also worth noting that some members of the team that builds React&#13;
work at Vercel, where Next.js is developed, which suggests an&#13;
extremely tight feedback loop of development between Next.js and React.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Remix" data-type="sect2"><div class="sect2" id="id134">&#13;
<h2>Remix</h2>&#13;
&#13;
<p>Compared to Next.js, Remix<a data-primary="Remix" data-type="indexterm" id="ix_Remix.08.1534.27"/><a data-primary="frameworks" data-secondary="Remix" data-type="indexterm" id="ix_frameworksRemix.08.1534.27"/> is a newer entry to the React framework scene, created around 10 years earlier. It’s built by the creators&#13;
of React Router and emphasizes web fundamentals, making fewer&#13;
assumptions and providing a lot of flexibility:</p>&#13;
<dl>&#13;
<dt>Learning curve</dt>&#13;
<dd>&#13;
<p>Remix might have a slightly flatter learning curve&#13;
because it relies more heavily on web fundamentals and uses React the&#13;
way many have learned it before the heavier emphasis on server&#13;
components.</p>&#13;
</dd>&#13;
<dt>Intuitiveness</dt>&#13;
<dd>&#13;
<p>Remix often gets out of the way and allows the&#13;
fundamentals of the web platform to shine through. This can be a bit of&#13;
a double-edged sword: on one hand, it’s great because it’s intuitive and&#13;
familiar, but on the other hand, it can be a bit frustrating because&#13;
it’s not as “magical” as other frameworks.</p>&#13;
</dd>&#13;
<dt>Performance</dt>&#13;
<dd>&#13;
<p>Remix’s unique approach<a data-primary="performance" data-secondary="Remix’s priorities in" data-type="indexterm" id="id1014"/> to routing and data loading makes&#13;
it efficient and performant. Since data fetching is tied to routes, only&#13;
the necessary data for a specific route is fetched, reducing the overall&#13;
data requirement. Plus, its optimistic UI updates and progressive&#13;
enhancement strategies improve the user experience.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Trade-Offs" data-type="sect2"><div class="sect2" id="id185">&#13;
<h2>Trade-Offs</h2>&#13;
&#13;
<p>Choosing a framework does not come without trade-offs, the meat of which&#13;
revolve around the continuum of convenience versus control. All&#13;
frameworks remove a lot of the brainwork and decision-making around our&#13;
applications by conventionalizing things. For example, frameworks by&#13;
default have answers for questions like:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>How do we do routing?</p>&#13;
</li>&#13;
<li>&#13;
<p>Where do static assets go?</p>&#13;
</li>&#13;
<li>&#13;
<p>Should we server render?</p>&#13;
</li>&#13;
<li>&#13;
<p>Where do we fetch data?</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Given that frameworks so heavily conventionalize these topics and more,&#13;
this takes control away from us, the developers. In exchange, we get&#13;
quite a bit of convenience to charge forward and work on the more&#13;
central aspects of our applications, like the business logic itself.</p>&#13;
&#13;
<p>Most, if not all, trade-offs around frameworks revolve around this&#13;
continuum.</p>&#13;
&#13;
<p>So, how to choose the right framework? It all comes down to your project&#13;
needs and personal preference:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>If you need a somewhat flexible full stack framework, Next.js<a data-primary="Next.js" data-secondary="in choosing framework" data-secondary-sortas="choosing framework" data-type="indexterm" id="ix_Nextjsinchoosingframework.08.1582.64"/> might be&#13;
a better fit since it lets you choose between static, server-side, or&#13;
entirely client-only &#13;
<span class="keep-together">application.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>If you prefer a serverful, progressively enhanced approach with a&#13;
strong adherence to web fundamentals, Remix could be your best bet.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In any case, it’s a good idea to try one out for a smaller&#13;
project or a part of your application. This will give you a better&#13;
understanding of how they work and which one feels most comfortable to&#13;
work with.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Developer Experience" data-type="sect2"><div class="sect2" id="id135">&#13;
<h2>Developer Experience</h2>&#13;
&#13;
<p>Both frameworks offer world-class developer experience, with a focus on&#13;
productivity and ease of use. They both provide a rich set of features&#13;
and tools to help developers build high-quality applications, as we’ve&#13;
seen previously in this chapter.</p>&#13;
&#13;
<p>Build performance becomes increasingly critical as a project grows in&#13;
complexity and size. Both Next.js and Remix have made optimizations to&#13;
improve the build time.</p>&#13;
&#13;
<p>Next.js uses static generation<a data-primary="static site generation (SSG)" data-type="indexterm" id="id1015"/><a data-primary="SSG (static site generation)" data-type="indexterm" id="id1016"/> by default, which means pages are&#13;
prerendered at build time. This can lead to faster page loads, but also&#13;
longer build times, especially for sites with a large number of pages.</p>&#13;
&#13;
<p>To address this, Next.js introduced Incremental Static Regeneration&#13;
(ISR)<a data-primary="Incremental Static Regeneration (ISR)" data-type="indexterm" id="id1017"/><a data-primary="ISR (Incremental Static Regeneration)" data-type="indexterm" id="id1018"/>, allowing developers to regenerate static pages after they have&#13;
been built, without a full rebuild. This feature can significantly&#13;
improve build times for large, dynamic sites.</p>&#13;
&#13;
<p>Remix, on the other hand, has a unique take on build performance. It&#13;
opts for a server-first architecture, which means that pages are&#13;
rendered on demand by the server, and the HTML is sent down to the&#13;
client.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Runtime Performance" data-type="sect2"><div class="sect2" id="id136">&#13;
<h2>Runtime Performance</h2>&#13;
&#13;
<p>Both Next.js and Remix are designed with performance<a data-primary="runtimes" data-type="indexterm" id="id1019"/><a data-primary="performance" data-secondary="frameworks for optimizing" data-type="indexterm" id="id1020"/> in mind and offer&#13;
several optimizations to deliver fast, responsive applications.</p>&#13;
&#13;
<p>Next.js comes with several built-in performance optimizations. It&#13;
supports automatic code splitting, which ensures that only the necessary&#13;
code is loaded for each page. It also has a built-in Image component&#13;
that optimizes image loading<a data-primary="image loading, Next.js" data-type="indexterm" id="id1021"/> for better &#13;
<span class="keep-together">performance.</span></p>&#13;
&#13;
<p>The hybrid SSG/SSR model in Next.js allows developers to choose the&#13;
optimal data fetching strategy for each page, balancing performance and&#13;
freshness. Pages that don’t require fresh data can be prerendered at&#13;
build time, resulting in faster page loads. For pages that require fresh&#13;
data, server-side rendering or ISR can be&#13;
used.</p>&#13;
&#13;
<p>Next.js also provides automatic static optimization for pages without&#13;
blocking data requirements, ensuring they are served as static HTML&#13;
files, leading to faster time to first byte (TTFB)<a data-primary="time to first byte (TTFB)" data-type="indexterm" id="id1022"/><a data-primary="TTFB (time to first byte)" data-type="indexterm" id="id1023"/>.</p>&#13;
&#13;
<p>Finally, Next.js takes full advantage of React Server Components<a data-primary="server components" data-type="indexterm" id="id1024"/> where&#13;
possible, allowing it to send less JavaScript to the client, resulting in&#13;
faster page loads and other overhead.</p>&#13;
&#13;
<p>Remix takes a slightly different approach to performance. Instead of&#13;
prerendering pages, it opts for server rendering, streaming down just&#13;
the HTML that the client needs. This can result in faster TTFB,&#13;
especially for dynamic content.</p>&#13;
&#13;
<p>One of the key features of Remix is its robust caching strategy<a data-primary="caching strategy, Remix" data-type="indexterm" id="id1025"/>. It&#13;
leverages the browser’s native fetch and cache APIs, allowing developers&#13;
to specify caching strategies for different resources. This leads to&#13;
faster page loads and a more resilient application.</p>&#13;
&#13;
<p>Both Next.js and Remix offer compelling benefits for large-scale,&#13;
complex projects. They both excel in developer experience, build&#13;
performance, and runtime performance. Next.js might be a better choice&#13;
if you prefer a mature ecosystem with extensive resources and plug-ins, a&#13;
hybrid SSG/SSR model, and innovative features like ISR. On the other&#13;
hand, Remix could be more suitable if you prefer a server rendered&#13;
approach with instant deploys, a strong emphasis on embracing web&#13;
platform features like fetch and cache APIs, and advanced React concepts&#13;
like Suspense and Server Components.</p>&#13;
&#13;
<p>The most suitable framework for your specific project needs would&#13;
ultimately depend on your team’s expertise, your project requirements,&#13;
and your preference for certain architectural patterns. Regardless of&#13;
the choice, both Next.js and Remix are solid foundations for building&#13;
high-quality, performant React applications<a data-startref="ix_frameworks.08.4.15" data-type="indexterm" id="id1026"/><a data-startref="ix_frameworksfactorsinchoosing.08.1457.9" data-type="indexterm" id="id1027"/><a data-startref="ix_Remix.08.1534.27" data-type="indexterm" id="id1028"/><a data-startref="ix_Nextjsinchoosingframework.08.1582.64" data-type="indexterm" id="id1029"/><a data-startref="ix_frameworksRemix.08.1534.27" data-type="indexterm" id="id1030"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Chapter Review" data-type="sect1"><div class="sect1" id="id254">&#13;
<h1>Chapter Review</h1>&#13;
&#13;
<p>Over the course of this chapter, we’ve delved deep into the concept of&#13;
React frameworks. This chapter allowed us to explore the underlying&#13;
principles, the reasoning, and the practical implications of using&#13;
frameworks.</p>&#13;
&#13;
<p>The discussion began by recapping concurrent React and its implications for&#13;
efficient rendering and user interactivity. We then moved on to explore&#13;
the “why” and the “what” of React frameworks: why they are&#13;
necessary, what benefits they offer, and what trade-offs they entail.</p>&#13;
&#13;
<p>We did this by implementing our own basic framework, which allowed us to&#13;
understand the underlying mechanisms and concepts behind React&#13;
frameworks. We then explored the concept of filesystem-based routing,&#13;
which is a common feature in many React frameworks. We also looked at&#13;
data fetching and how it can be implemented in a framework.</p>&#13;
&#13;
<p>Next, we dived into a comparison between different frameworks, focusing&#13;
primarily on Next.js and Remix. Each framework offers its unique set of&#13;
features and advantages, and the choice often comes down to the specific&#13;
needs of the project. We explored how these frameworks solve for server&#13;
rendering, routing, data fetching, and data mutations, and how they&#13;
compare to our own implementation of these &#13;
<span class="keep-together">features.</span></p>&#13;
&#13;
<p>Through this, we gleaned an understanding of the mechanism through the&#13;
commonalities between our own implementation and the frameworks. We also&#13;
explored the trade-offs involved in using frameworks, and how they can&#13;
be mitigated by understanding the underlying mechanisms.</p>&#13;
&#13;
<p>Finally, we discussed how to choose a framework, and explored some of&#13;
the trade-offs involved in this decision. We also looked at the&#13;
developer experience and runtime performance of frameworks and&#13;
considered what might be the best for our projects.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review Questions" data-type="sect1"><div class="sect1" id="id255">&#13;
<h1>Review Questions</h1>&#13;
&#13;
<p>As we wrap up this chapter, here are some questions to help you review&#13;
the concepts we’ve covered:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>What are the primary reasons for using a React framework like Next.js&#13;
or Remix, and what benefits do they offer?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are some of the trade-offs or downsides that come with using a&#13;
React framework?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are some common problems solved by frameworks?</p>&#13;
</li>&#13;
<li>&#13;
<p>How do these frameworks solve them?</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Up Next" data-type="sect1"><div class="sect1" id="id256">&#13;
<h1>Up Next</h1>&#13;
&#13;
<p>In this chapter, we briefly mentioned React Server Components and began&#13;
to scratch their surface in a crude manner. In the next chapter, we’ll&#13;
intensify our focus on React Server Components and dive a little bit&#13;
deeper: understanding their value proposition and how they work by&#13;
writing a minimal server that renders and serves React Server&#13;
Components.</p>&#13;
&#13;
<p>In addition, we’ll examine why React Server Components require a new&#13;
generation of build tooling, like bundlers, routers, and more.&#13;
Ultimately, we will come away with an improved understanding of React&#13;
Server Components and their underlying mechanism in what is sure to be&#13;
an informative and educational deep dive.</p>&#13;
</div></section>&#13;
</div></section></body></html>