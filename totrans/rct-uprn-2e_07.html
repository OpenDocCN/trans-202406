<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.w3.org/2002/06/xhtml2/ http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd" xmlns:epub="http://www.idpf.org/2007/ops">
<head>
<link href="Styles/Style00.css" rel="stylesheet" type="text/css" />
<link href="Styles/Style01.css" rel="stylesheet" type="text/css" />

<style type="text/css">body{margin:1em;background-color:transparent!important;}#sbo-rt-content *{text-indent:0pt!important;}#sbo-rt-content .bq{margin-right:1em!important;}</style></head>
<body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Building the App’s Components"><div class="chapter" id="ch7">
<h1><span class="label">Chapter 7. </span>Building the App’s Components</h1>


<p>Now that you know all the basics of creating custom React components (and using the built-in ones), using JSX to define the user interfaces, and using <code>create-react-app</code> for building and deploying the results, it’s time to start building a more complete app.</p>

<p>The app <a data-type="indexterm" data-primary="React app" data-secondary="Whinepad example of" id="idm45779435448160"/><a data-type="indexterm" data-primary="Whinepad app example" data-seealso="React app" id="idm45779435420848"/><a data-type="indexterm" data-primary="React app" data-secondary="beginning setup for" id="ch7_term3"/>is called “Whinepad,” and it allows users to keep notes and rate the wines they are trying. It doesn’t have to be wines, really; it could be anything they’d like to <em>whine</em> about. It <a data-type="indexterm" data-primary="CRUD (create, read, update, and delete) application" id="idm45779435417984"/>should do all you would expect from a create, read, update, and delete (CRUD) application. It should also be a client-side app, storing the data on the client. The goal is to learn React, so the non-React parts (e.g., server-side storage, CSS presentation) of the narrative are kept to a minimum.</p>

<p>When building an app, it’s a good idea to start with small, reusable components and combine them to form the whole. The more independent and reusable these components are, the better. This chapter focuses on creating the components, one at a time, and the next chapter puts them all together.</p>






<section data-type="sect1" data-pdf-bookmark="Setup"><div class="sect1" id="idm45779435416016">
<h1>Setup</h1>

<p>First, initialize <a data-type="indexterm" data-primary="Create React App (CRA)" id="ch7_term1"/><a data-type="indexterm" data-primary="React app" data-secondary="Create React App (CRA) for" id="ch7_term2"/>and start the new CRA app:</p>
<pre data-type="programlisting">
$ <strong>cd ~/reactbook/</strong>
$ <strong>npx create-react-app whinepad</strong>
$ <strong>cd whinepad</strong>
$ <strong>npm start</strong></pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Start Coding"><div class="sect1" id="idm45779435409824">
<h1>Start Coding</h1>

<p>Just to verify that all is working as expected, open <em>~/reactbook/whinepad/public/index.html</em> and change the title of the document to match the new app:</p>

<pre data-type="programlisting" data-code-language="html">// before
<code class="nt">&lt;title&gt;</code>React App<code class="nt">&lt;/title&gt;</code>

//after
<code class="nt">&lt;title&gt;</code>Whinepad<code class="nt">&lt;/title&gt;</code></pre>

<p>The browser auto-reloads and you can see the title change (shown in <a data-type="xref" href="#FIG0701">Figure 7-1</a>).</p>

<figure><div id="FIG0701" class="figure">
<img src="Images/rur2_0701.png" alt="rur2 0701" width="600" height="246"/>
<h6><span class="label">Figure 7-1. </span>The beginning of a new app</h6>
</div></figure>

<p>Now, for the purposes of organization, let’s keep <a data-type="indexterm" data-primary="directories, creating" id="idm45779435401712"/><a data-type="indexterm" data-primary="React app" data-secondary="directories for" id="idm45779435401008"/>all the React components and their corresponding CSS inside a new directory <em>whinepad/src/components</em>. Any other code that is not strictly components, like various utilities you might need, can go in <em>whinepad/src/modules</em>. The root <em>src</em> contains all the files CRA generated. You can change them, of course, but any new code goes in either of the two <a data-type="indexterm" data-primary="modules" data-secondary="for building React app" data-secondary-sortas="building React app" id="idm45779435398448"/><a data-type="indexterm" data-startref="ch7_term1" id="idm45779435397200"/><a data-type="indexterm" data-startref="ch7_term2" id="idm45779435396528"/><a data-type="indexterm" data-startref="ch7_term3" id="idm45779435395856"/>new directories <span class="keep-together"><code>components</code></span> or <code>modules</code>:</p>

<pre data-type="programlisting">whinepad/
├──  public/
│   ├── index.html
└── src/
    ├── App.css // CRA-generated
    ├── App.js  // CRA-generated
    ├── ...
    └── components/       // all components live here
        │   ├── Excel.js
        │   ├── Excel.css
        │   ├── ...
        │   └──  ...
        └── modules/      // helper JS modules here
            ├── clone.js
            ├── ...
            └── ...</pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Refactoring the Excel Component"><div class="sect1" id="idm45779435392592">
<h1>Refactoring the Excel Component</h1>

<p>Let’s get Whinepad off the ground. It’s a rating app where you take notes. So how about having the welcome screen be the list of stuff you’ve already rated in a nice table? This means reusing the <code>&lt;Excel&gt;</code> component from <a data-type="xref" href="ch04.xhtml#ch4">Chapter 4</a>.</p>

<p>Let’s grab a version of <code>Excel</code> (extracted from the file <em>04.10.fn.table-reducer.html</em> as it appears toward the end of <a data-type="xref" href="ch04.xhtml#ch4">Chapter 4</a>) and copy it over to <em>whinepad/src/components/Excel.js</em>.</p>

<p><code>Excel</code> can now <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="as reusable" data-secondary-sortas="resuable" id="idm45779435298448"/>be a reusable standalone component that doesn’t know anything about where data is coming from and how the content is inserted into an HTML page. It’s just a React component, one of the building blocks of the app. And you already know that a <a data-type="indexterm" data-primary="components" data-secondary="template of tasks for" id="idm45779435296720"/>usable component has three jobs:</p>

<ul>
<li>
<p>Import dependencies.</p>
</li>
<li>
<p>Do the work.</p>
</li>
<li>
<p>Export the component.</p>
</li>
</ul>

<p>Ignoring the dependencies part for a minute, now <code>Excel</code> can look like so:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="c1">// dependencies go here</code>

<code class="c1">// do the work</code>
<code class="kd">function</code> <code class="nx">Excel</code><code class="p">({</code><code class="nx">headers</code><code class="o">,</code> <code class="nx">initialData</code><code class="p">})</code> <code class="p">{</code>
  <code class="c1">// same as before</code>
<code class="p">}</code>

<code class="c1">// export</code>
<code class="nx">export</code> <code class="k">default</code> <code class="nx">Excel</code><code class="o">;</code></pre>

<p>Back to the <a data-type="indexterm" data-primary="dependencies" data-secondary="importing for React app" id="idm45779435277200"/><a data-type="indexterm" data-primary="global variables" id="idm45779435276352"/><a data-type="indexterm" data-primary="PropTypes" id="idm45779435275680"/><a data-type="indexterm" data-primary="imports for React app" id="ch7_term4"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="imports with" id="ch7_term5"/>dependencies. Before, when dealing with pure HTML, <code>React</code> was a global variable and so was <code>PropTypes</code>. Now you <code>import</code> them:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code></pre>

<p>Now you can use the state hook via <code>React.useState()</code>. However it’s often convenient to assign some of the React properties using the <em>named import</em> syntax:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="p">{</code><code class="nx">useState</code><code class="o">,</code> <code class="nx">useReducer</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code></pre>

<p>And now you <a data-type="indexterm" data-primary="hooks" data-secondary="useState()" id="idm45779435230000"/><a data-type="indexterm" data-primary="useState() hook" id="idm45779435229152"/><a data-type="indexterm" data-primary="state hooks" id="idm45779435228480"/><a data-type="indexterm" data-primary="Excel component, function" data-secondary="reducer hook examples of" id="idm45779435196384"/>can use the state hook with the shorter <code>useState()</code>.</p>

<p>Finally, let’s move <a data-type="indexterm" data-primary="modules" data-secondary="for building React app" data-secondary-sortas="building React app" id="idm45779435194272"/><a data-type="indexterm" data-primary="cloning" data-secondary="module for" id="idm45779435192992"/><a data-type="indexterm" data-primary="copying data" id="idm45779435192048"/>the object cloning helper into its own module, since it’s not really <code>Excel</code>’s job, and moving it will make it easier to replace the quick-and-dirty implementation with a proper library at any time later on. This means importing a new <code>clone</code> module from <code>Excel</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">clone</code> <code class="nx">from</code> <code class="s1">'../modules/clone.js'</code><code class="o">;</code></pre>

<p>The implementation of the clone module lives in <em>modules/</em> directory, the place designed for modules. In other words, it’s a JavaScript file with no dependencies named <em>whinepad/src/modules/clone.js</em> that looks like so:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">function</code> <code class="nx">clone</code><code class="p">(</code><code class="nx">o</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">o</code><code class="p">));</code>
<code class="p">}</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">clone</code><code class="o">;</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When importing <a data-type="indexterm" data-primary="JavaScript" data-secondary="importing files in" id="idm45779435121600"/>JavaScript files, you can omit the <em>.js</em> extension. You can use:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">clone</code> <code class="nx">from</code> <code class="s1">'../modules/clone'</code><code class="p">;</code></pre>

<p>Instead of:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">import</code> <code class="nx">clone</code> <code class="nx">from</code> <code class="s1">'../modules/clone.js'</code><code class="p">;</code></pre>
</div>

<p>And so the new <code>Excel</code> looks like the following:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="p">{</code><code class="nx">useState</code><code class="o">,</code> <code class="nx">useReducer</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">clone</code> <code class="nx">from</code> <code class="s1">'../modules/clone'</code><code class="o">;</code>

<code class="c1">// do the work</code>
<code class="kd">function</code> <code class="nx">Excel</code><code class="p">({</code><code class="nx">headers</code><code class="o">,</code> <code class="nx">initialData</code><code class="p">})</code> <code class="p">{</code>
  <code class="c1">// same as before</code>
<code class="p">}</code>

<code class="c1">// export</code>
<code class="nx">export</code> <code class="k">default</code> <code class="nx">Excel</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Version 0.0.1 of the New App"><div class="sect1" id="idm45779435391968">
<h1>Version 0.0.1 of the New App</h1>

<p>Now you have a standalone reusable component. So let’s <a data-type="indexterm" data-primary="React app" data-secondary="versions of" id="idm45779434977152"/><a data-type="indexterm" data-primary="App.js" id="idm45779434976416"/>use it. The <em>App.js</em> file that was generated by CRA is the top-level component for the application, and you can import <code>Excel</code> there. Deleting the CRA-generated code and replacing with <code>Excel</code> and some temporary data, you get:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="s1">'./App.css'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Excel</code> <code class="nx">from</code> <code class="s1">'./components/Excel'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Excel</code>
        <code class="nx">headers</code><code class="o">=</code><code class="p">{[</code><code class="s1">'Name'</code><code class="o">,</code> <code class="s1">'Year'</code><code class="p">]}</code>
        <code class="nx">initialData</code><code class="o">=</code><code class="p">{[</code>
          <code class="p">[</code><code class="s1">'Charles'</code><code class="o">,</code> <code class="s1">'1859'</code><code class="p">]</code><code class="o">,</code>
          <code class="p">[</code><code class="s1">'Antoine'</code><code class="o">,</code> <code class="s1">'1943'</code><code class="p">]</code><code class="o">,</code>
        <code class="p">]}</code>
      <code class="o">/&gt;</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">App</code><code class="o">;</code></pre>

<p>With this, you have a working app, shown in <a data-type="xref" href="#FIG0702">Figure 7-2</a>. It’s fairly modest, but it can still search and edit <a data-type="indexterm" data-startref="ch7_term4" id="idm45779434885664"/><a data-type="indexterm" data-startref="ch7_term5" id="idm45779434885056"/>data.</p>

<figure><div id="FIG0702" class="figure">
<img src="Images/rur2_0702.png" alt="rur2 0702" width="600" height="322"/>
<h6><span class="label">Figure 7-2. </span>A new app is born</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="CSS"><div class="sect1" id="idm45779434882224">
<h1>CSS</h1>

<p>As discussed in <a data-type="xref" href="ch06.xhtml#ch6">Chapter 6</a>, <a data-type="indexterm" data-primary="CSS" data-secondary="for React components" data-secondary-sortas="React components" id="ch7_term6"/><a data-type="indexterm" data-primary="React app" data-secondary="CSS for" id="ch7_term7"/> let’s have one CSS file per component. So <em>Excel.js</em> component should come (if needed) with an <em>Excel.css</em>. Any class names in <em>Excel.js</em> should be prefixed with <em>Excel-</em>. In the current implementation from <a data-type="xref" href="ch04.xhtml#ch4">Chapter 4</a>, elements are styled using the HTML selectors (e.g. <code>table th {...}</code>), but in a real app consisting of reusable elements, the styles should be scoped to components so they don’t interfere with other components.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are many options when it comes to styling your app. But for the purposes of this discussion, let’s focus on the React parts. A simple CSS naming convention will do the trick.</p>
</div>

<p>Any “global” styles can go in the CRA-created <em>App.css</em>, but these should be limited to a small set of really generic styles, for example the fonts for the whole app. CRA also generates an <em>index.css</em> but to avoid confusion about which global styles go where, let’s delete it.</p>

<p>So the top-level <code>&lt;div&gt;</code> that <code>Excel</code> renders becomes:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="k">return</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Excel"</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="cm">/* everything else */</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
<code class="p">);</code></pre>

<p>Now you can scope the styles to apply only to this component by using the <code>Excel</code> prefix:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.Excel</code> <code class="nt">table</code> <code class="p">{</code>
  <code class="k">width</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code>
<code class="p">}</code>

<code class="nc">.Excel</code> <code class="nt">td</code> <code class="p">{</code>
  <code class="c">/* etc. */</code>
<code class="p">}</code>

<code class="nc">.Excel</code> <code class="nt">th</code> <code class="p">{</code>
  <code class="c">/* etc. */</code>
<code class="p">}</code></pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Local Storage"><div class="sect1" id="idm45779434856224">
<h1>Local Storage</h1>

<p>To keep <a data-type="indexterm" data-startref="ch7_term6" id="idm45779434810800"/><a data-type="indexterm" data-startref="ch7_term7" id="idm45779434810064"/><a data-type="indexterm" data-primary="data" data-secondary="storage of" id="idm45779434809392"/><a data-type="indexterm" data-primary="localStorage" id="idm45779434808448"/><a data-type="indexterm" data-primary="React app" data-secondary="with local storage" data-secondary-sortas="local storage" id="idm45779434807776"/><a data-type="indexterm" data-primary="storage, data" id="idm45779434806560"/>the discussion limited to React as much as possible, let’s keep all the data in the browser and not worry about the server-side parts. But instead of hardcoding the data in the app, let’s use <code>localStorage</code>. If the storage is empty, one default should be enough to hint to the user about the purpose of the app.</p>

<p>The data retrieval can <a data-type="indexterm" data-primary="App.js" id="idm45779434804624"/>happen in the top-level <em>App.js</em>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">headers</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'headers'</code><code class="p">);</code>
<code class="kd">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'data'</code><code class="p">);</code>

<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">headers</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">headers</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'Title'</code><code class="o">,</code> <code class="s1">'Year'</code><code class="o">,</code> <code class="s1">'Rating'</code><code class="o">,</code> <code class="s1">'Comments'</code><code class="p">];</code>
  <code class="nx">data</code> <code class="o">=</code> <code class="p">[[</code><code class="s1">'Red whine'</code><code class="o">,</code> <code class="s1">'2021'</code><code class="o">,</code> <code class="s1">'3'</code><code class="o">,</code> <code class="s1">'meh'</code><code class="p">]];</code>
<code class="p">}</code></pre>

<p>Let’s also just <a data-type="indexterm" data-primary="button, search" id="idm45779434775824"/><a data-type="indexterm" data-primary="search button" id="idm45779434697248"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="removing search button from" id="idm45779434696640"/>remove the “search” button from <code>Excel</code>; it should become a part of its own component, better separated from the <code>Excel</code> component.</p>

<p>And with that, you’re on a path to a great new app (see <a data-type="xref" href="#FIG0703">Figure 7-3</a>).</p>

<figure><div id="FIG0703" class="figure">
<img src="Images/rur2_0703.png" alt="rur2 0703" width="600" height="79"/>
<h6><span class="label">Figure 7-3. </span>An app with style</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Components"><div class="sect1" id="idm45779434691360">
<h1>The Components</h1>

<p>Now that you know the setup is working, it’s time to <a data-type="indexterm" data-primary="components" data-secondary="of app" data-seealso="React app" data-secondary-sortas="app" id="idm45779434689792"/><a data-type="indexterm" data-primary="optimization of performance" id="ch7_term8"/><a data-type="indexterm" data-primary="React app" data-secondary="beginning setup for" id="ch7_term9"/><a data-type="indexterm" data-primary="React app" data-secondary="efficiency with" id="ch7_term10"/>build all the components that make up the app. Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#FIG0704">7-4</a> and
<a data-type="xref" data-xrefstyle="select:labelnumber" href="#FIG0705">7-5</a> show screenshots of the app-to-be.</p>

<figure><div id="FIG0704" class="figure">
<img src="Images/rur2_0704.png" alt="rur2 0704" width="600" height="210"/>
<h6><span class="label">Figure 7-4. </span>The Whinepad app to be built</h6>
</div></figure>

<figure><div id="FIG0705" class="figure">
<img src="Images/rur2_0705.png" alt="rur2 0705" width="600" height="305"/>
<h6><span class="label">Figure 7-5. </span>Editing items</h6>
</div></figure>

<p>Reusing the <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="limitations of" id="idm45779434677744"/><a data-type="indexterm" data-primary="React app" data-secondary="component reusability in" id="idm45779434676672"/>existing <code>&lt;Excel&gt;</code> component is one way to get started; however, this component is doing too much. It’s better to “divide and conquer” by splitting it into small, reusable components. For example, the buttons should be their own components so they can be reused outside of the context of the <code>Excel</code> table.</p>

<p>Additionally, the app needs some other specialized components such as a rating widget that shows emojis instead of just a number, a dialog component, and so on. Before getting started with new components, let’s add one more helper—a component discovery tool. Its goals are to:</p>

<ul>
<li>
<p>Let you develop and test components in isolation. Often using a component in an app leads you to “marry” the component to the app and reduce its reusability. Having the component by itself forces you to make better decisions about decoupling it from the environment.</p>
</li>
<li>
<p>Let other team members discover and reuse existing components. As your app grows, so does the team. To minimize the risk of two people working on strikingly similar components and to promote component reuse (which leads to faster app development), it’s a good idea to have all components in one place, together with examples of how they are meant to be used.</p>
</li>
</ul>

<p>There are tools available that allow for <a data-type="indexterm" data-primary="discovery tool" id="ch7_term11"/><a data-type="indexterm" data-primary="React app" data-secondary="discovery tool in" id="ch7_term12"/>component discovery and testing, but let’s not introduce another dependency. Instead, let’s take a lightweight do-it-yourself approach.</p>








<section data-type="sect2" data-pdf-bookmark="Discovery"><div class="sect2" id="idm45779434667760">
<h2>Discovery</h2>

<p>A discovery tool can be implemented as a new component that lives together with the app.</p>

<p>This task can be as simple as creating a new component (<em>src/components/Discovery.js</em>) where you list all your components. You can even render the same component with different props to demonstrate various uses of a component. For example:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">Excel</code> <code class="nx">from</code> <code class="s1">'./Excel'</code><code class="o">;</code>
<code class="c1">// more imports here...</code>

<code class="kd">function</code> <code class="nx">Discovery</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Excel</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Excel</code>
        <code class="nx">headers</code><code class="o">=</code><code class="p">{[</code><code class="s1">'Name'</code><code class="o">,</code> <code class="s1">'Year'</code><code class="p">]}</code>
        <code class="nx">initialData</code><code class="o">=</code><code class="p">{[</code>
          <code class="p">[</code><code class="s1">'Charles'</code><code class="o">,</code> <code class="s1">'1859'</code><code class="p">]</code><code class="o">,</code>
          <code class="p">[</code><code class="s1">'Antoine'</code><code class="o">,</code> <code class="s1">'1943'</code><code class="p">]</code><code class="o">,</code>
        <code class="p">]}</code>
      <code class="o">/&gt;</code>
      <code class="p">{</code><code class="cm">/* more components here */</code><code class="p">}</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Discovery</code><code class="o">;</code></pre>

<p>Now you can load the discovery component instead of the real app, by <a data-type="indexterm" data-primary="App.js" id="idm45779434661056"/>using the URL as a condition in your <em>App.js</em>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">isDiscovery</code> <code class="o">=</code> <code class="nx">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">pathname</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="sr">/\//g</code><code class="o">,</code> <code class="s1">''</code><code class="p">)</code> <code class="o">===</code> <code class="s1">'discovery'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">isDiscovery</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Discovery</code> <code class="o">/&gt;;</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Excel</code> <code class="nx">headers</code><code class="o">=</code><code class="p">{</code><code class="nx">headers</code><code class="p">}</code> <code class="nx">initialData</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">}</code> <code class="o">/&gt;</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>Now, if you load <em>http://localhost:3000/discovery</em> instead of <em>http://localhost:3000/</em>, you can see all the components you’ve added to the <code>&lt;Discovery&gt;</code>. At this point there’s only a single component, but this page will grow soon enough. Your new component discovery tool (see <a data-type="xref" href="#FIG0706">Figure 7-6</a>) is the place to start playing with your new components as they come to life. Let’s get to work and build them—one at <a data-type="indexterm" data-startref="ch7_term8" id="idm45779434473152"/><a data-type="indexterm" data-startref="ch7_term9" id="idm45779434472480"/><a data-type="indexterm" data-startref="ch7_term10" id="idm45779434471808"/><a data-type="indexterm" data-startref="ch7_term11" id="idm45779434471136"/><a data-type="indexterm" data-startref="ch7_term12" id="idm45779434470464"/>a time.</p>

<figure><div id="FIG0706" class="figure">
<img src="Images/rur2_0706.png" alt="rur2 0706" width="600" height="247"/>
<h6><span class="label">Figure 7-6. </span>Whinepad’s component discovery tool</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Logo and a Body"><div class="sect1" id="idm45779434467696">
<h1>Logo and a Body</h1>

<p>Starting with a few simple components you can verify that things are working and to get excited as you see quick progress. Here are <a data-type="indexterm" data-primary="logo component" id="idm45779434466048"/><a data-type="indexterm" data-primary="React app" data-secondary="logo component in" id="idm45779434465344"/>two new components that every app needs:</p>








<section data-type="sect2" data-pdf-bookmark="Logo"><div class="sect2" id="idm45779434464080">
<h2>Logo</h2>

<p>A <em>components/Logo.js</em> doesn’t need much. And just to show it’s possible, let’s use an arrow function to define this component:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s1">'./../images/whinepad-logo.svg'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">Logo</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">width</code><code class="o">=</code><code class="s2">"300"</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Whinepad logo"</code> <code class="o">/&gt;;</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Logo</code><code class="o">;</code></pre>

<p>The image files you need you can store in <em>src/images/</em>, siblings to the components found in <em>src/components/</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Body"><div class="sect2" id="idm45779434434656">
<h2>Body</h2>

<p>The body <a data-type="indexterm" data-primary="Body component" id="idm45779434433088"/><a data-type="indexterm" data-primary="React app" data-secondary="Body component in" id="idm45779434398064"/>is also a simple place for a few styles, and it merely renders the children passed to it:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="s1">'./Body.css'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">Body</code> <code class="o">=</code> <code class="p">({</code><code class="nx">children</code><code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Body"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">children</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;;</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Body</code><code class="o">;</code></pre>

<p>In the <em>Body.css</em>, you refer to images the same way as in a JavaScript file: relative to where the CSS is located. The build process takes care to extract the images referred to in the code and package them with the rest of the app in the <em>build/</em> directory (as you saw in the previous chapter):</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.Body</code> <code class="p">{</code>
  <code class="k">background</code><code class="o">:</code> <code class="sx">url('./../images/back.jpg')</code> <code class="nb">no-repeat</code> <code class="nb">center</code> <code class="nb">center</code> <code class="nb">fixed</code><code class="p">;</code>
  <code class="k">background-size</code><code class="o">:</code> <code class="n">cover</code><code class="p">;</code>
  <code class="k">padding</code><code class="o">:</code> <code class="m">40px</code><code class="p">;</code>
<code class="p">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discoverable"><div class="sect2" id="idm45779436945840">
<h2>Discoverable</h2>

<p>These are really simple components (and maybe unnecessary, you may argue, but apps do tend to grow), and they illustrate how you start assembling the app from little puzzle pieces. And since they exist, they <a data-type="indexterm" data-primary="discovery tool" id="idm45779434320608"/><a data-type="indexterm" data-primary="React app" data-secondary="discovery tool in" id="idm45779434319904"/>should be in the discovery tool (as shown in <a data-type="xref" href="#FIG0707">Figure 7-7</a>):</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">Logo</code> <code class="nx">from</code> <code class="s1">'./Logo'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Header</code> <code class="nx">from</code> <code class="s1">'./Header'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Body</code> <code class="nx">from</code> <code class="s1">'./Body'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">Discovery</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Discovery"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Logo</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">style</code><code class="o">=</code><code class="p">{{</code><code class="nx">background</code><code class="o">:</code> <code class="s1">'#f6f6f6'</code><code class="o">,</code> <code class="nx">display</code><code class="o">:</code> <code class="s1">'inline-block'</code><code class="p">}}</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">Logo</code> <code class="o">/&gt;</code>
      <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>

      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Body</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Body</code><code class="o">&gt;</code><code class="nx">I</code> <code class="nx">am</code> <code class="nx">content</code> <code class="nx">inside</code> <code class="nx">the</code> <code class="nx">body</code><code class="o">&lt;/</code><code class="nx">Body</code><code class="o">&gt;</code>

      <code class="p">{</code><code class="cm">/* and so on */</code><code class="p">}</code>

    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<figure><div id="FIG0707" class="figure">
<img src="Images/rur2_0707.png" alt="rur2 0707" width="600" height="253"/>
<h6><span class="label">Figure 7-7. </span>Starting to build the library of components</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="&lt;Button&gt; Component"><div class="sect1" id="idm45779434164304">
<h1>&lt;Button&gt; Component</h1>

<p>It’s not an <a data-type="indexterm" data-primary="Button component" id="ch7_term13"/><a data-type="indexterm" data-primary="React app" data-secondary="Button component in" id="ch7_term14"/>exaggeration to generalize that every app needs a button. It’s often a nicely styled vanilla HTML <code>&lt;button&gt;</code>, but sometimes it may have to be an <code>&lt;a&gt;</code>, as was necessary in <a data-type="xref" href="ch03.xhtml#ch3">Chapter 3</a> for the download buttons. How about making the new shiny <code>&lt;Button&gt;</code> take an optional <code>href</code> property? If present, it renders an <code>&lt;a&gt;</code> underneath it all.</p>

<p>In the <a data-type="indexterm" data-primary="test-driven development (TDD)" id="idm45779434156912"/>spirit of test-driven development (TDD), you can start backwards by defining example usage of the component in the <code>&lt;Discovery&gt;</code> component:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'./Button'</code><code class="o">;</code>

<code class="c1">// ...</code>

<code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Buttons</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
  <code class="nx">Button</code> <code class="k">with</code> <code class="nx">onClick</code><code class="o">:</code><code class="p">{</code><code class="s1">' '</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">alert</code><code class="p">(</code><code class="s1">'ouch'</code><code class="p">)}</code><code class="o">&gt;</code><code class="nx">Click</code> <code class="nx">me</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
  <code class="nx">A</code> <code class="nx">link</code><code class="o">:</code> <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">href</code><code class="o">=</code><code class="s2">"https://reactjs.org/"</code><code class="o">&gt;</code><code class="nx">Follow</code> <code class="nx">me</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
  <code class="nx">Custom</code> <code class="kd">class</code> <code class="nx">name</code><code class="o">:</code><code class="p">{</code><code class="s1">' '</code><code class="p">}</code>
  <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Discovery-custom-button"</code><code class="o">&gt;</code><code class="nx">I</code> <code class="k">do</code> <code class="nx">nothing</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code></pre>

<p>(Should we call it discovery-driven development, or DDD, then?)</p>








<section data-type="sect2" data-pdf-bookmark="Button.js"><div class="sect2" id="idm45779434154992">
<h2>Button.js</h2>

<p>Let’s see <em>components/Button.js</em> in its entirety:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">classNames</code> <code class="nx">from</code> <code class="s1">'classnames'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Button.css'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">Button</code> <code class="o">=</code> <code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="o">=&gt;</code>
  <code class="nx">props</code><code class="p">.</code><code class="nx">href</code> <code class="o">?</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">a</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">(</code><code class="s1">'Button'</code><code class="o">,</code> <code class="nx">props</code><code class="p">.</code><code class="nx">className</code><code class="p">)}</code><code class="o">&gt;</code>
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">children</code><code class="p">}</code>
    <code class="o">&lt;/</code><code class="nx">a</code><code class="o">&gt;</code>
  <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">button</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">(</code><code class="s1">'Button'</code><code class="o">,</code> <code class="nx">props</code><code class="p">.</code><code class="nx">className</code><code class="p">)}</code> <code class="o">/&gt;</code>
  <code class="p">);</code>

<code class="nx">Button</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">href</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Button</code><code class="o">;</code></pre>

<p>This component is short, but there are a <a data-type="indexterm" data-primary="classnames package" id="ch7_term15"/>few things to note:</p>

<ul>
<li>
<p>It uses the <code>classnames</code> module (more to follow).</p>
</li>
<li>
<p>It uses a <em>function expression</em> syntax (<code>const Button = () =&gt; {}</code> as opposed to <code>function Button() {}</code>). There’s really no reason to use this syntax in this context; it’s up to you which syntax you prefer, but it’s nice to know it’s possible.</p>
</li>
<li>
<p>It uses the <a data-type="indexterm" data-primary="spread operator/attributes" id="idm45779433885456"/><a data-type="indexterm" data-primary="attributes, spread" id="idm45779433884704"/><a data-type="indexterm" data-primary="JSX (JavaScript XML)" data-secondary="spread attributes in" id="idm45779433884032"/>spread operator <code>...props</code> as a convenient way to say: whatever properties were passed to <code>Button</code>, carry them over to the underlying HTML element.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="classnames Package"><div class="sect2" id="idm45779433881680">
<h2>classnames Package</h2>

<p>Remember this line?</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">classNames</code> <code class="nx">from</code> <code class="s1">'classnames'</code><code class="o">;</code></pre>

<p>The <code>classnames</code> package  gives you a helpful function when dealing with CSS class names. It helps with the common task of having your component use its own classes but is also flexible enough to allow customization via class names passed by the <span class="keep-together">parent</span>.</p>

<p>Bringing in the package to your CRA setup involves running:</p>
<pre data-type="programlisting">
$ <strong>cd ~/reactbook/whinepad</strong>
$ <strong>npm i classnames</strong></pre>

<p>Notice <a data-type="indexterm" data-primary="package.json" id="idm45779433873216"/><a data-type="indexterm" data-primary="React app" data-secondary="package.json for" id="idm45779433872480"/>that your <em>package.json</em> is updated with the new dependency.</p>

<p>Using the package’s only function:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">cssclasses</code> <code class="o">=</code> <code class="nx">classNames</code><code class="p">(</code><code class="s1">'Button'</code><code class="o">,</code> <code class="nx">props</code><code class="p">.</code><code class="nx">className</code><code class="p">);</code></pre>

<p>This line merges the <code>Button</code> class name with any (if any) class names passed as properties when creating the component (see <a data-type="xref" href="#FIG0708">Figure 7-8</a>).</p>

<figure><div id="FIG0708" class="figure">
<img src="Images/rur2_0708.png" alt="rur2 0708" width="600" height="308"/>
<h6><span class="label">Figure 7-8. </span><code>&lt;Button&gt;</code> with a custom class name</h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You can always do it yourself and concatenate class names, but <code>classnames</code> is a tiny package that makes it more convenient to do this common task. It also lets you set class names conditionally, which is convenient too, for example:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">({</code>
  <code class="s1">'mine'</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code> <code class="c1">// unconditional</code>
  <code class="s1">'highlighted'</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">active</code><code class="o">,</code> <code class="c1">// dependent on the</code>
                                    <code class="c1">// state...</code>
  <code class="s1">'hidden'</code><code class="o">:</code> <code class="k">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">hide</code><code class="o">,</code> <code class="c1">// ... or properties</code>
<code class="p">})}</code> <code class="o">/&gt;</code></pre>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Forms"><div class="sect1" id="idm45779433881088">
<h1>Forms</h1>

<p>Let’s move <a data-type="indexterm" data-startref="ch7_term13" id="idm45779433782208"/><a data-type="indexterm" data-startref="ch7_term14" id="idm45779433781472"/><a data-type="indexterm" data-startref="ch7_term15" id="idm45779433780800"/><a data-type="indexterm" data-primary="forms in React app" id="ch7_term18"/>on to the next task, which is essential to any data-entry app: dealing with forms. As app developers, we’re rarely satisfied with the look and feel of the browser’s built-in form inputs and we tend to create our own versions. The Whinepad app could not possibly be an exception.</p>

<p>Let’s have a generic <code>&lt;FormInput&gt;</code> component—a factory, if you will. Depending on its <code>type</code> property, this component should delegate the input creation to more specialized components, for example, <code>&lt;Suggest&gt;</code> input, <code>&lt;Rating&gt;</code> input, and so on.</p>

<p>Let’s start with the lower-level components.</p>








<section data-type="sect2" data-pdf-bookmark="&lt;Suggest&gt;"><div class="sect2" id="idm45779433725312">
<h2>&lt;Suggest&gt;</h2>

<p>Fancy <a data-type="indexterm" data-primary="forms in React app" data-secondary="for auto-suggest prompts" data-secondary-sortas="auto-suggest prompts" id="ch7_term17"/><a data-type="indexterm" data-primary="Suggest input" id="ch7_term16"/>auto-suggest (a.k.a. typeahead) inputs are common on the Web, but let’s keep it simple (as in <a data-type="xref" href="#FIG0709">Figure 7-9</a>) and piggyback on what the browser already provides—namely, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist"><code>&lt;datalist&gt;</code></a> HTML element.</p>

<p>First things first—update the discovery app:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Suggest</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="nx">Suggest</code> <code class="nx">options</code><code class="o">=</code><code class="p">{[</code><code class="s1">'eenie'</code><code class="o">,</code> <code class="s1">'meenie'</code><code class="o">,</code> <code class="s1">'miney'</code><code class="o">,</code> <code class="s1">'mo'</code><code class="p">]}</code> <code class="o">/&gt;</code>
<code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code></pre>

<p>Now off to implementing the component in <em>components/Suggest.js</em>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">Suggest</code><code class="p">({</code><code class="nx">id</code><code class="o">,</code> <code class="nx">defaultValue</code> <code class="o">=</code> <code class="s1">''</code><code class="o">,</code> <code class="nx">options</code><code class="o">=</code><code class="p">[]})</code> <code class="p">{</code>

  <code class="kd">const</code> <code class="nx">randomid</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">().</code><code class="nx">toString</code><code class="p">(</code><code class="mi">16</code><code class="p">).</code><code class="nx">substring</code><code class="p">(</code><code class="mi">2</code><code class="p">);</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code>
        <code class="nx">list</code><code class="o">=</code><code class="p">{</code><code class="nx">randomid</code><code class="p">}</code>
        <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">defaultValue</code><code class="p">}</code>
      <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">datalist</code> <code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">randomid</code><code class="p">}</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">options</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">item</code><code class="o">,</code> <code class="nx">idx</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code>
          <code class="o">&lt;</code><code class="nx">option</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">item</code><code class="p">}</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">idx</code><code class="p">}</code> <code class="o">/&gt;</code>
        <code class="p">))}</code>
      <code class="o">&lt;/</code><code class="nx">datalist</code><code class="o">&gt;</code>
    <code class="o">&lt;/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="nx">Suggest</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">defaultValue</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="o">,</code>
  <code class="nx">options</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">arrayOf</code><code class="p">(</code><code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="p">)</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Suggest</code><code class="o">;</code></pre>

<p>As the preceding code demonstrates, there’s nothing special about this component; it’s just a wrapper around an <code>&lt;input&gt;</code> with a <code>&lt;datalist&gt;</code> attached to it (via the <span class="keep-together"><code>randomid</code></span>).</p>

<figure><div id="FIG0709" class="figure">
<img src="Images/rur2_0709.png" alt="rur2 0709" width="412" height="427"/>
<h6><span class="label">Figure 7-9. </span>The <code>&lt;Suggest&gt;</code> input in action</h6>
</div></figure>

<p>In terms of JavaScript syntax, this <a data-type="indexterm" data-primary="destructuring assignment" id="idm45779433488160"/><a data-type="indexterm" data-primary="JavaScript" data-secondary="destructuring assignment in" id="idm45779433487392"/>example shows how it’s possible to use the <em>destructuring assignment</em> to assign more than one property to a variable and at the same time define default values:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="c1">// before</code>
<code class="kd">function</code> <code class="nx">Suggest</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="nx">id</code> <code class="o">=</code> <code class="nx">props</code><code class="p">.</code><code class="nx">id</code><code class="o">;</code>
  <code class="kd">const</code> <code class="nx">defaultValue</code> <code class="o">=</code> <code class="nx">props</code><code class="p">.</code><code class="nx">defaultValue</code> <code class="o">||</code> <code class="s1">''</code><code class="o">;</code>
  <code class="kd">const</code> <code class="nx">options</code> <code class="o">=</code> <code class="nx">props</code><code class="p">.</code><code class="nx">options</code> <code class="o">||</code> <code class="p">[];</code>
  <code class="c1">// ...</code>
<code class="p">}</code>

<code class="c1">// after</code>
<code class="kd">function</code> <code class="nx">Suggest</code><code class="p">({</code><code class="nx">id</code><code class="o">,</code> <code class="nx">defaultValue</code> <code class="o">=</code> <code class="s1">''</code><code class="o">,</code> <code class="nx">options</code><code class="o">=</code><code class="p">[]})</code> <code class="p">{}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="&lt;Rating&gt; Component"><div class="sect2" id="idm45779433724688">
<h2>&lt;Rating&gt; Component</h2>

<p>The app <a data-type="indexterm" data-startref="ch7_term16" id="idm45779433402448"/><a data-type="indexterm" data-startref="ch7_term17" id="idm45779433401808"/><a data-type="indexterm" data-primary="forms in React app" data-secondary="for rating inputs" data-secondary-sortas="rating inputs" id="ch7_term19"/><a data-type="indexterm" data-primary="Rating input" id="ch7_term20"/><a data-type="indexterm" data-primary="widget for rating inputs" id="ch7_term21"/>is about taking notes of things you try. The laziest way to take notes is by using star ratings, for example a scale of whole numbers from 1 through 5, with 5 being the highest/best rating.</p>

<p>This highly reusable component can be configured to:</p>

<ul>
<li>
<p>Use any number of “stars.” Default is 5, but why not, say, 11?</p>
</li>
<li>
<p>Be read-only, because sometimes you don’t want accidental clicks on the stars to change that all-important rating data.</p>
</li>
</ul>

<p>Test the component in the discovery tool (see <a data-type="xref" href="#FIG0710">Figure 7-10</a>):</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;h2&gt;</code>Rating<code class="nt">&lt;/h2&gt;</code>
<code class="nt">&lt;p&gt;</code>
  No initial value: <code class="nt">&lt;Rating</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;p&gt;</code>
  Initial value 4: <code class="nt">&lt;Rating</code> <code class="na">defaultValue=</code><code class="s">{4}</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;p&gt;</code>
  This one goes to 11: <code class="nt">&lt;Rating</code> <code class="na">max=</code><code class="s">{11}</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/p&gt;</code>
<code class="nt">&lt;p&gt;</code>
  Read-only: <code class="nt">&lt;Rating</code> <code class="na">readonly=</code><code class="s">{true}</code> <code class="na">defaultValue=</code><code class="s">{3}</code> <code class="nt">/&gt;</code>
<code class="nt">&lt;/p&gt;</code></pre>

<figure><div id="FIG0710" class="figure">
<img src="Images/rur2_0710.png" alt="rur2 0710" width="600" height="325"/>
<h6><span class="label">Figure 7-10. </span>A rating widget</h6>
</div></figure>

<p>The bare necessities of the implementation include setting up properties, their types and default values, as well as the state to be maintained:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">classNames</code> <code class="nx">from</code> <code class="s1">'classnames'</code><code class="o">;</code>
<code class="kd">import</code> <code class="p">{</code><code class="nx">useState</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Rating.css'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">Rating</code><code class="p">({</code><code class="nx">id</code><code class="o">,</code> <code class="nx">defaultValue</code> <code class="o">=</code> <code class="mi">0</code><code class="o">,</code> <code class="nx">max</code> <code class="o">=</code> <code class="mi">5</code><code class="o">,</code> <code class="nx">readonly</code> <code class="o">=</code> <code class="kc">false</code><code class="p">})</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">rating</code><code class="o">,</code> <code class="nx">setRating</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="nx">defaultValue</code><code class="p">);</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">tempRating</code><code class="o">,</code> <code class="nx">setTempRating</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="nx">defaultValue</code><code class="p">);</code>

  <code class="c1">// TODO the rendering goes here...</code>

<code class="p">}</code>

<code class="nx">Rating</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">defaultValue</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">number</code><code class="o">,</code>
  <code class="nx">readonly</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">bool</code><code class="o">,</code>
  <code class="nx">max</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">number</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Rating</code><code class="o">;</code></pre>

<p>Properties are self-explanatory: <code>max</code> is the number of stars, and <code>readonly</code> makes the widget, well, read-only. The state contains <code>rating</code>, which is the current value of stars assigned, and <code>tempRating</code>, which is to be used when the user moves the mouse around the component but is not yet ready to click and commit to a rating.</p>

<p>Next comes <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="rendering of" id="idm45779433194688"/><a data-type="indexterm" data-primary="rendering" data-secondary="of Excel app components" data-secondary-sortas="Excel app components" id="idm45779433193616"/>the rendering. It has:</p>

<ul>
<li>
<p>A loop to make stars between 1 and <code>props.max</code>. The stars are just the emoji symbol <code>&amp;#128514;</code>. When the <code>RatingOn</code> style is <em>not</em> applied, the stars <a data-type="indexterm" data-primary="CSS" data-secondary="for React components" data-secondary-sortas="React components" id="ch7_term22"/><a data-type="indexterm" data-primary="React app" data-secondary="CSS for" id="ch7_term23"/>become grey with the help of a CSS filter (<code>filter: grayscale(0.9);</code>).</p>
</li>
<li>
<p>A hidden input to act as a real form input and let the value be harvestable in a generic fashion (just like any old <code>&lt;input&gt;</code>):</p>
</li>
</ul>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">stars</code> <code class="o">=</code> <code class="p">[];</code>
<code class="k">for</code> <code class="p">(</code><code class="nx">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code> <code class="nx">i</code> <code class="o">&lt;=</code> <code class="nx">max</code><code class="o">;</code> <code class="nx">i</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">stars</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">span</code>
      <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">i</code> <code class="o">&lt;=</code> <code class="nx">tempRating</code> <code class="o">?</code> <code class="s1">'RatingOn'</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code>
      <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">i</code><code class="p">}</code>
      <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="p">(</code><code class="nx">readonly</code> <code class="o">?</code> <code class="kc">null</code> <code class="o">:</code> <code class="nx">setRating</code><code class="p">(</code><code class="nx">i</code><code class="p">))}</code>
      <code class="nx">onMouseOver</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="p">(</code><code class="nx">readonly</code> <code class="o">?</code> <code class="kc">null</code> <code class="o">:</code> <code class="nx">setTempRating</code><code class="p">(</code><code class="nx">i</code><code class="p">))}</code><code class="o">&gt;</code>
      <code class="o">&amp;</code><code class="err">#</code><code class="mi">128514</code><code class="o">;</code>
    <code class="o">&lt;/</code><code class="nx">span</code><code class="o">&gt;,</code>
  <code class="p">);</code>
<code class="p">}</code>
<code class="k">return</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">span</code>
    <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">({</code>
      <code class="nx">Rating</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
      <code class="nx">RatingReadonly</code><code class="o">:</code> <code class="nx">readonly</code><code class="o">,</code>
    <code class="p">})}</code>
    <code class="nx">onMouseOut</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">setTempRating</code><code class="p">(</code><code class="nx">rating</code><code class="p">)}</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">stars</code><code class="p">}</code>
    <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"hidden"</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">rating</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="o">&lt;/</code><code class="nx">span</code><code class="o">&gt;</code>
<code class="p">);</code></pre>

<p>When the <a data-type="indexterm" data-primary="mouse movements, responses to" id="idm45779433183488"/>user moves the mouse over the component, the <code>tempRating</code> state is getting updated, which changes the <code>RatingOn</code> class name. When <a data-type="indexterm" data-primary="clicks, event handling with" id="idm45779433181920"/>the user clicks, the real <span class="keep-together"><code>rating</code></span> state is getting updated, which also updates the hidden input. Leaving the component (on mouse out) abandons the <code>tempRating</code>, making it the same as the <span class="keep-together"><code>rating</code></span>.</p>

<p>Here you can <a data-type="indexterm" data-primary="conditional CSS" id="idm45779432994000"/><a data-type="indexterm" data-primary="CSS" data-secondary="conditional" id="idm45779432993264"/><a data-type="indexterm" data-primary="classNames() function" id="idm45779432992320"/>also see an example of using conditional CSS class names with the <code>classNames</code> function. The class <code>Rating</code> is always applied while the <code>RatingReadonly</code> is applied only when the <code>readonly</code> prop is set to <code>true</code>.</p>

<p>And here’s the relevant part of the CSS that deals with read-only and mouseover <a data-type="indexterm" data-startref="ch7_term19" id="idm45779432989072"/><a data-type="indexterm" data-startref="ch7_term20" id="idm45779432988368"/><a data-type="indexterm" data-startref="ch7_term21" id="idm45779432987696"/><a data-type="indexterm" data-startref="ch7_term22" id="idm45779432987024"/><a data-type="indexterm" data-startref="ch7_term23" id="idm45779432986352"/>behaviors:</p>

<pre data-type="programlisting" data-code-language="css"><code class="nc">.Rating</code> <code class="p">{</code><code class="k">cursor</code><code class="o">:</code> <code class="nb">pointer</code><code class="p">;}</code>
<code class="nc">.Rating.RatingReadonly</code> <code class="p">{</code><code class="k">cursor</code><code class="o">:</code> <code class="nb">auto</code><code class="p">;}</code>
<code class="nc">.Rating</code> <code class="nt">span</code> <code class="p">{</code><code class="k">filter</code><code class="o">:</code> <code class="n">grayscale</code><code class="p">(</code><code class="m">0</code><code class="o">.</code><code class="m">9</code><code class="p">);}</code>
<code class="nc">.Rating</code> <code class="nc">.RatingOn</code> <code class="p">{</code><code class="k">filter</code><code class="o">:</code> <code class="n">grayscale</code><code class="p">(</code><code class="m">0</code><code class="p">);}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="A &lt;FormInput&gt; “Factory”"><div class="sect2" id="idm45779433403040">
<h2>A &lt;FormInput&gt; “Factory”</h2>

<p>Next comes a <a data-type="indexterm" data-primary="FormInput component" id="ch7_term24"/><a data-type="indexterm" data-primary="forms in React app" data-secondary="for generic inputs" data-secondary-sortas="generic inputs" id="ch7_term25"/>generic <code>&lt;FormInput&gt;</code> that is capable of producing different inputs based on the given properties. This will allow you to generalize the whole app and turn it from taking wine notes to, say, managing your personal book library via a simple configuration. More on this in a moment.</p>

<p>Testing the <code>&lt;FormInput&gt;</code> in the discovery app (see <a data-type="xref" href="#FIG0711">Figure 7-11</a>):</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Form</code> <code class="nx">inputs</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">table</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Discovery-pad"</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="nx">tbody</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Vanilla</code> <code class="nx">input</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;&lt;</code><code class="nx">FormInput</code> <code class="sr">/&gt;&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Prefilled</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;&lt;</code><code class="nx">FormInput</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="s2">"with a default"</code> <code class="sr">/&gt;&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Year</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;&lt;</code><code class="nx">FormInput</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"year"</code> <code class="sr">/&gt;&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Rating</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;&lt;</code><code class="nx">FormInput</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"rating"</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="mi">4</code><code class="p">}</code> <code class="sr">/&gt;&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Suggest</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">FormInput</code>
          <code class="nx">type</code><code class="o">=</code><code class="s2">"suggest"</code>
          <code class="nx">options</code><code class="o">=</code><code class="p">{[</code><code class="s1">'red'</code><code class="o">,</code> <code class="s1">'green'</code><code class="o">,</code> <code class="s1">'blue'</code><code class="p">]}</code>
          <code class="nx">defaultValue</code><code class="o">=</code><code class="s2">"green"</code>
        <code class="o">/&gt;</code>
      <code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code><code class="nx">Vanilla</code> <code class="nx">textarea</code><code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;&lt;</code><code class="nx">FormInput</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"textarea"</code> <code class="sr">/&gt;&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="nx">tbody</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="nx">table</code><code class="o">&gt;</code></pre>

<figure><div id="FIG0711" class="figure">
<img src="Images/rur2_0711.png" alt="rur2 0711" width="600" height="526"/>
<h6><span class="label">Figure 7-11. </span>Form inputs</h6>
</div></figure>

<p>The implementation of <code>&lt;FormInput&gt;</code> (found in <em>components/FormInput.js</em>) requires the <a data-type="indexterm" data-primary="import/export/props structure" id="idm45779432673104"/><a data-type="indexterm" data-primary="PropTypes" id="idm45779432672352"/>usual boilerplate of import, export, and <code>propTypes</code> for validation:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Rating</code> <code class="nx">from</code> <code class="s1">'./Rating'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Suggest</code> <code class="nx">from</code> <code class="s1">'./Suggest'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">FormInput</code><code class="p">({</code><code class="nx">type</code> <code class="o">=</code> <code class="s1">'input'</code><code class="o">,</code> <code class="nx">defaultValue</code> <code class="o">=</code> <code class="s1">''</code><code class="o">,</code> <code class="nx">options</code> <code class="o">=</code> <code class="p">[]</code><code class="o">,</code> <code class="p">...</code><code class="nx">rest</code><code class="p">})</code> <code class="p">{</code>
  <code class="c1">// TODO rendering goes here...</code>
<code class="p">}</code>

<code class="nx">FormInput</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">type</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">oneOf</code><code class="p">([</code><code class="s1">'textarea'</code><code class="o">,</code> <code class="s1">'input'</code><code class="o">,</code> <code class="s1">'year'</code><code class="o">,</code> <code class="s1">'suggest'</code><code class="o">,</code> <code class="s1">'rating'</code><code class="p">])</code><code class="o">,</code>
  <code class="nx">defaultValue</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">oneOfType</code><code class="p">([</code><code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="o">,</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">number</code><code class="p">])</code><code class="o">,</code>
  <code class="nx">options</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">array</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">FormInput</code><code class="o">;</code></pre>

<p>Note <code>PropTypes.oneOfType([])</code> in the <a data-type="indexterm" data-primary="PropTypes" data-secondary="PropTypes.oneOfType([])" id="idm45779432666784"/>prop types; it allows the component to accept either strings or numbers for default values.</p>

<p>The rendering <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="rendering of" id="idm45779432539360"/><a data-type="indexterm" data-primary="rendering" data-secondary="of Excel app components" data-secondary-sortas="Excel app components" id="idm45779432538368"/><a data-type="indexterm" data-primary="switch statement" id="idm45779432537120"/><a data-type="indexterm" data-primary="textareas" data-secondary="as DOM element" data-secondary-sortas="DOM element" id="idm45779432536448"/>is one big <code>switch</code> statement, which delegates the individual input creation to a more specific component or falls back to the built-in DOM elements <code>&lt;input&gt;</code> and <code>&lt;textarea&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="k">switch</code> <code class="p">(</code><code class="nx">type</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">case</code> <code class="s1">'year'</code><code class="o">:</code>
    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code>
        <code class="nx">type</code><code class="o">=</code><code class="s2">"number"</code>
        <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code>
          <code class="p">(</code><code class="nx">defaultValue</code> <code class="o">&amp;&amp;</code> <code class="nf">parseInt</code><code class="p">(</code><code class="nx">defaultValue</code><code class="o">,</code> <code class="mi">10</code><code class="p">))</code> <code class="o">||</code>
          <code class="k">new</code> <code class="nb">Date</code><code class="p">().</code><code class="nx">getFullYear</code><code class="p">()</code>
        <code class="p">}</code>
      <code class="o">/&gt;</code>
    <code class="p">);</code>
  <code class="k">case</code> <code class="s1">'suggest'</code><code class="o">:</code>
    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">Suggest</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">defaultValue</code><code class="p">}</code> <code class="nx">options</code><code class="o">=</code><code class="p">{</code><code class="nx">options</code><code class="p">}</code> <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code> <code class="o">/&gt;</code>
    <code class="p">);</code>
  <code class="k">case</code> <code class="s1">'rating'</code><code class="o">:</code>
    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">Rating</code>
        <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code>
        <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">defaultValue</code> <code class="o">?</code> <code class="nf">parseInt</code><code class="p">(</code><code class="nx">defaultValue</code><code class="o">,</code> <code class="mi">10</code><code class="p">)</code> <code class="o">:</code> <code class="mi">0</code><code class="p">}</code>
      <code class="o">/&gt;</code>
    <code class="p">);</code>
  <code class="k">case</code> <code class="s1">'textarea'</code><code class="o">:</code>
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">textarea</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">defaultValue</code><code class="p">}</code> <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code> <code class="o">/&gt;;</code>
  <code class="k">default</code><code class="o">:</code>
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">defaultValue</code><code class="p">}</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code> <code class="o">/&gt;;</code>
<code class="p">}</code></pre>

<p>As you can see, not much going on here; this component is just a convenience wrapper that allows for implementation-agnostic <a data-type="indexterm" data-startref="ch7_term24" id="idm45779432533120"/><a data-type="indexterm" data-startref="ch7_term25" id="idm45779432532512"/>definition of forms.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="&lt;Form&gt;"><div class="sect2" id="idm45779432959088">
<h2>&lt;Form&gt;</h2>

<p>Now you have:</p>

<ul>
<li>
<p>Custom inputs (e.g., <code>&lt;Rating&gt;</code>)</p>
</li>
<li>
<p>Built-in inputs (e.g., <code>&lt;textarea&gt;</code>)</p>
</li>
<li>
<p><code>&lt;FormInput&gt;</code>—a factory that makes inputs based on the <code>type</code> property</p>
</li>
</ul>

<p>It’s time to <a data-type="indexterm" data-primary="Form component" id="ch7_term26"/><a data-type="indexterm" data-primary="forms in React app" data-secondary="and Form component" data-secondary-sortas="Form component" id="ch7_term27"/>make them all work together in a <code>&lt;Form&gt;</code> (see <a data-type="xref" href="#FIG0712">Figure 7-12</a>).</p>

<figure><div id="FIG0712" class="figure">
<img src="Images/rur2_0712.png" alt="rur2 0712" width="600" height="724"/>
<h6><span class="label">Figure 7-12. </span>Form elements</h6>
</div></figure>

<p>The form component should be reusable, so there shouldn’t be anything hardcoded about the wine rating app. (To take it one step further, nothing about wine is to be hardcoded, so the app can be repurposed to <em>whine</em> about anything.) The <code>&lt;Form&gt;</code> component <a data-type="indexterm" data-primary="forms in React app" data-secondary="as arrays" data-secondary-sortas="arrays" id="idm45779432341664"/><a data-type="indexterm" data-primary="fields prop in Form component" id="ch7_term28"/>can be configured via an array of <code>fields</code>, where each field is defined by:</p>
<dl>
<dt><code>type</code></dt>
<dd>
<p>The default is “input.”</p>
</dd>
<dt><code>id</code></dt>
<dd>
<p>This is used so that the input can be found later.</p>
</dd>
<dt><code>label</code></dt>
<dd>
<p>This is placed next to the input.</p>
</dd>
<dt><code>options</code></dt>
<dd>
<p>These are passed to the auto-suggest input.</p>
</dd>
</dl>

<p>The <code>&lt;Form&gt;</code> also takes a map of default values and is capable of rendering read-only, so the user cannot edit the fields.</p>

<p>Starting with the boilerplate:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="p">{</code><code class="nx">forwardRef</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Rating</code> <code class="nx">from</code> <code class="s1">'./Rating'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">FormInput</code> <code class="nx">from</code> <code class="s1">'./FormInput'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Form.css'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">Form</code> <code class="o">=</code> <code class="nx">forwardRef</code><code class="p">(({</code><code class="nx">fields</code><code class="o">,</code> <code class="nx">initialData</code> <code class="o">=</code> <code class="p">{}</code><code class="o">,</code> <code class="nx">readonly</code> <code class="o">=</code> <code class="kc">false</code><code class="p">}</code><code class="o">,</code> <code class="nx">ref</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">form</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Form"</code> <code class="nx">ref</code><code class="o">=</code><code class="p">{</code><code class="nx">ref</code><code class="p">}</code><code class="o">&gt;</code>
      <code class="p">{</code><code class="cm">/* more rendering here */</code><code class="p">}</code>
    <code class="o">&lt;/</code><code class="nx">form</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">});</code>

<code class="nx">Form</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">fields</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">objectOf</code><code class="p">(</code>
    <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">shape</code><code class="p">({</code>
      <code class="nx">label</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="p">.</code><code class="nx">isRequired</code><code class="o">,</code>
      <code class="nx">type</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">oneOf</code><code class="p">([</code><code class="s1">'textarea'</code><code class="o">,</code> <code class="s1">'input'</code><code class="o">,</code> <code class="s1">'year'</code><code class="o">,</code> <code class="s1">'suggest'</code><code class="o">,</code> <code class="s1">'rating'</code><code class="p">])</code><code class="o">,</code>
      <code class="nx">options</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">arrayOf</code><code class="p">(</code><code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="p">)</code><code class="o">,</code>
    <code class="p">})</code><code class="o">,</code>
  <code class="p">).</code><code class="nx">isRequired</code><code class="o">,</code>
  <code class="nx">initialData</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">object</code><code class="o">,</code>
  <code class="nx">readonly</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">bool</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Form</code><code class="o">;</code></pre>

<p>Before moving on, let’s review a few new things in this code.</p>










<section data-type="sect3" data-pdf-bookmark="Types: shape, objectOf, arrayOf"><div class="sect3" id="idm45779432330288">
<h3>Types: shape, objectOf, arrayOf</h3>

<p>Note the <a data-type="indexterm" data-primary="PropTypes" data-secondary="PropTypes.object" id="idm45779432329104"/><a data-type="indexterm" data-primary="PropTypes" data-secondary="PropTypes.objectOf" id="idm45779432128000"/><a data-type="indexterm" data-primary="PropTypes" data-secondary="PropTypes.shape" id="idm45779432127056"/>use of <code>PropTypes.shape</code> in the prop types. It lets you be specific in what you expect in a map/object. It’s more strict than just generalizing like <code>PropTypes.object</code> and is certain to catch more errors before they occur as other developers start using your components. Also note the use of the <code>PropTypes.objectOf</code>. It’s similar to <code>arrayOf</code>, which lets you define that you expect an array containing certain types of data. Here <code>objectOf</code> means that the component expects a <code>fields</code> prop that is an object. And for every key-value pair in <code>fields</code>, the value is expected to be another object that has <code>label</code>, <code>type</code>, and <code>options</code> properties, something <a data-type="indexterm" data-startref="ch7_term28" id="idm45779432121264"/>similar to:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">Form</code>
  <code class="nx">fields</code><code class="o">=</code><code class="p">{{</code>
    <code class="nx">name</code><code class="o">:</code> <code class="p">{</code><code class="nx">label</code><code class="o">:</code> <code class="s1">'Rating'</code><code class="o">,</code> <code class="nx">type</code><code class="o">:</code> <code class="s1">'input'</code><code class="p">}</code><code class="o">,</code>
    <code class="nx">comments</code><code class="o">:</code> <code class="p">{</code><code class="nx">label</code><code class="o">:</code> <code class="s1">'Comments'</code><code class="o">,</code> <code class="nx">type</code><code class="o">:</code> <code class="s1">'textarea'</code><code class="p">}</code><code class="o">,</code>
  <code class="p">}}</code>
<code class="o">/&gt;</code></pre>

<p>To summarize: <code>PropTypes.object</code> is any object, <code>PropTypes.shape</code> is an object with predefined key (property) names, and <code>PropTypes.objectOf</code> is an object with unknown keys but known types of values.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Refs"><div class="sect3" id="idm45779432093776">
<h3>Refs</h3>

<p>And what <a data-type="indexterm" data-primary="DOM (Document Object Model)" data-secondary="refs for access to" id="idm45779432091824"/><a data-type="indexterm" data-primary="refs, passing of" id="idm45779432057136"/>about that <code>ref</code> business? Ref (short for reference) allows you to access the underlying DOM element from React. It’s not recommended to overuse this where you can rely on React. However, in this case we want to allow code outside the form to do a generic loop over form inputs and collect the form data. And there’s a bit of chain (or parents/children) to get there. For example, we <a data-type="indexterm" data-primary="discovery tool" id="idm45779432055632"/><a data-type="indexterm" data-primary="React app" data-secondary="discovery tool in" id="idm45779432054992"/>want the <code>&lt;Discovery&gt;</code> component to collect the form data. So the chain looks like:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;Discovery&gt;</code>
  <code class="nt">&lt;Form&gt;</code>
    <code class="nt">&lt;form&gt;</code>
      <code class="nt">&lt;FormInput&gt;</code>
        <code class="nt">&lt;input</code> <code class="nt">/&gt;</code></pre>

<p>Refs <a data-type="indexterm" data-primary="forwardRef() hook" id="idm45779432048528"/><a data-type="indexterm" data-primary="hooks" data-secondary="useRef()" id="idm45779432047920"/><a data-type="indexterm" data-primary="useRef() hook" id="idm45779432047008"/>allows <code>Discovery</code> to get the input’s <code>value</code> in this way:</p>
<ol>
<li>
<p>A ref object is created in <code>&lt;Discovery&gt;</code> using the hook <code>useRef()</code>.</p>
</li>
<li>
<p>The ref is passed to <code>&lt;Form&gt;</code> which grabs it thanks to the <code>forwardRef()</code> hook.</p>
</li>
<li>
<p>The ref is <em>forwarded</em> to the HTML/DOM <code>&lt;form&gt;</code> element.</p>
</li>
<li>
<p><code>&lt;Discovery&gt;</code> now has access to the underlying form DOM element via the <span class="keep-together"><code>.current</code></span> property of the ref object.</p>
</li>

</ol>

<p>Here’s an example of using <code>&lt;Form&gt;</code> in the discovery tool:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">form</code> <code class="o">=</code> <code class="nx">useRef</code><code class="p">();</code>
<code class="c1">// ...</code>

<code class="o">&lt;</code><code class="nx">Form</code>
  <code class="nx">ref</code><code class="o">=</code><code class="p">{</code><code class="nx">form</code><code class="p">}</code>
  <code class="nx">fields</code><code class="o">=</code><code class="p">{{</code>
    <code class="nx">rateme</code><code class="o">:</code> <code class="p">{</code><code class="nx">label</code><code class="o">:</code> <code class="s1">'Rating'</code><code class="o">,</code> <code class="nx">type</code><code class="o">:</code> <code class="s1">'rating'</code><code class="p">}</code><code class="o">,</code>
    <code class="nx">freetext</code><code class="o">:</code> <code class="p">{</code><code class="nx">label</code><code class="o">:</code> <code class="s1">'Greetings'</code><code class="p">}</code><code class="o">,</code>
  <code class="p">}}</code>
  <code class="nx">initialData</code><code class="o">=</code><code class="p">{{</code><code class="nx">rateme</code><code class="o">:</code> <code class="mi">4</code><code class="o">,</code> <code class="nx">freetext</code><code class="o">:</code> <code class="s1">'Hello'</code><code class="p">}}</code>
<code class="o">/&gt;</code></pre>

<p>Now you can add a <a data-type="indexterm" data-primary="form.current property" id="idm45779432034720"/><a data-type="indexterm" data-primary="form ref" id="idm45779431930960"/>button that collects the data in the form using the <code>form</code> ref and its property <code>form.current</code>. Because <code>form.current</code> gives you access to the native form DOM node and native forms contain an array-like collection of inputs, this means you can <a data-type="indexterm" data-primary="Array.from() function" id="idm45779431928736"/><a data-type="indexterm" data-primary="arrays, conversion of forms to" id="idm45779431928032"/><a data-type="indexterm" data-primary="forms in React app" data-secondary="as arrays" data-secondary-sortas="arrays" id="idm45779431927296"/>convert the form to an array (with <code>Array.from()</code>) and iterate over this array. Each element in the array is a native DOM input element and you can grab the value of the inputs using their <code>value</code> property. That was also the reason why even “fancy” form <a data-type="indexterm" data-primary="forms in React app" data-secondary="for rating inputs" data-secondary-sortas="rating inputs" id="idm45779431924992"/><a data-type="indexterm" data-primary="Rating input" id="idm45779431923744"/><a data-type="indexterm" data-primary="widget for rating inputs" id="idm45779431923072"/>inputs such as <code>Rating</code> also contain (and update the value of) a hidden input <span class="keep-together">element</span>.</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">Button</code>
  <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">{};</code>
    <code class="nb">Array</code><code class="p">.</code><code class="nx">from</code><code class="p">(</code><code class="nx">form</code><code class="p">.</code><code class="nx">current</code><code class="p">).</code><code class="nx">forEach</code><code class="p">(</code>
      <code class="p">(</code><code class="nx">input</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code><code class="nx">data</code><code class="p">[</code><code class="nx">input</code><code class="p">.</code><code class="nx">id</code><code class="p">]</code> <code class="o">=</code> <code class="nx">input</code><code class="p">.</code><code class="nx">value</code><code class="p">)</code><code class="o">,</code>
    <code class="p">);</code>
    <code class="nx">alert</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">data</code><code class="p">));</code>
  <code class="p">}}</code><code class="o">&gt;</code>
  <code class="nx">Submit</code>
<code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code></pre>

<p>Clicking the button shows a message with a JSON string like <code>{"rateme":"4","freetext":"Hello"}</code>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Wrapping up &lt;Form&gt;"><div class="sect3" id="idm45779432093152">
<h3>Wrapping up &lt;Form&gt;</h3>

<p>Now back <a data-type="indexterm" data-primary="rendering" data-secondary="of Excel app components" data-secondary-sortas="Excel app components" id="idm45779431833600"/><a data-type="indexterm" data-primary="forms in React app" data-secondary="rendering of" id="idm45779431832416"/>to the rendering part of the <code>&lt;Form&gt;</code>. It’s a <a data-type="indexterm" data-primary="fields prop in Form component" id="idm45779431830960"/><a data-type="indexterm" data-primary="FormInput component" id="idm45779431830160"/>loop over the <code>fields</code> prop and renders either a read-only version of the <code>initialData</code> prop or a working form by passing each field info to <code>&lt;FormInput&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">form</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Form"</code> <code class="nx">ref</code><code class="o">=</code><code class="p">{</code><code class="nx">ref</code><code class="p">}</code><code class="o">&gt;</code>
  <code class="p">{</code><code class="nb">Object</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="nx">fields</code><code class="p">).</code><code class="nx">map</code><code class="p">((</code><code class="nx">id</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">const</code> <code class="nx">prefilled</code> <code class="o">=</code> <code class="nx">initialData</code><code class="p">[</code><code class="nx">id</code><code class="p">];</code>
    <code class="kd">const</code> <code class="p">{</code><code class="nx">label</code><code class="o">,</code> <code class="nx">type</code><code class="o">,</code> <code class="nx">options</code><code class="p">}</code> <code class="o">=</code> <code class="nx">fields</code><code class="p">[</code><code class="nx">id</code><code class="p">];</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">readonly</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">prefilled</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
      <code class="p">}</code>
      <code class="k">return</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"FormRow"</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"FormLabel"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">label</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">span</code><code class="o">&gt;</code>
          <code class="p">{</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'rating'</code> <code class="o">?</code> <code class="p">(</code>
            <code class="o">&lt;</code><code class="nx">Rating</code>
              <code class="nx">readonly</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>
              <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nf">parseInt</code><code class="p">(</code><code class="nx">prefilled</code><code class="o">,</code> <code class="mi">10</code><code class="p">)}</code>
            <code class="o">/&gt;</code>
          <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>
            <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">prefilled</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
          <code class="p">)}</code>
        <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="p">);</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"FormRow"</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"FormLabel"</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code><code class="o">&gt;</code>
          <code class="p">{</code><code class="nx">label</code><code class="p">}</code>
        <code class="o">&lt;/</code><code class="nx">label</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">FormInput</code>
          <code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">id</code><code class="p">}</code>
          <code class="nx">type</code><code class="o">=</code><code class="p">{</code><code class="nx">type</code><code class="p">}</code>
          <code class="nx">options</code><code class="o">=</code><code class="p">{</code><code class="nx">options</code><code class="p">}</code>
          <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">prefilled</code><code class="p">}</code>
        <code class="o">/&gt;</code>
      <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
    <code class="p">);</code>
  <code class="p">})}</code>
<code class="o">&lt;/</code><code class="nx">form</code><code class="o">&gt;</code></pre>

<p>You can see it’s relatively simple; the only complexity comes from rendering the read-only rating widget instead of a <a data-type="indexterm" data-startref="ch7_term18" id="idm45779431827296"/><a data-type="indexterm" data-startref="ch7_term26" id="idm45779431826688"/><a data-type="indexterm" data-startref="ch7_term27" id="idm45779431826048"/>simple value.</p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="&lt;Actions&gt;"><div class="sect1" id="idm45779432531152">
<h1>&lt;Actions&gt;</h1>

<p>Next to <a data-type="indexterm" data-primary="Actions component" id="ch7_term29"/><a data-type="indexterm" data-primary="onAction callback" id="ch7_term30"/><a data-type="indexterm" data-primary="React app" data-secondary="Actions component in" id="ch7_term31"/>each row in the data table there should be actions (see <a data-type="xref" href="#FIG0713">Figure 7-13</a>) you can take on each row: delete, edit, and view (when not all the information can fit in a row).</p>

<figure><div id="FIG0713" class="figure">
<img src="Images/rur2_0713.png" alt="rur2 0713" width="473" height="180"/>
<h6><span class="label">Figure 7-13. </span>Actions</h6>
</div></figure>

<p>Here’s the <code>&lt;Actions&gt;</code> component being tested in the discovery tool:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">Actions</code> <code class="nx">onAction</code><code class="o">=</code><code class="p">{(</code><code class="nx">type</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">alert</code><code class="p">(</code><code class="nx">type</code><code class="p">)}</code> <code class="o">/&gt;</code></pre>

<p>And the component in its entirety:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Actions.css'</code><code class="o">;</code>

<code class="kd">import</code> <code class="nx">deleteImage</code> <code class="nx">from</code> <code class="s1">'./../images/close.svg'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">editImage</code> <code class="nx">from</code> <code class="s1">'./../images/edit.svg'</code><code class="o">;</code>

<code class="kd">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'./Button'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">Actions</code> <code class="o">=</code> <code class="p">({</code><code class="nx">onAction</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{}})</code> <code class="o">=&gt;</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Actions"</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Button</code>
      <code class="nx">className</code><code class="o">=</code><code class="s2">"ActionsInfo"</code>
      <code class="nx">title</code><code class="o">=</code><code class="s2">"More info"</code>
      <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">onAction</code><code class="p">(</code><code class="s1">'info'</code><code class="p">)}</code><code class="o">&gt;</code>
      <code class="nx">View</code> <code class="nx">Details</code>
    <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Button</code>
      <code class="nx">title</code><code class="o">=</code><code class="s2">"Edit"</code>
      <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">onAction</code><code class="p">(</code><code class="s1">'edit'</code><code class="p">)}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">editImage</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Edit"</code> <code class="o">/&gt;</code>
    <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">Button</code>
      <code class="nx">tabIndex</code><code class="o">=</code><code class="s2">"0"</code>
      <code class="nx">title</code><code class="o">=</code><code class="s2">"Delete"</code>
      <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">onAction</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="kc">null</code><code class="o">,</code> <code class="s1">'delete'</code><code class="p">)}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">deleteImage</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Delete"</code> <code class="o">/&gt;</code>
    <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="nx">span</code><code class="o">&gt;</code>
<code class="p">);</code>

<code class="nx">Actions</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">onAction</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">func</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Actions</code><code class="o">;</code></pre>

<p>As you can see, the <a data-type="indexterm" data-primary="Button component" id="idm45779431552160"/><a data-type="indexterm" data-primary="React app" data-secondary="Button component in" id="idm45779431551248"/><a data-type="indexterm" data-primary="callbacks" data-secondary="with Action component" data-secondary-sortas="Action component" id="idm45779431550336"/><a data-type="indexterm" data-primary="clicks, event handling with" id="idm45779431315344"/><a data-type="indexterm" data-primary="child-parent data communication" id="idm45779431314736"/><a data-type="indexterm" data-primary="parent-child data communication" id="idm45779431314128"/>actions are implemented as buttons. The component takes a callback function as its <code>onAction</code> prop. When the user clicks a button, the callback is invoked, passing a string identifying which button was clicked: <code>'info'</code>, <code>'edit'</code>, or <code>'delete'</code>. This is a simple pattern for a child to inform its parent of a change within the component. As you see, custom events (like <code>onAction</code>, <code>onAlienAttack</code>, etc.) are just that <a data-type="indexterm" data-startref="ch7_term29" id="idm45779431310560"/><a data-type="indexterm" data-startref="ch7_term30" id="idm45779431309824"/><a data-type="indexterm" data-startref="ch7_term31" id="idm45779431309152"/>simple.</p>

<p>Next chapter is all about the data flow in your React app, but you already know <span class="keep-together">two ways</span> to exchange data between parents and children: callback properties (like <code>onAction</code>) and refs.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Dialogs"><div class="sect1" id="idm45779431306704">
<h1>Dialogs</h1>

<p>Next, let’s build <a data-type="indexterm" data-primary="Dialog component" data-secondary="building" id="ch7_term32"/>a generic dialog component to be used for any sort of messages (instead of <code>alert()</code>) or pop-ups (as depicted in <a data-type="xref" href="#FIG0714">Figure 7-14</a>). For example, all <span class="keep-together">add/edit</span> forms could be presented in a modal dialog on top of the data table.</p>

<figure><div id="FIG0714" class="figure">
<img src="Images/rur2_0714.png" alt="rur2 0714" width="600" height="277"/>
<h6><span class="label">Figure 7-14. </span>Dialogs</h6>
</div></figure>

<p>To test the dialogs in the <code>Discovery</code> component, just a bit of state is required to manage if they are open or closed:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">function</code> <code class="nx">DialogExample</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">example</code><code class="o">,</code> <code class="nx">setExample</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">setExample</code><code class="p">(</code><code class="mi">1</code><code class="p">)}</code><code class="o">&gt;</code><code class="nx">Example</code> <code class="mi">1</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code><code class="p">{</code><code class="s1">' '</code><code class="p">}</code>
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">setExample</code><code class="p">(</code><code class="mi">2</code><code class="p">)}</code><code class="o">&gt;</code><code class="nx">Example</code> <code class="mi">2</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="nx">p</code><code class="o">&gt;</code>
      <code class="p">{</code><code class="nx">example</code> <code class="o">===</code> <code class="mi">1</code> <code class="o">?</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">Dialog</code>
          <code class="nx">modal</code>
          <code class="nx">header</code><code class="o">=</code><code class="s2">"Out-of-the-box example"</code>
          <code class="nx">onAction</code><code class="o">=</code><code class="p">{(</code><code class="nx">type</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">alert</code><code class="p">(</code><code class="nx">type</code><code class="p">);</code>
            <code class="nx">setExample</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
          <code class="p">}}</code><code class="o">&gt;</code>
          <code class="nx">Hello</code><code class="o">,</code> <code class="nx">dialog</code><code class="o">!</code>
        <code class="o">&lt;/</code><code class="nx">Dialog</code><code class="o">&gt;</code>
      <code class="p">)</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code>

      <code class="p">{</code><code class="nx">example</code> <code class="o">===</code> <code class="mi">2</code> <code class="o">?</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">Dialog</code>
          <code class="nx">header</code><code class="o">=</code><code class="s2">"Not modal, custom dismiss button"</code>
          <code class="nx">hasCancel</code><code class="o">=</code><code class="p">{</code><code class="kc">false</code><code class="p">}</code>
          <code class="nx">confirmLabel</code><code class="o">=</code><code class="s2">"Whatever"</code>
          <code class="nx">onAction</code><code class="o">=</code><code class="p">{(</code><code class="nx">type</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
            <code class="nx">alert</code><code class="p">(</code><code class="nx">type</code><code class="p">);</code>
            <code class="nx">setExample</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
          <code class="p">}}</code><code class="o">&gt;</code>
          <code class="nx">Anything</code> <code class="nx">goes</code> <code class="nx">here</code><code class="o">,</code> <code class="nx">like</code> <code class="nx">a</code> <code class="o">&lt;</code><code class="nx">Button</code><code class="o">&gt;</code><code class="nx">a</code> <code class="nx">button</code><code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code> <code class="k">for</code> <code class="nx">example</code>
        <code class="o">&lt;/</code><code class="nx">Dialog</code><code class="o">&gt;</code>
      <code class="p">)</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code>
    <code class="o">&lt;/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>The implementation of a dialog doesn’t need to be too complicated, but let’s make it interesting and add a few nice-to-have features:</p>

<ul>
<li>
<p>There’s a <a data-type="indexterm" data-primary="headers, table" id="idm45779431295872"/><a data-type="indexterm" data-primary="tables" data-secondary="headers of" id="idm45779431295136"/>header with a title string coming from the the <code>header</code> prop.</p>
</li>
<li>
<p>There’s a body that is simply the children passed to <code>&lt;Dialog&gt;</code>.</p>
</li>
<li>
<p>The <a data-type="indexterm" data-primary="Button component" id="idm45779431063088"/><a data-type="indexterm" data-primary="React app" data-secondary="Button component in" id="idm45779431062384"/>footer has <em>OK</em>/<em>Cancel</em> buttons: let’s call them <code>confirm</code> and <code>dismiss</code>. Sometimes a dialog is merely an info message and you need only one button. The prop <span class="keep-together"><code>hasCancel</code></span> can define this. If it’s <code>false</code>, only the OK button is shown.</p>
</li>
<li>
<p>The <code>confirm</code> button can change the label via the <code>confirmLabel</code> prop. The <span class="keep-together"><code>dismiss</code></span> button always reads “Cancel.”</p>
</li>
<li>
<p>The dialog <a data-type="indexterm" data-primary="“modal” dialog" data-primary-sortas="modal dialog" id="idm45779431054864"/>may be “modal,” meaning it takes over the whole app and nothing really happens until it’s dismissed.</p>
</li>
<li>
<p>An <code>onAction</code> prop <a data-type="indexterm" data-primary="onAction callback" id="idm45779431052320"/>(similar to the <code>&lt;Actions&gt;</code> component) can pass the user’s action to the parent component.</p>
</li>
<li>
<p>The user can <a data-type="indexterm" data-primary="Escape key, functionality of" id="idm45779431050176"/><a data-type="indexterm" data-primary="extended functionality, dialog with" id="idm45779431049376"/>dismiss the dialog by hitting Escape or clicking outside the dialog. This is a nice and expected feature but sometimes may not be desirable. For example, what if you type extensively in a dialog, producing some of your best prose, and suddenly you hit Escape? All is lost! The decision about the behavior of the dialog should be left to the developer using the component. The <code>Dialog</code> can merely enable this <em>extended</em> behavior (hitting Escape or clicking outside) if requested by the developer via the <code>extendedDismiss</code> prop.</p>
</li>
</ul>

<p>The <code>import</code>/<code>export</code>/<code>props</code> setup <a data-type="indexterm" data-primary="properties (props)" data-secondary="for Dialog component" data-secondary-sortas="Dialog component" id="idm45779431044896"/><a data-type="indexterm" data-primary="import/export/props structure" id="idm45779431043808"/><a data-type="indexterm" data-primary="PropTypes" id="idm45779431043200"/>could look like so:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="p">{</code><code class="nx">useEffect</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">PropTypes</code> <code class="nx">from</code> <code class="s1">'prop-types'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'./Button'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Dialog.css'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">Dialog</code><code class="p">(</code><code class="nx">props</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="p">{</code>
    <code class="nx">header</code><code class="o">,</code>
    <code class="nx">modal</code> <code class="o">=</code> <code class="kc">false</code><code class="o">,</code>
    <code class="nx">extendedDismiss</code> <code class="o">=</code> <code class="kc">true</code><code class="o">,</code>
    <code class="nx">confirmLabel</code> <code class="o">=</code> <code class="s1">'ok'</code><code class="o">,</code>
    <code class="nx">onAction</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{}</code><code class="o">,</code>
    <code class="nx">hasCancel</code> <code class="o">=</code> <code class="kc">true</code><code class="o">,</code>
  <code class="p">}</code> <code class="o">=</code> <code class="nx">props</code><code class="o">;</code>

  <code class="c1">// rendering here...</code>

<code class="p">}</code>

<code class="nx">Dialog</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">header</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="p">.</code><code class="nx">isRequired</code><code class="o">,</code>
  <code class="nx">modal</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">bool</code><code class="o">,</code>
  <code class="nx">extendedDismiss</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">bool</code><code class="o">,</code>
  <code class="nx">confirmLabel</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="o">,</code>
  <code class="nx">onAction</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">func</code><code class="o">,</code>
  <code class="nx">hasCancel</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">bool</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Dialog</code><code class="o">;</code></pre>

<p>The rendering <a data-type="indexterm" data-primary="rendering" data-secondary="of Excel app components" data-secondary-sortas="Excel app components" id="idm45779431041520"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="rendering of" id="idm45779431040368"/>is not too complicated; it’s a <a data-type="indexterm" data-primary="conditional CSS" id="idm45779430879584"/><a data-type="indexterm" data-primary="CSS" data-secondary="conditional" id="idm45779430878976"/>conditional CSS when the dialog is modal and some conditional buttons display:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="k">return</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">modal</code> <code class="o">?</code> <code class="s1">'Dialog DialogModal'</code> <code class="o">:</code> <code class="s1">'Dialog'</code><code class="p">}</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">modal</code> <code class="o">?</code> <code class="s1">'DialogModalWrap'</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"DialogHeader"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">header</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"DialogBody"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">children</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"DialogFooter"</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">hasCancel</code> <code class="o">?</code> <code class="p">(</code>
          <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"DialogDismiss"</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">onAction</code><code class="p">(</code><code class="s1">'dismiss'</code><code class="p">)}</code><code class="o">&gt;</code>
            <code class="nx">Cancel</code>
          <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
        <code class="p">)</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code>
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">onAction</code><code class="p">(</code><code class="nx">hasCancel</code> <code class="o">?</code> <code class="s1">'confirm'</code> <code class="o">:</code> <code class="s1">'dismiss'</code><code class="p">)}</code><code class="o">&gt;</code>
          <code class="p">{</code><code class="nx">confirmLabel</code><code class="p">}</code>
        <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
<code class="p">);</code></pre>

<p>Finally, <a data-type="indexterm" data-primary="extended functionality, dialog with" id="idm45779430877168"/><a data-type="indexterm" data-primary="Escape key, functionality of" id="idm45779430876560"/><a data-type="indexterm" data-primary="hooks" data-secondary="useEffect()" id="idm45779430875904"/><a data-type="indexterm" data-primary="useEffect() hook" id="idm45779430708352"/>the <em>extended</em> functionality where the user can interact with the Escape key or click outside the dialog body is implemented in a <code>useEffect()</code> hook. This hook will be executed only once, when the dialog renders, and is responsible for setting up (and cleaning up) DOM event listeners. As you already know, the general <code>useEffect()</code> template is:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="c1">// setup</code>
    <code class="k">return</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="c1">// cleanup</code>
    <code class="p">};</code>
  <code class="p">}</code><code class="o">,</code>
  <code class="p">[]</code> <code class="c1">// dependencies</code>
<code class="p">)</code></pre>

<p>Armed with this template, the implementation could be something like:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="kd">function</code> <code class="nx">dismissClick</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">contains</code><code class="p">(</code><code class="s1">'DialogModal'</code><code class="p">))</code> <code class="p">{</code>
      <code class="nx">onAction</code><code class="p">(</code><code class="s1">'dismiss'</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="kd">function</code> <code class="nx">dismissKey</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">key</code> <code class="o">===</code> <code class="s1">'Escape'</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">onAction</code><code class="p">(</code><code class="s1">'dismiss'</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="k">if</code> <code class="p">(</code><code class="nx">modal</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="s1">'DialogModalOpen'</code><code class="p">);</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">extendedDismiss</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="o">,</code> <code class="nx">dismissClick</code><code class="p">);</code>
      <code class="nx">document</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'keydown'</code><code class="o">,</code> <code class="nx">dismissKey</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="s1">'DialogModalOpen'</code><code class="p">);</code>
    <code class="nx">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">removeEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="o">,</code> <code class="nx">dismissClick</code><code class="p">);</code>
    <code class="nx">document</code><code class="p">.</code><code class="nx">removeEventListener</code><code class="p">(</code><code class="s1">'keydown'</code><code class="o">,</code> <code class="nx">dismissKey</code><code class="p">);</code>
  <code class="p">};</code>
<code class="p">}</code><code class="o">,</code> <code class="p">[</code><code class="nx">onAction</code><code class="o">,</code> <code class="nx">modal</code><code class="o">,</code> <code class="nx">extendedDismiss</code><code class="p">]);</code></pre>

<p>Here are a couple of alternative ideas:</p>

<ul>
<li>
<p>Instead of <a data-type="indexterm" data-primary="onConfirm callback" id="idm45779430690016"/><a data-type="indexterm" data-primary="onDismiss callback" id="idm45779430689280"/>a single <code>onAction</code>, another option is to provide <code>onConfirm</code> (user clicks OK) and <code>onDismiss</code>.</p>
</li>
<li>
<p>The <a data-type="indexterm" data-primary="wrappers" id="idm45779430472752"/><a data-type="indexterm" data-primary="classnames package" id="idm45779430472016"/>wrapper <code>div</code> has a conditional and a non-conditional class name. The component could possibly benefit <a data-type="indexterm" data-startref="ch7_term32" id="idm45779430470688"/>from the <code>classnames</code> module, as follows.</p>
</li>
</ul>

<p>Before:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">modal</code> <code class="o">?</code> <code class="s1">'Dialog DialogModal'</code> <code class="o">:</code> <code class="s1">'Dialog'</code><code class="p">}</code><code class="o">&gt;</code></pre>

<p>After:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">({</code>
    <code class="s1">'Dialog'</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
    <code class="s1">'DialogModal'</code><code class="o">:</code> <code class="nx">modal</code><code class="o">,</code>
  <code class="p">})}</code><code class="o">&gt;</code></pre>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Header"><div class="sect1" id="idm45779430460944">
<h1>Header</h1>

<p>At this point, all the lowest-level components are done. Before tackling the big one, <code>Excel</code>, let’s <a data-type="indexterm" data-primary="Add button" id="idm45779430414512"/><a data-type="indexterm" data-primary="logo component" id="idm45779430413776"/><a data-type="indexterm" data-primary="search box" id="idm45779430413104"/><a data-type="indexterm" data-primary="Header component" data-secondary="about" id="idm45779430412432"/><a data-type="indexterm" data-primary="headers, table" id="idm45779430411488"/><a data-type="indexterm" data-primary="tables" data-secondary="headers of" id="idm45779430410816"/><a data-type="indexterm" data-primary="React app" data-secondary="Button component in" id="idm45779430409872"/><a data-type="indexterm" data-primary="Button component" id="idm45779430408928"/><a data-type="indexterm" data-primary="React app" data-secondary="logo component in" id="idm45779430408256"/>add a convenient <code>Header</code> component made up of logo, search box, and an “Add” button to add new records to the data table:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">Logo</code> <code class="nx">from</code> <code class="s1">'./Logo'</code><code class="o">;</code>
<code class="kd">import</code> <code class="s1">'./Header.css'</code><code class="o">;</code>

<code class="kd">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'./Button'</code><code class="o">;</code>
<code class="kd">import</code> <code class="nx">FormInput</code> <code class="nx">from</code> <code class="s1">'./FormInput'</code><code class="o">;</code>

<code class="kd">function</code> <code class="nx">Header</code><code class="p">({</code><code class="nx">onSearch</code><code class="o">,</code> <code class="nx">onAdd</code><code class="o">,</code> <code class="nx">count</code> <code class="o">=</code> <code class="mi">0</code><code class="p">})</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="nx">placeholder</code> <code class="o">=</code> <code class="nx">count</code> <code class="o">&gt;</code> <code class="mi">1</code> <code class="o">?</code> <code class="err">`</code><code class="nx">Search</code> <code class="nx">$</code><code class="p">{</code><code class="nx">count</code><code class="p">}</code> <code class="nx">items</code><code class="err">`</code> <code class="o">:</code> <code class="s1">'Search'</code><code class="o">;</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Header"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Logo</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">FormInput</code> <code class="nx">placeholder</code><code class="o">=</code><code class="p">{</code><code class="nx">placeholder</code><code class="p">}</code> <code class="nx">id</code><code class="o">=</code><code class="s2">"search"</code> <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onSearch</code><code class="p">}</code> <code class="o">/&gt;</code>
      <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">onAdd</code><code class="p">}</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">b</code><code class="o">&gt;&amp;</code><code class="err">#</code><code class="mi">65291</code><code class="o">;&lt;/</code><code class="nx">b</code><code class="o">&gt;</code> <code class="nx">Add</code> <code class="nx">whine</code>
        <code class="o">&lt;/</code><code class="nx">Button</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">Header</code><code class="o">;</code></pre>

<p>As you can see, the header doesn’t do any searching or adding to the data, but it <a data-type="indexterm" data-primary="callbacks" data-secondary="with Header component" data-secondary-sortas="Header component" id="idm45779430379536"/>offers callbacks for its parent to do the data management.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="App Config"><div class="sect1" id="idm45779430378032">
<h1>App Config</h1>

<p>It would be a good idea to divorce the Whinepad app from the wine-specific subject matter and <a data-type="indexterm" data-primary="CRUD (create, read, update, and delete) application" id="idm45779430208976"/><a data-type="indexterm" data-primary="optimization of performance" id="idm45779430208176"/><a data-type="indexterm" data-primary="React app" data-secondary="efficiency with" id="idm45779430207536"/><a data-type="indexterm" data-primary="data" data-secondary="schema object for type of" id="ch7_term33"/><a data-type="indexterm" data-primary="React app" data-secondary="app configuration in" id="ch7_term34"/><a data-type="indexterm" data-primary="React app" data-secondary="data as schema object in" id="ch7_term35"/><a data-type="indexterm" data-primary="schema for data configuration" id="ch7_term36"/>make it a reusable CRUD way of managing any sort of data. There should be no hardcoded data fields. Instead, a <code>schema</code> object can be a description of the type of data you want to deal with in the app.</p>

<p>Here’s an example (<em>src/config/schema.js</em>) to get you off the ground with a wine-oriented app:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">classification</code> <code class="nx">from</code> <code class="s1">'./classification'</code><code class="o">;</code>

<code class="kd">const</code> <code class="nx">schema</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">label</code><code class="o">:</code> <code class="s1">'Name'</code><code class="o">,</code>
    <code class="nx">show</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
    <code class="nx">samples</code><code class="o">:</code> <code class="p">[</code><code class="s1">'$2 Chuck'</code><code class="o">,</code> <code class="s1">'Chateau React'</code><code class="o">,</code> <code class="s1">'Vint.js'</code><code class="p">]</code><code class="o">,</code>
    <code class="nx">align</code><code class="o">:</code> <code class="s1">'left'</code><code class="o">,</code>
  <code class="p">}</code><code class="o">,</code>
  <code class="nx">year</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">label</code><code class="o">:</code> <code class="s1">'Year'</code><code class="o">,</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'year'</code><code class="o">,</code>
    <code class="nx">show</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
    <code class="nx">samples</code><code class="o">:</code> <code class="p">[</code><code class="mi">2015</code><code class="o">,</code> <code class="mi">2013</code><code class="o">,</code> <code class="mi">2021</code><code class="p">]</code><code class="o">,</code>
  <code class="p">}</code><code class="o">,</code>
  <code class="nx">grape</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">label</code><code class="o">:</code> <code class="s1">'Grape'</code><code class="o">,</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'suggest'</code><code class="o">,</code>
    <code class="nx">options</code><code class="o">:</code> <code class="nx">classification</code><code class="p">.</code><code class="nx">grapes</code><code class="o">,</code>
    <code class="nx">show</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
    <code class="nx">samples</code><code class="o">:</code> <code class="p">[</code><code class="s1">'Merlot'</code><code class="o">,</code> <code class="s1">'Bordeaux Blend'</code><code class="o">,</code> <code class="s1">'Zinfandel'</code><code class="p">]</code><code class="o">,</code>
    <code class="nx">align</code><code class="o">:</code> <code class="s1">'left'</code><code class="o">,</code>
  <code class="p">}</code><code class="o">,</code>
  <code class="nx">rating</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">label</code><code class="o">:</code> <code class="s1">'Rating'</code><code class="o">,</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'rating'</code><code class="o">,</code>
    <code class="nx">show</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
    <code class="nx">samples</code><code class="o">:</code> <code class="p">[</code><code class="mi">3</code><code class="o">,</code> <code class="mi">1</code><code class="o">,</code> <code class="mi">5</code><code class="p">]</code><code class="o">,</code>
  <code class="p">}</code><code class="o">,</code>
  <code class="nx">comments</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">label</code><code class="o">:</code> <code class="s1">'Comments'</code><code class="o">,</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'textarea'</code><code class="o">,</code>
    <code class="nx">samples</code><code class="o">:</code> <code class="p">[</code><code class="s1">'Nice for the price'</code><code class="o">,</code> <code class="s1">'XML in my JS, orly??!'</code><code class="o">,</code> <code class="s1">'Lodi? Again!'</code><code class="p">]</code><code class="o">,</code>
  <code class="p">}</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">schema</code><code class="o">;</code></pre>

<p>This is an <a data-type="indexterm" data-primary="schema module for type of data" id="idm45779430200160"/><a data-type="indexterm" data-primary="ECMAScript" data-secondary="modules in" id="idm45779430199552"/><a data-type="indexterm" data-primary="modules" data-secondary="for building React app" data-secondary-sortas="building React app" id="idm45779430198640"/>example of one of the simplest ECMAScript modules you can imagine—one that exports a single variable. It also imports another simple module that contains some lengthy options to prefill in the forms (<em>src/config/classification.js</em>). Just to keep the <code>schema</code> shorter and easier to read:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">classification</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">grapes</code><code class="o">:</code> <code class="p">[</code>
    <code class="s1">'Baco Noir'</code><code class="o">,</code>
    <code class="s1">'Barbera'</code><code class="o">,</code>
    <code class="s1">'Cabernet Franc'</code><code class="o">,</code>
    <code class="s1">'Cabernet Sauvignon'</code><code class="o">,</code>
    <code class="c1">// ...</code>
  <code class="p">]</code><code class="o">,</code>
<code class="p">};</code>

<code class="nx">export</code> <code class="k">default</code> <code class="nx">classification</code><code class="o">;</code></pre>

<p>With the help of the <code>schema</code> module, you can now configure what type of data you want to manage <a data-type="indexterm" data-startref="ch7_term33" id="idm45779429953136"/><a data-type="indexterm" data-startref="ch7_term34" id="idm45779429952528"/><a data-type="indexterm" data-startref="ch7_term35" id="idm45779429951856"/><a data-type="indexterm" data-startref="ch7_term36" id="idm45779429951184"/>in the app.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="&lt;Excel&gt;: New and Improved"><div class="sect1" id="idm45779429950256">
<h1>&lt;Excel&gt;: New and Improved</h1>

<p>And now comes the meat of the app, the data table that does most of the work: everything <a data-type="indexterm" data-primary="Excel component in React app" id="ch7_term40"/><a data-type="indexterm" data-primary="CRUD (create, read, update, and delete) application" id="idm45779429947456"/>in CRUD, except the C (create).</p>

<p>Using <a data-type="indexterm" data-primary="discovery tool" id="ch7_term37"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="testing with discovery tool" id="ch7_term38"/><a data-type="indexterm" data-primary="React app" data-secondary="discovery tool in" id="ch7_term39"/>the new <code>&lt;Excel&gt;</code> in <code>&lt;Discovery&gt;</code> so it can be tested independently of the whole app:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="nx">schema</code> <code class="nx">from</code> <code class="s1">'../config/schema'</code><code class="o">;</code>

<code class="c1">// ...</code>

<code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Excel</code><code class="o">&lt;/</code><code class="nx">h2</code><code class="o">&gt;</code>

<code class="o">&lt;</code><code class="nx">Excel</code>
  <code class="nx">schema</code><code class="o">=</code><code class="p">{</code><code class="nx">schema</code><code class="p">}</code>
  <code class="nx">initialData</code><code class="o">=</code><code class="p">{</code><code class="nx">schema</code><code class="p">.</code><code class="nx">name</code><code class="p">.</code><code class="nx">samples</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">_</code><code class="o">,</code> <code class="nx">idx</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="kd">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="p">{};</code>
    <code class="k">for</code> <code class="p">(</code><code class="nx">let</code> <code class="nx">key</code> <code class="k">in</code> <code class="nx">schema</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">element</code><code class="p">[</code><code class="nx">key</code><code class="p">]</code> <code class="o">=</code> <code class="nx">schema</code><code class="p">[</code><code class="nx">key</code><code class="p">].</code><code class="nx">samples</code><code class="p">[</code><code class="nx">idx</code><code class="p">];</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="nx">element</code><code class="o">;</code>
  <code class="p">})}</code>
  <code class="nx">onDataChange</code><code class="o">=</code><code class="p">{(</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}}</code>
<code class="o">/&gt;</code></pre>

<p>As you can see, all the <a data-type="indexterm" data-primary="console.log()" id="idm45779429911040"/><a data-type="indexterm" data-primary="data" data-secondary="schema object for type of" id="idm45779429910432"/><a data-type="indexterm" data-primary="onDataChange callback prop" id="idm45779429785424"/><a data-type="indexterm" data-primary="React app" data-secondary="app configuration in" id="idm45779429784736"/><a data-type="indexterm" data-primary="React app" data-secondary="data as schema object in" id="idm45779429783792"/><a data-type="indexterm" data-primary="schema for data configuration" id="idm45779429782832"/>data configuration comes from the <code>schema</code>, including three samples of the data being passed as the <code>initialData</code> prop to be used for testing. And then there’s the <code>onDataChange</code> callback prop, which enables the parent of the component to manage the data as a whole and perform tasks such as writing it to a database or <code>localStorage</code>. For the purposes of discovery and testing, <code>console.log()</code> is enough.</p>

<p>Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#FIG0715">7-15</a> through <a data-type="xref" data-xrefstyle="select:labelnumber" href="#FIG0718">7-18</a> show how <code>Excel</code> looks and behaves in the discovery tool.</p>

<figure><div id="FIG0715" class="figure">
<img src="Images/rur2_0715.png" alt="rur2 0715" width="600" height="177"/>
<h6><span class="label">Figure 7-15. </span><code>Excel</code> component rendered in <code>Discovery</code> with sample data coming from <code>schema</code></h6>
</div></figure>

<figure><div id="FIG0716" class="figure">
<img src="Images/rur2_0716.png" alt="rur2 0716" width="600" height="339"/>
<h6><span class="label">Figure 7-16. </span>Editing an item using <code>Form</code> in a <code>Dialog</code></h6>
</div></figure>

<figure><div id="FIG0717" class="figure">
<img src="Images/rur2_0717.png" alt="rur2 0717" width="600" height="347"/>
<h6><span class="label">Figure 7-17. </span>Viewing details for an item: same <code>Form</code> but rendered read-only</h6>
</div></figure>

<figure><div id="FIG0718" class="figure">
<img src="Images/rur2_0718.png" alt="rur2 0718" width="600" height="336"/>
<h6><span class="label">Figure 7-18. </span>Confirmation when clicking the delete <code>Action</code></h6>
</div></figure>








<section data-type="sect2" data-pdf-bookmark="The Overall Structure"><div class="sect2" id="idm45779429765696">
<h2>The Overall Structure</h2>

<p>The familiar <a data-type="indexterm" data-startref="ch7_term37" id="idm45779429764192"/><a data-type="indexterm" data-startref="ch7_term38" id="idm45779429763456"/><a data-type="indexterm" data-startref="ch7_term39" id="idm45779429762784"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="basic structure of" id="ch7_term41"/><a data-type="indexterm" data-primary="state" data-secondary="in Excel component" data-secondary-sortas="Excel component" id="ch7_term42"/><a data-type="indexterm" data-primary="import/export/props structure" id="idm45779429759344"/>structure is imports at the top, export at the end, and an <code>Excel</code> function for the rendering. Additionally, the component manages a bit of state:</p>

<ul>
<li>
<p>Is the data sorted? How?</p>
</li>
<li>
<p>Is there a dialog open? What’s in it?</p>
</li>
<li>
<p>Is the user editing inline in the table?</p>
</li>
<li>
<p>The data!</p>
</li>
</ul>

<p>The data <a data-type="indexterm" data-primary="hooks" data-secondary="useState()" id="idm45779429753680"/><a data-type="indexterm" data-primary="state hooks" id="idm45779429752672"/><a data-type="indexterm" data-primary="useState() hook" id="idm45779429752000"/><a data-type="indexterm" data-primary="reducers" data-secondary="Excel function" id="idm45779429751328"/>state is managed by a reducer and for everything else, there’s <code>useState()</code>. Inline in the <code>Excel</code> function there are a few helper functions to isolate some of the state handling code:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">import</code> <code class="p">{</code><code class="nx">useState</code><code class="o">,</code> <code class="nx">useReducer</code><code class="o">,</code> <code class="nx">useRef</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="o">;</code>
<code class="c1">// more imports...</code>

<code class="kd">function</code> <code class="nx">reducer</code><code class="p">(</code><code class="nx">data</code><code class="o">,</code> <code class="nx">action</code><code class="p">)</code> <code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code>

<code class="kd">function</code> <code class="nx">Excel</code><code class="p">({</code><code class="nx">schema</code><code class="o">,</code> <code class="nx">initialData</code><code class="o">,</code> <code class="nx">onDataChange</code><code class="o">,</code> <code class="nx">filter</code><code class="p">})</code> <code class="p">{</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">data</code><code class="o">,</code> <code class="nx">dispatch</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useReducer</code><code class="p">(</code><code class="nx">reducer</code><code class="o">,</code> <code class="nx">initialData</code><code class="p">);</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">sorting</code><code class="o">,</code> <code class="nx">setSorting</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">({</code>
    <code class="nx">column</code><code class="o">:</code> <code class="s1">''</code><code class="o">,</code>
    <code class="nx">descending</code><code class="o">:</code> <code class="kc">false</code><code class="o">,</code>
  <code class="p">});</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">edit</code><code class="o">,</code> <code class="nx">setEdit</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
  <code class="kd">const</code> <code class="p">[</code><code class="nx">dialog</code><code class="o">,</code> <code class="nx">setDialog</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
  <code class="kd">const</code> <code class="nx">form</code> <code class="o">=</code> <code class="nx">useRef</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>

  <code class="kd">function</code> <code class="nx">sort</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code>

  <code class="kd">function</code> <code class="nx">showEditor</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code>

  <code class="kd">function</code> <code class="nx">save</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code>

  <code class="kd">function</code> <code class="nx">handleAction</code><code class="p">(</code><code class="nx">rowidx</code><code class="o">,</code> <code class="nx">type</code><code class="p">)</code> <code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code>

  <code class="k">return</code> <code class="p">(</code><code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Excel"</code><code class="o">&gt;</code><code class="p">{</code><code class="cm">/*...*/</code><code class="p">}</code><code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code><code class="p">);</code>
<code class="p">}</code>

<code class="nx">Excel</code><code class="p">.</code><code class="nx">propTypes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">schema</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">object</code><code class="o">,</code>
  <code class="nx">initialData</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">arrayOf</code><code class="p">(</code><code class="nx">PropTypes</code><code class="p">.</code><code class="nx">object</code><code class="p">)</code><code class="o">,</code>
  <code class="nx">onDataChange</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">func</code><code class="o">,</code>
  <code class="nx">filter</code><code class="o">:</code> <code class="nx">PropTypes</code><code class="p">.</code><code class="nx">string</code><code class="o">,</code>
<code class="p">};</code>
<code class="nx">export</code> <code class="k">default</code> <code class="nx">Excel</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Rendering"><div class="sect2" id="idm45779429748784">
<h2>Rendering</h2>

<p>Let’s start <a data-type="indexterm" data-startref="ch7_term41" id="idm45779429747408"/><a data-type="indexterm" data-startref="ch7_term42" id="idm45779429491424"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="rendering of" id="ch7_term43"/><a data-type="indexterm" data-primary="rendering" data-secondary="of Excel app components" data-secondary-sortas="Excel app components" id="ch7_term44"/>with the rendering portion of the component. There’s an overall <code>div</code> to help with the styling and in it there’s a <code>table</code> and (optionally) a dialog, the content of which comes from the <code>dialog</code> state. This means that <a data-type="indexterm" data-primary="Dialog component" data-secondary="rendering of" id="idm45779429486800"/><a data-type="indexterm" data-primary="rendering" data-secondary="of Dialog component" data-secondary-sortas="Dialog component" id="idm45779429485824"/>when calling <code>setDialog()</code> (given by <code>useState()</code>), you pass the content of the dialog to be rendered (e.g., <span class="keep-together"><code>setDialog(&lt;Dialog /&gt;)</code></span>):</p>

<pre data-type="programlisting" data-code-language="actionscript">  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"Excel"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">table</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="cm">/* ... */</code><code class="p">}</code>
      <code class="o">&lt;/</code><code class="nx">table</code><code class="o">&gt;</code>
      <code class="p">{</code><code class="nx">dialog</code><code class="p">}</code>
    <code class="o">&lt;/</code><code class="nx">div</code><code class="o">&gt;</code>
  <code class="p">);</code></pre>










<section data-type="sect3" data-pdf-bookmark="Rendering the table head"><div class="sect3" id="idm45779429481488">
<h3>Rendering the table head</h3>

<p>The table <a data-type="indexterm" data-primary="headers, table" id="idm45779429462048"/><a data-type="indexterm" data-primary="tables" data-secondary="headers of" id="idm45779429461344"/>head is similar to what you’ve seen in previous chapters except now the header labels come from <code>schema</code> passed as a prop to <code>Excel</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">thead</code> <code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">sort</code><code class="p">}</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="nb">Object</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="nx">schema</code><code class="p">).</code><code class="nx">map</code><code class="p">((</code><code class="nx">key</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="nx">let</code> <code class="p">{</code><code class="nx">label</code><code class="o">,</code> <code class="nx">show</code><code class="p">}</code> <code class="o">=</code> <code class="nx">schema</code><code class="p">[</code><code class="nx">key</code><code class="p">];</code>
      <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">show</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
      <code class="p">}</code>
      <code class="k">if</code> <code class="p">(</code><code class="nx">sorting</code><code class="p">.</code><code class="nx">column</code> <code class="o">===</code> <code class="nx">key</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">label</code> <code class="o">+=</code> <code class="nx">sorting</code><code class="p">.</code><code class="nx">descending</code> <code class="o">?</code> <code class="s1">' \u2191'</code> <code class="o">:</code> <code class="s1">' \u2193'</code><code class="o">;</code>
      <code class="p">}</code>
      <code class="k">return</code> <code class="p">(</code>
        <code class="o">&lt;</code><code class="nx">th</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">key</code><code class="p">}</code> <code class="nx">data</code><code class="o">-</code><code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">key</code><code class="p">}</code><code class="o">&gt;</code>
          <code class="p">{</code><code class="nx">label</code><code class="p">}</code>
        <code class="o">&lt;/</code><code class="nx">th</code><code class="o">&gt;</code>
      <code class="p">);</code>
    <code class="p">})}</code>
    <code class="o">&lt;</code><code class="nx">th</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"ExcelNotSortable"</code><code class="o">&gt;</code><code class="nx">Actions</code><code class="o">&lt;/</code><code class="nx">th</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="nx">thead</code><code class="o">&gt;</code></pre>

<p>The <code>sorting</code> variable <a data-type="indexterm" data-primary="sort() method/function" id="idm45779429423184"/><a data-type="indexterm" data-primary="sorting table data" id="idm45779429248432"/><a data-type="indexterm" data-primary="onClick handler" id="idm45779429247824"/><a data-type="indexterm" data-primary="clicks, event handling with" id="idm45779429247152"/>comes from the state and affects which headers get a sorting arrow and in which direction. The whole header (<code>&lt;thead&gt;</code>) has an <code>onClick</code> handler that calls the <code>sort()</code> helper function:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">sort</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">column</code> <code class="o">=</code> <code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">id</code><code class="p">;</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">column</code><code class="p">)</code> <code class="p">{</code> <code class="c1">// The last "Action" column is not sortable</code>
    <code class="k">return</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="kr">const</code> <code class="nx">descending</code> <code class="o">=</code> <code class="nx">sorting</code><code class="p">.</code><code class="nx">column</code> <code class="o">===</code> <code class="nx">column</code> <code class="o">&amp;&amp;</code> <code class="o">!</code><code class="nx">sorting</code><code class="p">.</code><code class="nx">descending</code><code class="p">;</code>
  <code class="nx">setSorting</code><code class="p">({</code><code class="nx">column</code><code class="p">,</code> <code class="nx">descending</code><code class="p">});</code>
  <code class="nx">dispatch</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s1">'sort'</code><code class="p">,</code> <code class="nx">payload</code><code class="o">:</code> <code class="p">{</code><code class="nx">column</code><code class="p">,</code> <code class="nx">descending</code><code class="p">}});</code>
<code class="p">}</code></pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Rendering the table body"><div class="sect3" id="idm45779429241168">
<h3>Rendering the table body</h3>

<p>The table <a data-type="indexterm" data-primary="Body component" id="idm45779429145392"/><a data-type="indexterm" data-primary="React app" data-secondary="Body component in" id="idm45779429144784"/><a data-type="indexterm" data-primary="tables" data-secondary="body of" id="idm45779429143840"/><a data-type="indexterm" data-primary="Actions component" id="idm45779429142896"/><a data-type="indexterm" data-primary="React app" data-secondary="Actions component in" id="idm45779429142224"/>body (<code>&lt;tbody&gt;</code>) consists of table rows (<code>&lt;tr&gt;</code>) with table cells within them (<code>&lt;td&gt;</code>). The last cell in each row is reserved for <code>&lt;Actions&gt;</code>. You need two loops, one for rows and one for cells (columns) within the row.</p>

<p>After some tweaking of the content of each cell (you’ll see it in the next section), you’re <a data-type="indexterm" data-primary="data" data-secondary="two-dimensional (td)" id="idm45779429139056"/><a data-type="indexterm" data-primary="tables" data-secondary="td data of" id="idm45779429138048"/><a data-type="indexterm" data-primary="td (two-dimensional) data" id="idm45779429137104"/><a data-type="indexterm" data-primary="two-dimensional (td) data" id="idm45779429136416"/>ready to define the <code>&lt;td&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">tbody</code> <code class="nx">onDoubleClick</code><code class="o">=</code><code class="p">{</code><code class="nx">showEditor</code><code class="p">}</code><code class="o">&gt;</code>
  <code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">row</code><code class="o">,</code> <code class="nx">rowidx</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>

    <code class="c1">// TODO: data filtering comes here...</code>

    <code class="k">return</code> <code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">tr</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">rowidx</code><code class="p">}</code> <code class="nx">data</code><code class="o">-</code><code class="nx">row</code><code class="o">=</code><code class="p">{</code><code class="nx">rowidx</code><code class="p">}</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nb">Object</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="nx">row</code><code class="p">).</code><code class="nx">map</code><code class="p">((</code><code class="nx">cell</code><code class="o">,</code> <code class="nx">columnidx</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>

          <code class="kd">const</code> <code class="nx">config</code> <code class="o">=</code> <code class="nx">schema</code><code class="p">[</code><code class="nx">cell</code><code class="p">];</code>
          <code class="nx">let</code> <code class="nx">content</code> <code class="o">=</code> <code class="nx">row</code><code class="p">[</code><code class="nx">cell</code><code class="p">];</code>

          <code class="c1">// TODO: content tweaks go here...</code>

          <code class="k">return</code> <code class="p">(</code>
            <code class="o">&lt;</code><code class="nx">td</code>
              <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">columnidx</code><code class="p">}</code>
              <code class="nx">data</code><code class="o">-</code><code class="nx">schema</code><code class="o">=</code><code class="p">{</code><code class="nx">cell</code><code class="p">}</code>
              <code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="nx">classNames</code><code class="p">({</code>
                <code class="p">[</code><code class="err">`</code><code class="nx">schema</code><code class="o">-</code><code class="nx">$</code><code class="p">{</code><code class="nx">cell</code><code class="p">}</code><code class="err">`</code><code class="p">]</code><code class="o">:</code> <code class="kc">true</code><code class="o">,</code>
                <code class="nx">ExcelEditable</code><code class="o">:</code> <code class="nx">config</code><code class="p">.</code><code class="nx">type</code> <code class="o">!==</code> <code class="s1">'rating'</code><code class="o">,</code>
                <code class="nx">ExcelDataLeft</code><code class="o">:</code> <code class="nx">config</code><code class="p">.</code><code class="nx">align</code> <code class="o">===</code> <code class="s1">'left'</code><code class="o">,</code>
                <code class="nx">ExcelDataRight</code><code class="o">:</code> <code class="nx">config</code><code class="p">.</code><code class="nx">align</code> <code class="o">===</code> <code class="s1">'right'</code><code class="o">,</code>
                <code class="nx">ExcelDataCenter</code><code class="o">:</code>
                  <code class="nx">config</code><code class="p">.</code><code class="nx">align</code> <code class="o">!==</code> <code class="s1">'left'</code> <code class="o">&amp;&amp;</code> <code class="nx">config</code><code class="p">.</code><code class="nx">align</code> <code class="o">!==</code> <code class="s1">'right'</code><code class="o">,</code>
              <code class="p">})}</code><code class="o">&gt;</code>
              <code class="p">{</code><code class="nx">content</code><code class="p">}</code>
            <code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
          <code class="p">);</code>
        <code class="p">})}</code>
        <code class="o">&lt;</code><code class="nx">td</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">Actions</code> <code class="nx">onAction</code><code class="o">=</code><code class="p">{</code><code class="nx">handleAction</code><code class="p">.</code><code class="nx">bind</code><code class="p">(</code><code class="kc">null</code><code class="o">,</code> <code class="nx">rowidx</code><code class="p">)}</code> <code class="o">/&gt;</code>
        <code class="o">&lt;/</code><code class="nx">td</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="nx">tr</code><code class="o">&gt;</code>
    <code class="p">);</code>
  <code class="p">})}</code>
<code class="o">&lt;/</code><code class="nx">tbody</code><code class="o">&gt;</code></pre>

<p>Most of the <a data-type="indexterm" data-primary="conditional CSS" id="idm45779429119936"/><a data-type="indexterm" data-primary="CSS" data-secondary="conditional" id="idm45779429119328"/><a data-type="indexterm" data-primary="classnames package" id="idm45779429118416"/>effort goes to defining CSS class names. They are conditional on the <code>schema</code>, for example how the various data is aligned in the cells (left of center).</p>

<p>The oddest-looking class name definition is the <code>schema-${cell}</code>. This is optional but a nice touch that provides an extra CSS class name for each data type in case the developer needs something specific. The syntax may look odd, but it’s <a data-type="indexterm" data-primary="ECMAScript" data-secondary="defining class names with" id="idm45779428885664"/>the ECMAScript way of defining dynamic (<em>computed</em>) object property names using the <code>[]</code> in combination with a template string.</p>

<p>In the end, the resulting DOM of an example cell would look something like this:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;td</code>
  <code class="na">data-schema=</code><code class="s">"grape"</code>
  <code class="na">class=</code><code class="s">"schema-grape ExcelEditable ExcelDataLeft"</code><code class="nt">&gt;</code>
  Bordeaux Blend
<code class="nt">&lt;/td&gt;</code></pre>

<p>All the cells are editable except the hard-coded actions <a data-type="indexterm" data-primary="forms in React app" data-secondary="for rating inputs" data-secondary-sortas="rating inputs" id="idm45779428879104"/><a data-type="indexterm" data-primary="Rating input" id="idm45779428878016"/>and the ratings because you don’t want accidental clicks to change the rating.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Tweaking and filtering of content"><div class="sect3" id="idm45779428876352">
<h3>Tweaking and filtering of content</h3>

<p>Let’s address the two <code>TODO</code> comments in the table rendering. <a data-type="indexterm" data-primary="editing/tweaking table data" id="idm45779428874384"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="editing/tweaking content of" id="idm45779428873616"/>First the tweaking of content, which happens in the inner loop:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="kd">const</code> <code class="nx">config</code> <code class="o">=</code> <code class="nx">schema</code><code class="p">[</code><code class="nx">cell</code><code class="p">];</code>
<code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">config</code><code class="p">.</code><code class="nx">show</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
<code class="p">}</code>
<code class="nx">let</code> <code class="nx">content</code> <code class="o">=</code> <code class="nx">row</code><code class="p">[</code><code class="nx">cell</code><code class="p">];</code>
<code class="k">if</code> <code class="p">(</code><code class="nx">edit</code> <code class="o">&amp;&amp;</code> <code class="nx">edit</code><code class="p">.</code><code class="nx">row</code> <code class="o">===</code> <code class="nx">rowidx</code> <code class="o">&amp;&amp;</code> <code class="nx">edit</code><code class="p">.</code><code class="nx">column</code> <code class="o">===</code> <code class="nx">cell</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">content</code> <code class="o">=</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">form</code> <code class="nx">onSubmit</code><code class="o">=</code><code class="p">{</code><code class="nx">save</code><code class="p">}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code> <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nx">content</code><code class="p">}</code> <code class="o">/&gt;</code>
    <code class="o">&lt;/</code><code class="nx">form</code><code class="o">&gt;</code>
  <code class="p">);</code>
<code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">config</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'rating'</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">content</code> <code class="o">=</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">Rating</code>
      <code class="nx">id</code><code class="o">=</code><code class="p">{</code><code class="nx">cell</code><code class="p">}</code>
      <code class="nx">readonly</code>
      <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">content</code><code class="p">}</code>
      <code class="nx">defaultValue</code><code class="o">=</code><code class="p">{</code><code class="nb">Number</code><code class="p">(</code><code class="nx">content</code><code class="p">)}</code>
    <code class="o">/&gt;</code>
  <code class="p">);</code>
<code class="p">}</code></pre>

<p>You have a boolean <code>show</code> config coming from the schema. It’s helpful when you have too many columns to show in a single table. In this case, the comments for each item in the table may be too long and make the table hard to parse by the user. So it’s not shown in the table, though it’s still available (in the View Details action) and editable via the Edit action.</p>

<p>Next, if the user has double-clicked to <a data-type="indexterm" data-primary="inputs" data-secondary="inline" id="idm45779428689616"/>edit the data inline (bringing the table into an edit state), you show a form. Otherwise, just the text content, unless it’s the rating cell. It’s friendlier to <a data-type="indexterm" data-primary="forms in React app" data-secondary="for rating inputs" data-secondary-sortas="rating inputs" id="idm45779428688432"/><a data-type="indexterm" data-primary="Rating input" id="idm45779428687216"/>show the “star” rating component, rather than simple text (e.g., “5” or “2”) like all other cells.</p>

<p>As for the second <code>TODO</code>, it’s the <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="filtering content of" id="idm45779428685232"/><a data-type="indexterm" data-primary="filtering" data-secondary="search strings and" id="idm45779428684208"/><a data-type="indexterm" data-primary="filtering" data-secondary="of table data" data-secondary-sortas="table data" id="idm45779428683264"/><a data-type="indexterm" data-primary="search strings and data filtering" id="idm45779428682048"/><a data-type="indexterm" data-primary="searching table data" id="idm45779428681360"/>filtering of the data as a result of the user’s search string. In the previous chapter there were separate input fields for filtering per column. In the real app, let’s have a single search input in the header and pass what the user types to the data table. The <a data-type="indexterm" data-primary="filter prop" id="idm45779428680272"/>implementation is about going through each column in a row and attempting to match with the search string passed as a <code>filter</code> prop. If no match is found, the whole row is removed from the table.</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="k">if</code> <code class="p">(</code><code class="nx">filter</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">needle</code> <code class="o">=</code> <code class="nx">filter</code><code class="p">.</code><code class="nx">toLowerCase</code><code class="p">();</code>
  <code class="kd">let</code> <code class="nx">match</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>
  <code class="kr">const</code> <code class="nx">fields</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="nx">schema</code><code class="p">);</code>
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">f</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">f</code> <code class="o">&lt;</code> <code class="nx">fields</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">f</code><code class="o">++</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">row</code><code class="p">[</code><code class="nx">fields</code><code class="p">[</code><code class="nx">f</code><code class="p">]].</code><code class="nx">toString</code><code class="p">().</code><code class="nx">toLowerCase</code><code class="p">().</code><code class="nx">includes</code><code class="p">(</code><code class="nx">needle</code><code class="p">))</code> <code class="p">{</code>
      <code class="nx">match</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">}</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">match</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="kc">null</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>And why is this filtering done here, as opposed to in the reducer function? It’s a personal choice <a data-type="indexterm" data-primary="double-calling of reducer" id="ch7_term45"/><a data-type="indexterm" data-primary="React" data-secondary="safeguards against impurities" id="ch7_term46"/><a data-type="indexterm" data-primary="reducers" data-secondary="double-calling of" id="ch7_term47"/><a data-type="indexterm" data-primary="reducers" data-secondary="Excel function" id="ch7_term48"/>dictated to an extent by the double-calling of the reducer, which React <a data-type="indexterm" data-startref="ch7_term43" id="idm45779428554400"/><a data-type="indexterm" data-startref="ch7_term44" id="idm45779428553728"/>does in “strict” mode.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="React.Strict and Reducers"><div class="sect2" id="idm45779428552800">
<h2>React.Strict and Reducers</h2>

<p><code>Excel</code> uses a <code>reducer()</code> for various <a data-type="indexterm" data-primary="onDataChange callback prop" id="idm45779428550240"/><a data-type="indexterm" data-primary="setTimeout() function" id="idm45779428549536"/>data manipulations. At the end of every manipulation, it invokes the <code>onDataChange</code> callback passed to the component. That’s how parents of <code>Excel</code> can be notified about data changes.</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">reducer</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code> <code class="nx">action</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// ...</code>
  <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="nx">data</code><code class="p">));</code>
  <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>And this is <a data-type="indexterm" data-primary="discovery tool" id="idm45779428527312"/><a data-type="indexterm" data-primary="React app" data-secondary="discovery tool in" id="idm45779428526816"/>what was in <code>&lt;Discovery&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="o">&lt;</code><code class="nx">Excel</code>
  <code class="nx">schema</code><code class="o">=</code><code class="p">{</code><code class="nx">schema</code><code class="p">}</code>
  <code class="nx">initialData</code><code class="o">=</code><code class="p">{</code><code class="cm">/* ... */</code><code class="p">}</code>
  <code class="nx">onDataChange</code><code class="o">=</code><code class="p">{(</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}}</code>
<code class="o">/&gt;</code></pre>

<p>If you test the component with the console open, you’ll see that for every change there are two identical entries in the log (see <a data-type="xref" href="#FIG0719">Figure 7-19</a> for an example).</p>

<figure><div id="FIG0719" class="figure">
<img src="Images/rur2_0719.png" alt="rur2 0719" width="600" height="264"/>
<h6><span class="label">Figure 7-19. </span>Two console messages after changing “$2 Chuck” to “$2 Chucks”</h6>
</div></figure>

<p>This happens because in <a data-type="indexterm" data-primary="Create React App (CRA)" id="idm45779428471184"/><a data-type="indexterm" data-primary="index.js" id="idm45779428470480"/><a data-type="indexterm" data-primary="React app" data-secondary="Create React App (CRA) for" id="idm45779428469808"/><a data-type="indexterm" data-primary="wrappers" id="idm45779428468800"/><a data-type="indexterm" data-primary="React.StrictMode" id="ch7_term49"/><a data-type="indexterm" data-primary="strict mode" id="ch7_term50"/>strict mode while in development, React calls your reducer twice. If you look back to <em>index.js</em> generated by CRA, the whole app is wrapped in <code>&lt;React.StrictMode&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="nx">ReactDOM</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">StrictMode</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;</code>
  <code class="o">&lt;/</code><code class="nx">React</code><code class="p">.</code><code class="nx">StrictMode</code><code class="o">&gt;,</code>
  <code class="nx">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'root'</code><code class="p">)</code>
<code class="p">);</code></pre>

<p>You can remove the wrapper:</p>

<pre data-type="programlisting" data-code-language="actionscript"><code class="nx">ReactDOM</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;,</code>
  <code class="nx">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'root'</code><code class="p">)</code>
<code class="p">);</code></pre>

<p>Now the console will have only one log message.</p>

<p>This double invocation is React helping you uncover impurities in your reducer. The reducer must be <em>pure</em>: given the same data, it should return the same results. This is a great (again, development-only) feature and you should be on the lookout for impurities. Once you build your app, there’s no more double-calling.</p>

<p>In this case (logging changes) the impurity is tolerable. But in other cases, it may not be. For example, let’s say you pass an array to the reducer and it removes the last array element before returning the array. The returned array is the same object in memory and if you pass it again to the reducer, it will remove yet another element. This is not the expected behavior.</p>

<p>In the next chapter you’ll see a <a data-type="indexterm" data-primary="callbacks" data-secondary="context as alternative to" id="idm45779428371120"/>different way (using <em>contexts</em>) to communicate between parent and child components, beyond the callback props you’ve seen so far in the book. This will help avoid the double-calling problem. Still, for education purposes and for simple callbacks (e.g., <code>&lt;Dialog onAction...&gt;</code>), using props is fine, so let’s continue with them for just a bit longer.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>“What’s with the <a data-type="indexterm" data-primary="setTimeout() function" id="idm45779428367952"/><a data-type="indexterm" data-primary="child-parent data communication" id="idm45779428367216"/><a data-type="indexterm" data-primary="parent-child data communication" id="idm45779428366528"/>timeout?” you may ask. Whenever there is a <code>setTimeout</code> with no 0 milliseconds actual timeout, chances are there’s a bit of a workaround going on. This code is no exception and it has to do, again, with the parent-child communication. We will discuss and fix this in Chapter 8.</p>
</div>

<p>As you can see, we uncovered the interesting problem that comes with reducers and strict mode. And in the future you’ll know where to look for potential reducer problems in your apps. If you see something off and it looks like something is happening twice, a quick debug exercise is to remove <code>&lt;React.StrictMode&gt;</code> and see if the problem goes away. If so, time for another look at your <a data-type="indexterm" data-startref="ch7_term45" id="idm45779428363760"/><a data-type="indexterm" data-startref="ch7_term46" id="idm45779428363056"/><a data-type="indexterm" data-startref="ch7_term47" id="idm45779428362384"/><a data-type="indexterm" data-startref="ch7_term49" id="idm45779428361712"/><a data-type="indexterm" data-startref="ch7_term50" id="idm45779428361040"/>reducers.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Excel’s Little Helpers"><div class="sect2" id="idm45779428552208">
<h2>Excel’s Little Helpers</h2>

<p>Now back to <code>Excel</code>. At this point the rendering is done. It’s time to take a look at a <a data-type="indexterm" data-primary="reducer() function" id="idm45779428333968"/><span class="keep-together">few functions</span> that you saw commented out in the initial code listing, namely the <code>reducer()</code> function and the helpers <code>sort()</code>, <code>showEditor()</code>, <code>save()</code>,  and <span class="keep-together"><code>handleAction()</code></span>.</p>










<section data-type="sect3" data-pdf-bookmark="sort()"><div class="sect3" id="idm45779428330000">
<h3>sort()</h3>

<p>In fact, there <a data-type="indexterm" data-primary="sort() method/function" id="idm45779428328672"/><a data-type="indexterm" data-primary="sorting table data" id="idm45779428327936"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="sort() function in" id="idm45779428327264"/><a data-type="indexterm" data-primary="callbacks" data-secondary="with Header component" data-secondary-sortas="Header component" id="idm45779428326352"/><a data-type="indexterm" data-primary="headers, table" id="idm45779428325136"/><a data-type="indexterm" data-primary="tables" data-secondary="headers of" id="idm45779428324464"/>was already a discussion of <code>sort()</code>. It’s a callback for clicking on table headers:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">sort</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">column</code> <code class="o">=</code> <code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">id</code><code class="p">;</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">column</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="kr">const</code> <code class="nx">descending</code> <code class="o">=</code> <code class="nx">sorting</code><code class="p">.</code><code class="nx">column</code> <code class="o">===</code> <code class="nx">column</code> <code class="o">&amp;&amp;</code> <code class="o">!</code><code class="nx">sorting</code><code class="p">.</code><code class="nx">descending</code><code class="p">;</code>
  <code class="nx">setSorting</code><code class="p">({</code><code class="nx">column</code><code class="p">,</code> <code class="nx">descending</code><code class="p">});</code>
  <code class="nx">dispatch</code><code class="p">({</code><code class="nx">type</code><code class="o">:</code> <code class="s1">'sort'</code><code class="p">,</code> <code class="nx">payload</code><code class="o">:</code> <code class="p">{</code><code class="nx">column</code><code class="p">,</code> <code class="nx">descending</code><code class="p">}});</code>
<code class="p">}</code></pre>

<p>The general task is to <a data-type="indexterm" data-primary="dispatch() function" id="idm45779428322016"/>figure out what happened (user clicked a header, which one?), then update the state (call <code>setSorting()</code> provided by <code>useState()</code> to draw the sorting arrows) and <code>dispatch()</code> an event to be handled by the reducer. The reducer’s task is to do the actual <a data-type="indexterm" data-startref="ch7_term48" id="idm45779428223392"/>sorting.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="showEditor()"><div class="sect3" id="idm45779428222432">
<h3>showEditor()</h3>

<p>Another short <a data-type="indexterm" data-primary="showEditor() method/function" id="idm45779428221104"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="showEditor() function in" id="idm45779428220400"/><a data-type="indexterm" data-primary="double-clicks, event handling with" id="idm45779428219424"/><a data-type="indexterm" data-primary="inputs" data-secondary="inline" id="idm45779428218736"/>helper function is <code>showEditor()</code>. It’s called when the user double-clicks a cell and changes the state so an inline input field is shown:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">showEditor</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">config</code> <code class="o">=</code> <code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">schema</code><code class="p">;</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">config</code> <code class="o">||</code> <code class="nx">config</code> <code class="o">===</code> <code class="s1">'rating'</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="nx">setEdit</code><code class="p">({</code>
    <code class="nx">row</code><code class="o">:</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">parentNode</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">row</code><code class="p">,</code> <code class="mi">10</code><code class="p">),</code>
    <code class="nx">column</code><code class="o">:</code> <code class="nx">config</code><code class="p">,</code>
  <code class="p">});</code>
<code class="p">}</code></pre>

<p>Because this function is called for all clicks anywhere in the table (<code>&lt;tbody onDoubleClick={showEditor}&gt;</code>) you need to filter out cases where no inline form is desirable, namely, the rating (no inline rating of items) and anywhere in the action column. Action columns don’t have associated schema configuration so <code>!config</code> takes care of this case. For <a data-type="indexterm" data-primary="setEdit() function" id="idm45779428127248"/>all other cells, <code>setEdit()</code> is called, which updates the state identifying which cell is to be edited. Since this is a rendering-only change, the reducer doesn’t get involved and so no <code>dispatch()</code> is necessary.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="save()"><div class="sect3" id="idm45779428125408">
<h3>save()</h3>

<p>Next, <a data-type="indexterm" data-primary="save() method/function" id="idm45779428123856"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="save() function in" id="idm45779428123152"/><a data-type="indexterm" data-primary="onSubmit event handler" id="idm45779428122208"/>the <code>save()</code> helper. It’s invoked when the user is done with inline editing and submits the inline form by hitting Enter (<code>&lt;form onSubmit={save}&gt;</code>). Similarly to <code>sort()</code>, <code>save()</code> needs to know what happened (what was submitted) and then <a data-type="indexterm" data-primary="dispatch() function" id="idm45779428119552"/>update the state (<code>setEdit()</code>) and <code>dispatch()</code> an event for the reducer to update the data:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">save</code><code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">e</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>
  <code class="kr">const</code> <code class="nx">value</code> <code class="o">=</code> <code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">firstChild</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code>
  <code class="kr">const</code> <code class="nx">valueType</code> <code class="o">=</code> <code class="nx">schema</code><code class="p">[</code><code class="nx">e</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">parentNode</code><code class="p">.</code><code class="nx">dataset</code><code class="p">.</code><code class="nx">schema</code><code class="p">].</code><code class="nx">type</code><code class="p">;</code>
  <code class="nx">dispatch</code><code class="p">({</code>
    <code class="nx">type</code><code class="o">:</code> <code class="s1">'save'</code><code class="p">,</code>
    <code class="nx">payload</code><code class="o">:</code> <code class="p">{</code>
      <code class="nx">edit</code><code class="p">,</code>
      <code class="nx">value</code><code class="p">,</code>
      <code class="nx">onDataChange</code><code class="p">,</code>
      <code class="kr">int</code><code class="o">:</code> <code class="nx">valueType</code> <code class="o">===</code> <code class="s1">'year'</code> <code class="o">||</code> <code class="nx">valueType</code> <code class="o">===</code> <code class="s1">'rating'</code><code class="p">,</code>
    <code class="p">},</code>
  <code class="p">});</code>
  <code class="nx">setEdit</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>Figuring <a data-type="indexterm" data-primary="valueType" id="idm45779428113904"/>out the <code>valueType</code> helps the reducer write integers versus strings in the data, since all form values come as strings from the DOM.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="handleAction()"><div class="sect3" id="idm45779428006640">
<h3>handleAction()</h3>

<p>Next, <a data-type="indexterm" data-primary="Excel component in React app" data-secondary="handleAction() function in" id="ch7_term51"/><a data-type="indexterm" data-primary="handleAction() function" id="ch7_term52"/>the <code>handleAction()</code> method. It is the longest, but it’s not too complex. It needs to deal with three types of actions: delete, edit, and view info. Edit and info are close in implementation as the info is a read-only form. Let’s start with deleting:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">handleAction</code><code class="p">(</code><code class="nx">rowidx</code><code class="p">,</code> <code class="nx">type</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'delete'</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">setDialog</code><code class="p">(</code>
      <code class="o">&lt;</code><code class="nx">Dialog</code>
        <code class="nx">modal</code>
        <code class="nx">header</code><code class="o">=</code><code class="s2">"Confirm deletion"</code>
        <code class="nx">confirmLabel</code><code class="o">=</code><code class="s2">"Delete"</code>
        <code class="nx">onAction</code><code class="o">=</code><code class="p">{(</code><code class="nx">action</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
          <code class="nx">setDialog</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
          <code class="k">if</code> <code class="p">(</code><code class="nx">action</code> <code class="o">===</code> <code class="s1">'confirm'</code><code class="p">)</code> <code class="p">{</code>
            <code class="nx">dispatch</code><code class="p">({</code>
              <code class="nx">type</code><code class="o">:</code> <code class="s1">'delete'</code><code class="p">,</code>
              <code class="nx">payload</code><code class="o">:</code> <code class="p">{</code>
                <code class="nx">rowidx</code><code class="p">,</code>
                <code class="nx">onDataChange</code><code class="p">,</code>
              <code class="p">},</code>
            <code class="p">});</code>
          <code class="p">}</code>
        <code class="p">}}</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="sb">`Are you sure you want to delete "</code><code class="si">${</code><code class="nx">data</code><code class="p">[</code><code class="nx">rowidx</code><code class="p">].</code><code class="nx">name</code><code class="si">}</code><code class="sb">"?`</code><code class="p">}</code>
      <code class="o">&lt;</code><code class="err">/Dialog&gt;,</code>
    <code class="p">);</code>
  <code class="p">}</code>

  <code class="c1">// TODO: edit and info</code>
<code class="p">}</code></pre>

<p>Clicking the <a data-type="indexterm" data-primary="Delete action" id="idm45779428001312"/><a data-type="indexterm" data-primary="Dialog component" data-secondary="handleAction() and" id="idm45779428000704"/><a data-type="indexterm" data-primary="setDialog() function" id="idm45779427877936"/>Delete action brings up a <code>&lt;Dialog&gt;</code> saying “Are you sure?” by updating the state with <code>setDialog()</code> and passing a <code>&lt;Dialog&gt;</code> component as the dialog state. Regardless of the answer (the dialog’s <code>onAction</code>) the dialog is dismissed by passing a <code>null</code> dialog (<code>setDialog(null)</code>). But if the action was “confirm,” then an event is dispatched to the reducer.</p>

<p>If the user’s action is for editing or viewing a data row, a new <code>&lt;Dialog&gt;</code> is created, one that has a form for editing. The form is read-only when simply viewing the data. The user can then dismiss the dialog, abandoning any changes (which is the only option when viewing) or saving the changes. Saving means another dispatch, <a data-type="indexterm" data-primary="form ref" id="idm45779427873504"/><a data-type="indexterm" data-primary="refs, passing of" id="idm45779427872800"/>which includes a <code>ref</code> to the form, so the reducer can harvest the form data.</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">isEdit</code> <code class="o">=</code> <code class="nx">type</code> <code class="o">===</code> <code class="s1">'edit'</code><code class="p">;</code>
<code class="k">if</code> <code class="p">(</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'info'</code> <code class="o">||</code> <code class="nx">isEdit</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">formPrefill</code> <code class="o">=</code> <code class="nx">data</code><code class="p">[</code><code class="nx">rowidx</code><code class="p">];</code>
  <code class="nx">setDialog</code><code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">Dialog</code>
      <code class="nx">modal</code>
      <code class="nx">extendedDismiss</code><code class="o">=</code><code class="p">{</code><code class="o">!</code><code class="nx">isEdit</code><code class="p">}</code>
      <code class="nx">header</code><code class="o">=</code><code class="p">{</code><code class="nx">isEdit</code> <code class="o">?</code> <code class="s1">'Edit item'</code> <code class="o">:</code> <code class="s1">'Item details'</code><code class="p">}</code>
      <code class="nx">confirmLabel</code><code class="o">=</code><code class="p">{</code><code class="nx">isEdit</code> <code class="o">?</code> <code class="s1">'Save'</code> <code class="o">:</code> <code class="s1">'ok'</code><code class="p">}</code>
      <code class="nx">hasCancel</code><code class="o">=</code><code class="p">{</code><code class="nx">isEdit</code><code class="p">}</code>
      <code class="nx">onAction</code><code class="o">=</code><code class="p">{(</code><code class="nx">action</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="nx">setDialog</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>
        <code class="k">if</code> <code class="p">(</code><code class="nx">isEdit</code> <code class="o">&amp;&amp;</code> <code class="nx">action</code> <code class="o">===</code> <code class="s1">'confirm'</code><code class="p">)</code> <code class="p">{</code>
          <code class="nx">dispatch</code><code class="p">({</code>
            <code class="nx">type</code><code class="o">:</code> <code class="s1">'saveForm'</code><code class="p">,</code>
            <code class="nx">payload</code><code class="o">:</code> <code class="p">{</code>
              <code class="nx">rowidx</code><code class="p">,</code>
              <code class="nx">onDataChange</code><code class="p">,</code>
              <code class="nx">form</code><code class="p">,</code>
            <code class="p">},</code>
          <code class="p">});</code>
        <code class="p">}</code>
      <code class="p">}}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">Form</code>
        <code class="nx">ref</code><code class="o">=</code><code class="p">{</code><code class="nx">form</code><code class="p">}</code>
        <code class="nx">fields</code><code class="o">=</code><code class="p">{</code><code class="nx">schema</code><code class="p">}</code>
        <code class="nx">initialData</code><code class="o">=</code><code class="p">{</code><code class="nx">formPrefill</code><code class="p">}</code>
        <code class="nx">readonly</code><code class="o">=</code><code class="p">{</code><code class="o">!</code><code class="nx">isEdit</code><code class="p">}</code>
      <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/Dialog&gt;,</code>
  <code class="p">);</code></pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="reducer()"><div class="sect3" id="idm45779427871168">
<h3>reducer()</h3>

<p>Finally, the <a data-type="indexterm" data-startref="ch7_term51" id="idm45779427869792"/><a data-type="indexterm" data-startref="ch7_term52" id="idm45779427869056"/><a data-type="indexterm" data-primary="Excel component in React app" data-secondary="reducer() function in" id="ch7_term53"/><a data-type="indexterm" data-primary="reducer() function" id="ch7_term54"/><a data-type="indexterm" data-primary="reducers" data-secondary="Excel function" id="ch7_term55"/>almighty reducer. It’s similar to what you already saw toward the end of <a data-type="xref" href="ch04.xhtml#ch4">Chapter 4</a>. The sorting and inline editing parts are pretty much the same, the filtering is gone and moved to the rendering of the table, and there’s now a way to delete rows and to save the editing form:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">reducer</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code> <code class="nx">action</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'sort'</code><code class="p">)</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">{</code><code class="nx">column</code><code class="p">,</code> <code class="nx">descending</code><code class="p">}</code> <code class="o">=</code> <code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">;</code>
    <code class="k">return</code> <code class="nx">data</code><code class="p">.</code><code class="nx">sort</code><code class="p">((</code><code class="nx">a</code><code class="p">,</code> <code class="nx">b</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="k">if</code> <code class="p">(</code><code class="nx">a</code><code class="p">[</code><code class="nx">column</code><code class="p">]</code> <code class="o">===</code> <code class="nx">b</code><code class="p">[</code><code class="nx">column</code><code class="p">])</code> <code class="p">{</code>
        <code class="k">return</code> <code class="mi">0</code><code class="p">;</code>
      <code class="p">}</code>
      <code class="k">return</code> <code class="nx">descending</code>
        <code class="o">?</code> <code class="nx">a</code><code class="p">[</code><code class="nx">column</code><code class="p">]</code> <code class="o">&lt;</code> <code class="nx">b</code><code class="p">[</code><code class="nx">column</code><code class="p">]</code>
          <code class="o">?</code> <code class="mi">1</code>
          <code class="o">:</code> <code class="o">-</code><code class="mi">1</code>
        <code class="o">:</code> <code class="nx">a</code><code class="p">[</code><code class="nx">column</code><code class="p">]</code> <code class="o">&gt;</code> <code class="nx">b</code><code class="p">[</code><code class="nx">column</code><code class="p">]</code>
          <code class="o">?</code> <code class="mi">1</code>
          <code class="o">:</code> <code class="o">-</code><code class="mi">1</code><code class="p">;</code>
    <code class="p">});</code>
  <code class="p">}</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'save'</code><code class="p">)</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">{</code><code class="kr">int</code><code class="p">,</code> <code class="nx">edit</code><code class="p">}</code> <code class="o">=</code> <code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">;</code>
    <code class="nx">data</code><code class="p">[</code><code class="nx">edit</code><code class="p">.</code><code class="nx">row</code><code class="p">][</code><code class="nx">edit</code><code class="p">.</code><code class="nx">column</code><code class="p">]</code> <code class="o">=</code> <code class="kr">int</code>
      <code class="o">?</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">value</code><code class="p">,</code> <code class="mi">10</code><code class="p">)</code>
      <code class="o">:</code> <code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">value</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'delete'</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">data</code> <code class="o">=</code> <code class="nx">clone</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
    <code class="nx">data</code><code class="p">.</code><code class="nx">splice</code><code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">rowidx</code><code class="p">,</code> <code class="mi">1</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="k">if</code> <code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s1">'saveForm'</code><code class="p">)</code> <code class="p">{</code>
    <code class="nb">Array</code><code class="p">.</code><code class="nx">from</code><code class="p">(</code><code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">form</code><code class="p">.</code><code class="nx">current</code><code class="p">).</code><code class="nx">forEach</code><code class="p">(</code>
      <code class="p">(</code><code class="nx">input</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">(</code><code class="nx">data</code><code class="p">[</code><code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">rowidx</code><code class="p">][</code><code class="nx">input</code><code class="p">.</code><code class="nx">id</code><code class="p">]</code> <code class="o">=</code> <code class="nx">input</code><code class="p">.</code><code class="nx">value</code><code class="p">),</code>
    <code class="p">);</code>
  <code class="p">}</code>

  <code class="nx">setTimeout</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">action</code><code class="p">.</code><code class="nx">payload</code><code class="p">.</code><code class="nx">onDataChange</code><code class="p">(</code><code class="nx">data</code><code class="p">));</code>
  <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>The last two lines were already discussed above. The rest is all about array manipulation. The reducer is called with the current data and some payload describing what happened, and it acts on that information.</p>

<p>One thing to <a data-type="indexterm" data-primary="cloning" data-secondary="reducer and" id="idm45779427661184"/><a data-type="indexterm" data-primary="copying data" id="idm45779427660304"/><a data-type="indexterm" data-primary="Delete action" id="idm45779427659632"/><a data-type="indexterm" data-primary="double-calling of reducer" id="idm45779427658960"/><a data-type="indexterm" data-primary="reducers" data-secondary="double-calling of" id="idm45779427658272"/>note is how the <em>delete</em> action is the only one doing the cloning of the original array. This goes back to the discussion above about the double-calling of the reducer. All other actions can get away with modifying the array as they have an exact row/column to modify. Or, in the case of sorting, no data pieces are being modified. So asking twice, “Please update column 1, row 2, with value 2018” has the same effect every time. However, all the rows are just zero-indexed array elements. When you have elements 0, 1, and 2 and you delete 1, then you have 0, 1. And so deleting <code>id</code> 1 twice deletes two elements. Cloning the array before deletion solves this by producing a new array object. The double-calling happens both times with the original <code>data</code>, not with the <code>data</code> returned by the first call, so removing <code>id</code> 1 from 0, 1, 2 and again from 0, 1, 2. Tiny details like this when it’s a combination of React strict and the way objects (and arrays are objects too) work in JavaScript may cause trouble. So be extra diligent when modifying with arrays and objects in your reducers.</p>

<p>And with this, the last <a data-type="indexterm" data-startref="ch7_term40" id="idm45779427358032"/><a data-type="indexterm" data-startref="ch7_term53" id="idm45779427357296"/><a data-type="indexterm" data-startref="ch7_term54" id="idm45779427356624"/><a data-type="indexterm" data-startref="ch7_term55" id="idm45779427355952"/>component in the app is done and it’s time to put them all together to create a working app.</p>
</div></section>



</div></section>





</div></section>







</div></section></div></body>
</html>