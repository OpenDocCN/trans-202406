<html><head></head><body><section data-pdf-bookmark="Chapter 10. User Feedback" data-type="chapter" epub:type="chapter"><div class="chapter" id="topics_user_feedback">&#13;
<h1><span class="label">Chapter 10. </span>User Feedback</h1>&#13;
&#13;
&#13;
<p>In any program, it’s important to be able to provide your user information in a short-lived UI. Especially as it relates to mobile development, we’d quickly run out of real estate if each warning, alert, prompt, or notification appeared in the UI. Both frameworks provide a variety of facilities to accomplish this.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Tasks" data-type="sect1"><div class="sect1" id="idm46177222579272">&#13;
<h1>Tasks</h1>&#13;
&#13;
<p>In<a data-primary="user feedback" data-secondary="task overview" data-type="indexterm" id="idm46177222577944"/> this chapter, you’ll learn to:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Use framework-provided tools to show the user feedback in a variety of <span class="keep-together">circumstances</span>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Update the status bar.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Android" data-type="sect1"><div class="sect1" id="idm46177222573592">&#13;
<h1>Android</h1>&#13;
&#13;
<p>There are several APIs provided by the Android framework to display immediate feedback about an event, error, or change in state. Some simply display text, but others allow varying levels of customization and interactivity. We’ll examine the three main feedback classes and show you how to program them to meet your specific needs.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use Framework-Provided Tools to Show the User Feedback" data-type="sect2"><div class="sect2" id="idm46177222571512">&#13;
<h2>Use Framework-Provided Tools to Show the User Feedback</h2>&#13;
&#13;
<p>While<a data-primary="user feedback" data-secondary="Android" data-tertiary="framework-provided tools for" data-type="indexterm" id="idm46177222569976"/><a data-primary="Android" data-secondary="user feedback" data-tertiary="framework-provided tools for" data-type="indexterm" id="idm46177222568728"/> you’re free to present information to your users in any way you want using standard layout and drawing methods, the Android framework provides three main APIs to provide feedback to your users, graphically:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <code>Toast</code> class</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>Snackbar</code> class</p>&#13;
</li>&#13;
<li>&#13;
<p>The <code>Dialog</code> class</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The<a data-primary="Toast class" data-type="indexterm" id="idm46177222562104"/><a data-primary="Snackbar class" data-type="indexterm" id="idm46177222561368"/><a data-primary="Dialog class" data-type="indexterm" id="idm46177222560696"/> <code>Toast</code> class predates <code>Snackbar</code>, and while basic usage is very similar, it can be a bit simpler. On the other hand, if used correctly, a <code>Snackbar</code> can provide a nicer user experience and has flexibility not available to <code>Toast</code> messages. Dialogs are modal interfaces that can support a wide variety of elements, including elements to display <em>and receive</em> information to, and from, your users.</p>&#13;
&#13;
<p>Let’s jump right in.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Toast" data-type="sect3"><div class="sect3" id="idm46177222557112">&#13;
<h3>Toast</h3>&#13;
&#13;
<p>A<a data-primary="user feedback" data-secondary="Android" data-tertiary="Toast messages" data-type="indexterm" id="idm46177222555512"/><a data-primary="Android" data-secondary="user feedback" data-tertiary="Toast messages" data-type="indexterm" id="idm46177222554232"/> <code>Toast</code> message is implementation-specific. A version of the Android OS might choose to implement details differently, or older devices—when Android OS standards were looser for manufacturers—might even differ between device makes and models.</p>&#13;
&#13;
<p>Generally speaking, a <code>Toast</code> message is a brief, short-lived message displayed to your user over existing content. From the <a href="https://oreil.ly/zXgqS">Android developer docs</a>:</p>&#13;
<blockquote>&#13;
<p>A toast provides simple feedback about an operation in a small popup. It only fills the amount of space required for the message and the current activity remains visible and interactive. Toasts automatically disappear after a timeout.</p></blockquote>&#13;
&#13;
<p>To<a data-primary="Java" data-secondary="user feedback" data-tertiary="Toast messages" data-type="indexterm" id="idm46177222549144"/><a data-primary="Kotlin" data-secondary="user feedback" data-tertiary="Toast messages" data-type="indexterm" id="idm46177222547864"/> show a <code>Toast</code> message, use the following:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177222545928">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Toast</code><code class="o">.</code><code class="na">makeText</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="s">"Hi there!"</code><code class="o">,</code> <code class="n">Toast</code><code class="o">.</code><code class="na">LENGTH_SHORT</code><code class="o">).</code><code class="na">show</code><code class="o">();</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">Toast</code><code class="p">.</code><code class="n">makeText</code><code class="p">(</code><code class="n">context</code><code class="p">,</code> <code class="s">"Hi there!"</code><code class="p">,</code> <code class="n">Toast</code><code class="p">.</code><code class="n">LENGTH_SHORT</code><code class="p">).</code><code class="n">show</code><code class="p">()</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>That’s it! We have a <code>Context</code> instance, the message to display, and a duration constant (either <code>LENGTH_SHORT</code> or <code>LENGTH_LONG</code>).</p>&#13;
&#13;
<p>There are other APIs available, like setting where a <code>Toast</code> displays on the screen (its “gravity”), and even providing <code>Toast</code> pop-ups with custom <code>View</code> trees, but most of the time, <code>makeText</code> and <code>show</code> are all you’ll need.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Snackbar" data-type="sect2"><div class="sect2" id="idm46177222518568">&#13;
<h2>Snackbar</h2>&#13;
&#13;
<p>As<a data-primary="user feedback" data-secondary="Android" data-tertiary="Snackbar messages" data-type="indexterm" id="idm46177222420104"/><a data-primary="Android" data-secondary="user feedback" data-tertiary="Snackbar messages" data-type="indexterm" id="idm46177222418824"/><a data-primary="Snackbar class" data-type="indexterm" id="idm46177222417608"/> mentioned, the basics of <code>Toast</code> and <code>Snackbar</code> are very similar—both show a short-lived message to the user, on top of an existing UI. In fact, if you consider the basic <code>Snackbar</code> invocation compared to the basic <code>Toast</code> invocation shown previously, they’re nearly<a data-primary="Java" data-secondary="user feedback" data-tertiary="Snackbar messages" data-type="indexterm" id="idm46177222414936"/><a data-primary="Kotlin" data-secondary="user feedback" data-tertiary="Snackbar messages" data-type="indexterm" id="idm46177222413688"/> identical:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177222412344">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Snackbar</code><code class="o">.</code><code class="na">make</code><code class="o">(</code><code class="n">someView</code><code class="o">,</code> <code class="s">"Hello there!"</code><code class="o">,</code> <code class="n">Snackbar</code><code class="o">.</code><code class="na">LENGTH_SHORT</code><code class="o">).</code><code class="na">show</code><code class="o">();</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">Snackbar</code><code class="p">.</code><code class="n">make</code><code class="p">(</code><code class="n">someView</code><code class="p">,</code> <code class="s">"Hello there!"</code><code class="p">,</code> <code class="n">Snackbar</code><code class="p">.</code><code class="n">LENGTH_SHORT</code><code class="p">).</code><code class="n">show</code><code class="p">()</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Instead of a <code>Context</code> instance as the first method parameter, <code>Snackbar.make</code> asks for a <code>View</code> instance, and the naming is slightly different (<code>Toast.makeText</code> versus <code>Snackbar.make</code>), but otherwise they’re the same.</p>&#13;
&#13;
<p>The primary differences in terms of user experience are that:</p>&#13;
<ol>&#13;
<li>&#13;
<p>A <code>Snackbar</code> generally slides up from the bottom, while a <code>Toast</code> usually fades into the center of the screen.</p>&#13;
</li>&#13;
<li>&#13;
<p>A <code>Snackbar</code> can provide a simple action button to the right of the message with a single method call: <code>setAction</code>. The same can be done with a <code>Toast</code>, but this requires much more custom coding.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Also be aware that the maintainers encourage developers to prefer <code>Snackbar</code> over <code>Toast</code> now, according to the <a href="https://oreil.ly/XPy7s">Android developer docs</a>:</p>&#13;
<blockquote>&#13;
<p>The Snackbar class supersedes Toast. While Toast is currently still supported, Snackbar is now the preferred way to display brief, transient messages to the user.</p></blockquote>&#13;
&#13;
<p>The primary difference between <code>Snackbar</code> and <code>Toast</code>, however, can be seen when a <code>Snackbar</code> is attached to a <code>CoordinatorLayout</code>, which should be the root view of the <code>View</code> instance passed as the first parameter to the <code>make</code> method. By doing this, the <code>Snackbar</code> gains some additional features, like the ability to swipe the screen to dismiss it, and awareness of other components managed by the <code>CoordinatorLayout</code>. For example, a <code>FloatingActionButton</code> will move up and out of the way as a <code>Snackbar</code> slides into place. See <a href="https://oreil.ly/n8Mbx">the Android developer docs</a> for more information.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Dialogs" data-type="sect3"><div class="sect3" id="idm46177222329688">&#13;
<h3>Dialogs</h3>&#13;
&#13;
<p><code>Dialog</code> and<a data-primary="Dialog class" data-type="indexterm" id="idm46177222322472"/><a data-primary="user feedback" data-secondary="Android" data-tertiary="Dialog messages" data-type="indexterm" id="idm46177222321736"/><a data-primary="Android" data-secondary="user feedback" data-tertiary="Dialog messages" data-type="indexterm" id="idm46177222320520"/> <code>Dialog</code> subclasses are quite a bit more powerful and flexible than the preceding <code>Toast</code> and <code>Snackbar</code> classes, but can also require more attention, maintenance, and configuration.</p>&#13;
&#13;
<p>From the <a href="https://oreil.ly/xPFao">developer docs</a>:</p>&#13;
<blockquote>&#13;
<p>A dialog is a small window that prompts the user to make a decision or enter additional information. A dialog does not fill the screen and is normally used for modal events that require users to take an action before they can proceed.</p></blockquote>&#13;
&#13;
<p>As with the previously discussed classes, the <code>Dialog</code> UI can be entirely custom; there are also facilities for single- or multiple-choice feedback, and adding user response functionality is fairly straightforward.</p>&#13;
&#13;
<p>To create and show a <code>Dialog</code> with a title, a message, and buttons to “accept” or “cancel” an offered operation, you might do something<a data-primary="Java" data-secondary="user feedback" data-tertiary="Dialog messages" data-type="indexterm" id="idm46177222297576"/><a data-primary="Kotlin" data-secondary="user feedback" data-tertiary="Dialog messages" data-type="indexterm" id="idm46177222296392"/> like this:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177222294920">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="k">new</code> <code class="n">AlertDialog</code><code class="o">.</code><code class="na">Builder</code><code class="o">(</code><code class="n">context</code><code class="o">).</code><code class="na">setMessage</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">string</code><code class="o">.</code><code class="na">my_message</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setTitle</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">string</code><code class="o">.</code><code class="na">my_title</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setPositiveButton</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">string</code><code class="o">.</code><code class="na">my_accept_string</code><code class="o">,</code> <code class="o">(</code><code class="n">d</code><code class="o">,</code> <code class="n">id</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">Log</code><code class="o">.</code><code class="na">d</code><code class="o">(</code><code class="s">"MyTag"</code><code class="o">,</code> <code class="s">"Accepted!"</code><code class="o">))</code>&#13;
  <code class="o">.</code><code class="na">setNegativeButton</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">string</code><code class="o">.</code><code class="na">my_cancel_string</code><code class="o">,</code> <code class="o">(</code><code class="n">d</code><code class="o">,</code> <code class="n">id</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">Log</code><code class="o">.</code><code class="na">d</code><code class="o">(</code><code class="s">"MyTag"</code><code class="o">,</code> <code class="s">"Cancelled!"</code><code class="o">))</code>&#13;
  <code class="o">.</code><code class="na">create</code><code class="o">().</code><code class="na">show</code><code class="o">();</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="n">AlertDialog</code><code class="p">.</code><code class="n">Builder</code><code class="p">(</code><code class="n">context</code><code class="p">).</code><code class="n">setMessage</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">string</code><code class="p">.</code><code class="n">my_message</code><code class="p">)</code>&#13;
    <code class="p">.</code><code class="n">setTitle</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">string</code><code class="p">.</code><code class="n">my_title</code><code class="p">)</code>&#13;
    <code class="p">.</code><code class="n">setPositiveButton</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">string</code><code class="p">.</code><code class="n">my_accept_string</code><code class="p">,</code> <code class="p">{</code> <code class="n">d</code><code class="p">,</code> <code class="n">id</code> <code class="p">-&gt;</code> <code class="n">Log</code><code class="p">.</code><code class="n">d</code><code class="p">(</code><code class="s">"MyTag"</code><code class="p">,</code>&#13;
    <code class="s">"Accepted!"</code><code class="p">)</code> <code class="p">})</code>&#13;
    <code class="p">.</code><code class="n">setNegativeButton</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">string</code><code class="p">.</code><code class="n">my_cancel_string</code><code class="p">,</code> <code class="p">{</code> <code class="n">d</code><code class="p">,</code> <code class="n">id</code> <code class="p">-&gt;</code> <code class="n">Log</code><code class="p">.</code><code class="n">d</code><code class="p">(</code><code class="s">"MyTag"</code><code class="p">,</code>&#13;
    <code class="s">"Cancelled!"</code><code class="p">)</code> <code class="p">})</code>&#13;
    <code class="p">.</code><code class="n">create</code><code class="p">().</code><code class="n">show</code><code class="p">()</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>For more information about <code>Dialogs</code>, see <a href="https://oreil.ly/-VXCz">the developer docs</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Update the Status Bar" data-type="sect2"><div class="sect2" id="idm46177222421144">&#13;
<h2>Update the Status Bar</h2>&#13;
&#13;
<p>In<a data-primary="status bars, updating" data-secondary="Android" data-type="indexterm" id="idm46177222087048"/><a data-primary="user feedback" data-secondary="Android" data-tertiary="status bar updates" data-type="indexterm" id="idm46177222086040"/><a data-primary="Android" data-secondary="user feedback" data-tertiary="status bar updates" data-type="indexterm" id="idm46177222084824"/> Android, the status bar is the topmost area of the screen, where you’ll find system information like time, battery level, network state, etc. This kind of system-level data is generally displayed on the right half of that top bar, while application-level information, usually in the form of very small icons, is displayed on the left edge. These<a data-primary="Notifications API" data-type="indexterm" id="idm46177222083112"/> icons are known as “notification” icons, and generally correspond to a <code>Notification</code> instance, which is a UI that exists outside of your application and generally consists of a short message but may also include some actionable items. For example, when a download completes, your app may issue a <code>Notification</code> that briefly shows the user a message and maintains an icon in the status bar so the user can access that message again later. Some action might be attached to the message as well, like opening your app to the downloaded item’s detail screen, or a list of downloads. The <code>Notifications</code> API is robust and feature-full, but might not be as intuitive as some of the previously discussed user feedback provisions.</p>&#13;
&#13;
<p>Note also that the <code>Notifications</code> API has changed dramatically more than once as the AOSP has matured. Major changes were introduced in Android OS version 5, as well as version 8. We’ll touch on the basics here, but as always, check out <a href="https://oreil.ly/wGqyn">the developer docs</a> for a deeper dive.</p>&#13;
&#13;
<p>At the most basic level, here’s how to show a <code>Notification</code> using the <em>compat</em> library (make sure you have the dependency for <code>com.android.support:support-compat:xx.xx.xx</code>):</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177222076808">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre class="small" data-code-language="java" data-type="programlisting"><code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">CHANNEL_ID</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>&#13;
<code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">NOTIFICATION_ID</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code>&#13;
&#13;
<code class="o">...</code>&#13;
&#13;
<code class="n">NotificationCompat</code><code class="o">.</code><code class="na">Builder</code> <code class="n">builder</code> <code class="o">=</code> <code class="k">new</code> <code class="n">NotificationCompat</code><code class="o">.</code><code class="na">Builder</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="n">CHANNEL_ID</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setSmallIcon</code><code class="o">(</code><code class="n">R</code><code class="o">.</code><code class="na">drawable</code><code class="o">.</code><code class="na">my_notification_icon</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setContentTitle</code><code class="o">(</code><code class="s">"Title"</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setContentText</code><code class="o">(</code><code class="s">"Message body."</code><code class="o">)</code>&#13;
  <code class="o">.</code><code class="na">setPriority</code><code class="o">(</code><code class="n">NotificationCompat</code><code class="o">.</code><code class="na">PRIORITY_DEFAULT</code><code class="o">);</code>&#13;
&#13;
<code class="n">NotificationManagerCompat</code> <code class="n">notificationManager</code> <code class="o">=</code> <code class="n">NotificationManagerCompat</code><code class="o">.</code><code class="na">from</code><code class="o">(</code><code class="k">this</code><code class="o">);</code>&#13;
<code class="n">notificationManager</code><code class="o">.</code><code class="na">notify</code><code class="o">(</code><code class="n">NOTIFICATION_ID</code><code class="o">,</code> <code class="n">builder</code><code class="o">.</code><code class="na">build</code><code class="o">());</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre class="small" data-code-language="kotlin" data-type="programlisting"><code class="n">const</code> <code class="k">val</code> <code class="py">CHANNEL_ID</code> <code class="p">=</code> <code class="m">1</code>&#13;
<code class="n">const</code> <code class="k">val</code> <code class="py">NOTIFICATION_ID</code> <code class="p">=</code> <code class="m">1</code>&#13;
&#13;
<code class="p">...</code>&#13;
&#13;
<code class="k">val</code> <code class="py">builder</code> <code class="p">=</code> <code class="n">NotificationCompat</code><code class="p">.</code><code class="n">Builder</code><code class="p">(</code><code class="k">this</code><code class="p">,</code> <code class="n">CHANNEL_ID</code><code class="p">)</code>&#13;
<code class="p">.</code><code class="n">setSmallIcon</code><code class="p">(</code><code class="n">R</code><code class="p">.</code><code class="n">drawable</code><code class="p">.</code><code class="n">my_notification_icon</code><code class="p">)</code>&#13;
<code class="p">.</code><code class="n">setContentTitle</code><code class="p">(</code><code class="s">"Title"</code><code class="p">)</code>&#13;
<code class="p">.</code><code class="n">setContentText</code><code class="p">(</code><code class="s">"Message body."</code><code class="p">)</code>&#13;
<code class="p">.</code><code class="n">setPriority</code><code class="p">(</code><code class="n">NotificationCompat</code><code class="p">.</code><code class="n">PRIORITY_DEFAULT</code><code class="p">)</code>&#13;
<code class="k">val</code> <code class="py">notificationManager</code> <code class="p">=</code> <code class="n">NotificationManagerCompat</code><code class="p">.</code><code class="n">from</code><code class="p">(</code><code class="k">this</code><code class="p">)</code>&#13;
<code class="n">notificationManager</code><code class="p">.</code><code class="n">notify</code><code class="p">(</code><code class="n">NOTIFICATION_ID</code><code class="p">,</code> <code class="n">builder</code><code class="p">.</code><code class="n">build</code><code class="p">())</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>To launch an <code>Activity</code> when the user taps the <code>Notification</code>, use the <code>PendingIntent</code> class:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177221845848">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Intent</code> <code class="n">intent</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Intent</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="n">DownloadsActivity</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>&#13;
<code class="n">PendingIntent</code> <code class="n">pendingIntent</code> <code class="o">=</code> <code class="n">PendingIntent</code><code class="o">.</code><code class="na">getActivity</code><code class="o">(</code><code class="n">context</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">intent</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">val</code> <code class="py">intent</code> <code class="p">=</code> <code class="n">Intent</code><code class="p">(</code><code class="k">this</code><code class="p">,</code> <code class="n">DownloadsActivity</code><code class="o">::</code><code class="k">class</code><code class="p">)</code>&#13;
<code class="k">val</code> <code class="py">pendingIntent</code> <code class="p">=</code> <code class="n">PendingIntent</code><code class="p">.</code><code class="n">getActivity</code><code class="p">(</code><code class="n">context</code><code class="p">,</code> <code class="m">0</code><code class="p">,</code> <code class="n">intent</code><code class="p">,</code> <code class="m">0</code><code class="p">)</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>Add it to the builder before calling <code>build</code>:</p>&#13;
<aside class="java-kotlin" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46177221803160">&#13;
<h5/>&#13;
<p><em>Java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">builder</code><code class="o">.</code><code class="na">setContentIntent</code><code class="o">(</code><code class="n">pendingIntent</code><code class="o">);</code></pre>&#13;
&#13;
<p><em>Kotlin</em></p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">builder</code><code class="p">.</code><code class="n">contentIntent</code> <code class="p">=</code> <code class="n">pendingIntent</code></pre>&#13;
</div></aside>&#13;
&#13;
<p>For a deeper dive, see <a href="https://oreil.ly/rcuYz">the developer docs</a>.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>These built-in<a data-primary="feedback mechanisms" data-seealso="user feedback" data-type="indexterm" id="idm46177221694328"/> user feedback mechanisms can normalize the experience for your users. For example, using the built-in dialog system with accept and cancel buttons might seem more familiar to your users, so they may be more likely to sign up for your newsletter (or give your app a good rating) if these features are offered via traditional, framework-provided UIs. That said, if your requirements are more demanding than what’s allowed for by these APIs, you’re free to create (or modify) custom UI components that better suit your needs.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="iOS" data-type="sect1"><div class="sect1" id="idm46177222087928">&#13;
<h1>iOS</h1>&#13;
&#13;
<p>If you’ve read the Android section of this chapter, you’ll quickly discover that this is an area where iOS and Android differ strongly. One of the places where the differences between Android and iOS are in sharpest contrast is in the available methods for displaying user feedback. Let’s take a look at what’s available and where the variations show themselves most prominently.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use Framework-Provided Tools to Show the User Feedback" data-type="sect2"><div class="sect2" id="idm46177221727032">&#13;
<h2>Use Framework-Provided Tools to Show the User Feedback</h2>&#13;
&#13;
<p>There<a data-primary="user feedback" data-secondary="iOS" data-tertiary="framework-provided tools for" data-type="indexterm" id="idm46177221739096"/><a data-primary="iOS" data-secondary="user feedback" data-tertiary="framework-provided tools for" data-type="indexterm" id="idm46177221737848"/><a data-primary="UIKit" data-secondary="UIAlertController class" data-type="indexterm" id="idm46177221736664"/><a data-primary=".alerts" data-primary-sortas="alerts" data-type="indexterm" id="idm46177221735720"/><a data-primary=".actionSheet" data-primary-sortas="actionSheet" data-type="indexterm" id="idm46177221734776"/> are two ways through which feedback is shown to the user on iOS: alert views and action sheets. Both of them are created by the same class, <code>UIAlertController</code>, the only difference being an <code>.alert</code> passed in the initializer for alert view and <code>.actionSheet</code> being used for action sheets.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>It is not possible to display the <code>Snackbar</code>-style notifications possible in Android out of the box in iOS. One could, however, use a third-party library to achieve a similar effect. This is outside the scope of this book, however.</p>&#13;
</div>&#13;
&#13;
<p>There is no absolutely clear guidance from Apple on when to use an action sheet and when to use an alert, but the standard that has emerged for most apps is to present an alert view whenever there is something requiring immediate feedback that might be unexpected; use an action sheet in response to a user action where a choice is required and when there is context to an action being performed.</p>&#13;
&#13;
<p>Here’s an example alert view being displayed:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">let</code> <code class="nv">viewController</code> <code class="p">=</code> <code class="bp">UIViewController</code><code class="p">(</code><code class="n">nibName</code><code class="p">:</code> <code class="p">...,</code> <code class="n">bundle</code><code class="p">:</code> <code class="p">...)</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">alert</code> <code class="p">=</code> <code class="bp">UIAlertController</code><code class="p">(</code>&#13;
    <code class="n">title</code><code class="p">:</code> <code class="s">"Title"</code><code class="p">,</code> <code class="n">message</code><code class="p">:</code> <code class="s">"This is the message"</code><code class="p">,</code> <code class="n">preferredStyle</code><code class="p">:</code> <code class="p">.</code><code class="n">alert</code><code class="p">)</code>&#13;
<code class="n">alert</code><code class="p">.</code><code class="n">addAction</code><code class="p">(</code>&#13;
  <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"OK"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="k">default</code><code class="p">,</code> <code class="n">handler</code><code class="p">:</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="s">"OK button pressed!"</code><code class="p">)</code>&#13;
<code class="p">}))</code>&#13;
&#13;
<code class="n">viewController</code><code class="p">.</code><code class="n">present</code><code class="p">(</code><code class="n">alert</code><code class="p">,</code> <code class="n">animated</code><code class="p">:</code> <code class="kc">true</code><code class="p">,</code> <code class="n">completion</code><code class="p">:</code> <code class="kc">nil</code><code class="p">)</code></pre>&#13;
&#13;
<p>Let’s walk through the code.</p>&#13;
&#13;
<p>First, we<a data-primary="UIKit" data-secondary="UIViewController" data-type="indexterm" id="idm46177225731752"/><a data-primary="UIKit" data-secondary="UIAlertController" data-type="indexterm" id="idm46177221578664"/> create a view controller that will be used to present our alert later. Since iOS 8, alert views are actually <code>UIViewController</code> instances that can be presented by another view controller just like any other view controller. Next, we instantiate an alert via the initializer of <code>UIAlertController</code>. This class has a title, a message, and a <code>preferredStyle</code> parameter. We’re passing <code>.alert</code> indicating the alert we’re creating is an alert view; use <code>.actionSheet</code> to create an action sheet.</p>&#13;
&#13;
<p>The next line contains a method called <code>addAction(_:)</code> that is used to add an action, or button, to an alert view. We’re directly instantiating an instance of <code>UIAlertAction</code> to pass into this method with a title, style (<code>.default</code> in this case), and button handler. Inside the button handler, we display “OK button pressed!” out to the console whenever the button is pressed.</p>&#13;
&#13;
<p>Finally, we use the view controller created at the top of our code to display our alert view on top of the rest of the view stack.</p>&#13;
&#13;
<p>The meat of this process is the <code>addAction(_:)</code> method called on the alert itself. This is where we add all the buttons our alert, or potentially action sheet, has available.</p>&#13;
&#13;
<p>Now, it’s possible to create an alert with more than one button. Here’s an example with three buttons:</p>&#13;
&#13;
<pre class="small" data-code-language="swift" data-type="programlisting"><code class="kd">let</code> <code class="nv">viewController</code> <code class="p">=</code> <code class="bp">UIViewController</code><code class="p">(</code><code class="n">nibName</code><code class="p">:</code> <code class="kc">nil</code><code class="p">,</code> <code class="n">bundle</code><code class="p">:</code> <code class="kc">nil</code><code class="p">)</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">alert</code> <code class="p">=</code> <code class="bp">UIAlertController</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"Terms &amp; Conditions"</code><code class="p">,</code>&#13;
    <code class="n">message</code><code class="p">:</code> <code class="s">"Hit Agree to agree to terms and conditions."</code><code class="p">,</code> <code class="n">preferredStyle</code><code class="p">:</code> <code class="p">.</code><code class="n">alert</code><code class="p">)</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">agreeAction</code> <code class="p">=</code> <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"Agree"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="k">default</code><code class="p">)</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="s">"Terms and conditions accepted."</code><code class="p">)</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">viewAction</code> <code class="p">=</code>&#13;
  <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"View Terms &amp; Conditions"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="k">default</code><code class="p">)</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="s">"Blah blah blah."</code><code class="p">)</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">let</code> <code class="nv">cancelAction</code> <code class="p">=</code> <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"Cancel"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="n">cancel</code><code class="p">)</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="s">"I disagree with terms and conditions."</code><code class="p">)</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// Add all the actions</code>&#13;
<code class="n">alert</code><code class="p">.</code><code class="n">addAction</code><code class="p">(</code><code class="n">agreeAction</code><code class="p">)</code>&#13;
<code class="n">alert</code><code class="p">.</code><code class="n">addAction</code><code class="p">(</code><code class="n">viewAction</code><code class="p">)</code>&#13;
<code class="n">alert</code><code class="p">.</code><code class="n">addAction</code><code class="p">(</code><code class="n">cancelAction</code><code class="p">)</code>&#13;
&#13;
<code class="n">viewController</code><code class="p">.</code><code class="n">present</code><code class="p">(</code><code class="n">alert</code><code class="p">,</code> <code class="n">animated</code><code class="p">:</code> <code class="kc">true</code><code class="p">,</code> <code class="n">completion</code><code class="p">:</code> <code class="kc">nil</code><code class="p">)</code></pre>&#13;
&#13;
<p>Here we use almost identical logic to create and display our alert view. One key difference to make it easier to read is that we are creating our actions separately and then adding them directly to the alert instead of instantiating them directly in the call to <code>addAction(_:)</code>.</p>&#13;
&#13;
<p>Another slight difference is our use of the <code>.cancel</code> style to create the <code>cancelAction</code>. There are a limited set of action styles available. The <code>.default</code> style displays a basic button that’s bolded in a two-button configuration. The <code>.cancel</code> style displays a button in the position of a cancel button with a specified label. The remaining style, <code>.destructive</code>, displays a button usually with a red text color to indicate it’s an action with destructive potential.</p>&#13;
&#13;
<p>Here’s an action created with a <code>.destructive</code> style:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">let</code> <code class="nv">deleteAction</code> <code class="p">=</code>&#13;
  <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"Yes, Delete"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="n">destructive</code><code class="p">)</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="s">"All your photos were deleted. What were you thinking?"</code><code class="p">)</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>If there is any guidance to be given about alert view and action sheets, it’s that alert views should be displayed only when necessary. They’re a disruption in a user’s flow within an application and can quickly become tiresome and ignored if overused. With great power comes great responsibility. Tap “Yes” if you agree.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Update the Status Bar" data-type="sect2"><div class="sect2" id="idm46177221740392">&#13;
<h2>Update the Status Bar</h2>&#13;
&#13;
<p>The <code>Notifications</code> API<a data-primary="user feedback" data-secondary="iOS" data-tertiary="status bars, updating" data-type="indexterm" id="idm46177221366056"/><a data-primary="iOS" data-secondary="user feedback" data-tertiary="status bars, updating" data-type="indexterm" id="idm46177221364776"/><a data-primary="status bars, updating" data-secondary="iOS" data-type="indexterm" id="idm46177221363560"/> on Android allows developers to customize items in the status bar and to provide feedback to the user in this way. On iOS, the only way a developer can use the status for feedback is via the network status bar activity indicator.</p>&#13;
&#13;
<p>Although minimal in appearance, this indicator is arguably very helpful to users. It can help a user diagnose why an application might be slow and indicate that data is still loading. Small details like this can be the difference between a application that feels unfinished and an application that feels complete and polished.</p>&#13;
&#13;
<p>Here’s how you do it:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="c1">// Display the indicator</code>&#13;
<code class="bp">UIApplication</code><code class="p">.</code><code class="n">shared</code><code class="p">.</code><code class="n">isNetworkActivityIndicatorVisible</code> <code class="p">=</code> <code class="kc">true</code>&#13;
&#13;
<code class="c1">// Hide the indicator</code>&#13;
<code class="bp">UIApplication</code><code class="p">.</code><code class="n">shared</code><code class="p">.</code><code class="n">isNetworkActivityIndicatorVisible</code> <code class="p">=</code> <code class="kc">false</code></pre>&#13;
&#13;
<p>It’s remarkably easy to update the display and hide the indicator. Most third-party networking libraries have a way to do it themselves, but almost all of them end up just wrapping code like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">class</code> <code class="nc">NetworkClient</code> <code class="p">{</code>&#13;
    <code class="kd">func</code> <code class="nf">startDownload</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="p">...</code>&#13;
&#13;
        <code class="bp">UIApplication</code><code class="p">.</code><code class="n">shared</code><code class="p">.</code><code class="n">isNetworkActivityIndicatorVisible</code> <code class="p">=</code> <code class="kc">true</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="kd">func</code> <code class="nf">downloadCompleted</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="p">...</code>&#13;
&#13;
        <code class="bp">UIApplication</code><code class="p">.</code><code class="n">shared</code><code class="p">.</code><code class="n">isNetworkActivityIndicatorVisible</code> <code class="p">=</code> <code class="kc">false</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>It might not be as full-featured as Android, but it’s still incredibly helpful for the user.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Text fields in alert views" data-type="sect3"><div class="sect3" id="idm46177221312520">&#13;
<h3>Text fields in alert views</h3>&#13;
&#13;
<p>It’s<a data-primary="user input" data-secondary="iOS" data-tertiary="text fields in alert views" data-type="indexterm" id="idm46177221300824"/><a data-primary="iOS" data-secondary="user input" data-tertiary="text fields in alert views" data-type="indexterm" id="idm46177221299560"/> possible to use alert views not only for feedback but to get input from a user. There’s a convenience method provided to add a text field and style it like so:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="n">alert</code><code class="p">.</code><code class="n">addTextField</code> <code class="p">{</code> <code class="p">(</code><code class="n">textField</code><code class="p">)</code> <code class="k">in</code>&#13;
	<code class="n">textField</code><code class="p">.</code><code class="n">placeholder</code> <code class="p">=</code> <code class="s">"Enter your comment"</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>You can access the value of this text field in a <code>UIAlertAction</code> later:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">let</code> <code class="nv">action</code> <code class="p">=</code> <code class="bp">UIAlertAction</code><code class="p">(</code><code class="n">title</code><code class="p">:</code> <code class="s">"Save"</code><code class="p">,</code> <code class="n">style</code><code class="p">:</code> <code class="p">.</code><code class="k">default</code><code class="p">)</code> <code class="p">{</code> <code class="p">(</code><code class="n">action</code><code class="p">)</code> <code class="k">in</code>&#13;
    <code class="k">guard</code> <code class="kd">let</code> <code class="nv">textField</code> <code class="p">=</code> <code class="n">alert</code><code class="p">.</code><code class="n">textFields</code><code class="p">?[</code><code class="mi">0</code><code class="p">]</code> <code class="k">else</code> <code class="p">{</code> <code class="k">return</code> <code class="p">}</code>&#13;
    <code class="bp">print</code><code class="p">(</code><code class="n">textField</code><code class="p">.</code><code class="n">text</code> <code class="p">??</code> <code class="s">""</code><code class="p">)</code>&#13;
<code class="p">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Haptic feedback" data-type="sect3"><div class="sect3" id="idm46177221103400">&#13;
<h3>Haptic feedback</h3>&#13;
&#13;
<p>It’s<a data-primary="user feedback" data-secondary="iOS" data-tertiary="haptic feedback" data-type="indexterm" id="idm46177221074200"/><a data-primary="iOS" data-secondary="user feedback" data-tertiary="haptic feedback" data-type="indexterm" id="idm46177221073032"/><a data-primary="haptic feedback (iOS)" data-type="indexterm" id="idm46177221071816"/> possible to provide feedback to users on phones in nonvisual ways via haptic feedback. There are three classes that are used for different types of feedback:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>UINotificationFeedbackGenerator</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>UIImpactFeedbackGenerator</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>UISelectionFeedbackGenerator</code></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>As a quick example, in order to generate haptic feedback to a user about a failed download, you could use the following code snippet:</p>&#13;
&#13;
<pre data-code-language="swift" data-type="programlisting"><code class="kd">let</code> <code class="nv">hapticFeedbackGenerator</code> <code class="p">=</code> <code class="n">UINotificationFeedbackGenerator</code><code class="p">()</code>&#13;
<code class="n">hapticFeedbackGenerator</code><code class="p">.</code><code class="n">notificationOccurred</code><code class="p">(.</code><code class="n">error</code><code class="p">)</code></pre>&#13;
&#13;
<p>This would generate a tap that has been designed by Apple to feel negative and urgent. Use with discretion and remember that not all classes of devices, for example iPads, currently offer haptic feedback at the time of publication.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="What We’ve Learned" data-type="sect1"><div class="sect1" id="idm46177221049800">&#13;
<h1>What We’ve Learned</h1>&#13;
&#13;
<p>This seems to be one of the areas of developing apps on Android and iOS that presents the largest amount of differences between the two technology stacks:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Android has a number of ways to give user feedback, such as <code>Toast</code>, <code>Snackbar</code>, and <code>Dialog</code>. It’s also possible to update the Android status bar with alerts for the user.</p>&#13;
</li>&#13;
<li>&#13;
<p>There are more limited controls in terms of what’s available to give users feedback in iOS. That said, the options available are easy to use and follow standard UI conventions in the rest of UIKit.</p>&#13;
</li>&#13;
<li>&#13;
<p>Updating the status bar isn’t really possible in iOS. This highlights one of the core differences in Android and iOS: the amount of control a developer has over the device. There is a much tighter rein on iOS that Apple exercises. Developers are only able to indicate network activity.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>We’ve learned a lot about letting our apps talk back to our users this chapter. In the next chapter, we’ll cover providing them a way to store information that’s a little less cumbersome than an entire database persistence layer.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>