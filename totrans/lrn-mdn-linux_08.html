<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Observability"><div class="chapter" id="observability">
<h1><span class="label">Chapter 8. </span>Observability</h1>


<p><a data-type="indexterm" data-primary="observability" id="ix_ch08-asciidoc0"/>You need visibility into what’s going on across the stack—from the kernel to
user-facing parts. Often, you get that visibility by knowing the right tool
for the task.</p>

<p>This chapter is all about gathering and using different signals that Linux and
its applications generate so that you can make informed decisions. For example,
you’ll see how you can do the following:</p>

<ul>
<li>
<p>Figure out how much memory a process consumes</p>
</li>
<li>
<p>Understand how soon you will run out of disk space</p>
</li>
<li>
<p>Get an alert on custom events for security reasons</p>
</li>
</ul>

<p>To establish a common vocabulary, we’ll first review different signal types you
might come across, such as system or application logs, metrics, and process traces.
We’ll also have a look at how to go about troubleshooting and measuring performance.
Next, we’ll focus on logs specifically, reviewing different options and semantics. Then, we’ll cover monitoring for different resource types, such as
CPU cycles, memory, or I/O traffic. We’ll review different tools that you can use
and show certain end-to-end setup you may wish to adopt.</p>

<p>You’ll learn that observability is often reactionary. That is, something crashes
or runs slowly, and you start looking at processes and their CPU or memory usage, or
dig into the logs. But there are also times when observability has more of an investigative
nature—for example, when you want to figure out how long certain algorithms
take. Last but not least, you can use predictive (rather than reactive) observability.
For example, you can be alerted on a condition in the future, extrapolating the current
behavior (disk usage for a predictable load is a good example where that might
work well).</p>

<p>Likely the best visual overview on observability comes from performance maestro
Brendan Gregg. <a data-type="xref" href="#fig-linux-o11y">Figure 8-1</a>, taken from his
<a href="https://oreil.ly/KlzQP">Linux Performance site</a>, gives you a feeling for the wealth of
moving parts and tooling available.</p>

<figure><div id="fig-linux-o11y" class="figure">
<img src="Images/lmlx_0801.png" alt="lmlx 0801" width="600" height="438"/>
<h6><span class="label">Figure 8-1. </span>Linux observability overview. <em>Credit</em>: Brendan Gregg (shared under CC BY-SA 4.0 license)</h6>
</div></figure>

<p>Observability is an exciting topic with many use cases and
lots of (open source) tooling available, so let’s first establish a strategy
and look at some common terms used.</p>






<section data-type="sect1" data-pdf-bookmark="Basics"><div class="sect1" id="idm45805428810512">
<h1>Basics</h1>

<p><a data-type="indexterm" data-primary="observability" data-secondary="basics" id="ix_ch08-asciidoc1"/>Before we get into the observability terminology, let’s step back a bit and
look at how you turn the information provided into actionable insights and
use it to fix an issue or optimize an app in a structured manner.</p>








<section data-type="sect2" data-pdf-bookmark="Observability Strategy"><div class="sect2" id="o11y-strategy">
<h2>Observability Strategy</h2>

<p><a data-type="indexterm" data-primary="observability" data-secondary="OODA loop" id="idm45805428805952"/><a data-type="indexterm" data-primary="OODA (observe-orient-decide-act) loop" id="idm45805428804976"/>One widely established strategy in the observability context is the
<a href="https://oreil.ly/zLLET">OODA loop (observe–orient–decide–act)</a>.
It offers a structured way to test a hypothesis based on observed data and act upon it—that is, a way to get actionable insights from signals.</p>

<p>For example, let’s say an application is slow. Let’s further assume there are
multiple possible reasons for this (not enough memory,
too few CPU cycles, network I/O insufficient, etc.). First, you want to be able
to measure each resource consumption. Then you would change each resource
allocation individually (keeping the others unchanged) and measure the
outcome.</p>

<p>Does the performance improve after you provided more RAM to the app?
If so, you may have found the reason. If not, you continue with a different
resource, always measuring the consumption and trying to relate to the observed
impact on the 
<span class="keep-together">situation.</span></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Terminology"><div class="sect2" id="o11y-terminology">
<h2>Terminology</h2>

<p><a data-type="indexterm" data-primary="observability" data-secondary="terminology" id="idm45805428800128"/><a data-type="indexterm" data-primary="signals" data-secondary="defined" id="idm45805428799152"/>There are a range of terms in the observability
space,<sup><a data-type="noteref" id="idm45805428798080-marker" href="ch08.xhtml#idm45805428798080">1</a></sup> and not all have formal definitions. In addition, the
meanings might slightly differ if you’re looking at a single machine or
are in a networked (distributed) setup:</p>
<dl>
<dt>Observability</dt>
<dd>
<p><a data-type="indexterm" data-primary="observability" data-secondary="defined" id="idm45805428794096"/>Assessing the internal state of a system (such as Linux) by measuring external
information, usually with the goal of acting upon it. For example, if you notice
that your system reacts sluggishly, and measure how much main memory is available,
you might find that a particular app hogs all the memory, and you may decide to
terminate it to remedy the situation.</p>
</dd>
<dt>Signal types</dt>
<dd>
<p>Different ways to represent and emit information about the state of a system,
either via symbolic means (payload is text, such as the case with logs) or
numerical values (as with metrics) or combinations thereof. See also <a data-type="xref" href="#o11y-signals">“Signal Types”</a>.</p>
</dd>
<dt>Source</dt>
<dd>
<p>Generates signals, potentially of different types. Sources can be the Linux
operating system or an application.</p>
</dd>
<dt>Destination</dt>
<dd>
<p>Where you consume, store, and further process signals. We call a destination
that exposes a user interface (GUI, TUI, or CLI) a <em>frontend</em>. For example, a log viewer
or a dashboard plotting time series is a frontend, whereas an S3 bucket is not
(but can still act as a destination for, say, logs).</p>
</dd>
<dt>Telemetry</dt>
<dd>
<p>The process of extracting signals from sources and transporting (or routing,
shipping) the signals to destinations, often employing agents that collect
and/or preprocess signals (for example, filter or downsample).</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Signal Types"><div class="sect2" id="o11y-signals">
<h2>Signal Types</h2>

<p><a data-type="indexterm" data-primary="observability" data-secondary="signal types" id="idm45805428681616"/><em>Signals</em> are how we communicate the state of a system for further processing
or interpretation. By and large we distinguish between text payload (which is
most suited for a human to search and interpret) and numerical payload (good
for both machines and, in processed form, for humans). The three basic and
common signal types relevant to our discussion in this chapter are: logs,
metrics, and traces.</p>










<section data-type="sect3" data-pdf-bookmark="Logs"><div class="sect3" id="idm45805428680128">
<h3>Logs</h3>

<p><a data-type="indexterm" data-primary="logs, defined" id="idm45805428678928"/><em>Logs</em> are a fundamental signal type that every system, to some extent, generates.
Logs are discrete events with a textual payload, meant for human consumption.
Typically, these events are timestamped. Ideally, the logs are structured so that
there is a clear meaning defined for each part of the log message. This meaning is
potentially expressed through a formal schema so that validation can be
automatically 
<span class="keep-together">performed.</span></p>

<p><a data-type="indexterm" data-primary="structured logging" id="idm45805428676992"/>Interestingly, while every log has some structure (even if it’s not well defined
and parsing is hard, potentially due to delimiter or edge cases), you will often
hear the term <em>structured logging</em>. When people say that, they actually mean
that the log is structured using JSON.</p>

<p>While automating log content is hard (given its textual nature), logs are still
very useful for humans, and thus they will likely stay the dominating signal
type for some time. We’ll dig deeper into handling logs in <a data-type="xref" href="#logging">“Logging”</a>.
Logs are the most important signal type (for our considerations), and that’s
why we’ll spend most of the time in this chapter dealing with them.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Metrics"><div class="sect3" id="idm45805428673872">
<h3>Metrics</h3>

<p><a data-type="indexterm" data-primary="metrics, defined" id="idm45805428672464"/><em>Metrics</em> are (usually regularly) sampled numerical data points, forming a time
series. The individual data points can have additional context in the form
of dimensions or identifying metadata. Normally, you don’t directly consume
the raw metrics; instead, you use some sort of aggregation or graphical representation,
or you get notified if a certain condition is met. Metrics can be useful both for
operational tasks and for troubleshooting to answer questions like
how many transactions an app completed or how long a certain operation took
(in the past X minutes).</p>

<p>We distinguish between different types of metrics:</p>
<dl>
<dt>Counter</dt>
<dd>
<p><a data-type="indexterm" data-primary="counters" id="idm45805428669360"/>The value of a counter can only ever go up (besides resetting a
  counter to zero). An example of a counter metric is the total number of
  requests handled by a service or the bytes sent via an interface over a time period.</p>
</dd>
<dt>Gauges</dt>
<dd>
<p><a data-type="indexterm" data-primary="gauges" id="idm45805428667136"/>A gauge value can go up or down. For example, you gauge the currently
  available overall main memory or the number of processes running.</p>
</dd>
<dt>Histograms</dt>
<dd>
<p><a data-type="indexterm" data-primary="histograms" id="idm45805428664992"/>A sophisticated way to build a distribution of values. Using
  buckets, histograms allow you to assess how the data overall is structured.
  They also enable you to make flexible statements (such as 50% or 90% of the
  values fall into a certain range).</p>
</dd>
</dl>

<p>In <a data-type="xref" href="#monitoring">“Monitoring”</a>, we have a look at a range of tools that you can use for
simple use cases, and in <a data-type="xref" href="#prometheus-grafana">“Prometheus and Grafana”</a>, you see an advanced example
setup for metrics.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Traces"><div class="sect3" id="idm45805428661584">
<h3>Traces</h3>

<p><a data-type="indexterm" data-primary="traces, defined" id="idm45805428660528"/><em>Traces</em> are a dynamic collection of runtime information (for example,
information about what syscalls a process uses, or the sequence of events
in the kernel, for a given cause). Traces are often used not only for debugging
but also for performance assessments. We have a look at this advanced topic in <a data-type="xref" href="#tracing">“Tracing and Profiling”</a>.<a data-type="indexterm" data-startref="ix_ch08-asciidoc1" id="idm45805428658288"/></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Logging"><div class="sect1" id="logging">
<h1>Logging</h1>

<p><a data-type="indexterm" data-primary="logging" id="ix_ch08-asciidoc2"/><a data-type="indexterm" data-primary="observability" data-secondary="logging" id="ix_ch08-asciidoc3"/>As mentioned before, logs are (a collection of) discrete events with a
textual payload, optimized for human consumption. Let’s decompose this
statement to understand it better:</p>
<dl>
<dt>Discrete events</dt>
<dd>
<p>Think of a discrete event in the context of the codebase. You want to share
information about what is going on in the code using an (atomic) log item. For
example, you emit a log line that a database connection has been established
successfully. Another log item might be to flag an error because a file is missing.
Keep the scope of the log message small and specific, so it’s easier for someone consuming the
message to find the respective location in the code.</p>
</dd>
<dt>Textual payload</dt>
<dd>
<p>The payload of a log message is of textual nature. The default consumers are humans.
In other words, no matter if you’re using a log viewer on the command line, or a fancy
log-processing system with visual UI, a human reads and interprets the content
of the log message and decides on an action based on it.</p>
</dd>
</dl>

<p>From a structural perspective, overall, a log comprises the following:</p>
<dl>
<dt>A collection of log items, messages, or lines</dt>
<dd>
<p>Captures information
  about a discrete event.</p>
</dd>
<dt>Metadata or context</dt>
<dd>
<p>Can be present on a per-message basis as well as on a global
  scope (the entire log file, for example).</p>
</dd>
<dt>A format for how an individual log message is to be interpreted</dt>
<dd>
<p>Defines the log’s
  parts and meanings. Examples are line-oriented, space-separated messages or a
  JSON schema.</p>
</dd>
</dl>

<p>In <a data-type="xref" href="#tab-log-formats">Table 8-1</a>, you can see some common log formats. There are
many (more-specific, narrower-scoped) formats and frameworks—for example,
for database or programming languages.</p>
<table id="tab-log-formats">
<caption><span class="label">Table 8-1. </span>Common log formats</caption>
<thead>
<tr>
<th>Format</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><a href="https://oreil.ly/rHBWs">Common event format</a></p></td>
<td><p>Developed by ArcSight; used for devices, security use cases</p></td>
</tr>
<tr>
<td><p><a href="https://oreil.ly/Da7uC">Common log format</a></p></td>
<td><p>For web servers; see also extended log format</p></td>
</tr>
<tr>
<td><p><a href="https://oreil.ly/6MBHm">Graylog extended log format</a></p></td>
<td><p>Developed by Graylog; improves Syslog</p></td>
</tr>
<tr>
<td><p>Syslog</p></td>
<td><p>For operating systems, apps, devices; see <a data-type="xref" href="#syslog">“Syslog”</a></p></td>
</tr>
<tr>
<td><p><a href="https://oreil.ly/LeXhe">Embedded metric format</a></p></td>
<td><p>Developed by Amazon (both logs and metrics)</p></td>
</tr>
</tbody>
</table>

<p>As a good practice, you want to avoid overhead with logs (enabling fast lookups
and a small footprint—that is, not taking up too much disk space). In this context,
log rotation, for example, via <a href="https://oreil.ly/jX6Jy"><code>logrotate</code></a>, is used.
<a data-type="indexterm" data-primary="data temperature" id="idm45805428608240"/>An advanced concept called <em>data temperature</em> may also be useful, moving older
log files to cheaper and slower storage (attached disk, S3 bucket, Glacier).</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-type="indexterm" data-primary="security" data-secondary="sensitive information in logs" id="idm45805428606016"/>There’s one case where you need to be careful about logging information,
especially in production environments. Whenever you decide to emit a log
line in your app, ask yourself if you could potentially leak sensitive information.
This sensitive information could be a password, an API key, or even
simply user-identifying information (email, account ID).</p>

<p>The problem is that the logs are usually stored in a persistent form (say, on
local disk or even in an S3 bucket). This means that even long after the process has
terminated, someone could get access to the sensitive information and use it
for an attack.</p>
</div>

<p>To signal the importance or intended target consumer of a log item, logs
often define levels (for example <code>DEBUG</code> for development, <code>INFO</code> for normal
status, or <code>ERROR</code> for unexpected situations that may require human
intervention).</p>

<p>Now it’s time to get our hands dirty: let’s start with
something simple and, as an overview, have a look at Linux’s central log
directory (output shortened for readability):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ls</code><code> </code><code>-al</code><code> </code><code>/var/log</code><code>
</code><code>drwxrwxr-x</code><code>   </code><code class="m">8</code><code> </code><code>root</code><code>      </code><code>syslog</code><code>               </code><code class="m">4096</code><code> </code><code>Jul</code><code> </code><code class="m">13</code><code> </code><code class="m">06</code><code>:16</code><code> </code><code>.</code><code>
</code><code>drwxr-xr-x</code><code>  </code><code class="m">13</code><code> </code><code>root</code><code>      </code><code>root</code><code>                 </code><code class="m">4096</code><code> </code><code>Jun</code><code>  </code><code class="m">3</code><code> </code><code class="m">07</code><code>:52</code><code> </code><code>..</code><code>
</code><code>drwxr-xr-x</code><code>   </code><code class="m">2</code><code> </code><code>root</code><code>      </code><code>root</code><code>                 </code><code class="m">4096</code><code> </code><code>Jul</code><code> </code><code class="m">12</code><code> </code><code class="m">11</code><code>:38</code><code> </code><code>apt/</code><code> </code><a class="co" id="co_observability_CO1-1" href="#callout_observability_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>-rw-r-----</code><code>   </code><code class="m">1</code><code> </code><code>syslog</code><code>    </code><code>adm</code><code>                  </code><code class="m">7319</code><code> </code><code>Jul</code><code> </code><code class="m">13</code><code> </code><code class="m">07</code><code>:17</code><code> </code><code>auth.log</code><code> </code><a class="co" id="co_observability_CO1-2" href="#callout_observability_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>-rw-rw----</code><code>   </code><code class="m">1</code><code> </code><code>root</code><code>      </code><code>utmp</code><code>                 </code><code class="m">1536</code><code> </code><code>Sep</code><code> </code><code class="m">21</code><code> </code><code class="m">14</code><code>:07</code><code> </code><code>btmp</code><code> </code><a class="co" id="co_observability_CO1-3" href="#callout_observability_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>drwxr-xr-x</code><code>   </code><code class="m">2</code><code> </code><code>root</code><code>      </code><code>root</code><code>                 </code><code class="m">4096</code><code> </code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">08</code><code>:35</code><code> </code><code>cups/</code><code> </code><a class="co" id="co_observability_CO1-4" href="#callout_observability_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>-rw-r--r--</code><code>   </code><code class="m">1</code><code> </code><code>root</code><code>      </code><code>root</code><code>                </code><code class="m">28896</code><code> </code><code>Sep</code><code> </code><code class="m">21</code><code> </code><code class="m">16</code><code>:59</code><code> </code><code>dpkg.log</code><code> </code><a class="co" id="co_observability_CO1-5" href="#callout_observability_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>-rw-r-----</code><code>   </code><code class="m">1</code><code> </code><code>root</code><code>      </code><code>adm</code><code>                 </code><code class="m">51166</code><code> </code><code>Jul</code><code> </code><code class="m">13</code><code> </code><code class="m">06</code><code>:16</code><code> </code><code>dmesg</code><code> </code><a class="co" id="co_observability_CO1-6" href="#callout_observability_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>drwxrwxr-x</code><code>   </code><code class="m">2</code><code> </code><code>root</code><code>      </code><code>root</code><code>                 </code><code class="m">4096</code><code> </code><code>Jan</code><code> </code><code class="m">24</code><code>  </code><code class="m">2021</code><code> </code><code>installer/</code><code> </code><a class="co" id="co_observability_CO1-7" href="#callout_observability_CO1-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>drwxr-sr-x+</code><code>  </code><code class="m">3</code><code> </code><code>root</code><code>      </code><code>systemd-journal</code><code>      </code><code class="m">4096</code><code> </code><code>Jan</code><code> </code><code class="m">24</code><code>  </code><code class="m">2021</code><code> </code><code>journal/</code><code> </code><a class="co" id="co_observability_CO1-8" href="#callout_observability_CO1-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
</code><code>-rw-r-----</code><code>   </code><code class="m">1</code><code> </code><code>syslog</code><code>    </code><code>adm</code><code>                  </code><code class="m">4437</code><code> </code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">13</code><code>:30</code><code> </code><code>kern.log</code><code> </code><a class="co" id="co_observability_CO1-9" href="#callout_observability_CO1-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a><code>
</code><code>-rw-rw-r--</code><code>   </code><code class="m">1</code><code> </code><code>root</code><code>      </code><code>utmp</code><code>               </code><code class="m">292584</code><code> </code><code>Sep</code><code> </code><code class="m">21</code><code> </code><code class="m">15</code><code>:01</code><code> </code><code>lastlog</code><code> </code><a class="co" id="co_observability_CO1-10" href="#callout_observability_CO1-10"><img src="Images/10.png" alt="10" width="12" height="12"/></a><code>
</code><code>drwxr-xr-x</code><code>   </code><code class="m">2</code><code> </code><code>ntp</code><code>       </code><code>ntp</code><code>                  </code><code class="m">4096</code><code> </code><code>Aug</code><code> </code><code class="m">18</code><code>  </code><code class="m">2020</code><code> </code><code>ntpstats/</code><code> </code><a class="co" id="co_observability_CO1-11" href="#callout_observability_CO1-11"><img src="Images/11.png" alt="11" width="12" height="12"/></a><code>
</code><code>-rw-r-----</code><code>   </code><code class="m">1</code><code> </code><code>syslog</code><code>    </code><code>adm</code><code>                </code><code class="m">549081</code><code> </code><code>Jul</code><code> </code><code class="m">13</code><code> </code><code class="m">07</code><code>:57</code><code> </code><code>syslog</code><code> </code><a class="co" id="co_observability_CO1-12" href="#callout_observability_CO1-12"><img src="Images/12.png" alt="12" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO1-1" href="#co_observability_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Logs of the <code>apt</code> package manager</p></dd>
<dt><a class="co" id="callout_observability_CO1-2" href="#co_observability_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Logs of all login attempts (successful and failed) and authentication processes</p></dd>
<dt><a class="co" id="callout_observability_CO1-3" href="#co_observability_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Failed login attempts</p></dd>
<dt><a class="co" id="callout_observability_CO1-4" href="#co_observability_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Printing related logs</p></dd>
<dt><a class="co" id="callout_observability_CO1-5" href="#co_observability_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Logs of the <code>dpkg</code> package manager</p></dd>
<dt><a class="co" id="callout_observability_CO1-6" href="#co_observability_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Device driver logs; use <code>dmesg</code> to inspect</p></dd>
<dt><a class="co" id="callout_observability_CO1-7" href="#co_observability_CO1-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>System install logs (when the Linux distro was originally installed)</p></dd>
<dt><a class="co" id="callout_observability_CO1-8" href="#co_observability_CO1-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>The <code>journalctl</code> location; see <a data-type="xref" href="#journalctl">“journalctl”</a> for details</p></dd>
<dt><a class="co" id="callout_observability_CO1-9" href="#co_observability_CO1-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>The kernel logs</p></dd>
<dt><a class="co" id="callout_observability_CO1-10" href="#co_observability_CO1-10"><img src="Images/10.png" alt="10" width="12" height="12"/></a></dt>
<dd><p>All last logins of all users; use <code>lastlog</code> to inspect</p></dd>
<dt><a class="co" id="callout_observability_CO1-11" href="#co_observability_CO1-11"><img src="Images/11.png" alt="11" width="12" height="12"/></a></dt>
<dd><p>NTP-related logs (see also <a data-type="xref" href="ch07.xhtml#ntp">“Network Time Protocol”</a>)</p></dd>
<dt><a class="co" id="callout_observability_CO1-12" href="#co_observability_CO1-12"><img src="Images/12.png" alt="12" width="12" height="12"/></a></dt>
<dd><p>The <code>syslogd</code> location; see <a data-type="xref" href="#syslog">“Syslog”</a> for details</p></dd>
</dl>

<p>One common pattern for consuming logs live (that is, as it happens) is to
<em>follow logs</em>; that is, you watch the end of the log as new log lines are added
(edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>tail</code><code> </code><code>-f</code><code> </code><code>/var/log/syslog</code><code> </code><a class="co" id="co_observability_CO2-1" href="#callout_observability_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">15</code><code>:06:41</code><code> </code><code>starlite</code><code> </code><code>nm-applet</code><code class="o">[</code><code class="m">31555</code><code class="o">]</code><code>:</code><code> </code><code>...</code><code> </code><code class="s1">'GTK_IS_WIDGET (widget)'</code><code> </code><code>failed</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">15</code><code>:06:41</code><code> </code><code>starlite</code><code> </code><code>nm-dispatcher:</code><code> </code><code>...</code><code> </code><code>new</code><code> </code><code>request</code><code> </code><code class="o">(</code><code class="m">3</code><code> </code><code>scripts</code><code class="o">)</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">15</code><code>:06:41</code><code> </code><code>starlite</code><code> </code><code>systemd</code><code class="o">[</code><code class="m">1</code><code class="o">]</code><code>:</code><code> </code><code>Starting</code><code> </code><code>PackageKit</code><code> </code><code>Daemon...</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">15</code><code>:06:41</code><code> </code><code>starlite</code><code> </code><code>nm-dispatcher:</code><code> </code><code>...</code><code> </code><code>start</code><code> </code><code>running</code><code> </code><code>ordered</code><code> </code><code>scripts...</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">15</code><code>:06:42</code><code> </code><code>starlite</code><code> </code><code>PackageKit:</code><code> </code><code>daemon</code><code> </code><code>start</code><code> </code><a class="co" id="co_observability_CO2-2" href="#callout_observability_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>^C</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO2-1" href="#co_observability_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Follow the logs of the <code>syslogd</code> process with the <code>-f</code> option.</p></dd>
<dt><a class="co" id="callout_observability_CO2-2" href="#co_observability_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>An example log line; see <a data-type="xref" href="#syslog">“Syslog”</a> for the format.</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>If you want to see the log output of a process and at the same time store it in a file, you can use the
<a href="https://oreil.ly/X1Gqo"><code>tee</code> command</a>:</p>

<pre data-type="programlisting" data-code-language="shell">$ someprocess <code class="p">|</code> tee -a some.log</pre>

<p>Now you’d see the output of <code>someprocess</code> in your terminal, and the output would
at the same time be stored in <em>some.log</em>. Note that we’re using the <code>-a</code> option to append
to the log file, otherwise it would be truncated.</p>
</div>

<p>Let’s now have a look at the two most commonly used Linux logging systems.</p>








<section data-type="sect2" data-pdf-bookmark="Syslog"><div class="sect2" id="syslog">
<h2>Syslog</h2>

<p><a data-type="indexterm" data-primary="logging" data-secondary="syslog" id="idm45805427688640"/><a data-type="indexterm" data-primary="syslog" id="idm45805427700384"/>Syslog is a logging standard for a range of sources, from the kernel to daemons
to user space. It has its roots in networked environments, and today the
protocol comprises a textual format defined in <a href="https://oreil.ly/1Qqng">RFC 5424</a>,
along with deployment scenarios and security considerations.
<a data-type="xref" href="#fig-syslog-format">Figure 8-2</a> shows the high-level format of Syslog, but be aware
that there are many seldom-used optional fields.</p>

<figure><div id="fig-syslog-format" class="figure">
<img src="Images/lmlx_0802.png" alt="lmlx 0802" width="600" height="292"/>
<h6><span class="label">Figure 8-2. </span>Syslog format as per RFC 5424</h6>
</div></figure>

<p>The Syslog format as defined in RFC 5424 has the following header fields (with <code>TS</code>
and <code>HN</code> the most often used):</p>
<dl>
<dt><code>PRI</code></dt>
<dd>
<p>The message facility/severity</p>
</dd>
<dt><code>VER</code></dt>
<dd>
<p>The Syslog protocol number (usually left out since it can only be 1)</p>
</dd>
<dt><code>TS</code></dt>
<dd>
<p>Contains the time when the message was generated using ISO 8601 format</p>
</dd>
<dt><code>HN</code></dt>
<dd>
<p>Identifies the machine that sent the message</p>
</dd>
<dt><code>APP</code></dt>
<dd>
<p>Identifies the application (or a device) that sent the message</p>
</dd>
<dt><code>PID</code></dt>
<dd>
<p>Identifies the process that sent the message</p>
</dd>
<dt><code>MID</code></dt>
<dd>
<p>An optional message ID</p>
</dd>
</dl>

<p>The format also includes <em>structured data</em>, which is the payload in a structured (key/value-based) list where each
  element is bounded by <code>[ ]</code>.</p>

<p>Usually, one would use the <a href="https://oreil.ly/su6IX"><code>syslogd</code> binary</a>
to take care of the log management. Over time, other options have become available
that you should be aware of:</p>
<dl>
<dt><a href="https://oreil.ly/qETe9"><code>syslog-ng</code></a></dt>
<dd>
<p><a data-type="indexterm" data-primary="syslog-ng" id="idm45805427659184"/>An
enhanced log daemon that you can use as a drop-in replacement for <code>syslogd</code> and
that in addition supports TLS, content-based filtering, and logging into
databases such as PostgreSQL and MongoDB. Available since late 1990.</p>
</dd>
<dt><a href="https://oreil.ly/QDPmv"><code>rsyslog</code></a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Rsyslog" id="idm45805427656384"/>Extends the Syslog
  protocol and can also be used with <code>systemd</code>. Available since 2004.</p>
</dd>
</dl>

<p>Despite its age, the Syslog family of protocols and tools is still around and
widely available. With <code>systemd</code> becoming the de facto standard of init systems,
used in every major Linux distro, there is, however, a new way to go about logging:
meet the 
<span class="keep-together"><code>systemd</code></span> journal.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="journalctl"><div class="sect2" id="journalctl">
<h2>journalctl</h2>

<p><a data-type="indexterm" data-primary="journalctl" id="idm45805427651312"/><a data-type="indexterm" data-primary="logging" data-secondary="journalctl" id="idm45805427650384"/>In <a data-type="xref" href="ch06.xhtml#systemd">“systemd”</a>, we briefly touched upon a component that is part of the <code>systemd</code>
ecosystem, responsible for log management:
<a href="https://oreil.ly/M4sbo"><code>journalctl</code></a>.
In contrast to Syslog and the other systems we’ve used so far, <code>journalctl</code> uses a binary
format to store the log items. This allows faster access and better storage footprints.</p>

<p>The binary storage format did attract some criticism when it was introduced since
people are not able to continue to use the familiar <code>tail</code>, <code>cat</code>, and <code>grep</code>
commands to view and search logs. Having said that, while one has to learn a new way
to interact with logs when using <code>journalctl</code>, the learning curve is not
too bad.</p>

<p>Let’s have a look at some common tasks. If you launch <code>journalctl</code> without
parameters, it will present itself as an interactive pager (you can use the arrow keys or space
bar to scroll through it and exit with <code>q</code>) for all the logs.</p>

<p>To restrict the time range, you can, for example, use the following:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>journalctl</code><code> </code><code>--since</code><code> </code><code class="s2">"3 hours ago"</code><code> </code><a class="co" id="co_observability_CO3-1" href="#callout_observability_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code>journalctl</code><code> </code><code>--since</code><code> </code><code class="s2">"2021-09-26 15:30:00"</code><code> </code><code>--until</code><code> </code><code class="s2">"2021-09-26 18:30:00"</code><code> </code><a class="co" id="co_observability_CO3-2" href="#callout_observability_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO3-1" href="#co_observability_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Restrict the time range to what happened in the past three hours.</p></dd>
<dt><a class="co" id="callout_observability_CO3-2" href="#co_observability_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Another way to restrict the time range, with explicit start and stop times.</p></dd>
</dl>

<p>You can limit the output to specific <code>systemd</code> units like so (assuming
there is a service called <code>abc.service</code>):</p>

<pre data-type="programlisting" data-code-language="shell">$ journalctl -u abc.service</pre>
<div data-type="tip"><h6>Tip</h6>
<p>The <code>journalctl</code> tool has a powerful way to format the output of the
log items. Using the <code>--output</code> (or <code>-o</code> for short) parameter, you
can optimize the output for a certain use case. Important values are the following:</p>
<dl>
<dt><code>cat</code></dt>
<dd>
<p>Short form, without time stamp or source</p>
</dd>
<dt><code>short</code></dt>
<dd>
<p>The default, emulating Syslog output</p>
</dd>
<dt><code>json</code></dt>
<dd>
<p>One JSON-formatted entry per line (for automation)</p>
</dd>
</dl>
</div>

<p class="pagebreak-before">You can have the same experience to follow the logs as you’d have with
<code>tail -f</code> using the following:</p>

<pre data-type="programlisting" data-code-language="shell">$ journalctl -f</pre>

<p>Let’s put all the preceding information together into a concrete example. Assume
you want to relaunch a security component of the Linux distro, managed by
<code>systemd</code>: <a href="https://www.apparmor.net">AppArmor</a>. That is, in one terminal we
restart the service using <code>systemctl restart apparmor</code>, and in another we execute
the following command (output edited; the actual output is one log item per line):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>journalctl</code><code> </code><code>-f</code><code> </code><code>-u</code><code> </code><code>apparmor.service</code><code> </code><a class="co" id="co_observability_CO4-1" href="#callout_observability_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>--</code><code> </code><code>Logs</code><code> </code><code>begin</code><code> </code><code>at</code><code> </code><code>Sun</code><code> </code><code class="m">2021</code><code>-01-24</code><code> </code><code class="m">14</code><code>:36:30</code><code> </code><code>GMT.</code><code> </code><code>--</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:02</code><code> </code><code>starlite</code><code> </code><code>apparmor</code><code class="o">[</code><code class="m">13883</code><code class="o">]</code><code>:</code><code> </code><code>All</code><code> </code><code>profile</code><code> </code><code>caches</code><code> </code><code>have</code><code> </code><code>been</code><code> </code><code>cleared,</code><code>
                                          </code><code>but</code><code> </code><code>no</code><code> </code><code>profiles</code><code> </code><code>have</code><code> </code><code>been</code><code> </code><code>unloaded.</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:02</code><code> </code><code>starlite</code><code> </code><code>apparmor</code><code class="o">[</code><code class="m">13883</code><code class="o">]</code><code>:</code><code> </code><code>Unloading</code><code> </code><code>profiles</code><code> </code><code>will</code><code> </code><code>leave</code><code> </code><code>already</code><code>
                                          </code><code>running</code><code> </code><code>processes</code><code> </code><code>permanently</code><code>
</code><code>...</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:02</code><code> </code><code>starlite</code><code> </code><code>systemd</code><code class="o">[</code><code class="m">1</code><code class="o">]</code><code>:</code><code> </code><code>Stopped</code><code> </code><code>AppArmor</code><code> </code><code>initialization.</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:02</code><code> </code><code>starlite</code><code> </code><code>systemd</code><code class="o">[</code><code class="m">1</code><code class="o">]</code><code>:</code><code> </code><code>Starting</code><code> </code><code>AppArmor</code><code> </code><code>initialization...</code><code> </code><a class="co" id="co_observability_CO4-2" href="#callout_observability_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:02</code><code> </code><code>starlite</code><code> </code><code>apparmor</code><code class="o">[</code><code class="m">13904</code><code class="o">]</code><code>:</code><code>  </code><code>*</code><code> </code><code>Starting</code><code> </code><code>AppArmor</code><code> </code><code>profiles</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:03</code><code> </code><code>starlite</code><code> </code><code>apparmor</code><code class="o">[</code><code class="m">13904</code><code class="o">]</code><code>:</code><code> </code><code>Skipping</code><code> </code><code>profile</code><code> </code><code class="k">in</code><code>
                                     </code><code>/etc/apparmor.d/disable:</code><code> </code><code>usr.sbin.rsyslogd</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:09</code><code> </code><code>starlite</code><code> </code><code>apparmor</code><code class="o">[</code><code class="m">13904</code><code class="o">]</code><code>:</code><code>    </code><code>...done.</code><code>
</code><code>Sep</code><code> </code><code class="m">26</code><code> </code><code class="m">17</code><code>:10:09</code><code> </code><code>starlite</code><code> </code><code>systemd</code><code class="o">[</code><code class="m">1</code><code class="o">]</code><code>:</code><code> </code><code>Started</code><code> </code><code>AppArmor</code><code> </code><code>initialization.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO4-1" href="#co_observability_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Follow the logs of the AppArmor service.</p></dd>
<dt><a class="co" id="callout_observability_CO4-2" href="#co_observability_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>After <code>systemd</code> has stopped the service, here it comes back up again.</p></dd>
</dl>

<p>With that we are at the end of the logging section and move on to numerical
values with metrics and the wider topic of monitoring.<a data-type="indexterm" data-startref="ix_ch08-asciidoc3" id="idm45805427519664"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc2" id="idm45805427518960"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Monitoring"><div class="sect1" id="monitoring">
<h1>Monitoring</h1>

<p><a data-type="indexterm" data-primary="monitoring" id="ix_ch08-asciidoc4"/><a data-type="indexterm" data-primary="observability" data-secondary="monitoring" id="ix_ch08-asciidoc5"/><em>Monitoring</em> is the capturing of system and application metrics for a variety of reasons.
For example, you may be interested in how long something takes or how many resources
a process consumes (performance monitoring), or you may be troubleshooting an
unhealthy system. The two types of activities you’ll carry out most often in the
context of monitoring are as follows:</p>

<ul>
<li>
<p>Tracking one or more metrics (over time)</p>
</li>
<li>
<p>Alerting on a condition</p>
</li>
</ul>

<p>In this section, we first focus on some foundations and tools you should be aware of,
and as we move further into the section, we get into more advanced
techniques that may be relevant only in certain situations.</p>

<p>Let’s look at a simple example that displays some basic metrics, such as how
long a system is running, memory usage, and more, using the
<a href="https://oreil.ly/smiz6"><code>uptime</code> command</a>:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>uptime</code><code> </code><a class="co" id="co_observability_CO5-1" href="#callout_observability_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="m">08</code><code>:48:29</code><code> </code><code>up</code><code> </code><code class="m">21</code><code> </code><code>days,</code><code> </code><code class="m">20</code><code>:59,</code><code>  </code><code class="m">1</code><code> </code><code>user,</code><code>  </code><code>load</code><code> </code><code>average:</code><code> </code><code class="m">0</code><code>.76,</code><code> </code><code class="m">0</code><code>.20,</code><code> </code><code class="m">0</code><code>.09</code><code> </code><a class="co" id="co_observability_CO5-2" href="#callout_observability_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO5-1" href="#co_observability_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>uptime</code> command to display some basic system metrics.</p></dd>
<dt><a class="co" id="callout_observability_CO5-2" href="#co_observability_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Separated by commas, the output tells us how long the system is running,
the number of users logged in, and then (in the <code>load average</code> section)
three gauges: the 1-minute, 5-minute, and 15-minute average.
These averages are the number of jobs in the run queue or waiting for disk I/O; the numbers are
normalized and indicate how busy the CPUs are. For example, here the load average
for the past 5 minutes was 0.2 (which in isolation doesn’t tell you much,
so you have to compare it with the other values and track it over time).</p></dd>
</dl>

<p>Next, let’s monitor some basic memory utilization, using the <code>free</code> command
(output compressed to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>free</code><code> </code><code>-h</code><code> </code><a class="co" id="co_observability_CO6-1" href="#callout_observability_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
              </code><code>total</code><code>    </code><code>used</code><code>   </code><code>free</code><code>  </code><code>shared</code><code>  </code><code>buff/cache</code><code>   </code><code>available</code><code>
</code><code>Mem:</code><code>           </code><code class="m">7</code><code>.6G</code><code>    </code><code class="m">1</code><code>.3G</code><code>   </code><code>355M</code><code>    </code><code>395M</code><code>        </code><code class="m">6</code><code>.0G</code><code>        </code><code class="m">5</code><code>.6G</code><code> </code><a class="co" id="co_observability_CO6-2" href="#callout_observability_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>Swap:</code><code>          </code><code>975M</code><code>    </code><code class="m">1</code><code>.2M</code><code>   </code><code>974M</code><code>  </code><a class="co" id="co_observability_CO6-3" href="#callout_observability_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO6-1" href="#co_observability_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Show memory usage using a human-friendly output.</p></dd>
<dt><a class="co" id="callout_observability_CO6-2" href="#co_observability_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The memory stats: total/used/free/shared memory, memory used in
buffers and used for caching (use <code>-w</code> if you don’t want the combined value),
and the available memory.</p></dd>
<dt><a class="co" id="callout_observability_CO6-3" href="#co_observability_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The total/used/free amount of swap space—that is, physical memory moved out
to a swap disk space.</p></dd>
</dl>

<p>A more sophisticated way to look at memory usage is using the
<a href="https://oreil.ly/x8wrI"><code>vmstat</code> (short for virtual memory stats) command</a>.
The following example uses <code>vmstat</code> in a self-updating manner (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>vmstat</code><code> </code><code class="m">1</code><code> </code><a class="co" id="co_observability_CO7-1" href="#callout_observability_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>procs</code><code> </code><code>-----------memory---------</code><code> </code><code>---swap--</code><code> </code><code>----io----</code><code> </code><code>-system-</code><code> </code><code>-----cpu-----</code><code>
</code><code>r</code><code>  </code><code>b</code><code>  </code><code>swpd</code><code>   </code><code>free</code><code>   </code><code>buff</code><code>  </code><code>cache</code><code>   </code><code>si</code><code>   </code><code>so</code><code>   </code><code>bi</code><code>    </code><code>bo</code><code>   </code><code class="k">in</code><code>   </code><code>cs</code><code> </code><code>us</code><code> </code><code>sy</code><code> </code><code>id</code><code> </code><code>wa</code><code> </code><code>st</code><code> </code><a class="co" id="co_observability_CO7-2" href="#callout_observability_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">4</code><code>  </code><code class="m">0</code><code>  </code><code class="m">1184</code><code> </code><code class="m">482116</code><code> </code><code class="m">682388</code><code> </code><code class="m">5447048</code><code>   </code><code class="m">0</code><code>    </code><code class="m">0</code><code>   </code><code class="m">12</code><code>   </code><code class="m">105</code><code>   </code><code class="m">28</code><code>  </code><code class="m">191</code><code>  </code><code class="m">6</code><code>  </code><code class="m">3</code><code> </code><code class="m">91</code><code>  </code><code class="m">0</code><code>  </code><code class="m">0</code><code>
</code><code class="m">0</code><code>  </code><code class="m">0</code><code>  </code><code class="m">1184</code><code> </code><code class="m">483444</code><code> </code><code class="m">682388</code><code> </code><code class="m">5446600</code><code>   </code><code class="m">0</code><code>    </code><code class="m">0</code><code>   </code><code class="m">0</code><code>      </code><code class="m">0</code><code>  </code><code class="m">369</code><code>  </code><code class="m">522</code><code>  </code><code class="m">1</code><code>  </code><code class="m">0</code><code> </code><code class="m">99</code><code>  </code><code class="m">0</code><code>  </code><code class="m">0</code><code>
</code><code class="m">0</code><code>  </code><code class="m">0</code><code>  </code><code class="m">1184</code><code> </code><code class="m">483696</code><code> </code><code class="m">682392</code><code> </code><code class="m">5446600</code><code>   </code><code class="m">0</code><code>    </code><code class="m">0</code><code>   </code><code class="m">0</code><code>    </code><code class="m">104</code><code>  </code><code class="m">278</code><code>  </code><code class="m">374</code><code>  </code><code class="m">1</code><code>  </code><code class="m">1</code><code> </code><code class="m">99</code><code>  </code><code class="m">0</code><code>  </code><code class="m">0</code><code>
</code><code>^C</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO7-1" href="#co_observability_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Show memory stats. The argument <code>1</code> means to print a new summary line every
second.</p></dd>
<dt><a class="co" id="callout_observability_CO7-2" href="#co_observability_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Some important column headers: <code>r</code> is for the number of processes running
or waiting for CPU (should be less than or equal to the number of CPUs you have),
<code>free</code> is the free main memory in KB, <code>in</code> is the number of interrupts
per second, <code>cs</code> is the number of context switches per second, and <code>us</code> to
<code>st</code> are percentages of total CPU time across user space, kernel, idle, and the like.</p></dd>
</dl>

<p>To see how long a certain operation takes, you can use the <code>time</code> command:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code class="nb">time</code><code> </code><code class="o">(</code><code>ls</code><code> </code><code>-R</code><code> </code><code>/etc</code><code> </code><code class="m">2</code><code class="p">&amp;</code><code>&gt;</code><code> </code><code>/dev/null</code><code class="o">)</code><code> </code><a class="co" id="co_observability_CO8-1" href="#callout_observability_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>real</code><code>    </code><code>0m0.022s</code><code> </code><a class="co" id="co_observability_CO8-2" href="#callout_observability_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>user</code><code>    </code><code>0m0.012s</code><code> </code><a class="co" id="co_observability_CO8-3" href="#callout_observability_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>sys</code><code>     </code><code>0m0.007s</code><code> </code><a class="co" id="co_observability_CO8-4" href="#callout_observability_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO8-1" href="#co_observability_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Measure how long recursively listing all <em>/etc</em> subdirectories takes
(we throw away all output, including errors, with <code>2&amp;&gt; /dev/null</code>).</p></dd>
<dt><a class="co" id="callout_observability_CO8-2" href="#co_observability_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The total (wall clock) time it took (not really useful other than for performance).</p></dd>
<dt><a class="co" id="callout_observability_CO8-3" href="#co_observability_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>How long <code>ls</code> itself spent on-CPU (user space).</p></dd>
<dt><a class="co" id="callout_observability_CO8-4" href="#co_observability_CO8-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>How long <code>ls</code> was waiting for Linux to do something (kernel space).</p></dd>
</dl>

<p>In the previous example, if you’re interested in how long an operation took,
taking the sum of <code>user</code> and <code>sys</code> is a good approximation, and the ratio
of the two gives you a good idea where it spends most of the execution time.</p>

<p>Now we focus on some more specific topics: network interfaces and block devices.</p>








<section data-type="sect2" data-pdf-bookmark="Device I/O and Network Interfaces"><div class="sect2" id="idm45805427021904">
<h2>Device I/O and Network Interfaces</h2>

<p><a data-type="indexterm" data-primary="I/O devices, monitoring" id="ix_ch08-asciidoc6"/><a data-type="indexterm" data-primary="monitoring" data-secondary="device I/O and network interfaces" id="ix_ch08-asciidoc7"/><a data-type="indexterm" data-primary="network interfaces" id="ix_ch08-asciidoc8"/><a data-type="indexterm" data-primary="observability" data-secondary="I/O" id="ix_ch08-asciidoc9"/><a data-type="indexterm" data-primary="observability" data-secondary="network" id="ix_ch08-asciidoc10"/>With <a href="https://oreil.ly/L4Pbu"><code>iostat</code></a> you can monitor I/O devices
(output edited):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>iostat</code><code> </code><code>-z</code><code> </code><code>--human</code><code> </code><a class="co" id="co_observability_CO9-1" href="#callout_observability_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Linux</code><code> </code><code class="m">5</code><code>.4.0-81-generic</code><code> </code><code class="o">(</code><code>starlite</code><code class="o">)</code><code>   </code><code class="m">09</code><code>/26/21</code><code>     </code><code>_x86_64_</code><code>      </code><code class="o">(</code><code class="m">4</code><code> </code><code>CPU</code><code class="o">)</code><code>

</code><code>avg-cpu:</code><code>  </code><code>%user</code><code>   </code><code>%nice</code><code> </code><code>%system</code><code> </code><code>%iowait</code><code>  </code><code>%steal</code><code>   </code><code>%idle</code><code>
           </code><code class="m">5</code><code>.8%</code><code>    </code><code class="m">0</code><code>.0%</code><code>    </code><code class="m">2</code><code>.7%</code><code>    </code><code class="m">0</code><code>.1%</code><code>    </code><code class="m">0</code><code>.0%</code><code>   </code><code class="m">91</code><code>.4%</code><code>

</code><code>Device</code><code>             </code><code>tps</code><code>    </code><code>kB_read/s</code><code>    </code><code>kB_wrtn/s</code><code>    </code><code>kB_read</code><code>    </code><code>kB_wrtn</code><code>
</code><code>loop0</code><code>             </code><code class="m">0</code><code>.00</code><code>         </code><code class="m">0</code><code>.0k</code><code>         </code><code class="m">0</code><code>.0k</code><code>     </code><code class="m">343</code><code>.0k</code><code>       </code><code class="m">0</code><code>.0k</code><code>
</code><code>loop1</code><code>             </code><code class="m">0</code><code>.00</code><code>         </code><code class="m">0</code><code>.0k</code><code>         </code><code class="m">0</code><code>.0k</code><code>       </code><code class="m">2</code><code>.8M</code><code>       </code><code class="m">0</code><code>.0k</code><code>
</code><code>...</code><code>
</code><code>sda</code><code>               </code><code class="m">0</code><code>.38</code><code>         </code><code class="m">1</code><code>.4k</code><code>        </code><code class="m">12</code><code>.4k</code><code>       </code><code class="m">2</code><code>.5G</code><code>      </code><code class="m">22</code><code>.5G</code><code> </code><a class="co" id="co_observability_CO9-2" href="#callout_observability_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>dm-0</code><code>              </code><code class="m">0</code><code>.72</code><code>         </code><code class="m">1</code><code>.3k</code><code>        </code><code class="m">12</code><code>.5k</code><code>       </code><code class="m">2</code><code>.4G</code><code>      </code><code class="m">22</code><code>.7G</code><code>
</code><code>...</code><code>
</code><code>loop12</code><code>            </code><code class="m">0</code><code>.00</code><code>         </code><code class="m">0</code><code>.0k</code><code>         </code><code class="m">0</code><code>.0k</code><code>       </code><code class="m">1</code><code>.5M</code><code>       </code><code class="m">0</code><code>.0k</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO9-1" href="#co_observability_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>iostat</code> to show I/O device metrics. With <code>-z</code>, we tell it to
show only devices where there was some activity, and the <code>--human</code>
makes the output nicer (units are in human-readable form).</p></dd>
<dt><a class="co" id="callout_observability_CO9-2" href="#co_observability_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Example row: <code>tps</code> is the number of transfers (I/O requests) per second for that
device, <code>read</code> is data volume, and <code>wrtn</code> is written data.</p></dd>
</dl>

<p>Next up: network interfaces with the
<a href="https://oreil.ly/BAIiv"><code>ss</code> command</a> that can
dump socket statistics (see also <a data-type="xref" href="ch07.xhtml#sockets">“Sockets”</a>). The following command lists both
TCP and UDP sockets along with process IDs (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ss</code><code> </code><code>-atup</code><code> </code><a class="co" id="co_observability_CO10-1" href="#callout_observability_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Netid</code><code> </code><code>State</code><code>   </code><code>Recv-Q</code><code>  </code><code>Send-Q</code><code>  </code><code>Local</code><code> </code><code>Address:Port</code><code>       </code><code>Peer</code><code> </code><code>Address:Port</code><code>
</code><code>udp</code><code>   </code><code>UNCONN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">0</code><code>             </code><code class="m">0</code><code>.0.0.0:60360</code><code>           </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>...</code><code>
</code><code>udp</code><code>   </code><code>UNCONN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">0</code><code>             </code><code class="m">0</code><code>.0.0.0:ipp</code><code>             </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>udp</code><code>   </code><code>UNCONN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">0</code><code>             </code><code class="m">0</code><code>.0.0.0:789</code><code>             </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>udp</code><code>   </code><code>UNCONN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">0</code><code>         </code><code class="m">224</code><code>.0.0.251:mdns</code><code>            </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>udp</code><code>   </code><code>UNCONN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">0</code><code>             </code><code class="m">0</code><code>.0.0.0:mdns</code><code>            </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>udp</code><code>   </code><code>ESTAB</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>      </code><code class="m">192</code><code>.168.178.40:51008</code><code>    </code><code class="m">74</code><code>.125.193.113:443</code><code>
</code><code>...</code><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">128</code><code>           </code><code class="m">0</code><code>.0.0.0:sunrpc</code><code>          </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">128</code><code>     </code><code class="m">127</code><code>.0.0.53%lo:domain</code><code>          </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">5</code><code>           </code><code class="m">127</code><code>.0.0.1:ipp</code><code>             </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">4096</code><code>        </code><code class="m">127</code><code>.0.0.1:45313</code><code>           </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>tcp</code><code>   </code><code>ESTAB</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>      </code><code class="m">192</code><code>.168.178.40:57628</code><code>    </code><code class="m">74</code><code>.125.193.188:5228</code><code> </code><a class="co" id="co_observability_CO10-2" href="#callout_observability_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">128</code><code>              </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:sunrpc</code><code>             </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:*</code><code>
</code><code>tcp</code><code>   </code><code>LISTEN</code><code>  </code><code class="m">0</code><code>       </code><code class="m">5</code><code>               </code><code class="o">[</code><code>::1</code><code class="o">]</code><code>:ipp</code><code>                </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:*</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO10-1" href="#co_observability_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>ss</code> with the following options: with <code>-a</code>, we select all (that is,
both listening and nonlistening sockets); the <code>-t</code> and <code>-u</code> select TCP
and UDP, respectively; and 
<span class="keep-together"><code>-p</code></span> shows the processes using the sockets.</p></dd>
<dt><a class="co" id="callout_observability_CO10-2" href="#co_observability_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>An example socket in use. It’s an established TCP connection between local
IPv4 address <code>192.168.178.40</code> and remote <code>74.125.193.188</code> that seems idle:
both data queued for receive (<code>Recv-Q</code>) and transmit (<code>Send-Q</code>) report zero.</p></dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>An outdated way to gather and display interface stats is
using <a href="https://oreil.ly/UBqge"><span class="keep-together"><code>netstat</code></span></a>.
For example, if you want to have a continuously updated view on
TCP and UDP, including process ID and using IP addresses rather than
FQDNs, you could use <code>netstat -ctulpn</code>.</p>
</div>

<p><a href="https://oreil.ly/qDT67"><code>lsof</code></a> stands for
“list open files” and is a versatile tool with many use cases. The following example shows <code>lsof</code>
used in the context of network connections (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>lsof</code><code> </code><code>-i</code><code> </code><code>TCP:1-1024</code><code> </code><a class="co" id="co_observability_CO11-1" href="#callout_observability_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>COMMAND</code><code>     </code><code>PID</code><code>            </code><code>USER</code><code>   </code><code>FD</code><code>   </code><code>TYPE</code><code> </code><code>DEVICE</code><code> </code><code>SIZE/OFF</code><code> </code><code>NODE</code><code> </code><code>NAME</code><code>
</code><code>...</code><code>
</code><code>rpcbind</code><code>   </code><code class="m">26901</code><code>            </code><code>root</code><code>    </code><code>8u</code><code>  </code><code>IPv4</code><code> </code><code class="m">615970</code><code>    </code><code>0t0</code><code>  </code><code>TCP</code><code> </code><code>*:sunrpc</code><code> </code><code class="o">(</code><code>LISTEN</code><code class="o">)</code><code>
</code><code>rpcbind</code><code>   </code><code class="m">26901</code><code>            </code><code>root</code><code>   </code><code>11u</code><code>  </code><code>IPv6</code><code> </code><code class="m">615973</code><code>    </code><code>0t0</code><code>  </code><code>TCP</code><code> </code><code>*:sunrpc</code><code> </code><code class="o">(</code><code>LISTEN</code><code class="o">)</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO11-1" href="#co_observability_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>List privileged TCP ports (needs <code>root</code> privileges).</p></dd>
</dl>

<p>Another usage example for <code>lsof</code> is a process-centric view: if you know the
PID of a process (here, Chrome), you can use <code>lsof</code> to track file descriptors,
I/O, etc. (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell">$ lsof -p <code class="m">5299</code>
COMMAND  PID USER   FD TYPE  DEVICE  SIZE/OFF     NODE NAME
chrome  <code class="m">5299</code>  mh9  cwd  DIR   <code class="m">253</code>,0      <code class="m">4096</code>  <code class="m">6291458</code> /home/mh9
chrome  <code class="m">5299</code>  mh9  rtd  DIR   <code class="m">253</code>,0      <code class="m">4096</code>        <code class="m">2</code> /
chrome  <code class="m">5299</code>  mh9  txt  REG   <code class="m">253</code>,0 <code class="m">179093936</code>  <code class="m">3673554</code> /opt/google/chrome/chrome
...</pre>

<p>There are many more tools for (performance) monitoring available—for example,
<a href="https://oreil.ly/dYWwR"><code>sar</code></a> (covering a range of counters, nice for
scripts) and <a href="https://oreil.ly/TJ4gP"><code>perf</code></a>—some of
which we will discuss in <a data-type="xref" href="#advanced-o11y">“Advanced Observability”</a>.<a data-type="indexterm" data-startref="ix_ch08-asciidoc10" id="idm45805426842144"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc9" id="idm45805426841440"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc8" id="idm45805426840768"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc7" id="idm45805426584032"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc6" id="idm45805426583360"/></p>

<p>Now that you have a handle on individual tools, let’s move on to integrated
tools that allow you to interactively monitor Linux.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Integrated Performance Monitors"><div class="sect2" id="integrated-mon">
<h2>Integrated Performance Monitors</h2>

<p><a data-type="indexterm" data-primary="integrated performance monitoring" id="ix_ch08-asciidoc11"/><a data-type="indexterm" data-primary="monitoring" data-secondary="integrated performance monitors" id="ix_ch08-asciidoc12"/>Using the tooling we discussed in the previous section, such as <code>lsof</code> or <code>vmstat</code>,
is a good starting point and also useful in scripts. For more convenient
monitoring, you may prefer integrated solutions. These typically come with a
textual user interface (TUI), sometimes in color, and offer the following features:</p>

<ul>
<li>
<p>Support for multiple resource types (CPU, RAM, I/O)</p>
</li>
<li>
<p>Interactive sorting and filtering (by process, user, resource)</p>
</li>
<li>
<p>Live updates and drill-down into details such as a process group or even
cgroups and namespaces</p>
</li>
</ul>

<p>For example, the widely available <a href="https://oreil.ly/NqKO2"><code>top</code></a> provides
an overview in the header—akin to what we saw in the <code>uptime</code> output—and then a
tabular rendering of CPU and memory details, followed by a list of
processes you can track (output edited):</p>

<pre data-type="programlisting" data-code-language="shell"><code>top</code><code> </code><code>-</code><code> </code><code class="m">12</code><code>:52:54</code><code> </code><code>up</code><code> </code><code class="m">22</code><code> </code><code>days,</code><code>  </code><code class="m">1</code><code>:04,</code><code>  </code><code class="m">1</code><code> </code><code>user,</code><code>  </code><code>load</code><code> </code><code>average:</code><code> </code><code class="m">0</code><code>.23,</code><code> </code><code class="m">0</code><code>.26,</code><code> </code><code class="m">0</code><code>.23</code><code> </code><a class="co" id="co_observability_CO12-1" href="#callout_observability_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Tasks:</code><code> </code><code class="m">263</code><code> </code><code>total,</code><code>   </code><code class="m">1</code><code> </code><code>running,</code><code> </code><code class="m">205</code><code> </code><code>sleeping,</code><code>   </code><code class="m">0</code><code> </code><code>stopped,</code><code>   </code><code class="m">0</code><code> </code><code>zombie</code><code> </code><a class="co" id="co_observability_CO12-2" href="#callout_observability_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>%Cpu</code><code class="o">(</code><code>s</code><code class="o">)</code><code>:</code><code>  </code><code class="m">0</code><code>.2</code><code> </code><code>us,</code><code>  </code><code class="m">0</code><code>.4</code><code> </code><code>sy,</code><code>  </code><code class="m">0</code><code>.0</code><code> </code><code>ni,</code><code> </code><code class="m">99</code><code>.3</code><code> </code><code>id,</code><code>  </code><code class="m">0</code><code>.0</code><code> </code><code>wa,</code><code>  </code><code class="m">0</code><code>.0</code><code> </code><code>hi,</code><code>  </code><code class="m">0</code><code>.0</code><code> </code><code>si,</code><code> </code><code class="se">\
</code><code>  </code><code class="m">0</code><code>.0</code><code> </code><code>st%</code><code> </code><a class="co" id="co_observability_CO12-3" href="#callout_observability_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>KiB</code><code> </code><code>Mem</code><code> </code><code>:</code><code>  </code><code class="m">7975928</code><code> </code><code>total,</code><code>   </code><code class="m">363608</code><code> </code><code>free,</code><code>  </code><code class="m">1360348</code><code> </code><code>used,</code><code>  </code><code class="m">6251972</code><code> </code><code>buff/cache</code><code>
</code><code>KiB</code><code> </code><code>Swap:</code><code>   </code><code class="m">999420</code><code> </code><code>total,</code><code>   </code><code class="m">998236</code><code> </code><code>free,</code><code>     </code><code class="m">1184</code><code> </code><code>used.</code><code>  </code><code class="m">5914992</code><code> </code><code>avail</code><code> </code><code>Mem</code><code>

</code><code>PID</code><code> </code><code>USER</code><code>      </code><code>PR</code><code>  </code><code>NI</code><code>    </code><code>VIRT</code><code>    </code><code>RES</code><code>    </code><code>SHR</code><code> </code><code>S</code><code>  </code><code>%CPU</code><code> </code><code>%MEM</code><code>     </code><code>TIME+</code><code> </code><code>COMMAND</code><code> </code><a class="co" id="co_observability_CO12-4" href="#callout_observability_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
  </code><code class="m">1</code><code> </code><code>root</code><code>      </code><code class="m">20</code><code>   </code><code class="m">0</code><code>  </code><code class="m">225776</code><code>   </code><code class="m">9580</code><code>   </code><code class="m">6712</code><code> </code><code>S</code><code>   </code><code class="m">0</code><code>.0</code><code>  </code><code class="m">0</code><code>.1</code><code>   </code><code class="m">0</code><code>:25.84</code><code> </code><code>systemd</code><code>
</code><code>...</code><code>
</code><code class="m">433</code><code> </code><code>root</code><code>      </code><code class="m">20</code><code>   </code><code class="m">0</code><code>  </code><code class="m">105908</code><code>   </code><code class="m">1928</code><code>   </code><code class="m">1700</code><code> </code><code>S</code><code>   </code><code class="m">0</code><code>.0</code><code>  </code><code class="m">0</code><code>.0</code><code>   </code><code class="m">0</code><code>:00.05</code><code>  </code><code class="sb">`</code><code>-</code><code> </code><code>lvmetad</code><code>
</code><code>...</code><code>
</code><code class="m">775</code><code> </code><code>root</code><code>      </code><code class="m">20</code><code>   </code><code class="m">0</code><code>   </code><code class="m">36552</code><code>   </code><code class="m">4240</code><code>   </code><code class="m">3880</code><code> </code><code>S</code><code>   </code><code class="m">0</code><code>.0</code><code>  </code><code class="m">0</code><code>.1</code><code>   </code><code class="m">0</code><code>:00.16</code><code>  </code><code class="sb">`</code><code>-</code><code> </code><code>bluetoothd</code><code>
</code><code class="m">789</code><code> </code><code>syslog</code><code>    </code><code class="m">20</code><code>   </code><code class="m">0</code><code>  </code><code class="m">263040</code><code>   </code><code class="m">4384</code><code>   </code><code class="m">3616</code><code> </code><code>S</code><code>   </code><code class="m">0</code><code>.0</code><code>  </code><code class="m">0</code><code>.1</code><code>   </code><code class="m">0</code><code>:01.98</code><code>  </code><code class="sb">`</code><code>-</code><code> </code><code>rsyslogd</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO12-1" href="#co_observability_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Summary of system (compare with <code>uptime</code> output)</p></dd>
<dt><a class="co" id="callout_observability_CO12-2" href="#co_observability_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Task statistics</p></dd>
<dt><a class="co" id="callout_observability_CO12-3" href="#co_observability_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>CPU usage statistics (user, kernel, etc.; similar to <code>vmstat</code> output)</p></dd>
<dt><a class="co" id="callout_observability_CO12-4" href="#co_observability_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The dynamic process list, including details on a per-process level;
comparable to <code>ps aux</code> output</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>The following are the most important keys to remember in <code>top</code>:</p>
<dl>
<dt><code>?</code></dt>
<dd>
<p>To list the help (including key mappings)</p>
</dd>
<dt><code>V</code></dt>
<dd>
<p>To toggle to and from process tree view</p>
</dd>
<dt><code>m</code></dt>
<dd>
<p>To sort by memory usage</p>
</dd>
<dt><code>P</code></dt>
<dd>
<p>To sort by CPU consumption</p>
</dd>
<dt><code>k</code></dt>
<dd>
<p>To send a signal (like to <code>kill</code>)</p>
</dd>
<dt><code>q</code></dt>
<dd>
<p>To quit</p>
</dd>
</dl>
</div>

<p>While <code>top</code> is available in virtually any environment, there are a number of
alternatives available, including the following:</p>
<dl>
<dt><a href="https://oreil.ly/P9elE"><code>htop</code></a> (<a data-type="xref" href="#fig-htop">Figure 8-3</a>)</dt>
<dd>
<p>An incremental <code>top</code>
  improvement that is faster than <code>top</code> and has a nicer user interface.</p>
</dd>
<dt><a href="https://oreil.ly/luRoU"><code>atop</code></a> (<a data-type="xref" href="#fig-atop">Figure 8-4</a>)</dt>
<dd>
<p>A powerful alternative to <code>top</code>.
  In addition to CPU and memory, it covers resources such as I/O and network stats
  in great detail.</p>
</dd>
<dt><a href="https://oreil.ly/XdOHB"><code>below</code></a></dt>
<dd>
<p>A relatively new tool
  that is notable especially because it is cgroups v2–aware (see <a data-type="xref" href="ch06.xhtml#cgroups">“Linux cgroups”</a>).
  Other tools do not understand cgroups and hence provide only a global resource view.</p>
</dd>
</dl>

<figure><div id="fig-htop" class="figure">
<img src="Images/lmlx_0803.png" alt="lmlx 0803" width="600" height="299"/>
<h6><span class="label">Figure 8-3. </span>A screenshot of the <code>htop</code> tool</h6>
</div></figure>

<figure><div id="fig-atop" class="figure">
<img src="Images/lmlx_0804.png" alt="lmlx 0804" width="600" height="309"/>
<h6><span class="label">Figure 8-4. </span>A screenshot of the <code>atop</code> tool</h6>
</div></figure>

<p>There are a number of other integrated monitoring tools available that go beyond
the basic sources or that specialize in certain use cases. These include but are not limited to the following:</p>
<dl>
<dt><a href="https://oreil.ly/zOC9e">glances</a></dt>
<dd>
<p>A powerful hybrid that covers devices in addition to the usual resources</p>
</dd>
<dt><a href="https://oreil.ly/uqBH1">guider</a></dt>
<dd>
<p>An integrated performance analyzer
  that allows you to display and graph a range of metrics</p>
</dd>
<dt><a href="https://oreil.ly/O4BHS">neoss</a></dt>
<dd>
<p>For network traffic monitoring; an <code>ss</code> replacement that offers a
  nice TUI</p>
</dd>
<dt><a href="https://oreil.ly/uL38A">mtr</a></dt>
<dd>
<p>For network traffic monitoring; a more powerful alternative to <code>traceroute</code> (see <a data-type="xref" href="ch07.xhtml#routing">“Routing”</a> for details on <code>traceroute</code>)</p>
</dd>
</dl>

<p>Now that you have a broad understanding of the tooling to consume system metrics,
let’s see how you can expose those from your own code.<a data-type="indexterm" data-startref="ix_ch08-asciidoc12" id="idm45805426272576"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc11" id="idm45805426271872"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Instrumentation"><div class="sect2" id="instrumentation">
<h2>Instrumentation</h2>

<p><a data-type="indexterm" data-primary="monitoring" data-secondary="instrumentation" id="idm45805426269616"/>So far we’ve focused on signals coming from the kernel or existing applications
(that is, code that you don’t own). Now we move to the topic of how you can, similar to
logs, equip your code to emit metrics.</p>

<p>The process of inserting code to emit signals, especially metrics, is mainly
relevant if you’re developing software. This process is usually referred to as
<em>instrumentation</em>, and there are two common instrumentation strategies:
<em>autoinstrumentation</em> (no additional effort for you as a developer) and <em>custom
instrumentation</em>, where you manually insert code snippets to, for example, emit a
metric at a certain point in your code base.</p>

<p class="pagebreak-after">You can use <a href="https://oreil.ly/XOYFE">StatsD</a>, with client-side libraries
available for a number of programming languages, such as <a href="https://oreil.ly/VfE4D">Ruby</a>, <a href="https://oreil.ly/G9Jt3">Node.js</a>, <a href="https://oreil.ly/hQBMf">Python</a>, and <a href="https://oreil.ly/whpZV">Go</a>. StatsD is nice, but it  has a few limitations, especially in dynamic environments
such as Kubernetes or IoT. <a data-type="indexterm" data-primary="scraping" id="idm45805426261744"/>In those environments, a different approach—sometimes called <em>pull-based</em>
or <em>scraping</em>—is usually a better choice. With scraping, applications expose metrics (usually via an HTTP endpoint), and an agent then calls this endpoint to retrieve metrics, rather than configuring the app with where to send the metrics to.
We’ll return to this topic in <a data-type="xref" href="#prometheus-grafana">“Prometheus and Grafana”</a>.<a data-type="indexterm" data-startref="ix_ch08-asciidoc5" id="idm45805426258960"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc4" id="idm45805426258256"/></p>
</div></section>





</div></section>













<section data-type="sect1" class="less_space" data-pdf-bookmark="Advanced Observability"><div class="sect1" id="advanced-o11y">
<h1>Advanced Observability</h1>

<p>Now that you know the basics of Linux observability, let’s have a look at
some more advanced topics in this space.</p>








<section data-type="sect2" data-pdf-bookmark="Tracing and Profiling"><div class="sect2" id="tracing">
<h2>Tracing and Profiling</h2>

<p><a data-type="indexterm" data-primary="observability" data-secondary="tracing" id="ix_ch08-asciidoc14"/><a data-type="indexterm" data-primary="tracing" id="ix_ch08-asciidoc15"/>The term <em>tracing</em> is overloaded: in the context of Linux, on a single machine,
tracing means capturing the process execution (function calls in user space, syscalls,
etc.) over time.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In a distributed setup like containerized microservices in
Kubernetes or a bunch of Lambda functions that are part of a serverless app, we sometimes
shorten
<a href="https://oreil.ly/tTjY9"><em>distributed
tracing</em></a> (for example, with OpenTelemetry and Jaeger) to <em>tracing</em>. This type
of tracing is out of scope for this book.</p>
</div>

<p>There are a number of data sources in the context of a single Linux machine.
You can use the following as sources for tracing:</p>
<dl>
<dt>The Linux kernel</dt>
<dd>
<p>Traces can come from functions in the kernel or be triggered
  by syscalls. Examples include
  <a href="https://oreil.ly/lAolL">kernel probes</a>
  (kprobes) or
  <a href="https://oreil.ly/wZcXE">kernel
  tracepoints</a>.</p>
</dd>
<dt>User space</dt>
<dd>
<p>Application function calls, for example via
  <a href="https://oreil.ly/I8ICY">user space
  probes (uprobes)</a>, can act as a source for traces.</p>
</dd>
</dl>

<p>Use cases for tracing include the following:</p>

<ul>
<li>
<p>Debugging a program using, for example, the <a href="https://strace.io"><code>strace</code></a> tracing tool</p>
</li>
<li>
<p>Performance analysis with a frontend, using <a href="https://oreil.ly/izMpR"><code>perf</code></a></p>
</li>
</ul>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>You may be tempted to use <code>strace</code> everywhere; however, you should be aware
of the overhead it causes. This is particularly relevant for production
environments. Read
<a href="https://oreil.ly/eSLOT">“strace
Wow Much Syscall”</a> by Brendan Gregg to understand the background.</p>
</div>

<p>See <a data-type="xref" href="#fig-perf">Figure 8-5</a> for an example output of <code>sudo perf top</code>, which generates a
summary by process.</p>

<figure><div id="fig-perf" class="figure">
<img src="Images/lmlx_0805.png" alt="lmlx 0805" width="600" height="564"/>
<h6><span class="label">Figure 8-5. </span>A screenshot of the <code>perf</code> tracing tool</h6>
</div></figure>

<p>Going forward, it seems that eBPF (see <a data-type="xref" href="ch02.xhtml#ebpf">“A Modern Way to Extend the Kernel: eBPF”</a>) will become the de facto standard
to implement tracing, especially for custom cases. It has a rich ecosystem and
growing vendor support, so if you’re looking for a future-proof tracing method,
make sure it’s using eBPF.</p>

<p><a data-type="indexterm" data-primary="observability" data-secondary="profiling" id="idm45805426230544"/><a data-type="indexterm" data-primary="profiling" id="idm45805426229568"/>One particular use case for tracing is <em>profiling</em>—that is, to identify
frequently called code sections. Some relevant low-level tooling for profiling
include <a href="https://oreil.ly/tETfk"><code>pprof</code></a>, <a href="https://oreil.ly/p9HQJ">Valgrind</a>, and <a href="https://oreil.ly/bCgbJ">flame graph visualizations</a>.</p>

<p>There are many options to consume <code>perf</code> output interactively and visualize
traces; for example, see Mark Hansen’s blog post
<a href="https://oreil.ly/dGH1S">“Linux perf Profiler UIs”</a>.</p>

<p><a data-type="indexterm" data-primary="continuous profiling" id="idm45805426224096"/><em>Continuous profiling</em> is an advanced variant of profiling, which captures
traces (kernel and user space) over time. Once these timestamped traces are
collected, you can plot and compare them and drill down into interesting
segments. One very promising example is the eBPF-based open source project
<a href="https://www.parca.dev">parca</a>, shown in <a data-type="xref" href="#fig-parca">Figure 8-6</a>.<a data-type="indexterm" data-startref="ix_ch08-asciidoc15" id="idm45805426221168"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc14" id="idm45805426220464"/></p>

<figure><div id="fig-parca" class="figure">
<img src="Images/lmlx_0806.png" alt="lmlx 0806" width="600" height="284"/>
<h6><span class="label">Figure 8-6. </span>A screenshot of parca, a continuous profiling tool</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Prometheus and Grafana"><div class="sect2" id="prometheus-grafana">
<h2>Prometheus and Grafana</h2>

<p><a data-type="indexterm" data-primary="Grafana" id="ix_ch08-asciidoc16"/><a data-type="indexterm" data-primary="observability" data-secondary="metrics" id="ix_ch08-asciidoc17"/><a data-type="indexterm" data-primary="Prometheus" id="ix_ch08-asciidoc18"/>If you’re dealing with metrics over time (time series data), using
the <a href="https://prometheus.io">Prometheus</a> and <a href="https://grafana.com">Grafana</a> combo
is something you may want to consider for advanced observability.</p>

<p>I’ll show you a simple, single-machine setup that you can
use to dashboard and even alert on things going on in your Linux machine.</p>

<p>We’ll use the <a href="https://oreil.ly/0L4KJ">node exporter</a>
to expose a range of system metrics, from CPU to memory and network. We’ll
then use Prometheus to scrape the node exporter. Scraping means that Prometheus
calls an HTTP endpoint that the node exporter offers via the URL path <em>/metrics</em>, returning the metrics
in <a href="https://openmetrics.io">OpenMetrics format</a>. For that to happen, we need to
configure Prometheus with the URL of the node exporter’s HTTP endpoint. The
final step in our setup is using Prometheus as a datasource in Grafana,
where you can see the time series data (metrics over time) in dashboards and
can even alert on certain conditions, such as low disk space or CPUs
overloading.</p>

<p class="pagebreak-before">So, as a first step, download and untar the node exporter, and have it run the
binary with <code>./node_exporter &amp;</code> in the background. You can check if it’s running
properly with the following (output edited):</p>

<pre data-type="programlisting" data-code-language="shell">$ curl localhost:9100/metrics
...
<code class="c1"># TYPE go_gc_duration_seconds summary</code>
go_gc_duration_seconds<code class="o">{</code><code class="nv">quantile</code><code class="o">=</code><code class="s2">"0"</code><code class="o">}</code> <code class="m">7</code>.2575e-05
go_gc_duration_seconds<code class="o">{</code><code class="nv">quantile</code><code class="o">=</code><code class="s2">"0.25"</code><code class="o">}</code> <code class="m">0</code>.00011246
go_gc_duration_seconds<code class="o">{</code><code class="nv">quantile</code><code class="o">=</code><code class="s2">"0.5"</code><code class="o">}</code> <code class="m">0</code>.000227351
go_gc_duration_seconds<code class="o">{</code><code class="nv">quantile</code><code class="o">=</code><code class="s2">"0.75"</code><code class="o">}</code> <code class="m">0</code>.000336613
go_gc_duration_seconds<code class="o">{</code><code class="nv">quantile</code><code class="o">=</code><code class="s2">"1"</code><code class="o">}</code> <code class="m">0</code>.002659194
go_gc_duration_seconds_sum <code class="m">0</code>.126529838
go_gc_duration_seconds_count <code class="m">390</code>
...</pre>

<p>Now that we have the signal data source set up, we run both Prometheus and
Grafana as containers. For the following, you’ll need Docker
(see <a data-type="xref" href="ch06.xhtml#docker">“Docker”</a>) installed and configured.</p>

<p>Create a Prometheus configuration file called <em>prometheus.yml</em>
with the following 
<span class="keep-together">content:</span></p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">global</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">scrape_interval</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">15s</code><code class="w">
</code><code class="w">  </code><code class="nt">evaluation_interval</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">15s</code><code class="w">
</code><code class="w">  </code><code class="nt">external_labels</code><code class="p">:</code><code class="w">
</code><code class="w">      </code><code class="nt">monitor</code><code class="p">:</code><code class="w"> </code><code class="s">'</code><code class="s">mymachine</code><code class="s">'</code><code class="w">
</code><code class="nt">scrape_configs</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">job_name</code><code class="p">:</code><code class="w"> </code><code class="s">'</code><code class="s">prometheus</code><code class="s">'</code><code class="w"> </code><a class="co" id="co_observability_CO13-1" href="#callout_observability_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="w">
</code><code class="w">    </code><code class="nt">static_configs</code><code class="p">:</code><code class="w">
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">targets</code><code class="p">:</code><code class="w"> </code><code class="p-Indicator">[</code><code class="s">'</code><code class="s">localhost:9090</code><code class="s">'</code><code class="p-Indicator">]</code><code class="w">
</code><code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">job_name</code><code class="p">:</code><code class="w"> </code><code class="s">'</code><code class="s">machine</code><code class="s">'</code><code class="w"> </code><a class="co" id="co_observability_CO13-2" href="#callout_observability_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="w">
</code><code class="w">    </code><code class="nt">static_configs</code><code class="p">:</code><code class="w">
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">targets</code><code class="p">:</code><code class="w"> </code><code class="p-Indicator">[</code><code class="s">'</code><code class="s">172.17.0.1:9100</code><code class="s">'</code><code class="p-Indicator">]</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_observability_CO13-1" href="#co_observability_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Prometheus itself exposes metrics, so we include this (self-monitoring).</p></dd>
<dt><a class="co" id="callout_observability_CO13-2" href="#co_observability_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>That’s our node exporter. Since we’re running Prometheus in Docker, we
can’t use <code>localhost</code> but rather use the IP address Docker uses by default.</p></dd>
</dl>

<p>We use the Prometheus configuration file we created in the previous step
and mount it into the container via a volume, like so:</p>
<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>docker</code><code> </code><code>run</code><code> </code><code>--name</code><code> </code><code>prometheus</code><code> </code><code class="se">\
</code><code>         </code><code>--rm</code><code> </code><code>-d</code><code> </code><code>-p</code><code> </code><code class="m">9090</code><code>:9090</code><code> </code><code class="se">\ </code><a class="co" id="custom_co_observability_CO14-1" href="#custom_callout_observability_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
         </code><code>-v</code><code> </code><code>/home/mh9/lml/o11y/prometheus.yml:/etc/prometheus/prometheus.yml</code><code> </code><code class="se">\ </code><a class="co" id="custom_co_observability_CO14-2" href="#custom_callout_observability_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
         </code><code>prom/prometheus:main</code></pre>
<dl class="calloutlist pagebreak-before">
<dt class="less_space"><a class="co" id="custom_callout_observability_CO14-1" href="#custom_co_observability_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The parameters here make Docker remove the container on exit (<code>--rm</code>),
run as a daemon (<code>-d</code>), and expose the port 9090 (<code>-p</code>) so we can use it from
our machine.</p></dd>
<dt><a class="co" id="custom_callout_observability_CO14-2" href="#custom_co_observability_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Mapping our config file as a volume into the container. Note that here you
will have to replace <em>/home/mh9/lml/o11y/</em> with the path where you stored
it. Also, this has to be an absolute path. So, if you want to keep this
flexible, you could use <code>$PWD</code> in bash or <code>(pwd)</code> in Fish rather than
the hardcoded path.</p></dd>
</dl>

<p>After you’ve executed the previous command, open <em>localhost:9000</em> in your browser,
then click Targets in the Status dropdown menu at the top. You should, after
a few seconds, see something like the screen shown in <a data-type="xref" href="#fig-prometheus">Figure 8-7</a>, confirming
that Prometheus has successfully scraped metrics from itself and the node
exporter.</p>

<figure><div id="fig-prometheus" class="figure">
<img src="Images/lmlx_0807.png" alt="lmlx 0807" width="600" height="201"/>
<h6><span class="label">Figure 8-7. </span>A screenshot of Prometheus targets in the Web UI</h6>
</div></figure>

<p>Next, we launch Grafana:</p>

<pre data-type="programlisting" data-code-language="shell">$ docker run --name grafana <code class="se">\</code>
         --rm -d -p <code class="m">3000</code>:3000 <code class="se">\</code>
         grafana/grafana:8.0.3</pre>

<p>After you’ve executed the preceding command, open <em>localhost:3000</em> in your browser
and use <code>admin</code> for both the username and password. Next, we need to do two
things:</p>
<ol>
<li>
<p>Add <a href="https://oreil.ly/9Efhy">Prometheus as a datasource</a>
in Grafana, using <code>172.17.0.1:9100</code> as the URL</p>
</li>
<li>
<p>Import the <a href="https://oreil.ly/RpCDe">Node Exporter Full dashboard</a></p>
</li>

</ol>

<p>Once you’ve done this, you should see something akin to <a data-type="xref" href="#fig-grafana">Figure 8-8</a>.</p>

<figure><div id="fig-grafana" class="figure">
<img src="Images/lmlx_0808.png" alt="lmlx 0808" width="600" height="285"/>
<h6><span class="label">Figure 8-8. </span>A screenshot of the Grafana UI with the Node Exporter Full dashboard</h6>
</div></figure>

<p>That was some exciting advanced observability for Linux, using modern tooling.
Given that the Prometheus/Grafana setup is more elaborate and has a number of
moving parts, you’ll likely not use it for a trivial task. In other words,
the Linux native tooling we discussed in this section should go a long way;
however, there are more advanced use cases—for example, home automation or
a media server—where you want to have a more complete solution, in which case
Prometheus/Grafana makes a lot of sense<a data-type="indexterm" data-startref="ix_ch08-asciidoc18" id="idm45805425973664"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc17" id="idm45805425972960"/><a data-type="indexterm" data-startref="ix_ch08-asciidoc16" id="idm45805425972288"/>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45805426216880">
<h1>Conclusion</h1>

<p>In this chapter, we looked at making sure you’re not flying blind when you’re
running into issues with your Linux system. The main signal types you’d
typically use for diagnostics are logs (textual) and metrics (numerical).
For advanced cases, you can apply profiling techniques, rendering resource
usage of processes along with the execution context (source file and lines
of the source code that is being executed).</p>

<p>If you want to learn more and dive deeper into this topic, have
a look at these resources:</p>
<dl>
<dt>Basics</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/sxtPd"><em>Systems Performance: Enterprise and the Cloud</em>, second edition</a>, by Brendan Gregg  (Addison-Wesley)</p>
</li>
<li>
<p><a href="https://oreil.ly/YVxJt">“Linux Performance Analysis in 60,000 Milliseconds”</a></p>
</li>
</ul>
</dd>
<dt class="pagebreak-before less_space">Logging</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/fMNT7">“Linux Logging Complete Guide”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/hnMGz">“Unix/Linux—System Logging”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/wzRqG">“syslog-ng” on ArchWiki</a></p>
</li>
<li>
<p><a href="https://oreil.ly/hJ3nr">fluentd website</a></p>
</li>
</ul>
</dd>
<dt>Monitoring</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/C4ZJX">“80+ Linux Monitoring Tools for SysAdmins”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/JaUEK">“Monitoring StatsD: Metric Types, Format and Code Examples”</a></p>
</li>
</ul>
</dd>
<dt>Advanced</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/EIPYd">“Linux Performance”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/SuGPM">“Linux Tracing Systems &amp; How They Fit Together”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/Sk0zL">“Profilerpedia: A Map of the Software Profiling Ecosystem”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/wHLqr">“On the State of Continuous Profiling”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/DFYMN">eBPF website</a></p>
</li>
<li>
<p><a href="https://oreil.ly/5fA6z">“Monitoring Linux Host Metrics with the Node Exporter”</a></p>
</li>
</ul>
</dd>
</dl>

<p>Having completed this chapter and those that preceded it, you now know the basics of Linux, from kernel to shell to filesystems
and networking. The last chapter of this book is a collection of advanced topics
that didn’t quite fit in other chapters. You may find them interesting and
useful, depending on your goals, but for most day-to-day tasks, you now
know everything you need to get by.<a data-type="indexterm" data-startref="ix_ch08-asciidoc0" id="idm45805425933040"/></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45805428798080"><sup><a href="ch08.xhtml#idm45805428798080-marker">1</a></sup> <em>Observability</em> is also sometimes referred to with the numeronym <em>o11y</em>, as there are 11 letters between the <em>o</em> and the <em>y</em>.</p></div></div></section></div></body></html>