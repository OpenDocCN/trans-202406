["```\n$ `kubectl` `describe` `clusterrole` `cluster-admin`\nName:         cluster-admin  ![1](assets/1.png)\nLabels:       kubernetes.io/bootstrapping=rbac-defaults\nPolicyRule:\n  Resources  Non-Resource URLs  Resource Names  Verbs\n  ---------  -----------------  --------------  -----\n  *.*        []                 []              [*]\n             [*]                []              [*]\n\n```", "```\n$ kubectl version\nClient Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\",\nGitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\",\nBuildDate:\"2019-10-15T19:18:23Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\",\nPlatform:\"darwin/amd64\"}\nServer Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.2\",\nGitCommit:\"c97fe5036ef3df2967d086711e6c0c405941e14b\", GitTreeState:\"clean\",\nBuildDate:\"2019-10-15T19:09:08Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\",\nPlatform:\"linux/amd64\"}\n\n```", "```\n$ `git` `clone` `https://github.com/kubernetes-operators-book/chapters.git`\n$ `cd` `chapters/ch03`\n\n```", "```\napiVersion: apiextensions.k8s.io/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: etcdclusters.etcd.database.coreos.com\nspec:\n  group: etcd.database.coreos.com\n  names:\n    kind: EtcdCluster\n    listKind: EtcdClusterList\n    plural: etcdclusters\n    shortNames:\n    - etcdclus\n    - etcd\n    singular: etcdcluster\n  scope: Namespaced\n  versions:\n  - name: v1beta2\n    served: true\n    storage: true\n```", "```\n$ `kubectl` `create` `-f` `etcd-operator-crd.yaml`\n\n```", "```\n$ `kubectl` `get` `crd`\nNAME                                    CREATED AT\netcdclusters.etcd.database.coreos.com   2019-11-15T02:50:14Z\n\n```", "```\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: etcd-operator-sa\n```", "```\n$ `kubectl` `create` `-f` `etcd-operator-sa.yaml`\nserviceaccount/etcd-operator-sa created\n\n```", "```\n$ kubectl get serviceaccounts\nNAME               SECRETS   AGE\nbuilder            2         2h\ndefault            3         2h\ndeployer           2         2h\netcd-operator-sa   `2`         3s\n[...]\n\n```", "```\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: etcd-operator-role\nrules:\n- apiGroups:\n  - etcd.database.coreos.com\n  resources:\n  - etcdclusters\n  - etcdbackups\n  - etcdrestores\n  verbs:\n  - '*'\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - services\n  - endpoints\n  - persistentvolumeclaims\n  - events\n  verbs:\n  - '*'\n- apiGroups:\n  - apps\n  resources:\n  - deployments\n  verbs:\n  - '*'\n- apiGroups:\n  - \"\"\n  resources:\n  - secrets\n  verbs:\n  - get\n```", "```\n$ `kubectl` `create` `-f` `etcd-operator-role.yaml`\nrole.rbac.authorization.k8s.io/etcd-operator-role created\n\n```", "```\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: etcd-operator-rolebinding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: etcd-operator-role\nsubjects:\n- kind: ServiceAccount\n  name: etcd-operator-sa\n  namespace: default\n```", "```\n$ `kubectl` `create` `-f` `etcd-operator-rolebinding.yaml`\nrolebinding.rbac.authorization.k8s.io/etcd-operator-rolebinding created\n\n```", "```\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  labels:\n    name: etcdoperator\n  name: etcd-operator\nspec:\n  replicas: 1\n  selector:\n      name: etcd-operator\n  template:\n        name: etcd-operator\n    spec:\n      containers:\n      - name: etcd-operator\n        image: quay.io/coreos/etcd-operator:v0.9.4\n        command:\n        - etcd-operator\n        - --create-crd=false\n        [...]\n        imagePullPolicy: IfNotPresent\n      serviceAccountName: etcd-operator-sa\n```", "```\n$ kubectl create -f etcd-operator-deployment.yaml\ndeployment.apps/etcd-operator created\n$ kubectl get deployments\nNAME            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\netcd-operator   1         1         1            1           19s\n\n```", "```\n$ kubectl get pods\nNAME                             READY     STATUS              RESTARTS   AGE\netcd-operator-594fbd565f-4fm8k   0/1       ContainerCreating   0          4s\n\n```", "```\napiVersion: etcd.database.coreos.com/v1beta2\nkind: EtcdCluster\nmetadata:\n  name: example-etcd-cluster\nspec:\n  size: 3\n  version: 3.1.10\n```", "```\n$ kubectl create -f etcd-cluster-cr.yaml\netcdcluster.etcd.database.coreos.com/example-etcd-cluster created\n$ kubectl get pods -w\nNAME                              READY   STATUS      RESTARTS   AGE\netcd-operator-594fbd565f-4fm8k    1/1     Running     0           3m\nexample-etcd-cluster-95gqrthjbz   1/1     Running     2           38s\nexample-etcd-cluster-m9ftnsk572   1/1     Running     0           34s\nexample-etcd-cluster-pjqhm8d4qj   1/1     Running     0           31s\n\n```", "```\n$ `kubectl` `describe` `etcdcluster/example-etcd-cluster`\nName:         example-etcd-cluster\nNamespace:    default\nAPI Version:  etcd.database.coreos.com/v1beta2\nKind:         EtcdCluster\n[...]\nSpec:\n  Repository:  quay.io/coreos/etcd\n  Size:        3\n  Version:     3.1.10\nStatus:\n  Client Port:  2379\n  Conditions:\n    Last Transition Time:  2019-11-15T02:52:04Z\n    Reason:                Cluster available\n    Status:                True\n    Type:                  Available\n  Current Version:         3.1.10\n  Members:\n    Ready:\n      example-etcd-cluster-6pq7qn82g2\n      example-etcd-cluster-dbwt7kr8lw\n      example-etcd-cluster-t85hs2hwzb\n  Phase:           Running\n  Service Name:    example-etcd-cluster-client\n\n```", "```\n$ `kubectl` `get` `services` `--selector` `etcd_cluster``=``example-etcd-cluster`\nNAME                         TYPE       CLUSTER-IP    ... PORT(S)            AGE\nexample-etcd-cluster         ClusterIP  None          ... 2379/TCP,2380/TCP  21h\nexample-etcd-cluster-client  ClusterIP  10.96.46.231  ... 2379/TCP           21h\n\n```", "```\n$ `kubectl` `run` `--rm` `-i` `--tty` `etcdctl` `--image` `quay.io/coreos/etcd` \\\n  `--restart``=``Never` `--` `/bin/sh`\n\n```", "```\n$ `export` `ETCDCTL_API``=``3`\n$ `export` `ETCDCSVC``=``http://example-etcd-cluster-client:2379`\n$ `etcdctl` `--endpoints` `$ETCDCSVC` `put` `foo` `bar`\n$ `etcdctl` `--endpoints` `$ETCDCSVC` `get` `foo`\nfoo\nbar\n\n```", "```\n$ kubectl apply -f etcd-cluster-cr.yaml\n\n```", "```\n$ kubectl get pods\nNAME                              READY   STATUS      RESTARTS   AGE\netcd-operator-594fbd565f-4fm8k    1/1     Running     1          16m\nexample-etcd-cluster-95gqrthjbz   1/1     Running     2          15m\nexample-etcd-cluster-m9ftnsk572   1/1     Running     0           15m\nexample-etcd-cluster-pjqhm8d4qj   1/1     Running     0           15m\nexample-etcd-cluster-w5l67llqq8   0/1     Init:0/1    0           3s\n\n```", "```\n$ kubectl delete pod example-etcd-cluster-95gqrthjbz\npod \"example-etcd-cluster-95gqrthjbz\" deleted\n\n```", "```\n$ kubectl get pods -w\nNAME                              READY   STATUS            RESTARTS   AGE\netcd-operator-594fbd565f-4fm8k    1/1     Running           1         18m\nexample-etcd-cluster-m9ftnsk572   1/1     Running           0         17m\nexample-etcd-cluster-pjqhm8d4qj   1/1     Running           0         17m\nexample-etcd-cluster-r6cb8g2qqw   0/1     PodInitializing   0         31s\n\n```", "```\n$ `kubectl` `describe` `etcdcluster/example-etcd-cluster`\n[...]\nEvents:\n  Normal  Replacing Dead Member  4m    etcd-operator-589c65bd9f-hpkc6\n    The dead member example-etcd-cluster-95gqrthjbz is being replaced\n  Normal  Member Removed         4m    etcd-operator-589c65bd9f-hpkc6\n    Existing member example-etcd-cluster-95gqrthjbz removed from the cluster\n[...]\n\n```", "```\n$ kubectl run --rm -i --tty etcdctl --image quay.io/coreos/etcd \\\n  --restart=Never -- /bin/sh\nIf you don't see a command prompt, try pressing enter.\n$ etcdctl --endpoints http://example-etcd-cluster-client:2379 cluster-health\nmember 5ee0dd47065a4f55 is healthy: got healthy result ...\nmember 70baca4290889c4a is healthy: got healthy result ...\nmember 76cd6c58798a7a4b is healthy: got healthy result ...\ncluster is healthy\n$ exit\npod \"etcdctl\" deleted\n\n```", "```\n$ kubectl get pod example-etcd-cluster-795649v9kq `\\`\n  -o yaml | grep `\"image:\"` | uniq\nimage: quay.io/coreos/etcd:v3.1.10\nimage: busybox:1.28.0-glibc\n\n```", "```\n$ `kubectl` `describe` `etcdcluster/example-etcd-cluster`\n\n```", "```\n$ `kubectl` `apply` `-f` `etcd-cluster-cr.yaml`\n\n```", "```\n$ `kubectl` `describe` `etcdcluster/example-etcd-cluster`\nName:         example-etcd-cluster\nNamespace:    default\nAPI Version:  etcd.database.coreos.com/v1beta2\nKind:         EtcdCluster\n[...]\nStatus:\n  Conditions:\n    [...]\n    Message:               upgrading to 3.2.13\n    Reason:                Cluster upgrading\n    Status:                True\n    Type:                  Upgrading\n  Current Version:         3.1.10\n  [...]\n  Size:            3\n  Target Version:  3.2.13\nEvents:\n  Type    Reason           Age  From                           ...\n  ----    ------           ---  ----                           ---\n  Normal  Member Upgraded  3s   etcd-operator-594fbd565f-4fm8k ...\n  Normal  Member Upgraded  5s   etcd-operator-594fbd565f-4fm8k ...\n\n```", "```\n$ kubectl patch etcdcluster example-etcd-cluster --type='json' \\\n  -p `'[{\"op\": \"replace\", \"path\": \"/spec/version\", \"value\":3.3.12}]'`\n\n```", "```\n  Normal  Member Upgraded   1m    etcd-operator-594fbd565f-4fm8k\n    Member example-etcd-cluster-pjqhm8d4qj upgraded from 3.1.10 to 3.2.23\n  Normal  Member Upgraded   27s   etcd-operator-594fbd565f-4fm8k\n    Member example-etcd-cluster-r6cb8g2qqw upgraded from 3.2.23 to 3.3.12\n```", "```\n$ kubectl delete -f etcd-operator-sa.yaml\n$ kubectl delete -f etcd-operator-role.yaml\n$ kubectl delete -f etcd-operator-rolebinding.yaml\n$ kubectl delete -f etcd-operator-crd.yaml\n$ kubectl delete -f etcd-operator-deployment.yaml\n$ kubectl delete -f etcd-cluster-cr.yaml\nserviceaccount \"etcd-operator-sa\" deleted\nrole.rbac.authorization.k8s.io \"etcd-operator-role\" deleted\nrolebinding.rbac.authorization.k8s.io \"etcd-operator-rolebinding\" deleted\ncustomresourcedefinition.apiextensions.k8s.io \\\n  \"etcdclusters.etcd.database.coreos.com\" deleted\ndeployment.apps \"etcd-operator\" deleted\netcdcluster.etcd.database.coreos.com \"example-etcd-cluster\" deleted\n\n```"]