<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. Asynchronous Programming Patterns"><div class="chapter" id="asynchronous-programming-patterns">
<h1><span class="label">Chapter 9. </span>Asynchronous Programming Patterns</h1>


<p>Asynchronous JavaScript programming<a data-type="indexterm" data-primary="asynchronous programming patterns" data-secondary="async programming" data-tertiary="about" id="idm45017698548352"/><a data-type="indexterm" data-primary="background tasks" data-seealso="asynchronous programming patterns" id="idm45017698547040"/><a data-type="indexterm" data-primary="browsers" data-secondary="background tasks" data-seealso="asynchronous programming patterns" id="idm45017698546080"/> allows you to execute long-running tasks in the background while allowing the browser to respond to events and run other code to handle these events. <a data-type="indexterm" data-primary="JavaScript" data-secondary="modern syntax and features" data-tertiary="asynchronous programming" id="idm45017698544560"/>Asynchronous programming is relatively new in JavaScript, and the syntax to support it was not available when the first edition of this book was published.</p>

<p>JavaScript concepts such as <code>promise</code>, <code>async</code>, and <code>await</code> <a data-type="indexterm" data-primary="Promise patterns" data-secondary="about promises" id="idm45017698541136"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="asynchronous action" id="idm45017698540128"/><a data-type="indexterm" data-primary="await" data-secondary="asynchronous action" id="idm45017698539184"/>make your code tidier and easy to read without blocking the main thread. <code>async</code> functions were introduced as part of ES7 in 2016 and are now supported on all browsers. Let’s look at some patterns that use these features to structure our application flows.</p>






<section data-type="sect1" data-pdf-bookmark="Asynchronous Programming"><div class="sect1" id="async-programming">
<h1>Asynchronous Programming</h1>

<p>In JavaScript, synchronous code is executed<a data-type="indexterm" data-primary="asynchronous programming patterns" data-secondary="async programming" id="ch09-async"/><a data-type="indexterm" data-primary="JavaScript" data-secondary="blocking versus nonblocking code" id="idm45017698534176"/> in a blocking manner, meaning that the code is executed serially, one statement at a time. The following code can run only after the execution of the current statement has been completed. <a data-type="indexterm" data-primary="synchronous functions" id="idm45017698533088"/>When you call a synchronous function, the code inside that function will execute from start to finish before the control returns to the caller.</p>

<p>On the other hand, asynchronous code is executed in a nonblocking manner, meaning that the JavaScript engine can switch to execute this code in the background while the currently running code is waiting on something. When you call an asynchronous function, the code inside the function will execute in the background, and the control returns to the caller immediately.</p>

<p class="pagebreak-before">Here is an example of synchronous code in JavaScript:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">synchronousFunction</code><code class="p">()</code> <code class="p">{</code>
  <code class="c1">// do something</code>
<code class="p">}</code>

<code class="nx">synchronousFunction</code><code class="p">();</code>
<code class="c1">// the code inside the function is executed before this line</code></pre>

<p>And here is an example of asynchronous code in JavaScript:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">asynchronousFunction</code><code class="p">()</code> <code class="p">{</code>
  <code class="c1">// do something</code>
<code class="p">}</code>

<code class="nx">asynchronousFunction</code><code class="p">();</code>
<code class="c1">// the code inside the function is executed in the background</code>
<code class="c1">// while control returns to this line</code></pre>

<p>You can generally use asynchronous code to perform long-running operations without blocking the rest of your code. Asynchronous code is suitable when making network requests, reading or writing to a database, or doing any other type of I/O (input/output) operation.</p>

<p>Language features such<a data-type="indexterm" data-primary="async/await patterns" data-secondary="asynchronous action" id="idm45017698478784"/><a data-type="indexterm" data-primary="await" data-secondary="asynchronous action" data-seealso="async/await patterns" id="idm45017698477904"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary="about promises" id="idm45017698476688"/> as <code>async</code>, <code>await</code>, and <code>promise</code> make writing asynchronous code in JavaScript easier. They allow you to write asynchronous code in a way that looks and behaves like synchronous code, making it easier to read and understand.</p>

<p>Let’s briefly look at the differences between callbacks, promises, and <code>async</code>/<code>await</code> before diving into each in more depth:<a data-type="indexterm" data-primary="callbacks" id="idm45017698473152"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="c1">// using callbacks</code>
<code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">callback</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">callback</code><code class="p">(</code><code class="kc">null</code><code class="p">,</code> <code class="nx">data</code><code class="p">))</code>
    <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">callback</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">});</code></pre>

<p>In the first example, the <code>makeRequest</code> function uses a callback to return the result of the network request. <a data-type="indexterm" data-primary="then and catch" data-secondary="callbacks" id="idm45017698443296"/>The caller passes a <code>callback</code> function to <code>makeRequest</code>, which is called back with either the result(<code>data</code>) or an <code>error</code>:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="c1">// using promises</code>
<code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">resolve</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
      <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
  <code class="p">});</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>

<p>In the second example, the <code>makeRequest</code> function<a data-type="indexterm" data-primary="then and catch" data-secondary="promises" id="idm45017698320320"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary="error handling" id="idm45017698229296"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary="promises versus callbacks versus async" id="idm45017698228352"/> returns a <code>promise</code> that resolves with the result of the network request or rejects with an error. The caller can use the <code>then</code> and <code>catch</code> methods on the returned promise to handle the result of the request:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="c1">// using async/await</code>
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code></pre>

<p>In the third example, the <code>makeRequest</code> function<a data-type="indexterm" data-primary="async/await patterns" data-secondary="promises and callbacks versus" id="idm45017698158928"/> is declared with the <code>async</code> keyword, which allows it to use the <code>await</code> keyword to wait for the result of the network request. <a data-type="indexterm" data-primary="try and catch in async function" id="idm45017698157120"/>The caller can use the <code>try</code> and <code>catch</code> keywords to handle any errors that may occur during the execution of the function.<a data-type="indexterm" data-startref="ch09-async" id="idm45017698155456"/></p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Background"><div class="sect1" id="background">
<h1>Background</h1>

<p>Callback functions in JavaScript can be passed<a data-type="indexterm" data-primary="callbacks" data-secondary="“callback hell”" data-secondary-sortas="callback hell" id="idm45017698152816"/> to another function as an argument and executed after some asynchronous operation is completed. Callbacks were commonly used to handle the results of asynchronous operations, such as network requests or user input.</p>

<p>One of the main disadvantages of using callbacks is that they can lead to what is known as “callback hell”—a situation where nested callbacks become challenging to read and maintain. Consider the following example:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeRequest1</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">callback</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// make network request</code>
  <code class="nx">callback</code><code class="p">(</code><code class="kc">null</code><code class="p">,</code> <code class="nx">response</code><code class="p">);</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">makeRequest2</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">callback</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// make network request</code>
  <code class="nx">callback</code><code class="p">(</code><code class="kc">null</code><code class="p">,</code> <code class="nx">response</code><code class="p">);</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">makeRequest3</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">callback</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// make network request</code>
  <code class="nx">callback</code><code class="p">(</code><code class="kc">null</code><code class="p">,</code> <code class="nx">response</code><code class="p">);</code>
<code class="p">}</code>

<code class="nx">makeRequest1</code><code class="p">(</code><code class="s1">'http://example.com/1'</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">data1</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
    <code class="k">return</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nx">makeRequest2</code><code class="p">(</code><code class="s1">'http://example.com/2'</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">data2</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
      <code class="k">return</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="nx">makeRequest3</code><code class="p">(</code><code class="s1">'http://example.com/3'</code><code class="p">,</code> <code class="p">(</code><code class="nx">error</code><code class="p">,</code> <code class="nx">data3</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
        <code class="k">return</code><code class="p">;</code>
      <code class="p">}</code>

      <code class="c1">// do something with data1, data2, data3</code>
    <code class="p">});</code>
  <code class="p">});</code>
<code class="p">});</code></pre>

<p>In this example, the <code>makeRequest1</code> function makes a network request and then calls the <code>callback</code> function with the result of the request. The <code>callback</code> function then makes a second network request using the <code>makeRequest2</code> function, which calls another <code>callback</code> function with its result. This pattern continues for the third network request.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Promise Patterns"><div class="sect1" id="promise-patterns">
<h1>Promise Patterns</h1>

<p>Promises are a more modern approach<a data-type="indexterm" data-primary="Promise patterns" id="ch09-prom"/><a data-type="indexterm" data-primary="asynchronous programming patterns" data-secondary="Promise patterns" id="ch09-prom2"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary="about promises" id="idm45017698029472"/><a data-type="indexterm" data-primary="asynchronous programming patterns" data-secondary="async programming" data-tertiary="promise as result" id="idm45017698028528"/> to handling asynchronous operations in JavaScript. A promise is an object that represents the result of an asynchronous operation. It can be in three states: pending, fulfilled, or rejected. A promise is like a contract that can be settled if it is fulfilled or rejected.</p>

<p>You can create a promise using<a data-type="indexterm" data-primary="Promise patterns" data-secondary="Promise constructor" id="idm45017698026608"/> the <code>Promise</code> constructor, which takes a function as an argument. The function receives two arguments: <code>resolve</code> and <code>reject</code>. The <code>resolve</code> function is called when the asynchronous operation is completed successfully, and the <code>reject</code> function is called if the operation fails.</p>

<p>Here is an example that shows how you can use promises to make network requests:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="network request example" id="idm45017697911088"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">resolve</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
      <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
  <code class="p">});</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>

<p>In this example, the <code>makeRequest</code> function returns a <code>promise</code> representing the network request’s result.  The <code>fetch</code> method is used inside the function to make the HTTP request. If the request succeeds, the promise is fulfilled with the data from the response. If it fails, the promise is rejected with the error. The caller can use the <code>then</code> and <code>catch</code> methods on the returned promise to handle the result of the request.</p>

<p>One of the main advantages of using promises over callbacks is that they provide a more structured and readable approach to handling asynchronous operations. This allows you to avoid “callback hell” and write code that is easier to understand and maintain.</p>

<p>The following sections provide additional examples that will be relevant to help you understand the different promise design patterns that you can use in JavaScript.</p>








<section data-type="sect2" data-pdf-bookmark="Promise Chaining"><div class="sect2" id="idm45017697815360">
<h2>Promise Chaining</h2>

<p>This pattern allows you to chain multiple promises together to create more complex <code>async</code> logic:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="promise chaining" id="idm45017697813616"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">resolve</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
      <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
  <code class="p">});</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">processData</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// process data</code>
  <code class="k">return</code> <code class="nx">processedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">processData</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">processedData</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">processedData</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Error Handling"><div class="sect2" id="idm45017697770864">
<h2>Promise Error Handling</h2>

<p>This pattern uses the <code>catch</code> method to handle errors that may occur during the execution of a promise chain:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="error handling" id="idm45017697665232"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">processData</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">processedData</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">processedData</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Parallelism"><div class="sect2" id="idm45017697637200">
<h2>Promise Parallelism</h2>

<p>This pattern allows you to run multiple promises concurrently using the <code>Promise.all</code> method:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="parallelism" id="idm45017697595840"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary=".all method" data-secondary-sortas="all" id="idm45017697582128"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">([</code>
  <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/1'</code><code class="p">),</code>
  <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/2'</code><code class="p">)</code>
<code class="p">]).</code><code class="nx">then</code><code class="p">(([</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">);</code>
<code class="p">});</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Sequential Execution"><div class="sect2" id="idm45017697512720">
<h2>Promise Sequential Execution</h2>

<p>This pattern allows you to run promises in sequence using the <code>Promise.resolve</code> method:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="sequential execution of" id="idm45017697549888"/><a data-type="indexterm" data-primary="Promise patterns" data-secondary=".resolve method" data-secondary-sortas="resolve" id="idm45017697548912"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nb">Promise</code><code class="p">.</code><code class="nx">resolve</code><code class="p">()</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">makeRequest1</code><code class="p">())</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">makeRequest2</code><code class="p">())</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">makeRequest3</code><code class="p">())</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="c1">// all requests completed</code>
  <code class="p">});</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Memoization"><div class="sect2" id="idm45017697534112">
<h2>Promise Memoization</h2>

<p>This pattern uses a cache to store the results of promise function calls, allowing you to avoid making duplicate<a data-type="indexterm" data-primary="Promise patterns" data-secondary="memoization" id="idm45017697485776"/><a data-type="indexterm" data-primary="memoization" data-secondary="promises" id="idm45017697484800"/> requests:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>

<code class="kd">function</code> <code class="nx">memoizedMakeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">cache</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="nx">url</code><code class="p">))</code> <code class="p">{</code>
    <code class="k">return</code> <code class="nx">cache</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="k">return</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="nx">cache</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">data</code><code class="p">);</code>
        <code class="nx">resolve</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
      <code class="p">})</code>
      <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
  <code class="p">});</code>
<code class="p">}</code></pre>

<p>In this example, we’ll demonstrate how to use the <code>memoizedMakeRequest</code> function to avoid making duplicate requests:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">button</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'button'</code><code class="p">);</code>
<code class="nx">button</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">memoizedMakeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
    <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
<code class="p">});</code></pre>

<p>Now, when the button is clicked, the <code>memoizedMakeRequest</code> function will be called. If the requested URL is already in the cache, the cached data will be returned. Otherwise, a new request will be made, and the result will be cached for future requests.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Pipeline"><div class="sect2" id="idm45017697286944">
<h2>Promise Pipeline</h2>

<p>This pattern uses promises and functional programming techniques to create a pipeline of <code>async</code> transformations:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="pipeline of async transformations" id="idm45017697285216"/><a data-type="indexterm" data-primary="pipelines" data-secondary="promise pipeline" id="idm45017697284240"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">transform1</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// transform data</code>
  <code class="k">return</code> <code class="nx">transformedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">transform2</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// transform data</code>
  <code class="k">return</code> <code class="nx">transformedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">pipeline</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">transform1</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">transform2</code><code class="p">))</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">transformedData</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">transformedData</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Retry"><div class="sect2" id="idm45017697157168">
<h2>Promise Retry</h2>

<p>This pattern allows you to retry a promise if it fails:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="retrying on failure" id="idm45017697165872"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">makeRequestWithRetry</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">attempts</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

  <code class="kr">const</code> <code class="nx">makeRequest</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">((</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">reject</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">resolve</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
      <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">reject</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code>
  <code class="p">});</code>

  <code class="kr">const</code> <code class="nx">retry</code> <code class="o">=</code> <code class="nx">error</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">attempts</code><code class="o">++</code><code class="p">;</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">attempts</code> <code class="o">&gt;=</code> <code class="mi">3</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Request failed after 3 attempts.'</code><code class="p">);</code>
    <code class="p">}</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Retrying request: attempt </code><code class="si">${</code><code class="nx">attempts</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
    <code class="k">return</code> <code class="nx">makeRequest</code><code class="p">();</code>
  <code class="p">};</code>

  <code class="k">return</code> <code class="nx">makeRequest</code><code class="p">().</code><code class="k">catch</code><code class="p">(</code><code class="nx">retry</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Promise Decorator"><div class="sect2" id="idm45017697135776">
<h2>Promise Decorator</h2>

<p>This pattern uses a higher-order function to create a decorator that can be applied to promises to add additional behavior:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="decorator applied to promises" id="idm45017697013104"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">logger</code><code class="p">(</code><code class="nx">fn</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="kd">function</code> <code class="p">(...</code><code class="nx">args</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Starting function...'</code><code class="p">);</code>
    <code class="k">return</code> <code class="nx">fn</code><code class="p">(...</code><code class="nx">args</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">result</code> <code class="o">=&gt;</code> <code class="p">{</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Function completed.'</code><code class="p">);</code>
      <code class="k">return</code> <code class="nx">result</code><code class="p">;</code>
    <code class="p">});</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">makeRequestWithLogger</code> <code class="o">=</code> <code class="nx">logger</code><code class="p">(</code><code class="nx">makeRequest</code><code class="p">);</code>

<code class="nx">makeRequestWithLogger</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)</code>
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">))</code>
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">));</code></pre>
</div></section>








<section data-type="sect2" class="pagebreak-before less_space" data-pdf-bookmark="Promise Race"><div class="sect2" id="idm45017696892464">
<h2>Promise Race</h2>

<p>This pattern allows you to run multiple promises concurrently and return the result of the first one to settle:<a data-type="indexterm" data-primary="Promise patterns" data-secondary="race between two" id="idm45017696936784"/><a data-type="indexterm" data-startref="ch09-prom" id="idm45017696935808"/><a data-type="indexterm" data-startref="ch09-prom2" id="idm45017696935136"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nb">Promise</code><code class="p">.</code><code class="nx">race</code><code class="p">([</code>
  <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/1'</code><code class="p">),</code>
  <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/2'</code><code class="p">)</code>
<code class="p">]).</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
<code class="p">});</code></pre>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="async/await Patterns"><div class="sect1" id="async-await-patterns">
<h1>async/await Patterns</h1>

<p><code>async</code>/<code>await</code> is a language feature<a data-type="indexterm" data-primary="async/await patterns" id="ch09-aa"/><a data-type="indexterm" data-primary="asynchronous programming patterns" data-secondary="async/await patterns" id="ch09-aa2"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="about async/await" id="idm45017696833904"/> that allows a programmer to write asynchronous code as if it were synchronous. It is built on top of promises, and it makes working with asynchronous code easier and cleaner.</p>

<p>Here is an example of how you might use <code>async</code>/<code>await</code> to make an asynchronous HTTP request:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>In this example, the <code>makeRequest</code> function is asynchronous<a data-type="indexterm" data-primary="async/await patterns" data-secondary="async keyword" id="idm45017696768832"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="await keyword" id="idm45017696767952"/><a data-type="indexterm" data-primary="await" id="idm45017696767008"/> because it uses the <code>async</code> keyword. Inside the function, the <code>await</code> keyword is used to pause the execution of the function until the <code>fetch</code> call resolves. If the call succeeds, the data is logged to the console. If it fails, the error is caught and logged to the console.</p>

<p>Let us now look at some other patterns using <code>async</code>.</p>








<section data-type="sect2" data-pdf-bookmark="async Function Composition"><div class="sect2" id="idm45017696764128">
<h2>async Function Composition</h2>

<p>This pattern involves composing multiple <code>async</code> functions together to create more complex <code>async</code> logic:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="async function composition" id="idm45017696730096"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
  <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
<code class="p">}</code>


<code class="nx">async</code> <code class="kd">function</code> <code class="nx">processData</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// process data</code>
  <code class="k">return</code> <code class="nx">processedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">processedData</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">processData</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">processedData</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Iteration"><div class="sect2" id="idm45017696700480">
<h2>async Iteration</h2>

<p>This pattern allows you to use the <code>for-await-of</code> loop to iterate <a data-type="indexterm" data-primary="async/await patterns" data-secondary="async iteration" id="idm45017696671120"/><a data-type="indexterm" data-primary="iterating over an async iterable" id="idm45017696670112"/>over an <code>async</code> 
<span class="keep-together">iterable:</span></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code><code class="o">*</code> <code class="nx">createAsyncIterable</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">yield</code> <code class="mi">1</code><code class="p">;</code>
  <code class="k">yield</code> <code class="mi">2</code><code class="p">;</code>
  <code class="k">yield</code> <code class="mi">3</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">for</code> <code class="nx">await</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">value</code> <code class="k">of</code> <code class="nx">createAsyncIterable</code><code class="p">())</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">value</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Error Handling"><div class="sect2" id="idm45017696592720">
<h2>async Error Handling</h2>

<p>This pattern uses <code>try-catch</code> blocks to handle errors that may occur during the execution of an <code>async</code> function:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="error handling" id="idm45017696552672"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Parallelism"><div class="sect2" id="idm45017696496496">
<h2>async Parallelism</h2>

<p>This pattern allows you to run multiple <code>async</code> tasks concurrently using the <code>Promise.all</code> method:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="parallelism" id="idm45017696514800"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">]</code> <code class="o">=</code> <code class="nx">await</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">([</code>
    <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/1'</code><code class="p">),</code>
    <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/2'</code><code class="p">)</code>
  <code class="p">]);</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Sequential Execution"><div class="sect2" id="idm45017696513024">
<h2>async Sequential Execution</h2>

<p>This pattern allows you to run <code>async</code> tasks in sequence using the <code>Promise.resolve</code> method:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="sequential execution" id="idm45017696451600"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">resolve</code><code class="p">();</code>

  <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest1</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>
  <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest2</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>
  <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest3</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Memoization"><div class="sect2" id="idm45017696409088">
<h2>async Memoization</h2>

<p>This pattern uses a cache to store the results of <code>async</code> function calls, allowing you to avoid making duplicate requests:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="memoization" id="idm45017696385792"/><a data-type="indexterm" data-primary="memoization" data-secondary="async" id="idm45017696384816"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">memoizedMakeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">cache</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="nx">url</code><code class="p">))</code> <code class="p">{</code>
    <code class="k">return</code> <code class="nx">cache</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>

  <code class="nx">cache</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">data</code><code class="p">);</code>
  <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Event Handling"><div class="sect2" id="idm45017696310048">
<h2>async Event Handling</h2>

<p>This pattern allows you to use <code>async</code> functions to handle events:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="event handling" id="idm45017696286720"/><a data-type="indexterm" data-primary="events" data-secondary="async event handling" id="idm45017696285744"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="event handling" id="idm45017696284800"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">button</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'button'</code><code class="p">);</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">handleClick</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">response</code><code class="p">);</code>
<code class="p">}</code>

<code class="nx">button</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">handleClick</code><code class="p">);</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async/await Pipeline"><div class="sect2" id="idm45017696164240">
<h2>async/await Pipeline</h2>

<p>This pattern uses <code>async</code>/<code>await</code> and functional programming techniques to create a pipeline of <code>async</code> transformations:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="pipeline" id="idm45017696214736"/><a data-type="indexterm" data-primary="pipelines" data-secondary="async pipeline" id="idm45017696213728"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">transform1</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// transform data</code>
  <code class="k">return</code> <code class="nx">transformedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">transform2</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="c1">// transform data</code>
  <code class="k">return</code> <code class="nx">transformedData</code><code class="p">;</code>
<code class="p">}</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">transformedData</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">pipeline</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">transform1</code><code class="p">)</code>
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">transform2</code><code class="p">);</code>

  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">transformedData</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async Retry"><div class="sect2" id="idm45017696161936">
<h2>async Retry</h2>

<p>This pattern allows you to retry an <code>async</code> operation if it fails:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="retry on failure" id="idm45017696117248"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="retry on failure" id="idm45017696116240"/></p>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequestWithRetry</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">attempts</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

  <code class="k">while</code> <code class="p">(</code><code class="nx">attempts</code> <code class="o">&lt;</code> <code class="mi">3</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">try</code> <code class="p">{</code>
      <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
      <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
      <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">attempts</code><code class="o">++</code><code class="p">;</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Retrying request: attempt </code><code class="si">${</code><code class="nx">attempts</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s1">'Request failed after 3 attempts.'</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="async/await Decorator"><div class="sect2" id="idm45017696010976">
<h2>async/await Decorator</h2>

<p>This pattern uses a higher-order function to create a decorator that can be applied to <code>async</code> functions to add additional behavior:<a data-type="indexterm" data-primary="async/await patterns" data-secondary="decorator" id="idm45017696016624"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="decorator" id="idm45017696015648"/></p>

<pre data-type="programlisting" data-code-language="javascript" class="pagebreak-before"><code class="kd">function</code> <code class="nx">asyncLogger</code><code class="p">(</code><code class="nx">fn</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">async</code> <code class="kd">function</code> <code class="p">(...</code><code class="nx">args</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Starting async function...'</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fn</code><code class="p">(...</code><code class="nx">args</code><code class="p">);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Async function completed.'</code><code class="p">);</code>
    <code class="k">return</code> <code class="nx">result</code><code class="p">;</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="err">@</code><code class="nx">asyncLogger</code>
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
<code class="p">}</code></pre>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Additional Practical Examples"><div class="sect1" id="additional-practical-examples">
<h1>Additional Practical Examples</h1>

<p>In addition to the patterns discussed in the previous sections, let’s take a look at some practical examples of using <code>async</code>/<code>await</code> in JavaScript.<a data-type="indexterm" data-startref="ch09-aa" id="idm45017695897584"/><a data-type="indexterm" data-startref="ch09-aa2" id="idm45017695896848"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="HTTP request" id="idm45017695896176"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="reading file from filesystem" id="idm45017695894960"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="writing file to filesystem" id="idm45017695893776"/><a data-type="indexterm" data-primary="HTTP request with async/await" id="idm45017695844560"/><a data-type="indexterm" data-primary="reading file from filesystem with async/await" id="idm45017695843952"/><a data-type="indexterm" data-primary="writing file to filesystem with async/await" id="idm45017695843344"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="multiple async executions" id="idm45017695842736"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="multiple async executions in sequence" id="idm45017695841648"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="catching the result" id="idm45017695840560"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="event handling" id="idm45017695839472"/><a data-type="indexterm" data-primary="events" data-secondary="async event handling" id="idm45017695838384"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="retry on failure" id="idm45017695837440"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="retry on failure" id="idm45017695836496"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="decorator" id="idm45017695835280"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="practical examples" data-tertiary="decorator" id="idm45017695834336"/><a data-type="indexterm" data-primary="async/await patterns" data-secondary="event handling" id="idm45017695833120"/></p>








<section data-type="sect2" data-pdf-bookmark="Making an HTTP Request"><div class="sect2" id="idm45017695898496">
<h2>Making an HTTP Request</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Reading a File from the Filesystem"><div class="sect2" id="idm45017695769424">
<h2>Reading a File from the Filesystem</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">readFile</code><code class="p">(</code><code class="nx">filePath</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">fileData</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fs</code><code class="p">.</code><code class="nx">promises</code><code class="p">.</code><code class="nx">readFile</code><code class="p">(</code><code class="nx">filePath</code><code class="p">);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">fileData</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Writing to a File on the Filesystem"><div class="sect2" id="idm45017695736208">
<h2>Writing to a File on the Filesystem</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">writeFile</code><code class="p">(</code><code class="nx">filePath</code><code class="p">,</code> <code class="nx">data</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="nx">await</code> <code class="nx">fs</code><code class="p">.</code><code class="nx">promises</code><code class="p">.</code><code class="nx">writeFile</code><code class="p">(</code><code class="nx">filePath</code><code class="p">,</code> <code class="nx">data</code><code class="p">);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'File written successfully.'</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Executing Multiple async Operations"><div class="sect2" id="idm45017695673632">
<h2>Executing Multiple async Operations</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="p">[</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">]</code> <code class="o">=</code> <code class="nx">await</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">([</code>
      <code class="nx">makeRequest1</code><code class="p">(),</code>
      <code class="nx">makeRequest2</code><code class="p">()</code>
    <code class="p">]);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Executing Multiple async Operations in Sequence"><div class="sect2" id="idm45017695549952">
<h2>Executing Multiple async Operations in Sequence</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">main</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">data1</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest1</code><code class="p">();</code>
    <code class="kr">const</code> <code class="nx">data2</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest2</code><code class="p">();</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data1</code><code class="p">,</code> <code class="nx">data2</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Caching the Result of an async Operation"><div class="sect2" id="idm45017695519376">
<h2>Caching the Result of an async Operation</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Map</code><code class="p">();</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">cache</code><code class="p">.</code><code class="nx">has</code><code class="p">(</code><code class="nx">url</code><code class="p">))</code> <code class="p">{</code>
    <code class="k">return</code> <code class="nx">cache</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
    <code class="nx">cache</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="nx">data</code><code class="p">);</code>
    <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="nx">error</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Handling Events with async/await"><div class="sect2" id="idm45017695446288">
<h2>Handling Events with async/await</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="kr">const</code> <code class="nx">button</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'button'</code><code class="p">);</code>

<code class="nx">button</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">);</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">});</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Retrying an async Operation on Failure"><div class="sect2" id="idm45017695312640">
<h2>Retrying an async Operation on Failure</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">try</code> <code class="p">{</code>
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
    <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="nx">error</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="nx">async</code> <code class="kd">function</code> <code class="nx">retry</code><code class="p">(</code><code class="nx">fn</code><code class="p">,</code> <code class="nx">maxRetries</code> <code class="o">=</code> <code class="mi">3</code><code class="p">,</code> <code class="nx">retryDelay</code> <code class="o">=</code> <code class="mi">1000</code><code class="p">)</code> <code class="p">{</code>
  <code class="kd">let</code> <code class="nx">retries</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>

  <code class="k">while</code> <code class="p">(</code><code class="nx">retries</code> <code class="o">&lt;=</code> <code class="nx">maxRetries</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">try</code> <code class="p">{</code>
      <code class="k">return</code> <code class="nx">await</code> <code class="nx">fn</code><code class="p">();</code>
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="nx">retries</code><code class="o">++</code><code class="p">;</code>
      <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>
      <code class="nx">await</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">(</code><code class="nx">resolve</code> <code class="o">=&gt;</code> <code class="nx">setTimeout</code><code class="p">(</code><code class="nx">resolve</code><code class="p">,</code> <code class="nx">retryDelay</code><code class="p">));</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="sb">`Failed after </code><code class="si">${</code><code class="nx">retries</code><code class="si">}</code><code class="sb"> retries.`</code><code class="p">);</code>
<code class="p">}</code>

<code class="nx">retry</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">)).</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
<code class="p">});</code></pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Creating an async/await Decorator"><div class="sect2" id="idm45017695241568">
<h2>Creating an async/await Decorator</h2>

<pre data-type="programlisting" data-code-language="javascript"><code class="kd">function</code> <code class="nx">asyncDecorator</code><code class="p">(</code><code class="nx">fn</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">async</code> <code class="kd">function</code><code class="p">(...</code><code class="nx">args</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">try</code> <code class="p">{</code>
      <code class="k">return</code> <code class="nx">await</code> <code class="nx">fn</code><code class="p">(...</code><code class="nx">args</code><code class="p">);</code>
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">throw</code> <code class="nx">error</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">};</code>
<code class="p">}</code>
<code class="kr">const</code> <code class="nx">makeRequest</code> <code class="o">=</code> <code class="nx">asyncDecorator</code><code class="p">(</code><code class="nx">async</code> <code class="kd">function</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>
  <code class="k">return</code> <code class="nx">data</code><code class="p">;</code>
<code class="p">});</code>

<code class="nx">makeRequest</code><code class="p">(</code><code class="s1">'http://example.com/'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>
<code class="p">});</code></pre>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="ch09_conclusion">
<h1>Summary</h1>

<p>This chapter covered an extensive set of patterns and examples that can be useful when writing asynchronous code for executing long-running tasks in the background. We saw how <code>callback</code> functions made way for promises and <code>async</code>/<code>await</code> to execute one or many <code>async</code> tasks.</p>

<p>In the next chapter, we will look at another angle of application architecture patterns. We will look at how the patterns for modular development have evolved over time.</p>
</div></section>
</div></section></div></body></html>