<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:epub="http://www.idpf.org/2007/ops" lang="en" xml:lang="en" xsi:schemaLocation="http://www.w3.org/2002/06/xhtml2/ http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd">
  <head>
    <title>Unknown</title>
    <link rel="stylesheet" type="text/css" href="../stylesheet.css"/>
    <link rel="stylesheet" type="text/css" href="../page_styles.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  </head>
  <body class="calibre"><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Jobs and CronJobs" class="praise"><div class="dedication" id="jobs_cronjobs">
<h1 class="calibre14"><span class="keep-together">Chapter 6. </span>Jobs and CronJobs</h1>


<p class="author1">A Job models a one-time process—for example, a batch operation. The Pod and its encompassed containers stop running after the work has been completed. CronJobs run periodically according to their defined schedules. A good application for a CronJob is a task that needs to occur periodically (for example, a process that exports data). In this chapter you will learn how to configure, run, and inspect a Job and a CronJob.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre48"><div class="sidebar" id="id474">
<h1 class="calibre49">Coverage of Curriculum Objectives</h1>
<p class="author1">This chapter addresses the following curriculum objective:</p>

<ul class="printings">
<li class="calibre13">
<p class="author1">Understand Jobs and CronJobs</p>
</li>
</ul>
</div></aside>






<section data-type="sect1" data-pdf-bookmark="Working with Jobs" class="praise"><div class="dedication" id="id194">
<h1 class="calibre17">Working with Jobs</h1>

<p class="author1">A Job is a Kubernetes primitive that runs functionality until a specified number of completions has been reached, making it a good fit for one-time operations like import/export data processes or I/O-intensive processes with a finite end. The actual work managed by a Job is still running inside of a Pod. Therefore, you can think of 
<span class="keep-together">a Job as</span> a higher-level coordination instance for Pods executing the workload. <a data-type="xref" href="#job_pod_relationship" class="calibre10">Figure 6-1</a> shows the parent-child relationship between a Job and the Pod(s) it 
<span class="keep-together">manages.</span></p>

<p class="author1">Upon completion of a Job and its Pods, Kubernetes does not automatically delete the objects—they will stay until they’re explicitly deleted. Keeping those objects helps with debugging the command run inside of the Pod and gives you a chance to inspect the logs.</p>

<figure class="calibre35"><div id="job_pod_relationship" class="figure">
<img src="Images/ckd2_0601.png" alt="ckd2 0601" class="calibre69"/>
<h6 class="calibre32"><span class="keep-together">Figure 6-1. </span>Relationship between a Job and its Pods</h6>
</div></figure>
<div data-type="tip" class="calibre26"><h1 class="calibre34">Auto-cleanup of Jobs and Pods</h1>
<p class="author1">Kubernetes supports an <a href="https://kubernetes.io/docs/concepts/workloads/controllers/ttlafterfinished/" class="calibre10">auto-cleanup mechanism for Jobs</a> and their controlled Pods by specifying the YAML attribute <code class="calibre15">spec.ttlSe⁠condsAfterFinished</code>.</p>
</div>








<section data-type="sect2" data-pdf-bookmark="Creating and Inspecting Jobs" class="praise"><div class="dedication" id="id195">
<h2 class="calibre33">Creating and Inspecting Jobs</h2>

<p class="author1">Let’s first create a Job and observe its behavior in practice before delving into details. To create a Job imperatively, simply use the <code class="calibre15">create job</code> command. If the provided image doesn’t run any commands, you may want to append a command to be executed in the corresponding Pod.</p>

<p class="author1">The following command creates a Job that runs an iteration process. For each iteration of the loop, a variable named <code class="calibre15">counter</code> is incremented. The command execution finishes after reaching the counter value 3:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl create job counter --image=nginx:1.25.1 \
  -- /bin/sh -c 'counter=0; while [ $counter -lt 3 ]; do \
  counter=$((counter+1)); echo "$counter"; sleep 3; done;'</strong>
job.batch/counter created
</pre>

<p class="author1"><a data-type="xref" href="#job_loop" class="calibre10">Example 6-1</a> shows the YAML manifest equivalent for the Job if you prefer the declarative approach.</p>
<div id="job_loop" data-type="example" class="calibre45">
<h5 class="calibre46"><span class="keep-together">Example 6-1. </span>A Job executing a loop command</h5>

<pre data-type="programlisting" data-code-language="yaml" class="calibre47"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="calibre15">batch/v1</code><code class="w">
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="calibre15">Job</code><code class="w">
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">counter</code><code class="w">
</code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">template</code><code class="p">:</code><code class="w">   </code><a class="calibre10" id="co_jobs_and_cronjobs_CO1-1" href="#callout_jobs_and_cronjobs_CO1-1"><img src="Images/1.png" alt="1" class="calibre51"/></a><code class="w">
</code><code class="w">    </code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">      </code><code class="nt">containers</code><code class="p">:</code><code class="w">
</code><code class="w">      </code><code class="calibre15">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">counter</code><code class="w">
</code><code class="w">        </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="calibre15">nginx:1.25.1</code><code class="w">
</code><code class="w">        </code><code class="nt">command</code><code class="p">:</code><code class="w">
</code><code class="w">        </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">/bin/sh</code><code class="w">
</code><code class="w">        </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">-c</code><code class="w">
</code><code class="w">        </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">counter=0;</code><code class="calibre15"> </code><code class="calibre15">while</code><code class="calibre15"> </code><code class="calibre15">[</code><code class="calibre15"> </code><code class="calibre15">$counter</code><code class="calibre15"> </code><code class="calibre15">-lt</code><code class="calibre15"> </code><code class="calibre15">3</code><code class="calibre15"> </code><code class="calibre15">];</code><code class="calibre15"> </code><code class="calibre15">do</code><code class="calibre15"> </code><code class="calibre15">counter=$((counter+1));</code><code class="calibre15"> </code><code class="calibre15">\</code><code class="w">
</code><code class="w">          </code><code class="calibre15">echo</code><code class="calibre15"> </code><code class="calibre15">"$counter";</code><code class="calibre15"> </code><code class="calibre15">sleep</code><code class="calibre15"> </code><code class="calibre15">3;</code><code class="calibre15"> </code><code class="calibre15">done;</code><code class="w">
</code><code class="w">      </code><code class="nt">restartPolicy</code><code class="p">:</code><code class="w"> </code><code class="calibre15">Never</code></pre></div>
<dl class="calibre18">
<dt class="calibre52"><a class="calibre10" id="callout_jobs_and_cronjobs_CO1-1" href="#co_jobs_and_cronjobs_CO1-1"><img src="Images/1.png" alt="1" class="calibre51"/></a></dt>
<dd class="calibre20"><p class="calibre53">The Pod template uses the same attributes available in a Pod definition.</p></dd>
</dl>

<p class="author1">The output of listing the Job shows the current number of completions and the expected number of completions. The default number of completions is 1. This means if the Pod executing the command was successful, a Job is considered completed. As you can see in the following terminal output, a Job uses a single Pod by default to perform the work. The corresponding Pod can be identified by name—it uses the Job name as a prefix in its own name:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get jobs</strong>
NAME      COMPLETIONS   DURATION   AGE
counter   0/1           13s        13s
<strong class="calibre38">$ kubectl get jobs</strong>
NAME      COMPLETIONS   DURATION   AGE
counter   1/1           15s        19s
<strong class="calibre38">$ kubectl get pods</strong>
NAME            READY   STATUS      RESTARTS   AGE
counter-z6kdj   0/1     Completed   0          51s
</pre>

<p class="author1">To verify the correct behavior of the Job, you can download its logs. As expected, the output renders the counter for each iteration:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl logs counter-z6kdj</strong>
1
2
3
</pre>

<p class="author1">You can further tweak the runtime behavior of a Job. The next two sections discuss configuring the Job operation types and restart behavior.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Job Operation Types" class="praise"><div class="dedication" id="id196">
<h2 class="calibre33">Job Operation Types</h2>

<p class="author1">The default behavior of a Job is to run the workload in a single Pod and expect one successful completion. That’s what Kubernetes calls a <em class="calibre3">non-parallel</em> Job. Internally, those parameters are tracked by the attributes <code class="calibre15">spec.completions</code> and <code class="calibre15">spec.parallelism</code>, each with the assigned value 1. The following command renders the parameters of the Job we created earlier:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get jobs counter -o yaml | grep -C 1 "completions"</strong>
...
  completions: 1
  parallelism: 1
...
</pre>

<p class="author1">You can tweak any of those parameters to fit the needs of your use case. For example, if you expected the workload to complete successfully multiple times, then you’d increase the value of <code class="calibre15">spec.completions</code> to at least 2. Sometimes, you’ll want to execute the workload by multiple pods in parallel. In those cases, you’d bump up the value assigned to <code class="calibre15">spec.parallelism</code>. This is referred to as a <em class="calibre3">parallel job</em>. Remember that you can use any combination of assigned values for both attributes. <a data-type="xref" href="#configuration_for_different_job_operation_types" class="calibre10">Table 6-1</a> summarizes the different use cases.</p>
<table id="configuration_for_different_job_operation_types" class="calibre58">
<caption class="calibre59"><span class="keep-together">Table 6-1. </span>Configuration for different Job operation types</caption>
<thead class="calibre61">
<tr class="calibre62">
<th class="calibre63">Type</th>
<th class="calibre63">spec.completions</th>
<th class="calibre63">spec.parallelism</th>
<th class="calibre63">Description</th>
</tr>
</thead>
<tbody class="calibre64">
<tr class="calibre62">
<td class="calibre65"><p class="author1">Non-parallel with one completion count</p></td>
<td class="calibre65"><p class="author1">1</p></td>
<td class="calibre65"><p class="author1">1</p></td>
<td class="calibre65"><p class="author1">Completes as soon as its Pod terminates successfully.</p></td>
</tr>
<tr class="calibre66">
<td class="calibre65"><p class="author1">Parallel with a fixed completion count</p></td>
<td class="calibre65"><p class="author1">&gt;= 1</p></td>
<td class="calibre65"><p class="author1">&gt;= 1</p></td>
<td class="calibre65"><p class="author1">Completes when specified number of tasks finish successfully.</p></td>
</tr>
<tr class="calibre62">
<td class="calibre65"><p class="author1">Parallel with worker queue</p></td>
<td class="calibre65"><p class="author1">unset</p></td>
<td class="calibre65"><p class="author1">&gt;= 1</p></td>
<td class="calibre65"><p class="author1">Completes when at least one Pod has terminated successfully and all Pods are terminated.</p></td>
</tr>
</tbody>
</table>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Restart Behavior" class="praise"><div class="dedication" id="id197">
<h2 class="calibre33">Restart Behavior</h2>

<p class="author1">The <code class="calibre15">spec.backoffLimit</code> attribute determines the number of retries a Job attempts to successfully complete the workload until the executed command finishes with an exit code 0. The default is 6, which means it will execute the workload 6 times before the Job is considered unsuccessful.</p>

<p class="author1">The Job manifest needs to explicitly declare the restart policy  by using <code class="calibre15">spec.tem⁠plate.spec.restartPolicy</code>. The default restart policy of a Pod is <code class="calibre15">Always</code>, which tells the Kubernetes scheduler to <em class="calibre3">always</em> restart the Pod even if the container exits with a 0 exit code. The restart policy of a Job can be only <code class="calibre15">OnFailure</code> or <code class="calibre15">Never</code>.</p>










<section data-type="sect3" data-pdf-bookmark="Restarting the container on failure" class="praise"><div class="dedication" id="id198">
<h3 class="calibre44">Restarting the container on failure</h3>

<p class="author1"><a data-type="xref" href="#job_restartpolicy_onfailure" class="calibre10">Figure 6-2</a> shows the behavior of a Job that uses the restart policy <code class="calibre15">OnFailure</code>. Upon a container failure, this policy will simply rerun the container.</p>

<figure class="calibre35"><div id="job_restartpolicy_onfailure" class="figure">
<img src="Images/ckd2_0602.png" alt="ckd2 0602" class="calibre70"/>
<h6 class="calibre32"><span class="keep-together">Figure 6-2. </span>Restart policy <em class="calibre3">onFailure</em></h6>
</div></figure>
</div></section>










<section data-type="sect3" data-pdf-bookmark="Starting a new Pod on failure" class="praise"><div class="dedication" id="id199">
<h3 class="calibre44">Starting a new Pod on failure</h3>

<p class="author1"><a data-type="xref" href="#job_restartpolicy_never" class="calibre10">Figure 6-3</a> shows the behavior of a Job that uses the restart policy <code class="calibre15">Never</code>. This policy does not restart the container upon a failure. It starts a new Pod instead.</p>

<figure class="calibre35"><div id="job_restartpolicy_never" class="figure">
<img src="Images/ckd2_0603.png" alt="ckd2 0603" class="calibre70"/>
<h6 class="calibre32"><span class="keep-together">Figure 6-3. </span>Restart policy <code class="calibre15">Never</code></h6>
</div></figure>
</div></section>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Working with CronJobs" class="praise"><div class="dedication" id="id200">
<h1 class="calibre17">Working with CronJobs</h1>

<p class="author1">A Job represents a finite operation. Once the operation can be executed successfully, the work is done and the Job will create no more Pods. A CronJob creates a new Job object periodically based a schedule. The Pods controlled by the Job handle the actual workload. <a data-type="xref" href="#cronjob_job_pod_relationship" class="calibre10">Figure 6-4</a> illustrates the relationship between a CronJob, the Job it manages, and the Pods that execute the workload.</p>

<figure class="calibre35"><div id="cronjob_job_pod_relationship" class="figure">
<img src="Images/ckd2_0604.png" alt="ckd2 0604" class="calibre71"/>
<h6 class="calibre32"><span class="keep-together">Figure 6-4. </span>Relationship between a CronJob, Job, and its Pods</h6>
</div></figure>

<p class="author1">The schedule can be defined with a cron-expression you may already know from Unix cron jobs. <a data-type="xref" href="#cronjob_schedule" class="calibre10">Figure 6-5</a> shows a CronJob that executes every hour. For every execution, the CronJob creates a new Pod that runs the task and finishes with a 0 or non-zero exit code.</p>

<figure class="calibre35"><div id="cronjob_schedule" class="figure">
<img src="Images/ckd2_0605.png" alt="ckd2 0605" class="calibre72"/>
<h6 class="calibre32"><span class="keep-together">Figure 6-5. </span>Executing a Job based on a schedule</h6>
</div></figure>








<section data-type="sect2" data-pdf-bookmark="Creating and Inspecting CronJobs" class="praise"><div class="dedication" id="id201">
<h2 class="calibre33">Creating and Inspecting CronJobs</h2>

<p class="author1">You can use the imperative <code class="calibre15">create cronjob</code> command to create a new CronJob. The following command schedules the CronJob to run every minute. The Pod created for every execution renders the current date to standard output using the Unix <code class="calibre15">echo</code> command:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl create cronjob current-date --schedule="* * * * *" \
  --image=nginx:1.25.1 -- /bin/sh -c 'echo "Current date: $(date)"'</strong>
cronjob.batch/current-date created
</pre>

<p class="author1">To create a CronJob from the YAML manifest, use the definition shown in <a data-type="xref" href="#cronjob_date" class="calibre10">Example 6-2</a>.</p>
<div id="cronjob_date" data-type="example" class="calibre45">
<h5 class="calibre46"><span class="keep-together">Example 6-2. </span>A CronJob printing the current date</h5>

<pre data-type="programlisting" data-code-language="yaml" class="calibre47"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="calibre15">batch/v1</code><code class="w">
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="calibre15">CronJob</code><code class="w">
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">current-date</code><code class="w">
</code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">schedule</code><code class="p">:</code><code class="w"> </code><code class="s">"</code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="s">"</code><code class="w">   </code><a class="calibre10" id="co_jobs_and_cronjobs_CO2-1" href="#callout_jobs_and_cronjobs_CO2-1"><img src="Images/1.png" alt="1" class="calibre51"/></a><code class="w">
</code><code class="w">  </code><code class="nt">jobTemplate</code><code class="p">:</code><code class="w">            </code><a class="calibre10" id="co_jobs_and_cronjobs_CO2-2" href="#callout_jobs_and_cronjobs_CO2-2"><img src="Images/2.png" alt="2" class="calibre51"/></a><code class="w">
</code><code class="w">    </code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">      </code><code class="nt">template</code><code class="p">:</code><code class="w">
</code><code class="w">        </code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">          </code><code class="nt">containers</code><code class="p">:</code><code class="w">
</code><code class="w">          </code><code class="calibre15">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">current-date</code><code class="w">
</code><code class="w">            </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="calibre15">nginx:1.25.1</code><code class="w">
</code><code class="w">            </code><code class="nt">args</code><code class="p">:</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">/bin/sh</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">-c</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="s">'</code><code class="s">echo</code><code class="nv"> </code><code class="s">"Current</code><code class="nv"> </code><code class="s">date:</code><code class="nv"> </code><code class="s">$(date)"</code><code class="s">'</code><code class="w">
</code><code class="w">          </code><code class="nt">restartPolicy</code><code class="p">:</code><code class="w"> </code><code class="calibre15">OnFailure</code></pre></div>
<dl class="calibre18">
<dt class="calibre52"><a class="calibre10" id="callout_jobs_and_cronjobs_CO2-1" href="#co_jobs_and_cronjobs_CO2-1"><img src="Images/1.png" alt="1" class="calibre51"/></a></dt>
<dd class="calibre20"><p class="calibre53">Defines the cron expression that determines when a new Job object needs to be created.</p></dd>
<dt class="calibre52"><a class="calibre10" id="callout_jobs_and_cronjobs_CO2-2" href="#co_jobs_and_cronjobs_CO2-2"><img src="Images/2.png" alt="2" class="calibre51"/></a></dt>
<dd class="calibre20"><p class="calibre53">The section that describes the Job template.</p></dd>
</dl>

<p class="author1">If you list the existing CronJob with the <code class="calibre15">get cronjobs</code> command, you will see the schedule, the last scheduled execution, and whether the CronJob is currently active:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get cronjobs</strong>
NAME           SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
current-date   * * * * *   False     0        &lt;none&gt;          28s
<strong class="calibre38">$ kubectl get cronjobs</strong>
NAME           SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
current-date   * * * * *   False     1        14s             53s
</pre>

<p class="author1">It’s easy to match Jobs and Pods created by a CronJob. You can simply identify them by the name prefix. In this case, the prefix is <code class="calibre15">current-date-</code>:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get jobs,pods</strong>
NAME                              COMPLETIONS   DURATION   AGE
job.batch/current-date-28473049   1/1           3s         2m23s
job.batch/current-date-28473050   1/1           3s         83s
job.batch/current-date-28473051   1/1           3s         23s

NAME                              READY   STATUS      RESTARTS   AGE
pod/current-date-28473049-l6hc7   0/1     Completed   0          2m23s
pod/current-date-28473050-csq7n   0/1     Completed   0          83s
pod/current-date-28473051-jg8st   0/1     Completed   0          23s
</pre>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Configuring Retained Job History" class="praise"><div class="dedication" id="id202">
<h2 class="calibre33">Configuring Retained Job History</h2>

<p class="author1">Even after a task in a Pod controlled by a CronJob completes, it will not be deleted automatically. Keeping a historical record of Pods can be tremendously helpful for troubleshooting failed workloads or inspecting the logs. By default, a CronJob retains the last three successful Pods and the last failed Pod:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get cronjobs current-date -o yaml | grep successfulJobsHistoryLimit:</strong>
  successfulJobsHistoryLimit: 3
<strong class="calibre38">$ kubectl get cronjobs current-date -o yaml | grep failedJobsHistoryLimit:</strong>
  failedJobsHistoryLimit: 1
</pre>

<p class="author1">To reconfigure the job retention history limits, set new values for the <code class="calibre15">spec.successfulJobsHistoryLimit</code> and <code class="calibre15">spec.failedJobsHistoryLimit</code> attributes. <a data-type="xref" href="#cronjob_retention_history_limits" class="calibre10">Example 6-3</a> keeps the last five successful executions and the last three failed executions.</p>
<div id="cronjob_retention_history_limits" data-type="example" class="calibre45">
<h5 class="calibre46"><span class="keep-together">Example 6-3. </span>A CronJob configuring retention history limits</h5>

<pre data-type="programlisting" data-code-language="yaml" class="calibre47"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="calibre15">batch/v1</code><code class="w">
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="calibre15">CronJob</code><code class="w">
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">current-date</code><code class="w">
</code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">  </code><code class="nt">successfulJobsHistoryLimit</code><code class="p">:</code><code class="w"> </code><code class="calibre15">5</code><code class="w">   </code><a class="calibre10" id="co_jobs_and_cronjobs_CO3-1" href="#callout_jobs_and_cronjobs_CO3-1"><img src="Images/1.png" alt="1" class="calibre51"/></a><code class="w">
</code><code class="w">  </code><code class="nt">failedJobsHistoryLimit</code><code class="p">:</code><code class="w"> </code><code class="calibre15">3</code><code class="w">       </code><a class="calibre10" id="co_jobs_and_cronjobs_CO3-2" href="#callout_jobs_and_cronjobs_CO3-2"><img src="Images/2.png" alt="2" class="calibre51"/></a><code class="w">
</code><code class="w">  </code><code class="nt">schedule</code><code class="p">:</code><code class="w"> </code><code class="s">"</code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="nv"> </code><code class="s">*</code><code class="s">"</code><code class="w">
</code><code class="w">  </code><code class="nt">jobTemplate</code><code class="p">:</code><code class="w">
</code><code class="w">    </code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">      </code><code class="nt">template</code><code class="p">:</code><code class="w">
</code><code class="w">        </code><code class="nt">spec</code><code class="p">:</code><code class="w">
</code><code class="w">          </code><code class="nt">containers</code><code class="p">:</code><code class="w">
</code><code class="w">          </code><code class="calibre15">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="calibre15">current-date</code><code class="w">
</code><code class="w">            </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="calibre15">nginx:1.25.1</code><code class="w">
</code><code class="w">            </code><code class="nt">args</code><code class="p">:</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">/bin/sh</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="calibre15">-c</code><code class="w">
</code><code class="w">            </code><code class="calibre15">-</code><code class="w"> </code><code class="s">'</code><code class="s">echo</code><code class="nv"> </code><code class="s">"Current</code><code class="nv"> </code><code class="s">date:</code><code class="nv"> </code><code class="s">$(date)"</code><code class="s">'</code><code class="w">
</code><code class="w">          </code><code class="nt">restartPolicy</code><code class="p">:</code><code class="w"> </code><code class="calibre15">OnFailure</code></pre></div>
<dl class="calibre18">
<dt class="calibre52"><a class="calibre10" id="callout_jobs_and_cronjobs_CO3-1" href="#co_jobs_and_cronjobs_CO3-1"><img src="Images/1.png" alt="1" class="calibre51"/></a></dt>
<dd class="calibre20"><p class="calibre53">Defines the number of successful Jobs kept in the history.</p></dd>
<dt class="calibre52"><a class="calibre10" id="callout_jobs_and_cronjobs_CO3-2" href="#co_jobs_and_cronjobs_CO3-2"><img src="Images/2.png" alt="2" class="calibre51"/></a></dt>
<dd class="calibre20"><p class="calibre53">Defines the number of failed Jobs kept in the history.</p></dd>
</dl>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary" class="praise"><div class="dedication" id="id203">
<h1 class="calibre17">Summary</h1>

<p class="author1">Jobs are well suited for implementing batch processes run in one or many Pods as a finite operation. Both objects, the Job and the Pod, will not be deleted after the work is completed to support inspection and troubleshooting activities. A CronJob is very similar to a Job but executes on a schedule, defined as a Unix cron expression.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Exam Essentials" class="praise"><div class="dedication" id="id204">
<h1 class="calibre17">Exam Essentials</h1>
<dl class="calibre18">
<dt class="calibre19">Understand practical use cases of Jobs and CronJobs</dt>
<dd class="calibre20">
<p class="calibre21">Jobs and CronJobs manage Pods that should finish the work at least once or periodically. You will need to understand the creation of those objects and how to inspect them at runtime. Make sure to play around with the different configuration options and how they affect the runtime behavior.</p>
</dd>
<dt class="calibre19">Practice different Job operational modes</dt>
<dd class="calibre20">
<p class="calibre21">Jobs can operate in three modes: non-parallel with one completion count, in parallel with a fixed completion count, and in parallel with worker queue. 
<span class="keep-together">The default</span> behavior of a Job is to run the workload in a single Pod and expect one successful completion (non-parallel Job). The attribute <code class="calibre15">spec.completions</code> controls the number of required successful completions. The attribute <code class="calibre15">spec.par⁠allelism</code> allows for executing the workload by multiple Pods in parallel.</p>
</dd>
</dl>
</div></section>






<section data-type="sect1" class="praise" data-pdf-bookmark="Sample Exercises"><div class="dedication" id="id205">
<h1 class="calibre17">Sample Exercises</h1>

<p class="author1">Solutions to these exercises are available in <a href="app01_split_002.xhtml#appendix_a_jobs_cronjobs" class="calibre10">Appendix A</a>.</p>
<ol class="calibre55">
<li class="calibre56">
<p class="author1">Create a Job named <code class="calibre15">random-hash</code> using the container image <code class="calibre15">alpine:3.17.3</code> that executes the shell command <code class="calibre15">echo $RANDOM | base64 | head -c 20</code>. Configure the Job to execute with two Pods in parallel. The number of completions should be set to 5.</p>

<p class="author1">Identify the Pods that executed the shell command. How many Pods do you expect to exist?</p>

<p class="author1">Retrieve the generated hash from one of the Pods.</p>

<p class="author1">Delete the Job. Will the corresponding Pods continue to exist?</p>
</li>
<li class="calibre56">
<p class="author1">Create a new CronJob named <code class="calibre15">google-ping</code>. When executed, the Job should run a <code class="calibre15">curl</code> command for <code class="calibre15">google.com</code>. Pick an appropriate image. The execution should occur every two minutes.</p>

<p class="author1">Watch the creation of the underlying Jobs managed by the CronJob. Check the command-line options of the relevant command or consult the <a href="https://kubernetes.io/docs/reference/kubectl" class="calibre10">Kubernetes 
<span class="keep-together">documentation</span></a>.</p>

<p class="author1">Reconfigure the CronJob to retain a history of seven executions.</p>

<p class="author1">Reconfigure the CronJob to disallow a new execution if the current execution is still running. Consult the <a href="https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/#concurrency-policy" class="calibre10">Kubernetes documentation</a> for more information.</p>
</li>

</ol>
</div></section>
</div></section></div></body>
</html>