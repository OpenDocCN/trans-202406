<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Managing Files and Directories"><div class="chapter" id="cha-files-directories">
<h1><span class="label">Chapter 6. </span>Managing Files and Directories</h1>


<p>Linux provides strong basic controls for access to files and directories with
configurable privileges. Every file and directory has three
levels of ownership, including user, group, and other; and multiple levels of access,
including read, write, and execute. You can protect your personal files and
control who has access to them, and the root user can manage access to commands,
scripts, shared files, and system files.</p>

<p>Even when you are using stronger access control tools—tools such as SELinux or

<span class="keep-together">AppArmor</span>—it is still important to get the fundamentals right.</p>

<p>On a Linux system, both human users and system services have user accounts.
Some system services need user accounts to control privileges, just like human
users.</p>

<p>Every<a data-type="indexterm" data-primary="files" data-secondary="ownership" data-tertiary="types of" id="idm46466160916840"/><a data-type="indexterm" data-primary="ownership" data-secondary="types of" id="idm46466160914584"/> file has three types of ownership: owner, group, and other (sometimes
<em>other</em> is expressed as <em>world</em>). The owner is a single user, the group owner
is a single group, and other is everyone else who has access to the file.</p>

<p>Every <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="types of" id="idm46466160909784"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="types of" data-secondary-sortas="files" id="idm46466160911176"/><a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="special modes" id="idm46466160908376"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="special modes" data-secondary-sortas="files" id="idm46466160907096"/><a data-type="indexterm" data-primary="special modes" data-secondary="types of" id="idm46466160905480"/>file has six permission modes—read, write, and executable—and three
special modes: the <em>sticky bit</em>, <em>setuid</em>, and <em>setgid</em>.</p>

<p>File permissions <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="purpose of" id="idm46466160902840"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="purpose of" data-secondary-sortas="files" id="idm46466160901352"/>control which users can create, read, edit, or delete a file,
and which users can execute a command. The special modes control who can move,
delete, or rename a file, and who can execute a command with elevated privileges.</p>

<p>Directory permissions <a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="purpose of" id="idm46466160899368"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="purpose of" data-secondary-sortas="directories" id="idm46466160898280"/>control which users can edit or enter a directory and
who can read, edit, add, or remove files from a directory.</p>

<p>Remember the fundamental Linux security principle: use the minimum necessary
privileges to get the job done.</p>
<div data-type="note" epub:type="note"><h1>Limitations of Privileges</h1>
<p>Anyone who can read a file can copy it.</p>

<p>You<a data-type="indexterm" data-primary="privileges" data-secondary="limitations" id="idm46466160894360"/> cannot prevent the root user, or <em>sudo</em> users with sufficient privileges,
from accessing your files.</p>

<p>Permissions and ownership are functions of filesystems and can be bypassed by
reading a storage device from another Linux instance, such as booting up a
live Linux from removable media to access the host system, or removing
the hard drive and connecting it to a different machine. You only need root
privileges on the system that you mount the storage device on, and do not need
to know anything about the original file owners and permissions.</p>
</div>

<p>On a <a data-type="indexterm" data-primary="users" data-secondary="root" data-tertiary="abilities of" id="idm46466160891016"/><a data-type="indexterm" data-primary="root users" data-secondary="abilities of" id="idm46466160889688"/>Linux system the root user, also called the superuser, reigns supreme.
Root can do almost anything, including editing and deleting other users’
files, entering any directory, and running any command. Normal, or unprivileged,
users may temporarily assume root powers with the <em>sudo</em> or <em>su</em> commands
(see Recipes <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.xhtml#rec-su">5.17</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.xhtml#rec-sudo">5.18</a>).</p>

<p>Every user has a unique identification (UID), and belongs to at least one
group (see <a data-type="xref" href="ch05.xhtml#rec-uid-gid">Recipe 5.1</a>). Every user in a group shares the<a data-type="indexterm" data-primary="groups" data-secondary="permissions" id="idm46466160884456"/><a data-type="indexterm" data-primary="permissions" data-secondary="of groups" data-secondary-sortas="groups" id="idm46466160884792"/> permissions of
that group.</p>

<p>To see what all of this looks like, take a look <a data-type="indexterm" data-primary="/etc" data-secondary="directory permissions" id="idm46466160879256"/><a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="in /etc" data-tertiary-sortas="/etc" id="idm46466160878408"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="in /etc" data-secondary-sortas="directories" data-tertiary-sortas="/etc" id="idm46466160877080"/>at <em>/etc</em>, which contains
system configuration files:</p>
<pre> $ <strong>stat --format=%a:%A:%U:%G /etc</strong>
755:drwxr-xr-x:root:root
</pre>

<p>The command output shows the directory’s <em>mode</em>, or set of permissions, in two
forms, <em>755:drwxr-xr-x</em>. <em>755</em> is <a data-type="indexterm" data-primary="symbolic notation" id="idm46466160872488"/><a data-type="indexterm" data-primary="octal notation" id="idm46466160871992"/><a data-type="indexterm" data-primary="modes" data-see="permissions" id="idm46466160871384"/><a data-type="indexterm" data-primary="privileges" data-seealso="permissions" id="idm46466160870536"/>octal notation, and <em>drwxr-xr-x</em> is
symbolic notation. These are two different ways of expressing the same mode, which
in this example is unrestricted privileges for the directory owner, and
group and other may only enter the directory. File modes are discussed in detail
in this chapter.</p>

<p><em>root:root</em> is the owner and group. Files and directories can have different owners and groups; for example, <em>/etc/cups</em> is owned by <em>root:lp</em>.</p>

<p>In this chapter you will learn about the<a data-type="indexterm" data-primary="special modes" data-secondary="types of" id="idm46466160867432"/> special modes: the <em>sticky bit</em>,
<em>setuid</em>, and <em>setgid</em>. The <a data-type="indexterm" data-primary="setuid mode" id="idm46466160863800"/><a data-type="indexterm" data-primary="setgid mode" id="idm46466160863192"/>setuid and setgid modes elevate user and group permissions
to the same level as the file owner. These are used only in special cases, and
used very carefully because privilege escalation is a potential security
risk. The sticky bit <a data-type="indexterm" data-primary="sticky bits" id="idm46466160862584"/>prevents anyone but the file owner, or anyone with
root privileges, from deleting, renaming, or moving files they do not own in
a directory, such as <em>/tmp</em>.</p>

<p>You will learn how to set ownership and modes, create and delete files and
directories, configure default privileges, transfer file ownership to
a different user or group, and copy, move, and rename files and
directories.</p>
<div data-type="note" epub:type="note"><h1>Using sudo</h1>
<p>Most of the examples in this recipe use the dollar sign command prompt, $, which
indicates an unprivileged user. Depending on your own file permissions, you may
need <em>sudo</em> for some operations.</p>
</div>






<section data-type="sect1" data-pdf-bookmark="6.1 Creating Files and Directories"><div class="sect1" id="idm46466160861400">
<h1>6.1 Creating Files and Directories</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160860296">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="creating" id="file-create"/><a data-type="indexterm" data-primary="directories" data-secondary="creating" id="directory-create"/>want to organize your files by placing them in directories.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160852696">
<h2>Solution</h2>

<p>Use<a data-type="indexterm" data-primary="mkdir command" id="idm46466160850664"/> the <em>mkdir</em> command to create directories. The following example creates a new
subdirectory in the current directory:</p>
<pre>$ <strong>mkdir -v presentations</strong>
mkdir: created directory 'presentations'</pre>

<p>Create a subdirectory two levels down inside the current directory, and
its parent directories, with the <em>-p</em> (parent) option:</p>
<pre>$ <strong>mkdir -p presentations/2020/august</strong>
mkdir: created directory 'presentations/2020'
mkdir: created directory 'presentations/2020/august'</pre>

<p>Create a new top-level directory, which is relative to root, /. You need root
privileges to do this:</p>
<pre>$ <strong>sudo mkdir -v /charts</strong>
mkdir: created directory '/charts'</pre>

<p>You can set permissions when you create a directory:</p>
<pre>$ <strong>mkdir -m 0700 /home/duchess/dog-memes</strong></pre>

<p>Files are created by applications, such as word processors and image editors, and
special commands like <em>touch</em>. The <em>touch</em> command <a data-type="indexterm" data-primary="touch command" id="touch-command"/>creates a new empty file:</p>
<pre>$ <strong>touch newfile.txt</strong></pre>

<p>See <a data-type="xref" href="#rec-touch-yes">Recipe 6.2</a> to learn how to use <em>touch</em> to quickly create batches of
files for testing.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160852104">
<h2>Discussion</h2>

<p>If you are having trouble visualizing file trees, and how all directories are
relative to /, try the <em>tree</em> command. <a data-type="indexterm" data-primary="tree command" id="idm46466160837208"/>Root, /, is at the top:</p>
<pre>$ <strong>tree -L 1 /</strong>
/
├── backups
├── bin
├── boot
[...]</pre>

<p>You have probably noticed that this is upside down. In the real world, trees branch
from the root, but the <em>tree</em> command displays the directory tree branching
downward. There is a reason for this: we read screens from the top down.</p>

<p>This example lists only the top-level directories under root. <em>-L 2</em> shows
second-level directories, <em>-L 3</em> goes to three levels, <a data-type="indexterm" data-primary="files" data-secondary="creating" data-startref="file-create" id="idm46466160833672"/><a data-type="indexterm" data-primary="directories" data-secondary="creating" data-startref="directory-create" id="idm46466160831144"/>and so on.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160838456">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="#rec-touch-yes">Recipe 6.2</a></p>
</li>
<li>
<p><em>man 1 mkdir</em></p>
</li>
<li>
<p><em>man 1 touch</em></p>
</li>
<li>
<p><em>man 1 yes</em></p>
</li>
<li>
<p><em>man 1 tree</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.2 Quickly Creating a Batch of Files for Testing"><div class="sect1" id="rec-touch-yes">
<h1>6.2 Quickly Creating a Batch of Files for Testing</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160820968">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="creating" data-tertiary="in batches" data-tertiary-sortas="batches" id="file-create-batch"/><a data-type="indexterm" data-primary="batches of files, creating" id="batch-file-create"/> want to create batches of files to use for testing file permissions,
and for any testing that needs a lot of files in a hurry.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160816616">
<h2>Solution</h2>

<p>Use the <em>touch</em> command. The following example creates a single new empty file:</p>
<pre>$ <strong>touch newfile.txt</strong></pre>

<p>Create 100 new empty files:</p>
<pre>$ <strong>touch file{00..99}</strong></pre>

<p>This creates 100 new files named <em>file00</em>, <em>file01</em>, <em>file02</em>, and so on.
You may give them file extensions and name them anything:</p>
<pre>$ <strong>touch test{00..99}.doc</strong>
$ <strong>ls</strong>
test00.doc
test01.doc
test02.doc
[...]</pre>

<p class="pagebreak-before less_space">Put the numbers first in the filename for easy ordering:</p>
<pre>$ <strong>touch {00..99}test.doc</strong>
$ <strong>ls</strong>
00test.doc
01test.doc
02test.doc
[...]
</pre>

<p>A fast way to populate the files with content is to use<a data-type="indexterm" data-primary="yes command" id="idm46466160804840"/> the <em>yes</em> command.
The following example creates a 500 MB file filled with the repeated line “This
is a test file”:</p>
<pre>$ <strong>yes This is a test file | head -c 500 MB &gt; testfile.txt</strong>
</pre>

<p>Create a batch of 100 files with 1 MB of content in each file:</p>
<pre>$ <strong>for x in {01..100};</strong>
&gt; <strong>do yes This is a test file | head -c 1MB &gt; $x-testfile.txt;</strong>
&gt; <strong>done</strong> </pre>

<p>The new files look like this:</p>
<pre>001-testfile.txt
002-testfile.txt
003-testfile.txt
[...]</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160801432">
<h2>Discussion</h2>

<p>You may customize this command in a number of ways: filenames, file sizes,
numbering, and the text for <em>yes</em>.</p>

<p>The examples in the recipe pad the numbers in the filenames with leading
zeroes so they will order correctly. Most graphical file managers handle ordering
numbered filenames correctly, but the default<a data-type="indexterm" data-primary="ls command" id="ls-command"/><a data-type="indexterm" data-primary="lexicographic ordering" id="lex-order"/> for <em>ls</em> is lexicographic order.
The following example demonstrates this with a 1- to 3-digit numbering range:</p>
<pre>$ <strong>touch {0..150}test.doc</strong>
$ <strong>ls -C1</strong>
0test.doc
100test.doc
101test.doc
102test.doc
103test.doc
104test.doc
105test.doc
106test.doc
107test.doc
108test.doc
109test.doc
10test.doc
110test.doc
111test.doc
112test.doc
113test.doc
114test.doc
115test.doc
116test.doc
117test.doc
118test.doc
119test.doc
11test.doc
120test.doc
121test.doc
[...]
</pre>

<p>Lexicographic ordering treats the filenames as text strings instead of
integers and characters, and compares each number and letter individually, from
left to right. Lexicographic ordering doesn’t know that 10 is smaller than 100, only
that 101 follows 100, 102 follows 101, and 10t follows 109 because letters
follow numbers, <a data-type="indexterm" data-primary="ls command" data-startref="ls-command" id="idm46466160788376"/><a data-type="indexterm" data-primary="lexicographic ordering" data-startref="lex-order" id="idm46466160787432"/>so the <em>t</em> follows the <em>9</em>.</p>

<p>You can use leading zeroes to make all the numbers the same number of characters,
or list your files with <em>ls -v</em>. This treats the numbers in filenames as integers
and not characters, so they are listed in correct numerical <a data-type="indexterm" data-primary="files" data-secondary="creating" data-tertiary="in batches" data-tertiary-sortas="batches" data-startref="file-create-batch" id="idm46466160788696"/><a data-type="indexterm" data-primary="batches of files, creating" data-startref="batch-file-create" id="idm46466160790264"/><a data-type="indexterm" data-primary="touch command" data-startref="touch-command" id="idm46466160789752"/>order.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160785240">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 ls</em></p>
</li>
<li>
<p><em>man 1 touch</em></p>
</li>
<li>
<p><em>man 1 yes</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.3 Working with Relative and Absolute Filepaths"><div class="sect1" id="idm46466160780168">
<h1>6.3 Working with Relative and Absolute Filepaths</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160779160">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="directories" data-secondary="filepaths, absolute/relative" id="directory-filepath-relabs"/><a data-type="indexterm" data-primary="filepaths, absolute/relative" id="filepaths-absrel"/><a data-type="indexterm" data-primary="absolute filepaths" id="abs-filepath"/><a data-type="indexterm" data-primary="relative filepaths" id="rel-filepath"/> need to understand the difference between relative and absolute filepaths,
and how to find where you are in the filesystem.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160773208">
<h2>Solution</h2>

<p>Absolute filepaths always start at the root, <em>/</em>, such as <em>/boot</em> and <em>/etc</em>. Relative
filepaths are relative to your current directory and do not have a leading
slash. Suppose you are in your home directory and it contains the following
subdirectories:</p>
<pre>madmax@client2:~$ <strong>ls --group-directories-first</strong>
 Audiobooks
 bin
 Desktop
 Documents
 Downloads
 games
 Music
 Pictures
 Public
 Templates
 Videos</pre>

<p>In this example, the absolute path to <em>Audiobooks</em> is <em>/home/madmax/Audiobooks</em>,
and the relative path is <em>Audiobooks</em>. Use the <em>cd</em> command <a data-type="indexterm" data-primary="cd command" id="idm46466160766440"/>to enter this
directory with either the absolute path:</p>
<pre>$ cd <strong>/home/madmax/Audiobooks</strong></pre>

<p>Or the relative path:</p>
<pre>$ <strong>cd Audiobooks</strong></pre>

<p>The directory you are in is the <a data-type="indexterm" data-primary="cwd (current working directory)" id="idm46466160763240"/><a data-type="indexterm" data-primary="pwd command" id="idm46466160762632"/>current working directory, <em>cwd</em>. Confirm your
<em>cwd</em> with the <em>pwd</em> (print working directory) command:</p>
<pre>$ <strong>pwd</strong>
/home/madmax</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160772952">
<h2>Discussion</h2>

<p>Absolute and relative filepaths are a common source of confusion. Remember that
when the filepath begins with a slash (/), it is an absolute path.
When there is no leading slash, it is relative to your current working directory.</p>

<p>Some applications and commands require relative paths; for example, <em>rsync</em> <em>include</em>
and <em>exclude</em> lists use filepaths that are relative to the directories being<a data-type="indexterm" data-primary="directories" data-secondary="filepaths, absolute/relative" data-startref="directory-filepath-relabs" id="idm46466160755224"/><a data-type="indexterm" data-primary="filepaths, absolute/relative" data-startref="filepaths-absrel" id="idm46466160753672"/><a data-type="indexterm" data-primary="absolute filepaths" data-startref="abs-filepath" id="idm46466160752824"/><a data-type="indexterm" data-primary="relative filepaths" data-startref="rel-filepath" id="idm46466160751976"/>
copied.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160756152">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 pwd</em></p>
</li>
<li>
<p><a data-type="xref" href="Images/ch07.html#cha-backup-recovery">Chapter 7</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.4 Deleting Files and Directories"><div class="sect1" id="idm46466160747448">
<h1>6.4 Deleting Files and Directories</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160746440">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="deleting" id="file-delete"/><a data-type="indexterm" data-primary="directories" data-secondary="deleting" id="directory-delete"/><a data-type="indexterm" data-primary="deleting" data-secondary="files/directories" id="delete-file-directory"/><a data-type="indexterm" data-primary="rm command" id="rm-command"/> had fun creating a bunch of files and directories, and now you want to get
rid of them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160739960">
<h2>Solution</h2>

<p>Use the <em>rm</em> (remove) command with caution, because <em>rm</em> will happily delete
everything you tell it to, so be sure you tell it the right files or
directories to delete.</p>

<p>Delete a single file, with verbose output:</p>
<pre>$ <strong>rm -v aria.ogg</strong>
removed 'aria.ogg'</pre>

<p>Use the <em>-i</em> flag to prompt for confirmation first:</p>
<pre> $ <strong>rm -iv intermezzo.wav</strong>
rm: remove regular file 'intermezzo.wav'? <strong>y</strong>
removed 'intermezzo.wav' </pre>

<p>Add the <em>-r</em> (recursive) flag to delete a directory and all of its files and
subdirectories. Combining <em>-r</em> with <em>-i</em> will prompt you for confirmation
before each deletion:</p>
<pre>$ <strong>rm -rvi rehearsals</strong>
rm: descend into directory 'rehearsals'? <strong>y</strong>
rm: remove regular file 'rehearsals/brass-section'? <strong>y</strong>
[...]</pre>

<p>If you are confident you don’t need to be prompted for every deletion, omit
the <em>-i</em> option.</p>

<p>This example deletes only the <em>jan</em> subdirectory:</p>
<pre>$ <strong>rm -rv rehearsals/2020/jan</strong></pre>

<p>This example deletes the <em>rehearsals</em> directory and all of its files and
subdirectories:</p>
<pre>$ <strong>rm -rv rehearsals</strong></pre>

<p>Use wildcards to match file names to delete, for example by file extension:</p>
<pre>$ <strong>rm -v *.txt</strong></pre>

<p>Or by files named with the same text strings:</p>
<pre>$ <strong>rm -v aria*</strong></pre>

<p>If <em>rm</em> refuses to delete a file or directory, and you are certain you want to
delete it, add the <em>-f</em> (force) option.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160739336">
<h2>Discussion</h2>

<p><em>rm -rf /</em> will erase your entire root filesystem (if you have root privileges).
Some folks think it is a funny prank to tell newbies to do this. It is not funny.
It is fun to run it on a test machine, or on a virtual machine, and observe
how long the system keeps running because processes in memory are still running,
even though the filesystem is erased from <a data-type="indexterm" data-primary="files" data-secondary="deleting" data-startref="file-delete" id="idm46466160719736"/><a data-type="indexterm" data-primary="directories" data-secondary="deleting" data-startref="directory-delete" id="idm46466160718872"/><a data-type="indexterm" data-primary="deleting" data-secondary="files/directories" data-startref="delete-file-directory" id="idm46466160717624"/><a data-type="indexterm" data-primary="rm command" data-startref="rm-command" id="idm46466160716376"/>disk.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160714616">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 rm</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.5 Copying, Moving, and Renaming Files and Directories"><div class="sect1" id="rec-cp-mv">
<h1>6.5 Copying, Moving, and Renaming Files and Directories</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160710264">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="copying" data-tertiary="with cp command" data-tertiary-sortas="cp command, id=file-copymove" id="idm46466160708936"/><a data-type="indexterm" data-primary="directories" data-secondary="copying/moving" id="directory-copymove"/><a data-type="indexterm" data-primary="files" data-secondary="renaming" id="file-rename"/><a data-type="indexterm" data-primary="directories" data-secondary="renaming" id="directory-rename"/><a data-type="indexterm" data-primary="copying" data-secondary="files" id="copy-file-directory"/><a data-type="indexterm" data-primary="moving" data-secondary="files/directories" id="move-file-directory"/><a data-type="indexterm" data-primary="renaming files/directories" id="rename-file-directory"/><a data-type="indexterm" data-primary="cp command" id="cp-command"/><a data-type="indexterm" data-primary="mv command" id="mv-command"/>have directories, and you have files. You want to move files into the
directories, change filenames, and make copies.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160697400">
<h2>Solution</h2>

<p>Use the <em>cp</em> command for copying, and the <em>mv</em> command for moving or renaming.</p>

<p>This example copies two files from the current working directory into the
<em>~/songs2</em> directory:</p>
<pre>$ <strong>cp -v aria.ogg solo.flac ~/songs2/</strong>
'aria.ogg' -&gt; '/home/duchess/songs2/aria.ogg'
'solo.flac' -&gt; '/home/duchess/songs2/solo.flac' </pre>
<div data-type="note" epub:type="note"><h1>The Tilde Represents Your Home Directory</h1>
<p>The<a contenteditable="false" data-primary="/home" data-secondary="tilde (~) shortcut" data-type="indexterm" id="idm46466160692072"/><a contenteditable="false" data-primary="~ (tilde), for /home directory" data-type="indexterm" id="idm46466160690456"/><a contenteditable="false" data-primary="tilde (~), for /home directory" data-type="indexterm" id="idm46466160689304"/> tilde is short for your home directory, so in the example,
<em>~/songs2</em> is the same as <em>/home/duchess/songs2/</em>.</p>
</div>

<p>Copy a directory and all of its contents with the <em>-r</em> (recursive) option:</p>
<pre>$ <strong>cp -rv ~/music/songs2 /shared/archives</strong></pre>

<p>The recursive example only copies the directory and its files. Use the <em>--parents</em>
option to preserve parent directories. The following example copies <em>songs1</em> and
its contents, and preserves the filepath <em>duchess/music/songs2/</em>:</p>
<pre>$ <strong>cp -rv --parents duchess/music/songs2/ shows/</strong>
duchess -&gt; shows/duchess
duchess/music -&gt; shows/duchess/music
'duchess/music/songs2' -&gt; 'shows/duchess/music/songs2'
'duchess/music/songs2/intro.flac' -&gt; 'shows/duchess/music/songs2/intro.flac'
'duchess/music/songs2/reprise.flac' -&gt; 'shows/duchess/music/songs2/reprise.flac'
'duchess/music/songs2/solo.flac' -&gt; 'shows/duchess/music/songs2/solo.flac'</pre>

<p>The other contents of <em>duchess</em> and <em>music</em> are not copied, only <em>songs2</em> and
its contents.</p>

<p class="pagebreak-before less_space">Use the <em>mv</em> command to move and rename files. This example moves two files to
another directory:</p>
<pre>$ <strong>mv -v aria.ogg solo.flac ~/songs2/</strong>
renamed 'aria.ogg' -&gt; '/home/duchess/songs2/aria.ogg'
renamed 'solo.flac' -&gt; '/home/duchess/songs2/solo.flac' </pre>

<p>The following example moves a directory into another directory:</p>
<pre>$ <strong>mv -v ~/songs2/ ~/music/</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160696616">
<h2>Discussion</h2>

<p>Some useful <em>cp</em> options are:</p>

<ul>
<li>
<p><em>-a, --archive</em> preserves all the file attributes, such as mode, ownership,
and timestamps.</p>
</li>
<li>
<p><em>-i, --interactive</em> prompts before overwriting destination files.</p>
</li>
<li>
<p><em>-u, --update</em> overwrites an existing destination file only if the source
file is newer. This saves time when you’re recopying a batch of files, and some
of the copies are unchanged. (<em>rsync</em> is better for efficient file transfers by
copying only changes, see <a data-type="xref" href="Images/ch07.html#cha-backup-recovery">Chapter 7</a>.)</p>
</li>
</ul>

<p><em>mv</em> has some useful options:</p>

<ul>
<li>
<p><em>-i, --interactive</em> prompts before overwriting destination files.</p>
</li>
<li>
<p><em>-n, --no-clobber</em> prevents overwriting destination files.</p>
</li>
<li>
<p><em>-u, --update</em> moves your files only when they are newer than the destination
files, or when they are moved for the first <a data-type="indexterm" data-primary="files" data-secondary="copying" data-tertiary="with cp command" data-tertiary-sortas="cp command, startref=file-copymove" id="idm46466160664248"/><a data-type="indexterm" data-primary="directories" data-secondary="copying/moving" data-startref="directory-copymove" id="idm46466160663480"/><a data-type="indexterm" data-primary="files" data-secondary="renaming" data-startref="file-rename" id="idm46466160662840"/><a data-type="indexterm" data-primary="directories" data-secondary="renaming" data-startref="directory-rename" id="idm46466160660600"/><a data-type="indexterm" data-primary="copying" data-secondary="files" data-startref="copy-file-directory" id="idm46466160659512"/><a data-type="indexterm" data-primary="moving" data-secondary="files/directories" data-startref="move-file-directory" id="idm46466160658328"/><a data-type="indexterm" data-primary="renaming files/directories" data-startref="rename-file-directory" id="idm46466160657048"/><a data-type="indexterm" data-primary="cp command" data-startref="cp-command" id="idm46466160656008"/><a data-type="indexterm" data-primary="mv command" data-startref="mv-command" id="idm46466160654936"/>time.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160653256">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 cp</em></p>
</li>
<li>
<p><em>man 1 mv</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.6 Setting File Permissions with chmod’s &#10;Octal Notation"><div class="sect1" id="idm46466160649704">
<h1>6.6 Setting File Permissions with chmod’s 
<span class="keep-together">Octal Notation</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160648680">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="octal notation" id="file-permission-octal"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="octal notation" data-secondary-sortas="files" id="permissions-file-octal"/><a data-type="indexterm" data-primary="chmod command" data-secondary="octal notation" data-tertiary="for file permissions" data-tertiary-sortas="file permissions" id="chmod-octal-files"/><a data-type="indexterm" data-primary="octal notation" data-secondary="for file permissions" data-secondary-sortas="file permissions" id="octal-file-permission"/> know that the <em>chmod</em> (change mode) command supports both octal and
symbolic notation, and you want to use octal notation to manage
file permissions.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160640328">
<h2>Solution</h2>

<p>The following examples show how to set different permissions on files
using octal notation. The first example grants read-write access to the
owner of the <em>file.txt</em> file, and excludes all access
for group and world:</p>
<pre>$ <strong>chmod -v 0600 file.txt</strong>
mode of 'file.txt' changed from 0644 (rw-r--r--) to 0600
(rw-------)</pre>

<p>The file owner can read, edit, and delete the file, while other users can do
nothing with it, not even read it, though they can see it listed in a file
manager.</p>

<p>Make a file world readable and writeable, allowing everyone to do whatever
they want to it:</p>
<pre>$ <strong>chmod 0666 file.txt</strong></pre>

<p>In the next example, <em>file.txt</em> is changed to read-write for the file owner
and read-only for group and world:</p>
<pre>$ <strong>chmod -v 0644 file.txt</strong>
mode of 'file.txt' changed from 0666 (rw-rw-rw-) to 0644 (rw-r--r--)</pre>

<p>A common permission set is to give the owner and group the same permissions,
such as read-write, and to exclude other:</p>
<pre>$ <strong>chmod 0660 file.txt</strong></pre>

<p>Commands and scripts require the executable bit to be set. This example
makes the <em>backup.sh</em> script executable and read-write for the owner,
executable and readable for group, and inaccessible to other:</p>
<pre>$ <strong>chmod 0750 backup.sh</strong></pre>

<p>Octal notation has four fields, but you probably will use the last three
fields the most often, and the first field rarely. The first field is
reserved for the special modes (see <a data-type="xref" href="#rec-sticky-octal">Recipe 6.8</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160638984">
<h2>Discussion</h2>

<p>Octal notation uses integers 0-7. <a data-type="xref" href="#table-octal-notation">Table 6-1</a> shows the
relationship between owners and permissions.</p>
<table id="table-octal-notation">
<caption><span class="label">Table 6-1. </span>Octal fields</caption>
<thead>
<tr>
<th>Mode</th>
<th>Owner</th>
<th>Group</th>
<th>Other</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Read</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr>
<td><p>Write</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr>
<td><p>Execute</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr>
<td><p>No permission</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>

<p>A file or directory has one user owner, and one group owner. <em>Other</em> is
everyone else. A directory or executable that is unrestricted to everyone
is mode 0777, and an unrestricted file is mode 0666.</p>

<p>When you’re not familiar with Linux file permissions, it might help to see
them in another view, like in <a data-type="xref" href="#permission-description">Table 6-2</a>.</p>
<table id="permission-description">
<caption><span class="label">Table 6-2. </span>Linux file permissions</caption>
<thead>
<tr>
<th>Permission</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><em>7</em></p></td>
<td><p>Read, write, execute. Directories differ from files because all directories require the executable bit set. You can assign a directory any permissions, just like a file, but without the executable bit no one can enter the directory (with the <em>cd</em> command or in a file manager). Scripts and binary commands must have the executable bit set, or they will be treated as ordinary files.</p></td>
</tr>
<tr>
<td><p><em>6</em></p></td>
<td><p>Read and write.</p></td>
</tr>
<tr>
<td><p><em>5</em></p></td>
<td><p>Read and execute. This is a common permission for commands.</p></td>
</tr>
<tr>
<td><p><em>4</em></p></td>
<td><p>Read.</p></td>
</tr>
<tr>
<td><p><em>3</em></p></td>
<td><p>Write and execute.</p></td>
</tr>
<tr>
<td><p><em>2</em></p></td>
<td><p>Write.</p></td>
</tr>
<tr>
<td><p><em>1</em></p></td>
<td><p>Execute.</p></td>
</tr>
<tr>
<td><p><em>0</em></p></td>
<td><p>No <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="octal notation" data-startref="file-permission-octal" id="idm46466160588968"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="octal notation" data-secondary-sortas="files" data-startref="permissions-file-octal" id="idm46466160587640"/><a data-type="indexterm" data-primary="chmod command" data-secondary="octal notation" data-tertiary="for file permissions" data-tertiary-sortas="file permissions" data-startref="chmod-octal-files" id="idm46466160586072"/><a data-type="indexterm" data-primary="octal notation" data-secondary="for file permissions" data-secondary-sortas="file permissions" data-startref="octal-file-permission" id="idm46466160584280"/>permission.</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160628888">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-sticky-octal">Recipe 6.8</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.7 Setting Directory Permissions with chmod’s Octal Notation"><div class="sect1" id="idm46466160578344">
<h1>6.7 Setting Directory Permissions with chmod’s Octal Notation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160577448">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="octal notation" id="directory-permission-octal"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="octal notation" data-secondary-sortas="directories" id="permissions-directory-octal"/><a data-type="indexterm" data-primary="chmod command" data-secondary="octal notation" data-tertiary="for directory permissions" data-tertiary-sortas="directory permissions" id="chmod-octal-directories"/><a data-type="indexterm" data-primary="octal notation" data-secondary="for directory permissions" data-secondary-sortas="directory permissions" id="octal-directory-permission"/> know that permissions are managed a little differently on directories,
and you want to manage them with chmod’s octal notation.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160568840">
<h2>Solution</h2>

<p>Directories must have the executable bit set. This might sound a little
strange, but it is necessary for entering the directory with the <em>cd</em> command
or with a file manager.</p>

<p>The following examples creates a shared directory:</p>
<pre>$ <strong>sudo mkdir /shared</strong></pre>

<p>This example makes <em>/shared</em> read-write for the owner and read-only for
everyone else:</p>
<pre>$ <strong>chmod 0755 /shared</strong></pre>

<p>The owner has unrestricted privileges to the directory. Group and world
may enter the directory and read files, but not edit or add files.</p>

<p>This example applies the same permissions to the existing contents of the directory,
using the <em>-R</em> (recursive) option:</p>
<pre>$ <strong>chmod -R 0755 /shared</strong></pre>

<p>The next example restricts the directory and its existing contents to the
directory owner. Files and directories inside the directory may have different
owners and permissions, but are still inaccessible to group and world:</p>
<pre>$ <strong>chmod 0700 /shared</strong></pre>

<p>A common permission set is to give the owner and group the same permissions,
such as read-write-execute, and to exclude other:</p>
<pre>$ <strong>chmod 0770 /shared</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160568296">
<h2>Discussion</h2>

<p>You have a lot of power with groups and directories to control file access. Set
up groups according to function, for example various teams could each have
their own exclusive shared directories. Most shops don’t need super-fine-grained
control and default to more sharing rather than less. Whatever your needs are,
the old <em>chmod</em> command is still the fundamental tool for controlling file<a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="octal notation" data-startref="directory-permission-octal" id="idm46466160555832"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="octal notation" data-secondary-sortas="directories" data-startref="permissions-directory-octal" id="idm46466160554408"/><a data-type="indexterm" data-primary="chmod command" data-secondary="octal notation" data-tertiary="for directory permissions" data-tertiary-sortas="directory permissions" data-startref="chmod-octal-directories" id="idm46466160552648"/><a data-type="indexterm" data-primary="octal notation" data-secondary="for directory permissions" data-secondary-sortas="directory permissions" data-startref="octal-directory-permission" id="idm46466160550456"/> permissions.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160557640">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.8 Using the Special Modes for Special Use Cases"><div class="sect1" id="rec-sticky-octal">
<h1>6.8 Using the Special Modes for Special Use Cases</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160545256">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="special modes" id="file-permission-special"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="special modes" data-secondary-sortas="files" id="permissions-file-special"/><a data-type="indexterm" data-primary="special modes" data-secondary="octal notation" data-tertiary="setting" id="special-mode-octal-set"/><a data-type="indexterm" data-primary="octal notation" data-secondary="special modes" data-tertiary="setting" id="octal-special-set"/><a data-type="indexterm" data-primary="sticky bits" data-secondary="octal notation" id="sticky-bit-octal"/><a data-type="indexterm" data-primary="setuid mode" data-secondary="octal notation" id="setuid-octal"/><a data-type="indexterm" data-primary="setgid mode" data-secondary="octal notation" id="setgid-octal"/><a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="special modes" id="directory-permission-special"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="special modes" data-secondary-sortas="directories" id="permission-directory-special"/><a data-type="indexterm" data-primary="chmod command" data-secondary="special modes" data-tertiary="setting" id="chmod-special-set"/>want to set some permissions not supported by the traditional user-group-other
set of permissions, such as allowing unprivileged users to run a command that
requires elevated permissions, protecting files in a directory shared by multiple
users, or enforcing certain file permissions in a directory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160527912">
<h2>Solution</h2>

<p>The special modes are <em>sticky bit</em>,  <em>setuid</em>, and <em>setgid</em> (see
<a data-type="xref" href="#table-all-modes-octal">Table 6-3</a>). The sticky bit is applied to directories that contain
files owned by multiple users, to prevent users from moving, renaming, or
deleting files they do not own:</p>
<pre>$ <strong>chmod -v 1770 /home/duchess/shared</strong>
mode of '/home/duchess/shared changed from 0770 (rwxrwx---) to 1770 (rwxrwx--T)</pre>

<p><em>setuid</em> is applied to executable files, to elevate any user running the command
to the same permissions as the owner:</p>
<pre>$ <strong>chmod 4750 backup-script</strong>
mode of 'backup-script' changed from 0750 (rwxrw----) to 4770 (rwsrwx---)</pre>

<p>Apply <em>setgid</em> to a directory, so that all newly created files in the directory
are assigned to the same group as the directory’s group owner. This is a nice trick
for enforcing correct ownership in a shared directory:</p>
<pre>$ <strong>chmod 2770 /home/duchess/shared</strong>
mode of '/home/duchess/shared' changed from 0770 (rwxrwx---) to 2770 (rwxrws---)
</pre>

<p><em>setgid</em> may also be applied to files, changing the effective group of the user
to the same group as the file owner.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160518616">
<h2>Discussion</h2>

<p><em>setgid</em> and <em>setuid</em> have the potential to create security holes
for an intruder or an untrustworthy user. It is a best practice to use them only
when you can’t think of a safer way to accomplish what you want to do, such as
using group assignments or <em>sudo</em>.</p>

<p><em>setuid</em> is useful for executable files.</p>

<p><em>setgid</em> is useful for directories and files.</p>

<p>The sticky bit is only for directories.
<a data-type="xref" href="#table-all-modes-octal">Table 6-3</a> shows the relationship of permissions
to owners.</p>
<table id="table-all-modes-octal">
<caption><span class="label">Table 6-3. </span>Octal fields</caption>
<thead>
<tr>
<th>Mode</th>
<th>Special modes</th>
<th>Owner</th>
<th>Group</th>
<th>World</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Read</p></td>
<td/>
<td><p>4</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr>
<td><p>Write</p></td>
<td/>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr>
<td><p>Execute</p></td>
<td/>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr>
<td><p>setuid</p></td>
<td><p>4</p></td>
<td/>
<td/>
<td/>
</tr>
<tr>
<td><p>setgid</p></td>
<td><p>2</p></td>
<td/>
<td/>
<td/>
</tr>
<tr>
<td><p>Sticky bit</p></td>
<td><p>1</p></td>
<td/>
<td/>
<td/>
</tr>
<tr>
<td><p>No permission</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>

<p>The special mode values may be combined (see <a data-type="xref" href="#table-special-values-octal">Table 6-4</a>).</p>
<table id="table-special-values-octal">
<caption><span class="label">Table 6-4. </span>Sticky bit/setgid/setuid values</caption>
<thead>
<tr>
<th>Option name</th>
<th>Octal value</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>No option set</p></td>
<td><p>0</p></td>
</tr>
<tr>
<td><p>Sticky bit set</p></td>
<td><p>1</p></td>
</tr>
<tr>
<td><p>setgid</p></td>
<td><p>2</p></td>
</tr>
<tr>
<td><p>Sticky bit and setgid</p></td>
<td><p>3</p></td>
</tr>
<tr>
<td><p>setuid</p></td>
<td><p>4</p></td>
</tr>
<tr>
<td><p>Sticky bit and setuid</p></td>
<td><p>5</p></td>
</tr>
<tr>
<td><p>setgid and setuid</p></td>
<td><p>6</p></td>
</tr>
<tr>
<td><p>Sticky bit, setgid, and setuid</p></td>
<td><p>7</p></td>
</tr>
</tbody>
</table>

<p>A more descriptive name for the sticky bit <a data-type="indexterm" data-primary="restricted deletion bit" id="idm46466160468488"/>is <em>restricted deletion bit</em>.
This bit prevents unprivileged users from removing or renaming a file in a
directory, unless they own the file. You can see this on your <em>/tmp</em>
directory, which is world readable and writeable, and contains files
owned by multiple users. Using the sticky bit prevents users from moving, renaming,
or deleting files they do not own, even if they have write privileges on some
files they do not own:</p>
<pre> $ <strong>stat --format=%a:%A:%U:%G /tmp</strong>
1777:drwxrwxrwt:root:root
</pre>

<p>The sticky bit is the 1 in 1777.</p>

<p><em>setgid</em> means set group user identification, and <em>setuid</em> is set user
identification. These are used to elevate the permissions of an unprivileged
user to the same as the user or group owner. This is how unprivileged users can
use the <em>passwd</em> command to change their own passwords, even though only root
has write permissions on <em>/etc/passwd</em>, and everyone else has only read and
execute permissions:</p>
<pre> $ <strong>stat --format=%a:%A:%U:%G /usr/bin/passwd</strong>
4755:-rwsr-xr-x:root:root
</pre>

<p>In <em>/etc/passwd</em> the 4 in 4755 is <em>setuid</em>, which means all users have root
powers when they run the command, though their powers are limited to changing
their own <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="special modes" data-startref="file-permission-special" id="idm46466160464072"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="special modes" data-secondary-sortas="files" data-startref="permissions-file-special" id="idm46466160460008"/><a data-type="indexterm" data-primary="special modes" data-secondary="octal notation" data-tertiary="setting" data-startref="special-mode-octal-set" id="idm46466160458072"/><a data-type="indexterm" data-primary="octal notation" data-secondary="special modes" data-tertiary="setting" data-startref="octal-special-set" id="idm46466160456744"/><a data-type="indexterm" data-primary="sticky bits" data-secondary="octal notation" data-startref="sticky-bit-octal" id="idm46466160455416"/><a data-type="indexterm" data-primary="setuid mode" data-secondary="octal notation" data-startref="setuid-octal" id="idm46466160454104"/><a data-type="indexterm" data-primary="setgid mode" data-secondary="octal notation" data-startref="setgid-octal" id="idm46466160452824"/><a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="special modes" data-startref="directory-permission-special" id="idm46466160451640"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="special modes" data-secondary-sortas="directories" data-startref="permission-directory-special" id="idm46466160450216"/><a data-type="indexterm" data-primary="chmod command" data-secondary="special modes" data-tertiary="setting" data-startref="chmod-special-set" id="idm46466160448280"/>passwords.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160445752">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.9 Removing the Special Modes in Octal Notation"><div class="sect1" id="idm46466160446424">
<h1>6.9 Removing the Special Modes in Octal Notation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160442328">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="special modes" data-secondary="octal notation" data-tertiary="removing" id="idm46466160440904"/><a data-type="indexterm" data-primary="removing" data-secondary="special modes" id="idm46466160439816"/><a data-type="indexterm" data-primary="octal notation" data-secondary="special modes" data-tertiary="removing" id="idm46466160438968"/><a data-type="indexterm" data-primary="chmod command" data-secondary="special modes" data-tertiary="removing" id="idm46466160437880"/> want to remove the special modes from a file or directory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160436088">
<h2>Solution</h2>

<p>Removing a special mode is a little different from setting it because you need
to use an extra leading zero, as in the following example:</p>
<pre>$ <strong>chmod -v 00770 backup.sh</strong>
mode of 'backup.sh' changed from 1770 (rwxrwx--T) to 0770 (rwxrwx---)</pre>

<p>Or replace the leading zeroes with a leading equals sign:</p>
<pre>$ <strong>chmod -v =770 backup.sh</strong>
mode of 'backup.sh' changed from 1770 (rwxrwx--T) to 0770 (rwxrwx---)
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160431736">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.10 Setting File Permissions with chmod’s &#10;Symbolic Notation"><div class="sect1" id="rec-chmod-symbolic">
<h1>6.10 Setting File Permissions with chmod’s 
<span class="keep-together">Symbolic Notation</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160427704">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="symbolic notation" id="file-permission-symbolic"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="symbolic notation" data-secondary-sortas="files" id="permissions-file-symbolic"/><a data-type="indexterm" data-primary="chmod command" data-secondary="symbolic notation for file permissions" data-tertiary-sortas="file permissions" id="chmod-symbolic-files"/><a data-type="indexterm" data-primary="symbolic notation" data-secondary="for file permissions" data-secondary-sortas="file permissions" id="symbolic-file-permission"/> know that the <em>chmod</em> (change mode) command supports both octal and
symbolic notation, and you want to use symbolic notation to manage file permissions.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160419848">
<h2>Solution</h2>

<p>Symbolic notation is more complex than octal notation and behaves differently
according to which operator you use.</p>

<p>There are three operators: +, -, and =. You can change permissions for
everyone with the <em>a</em> flag, or individually with <em>u</em> for the file owner,
<em>g</em> for the group, and <em>-o</em> for other, which is everyone else:</p>

<ul>
<li>
<p><em>+</em> adds to existing permissions.</p>
</li>
<li>
<p><em>-</em> subtracts from existing permissions.</p>
</li>
<li>
<p><em>=</em> adds new permissions, and removes any permission bits not listed.</p>
</li>
</ul>

<p>Suppose that <em>file.txt</em> is owner read-write, group read, and other read, or
<em>-rw-r--r--</em>:</p>
<pre>$ <strong>stat --format=%a:%A:%U:%G file.txt</strong>
664:-rw-r--r--:stash:stash
</pre>

<p>You want to change it to <em>-rw-rw-rw-</em>. Add write permissions to group and
other:</p>
<pre>$ <strong>chmod -v g+w,o+w file.txt</strong>
mode of 'file.txt' changed from 0644 (rw-r--r--) to 0666 (rw-rw-rw-)</pre>

<p>You could also use <em>a=rw</em>.</p>

<p>In the next example the owner of <em>file.txt</em> changes it from
world readable and writeable to only the file owner can edit it, and
group and world can only read it:</p>
<pre>$ <strong>chmod -v g-w,o-w file.txt</strong>
mode of 'file.txt' changed from 0666 (rw-rw-rw-) to 0644 (rw-r--r--)</pre>

<p>A common permission set is to give the owner and group the same permissions,
such as read-write, and to exclude other:</p>
<pre>$ <strong>chmod -v u=rw,g=rw,o-r file.txt</strong>
mode of 'file.txt' changed from 0644 (rw-r-r--) to 0660 (rw-rw----)</pre>

<p>Commands and scripts require the executable bit to be set. This example
adds the executable bit to the existing permissions for the file owner:</p>
<pre>$ <strong>chmod -v u+x file.txt</strong>
mode of 'file.sh' changed from 0660 (rw-rw----) to 0760 (rwxrw----)</pre>

<p>The <strong><code>=</code></strong> operator is useful for overwriting existing permissions:</p>
<pre>$ <strong>chmod -v u=rw,g=rw,o=r file.txt</strong>
mode of 'file.sh' changed from 0760 (rwxrw----) to 0664 (rw-rw-r--)</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160418136">
<h2>Discussion</h2>

<p>The key to using <em>chmod</em>’s symbolic notation reliably is to always be explicit
and to be mindful of the existing permissions. Add and subtract from existing
permissions (except with the = operator, which overwrites), and specify
<em>u</em>, <em>g</em>, <em>o</em>, or <em>-a</em>.</p>

<p><em>symbolic</em> notation is designed to be mnemonic, <em>r</em> for read, <em>w</em> for write,
and <em>x</em> for execute (<a data-type="xref" href="#table-symbolic-notation-permissions">Table 6-5</a>).</p>
<table id="table-symbolic-notation-permissions">
<caption><span class="label">Table 6-5. </span>Symbolic notation permissions</caption>
<thead>
<tr>
<th>Mode</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>r</p></td>
<td><p>read</p></td>
</tr>
<tr>
<td><p>w</p></td>
<td><p>write</p></td>
</tr>
<tr>
<td><p>x</p></td>
<td><p>execute</p></td>
</tr>
</tbody>
</table>

<p class="pagebreak-before less_space">The notation for users and groups is also mnemonic (<a data-type="xref" href="#table-symbolic-notation-owners">Table 6-6</a>).</p>
<table id="table-symbolic-notation-owners">
<caption><span class="label">Table 6-6. </span>Symbolic notation owners</caption>
<thead>
<tr>
<th>Owner</th>
<th>Notation</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>user</p></td>
<td><p>u</p></td>
</tr>
<tr>
<td><p>group</p></td>
<td><p>g</p></td>
</tr>
<tr>
<td><p>other</p></td>
<td><p>o</p></td>
</tr>
<tr>
<td><p>all</p></td>
<td><p>a</p></td>
</tr>
</tbody>
</table>

<p>Just like octal notation, symbolic notation also supports the special modes (see <a data-type="xref" href="#rec-sticky-symbolic">Recipe 6.11</a>).</p>

<p>There are 10 values in symbolic notation, and unset values (which mean no
permissions) are represented by a dash, like this example for Duchess’s home
directory:</p>
<pre>$ <strong>stat --format=%a:%A:%U:%G /home/duchess</strong>
755:drwxr-xr-x:duchess:duchess
</pre>

<p>In <em>drwxr-xr-x</em>, the <em>d</em> indicates that this is a directory. There is no
comparable value in octal notation.</p>

<p>The remaining nine values are divided into three triads, and the three values
in each triad represent read, write, and <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="symbolic notation" data-startref="file-permission-symbolic" id="idm46466160367016"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="symbolic notation" data-secondary-sortas="files" data-startref="permissions-file-symbolic" id="idm46466160365848"/><a data-type="indexterm" data-primary="chmod command" data-secondary="symbolic notation for file permissions" data-tertiary-sortas="file permissions" data-startref="chmod-symbolic-files" id="idm46466160364952"/><a data-type="indexterm" data-primary="symbolic notation" data-secondary="for file permissions" data-secondary-sortas="file permissions" data-startref="symbolic-file-permission" id="idm46466160362248"/>execute.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160360248">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.11 Setting the Special Modes with chmod’s Symbolic Notation"><div class="sect1" id="rec-sticky-symbolic">
<h1>6.11 Setting the Special Modes with chmod’s Symbolic Notation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160356152">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="special modes" data-secondary="symbolic notation, setting" id="special-mode-symbolic-set"/><a data-type="indexterm" data-primary="symbolic notation" data-secondary="special modes, setting" id="symbolic-special-set"/><a data-type="indexterm" data-primary="sticky bits" data-secondary="symbolic notation" id="sticky-bit-symbolic"/><a data-type="indexterm" data-primary="setuid mode" data-secondary="symbolic notation" id="setuid-symbolic"/><a data-type="indexterm" data-primary="setgid mode" data-secondary="symbolic notation" id="setgid-symbolic"/><a data-type="indexterm" data-primary="chmod command" data-secondary="special modes" data-tertiary="setting" id="chmod-special-set-symbolic"/>want to set special modes with <em>chmod</em>’s symbolic notation.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160346760">
<h2>Solution</h2>

<p>The special modes include the <em>sticky bit</em>, <em>setuid</em>, and
<em>setgid</em>. These are all set in the executable fields. (See the end of the Discussion in <a data-type="xref" href="#rec-chmod-symbolic">Recipe 6.10</a> if you are not sure what the executable
fields are.)</p>

<p>The sticky bit is applied to directories that contain files owned by multiple
users to prevent nonowners from moving, renaming, or deleting the files:</p>
<pre>$ <strong>chmod o+t /shared/stickydir</strong>
mode of '/shared/stickydir' changed from 0775 (rwxrwxr-x) to 1775 (rwxrwxr-t)</pre>

<p>Apply <em>setgid</em> to a directory to set all newly created files in the directory
to the same group as the directory. This is a nice trick for enforcing correct
ownership in a shared directory:</p>
<pre>$ <strong>chmod -v g+s /shared</strong>
mode of '/shared' changed from 0770 (rwxrwx---) to 2770 (rwxrws---)</pre>

<p>Apply <em>setuid</em> to an executable file to allow nonroot users to run the
executable:</p>
<pre>$ <strong>chmod -v u+s backup-script</strong>
mode of 'backup-script' changed from 0755 (rwxr-xr-x) to 4755 (rwsr-xr-x)</pre>

<p><em>setuid</em> and <em>setgid</em> have the potential to open security holes; see the
Discussion to learn more.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160335096">
<h2>Discussion</h2>

<p><em>setuid</em> is useful for executable files.</p>

<p><em>setgid</em> is useful for directories and files.</p>

<p>The sticky bit is only for directories.</p>

<p><a data-type="xref" href="#table-all-modes-symbolic">Table 6-7</a> shows the relationship between owners and modes.</p>
<table id="table-all-modes-symbolic">
<caption><span class="label">Table 6-7. </span>All symbolic modes</caption>
<thead>
<tr>
<th>Mode</th>
<th>User</th>
<th>Group</th>
<th>Other</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Read</p></td>
<td><p>r</p></td>
<td><p>r</p></td>
<td><p>r</p></td>
</tr>
<tr>
<td><p>Write</p></td>
<td><p>w</p></td>
<td><p>w</p></td>
<td><p>w</p></td>
</tr>
<tr>
<td><p>Execute</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
<td><p>x</p></td>
</tr>
<tr>
<td><p>setuid</p></td>
<td><p>s</p></td>
<td/>
<td/>
</tr>
<tr>
<td><p>setgid</p></td>
<td/>
<td><p>s</p></td>
<td/>
</tr>
<tr>
<td><p>Sticky bit</p></td>
<td/>
<td/>
<td><p>t</p></td>
</tr>
</tbody>
</table>

<p>A more descriptive name for the sticky bit <a data-type="indexterm" data-primary="restricted deletion bit" id="idm46466160309928"/>is <em>restricted deletion bit</em>.
This prevents users from removing or renaming a file in a directory unless
they own the file. You can see this on your <em>/tmp</em>
directory, which is world readable and writeable, and contains files
for multiple users. Using the sticky bit prevents users from moving,
renaming, or deleting files they do not own:</p>
<pre>$ <strong>stat --format=%a:%A:%U:%G /tmp</strong>
1777:drwxrwxrwt/:root:root </pre>

<p><em>setgid</em> means set group identification, and <em>setuid</em> is set user
identification. These are used to elevate the permissions of an unprivileged
user to the same as the file owner. This is how unprivileged users can use the
<em>passwd</em> command to change their own passwords, even though only root has write
permissions on <em>/etc/passwd</em>, and everyone else has only read and execute
permissions:</p>
<pre>$ <strong>stat --format=%a:%A:%U:%G /usr/bin/passwd</strong>
4755:-rwsr-xr-x:root:root</pre>

<p><em>rws</em> in the user fields means read, write, and execute for all users, with the
same permissions as the file owner.</p>

<p><em>setgid</em> and <em>setuid</em> have the potential to create security holes. It is a best
practice to use them only when you can’t devise a safer way to accomplish what
you want to do, such as using group assignments <a data-type="indexterm" data-primary="special modes" data-secondary="symbolic notation, setting" data-startref="special-mode-symbolic-set" id="idm46466160301944"/><a data-type="indexterm" data-primary="symbolic notation" data-secondary="special modes, setting" data-startref="symbolic-special-set" id="idm46466160301288"/><a data-type="indexterm" data-primary="sticky bits" data-secondary="symbolic notation" data-startref="sticky-bit-symbolic" id="idm46466160300200"/><a data-type="indexterm" data-primary="setuid mode" data-secondary="symbolic notation" data-startref="setuid-symbolic" id="idm46466160299112"/><a data-type="indexterm" data-primary="setgid mode" data-secondary="symbolic notation" data-startref="setgid-symbolic" id="idm46466160297800"/><a data-type="indexterm" data-primary="chmod command" data-secondary="special modes" data-tertiary="setting" data-startref="chmod-special-set-symbolic" id="idm46466160296712"/>or <em>sudo</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160334600">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.12 Setting Permissions in Batches with chmod"><div class="sect1" id="idm46466160291304">
<h1>6.12 Setting Permissions in Batches with chmod</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160290440">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="in batches" data-tertiary-sortas="batches" id="file-permission-batch"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="in batches" data-secondary-sortas="files" data-tertiary-sortas="batches" id="permission-file-batch"/><a data-type="indexterm" data-primary="chmod command" data-secondary="batch permissions" id="chmod-batch"/><a data-type="indexterm" data-primary="batch permissions" id="batch-permission"/><a data-type="indexterm" data-primary="find command" data-secondary="batch permissions" id="find-batch"/> want to set permissions on more than one file at a time.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160281128">
<h2>Solution</h2>

<p><em>chmod</em> supports operating on lists of files. You can also use the <em>find</em>
command and shell wildcards to select the files you want to change.</p>
<div data-type="tip"><h1>You May Need sudo</h1>
<p>If you see “Permission denied” messages, use <em>sudo</em>.</p>
</div>

<p>The following example takes a space-delimited list of files and makes them
all read-only for everyone:</p>
<pre>$ <strong>chmod -v 444 file1 file2 file3</strong></pre>

<p>Set permissions for a directory and its contents, including subdirectories,
with the <em>-R</em> (recursive) flag:</p>
<pre>$ <strong>chmod -vR 755 /shared</strong></pre>

<p>You may use wildcards to select files; for example, to make all <em>.txt</em> files in
the current directory readable and writable to the owner, and to make group and other
readable:</p>
<pre>$ <strong>chmod -v 644 *.txt</strong></pre>

<p>Use a wildcard to select all filenames that start with the same string:</p>
<pre>$ <strong>chmod -v 644 abcd*</strong></pre>

<p>This example makes all files in the current directory read-write for the owner
and group, without changing permissions on the directory:</p>
<pre>$ <strong>find . -type f -exec chmod -v 660 {} \;</strong></pre>

<p>You can change the mode of all files belonging to a particular user. You may
name the user with either their numeric ID or username. This example starts at
the root of the filesystem:</p>
<pre>$ <strong>sudo find / -user madmax -exec chmod -v 660 {} \;</strong>
$ <strong>sudo find / -user 1007 -exec chmod -v 660 {} \;</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160280584">
<h2>Discussion</h2>

<p>You need root privileges to search for files in all directories.</p>

<p>The dot (<em>find .</em>) tells <em>find</em> to start its search in the current directory.
You can start your search in any directory.</p>

<p><em>-type</em> limits the results to files, and not directories.</p>

<p><em>-user</em> looks for files owned by the specified user.</p>

<p><em>-exec chmod -v 660 {} \;</em> is a fabulous little incantation that takes the
results of the <em>find</em> search and runs the <em>chmod -v 660</em> command on the
results. You can use this for pretty much any command that you want to apply to
the results<a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="in batches" data-tertiary-sortas="batches" data-startref="file-permission-batch" id="idm46466160260920"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="in batches" data-secondary-sortas="files" data-tertiary-sortas="batches" data-startref="permission-file-batch" id="idm46466160260024"/><a data-type="indexterm" data-primary="chmod command" data-secondary="batch permissions" data-startref="chmod-batch" id="idm46466160257624"/><a data-type="indexterm" data-primary="batch permissions" data-startref="batch-permission" id="idm46466160256536"/><a data-type="indexterm" data-primary="find command" data-secondary="batch permissions" data-startref="find-batch" id="idm46466160255688"/> of a <em>find</em> search.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160262680">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
<li>
<p><em>man 1 find</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.13 Setting File and Directory Ownership with chown"><div class="sect1" id="idm46466160249624">
<h1>6.13 Setting File and Directory Ownership with chown</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160248616">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="ownership" data-tertiary="changing" id="file-owner-change"/><a data-type="indexterm" data-primary="directories" data-secondary="ownership, changing" id="directory-own-change"/><a data-type="indexterm" data-primary="ownership" data-secondary="changing" id="ownership-change"/><a data-type="indexterm" data-primary="changing" data-secondary="file ownership" id="change-ownership"/><a data-type="indexterm" data-primary="chown command" id="chown"/> need to change ownership on a file or directory.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160240376">
<h2>Solution</h2>

<p>Use the <em>chown</em> (change owner) command to change file ownership. The
basic command syntax is <em>chown user:group filename</em>. You may change only the
owner, <em>chown user: filename</em>, or only the group, <em>chown :group filename</em>.</p>

<p>Changing the owner requires root privileges:</p>
<pre>duchess@client1:~$ <strong>sudo chown -v madmax: song.wav</strong>
changed ownership of 'song.wav' from duchess:duchess to madmax:duchess</pre>

<p>Change the group owner:</p>
<pre>$ <strong>sudo chown -v :composers song.wav</strong>
changed ownership of 'song.wav' from madmax:duchess to :composers</pre>

<p>Change both the user and group owner:</p>
<pre>$ <strong>sudo chown stash:stash song.wav</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160232968">
<h2>Discussion</h2>

<p>You need root privileges to make changes to files you do not own and to transfer
file ownership to another user. You can change group file ownership without
root privileges when you belong to both the original group and the new group.</p>

<p>The colon is optional when you change only the owner and required when you change the
group.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160229400">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chown</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.14 Changing Ownership on Batches of Files with chown"><div class="sect1" id="idm46466160230328">
<h1>6.14 Changing Ownership on Batches of Files with chown</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160226984">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="batch ownership, changing" id="batch-ownership"/><a data-type="indexterm" data-primary="find command" data-secondary="batch ownership" id="find-batch-owner"/>want to change ownership of directories and their contents, or just the
contents of directories, a list of files, or change ownership of files from one
user to another.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160220680">
<h2>Solution</h2>

<p><em>chown</em> supports operating on lists of files. You can also use the <em>find</em>
command and shell wildcards to list the files you want to change.</p>

<p>To change the owner of several files at once with <em>chown</em>, use a space-delimited
list:</p>
<pre>$ <strong>sudo chown -v madmax:share file1 file2 file3</strong></pre>

<p>Change files with a certain file extension in the current directory
to a new group:</p>
<pre>$ <strong>sudo chown -v :share *.txt</strong></pre>

<p>Give all of a user’s files in a directory to another user, using their
numeric UIDs or usernames:</p>
<pre>$ <strong>chown -Rv --from duchess stash /shared/compositions</strong>

$ <strong>chown -Rv --from 1001 1005 /shared/compositions</strong></pre>

<p>Use the -find_ command to traverse the entire filesystem, or any directory and
its subdirectories, to give all of a user’s files to another user:</p>
<pre>$ <strong>sudo find / -user duchess -exec chown -v stash {} \;</strong>

$ <strong>sudo find / -user 1001 -exec chown -v 1005 {} \;</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160213736">
<h2>Discussion</h2>

<p>Transferring ownership of all of a user’s files to another user, or to a
different group, is useful for cleaning up after users who no
longer have accounts on the <a data-type="indexterm" data-primary="batch ownership, changing" data-startref="batch-ownership" id="idm46466160212376"/><a data-type="indexterm" data-primary="find command" data-secondary="batch ownership" data-startref="find-batch-owner" id="idm46466160211000"/><a data-type="indexterm" data-primary="files" data-secondary="ownership" data-tertiary="changing" data-startref="file-owner-change" id="idm46466160209912"/><a data-type="indexterm" data-primary="directories" data-secondary="ownership, changing" data-startref="directory-own-change" id="idm46466160208296"/><a data-type="indexterm" data-primary="ownership" data-secondary="changing" data-startref="ownership-change" id="idm46466160207112"/><a data-type="indexterm" data-primary="changing" data-secondary="file ownership" data-startref="change-ownership" id="idm46466160205800"/><a data-type="indexterm" data-primary="chown command" data-startref="chown" id="idm46466160204456"/>system.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160202200">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chown</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.15 Setting Default Permissions with umask"><div class="sect1" id="idm46466160199784">
<h1>6.15 Setting Default Permissions with umask</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160198680">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="default" id="file-permission-default"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="default" data-secondary-sortas="files" id="permission-file-default"/><a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="default" id="directory-permission-default"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="default" data-secondary-sortas="directories" id="permission-directory-default"/><a data-type="indexterm" data-primary="default permissions" id="default-permission"/><a data-type="indexterm" data-primary="umask command" id="umask"/>want to understand why files are created with a certain set of default
permissions, and how to configure the defaults yourself.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160188552">
<h2>Solution</h2>

<p>The umask (user file-creation mode mask) controls this behavior. To see what
yours is, run the <em>umask</em> command:</p>
<pre>$ <strong>umask</strong>
0002</pre>

<p>This is how it looks it in symbolic notation:</p>
<pre>$ <strong>umask -S</strong>
u=rwx,g=rwx,o=rx</pre>

<p>This sets your default permissions to 0775 for directories and 0664 for
files, because the umask “masks” the hardcoded default permissions of 0777 and
0666. Or you can think of it as subtraction, 0777 - 0002 = 0775.</p>

<p>To change your umask temporarily for the duration of your current session, set
it this way:</p>
<pre>$ <strong>umask 0022</strong></pre>

<p>Set the umask permanently by inserting the line <em>umask 0022</em>, or whatever
value you want, in your <em>~/.bashrc</em> file.</p>

<p>Set the default umask for all of your users in <em>/etc/login.defs</em>:</p>
<pre><strong>UMASK 022</strong></pre>

<p><a data-type="xref" href="#table-common-umask">Table 6-8</a> shows some common umask values.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160188008">
<h2>Discussion</h2>

<p><em>umask</em> is a Bash shell built-in, and not an executable program stored in <em>/bin</em>,
<em>/usr/bin</em>, or any of the other <em>bin</em> (binary) directories.</p>

<p><a data-type="xref" href="#table-common-umask">Table 6-8</a> lists some commonly used umask <a data-type="indexterm" data-primary="files" data-secondary="permissions" data-tertiary="default" data-startref="file-permission-default" id="idm46466160174120"/><a data-type="indexterm" data-primary="permissions" data-secondary="for files" data-tertiary="default" data-secondary-sortas="files" data-startref="permission-file-default" id="idm46466160172728"/><a data-type="indexterm" data-primary="directories" data-secondary="permissions" data-tertiary="default" data-startref="directory-permission-default" id="idm46466160170936"/><a data-type="indexterm" data-primary="permissions" data-secondary="for directories" data-tertiary="default" data-secondary-sortas="directories" data-startref="permission-directory-default" id="idm46466160169352"/><a data-type="indexterm" data-primary="default permissions" data-startref="default-permission" id="idm46466160167496"/><a data-type="indexterm" data-primary="umask command" data-startref="umask" id="idm46466160166424"/>values.</p>
<table id="table-common-umask">
<caption><span class="label">Table 6-8. </span>Common umask values</caption>
<thead>
<tr>
<th>umask</th>
<th>Directories</th>
<th>Files</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>0002</p></td>
<td><p>0775</p></td>
<td><p>0664</p></td>
</tr>
<tr>
<td><p>0022</p></td>
<td><p>0755</p></td>
<td><p>0644</p></td>
</tr>
<tr>
<td><p>0007</p></td>
<td><p>0770</p></td>
<td><p>0660</p></td>
</tr>
<tr>
<td><p>0077</p></td>
<td><p>0700</p></td>
<td><p>0600</p></td>
</tr>
</tbody>
</table>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160152424">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chmod</em></p>
</li>
<li>
<p>See the Shell Builtin Commands section of <em>man 1 bash</em> to learn more about
<em>umask</em> and other Bash built-in commands</p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.16 Creating Shortcuts (Soft and Hard Links) to Files &#10;and Directories"><div class="sect1" id="idm46466160147768">
<h1>6.16 Creating Shortcuts (Soft and Hard Links) to Files 
<span class="keep-together">and Directories</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160146712">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="files" data-secondary="soft/hard links" id="file-links"/><a data-type="indexterm" data-primary="directories" data-secondary="soft links" id="directory-link"/><a data-type="indexterm" data-primary="soft links" id="soft-link"/><a data-type="indexterm" data-primary="hard links" id="hard-link"/><a data-type="indexterm" data-primary="shortcuts to files/directories" id="shortcut-file-directory"/><a data-type="indexterm" data-primary="links to files/directories" id="links-files-directories"/><a data-type="indexterm" data-primary="ln command" id="ln-command"/><a data-type="indexterm" data-primary="symlinks" id="symlink"/>want to create shortcuts or links to files.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160135672">
<h2>Solution</h2>

<p>There are two types of links in Linux: soft links and hard links. Soft links
are for files and directories. Hard links are only for files.</p>

<p>Use the <em>ln</em> (link) command to create soft and hard links. The
following example creates a soft link to an external directory,
<em>/files/userstuff</em>, in Mad Max’s home directory:</p>
<pre>$ <strong>ln -s /files/userstuff stuff</strong></pre>

<p><em>/files/userstuff</em> is the target, and <em>stuff</em> is the destination, or
soft link name. You can name your soft links anything you want, and move and
delete them without affecting their targets. When you open a soft link, it
behaves the same way as opening the target.</p>

<p>Hard links are copies of files. The default for the <em>ln</em> command is to create
hard links:</p>
<pre>$ <strong>ln /files/config1.txt myconf.txt</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160129448">
<h2>Discussion</h2>

<p>Soft links are for files and directories, while hard links are only for files.</p>










<section data-type="sect3" data-pdf-bookmark="Soft links"><div class="sect3" id="idm46466160128488">
<h3>Soft links</h3>

<p>Soft links are more commonly called <em>symlinks</em>, short for symbolic links.</p>

<p>Symlinks point to files and directories. When the target of a symlink is deleted, renamed,
or moved, the symlink is broken. If you create a new file with the same name as
the deleted file, the symlink is restored, even if the content is different.</p>

<p>Symlinks can cross filesystems. You can even create symlinks to files or
directories that are not permanently available, like USB storage devices
or network file shares.</p>

<p>Symlinks are not updated when the target changes (renamed, moved, or deleted). You
need to create a new symlink and delete the old one.</p>

<p>You don’t manage permissions or ownership on symlinks because only the permissions
on the target matter.</p>

<p>Symlinks look like this:</p>
<pre>$ <strong>stat stuff</strong>
  File: stuff -&gt; /files/userstuff
  Size: 4               Blocks: 0          IO Block: 4096   symbolic link
Device: 804h/2052d      Inode: 877581      Links: 1
Access: (0777/lrwxrwxrwx)  Uid: ( 1000/ madmax) Gid: ( 1000/ madmax)</pre>

<p><em>File: stuff → /files/userstuff</em> shows the target that the symlink points to.</p>

<p>The third line identifies this as a symbolic link.</p>

<p>The <em>l</em> in <em>Access: lrwxrwxrwx</em> identifies this as a symlink.</p>

<p>This is what a symlink looks like in a file listing:</p>
<pre>$ <strong>ls -l</strong>
[...]
lrwxrwxrwx 1 madmax madmax  4 Apr 26 12:42 stuff -&gt; /files/userstuff
</pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Hard links"><div class="sect3" id="idm46466160127944">
<h3>Hard links</h3>

<p>Files are uniquely <a data-type="indexterm" data-primary="inodes" id="inodes"/>identified by <em>inodes</em>, and inodes are what hard links point
to, rather than filenames. The <em>ls</em> command <a data-type="indexterm" data-primary="ls command" id="idm46466160114120"/>shows inodes with the <em>-i</em> option.
The inode in this example is 1353, and it is the same for the three hard links:</p>
<pre>$ <strong>ls -li</strong>
1353 -rw-rw-r--   3 madmax madmax  11208 Apr 26 13:06  config.txt
1353 -rw-rw-r--   3 madmax madmax  11208 Apr 26 13:06  config2.txt
1353 -rw-rw-r--   3 madmax madmax  11208 Apr 26 13:06  config3.txt</pre>

<p>This is because all three inodes point to the same block of data.</p>

<p>Hard links always work because they point directly to inodes. Files with multiple
hard links can be moved, renamed, and edited, and all hard links remain in sync
because they all point to the same data block.</p>

<p>Every file on a Linux system starts with a hard link. When you create a hard link,
you are creating a new filename for an existing data block.</p>

<p>Hard links cannot cross filesystems, but exist only inside a single filesystem.
For example, if you have <em>/</em> and <em>/home</em> on separate partitions, you cannot make
hard links in <em>/home</em> for files in <em>/</em>.</p>

<p>You can make as many hard links to a file as you like, and the disk space
occupied by the data they point to is always the same, regardless of how many
hard links it has.</p>

<p>Contrast hard links with making file copies: every copy uses more disk space,
each copy is independent, and copies can go anywhere.</p>

<p>A file is not completely deleted until all hard links are deleted. You can see
this with <em>ls</em>. The following example shows another view of our example inode
with three hard links:</p>
<pre>$ <strong>stat config3.txt</strong>
  File: config3.txt
  Size: 11208           Blocks: 24         IO Block: 4096   regular file
Device: 804h/2052d      Inode: 1353        Links: 3</pre>

<p>Compare the File, Size, and Links to a symlink. A hard link is a
regular file, and note Links: 3. This shows there are three hard links to
the same data. When you delete a file with more than one hard link, it is not deleted
until you delete all of them. Locate all related hard links with<a data-type="indexterm" data-primary="find command" data-secondary="hard links" id="idm46466160103320"/> the <em>find</em> command:</p>
<pre>$ <strong>find <i>/etc</i> -xdev -samefile <i>config3.txt</i></strong>
./config
./config2
./config3</pre>

<p>Symlinks are used a lot in Linux, hard links not so much. Some backup applications
use inodes for deduplication. In olden times, when
filesystems were much smaller, running out of inodes was not uncommon. In
this case hard links were preferable, because symlinks each have their own inodes,
but hard links share inodes.</p>

<p>You can see how many inodes a filesystem has with<a data-type="indexterm" data-primary="du command" id="idm46466160097688"/> the <em>du</em> command, and how
many are used:</p>
<pre>$ <strong>df -i /dev/sda4</strong>
Filesystem        Inodes  IUsed     IFree IUse% Mounted on
/dev/sda4      384061120 389965 383671155    1% /home</pre>

<p>With 1% in use, I’m not running out of inodes anytime <a data-type="indexterm" data-primary="inodes" data-startref="inodes" id="idm46466160096408"/><a data-type="indexterm" data-primary="files" data-secondary="soft/hard links" data-startref="file-links" id="idm46466160094104"/><a data-type="indexterm" data-primary="directories" data-secondary="soft links" data-startref="directory-link" id="idm46466160092520"/><a data-type="indexterm" data-primary="soft links" data-startref="soft-link" id="idm46466160091432"/><a data-type="indexterm" data-primary="hard links" data-startref="hard-link" id="idm46466160090584"/><a data-type="indexterm" data-primary="shortcuts to files/directories" data-startref="shortcut-file-directory" id="idm46466160089544"/><a data-type="indexterm" data-primary="links to files/directories" data-startref="links-files-directories" id="idm46466160088504"/><a data-type="indexterm" data-primary="ln command" data-startref="ln-command" id="idm46466160087464"/><a data-type="indexterm" data-primary="symlinks" data-startref="symlink" id="idm46466160086392"/>soon.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160096200">
<h2>See Also</h2>

<ul>
<li>
<p>man 1 ls</p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.17 Hiding Files and Directories"><div class="sect1" id="idm46466160083336">
<h1>6.17 Hiding Files and Directories</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466160082472">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="files" data-secondary="hiding" id="file-hide"/><a data-type="indexterm" data-primary="directories" data-secondary="hiding" id="directory-hide"/><a data-type="indexterm" data-primary="hiding files/directories" id="hide-file-directory"/> want to hide some files and directories so that nobody can see them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466160077880">
<h2>Solution</h2>

<p>To hide files so nobody can see them, put them on a storage device only you have
access to.</p>

<p>To reduce clutter in your file manager,<a data-type="indexterm" data-primary="dot files" id="idm46466160075752"/> use <em>dot files</em> to ignore
files. You already have these. Look for a setting like “Show hidden files” in
your graphical file manager, or use the <em>-a</em> option for <em>ls</em>:</p>
<pre>$ <strong>ls -a</strong>
.
..
Audiobooks
.bash_history
.bash_logout
.bashrc
bin
.bogofilter
.cache
Calibre-Library
cat-memes
.cddb
.cert</pre>

<p>Prefixing any file with a dot makes it a hidden file, though it is really not hidden,
but ignored until you want to see it. This is used mainly in users’ home directories
to reduce clutter by not displaying configuration files. These are normal
files you can edit, delete, or whatever you want.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466160077576">
<h2>Discussion</h2>

<p>Note the single and double dots at the top of the file list. The single dot
represents the current directory, and the double dot represents the parent directory.
Try it with <a data-type="indexterm" data-primary="cd command" id="idm46466160067208"/>the <em>cd</em> command. The first example stays in the current directory,
the second example changes to the parent directory:</p>
<pre>stash@client4:~$ <strong>cd .</strong>
stash@client4:~$

stash@client4:~$ <strong>cd ..</strong>
stash@client4:/home$</pre>

<p>Run <em>cd</em> with no options to return to your home directory, or <em>cd -</em> to return
to the last directory you<a data-type="indexterm" data-primary="files" data-secondary="hiding" data-startref="file-hide" id="idm46466160069800"/><a data-type="indexterm" data-primary="directories" data-secondary="hiding" data-startref="directory-hide" id="idm46466160064568"/><a data-type="indexterm" data-primary="hiding files/directories" data-startref="hide-file-directory" id="idm46466160063448"/> were in.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466160062104">
<h2>See Also</h2>

<ul>
<li>
<p>See the Shell Builtin Commands section of <em>man 1 bash</em> to learn more about
<em>cd</em> and other Bash built-in commands</p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>