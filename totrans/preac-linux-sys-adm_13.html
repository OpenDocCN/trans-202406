<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 13. Securing Your System" data-type="chapter" epub:type="chapter"><div class="chapter" id="securing_your_system">
<h1><span class="label">Chapter 13. </span>Securing Your System</h1>
<p>System security <a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-type="indexterm" id="ix_secsys"/>is the application of configurations, software, policies, rules, and best practices to a system (whether it’s new or years old) so that the system operates without significant downtime due to security breaches and compromises. As a system administrator, security is your most important and time-consuming task.</p>
<p>This chapter concentrates on the prevention of security problems. Discovery and mitigation are briefly covered. You will learn how to secure both newly deployed systems and systems that have been in operation for years. No single treatment is comprehensive because new threats and vulnerabilities arise on what seems like a daily basis. You will learn how to apply basic security settings to your Linux systems. Because many larger companies have their own standards, the security settings I recommend are a good place to start, but you should always comply with corporate security protocols and policies.</p>
<section data-pdf-bookmark="Protecting the Root Account" data-type="sect1"><div class="sect1" id="protecting_the_root_account">
<h1>Protecting the Root Account</h1>
<p>The root user account is the all-powerful account on every Linux system, and you must protect access to it. <a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-tertiary="protecting the root account" data-type="indexterm" id="idm45657872061472"/><a contenteditable="false" data-primary="root user" data-secondary="protecting the root account" data-type="indexterm" id="idm45657872200768"/>If someone compromises this account, they can lock you out, destroy the system, steal data, or maintain control of it and use it to pivot to and compromise other systems within your network.<a contenteditable="false" data-primary="passwords" data-secondary="using keys instead of for authentication" data-type="indexterm" id="idm45657872200640"/> Never write down or share the root password with anyone outside the system administrators group. If you use a database or other secure password manager to generate and store passwords, ensure that you exercise extreme security measures around those applications.</p>
<p>Beyond the protection of regular user accounts (with password complexity, length, and expiration), you have the ultimate responsibility of protecting the root account as a system administrator. <a contenteditable="false" data-primary="users" data-secondary="protecting user accounts" data-type="indexterm" id="idm45657872078176"/>System user account passwords can be shared, written down, stolen via phishing, or given verbally to someone attempting to exploit a user via social engineering tactics. <a contenteditable="false" data-primary="public/private keys" data-secondary="using keys instead of passwords for authentication" data-type="indexterm" id="idm45657872114112"/>For these reasons, passwords, no matter how complex, are still vulnerable to many different types of attacks and should be replaced with passwordless key files, whose creation and use are covered later in this chapter.</p>
<p>The next section helps you understand the balance you must find and maintain between securing a system and locking it down so tightly that users will be tempted to circumvent security altogether by creating rogue systems or local virtual machines that likely have little to no security measures in place.</p>
</div></section>
<section data-pdf-bookmark="Finding the Balance Between Security and Usability" data-type="sect1"><div class="sect1" id="finding_the_balance_between_security_an">
<h1>Finding the Balance Between Security and Usability</h1>
<p>As we’ve established, security is your greatest responsibility. However, you must also support usable systems. <a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-tertiary="finding balance between security and usability" data-type="indexterm" id="ix_secsysbal"/>The most secure system is powered off and locked away, but it’s also not usable. Therefore, you have to strike a balance between a system that is secure for everyone and one that’s also usable.</p>
<p>Systems must have users, software, files, and network connections to be useful. All of these make your system less secure but more usable.</p>
<p>Your job is to do the following:</p>
<ul class="list_style_type_none">
<li>
<p>Maintain systems so they’re secure from over-the-network attacks</p>
</li>
<li>
<p>Protect the system from careless users</p>
</li>
<li>
<p>Protect users from one another</p>
</li>
<li>
<p>Protect the system’s configurations and data from everyone except those with appropriate access granted to them.</p>
</li>
</ul>
<p>In the following sections, you’ll learn how to perform these functions.</p>
<section data-pdf-bookmark="Minimizing Your System’s Attack Surface" data-type="sect2"><div class="sect2" id="minimizing_your_systemapostrophes_attac">
<h2>Minimizing Your System’s Attack Surface</h2>
<p>Have you ever seen a reenactment of a duel on television or in a movie? <a contenteditable="false" data-primary="attack surface, minimizing for your system" data-type="indexterm" id="ix_attck"/>Notice that the participants turn sideways to each another with one arm outstretched and holding the dueling pistol while holding the other hand behind them. This “dueling” stance minimizes their exposed shootable surface, making them harder to hit. By decreasing the target size, you also decrease the chances of a fatal strike. You should protect your systems by decreasing their attackable surface in the same way, exposing only what you must to support normal user operation.</p>
<p>You must carefully select which services to install when installing a new system.<a contenteditable="false" data-primary="installation" data-secondary="minimal installs" data-type="indexterm" id="idm45657873690384"/> For example, when I install a Red Hat–based server system, I use a minimal installation option that usually includes only the SSH service. I add services and packages as required to keep my systems’ footprints purposely small and focused on a single task.<a contenteditable="false" data-primary="GUIs (graphical user interfaces)" data-secondary="security vulnerabilities" data-type="indexterm" id="idm45657872343968"/> I never install a graphical user interface (GUI) or graphical display manager onto a server system because of the security vulnerabilities inherent in these user-friendly interfaces.</p>
<section data-pdf-bookmark="Checking for and removing a GUI" data-type="sect3"><div class="sect3" id="checking_for_and_removing_a_gui">
<h3>Checking for and removing a GUI</h3>
<p>To check if your system has a<a contenteditable="false" data-primary="attack surface, minimizing for your system" data-secondary="checking for and removing system GUI" data-type="indexterm" id="idm45657872049344"/> graphical display manager, issue <a contenteditable="false" data-primary="GUIs (graphical user interfaces)" data-secondary="system, checking for and removing" data-type="indexterm" id="idm45657872036208"/>the <a contenteditable="false" data-primary="systemctl utility" data-secondary="systemctl get-default command" data-type="indexterm" id="idm45657872050672"/>following <span class="keep-together">command:</span></p>
<pre data-type="programlisting">
$ systemctl get-default
multi-user.target</pre>
<p>If the response is anything but <code>multi-user.target</code>, run the <a contenteditable="false" data-primary="multi-user.target graphical display manager" data-type="indexterm" id="idm45657872028160"/>following command to<a contenteditable="false" data-primary="systemctl utility" data-secondary="systemctl set-default multi-user.target" data-type="indexterm" id="idm45657872027024"/> correct it:</p>
<pre data-type="programlisting">
$ sudo systemctl set-default multi-user.target</pre>
<p>Check <a contenteditable="false" data-primary="rpm package manager" data-secondary="rpm -qa | grep xorg | grep server" data-type="indexterm" id="idm45657872024416"/>for the <a contenteditable="false" data-primary="grep command" data-secondary="grep xorg | grep server, filtering rpm -qa output" data-type="indexterm" id="idm45657872022912"/>installation of a GUI or graphical display manager:</p>
<pre data-type="programlisting">
$ rpm -qa | grep xorg | grep server</pre>
<p>If you receive any response, it might look similar to the following:</p>
<pre data-type="programlisting">
xorg-x11-server-utils-7.7-27.el8.x86_64</pre>
<p>You might also see packages similar to <code>xorg-x11-server-common</code> and <code>xorg-x11-server-utils</code>. If you see any of these packages, issue the following command to remove them. <a contenteditable="false" data-primary="xorg-x11-server-utils package" data-type="indexterm" id="idm45657872016640"/><a contenteditable="false" data-primary="xorg-x11-server-common package" data-type="indexterm" id="idm45657872015568"/><a contenteditable="false" data-primary="YUM/DNF utility" data-secondary="yum remove command" data-type="indexterm" id="idm45657872014496"/>Use the specific package name corresponding to your system’s installed package:</p>
<pre data-type="programlisting">
$ sudo yum remove xorg-x11-server-Xorg \
xorg-x11-server-common xorg-x11-server-utils</pre>
</div></section>
<section data-pdf-bookmark="Creating single-purpose systems" data-type="sect3"><div class="sect3" id="creating_single_purpose_systems">
<h3>Creating single-purpose systems</h3>
<p>At a minimum, each of your systems needs an SSH server. <a contenteditable="false" data-primary="attack surface, minimizing for your system" data-secondary="creating single-purpose systems" data-type="indexterm" id="idm45657872010064"/><a contenteditable="false" data-primary="single-purpose systems, creating" data-type="indexterm" id="idm45657872008784"/>It’s a secure method of connecting and managing systems. Unused services make your system vulnerable and are entry points for system- and network-wide compromise.<a contenteditable="false" data-primary="networks" data-secondary="security vulnerability from unused services" data-type="indexterm" id="idm45657872011472"/> You should install your systems using a server or a minimal install option and add services as required after installation and setup.</p>
<p>If your distribution doesn’t have a server or minimal install option, then you must selectively uninstall any service or software package that isn’t explicitly required for the system’s prescribed purpose. Let’s examine how to create systems with a single purpose.</p>
<p>Virtualization and cloud computing have allowed businesses to focus on a single service per system.<a contenteditable="false" data-primary="virtualization, allowing single services per system" data-type="indexterm" id="idm45657872184320"/><a contenteditable="false" data-primary="cloud computing" data-secondary="allowing single services per system" data-type="indexterm" id="idm45657872003280"/> Because of hardware costs, we used physical systems as servers rather than virtualization hosts and had to stack multiple services on a single system. Virtualization host systems can serve dozens of virtual machines or hundreds of container systems, each performing a single business task, such as a web server, database server, or application server.</p>
<p>Building a system that hosts a single service is much easier than paring down one that has existed for some time. However, as part of your system administrator duties, you should perform security “sweeps” of any system under your management. <a contenteditable="false" data-primary="security sweep or audit of single-service systems" data-type="indexterm" id="idm45657872327744"/>And a security sweep or audit includes examining the system for unused and outdated services that cause it to be vulnerable to attack.<a contenteditable="false" data-primary="grep command" data-secondary="filtering netstat -an output" data-type="indexterm" id="idm45657872324096"/><a contenteditable="false" data-primary="netstat -an command" data-type="indexterm" id="idm45657872006240"/> A security sweep consists of checking listening ports on the local machine using the following commands:</p>
<pre data-type="programlisting">
$ netstat -an | grep LISTEN | grep tcp
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN    

$ netstat -an | grep LISTEN | grep udp</pre>
<p>These two commands provide a list of listening daemons (services).<a contenteditable="false" data-primary="listening daemons (services), listing" data-type="indexterm" id="idm45657872093680"/> The interface <code>0.0.0.0</code> is all interfaces. Services accessible only on the local system listen on <code>127.0.0.1</code> (<code>localhost</code> or <code>loopback</code>). Malicious actors often set up an exfiltration service disguised as a web service, DNS service, or other legitimate service to fool system administrators and port scanners. You should check the legitimacy of all listening processes on your systems:</p>
<pre data-type="programlisting">
$ netstat -an | grep LISTEN | grep tcp
tcp        0      0 127.0.0.1:80            0.0.0.0:*               LISTEN    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN</pre>
<p>For example in the <em>/etc/httpd/conf/httpd.conf</em> file (or your specific Apache configuration file), there are two possible configurations, but you may only use one or the other. <a contenteditable="false" data-primary="/etc/httpd/conf/httpd.conf file" data-primary-sortas="etc" data-type="indexterm" id="idm45657872339584"/><a contenteditable="false" data-primary="httpd.conf file" data-type="indexterm" id="idm45657871995248"/>You must comment the one you don’t wish to use. Here is the excerpt from <em>httpd.conf</em>:</p>
<pre data-type="programlisting">
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, instead of the default. See also the &lt;VirtualHost&gt;
# directive.
#
# Change this to Listen on specific IP addresses as shown below to
# prevent Apache from glomming onto all bound IP addresses.
#
Listen 127.0.0.1:80
#Listen 80</pre>
<p>You may specify a particular network interface and port (<code>Listen 127.0.0.1:80</code>) or a port to listen on all interfaces (<code>Listen 80</code>). The former configuration ensures that only local system users may use the web service. While a local-only web server isn’t very practical, it illustrates how to limit access to a network service.</p>
<p>You should perform an <code>autoremove</code> to remove unused software from your system:</p>
<pre data-type="programlisting">
$ sudo yum autoremove
$ sudo apt autoremove</pre>
<p>This command removes any leftover software package dependencies from an incomplete uninstall or insufficient package removal cleanup.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Remember that enabling any over-the-network listening daemon or service puts your system at potential risk. Protect all services with secure protocols, firewalls, access control lists, and IP restrictions as necessary.</p>
</div>
<p>The next section discusses security for user accounts.<a contenteditable="false" data-primary="attack surface, minimizing for your system" data-startref="x_attck" data-type="indexterm" id="idm45657872046672"/> </p>
</div></section>
</div></section>
<section data-pdf-bookmark="Creating and Securing User Accounts" data-type="sect2"><div class="sect2" id="creating_and_securing_user_accounts">
<h2>Creating and Securing User Accounts</h2>
<p>As soon as you create a user account on your system, your system’s security is weakened. <a contenteditable="false" data-primary="users" data-secondary="creating and securing user accounts" data-type="indexterm" id="ix_usracctcrsec"/>However, as you know, user accounts are a requirement. It is a rare system with no user accounts other than the root account. Service accounts are common user accounts, even with no interactive shell. Having no shell means no one may interactively log in as that user and issue shell commands. Most systems have interactive shell user accounts so that regular users may log in and issue commands, compile software, connect to other systems, and use resources such as storage and data.</p>
<p>The biggest problem with interactive user accounts is weak passwords. <a contenteditable="false" data-primary="passwords" data-secondary="security vulnerabilities" data-type="indexterm" id="idm45657872034336"/>Weak passwords threaten your system’s security. There are at least two methods of mitigating this problem.<a contenteditable="false" data-primary="authentication" data-secondary="using key files or multifactor authentication" data-type="indexterm" id="idm45657871987904"/> One is to set up your system to require strong passwords by creating and enforcing a strong password policy. Another is to disable password use in favor of SSH key files so that users can connect to other systems without a password.<a contenteditable="false" data-primary="MFA (multifactor authentication)" data-type="indexterm" id="idm45657871988160"/><a contenteditable="false" data-primary="multifactor authentication (MFA)" data-type="indexterm" id="idm45657872325536"/> You can also configure multifactor authentication (MFA) using various free or commercial tools. MFA implementation is beyond the scope of this book.</p>
<section data-pdf-bookmark="Creating and enforcing a strong password policy" data-type="sect3"><div class="sect3" id="creating_and_enforcing_a_strong_passwor">
<h3>Creating and enforcing a strong password policy</h3>
<p>On Red Hat <a contenteditable="false" data-primary="users" data-secondary="creating and securing user accounts" data-tertiary="using strong password policy" data-type="indexterm" id="idm45657871977648"/>Enterprise Linux–based <a contenteditable="false" data-primary="passwords" data-secondary="creating and enforcing strong password policy" data-type="indexterm" id="idm45657871975376"/>systems, the <em>/etc/security/pwquality.conf</em> file is the configuration file that allows system administrators to set and enforce corporate password policies. <a contenteditable="false" data-primary="/etc/security/pwquality.conf file" data-primary-sortas="etc" data-type="indexterm" id="idm45657871972848"/><a contenteditable="false" data-primary="Red Hat Enterprise Linux" data-secondary="configuration file for sysadmins to set and enforce password policies" data-type="indexterm" id="idm45657871972080"/>The following is a complete listing of that file:</p>
<pre class="widows14" data-type="programlisting">
# Configuration for systemwide password quality limits
# Defaults:
#
# Number of characters in the new password that must not be present in the
# old password.
# difok = 1
#
# Minimum acceptable size for the new password (plus one if
# credits are not disabled which is the default). (See pam_cracklib manual.)
# Cannot be set to lower value than 6.
# minlen = 8
#
# The maximum credit for having digits in the new password. If less than 0
# it is the minimum number of digits in the new password.
# dcredit = 0
#
# The maximum credit for having uppercase characters in the new password.
# If less than 0 it is the minimum number of uppercase characters in the new
# password.
# ucredit = 0
#
# The maximum credit for having lowercase characters in the new password.
# If less than 0 it is the minimum number of lowercase characters in the new
# password.
# lcredit = 0
#
# The maximum credit for having other characters in the new password.
# If less than 0 it is the minimum number of other characters in the new
# password.
# ocredit = 0
#
# The minimum number of required classes of characters for the new
# password (digits, uppercase, lowercase, others).
# minclass = 0
#
# The maximum number of allowed consecutive same characters in the new password.
# The check is disabled if the value is 0.
# maxrepeat = 0
#
# The maximum number of allowed consecutive characters of the same class in the
# new password.
# The check is disabled if the value is 0.
# maxclassrepeat = 0
#
# Whether to check for the words from the passwd entry GECOS string of the user.
# The check is enabled if the value is not 0.
# gecoscheck = 0
#
# Whether to check for the words from the cracklib dictionary.
# The check is enabled if the value is not 0.
# dictcheck = 1
#
# Whether to check if it contains the user name in some form.
# The check is enabled if the value is not 0.
# usercheck = 1
#
# Length of substrings from the username to check for in the password
# The check is enabled if the value is greater than 0 and usercheck is enabled.
# usersubstr = 0
#
# Whether the check is enforced by the PAM module and possibly other
# applications.
# The new password is rejected if it fails the check and the value is not 0.
# enforcing = 1
#
# Path to the cracklib dictionaries. Default is to use the cracklib default.
# dictpath =
#
# Prompt user at most N times before returning with error. The default is 1.
# retry = 3
#
# Enforces pwquality checks on the root user password.
# Enabled if the option is present.
# enforce_for_root
#
# Skip testing the password quality for users that are not present in the
# /etc/passwd file.
# Enabled if the option is present.
# local_users_only</pre>
</div></section>
<section data-pdf-bookmark="Connecting to other systems via passwordless key files" data-type="sect3"><div class="sect3" id="connecting_to_other_systems_via_passwor">
<h3>Connecting to other systems via passwordless key files</h3>
<p>Capturing passwords through packet sniffing or keylogger programs is a common method of compromising systems when unsuspecting users connect from one system to another using passwords.<a contenteditable="false" data-primary="users" data-secondary="creating and securing user accounts" data-tertiary="connecting to other systems via passwordless key files" data-type="indexterm" id="ix_usracctseckeys"/><a contenteditable="false" data-primary="passwords" data-secondary="using passwordless key files to connect to other systems" data-type="indexterm" id="idm45657871962768"/><a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-type="indexterm" id="idm45657871961408"/> One of the best methods of password capture prevention is to discontinue the use of passwords altogether. Using key files, users may connect from one system to another without the need to interactively enter a password.</p>
<p>Setting up key files between systems is trivial but a little time-consuming. Ultimately, it increases security because no passwords are traveling across networks, written on sticky notes, or so simple that anyone can guess them.</p>
<section data-pdf-bookmark="Creating the key file" data-type="sect4"><div class="sect4" id="creating_the_key_file">
<h4>Creating the key file</h4>
<p>Remote login via key files provides you with a more secure connection between remote systems than using passwords.<a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-tertiary="creating the key file" data-type="indexterm" id="idm45657871954976"/>  Without going into great detail about how private/public key authentication works, which you can certainly research on your own, realize that using key files doesn’t pass an encrypted or unencrypted password to another system. There is no usable data (passwords) for an attacker to capture, so brute-force attacks against encrypted information aren’t possible. Creating a private/public key pair is easy.</p>
<p>The following example uses two Linux systems, <code>server1</code> and <code>server2</code>. You can see in the following code that you haven’t configured remote login via key files between these two systems:</p>
<pre class="pagebreak-after" data-type="programlisting">
[khess@server1 ~]$ ssh server2
The authenticity of host 'server2 (192.168.1.20)' can't be established.
ECDSA key fingerprint is SHA256:dh2YOMWKu2pF/SivS++Y1u1FaE9LcadCKIl6shlSUuc.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'server2' (ECDSA) to the list of known hosts.
khess@server2's password:
Last login: Thu Aug 11 08:12:06 2022 from 192.168.1.234
[khess@server2 ~]$</pre>
<p>Run the following commands on both <a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-tertiary="commands on both computers to set up key pair" data-type="indexterm" id="idm45657872068720"/>systems to set up your private/public key pair <a contenteditable="false" data-primary="ssh-keygen -t ecdsa -b command" data-type="indexterm" id="idm45657871946976"/>between these two:</p>
<pre data-type="programlisting">
[khess@server1 ~]$ ssh-keygen -t ecdsa -b 521
Generating public/private ecdsa key pair.
Enter file in which to save the key (/home/khess/.ssh/id_ecdsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/khess/.ssh/id_ecdsa.
Your public key has been saved in /home/khess/.ssh/id_ecdsa.pub.
The key fingerprint is:
SHA256:KGNaYYxQXO46dm2J7/8960FLAYQ5mb3e+wgRghX4BUk khess@server1
The key's randomart image is:
+---[ECDSA 521]---+
|.o...  oE@o      |
| ..+  .oB o.     |
|  . = ...o...    |
|   o . ..... .   |
|    * . S...o    |
|   = = .  .+..   |
|  = o +   . o.   |
| . o o     ooo   |
|     .o.....=+.  |
+----[SHA256]-----+</pre>
<p>The default <a contenteditable="false" data-primary="encryption algorithms" data-type="indexterm" id="idm45657871945216"/>encryption algorithm is RSA, but both RSA and DSA algorithms are old, and you shouldn’t use them. <a contenteditable="false" data-primary="DSA encryption algorithm" data-type="indexterm" id="idm45657871942048"/><a contenteditable="false" data-primary="RSA encryption algorithm" data-type="indexterm" id="idm45657871941312"/>The newer elliptical curve digital signature algorithm (ECDSA) is currently the best option. <a contenteditable="false" data-primary="ECDSA (elliptical curve digital signature algorithm)" data-type="indexterm" id="idm45657871939664"/><a contenteditable="false" data-primary="elliptical curve digital signature algorithm (ECDSA)" data-type="indexterm" id="idm45657871938928"/>And while this algorithm accepts 256- and 384-bit encryption, use 521 for maximum protection. You may optionally provide a passphrase to protect your key file pair further. Providing a passphrase ensures that even if your private key is stolen, it can’t be used without the passphrase.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The three available key sizes are 256, 384, and 521. No, the <code>521</code> you see in the command isn’t an error.<a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-tertiary="key sizes" data-type="indexterm" id="idm45657872282432"/> One would think the next available key size would be 512, but for ECDSA, it is 521.</p>
</div>
<p>Copy the ID from one server <a contenteditable="false" data-primary="ssh-copy-id command" data-type="indexterm" id="idm45657871947504"/>to another using the following command:</p>
<pre class="pagebreak-after" data-type="programlisting">
[khess@server1 ~]$ ssh-copy-id server2
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/khess/.ss...
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filte...
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prom...
khess@server2's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'server2'"
and check to ensure that only the key(s) you wanted were added.</pre>
<p>As the <a contenteditable="false" data-primary="logging in from one server to another server without  password" data-type="indexterm" id="idm45657871929968"/>message suggests, try to log into <code>server2</code>:</p>
<pre data-type="programlisting">
[khess@server1 ~]$ ssh server2
Last login: Fri Aug 12 14:10:46 2022 from 192.168.1.80
[khess@server2 ~]$</pre>
<p>You have successfully created the key pair and may now log in from <code>server1</code> to <code>server2</code> without a password. Your next question should be, “Is this passwordless login only valid from <code>server1</code> to <code>server2</code> (unidirectional), or is it bidirectional (<code>server2</code> to <code>server1</code>)?”</p>
<p>To answer the question, try to log in from <code>server2</code> to <code>server1</code>:</p>
<pre data-type="programlisting">
[khess@server2 ~]$ ssh server1
The authenticity of host 'server1 (192.168.1.80)' can't be established.
ECDSA key fingerprint is SHA256:Aim3J/cp24ZIneGzoNyZpf3kWG17ZRrMQVicvOQRyPM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.1.80' (ECDSA) to the list of known hosts.
khess@192.168.1.80's password:

Last login: Thu Aug 11 08:08:04 2022 from 192.168.1.234
[khess@server1 ~]$</pre>
<p>The answer is no. The key pair is unidirectional. <a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-tertiary="logging in bidirectionally between servers" data-type="indexterm" id="idm45657871920224"/>To set up a reciprocal login (<code>server2</code> to <code>server1</code>), you must repeat the process for <code>server2</code>:</p>
<pre class="widows11" data-type="programlisting">
[khess@server2 ~]$ ssh-keygen -t ecdsa -b 521
Generating public/private ecdsa key pair.
Enter file in which to save the key (/home/khess/.ssh/id_ecdsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/khess/.ssh/id_ecdsa
Your public key has been saved in /home/khess/.ssh/id_ecdsa.pub
The key fingerprint is:
SHA256:nlHb2YUMzW29H7XrZvubiP0RK8DnkB+I3bff9TBHsTo khess@server2
The key's randomart image is:
+---[ECDSA 521]---+
|            .o ..|
|             oo.=|
|          .   oo=|
|         .+o+o =o|
|        S..Bo+.+=|
|       . o  * +o=|
|        o    E++o|
|            o +BB|
|           . o+=O|
+----[SHA256]-----+

[khess@server2 ~]$ ssh-copy-id server1
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/khess/.ss...
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filte...
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prom...
khess@server1's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'server1'"
and check to make sure that only the key(s) you wanted were added.

[khess@server2 ~]$ ssh server1

Last login: Sun Aug 14 10:35:42 2022 from 192.168.1.20
[khess@server1 ~]$</pre>
<p>You may now connect bidirectionally between <code>server1</code> and <code>server2</code> using key pair authentication. <a contenteditable="false" data-primary="encryption, learning more about" data-type="indexterm" id="idm45657871914432"/><a contenteditable="false" data-primary="SSH" data-secondary="learning more about" data-type="indexterm" id="idm45657871913296"/>If you want to learn more about SSH, encryption protocols, and security-related topics, please visit the <a href="https://oreil.ly/ontmn">OpenSSH website</a>.</p>
</div></section>
<section data-pdf-bookmark="Adding extra security to SSHD" data-type="sect4"><div class="sect4" id="adding_extra_security_to_sshd">
<h4>Adding extra security to SSHD</h4>
<p>You should secure your SSHD by accepting key<a contenteditable="false" data-primary="public/private keys" data-secondary="connecting to other systems via passwordless key file" data-tertiary="adding extra security to SSHD" data-type="indexterm" id="idm45657871908864"/> file authentication if it’s not already set up. <a contenteditable="false" data-primary="SSH daemon (SSHD)" data-secondary="adding extra security to" data-type="indexterm" id="idm45657871906832"/>You can check by<a contenteditable="false" data-primary="passwords" data-secondary="enabling users to create key pairs for secure connectivity" data-type="indexterm" id="idm45657871909376"/> issuing the following command:</p>
<pre data-type="programlisting">
$ sudo grep -i pubkey /etc/ssh/sshd_config
#PubkeyAuthentication yes</pre>
<p>Uncomment this line and restart the SSHD service. If you filter on the word “password,” you will find the following line in <em>/etc/ssh/sshd_config</em>:</p>
<pre data-type="programlisting">
$ sudo grep -i password /etc/ssh/sshd_config
PasswordAuthentication yes</pre>
<p>This line allows users to connect and log in with a username and password. This line is a requirement for setting up key-based authentication. <a contenteditable="false" data-primary="PasswordAuthentication setting" data-type="indexterm" id="idm45657871901488"/>(Refer to the preceding subsection, where we saw that you must log in via username and password to copy your key to the remote system.)</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>If you change <code>PasswordAuthentication yes</code> to <code>Password​Authenti⁠cation no</code>, you will exclude users who do not already have their key-based authentication configured, because they will not be able to log in with a username and password. You’ll have to manually configure each user account unless you use some automation.</p>
</div>
<p>The preceding warning is one of those decision points that you must make as a system administrator—finding the balance between usability and security. On the one hand, your attempt to increase security by removing passwords from remote connectivity is admirable. Still, on the other hand, you must leave password authentication intact to enable users to create their key pairs for secure connectivity. My best advice is to disable passwords and handle the task for your users because if you leave this significant security step to your users, your systems may go unsecured for months or years. Should you decide not to disable password authentication, please increase password complexity, shorten the expiration interval to no more than 90 days, and enforce nonrepeated passwords.<a contenteditable="false" data-primary="users" data-secondary="creating and securing user accounts" data-startref="ix_usracctseckeys" data-tertiary="connecting to other systems via passwordless key files" data-type="indexterm" id="idm45657871980320"/><a contenteditable="false" data-primary="users" data-secondary="creating and securing user accounts" data-startref="ix_usracctcrsec" data-type="indexterm" id="idm45657873067232"/><a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-startref="ix_secsysbal" data-tertiary="finding balance between security and usability" data-type="indexterm" id="idm45657873064656"/></p>
</div></section>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Implementing Advanced Security Measures" data-type="sect1"><div class="sect1" id="implementing_advanced_security_measures">
<h1>Implementing Advanced Security Measures</h1>
<p>The definition of <em>advanced</em> is certainly up for debate. <a contenteditable="false" data-primary="security measures (advanced), implementing" data-type="indexterm" id="ix_secadv"/><a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-tertiary="implementing advanced security measures" data-type="indexterm" id="ix_secsysadv"/><a contenteditable="false" data-primary="STIG (Security Technical Implementation Guide)" data-type="indexterm" id="idm45657871878496"/>For me, advanced means security measures that generally conform to the Security Technical Implementation Guide (STIG) as described in the <a href="https://oreil.ly/E1G1b">National Institute of Standards and Technology (NIST) 800-53</a> and related documents. The so-called “STIGging” of a system protects it from over-the-network attacks and local system attacks.<a contenteditable="false" data-primary="Security Technical Implementation Guide" data-see="STIG" data-type="indexterm" id="idm45657871901040"/><a contenteditable="false" data-primary="STIGging of a system" data-type="indexterm" id="idm45657871874432"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Remember that even using STIG to secure a system is not a foolproof security method, but it’s a great standard for setting up new systems. It would be best to use it to secure your inherited systems.</p>
</div>
<p>STIGs are generally used for government contractor–owned systems involved in Department of Defense projects that must comply with strict data-handling regulations. <a contenteditable="false" data-primary="Red Hat Enterprise Linux" data-secondary="STIG for" data-type="indexterm" id="idm45657873709120"/>Still, they apply to any system, hosting sensitive data or not. It would help if you implemented as many of these items as practical, especially those in the high severity list. <a data-type="xref" href="#the_findings_and_severity_levels_of_the">Figure 13-1</a> shows each guideline’s number and severity for reference.</p>
<figure><div class="figure" id="the_findings_and_severity_levels_of_the"><img alt="" height="286" src="assets/plsa_1301.png" width="600"/>
<h6><span class="label">Figure 13-1. </span>The findings and severity levels of the Red Hat Enterprise Linux 8 STIG</h6>
</div></figure>
<p>The next section discusses applying these controls to your systems.</p>
<section data-pdf-bookmark="Applying STIG Security Controls" data-type="sect2"><div class="sect2" id="applying_stig_security_controls">
<h2>Applying STIG Security Controls</h2>
<p>Applying a list of STIG controls is a time-consuming task. <a contenteditable="false" data-primary="security measures (advanced), implementing" data-secondary="STIG security controls" data-type="indexterm" id="idm45657871863568"/><a contenteditable="false" data-primary="STIG (Security Technical Implementation Guide)" data-secondary="applying STIG security controls" data-type="indexterm" id="idm45657871862352"/>However, as you read through the controls, you’ll find that you can automate most configurations necessary to comply with the standard. And some STIGs provide you with downloadable scripts to make compliance easier. While the STIG shown in <a data-type="xref" href="#the_findings_and_severity_levels_of_the">Figure 13-1</a> is Red Hat Enterprise Linux–specific, these standards apply to all Linux distributions used in businesses and government offices. <a contenteditable="false" data-primary="Ubuntu" data-secondary="information on Ubuntu STIG" data-type="indexterm" id="idm45657871900896"/>Information related to an Ubuntu STIG is available on the <a href="https://oreil.ly/Bob4c">Ubuntu DISA page</a>.</p>
<p>If you create “golden” images for your systems, which I highly recommend, you can develop a STIG image with the security controls already in place. New, revised STIGs are released when necessary and usually contain only a few new security fixes that you can place on your systems via script or some automation tool. Updating a golden image twice per year is probably enough to keep your systems updated so that new controls will be easy to distribute.</p>
<p>To implement STIG controls, begin with the Category I (High severity) controls and apply those first. <a contenteditable="false" data-primary="High-severity security controls (STIG)" data-type="indexterm" id="idm45657872489920"/><a contenteditable="false" data-primary="Category I (High severity) security controls (STIG)" data-type="indexterm" id="idm45657871855088"/>If you have systems that you feel might be vulnerable, immediately implement all Category I security controls. Currently, for Red Hat Enterprise Linux 8, there are only 21 such controls, so the effort required is minimal. For Category II (Medium severity) controls, you <a contenteditable="false" data-primary="Medium-severity security controls (STIG)" data-type="indexterm" id="idm45657872098528"/><a contenteditable="false" data-primary="Category II (Medium severity) security controls (STIG)" data-type="indexterm" id="idm45657872005552"/>should employ an audit tool because there are more than 300 Category II controls.</p>
</div></section>
<section data-pdf-bookmark="Installing and Using Security Tools" data-type="sect2"><div class="sect2" id="installing_and_using_security_tools">
<h2>Installing and Using Security Tools</h2>
<p>There are dozens of <a contenteditable="false" data-primary="security measures (advanced), implementing" data-secondary="installing and using security tools" data-type="indexterm" id="ix_secadvtool"/>commercial and free security tools that you can use to better protect your systems. The following three tools used with STIG can greatly enhance your systems’ security. As stated previously, you should install and run these tools at least once before deploying your systems onto a live network. An initial run provides you with a baseline assessment. Keep these initial reports to compare with those you run in the future.</p>
<p>I highly recommend the following short list of security tools. All new systems should have these tools installed and an initial run completed before system production deployment. These security tools have served me well and are well-accepted in many enterprise environments.</p>
<section data-pdf-bookmark="Lynis" data-type="sect3"><div class="sect3" id="lynis">
<h3>Lynis</h3>
<p>Lynis is a lighter-weight vulnerability checker than the Security Content Automation Protocol (SCAP) and STIG tools. <a contenteditable="false" data-primary="security measures (advanced), implementing" data-secondary="installing and using security tools" data-tertiary="Lynis" data-type="indexterm" id="idm45657871838848"/><a contenteditable="false" data-primary="Lynis (security vulnerability checker)" data-type="indexterm" id="idm45657871849632"/><a contenteditable="false" data-primary="SCAP (Security Content Automation Protocol)" data-type="indexterm" id="idm45657871849248"/><a contenteditable="false" data-primary="Security Content Automation Protocol (SCAP)" data-type="indexterm" id="idm45657871836336"/>However, it is not a replacement for those tools if you must comply with the Department of Defense or other government security standards. Lynis is a security auditing tool that checks your servers’ system and software configurations.</p>
<p>Install the Lynis package via your package manager, and then run a system audit:</p>
<pre data-type="programlisting">
$ sudo lynis audit system</pre>
<p>Once the <a contenteditable="false" data-primary="security fixes (recommended), getting list of from Lynis" data-type="indexterm" id="idm45657871859216"/>audit is complete, I usually <code>grep</code> for <code>Suggestion</code>, as shown here, to obtain a list of recommended security fixes. The list might be quite lengthy.</p>
<pre data-type="programlisting">
$ sudo grep Suggestion /var/log/lynis.log &gt; lynis_fixes.txt</pre>
<p>You can refer to this list, make corrections and fixes, and rerun the system audit. I recommend continuing to do this until there are no more recommended fixes or to get the list to a point where the recommendations (suggestions) do not apply to your system. The following is an excerpt from my suggestion list:</p>
<pre data-type="programlisting">
2022-10-31 13:35:53 Suggestion: Install Apache mod_evasive to guard webserver ...
DoS/brute force attempts [test:HTTP-6640] [details:-] [solution:-]
2022-10-31 13:35:53 Suggestion: Install Apache modsecurity to guard webserver ...
web application attacks [test:HTTP-6643] [details:-] [solution:-]
2022-10-31 13:35:54 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:AllowTcpForwarding (set YES to NO)] [solution:-]
2022-10-31 13:35:54 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:ClientAliveCountMax (set 3 to 2)] [solution:-]
2022-10-31 13:35:54 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:Compression (set YES to NO)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:LogLevel (set INFO to VERBOSE)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:MaxAuthTries (set 6 to 3)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:MaxSessions (set 10 to 2)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:PermitRootLogin (set YES to (FORCED-COMMANDS-ONLY|NO|PROHIBIT-PASSWOR...
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:Port (set 22 to )] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:TCPKeepAlive (set YES to NO)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:X11Forwarding (set YES to NO)] [solution:-]
2022-10-31 13:35:55 Suggestion: Consider hardening SSH configuration [test:SSH...
[details:AllowAgentForwarding (set YES to NO)] [solution:-]
2022-10-31 13:35:58 Suggestion: Enable logging to an external logging host for...
purposes and additional protection [test:LOGG-2154] [details:-] [solution:-]
2022-10-31 13:35:59 Suggestion: Check what deleted files are still in use and ...
[test:LOGG-2190] [details:-] [solution:-]
2022-10-31 13:36:13 Suggestion: Add a legal banner to /etc/issue, to warn unau...
users [test:BANN-7126] [details:-] [solution:-]
2022-10-31 13:36:13 Suggestion: Add legal banner to /etc/issue.net, to warn un...
users [test:BANN-7130] [details:-] [solution:-]</pre>
<p>An example of something I can ignore is the <em>/etc/issue</em> and <em>/etc/issue.net</em> legal notice. My systems are private virtual machines, and I’m the only one who uses them. You will likely see a long list of SSH hardening suggestions. It would be best if you implemented these. Some sysadmins create “golden” images from systems that have passed through a Lynis “cleansing” so they can deploy a clean image. Of course, Lynis should be run regularly to maintain this status. A scheduled <code>cron</code> job is a good solution for creating regular reports.</p>
</div></section>
<section data-pdf-bookmark="Portsentry" data-type="sect3"><div class="sect3" id="portsentry">
<h3>Portsentry</h3>
<p>Portsentry runs in memory and attempts to detect network port scans and then ban the offending <a contenteditable="false" data-primary="iptables command" data-type="indexterm" id="idm45657871951888"/>hosts’ <a contenteditable="false" data-primary="security measures (advanced), implementing" data-secondary="installing and using security tools" data-tertiary="Portsentry" data-type="indexterm" id="idm45657871829680"/>IP <a contenteditable="false" data-primary="ipchains command" data-type="indexterm" id="idm45657871817376"/>address <a contenteditable="false" data-primary="/etc/hosts.deny file" data-primary-sortas="etc" data-type="indexterm" id="idm45657871816112"/><a contenteditable="false" data-primary="hosts.deny file" data-type="indexterm" id="idm45657871814736"/>via <em>hosts.deny</em>, firewall rules, <code>ipchains</code> and <code>iptables</code> entries, or dropped routes.<a contenteditable="false" data-primary="Portsentry" data-type="indexterm" id="idm45657871812096"/></p>
<p>The following ports defined in <em>/etc/portsentry/portsentry.conf</em> are “activated.” You may add custom ports or remove port numbers at will.<a contenteditable="false" data-primary="/etc/portsentry/portsentry.conf" data-primary-sortas="etc" data-type="indexterm" id="idm45657871809296"/><a contenteditable="false" data-primary="Ubuntu" data-secondary="default list of ports" data-type="indexterm" id="idm45657871807728"/> In the Ubuntu implementation, this is the default list of ports:</p>
<pre data-type="programlisting">
# Use these if you just want to be aware:
TCP_PORTS="1,11,15,79,111,119,143,540,635,1080,1524,2000,5742,6667,12345,12346,20
034,27665,31337,32771,32772,32773,32774,40421,49724,54320"
UDP_PORTS="1,7,9,69,161,162,513,635,640,641,700,37444,34555,31335,32770,32771,327
72,32773,32774,31337,54321"</pre>
<p>The default action is to drop the route back to the scanning host:</p>
<pre data-type="programlisting">
KILL_ROUTE="/sbin/route add -host $TARGET$ reject"</pre>
<p>I also use the <em>/etc/hosts.deny</em> entry by uncommenting the following line:</p>
<pre data-type="programlisting">
KILL_HOSTS_DENY="ALL: $TARGET$ : DENY"</pre>
<p>This ensures that the route to the host is blocked and the IP address is blocked in <em>/etc/hosts.deny</em>. The entries from <em>/etc/hosts.deny</em> and <em>route</em> look like the result from a scan (the scanning host is <code>192.168.1.234</code>).</p>
<p>From <em>/etc/hosts.deny</em>:</p>
<pre data-type="programlisting">
ALL: 192.168.1.234 : DENY</pre>
<p>From<a contenteditable="false" data-primary="kernels" data-secondary="kernel IP routing table" data-type="indexterm" id="idm45657871799312"/><a contenteditable="false" data-primary="route table" data-type="indexterm" id="idm45657871797904"/> the <em>route</em> table:</p>
<pre data-type="programlisting">
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         Docsis-Gateway  0.0.0.0         UG    0      0        0 enp0s3
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 enp0s3
192.168.1.234   -               255.255.255.255 !H    0      -        0 -</pre>
<p>Here are some <a contenteditable="false" data-primary="/var/log/syslog, Portscan entries identifying offending system" data-primary-sortas="var" data-type="indexterm" id="idm45657871795152"/>entries from <em>/var/log/syslog</em> that identify the offending system:</p>
<pre data-type="programlisting">
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Host: 192.168.1.234...
already blocked. Ignoring
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Connect from host: ...
to TCP port: 32772
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Host: 192.168.1.234...
already blocked. Ignoring
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Connect from host: ...
to TCP port: 32773
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Host: 192.168.1.234...
already blocked. Ignoring
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Connect from host: ...
to TCP port: 32774
Oct 31 21:21:51 server2 portsentry[177518]: attackalert: Host: 192.168.1.234...
already blocked. Ignoring</pre>
<p>Portsentry is a handy little utility that’s always been one of my security layers. You can see that it effectively eliminates connectivity from a particular host. If you have a DMZ host, you should use Portsentry on it because it will be scanned multiple times daily.</p>
</div></section>
<section data-pdf-bookmark="Advanced Intrusion and Detection Environment" data-type="sect3"><div class="sect3" id="advanced_intrusion_and_detection_enviro">
<h3>Advanced Intrusion and Detection Environment</h3>
<p>Advanced<a contenteditable="false" data-primary="security measures (advanced), implementing" data-secondary="installing and using security tools" data-tertiary="Advanced Intrusion and Detection Environment" data-type="indexterm" id="idm45657872351872"/> Intrusion and <a contenteditable="false" data-primary="Advanced Intrusion and Detection Environment (AIDE)" data-type="indexterm" id="idm45657871788592"/>Detection Environment (AIDE) is an intrusion-detection system for checking file integrity.<a contenteditable="false" data-primary="intrusion detection system (AIDE)" data-type="indexterm" id="idm45657871785584"/><a contenteditable="false" data-primary="sudo (substitute user do) command" data-secondary="sudo dnf install aide" data-type="indexterm" id="idm45657871784912"/> Install AIDE from a repository:</p>
<pre data-type="programlisting">
$ sudo dnf install aide</pre>
<p>If you do not <a contenteditable="false" data-primary="Red Hat Enterprise Linux" data-secondary="installing and initializing AIDE" data-type="indexterm" id="idm45657871783824"/>use a <a contenteditable="false" data-primary="YUM/DNF utility" data-secondary="dnf install aide command" data-type="indexterm" id="idm45657871781936"/>Red Hat–based system, the installation proceeds differently. On Ubuntu (and I assume on all Debian-based systems), the <a contenteditable="false" data-primary="Debian" data-secondary="installing and initializing AIDE" data-type="indexterm" id="idm45657871858576"/><a contenteditable="false" data-primary="Ubuntu" data-secondary="installing AIDE" data-type="indexterm" id="idm45657871778864"/>installer steps you through a postfix configuration and creates multiple configuration files under <em>/etc/aide</em>. <a contenteditable="false" data-primary="/etc/aide direcotry" data-primary-sortas="etc" data-type="indexterm" id="idm45657871777200"/>The Ubuntu implementation is different from the Red Hat Enterprise Linux–based one. Differences are noted in the text. Before using AIDE, you must first initialize its database with the following command. <a contenteditable="false" data-primary="sudo (substitute user do) command" data-secondary="sudo aide --init" data-type="indexterm" id="idm45657872062128"/>This process takes a few minutes to complete.</p>
<pre data-type="programlisting">
$ sudo aide --init
Start timestamp: 2022-10-31 09:19:12 -0400 (AIDE 0.16)
AIDE initialized database at /var/lib/aide/aide.db.new.gz

Number of entries:    156566

---------------------------------------------------
The attributes of the (uncompressed) database(s):
---------------------------------------------------

/var/lib/aide/aide.db.new.gz
  MD5      : WzAN0+7wHIA5a+vZkzwQVQ==
  SHA1     : 8FisYNVBvBy3bdg1NaeJY1vm7LI=
  RMD160   : fwBCNvM7WMl7j8TN3EhB5X72ozs=
  TIGER    : 2fM2gL5j7aZ+BpjS9QOx4CjJKEZlZLSC
  SHA256   : XTBnehGnObWiSXR4qEJDQqOO0eCAQzfJ
             4viTZDfmQYI=
  SHA512   : M+1T1KBw04F/hbWE2uSEs3mEsYI7QzoM
             godalkUZAWLoG5LgsJTiFjPXdSnZ/dRE
             n4A83aQWtART7O7uVNR//A==


End timestamp: 2022-10-31 09:21:17 -0400 (run time: 2m 5s)</pre>
<p>You can<a contenteditable="false" data-primary="Ubuntu" data-secondary="initializing AIDE database" data-type="indexterm" id="idm45657871772736"/> initialize the AIDE database on Ubuntu with a similar command (script), which executes <code>aide –init</code>:</p>
<pre data-type="programlisting">
$ sudo aideinit
Running aide --init...
Start timestamp: 2022-10-31 09:31:07 -0400 (AIDE 0.16.1)
AIDE initialized database at /var/lib/aide/aide.db.new
Verbose level: 6

Number of entries:    220642

---------------------------------------------------
The attributes of the (uncompressed) database(s):
---------------------------------------------------

/var/lib/aide/aide.db.new
  RMD160   : pxukBfZYMClQJluYftmJxyHvQ6c=
  TIGER    : aRgAX6JnizUa9yiTE29/uZ0HqMYioQcN
  SHA256   : lmV6LTtzpiLDUAw6qloEgfAT0sD7J74w
             2vqhj7nVLP0=
  SHA512   : VCfBAAxLvaA5CEtOJEPu2SeA/565gfUS
             T0BgFFwfXWG8RkksMbnHtm8pDtVlUSnc
             TqQhcebdU/qODLwPkGIzTg==
  CRC32    : 7jx94w==
  HAVAL    : vrZDJ+70DZkjj7t6BHzt3ph4UN4yoDnd
             8oxrBBy2hvA=
  GOST     : sDLorHAYPZb74dZmIpYYZjARR3znxOXI
             Sv0WSZiZV0g=


End timestamp: 2022-10-31 09:39:38 -0400 (run time: 8m 31s)</pre>
<p>On Red Hat Enterprise Linux–based systems, you must <a contenteditable="false" data-primary="Red Hat Enterprise Linux" data-secondary="copying AIDE database and running check" data-type="indexterm" id="idm45657871768528"/>perform one last task before checking your <a contenteditable="false" data-primary="sudo (substitute user do) command" data-secondary="sudo aide --check" data-type="indexterm" id="idm45657871767472"/>system:</p>
<pre data-type="programlisting">
$ sudo cp /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz
$ sudo aide --check

Start timestamp: 2022-10-31 10:08:44 -0400 (AIDE 0.16)
AIDE found NO differences between database and filesystem. Looks okay!!

Number of entries:    156566

---------------------------------------------------
The attributes of the (uncompressed) database(s):
---------------------------------------------------

/var/lib/aide/aide.db.gz
  MD5      : WzAN0+7wHIA5a+vZkzwQVQ==
  SHA1     : 8FisYNVBvBy3bdg1NaeJY1vm7LI=
  RMD160   : fwBCNvM7WMl7j8TN3EhB5X72ozs=
  TIGER    : 2fM2gL5j7aZ+BpjS9QOx4CjJKEZlZLSC
  SHA256   : XTBnehGnObWiSXR4qEJDQqOO0eCAQzfJ
             4viTZDfmQYI=
  SHA512   : M+1T1KBw04F/hbWE2uSEs3mEsYI7QzoM
             godalkUZAWLoG5LgsJTiFjPXdSnZ/dRE
             n4A83aQWtART7O7uVNR//A==


End timestamp: 2022-10-31 10:10:53 -0400 (run time: 2m 9s)</pre>
<p>You can perform a check on Ubuntu systems without copying the file. <a contenteditable="false" data-primary="Ubuntu" data-secondary="running AIDE check" data-type="indexterm" id="idm45657871764480"/>The Ubuntu install completes the task for you. However, if you run <code>sudo aide --check</code>, you receive the error <code>Couldn't open file /var/lib/aide/please-dont-call-aide-without-parameters/aide.db for reading</code>.</p>
<p>The Ubuntu system shows a positive report for changes. <a contenteditable="false" data-primary="sudo (substitute user do) command" data-secondary="sudo aide.wrapper --check" data-type="indexterm" id="idm45657871761696"/>It’s lengthy but illustrates the type of report you’ll see when AIDE detects changes. The report provides details of changes made to files:</p>
<pre data-type="programlisting">
$ sudo aide.wrapper --check

Start timestamp: 2022-10-31 10:09:42 -0400 (AIDE 0.16.1)
AIDE found differences between database and filesystem!!
Verbose level: 6

Summary:
  Total number of entries:    220641
  Added entries:          1
  Removed entries:        1
  Changed entries:        5

---------------------------------------------------
Added entries:
---------------------------------------------------

f++++++++++++++++: /var/lib/aide/aide.db

---------------------------------------------------
Removed entries:
---------------------------------------------------

l----------------: /run/systemd/units/invocation:packagekit.service

---------------------------------------------------
Changed entries:
---------------------------------------------------

f =.... ....C..  : /run/samba/smbXsrv_open_global.tdb
f =.... ....C..  : /run/samba/smbd_cleanupd.tdb
d &lt;.... mc.. ..  : /run/systemd/units
f =.... mc..C.. .: /var/log/journal/ae1c358b16f744999c9d4b7a80e.../system.journal
f &gt;b... mc..C.. .: /var/log/sysstat/sa31

---------------------------------------------------
Detailed information about changes:
---------------------------------------------------

File: /run/samba/smbXsrv_open_global.tdb
  RMD160   : CCdm3M2ObTIu3vIXdx1vyH8emLc=     | AMx08YvCC7rmeUGhvjZ3OjLInKs=
  TIGER    : 814xHPLSSvskZzBYZ0xfLej4O5/LeQ2s | PE/hVYgRx4i17ckNePiFjVXgPQu0wOGG
  SHA256   : Y6KJgoFPHLYXfqBOom9NlbkXIYAmXmjQ | ahWfobXIOoIToffW0+jZjYYTg8W/JrFd
             /kRNN0Axa1o=                     | vrCgRinjC+g=
  SHA512   : kRDLUujEHcHUIyUVtv/u9BFldu+oCXFj | ZudqhTqoc3xOSp5RMntoJ0yUU6dkrifw
             9qbOjLft3SJK3btR0vfJtJHL1UW13LZC | R+2UDQM1zTopREoU/+N/jo9i80AcDqD6
             bUf44NCR1OSQ6s2DIfcb7A==         | j44U/ao6HhDEjE/aqoMT4Q==
  CRC32    : j0j0sA==                         | E7N72A==
  HAVAL    : giCwkv0n5oPDwHs/9k0HfPoGcAvkntQF | TJbUsmxe9Kt0+xK6R72Nk0R/2PT/XZVe
             39jkiW8nA3o=                     | Ml3VqYaXTGg=
  GOST     : P7uSZmTObQfp5nChg9W4svXupluCGaMS | GHF0TxYsXQfay3ayLi/KBck1hDcor92t
             xKp5tZQoPsQ=                     | zHzSyOiNZYk=

File: /run/samba/smbd_cleanupd.tdb
  RMD160   : D8RmZx6959xPvPKuRbEGMJdl9ww=     | uOtFZoKw8zVjcGZdhJkXcyL3kEg=
  TIGER    : xCRjkykka/bv2rf06KRdPtigjByvsQJB | r5sm3aHqZJ26jPmADp8tk1qvdPw1IfFF
  SHA256   : 7egAlq5dMozWAiYPYx3JH9r7kY1oyeOR | FVaSrvPfA5ivujOsuVcKgCdS20TQTGrw
             0DYEU4MZohA=                     | MFTjvyUFZWk=
  SHA512   : AqzJDePQwKxivNPtdJzX4suWBQnDSJhO | lYLskmVOAFSHs9dG2eVP9u4bEAWOcKM6
             hjUdEpFGKFaj0ODwuVumBHi/npByq2pZ | M0Tf73IXztE5kaP/9YHaOJRGata0GCZk
             +tMh5Kc5IevDpGPvrj5lxQ==         | t5viYSFd2ZIL9Alr31kACg==
  CRC32    : V4u1vg==                         | haAC6Q==
  HAVAL    : 0Ny4G+Y4tTaGHfFu7cXgW7yV2iPaO7xL | tR7ZgOfYNMjaKk0byAUOXAPx6/COqfVc
             ae5dMQFmNPY=                     | 4jpIEdYENd4=
  GOST     : dbrx9gce/697G9QVs4XcaoHXuS2fd3Nn | jewBI4vx9CPF6Xof7f2vdZOrzmzAcD2c
             ZNAX4+OndrQ=                     | yimBCewy/bE=

Directory: /run/systemd/units
  Size     : 1760                             | 1740
  Mtime    : 2022-10-31 09:30:13 -0400        | 2022-10-31 09:35:18 -0400
  Ctime    : 2022-10-31 09:30:13 -0400        | 2022-10-31 09:35:18 -0400

File: /var/log/journal/ae1c358b16f744999c9d4b7a80e92d66/system.journal
  Mtime    : 2022-10-31 09:35:18 -0400        | 2022-10-31 10:17:02 -0400
  Ctime    : 2022-10-31 09:35:18 -0400        | 2022-10-31 10:17:02 -0400
  RMD160   : oUjngLN5zL6EG9FssV5/Y7RDdG4=     | EekegpOq7Vf0fR82TtrvxJAwXP4=
  TIGER    : ZH3LLiOvM8ew7O3yw+SC/wHiDvkTemCF | N9DDL3wW44urrq0MJhwnclk4/c1jLuJW
  SHA256   : bfyPm9q1QlUlTm+JurRZnVMgAOYb0UFE | 5vU1pGWJ2WxMLZK7/f3qZ/Ix4o+NANoB
             qIjQofT4Jfo=                     | kNN6Q+9pwCk=
  SHA512   : oLscXcjp62ezwcSZ3E1EUkTrRCilblyM | Vd0CyIE+C+oGAOLsCfvfxdNlqKvasSC4
             9/g+mdsGNBxA681uxBJcyVZIPJZ1s/cX | dVF0zmryyzd5lDsod8aH8WNLEfpHlSzL
             SQV6E+nnc2KiL4teg1YdKg==         | j9+yt6iOJAKTtO3bIdqmEg==
  CRC32    : pe7DMw==                         | br312w==
  HAVAL    : izYRs/Df2Ae5PAbD9m7RsTOXvO2sTOV0 | wamyIlLjRTtgFpwgfIABPhAodrHuRHe1
             qv7063B7mFI=                     | ee/pSNw9Z/I=
  GOST     : FH3fMIAa0W2eV+aLNnkY+wjxhjr+LhqA | yYmdcHpvePslHVmsm1w2TpgqIo6Mh1QT
             CZbOX7wbKRA=                     | oFuber3PVDo=

File: /var/log/sysstat/sa31
  Size     : 131024                           | 139840
  Bcount   : 264                              | 288
  Mtime    : 2022-10-31 09:35:01 -0400        | 2022-10-31 10:15:01 -0400
  Ctime    : 2022-10-31 09:35:01 -0400        | 2022-10-31 10:15:01 -0400
  RMD160   : bFqT+RlB042AhIl9JaOaAI/fGPE=     | jO8DEa6NGNYnP6+U8BF/yUsweIs=
  TIGER    : /Pz1oVax6QHqhWivA3Cec/f0vHajjxx0 | XiMXwjskfSFf4NH8rRb4cWc6West9MQp
  SHA256   : t256G+V3hS8DvMj53EXw8W7e/MkwSAUe | T7r2xNaGWtzBp0Qab6seO1KNluyOmWa+
             9AYuduiSjVI=                     | 634jjyPpVCk=
  SHA512   : KSUTRzDpgc/s2jwJkQIb0uS+5cJsFqXl | iguQ86cwvpqL3WAmFJWA0tpzy43REGKh
             yGXoVuzd65YDpE8msRaBRCcqTIB740pf | DcySXGUBCSHXvmFHAK4P7Zk0tJB4etzj
             dgo3E6K/s8UaqI1biiC2tQ==         | Vpg8/WZL+0nSk3XaKZ6UwA==
  CRC32    : 07QWcA==                         | 8X9Ixg==
  HAVAL    : WnGG1i1qhDBdNIL7TGF9euydFem/oZC9 | v6IskRb6hSnVRiB5tqUSCysPtqn3ZKQp
             u7o3lSxAl0Q=                     | HPay7Epiak0=
  GOST     : vkWWBQUA+WBuEBvNAMLFerzUOkT5SWl9 | AZNTPCF3a1oSYHexxtKQoL0ksvP1Oyhx
             QTnod3FQCJQ=                     | H+BXGeFVW70=


---------------------------------------------------
The attributes of the (uncompressed) database(s):
---------------------------------------------------

/var/lib/aide/aide.db
  RMD160   : pxukBfZYMClQJluYftmJxyHvQ6c=
  TIGER    : aRgAX6JnizUa9yiTE29/uZ0HqMYioQcN
  SHA256   : lmV6LTtzpiLDUAw6qloEgfAT0sD7J74w
             2vqhj7nVLP0=
  SHA512   : VCfBAAxLvaA5CEtOJEPu2SeA/565gfUS
             T0BgFFwfXWG8RkksMbnHtm8pDtVlUSnc
             TqQhcebdU/qODLwPkGIzTg==
  CRC32    : 7jx94w==
  HAVAL    : vrZDJ+70DZkjj7t6BHzt3ph4UN4yoDnd
             8oxrBBy2hvA=
  GOST     : sDLorHAYPZb74dZmIpYYZjARR3znxOXI
             Sv0WSZiZV0g=


End timestamp: 2022-10-31 10:18:52 -0400 (run time: 9m 10s)</pre>
<p>You can also run an update that checks and updates the database, but the input and output databases must differ. The output from this command is also rather lengthy and is truncated because of that length. But the part I show here is the summary rather than the detailed view. <a contenteditable="false" data-primary="Red Hat Enterprise Linux" data-secondary="running update to check and update AIDE database" data-type="indexterm" id="idm45657871876592"/><a contenteditable="false" data-primary="Ubuntu" data-secondary="running update to check and update AIDE database" data-type="indexterm" id="idm45657871791104"/><a contenteditable="false" data-primary="sudo (substitute user do) command" data-secondary="sudo aide.wrapper --update" data-type="indexterm" id="idm45657871750144"/>This update was executed on an Ubuntu system but worked the same on Red Hat Enterprise Linux–based systems using the <code>sudo aide.wrapper --update</code> command:</p>
<pre data-type="programlisting">
$ sudo aide.wrapper --update
Start timestamp: 2022-10-31 10:42:00 -0400 (AIDE 0.16.1)
AIDE found differences between database and filesystem!!
New AIDE database written to /var/lib/aide/aide.db.new
Verbose level: 6

Summary:
  Total number of entries:    220641
  Added entries:          1
  Removed entries:        1
  Changed entries:        9

---------------------------------------------------
Added entries:
---------------------------------------------------

f++++++++++++++++: /var/lib/aide/aide.db

---------------------------------------------------
Removed entries:
---------------------------------------------------

l----------------: /run/systemd/units/invocation:packagekit.service

---------------------------------------------------
Changed entries:
---------------------------------------------------

f =.... ....C..  : /run/samba/smbXsrv_open_global.tdb
f =.... ....C..  : /run/samba/smbd_cleanupd.tdb
d &lt;.... mc.. ..  : /run/systemd/units
d =.... mc.. .. .: /var/lib/chrony
f =.... mci.C.. .: /var/lib/chrony/chrony.drift
d =.... mc.. .. .: /var/lib/snapd
f &gt;.... mci.C.. .: /var/lib/snapd/state.json
f =.... mc..C.. .: /var/log/journal/ae1c358b16f744999c9d4b7a80e.../system.journal
f &gt;b... mc..C.. .: /var/log/sysstat/sa31</pre>
<p>As you can see, you might receive false positives because some files change often, but it’s worth the slight annoyance to have a file integrity check that works. The next section is an overview of responding to security incidents, including internal and external system breaches.<a contenteditable="false" data-primary="security measures (advanced), implementing" data-startref="ix_secadvtool" data-type="indexterm" id="idm45657872486400"/><a contenteditable="false" data-primary="security measures (advanced), implementing" data-startref="ix_secadv" data-type="indexterm" id="idm45657871936368"/><a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-startref="ix_secsysadv" data-tertiary="implementing advanced security measures" data-type="indexterm" id="idm45657872488032"/></p>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Responding to Security Incidents" data-type="sect1"><div class="sect1" id="responding_to_security_incidents">
<h1>Responding to Security Incidents</h1>
<p>A security incident ranges from a user allowing  <a contenteditable="false" data-primary="security incidents, responding to" data-type="indexterm" id="ix_secinci"/>another user <a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-tertiary="responding to security incidents" data-type="indexterm" id="ix_secsysresp"/>access to their account, to a clever user attempting to crack the root user’s password, to a full security breach by a malicious outside actor or advanced persistent threat. I’ve witnessed these, plus many other types of security incidents. <a contenteditable="false" data-primary="responding to security incidents" data-see="security incidents, responding to" data-type="indexterm" id="idm45657871739536"/>One of the least-pleasant tasks that any sysadmin performs is responding to a security incident. Your worst day imaginable is when you discover a security breach or someone tells you, “We’ve been hacked.” These words are going to ruin an otherwise uneventful day.</p>
<p>A well-written security policy is the best defense against insider threats, such as someone trying to crack the root user’s passwords or sharing credentials between users. These incidents should be recorded and reported to management, and policy-driven action should be taken to prevent future occurrences of these types of security breaches. The story goes differently for external breaches because corporate policies do not bind malicious actors outside your organization.</p>
<p>The topics covered in this section deal with handling security incidents that occur from internal and external actors.</p>
<section data-pdf-bookmark="Creating a Written Security Policy" data-type="sect2"><div class="sect2" id="creating_a_written_security_policy">
<h2>Creating a Written Security Policy</h2>
<p>Writing a security policy is a manageable task.<a contenteditable="false" data-primary="security incidents, responding to" data-secondary="creating written security policy" data-type="indexterm" id="idm45657871982736"/> Many examples are freely available online. A quick search turns up hundreds of possibilities. Select one or more generic policy examples and adapt them to your organization. All security incidents are serious and should be handled as such. Even the simple sharing of usernames and passwords between friendly coworkers is a violation and should be dealt with immediately and sternly. Violating security policy is often grounds for reprimand, termination, and criminal prosecution.</p>
<p>Each employee should be given a copy of the written security policy and should sign that they’ve read and understood the policy and the consequences of its violation. Annual security refresher courses should reinforce corporate security policy standards, expectations, and violation consequences.</p>
</div></section>
<section data-pdf-bookmark="Confirming the Breach" data-type="sect2"><div class="sect2" id="confirming_the_breach">
<h2>Confirming the Breach</h2>
<p>You must confirm that a breach has occurred and to what extent the breach has compromised intellectual property, financial records, employee information, and other valuable information and data.<a contenteditable="false" data-primary="security incidents, responding to" data-secondary="confirming the breach" data-type="indexterm" id="idm45657871750848"/> Depending on your specific regulatory requirements from the Securities and Exchange Commission, Department of Defense, and other authorities, some breaches must be reported to law enforcement upon discovery and confirmation.<a contenteditable="false" data-primary="breaches (security), confirming" data-seealso="security incidents, responding to" data-type="indexterm" id="idm45657873706192"/> </p>
<p>If you aren’t classified under one of the many regulatory authorities, you might find that you’re on your own for confirming and dealing with a breach. You should contact a third-party security firm that deals with breach discovery to assist in your efforts.</p>
<p>The first course of action is to remove compromised systems from the network. Unplug their network connections and disable WiFi adapters. Leave the systems powered on. Load your forensic tools offline onto the affected systems and perform a disk clone of the system before performing any mitigation. The duplicated disk may prove valuable to law enforcement in tracking the suspects.</p>
</div></section>
<section data-pdf-bookmark="Identifying the Malicious Actor(s)" data-type="sect2"><div class="sect2" id="identifying_the_malicious_actorleft_par">
<h2>Identifying the Malicious Actor(s)</h2>
<p>Identifying internal actors is often far easier than identifying those from an external source.<a contenteditable="false" data-primary="security incidents, responding to" data-secondary="identifying malicious actor(s)" data-type="indexterm" id="idm45657873670080"/><a contenteditable="false" data-primary="malicious actor(s), identifying" data-type="indexterm" id="idm45657871728096"/> Law enforcement, including the FBI, the Department of Homeland Security, the NSA, and other agencies, might help with the investigation if the threat is thought to be from a foreign source. Attackers cover their tracks by removing log files, exfiltrating data in small amounts, and pivoting from one system to another to remain inside your network undetected for months or years.</p>
<p>If you suspect a malicious group or foreign government-sponsored collective has breached your network or stolen intellectual property, your best option is to contact law enforcement and the FBI. If your company is a contractor protected by the Department of Defense or another agency, the FBI or NSA might contact you about a breach before you know it has occurred. In these cases, it’s best to provide those authorities with any information, data, and access they request. Identifying, stopping, and prosecuting cybercriminals is a high priority for government agencies.</p>
</div></section>
<section data-pdf-bookmark="Taking Corrective Actions" data-type="sect2"><div class="sect2" id="taking_corrective_actions">
<h2>Taking Corrective Actions</h2>
<p>Once you’ve confirmed a breach and evaluated the damage, it’s time<a contenteditable="false" data-primary="security incidents, responding to" data-secondary="taking corrective action" data-type="indexterm" id="idm45657873292640"/> to take corrective action, including scanning and cleaning files, enabling host-based firewalls, encrypting data, and reimaging systems. <a contenteditable="false" data-primary="corrective actions for security breach" data-type="indexterm" id="idm45657874672384"/>The actions you take will be dictated by the extent of the breach and actions taken by the malicious actors. Good backups, a disaster recovery plan, encrypted data, and multilayer security will help you recover from a breach.</p>
<p>You should report any breach to local law enforcement and take any recommended actions. If the breach is ongoing, inform law enforcement that the breach is ongoing so that they can take action or notify other agencies on your behalf.</p>
<p>Unfortunately, when an attack’s breadth and depth aren’t clear, it’s recommended to reimage key systems offline and apply all security measures before bringing them back onto the corporate network.<a contenteditable="false" data-primary="security incidents, responding to" data-startref="ix_secinci" data-type="indexterm" id="idm45657871743776"/><a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-startref="ix_secsysresp" data-tertiary="responding to security incidents" data-type="indexterm" id="idm45657871774416"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id00014">
<h1>Summary</h1>
<p>Network and system security are ongoing efforts, not a “set it and forget it” scenario. Security requires constant vigilance, advanced training, regular software and hardware patching, automated system software, and multiple layers of security from MFA, firewalls, encryption, secure tools, secure development, and user training. It’s wise to engage an external security firm to assist in the secure design and protection of your network and assets.<a contenteditable="false" data-primary="security" data-secondary="securing your systems" data-startref="ix_secsys" data-type="indexterm" id="idm45657871710480"/></p>
</div></section>
</div></section></div></body></html>