<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 12. Working with Metadata"><div class="chapter" id="nch-meta"><h1><span class="label">Chapter 12. </span>Working with Metadata</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820362227424"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="12.0 Introduction"><div class="sect1" id="nch-meta-meta-intro"><h1>12.0 Introduction</h1><p>Most of the SQL statements used so far have been written to work
    with the data stored in the database. That is, after all, what the
    database is designed to hold. But sometimes you need more than just data
    values. You need information that characterizes or describes those
    values—that is, the statement metadata. Metadata is used most often to process result sets, but also
    applies to other aspects of your interaction with MySQL. This chapter
    describes how to obtain and use several types of metadata:</p><dl><dt>Information about statement results</dt><dd><p>For statements that delete or update rows, you can determine how many
          rows were changed. For a <code>SELECT</code>
          statement, you can obtain the number of columns in the result set,
          as well as information about each column in the result set, such as
          the column name and its display width. For example, to format a
          tabular display, you can determine how wide to make each column and
          whether to justify values to the left or right.</p></dd><dt>Information about databases and tables</dt><dd><p>A MySQL server can be queried to determine which databases and tables it
          manages. This is useful for existence tests or producing lists. For
          example, an application might present a display enabling the user to
          select one of the available databases. Table metadata can be
          examined to determine column definitions; for example, to determine
          the legal values for <code>ENUM</code> or
          <code>SET</code> columns to generate web form
          elements corresponding to the available choices.</p></dd><dt>Information about the MySQL server</dt><dd><p>The database server provides information about itself and about the status
          of your current session with it. Knowing the server version can be
          useful for determining whether it supports a given feature, which
          helps you build adaptive applications.</p></dd></dl><p>Metadata is closely tied to the implementation of the database
    system, so it tends to be database system−dependent. This means that if an
    application uses techniques shown in this chapter, it might need some
    modification if you port it to other database systems. For example, lists
    of tables and databases in MySQL are available by executing <code>SHOW</code> statements. However, <code>SHOW</code> is a MySQL-specific extension to SQL, so
    even for APIs like Perl DBI, PHP PDO, Python DB API, and JDBC that give you a
    database-independent way of executing statements, the SQL itself is
    MySQL-specific and must be changed to work with other database
    systems.</p><p>A more portable source of metadata is <code>INFORMATION_SCHEMA</code>, a database that contains
    information about databases, tables, columns, character sets, and so
    forth. <code>INFORMATION_SCHEMA</code> has some
    advantages over <code>SHOW</code>:</p><ul><li><p>Other database systems support <code>INFORMATION_SCHEMA</code>, so applications that use
        it are likely to be more portable than those that use <code>SHOW</code> statements.</p></li><li><p><code>INFORMATION_SCHEMA</code> is used
        with standard <code>SELECT</code>
        syntax, so it’s more similar to other data-retrieval operations than
        <code>SHOW</code> statements.</p></li></ul><p>Because of those advantages, recipes in this chapter use <code>INFORMATION_SCHEMA</code> rather than <code>SHOW</code> in most
    cases.</p><p>A disadvantage of <code>INFORMATION_SCHEMA</code> is that statements to access
    it are more verbose than the corresponding <code>SHOW</code> statements. That doesn’t matter so much
    when you’re writing programs, but for interactive use, <code>SHOW</code> statements can be more attractive because
    they require less typing. 
    </p><div data-type="note" epub:type="note"><h6>Note</h6><p>The results retrieved from <code>INFORMATION_SCHEMA</code> or <code>SHOW</code> depend on your privileges. You’ll see
      information only for those databases or tables for which you have some
      privileges. Thus, an existence test for an object returns false if it
      exists but you have no privileges for accessing it. You may need to use a user with administrative privileges to be able to repeat all code examples that we provide in this chapter.
      </p></div><p>Scripts that create tables used in this chapter are located in the
    <em class="filename">tables</em> directory of the <code>recipes</code> distribution. Scripts containing code
    for the examples are located in the <em class="filename">metadata</em> directory. (Some of them use utility
    functions located in the <em class="filename">lib</em>
    directory.) The distribution often provides implementations in languages
    other than those shown.</p></div></section><section data-type="sect1" data-pdf-bookmark="12.1 Determining the Number of Rows Affected by a Statement"><div class="sect1" id="nch-meta-meta-rows"><h1>12.1 Determining the Number of Rows Affected by a Statement</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820362207040"><h2>Problem</h2><p>You want to know how many rows have been changed by an SQL statement..</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820362206064"><h2>Solution</h2><p>Some APIs return the row count as a return value of the function that
      executes the statement. Others provide a separate
      function that you call after executing the statement. Use the method, available in the programming language you use.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820362205120"><h2>Discussion</h2><p>For statements that affect rows (<code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>REPLACE</code>), each API provides a way to determine
      the number of rows involved. For MySQL, the default meaning of
      <q>affected by</q> is <q>changed by,</q> not
      <q>matched by.</q> That is, rows not changed by a statement are
      not counted, even if they match the conditions specified in the
      statement. For example, the following <code>UPDATE</code> statement results in an <q>affected
      by</q> value of zero because it changes no columns from their
      current values, no matter how many rows the <code>WHERE</code> clause matches:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">profile</code> <code class="k">SET</code> <code class="n">cats</code> <code class="o">=</code> <code class="mi">0</code> <code class="k">WHERE</code> <code class="n">cats</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code></pre><p>The MySQL server permits a client to set a connect-time flag to
      indicate that it wants rows-matched counts, not rows-changed counts. In
      this case, the row count for the preceding statement would be equal to
      the number of rows with a <code>cats</code> value
      of 0, even though the statement results in no net change to the table.
      However, not all MySQL APIs expose this flag. The following discussion
      indicates which APIs enable you to select the type of count you want and
      which use the rows-matched count by default rather than the rows-changed
      count.</p><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820363120832"><h3>Perl</h3><p>In Perl DBI scripts, <code>do()</code>
        returns the row count for statements that modify rows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="c1"># report 0 rows if an error occurred</code>
<code class="nb">printf</code> <code class="s">"Number of rows affected: %d\n"</code><code class="p">,</code> <code class="p">(</code><code class="nb">defined</code> <code class="p">(</code><code class="nv">$count</code><code class="p">)</code> <code class="p">?</code> <code class="nv">$count</code> <code class="p">:</code> <code class="mi">0</code><code class="p">);</code></pre><p>If you prepare a statement first and then execute it, <code>execute()</code> returns the row count:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="nb">printf</code> <code class="s">"Number of rows affected: %d\n"</code><code class="p">,</code> <code class="p">(</code><code class="nb">defined</code> <code class="p">(</code><code class="nv">$count</code><code class="p">)</code> <code class="p">?</code> <code class="nv">$count</code> <code class="p">:</code> <code class="mi">0</code><code class="p">);</code></pre><p>To tell MySQL whether to return rows-changed or rows-matched
        counts, specify <code>mysql_client_found_rows</code> in the options part of the data source name (DSN) argument of
        the <code>connect()</code> call
        when you connect to the MySQL server. Set the option to 0 for
        rows-changed counts and 1 for rows-matched counts. Here’s an
        example:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:cookbook:localhost;mysql_client_found_rows=1"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p><code>mysql_client_found_rows</code>
        changes the row-reporting behavior for the duration of the
        session.</p><p>Although the default behavior for MySQL itself is to return
        rows-changed counts, current versions of the Perl DBI driver for MySQL
        automatically request rows-matched counts unless you specify
        otherwise. For applications that depend on a particular behavior, it’s
        best to explicitly set the <code>mysql_client_found_rows</code> option in the DSN to
        the appropriate value.</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820363176784"><h3>Ruby</h3><p>In Ruby Mysql2 scripts, the <code>affected_rows</code>
        method returns the row count for statements that modify
        rows:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="n">stmt</code><code class="p">)</code>
<code class="nb">puts</code> <code class="s2">"Number of rows affected: </code><code class="si">#{</code><code class="n">client</code><code class="o">.</code><code class="n">affected_rows</code><code class="si">}</code><code class="s2">"</code></pre><p>If you use prepared statements method <code>execute</code> to execute
        a statement, use the statement handle <code>affected_rows</code> method to get the count
        afterward:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="n">stmt</code><code class="p">)</code>
<code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">()</code>
<code class="nb">puts</code> <code class="s2">"Number of rows affected: </code><code class="si">#{</code><code class="n">sth</code><code class="o">.</code><code class="n">affected_rows</code><code class="si">}</code><code class="s2">"</code></pre><p>The Ruby driver for MySQL returns rows-changed counts by
        default, but the driver supports a <code>Mysql2::Client::FOUND_ROWS</code> option that enables
        you to control whether the server returns rows-changed or rows-matched
        counts. For example, to request
        rows-matched counts, do this:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:flags</code><code class="o">=&gt;</code><code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">::</code><code class="no">FOUND_ROWS</code><code class="p">,</code> <code class="ss">:database</code><code class="o">=&gt;</code><code class="s1">'cookbook'</code><code class="p">)</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820363161792"><h3>PHP</h3><p>In PDO, the database handle <code>exec()</code> method returns the rows-affected count:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">exec</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="nb">printf</code> <code class="p">(</code><code class="s2">"Number of rows updated: %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$count</code><code class="p">);</code></pre><p>If you use <code>prepare()</code> plus
        <code>execute()</code> instead, the rows-affected count is available from the statement
        handle <code>rowCount()</code>
        method:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">prepare</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">execute</code> <code class="p">();</code>
<code class="nb">printf</code> <code class="p">(</code><code class="s2">"Number of rows updated: %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">rowCount</code> <code class="p">());</code></pre><p>The PDO driver for MySQL returns rows-changed counts by default,
        but the driver supports a <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> attribute
        that you can specify at connect time to control whether
        the server returns rows-changed or rows-matched counts. The <code>new</code> <code>PDO</code> class constructor takes an optional
        key/value array following the password argument. Pass <code>PDO::MYSQL_ATTR_FOUND_ROWS</code> <code>=&gt;</code> <code>1</code>
        in this array to request rows-matched counts:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=localhost;dbname=cookbook"</code><code class="p">;</code>
<code class="nv">$dbh</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">PDO</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s2">"cbuser"</code><code class="p">,</code> <code class="s2">"cbpass"</code><code class="p">,</code>
                <code class="k">array</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">MYSQL_ATTR_FOUND_ROWS</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">));</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820362461136"><h3>Python</h3><p>Python’s DB API makes the rows-changed count available as the value of the
        statement cursor’s <code>rowcount</code>
        attribute:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">stmt</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows affected: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>To obtain rows-matched counts instead, import the
        Connector/Python client-flag constants and pass the <code>FOUND_ROWS</code> flag in the <code>client_flags</code> parameter of the <code>connect()</code>
        method:</p><pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">mysql.connector.constants</code> <code class="kn">import</code> <code class="n">ClientFlag</code>

<code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code>
  <code class="n">database</code><code class="o">=</code><code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="n">host</code><code class="o">=</code><code class="s2">"localhost"</code><code class="p">,</code>
  <code class="n">user</code><code class="o">=</code><code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="n">password</code><code class="o">=</code><code class="s2">"cbpass"</code><code class="p">,</code>
  <code class="n">client_flags</code><code class="o">=</code><code class="p">[</code><code class="n">ClientFlag</code><code class="o">.</code><code class="n">FOUND_ROWS</code><code class="p">]</code>
<code class="p">)</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820362376304"><h3>Go</h3><p>
          Go SQL driver provides method <code>RowsAffected</code> of the <code>Result</code> type that returns number of changed rows.
        </p><pre data-type="programlisting" data-code-language="go"><code class="nx">res</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Exec</code><code class="p">(</code><code class="nx">sql</code><code class="p">)</code><code class="w"/>
<code class="c1">// Check and handle err</code><code class="w"/>
<code class="nx">affectedRows</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">RowsAffected</code><code class="p">()</code><code class="w"/>
<code class="c1">// Check and handle err</code><code class="w"/>
<code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"The statement affected %d rows\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">affectedRows</code><code class="p">)</code><code class="w"/></pre><p>
         To retrieve row-matched count instead add a parameter <code>clientFoundRows=true</code> to the connection string:
       </p><pre data-type="programlisting" data-code-language="go"><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="err">↩</code><code class="w"/>
<code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"> </code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook?clientFoundRows=true"</code><code class="p">)</code><code class="w"/></pre></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820362573984"><h3>Java</h3><p>For statements that modify rows, the Connector/J driver provides
        rows-matched counts rather than rows-changed counts, for conformance
        with the Java JDBC specification.</p><p>The JDBC interface provides row counts two different ways, depending on the
        method you invoke to execute the statement. If you use <code>executeUpdate()</code>, the row count is its return value:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code>
<code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">executeUpdate</code> <code class="o">(</code><code class="n">stmt</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"Number of rows affected: "</code> <code class="o">+</code> <code class="n">count</code><code class="o">);</code></pre><p>If you use <code>execute()</code>, that
        method returns true or false to indicate whether the
        statement produces a result set. For statements such as <code>UPDATE</code> or <code>DELETE</code> that return no result set, <code>execute()</code> returns false and the row count is
        available by calling the <code>getUpdateCount()</code>
        method:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code>
<code class="k">if</code> <code class="o">(!</code><code class="n">s</code><code class="o">.</code><code class="na">execute</code> <code class="o">(</code><code class="n">stmt</code><code class="o">))</code>
<code class="o">{</code>
  <code class="c1">// there is no result set, print the row count</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"Number of rows affected: "</code> <code class="o">+</code> <code class="n">s</code><code class="o">.</code><code class="na">getUpdateCount</code> <code class="o">());</code>
<code class="o">}</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code></pre></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.2 Obtaining Result Set Metadata"><div class="sect1" id="nch-meta-meta-result"><h1>12.2 Obtaining Result Set Metadata</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820362003344"><h2>Problem</h2><p>After retrieving the rows (see <a data-type="xref" href="ch04.xhtml#nch-api-api-statement">Recipe 4.4</a>) you want to know other details
      <em>about</em> the result set, such as the column names and
      data types, or how many rows and columns there are.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820362001104"><h2>Solution</h2><p>Use the capabilities provided by your API.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820362000160"><h2>Discussion</h2><p>Statements such as <code>SELECT</code> that
      generate a result set produce several types of metadata.
      This section discusses the information available through each API, using
      programs that show how to display the result set metadata available
      after executing a sample statement (<code>SELECT</code> <code>name,</code> <code>birth</code>
      <code>FROM</code> <code>profile</code>). The example programs illustrate one
      of the simplest uses for this information: when you retrieve a row from
      a result set and you want to process the column values in a loop, the
      column count stored in the metadata serves as the upper bound on the
      loop iterator.</p><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820361999216"><h3>Perl</h3><p>The scope of result set metadata available from Perl DBI depends on how you process queries:</p><ul><li><p>Using a statement handle</p><p>In this case, invoke <code>prepare()</code> to get the statement handle. This handle has an <code>execute()</code> method. Invoke it to generate
            the result set, then fetch the rows in a loop. With this approach,
            access to the metadata is available while the result set is
            active—that is, after the call to <code>execute()</code> and until the end of the
            result set is reached. When the row-fetching method finds that
            there are no more rows, it invokes <code>finish()</code>
            implicitly, which causes the metadata to become unavailable. (That
            also happens if you explicitly call <code>finish()</code> yourself.) Thus, normally it’s
            best to access the metadata immediately after calling <code>execute()</code>, making a copy of any values
            that you’ll need to use beyond the end of the fetch loop.</p></li><li><p>Using a database-handle method that returns the result set
            in a single operation</p><p>With this approach, any metadata generated while processing
            the statement will have been disposed of by the time the method
            returns. You can still determine the number of rows and columns
            from the size of the result set.</p></li></ul><p>When you use a statement handle to process a query, DBI makes
        result set metadata available after you invoke the handle’s <code>execute()</code> method. This information is
        available primarily in the form of references to arrays. For each such
        type of metadata, the array has one element per column in the result
        set. Access these array references as attributes of the statement
        handle. For example, <code>$sth-&gt;{NAME}</code> points to the column name
        array, with individual column names available as elements of this
        array:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$name</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NAME</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code></pre><p>Or access the entire array like this:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">@names</code> <code class="o">=</code> <code class="nv">@</code><code class="p">{</code><code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NAME</code><code class="p">}};</code></pre><p><a data-type="xref" href="#nch-meta-meta-result-perl">Table 12-1</a> lists the attribute names through which you
        access array-based metadata and the meaning of values in each array.
        Names that begin with uppercase are standard DBI attributes and should
        be available for most database engines. Attribute names that begin
        with <code>mysql_</code> are MySQL-specific and
        nonportable:</p><table id="nch-meta-meta-result-perl"><caption><span class="label">Table 12-1. </span>Metadata in Perl</caption><thead><tr><th>Attribute name</th><th>Array element meaning</th></tr></thead><tbody><tr><td><code>NAME </code></td><td>Column name</td></tr><tr><td><code>NAME_lc </code></td><td>Column name in lowercase</td></tr><tr><td><code>NAME_uc </code></td><td>Column name in uppercase</td></tr><tr><td><code>NULLABLE </code></td><td>0 or empty string = column
                values cannot be <code>NULL</code></td></tr><tr><td/><td>1 = column values can be
                <code>NULL</code></td></tr><tr><td/><td>2 = unknown</td></tr><tr><td><code>PRECISION </code></td><td>Column width</td></tr><tr><td><code>SCALE </code></td><td>Number of decimal places (for numeric columns)</td></tr><tr><td><code>TYPE </code></td><td>Data type (numeric DBI code)</td></tr><tr><td><code>mysql_is_blob </code></td><td>True if column has a <code>BLOB</code> (or <code>TEXT</code>) type</td></tr><tr><td><code>mysql_is_key </code></td><td>True if column is part of a key</td></tr><tr><td><code>mysql_is_num </code></td><td>True if column has a numeric type</td></tr><tr><td><code>mysql_is_pri_key </code></td><td>True if column is part of a primary key</td></tr><tr><td><code>mysql_max_length </code></td><td>Actual maximum length of column values in result
                set</td></tr><tr><td><code>mysql_table </code></td><td>Name of table the column is part of</td></tr><tr><td><code>mysql_type </code></td><td>Data type (numeric internal MySQL code)</td></tr><tr><td><code>mysql_type_name </code></td><td>Data type name</td></tr></tbody></table><p>Some types of metadata, listed in <a data-type="xref" href="#nch-meta-meta-result-perl-hash">Table 12-2</a>, are
        accessed as references to hashes rather than arrays. These hashes have
        one element per column value. The element key is the column name and
        its value is the position of the column within the result set. For
        example:</p><pre data-type="programlisting" data-code-language="perl">$col_pos = $sth-&gt;{NAME_hash}-&gt;{<em><code>col_name</code></em>};</pre><table id="nch-meta-meta-result-perl-hash"><caption><span class="label">Table 12-2. </span>Metadata in Perl, accessible as references to hashes</caption><thead><tr><th>Attribute name</th><th>Hash element meaning</th></tr></thead><tbody><tr><td><code>NAME_hash </code></td><td>Column name</td></tr><tr><td><code>NAME_hash_lc </code></td><td>Column name in lowercase</td></tr><tr><td><code>NAME_hash_uc </code></td><td>Column name in uppercase</td></tr></tbody></table><p>The number of columns in a result set is available as a scalar
        value:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$num_cols</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NUM_OF_FIELDS</code><code class="p">};</code></pre><p>This example code shows how to execute a statement and display
        result set metadata:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$stmt</code> <code class="o">=</code> <code class="s">"SELECT name, birth FROM profile"</code><code class="p">;</code>
<code class="nb">printf</code> <code class="s">"Statement: %s\n"</code><code class="p">,</code> <code class="nv">$stmt</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code><code class="p">();</code>
<code class="c1"># metadata information becomes available at this point ...</code>
<code class="nb">printf</code> <code class="s">"NUM_OF_FIELDS: %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NUM_OF_FIELDS</code><code class="p">};</code>
<code class="k">print</code> <code class="s">"Note: statement has no result set\n"</code> <code class="k">if</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NUM_OF_FIELDS</code><code class="p">}</code> <code class="o">==</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">for</code> <code class="k">my</code> <code class="nv">$i</code> <code class="p">(</code><code class="mi">0</code> <code class="o">..</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NUM_OF_FIELDS</code><code class="p">}</code><code class="o">-</code><code class="mi">1</code><code class="p">)</code>
<code class="p">{</code>
  <code class="nb">printf</code> <code class="s">"--- Column %d (%s) ---\n"</code><code class="p">,</code> <code class="nv">$i</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NAME</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"NAME_lc:          %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NAME_lc</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"NAME_uc:          %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NAME_uc</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"NULLABLE:         %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">NULLABLE</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"PRECISION:        %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">PRECISION</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"SCALE:            %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">SCALE</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"TYPE:             %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">TYPE</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_is_blob:    %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_is_blob</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_is_key:     %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_is_key</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_is_num:     %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_is_num</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_is_pri_key: %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_is_pri_key</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_max_length: %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_max_length</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_table:      %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_table</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_type:       %d\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_type</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
  <code class="nb">printf</code> <code class="s">"mysql_type_name:  %s\n"</code><code class="p">,</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">mysql_type_name</code><code class="p">}</code><code class="o">-&gt;</code><code class="p">[</code><code class="nv">$i</code><code class="p">];</code>
<code class="p">}</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">finish</code> <code class="p">();</code>  <code class="c1"># release result set because we didn't fetch its rows</code></pre><p>The program produces this output:</p><pre data-type="programlisting">Statement: SELECT name, birth FROM profile
NUM_OF_FIELDS: 2
--- Column 0 (name) ---
NAME_lc:          name
NAME_uc:          NAME
NULLABLE:
PRECISION:        20
SCALE:            0
TYPE:             12
mysql_is_blob:
mysql_is_key:
mysql_is_num:     0
mysql_is_pri_key:
mysql_max_length: 7
mysql_table:      profile
mysql_type:       253
mysql_type_name:  varchar
--- Column 1 (birth) ---
NAME_lc:          birth
NAME_uc:          BIRTH
NULLABLE:         1
PRECISION:        10
SCALE:            0
TYPE:             9
mysql_is_blob:
mysql_is_key:
mysql_is_num:     0
mysql_is_pri_key:
mysql_max_length: 10
mysql_table:      profile
mysql_type:       10
mysql_type_name:  date</pre><p>To get a row count from a result set generated by calling
        <code>execute()</code>, fetch the rows and count
        them yourself. Using <code>$sth-&gt;rows()</code> to get a count for <code>SELECT</code> statements is expressly deprecated in
        the DBI documentation.</p><p>You can also obtain a result set by calling one of the DBI
        methods that uses a database handle rather than a statement handle,
        such as <code>selectall_arrayref()</code> or <code>selectall_hashref()</code>. These methods provide no access to column metadata. That
        information already will have been disposed of by the time the method
        returns, and is unavailable to your scripts. However, you can derive
        column and row counts by examining the result set itself. <a data-type="xref" href="ch04.xhtml#nch-api-api-statement">Recipe 4.4</a> discusses the result set structures
        produced by several methods and how to use them to obtain row and
        column counts.</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820361996160"><h3>Ruby</h3><p>
          Ruby Mysql2 gem does not provide own methods to access result set metadata after you execute a statement. You can only get column names by calling method <code>fields</code> of the class <code>Mysql2::Result</code>.
        </p><pre data-type="programlisting" data-code-language="ruby"><code class="n">stmt</code> <code class="o">=</code> <code class="s2">"SELECT name, birth FROM profile"</code>
<code class="nb">puts</code> <code class="s2">"Statement: </code><code class="si">#{</code><code class="n">stmt</code><code class="si">}</code><code class="s2">"</code>
<code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="n">stmt</code><code class="p">)</code>
<code class="n">res</code> <code class="o">=</code> <code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">()</code>
<code class="c1"># metadata information becomes available at this point ...</code>
<code class="nb">puts</code> <code class="s2">"Number of columns: </code><code class="si">#{</code><code class="n">res</code><code class="o">.</code><code class="n">fields</code><code class="o">.</code><code class="n">size</code><code class="si">}</code><code class="s2">"</code>
<code class="nb">puts</code> <code class="s2">"Note: statement has no result set"</code> <code class="k">if</code> <code class="n">res</code><code class="o">.</code><code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>
<code class="nb">puts</code> <code class="s2">"Columns names: </code><code class="si">#{</code><code class="n">res</code><code class="o">.</code><code class="n">fields</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="s2">", "</code><code class="p">)</code><code class="si">}</code><code class="s2">"</code>
<code class="n">res</code><code class="o">.</code><code class="n">free</code></pre><p>
          To obtain other column metadata query Information Schema as we suggest in <a data-type="xref" href="#nch-meta-meta-column-info">Recipe 12.5</a>
        </p></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820363606688"><h3>PHP</h3><p>In PHP, metadata for <code>SELECT</code>
        statements is available from PDO after a successful call to
        <code>query()</code>. If you execute a
        statement using <code>prepare()</code> plus <code>execute()</code> instead (which can be used for <code>SELECT</code> or non-<code>SELECT</code> statements), metadata becomes
        available after <code>execute()</code>.</p><p>To determine metadata availability, check whether the statement
        handle <code>columnCount()</code>
        method returns a value greater than zero. If so, the handle’s <code>getColumnMeta()</code> method returns an
        associative array containing metadata for a single column. The
        following table shows the elements of this array. (The format of the
        <code>flags</code> value might differ for other
        database systems.)</p><table id="nch-meta-meta-result-php"><caption><span class="label">Table 12-3. </span>Metadata in PHP</caption><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody><tr><td><code>pdo_type </code></td><td>Column type (corresponds
                to a <code>PDO::PARAM_</code><em><code>XXX</code></em>
                value)</td></tr><tr><td><code>native_type </code></td><td>PHP native type for the
                column value</td></tr><tr><td><code>name </code></td><td>Column name</td></tr><tr><td><code>len </code></td><td>Column length</td></tr><tr><td><code>precision </code></td><td>Column precision</td></tr><tr><td><code>flags </code></td><td>Array of flags describing
                the column attributes</td></tr><tr><td><code>table </code></td><td>Name of table the column
                is part of</td></tr></tbody></table><p>This example code shows how to execute a statement and display
        result set metadata:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$stmt</code> <code class="o">=</code> <code class="s2">"SELECT name, birth FROM profile"</code><code class="p">;</code>
<code class="k">print</code> <code class="p">(</code><code class="s2">"Statement: </code><code class="si">$stmt\n</code><code class="s2">"</code><code class="p">);</code>
<code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">prepare</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">execute</code> <code class="p">();</code>
<code class="c1"># metadata information becomes available at this point ...</code>
<code class="nv">$ncols</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">columnCount</code> <code class="p">();</code>
<code class="k">print</code> <code class="p">(</code><code class="s2">"Number of columns: </code><code class="si">$ncols\n</code><code class="s2">"</code><code class="p">);</code>
<code class="k">if</code> <code class="p">(</code><code class="nv">$ncols</code> <code class="o">==</code> <code class="mi">0</code><code class="p">)</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Note: statement has no result set</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="k">for</code> <code class="p">(</code><code class="nv">$i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nv">$i</code> <code class="o">&lt;</code> <code class="nv">$ncols</code><code class="p">;</code> <code class="nv">$i</code><code class="o">++</code><code class="p">)</code>
<code class="p">{</code>
  <code class="nv">$col_info</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">getColumnMeta</code> <code class="p">(</code><code class="nv">$i</code><code class="p">);</code>
  <code class="nv">$flags</code> <code class="o">=</code> <code class="nb">implode</code> <code class="p">(</code><code class="s2">","</code><code class="p">,</code> <code class="nb">array_values</code> <code class="p">(</code><code class="nv">$col_info</code><code class="p">[</code><code class="s2">"flags"</code><code class="p">]));</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"--- Column %d (%s) ---</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$i</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"name"</code><code class="p">]);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"pdo_type:     %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"pdo_type"</code><code class="p">]);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"native_type:  %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"native_type"</code><code class="p">]);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"len:          %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"len"</code><code class="p">]);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"precision:    %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"precision"</code><code class="p">]);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"flags:        %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$flags</code><code class="p">);</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"table:        %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$col_info</code><code class="p">[</code><code class="s2">"table"</code><code class="p">]);</code>
<code class="p">}</code></pre><p>The program produces this output:</p><pre data-type="programlisting">Statement: SELECT name, birth FROM profile
Number of columns: 2
--- Column 0 (name) ---
PDO type:     2
native type:  VAR_STRING
len:          20
precision:    0
flags:        not_null
table:        profile
--- Column 1 (birth) ---
PDO type:     2
native type:  DATE
len:          10
precision:    0
flags:
table:        profile</pre><p>To get a row count from a statement that returns rows, fetch the
        rows and count them yourself. The <code>rowCount()</code> method is not guaranteed to work
        for result sets.</p></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820361145264"><h3>Python</h3><p>For statements that produce a result set, Python’s DB API makes row and
        column counts available, as well as a few information items about
        individual columns.</p><p>To get the row count for a result set, access the cursor’s <code>rowcount</code>
        attribute. This requires that the cursor be buffered so that it
        fetches query results immediately; otherwise, you must count the rows
        as you fetch them. The column count is not available directly, but
        after calling <code>fetchone()</code> or
        <code>fetchall()</code>, you can determine the
        count as the length of any result set row tuple. It’s also possible to
        determine the column count without fetching any rows by using <code>cursor.description</code>. This is a tuple
        containing one element per column in the result set, so its length
        tells you how many columns are in the set. (If the statement generates
        no result set, such as for <code>UPDATE</code>,
        the value of <code>description</code> is
        <code>None</code>.) Each element of the <code>description</code> tuple is another tuple that
        represents the metadata for the corresponding column of the result.
        For Connector/Python, only a few <code>description</code> values are meaningful. The
        following code shows how to access them:</p><pre data-type="programlisting" data-code-language="python"><code class="n">stmt</code> <code class="o">=</code> <code class="s2">"SELECT name, birth FROM profile"</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Statement: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">stmt</code><code class="p">)</code>
<code class="c1"># buffer cursor so that rowcount has usable value</code>
<code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">(</code><code class="n">buffered</code><code class="o">=</code><code class="bp">True</code><code class="p">)</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">stmt</code><code class="p">)</code>
<code class="c1"># metadata information becomes available at this point ...</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="k">if</code> <code class="n">cursor</code><code class="o">.</code><code class="n">description</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>  <code class="c1"># no result set</code>
  <code class="n">ncols</code> <code class="o">=</code> <code class="mi">0</code>
<code class="k">else</code><code class="p">:</code>
  <code class="n">ncols</code> <code class="o">=</code> <code class="nb">len</code><code class="p">(</code><code class="n">cursor</code><code class="o">.</code><code class="n">description</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of columns: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">ncols</code><code class="p">)</code>
<code class="k">if</code> <code class="n">ncols</code> <code class="o">==</code> <code class="mi">0</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Note: statement has no result set"</code><code class="p">)</code>
<code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">col_info</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">cursor</code><code class="o">.</code><code class="n">description</code><code class="p">):</code>
  <code class="c1"># print name, then other information</code>
  <code class="n">name</code><code class="p">,</code> <code class="nb">type</code><code class="p">,</code> <code class="n">_</code><code class="p">,</code> <code class="n">_</code><code class="p">,</code> <code class="n">_</code><code class="p">,</code> <code class="n">_</code><code class="p">,</code> <code class="n">nullable</code><code class="p">,</code> <code class="n">flags</code><code class="p">,</code> <code class="n">_</code> <code class="o">=</code> <code class="n">col_info</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"--- Column </code><code class="si">%d</code><code class="s2"> (</code><code class="si">%s</code><code class="s2">) ---"</code> <code class="o">%</code> <code class="p">(</code><code class="n">i</code><code class="p">,</code> <code class="n">name</code><code class="p">))</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Type:     </code><code class="si">%d</code><code class="s2"> (</code><code class="si">%s</code><code class="s2">)"</code> <code class="o">%</code> <code class="p">(</code><code class="nb">type</code><code class="p">,</code> <code class="n">FieldType</code><code class="o">.</code><code class="n">get_info</code><code class="p">(</code><code class="nb">type</code><code class="p">)))</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Nullable: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">nullable</code><code class="p">))</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Flags:    </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">flags</code><code class="p">))</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>The code uses the <code>FieldType</code>
        class, imported as follows:</p><pre data-type="programlisting" data-code-language="python"><code class="kn">from</code> <code class="nn">mysql.connector</code> <code class="kn">import</code> <code class="n">FieldType</code></pre><p>The program produces this output:</p><pre data-type="programlisting">Statement:  SELECT name, birth FROM profile
Number of rows: 10
Number of columns: 2
--- Column 0 (name) ---
Type:     253 (VAR_STRING)
Nullable: 0
Flags:    4097
--- Column 1 (birth) ---
Type:     10 (DATE)
Nullable: 1
Flags:    128</pre></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820361003184"><h3>Go</h3><p>
          Go provides column metadata as array of <code>ColumnType</code> values, returned by the method <code>Rows.ColumnTypes</code>. You can query each of the array members to obtain specific characteristic of the column.
        </p><p>
          <a data-type="xref" href="#nch-meta-meta-result-go">Table 12-4</a> contains methods that the <code>ColumnType</code> supports.
        </p><table id="nch-meta-meta-result-go"><caption><span class="label">Table 12-4. </span>Metadata in Go</caption><thead><tr><th>Method name</th><th>Description</th></tr></thead><tbody><tr><td><code>DatabaseTypeName</code></td><td>Database type, such as <code>INT</code> or <code>VARCHAR</code>.</td></tr><tr><td><code>DecimalSize</code></td><td>Scale and precision for the decimal type</td></tr><tr><td><code>Length</code></td><td>Column type lenght for the variable length text and binary columns. Not supported by the MySQL driver.</td></tr><tr><td><code>Name</code></td><td>The name or the alias of the column.</td></tr><tr><td><code>Nullable</code></td><td>Whenever column is nullable.</td></tr><tr><td><code>ScanType</code></td><td>The native Go type, suitable for scanning into <code>Rows.Scan</code>.</td></tr></tbody></table><p>
          You may also get the list of column names if use method <code>Rows.Columns</code>. It returns array of strings that contain column names or aliases.
        </p><p>
          
        </p><p>
          The example code demonstrates how to obtain column names and metadata in the Go applicaiton.
        </p><pre data-type="programlisting" data-code-language="go"><code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">  </code><code class="s">"fmt"</code><code class="w"/>
<code class="w">  </code><code class="s">"log"</code><code class="w"/>
<code class="w">  </code><code class="s">"github.com/svetasmirnova/mysqlcookbook/recipes/lib/cookbook"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">  </code><code class="nx">db</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cookbook</code><code class="p">.</code><code class="nx">Connect</code><code class="p">()</code><code class="w"/>
<code class="w">  </code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">  </code><code class="nx">stmt</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">"SELECT name, birth FROM profile"</code><code class="w"/>
<code class="w">  </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"Statement: %s\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">stmt</code><code class="p">)</code><code class="w"/>

<code class="w">  </code><code class="nx">rows</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Query</code><code class="p">(</code><code class="nx">stmt</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>
<code class="w">  </code><code class="k">defer</code><code class="w"> </code><code class="nx">rows</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">  </code><code class="c1">// metadata information becomes available at this point ...</code><code class="w"/>
<code class="w">  </code><code class="nx">cols</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">rows</code><code class="p">.</code><code class="nx">ColumnTypes</code><code class="p">()</code><code class="w"/>
<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>

<code class="w">  </code><code class="nx">ncols</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nb">len</code><code class="p">(</code><code class="nx">cols</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"Number of columns: %d\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">ncols</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">ncols</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Note: statement has no result set"</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>


<code class="w">  </code><code class="k">for</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="w"> </code><code class="p">&lt;</code><code class="w"> </code><code class="nx">ncols</code><code class="p">;</code><code class="w"> </code><code class="nx">i</code><code class="o">++</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"---- Column %d (%s) ----\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">i</code><code class="p">,</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">Name</code><code class="p">())</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"DatabaseTypeName: %s\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">DatabaseTypeName</code><code class="p">())</code><code class="w"/>

<code class="w">    </code><code class="nx">collen</code><code class="p">,</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">Length</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">      </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"Length: %d\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">collen</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="nx">precision</code><code class="p">,</code><code class="w"> </code><code class="nx">scale</code><code class="p">,</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">DecimalSize</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">      </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"DecimalSize precision: %d, scale: %d\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">precision</code><code class="p">,</code><code class="w"> </code><code class="nx">scale</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="nx">colnull</code><code class="p">,</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">Nullable</code><code class="p">()</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">ok</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">      </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"Nullable: %t\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">colnull</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"ScanType: %s\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">cols</code><code class="p">[</code><code class="nx">i</code><code class="p">].</code><code class="nx">ScanType</code><code class="p">())</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
          The program produces this output:
        </p><pre data-type="programlisting" data-code-language="bash">Statement: SELECT name, birth FROM profile
Number of columns: <code class="m">2</code>
---- Column <code class="m">0</code> <code class="o">(</code>name<code class="o">)</code> ----
DatabaseTypeName: VARCHAR
Nullable: <code class="nb">false</code>
ScanType: sql.RawBytes
---- Column <code class="m">1</code> <code class="o">(</code>birth<code class="o">)</code> ----
DatabaseTypeName: DATE
Nullable: <code class="nb">true</code>
ScanType: sql.NullTime</pre></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820360860112"><h3>Java</h3><p>JDBC makes result set metadata available through a <code>ResultSetMetaData</code>
        object, obtained by calling the <code>getMetaData()</code>
        method of your <code>ResultSet</code> object.
        The metadata object provides access to several kinds of information. Its
        <code>getColumnCount()</code> method returns the number of columns in the result set. Other
        types of metadata, illustrated by the following code, provide
        information about individual columns and take a column index as their
        argument. For JDBC, column indexes begin at 1 rather than 0, unlike
        our other APIs:</p><pre data-type="programlisting" data-code-language="java"><code class="n">String</code> <code class="n">stmt</code> <code class="o">=</code> <code class="s">"SELECT name, birth FROM profile"</code><code class="o">;</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Statement: "</code> <code class="o">+</code> <code class="n">stmt</code><code class="o">);</code>
<code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code><code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code><code class="o">(</code><code class="n">stmt</code><code class="o">);</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSet</code><code class="o">();</code>
<code class="n">ResultSetMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getMetaData</code><code class="o">();</code>
<code class="c1">// metadata information becomes available at this point ...</code>
<code class="kt">int</code> <code class="n">ncols</code> <code class="o">=</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnCount</code><code class="o">();</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Number of columns: "</code> <code class="o">+</code> <code class="n">ncols</code><code class="o">);</code>
<code class="k">if</code> <code class="o">(</code><code class="n">ncols</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"Note: statement has no result set"</code><code class="o">);</code>
<code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">1</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;=</code> <code class="n">ncols</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code> <code class="c1">// column index values are 1-based</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"--- Column "</code> <code class="o">+</code> <code class="n">i</code>
            <code class="o">+</code> <code class="s">" ("</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnName</code> <code class="o">(</code><code class="n">i</code><code class="o">)</code> <code class="o">+</code> <code class="s">") ---"</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getColumnDisplaySize: "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnDisplaySize</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getColumnLabel:       "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnLabel</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getColumnType:        "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnType</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getColumnTypeName:    "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnTypeName</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getPrecision:         "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getPrecision</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getScale:             "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getScale</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"getTableName:         "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getTableName</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"isAutoIncrement:      "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">isAutoIncrement</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"isNullable:           "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">isNullable</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"isCaseSensitive:      "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">isCaseSensitive</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"isSigned:             "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">isSigned</code> <code class="o">(</code><code class="n">i</code><code class="o">));</code>
<code class="o">}</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code></pre><p>The program produces this output:</p><pre data-type="programlisting">Statement: SELECT name, birth FROM profile
Number of columns: 2
--- Column 1 (name) ---
getColumnDisplaySize: 20
getColumnLabel:       name
getColumnType:        12
getColumnTypeName:    VARCHAR
getPrecision:         20
getScale:             0
getTableName:         profile
isAutoIncrement:      false
isNullable:           0
isCaseSensitive:      false
isSigned:             false
--- Column 2 (birth) ---
getColumnDisplaySize: 10
getColumnLabel:       birth
getColumnType:        91
getColumnTypeName:    DATE
getPrecision:         10
getScale:             0
getTableName:         profile
isAutoIncrement:      false
isNullable:           1
isCaseSensitive:      false
isSigned:             false</pre><p>The row count of the result set is not available directly; you
        must fetch the rows and count them.</p><p>JDBC has several other result set metadata calls, but many of
        them provide no useful information for MySQL. To try them, consult a JDBC
        reference to see what the calls are and modify the program to see
        what, if anything, they return.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.3 Listing or Checking the Existence of Databases or Tables"><div class="sect1" id="nch-meta-meta-table-list"><h1>12.3 Listing or Checking the Existence of Databases or Tables</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820360357120"><h2>Problem</h2><p>You want to list the databases hosted by the MySQL server or the tables in a
      database. Or you want to check whether a particular database or table
      exists.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820360356240"><h2>Solution</h2><p>Use <code>INFORMATION_SCHEMA</code> to get
      this information. The <code>SCHEMATA</code> table contains a row for each
      database, and the <code>TABLES</code> table
      contains a row for each table or view in each database.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820360253088"><h2>Discussion</h2><p>To retrieve the list of databases hosted by the server, use this
      statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="k">SCHEMA_NAME</code> <code class="k">FROM</code> <code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">SCHEMATA</code><code class="p">;</code></pre><p>To sort the result, add an <code>ORDER</code> <code>BY</code> <code>SCHEMA_NAME</code> clause.</p><p>To check whether a specific database exists, use a <code>WHERE</code> clause with a condition that names the
      database. If you get a row back, the database exists. The following
      Ruby method shows how to perform an existence test for a
      database:</p><pre data-type="programlisting" data-code-language="ruby"><code class="k">def</code> <code class="nf">database_exists</code><code class="p">(</code><code class="n">client</code><code class="p">,</code> <code class="n">db_name</code><code class="p">)</code>
  <code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="s2">"SELECT SCHEMA_NAME</code>
<code class="s2">                        FROM INFORMATION_SCHEMA.SCHEMATA</code>
<code class="s2">                        WHERE SCHEMA_NAME = ?"</code><code class="p">)</code>
  <code class="k">return</code> <code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">db_name</code><code class="p">)</code><code class="o">.</code><code class="n">count</code> <code class="o">&gt;</code> <code class="mi">0</code>
<code class="k">end</code></pre><p>To obtain the list of tables in a database, name the database in
      the <code>WHERE</code> clause of a statement that
      selects from the <code>TABLES</code> table:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="k">TABLE_NAME</code> <code class="k">FROM</code> <code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLES</code>
<code class="k">WHERE</code> <code class="n">TABLE_SCHEMA</code> <code class="o">=</code> <code class="s1">'cookbook'</code><code class="p">;</code></pre><p>To sort the result, add an <code>ORDER</code> <code>BY</code>
      <code>TABLE_NAME</code> clause.</p><p>To obtain a list of tables in the default database, use this
      statement instead:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="k">TABLE_NAME</code> <code class="k">FROM</code> <code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLES</code>
<code class="k">WHERE</code> <code class="n">TABLE_SCHEMA</code> <code class="o">=</code> <code class="k">DATABASE</code><code class="p">();</code></pre><p>If no database has been selected, <code>DATABASE()</code> returns <code>NULL</code> and no rows match, which is the correct
      result.</p><p>To check whether a specific table exists, use a <code>WHERE</code> clause with a
      condition that names the table. Here’s a Ruby method that performs an existence test for a table in
      a given database:</p><pre data-type="programlisting" data-code-language="ruby"><code class="k">def</code> <code class="nf">table_exists</code><code class="p">(</code><code class="n">client</code><code class="p">,</code> <code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">)</code>
  <code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="s2">"SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES</code>
<code class="s2">                        WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?"</code><code class="p">)</code>
  <code class="k">return</code> <code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">)</code><code class="o">.</code><code class="n">count</code> <code class="o">&gt;</code> <code class="mi">0</code>
<code class="k">end</code></pre><p>Some APIs provide a database-independent way to get database or
      table lists. In Perl DBI, the database handle <code>tables()</code> method returns a list of tables in the default database:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">@tables</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">tables</code> <code class="p">();</code></pre><p>For Java, there are JDBC methods designed to return lists of databases or
      tables. For each method, invoke your connection object’s <code>getMetaData()</code>
      method and use the resulting <code>DatabaseMetaData</code> object to retrieve the
      information you want. Here’s how to produce a list of databases:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// get list of databases</code>
<code class="n">DatabaseMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getMetaData</code> <code class="o">();</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">md</code><code class="o">.</code><code class="na">getCatalogs</code> <code class="o">();</code>
<code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">getString</code> <code class="o">(</code><code class="mi">1</code><code class="o">));</code>  <code class="c1">// column 1 = database name</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code></pre><p>To list the tables in a database, do this:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// get list of tables in database named by dbName; if</code>
<code class="c1">// dbName is the empty string, the default database is used</code>
<code class="n">DatabaseMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getMetaData</code> <code class="o">();</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">md</code><code class="o">.</code><code class="na">getTables</code> <code class="o">(</code><code class="n">dbName</code><code class="o">,</code> <code class="s">""</code><code class="o">,</code> <code class="s">"%"</code><code class="o">,</code> <code class="kc">null</code><code class="o">);</code>
<code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">getString</code> <code class="o">(</code><code class="mi">3</code><code class="o">));</code>  <code class="c1">// column 3 = table name</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.4 Listing or Checking the Existence of Views"><div class="sect1" id="nch-meta-meta-views"><h1>12.4 Listing or Checking the Existence of Views</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820359759424"><h2>Problem</h2><p>
        You want to check if your database contains views.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820359725600"><h2>Solution</h2><p>
        Select only those tables from the table <code>INFORMATION_SCHEMA.TABLES</code> that have <code>TABLE_TYPE</code> equal to <code>VIEW</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820359723472"><h2>Discussion</h2><p>
        Method, used in the <a data-type="xref" href="#nch-meta-meta-table-list">Recipe 12.3</a> shows both physical tables and views. If you need to distinguish them from each other use clause <code>WHERE TABLE_TYPE='VIEW'</code> to list only views:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="p">,</code><code> </code><code class="k">TABLE_NAME</code><code class="p">,</code><code> </code><code class="n">TABLE_TYPE</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLES</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">TABLE_TYPE</code><code class="o">=</code><code class="s1">'VIEW'</code><code> </code><code class="k">AND</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------+---------------------+------------+
</code><code class="o">|</code><code> </code><code class="n">TABLE_SCHEMA</code><code> </code><code class="o">|</code><code> </code><code class="k">TABLE_NAME</code><code>          </code><code class="o">|</code><code> </code><code class="n">TABLE_TYPE</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+---------------------+------------+
</code><code class="o">|</code><code> </code><code class="n">cookbook</code><code>     </code><code class="o">|</code><code> </code><code class="n">patients_statistics</code><code> </code><code class="o">|</code><code> </code><code class="k">VIEW</code><code>       </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+---------------------+------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
          If you want, instead, to list only physical tables, use condition <code>TABLE_TYPE='BASE TABLE'</code>:
          </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="p">,</code><code> </code><code class="k">TABLE_NAME</code><code class="p">,</code><code> </code><code class="n">TABLE_TYPE</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLES</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">TABLE_TYPE</code><code class="o">=</code><code class="s1">'BASE TABLE'</code><code> </code><code class="k">AND</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AND</code><code> </code><code class="k">TABLE_NAME</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'trip%'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------+------------+------------+
</code><code class="o">|</code><code> </code><code class="n">TABLE_SCHEMA</code><code> </code><code class="o">|</code><code> </code><code class="k">TABLE_NAME</code><code> </code><code class="o">|</code><code> </code><code class="n">TABLE_TYPE</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+------------+------------+
</code><code class="o">|</code><code> </code><code class="n">cookbook</code><code>     </code><code class="o">|</code><code> </code><code class="n">trip_leg</code><code>   </code><code class="o">|</code><code> </code><code class="n">BASE</code><code> </code><code class="k">TABLE</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">cookbook</code><code>     </code><code class="o">|</code><code> </code><code class="n">trip_log</code><code>   </code><code class="o">|</code><code> </code><code class="n">BASE</code><code> </code><code class="k">TABLE</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+------------+------------+
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.5 Accessing Table Column Definitions"><div class="sect1" id="nch-meta-meta-column-info"><h1>12.5 Accessing Table Column Definitions</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820364596464"><h2>Problem</h2><p>You want to find out what columns a table has and how they are defined.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820359496080"><h2>Solution</h2><p>There are several ways to do this. You can obtain column
      definitions from <code>INFORMATION_SCHEMA</code>, from <code>SHOW</code> statements, or from <span class="command"><em>mysqldump</em></span>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820359509504"><h2>Discussion</h2><p>Information about the structure of tables enables you to answer
      questions such as <q>What columns does a table contain and what are
      their types?</q> or <q>What are the legal values for an <code>ENUM</code> or <code>SET</code>
      column?</q> Here are some applications for that kind of
      information:</p><dl><dt>Displaying column lists</dt><dd><p>A simple use of table information is presenting a list of
            the table’s columns. This is common in web-based or GUI
            applications that enable users to construct statements
            interactively by selecting a table column from a list and entering
            a value against which to compare column values.</p></dd><dt>Interactive record editing</dt><dd><p>Knowledge of a table’s structure can be very useful for
            applications that modify data interactively. Suppose that an
            application retrieves a record from the database, displays a form
            containing the record’s content so a user can edit it, and then
            updates the record in the database after the user modifies the
            form and submits it. You can use table structure information for
            validating column values, so you would not try to insert invalid values into a database. If a column is an <code>ENUM</code>, you can find out the valid
            enumeration values and check the value submitted by the user
            against them to determine whether it’s legal. If the column is an
            integer type, check the submitted value to make sure that it
            consists entirely of digits, possibly preceded by a <code>+</code> or <code>−</code> sign character. If the column contains
            dates, look for a legal date format.</p><p>But what if the user leaves a field empty? If the field
            corresponds to, say, a <code>CHAR</code>
            column in the table, do you set the column value to <code>NULL</code> or to the empty string? This too is
            a question that can be answered by checking the table’s structure.
            <span class="keep-together">Determine</span> whether the column
            can contain <code>NULL</code> values. If it
            can, set the column to <code>NULL</code>;
            otherwise, set it to the empty string.</p></dd><dt>Mapping column definitions onto web page elements</dt><dd><p>Some data types such as <code>ENUM</code> and <code>SET</code> correspond naturally to elements of
            web forms:</p><ul><li><p>An <code>ENUM</code> has a fixed
                set of values from which you choose a single value.
                This is analogous to a group of radio buttons, a pop-up menu,
                or a single-pick scrolling list.</p></li><li><p>A <code>SET</code> column is
                similar, except that you can select multiple values; this
                corresponds to a group of checkboxes or a multiple-pick
                scrolling list.</p></li></ul><p>By using table metadata to access definitions for these
            types of columns, you can easily determine a column’s legal values
            and map them onto an appropriate form element. <a data-type="xref" href="#nch-meta-meta-enum">Recipe 12.6</a> discusses how to get definitions
            for these types of columns.</p></dd></dl><p>MySQL provides several ways to find out about a table’s
      structure:</p><ul><li><p>Retrieve the information from <code>INFORMATION_SCHEMA</code>. The <code>COLUMNS</code> table contains the column
          definitions.</p></li><li><p>Use a <code>SHOW</code> <code>COLUMNS</code> statement.</p></li><li><p>Use the <code>SHOW</code> <code>CREATE</code> <code>TABLE</code> statement or the <span class="command"><em>mysqldump</em></span>
          command-line program to obtain a <code>CREATE</code> <code>TABLE</code> statement that displays the table’s
          structure.</p></li></ul><p>The following discussion shows how to ask MySQL for table
      information using each method. To try the examples, create an <code>item</code> table that lists item IDs, names, and
      colors in which each item is available:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">item</code>
<code class="p">(</code>
  <code class="n">id</code>      <code class="nb">INT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="n">name</code>    <code class="nb">CHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">),</code>
  <code class="n">colors</code>  <code class="n">ENUM</code><code class="p">(</code><code class="s1">'chartreuse'</code><code class="p">,</code><code class="s1">'mauve'</code><code class="p">,</code><code class="s1">'lime green'</code><code class="p">,</code><code class="s1">'puce'</code><code class="p">)</code> <code class="k">DEFAULT</code> <code class="s1">'puce'</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">)</code>
<code class="p">);</code></pre><section data-type="sect3" data-pdf-bookmark="Using INFORMATION_SCHEMA to get table structure"><div class="sect3" id="idm45820359450480"><h3>Using INFORMATION_SCHEMA to get table structure</h3><p>To obtain information about a single column in a table, query
        table <code>INFORMATION_SCHEMA.COLUMNS</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM INFORMATION_SCHEMA.COLUMNS</code></strong>
    -&gt; <strong><code>WHERE TABLE_SCHEMA = 'cookbook' AND TABLE_NAME = 'item'</code></strong>
    -&gt; <strong><code>AND COLUMN_NAME = 'colors'\G</code></strong>
*************************** 1. row ***************************
           TABLE_CATALOG: def
            TABLE_SCHEMA: cookbook
              TABLE_NAME: item
             COLUMN_NAME: colors
        ORDINAL_POSITION: 3
          COLUMN_DEFAULT: puce
             IS_NULLABLE: YES
               DATA_TYPE: enum
CHARACTER_MAXIMUM_LENGTH: 10
  CHARACTER_OCTET_LENGTH: 10
       NUMERIC_PRECISION: NULL
           NUMERIC_SCALE: NULL
      DATETIME_PRECISION: NULL
      CHARACTER_SET_NAME: utf8mb4
          COLLATION_NAME: utf8mb4_0900_ai_ci
             COLUMN_TYPE: enum('chartreuse','mauve','lime green','puce')
              COLUMN_KEY:
                   EXTRA:
              PRIVILEGES: select,insert,update,references
          COLUMN_COMMENT:</pre><p>To obtain information about all columns, omit the <code>COLUMN_NAME</code> condition from the <code>WHERE</code>
        clause.</p><p>Here are some <code>COLUMNS</code> table
        columns likely to be of most use:</p><ul><li><p><code>COLUMN_NAME</code>: The column
            name.</p></li><li><p><code>ORDINAL_POSITION</code>: The
            position of the column within the table definition.</p></li><li><p><code>COLUMN_DEFAULT</code>: The
            column’s default value.</p></li><li><p><code>IS_NULLABLE</code>: <code>YES</code> or <code>NO</code> to indicate whether the column can
            contain <code>NULL</code> values.</p></li><li><p><code>DATA_TYPE</code>, <code>COLUMN_TYPE</code>: Data type information.
            <code>DATA_TYPE</code> is the data-type
            keyword and <code>COLUMN_TYPE</code>
            contains additional information such as type attributes.</p></li><li><p><code>CHARACTER_SET_NAME</code>,
            <code>COLLATION_NAME</code>: The character
            set and collation for string columns. They are <code>NULL</code> for nonstring columns.</p></li><li><p><code>COLUMN_KEY</code>: Information
            about whether the column is indexed.</p></li></ul><p><code>INFORMATION_SCHEMA</code> content is
        easy to use from within programs. Here’s a PHP function that illustrates this process. It takes
        database and table name arguments, selects from <code>INFORMATION_SCHEMA</code> to obtain a list of the
        table’s column names, and returns the names as an array. The <code>ORDER</code> <code>BY</code> <code>ORDINAL_POSITION</code> clause ensures that names
        in the array are returned in table-definition order:</p><pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">get_column_names</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">,</code> <code class="nv">$db_name</code><code class="p">,</code> <code class="nv">$tbl_name</code><code class="p">)</code>
<code class="p">{</code>
  <code class="nv">$stmt</code> <code class="o">=</code> <code class="s2">"SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS</code>
<code class="s2">           WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?</code>
<code class="s2">           ORDER BY ORDINAL_POSITION"</code><code class="p">;</code>
  <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">prepare</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
  <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">execute</code> <code class="p">(</code><code class="k">array</code> <code class="p">(</code><code class="nv">$db_name</code><code class="p">,</code> <code class="nv">$tbl_name</code><code class="p">));</code>
  <code class="k">return</code> <code class="p">(</code><code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">fetchAll</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_COLUMN</code><code class="p">,</code> <code class="mi">0</code><code class="p">));</code>
<code class="p">}</code></pre><p><code>get_column_names()</code> returns an
        array containing only column names. If you require additional column
        information, it’s possible to write a more general <code>get_column_info()</code> routine that returns an
        array of column information structures. For implementations of both
        routines in PHP as well as other languages, check the library files in
        the <em class="filename">lib</em> directory of the <code>recipes</code>
        distribution.</p></div></section><section data-type="sect3" data-pdf-bookmark="Using SHOW COLUMNS to get table structure"><div class="sect3" id="idm45820359341824"><h3>Using SHOW COLUMNS to get table structure</h3><p>The <code>SHOW</code> <code>COLUMNS</code> statement produces one row of output for each column in the table,
        with each row providing various pieces of information about the
        corresponding column. The following example demonstrates <code>SHOW</code> <code>COLUMNS</code> output for the <code>item</code> table <code>colors</code> column:</p><pre data-type="programlisting">mysql&gt; <strong><code>SHOW COLUMNS FROM item LIKE 'colors'\G</code></strong>
*************************** 1. row ***************************
  Field: colors
   Type: enum('chartreuse','mauve','lime green','puce')
   Null: YES
    Key:
Default: puce
  Extra:</pre><p><code>SHOW</code> <code>COLUMNS</code> displays information for all columns
        having a name that matches the <code>LIKE</code>
        pattern. To obtain information about all columns, omit the <code>LIKE</code> clause.</p><p>The values displayed by <code>SHOW</code>
        <code>COLUMNS</code> correspond to these columns
        of the <code>INFORMATION_SCHEMA</code> <code>COLUMNS</code> table: <code>COLUMN_NAME</code>, <code>COLUMN_TYPE</code>, <code>COLUMN_KEY</code>, <code>IS_NULLABLE</code>, <code>COLUMN_DEFAULT</code>, <code>EXTRA</code>.</p><p><code>SHOW</code> <code>FULL</code> <code>COLUMNS</code> displays additional <code>Collation</code>, <code>Privileges</code>, and <code>Comment</code> fields for each column. These
        correspond to the <code>COLUMNS</code> table
        <code>COLLATION_NAME</code>, <code>PRIVILEGES</code>, and <code>COLUMN_COMMENT</code> columns.</p><p><code>SHOW</code> interprets the pattern
        the same way as for the <code>LIKE</code> operator in
        the <code>WHERE</code> clause of a <code>SELECT</code> statement. (For information about
        pattern matching, see <a data-type="xref" href="ch07.xhtml#nch-strings-strings-pat-sql">Recipe 7.10</a>.)
        If you specify a literal column name, the string matches only that
        name and <code>SHOW</code> <code>COLUMNS</code> displays information only for that
        column. If your column name
        contains SQL pattern characters (<code>%</code> or
        <code>_</code>) that you want to match
        literally, you must escape them with a backslash in the pattern string to avoid matching other
        names as well.</p><p>The need to escape <code>%</code> and
        <code>_</code> characters to match a <code>LIKE</code> pattern literally also applies to other
        <code>SHOW</code> statements that permit a name
        pattern in the <code>LIKE</code> clause, such as
        <code>SHOW</code> <code>TABLES</code> and <code>SHOW</code> <code>DATABASES</code>.</p><p>Within a program, you can use your API language’s
        pattern-matching capabilities to escape SQL pattern characters before
        putting the column name into a <code>SHOW</code>
        statement. In Perl, Ruby, and PHP, use the following
        expressions.</p><p>Perl:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$name</code> <code class="o">=~</code> <code class="sr">s/([%_])/\\$1/g</code><code class="p">;</code></pre><p>Ruby:</p><pre data-type="programlisting" data-code-language="ruby"><code class="nb">name</code> <code class="o">=</code> <code class="nb">name</code><code class="o">.</code><code class="n">gsub</code><code class="p">(</code><code class="sr">/([%_])/</code><code class="p">,</code> <code class="s1">'</code><code class="se">\\\\\1</code><code class="s1">'</code><code class="p">)</code></pre><p>PHP:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$name</code> <code class="o">=</code> <code class="nb">preg_replace</code> <code class="p">(</code><code class="s1">'/([%_])/'</code><code class="p">,</code> <code class="s1">'\\\\$1'</code><code class="p">,</code> <code class="nv">$name</code><code class="p">);</code></pre><p>For Python, import the <code>re</code> module,
        and use its <code>sub()</code> method:</p><pre data-type="programlisting" data-code-language="python"><code class="n">name</code> <code class="o">=</code> <code class="n">re</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="sa">r</code><code class="s1">'([%_])'</code><code class="p">,</code> <code class="sa">r</code><code class="s1">'</code><code class="se">\\</code><code class="s1">\1'</code><code class="p">,</code> <code class="n">name</code><code class="p">)</code></pre><p>
          For Go, use methods from the <code>regexp</code> package:
        </p><pre data-type="programlisting" data-code-language="go"><code class="kn">import</code><code class="w"> </code><code class="s">"regexp"</code><code class="w"/>
<code class="c1">// ...</code><code class="w"/>
<code class="w">  </code><code class="nx">re</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">regexp</code><code class="p">.</code><code class="nx">MustCompile</code><code class="p">(</code><code class="s">`([_%])`</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="nx">name</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">re</code><code class="p">.</code><code class="nx">ReplaceAllString</code><code class="p">(</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="s">"\\\\$1"</code><code class="p">)</code><code class="w"/></pre><p>For Java, use methods from the <code>java.util.regex</code>
        package:</p><pre data-type="programlisting" data-code-language="java"><code class="kn">import</code> <code class="nn">java.util.regex.*</code><code class="o">;</code>

<code class="n">Pattern</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="s">"([_%])"</code><code class="o">);</code>
<code class="n">Matcher</code> <code class="n">m</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">name</code><code class="o">);</code>
<code class="n">name</code> <code class="o">=</code> <code class="n">m</code><code class="o">.</code><code class="na">replaceAll</code> <code class="o">(</code><code class="s">"\\\\$1"</code><code class="o">);</code></pre><p>If these expressions appear to have too many backslashes,
        remember that the API language processor itself interprets backslashes
        and strips off a level before performing the pattern match. To get a
        literal backslash into the result, it must be doubled in the pattern.
        Another level on top of that is needed if the pattern processor strips a set.</p></div></section><section data-type="sect3" data-pdf-bookmark="Using SHOW CREATE TABLE to get table structure"><div class="sect3" id="idm45820359341360"><h3>Using SHOW CREATE TABLE to get table structure</h3><p>Another way to obtain table structure information from MySQL is from the <code>CREATE</code> <code>TABLE</code> statement that defines the table. To
        get this information, use the <code>SHOW</code>
        <code>CREATE</code> <code>TABLE</code> statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SHOW CREATE TABLE item\G</code></strong>
*************************** 1. row ***************************
       Table: item
Create Table: CREATE TABLE `item` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` char(20) DEFAULT NULL,
  `colors` enum('chartreuse','mauve','lime green','puce') DEFAULT 'puce',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</pre><p>From the command line, the same <code>CREATE</code> <code>TABLE</code> information is available from <span class="command"><em>mysqldump</em></span> if you use the
        <code class="option">--no-data</code> option, which tells <span class="command"><em>mysqldump</em></span>
        to dump only the structure of the table and not its data.</p><p><code>CREATE</code> <code>TABLE</code> format is highly informative and easy
        to read because it shows column information in a format similar to the
        one you used to create the table in the first place. It also shows the
        index structure clearly, whereas the other methods do not. However,
        you’ll probably find this method of checking table structure more
        useful interactively than within programs. The information isn’t
        provided in regular row-and-column format, so it’s more difficult to
        parse. Also, the format is subject to change whenever the <code>CREATE</code> <code>TABLE</code> statement is enhanced, which happens
        from time to time as MySQL’s capabilities are extended.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.6 Getting ENUM and SET Column Information"><div class="sect1" id="nch-meta-meta-enum"><h1>12.6 Getting ENUM and SET Column Information</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820359045168"><h2>Problem</h2><p>You want to know the members of an <code>ENUM</code> or <code>SET</code> column.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820359043328"><h2>Solution</h2><p>This problem is a subset of getting table structure metadata.
      Obtain the column definition from the table metadata, then extract the
      member list from the definition.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820359042160"><h2>Discussion</h2><p>It’s often useful to know the list of allowed values for an <code>ENUM</code> or <code>SET</code>
      column. Suppose that you want to present a web form containing a pop-up
      menu that has options corresponding to each legal value of an <code>ENUM</code> column, such as the sizes in which a
      garment can be ordered, or the available shipping methods for delivering
      a package. You could hardwire the choices into the script that generates
      the form, but if you alter the column later (for example, to add a new
      enumeration value), you introduce a discrepancy between the column and
      the script that uses it. If instead you look up the legal values using
      the table metadata, the script can always produce a pop-up that contains
      the proper set of values. A similar approach applies to <code>SET</code> columns.</p><p>To determine the permitted values for an <code>ENUM</code> or <code>SET</code>
      column, get its definition using one of the techniques described in
      <a data-type="xref" href="#nch-meta-meta-column-info">Recipe 12.5</a>. For example, if you select
      from the <code>INFORMATION_SCHEMA</code> <code>COLUMNS</code> table, the <code>COLUMN_TYPE</code> value for the <code>colors</code> column of the <code>item</code> table looks like this:</p><pre data-type="programlisting">enum('chartreuse','mauve','lime green','puce')</pre><p><code>SET</code> columns are similar, except
      that they say <code>set</code> rather than
      <code>enum</code>. For either data type, extract
      the permitted values by stripping the initial word and the parentheses,
      splitting at the commas, and removing the enclosing quotes from the
      individual values. 
      </p><p>Let’s write a <code>get_enumorset_info()</code> routine to extract
      these values from the data-type definition. While we’re at it, we can
      have the routine return the column’s type, its default value, and
      whether values can be <code>NULL</code>. Then the
      routine can be used by scripts that may need more than just the list of
      values. Here is a version in Ruby. Its arguments are a database handle, a database
      name, a table name, and a column name. It returns a hash with entries
      corresponding to the various aspects of the column definition (or <code>nil</code> if the column does not exist):</p><pre data-type="programlisting" data-code-language="ruby"><code class="k">def</code> <code class="nf">get_enumorset_info</code><code class="p">(</code><code class="n">client</code><code class="p">,</code> <code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">,</code> <code class="n">col_name</code><code class="p">)</code>
  <code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code>
          <code class="s2">"SELECT COLUMN_NAME, COLUMN_TYPE, IS_NULLABLE, COLUMN_DEFAULT</code>
<code class="s2">           FROM INFORMATION_SCHEMA.COLUMNS</code>
<code class="s2">           WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ? AND COLUMN_NAME = ?"</code><code class="p">)</code>
  <code class="n">res</code> <code class="o">=</code> <code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">,</code> <code class="n">col_name</code><code class="p">)</code>
  <code class="k">return</code> <code class="kp">nil</code> <code class="k">if</code> <code class="n">res</code><code class="o">.</code><code class="n">count</code> <code class="o">==</code> <code class="mi">0</code>  <code class="c1"># no such column</code>
  <code class="n">row</code> <code class="o">=</code> <code class="n">res</code><code class="o">.</code><code class="n">first</code>
  <code class="n">info</code> <code class="o">=</code> <code class="p">{}</code>
  <code class="n">info</code><code class="o">[</code><code class="s2">"name"</code><code class="o">]</code> <code class="o">=</code> <code class="n">row</code><code class="o">.</code><code class="n">values</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code>
  <code class="k">return</code> <code class="kp">nil</code> <code class="k">unless</code> <code class="n">row</code><code class="o">.</code><code class="n">values</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code> <code class="o">=~</code> <code class="sr">/^(ENUM|SET)\((.*)\)$/i</code> <code class="c1"># not ENUM or SET</code>
  <code class="n">info</code><code class="o">[</code><code class="s2">"type"</code><code class="o">]</code> <code class="o">=</code> <code class="vg">$1</code>
  <code class="c1"># split value list on commas, trim quotes from end of each word</code>
  <code class="n">info</code><code class="o">[</code><code class="s2">"values"</code><code class="o">]</code> <code class="o">=</code> <code class="vg">$2</code><code class="o">.</code><code class="n">split</code><code class="p">(</code><code class="s2">","</code><code class="p">)</code><code class="o">.</code><code class="n">collect</code> <code class="p">{</code> <code class="o">|</code><code class="n">val</code><code class="o">|</code> <code class="n">val</code><code class="o">.</code><code class="n">sub</code><code class="p">(</code><code class="sr">/^'(.*)'$/</code><code class="p">,</code> <code class="s2">"</code><code class="se">\\</code><code class="s2">1"</code><code class="p">)</code> <code class="p">}</code>
  <code class="c1"># determine whether column can contain NULL values</code>
  <code class="n">info</code><code class="o">[</code><code class="s2">"nullable"</code><code class="o">]</code> <code class="o">=</code> <code class="p">(</code><code class="n">row</code><code class="o">.</code><code class="n">values</code><code class="o">[</code><code class="mi">2</code><code class="o">].</code><code class="n">upcase</code> <code class="o">==</code> <code class="s2">"YES"</code><code class="p">)</code>
  <code class="c1"># get default value (nil represents NULL)</code>
  <code class="n">info</code><code class="o">[</code><code class="s2">"default"</code><code class="o">]</code> <code class="o">=</code> <code class="n">row</code><code class="o">.</code><code class="n">values</code><code class="o">[</code><code class="mi">3</code><code class="o">]</code>
  <code class="k">return</code> <code class="n">info</code>
<code class="k">end</code></pre><p>The routine uses case-insensitive matching when checking the data
      type and nullable attributes. This guards against future lettercase
      changes in metadata results.</p><p>The following example shows how to access and display each element
      of the hash returned by <code>get_enumorset_info()</code>:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">info</code> <code class="o">=</code> <code class="n">get_enumorset_info</code><code class="p">(</code><code class="n">client</code><code class="p">,</code> <code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">,</code> <code class="n">col_name</code><code class="p">)</code>
<code class="nb">puts</code> <code class="s2">"Information for </code><code class="si">#{</code><code class="n">db_name</code><code class="si">}</code><code class="s2">.</code><code class="si">#{</code><code class="n">tbl_name</code><code class="si">}</code><code class="s2">.</code><code class="si">#{</code><code class="n">col_name</code><code class="si">}</code><code class="s2">:"</code>
<code class="k">if</code> <code class="n">info</code><code class="o">.</code><code class="n">nil?</code>
  <code class="nb">puts</code> <code class="s2">"No information available (not an ENUM or SET column?)"</code>
<code class="k">else</code>
  <code class="nb">puts</code> <code class="s2">"Name: "</code> <code class="o">+</code> <code class="n">info</code><code class="o">[</code><code class="s2">"name"</code><code class="o">]</code>
  <code class="nb">puts</code> <code class="s2">"Type: "</code> <code class="o">+</code> <code class="n">info</code><code class="o">[</code><code class="s2">"type"</code><code class="o">]</code>
  <code class="nb">puts</code> <code class="s2">"Legal values: "</code> <code class="o">+</code> <code class="n">info</code><code class="o">[</code><code class="s2">"values"</code><code class="o">].</code><code class="n">join</code><code class="p">(</code><code class="s2">","</code><code class="p">)</code>
  <code class="nb">puts</code> <code class="s2">"Nullable: "</code> <code class="o">+</code> <code class="p">(</code><code class="n">info</code><code class="o">[</code><code class="s2">"nullable"</code><code class="o">]</code> <code class="p">?</code> <code class="s2">"yes"</code> <code class="p">:</code> <code class="s2">"no"</code><code class="p">)</code>
  <code class="nb">puts</code> <code class="s2">"Default value: "</code> <code class="o">+</code> <code class="p">(</code><code class="n">info</code><code class="o">[</code><code class="s2">"default"</code><code class="o">].</code><code class="n">nil?</code> <code class="p">?</code> <code class="s2">"NULL"</code> <code class="p">:</code> <code class="n">info</code><code class="o">[</code><code class="s2">"default"</code><code class="o">]</code><code class="p">)</code>
<code class="k">end</code></pre><p>That code produces the following output for the <code>profile</code> table <code>color</code> column:</p><pre data-type="programlisting">Information for cookbook.profile.color:
Name: color
Type: enum
Legal values: blue,red,green,brown,black,white
Nullable: yes
Default value: NULL</pre><p>Equivalent routines for other APIs are similar. You can find
      implementations in the <em class="filename">lib</em>
      directory of the <code>recipes</code>
      distribution. Such routines are useful for validation of input values
      (see <a data-type="xref" href="ch14.xhtml#nch-format-format-meta">Recipe 14.11</a>).</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.7 Getting Server Metadata"><div class="sect1" id="nch-meta-meta-server"><h1>12.7 Getting Server Metadata</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820358722656"><h2>Problem</h2><p>You want to get information about the MySQL server itself, such as its version, configuration, and current status of its components.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820358643888"><h2>Solution</h2><p>Several SQL functions and <code>SHOW</code>
      statements return information about the server.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820358642624"><h2>Discussion</h2><p>MySQL has several SQL functions and statements that provide you
      with information about the server itself and about your current client
      session. <a data-type="xref" href="#nch-meta-meta-server-funcs">Table 12-5</a> shows a few that you may find useful. Both
      <code>SHOW</code> statements permit a <code>GLOBAL</code> or <code>SESSION</code> keyword to select global server values or values specific to your
      session, and a <code>LIKE</code> <code>'</code><em><code>pattern</code></em><code>'</code> clause for limiting the results to variable
      names matching the pattern:</p><table id="nch-meta-meta-server-funcs"><caption><span class="label">Table 12-5. </span>SQL Functions and Statements to Obtain Server Metadata</caption><thead><tr><th>Statement</th><th>Information produced by statement</th></tr></thead><tbody><tr><td><code>SELECT VERSION() </code></td><td>Server version string</td></tr><tr><td><code>SELECT DATABASE() </code></td><td>Default database name (<code>NULL</code> if none)</td></tr><tr><td><code>SELECT USER() </code></td><td>Current user as given by client when connecting</td></tr><tr><td><code>SELECT CURRENT_USER() </code></td><td>User used for checking client privileges</td></tr><tr><td><code>SHOW [GLOBAL|SESSION] STATUS </code></td><td>Server global or session status indicators</td></tr><tr><td><code>SHOW [GLOBAL|SESSION] VARIABLES
              </code></td><td>Server global or status configuration variables</td></tr></tbody></table><p>To obtain the information provided by any statement in the table,
      execute it and process its result set. For example, <code>SELECT</code> <code>DATABASE()</code> returns the name of the default
      database or <code>NULL</code> if no database has
      been selected. The following Ruby code uses the statement to present a
      status display containing information about the current session:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">db</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="s2">"SELECT DATABASE()"</code><code class="p">)</code><code class="o">.</code><code class="n">first</code><code class="o">.</code><code class="n">values</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code>
<code class="nb">puts</code> <code class="s2">"Default database: "</code> <code class="o">+</code> <code class="p">(</code><code class="n">db</code><code class="o">.</code><code class="n">nil?</code> <code class="p">?</code> <code class="s2">"(no database selected)"</code> <code class="p">:</code> <code class="n">db</code><code class="p">)</code></pre><p>A given API might provide alternatives to executing SQL statements
      to access these types of information. For example, JDBC has several database-independent methods for obtaining server
      metadata. Use your connection object to obtain the database metadata,
      then invoke the appropriate methods to get the information in which
      you’re interested. Consult a JDBC reference for a complete list, but
      here are a few representative examples:</p><pre data-type="programlisting" data-code-language="java"><code class="n">DatabaseMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getMetaData</code><code class="o">();</code>
<code class="c1">// can also get this with SELECT VERSION()</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Product version: "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getDatabaseProductVersion</code><code class="o">());</code>
<code class="c1">// this is similar to SELECT USER() but doesn't include the hostname</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Username: "</code> <code class="o">+</code> <code class="n">md</code><code class="o">.</code><code class="na">getUserName</code><code class="o">());</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820358577392"><h2>See Also</h2><p>For more discussion about the use of <code>SHOW</code> (and <code>INFORMATION_SCHEMA</code>) in the context of server
      monitoring, see <a data-type="xref" href="ch23.xhtml#nch-monitoring-monitoring-sources">Recipe 23.2</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.8 Writing Applications That Adapt to the MySQL Server Version"><div class="sect1" id="nch-meta-meta-server-version"><h1>12.8 Writing Applications That Adapt to the MySQL Server Version</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820358545520"><h2>Problem</h2><p>You want to use a given feature that is available only as of a particular
      version of MySQL.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820358544432"><h2>Solution</h2><p>Ask the server for its version number. If the server is too old to
      support a given feature, maybe you can fall back to a workaround, if one
      exists. Or suggest your user to upgrade.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820358543488"><h2>Discussion</h2><p> With each new release of MySQL, new features are added.
      If you’re writing an application that requires certain features, check
      the server version to determine whether they are present; if not, you
      must perform some sort of workaround (assuming there is one).</p><p>To get the server version, invoke the <code>VERSION()</code> function. The result is a string that looks something like <code>5.7.33-debug-log</code> or <code>8.0.25</code>. In other words, it returns a string
      consisting of major, minor, and <q>patch</q> version numbers,
      possibly some nondigits at the end of the <q>patch</q> version,
      and possibly some suffix. The version string can be used as is for
      presentation purposes, but for comparisons, it’s simpler to work with a
      number—in particular, a five-digit number in
      <em><code>Mmmtt</code></em> format, in which
      <em><code>M</code></em>, <em><code>mm</code></em>,
      <em><code>tt</code></em> are the major, minor, and patch version
      numbers. Perform the conversion by splitting the string at the periods,
      stripping from the third piece the suffix that begins with the first
      nonnumeric character, and joining the pieces. For example, <code>5.7.33-debug-log</code> becomes <code>50733</code>, and <code>8.0.25</code> becomes <code>80025</code>.</p><p>Here’s a Perl DBI function that takes a database-handle argument and returns a
      two-element list that contains both the string and numeric forms of the
      server version. The code assumes that the minor and patch version parts
      are less than 100 and thus no more than two digits each. That should be
      a valid assumption because the source code for MySQL itself uses the
      same format:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">sub</code> <code class="nf">get_server_version</code>
<code class="p">{</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nb">shift</code><code class="p">;</code>
<code class="k">my</code> <code class="p">(</code><code class="nv">$ver_str</code><code class="p">,</code> <code class="nv">$ver_num</code><code class="p">);</code>
<code class="k">my</code> <code class="p">(</code><code class="nv">$major</code><code class="p">,</code> <code class="nv">$minor</code><code class="p">,</code> <code class="nv">$patch</code><code class="p">);</code>

  <code class="c1"># fetch result into scalar string</code>
  <code class="nv">$ver_str</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectrow_array</code> <code class="p">(</code><code class="s">"SELECT VERSION()"</code><code class="p">);</code>
  <code class="k">return</code> <code class="nb">undef</code> <code class="k">unless</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ver_str</code><code class="p">);</code>
  <code class="p">(</code><code class="nv">$major</code><code class="p">,</code> <code class="nv">$minor</code><code class="p">,</code> <code class="nv">$patch</code><code class="p">)</code> <code class="o">=</code> <code class="nb">split</code> <code class="p">(</code><code class="sr">/\./</code><code class="p">,</code> <code class="nv">$ver_str</code><code class="p">);</code>
  <code class="nv">$patch</code> <code class="o">=~</code> <code class="sr">s/\D.*$//</code><code class="p">;</code> <code class="c1"># strip nonnumeric suffix if present</code>
  <code class="nv">$ver_num</code> <code class="o">=</code> <code class="nv">$major</code><code class="o">*</code><code class="mi">10000</code> <code class="o">+</code> <code class="nv">$minor</code><code class="o">*</code><code class="mi">100</code> <code class="o">+</code> <code class="nv">$patch</code><code class="p">;</code>
  <code class="k">return</code> <code class="p">(</code><code class="nv">$ver_str</code><code class="p">,</code> <code class="nv">$ver_num</code><code class="p">);</code>
<code class="p">}</code></pre><p>To get both forms of the version information at once, call the
      function like this:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="p">(</code><code class="nv">$ver_str</code><code class="p">,</code> <code class="nv">$ver_num</code><code class="p">)</code> <code class="o">=</code> <code class="n">get_server_version</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">);</code></pre><p>To get just one of the values, call it as follows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ver_str</code> <code class="o">=</code> <code class="p">(</code><code class="n">get_server_version</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">))[</code><code class="mi">0</code><code class="p">];</code> <code class="c1"># string form</code>
<code class="k">my</code> <code class="nv">$ver_num</code> <code class="o">=</code> <code class="p">(</code><code class="n">get_server_version</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">))[</code><code class="mi">1</code><code class="p">];</code> <code class="c1"># numeric form</code></pre><p>The following examples demonstrate how to use the numeric version
      value to check whether the server supports certain features:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ver_num</code> <code class="o">=</code> <code class="p">(</code><code class="n">get_server_version</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">))[</code><code class="mi">1</code><code class="p">];</code>
<code class="nb">printf</code> <code class="s">"Event scheduler:    %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50106</code> <code class="p">?</code> <code class="s">"yes"</code> <code class="p">:</code> <code class="s">"no"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"4-byte Unicode:     %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50503</code> <code class="p">?</code> <code class="s">"yes"</code> <code class="p">:</code> <code class="s">"no"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"Fractional seconds: %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50604</code> <code class="p">?</code> <code class="s">"yes"</code> <code class="p">:</code> <code class="s">"no"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"SHA-256 passwords:  %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50606</code> <code class="p">?</code> <code class="s">"yes"</code> <code class="p">:</code> <code class="s">"no"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"ALTER USER:         %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50607</code> <code class="p">?</code> <code class="s">"yes"</code> <code class="p">:</code> <code class="s">"no"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"INSERT DELAYED:     %s\n"</code><code class="p">,</code> <code class="p">(</code><code class="nv">$ver_num</code> <code class="o">&gt;=</code> <code class="mi">50700</code> <code class="p">?</code> <code class="s">"no"</code> <code class="p">:</code> <code class="s">"yes"</code><code class="p">);</code></pre><p>The <code>recipes</code> distribution
      <em class="filename">metadata</em> directory contains
      <code>get_server_version()</code> implementations
      in other API languages, and the <em class="filename">routines</em> directory contains a <code>server_version()</code> stored function for use in
      SQL statements. The latter function returns only the numeric value
      because <code>VERSION()</code> already produces
      the string value. The following example shows how to use it to implement
      a stored procedure that enables password locking for <em><code>N</code></em> failed login attempts if the server is
      recent enough to support the <code>ALTER USER ... FAILED_LOGIN_ATTEMPTS</code> statement (MySQL 8.0.19 or
      later):</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">PROCEDURE</code> <code class="n">enable_failed_login_attempts</code><code class="p">(</code>
                                  <code class="k">user</code> <code class="nb">TEXT</code><code class="p">,</code> <code class="k">host</code> <code class="nb">TEXT</code><code class="p">,</code> <code class="n">failed_atempts</code> <code class="nb">INT</code><code class="p">)</code>
<code class="k">BEGIN</code>
  <code class="k">DECLARE</code> <code class="n">account</code> <code class="nb">TEXT</code><code class="p">;</code>
  <code class="k">SET</code> <code class="n">account</code> <code class="o">=</code> <code class="n">CONCAT</code><code class="p">(</code><code class="n">QUOTE</code><code class="p">(</code><code class="k">user</code><code class="p">),</code><code class="s1">'@'</code><code class="p">,</code><code class="n">QUOTE</code><code class="p">(</code><code class="k">host</code><code class="p">));</code>
  <code class="n">IF</code> <code class="n">server_version</code><code class="p">()</code> <code class="o">&gt;=</code> <code class="mi">80019</code> <code class="k">AND</code> <code class="k">user</code> <code class="o">&lt;&gt;</code> <code class="s1">''</code> <code class="k">THEN</code>
    <code class="k">CALL</code> <code class="n">exec_stmt</code><code class="p">(</code><code class="n">CONCAT</code><code class="p">(</code><code class="s1">'ALTER USER '</code><code class="p">,</code><code class="n">account</code><code class="p">,</code><code class="s1">' </code>
<code class="s1">                   FAILED_LOGIN_ATTEMPTS '</code><code class="p">,</code> <code class="n">failed_atempts</code><code class="p">));</code>
  <code class="k">END</code> <code class="n">IF</code><code class="p">;</code>
<code class="k">END</code><code class="p">;</code></pre><p><code>expire_password()</code> requires the
      <code>exec_stmt()</code> helper routine (see <a data-type="xref" href="ch11.xhtml#nch-routines-dynamic-sql-helpers">Recipe 11.6</a>). Both are available in
      the <em class="filename">routines</em> directory. For more
      information about password expiration, see <a data-type="xref" href="ch24.xhtml#nch-security-password-expiration">Recipe 24.5</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.9 Getting Child Tables That Reference a Specific Table via Foreign Key Constraints"><div class="sect1" id="nch-meta-meta-fk"><h1>12.9 Getting Child Tables That Reference a Specific Table via Foreign Key Constraints</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820358053248"><h2>Problem</h2><p>
        You want to know which other tables refer to your table as parent via foreign key constraints. 
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820358052240"><h2>Solution</h2><p>
        Query the tables <code>INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code> and <code>INFORMATION_SCHEMA.KEY_COLUMN_USAGE</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820358050400"><h2>Discussion</h2><p>
        Foreign key constraints provide integrity checks as we discuss in <a data-type="xref" href="ch16.xhtml#nch-multi-multi-fks">“Using Foreign Keys to Enforce Referential Integrity and Prevent Mismatches”</a>. They do it by preventing statements that modify data, referenced by the linked table, to execute if the result of the statement can break integrity. Foreign keys help keeping the data correct, but at the same time they can raise SQL errors that is hard to troubleshoot. And while it is easy to figure out which table is a parent for the particular child, it is not easy to find which table is a child of the particular parent. Still it would be good to know if a table is referenced by a child in case if you plan to modify it.
      </p><p>
        Table <code>INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code> contains all the constraints, created for your MySQL installation. To select foreign key constraints, narrow your search with the clause <code>WHERE CONSTRAINT_TYPE='FOREIGN KEY'</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="p">,</code><code> </code><code class="k">TABLE_NAME</code><code class="p">,</code><code> </code><code class="k">CONSTRAINT_NAME</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLE_CONSTRAINTS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">CONSTRAINT_TYPE</code><code class="o">=</code><code class="s1">'FOREIGN KEY'</code><code> </code><code class="k">AND</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------+--------------------+---------------------------+
</code><code class="o">|</code><code> </code><code class="n">TABLE_SCHEMA</code><code> </code><code class="o">|</code><code> </code><code class="k">TABLE_NAME</code><code>         </code><code class="o">|</code><code> </code><code class="k">CONSTRAINT_NAME</code><code>           </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+--------------------+---------------------------+
</code><code class="o">|</code><code> </code><code class="n">cookbook</code><code>     </code><code class="o">|</code><code> </code><code class="n">movies_actors_link</code><code> </code><code class="o">|</code><code> </code><code class="n">movies_actors_link_ibfk_1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">cookbook</code><code>     </code><code class="o">|</code><code> </code><code class="n">movies_actors_link</code><code> </code><code class="o">|</code><code> </code><code class="n">movies_actors_link_ibfk_2</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------+--------------------+---------------------------+
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        The listing above prints foreign keys we created for the example in <a data-type="xref" href="ch11.xhtml#nch-routines-routines-diagnostic-area">Recipe 11.10</a>. However, this output still lists only the child table. To find out which table is parent we need to join <code>INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code> with table <code>INFORMATION_SCHEMA.KEY_COLUMN_USAGE</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code>  </code><code class="n">ku</code><code class="p">.</code><code class="k">CONSTRAINT_NAME</code><code class="p">,</code><code> </code><code class="n">ku</code><code class="p">.</code><code class="k">TABLE_NAME</code><code class="p">,</code><code> </code><code class="n">ku</code><code class="p">.</code><code class="k">COLUMN_NAME</code><code class="p">,</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">ku</code><code class="p">.</code><code class="n">REFERENCED_TABLE_NAME</code><code class="p">,</code><code> </code><code class="n">ku</code><code class="p">.</code><code class="n">REFERENCED_COLUMN_NAME</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLE_CONSTRAINTS</code><code> </code><code class="n">tc</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">JOIN</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">KEY_COLUMN_USAGE</code><code> </code><code class="n">ku</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">USING</code><code> </code><code class="p">(</code><code class="k">CONSTRAINT_NAME</code><code class="p">,</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="p">,</code><code> </code><code class="k">TABLE_NAME</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">CONSTRAINT_TYPE</code><code class="o">=</code><code class="s1">'FOREIGN KEY'</code><code> </code><code class="k">AND</code><code> </code><code class="n">ku</code><code class="p">.</code><code class="n">TABLE_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
       </code><code class="k">CONSTRAINT_NAME</code><code class="p">:</code><code> </code><code class="n">movies_actors_link_ibfk_1</code><code>
            </code><code class="k">TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">movies_actors_link</code><code>
           </code><code class="k">COLUMN_NAME</code><code class="p">:</code><code> </code><code class="n">movie_id</code><code>
 </code><code class="n">REFERENCED_TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">movies</code><code>
</code><code class="n">REFERENCED_COLUMN_NAME</code><code class="p">:</code><code> </code><code class="n">id</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
       </code><code class="k">CONSTRAINT_NAME</code><code class="p">:</code><code> </code><code class="n">movies_actors_link_ibfk_2</code><code>
            </code><code class="k">TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">movies_actors_link</code><code>
           </code><code class="k">COLUMN_NAME</code><code class="p">:</code><code> </code><code class="n">actor_id</code><code>
 </code><code class="n">REFERENCED_TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">actors</code><code>
</code><code class="n">REFERENCED_COLUMN_NAME</code><code class="p">:</code><code> </code><code class="n">id</code><code>
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        In the listing above columns <code>TABLE_NAME</code> and <code>COLUMN_NAME</code> refer the child table and columns <code>REFERENCED_TABLE_NAME</code> and <code>REFERENCED_COLUMN_NAME</code> refer the parent table.
      </p><p>
        For InnoDB tables you may also query tables <code>INNODB_FOREIGN</code> and <code>INNODB_FOREIGN_COLS</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">ID</code><code class="p">,</code><code> </code><code class="n">FOR_NAME</code><code class="p">,</code><code> </code><code class="n">FOR_COL_NAME</code><code class="p">,</code><code> </code><code class="n">REF_NAME</code><code class="p">,</code><code> </code><code class="n">REF_COL_NAME</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">INNODB_FOREIGN</code><code> </code><code class="k">JOIN</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">INNODB_FOREIGN_COLS</code><code> </code><code class="k">USING</code><code class="p">(</code><code class="n">ID</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">ID</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'cookbook%'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
          </code><code class="n">ID</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">movies_actors_link_ibfk_1</code><code>
    </code><code class="n">FOR_NAME</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">movies_actors_link</code><code>
</code><code class="n">FOR_COL_NAME</code><code class="p">:</code><code> </code><code class="n">movie_id</code><code>
    </code><code class="n">REF_NAME</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">movies</code><code>
</code><code class="n">REF_COL_NAME</code><code class="p">:</code><code> </code><code class="n">id</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
          </code><code class="n">ID</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">movies_actors_link_ibfk_2</code><code>
    </code><code class="n">FOR_NAME</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">movies_actors_link</code><code>
</code><code class="n">FOR_COL_NAME</code><code class="p">:</code><code> </code><code class="n">actor_id</code><code>
    </code><code class="n">REF_NAME</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code class="o">/</code><code class="n">actors</code><code>
</code><code class="n">REF_COL_NAME</code><code class="p">:</code><code> </code><code class="n">id</code><code>
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Note that these tables take data from the internal InnoDB data dictionary that stores database and table names in one field. Therefore you need to use the operator <code>LIKE</code> to limit results to the specific database or table.
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.10 Listing Triggers"><div class="sect1" id="nch-meta-meta-triggers"><h1>12.10 Listing Triggers</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820357803744"><h2>Problem</h2><p>
        You want to list triggers, defined for your table.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820357802800"><h2>Solution</h2><p>
        Query the table <code>INFORMATION_SCHEMA.TRIGGERS</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820357343872"><h2>Discussion</h2><p>
        Knowing which triggers are defined for the specific tables is very useful when you tune performance. Especially in situations when:
        </p><ul><li><p>Simple update, affecting a couple of rows, runs much longer than you expect.</p></li><li><p>Tables, not participating in the application load and not visible in the processlist, wait for or hold the locks.</p></li><li><p>Disk IO is high.</p></li></ul><p>
      </p><p>
        For example, to list triggers, created for the table <code>auction</code> use the following query:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">EVENT_MANIPULATION</code><code class="p">,</code><code> </code><code class="n">ACTION_TIMING</code><code class="p">,</code><code> </code><code class="k">TRIGGER_NAME</code><code class="p">,</code><code> </code><code class="n">ACTION_STATEMENT</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TRIGGERS</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="k">TRIGGER_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code> </code><code class="k">AND</code><code> </code><code class="n">EVENT_OBJECT_TABLE</code><code> </code><code class="o">=</code><code> </code><code class="s1">'auction'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">EVENT_MANIPULATION</code><code class="p">:</code><code> </code><code class="k">INSERT</code><code>
     </code><code class="n">ACTION_TIMING</code><code class="p">:</code><code> </code><code class="k">AFTER</code><code>
      </code><code class="k">TRIGGER_NAME</code><code class="p">:</code><code> </code><code class="n">ai_auction</code><code>
  </code><code class="n">ACTION_STATEMENT</code><code class="p">:</code><code> </code><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">auction_log</code><code> </code><code class="p">(</code><code class="n">action</code><code class="p">,</code><code class="n">id</code><code class="p">,</code><code class="n">ts</code><code class="p">,</code><code class="n">item</code><code class="p">,</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'create'</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">id</code><code class="p">,</code><code class="n">NOW</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">item</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">EVENT_MANIPULATION</code><code class="p">:</code><code> </code><code class="k">UPDATE</code><code>
     </code><code class="n">ACTION_TIMING</code><code class="p">:</code><code> </code><code class="k">AFTER</code><code>
      </code><code class="k">TRIGGER_NAME</code><code class="p">:</code><code> </code><code class="n">au_auction</code><code>
  </code><code class="n">ACTION_STATEMENT</code><code class="p">:</code><code> </code><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">auction_log</code><code> </code><code class="p">(</code><code class="n">action</code><code class="p">,</code><code class="n">id</code><code class="p">,</code><code class="n">ts</code><code class="p">,</code><code class="n">item</code><code class="p">,</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'update'</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">id</code><code class="p">,</code><code class="n">NOW</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">item</code><code class="p">,</code><code class="k">NEW</code><code class="p">.</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
</code><code class="n">EVENT_MANIPULATION</code><code class="p">:</code><code> </code><code class="k">DELETE</code><code>
     </code><code class="n">ACTION_TIMING</code><code class="p">:</code><code> </code><code class="k">AFTER</code><code>
      </code><code class="k">TRIGGER_NAME</code><code class="p">:</code><code> </code><code class="n">ad_auction</code><code>
  </code><code class="n">ACTION_STATEMENT</code><code class="p">:</code><code> </code><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">auction_log</code><code> </code><code class="p">(</code><code class="n">action</code><code class="p">,</code><code class="n">id</code><code class="p">,</code><code class="n">ts</code><code class="p">,</code><code class="n">item</code><code class="p">,</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'delete'</code><code class="p">,</code><code class="k">OLD</code><code class="p">.</code><code class="n">id</code><code class="p">,</code><code class="k">OLD</code><code class="p">.</code><code class="n">ts</code><code class="p">,</code><code class="k">OLD</code><code class="p">.</code><code class="n">item</code><code class="p">,</code><code class="k">OLD</code><code class="p">.</code><code class="n">bid</code><code class="p">)</code><code>
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        This way, you can have information such as when a trigger is fired, and its body definition. If there are more than one trigger you will see all of them.
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.11 Listing Stored Routines and Scheduled Events"><div class="sect1" id="nch-meta-meta-routines"><h1>12.11 Listing Stored Routines and Scheduled Events</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820356876944"><h2>Problem</h2><p>
        You want to know which stored procedures, functions and scheduled events are created in your database.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820356875936"><h2>Solution</h2><p>
        Query the tables <code>INFORMATION_SCHEMA.ROUTINES</code> and <code>INFORMATION_SCHEMA.EVENTS</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820356989904"><h2>Discussion</h2><p>
        To list both stored functions and stored procedures, query the table <code>INFORMATION_SCHEMA.ROUTINES</code>. If you want to distinguish which kind of routine it is, narrow your search by specifying <code>ROUTINE_TYPE</code> either <code>FUNCTION</code> or <code>PROCEDURE</code> by the <code>WHERE</code> condition.
      </p><p>
        For example, to list all routines that participate in sequence generation as we discuss in <a data-type="xref" href="ch15.xhtml#nch-sequences-seq-custom">Recipe 15.17</a> use following code: 
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">ROUTINE_NAME</code><code class="p">,</code><code> </code><code class="n">ROUTINE_TYPE</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">ROUTINES</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="k">ROUTINE_SCHEMA</code><code class="o">=</code><code class="s1">'cookbook'</code><code> </code><code class="k">AND</code><code> </code><code class="k">ROUTINE_NAME</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'%sequence%'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------+--------------+
</code><code class="o">|</code><code> </code><code class="k">ROUTINE_NAME</code><code>        </code><code class="o">|</code><code> </code><code class="n">ROUTINE_TYPE</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------+--------------+
</code><code class="o">|</code><code> </code><code class="n">sequence_next_value</code><code> </code><code class="o">|</code><code> </code><code class="k">FUNCTION</code><code>     </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">create_sequence</code><code>     </code><code class="o">|</code><code> </code><code class="k">PROCEDURE</code><code>    </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">delete_sequence</code><code>     </code><code class="o">|</code><code> </code><code class="k">PROCEDURE</code><code>    </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------+--------------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        You may additionally select the column <code>ROUTINE_DEFINITION</code> to obtain the routine body.
      </p><p>
        To get list of scheduled events, query the table <code>INFORMATION_SCHEMA.EVENTS</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">EVENT_NAME</code><code class="p">,</code><code> </code><code class="n">EVENT_TYPE</code><code class="p">,</code><code> </code><code class="n">INTERVAL_VALUE</code><code class="p">,</code><code> </code><code class="n">INTERVAL_FIELD</code><code class="p">,</code><code> </code><code class="n">LAST_EXECUTED</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">STATUS</code><code class="p">,</code><code> </code><code class="n">ON_COMPLETION</code><code class="p">,</code><code> </code><code class="n">EVENT_DEFINITION</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">EVENTS</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
      </code><code class="n">EVENT_NAME</code><code class="p">:</code><code> </code><code class="n">mark_insert</code><code>
      </code><code class="n">EVENT_TYPE</code><code class="p">:</code><code> </code><code class="n">RECURRING</code><code>
  </code><code class="n">INTERVAL_VALUE</code><code class="p">:</code><code> </code><code class="mi">5</code><code>
  </code><code class="n">INTERVAL_FIELD</code><code class="p">:</code><code> </code><code class="k">MINUTE</code><code>
   </code><code class="n">LAST_EXECUTED</code><code class="p">:</code><code> </code><code class="mi">2021</code><code class="o">-</code><code class="mi">07</code><code class="o">-</code><code class="mi">07</code><code> </code><code class="mi">05</code><code class="p">:</code><code class="mi">10</code><code class="p">:</code><code class="mi">45</code><code>
          </code><code class="n">STATUS</code><code class="p">:</code><code> </code><code class="n">ENABLED</code><code>
   </code><code class="n">ON_COMPLETION</code><code class="p">:</code><code> </code><code class="k">NOT</code><code> </code><code class="k">PRESERVE</code><code>
</code><code class="n">EVENT_DEFINITION</code><code class="p">:</code><code> </code><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">mark_log</code><code> </code><code class="p">(</code><code class="n">message</code><code class="p">)</code><code> </code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'-- MARK --'</code><code class="p">)</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
      </code><code class="n">EVENT_NAME</code><code class="p">:</code><code> </code><code class="n">mark_expire</code><code>
      </code><code class="n">EVENT_TYPE</code><code class="p">:</code><code> </code><code class="n">RECURRING</code><code>
  </code><code class="n">INTERVAL_VALUE</code><code class="p">:</code><code> </code><code class="mi">1</code><code>
  </code><code class="n">INTERVAL_FIELD</code><code class="p">:</code><code> </code><code class="k">DAY</code><code>
   </code><code class="n">LAST_EXECUTED</code><code class="p">:</code><code> </code><code class="mi">2021</code><code class="o">-</code><code class="mi">07</code><code class="o">-</code><code class="mi">07</code><code> </code><code class="mi">02</code><code class="p">:</code><code class="mi">56</code><code class="p">:</code><code class="mi">14</code><code>
          </code><code class="n">STATUS</code><code class="p">:</code><code> </code><code class="n">ENABLED</code><code>
   </code><code class="n">ON_COMPLETION</code><code class="p">:</code><code> </code><code class="k">NOT</code><code> </code><code class="k">PRESERVE</code><code>
</code><code class="n">EVENT_DEFINITION</code><code class="p">:</code><code> </code><code class="k">DELETE</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mark_log</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">ts</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">NOW</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">-</code><code> </code><code class="nb">INTERVAL</code><code> </code><code class="mi">2</code><code> </code><code class="k">DAY</code><code>
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        This table holds not only event definitions, but also such metadata as when it was executed last time, it’s scheduled interval and if it is enabled or disabled.
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.12 Listing installed plugins"><div class="sect1" id="nch-meta-meta-plugins"><h1>12.12 Listing installed plugins</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820356756608"><h2>Problem</h2><p>
        You want to know which plugins are installed for your MySQL server.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820356755728"><h2>Solution</h2><p>
        Query the table <code>INFORMATION_SCHEMA.PLUGINS</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820357242064"><h2>Discussion</h2><p>
        MySQL is highly modular system. Many of its parts are pluggable. For example, all storage engines are also plugins. Therefore it is important to know which are available on your server. To get information about installed plugins, query the table <code>INFORMATION_SCHEMA.PLUGINS</code>, or run the command <code>SHOW PLUGINS</code>. While the latter is convenient for the interactive use, the former provides more information.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">PLUGINS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">PLUGIN_NAME</code><code> </code><code class="k">IN</code><code> </code><code class="p">(</code><code class="s1">'caching_sha2_password'</code><code class="p">,</code><code> </code><code class="s1">'InnoDB'</code><code class="p">,</code><code> </code><code class="s1">'Rewriter'</code><code class="p">)</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
           </code><code class="n">PLUGIN_NAME</code><code class="p">:</code><code> </code><code class="n">caching_sha2_password</code><code>
        </code><code class="n">PLUGIN_VERSION</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">.</code><code class="mi">0</code><code>
         </code><code class="n">PLUGIN_STATUS</code><code class="p">:</code><code> </code><code class="n">ACTIVE</code><code>
           </code><code class="n">PLUGIN_TYPE</code><code class="p">:</code><code> </code><code class="n">AUTHENTICATION</code><code>
   </code><code class="n">PLUGIN_TYPE_VERSION</code><code class="p">:</code><code> </code><code class="mi">2</code><code class="p">.</code><code class="mi">0</code><code>
        </code><code class="n">PLUGIN_LIBRARY</code><code class="p">:</code><code> </code><code class="k">NULL</code><code>
</code><code class="n">PLUGIN_LIBRARY_VERSION</code><code class="p">:</code><code> </code><code class="k">NULL</code><code>
         </code><code class="n">PLUGIN_AUTHOR</code><code class="p">:</code><code> </code><code class="n">Oracle</code><code> </code><code class="n">Corporation</code><code>
    </code><code class="n">PLUGIN_DESCRIPTION</code><code class="p">:</code><code> </code><code class="n">Caching</code><code> </code><code class="n">sha2</code><code> </code><code class="n">authentication</code><code>
        </code><code class="n">PLUGIN_LICENSE</code><code class="p">:</code><code> </code><code class="n">GPL</code><code>
           </code><code class="n">LOAD_OPTION</code><code class="p">:</code><code> </code><code class="k">FORCE</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
           </code><code class="n">PLUGIN_NAME</code><code class="p">:</code><code> </code><code class="n">InnoDB</code><code>
        </code><code class="n">PLUGIN_VERSION</code><code class="p">:</code><code> </code><code class="mi">8</code><code class="p">.</code><code class="mi">0</code><code>
         </code><code class="n">PLUGIN_STATUS</code><code class="p">:</code><code> </code><code class="n">ACTIVE</code><code>
           </code><code class="n">PLUGIN_TYPE</code><code class="p">:</code><code> </code><code class="k">STORAGE</code><code> </code><code class="n">ENGINE</code><code>
   </code><code class="n">PLUGIN_TYPE_VERSION</code><code class="p">:</code><code> </code><code class="mi">80025</code><code class="p">.</code><code class="mi">0</code><code>
        </code><code class="n">PLUGIN_LIBRARY</code><code class="p">:</code><code> </code><code class="k">NULL</code><code>
</code><code class="n">PLUGIN_LIBRARY_VERSION</code><code class="p">:</code><code> </code><code class="k">NULL</code><code>
         </code><code class="n">PLUGIN_AUTHOR</code><code class="p">:</code><code> </code><code class="n">Oracle</code><code> </code><code class="n">Corporation</code><code>
    </code><code class="n">PLUGIN_DESCRIPTION</code><code class="p">:</code><code> </code><code class="n">Supports</code><code> </code><code class="n">transactions</code><code class="p">,</code><code> </code><code class="k">row</code><code class="o">-</code><code class="k">level</code><code> </code><code class="n">locking</code><code class="p">,</code><code> </code><code class="k">and</code><code> </code><code class="k">foreign</code><code> </code><code class="n">keys</code><code>
        </code><code class="n">PLUGIN_LICENSE</code><code class="p">:</code><code> </code><code class="n">GPL</code><code>
           </code><code class="n">LOAD_OPTION</code><code class="p">:</code><code> </code><code class="k">FORCE</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">3</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
           </code><code class="n">PLUGIN_NAME</code><code class="p">:</code><code> </code><code class="n">Rewriter</code><code>
        </code><code class="n">PLUGIN_VERSION</code><code class="p">:</code><code> </code><code class="mi">0</code><code class="p">.</code><code class="mi">2</code><code>
         </code><code class="n">PLUGIN_STATUS</code><code class="p">:</code><code> </code><code class="n">ACTIVE</code><code>
           </code><code class="n">PLUGIN_TYPE</code><code class="p">:</code><code> </code><code class="n">AUDIT</code><code>
   </code><code class="n">PLUGIN_TYPE_VERSION</code><code class="p">:</code><code> </code><code class="mi">4</code><code class="p">.</code><code class="mi">1</code><code>
        </code><code class="n">PLUGIN_LIBRARY</code><code class="p">:</code><code> </code><code class="n">rewriter</code><code class="p">.</code><code class="n">so</code><code>
</code><code class="n">PLUGIN_LIBRARY_VERSION</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">.</code><code class="mi">10</code><code>
         </code><code class="n">PLUGIN_AUTHOR</code><code class="p">:</code><code> </code><code class="n">Oracle</code><code> </code><code class="n">Corporation</code><code>
    </code><code class="n">PLUGIN_DESCRIPTION</code><code class="p">:</code><code> </code><code class="n">A</code><code> </code><code class="n">query</code><code> </code><code class="n">rewrite</code><code> </code><code class="n">plugin</code><code> </code><code class="n">that</code><code> </code><code class="n">rewrites</code><code> </code><code class="n">queries</code><code> </code><code class="k">using</code><code> </code><code class="n">the</code><code> </code><code class="n">parse</code><code> </code><code class="n">tree</code><code class="p">.</code><code>
        </code><code class="n">PLUGIN_LICENSE</code><code class="p">:</code><code> </code><code class="n">GPL</code><code>
           </code><code class="n">LOAD_OPTION</code><code class="p">:</code><code> </code><code class="k">ON</code><code>
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        For storage engines you can obtain even more details if query the table <code>INFORMATION_SCHEMA.ENGINES</code>, or run the command <code>SHOW ENGINES</code>. Here is the table content for the InnoDB storage engine:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">ENGINES</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">ENGINE</code><code> </code><code class="o">=</code><code> </code><code class="s1">'InnoDB'</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
      </code><code class="n">ENGINE</code><code class="p">:</code><code> </code><code class="n">InnoDB</code><code>
     </code><code class="n">SUPPORT</code><code class="p">:</code><code> </code><code class="k">DEFAULT</code><code>
     </code><code class="k">COMMENT</code><code class="p">:</code><code> </code><code class="n">Supports</code><code> </code><code class="n">transactions</code><code class="p">,</code><code> </code><code class="k">row</code><code class="o">-</code><code class="k">level</code><code> </code><code class="n">locking</code><code class="p">,</code><code> </code><code class="k">and</code><code> </code><code class="k">foreign</code><code> </code><code class="n">keys</code><code>
</code><code class="n">TRANSACTIONS</code><code class="p">:</code><code> </code><code class="n">YES</code><code>
          </code><code class="n">XA</code><code class="p">:</code><code> </code><code class="n">YES</code><code>
  </code><code class="n">SAVEPOINTS</code><code class="p">:</code><code> </code><code class="n">YES</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.13 Listing Character Sets and Collations"><div class="sect1" id="nch-meta-meta-charsets"><h1>12.13 Listing Character Sets and Collations</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820356840208"><h2>Problem</h2><p>
        Sort order, defining which letters are equal, does not work for you and you want to study which other options you have.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820356839328"><h2>Solution</h2><p>
        Obtain a list of characters sets, their default collation and available collations by querying tables <code>INFORMATION_SCHEMA.CHARACTER_SETS</code> and <code>INFORMATION_SCHEMA.COLLATIONS</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820355760432"><h2>Discussion</h2><p>
        In <a data-type="xref" href="ch07.xhtml#nch-strings-strings-charset-checking-changing">Recipe 7.5</a> we discuss how to change or set string’s character set and collation. But how do you choose the one that suits your application requirements best?
      </p><p>
        Fortunately, MySQL itself can help you to find the answer. Inside MySQL client, select from the <code>INFORMATION_SCHEMA.CHARACTER_SETS</code> table to get list of all available character sets, their default collations and maximum character lenght they can store. For example, to list all Unicode character sets, run the following query:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">CHARACTER_SETS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">DESCRIPTION</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'%Unicode%'</code><code> </code><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="n">MAXLEN</code><code> </code><code class="k">DESC</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+------------------+--------+
</code><code class="o">|</code><code> </code><code class="k">CHARACTER_SET_NAME</code><code> </code><code class="o">|</code><code> </code><code class="n">DEFAULT_COLLATE_NAME</code><code> </code><code class="o">|</code><code> </code><code class="n">DESCRIPTION</code><code>      </code><code class="o">|</code><code> </code><code class="n">MAXLEN</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+------------------+--------+
</code><code class="o">|</code><code> </code><code class="n">utf16</code><code>              </code><code class="o">|</code><code> </code><code class="n">utf16_general_ci</code><code>     </code><code class="o">|</code><code> </code><code class="n">UTF</code><code class="o">-</code><code class="mi">16</code><code> </code><code class="n">Unicode</code><code>   </code><code class="o">|</code><code>      </code><code class="mi">4</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">utf16le</code><code>            </code><code class="o">|</code><code> </code><code class="n">utf16le_general_ci</code><code>   </code><code class="o">|</code><code> </code><code class="n">UTF</code><code class="o">-</code><code class="mi">16</code><code class="n">LE</code><code> </code><code class="n">Unicode</code><code> </code><code class="o">|</code><code>      </code><code class="mi">4</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">utf32</code><code>              </code><code class="o">|</code><code> </code><code class="n">utf32_general_ci</code><code>     </code><code class="o">|</code><code> </code><code class="n">UTF</code><code class="o">-</code><code class="mi">32</code><code> </code><code class="n">Unicode</code><code>   </code><code class="o">|</code><code>      </code><code class="mi">4</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">utf8mb4</code><code>            </code><code class="o">|</code><code> </code><code class="n">utf8mb4_0900_ai_ci</code><code>   </code><code class="o">|</code><code> </code><code class="n">UTF</code><code class="o">-</code><code class="mi">8</code><code> </code><code class="n">Unicode</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">4</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">utf8</code><code>               </code><code class="o">|</code><code> </code><code class="n">utf8_general_ci</code><code>      </code><code class="o">|</code><code> </code><code class="n">UTF</code><code class="o">-</code><code class="mi">8</code><code> </code><code class="n">Unicode</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">3</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">ucs2</code><code>               </code><code class="o">|</code><code> </code><code class="n">ucs2_general_ci</code><code>      </code><code class="o">|</code><code> </code><code class="n">UCS</code><code class="o">-</code><code class="mi">2</code><code> </code><code class="n">Unicode</code><code>    </code><code class="o">|</code><code>      </code><code class="mi">2</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+------------------+--------+
</code><code class="mi">6</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Each character set may have not only default collation, but other collations that allow you to adjust sort order. For example, Turkish capital letters <q>I</q> and <q>İ</q>, as well as <q>S</q> and <q>Ş</q> are considered equal by the <code>utf8mb4</code> character set with the default collation. This leads to a situation when MySQL thinks that Turksih words <q>ISSIZ</q> (deserted) and <q>İŞSİZ</q> (unemployed) are the same:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="n">two_words</code><code class="p">(</code><code class="n">deserted</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">unemployed</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">03</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">two_words</code><code> </code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'ISSIZ'</code><code class="p">,</code><code> </code><code class="s1">'İŞSİZ'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------+
</code><code class="o">|</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------+
</code><code class="o">|</code><code>                   </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        To resolve this situation let’s check the table <code>INFORMATION_SCHEMA.COLLATIONS</code> for the collations of the character set <code>utf8mb4</code>, applicable for the Turkish language.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">COLLATION_NAME</code><code class="p">,</code><code> </code><code class="k">CHARACTER_SET_NAME</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">COLLATIONS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="k">CHARACTER_SET_NAME</code><code class="o">=</code><code class="s1">'utf8mb4'</code><code> </code><code class="k">AND</code><code> </code><code class="k">COLLATION_NAME</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'%\_tr\_%'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">-----------------------+--------------------+
</code><code class="o">|</code><code> </code><code class="k">COLLATION_NAME</code><code>        </code><code class="o">|</code><code> </code><code class="k">CHARACTER_SET_NAME</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------------+--------------------+
</code><code class="o">|</code><code> </code><code class="n">utf8mb4_tr_0900_ai_ci</code><code> </code><code class="o">|</code><code> </code><code class="n">utf8mb4</code><code>            </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">utf8mb4_tr_0900_as_cs</code><code> </code><code class="o">|</code><code> </code><code class="n">utf8mb4</code><code>            </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">-----------------------+--------------------+
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        If we try them we will recieve the correct result: the words <q>deserted</q> and <q>unemployed</q> are no longer considered equal:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_tr_0900_ai_ci</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_tr_0900_ai_ci</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="o">|</code><code>                                                 </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_tr_0900_as_cs</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">deserted</code><code class="o">=</code><code class="n">unemployed</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_tr_0900_as_cs</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="o">|</code><code>                                                 </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">---------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Character set <code>utf8mb4</code> is default and works well for most of setups. However, you may be in a situation when this is not the case. For example, if you store the Russian words <q>совершенный</q> (perfect) and <q>совершённый</q> (accomplished) in a <code>utf8mb4</code> column with default collation, MySQL will consider these two words equal:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code> </code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="o">`</code><code class="n">two_words</code><code class="o">`</code><code> </code><code class="p">(</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="o">`</code><code class="n">perfect</code><code class="o">`</code><code> </code><code class="nb">varchar</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="o">`</code><code class="n">accomplished</code><code class="o">`</code><code> </code><code class="nb">varchar</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">)</code><code> </code><code class="n">ENGINE</code><code class="o">=</code><code class="n">InnoDB</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="n">CHARSET</code><code class="o">=</code><code class="n">utf8mb4</code><code> </code><code class="k">COLLATE</code><code class="o">=</code><code class="n">utf8mb4_0900_ai_ci</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">04</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">two_words</code><code> </code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'совершенный'</code><code class="p">,</code><code> </code><code class="s1">'совершённый'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="o">|</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="o">|</code><code>                      </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        An intuitive way to solve this issue is to use available collations for the Russian language: <code>utf8mb4_ru_0900_ai_ci</code>. Unfortunately, this does not work:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_ru_0900_ai_ci</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_ru_0900_ai_ci</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="o">|</code><code>                                                    </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        The reason for this is that the collation <code>utf8mb4_ru_0900_ai_ci</code> is accent insensitive. Its case sensitive and accent sensitive variation <code>utf8mb4_ru_0900_as_cs</code> solves the issue:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_ru_0900_as_cs</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">COLLATE</code><code> </code><code class="n">utf8mb4_ru_0900_as_cs</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="o">|</code><code>                                                    </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        Collations <code>utf8mb4_ru_0900_ai_ci</code> and <code>utf8mb4_ru_0900_as_cs</code> were added in version 8.0. If you are still using version 5.7 and are working on the application where such difference is critical you may also examine the table <code>INFORMATION_SCHEMA.CHARACTER_SETS</code> for a character set that supports Cyrillic alphabet and try it:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">CHARACTER_SETS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">DESCRIPTION</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'%Russian%'</code><code> </code><code class="k">OR</code><code> </code><code class="n">DESCRIPTION</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'%Cyrillic%'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+-----------------------+--------+
</code><code class="o">|</code><code> </code><code class="k">CHARACTER_SET_NAME</code><code> </code><code class="o">|</code><code> </code><code class="n">DEFAULT_COLLATE_NAME</code><code> </code><code class="o">|</code><code> </code><code class="n">DESCRIPTION</code><code>           </code><code class="o">|</code><code> </code><code class="n">MAXLEN</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+-----------------------+--------+
</code><code class="o">|</code><code> </code><code class="n">koi8r</code><code>              </code><code class="o">|</code><code> </code><code class="n">koi8r_general_ci</code><code>     </code><code class="o">|</code><code> </code><code class="n">KOI8</code><code class="o">-</code><code class="n">R</code><code> </code><code class="n">Relcom</code><code> </code><code class="n">Russian</code><code> </code><code class="o">|</code><code>      </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">cp866</code><code>              </code><code class="o">|</code><code> </code><code class="n">cp866_general_ci</code><code>     </code><code class="o">|</code><code> </code><code class="n">DOS</code><code> </code><code class="n">Russian</code><code>           </code><code class="o">|</code><code>      </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">cp1251</code><code>             </code><code class="o">|</code><code> </code><code class="n">cp1251_general_ci</code><code>    </code><code class="o">|</code><code> </code><code class="n">Windows</code><code> </code><code class="n">Cyrillic</code><code>      </code><code class="o">|</code><code>      </code><code class="mi">1</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">--------------------+----------------------+-----------------------+--------+
</code><code class="mi">3</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">drop</code><code> </code><code class="k">table</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">02</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="n">two_words</code><code class="p">(</code><code class="n">perfect</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code class="p">,</code><code> </code><code class="n">accomplished</code><code> </code><code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="nb">CHARACTER</code><code> </code><code class="k">SET</code><code> </code><code class="n">cp1251</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">04</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">INSERT</code><code> </code><code class="k">INTO</code><code> </code><code class="n">two_words</code><code> </code><code class="k">VALUES</code><code class="p">(</code><code class="s1">'совершенный'</code><code class="p">,</code><code> </code><code class="s1">'совершённый'</code><code class="p">)</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code><code>

</code><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="k">FROM</code><code> </code><code class="n">two_words</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="o">|</code><code> </code><code class="n">perfect</code><code> </code><code class="o">=</code><code> </code><code class="n">accomplished</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="o">|</code><code>                      </code><code class="mi">0</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
        We have chosen character set <code>cp1251</code> for our example, but all of them resolve this comparison issue.
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="12.14 Listing CHECK Constraints"><div class="sect1" id="nch-meta-meta-check"><h1>12.14 Listing CHECK Constraints</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820354987696"><h2>Problem</h2><p>
        You want to examine which <code>CHECK</code> constraints are defined for your database.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820354935344"><h2>Solution</h2><p>
        Query the tables <code>INFORMATION_SCHEMA.CHECK_CONSTRAINTS</code> and <code>INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code>.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820354933568"><h2>Discussion</h2><p>
        The table <code>INFORMATION_SCHEMA.CHECK_CONSTRAINTS</code> contains list of all constraints, the schema for which they are definded, and the <code>CHECK_CLAUSE</code> that is practically the constraint definition. However, the table does not store information about for which table the constraint is created. To list both constraints and tables for which they are defined join table <code>INFORMATION_SCHEMA.CHECK_CONSTRAINTS</code> with table <code>INFORMATION_SCHEMA.TABLE_CONSTRAINTS</code>:
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">TABLE_SCHEMA</code><code class="p">,</code><code> </code><code class="k">TABLE_NAME</code><code class="p">,</code><code> </code><code class="k">CONSTRAINT_NAME</code><code class="p">,</code><code> </code><code class="n">ENFORCED</code><code class="p">,</code><code> </code><code class="n">CHECK_CLAUSE</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">CHECK_CONSTRAINTS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">JOIN</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TABLE_CONSTRAINTS</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">USING</code><code class="p">(</code><code class="k">CONSTRAINT_NAME</code><code class="p">)</code><code> </code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">CONSTRAINT_TYPE</code><code class="o">=</code><code class="s1">'CHECK'</code><code> </code><code class="k">ORDER</code><code> </code><code class="k">BY</code><code> </code><code class="k">CONSTRAINT_NAME</code><code> </code><code class="k">DESC</code><code> </code><code class="k">LIMIT</code><code> </code><code class="mi">2</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
   </code><code class="n">TABLE_SCHEMA</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code>
     </code><code class="k">TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">even</code><code>
</code><code class="k">CONSTRAINT_NAME</code><code class="p">:</code><code> </code><code class="n">even_chk_1</code><code>
       </code><code class="n">ENFORCED</code><code class="p">:</code><code> </code><code class="n">YES</code><code>
   </code><code class="n">CHECK_CLAUSE</code><code class="p">:</code><code> </code><code class="p">(</code><code class="p">(</code><code class="o">`</code><code class="n">even_value</code><code class="o">`</code><code> </code><code class="o">%</code><code> </code><code class="mi">2</code><code class="p">)</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="p">)</code><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">2</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
   </code><code class="n">TABLE_SCHEMA</code><code class="p">:</code><code> </code><code class="n">cookbook</code><code>
     </code><code class="k">TABLE_NAME</code><code class="p">:</code><code> </code><code class="n">book_authors</code><code>
</code><code class="k">CONSTRAINT_NAME</code><code class="p">:</code><code> </code><code class="n">book_authors_chk_1</code><code>
       </code><code class="n">ENFORCED</code><code class="p">:</code><code> </code><code class="n">YES</code><code>
   </code><code class="n">CHECK_CLAUSE</code><code class="p">:</code><code> </code><code class="n">json_schema_valid</code><code class="p">(</code><code class="n">_utf8mb4</code><code class="err">\</code><code class="s1">'{"id": ↩ 
                "http://www.oreilly.com/mysqlcookbook", "$schema": ↩
                "http://json-schema.org/draft-04/schema#", "description": ↩
                "Schema for the table book_authors", "type": "object", "properties": ↩
                {"name": {"type": "string"}, "lastname": {"type": "string"}, ↩
                "books": {"type": "array"}}, "required":["name", "lastname"]} \'</code><code class="p">,</code><code class="o">`</code><code class="n">author</code><code class="o">`</code><code class="p">)</code><code>
</code><code class="mi">2</code><code> </code><code class="k">rows</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">01</code><code> </code><code class="n">sec</code><code class="p">)</code></pre></div></section></div></section></div></section></div></body></html>