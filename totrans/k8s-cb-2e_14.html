<html><head></head><body><section data-pdf-bookmark="Chapter 14. Serverless and Event-Driven Applications" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_serverless">&#13;
<h1><span class="label">Chapter 14. </span>Serverless and Event-Driven Applications</h1>&#13;
&#13;
&#13;
<p>Serverless represents a cloud native paradigm for development, empowering developers to create and deploy applications without the burden of server management.<a data-primary="serverless" data-type="indexterm" id="ix_srvls"/> While servers are still part of the equation, the platform abstracts them away from the intricacies of application development.<a data-primary="servers" data-seealso="serverless" data-type="indexterm" id="id1277"/></p>&#13;
&#13;
<p>In this chapter, you will find recipes that show you how to deploy serverless workloads on Kubernetes using the <a href="https://knative.dev">Knative</a> stack.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.1 Installing the Knative Operator" data-type="sect1"><div class="sect1" id="kn_operator_install">&#13;
<h1>14.1 Installing the Knative Operator</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id1278">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to deploy the Knative platform to your cluster.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id270">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Using the <a href="https://oreil.ly/y_7fy">Knative Operator</a>, you can easily deploy the Knative stack components to your cluster.<a data-primary="Knative platform" data-secondary="installing Knative Operator" data-type="indexterm" id="id1279"/><a data-primary="serverless" data-secondary="installing Knative Operator" data-type="indexterm" id="id1280"/> The operator defines custom resources (CRs), enabling you to easily configure, install, upgrade, and manage the lifecycle of the Knative stack.<a data-primary="resources" data-secondary="custom, defined by Knative Operator" data-type="indexterm" id="id1281"/></p>&#13;
&#13;
<p>To install version 1.11.4 of the Knative Operator from the <a href="https://oreil.ly/6CRLJ">release page</a>, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/knative/operator/releases/download/&#13;
knative-v1.11.4/operator.yaml</strong>&#13;
</pre>&#13;
&#13;
<p class="pagebreak-before">Verify that the operator is running:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get deployment knative-operator</strong>&#13;
NAME               READY   UP-TO-DATE   AVAILABLE   AGE&#13;
knative-operator   1/1     1            1           13s&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1282">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Knative is an open source project that develops components for deploying, running, and managing serverless, cloud native applications on Kubernetes. The platform consists of two main components, namely <a href="https://oreil.ly/dpMyf">Serving</a> and <a href="https://oreil.ly/kYtPu">Eventing</a>.</p>&#13;
&#13;
<p>While the Knative Operator is the preferred method for deploying and configuring the Knative components, alternatively these components can be deployed using YAML files made available on their respective release pages.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.2 Installing the Knative Serving Component" data-type="sect1"><div class="sect1" id="kn_serving_install">&#13;
<h1>14.2 Installing the Knative Serving Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id271">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the Knative Operator (see <a data-type="xref" href="#kn_operator_install">Recipe 14.1</a>), and now you want to deploy the <a href="https://oreil.ly/dpMyf">Knative Serving</a> component to run serverless applications.<a data-primary="serverless" data-secondary="installing Knative Serving  component" data-type="indexterm" id="ix_srvlKnatSrv"/><a data-primary="Knative platform" data-secondary="installing Knative Serving component" data-type="indexterm" id="ix_KnatSrv"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id132">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <a href="https://oreil.ly/v-LsX"><code>KnativeServing</code></a> custom resource provided by the Knative Operator to install the Serving component of Knative.</p>&#13;
&#13;
<p>Knative Serving should be installed in a namespace named <code>knative-serving</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl create ns knative-serving</strong>&#13;
namespace/knative-serving created&#13;
</pre>&#13;
&#13;
<p>You must create a <code>KnativeServing</code> CR, add a networking layer, and configure the DNS.<a data-primary="KnativeServing custom resource" data-type="indexterm" id="id1283"/><a data-primary="networking layer for Knative Serving" data-type="indexterm" id="id1284"/> For the networking layer, we will use <a href="https://oreil.ly/5DRRi">Kourier</a>, which is a lightweight <code>Ingress</code> object for Knative Serving. <a data-primary="kourier" data-type="indexterm" id="id1285"/><a data-primary="DNS" data-secondary="sslip.io DNS service" data-type="indexterm" id="id1286"/><a data-primary="sslip.io DNS service" data-type="indexterm" id="id1287"/>For the DNS, we will use the <a href="https://sslip.io">sslip.io</a> DNS service.</p>&#13;
&#13;
<p>Create a file named <em>serving.yaml</em> with the following contents:</p>&#13;
<pre data-type="programlisting">&#13;
apiVersion: operator.knative.dev/v1beta1&#13;
kind: KnativeServing&#13;
metadata:&#13;
  name: knative-serving&#13;
  namespace: knative-serving&#13;
spec:&#13;
  ingress:&#13;
    kourier:&#13;
      enabled: true&#13;
  config:&#13;
    network:&#13;
      ingress-class: "kourier.ingress.networking.knative.dev"&#13;
</pre>&#13;
&#13;
<p>Now use <code>kubectl</code> to apply this configuration:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f serving.yaml</strong>&#13;
knativeserving.operator.knative.dev/knative-serving created&#13;
</pre>&#13;
&#13;
<p>It will take a few minutes for the <code>Knative Serving</code> component to be successfully deployed. You can watch its deployment status using this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl -n knative-serving get KnativeServing knative-serving -w</strong>&#13;
NAME              VERSION   READY   REASON&#13;
knative-serving   1.11.0    False   NotReady&#13;
knative-serving   1.11.0    False   NotReady&#13;
knative-serving   1.11.0    True&#13;
</pre>&#13;
&#13;
<p>Alternatively, you can<a data-primary="YAML" data-secondary="using YAML files to install Knative Serving" data-type="indexterm" id="id1288"/> install Knative Serving using YAML files:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/knative/serving/releases/download/&#13;
knative-v1.11.0/serving-crds.yaml</strong>&#13;
$ <strong>kubectl apply -f https://github.com/knative/serving/releases/download/&#13;
knative-v1.11.0/serving-core.yaml</strong>&#13;
</pre>&#13;
&#13;
<p>Check if the <code>kourier</code> service has been assigned an <a data-primary="kourier" data-secondary="checking if service is assigned external IP address or CNAME" data-type="indexterm" id="id1289"/><a data-primary="IP addresses" data-secondary="external IP address for kourier service" data-type="indexterm" id="id1290"/>external IP address or CNAME:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl -n knative-serving get service kourier</strong>&#13;
NAME      TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)         AGE&#13;
kourier   LoadBalancer   10.99.62.226   10.99.62.226   80:30227/T...   118s&#13;
</pre>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>On a Minikube cluster, run the command <code>minikube tunnel</code> in a terminal so that the <code>kourier</code> service is assigned an external IP address.<a data-primary="Minikube" data-secondary="using minikube tunnel so kourier service is assigned external IP address" data-type="indexterm" id="id1291"/></p>&#13;
</div>&#13;
&#13;
<p>Finally, configure <a data-primary="DNS" data-secondary="configuring Knative Serving to use sslip.io as prefix" data-type="indexterm" id="id1292"/><a data-primary="sslip.io DNS service" data-type="indexterm" id="id1293"/>Knative Serving to use sslip.io as the DNS suffix:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/knative/serving/releases/download/&#13;
knative-v1.11.0/serving-default-domain.yaml</strong>&#13;
job.batch/default-domain created&#13;
service/default-domain-service created&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1294">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The Knative Serving component enables the Serving API. It provides a high-level abstraction for deploying, managing, and autoscaling serverless workloads, primarily focusing on stateless, request-driven applications. It aims to simplify the process of deploying and managing containerized applications in a serverless manner, allowing developers to focus on writing code without the need to manage infrastructure concerns.</p>&#13;
&#13;
<p>sslip.io is a DNS service that allows you to easily access your applications deployed on Knative using domain names, without having to manage DNS records. The service URLs will have the sslip.io suffix and when queried with a hostname with an embedded IP address, the service will rturn that IP address.</p>&#13;
&#13;
<p>In production environments, it is highly recommended that you configure a <a href="https://oreil.ly/Shtsq">real DNS</a> for workloads deployed on Knative.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id272">&#13;
<h2>See Also</h2>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://knative.dev/docs/install">Installing Knative</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/Shtsq">Configuring DNS</a><a data-primary="serverless" data-secondary="installing Knative Serving  component" data-startref="ix_srvlKnatSrv" data-type="indexterm" id="id1295"/><a data-primary="Knative platform" data-secondary="installing Knative Server component" data-startref="ix_KnatSrv" data-type="indexterm" id="id1296"/></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.3 Installing the Knative CLI" data-type="sect1"><div class="sect1" id="kn_cli_install">&#13;
<h1>14.3 Installing the Knative CLI</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id1297">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the Knative Operator (<a data-type="xref" href="#kn_operator_install">Recipe 14.1</a>), and now you want an easy way for managing Knative resources instead of dealing with YAML files.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id273">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <a href="https://knative.dev/docs/client/install-kn"><code>kn</code></a>, the Knative CLI.<a data-primary="serverless" data-secondary="installing the Knative CLI" data-type="indexterm" id="id1298"/><a data-primary="Knative platform" data-secondary="installing Knative CLI" data-type="indexterm" id="id1299"/><a data-primary="CLI (command-line interface)" data-secondary="installing kn (Knative) CLI" data-type="indexterm" id="id1300"/><a data-primary="kn (Knative) CLI" data-secondary="installing" data-type="indexterm" id="id1301"/></p>&#13;
&#13;
<p>Install the <code>kn</code> binary from the GitHub <a href="https://oreil.ly/wZXg6">release page</a> and move it into your <code>$PATH</code>. For example, to install <code>kn</code> v1.8.2 on macOS (Intel), do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>wget https://github.com/knative/client/releases/download/knative-v1.11.0/&#13;
kn-darwin-amd64</strong>&#13;
&#13;
$ <strong>sudo install -m 755 kn-darwin-amd64 /usr/local/bin/kn</strong>&#13;
</pre>&#13;
&#13;
<p>Alternatively, Linux and macOS users can install the Knative CLI using the <a href="https://brew.sh">Homebrew</a> package manager:<a data-primary="macOS" data-secondary="installing kn (Knative) CLI" data-type="indexterm" id="id1302"/><a data-primary="Linux" data-secondary="installing kn (Knative) CLI" data-type="indexterm" id="id1303"/></p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>brew install knative/client/kn</strong>&#13;
</pre>&#13;
&#13;
<p>Installation of <code>kn</code> is extensively documented at the <a href="https://oreil.ly/Ks0Oh">project page</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id274">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><code>kn</code> provides a quick and easy way of creating Knative resources such as services and event sources, without having to deal with YAML files directly. The <code>kn</code> tool provides a number of commands to manage Knative resources.</p>&#13;
&#13;
<p>For an overview of the <a data-primary="kn (Knative) CLI" data-secondary="overview of available commands" data-type="indexterm" id="id1304"/>available commands, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kn help</strong>&#13;
kn is the command line interface for managing Knative Serving and Eventing&#13;
&#13;
Find more information about Knative at: https://knative.dev&#13;
&#13;
Serving Commands:&#13;
  service      Manage Knative services&#13;
  revision     Manage service revisions&#13;
  ...&#13;
&#13;
Eventing Commands:&#13;
  source       Manage event sources&#13;
  broker       Manage message brokers&#13;
  ...&#13;
&#13;
Other Commands:&#13;
  plugin       Manage kn plugins&#13;
  completion   Output shell completion code&#13;
  version      Show the version of this client&#13;
</pre>&#13;
&#13;
<p>You will find example usage scenarios of <code>kn</code> in the remainder of this chapter.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.4 Creating a Knative Service" data-type="sect1"><div class="sect1" id="kn_serving_example">&#13;
<h1>14.4 Creating a Knative Service</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id275">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed Knative Serving (see <a data-type="xref" href="#kn_serving_install">Recipe 14.2</a>) and now want to deploy an application on Kubernetes that will release the cluster resources when not in use.<a data-primary="serverless" data-secondary="creating a Knative Service" data-type="indexterm" id="ix_srvlKnatSer"/><a data-primary="Knative platform" data-secondary="creating a Knative Service" data-type="indexterm" id="ix_KnatSrvc"/><a data-primary="services" data-secondary="creating a Knative Service" data-type="indexterm" id="ix_serKnat"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id1305">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Knative Serving API to create a Knative <code>Service</code> that automatically scales down to zero when not in use.</p>&#13;
&#13;
<p>As an example, let’s deploy the application <code>functions/nodeinfo</code>, which provides information about the Kubernetes node it’s running on. Create a file named <em>nodeinfo.yaml</em> to deploy the application as a Knative <code>Service</code>:</p>&#13;
<pre data-type="programlisting">&#13;
apiVersion: serving.knative.dev/v1&#13;
kind: Service&#13;
metadata:&#13;
  name: nodeinfo&#13;
spec:&#13;
  template:&#13;
    spec:&#13;
      containers:&#13;
        - image: functions/nodeinfo:latest&#13;
</pre>&#13;
&#13;
<p>It’s important to note that this type of service is not the same as the <code>Service</code> object described in <a data-type="xref" href="ch05.html#svc-concept">Figure 5-1</a>; rather, this <code>Service</code> object is instantiated from the <a href="https://oreil.ly/G3_jU">Knative Serving API</a>.</p>&#13;
&#13;
<p>Deploy the application with this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f nodeinfo.yaml</strong>&#13;
service.serving.knative.dev/nodeinfo created&#13;
</pre>&#13;
&#13;
<p>Check the status of the service with this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get ksvc nodeinfo</strong>&#13;
NAME       URL                          LATESTCREATED    LATESTREADY      READY&#13;
nodeinfo   http://nodeinfo...sslip.io   nodeinfo-00001   nodeinfo-00001   True&#13;
</pre>&#13;
&#13;
<p>After the service has started successfully, open the URL in your browser to see the node information.</p>&#13;
&#13;
<p>Now, take a look at the pods that were created for the service:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get po -l serving.knative.dev/service=nodeinfo -w</strong>&#13;
NAME                       READY   STATUS    RESTARTS   AGE&#13;
nodeinfo-00001-deploy...   0/2     Pending   0          0s&#13;
nodeinfo-00001-deploy...   0/2     Pending   0          0s&#13;
nodeinfo-00001-deploy...   0/2     ContainerCreating   0          0s&#13;
nodeinfo-00001-deploy...   1/2     Running             0          2s&#13;
nodeinfo-00001-deploy...   2/2     Running             0          2s&#13;
</pre>&#13;
&#13;
<p>Close the browser window, and after about two minutes you should notice that the <code>nodeinfo</code> pods are automatically scaled down to zero:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get po -l serving.knative.dev/service=nodeinfo</strong>&#13;
No resources found in default namespace.&#13;
</pre>&#13;
&#13;
<p>Now, if you open the URL in the browser, a new <code>Pod</code> object will automatically be started to handle the incoming request. You should notice a delay in rendering the page since a new <code>Pod</code> is created to handle this request.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id276">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Using the <code>kn</code> client (see <a data-type="xref" href="#kn_cli_install">Recipe 14.3</a>), you can create the service without having to write YAML files:<a data-primary="kn (Knative) CLI" data-secondary="creating a service" data-type="indexterm" id="id1306"/></p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kn service create nodeinfo --image functions/nodeinfo:latest --port 8080</strong>&#13;
Creating service 'nodeinfo' in namespace 'default':&#13;
&#13;
  0.054s The Route is still working to reflect the latest desired specification.&#13;
  0.068s Configuration "nodeinfo" is waiting for a Revision to become ready.&#13;
  3.345s ...&#13;
  3.399s Ingress has not yet been reconciled.&#13;
  3.481s Waiting for load balancer to be ready&#13;
  3.668s Ready to serve.&#13;
&#13;
Service 'nodeinfo' created to latest revision 'nodeinfo-00001' is available at&#13;
URL: http://nodeinfo.default.10.96.170.166.sslip.io&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.5 Installing the Knative Eventing Component" data-type="sect1"><div class="sect1" id="kn_eventing_install">&#13;
<h1>14.5 Installing the Knative Eventing Component</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id277">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the Knative Operator (see <a data-type="xref" href="#kn_operator_install">Recipe 14.1</a>), and now you want to deploy the <a href="https://oreil.ly/kYtPu">Knative Eventing</a> component to build event-driven &#13;
<span class="keep-together">applications</span>.<a data-primary="serverless" data-secondary="creating a Knative Service" data-startref="ix_srvlKnatSer" data-type="indexterm" id="id1307"/><a data-primary="services" data-secondary="creating a Knative Service" data-startref="ix_serKnat" data-type="indexterm" id="id1308"/><a data-primary="Knative platform" data-secondary="creating a Knative Service" data-startref="ix_KnatSrvc" data-type="indexterm" id="id1309"/><a data-primary="event-driven applications" data-secondary="installing Knative Eventing" data-type="indexterm" id="id1310"/><a data-primary="Knative platform" data-secondary="installing Knative Eventing" data-type="indexterm" id="id1311"/><a data-primary="serverless" data-secondary="installing Knative Eventing" data-type="indexterm" id="id1312"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id133">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <a href="https://oreil.ly/1u62U"><code>KnativeEventing</code></a> custom resource provided by the Knative Operator to install the Eventing component of Knative.<a data-primary="KnativeEventing custom resource" data-type="indexterm" id="id1313"/></p>&#13;
&#13;
<p>Knative Eventing <a data-primary="namespaces" data-secondary="knative-eventing" data-type="indexterm" id="id1314"/>should be installed in a namespace named <code>knative-eventing</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl create ns knative-eventing</strong>&#13;
namespace/knative-eventing created&#13;
</pre>&#13;
&#13;
<p>Create a file named <em>eventing.yaml</em> with the<a data-primary="manifests" data-secondary="creating KnativeEventing manifest" data-type="indexterm" id="id1315"/><a data-primary="eventing.yaml file" data-type="indexterm" id="id1316"/> following contents:</p>&#13;
<pre data-type="programlisting">&#13;
apiVersion: operator.knative.dev/v1beta1&#13;
kind: KnativeEventing&#13;
metadata:&#13;
  name: knative-eventing&#13;
  namespace: knative-eventing&#13;
</pre>&#13;
&#13;
<p>Now use <code>kubectl</code> to apply this configuration:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f eventing.yaml</strong>&#13;
knativeeventing.operator.knative.dev/knative-eventing created&#13;
</pre>&#13;
&#13;
<p>It will take a few minutes for the <code>Knative Eventing</code> component to be successfully deployed. You can watch its deployment status using this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl --namespace knative-eventing get KnativeEventing knative-eventing -w</strong>&#13;
NAME               VERSION   READY   REASON&#13;
knative-eventing   1.11.1    False   NotReady&#13;
knative-eventing   1.11.1    False   NotReady&#13;
knative-eventing   1.11.1    False   NotReady&#13;
knative-eventing   1.11.1    True&#13;
</pre>&#13;
&#13;
<p class="pagebreak-before">Alternatively, to install <a data-primary="YAML" data-secondary="installing Knative Eventing using YAML files" data-type="indexterm" id="id1317"/>Knative Eventing using YAML files, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/knative/eventing/releases/download/&#13;
knative-v1.11.1/eventing-crds.yaml</strong>&#13;
$ <strong>kubectl apply -f https://github.com/knative/eventing/releases/download/&#13;
knative-v1.11.1/eventing-core.yaml</strong>&#13;
</pre>&#13;
&#13;
<p>And then <a data-primary="in-memory channel" data-type="indexterm" id="id1318"/><a data-primary="MTChannelBasedBroker" data-type="indexterm" id="id1319"/>install the in-memory channel and <code>MTChannelBasedBroker</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/knative/eventing/releases/download/&#13;
knative-v1.11.1/in-memory-channel.yaml</strong>&#13;
$ <strong>kubectl apply -f https://github.com/knative/eventing/releases/download/&#13;
knative-v1.11.1/mt-channel-broker.yaml</strong>&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1320">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The Knative Eventing component enables the Eventing API. It provides a framework for managing and handing events within a cloud native environment. Events in this context refer to occurrences or changes within a system, such as the creation of a new resource, updates to existing resources, or external triggers. This component enables developers to build reactive and flexible applications that respond to real-time changes and triggers across the cloud native ecosystem.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.6 Deploying a Knative Eventing Source" data-type="sect1"><div class="sect1" id="kn_eventing_example">&#13;
<h1>14.6 Deploying a Knative Eventing Source</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id278">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed Knative Eventing (see <a data-type="xref" href="#kn_eventing_install">Recipe 14.5</a>), and now you want to deploy a source that produces events so that you can use those events to trigger workflows in Knative.<a data-primary="serverless" data-secondary="deploying Knative Eventing source" data-type="indexterm" id="ix_srvlKnatEvntsrc"/><a data-primary="event-driven applications" data-secondary="deploying Knative Eventing source" data-type="indexterm" id="ix_evntKnatsrc"/><a data-primary="Knative platform" data-secondary="deploying Knative Eventing source" data-type="indexterm" id="ix_KnatEvntsrc"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id134">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>An event source is a Kubernetes custom resource that acts as a link between an event producer and an event sink. To inspect the event sources currently available, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl api-resources --api-group='sources.knative.dev'</strong>&#13;
NAME              SHORTNAMES  APIVERSION           NAMESPACED   KIND&#13;
apiserversources              sources.kn...dev/v1  true         ApiServerSource&#13;
containersources              sources.kn...dev/v1  true         ContainerSource&#13;
pingsources                   sources.kn...dev/v1  true         PingSource&#13;
sinkbindings                  sources.kn...dev/v1  true         SinkBinding&#13;
</pre>&#13;
&#13;
<p><a href="https://oreil.ly/KlpSU">PingSource</a> is an event source that generates events containing a fixed payload at regular intervals defined by a cron schedule.<a data-primary="PingSource" data-type="indexterm" id="id1321"/><a data-primary="sinks (eventing)" data-type="indexterm" id="id1322"/> Let’s deploy a <code>PingSource</code> and hook it on to a <a href="https://oreil.ly/RWa85">Sink</a> named <code>sockeye</code>.</p>&#13;
&#13;
<p class="pagebreak-before">Begin by creating the <code>sockeye</code> service:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/n3wscott/sockeye/releases/download/&#13;
v0.7.0/release.yaml</strong>&#13;
service.serving.knative.dev/sockeye created&#13;
</pre>&#13;
&#13;
<p>Verify that the <code>sockeye</code> service was created successfully:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get ksvc sockeye</strong>&#13;
NAME      URL                         LATESTCREATED   LATESTREADY     READY&#13;
sockeye   http://sockeye...sslip.io   sockeye-00001   sockeye-00001   True&#13;
</pre>&#13;
&#13;
<p>Create a file named <em>pingsource.yaml</em> to create the <code>PingSource</code> and hook it up with the <code>sockeye</code> application:</p>&#13;
<pre data-type="programlisting">&#13;
apiVersion: sources.knative.dev/v1&#13;
kind: PingSource&#13;
metadata:&#13;
  name: ping-source&#13;
spec:&#13;
  schedule: "* * * * *"&#13;
  contentType: "application/json"&#13;
  data: '{ "message": "Hello, world!" }'&#13;
  sink:&#13;
    ref:&#13;
      apiVersion: serving.knative.dev/v1&#13;
      kind: Service&#13;
      name: sockeye&#13;
</pre>&#13;
&#13;
<p>Apply the manifest with this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f pingsource.yaml</strong>&#13;
pingsource.sources.knative.dev/ping-source created&#13;
</pre>&#13;
&#13;
<p>Verify that the <code>PingSource</code> was created successfully:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get pingsource ping-source -w</strong>&#13;
NAME          ...   AGE   READY   REASON&#13;
ping-source   ...   52s   False   MinimumReplicasUnavailable&#13;
ping-source   ...   59s   True&#13;
</pre>&#13;
&#13;
<p>Get the URL of the <code>sockeye</code> service using this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get ksvc sockeye  -o jsonpath={.status.url}</strong>&#13;
http://sockeye.default.10.99.62.226.sslip.io&#13;
</pre>&#13;
&#13;
<p>Upon opening the URL in your web browser, you should see new events appear every minute, as shown in <a data-type="xref" href="#sockeye-pingsource-events">Figure 14-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="sockeye-pingsource-events">&#13;
<img alt="Screen Shot of events appearing in Sockeye" src="assets/kcb2_1401.png"/>&#13;
<h6><span class="label">Figure 14-1. </span>Events appearing in Sockeye</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id279">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If you do not want to write YAML files, you can use the <code>kn</code> client (see <a data-type="xref" href="#kn_cli_install">Recipe 14.3</a>) instead.</p>&#13;
&#13;
<p>Create the <code>sockeye</code> service <a data-primary="kn (Knative) CLI" data-secondary="creating sockeye service" data-type="indexterm" id="id1323"/>with this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kn service create sockeye --image docker.io/n3wscott/sockeye:v0.7.0</strong>&#13;
</pre>&#13;
&#13;
<p>Next, create the <code>PingSource</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kn source ping create ping-source --data '{ "message": "Hello, world!" }' \&#13;
    --schedule '* * * * *' --sink sockeye</strong>&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.7 Enabling Knative Eventing Sources" data-type="sect1"><div class="sect1" id="kn_eventing_sources_install">&#13;
<h1>14.7 Enabling Knative Eventing Sources</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id280">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the Knative Eventing component (see <a data-type="xref" href="#kn_eventing_install">Recipe 14.5</a>), and you want to enable Knative event sources that are not enabled by default.<a data-primary="Knative platform" data-secondary="deploying Knative Eventing source" data-startref="ix_KnatEvntsrc" data-type="indexterm" id="id1324"/><a data-primary="serverless" data-secondary="deploying Knative Eventing source" data-startref="ix_srvlKnatEvntsrc" data-type="indexterm" id="id1325"/><a data-primary="event-driven applications" data-secondary="deploying Knative Eventing source" data-startref="ix_evntKnatsrc" data-type="indexterm" id="id1326"/><a data-primary="Knative platform" data-secondary="enabling Knative Eventing sources" data-type="indexterm" id="id1327"/><a data-primary="serverless" data-secondary="enabling Knative Eventing sources" data-type="indexterm" id="id1328"/><a data-primary="event-driven applications" data-secondary="enabling Knative Eventing sources" data-type="indexterm" id="id1329"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id281">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a href="https://oreil.ly/ZP2Wa">Additional event sources</a> developed by the Knative community, such as ones for GitHub, GitLab, Apache Kafka, and so on, can be configured in the Knative Eventing custom resource. <a data-primary="GitHub" data-secondary="installing GitHub event source" data-type="indexterm" id="id1330"/>For instance, to install the <a href="https://oreil.ly/8HavC">GitHub event source</a>, update the <em>eventing.yaml</em> file from <a data-type="xref" href="#kn_eventing_install">Recipe 14.5</a> like so:</p>&#13;
<pre data-type="programlisting">&#13;
apiVersion: operator.knative.dev/v1beta1&#13;
kind: KnativeEventing&#13;
metadata:&#13;
  name: knative-eventing&#13;
  namespace: knative-eventing&#13;
spec:&#13;
  source:&#13;
    github:&#13;
      enabled: true&#13;
</pre>&#13;
&#13;
<p>Apply the changes with this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f eventing.yaml</strong>&#13;
knativeeventing.operator.knative.dev/knative-eventing configured&#13;
</pre>&#13;
&#13;
<p>Watch the status of the update:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl -n knative-eventing get KnativeEventing knative-eventing -w</strong>&#13;
NAME               VERSION   READY   REASON&#13;
knative-eventing   1.11.1    False   NotReady&#13;
knative-eventing   1.11.1    True&#13;
</pre>&#13;
&#13;
<p>Now, if you inspect the available sources, you should see the <code>GitHubSource</code> event source:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl api-resources --api-group='sources.knative.dev'</strong>&#13;
NAME                 APIVERSION                  NAMESPACED    KIND&#13;
apiserversources     sources.kn..dev/v1          true          ApiServerSource&#13;
containersources     sources.kn..dev/v1          true          ContainerSource&#13;
<strong>githubsources        sources.kn..dev/v1alpha1    true          GitHubSource</strong>&#13;
pingsources          sources.kn..dev/v1          true          PingSource&#13;
sinkbindings         sources.kn..dev/v1          true          SinkBinding&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id1331">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>GitHubSource</code> event source registers for events on a specified GitHub organization or repository and triggers a new event for selected GitHub event types.</p>&#13;
&#13;
<p>Open source event sources for GitLab, Apache Kafka, RabbitMQ, and more are  &#13;
<span class="keep-together">also available.</span></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.8 Installing Event Sources from TriggerMesh" data-type="sect1"><div class="sect1" id="kn_eventing_install_triggermesh_sources">&#13;
<h1>14.8 Installing Event Sources from TriggerMesh</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id135">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed Knative Eventing (see <a data-type="xref" href="#kn_eventing_install">Recipe 14.5</a>), and now you want to install event sources from TriggerMesh so that you have access to event sources for a wide range of platforms and services.<a data-primary="event-driven applications" data-secondary="installing event sources from TriggerMesh" data-type="indexterm" id="ix_evntTMsrc"/><a data-primary="TriggerMesh event sources, installing" data-type="indexterm" id="ix_TMevntsrc"/><a data-primary="serverless" data-secondary="installing event sources from TriggerMesh" data-type="indexterm" id="ix_srvlevntsrcTM"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id1332">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>To install v1.26.0 of TriggerMesh, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl apply -f https://github.com/triggermesh/triggermesh/releases/&#13;
download/v1.26.0/triggermesh-crds.yaml</strong>&#13;
...k8s.io/awscloudwatchlogssources.sources.triggermesh.io created&#13;
...k8s.io/awscloudwatchsources.sources.triggermesh.io created&#13;
...k8s.io/awscodecommitsources.sources.triggermesh.io create&#13;
...&#13;
&#13;
$ <strong>kubectl apply -f https://github.com/triggermesh/triggermesh/releases/&#13;
download/v1.26.0/triggermesh.yaml</strong>&#13;
namespace/triggermesh created&#13;
clusterrole.rbac.authorization.k8s.io/triggermesh-namespaced-admin created&#13;
clusterrole.rbac.authorization.k8s.io/triggermesh-namespaced-edit created&#13;
clusterrole.rbac.authorization.k8s.io/triggermesh-namespaced-view created&#13;
...&#13;
</pre>&#13;
&#13;
<p>You can inspect the sources provided by the TriggerMesh API using this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl api-resources --api-group='sources.triggermesh.io'</strong>&#13;
NAME                     APIVERSION       NAMESPACED  KIND&#13;
awscloudwatchlog...      sources.tri...   true        AWSCloudWatchLogsSource&#13;
awscloudwatchsou...      sources.tri...   true        AWSCloudWatchSource&#13;
awscodecommitsou...      sources.tri...   true        AWSCodeCommitSource&#13;
...&#13;
</pre>&#13;
&#13;
<p>Similarly, you can list all the sinks provided by the TriggerMesh API using this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl api-resources --api-group='targets.triggermesh.io'</strong>&#13;
NAME                 SHORT...  APIVERSION       NAMESPACED  KIND&#13;
awscomprehendtar...            targets.tri...   true        AWSComprehendTarget&#13;
awsdynamodbtarge...            targets.tri...   true        AWSDynamoDBTarget&#13;
awseventbridgeta...            targets.tri...   true        AWSEventBridgeTarget&#13;
...&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id136">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a href="https://triggermesh.com">TriggerMesh</a> is free open source software that lets you easily build event-driven applications. TriggerMesh provides event sources for a wide range of platforms and services, such as AWS, Google Cloud, Azure, Salesforce, Zendesk, and so on. In addition to event sources, TriggerMesh provides components that enable you to transform the cloud events.</p>&#13;
&#13;
<p>Head over to the <a href="https://oreil.ly/0lDap">TriggerMesh documentation</a> to learn more.<a data-primary="event-driven applications" data-secondary="installing event sources from TriggerMesh" data-startref="ix_evntTMsrc" data-type="indexterm" id="id1333"/><a data-primary="TriggerMesh event sources, installing" data-startref="ix_TMevntsrc" data-type="indexterm" id="id1334"/><a data-primary="serverless" data-secondary="installing event sources from TriggerMesh" data-startref="ix_srvlevntsrcTM" data-type="indexterm" id="id1335"/><a data-primary="serverless" data-startref="ix_srvls" data-type="indexterm" id="id1336"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id1337">&#13;
<h2>See Also</h2>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://oreil.ly/-bqVQ">TriggerMesh sources</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/7tlVP">TriggerMesh targets</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/O2Et4">TriggerMesh transformations</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>