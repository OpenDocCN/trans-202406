<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 11. Deploying Samba for Windows Compatibility" data-type="chapter" epub:type="chapter"><div class="chapter" id="deploying_samba_for_windows_compatibili">
<h1><span class="label">Chapter 11. </span>Deploying Samba for <span class="keep-together">Windows Compatibility</span></h1>
<p>Interoperability is the capability for disparate systems such as Windows, Linux, Unix, and macOS to coexist and work together. <a contenteditable="false" data-primary="operating systems" data-secondary="interoperability of Linux with" data-seealso="Samba" data-type="indexterm" id="idm45657873042192"/><a contenteditable="false" data-primary="interoperability, Windows, Linux, Unix, and macOS" data-seealso="Samba" data-type="indexterm" id="idm45657872596720"/><a contenteditable="false" data-primary="Mac systems" data-secondary="interoperability with other operating systems" data-type="indexterm" id="idm45657872595408"/><a contenteditable="false" data-primary="Samba" data-type="indexterm" id="ix_Smba"/>Interoperability is now a standard and accepted feature of all data center operating systems, although some functionality requires third-party software. <a contenteditable="false" data-primary="Windows" data-secondary="interoperability with Linux and Unix" data-seealso="Samba" data-type="indexterm" id="idm45657872592688"/>Hardware, software, and operating systems can no longer exist in a proprietary vacuum. In other words, vendors must ensure that their products are cross-platform capable. Contemporary data centers are heterogenous—meaning that Windows, Linux, and Unix systems occupy racks.</p>
<p>Both native and third-party utilities make interoperability possible.<a contenteditable="false" data-primary="AD (Active Directory)" data-type="indexterm" id="idm45657873402224"/><a contenteditable="false" data-primary="Lightweight Directory Access Protocol (LDAP)" data-type="indexterm" id="idm45657874527088"/><a contenteditable="false" data-primary="LDAP (Lightweight Directory Access Protocol)" data-type="indexterm" id="idm45657874525584"/> From Active Directory (AD) and LDAP to Samba/SMB to *nix utilities and applications, systems can work together toward a common goal: serving customers.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The generic wildcard designation “*nix” represents all Unix, Linux, and similar operating systems and distributions.</p>
</div>
<p class="pagebreak-after">Samba is a suite of utilities that enable Windows interoperability for Linux and Unix. Samba provides secure, stable, file and print services for non-Windows systems using the Server Message Block/Common Internet File System (SMB/CIFS) protocol. Samba has its own authentication structure consisting of permissions and passwords.<a contenteditable="false" data-primary="CIFS (Common Internet File System), SMB/CIFS" data-type="indexterm" id="idm45657872589312"/><a contenteditable="false" data-primary="Server Message Block/Common Internet File System (SMB/CIFS)" data-type="indexterm" id="idm45657872769424"/></p>
<p>Using Samba, Linux systems <a contenteditable="false" data-primary="Samba" data-secondary="Linux systems using, capabilities of" data-type="indexterm" id="idm45657872767888"/>may do the following:</p>
<ul>
<li>
<p>Share directories, filesystems, and printers with Windows computers</p>
</li>
<li>
<p>Mount Windows shares</p>
</li>
<li>
<p>Browse the network for shares provided by Windows and other Linux computers</p>
</li>
<li>
<p>Participate in Windows domain authentication and authorization</p>
</li>
<li>
<p>Use Windows name resolution services</p>
</li>
<li>
<p>Use shared printers</p>
</li>
</ul>
<p>With Samba <a contenteditable="false" data-primary="Windows" data-secondary="capabilities of Windows computers with Samba on Linux servers" data-type="indexterm" id="idm45657872578672"/>installed on Linux servers, Windows <a contenteditable="false" data-primary="Samba" data-secondary="installed on Linux servers, Windows computers capabilities" data-type="indexterm" id="idm45657872577280"/>computers may do the following:</p>
<ul>
<li>
<p>Browse Linux shares</p>
</li>
<li>
<p>Use shared printers</p>
</li>
<li>
<p>Map network drives to Linux shares</p>
</li>
</ul>
<p>This chapter explores some utilities and applications that enable Linux systems to interoperate with Windows. The following section discusses the challenges of interacting with Windows systems, and tools and configurations to make it work.</p>
<section data-pdf-bookmark="Planning Your Samba Environment" data-type="sect1"><div class="sect1" id="planning_your_samba_environment">
<h1>Planning Your Samba Environment</h1>
<p>Requests for new file shares are commonplace in any business. <a contenteditable="false" data-primary="Samba" data-secondary="planning a Samba environment" data-type="indexterm" id="ix_Smbaenv"/>Coworkers, often separated by hundreds or thousands of miles, want a shared space to place files such as documents, spreadsheets, text files, scripts, and images. As a system administrator, there are some questions you must ask of your groups who want this shared space.</p>
<p>For this scenario, the Facilities department has requested the shared file space. So, you will set up their Linux system as a Windows file server. The following is a list of five important questions to ask:</p>
<ol class="pagebreak-after">
<li>
<p>Should this space be restricted to your group only?</p>
</li>
<li>
<p>Do you want everyone in your group to be able to copy and create files in the shared space?</p>
</li>
<li>
<p>Are there any default permissions you want to set on uploaded files?</p>
</li>
<li>
<p>Do you need any read-only folders for documents?</p>
</li>
<li>
<p>Is this a permanent or a temporary shared space?</p>
</li>
</ol>
<p>For this scenario, the facilities manager gave the following answers:</p>
<ol>
<li>
<p>Yes, restrict to facilities employees only.</p>
</li>
<li>
<p>Everyone needs to be able to copy and create files.</p>
</li>
<li>
<p>Everyone in the group needs read and write access to all files.</p>
</li>
<li>
<p>Yes, we need a <em>Policies</em> folder from which no one can edit or remove files.</p>
</li>
<li>
<p>This is a permanent space.</p>
</li>
</ol>
<p>The answers give you a starting place for the new shared space for the facilities team. If a facilities group doesn’t exist, create one now and add facilities team members as their primary group. The group member accounts are <code>atran</code>, <code>areed</code>, and <code>akumar</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Samba <a contenteditable="false" data-primary="passwords" data-secondary="Samba" data-type="indexterm" id="idm45657872550688"/>usernames and <a contenteditable="false" data-primary="users" data-secondary="Samba" data-tertiary="usernames and passwords" data-type="indexterm" id="idm45657872549792"/>passwords must match exactly with those configured on Windows systems.</p>
</div>
<p>To demonstrate Samba’s functionality, perform the following tasks:</p>
<pre data-type="programlisting">
$ sudo groupadd -g 9001 facilities
$ sudo usermod -g facilities atran
$ sudo usermod -g facilities areed
$ sudo usermod -g facilities akumar</pre>
<p>Create a directory such as <em>/opt/facilities</em> that will be shared via Samba:</p>
<pre data-type="programlisting">
$ sudo mkdir /opt/facilities</pre>
<p>Change the group ownership and permissions of the <em>/opt/facilities</em> directory to reflect the requested permissions:</p>
<pre data-type="programlisting">
$ sudo chgrp facilities /opt/facilities
$ sudo chmod 770 /opt/facilities</pre>
<p>Create a subdirectory under <em>/opt/facilities</em> and name it <em>Policies</em>. Make the <em>Policies</em> directory read-only for the facilities group:</p>
<pre data-type="programlisting">
$ sudo mkdir /opt/facilities/Policies
$ sudo chmod 740 /opt/facilities/Policies</pre>
<p class="pagebreak-after">Now the shared space setup is complete and ready for Samba configuration.</p>
<section data-pdf-bookmark="Installing Samba and Its Dependencies" data-type="sect2"><div class="sect2" id="installing_samba_and_its_dependencies">
<h2 class="less_space">Installing Samba and Its Dependencies</h2>
<p>Before configuring anything related to<a contenteditable="false" data-primary="installation" data-secondary="installing Samba and its dependencies" data-type="indexterm" id="idm45657872537568"/> Samba, you must <a contenteditable="false" data-primary="Samba" data-secondary="planning a Samba environment" data-tertiary="installing Samba and dependencies" data-type="indexterm" id="idm45657872536080"/>install it and its dependent software:</p>
<pre data-type="programlisting">
$ sudo yum install samba

Last metadata expiration check: 2:55:52 ago on Sat 08 Oct 2022 11:42:12 AM EDT.
Dependencies resolved.
=================================================================================
 Package              Architecture    Version              Repository       Size
=================================================================================
Installing:
 samba                x86_64          4.14.5-7.el8_5       baseos           848 k
Installing dependencies:
 libwbclient          x86_64          4.14.5-7.el8_5       baseos           121 k
 Samba-client-libs    x86_64          4.14.5-7.el8_5       baseos           5.4 M
 samba-common         noarch          4.14.5-7.el8_5       baseos           221 k
 Samba-common-libs    x86_64          4.14.5-7.el8_5       baseos           173 k
 samba-common-tools   x86_64          4.14.5-7.el8_5       baseos           500 k
 samba-libs           x86_64          4.14.5-7.el8_5       baseos           

Transaction Summary
=================================================================================
Install  7 Packages

Total download size: 7.4 M
Installed size: 25 M
Is this ok [y/N]: y</pre>
<p>The process works similarly on other distributions. This transaction installs everything you need to set up your Linux system as a Windows file server.</p>
<p>Enable <a contenteditable="false" data-primary="nmb and smb services (Samba), enabling and starting" data-type="indexterm" id="idm45657872531808"/>and <a contenteditable="false" data-primary="services" data-secondary="Samba, enabling nd starting" data-type="indexterm" id="idm45657872530000"/>start the<a contenteditable="false" data-primary="smb and nmb services (Samba), enabling and starting" data-type="indexterm" id="idm45657872528624"/> Samba services (<code>smb</code> and <code>nmb</code>):</p>
<pre data-type="programlisting">
$ sudo systemctl enable smb
Created symlink /etc/systemd/system/multi-user.target.wants/smb.service 
→ /usr/lib/systemd/system/smb.service.

$ sudo systemctl enable nmb
Created symlink /etc/systemd/system/multi-user.target.wants/nmb.service 
→ /usr/lib/systemd/system/nmb.service.

$ sudo systemctl start smb
$ sudo systemctl start nmb</pre>
<p class="pagebreak-after">Samba services are now started and will start at boot time.</p>
</div></section>
<section data-pdf-bookmark="Adding Samba Users to Your System" data-type="sect2"><div class="sect2" id="adding_samba_users_to_your_system">
<h2 class="less_space">Adding Samba Users to Your System</h2>
<p>Because Samba<a contenteditable="false" data-primary="Samba" data-secondary="planning a Samba environment" data-tertiary="adding Samba users to your system" data-type="indexterm" id="idm45657872522896"/> manages its own <a contenteditable="false" data-primary="users" data-secondary="Samba" data-tertiary="adding to your system" data-type="indexterm" id="idm45657872521152"/>user list, you must add each user to the Samba User Database. For demonstration purposes, I use <code>PaSSw0rd</code> for the Samba password:</p>
<pre data-type="programlisting">
$ sudo smbpasswd -a atran
New SMB password:
Retype new SMB password:
Added user atran.</pre>
<p>A configuration is available to sync Samba and Linux passwords. I cover this later in the chapter.</p>
</div></section>
<section data-pdf-bookmark="Managing Samba Users as a Group" data-type="sect2"><div class="sect2" id="managing_samba_users_as_a_group">
<h2>Managing Samba Users as a Group</h2>
<p>Groups make it easier to manage large numbers of users. <a contenteditable="false" data-primary="Samba" data-secondary="planning a Samba environment" data-tertiary="managing Samba users as a group" data-type="indexterm" id="idm45657872513792"/><a contenteditable="false" data-primary="groups" data-secondary="managing Samba users as a group" data-type="indexterm" id="idm45657872512576"/><a contenteditable="false" data-primary="users" data-secondary="Samba" data-tertiary="managing as a group" data-type="indexterm" id="idm45657872511232"/>Groups are easier to manage because you can apply security to multiple users at once without the overhead of tracking the security settings for each user. In other words, managing security for 10 groups is much easier than managing it for 100 individual users.</p>
<p>You can create new Linux groups or use existing ones for Samba users and grant group access to a share. You can also grant individual users access to a share, but it’s much more labor-intensive.</p>
<p>Continuing with the example scenario where you have a facilities Linux group containing three members, you can manage directory and file permissions for all three group members for a particular directory (<em>/opt/facilities</em>). This is standard Linux administration practice.</p>
<p>If you then share that same directory (<em>/opt/facilities</em>) via Samba, add <code>valid users = @facilities</code> in the configuration file to allow the entire group access to the shared directory. The <code>@facilities</code> declaration refers to the facilities Linux group, and its group members are valid users of that share.</p>
<p>Linux file and directory permissions are different from Samba permissions.<a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="Linux file and directory permissions versus Samba" data-type="indexterm" id="idm45657872504128"/> A Linux user might have write access permission to a directory, but the share might be read-only for the same user. If you don’t add valid users to a share, it doesn’t matter that the Linux file permissions allow the group to write to the directory; group members won’t be able to access that directory via the share.</p>
<p>One of the primary reasons for enabling Samba shares is to create compatibility between Windows and Mac clients and Linux servers. The rest of this chapter deals with configuring and supporting that interoperability.<a contenteditable="false" data-primary="Samba" data-secondary="planning a Samba environment" data-startref="ix_Smbaenv" data-type="indexterm" id="idm45657872509904"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Providing Services to Mac and Windows Clients" data-type="sect1"><div class="sect1" id="providing_services_to_mac_and_windows_c">
<h1>Providing Services to Mac and Windows Clients</h1>
<p>As a Linux system administrator, you must realize that Linux is a great <em>server</em> operating system.<a contenteditable="false" data-primary="Mac systems" data-secondary="providing services to Mac clients" data-type="indexterm" id="ix_Macser"/><a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-type="indexterm" id="ix_Smbaser"/><a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-type="indexterm" id="ix_Winser"/> Some believe massive Linux desktop adoption is “just around the corner.” However, realistically, Windows and Mac workstations are the corporate standards, while Linux is still the outlier. Because Linux is a great server operating system, sysadmins must provide services compatible with Windows and Mac clients. macOS, having *nix roots, is generally Linux compatible, so less effort is required to make Mac systems and Linux work together.<a contenteditable="false" data-primary="macOS" data-seealso="Mac systems" data-type="indexterm" id="idm45657872493008"/></p>
<p>Windows, however, is not so easy to integrate with Linux—at least, not right out of the box. Windows systems require third-party tools and utilities, and Linux systems require extra software packages and special configurations. But it’s possible to make the two systems work together seamlessly, and the solutions are also quite elegant and stable.</p>
<section data-pdf-bookmark="Serving Network Storage to Desktop Clients" data-type="sect2"><div class="sect2" id="serving_network_storage_to_desktop_clie">
<h2>Serving Network Storage to Desktop Clients</h2>
<p>Administrators provide network storage to Windows systems <a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-tertiary="serving network storage to desktop clients" data-type="indexterm" id="ix_Smbaserstor"/><a contenteditable="false" data-primary="storage" data-secondary="network storage, serving to Windows and Mac desktop clients" data-type="indexterm" id="ix_storser"/><a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-tertiary="serving network storage to desktop clients" data-type="indexterm" id="ix_Winserstor"/>via mapped drives and to Mac clients via mounted shares. A mapped drive, in Linux terms, is a mounted remote shared directory. Windows labels these remote shares as drive letters, such as <em>F:</em> through <em>Z:</em>. From the Linux system, sysadmins share directories through Samba, which is somewhat analogous to *nix Network File System (NFS) shares. macOS systems can also mount Samba shares by browsing the network using the Samba protocol or by direct connection.</p>
<p>Samba shares are handy because users can drag and drop files onto a shared directory without using file transfer software such as FTP, SFTP, SCP, or others. Samba shares appear to be shared from a Windows server system, which further integrates Linux into a Windows and Mac desktop environment.</p>
<section data-pdf-bookmark="Exploring global Samba settings" data-type="sect3"><div class="sect3" id="exploring_global_samba_settings">
<h3>Exploring global Samba settings</h3>
<p>You can set dozens of “directives” in the <code>[global]</code> portion of your <em>/etc/samba/smb.conf</em> file. <a contenteditable="false" data-primary="/etc/samba/smb.conf file" data-primary-sortas="etc" data-secondary="global settings in" data-type="indexterm" id="idm45657872472352"/><a contenteditable="false" data-primary="global settings (Samba)" data-type="indexterm" id="idm45657872471088"/>Still, in my opinion, the following directives are the ones you should set, regardless of your use of domain controllers and AD, but they are best used as a standalone Samba server.<a contenteditable="false" data-primary="AD (Active Directory)" data-type="indexterm" id="idm45657872679616"/> Many of the directives shown are defaults:</p>
<pre data-type="programlisting">
[global]
    load printers = yes
    passdb backend = tdbsam
    security = user
    cups options = raw
    workgroup = YOUR_DOMAIN_NAME
    printcap name = cups
    printing = cups
    os level = 20
    netbios name = SERVER1
    browseable = yes

    interfaces = lo eth0 192.168.1.0/24
    hosts allow = 127. 192.168.1.</pre>
<p>Change the settings to match your network and needs. The workgroup is usually set to the same as your domain name or workgroup if you aren’t using a domain. The NetBIOS name is the name of the Samba server that you’ll see in a network browse list.</p>
</div></section>
<section data-pdf-bookmark="Printing via Samba" data-type="sect3"><div class="sect3" id="printing_via_samba">
<h3>Printing via Samba</h3>
<p>You can also share printers, but <a contenteditable="false" data-primary="printing via Samba" data-type="indexterm" id="idm45657872474512"/>because most systems print directly to printers via their IP addresses, printer sharing isn’t covered here. <a contenteditable="false" data-primary="/etc/samba/smb.conf file" data-primary-sortas="etc" data-secondary="configuration for sharing printers" data-type="indexterm" id="idm45657872462672"/>There is a sample configuration for sharing printers in the <em>/etc/samba/smb.conf</em> file:</p>
<pre data-type="programlisting">
[printers]
        comment = All Printers
        path = /var/tmp
        printable = yes
        create mask = 0600
        browseable = no

[print$]
        comment = Printer Drivers
        path = /var/lib/samba/drivers
        write list = @printadmin root
        force group = @printadmin
        create mask = 0664
        directory mask = 0775</pre>
<p>These configurations will get you started. I suggest that you change <span class="keep-together"><code>browseable = no</code></span> to <code>browseable = yes</code>. Remember to restart the <code>samba</code> service every time you make a configuration change. The next two sections step you through sharing a directory for user access.</p>
</div></section>
<section data-pdf-bookmark="Deploying the lmhosts file" data-type="sect3"><div class="sect3" id="deploying_the_lmhosts_file">
<h3>Deploying the lmhosts file</h3>
<p>Just as you have in Windows systems, Samba supports the <em>lmhosts</em> file. <a contenteditable="false" data-primary="lmhosts file, deploying" data-type="indexterm" id="idm45657872456240"/>The <em>lmhosts</em> file lists NetBIOS names and IP addresses of systems on your network. I suggest you copy and paste the contents of a Windows <em>lmhosts</em> file to your Linux systems that provide Samba services. Do not transfer the Windows <em>lmhosts</em> file to your Linux servers because of text formatting differences between Windows and Linux systems. The default <em>lmhosts</em> file in <em>/etc/samba</em> only contains localhost information:</p>
<pre class="pagebreak-after" data-type="programlisting">
127.0.0.1 localhost</pre>
<p>Think of the <em>lmhosts</em> file the same way you consider the <em>/etc/hosts</em> file. You can also set other directives in the <em>lmhosts</em> file shown in the following list. Directives follow entries and use the <code>#</code>:</p>
<dl>
<dt><code>#PRE</code></dt>
<dd>
<p>Entries loaded into cache for name lookup and resolution:</p>
<pre data-type="programlisting">
192.168.1.50    testserv1    #PRE</pre>
</dd>
<dt><code>#DOM:<em>domain</em></code></dt>
<dd>
<p>Domain server entries. Use this directive with the <code>#PRE</code> directive:</p>
<pre data-type="programlisting">
192.168.1.100  DC1  #PRE #DOM:WEST  #The West Domain Controller DC1</pre>
</dd>
<dt><code>#INCLUDE \\<em>UNC Path</em>\<em>To File</em></code></dt>
<dd>
<p>Includes a file from another system. This is often used to integrate <em>lmhosts</em> files from frequently updated Windows systems:</p>
<pre data-type="programlisting">
#INCLUDE \\server1\public\lmhosts</pre>
</dd>
<dt><code>#BEGIN_ALTERNATE</code>/<code>#END_ALTERNATE</code></dt>
<dd>
<p>Groups multiple <code>#INCLUDE</code> directives together:</p>
<pre data-type="programlisting">
#BEGIN_ALTERNATE

#INCLUDE \\server1\public\lmhosts
#INCLUDE \\server2\public\lmhosts
#INCLUDE \\server3\public\lmhosts

#END_ALTERNATE</pre>
</dd>
</dl>
<p>I always use <em>lmhosts</em> files on my Samba servers. I set up an automated script to keep the local <em>lmhosts</em> file in sync with a single source of truth. However, the <code>#INCLUDE</code> directive that points to another system’s <em>lmhosts</em> file is a good alternative.</p>
<p>The next few sections demonstrate how to set up and use a Samba share.<a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-startref="ix_Smbaserstor" data-tertiary="serving network storage to desktop clients" data-type="indexterm" id="idm45657872432080"/><a contenteditable="false" data-primary="storage" data-secondary="network storage, serving to Windows and Mac desktop clients" data-startref="ix_storser" data-type="indexterm" id="idm45657872430352"/><a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-startref="ix_Winserstor" data-tertiary="serving network storage to desktop clients" data-type="indexterm" id="idm45657872428736"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Configuring a Shared Directory" data-type="sect2"><div class="sect2" id="configuring_a_shared_directory">
<h2>Configuring a Shared Directory</h2>
<p>The <em>/etc/samba/smb.conf</em> file <a contenteditable="false" data-primary="/etc/samba/smb.conf file" data-primary-sortas="etc" data-secondary="configuring shared Linux Samba directory" data-type="indexterm" id="idm45657872425504"/>is the Samba configuration file where you set up shared directories. <a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-tertiary="configuring a shared directory" data-type="indexterm" id="idm45657872422640"/><a contenteditable="false" data-primary="shared directories" data-secondary="configuring Samba shared directory" data-type="indexterm" id="idm45657872421056"/>The <code>homes</code> share is a good place to start for your custom shared directory configuration. <a contenteditable="false" data-primary="directories" data-secondary="shared directory for Linux and Samba" data-type="indexterm" id="idm45657872419008"/></p>
<p>The following sample shared directory is from an <em>/etc/samba/smb.conf.example</em> file:</p>
<pre data-type="programlisting">
[homes]
    comment = Home Directories
    browseable = no
    writeable = yes
;   valid users = %S
;   valid users = MYDOMAIN\%S</pre>
<p>The following is the facilities share configuration in my <em>/etc/samba/smb.conf</em> file. The bracketed portion, <code>[Facilities]</code>, is the share name. Remember to keep share names to 15 characters or less, and avoid nonalphanumeric characters and spaces.</p>
<p>The <code>create mode</code> and <code>directory mode</code> are set according to the facilities manager’s needs from the previously mentioned five questions:</p>
<pre data-type="programlisting">
[Facilities]
    create mode = 0660
    writeable = yes
    path = /opt/facilities
    comment = Facilities Group Share
    directory mode = 0770
    only user = yes
    valid users = @facilities
    browseable = yes</pre>
<p>The <code>valid users</code> entry limits access to users listed in the facilities Linux group. <code>browseable</code> means that if you perform a network browse, the system and this share appear in the list of available shares. The <code>create mode</code> directive (<code>0660</code>) is the default file creation permission for files in the share. When you create a new file in the shared directory via the share, its permissions will be <code>0660</code>. The directory mode is the permissions given to the share.</p>
</div></section>
<section data-pdf-bookmark="Browsing for Shared Directories" data-type="sect2"><div class="sect2" id="browsing_for_shared_directories">
<h2>Browsing for Shared Directories</h2>
<p>This section covers browsing for and connecting to Linux Samba shares from Mac, Windows, and Linux computers. <a contenteditable="false" data-primary="Mac systems" data-secondary="providing services to Mac and Windows clients" data-tertiary="browsing for Linux Samba shares from macOS" data-type="indexterm" id="idm45657872405504"/><a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-tertiary="browsing for shared directories" data-type="indexterm" id="idm45657872406656"/><a contenteditable="false" data-primary="shared directories" data-secondary="browsing for Linux Samba shares from Mac, Windows, and Linux" data-type="indexterm" id="idm45657872406528"/>Refer to Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#a_samba_network_browse_on_a_macos_syste">11-1</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#the_macos_finder_app_displaying_samba_s">11-2</a> to see how a Mac system views Samba shares on Linux systems. <em>server1</em> is the CentOS system I’ve used in the examples, and <em>server2</em> is an Ubuntu system also used in this book.</p>
<figure><div class="figure" id="a_samba_network_browse_on_a_macos_syste"><img alt="" height="186" src="assets/plsa_1101.png" width="467"/>
<h6><span class="label">Figure 11-1. </span>A Samba network browse on a macOS system</h6>
</div></figure>
<p>Once connected, the mounted shares appear as resources in the macOS Finder application.</p>
<figure><div class="figure" id="the_macos_finder_app_displaying_samba_s"><img alt="" height="416" src="assets/plsa_1102.png" width="461"/>
<h6><span class="label">Figure 11-2. </span>The macOS Finder app displaying Samba systems and shares</h6>
</div></figure>
<p>On Windows systems, the view is similar, but to connect<a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-tertiary="browsing for shared directories" data-type="indexterm" id="idm45657872393808"/> to a remote share, you must map a drive. Mapping a drive means mounting the remote share and using it as if it were local to the system. Recall the NFS reference from earlier. See Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#mapping_a_drive_left_parenthesisgright">11-3</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#the_mapped_drive_in_windows_file_explor">11-4</a>.</p>
<figure><div class="figure" id="mapping_a_drive_left_parenthesisgright"><img alt="" height="211" src="assets/plsa_1103.png" width="558"/>
<h6><span class="label">Figure 11-3. </span>Mapping a drive (G:) to the remote share \\server1\Facilities</h6>
</div></figure>
<p>Mapping the share makes it available as a drive letter on the client system.</p>
<figure><div class="figure" id="the_mapped_drive_in_windows_file_explor"><img alt="" height="164" src="assets/plsa_1104.png" width="426"/>
<h6><span class="label">Figure 11-4. </span>The mapped drive in Windows File Explorer</h6>
</div></figure>
<p>With the drive mapped, the user, <code>ajones</code>, can freely access the <em>Facilities</em> share, and this user can create, edit, and copy files to the shared directory. The following section deals with how Linux systems view and connect to Windows shares.</p>
</div></section>
<section data-pdf-bookmark="Mounting Windows System’s Shares" data-type="sect2"><div class="sect2" id="mounting_windows_systemapostrophes_shar">
<h2>Mounting Windows System’s Shares</h2>
<p>You can also <a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-tertiary="mounting Windows system shares" data-type="indexterm" id="idm45657872381472"/>browse shares on <a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-tertiary="mounting Windows system shares" data-type="indexterm" id="idm45657872379760"/>a remote<a contenteditable="false" data-primary="mounting and mount points" data-secondary="mounting Windows system shares" data-type="indexterm" id="idm45657872378016"/> Windows (or other Linux) system from a Linux computer using the Samba protocol:</p>
<pre data-type="programlisting">
$ smbclient -U "Ken Hess" -L WIN10
Enter WORKGROUP\Ken Hess's password:

    Sharename       Type      Comment
    ---------       ----      -------
    ADMIN$          Disk      Remote Admin
    C$              Disk      Default share
    Files           Disk     
    IPC$            IPC       Remote IPC
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to WIN10 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available</pre>
<p>The message concerning <code>SMB1</code> can be ignored. It doesn’t affect functionality. Depending on your Samba client and server versions on the systems you’re browsing, you can receive different messages referring to SMB versions. All can be ignored.</p>
<p><code>mount</code> the remote Windows share (<code>Files</code>) on the <code>WIN10</code> computer:</p>
<pre data-type="programlisting">
$ sudo mount -t cifs \\\\WIN10\\Files /mnt
Password for Ken Hess@\WIN10\Files:  ********
[khess@server1 facilities]$ ls /mnt
abi.mp4  new.txt  untitled.mp3</pre>
<p class="pagebreak-before">If you don’t use the <a contenteditable="false" data-primary="cifs filesystem type" data-type="indexterm" id="idm45657874609168"/>filesystem type <code>cifs</code> as part of the <code>mount</code> command, you’ll receive the following message:</p>
<pre data-type="programlisting">
mount: /mnt: special device \\WIN10\Files does not exist.
Use four backslashes (\\\\) and two for the UNC mapping command's share name 
(\\). For example, \\\\WIN10\\Files. You may also use single-quoted backs...
('\\'WIN10'\'Files). Remember that in Linux, you escape a character with ...
(\), so you must escape (or quote) the backslash character with a backsla...
to tell the shell that this is a literal backslash. A regular UNC mapping...
looks like this: \\WIN10\Files.</pre>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id00012">
<h1>Summary</h1>
<p>Linux <a contenteditable="false" data-primary="Windows" data-secondary="providing services to Windows clients" data-startref="ix_Winser" data-type="indexterm" id="idm45657872371328"/>interoperability everywhere from <a contenteditable="false" data-primary="Mac systems" data-secondary="providing services to Mac clients" data-startref="ix_Macser" data-type="indexterm" id="idm45657872368880"/>contemporary <a contenteditable="false" data-primary="Samba" data-secondary="providing services to Mac and Windows clients" data-startref="ix_Smbaser" data-type="indexterm" id="idm45657872367264"/>enterprise data centers to small server rooms provides increased functionality, lowers costs, and offers greater freedom of software choice. Regardless of which distribution you choose to integrate into your business, providing services to Windows and Mac clients is essential to Linux adoption and success. You must seamlessly duplicate standard Windows Server services and demonstrate to users and management that Linux can dispel skepticism with higher stability and lower maintenance than its costly alternatives.<a contenteditable="false" data-primary="Samba" data-startref="ix_Smba" data-type="indexterm" id="idm45657872365712"/></p>
</div></section>
</div></section></div></body></html>