<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. Getting Started"><div class="chapter" id="chapter-2"><h1><span class="label">Chapter 2. </span>Getting Started</h1><p>MongoDB<a data-type="indexterm" data-primary="MongoDB" data-secondary="basic concepts" id="MDBbasic02"/> is powerful but easy to get started with. In this chapter
  we’ll introduce some of the basic concepts of MongoDB:</p><ul><li><p>A <em>document</em> is the basic unit of data for
      MongoDB and is roughly equivalent to a row in a relational database
      management system (but much more expressive).</p></li><li><p>Similarly, a <em>collection</em> can be thought of as
      a table with a dynamic schema.</p></li><li><p>A single instance of MongoDB can host multiple independent
      <em>databases</em>, each of which contains its own
      collections.</p></li><li><p>Every document has a special key, <code>"_id"</code>, that is unique within a
      collection.</p></li><li><p>MongoDB is distributed with a simple but powerful tool called
      the<em> mongo shell</em>. The <em>mongo</em>
      shell provides built-in support for administering MongoDB instances and
      manipulating data using the MongoDB query language. It is also a fully
      functional JavaScript interpreter that enables users to create and load
      their own scripts for a variety of purposes.</p></li></ul><section data-type="sect1" data-pdf-bookmark="Documents"><div class="sect1" id="sect1_d1e735"><h1>Documents</h1><p>At<a data-type="indexterm" data-primary="documents" data-secondary="basics of" id="idm45882399545608"/> the heart of MongoDB is the <em>document</em>:
    an ordered set of <a data-type="indexterm" data-primary="keys" data-secondary="in documents" id="idm45882399543832"/>keys with associated values. The representation of a
    document varies by programming language, but most languages have a data
    structure that is a natural fit, such as a map, hash, or dictionary. In
    JavaScript, for example, documents are represented as objects:</p><pre id="I_programlisting2_d1e631" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"greeting"</code> <code class="o">:</code> <code class="s2">"Hello, world!"</code><code class="p">}</code></pre><p>This simple document contains a single key, <code>"greeting"</code>, with a value of <code>"Hello, world!"</code>. Most documents will be more
    complex than this simple one and often will contain multiple key/value
    pairs:</p><pre id="I_programlisting2_d1e641" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"greeting"</code> <code class="o">:</code> <code class="s2">"Hello, world!"</code><code class="p">,</code> <code class="s2">"views"</code> <code class="o">:</code> <code class="mi">3</code><code class="p">}</code></pre><p>As you can see, values in documents are not just “blobs.” They can
    be one of several different data types (or even an entire embedded
    document—see <a data-type="xref" href="#embedded-documents">“Embedded Documents”</a>). In this example the
    value for <code>"greeting"</code> is a string,
    whereas the value for <code>"views"</code> is an
    integer.</p><p>The<a data-type="indexterm" data-primary="keys" data-secondary="disallowed characters" id="idm45882399189464"/> keys in a document are strings. Any UTF-8 character is
    allowed in a key, with a few notable exceptions:</p><ul><li><p>Keys must not contain the character <em>\0</em> (the
        <code>null</code> character)<a data-type="indexterm" data-primary="\0 (the null character)" id="idm45882397889976"/>. This character is used to signify the end of a
        key.</p></li><li><p>The <em>.</em> and <em>$</em>
        characters<a data-type="indexterm" data-primary="$ (dollar sign)" data-secondary="reserved character" id="idm45882397884712"/><a data-type="indexterm" data-primary=". (dot)" data-secondary="reserved character" id="idm45882397883576"/> have some special properties and should be used only in
        certain circumstances, as described in later chapters. In general,
        they should be considered reserved, and drivers will complain if they
        are used inappropriately.</p></li></ul><p>MongoDB is type-sensitive and case-sensitive. For example, these
    documents are <span class="keep-together">distinct:</span></p><pre id="I_programlisting2_d1e728" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"count"</code> <code class="o">:</code> <code class="mi">5</code><code class="p">}</code>
<code class="p">{</code><code class="s2">"count"</code> <code class="o">:</code> <code class="s2">"5"</code><code class="p">}</code></pre><p>as are these:</p><pre id="I_programlisting2_d1e732" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"count"</code> <code class="o">:</code> <code class="mi">5</code><code class="p">}</code>
<code class="p">{</code><code class="s2">"Count"</code> <code class="o">:</code> <code class="mi">5</code><code class="p">}</code></pre><p>A final important thing to note is that documents in MongoDB cannot
    contain duplicate keys. For example, the following is not a legal
    document:</p><pre id="I_programlisting2_d1e741" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"greeting"</code> <code class="o">:</code> <code class="s2">"Hello, world!"</code><code class="p">,</code> <code class="s2">"greeting"</code> <code class="o">:</code> <code class="s2">"Hello, MongoDB!"</code><code class="p">}</code></pre></div></section><section data-type="sect1" data-pdf-bookmark="Collections"><div class="sect1" id="sect1_d1e842"><h1>Collections</h1><p>A<a data-type="indexterm" data-primary="collections" data-secondary="basics of" id="Cbas02"/> <em>collection</em> is a group of documents. If
    a document is the MongoDB analog of a row in a relational database, then a
    collection can be thought of as the analog to a table.</p><section data-type="sect2" data-pdf-bookmark="Dynamic Schemas"><div class="sect2" id="sect2_d1e853"><h2>Dynamic Schemas</h2><p>Collections<a data-type="indexterm" data-primary="collections" data-secondary="dynamic schemas" id="idm45882398385720"/><a data-type="indexterm" data-primary="dynamic schemas, collections" id="idm45882398384584"/> have <em>dynamic schemas</em>. This means
      that the documents within a single collection can have any number of
      different “shapes.” For example, both of the following documents could
      be stored in a single collection:</p><pre id="I_programlisting2_d1e770" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"greeting"</code> <code class="o">:</code> <code class="s2">"Hello, world!"</code><code class="p">,</code> <code class="s2">"views"</code><code class="o">:</code> <code class="mi">3</code><code class="p">}</code>
<code class="p">{</code><code class="s2">"signoff"</code><code class="o">:</code> <code class="s2">"Good night, and good luck"</code><code class="p">}</code></pre><p>Note<a data-type="indexterm" data-primary="collections" data-secondary="benefits of separate" id="idm45882398888824"/> that the previous documents have different keys,
      different numbers of keys, and values of different types. Because any
      document can be put into any collection, the question often arises: “Why
      do we need separate collections at all?” With no need for separate
      schemas for different kinds of documents, why
      <em>should</em> we use more than one collection? There are
      several good <span class="keep-together">reasons</span>:</p><ul><li><p>Keeping different kinds of documents in the same collection
          can be a nightmare for developers and admins. Developers need to
          make sure that each query is only returning documents adhering to a
          particular schema or that the application code performing a query
          can handle documents of different shapes. If we’re querying for blog
          posts, it’s a hassle to weed out documents containing author
          data.</p></li><li><p>It’s much faster to get a list of collections than to extract
          a list of the types of documents in a collection. For example, if we
          had a <code>"type"</code> field in each
          document that specified whether the document was a “skim,” “whole,”
          or “chunky monkey,” it would be much slower to find those three
          values in a single collection than to have three separate
          collections and query the correct collection.</p></li><li><p>Grouping documents of the same kind together in the same
          collection allows for data locality. Getting several blog posts from
          a collection containing only posts will likely require fewer disk
          seeks than getting the same posts from a collection containing posts
          and author data.</p></li><li><p>We begin to impose some structure on our documents when we
          create indexes. (This is especially true in the case of unique
          indexes.) These indexes are defined per collection. By putting only
          documents of a single type into the same collection, we can index
          our collections more efficiently.</p></li></ul><p>There are sound reasons for creating a schema and for grouping
      related types of documents together. While not required by default,
      defining schemas for your application is good practice and can be
      enforced through the use of MongoDB’s documentation validation
      functionality and object–document mapping libraries available for many
      programming languages.</p></div></section><section data-type="sect2" data-pdf-bookmark="Naming"><div class="sect2" id="sect2_d1e908"><h2>Naming</h2><p>A<a data-type="indexterm" data-primary="collections" data-secondary="naming" id="idm45882398355752"/><a data-type="indexterm" data-primary="naming" data-secondary="collections" id="idm45882398354616"/> collection is identified by its name. Collection names
      can be any UTF-8 string, with a few restrictions:</p><ul><li><p>The empty string (<code>""</code>) is
          not a valid collection name.</p></li><li><p>Collection names may not contain the character<a data-type="indexterm" data-primary="\0 (the null character)" id="idm45882398351720"/> <em>\0</em> (the <code>null</code> character), because this delineates
          the end of a collection name.</p></li><li><p>You should not create any collections with names that start
          with <em>system.</em>, a prefix reserved for<a data-type="indexterm" data-primary="collections" data-secondary="internal" id="idm45882398349064"/> internal collections. For example, the
          <em>system.users</em> collection contains the database’s
          users, and the <em>system.namespaces</em> collection
          contains information about all of the database’s collections.</p></li><li><p>User-created collections should not contain the<a data-type="indexterm" data-primary="$ (dollar sign)" data-secondary="reserved character" id="idm45882398346456"/> reserved character <em>$</em> in their
          names. The various drivers available for the database do support
          using <em>$</em> in collection names because some
          system-generated collections contain it, but you should not use
          <em>$</em> in a name unless you are accessing one of
          these collections.</p></li></ul><section data-type="sect3" data-pdf-bookmark="Subcollections"><div class="sect3" id="sect3_d1e952"><h3>Subcollections</h3><p>One<a data-type="indexterm" data-primary="collections" data-secondary="subcollections" id="idm45882398342648"/><a data-type="indexterm" data-primary="subcollections" id="idm45882398341320"/> convention for organizing collections is to use
        namespaced subcollections separated by the<a data-type="indexterm" data-primary=". (dot)" data-secondary="in subcollections" id="idm45882398340216"/> <em>.</em> character. For example, an
        application containing a blog might have a collection named
        <em>blog.posts</em> and a separate collection named
        <em>blog.authors</em>. This is for organizational purposes
        only—there is no relationship between the <em>blog</em>
        collection (it doesn’t even have to exist) and its “children.”</p><p>Although subcollections do not have any special properties, they
        are useful and are incorporated into many MongoDB tools. For
        instance:</p><ul><li><p>GridFS, a protocol for storing large files, uses
            subcollections to store file metadata separately from content
            chunks (see <a data-type="xref" href="ch06.xhtml#chapter-idx-types">Chapter 6</a> for more
            information about GridFS).</p></li><li><p>Most drivers provide some syntactic sugar for accessing a
            subcollection of a given collection. For example, in the database
            shell, <code>db.blog</code> will give you
            the <em>blog</em> collection, and <code>db.blog.posts</code> will give you the
            <em>blog.posts</em> collection.</p></li></ul><p>Subcollections are a good way to organize data in MongoDB for
        many use<a data-type="indexterm" data-startref="Cbas02" id="idm45882398314232"/>
        cases.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="Databases"><div class="sect1" id="sect1_d1e1015"><h1>Databases</h1><p>In<a data-type="indexterm" data-primary="databases" data-secondary="basics of" id="idm45882398312120"/> addition to grouping documents by collection, MongoDB
    groups collections into <em>databases</em>. A single instance
    of MongoDB can host several databases, each grouping together zero or more
    collections. A good rule of thumb is to store all data for a single
    application in the same database. Separate databases are useful when
    storing data for several applications or users on the same MongoDB
    server.</p><p>Like<a data-type="indexterm" data-primary="naming" data-secondary="databases" id="idm45882398309848"/><a data-type="indexterm" data-primary="databases" data-secondary="naming" id="idm45882398308712"/> collections, databases are identified by name. Database
    names can be any UTF-8 string, with the following restrictions:</p><ul><li><p>The empty string (<em>“”</em>) is not a valid
        database name.</p></li><li><p>A database name cannot contain any of these characters:
        <em>/</em>, <em>\</em>,
        <em>.</em>, <em>"</em>,
        <em>*</em>, <em>&lt;</em>,
        <em>&gt;</em>, <em>:</em>,
        <em>|</em>, <em>?</em>,
        <em>$</em>, (a single space), or <em>\0</em>
        (the <code>null</code> character). Basically,
        stick with alphanumeric ASCII.</p></li><li><p>Database names are case-insensitive.</p></li><li><p>Database names are limited to a maximum of 64 bytes.</p></li></ul><p>Historically, prior to the use of the WiredTiger storage engine,
    database names became files on your filesystem. It is no longer the case.
    This explains why many of the previous restrictions exist in the first
    place.</p><p>There<a data-type="indexterm" data-primary="databases" data-secondary="reserved names" id="idm45882398298552"/> are also some reserved database names, which you can access
    but which have special semantics. These are as follows:</p><dl><dt><em>admin</em></dt><dd><p>The <em>admin</em> database<a data-type="indexterm" data-primary="admin database" data-secondary="role of" id="idm45882398295768"/> plays a role in authentication and authorization. In
          addition, access to this database is required for some
          administrative operations. See <a data-type="xref" href="ch19.xhtml#chapter-data-admin">Chapter 19</a>
          for more information about the <em>admin</em>
          database.</p></dd><dt><em>local</em></dt><dd><p>This<a data-type="indexterm" data-primary="local database, role of" id="idm45882398292056"/> database stores data specific to a single server. In
          replica sets, <em>local</em> stores data used in the
          replication process. The <em>local</em> database itself
          is never replicated. (See <a data-type="xref" href="ch10.xhtml#chapter_d1e9405">Chapter 10</a> for
          more information about replication and the local database.)</p></dd><dt><em>config</em></dt><dd><p>Sharded<a data-type="indexterm" data-primary="config database" data-secondary="role of" id="idm45882398288408"/> MongoDB clusters (see <a data-type="xref" href="ch14.xhtml#chapter_d1e10482">Chapter 14</a>) use the <em>config</em>
          database to store information about each shard.</p></dd></dl><p>By concatenating a database name with a collection in that database
    you can get a fully qualified collection name, which is called a<a data-type="indexterm" data-primary="namespaces" data-secondary="basics of" id="idm45882398285064"/> <em>namespace</em>. For instance, if you are
    using the <em>blog.posts</em> collection in the
    <em>cms</em> database, the namespace of that collection would
    be <em>cms.blog.posts</em>. Namespaces are limited to 120
    bytes in length and, in practice, should be fewer than 100 bytes long. For
    more on namespaces and the internal representation of collections
    in<a data-type="indexterm" data-startref="MDBbasic02" id="idm45882398281896"/>
    MongoDB, see <a data-type="xref" href="app02.xhtml#appendix_see">Appendix B</a>.</p></div></section><section data-type="sect1" data-pdf-bookmark="Getting and Starting MongoDB"><div class="sect1" id="sect1_d1e1130"><h1>Getting and Starting MongoDB</h1><p>To<a data-type="indexterm" data-primary="MongoDB" data-secondary="getting and starting" id="idm45882398278616"/><a data-type="indexterm" data-primary="mongod" data-secondary="running" id="idm45882398277480"/> start the server, run the <em>mongod</em>
    executable in the Unix command-line environment of your choice:</p><pre data-type="programlisting">$ mongod
2016-04-27T22:15:55.871-0400 I CONTROL  [initandlisten] MongoDB starting : 
pid=8680 port=27017 dbpath=/data/db 64-bit host=morty
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] db version v4.2.0
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] git version:
34e65e5383f7ea1726332cb175b73077ec4a1b02
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] allocator: system
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] modules: none
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] build environment:
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten]     distarch: x86_64
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten]     target_arch: x86_64
2016-04-27T22:15:55.872-0400 I CONTROL  [initandlisten] options: {}
2016-04-27T22:15:55.889-0400 I JOURNAL  [initandlisten] 
journal dir=/data/db/journal
2016-04-27T22:15:55.889-0400 I JOURNAL  [initandlisten] recover : 
no journal files
present, no recovery needed
2016-04-27T22:15:55.909-0400 I JOURNAL  [durability] Durability thread started
2016-04-27T22:15:55.909-0400 I JOURNAL  [journal writer] Journal writer thread 
started
2016-04-27T22:15:55.909-0400 I CONTROL  [initandlisten]
2016-04-27T22:15:56.777-0400 I NETWORK  [HostnameCanonicalizationWorker] 
Starting hostname canonicalization worker
2016-04-27T22:15:56.778-0400 I FTDC     [initandlisten] Initializing full-time 
diagnostic data capture with directory '/data/db/diagnostic.data'
2016-04-27T22:15:56.779-0400 I NETWORK  [initandlisten] waiting for connections 
on port 27017</pre><p>If you’re on Windows, run this:</p><pre id="I_programlisting2_d1e1073" data-type="programlisting">&gt; mongod.exe</pre><div data-type="tip"><h6>Tip</h6><p>For detailed information on installing MongoDB on your system, see
      <a data-type="xref" href="app01.xhtml#appendix_d1e12346">Appendix A</a> or the appropriate <a href="https://oreil.ly/5WP5e">installation
      tutorial</a> in the MongoDB documentation.</p></div><p>When run with no arguments, <em>mongod</em> will use the
    default data directory, <em class="filename">/data/db/</em> (or
    <em class="filename">\data\db\</em> on the current volume on
    Windows). If the data directory does not already exist or is not writable,
    the server will fail to start. It is important to create the data
    directory (e.g., <code>mkdir -p /data/db/</code>)
    and to make sure your user has permission to write to the directory before
    starting MongoDB.</p><p>On startup, the server will print some version and system
    information and then begin waiting for connections. By default MongoDB
    listens for socket connections on port 27017. The server will fail to
    start if that port is not available—the most common cause of this is
    another instance of MongoDB that is already running.</p><div data-type="tip"><h6>Tip</h6><p>You should always secure your <em>mongod</em>
      instances. See <a data-type="xref" href="ch19.xhtml#chapter-data-admin">Chapter 19</a> for more
      information on securing MongoDB.</p></div><p>You<a data-type="indexterm" data-primary="mongod" data-secondary="stopping" id="idm45882398264248"/> can safely stop <em>mongod</em> by typing
    Ctrl-C in the command-line-environment from which you launched the
    <em>mongod</em> server.</p><div data-type="tip"><h6>Tip</h6><p>For more information on starting or stopping MongoDB, see <a data-type="xref" href="ch21.xhtml#chapter-start-stop">Chapter 21</a>.</p></div></div></section><section data-type="sect1" data-pdf-bookmark="Introduction to the MongoDB Shell"><div class="sect1" id="sect1_d1e1195"><h1>Introduction to the MongoDB Shell</h1><p>MongoDB<a data-type="indexterm" data-primary="MongoDB" data-secondary="shell basics" id="MDBshell02"/><a data-type="indexterm" data-primary="mongo shell" data-secondary="purpose of" id="idm45882398257928"/> comes with a JavaScript shell that allows interaction with
    a MongoDB instance from the command line. The shell is useful for
    performing administrative <span class="keep-together">functions</span>,
    inspecting a running instance, or just exploring MongoDB. The
    <em>mongo</em> shell is a crucial tool for using MongoDB.
    We’ll use it extensively throughout the rest of the text.</p><section data-type="sect2" data-pdf-bookmark="Running the Shell"><div class="sect2" id="sect2_d1e1206"><h2>Running the Shell</h2><p>To<a data-type="indexterm" data-primary="mongo shell" data-secondary="running" id="idm45882398253800"/> start the shell, run the <em>mongo</em>
      executable:</p><pre data-type="programlisting">$ mongo
MongoDB shell version: 4.2.0
connecting to: test
&gt;</pre><p>The shell automatically attempts to connect to a MongoDB server
      running on the local machine on startup, so make sure you start
      <em>mongod</em> before starting the shell.</p><p>The shell is a full-featured JavaScript interpreter, capable of
      running arbitrary JavaScript programs. To illustrate this, let’s perform
      some basic math:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">x</code> <code class="o">=</code> <code class="mi">200</code><code class="p">;</code>
<code class="mi">200</code>
<code class="o">&gt;</code> <code class="nx">x</code> <code class="o">/</code> <code class="mi">5</code><code class="p">;</code>
<code class="mi">40</code></pre><p>We can also leverage all of the standard JavaScript
      libraries:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">sin</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">PI</code> <code class="o">/</code> <code class="mi">2</code><code class="p">);</code>
<code class="mi">1</code>
<code class="o">&gt;</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="s2">"20109/1/1"</code><code class="p">);</code>
<code class="nx">ISODate</code><code class="p">(</code><code class="s2">"2019-01-01T05:00:00Z"</code><code class="p">)</code>
<code class="o">&gt;</code> <code class="s2">"Hello, World!"</code><code class="p">.</code><code class="nx">replace</code><code class="p">(</code><code class="s2">"World"</code><code class="p">,</code> <code class="s2">"MongoDB"</code><code class="p">);</code>
<code class="nx">Hello</code><code class="p">,</code> <code class="nx">MongoDB</code><code class="o">!</code></pre><p>We can even define and call JavaScript functions:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="kd">function</code> <code class="nx">factorial</code> <code class="p">(</code><code class="nx">n</code><code class="p">)</code> <code class="p">{</code>
<code class="p">...</code> <code class="k">if</code> <code class="p">(</code><code class="nx">n</code> <code class="o">&lt;=</code> <code class="mi">1</code><code class="p">)</code> <code class="k">return</code> <code class="mi">1</code><code class="p">;</code>
<code class="p">...</code> <code class="k">return</code> <code class="nx">n</code> <code class="o">*</code> <code class="nx">factorial</code><code class="p">(</code><code class="nx">n</code> <code class="o">-</code> <code class="mi">1</code><code class="p">);</code>
<code class="p">...</code> <code class="p">}</code>
<code class="o">&gt;</code> <code class="nx">factorial</code><code class="p">(</code><code class="mi">5</code><code class="p">);</code>
<code class="mi">120</code></pre><p>Note that you can create multiline commands. The shell will detect
      whether the JavaScript statement is complete when you press Enter. If
      the statement is not complete, the shell will allow you to continue
      writing it on the next line. Pressing Enter three times in a row will
      cancel the half-formed command and get you back to the <code>&gt;</code> prompt.</p></div></section><section data-type="sect2" data-pdf-bookmark="A MongoDB Client"><div class="sect2" id="sect2_d1e1249"><h2>A MongoDB Client</h2><p>Although<a data-type="indexterm" data-primary="mongo shell" data-secondary="MongoDB client" id="idm45882398182280"/> the ability to execute arbitrary JavaScript is useful,
      the real power of the shell lies in the fact that it is also a
      standalone MongoDB client. On startup, the shell connects to the
      <em>test</em> database on a MongoDB server and assigns this
      database connection to the global variable <code class="varname">db</code>. This
      variable is the primary access point to your MongoDB server through the
      shell.</p><p>To see the database to which <code class="varname">db</code> is currently
      assigned, type in <code>db</code> and hit
      Enter:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code>
<code class="nx">test</code></pre><p>The shell contains some add-ons that are not valid JavaScript
      syntax but were implemented because of their familiarity to users of SQL
      shells. The add-ons do not provide any extra functionality, but they are
      nice syntactic sugar. For instance, one of the most important operations
      is selecting which database to use:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">use</code> <code class="nx">video</code>
<code class="nx">switched</code> <code class="nx">to</code> <code class="nx">db</code> <code class="nx">video</code></pre><p>Now if you look at the <code class="varname">db</code> variable, you can see
      that it refers to the <em>video</em> database:</p><pre id="I_programlisting2_d1e1228" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code>
<code class="nx">video</code></pre><p>Because this is a JavaScript shell, typing a variable name will
      cause the name to be evaluated as an expression. The value (in this
      case, the database name) is then printed.</p><p>You may access collections from the <code class="varname">db</code>
      variable. For example:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code></pre><p>returns the <em>movies</em> collection in the current
      database. Now that we can access a collection in the shell, we can
      perform almost any database operation.</p></div></section><section data-type="sect2" data-pdf-bookmark="Basic Operations with the Shell"><div class="sect2" id="sect2_d1e1298"><h2>Basic Operations with the Shell</h2><p>We<a data-type="indexterm" data-primary="mongo shell" data-secondary="manipulating and viewing data in" id="MSman02"/> can use the four basic operations, create, read, update,
      and delete<a data-type="indexterm" data-primary="CRUD (create, read, update, and delete)" data-secondary="basic shell operation" id="CRUD02"/> (CRUD), to manipulate and view data in the shell.</p><section data-type="sect3" data-pdf-bookmark="Create"><div class="sect3" id="sect3_d1e1306"><h3>Create</h3><p>The <code class="function">insertOne</code>
        function<a data-type="indexterm" data-primary="insertOne method" id="idm45882396559240"/><a data-type="indexterm" data-primary="documents" data-secondary="adding to collections" id="idm45882396558376"/> adds a document to a collection. For example, suppose
        we want to store a movie. First, we’ll create a local variable called
        <code class="varname">movie</code> that is a JavaScript object representing our
        document. It will have the keys <code>"title"</code>, <code>"director"</code>, and <code>"year"</code> (the year it was released):</p><pre id="I_programlisting2_d1e1277" class="pagebreak-before" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">movie</code> <code class="o">=</code> <code class="p">{</code><code class="s2">"title"</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">,</code>
<code class="p">...</code> <code class="s2">"director"</code> <code class="o">:</code> <code class="s2">"George Lucas"</code><code class="p">,</code>
<code class="p">...</code> <code class="s2">"year"</code> <code class="o">:</code> <code class="mi">1977</code><code class="p">}</code>
<code class="p">{</code>
	<code class="s2">"title"</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">,</code>
	<code class="s2">"director"</code> <code class="o">:</code> <code class="s2">"George Lucas"</code><code class="p">,</code>
	<code class="s2">"year"</code> <code class="o">:</code> <code class="mi">1977</code>
<code class="p">}</code></pre><p>This object is a valid MongoDB document, so we can save it to
        the <em>movies</em> collection using the <code class="function">insertOne</code> method:</p><pre id="I_programlisting2_d1e1295" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">insertOne</code><code class="p">(</code><code class="nx">movie</code><code class="p">)</code>
<code class="p">{</code>
	<code class="s2">"acknowledged"</code> <code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
	<code class="s2">"insertedId"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">(</code><code class="s2">"5721794b349c32b32a012b11"</code><code class="p">)</code>
<code class="p">}</code></pre><p>The movie has been saved to the database. We can see it by
        calling <code>find</code> on the
        <span class="keep-together">collection</span>:</p><pre id="I_programlisting2_d1e1305" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">find</code><code class="p">().</code><code class="nx">pretty</code><code class="p">()</code>
<code class="p">{</code>
	<code class="s2">"_id"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">(</code><code class="s2">"5721794b349c32b32a012b11"</code><code class="p">),</code>
	<code class="s2">"title"</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">,</code>
	<code class="s2">"director"</code> <code class="o">:</code> <code class="s2">"George Lucas"</code><code class="p">,</code>
	<code class="s2">"year"</code> <code class="o">:</code> <code class="mi">1977</code>
<code class="p">}</code></pre><p>We can see that an <code>"_id"</code> key
        was added and that the other key/value pairs were saved as we entered
        them. The reason for the sudden appearance of the <code>"_id"</code> field is explained at the end of this
        chapter.</p></div></section><section data-type="sect3" data-pdf-bookmark="Read"><div class="sect3" id="sect3_d1e1361"><h3>Read</h3><p><code class="function">find</code> and <code class="function">findOne</code> can<a data-type="indexterm" data-primary="collections" data-secondary="querying" id="idm45882396380568"/><a data-type="indexterm" data-primary="find method" data-secondary="querying collections" id="idm45882396379432"/><a data-type="indexterm" data-primary="findOne method" id="idm45882396378328"/> be used to query a collection. If we just want to see
        one document from a collection, we can use <code class="function">findOne</code>:</p><pre id="I_programlisting2_d1e1336" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">findOne</code><code class="p">()</code>
<code class="p">{</code>
	<code class="s2">"_id"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">(</code><code class="s2">"5721794b349c32b32a012b11"</code><code class="p">),</code>
	<code class="s2">"title"</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">,</code>
	<code class="s2">"director"</code> <code class="o">:</code> <code class="s2">"George Lucas"</code><code class="p">,</code>
	<code class="s2">"year"</code> <code class="o">:</code> <code class="mi">1977</code>
<code class="p">}</code></pre><p><code class="function">find</code> and <code class="function">findOne</code> can also be passed criteria in the
        form of a <span class="firstterm">query document<a data-type="indexterm" data-primary="query documents" id="idm45882396322888"/></span>. This will restrict the documents matched
        by the query. The shell will automatically display up to 20 documents
        matching a <code class="function">find</code>, but more can be
        fetched. (See <a data-type="xref" href="ch04.xhtml#chapter_d1e3559">Chapter 4</a> for more information
        on querying.)</p></div></section><section data-type="sect3" data-pdf-bookmark="Update"><div class="sect3" id="sect3_d1e1389"><h3>Update</h3><p>If we would like to modify our post, we can use <code class="function">updateOne<a data-type="indexterm" data-primary="updateOne method" id="idm45882396318152"/></code>. <code class="function">updateOne</code> takes (at least) two parameters:
        the first is the criteria to find which document to update, and the
        second is a document describing the updates to make. Suppose we decide
        to enable reviews for the movie we created earlier. We’ll need to add
        an array of reviews as the value for a new key in our <span class="keep-together">document</span>.</p><p>To perform the update, we’ll need to use an update operator,
        <code>set</code>:</p><pre id="I_programlisting2_d1e1383" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">updateOne</code><code class="p">({</code><code class="nx">title</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">},</code>
<code class="p">...</code> <code class="p">{</code><code class="nx">$set</code> <code class="o">:</code> <code class="p">{</code><code class="nx">reviews</code><code class="o">:</code> <code class="p">[]}})</code>
<code class="nx">WriteResult</code><code class="p">({</code><code class="s2">"nMatched"</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="s2">"nUpserted"</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="s2">"nModified"</code><code class="o">:</code> <code class="mi">1</code><code class="p">})</code></pre><p>Now the document has a <code>"reviews"</code> key. If we call <code class="function">find</code> again, we can see the new key:</p><pre id="I_programlisting2_d1e1394" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">find</code><code class="p">().</code><code class="nx">pretty</code><code class="p">()</code>
<code class="p">{</code>
	<code class="s2">"_id"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">(</code><code class="s2">"5721794b349c32b32a012b11"</code><code class="p">),</code>
	<code class="s2">"title"</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">,</code>
	<code class="s2">"director"</code> <code class="o">:</code> <code class="s2">"George Lucas"</code><code class="p">,</code>
	<code class="s2">"year"</code> <code class="o">:</code> <code class="mi">1977</code><code class="p">,</code>
	<code class="s2">"reviews"</code> <code class="o">:</code> <code class="p">[</code> <code class="p">]</code>
<code class="p">}</code></pre><p>See <a data-type="xref" href="ch03.xhtml#sect1_d1e2484">“Updating Documents”</a> for detailed information on
        updating <span class="keep-together">documents</span>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Delete"><div class="sect3" id="sect3_d1e1436"><h3>Delete</h3><p><code class="function">deleteOne</code><a data-type="indexterm" data-primary="deleteOne method" id="idm45882396175304"/> and <code>deleteMany<a data-type="indexterm" data-primary="deleteMany method" id="idm45882396174024"/></code> permanently delete<a data-type="indexterm" data-primary="documents" data-secondary="deleting from database" id="idm45882396173032"/> documents from the database. Both methods take a filter
        document specifying criteria for the removal. For example, this would
        remove the movie we just created:</p><pre id="I_programlisting2_d1e1416" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">deleteOne</code><code class="p">({</code><code class="nx">title</code> <code class="o">:</code> <code class="s2">"Star Wars: Episode IV - A New Hope"</code><code class="p">})</code></pre><p>Use <code>deleteMany</code> to delete all
        documents matching a<a data-type="indexterm" data-startref="CRUD02" id="idm45882396113064"/><a data-type="indexterm" data-startref="MSman02" id="idm45882396112328"/><a data-type="indexterm" data-startref="MDBshell02" id="idm45882396111528"/> filter.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="Data Types"><div class="sect1" id="sect1_d1e1569"><h1>Data Types</h1><p>The<a data-type="indexterm" data-primary="MongoDB" data-secondary="data types" id="MDBdata02"/> beginning of this chapter covered the basics of what a
    document is. Now that you are up and running with MongoDB and can try
    things in the shell, this section will dive a little deeper. MongoDB
    supports a wide range of data types as values in documents. In this
    section, we’ll outline all the supported types.</p><section data-type="sect2" data-pdf-bookmark="Basic Data Types"><div class="sect2" id="sect2_d1e1577"><h2>Basic Data Types</h2><p>Documents<a data-type="indexterm" data-primary="data types" data-secondary="basic" id="DTbasic02"/> in MongoDB can be thought of as<a data-type="indexterm" data-primary="JSON, MongoDB documents resembling" id="idm45882396153336"/> “JSON-like” in that they are conceptually similar to
      objects in JavaScript. <a href="http://www.json.org">JSON</a> is
      a simple representation of data: the specification can be described in
      about one paragraph (the website proves it) and lists only six data
      types. This is a good thing in many ways: it’s easy to understand,
      parse, and remember. On the other hand, JSON’s expressive capabilities
      are limited because the only types are null, boolean, numeric, string,
      array, and object.</p><p>Although these types allow for an impressive amount of
      expressivity, there are a couple of additional types that are crucial
      for most applications, especially when working with a database. For
      example, JSON has no date type, which makes working with dates even more
      annoying than it usually is. There is a number type, but only one—there
      is no way to differentiate floats and integers, never mind any
      distinction between 32-bit and 64-bit numbers. There is no way to
      represent other commonly used types, either, such as regular expressions
      or functions.</p><p>MongoDB adds support for a number of additional data types while
      keeping JSON’s essential key/value–pair<a data-type="indexterm" data-primary="keys" data-secondary="in MongoDB" id="idm45882396150024"/> nature. Exactly how values of each type are represented
      varies by language, but this is a list of the commonly supported types
      and how they are represented as part of a document in the shell. The
      most common types are:</p><dl><dt>Null</dt><dd><p>The null type <a data-type="indexterm" data-primary="null type" data-secondary="uses for" id="idm45882396147448"/>can be used to represent both a null value and a
            nonexistent field:</p><pre id="I_programlisting2_d1e1619" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="kc">null</code><code class="p">}</code></pre></dd><dt>Boolean</dt><dd><p>There is a boolean type<a data-type="indexterm" data-primary="boolean type" id="idm45882396145224"/>, which can be used for the values <code>true</code> and <code>false</code>:</p><pre id="I_programlisting2_d1e1636" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="kc">true</code><code class="p">}</code></pre></dd><dt>Number</dt><dd><p>The<a data-type="indexterm" data-primary="number type" id="idm45882396092600"/> shell defaults to using 64-bit floating-point
            numbers. Thus, these numbers both look “normal” in the
            shell:</p><pre id="I_programlisting2_d1e1675" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="mf">3.14</code><code class="p">}</code></pre><pre id="I_programlisting2_d1e1679" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="mi">3</code><code class="p">}</code></pre><p>For integers, use the <code class="classname">NumberInt</code> or
            <code class="classname">NumberLong</code> classes, which represent 4-byte
            or 8-byte signed integers, respectively.</p><pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="nx">NumberInt</code><code class="p">(</code><code class="s2">"3"</code><code class="p">)}</code>
<code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="s2">"3"</code><code class="p">)}</code></pre></dd><dt>String</dt><dd><p>Any<a data-type="indexterm" data-primary="string type" id="idm45882396026744"/> string of UTF-8 characters can be represented using
            the string type:</p><pre id="I_programlisting2_d1e1692" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="s2">"foobar"</code><code class="p">}</code></pre></dd><dt>Date</dt><dd><p>MongoDB<a data-type="indexterm" data-primary="dates" data-secondary="date type" id="idm45882395968184"/> stores dates as 64-bit integers representing
            milliseconds since the Unix epoch (January 1, 1970). The time zone
            is not stored:</p><pre id="I_programlisting2_d1e1727" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">()}</code></pre></dd><dt>Regular expression</dt><dd><p>Queries<a data-type="indexterm" data-primary="regular expressions" data-secondary="querying with" id="idm45882395950776"/> can use regular expressions using JavaScript’s
            regular expression syntax:</p><pre id="I_programlisting2_d1e1740" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="sr">/foobar/i</code><code class="p">}</code></pre></dd><dt>Array</dt><dd><p>Sets<a data-type="indexterm" data-primary="arrays" data-secondary="array type" id="idm45882395909384"/> or lists of values can be represented as
            arrays:</p><pre id="I_programlisting2_d1e1801" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="p">[</code><code class="s2">"a"</code><code class="p">,</code> <code class="s2">"b"</code><code class="p">,</code> <code class="s2">"c"</code><code class="p">]}</code></pre></dd><dt>Embedded document</dt><dd><p>Documents<a data-type="indexterm" data-primary="embedded documents" data-secondary="embedded document type" id="idm45882395965464"/><a data-type="indexterm" data-primary="documents" data-secondary="embedded" id="idm45882395964488"/> can contain entire documents embedded as values in
            a parent <span class="keep-together">document</span>:</p><pre id="I_programlisting2_d1e1815" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="p">{</code><code class="s2">"foo"</code> <code class="o">:</code> <code class="s2">"bar"</code><code class="p">}}</code></pre></dd><dt>Object ID</dt><dd><p>An<a data-type="indexterm" data-primary="object ID type" id="idm45882395801400"/> object ID is a 12-byte ID for documents:</p><pre id="I_programlisting2_d1e1714" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="nx">ObjectId</code><code class="p">()}</code></pre><p>See the section <a data-type="xref" href="#sect2_d1e1990">“_id and ObjectIds”</a> for
            details.</p></dd></dl><p>There are also a few less common types that you may need,
      including:</p><dl><dt>Binary data</dt><dd><p>Binary<a data-type="indexterm" data-primary="binary data type" id="idm45882395820056"/> data is a string of arbitrary bytes. It cannot be
            manipulated from the shell. Binary data is the only way to save
            non-UTF-8 strings to the database.</p></dd><dt>Code</dt><dd><p>MongoDB<a data-type="indexterm" data-primary="code type" id="idm45882395818232"/> also makes it possible to store arbitrary
            JavaScript in queries and documents:</p><pre id="I_programlisting2_d1e1751" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"x"</code> <code class="o">:</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code> <code class="cm">/* ... */</code> <code class="p">}}</code></pre></dd></dl><p>Finally, there are a few types that are mostly used internally (or
      superseded by other types). These will be described in the text as
      needed.</p><p>For more information on MongoDB’s<a data-type="indexterm" data-startref="DTbasic02" id="idm45882395851880"/> data format, see <a data-type="xref" href="app02.xhtml#appendix_see">Appendix B</a>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Dates"><div class="sect2" id="sect2_d1e1886"><h2>Dates</h2><p>In<a data-type="indexterm" data-primary="data types" data-secondary="dates" id="idm45882395848840"/> JavaScript, the<a data-type="indexterm" data-primary="dates" data-secondary="creating new Date objects" id="idm45882395847576"/> <code>Date</code> class is used for
      MongoDB’s date type. When creating a new <code>Date</code> object, always call <code>new Date()<a data-type="indexterm" data-primary="new Date()" id="idm45882397721176"/></code>, not just <code>Date()<a data-type="indexterm" data-primary="Date()" id="idm45882397719896"/></code>. Calling the constructor as a function (i.e.,
      not including <code>new</code>) returns a string
      representation of the date, not an actual <code>Date</code> object. This is not MongoDB’s choice; it
      is how JavaScript works. If you are not careful to always use the
      <code>Date</code> constructor, you can end up with
      a mishmash of strings and dates. Strings do not match dates and vice
      versa, so this can cause problems with removing, updating,
      querying…pretty much everything.</p><p>For a full explanation of JavaScript’s <code>Date</code> class and acceptable formats for the
      constructor, see <a href="http://www.ecma-international.org">section
      15.9 of the ECMAScript specification</a>.</p><p>Dates<a data-type="indexterm" data-primary="dates" data-secondary="time zone information" id="idm45882397715736"/> in the shell are displayed using local time zone
      settings. However, dates in the database are just stored as milliseconds
      since the epoch, so they have no time zone information associated with
      them. (Time zone information could, of course, be stored as the value
      for another key.)</p></div></section><section data-type="sect2" data-pdf-bookmark="Arrays"><div class="sect2" id="sect2_d1e1910"><h2>Arrays</h2><p>Arrays<a data-type="indexterm" data-primary="data types" data-secondary="arrays" id="idm45882397712936"/><a data-type="indexterm" data-primary="arrays" data-secondary="uses for" id="idm45882397711800"/> are values that can be used interchangeably for both
      ordered operations (as though they were lists, stacks, or queues) and
      unordered operations (as though they were sets).</p><p>In the following document, the key <code>"things"</code> has an array value:</p><pre id="I_programlisting2_d1e1951" data-type="programlisting" data-code-language="javascript"><code class="p">{</code><code class="s2">"things"</code> <code class="o">:</code> <code class="p">[</code><code class="s2">"pie"</code><code class="p">,</code> <code class="mf">3.14</code><code class="p">]}</code></pre><p>As you can see from this example, arrays can contain different
      data types as values (in this case, a string and a floating-point
      number). In fact, array values can be any of the supported value types
      for normal key/value pairs, even nested arrays.</p><p>One of the great things about arrays in documents is that MongoDB
      “understands” their structure and knows how to reach inside of arrays to
      perform operations on their contents. This allows us to query on arrays
      and build indexes using their contents. For instance, in the previous
      example, MongoDB can query for all documents where <code>3.14</code> is an element of the <code>"things"</code> array. If this is a common query, you
      can even create an index on the <code>"things"</code> key to improve the query’s
      speed.</p><p>MongoDB<a data-type="indexterm" data-primary="arrays" data-secondary="atomic updates" id="idm45882397683016"/> also allows atomic updates that modify the contents of
      arrays, such as reaching into the array and changing the value <code>"pie"</code> to <code>pi</code>. We’ll see more examples of these types of
      operations throughout the text.</p></div></section><section data-type="sect2" data-pdf-bookmark="Embedded Documents"><div class="sect2" id="embedded-documents"><h2>Embedded Documents</h2><p>A <a data-type="indexterm" data-primary="data types" data-secondary="embedded documents" id="idm45882397679592"/><a data-type="indexterm" data-primary="embedded documents" data-secondary="uses for" id="idm45882397678456"/>document can be used as the value for a key. This is
      called an <em>embedded document</em>. Embedded documents can
      be used to organize data in a more natural way than just a flat
      structure of key/value pairs.</p><p>For example, if we have a document representing a person and want
      to store that person’s address, we can nest this information in an
      embedded <code>"address"</code> document:</p><pre id="I_programlisting2_d1e1992" data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
    <code class="s2">"name"</code> <code class="o">:</code> <code class="s2">"John Doe"</code><code class="p">,</code>
    <code class="s2">"address"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"street"</code> <code class="o">:</code> <code class="s2">"123 Park Street"</code><code class="p">,</code>
        <code class="s2">"city"</code> <code class="o">:</code> <code class="s2">"Anytown"</code><code class="p">,</code>
        <code class="s2">"state"</code> <code class="o">:</code> <code class="s2">"NY"</code>
    <code class="p">}</code>
<code class="p">}</code></pre><p>The value for the <code>"address"</code> key
      in this example is an embedded document with its own key/value pairs for
      <code>"street"</code>, <code>"city"</code>, and <code>"state"</code>.</p><p>As with arrays, MongoDB “understands” the structure of embedded
      documents and is able to reach inside them to build indexes, perform
      queries, or make updates.</p><p>We’ll discuss schema design in-depth later, but even from this
      basic example we can begin to see how embedded documents can change the
      way we work with data. In a relational database, the previous document
      would probably be modeled as two separate rows in two different tables
      (<em>people</em> and <em>addresses</em>). With
      MongoDB we can embed the <code>"address"</code>
      document directly within the <code>"person"</code>
      document. Thus, when used properly, embedded documents can provide a
      more natural representation of <span class="keep-together">information</span>.</p><p>The flip side of this is that there can be more data repetition
      with MongoDB. Suppose <em>addresses</em> was a separate
      table in a relational database and we needed to fix a typo in an
      address. When we did a join with <em>people</em> and
      <em>addresses</em>, we’d get the updated address for
      everyone who shares it. With <span class="keep-together">MongoDB</span>, we’d need to fix the typo in each
      person’s document.</p></div></section><section data-type="sect2" data-pdf-bookmark="_id and ObjectIds"><div class="sect2" id="sect2_d1e1990"><h2>_id and ObjectIds</h2><p>Every<a data-type="indexterm" data-primary="data types" data-secondary="_id keys and&#10;          ObjectIds" id="DTquote02"/><a data-type="indexterm" data-primary="_id keys" data-secondary="basics of" data-primary-sortas="id keys" id="idm45882397616040"/> document stored in MongoDB must have an <code>"_id"</code> key. The <code>"_id"</code> key’s value can be any type, but it
      defaults to an <code class="classname">ObjectId</code>. In a single collection,
      every document must have a unique value for <code>"_id"</code>, which ensures that every document in a
      collection can be uniquely identified. That is, if you had two
      collections, each one could have a document where the value for <code>"_id"</code> was <code>123</code>. However, neither collection could contain
      more than one document with an <code>"_id"</code>
      of <code>123</code>.</p><section data-type="sect3" data-pdf-bookmark="ObjectIds"><div class="sect3" id="sect3_d1e2017"><h3>ObjectIds</h3><p><code class="classname">ObjectId</code> is<a data-type="indexterm" data-primary="ObjectIDs" data-secondary="basics of" id="idm45882397608792"/> the default type for <code>"_id"</code>. The <code class="classname">ObjectId</code>
        class is designed to be lightweight, while still being easy to
        generate in a globally unique way across different machines. MongoDB’s
        distributed nature is the main reason why it uses
        <code class="classname">ObjectId</code>s as opposed to something more
        traditional, like an autoincrementing primary key: it is difficult and
        time-consuming to synchronize autoincrementing primary keys across
        multiple servers. Because MongoDB was designed to be a distributed
        database, it was important to be able to generate unique identifiers
        in a sharded environment.</p><p><code class="classname">ObjectId</code>s use 12 bytes of storage, which
        gives them a string representation that is 24 hexadecimal digits: 2
        digits for each byte. This causes them to appear larger than they are,
        which makes some people nervous. It’s important to note that even
        though an <code class="classname">ObjectId</code> is often represented as a
        giant hexadecimal string, the string is actually twice as long as the
        data being stored.</p><p>If you create multiple new <code class="classname">ObjectId</code>s in
        rapid succession, you can see that only the last few digits change
        each time. In addition, a couple of digits in the middle of the
        <code class="classname">ObjectId</code> will change if
        you space the creations out by a couple of seconds. This is because of
        the manner in which <code class="classname">ObjectId</code>s are created. The
        12 bytes of an <code class="classname">ObjectId</code> are generated as
        follows:</p><table><tbody><tr><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><td>Timestamp</td><td>Random</td><td>Counter (random start
                value)</td></tr></tbody></table><p>The first four bytes of an <code class="classname">ObjectId</code> are a
        timestamp in seconds since the epoch. This provides a couple of useful
        properties:</p><ul><li><p>The timestamp, when combined with the next five bytes (which
            will be described in a moment), provides uniqueness at the
            granularity of a second.</p></li><li><p>Because the timestamp comes first,
            <code class="classname">ObjectId</code>s will sort in
            <em>rough</em> insertion order. This is not a strong
            guarantee but does have some nice properties, such as making
            <code class="classname">ObjectId</code>s efficient to index.</p></li><li><p>In these four bytes exists an implicit timestamp of when
            each document was created. Most drivers expose a method for
            extracting this information from an <code class="classname">ObjectId</code>.</p></li></ul><p>Because the current time is used in
        <code class="classname">ObjectId</code>s, some users worry that their servers
        will need to have synchronized clocks. Although synchronized clocks
        are a good idea for other reasons (see <a data-type="xref" href="ch24.xhtml#clock-sync">“Synchronizing Clocks”</a>),
        the actual timestamp doesn’t matter to <code>ObjectId</code>s, only that it is often new (once
        per second) and <span class="keep-together">increasing</span>.</p><p>The next five bytes of an <code>ObjectId</code> are a random value. The final three
        bytes are a counter that starts with a random value to avoid
        generating colliding <code>ObjectId</code>s on
        different machines.</p><p>These first nine bytes of an <code class="classname">ObjectId</code>
        therefore guarantee its uniqueness across machines and processes for a
        single second. The last three bytes are simply an incrementing counter
        that is responsible for uniqueness within a second in a single
        process. This allows for up to 256<sup>3</sup>
        (16,777,216) unique <code class="classname">ObjectId</code>s to be generated
        <em>per process</em> in a single second.</p></div></section><section data-type="sect3" data-pdf-bookmark="Autogeneration of _id"><div class="sect3" id="sect3_d1e2230"><h3>Autogeneration of _id</h3><p>As<a data-type="indexterm" data-primary="_id keys" data-secondary="autogeneration of" data-primary-sortas="id keys" id="idm45882397557544"/><a data-type="indexterm" data-primary="documents" data-secondary="_id key&#10;            autogeneration" id="idm45882397556136"/> stated earlier, if there is no <code>"_id"</code> key present when a document is
        inserted, one will be automatically added to the inserted document.
        This can be handled by the MongoDB server but will generally be done
        by the driver on the client<a data-type="indexterm" data-startref="DTquote02" id="idm45882397554232"/><a data-type="indexterm" data-startref="MDBdata02" id="idm45882397553400"/> side.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="Using the MongoDB Shell"><div class="sect1" id="idm45882397552440"><h1>Using the MongoDB Shell</h1><p>This<a data-type="indexterm" data-primary="MongoDB" data-secondary="shell use" id="MDBuse02"/><a data-type="indexterm" data-primary="mongo shell" data-secondary="using" id="idm45882397549880"/> section covers how to use the shell as part of your
    command-line toolkit, customize it, and use some of its more advanced
    functionality.</p><p>Although we connected to a local <em class="filename">mongod</em> instance above, you can connect your
    shell to any MongoDB instance that your machine can reach. To connect to a
    <em class="filename">mongod</em> on a different machine or
    port, specify the hostname, port, and database when starting the
    shell:</p><pre data-type="programlisting">$ mongo some-host:30000/myDB
MongoDB shell version: 4.2.0
connecting to: some-host:30000/myDB
&gt;</pre><p><code>db</code> will now refer to <em class="filename">some-host:30000</em>’s <code>myDB</code> database.</p><p>Sometimes it is handy to not connect to a <em class="filename">mongod</em> at all when starting the <em class="filename">mongo</em> shell. If you start the shell with
    <code class="option">--nodb<a data-type="indexterm" data-primary="--nodb option" data-primary-sortas="nodb option" id="idm45882397541848"/></code>, it will start up without attempting to connect to
    anything:</p><pre data-type="programlisting" data-code-language="javascript"><code class="nx">$</code> <code class="nx">mongo</code> <code class="o">--</code><code class="nx">nodb</code>
<code class="nx">MongoDB</code> <code class="nx">shell</code> <code class="nx">version</code><code class="o">:</code> <code class="mf">4.2</code><code class="p">.</code><code class="mi">0</code>
<code class="o">&gt;</code></pre><p>Once<a data-type="indexterm" data-primary="mongod" data-secondary="connecting to" id="idm45882397531512"/> started, you can connect to a <em class="filename">mongod</em> at your leisure by running <code>new Mongo("<em><code>hostname</code></em>")<a data-type="indexterm" data-primary="new Mongo(&quot;hostname&quot;)" id="idm45882397528856"/></code>:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">conn</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Mongo</code><code class="p">(</code><code class="s2">"some-host:30000"</code><code class="p">)</code>
<code class="nx">connection</code> <code class="nx">to</code> <code class="nx">some</code><code class="o">-</code><code class="nx">host</code><code class="o">:</code><code class="mi">30000</code>
<code class="o">&gt;</code> <code class="nx">db</code> <code class="o">=</code> <code class="nx">conn</code><code class="p">.</code><code class="nx">getDB</code><code class="p">(</code><code class="s2">"myDB"</code><code class="p">)</code>
<code class="nx">myDB</code></pre><p>After these two commands, you can use <code>db</code> normally. You can use these commands
    to<a data-type="indexterm" data-primary="databases" data-secondary="connecting to" id="idm45882397473464"/><a data-type="indexterm" data-primary="servers" data-secondary="connecting to" id="idm45882397472488"/> connect to a different database or server at any
    time.</p><section data-type="sect2" data-pdf-bookmark="Tips for Using the Shell"><div class="sect2" id="sect2_d1e1455"><h2>Tips for Using the Shell</h2><p>Because <em>mongo</em> is simply a JavaScript shell,
      you can get a great deal of help for it by simply looking up JavaScript
      documentation online. For MongoDB-specific functionality, the shell
      includes built-in help that can be accessed by<a data-type="indexterm" data-primary="mongo shell" data-secondary="help command" id="idm45882397469368"/><a data-type="indexterm" data-primary="help command" id="idm45882397468264"/> typing <code><strong><code>help</code></strong></code>:</p><pre class="pagebreak-before" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">help</code>
    <code class="nx">db</code><code class="p">.</code><code class="nx">help</code><code class="p">()</code>                    <code class="nx">help</code> <code class="nx">on</code> <code class="nx">db</code> <code class="nx">methods</code>
    <code class="nx">db</code><code class="p">.</code><code class="nx">mycoll</code><code class="p">.</code><code class="nx">help</code><code class="p">()</code>             <code class="nx">help</code> <code class="nx">on</code> <code class="nx">collection</code> <code class="nx">methods</code>
    <code class="nx">sh</code><code class="p">.</code><code class="nx">help</code><code class="p">()</code>                    <code class="nx">sharding</code> <code class="nx">helpers</code>
    <code class="p">...</code>

    <code class="nx">show</code> <code class="nx">dbs</code>                     <code class="nx">show</code> <code class="nx">database</code> <code class="nx">names</code>
    <code class="nx">show</code> <code class="nx">collections</code>             <code class="nx">show</code> <code class="nx">collections</code> <code class="k">in</code> <code class="nx">current</code> <code class="nx">database</code>
    <code class="nx">show</code> <code class="nx">users</code>                   <code class="nx">show</code> <code class="nx">users</code> <code class="k">in</code> <code class="nx">current</code> <code class="nx">database</code>
    <code class="p">...</code></pre><p>Database-level help is provided by <code>db.help()<a data-type="indexterm" data-primary="db.help command" id="idm45882397414136"/></code> and collection-level help by <code>db.foo.help()</code>.</p><p>A good way of figuring out what a function is doing is to type it
      without the parentheses. This will print the JavaScript source code for
      the function. For example, if you are curious about how the <code class="function">update</code> function works or cannot remember the
      order of parameters, you can do the following:</p><pre id="I_programlisting2_d1e1474" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">updateOne</code>
<code class="kd">function</code> <code class="p">(</code><code class="nx">filter</code><code class="p">,</code> <code class="nx">update</code><code class="p">,</code> <code class="nx">options</code><code class="p">)</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="nx">opts</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">extend</code><code class="p">({},</code> <code class="nx">options</code> <code class="o">||</code> <code class="p">{});</code>

    <code class="c1">// Check if first key in update statement contains a $</code>
    <code class="kd">var</code> <code class="nx">keys</code> <code class="o">=</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">keys</code><code class="p">(</code><code class="nx">update</code><code class="p">);</code>
    <code class="k">if</code> <code class="p">(</code><code class="nx">keys</code><code class="p">.</code><code class="nx">length</code> <code class="o">==</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s2">"the update operation document must contain at</code>
<code class="s2">        least one atomic operator"</code><code class="p">);</code>
    <code class="p">}</code>
    <code class="p">...</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="Running Scripts with the Shell"><div class="sect2" id="idm45882397376712"><h2>Running Scripts with the Shell</h2><p>In<a data-type="indexterm" data-primary="mongo shell" data-secondary="running scripts" id="MSscript02"/><a data-type="indexterm" data-primary="scripts" data-secondary="running with mongo shell" id="scripts02"/> addition to using the shell interactively, you can also
      pass the shell JavaScript files to execute. Simply pass in your scripts
      at the command line:</p><pre data-type="programlisting">$ mongo script1.js script2.js script3.js
MongoDB shell version: 4.2.1
connecting to: mongodb://127.0.0.1:27017
MongoDB server version: 4.2.1

loading file: script1.js
I am script1.js
loading file: script2.js
I am script2.js
loading file: script3.js
I am script3.js
...</pre><p>The <em class="filename">mongo</em> shell will execute
      each script listed and exit.</p><p>If you want to run a script using a connection to a nondefault
      host/port <em class="filename">mongod</em>, specify the
      address first, then the script(s):</p><pre data-type="programlisting">$ mongo server-1:30000/foo --quiet script1.js script2.js script3.js</pre><p>This would execute the three scripts with <code>db</code> set to the <em class="filename">foo</em> database on <em class="filename">server-1:30000</em>.</p><p>You can print to stdout in scripts (as the preceding scripts did)
      using the <code class="function">print</code> function. This
      allows you to use the shell as part of a pipeline of commands. If you’re
      planning to pipe the output of a shell script to another command, use
      the <code class="option">--quiet</code> optio<a data-type="indexterm" data-primary="--quiet option" data-primary-sortas="quiet option" id="idm45882397277352"/>n to prevent the “MongoDB shell version v4.2.0” banner
      from printing.</p><p>You can also run scripts from within the interactive shell using
      the <code class="function">load</code> function<a data-type="indexterm" data-primary="load function" id="idm45882397275144"/>:</p><pre data-type="programlisting">&gt; load("script1.js")
I am script1.js
true
&gt;</pre><p>Scripts<a data-type="indexterm" data-primary="db.getCollectionNames()" id="idm45882397273048"/><a data-type="indexterm" data-primary="db.getMongo().getDBs()" id="idm45882397272184"/><a data-type="indexterm" data-primary="db.getSisterDB()" id="idm45882397271352"/><a data-type="indexterm" data-primary="show collections command" id="idm45882397270520"/><a data-type="indexterm" data-primary="show dbs command" id="idm45882397269720"/><a data-type="indexterm" data-primary="use video command" id="idm45882397268888"/> have access to the <code>db</code>
      variable (as well as any other global). However, shell helpers such as
      <code>use db</code> or <code>show collections</code> do not work from files. There
      are valid JavaScript equivalents to each of these, as shown in <a data-type="xref" href="#table-js-helpers">Table 2-1</a>.</p><table id="table-js-helpers"><caption><span class="label">Table 2-1. </span>JavaScript equivalents to shell helpers</caption><thead><tr><th>Helper</th><th>Equivalent</th></tr></thead><tbody><tr><td><code>use video</code></td><td><code>db.getSisterDB("video")</code></td></tr><tr><td><code>show dbs</code></td><td><code>db.getMongo().getDBs()</code></td></tr><tr><td><code>show collections</code></td><td><code>db.getCollectionNames()</code></td></tr></tbody></table><p>You can also use scripts to inject variables into the shell. For
      example, you could have a script that simply initializes helper
      functions that you commonly use. The following script, for instance, may
      be helpful for <a data-type="xref" href="part03.xhtml#part3_replication">Part III</a> and <a data-type="xref" href="part04.xhtml#part4_sharding">Part IV</a>. It defines a function, <code class="function">connectTo</code>, that connects to the locally
      running database on the given port and sets <code class="varname">db</code> to
      that connection:</p><pre data-type="programlisting" data-code-language="javascript"><code class="c1">// defineConnectTo.js</code>

<code class="cm">/**</code>
<code class="cm"> * Connect to a database and set db.</code>
<code class="cm"> */</code>
<code class="kd">var</code> <code class="nx">connectTo</code> <code class="o">=</code> <code class="kd">function</code><code class="p">(</code><code class="nx">port</code><code class="p">,</code> <code class="nx">dbname</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">port</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">port</code> <code class="o">=</code> <code class="mi">27017</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">dbname</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">dbname</code> <code class="o">=</code> <code class="s2">"test"</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="nx">db</code> <code class="o">=</code> <code class="nx">connect</code><code class="p">(</code><code class="s2">"localhost:"</code><code class="o">+</code><code class="nx">port</code><code class="o">+</code><code class="s2">"/"</code><code class="o">+</code><code class="nx">dbname</code><code class="p">);</code>
    <code class="k">return</code> <code class="nx">db</code><code class="p">;</code>
<code class="p">};</code></pre><p>If you load this script in the shell, <code class="varname">connectTo</code>
      is now defined:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="k">typeof</code> <code class="nx">connectTo</code>
<code class="kc">undefined</code>
<code class="o">&gt;</code> <code class="nx">load</code><code class="p">(</code><code class="s1">'defineConnectTo.js'</code><code class="p">)</code>
<code class="o">&gt;</code> <code class="k">typeof</code> <code class="nx">connectTo</code>
<code class="kd">function</code></pre><p>In addition to adding helper functions, you can use scripts to
      automate common tasks and administrative activities.</p><p>By default, the shell will look in the directory that you started
      the shell in (use <code>pwd()</code> to see
      what directory that is). If the script is not in your current directory,
      you can give the shell a relative or absolute path to it. For example,
      if you wanted to put your shell scripts in <em class="filename">~/my-scripts</em>, you could load <em class="filename">defineConnectTo.js</em> with <code>load("/home/myUser/my-scripts/defineConnectTo.js")</code>.
      Note that <code>load</code> cannot resolve
      <code>~</code>.</p><p>You can use <code>run</code> to run
      command-line programs from the shell. You can pass arguments to the
      function as parameters:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">run</code><code class="p">(</code><code class="s2">"ls"</code><code class="p">,</code> <code class="s2">"-l"</code><code class="p">,</code> <code class="s2">"/home/myUser/my-scripts/"</code><code class="p">)</code>
<code class="nx">sh70352</code><code class="o">|</code> <code class="o">-</code><code class="nx">rw</code><code class="o">-</code><code class="nx">r</code><code class="o">--</code><code class="nx">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="nx">myUser</code> <code class="nx">myUser</code> <code class="mi">2012</code><code class="o">-</code><code class="mi">12</code><code class="o">-</code><code class="mi">13</code> <code class="mi">13</code><code class="o">:</code><code class="mi">15</code> <code class="nx">defineConnectTo</code><code class="p">.</code><code class="nx">js</code>
<code class="nx">sh70532</code><code class="o">|</code> <code class="o">-</code><code class="nx">rw</code><code class="o">-</code><code class="nx">r</code><code class="o">--</code><code class="nx">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="nx">myUser</code> <code class="nx">myUser</code> <code class="mi">2013</code><code class="o">-</code><code class="mi">02</code><code class="o">-</code><code class="mi">22</code> <code class="mi">15</code><code class="o">:</code><code class="mi">10</code> <code class="nx">script1</code><code class="p">.</code><code class="nx">js</code>
<code class="nx">sh70532</code><code class="o">|</code> <code class="o">-</code><code class="nx">rw</code><code class="o">-</code><code class="nx">r</code><code class="o">--</code><code class="nx">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="nx">myUser</code> <code class="nx">myUser</code> <code class="mi">2013</code><code class="o">-</code><code class="mi">02</code><code class="o">-</code><code class="mi">22</code> <code class="mi">15</code><code class="o">:</code><code class="mi">12</code> <code class="nx">script2</code><code class="p">.</code><code class="nx">js</code>
<code class="nx">sh70532</code><code class="o">|</code> <code class="o">-</code><code class="nx">rw</code><code class="o">-</code><code class="nx">r</code><code class="o">--</code><code class="nx">r</code><code class="o">--</code>  <code class="mi">1</code> <code class="nx">myUser</code> <code class="nx">myUser</code> <code class="mi">2013</code><code class="o">-</code><code class="mi">02</code><code class="o">-</code><code class="mi">22</code> <code class="mi">15</code><code class="o">:</code><code class="mi">13</code> <code class="nx">script3</code><code class="p">.</code><code class="nx">js</code></pre><p>This is of limited use, generally, as the output is formatted
      oddly and it doesn’t support<a data-type="indexterm" data-startref="scripts02" id="idm45882397130632"/><a data-type="indexterm" data-startref="MSscript02" id="idm45882397129896"/> pipes.</p></div></section><section data-type="sect2" data-pdf-bookmark="Creating a .mongorc.js"><div class="sect2" id="idm45882397374648"><h2>Creating a .mongorc.js</h2><p>If<a data-type="indexterm" data-primary="mongo shell" data-secondary=".mongorc.js&#10;          creation" id="idm45882396829736"/> you have frequently loaded scripts, you might want to put
      them in your <em class="filename">.mongorc.js</em>
      file<a data-type="indexterm" data-primary="scripts" data-secondary=".mongorc.js files for&#10;          frequently loaded" id="idm45882396827816"/><a data-type="indexterm" data-primary=".mongorc.js files" data-primary-sortas="mongorc.js files" id="idm45882396826584"/>. This file is run whenever you start up the shell.</p><p>For example, suppose you would like the shell to greet you when
      you log in. Create a file called <em class="filename">.mongorc.js</em> in your home directory, and then
      add the following lines to it:</p><pre data-type="programlisting" data-code-language="javascript"><code class="c1">// .mongorc.js</code>

<code class="kd">var</code> <code class="nx">compliment</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"attractive"</code><code class="p">,</code> <code class="s2">"intelligent"</code><code class="p">,</code> <code class="s2">"like Batman"</code><code class="p">];</code>
<code class="kd">var</code> <code class="nx">index</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code><code class="o">*</code><code class="mi">3</code><code class="p">);</code>

<code class="nx">print</code><code class="p">(</code><code class="s2">"Hello, you're looking particularly "</code><code class="o">+</code><code class="nx">compliment</code><code class="p">[</code><code class="nx">index</code><code class="p">]</code><code class="o">+</code><code class="s2">" today!"</code><code class="p">);</code></pre><p class="pagebreak-after">Then, when you start the shell, you’ll see something like:</p><pre data-type="programlisting">$ mongo
MongoDB shell version: 4.2.1
connecting to: test
Hello, you're looking particularly like Batman today!
&gt;</pre><p>More practically, you can use this script to set up any global
      variables you’d like to use, alias long names to shorter ones, and
      override built-in functions. One of the most common uses for <em class="filename">.mongorc.js</em> is to remove some of the more
      “dangerous” shell helpers. You can override functions like <code class="function">dropDatabase</code> or <code class="function">deleteIndexes</code> with no-ops or undefine them
      altogether:</p><pre data-type="programlisting" data-code-language="javascript"><code class="kd">var</code> <code class="nx">no</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
    <code class="nx">print</code><code class="p">(</code><code class="s2">"Not on my watch."</code><code class="p">);</code>
<code class="p">};</code>

<code class="c1">// Prevent dropping databases</code>
<code class="nx">db</code><code class="p">.</code><code class="nx">dropDatabase</code> <code class="o">=</code> <code class="nx">DB</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">dropDatabase</code> <code class="o">=</code> <code class="nx">no</code><code class="p">;</code>

<code class="c1">// Prevent dropping collections</code>
<code class="nx">DBCollection</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">drop</code> <code class="o">=</code> <code class="nx">no</code><code class="p">;</code>

<code class="c1">// Prevent dropping an index</code>
<code class="nx">DBCollection</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">dropIndex</code> <code class="o">=</code> <code class="nx">no</code><code class="p">;</code>

<code class="c1">// Prevent dropping indexes</code>
<code class="nx">DBCollection</code><code class="p">.</code><code class="nx">prototype</code><code class="p">.</code><code class="nx">dropIndexes</code> <code class="o">=</code> <code class="nx">no</code><code class="p">;</code></pre><p>Now if you try to call any of these functions, it will simply
      print an error message. Note that this technique does not protect you
      against malicious users; it can only help with fat-fingering.</p><p>You can disable loading your <em class="filename">.mongorc.js</em> by using the
      <code class="option">--norc</code> option when starting the shell.</p></div></section><section data-type="sect2" data-pdf-bookmark="Customizing Your Prompt"><div class="sect2" id="idm45882397374520"><h2>Customizing Your Prompt</h2><p>The<a data-type="indexterm" data-primary="mongo shell" data-secondary="prompt customization" id="idm45882396930712"/> default shell prompt can be overridden by setting the
      <code class="varname">prompt</code> variable to either a string or a function. For
      example, if you are running a query that takes minutes to complete, you
      may want to have a prompt that displays the current time so you can see
      when the last operation finished:</p><pre data-type="programlisting" data-code-language="javascript"><code class="nx">prompt</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="p">(</code><code class="k">new</code> <code class="nb">Date</code><code class="p">())</code><code class="o">+</code><code class="s2">"&gt; "</code><code class="p">;</code>
<code class="p">};</code></pre><p class="pagebreak-after">Another handy prompt might show the current database you’re
      using:</p><pre data-type="programlisting" data-code-language="javascript"><code class="nx">prompt</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">db</code> <code class="o">==</code> <code class="s1">'undefined'</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">return</code> <code class="s1">'(nodb)&gt; '</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="c1">// Check the last db operation</code>
    <code class="k">try</code> <code class="p">{</code>
        <code class="nx">db</code><code class="p">.</code><code class="nx">runCommand</code><code class="p">({</code><code class="nx">getLastError</code><code class="o">:</code><code class="mi">1</code><code class="p">});</code>
    <code class="p">}</code>
    <code class="k">catch</code> <code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>
        <code class="nx">print</code><code class="p">(</code><code class="nx">e</code><code class="p">);</code>
    <code class="p">}</code>

    <code class="k">return</code> <code class="nx">db</code><code class="o">+</code><code class="s2">"&gt; "</code><code class="p">;</code>
<code class="p">};</code></pre><p>Note that prompt functions should return strings and be very
      cautious about catching exceptions: it can be extremely confusing if
      your prompt turns into an exception!</p><p>In general, your prompt function should include a call to
      <code class="function">getLastError</code>. This catches errors
      on writes and reconnects you automatically if the shell gets
      disconnected (e.g., if you restart <em class="filename">mongod</em>).</p><p>The <em class="filename">.mongorc.js</em> file is a
      good place to set your prompt if you want to always use a custom one (or
      set up a couple of custom prompts that you can switch between in the
      shell).</p></div></section><section data-type="sect2" data-pdf-bookmark="Editing Complex Variables"><div class="sect2" id="idm45882395662728"><h2>Editing Complex Variables</h2><p>The<a data-type="indexterm" data-primary="mongo shell" data-secondary="complex variable editing" id="idm45882395661816"/> multiline support in the shell is somewhat limited: you
      cannot edit previous lines, which can be annoying when you realize that
      the first line has a typo and you’re currently working on line 15. Thus,
      for larger blocks of code or objects, you may want to edit them in an
      editor. To do so, set the <code>EDITOR</code>
      variable<a data-type="indexterm" data-primary="EDITOR variable" id="idm45882395659832"/> in the shell (or in your environment, but since you’re
      already in the shell…):</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">EDITOR</code><code class="o">=</code><code class="s2">"/usr/bin/emacs"</code></pre><p>Now, if you want to edit a variable, you can say <em><code>edit
      varname</code></em>—for example:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="kd">var</code> <code class="nx">wap</code> <code class="o">=</code> <code class="nx">db</code><code class="p">.</code><code class="nx">books</code><code class="p">.</code><code class="nx">findOne</code><code class="p">({</code><code class="nx">title</code><code class="o">:</code> <code class="s2">"War and Peace"</code><code class="p">});</code>
<code class="o">&gt;</code> <code class="nx">edit</code> <code class="nx">wap</code></pre><p>When you’re done making changes, save and exit the editor. The
      variable will be parsed and loaded back into the shell.</p><p>Add
      <code>EDITOR="<em><code>/path/to/editor</code></em>";</code> to
      your <em class="filename">.mongorc.js</em> file and you won’t
      have to worry about setting it again.</p></div></section><section data-type="sect2" data-pdf-bookmark="Inconvenient Collection Names"><div class="sect2" id="sect3_d1e1496"><h2>Inconvenient Collection Names</h2><p>Fetching<a data-type="indexterm" data-primary="mongo shell" data-secondary="inconvenient collection names" id="idm45882395641400"/><a data-type="indexterm" data-primary="collections" data-secondary="dealing with inconvenient names" id="idm45882395640296"/><a data-type="indexterm" data-primary="naming" data-secondary="dealing with inconvenient collection names" id="idm45882395639224"/> a collection with the <code>db.<em><code>collectionName</code></em></code>
      syntax almost always works, unless the collection name is a reserved word
      or is an invalid JavaScript property name.</p><p>For example, suppose we are trying to access the
      <em>version</em> collection. We cannot say <code>db.version</code> because <code class="function">db.version</code> is a method on
      <code class="varname">db</code> (it returns the version of the running MongoDB
      server):</p><pre id="I_programlisting2_d1e1512" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">version</code>
<code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">serverBuildInfo</code><code class="p">().</code><code class="nx">version</code><code class="p">;</code>
<code class="p">}</code></pre><p>To actually access the <em>version</em> collection,
      you must use the<a data-type="indexterm" data-primary="getCollection function" id="idm45882395575256"/> <code class="function">getCollection</code>
      function:</p><pre id="I_programlisting2_d1e1524" data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">getCollection</code><code class="p">(</code><code class="s2">"version"</code><code class="p">);</code>
<code class="nx">test</code><code class="p">.</code><code class="nx">version</code></pre><p>This can also be used for collection names with characters that
      aren’t valid JavaScript property names, such as
      <em>foo-bar-baz</em> and <em>123abc</em>
      (JavaScript property names can only contain letters, numbers,
      <em>$</em> and <em>_</em>, and cannot start with
      a number).</p><p>Another way of getting around invalid properties is to use
      array-access syntax. In JavaScript, <code>x.y</code> is identical to <code>x['y']</code>. This means that subcollections can be
      accessed using variables, not just literal names. Thus, if you needed to
      perform some operation on every <em>blog</em> subcollection,
      you could iterate through them with something like this:</p><pre id="I_programlisting2_d1e1558" data-type="programlisting" data-code-language="javascript"><code class="kd">var</code> <code class="nx">collections</code> <code class="o">=</code> <code class="p">[</code><code class="s2">"posts"</code><code class="p">,</code> <code class="s2">"comments"</code><code class="p">,</code> <code class="s2">"authors"</code><code class="p">];</code>

<code class="k">for</code> <code class="p">(</code><code class="kd">var</code> <code class="nx">i</code> <code class="k">in</code> <code class="nx">collections</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">print</code><code class="p">(</code><code class="nx">db</code><code class="p">.</code><code class="nx">blog</code><code class="p">[</code><code class="nx">collections</code><code class="p">[</code><code class="nx">i</code><code class="p">]]);</code>
<code class="p">}</code></pre><p>instead of this:</p><pre id="I_programlisting2_d1e1562" data-type="programlisting" data-code-language="javascript"><code class="nx">print</code><code class="p">(</code><code class="nx">db</code><code class="p">.</code><code class="nx">blog</code><code class="p">.</code><code class="nx">posts</code><code class="p">);</code>
<code class="nx">print</code><code class="p">(</code><code class="nx">db</code><code class="p">.</code><code class="nx">blog</code><code class="p">.</code><code class="nx">comments</code><code class="p">);</code>
<code class="nx">print</code><code class="p">(</code><code class="nx">db</code><code class="p">.</code><code class="nx">blog</code><code class="p">.</code><code class="nx">authors</code><code class="p">);</code></pre><p>Note that you cannot do <code>db.blog.i</code>, which would be interpreted as
      <code>test.blog.i</code>, not <code>test.blog.posts</code>. You must use the <code>db.blog[i]</code> syntax for <code>i</code> to be interpreted as a variable.</p><p>You can use this technique to access awkwardly named
      collections:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="kd">var</code> <code class="nx">name</code> <code class="o">=</code> <code class="s2">"@#&amp;!"</code>
<code class="o">&gt;</code> <code class="nx">db</code><code class="p">[</code><code class="nx">name</code><code class="p">].</code><code class="nx">find</code><code class="p">()</code></pre><p>Attempting to query <code>db.@#&amp;!</code>
      would be illegal, but <code>db[name]</code>
      would<a data-type="indexterm" data-startref="MDBuse02" id="idm45882395399848"/>
      work.</p></div></section></div></section></div></section></div>



  </body></html>