<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 21. Troubleshooting Networks"><div class="chapter" id="troubleshooting_networks">
<h1><span class="label">Chapter 21. </span>Troubleshooting Networks</h1>


<p>Figuring out networking problems is just like any troubleshooting. Know your
network, know how to use basic tools well, and be patient and systematic.</p>

<p>In this chapter we learn how to use <em>ping</em>, FPing, Nmap, <em>httping</em>,
<em>arping</em>, and <em>mtr</em> to test connectivity, map networks, find rogue services,
test website performance, find duplicate IP addresses, and find routing
bottlenecks.</p>






<section data-type="sect1" class="orm:non-recipe" data-pdf-bookmark="Diagnostic Hardware"><div class="sect1" id="idm46466153011736">
<h1>Diagnostic Hardware</h1>

<p>If <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="diagnostic hardware" id="idm46466153009896"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="diagnostic hardware" id="idm46466153008520"/><a data-type="indexterm" data-primary="hardware" data-secondary="diagnostic hardware for network components" id="idm46466153007432"/>you find yourself stuck with mysterious unlabeled Ethernet and phone
cabling, get yourself an <a data-type="indexterm" data-primary="Ethernet/telephone cable test and tone trackers" id="idm46466153004136"/>Ethernet/telephone cable test and tone tracker. There
are many that cost under $100. These come in two pieces: one emitter and one
receiver. This goes fast with two people, one at each end of a cable. When you
find both ends of a cable, label it and move on. You can do it alone, but it is
faster with two people.</p>

<p>Multimeters are <a data-type="indexterm" data-primary="multimeters" id="idm46466153005288"/>useful for a lot of jobs, such as finding shorts and opens,
testing for continuity and attenuation, determining whether a wire is
terminated correctly, 
<span class="keep-together">testing</span> electric outlets, and testing computer power
supplies and motherboards. 
<span class="keep-together"><a href="https://adafruit.com">Adafruit</a></span> is a great
site to find excellent tutorials on using a multimeter and learning 
<span class="keep-together">electronics</span>.</p>

<p>Keep a few spare parts, if you can. Sometimes it is faster to swap out a network
interface, cable, or switch to find a defective piece of hardware.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="21.1 Testing Connectivity with ping"><div class="sect1" id="idm46466153003320">
<h1>21.1 Testing Connectivity with ping</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466152998872">
<h2>Problem</h2>

<p>Some <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="connectivity tests" id="troubleshoot-network-connectivity"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="connectivity tests" id="network-troubleshoot-connectivity"/><a data-type="indexterm" data-primary="connectivity testing" data-secondary="with ping" data-secondary-sortas="ping" id="connectivity-test"/><a data-type="indexterm" data-primary="ping command" id="ping"/>services or hosts on your network are not accessible or have intermittent
failures. You want to figure out if it is a hardware problem, a problem with name services, routing, or something else.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466152991320">
<h2>Solution</h2>

<p>When you are debugging network problems, start close, and systematically work from
closer to farther. This means physical distance and how many routers there are
to cross. Start within your local LAN segment. Then proceed to your next LAN
segment, if you have more than one, crossing a single router. Then to the next
one two routers away, and so on.</p>

<p>Start with good old <em>ping</em> to test connectivity. First, ping <em>localhost</em>:</p>
<pre>$ <strong>ping localhost</strong>
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.065 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.035 ms</pre>

<p>Stop <em>ping</em> by pressing Ctrl-C. Pinging <em>localhost</em> first confirms that your
network interface is up and operating. If you see
“connect: Network is unreachable,” there is a problem with your network interface.
Keep some spare USB network interfaces on hand to quickly learn if you have a
defective interface.</p>

<p>Once you have your network interface sorted, ping your hostname to test name
resolution, and tell <em>ping</em> to stop after three pings:</p>
<pre>$ <strong>ping -c 3 <i>client4</i></strong>
PING client4 (192.168.1.97) 56(84) bytes of data.
64 bytes from client4 (192.168.1.97): icmp_seq=1 ttl=64 time=0.087 ms
64 bytes from client4 (192.168.1.97): icmp_seq=2 ttl=64 time=0.059 ms
64 bytes from client4 (192.168.1.97): icmp_seq=3 ttl=64 time=0.061 ms

--- client4 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2046ms
rtt min/avg/max/mdev = 0.059/0.069/0.087/0.012 ms</pre>

<p>If it returns the correct IP address, your name resolution is set up correctly.
If it returns a localhost address, like 127.0.1.1, or “Name or service not known,”
something is haywire with your DNS configuration.</p>

<p>When your local DNS is fixed, ping one of your network hosts by hostname.
If <em>ping</em> fails with “Destination Host Unreachable” try pinging its IP address.
If that succeeds, check your DNS. If that fails with the same message, your
hostname and address are incorrect, or the host is down.</p>

<p>If you cannot reach any external IP addresses, your network interface is probably
healthy and the problem is upstream: your Ethernet cable, wireless access point,

<span class="keep-together">or switch.</span> “Network is unreachable” means your machine is not connected to the

<span class="keep-together">network</span>.</p>

<p>When you’re hunting down the source of intermittent outages, set <em>ping</em> to run
for a length of time, like 500 pings, spaced 2 seconds apart, so you don’t overwhelm
the host or your network, and output the results to a text file. The following
example appends added information to the file, so you can stop and restart:</p>
<pre>$ <strong>ping -c 500 -i 2 <i>server2</i> &gt;&gt; server2-ping.txt</strong></pre>

<p>Or, use <em>tee</em> to see the output and record it in a file:</p>
<pre>$ <strong>ping -c 500 -i 2 <i>server2</i> | tee server2-ping.txt</strong></pre>

<p>On a multihomed host, use <em>ping -i interface-name</em> to specify which interface to use.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466152972856">
<h2>Discussion</h2>

<p>Don’t block <em>echo-request</em>, <em>echo-reply</em>, <em>time-exceeded</em>, or
<em>destination-unreachable</em> ping messages. Some admins block all ping messages
at their firewalls, and this is a mistake because many network functions require
at least these four ping messages to operate correctly.</p>

<p>The <em>ping</em> command <a data-type="indexterm" data-primary="beep speakers" id="beep"/>actually pings if you use the <em>-a</em> (audible) switch, though
you will probably have to do a bit of setup to make it work. In olden times we
had PC speakers built into computer cases, connected directly to the motherboard,
and the kernel module that activated the case speaker automatically loaded at boot.
You are probably familiar with the low-fi annoyings beeps emitted from this
speaker, and perhaps you even ran some hacks to make it play music.</p>

<p>Now, in these here modern times, case speakers are mostly gone, and laptops mostly
do not have a motherboard beep anymore. But most PC motherboards still support
them, and the modern beep speaker is a little thing (<a data-type="xref" href="#fig-net-trouble-1">Figure 21-1</a>).
You will probably have to buy one.</p>

<figure class="width-25"><div id="fig-net-trouble-1" class="figure">
<img src="Images/lcb2_2101.png" alt="Beep speaker for computer motherboard." width="376" height="368"/>
<h6><span class="label">Figure 21-1. </span>Beep speaker for computer motherboard</h6>
</div></figure>

<p>Once you have your beep speaker, load the <em>pcspkr</em> kernel module, then confirm
it is loaded:</p>
<pre>$ <strong>sudo modprobe pcspkr</strong>
$ <strong>lsmod|grep pcspkr</strong>
pcspkr                 16384  0</pre>

<p>Now try it out. Drop to a plain console with Ctrl-Alt-F2, or fire up an X terminal,
and use the <em>echo</em> command to play the ASCII bell character. All examples are the
same thing, different representations of the ASCII character code 7:</p>
<pre>$ <strong>echo -e "\a"</strong>
$ <strong>tput bel</strong>
$ <strong>echo -e '\007'</strong></pre>

<p>Or press Ctrl-G.</p>

<p>If you hear nothing in your graphical terminal, check its settings to enable
sounds. <em>xfce4-terminal</em> and <em>gnome-terminal</em> both play the ASCII bell.
<em>Konsole</em> supports using your choice of sound files for notifications, but it does
not support the beep <a data-type="indexterm" data-primary="beep speakers" data-startref="beep" id="idm46466152953384"/><a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="connectivity tests" data-startref="troubleshoot-network-connectivity" id="idm46466152952872"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="connectivity tests" data-startref="network-troubleshoot-connectivity" id="idm46466152952104"/><a data-type="indexterm" data-primary="connectivity testing" data-secondary="with ping" data-secondary-sortas="ping" data-startref="connectivity-test" id="idm46466152951336"/><a data-type="indexterm" data-primary="ping command" data-startref="ping" id="idm46466152950152"/>speaker.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466152972312">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 ping</em></p>
</li>
<li>
<p><a href="https://oreil.ly/pWYWE">IANA list of ICMP parameters</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="21.2 Profiling Your Network with fping and nmap"><div class="sect1" id="rec-profile">
<h1>21.2 Profiling Your Network with fping and nmap</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466152943608">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="port scanning" id="troubleshoot-network-portscan"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="port scanning" id="network-troubleshoot-portscan"/><a data-type="indexterm" data-primary="port scanning" id="portscan-network"/><a data-type="indexterm" data-primary="nmap command" id="nmap-portscan"/> want to generate a list of all hosts and IP addresses on your network and
probe for MAC addresses and open ports.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466152936648">
<h2>Solution</h2>

<p>Use <em>fping</em> and <em>nmap</em> to probe your LAN, and record the results.</p>

<p><em>fping</em> pings <a data-type="indexterm" data-primary="fping command" id="idm46466152932920"/>all the addresses in a range in sequence. This example pings a
subnet once, reports which hosts are alive, queries DNS for the hostnames, and
prints a 
<span class="keep-together">summary</span>:</p>
<pre>$ <strong>fping -c1 -gAds 192.168.1.0/24 2&gt;1 | egrep -v "ICMP|xmt" &gt;&gt; <i>fping.txt</i></strong>
client1.net (192.168.1.15)     : [0], 84 bytes, 3.12 ms (3.12 avg, 0% loss)
server2.net (192.168.1.91)     : [0], 84 bytes, 5.34 ms (5.34 avg, 0% loss)
client4.net (192.168.1.97)     : [0], 84 bytes, 0.03 ms (0.03 avg, 0% loss)

     254 targets
       3 alive
     251 unreachable
       0 unknown addresses

     251 timeouts (waiting for response)

 0.03 ms (min round trip time)
 2.83 ms (avg round trip time)
 5.34 ms (max round trip time)
        3.575 sec (elapsed real time)</pre>

<p>To see the unfiltered output, omit the <em>2&gt;1 | egrep -v “ICMP|xmt”</em> part. Any offline machines will not be found, so you could run
this at different times to try to capture everything. <em>&gt;&gt; fping.txt</em> appends
the new results for each run.</p>

<p>This <em>nmap</em> example performs a similar task, with less verbose output:</p>
<pre>$ <strong>sudo nmap -sn 192.168.1.0/24 &gt; <i>nmap.txt</i></strong>
Starting Nmap 7.70 ( https://nmap.org ) at 2021-03-31 18:30 PDT
Nmap scan report for client1.net (192.168.1.15)
Host is up (0.0052s latency).
MAC Address: 44:A5:6E:D7:8F:B9 (Unknown)
Nmap scan report for BRW7440BBC7CA75.net (192.168.1.39)
Host is up (1.0s latency).
MAC Address: 74:40:BB:C7:CA:75 (Unknown)
Nmap scan report for client4.net (192.168.1.97)
Host is up (0.47s latency).
MAC Address: 9C:EF:D5:FE:8F:20 (Panda Wireless)
Nmap scan report for server2.net (192.168.1.91)
Host is up.
Nmap done: 256 IP addresses (6 hosts up) scanned in 15.19 seconds</pre>

<p>That is a rather indigestible lump, so insert a newline before each host and
store the output in a new file:</p>
<pre>$ <strong>awk '/Nmap/{print ""}1' <i>nmap.txt</i> &gt; <i>nmap2.txt</i></strong></pre>

<p>Now you have nice groupings:</p>
<pre>Nmap scan report for client1.net (192.168.1.15)
Host is up (0.0052s latency).
MAC Address: 44:A5:6E:D7:8F:B9 (Unknown)

Nmap scan report for BRW7440BBC7CA75.net (192.168.1.39)
Host is up (1.0s latency).
MAC Address: 74:40:BB:C7:CA:75 (Unknown)

Nmap scan report for client4.net (192.168.1.97)
Host is up (0.47s latency).
MAC Address: 9C:EF:D5:FE:8F:20 (Panda Wireless)

Nmap scan report for server2.net (192.168.1.91)
Host is up.

Nmap done: 256 IP addresses (6 hosts up) scanned in 15.19 seconds</pre>

<p>Probe the hosts on your network for open ports:</p>
<pre>$ <strong>sudo nmap -sS  <i>192.168.1.*</i></strong>
Starting Nmap 7.70 ( https://nmap.org ) at 2021-03-31 19:36 PDT
Nmap scan report for client2.net (192.168.1.15)
Host is up (0.027s latency).
Not shown: 997 closed ports
PORT     STATE    SERVICE
53/tcp   open     domain
80/tcp   open     http
MAC Address: 44:A5:6E:D7:8F:B9 (Unknown)

Nmap scan report for 192.168.1.39
Host is up (0.074s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE
25/tcp   open  smtp
80/tcp   open  http
443/tcp  open  https
515/tcp  open  printer
631/tcp  open  ipp
9100/tcp open  jetdirect
MAC Address: 74:40:BB:C7:CA:75 (Unknown)
[...]</pre>

<p>client2.net is running a DNS and web server. You can run the same probe from
outside your firewall to see if they are visible outside of your network.</p>

<p>The second entry is interesting because it is a network printer running a whole
mob of services. The printer documentation says they all have a purpose.
The printer supports remote administration through a web control panel, so they
could be disabled, if necessary.</p>

<p>Collect a list of hosts and their IP addresses:</p>
<pre>$ <strong>nmap -sn 192.168.43.0/24 | grep 'Nmap scan report for' |cut -d' ' -f5,6</strong>
server2 (192.168.43.15)
dns-server (192.168.43.74)
client4 (192.168.43.14)</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466152936072">
<h2>Discussion</h2>

<p><em>nmap</em> has numerous options for probing networks. Do not probe other people’s
networks without permission because it could be seen as a hostile act, probing
for vulnerabilities.</p>

<p>Running a port scan takes some time, but it is a good idea to do this regularly
to see what is happening on your network. It is basic security to run only
necessary services and to disable everything <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="port scanning" data-startref="troubleshoot-network-portscan" id="idm46466152914024"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="port scanning" data-startref="network-troubleshoot-portscan" id="idm46466152915592"/><a data-type="indexterm" data-primary="port scanning" data-startref="portscan-network" id="idm46466152913016"/><a data-type="indexterm" data-primary="nmap command" data-startref="nmap-portscan" id="idm46466152910632"/>else.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466152909288">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 nmap</em></p>
</li>
<li>
<p><a href="https://nmap.org"><em class="hyperlink">https://nmap.org</em></a></p>
</li>
<li>
<p><em>man 8 fping</em></p>
</li>
<li>
<p><a href="https://fping.org"><em class="hyperlink">https://fping.org</em></a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="21.3 Finding Duplicate IP Addresses with arping"><div class="sect1" id="idm46466152902104">
<h1>21.3 Finding Duplicate IP Addresses with arping</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466152901208">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="duplicate IP addresses" id="troubleshoot-network-ip-duplicate"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="duplicate IP addresses" id="network-troubleshoot-ip-duplicate"/><a data-type="indexterm" data-primary="duplicate IP addresses, finding" id="duplicate-find"/><a data-type="indexterm" data-primary="finding" data-secondary="duplicate IP addresses" id="find-ip-duplicate"/><a data-type="indexterm" data-primary="IP addresses" data-secondary="finding duplicate" id="ip-duplicate"/><a data-type="indexterm" data-primary="arping command" id="arping"/>want to search your network for duplicate IP addresses.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466152891736">
<h2>Solution</h2>

<p>This example searches your network for 192.168.1.91 and sends four pings:</p>
<pre>$ <strong>sudo arping -I wlan2 -c 4 192.168.1.91</strong>
ARPING 192.168.1.91
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=0 time=49.463 msec
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=1 time=458.306 msec
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=2 time=73.938 msec
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=3 time=504.482 msec

--- 192.168.1.91 statistics ---
4 packets transmitted, 4 packets received,   0% unanswered (0 extra)
rtt min/avg/max/std-dev = 49.463/271.547/504.482/210.659 ms</pre>

<p>All of the MAC addresses are the same, so it found no duplicates. This is an
example of <em>arping</em> finding duplicate IP addresses:</p>
<pre>$ <strong>sudo arping -I wlan2 -c 4 192.168.1.91</strong>
ARPING 192.168.1.91
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=0 time=49.463 msec
42 bytes from 2F:EF:D5:FE:8F:20 (192.168.1.91): index=1 time=458.306 msec
42 bytes from 9c:ef:d5:fe:01:7c (192.168.1.91): index=2 time=73.938 msec
42 bytes from 2F:EF:D5:FE:8F:20 (192.168.1.91): index=3 time=504.482 msec
[...]

--- 192.168.1.91 statistics ---
4 packets transmitted, 4 packets received,   0% unanswered (0 extra)
rtt min/avg/max/std-dev = 49.463/271.547/504.482/210.659 ms</pre>

<p>Use <em>nmap</em> to identify the two machines with the same IP address:</p>
<pre>$ <strong>nmap -sn <i>192.168.43.0/24</i> | grep 'Nmap scan report for' |cut -d' ' -f5,6</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466152884168">
<h2>Discussion</h2>

<p><em>arp</em> is the<a data-type="indexterm" data-primary="Address Resolution Protocol (ARP)" id="idm46466152882632"/><a data-type="indexterm" data-primary="ARP (Address Resolution Protocol)" id="idm46466152882024"/> Address Resolution Protocol, matching IP addresses to MAC addresses.</p>

<p>An advantage of using DHCP to dynamically assign IP addresses is less risk of
creating duplicates than setting static IP addresses manually. You can assign
static addresses with DHCP; see <a data-type="xref" href="ch16.xhtml#cha-dns-dhcp">Chapter 16</a>.</p>

<p><em>arping</em> is useful to see if a host is up when <em>ping</em> does not find it.
Some folks like to block <em>ping</em>, which is not a good thing to do because it is
essential to network functionality. <em>arping</em> cannot be blocked without disabling
the ability for network hosts to communicate with each other. <em>arp</em>, the
Address Resolution Protocol, maintains a table of MAC addresses. When a network
host sends a packet to another host, <em>arp</em> matches the IP address to the MAC
address, and then the packet can be delivered.</p>

<p>You can see what it looks like when <em>arp</em> probes your network to update its
address table, with a packet sniffer<a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="duplicate IP addresses" data-startref="troubleshoot-network-ip-duplicate" id="idm46466152874152"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="duplicate IP addresses" data-startref="network-troubleshoot-ip-duplicate" id="idm46466152872824"/><a data-type="indexterm" data-primary="duplicate IP addresses, finding" data-startref="duplicate-find" id="idm46466152871496"/><a data-type="indexterm" data-primary="finding" data-secondary="duplicate IP addresses" data-startref="find-ip-duplicate" id="idm46466152870648"/><a data-type="indexterm" data-primary="IP addresses" data-secondary="finding duplicate" data-startref="ip-duplicate" id="idm46466152869560"/><a data-type="indexterm" data-primary="arping command" data-startref="arping" id="idm46466152868248"/> like <em>tcpdump</em>:</p>
<pre>$ <strong>sudo tcpdump -pi eth1 arp</strong>
listening on eth1, link-type EN1000MB (Ethernet), capture size 262144 bytes
21:19:36.921293 ARP, Request who-has client4.net tell m1login.net, length 28
21:19:36.921309 ARP, Reply client4.net is-at 9c:ef:d5:fe:8f:20</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466152865480">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch16.xhtml#cha-dns-dhcp">Chapter 16</a></p>
</li>
<li>
<p><em>man 8 arping</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="21.4 Testing HTTP Throughput and Latency with httping"><div class="sect1" id="idm46466152861416">
<h1>21.4 Testing HTTP Throughput and Latency with httping</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466152860552">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="HTTP throughput and latency testing" id="troubleshoot-network-http"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="HTTP throughput and latency testing" id="network-troubleshoot-http"/><a data-type="indexterm" data-primary="HTTP throughput and latency testing" id="http-test"/><a data-type="indexterm" data-primary="testing" data-secondary="HTTP throughput and latency" id="test-http"/><a data-type="indexterm" data-primary="throughput, testing" id="throughput-test"/><a data-type="indexterm" data-primary="latency, testing" id="latency-test"/><a data-type="indexterm" data-primary="httping command" id="httping"/><a data-type="indexterm" data-primary="website performance testing" id="website-performance"/>want to test a website that you host to see if it loads in a reasonable
length of time.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466152849352">
<h2>Solution</h2>

<p><em>httping</em> measures HTTP server throughput and latency. Its simplest invocation
tests latency:</p>
<pre>$ <strong>httping -c4 -l -g www.oreilly.com</strong>
PING www.oreilly.com:443 (/):
connected to 184.86.29.153:443 (453 bytes), seq=0 time=292.25 ms
connected to 184.86.29.153:443 (453 bytes), seq=1 time=726.35 ms
connected to 184.86.29.153:443 (452 bytes), seq=2 time=629.11 ms
connected to 184.86.29.153:443 (453 bytes), seq=3 time=529.95 ms
--- https://www.oreilly.com/ ping statistics ---
4 connects, 4 ok, 0.00% failed, time 6179ms
round-trip min/avg/max = 292.2/544.4/726.3 ms</pre>

<p>This doesn’t tell you how long it takes pages to load, only how
long it takes the server, in milliseconds, to respond to a HEAD request, which
fetches only the page headers without the content. A GET (<em>-G</em>) request fetches
the whole page:</p>
<pre>$ <strong>httping -c4 -l -Gg www.oreilly.com</strong>
PING www.oreilly.com:443 (/):
connected to 104.112.183.230:443 (453 bytes), seq=0 time=2125.72 ms
connected to 104.112.183.230:443 (453 bytes), seq=1 time=701.94 ms
connected to 104.112.183.230:443 (453 bytes), seq=2 time=470.66 ms
connected to 104.112.183.230:443 (453 bytes), seq=3 time=433.11 ms
--- https://www.oreilly.com/ ping statistics ---
4 connects, 4 ok, 0.00% failed, time 7733ms
round-trip min/avg/max = 433.1/932.9/2125.7 ms</pre>

<p>Add the <em>-r</em> switch to minimize DNS latency by resolving the hostname just once:</p>
<pre>$ <strong>httping -c4 -l -rGg www.oreilly.com</strong>
PING www.oreilly.com:443 (/):
connected to 23.10.2.218:443 (452 bytes), seq=0 time=961.29 ms
connected to 23.10.2.218:443 (452 bytes), seq=1 time=1091.16 ms
connected to 23.10.2.218:443 (452 bytes), seq=2 time=925.46 ms
connected to 23.10.2.218:443 (452 bytes), seq=3 time=913.26 ms
--- https://www.oreilly.com/ ping statistics ---
4 connects, 4 ok, 0.00% failed, time 7894ms
round-trip min/avg/max = 913.3/972.8/1091.2 ms</pre>

<p>If minimizing DNS latency makes a large difference, then you need to take a look
at your nameservers.</p>

<p>Test an alternate port, such as 8080, by appending it to the URL:</p>
<pre>$ <strong>httping -c4 -l -rGg www.oreilly.com:8080</strong></pre>

<p>Use the <em>-s</em> switch to display return codes, such as 200 OK, which indicates
a successful page load:</p>
<pre>$ <strong>httping -c4 -l -srGg www.oreilly.com</strong>
PING www.oreilly.com:443 (/):
connected to 23.10.2.218:443 (452 bytes), seq=0 time=920.88 ms 200 OK
connected to 23.10.2.218:443 (452 bytes), seq=1 time=857.60 ms 200 OK
connected to 23.10.2.218:443 (452 bytes), seq=2 time=1246.69 ms 200 OK
connected to 23.10.2.218:443 (452 bytes), seq=3 time=1134.91 ms 200 OK
--- https://www.oreilly.com/ ping statistics ---
4 connects, 4 ok, 0.00% failed, time 8249ms
round-trip min/avg/max = 857.6/1040.0/1246.7 ms</pre>
</div></section>













<section data-type="sect2" class="pagebreak-before less_space" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466152848552">
<h2>Discussion</h2>

<p>Run multiple tests at different times of day to gather data that is representative
of what your users are experiencing.</p>

<p><em>httping</em> is not a super-sophisticated tester that digs deeply into your site
to identify bottlenecks. It is a quick, simple tool to give you an idea of your
overall site performance, and to tell you if you need to dig deeper to diagnose
performance <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="HTTP throughput and latency testing" data-startref="troubleshoot-network-http" id="idm46466152835768"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="HTTP throughput and latency testing" data-startref="network-troubleshoot-http" id="idm46466152833624"/><a data-type="indexterm" data-primary="HTTP throughput and latency testing" data-startref="http-test" id="idm46466152832296"/><a data-type="indexterm" data-primary="testing" data-secondary="HTTP throughput and latency" data-startref="test-http" id="idm46466152831416"/><a data-type="indexterm" data-primary="throughput, testing" data-startref="throughput-test" id="idm46466152829816"/><a data-type="indexterm" data-primary="latency, testing" data-startref="latency-test" id="idm46466152828872"/><a data-type="indexterm" data-primary="httping command" data-startref="httping" id="idm46466152827864"/><a data-type="indexterm" data-primary="website performance testing" data-startref="website-performance" id="idm46466152826792"/>problems.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466152824984">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/pMvFV">HTTP return codes</a></p>
</li>
<li>
<p><em>man 1 httping</em></p>
</li>
<li>
<p><a href="https://oreil.ly/2ts3n">httping</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="21.5 Using mtr to Find Troublesome Routers"><div class="sect1" id="idm46466152819640">
<h1>21.5 Using mtr to Find Troublesome Routers</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466152818744">
<h2>Problem</h2>

<p>There<a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="packet tracing" id="troubleshoot-network-packettrace"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="packet tracing" id="network-troubleshoot-packettrace"/><a data-type="indexterm" data-primary="packet tracing" id="packettrace"/><a data-type="indexterm" data-primary="routers, packet tracing" id="router-packettrace"/><a data-type="indexterm" data-primary="mtr command" id="mtr"/> is a site you are trying to access, and it is very slow or unreachable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466152811080">
<h2>Solution</h2>

<p>Use <em>mtr</em> (My Traceroute) to see where your packets are going astray. This works
better on networks that you control, because the internet is vast and routes
change, but when you are having trouble reaching a site it will provide useful
information.</p>

<p>Let’s see what wandering path takes us to <em>carlaschroder.com</em>:</p>
<pre>$ <strong>mtr -wo LSRABW carlaschroder.com</strong>
Start: 2021-03-31T09:54:17-0700
HOST: client4                               Loss%   Snt   Rcv   Avg  Best  Wrst
  1.|-- m1login.net                            0.0%    10    10  55.5   1.2 199.6
  2.|-- 172.26.96.169                          0.0%    10    10  92.3  29.0 243.6
  3.|-- 172.18.84.60                           0.0%    10    10  84.5  29.3 220.3
  4.|-- 12.249.2.25                            0.0%    10    10  80.7  36.4 215.5
  5.|-- 12.122.146.97                          0.0%    10    10  65.6  34.8 156.6
  6.|-- 12.122.111.33                          0.0%    10    10  49.3  35.5  97.6
  7.|-- cr2.st6wa.ip.att.net                   0.0%    10    10  46.7  35.9  64.0
  8.|-- 12.122.111.109                         0.0%    10    10  57.9  31.4 215.4
  9.|-- 12.122.111.81                          0.0%    10    10  72.3  27.6 231.4
 10.|-- 12.249.133.242                         0.0%    10    10 101.2  31.7 263.1
 11.|-- ae6.cbs01.wb01.sea02.networklayer.com  0.0%    10    10  93.7  31.6 202.7
 12.|-- fc.11.6132.ip4.static.sl-reverse.com   0.0%    10    10 106.0  86.1 171.2
 13.|-- ae1.cbs02.eq01.dal03.networklayer.com 60.0%    10     4 102.0  86.5 115.8
 14.|-- ae0.dar01.dal13.networklayer.com       0.0%    10    10 103.7  80.3 230.8
 15.|-- 85.76.30a9.ip4.static.sl-reverse.com   0.0%    10    10 114.8  82.8 305.7
 16.|-- a1.76.30a9.ip4.static.sl-reverse.com   0.0%    10    10 122.7  83.7 278.4
 17.|-- hs17.name.tools                        0.0%    10    10 145.9  74.9 277.2
</pre>

<p>m1login.net is my network’s internet gateway router. After that it is all the wild
internet. Hop 13 could be a chokepoint, with 60% packet loss. Hop 13 could be part
of a load-balancing cluster; note that hop 11 and hop 14 have the same domain name.
If it is part of a cluster then the packet loss is not significant.</p>

<p>Ping the last hop, hs17.name.tools. The following example looks like everything is working fine:</p>
<pre>$ <strong>ping -c 3 hs17.name.tools</strong>
PING hs17.name.tools (169.61.1.230) 56(84) bytes of data.
64 bytes from hs17.name.tools (169.61.1.230): icmp_seq=1 ttl=46 time=319 ms
64 bytes from hs17.name.tools (169.61.1.230): icmp_seq=2 ttl=46 time=168 ms
64 bytes from hs17.name.tools (169.61.1.230): icmp_seq=3 ttl=46 time=166 ms
[...]</pre>

<p>If <em>mtr</em> reveals a problem, use <em>whois</em> to look up <a data-type="indexterm" data-primary="whois command" id="idm46466152803352"/>the domain owner and their
contact information:</p>
<pre>$ <strong>whois -H networklayer.com</strong></pre>

<p><em>whois</em> also works for IP addresses. The <em>-H</em> switch disables the annoying legalese.</p>

<p>Capture <em>mtr</em> output in a file, with the date and time at the end of each entry:</p>
<pre>$ <strong>mtr -r -c25 oreilly.com &gt;&gt; mtr.txt &amp;&amp; date &gt;&gt; mtr.txt</strong></pre>

<p>Collect data over time by creating a cron job (<a data-type="xref" href="ch03.xhtml#rec-scheduled-shutdowns-cron">Recipe 3.7</a>)
to run the preceding <em>mtr</em> once per hour, and let it run for a day or two. Don’t
forget to turn it off.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466152795944">
<h2>Discussion</h2>

<p><em>mtr -wo LSRABW</em> limits the number of columns to make the example fit better on
this page. <em>mtr -w</em> is wide format for reports.</p>

<p>Save your records in case you need to report a problem; the <em>whois</em> examples
show how to find who to contact.</p>

<p><em>mtr</em> generates a lot of traffic, so take care to not run it too <a data-type="indexterm" data-primary="troubleshooting" data-secondary="networks" data-tertiary="packet tracing" data-startref="troubleshoot-network-packettrace" id="idm46466152790104"/><a data-type="indexterm" data-primary="networking" data-secondary="troubleshooting" data-tertiary="packet tracing" data-startref="network-troubleshoot-packettrace" id="idm46466152788776"/><a data-type="indexterm" data-primary="packet tracing" data-startref="packettrace" id="idm46466152787448"/><a data-type="indexterm" data-primary="routers, packet tracing" data-startref="router-packettrace" id="idm46466152786600"/><a data-type="indexterm" data-primary="mtr command" data-startref="mtr" id="idm46466152785720"/>frequently.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466152784424">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 mtr</em></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>