<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 9. Monitoring Your System" data-type="chapter" epub:type="chapter"><div class="chapter" id="monitoring_your_system">
<h1><span class="label">Chapter 9. </span>Monitoring Your System</h1>
<p>Monitoring is not optional. It’s essential. Every system administrator must monitor their system’s performance, health, and security with a vigilant eye.<a contenteditable="false" data-primary="monitoring your system" data-type="indexterm" id="ix_monsys"/> It’s impossible to manually monitor your systems and also perform your other administrative tasks, so you must rely on automated software, specific system configurations, and a reporting system to update you on each system’s status.</p>
<p>This chapter explores native monitoring tools and guides you in gathering performance and health statistics for your systems. </p>
<section data-pdf-bookmark="Maintaining Vigilance on CPU, Memory, and Disk Performance and Capacity" data-type="sect1"><div class="sect1" id="maintaining_vigilance_on_cpucomma_memor">
<h1>Maintaining Vigilance on CPU, Memory, and Disk <span class="breakbefore">Performance and Capacity</span></h1>
<p>The three primary monitoring<a contenteditable="false" data-primary="monitoring your system" data-secondary="CPU, memory, and disk performance and capacity" data-type="indexterm" id="ix_monsysCPUmemdsk"/> focal points in Linux systems are CPU, memory, and disk performance.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Network capacity on local area networks (LANs) isn’t usually much of an issue, especially with gigabit network speeds.<a contenteditable="false" data-primary="networks" data-secondary="checking network performance" data-type="indexterm" id="idm45657873056096"/> Many data centers/server rooms use 10-gigabit connections so that system-to-system communications are practically instantaneous and backups, even huge ones, are of no consequence. That said, checking network performance will only require a few minutes of your day, so why not include it? The data exists and is freely available to you, so display it, study it, and act on it if you see a negative trend.</p>
</div>
<p>This chapter focuses on CPU, memory, and disk performance and capacity.</p>
<section data-pdf-bookmark="Tracking CPU Usage" data-type="sect2"><div class="sect2" id="tracking_cpu_usage">
<h2>Tracking CPU Usage</h2>
<p>The CPU is often at the top of the list of system components to monitor. It’s at the top of the list because it’s the system’s powerhouse.<a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-type="indexterm" id="ix_CPUtrk"/> Suppose your system’s CPU continuously operates above 80% utilization. In that case, it’s possible that your system doesn’t have enough CPU to power the operating system and all of a host’s running applications. It’s also conceivable that an application coding problem or security breach issue sends your CPU’s utilization into the “red” zone.</p>
<p>There are numerous tools available to help you monitor and assess CPU utilization. The simplest and most readily available are <code>top</code> and <code>ps</code>. These commands are part of the standard build on every Linux distribution.</p>
<section data-pdf-bookmark="The top commands" data-type="sect3"><div class="sect3" id="the_top_commands">
<h3>The top commands</h3>
<p>As a system administrator, you’ve possibly encountered <code>top</code> or one of its related commands, such as <code>atop</code> or <code>htop</code>. <a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-tertiary="top commands" data-type="indexterm" id="ix_CPUtrktop"/><a contenteditable="false" data-primary="top commands" data-type="indexterm" id="ix_top"/>The <code>top</code> utility is standard on most Linux distributions, but you’ll have to install <code>atop</code> and <code>htop</code> packages from your distribution’s repositories. The <code>top</code> commands give you a real-time view of your system’s “top” processes. By default, <code>top</code> lists those that consume the most CPU at the top of the view.</p>
<section data-pdf-bookmark="top" data-type="sect4"><div class="sect4" id="top">
<h4>top</h4>
<p>All users may issue the <code>top</code> command and change<a contenteditable="false" data-primary="top commands" data-secondary="top" data-type="indexterm" id="ix_toptop"/> sorting options from CPU (default) to memory, time, and PID, as shown in <a data-type="xref" href="#the_top_command_sorted_by_percent_cpu">Figure 9-1</a>.</p>
<figure><div class="figure" id="the_top_command_sorted_by_percent_cpu"><img alt="" height="379" src="assets/plsa_0901.png" width="600"/>
<h6><span class="label">Figure 9-1. </span>The top command sorted by % CPU</h6>
</div></figure>
<p class="pagebreak-before">Use Shift + M to switch to memory<a contenteditable="false" data-primary="memory" data-secondary="tracking memory usage" data-tertiary="top command" data-type="indexterm" id="idm45657873025056"/> usage mode, as shown in <a data-type="xref" href="#the_top_command_is_sorted_by_memory_con">Figure 9-2</a>.</p>
<figure><div class="figure" id="the_top_command_is_sorted_by_memory_con"><img alt="" height="379" src="assets/plsa_0902.png" width="600"/>
<h6><span class="label">Figure 9-2. </span>The top command is sorted by Memory consumption usage</h6>
</div></figure>
<p>To see how long your processes have run, use Shift + S to sort by time, as shown in <a data-type="xref" href="#top_processes_sorted_by_time">Figure 9-3</a>.</p>
<figure class="pagebreak-after"><div class="figure" id="top_processes_sorted_by_time"><img alt="" height="379" src="assets/plsa_0903.png" width="600"/>
<h6><span class="label">Figure 9-3. </span>Top processes sorted by time</h6>
</div></figure>
<p><a data-type="xref" href="#keyboard_shortcuts_for_some_sorting_opt">Table 9-1</a> provides you with a few keyboard shortcuts to <code>top</code>’s sorting options.</p>
<table class="border" id="keyboard_shortcuts_for_some_sorting_opt">
<caption><span class="label">Table 9-1. </span>Keyboard shortcuts for some sorting options</caption>
<thead>
<tr>
<th>Key</th>
<th>Sorting</th>
</tr>
</thead>
<tbody>
<tr>
<td>Shift + M</td>
<td><code>%MEM</code> (memory usage)</td>
</tr>
<tr>
<td>Shift + P</td>
<td><code>%CPU</code> (CPU usage—the default)</td>
</tr>
<tr>
<td>Shift + S</td>
<td><code>TIME</code> (running time)</td>
</tr>
</tbody>
</table>
<p>From a cursory glance at <code>top</code>’s output, you might find it difficult to know which value is in focus. So it’s often necessary to use one of the keyboard shortcuts to apply a known sorting scheme to reset your view. If I forget which sorting scheme I’m running, I cycle through CPU, memory, and time to check.</p>
<p>The standard <code>top</code> command is useful, but for many sysadmins, the displayed information isn’t sufficient for informed decision-making. The <code>atop</code> and <code>htop</code> commands, not installed by default on most distributions, provide you with a broader view of what’s happening.<a contenteditable="false" data-primary="top commands" data-secondary="top" data-startref="ix_toptop" data-type="indexterm" id="idm45657872999840"/></p>
</div></section>
<section data-pdf-bookmark="atop" data-type="sect4"><div class="sect4" id="atop">
<h4>atop</h4>
<p>The <code>atop</code> utility is an advanced <a contenteditable="false" data-primary="atop utility" data-type="indexterm" id="idm45657872996576"/>system and <a contenteditable="false" data-primary="top commands" data-secondary="atop" data-type="indexterm" id="idm45657872995312"/>process monitor. <code>atop</code> displays standard top processes in the lower pane but provides insight<a contenteditable="false" data-primary="memory" data-secondary="tracking memory usage" data-tertiary="atop command" data-type="indexterm" id="idm45657872992288"/> into <a contenteditable="false" data-primary="networks" data-secondary="checking network performance" data-tertiary="atop command" data-type="indexterm" id="idm45657872993488"/>CPU, memory, disk, and network performance in the upper pane, as shown in <a data-type="xref" href="#the_atop_command">Figure 9-4</a>.</p>
<figure class="pagebreak-after"><div class="figure" id="the_atop_command"><img alt="" height="322" src="assets/plsa_0904.png" width="600"/>
<h6><span class="label">Figure 9-4. </span>The atop command</h6>
</div></figure>
<p>The <a href="https://oreil.ly/Fu2Sw"><code>atop</code> man page</a> describes <code>atop</code> as follows:</p>
<blockquote>
<p>The program <code>atop</code> is an interactive monitor to view the load on a Linux system. It shows the occupation of the most critical hardware resources (from a performance point of view) on the system level, i.e., CPU, memory, disk, LVM, swap usage, and network. It also shows which processes are responsible for the indicated load concerning CPU and memory load on the process level.</p>
</blockquote>
<p>You may run <code>atop</code> as a regular user or as the root user. Depending on which user (regular or root) executes the command, the command displays a message that informs you of which mode you’re using.</p>
<p>When run as root:</p>
<pre data-type="programlisting">
*** System and Process Activity since Boot ***     Unrestricted view (privileged)</pre>
<p>When run as a regular user:</p>
<pre data-type="programlisting">
*** System and Process Activity since Boot ***     Restricted view (unprivileged)</pre>
<p>The views are the same for both modes. Still, in restricted view, there are actions that you can’t take, such as using <code>kill</code> on processes that you don’t own. As mentioned earlier, the <code>atop</code> utility appeals to sysadmins because it displays focused performance values for critical system parameters. These statistics are handy because you don’t have to search for performance-specific data or use a potentially expensive third-party tool to extract the information. The <code>atop</code> utility is an essential part of a system administrator’s toolbox.</p>
</div></section>
<section data-pdf-bookmark="htop" data-type="sect4"><div class="sect4" id="htop">
<h4>htop</h4>
<p>The <code>htop</code> utility is another system performance viewer that displays the same information as the standard <code>top</code> utility but is color-coded and has a convenient command menu. <a contenteditable="false" data-primary="htop utility" data-type="indexterm" id="idm45657872976592"/><a contenteditable="false" data-primary="top commands" data-secondary="htop" data-type="indexterm" id="idm45657872975792"/>As you can see in <a data-type="xref" href="#the_htop_utility_running_in_cpu_usage_m">Figure 9-5</a>, the <code>htop</code> utility’s current usage mode is highlighted (<code>CPU%</code>). The current mode is CPU usage. The menu helps execute specific commands without the administrator having to memorize keystrokes for each action.</p>
<figure><div class="figure" id="the_htop_utility_running_in_cpu_usage_m"><img alt="" height="437" src="assets/plsa_0905.png" width="600"/>
<h6><span class="label">Figure 9-5. </span>The <code>htop</code> utility running in CPU usage mode</h6>
</div></figure>
</div></section>
</div></section>
<section data-pdf-bookmark="ps" data-type="sect3"><div class="sect3" id="ps">
<h3>ps</h3>
<p>The <code>ps</code> command displays information about running processes. <a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-startref="ix_CPUtrktop" data-tertiary="top commands" data-type="indexterm" id="idm45657872968288"/><a contenteditable="false" data-primary="top commands" data-startref="ix_top" data-type="indexterm" id="idm45657872966336"/>You can view your own processes, all processes, and the process table in different formats using command options or switches. <a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-tertiary="ps command" data-type="indexterm" id="idm45657873000768"/><a contenteditable="false" data-primary="ps command" data-type="indexterm" id="idm45657872963424"/>The <code>ps</code> command is common to all Linux distributions.</p>
<p>To view all processes <a contenteditable="false" data-primary="ps command" data-secondary="-ux option" data-type="indexterm" id="idm45657872968608"/>your user account owns, use the <code>ps</code> command with the <code>-ux</code> option:</p>
<pre data-type="programlisting">
$ ps -ux
USER    PID %CPU %MEM    VSZ   RSS TTY    STAT START  TIME COMMAND
khess  1550  0.0  1.1  89444  9600 ?      Ss   Jul31  0:00 /usr/lib/systemd/...
khess  1554  0.0  0.4 244512  3868 ?      S    Jul31  0:00 (sd-pam)
khess  1560  0.0  0.5 153444  4728 ?      S    Jul31  0:00 sshd: khess@pts/0
khess  1561  0.0  0.6 235212  5052 pts/0  Ss   Jul31  0:00 -bash
khess  4698  0.0  0.4 271452  4140 pts/0  R+   08:31  0:00 ps -ux</pre>
<p>You may also view all <a contenteditable="false" data-primary="ps command" data-secondary="-aux option" data-type="indexterm" id="idm45657872957824"/>processes by owner using the <code>-aux</code> switch combination:</p>
<pre data-type="programlisting">
$ ps -aux
USER    PID %CPU %MEM    VSZ   RSS TTY    STAT START   TIME COMMAND
root      1  0.0  1.6 174996 13372 ?      Ss   Jul31   0:04 /usr/lib/systemd/...
root      2  0.0  0.0      0     0 ?      S    Jul31   0:00 [kthreadd]
root      3  0.0  0.0      0     0 ?      I&lt;   Jul31   0:00 [rcu_gp]
root      4  0.0  0.0      0     0 ?      I&lt;   Jul31   0:00 [rcu_par_gp]
root      6  0.0  0.0      0     0 ?      I&lt;   Jul31   0:00 [kworker/0:0H...
root      9  0.0  0.0      0     0 ?      I&lt;   Jul31   0:00 [mm_percpu_wq]</pre>
<p>The full process table is too long to show here, but you can see from the listing that the displayed results show processes in ascending order of process ID (PID). The <code>top</code> command in the previous section is a dynamic process table that you can order by CPU, memory, and other performance measurements.</p>
<p>The remaining utilities in this section are not as well-known as the <code>top</code> or <code>ps</code> commands but are important enough for you to learn about and explore the features and functions of each. </p>
</div></section>
<section data-pdf-bookmark="glances" data-type="sect3"><div class="sect3" id="glances">
<h3>glances</h3>
<p><code>glances</code>, shown in <a data-type="xref" href="#glancesapostrophe_dynamic_display_with">Figure 9-6</a>, is another <code>top</code> program. <a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-tertiary="glances tool" data-type="indexterm" id="idm45657872948672"/><a contenteditable="false" data-primary="glances (monitoring tool)" data-type="indexterm" id="idm45657872946992"/>It is a cross-platform monitoring tool. The developer(s) rearranged and colorized the display, but the information is similar to what you see in the <code>htop</code> utility.</p>
<figure><div class="figure" id="glancesapostrophe_dynamic_display_with"><img alt="" height="407" src="assets/plsa_0906.png" width="600"/>
<h6><span class="label">Figure 9-6. </span><code>glances</code>’ dynamic display with <code>CPU%</code> focus</h6>
</div></figure>
<p>Press the M key (Shift is not required for shortcuts in <code>glances</code>) to<a contenteditable="false" data-primary="memory" data-secondary="tracking memory usage" data-tertiary="glances tool" data-type="indexterm" id="idm45657872942240"/> change the focus from <code>CPU%</code> to <code>MEM%</code>, and press T to switch to <code>TIME</code>. Press C to return to <code>CPU%</code> on the display.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If your system is CPU-constrained or you suspect it to be CPU-constrained, don’t use <code>glances</code> as your primary CPU performance check because it consumes about 15% of your CPU as opposed to <code>top</code>’s 3%–5%.</p>
</div>
<p>You may also run <code>glances</code> in a client/server configuration, export data to multiple formats, and change its display settings. Consult the man page for a list of <code>glances</code>’ features and options.<a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-startref="ix_CPUtrk" data-type="indexterm" id="idm45657872945472"/><a contenteditable="false" data-primary="monitoring your system" data-secondary="CPU, memory, and disk performance and capacity" data-startref="ix_monsysCPUmemdsk" data-type="indexterm" id="idm45657872932208"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Exploring sysstat Monitoring" data-type="sect2"><div class="sect2" id="exploring_sysstat_monitoring">
<h2>Exploring sysstat Monitoring</h2>
<p>The <code>sysstat</code> (System Status) package is a native tool. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-type="indexterm" id="ix_monsyssysst"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-type="indexterm" id="ix_sysstat"/>In other words, it’s a prepackaged, standard monitoring tool that’s free and freely available on any Linux distribution. You can compile it from source code if you prefer, but it’s generally available in package form for all major distributions.<a contenteditable="false" data-primary="System Status package" data-see="sysstat package" data-type="indexterm" id="idm45657873048176"/></p>
<p>The following is excerpted from the <code>sysstat</code> man <a contenteditable="false" data-primary="sadf command" data-type="indexterm" id="idm45657874145760"/>page:</p>
<blockquote>
<p>The sysstat package contains the sar, sadf, mpstat, iostat, tapestat, pidstat, cifsiostat tools for Linux.</p>
<ul>
<li>
<p>sar is the system activity reporter utility.</p>
</li>
<li>
<p>sadf is the system activity data formatter that displays data collected by sar in multiple formats (CSV, XML, etc.).</p>
</li>
<li>
<p>iostat is the input/output statistics utility that displays CPU utilization and disk I/O statistics.</p>
</li>
<li>
<p>tapestat displays tape and tape drive statistics.</p>
</li>
<li>
<p>mpstat is the multi-processor statistics utility that displays global and per-processor statistics.</p>
</li>
<li>
<p>pidstat reports statistics for Linux processes by process ID.</p>
</li>
<li>
<p>cifsiostat is the CIFS (Samba/SMB) I/O statistics utility.</p>
</li>
</ul>
</blockquote>
<section data-pdf-bookmark="Reporting System Activity" data-type="sect2"><div class="sect2" id="reporting_system_activity">
<h2>Reporting System Activity</h2>
<p>The <code>sar</code> utility is the most used of the <code>sysstat</code> suite of commands. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="reporting system activity using sar" data-type="indexterm" id="idm45657872914000"/><a contenteditable="false" data-primary="sar utility (sysstat)" data-secondary="reporting system activity" data-type="indexterm" id="idm45657872913040"/><a contenteditable="false" data-primary="sysstat package" data-secondary="reporting system activity using sar utility" data-type="indexterm" id="idm45657872911696"/>The system activity reporting tool displays performance statistics from midnight to the current time. By default, <code>sar</code> only displays the current day’s metrics.</p>
<p>You can save the information collected by <code>sar</code> in a file in a binary format. The statistics reported by <code>sar</code> include I/O transfer rates, paging, process-related performance, interrupts, network activity, memory utilization, swap space utilization, CPU utilization, kernel activities, TTY statistics, and more. The <code>sysstat</code> package fully supports both single and multiprocessor systems.<a contenteditable="false" data-primary="processors" data-secondary="sysstat support for single and multiprocessor systems" data-type="indexterm" id="idm45657874632672"/></p>
<p>Using the <code>sar</code> command with<a contenteditable="false" data-primary="CPUs" data-secondary="tracking CPU usage" data-tertiary="using sar command in sysstat" data-type="indexterm" id="idm45657874258112"/> no options displays CPU statistics (default):</p>
<pre data-type="programlisting">
$ sar
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/20/2022     _x86_64_    (1 CPU)

12:00:07 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle
12:10:08 AM     all      0.01      0.20      0.53      0.05      0.00     99.22
12:20:00 AM     all      0.01      0.00      0.25      0.01      0.00     99.74
12:30:01 AM     all      0.00      0.00      0.24      0.01      0.00     99.75
12:40:02 AM     all      0.01      0.00      0.25      0.01      0.00     99.73

...

02:00:04 PM     all      0.01      0.00      0.26      0.01      0.00     99.73
02:10:05 PM     all      0.01      0.01      0.27      0.01      0.00     99.70
02:20:05 PM     all      0.01      0.00      0.26      0.01      0.00     99.72
02:30:06 PM     all      0.01      0.00      0.27      0.01      0.00     99.72
Average:        all      0.01      0.01      0.29      0.01      0.00     99.69</pre>
<p>You can filter <code>sar</code> results using command options. <a contenteditable="false" data-primary="sar utility (sysstat)" data-secondary="reporting system activity" data-tertiary="filtering sar results with command options" data-type="indexterm" id="idm45657872901424"/>For example, to display CPU statistics, use the <code>-u</code> option. The <code>-u</code> option displays the same results as the <code>sar</code> command with no options. Add the <code>ALL</code> keyword to include all CPU-related statistics:</p>
<pre data-type="programlisting">
$ sar -u ALL
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)

12:00:03 AM   CPU %usr %nice %sys %iowait %steal %irq %soft %guest %gnice %idle
12:10:01 AM   all 0.02 0.00  0.06 0.01    0.00   0.22 0.05  0.00   0.00   99.64
12:20:01 AM   all 0.01 0.00  0.03 0.01    0.00   0.21 0.05  0.00   0.00   99.69
12:30:02 AM   all 0.01 0.00  0.03 0.01    0.00   0.20 0.05  0.00   0.00   99.70</pre>
<p>The <code>-B</code> option displays <a contenteditable="false" data-primary="paging statistics" data-type="indexterm" id="idm45657872896432"/>paging statistics:</p>
<pre data-type="programlisting">
$ sar -B
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)</pre>
<p>The <code>-b</code> option reports I/O and transfer<a contenteditable="false" data-primary="I/O" data-secondary="sar -b reporting on" data-type="indexterm" id="idm45657872893200"/> rate statistics:</p>
<pre data-type="programlisting">
$ sar -b
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)

12:00:03 AM       tps      rtps      wtps   bread/s   bwrtn/s
12:10:01 AM      0.53      0.13      0.40     11.42      6.52
12:20:01 AM      0.17      0.00      0.17      0.00      1.97
12:30:02 AM      0.16      0.00      0.16      0.00      1.97
12:40:03 AM      0.17      0.00      0.17      0.00      1.99</pre>
<p>As demonstrated, the <code>sar</code> command is versatile and has many options for displaying system performance data. Refer to the <code>sar</code> man page for an extensive list of options. The next section covers displaying <code>sar</code> data in multiple formats using the <code>sadf</code> command.</p>
</div></section>
<section data-pdf-bookmark="Displaying System Activity Data in Multiple Formats" data-type="sect2"><div class="sect2" id="displaying_system_activity_data_in_mult">
<h2>Displaying System Activity Data in Multiple Formats</h2>
<p>The <code>sadf</code> command sends <code>sar</code> data to different output types to make ingesting its data into a database or displaying it on a web page easier. <a contenteditable="false" data-primary="sadf command" data-secondary="displaying system activity data in multiple formats" data-type="indexterm" id="idm45657872884512"/><a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="displaying system activity data in multiple formats with sadf" data-type="indexterm" id="idm45657872883744"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="displaying system activity data in multiple formats" data-type="indexterm" id="idm45657872885408"/>For example, the following command displays <code>sar</code> data from the 21st of the month in a format that’s easy to import into a database:</p>
<pre data-type="programlisting">
$ sadf -d /var/log/sa/sa21
# hostname;interval;timestamp;CPU;%user;%nice;%system;%iowait;%steal;%idle
server1;601;2022-09-21 04:10:04 UTC;-1;0.01;0.00;0.28;0.01;0.00;99.70
server1;601;2022-09-21 04:20:05 UTC;-1;0.01;0.00;0.26;0.01;0.00;99.72
server1;601;2022-09-21 04:30:06 UTC;-1;0.01;0.00;0.28;0.01;0.00;99.71
server1;601;2022-09-21 04:40:07 UTC;-1;0.01;0.00;0.27;0.01;0.00;99.71
...</pre>
<p>In addition to using <code>sadf</code> with historical data, you can also use it with current data:</p>
<pre data-type="programlisting">
$ sadf -dh -- -p
# hostname;interval;timestamp;CPU;%user;%nice;%system;%iowait;%steal;%idle[...]
server1;598;2022-09-24 04:10:01 UTC;-1;0.02;0.00;0.33;0.01;0.00;99.64
server1;601;2022-09-24 04:20:01 UTC;-1;0.01;0.00;0.30;0.01;0.00;99.69
server1;601;2022-09-24 04:30:02 UTC;-1;0.01;0.00;0.29;0.01;0.00;99.70
server1;600;2022-09-24 04:40:03 UTC;-1;0.01;0.00;0.29;0.01;0.00;99.69
...</pre>
<p>There are too many possible options for generating different data outputs using <code>sadf</code> to list here. Search online for more examples or experiment with options from the <code>sadf</code> man page. The next sections deal with specific statistics output from other <span class="keep-together"><code>sysstat</code></span> utilities: <code>iostat</code>, <code>tapestat</code>, <code>mpstat</code>, <code>pidstat</code>, and <code>cifsiostat</code>. Their relevance depends on your hardware configuration. For example, very few, if any, businesses still use tape drives for backups.</p>
</div></section>
<section data-pdf-bookmark="Monitoring System I/O Device Loading with iostat" data-type="sect2"><div class="sect2" id="monitoring_system_isoliduso_device_load">
<h2>Monitoring System I/O Device Loading with iostat</h2>
<p>Like other “stat” commands, the first metric you see is a statistics summary or summary metric from the time since the system was last booted.<a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="monitoring I/O device loading with iostat" data-type="indexterm" id="idm45657872881184"/><a contenteditable="false" data-primary="iostat command" data-secondary="monitoring system I/O device loading" data-type="indexterm" id="ix_iostat"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="monitoring I/O device loading with iostat" data-type="indexterm" id="ix_sysstatIO"/><a contenteditable="false" data-primary="I/O" data-secondary="monitoring system I/O device loading with iostat" data-type="indexterm" id="ix_IOmon"/> Generally, you run the stat commands in multiples to see current statistics or use the <code>-y</code> option to ignore the summary metric. In this first example, the summary information is included; in the second, the summary is omitted.</p>
<p>Here it is with the summary information included:</p>
<pre data-type="programlisting">
$ iostat -d 2
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.26         1.59         2.05     312698     403049
sdc               0.01         0.04         0.01       8267       2797
sdb               0.00         0.02         0.01       3028       2048
scd0              0.00         0.00         0.00          1          0
dm-0              0.26         1.31         2.12     257071     416372
dm-1              0.00         0.01         0.01       2220       1172
dm-2              0.00         0.01         0.01       1330       2048

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
sdc               0.00         0.00         0.00          0          0
sdb               0.00         0.00         0.00          0          0
scd0              0.00         0.00         0.00          0          0
dm-0              0.00         0.00         0.00          0          0
dm-1              0.00         0.00         0.00          0          0
dm-2              0.00         0.00         0.00          0          0

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
sdc               0.00         0.00         0.00          0          0
sdb               0.00         0.00         0.00          0          0
scd0              0.00         0.00         0.00          0          0
dm-0              0.00         0.00         0.00          0          0
dm-1              0.00         0.00         0.00          0          0
dm-2              0.00         0.00         0.00          0          0</pre>
<p>Here it is with the summary information omitted:</p>
<pre data-type="programlisting">
$ iostat -y -d 2
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
sdc               1.00         0.00         0.75          0          1
sdb               0.00         0.00         0.00          0          0
scd0              0.00         0.00         0.00          0          0
dm-0              0.00         0.00         0.00          0          0
dm-1              0.00         0.00         0.00          0          0
dm-2              0.00         0.00         0.00          0          0

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
sdc               0.00         0.00         0.00          0          0
sdb               0.00         0.00         0.00          0          0
scd0              0.00         0.00         0.00          0          0
dm-0              0.00         0.00         0.00          0          0
dm-1              0.00         0.00         0.00          0          0
dm-2              0.00         0.00         0.00          0          0

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
sdc               0.00         0.00         0.00          0          0
sdb               0.00         0.00         0.00          0          0
scd0              0.00         0.00         0.00          0          0
dm-0              0.00         0.00         0.00          0          0
dm-1              0.00         0.00         0.00          0          0
dm-2              0.00         0.00         0.00          0          0</pre>
<p>The statistics on a quiet virtual machine aren’t very interesting, but at least you see which metrics the utility yields in its reports. <a contenteditable="false" data-primary="iostat command" data-secondary="monitoring system I/O device loading" data-startref="ix_iostat" data-type="indexterm" id="idm45657872856768"/>Like the other <code>sysstat</code> utilities, <code>iostat</code> has several options you <a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-startref="ix_sysstatIO" data-tertiary="monitoring I/O device loading with iostat" data-type="indexterm" id="idm45657872853808"/>can glean from the man pages.<a contenteditable="false" data-primary="I/O" data-secondary="monitoring system I/O device loading with iostat" data-startref="ix_IOmon" data-type="indexterm" id="idm45657872851712"/></p>
</div></section>
<section data-pdf-bookmark="Kicking It Old-School with the tapestat Utility" data-type="sect2"><div class="sect2" id="kicking_it_old_school_with_the_tapestat">
<h2>Kicking It Old-School with the tapestat Utility</h2>
<p>I haven’t used a tape drive in more than 15 years as of this writing. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="tape drive monitoring with tapestat" data-type="indexterm" id="idm45657872847264"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="tapestat utility" data-type="indexterm" id="idm45657872845616"/><a contenteditable="false" data-primary="tapestat utility" data-type="indexterm" id="idm45657872844000"/>Virtual tape drives (hard disks masquerading as tape drives) have replaced the old streaming tape systems. I’m covering <code>tapestat</code> here for legacy purposes because there’s always an old “unsupported” system lying about somewhere with a tape drive installed. The information on it is always more valuable than gold, and you might have to retrieve it. This section won’t help you retrieve the information, but you can see some tape drive–related statistics from its operation.</p>
<p>This is the response I receive when I run <code>tapestat</code> on my Linux VM:</p>
<pre data-type="programlisting">
$ tapestat
Linux 4.18.0-348.7.1.el8_5.x86_64 (server1)    09/24/2022     _x86_64_    (1 CPU)

No tape drives with statistics found</pre>
<p>That’s the message you’re likely to receive when you type the <code>tapestat</code> command. Tape drives are part of history and were not part of anyone’s good old days. If you’re still using one, your output will provide you with interesting and useful statistics.</p>
</div></section>
<section data-pdf-bookmark="Collecting Processor Statistics" data-type="sect2"><div class="sect2" id="collecting_processor_statistics">
<h2>Collecting Processor Statistics</h2>
<p>Using the <code>mpstat</code> (multiprocessor statistics) utility, you can display multiprocessor and uniprocessor statistics for your systems. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="collecting processor statistics with mpstat" data-type="indexterm" id="idm45657872834928"/><a contenteditable="false" data-primary="mpstat utility" data-type="indexterm" id="idm45657873100800"/><a contenteditable="false" data-primary="processors" data-secondary="collecting statistics on" data-type="indexterm" id="idm45657872876496"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="collecting processor statistics" data-type="indexterm" id="idm45657872831744"/>Issuing the <code>mpstat</code> command with no options displays a summary for all processors:</p>
<pre data-type="programlisting">
$ mpstat
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

10:06:16 AM  CPU  %usr %nice %sys %iowait %irq  %soft %steal %guest %gnice  %idle
10:06:16 AM  all  0.92  0.01  0.91 0.20   0.00  0.25  0.00    0.00   0.00   97.72</pre>
<p>You see that the system contains two processors, so you know that you can view individual processor performance. View individual processors by specifying option <code>-P</code> and the processor number. Remember that processor numbering begins with <code>0</code>. For a two-processor system, you have processor <code>0</code> and processor <code>1</code>. The following command displays statistics for processor <code>1</code>:</p>
<pre data-type="programlisting">
$ mpstat -P 1
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

10:12:43 AM  CPU  %usr %nice  %sys %iowait %irq %soft %steal %guest %gnice  %idle
10:12:43 AM    1  0.71  0.01  0.64  0.14   0.00  0.08  0.00   0.00   0.00   98.43</pre>
<p>You may also view all processors by specifying the <code>ALL</code> option:</p>
<pre data-type="programlisting">
$ mpstat -P ALL
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

09:56:28 AM  CPU  %usr  %nice  %sys %iowait %irq %soft %steal %guest %gnice %idle
09:56:28 AM  all  2.05  0.02   2.01  0.44   0.00  0.44  0.00   0.00   0.00  95.05
09:56:28 AM    0  1.93  0.02   2.11  0.44   0.00  0.65  0.00   0.00   0.00  94.84
09:56:28 AM    1  2.16  0.02   1.91  0.43   0.00  0.22  0.00   0.00   0.00  95.25</pre>
<p>Similar to other “stat” commands, you can request a display at an interval in seconds and a specified number of iterations. For example, the following executes <code>mpstat</code> every five seconds and three iterations:</p>
<pre data-type="programlisting">
$ mpstat 5 3
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

10:26:53 AM  CPU  %usr %nice %sys  %iowait %irq %soft %steal %guest %gnice  %idle
10:26:58 AM  all   0.00  0.00 0.00  0.00    0.00 0.10  0.00    0.00  0.00   99.90
10:27:03 AM  all   0.00  0.00 0.00  0.00    0.00 0.10  0.00    0.00  0.00   99.90
10:27:08 AM  all   0.00  0.00 0.00  0.00    0.00 0.00  0.00    0.00  0.00  100.00
Average:     all   0.00  0.00 0.00  0.00    0.00 0.07  0.00    0.00  0.00   99.93</pre>
<p>On a busier system, the numbers are far more informative. You can determine if a particular processor is at or above capacity and then selectively bind processes (changing the processor affinity of a process) to other processors to relieve the stress on <code>CPU0</code>. The next utility, <code>pidstat</code>, displays which processor a particular process is bound to.</p>
</div></section>
<section data-pdf-bookmark="Monitoring Linux Tasks with pidstat" data-type="sect2"><div class="sect2" id="monitoring_linux_tasks_with_pidstat">
<h2>Monitoring Linux Tasks with pidstat</h2>
<p>The <code>pidstat</code> command is used to monitor individual tasks currently managed by the Linux kernel. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="monitoring Linux tasks with pidstat" data-type="indexterm" id="idm45657872815984"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="Linux tasks, monitoring with pidstat" data-type="indexterm" id="idm45657872814304"/><a contenteditable="false" data-primary="pidstat utility" data-type="indexterm" id="idm45657872812720"/>The default command, with no options passed to it, displays only active tasks (tasks with nonzero statistics values) in the report:</p>
<pre data-type="programlisting">
$ pidstat
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

11:19:08 AM   UID   PID   %usr %system  %guest   %wait   %CPU   CPU  Command
11:19:08 AM    0     1    0.02   0.04    0.00     0.01    0.06    0  systemd
11:19:08 AM    0     2    0.00   0.00    0.00     0.00    0.00    1  kthreadd
11:19:08 AM    0    10    0.00   0.01    0.00     0.00    0.01    0  ksoftirqd/0
11:19:08 AM    0    11    0.00   0.03    0.00     0.02    0.03    1  rcu_sched
11:19:08 AM    0    12    0.00   0.00    0.00     0.00    0.00    0  migration/0
11:19:08 AM    0    17    0.01   0.00    0.00     0.01    0.01    1  migration/1
11:19:08 AM    0    18    0.00   0.00    0.00     0.01    0.00    1  ksoftirqd/1
11:19:08 AM    0    30    0.00   0.00    0.00     0.00    0.00    1  khugepaged
...</pre>
<p class="pagebreak-before">A handy use of the <code>pidstat</code> utility is to check system usage by an individual user:</p>
<pre data-type="programlisting">
$ pidstat -d -U khess
Linux 5.4.0-125-generic (server2)     09/25/2022     _x86_64_    (2 CPU)

11:36:26 AM    USER      PID    kB_rd/s   kB_wr/s  kB_ccwr/s iodelay  Command
11:36:26 AM    khess     1131    0.03      0.00      0.00      1      systemd
11:36:26 AM    khess     1239    0.79      0.00      0.00      2      bash</pre>
<p>The <code>pidstat</code> utility has significant value if you’re tracking down a rogue user or process consuming too many system resources.</p>
</div></section>
<section data-pdf-bookmark="Watching Windows-Compatible Filesystem Statistics with cifsiostat" data-type="sect2"><div class="sect2" id="watching_windows_compatible_filesystem">
<h2>Watching Windows-Compatible Filesystem Statistics with cifsiostat</h2>
<p>The <code>cifsiostat</code> command displays statistics about read and write operations on Common Internet File System (CIFS) or Samba filesystems. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-tertiary="watching Windows-compatible filesystem statistics with cifsiostat" data-type="indexterm" id="idm45657872805360"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-tertiary="watching Windows-compatible filesystem statistics using cifsiostat" data-type="indexterm" id="idm45657872803584"/><a contenteditable="false" data-primary="filesystems" data-secondary="Windows-compatible, monitoring statistics with cifsiostat" data-type="indexterm" id="idm45657872801920"/><a contenteditable="false" data-primary="Windows" data-secondary="monitoring Windows-compatible filesystem statistics with cifsiostat" data-type="indexterm" id="idm45657872800496"/><a contenteditable="false" data-primary="Samba filesystems" data-type="indexterm" id="idm45657872799072"/><a contenteditable="false" data-primary="Common Internet File System (CIFS)" data-type="indexterm" id="idm45657872797968"/><a contenteditable="false" data-primary="cifsiostat command" data-type="indexterm" id="idm45657872796896"/>Many system administrators will maintain CIFS to be compatible with their Windows users. Windows users may map drive letters to CIFS shares, similar to mapping to a shared folder on a Windows system. Using CIFS makes it easier to maintain some compatibility between Windows desktop systems and Linux servers. CIFS may also make using Windows Server systems unnecessary because many Windows services may be duplicated using the protocol.</p>
<p>Use the <code>cifsiostat</code> command to display statistics:</p>
<pre data-type="programlisting">
$ cifsiostat

Filesystem:      rB/s   wB/s    rops/s    wops/s   fo/s    fc/s    fd/s
\\server2\common  0.00   0.00    0.00      0.00     1.00    1.00    0.00</pre>
<p>If <code>cifsiostat</code> doesn’t work on your systems, ensure that you have CIFS/Samba installed and operating correctly. Add Samba users to your system. Set up writeable/browseable shares. Start/restart and enable Samba using the following <span class="keep-together">commands:</span></p>
<pre data-type="programlisting">
$ sudo systemctl enable smbd
$ sudo systemctl enable nmbd
$ sudo systemctl start smbd
$ sudo systemctl start nmbd</pre>
<p>Also, be sure <a contenteditable="false" data-primary="cifs kernel module" data-type="indexterm" id="idm45657883325552"/>that the <code>cifs</code> kernel module is loaded:</p>
<pre class="pagebreak-after" data-type="programlisting">
$ modinfo cifs</pre>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id00009">
<h1 class="less_space">Summary</h1>
<p>In this chapter, you learned about monitoring your system’s performance as well as the tools with which you can track those statistics. <a contenteditable="false" data-primary="monitoring your system" data-secondary="using sysstat" data-startref="ix_monsyssysst" data-type="indexterm" id="idm45657872788080"/><a contenteditable="false" data-primary="sysstat package" data-secondary="exploring sysstat monitoring" data-startref="ix_sysstat" data-type="indexterm" id="idm45657872786000"/>Unfortunately, there isn’t a single tool that does everything. Many system administrators install commercial monitoring tools to remedy the lack of a global, free monitoring tool. There have been a few attempts in the past to create such free tools, but they were either abandoned by their developers or sold to commercial companies.</p>
<p>Monitoring your systems is a required task, and it’s more than a simple up/down status check. You must maintain constant vigilance over your systems’ performance and capacity to minimize outages and provide business continuity to your applications and resources.<a contenteditable="false" data-primary="monitoring your system" data-startref="ix_monsys" data-type="indexterm" id="idm45657874741936"/></p>
</div></section>
</div></section></div></body></html>