<html><head></head><body><section data-pdf-bookmark="Chapter 19. Animation" data-type="chapter" epub:type="chapter"><div class="chapter" id="animation">&#13;
<h1><span class="label">Chapter 19. </span>Animation</h1>&#13;
&#13;
&#13;
<p>CSS <a data-primary="animation" data-type="indexterm" id="ix_animation_ch19"/>transitions, covered in the previous chapter, enable simple&#13;
animations that are triggered by changes in the DOM state and proceed from a beginning state to an end state.  CSS <em>animations</em> are similar to transitions in that values of CSS&#13;
properties change over time, but animations provide much more control over the way those changes happen. Specifically, CSS keyframe animations let us decide if and how an animation repeats, give us granular control over what happens throughout the animation, and more.  While transitions trigger implicit property value changes, animations&#13;
are explicitly executed when keyframe animations are applied.</p>&#13;
&#13;
<p>With CSS animations, you can change property values that are not part of&#13;
the set pre- or post-state of an element. The property values set on the&#13;
animated element don’t necessarily have to be part of the animation&#13;
progression. For example, when using a transition, going from black to white will animate only through various shades of gray. With animation, that same element doesn’t have to be black or white or even in-between shades of gray during the animation.</p>&#13;
&#13;
<p>While you <em>can</em> transition through shades of gray,&#13;
you could instead turn the element yellow, then animate from&#13;
yellow to orange. Alternatively, you could animate through various colors,&#13;
starting with black and ending with white, but progressing through the entire&#13;
rainbow along the way.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Look for the Play symbol <span class="play"><img src="assets/play-icon-round.png"/></span> to know when an online example is available. All of the examples in this chapter can be found at <a class="bare" href="https://meyerweb.github.io/csstdg5figs/19-animation"><em class="hyperlink">https://meyerweb.github.io/csstdg5figs/19-animation</em></a>.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Accommodating Seizure and Vestibular Disorders" data-type="sect1"><div class="sect1" id="seizure-disorders">&#13;
<h1>Accommodating Seizure and Vestibular Disorders</h1>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>While you can use <a data-primary="seizure disorders, animations affecting" data-type="indexterm" id="idm45176064055088"/><a data-primary="vestibular disorders, animations affecting" data-type="indexterm" id="idm45176064054336"/>animations to create ever-changing content, <em>repeated rapid changing of content can lead to seizures in some users.</em>  Always keep this in mind, and ensure the accessibility of your website for&#13;
people with epilepsy and other seizure disorders.</p>&#13;
</div>&#13;
&#13;
<p>We don’t usually start a chapter with a warning, but in this case, it’s warranted.  Visual change, especially rapid visual change, can trigger medical emergencies in users who are prone to seizures.  They can also cause severe unease in users who are prone to vestibular disorder (motion sickness).</p>&#13;
&#13;
<p>To reduce or eliminate this risk, use the <code>prefers-reduced-motion</code> media query (see <a data-type="xref" href="ch21.html#css-at-rules">Chapter 21</a>).  <a data-primary="media queries (@media)" data-secondary="for reduced-motion animations" data-secondary-sortas="reduced-motion animations" data-type="indexterm" id="idm45176064005648"/><a data-primary="prefers-reduced-motion media query" data-type="indexterm" id="idm45176064004368"/><a data-primary="reduced-motion animations" data-type="indexterm" id="idm45176064003680"/>This allows you to apply styles when the user has a “Reduce motion” or similar preference set for their browser or operating system. An approach such as this may be considered:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@media</code> <code class="p">(</code><code class="n">prefers</code><code class="o">-</code><code class="n">reduced</code><code class="o">-</code><code class="n">motion</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="o">*</code> <code class="p">{</code><code class="k">animation</code><code class="o">:</code> <code class="nb">none</code> <code class="cp">!important</code><code class="p">;</code> <code class="k">transition</code><code class="o">:</code> <code class="nb">none</code> <code class="cp">!important</code><code class="p">;}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This disables all animations and transitions, assuming no other <code>!important</code> animations are specified (and they shouldn’t be).  This is not a nuanced or perfect solution, but it’s a first step.  You can invert this approach by segregating all of your animations and transitions in a media block for those who do <em>not</em> have motion reduction enabled, like this:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@media</code> <code class="nt">not</code> <code class="p">(</code><code class="n">prefers</code><code class="o">-</code><code class="n">reduced</code><code class="o">-</code><code class="n">motion</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="c">/* all animations and transitions */</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Not all animations are dangerous or disorienting, and having at least some animations for all users may be necessary. Transitions and animations can be very helpful in informing users what has changed and guiding them to focus on specific content. In such cases, use <code>prefers-reduced-motion</code> to tone down animations that are essential to understanding the UI, and to switch off those that are not essential.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining Keyframes" data-type="sect1"><div class="sect1" id="keyframes">&#13;
<h1>Defining Keyframes</h1>&#13;
&#13;
<p>To <a data-primary="keyframes" data-type="indexterm" id="ix_keyframes_ch19"/><a data-primary="animation" data-secondary="keyframes" data-type="indexterm" id="ix_animate_keyframe"/><a data-primary="keyframes" data-secondary="@keyframe rule" data-secondary-sortas="keyframe rule" data-type="indexterm" id="ix_keyframe_rule"/><a data-primary="at-rules" data-secondary="@keyframes" data-secondary-sortas="keyframes" data-type="indexterm" id="ix_atrule_keyframe"/>animate an element, you need to refer to the name of a keyframe animation; to do <em>that</em>, we need a named keyframe animation. The first step is to define this reusable CSS keyframe animation by using the <code>@keyframes</code> at-rule, thus giving our animation a name.</p>&#13;
&#13;
<p>A <code>@keyframes</code> at-rule <a data-primary="animation" data-secondary="animation identifier" data-type="indexterm" id="idm45176063905424"/><a data-primary="blocks" data-secondary="keyframes in animation" data-type="indexterm" id="ix_block_keyframe_anim"/><a data-primary="keyframes" data-secondary="keyframe blocks" data-type="indexterm" id="ix_keyframe_block"/><a data-primary="keyframes" data-secondary="naming" data-type="indexterm" id="ix_keyframe_name"/>includes the <em>animation identifier</em>, or name, and&#13;
one or more <em>keyframe blocks</em>. Each keyframe block includes one or more&#13;
keyframe selectors with declaration blocks of property-value pairs.&#13;
The entire <code>@keyframes</code> at-rule specifies the behavior of a single&#13;
full iteration of the animation. The animation can iterate zero or more&#13;
times, depending mainly on the <code>animation-iteration-count</code> property&#13;
value, which we’ll discuss in <a data-type="xref" href="#defining-animation-iterations">“Declaring Animation Iterations”</a>.</p>&#13;
&#13;
<p>Each <a data-primary="keyframes" data-secondary="selectors, including to and from" data-type="indexterm" id="idm45176063897920"/>keyframe block includes one or more <em>keyframe selectors</em>. These are percentage-of-time positions along the duration of the animation; they are declared either as percentages or with the keywords <code>from</code> or <code>to</code>.  Here’s the generic structure of an animation:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">animation_identifier</code> <code class="p">{</code>&#13;
  <code class="nt">keyframe_selector</code> <code class="p">{</code>&#13;
    <code class="n">property</code><code class="o">:</code> <code class="n">value</code><code class="p">;</code>&#13;
    <code class="n">property</code><code class="o">:</code> <code class="n">value</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">keyframe_selector</code> <code class="p">{</code>&#13;
    <code class="n">property</code><code class="o">:</code> <code class="n">value</code><code class="p">;</code>&#13;
    <code class="n">property</code><code class="o">:</code> <code class="n">value</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Here are a couple of basic examples:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">fadeout</code> <code class="p">{</code>&#13;
    <code class="nt">from</code> <code class="p">{</code>&#13;
        <code class="k">opacity</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">to</code> <code class="p">{</code>&#13;
        <code class="k">opacity</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">color-pop</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code> <code class="p">{</code>&#13;
        <code class="k">color</code><code class="o">:</code> <code class="nb">black</code><code class="p">;</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">white</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">33%</code> <code class="p">{</code> <code class="c">/* one-third of the way through the animation */</code>&#13;
        <code class="k">color</code><code class="o">:</code> <code class="nb">gray</code><code class="p">;</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">color</code><code class="o">:</code> <code class="nb">white</code><code class="p">;</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">orange</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The first set of keyframes shown takes an element, sets its <code>opacity</code> to <code>1</code> (fully opaque), and animates it to <code>0</code> opacity (fully transparent).  The second keyframe set animates an element’s foreground to black and its background to white, then animates the foreground from black to gray and then white, and the background from white to yellow and then orange.</p>&#13;
&#13;
<p>Note that the keyframes don’t say how long this animation should take—that’s handled by a CSS property dedicated to the purpose.  Instead they say, “Go from this state to that state” or “Hit these various states at these percentage points of the total animation.”  That’s why keyframe selectors are always percentages, or <code>from</code> and <code>to</code>.  If you try to use time values (like <code>1.5s</code>) as your keyframe selectors, you’ll render them invalid.<a data-primary="" data-startref="ix_atrule_keyframe" data-type="indexterm" id="idm45176063768832"/><a data-primary="" data-startref="ix_block_keyframe_anim" data-type="indexterm" id="idm45176063767856"/><a data-primary="" data-startref="ix_keyframe_block" data-type="indexterm" id="idm45176063766912"/><a data-primary="" data-startref="ix_keyframe_rule" data-type="indexterm" id="idm45176063765968"/><a data-primary="" data-startref="ix_keyframe_name" data-type="indexterm" id="idm45176063735360"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Setting Up Keyframe Animations" data-type="sect1"><div class="sect1" id="setting-up-your-keyframe-animation">&#13;
<h1>Setting Up Keyframe Animations</h1>&#13;
&#13;
<p>Within the <a data-primary="keyframes" data-secondary="setting up" data-type="indexterm" id="idm45176063732800"/><a data-primary="{…​} (curly braces)" data-secondary="keyframes" data-type="indexterm" id="idm45176063731792"/><a data-primary="curly braces ({…​})" data-secondary="keyframes" data-type="indexterm" id="idm45176063730848"/>opening and closing curly braces of a keyframe set, you&#13;
include a series of keyframe selectors with blocks of CSS that&#13;
declare the properties you want to animate. Once the keyframes are defined, you “attach” the animation to an element by using the <code>animation-name</code> property. We’ll discuss that property shortly, in <a data-type="xref" href="#the-animation-name-property">“Invoking a Named Animation”</a>.</p>&#13;
&#13;
<p>Start with the at-rule declaration, followed by the animation name and&#13;
braces:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">nameOfAnimation</code> <code class="p">{</code>&#13;
<code class="o">...</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <a data-primary="animation" data-secondary="animation identifier" data-type="indexterm" id="idm45176063723392"/>name, which you create, is an identifier or a string. Originally, the keyframe names had to be an identifier, but both the specification and the browsers also support quoted strings.</p>&#13;
&#13;
<p>Identifiers are unquoted and have specific rules. You can use any&#13;
characters <code>a-z</code>, <code>A-Z</code>, and <code>0-9</code>, the hyphen (<code>-</code>), underscore (<code>_</code>), and any ISO&#13;
10646 character U+00A0 and higher. ISO 10646 is the universal character&#13;
set; this means you can use any character in the Unicode standard that&#13;
matches the regular expression <code>[-_a-zA-Z0-9\u00A0-\u10FFFF]</code>.<a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/name.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> The identifier can’t start with&#13;
a digit (0–9) and should not start with two hyphens (though some browsers allow this). One hyphen is fine, as long as it is&#13;
not followed by a digit—unless you escape the digit or hyphen with a backslash.</p>&#13;
&#13;
<p>If you include any escape characters within your animation name, make&#13;
sure to escape them with a backslash (<code>\</code>). For example, <code>Q&amp;A!</code> must be&#13;
written as <code>Q\&amp;A\!</code>. The name <code>âœŽ</code> can be left as <code>âœŽ</code> (no, that’s not a typo), and <code>✎</code> is a valid name as well. But if you’re going to use any&#13;
keyboard characters that aren’t letters or digits in an identifier, like&#13;
<code>!</code>, <code>@</code>, <code>#</code>, <code>$</code>, and so on, escape them with a backslash.</p>&#13;
&#13;
<p>Also, don’t use any of the keywords covered in this chapter as the name&#13;
of your animation. For example, possible values for the various&#13;
animation properties we’ll be covering later in the chapter include&#13;
<code>none</code>, <code>paused</code>, <code>running</code>, <code>infinite</code>, <code>backwards</code>, and <code>forwards</code>. Using an animation property keyword, while not prohibited&#13;
by the spec, will likely break your animation <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/badnames.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> when using the <code>animation</code>&#13;
shorthand property (discussed in <a data-type="xref" href="#the-animation-shorthand-property">“Bringing It All Together”</a>). So, while you can legally name your&#13;
animation <code>paused</code> (or another keyword,) we <em>strongly</em> recommend against it.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining Keyframe Selectors" data-type="sect1"><div class="sect1" id="keyframe-selectors">&#13;
<h1>Defining Keyframe Selectors</h1>&#13;
&#13;
<p><em>Keyframe selectors</em> define<a data-primary="keyframes" data-secondary="selectors, including to and from" data-type="indexterm" id="ix_keyframe_selectors"/> points during an animation where we set the&#13;
values of the properties we want to animate. If you want a value at the start of the&#13;
animation, you declare it at the <code>0%</code> mark. If you want a different value&#13;
at the end of the animation, you declare the property value at the <code>100%</code>&#13;
mark. If you want a value a third of the way through the animation, you&#13;
declare it at the <code>33%</code> mark. These marks are defined with keyframe&#13;
selectors.</p>&#13;
&#13;
<p>Keyframe selectors consist of a comma-separated list of one or more&#13;
percentage values or the keywords <code>from</code> or <code>to</code>. The keyword <code>from</code> is&#13;
equal to <code>0%</code>. The keyword <code>to</code> equals <code>100%</code>. The keyframe selectors are used to&#13;
specify the percentage along the duration of the animation the keyframe&#13;
represents. The keyframe itself is specified by the block of property&#13;
values declared on the selector. The <code>%</code> unit must be used on percentage&#13;
values. In other words, <code>0</code> is invalid as a keyframe selector:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
    <code class="nt">from</code> <code class="p">{</code>  <code class="c">/* equivalent to 0% */</code>&#13;
      <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
      <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code>&#13;
      <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">50%</code> <code class="p">{</code>&#13;
      <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">to</code> <code class="p">{</code>  <code class="c">/* equivalent to 100% */</code>&#13;
      <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code>&#13;
      <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This <code>@keyframes</code> animation, named <code>W</code>, when attached to a&#13;
nonstatically positioned element, would move that element along a W-shaped path. <code>W</code> has five keyframes: one each at the <code>0%</code>, <code>25%</code>, <code>50%</code>, <code>75%</code>, and <code>100%</code> marks. The <code>from</code> is the <code>0%</code> mark, while the <code>to</code> is the <span class="keep-together"><code>100%</code> mark.</span> <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/02_W.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Because the property values we set for the <code>25%</code> and <code>75%</code> mark are the same, we can put the two keyframe selectors together as a comma-separated list. This is very similar to regular selectors, which you can group together with commas. Whether you keep those selectors on one line (as in the example) or put each selector on its own line is up to your personal preference.</p>&#13;
&#13;
<p>Notice that keyframe selectors do not need to be listed in ascending order. In the preceding example, we have the <code>25%</code> and <code>75%</code> on the same line, with the <code>50%</code> mark coming after that declaration. For legibility, it is highly&#13;
encouraged to progress from the <code>0%</code> to the <code>100%</code> mark. However, as&#13;
demonstrated by the <code>75%</code> keyframe in this example, it is&#13;
not required.  You could define your keyframes with the last first and the first last, or scramble them up randomly, or whatever works for you.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Omitting from and to Values" data-type="sect2"><div class="sect2" id="omitting-from-and-to-values">&#13;
<h2>Omitting from and to Values</h2>&#13;
&#13;
<p>If a <code>0%</code> or <code>from</code> keyframe<a data-primary="from keyframe selector, animations" data-type="indexterm" id="idm45176063578672"/><a data-primary="to keyframe selector, animations" data-type="indexterm" id="idm45176063577920"/><a data-primary="keyframes" data-secondary="omitting from or to values in" data-type="indexterm" id="idm45176063577232"/> is not specified, the user agent&#13;
(browser) constructs a <code>0%</code> keyframe. The implicit <code>0%</code> keyframe uses the original values of the properties being animated, as if the <code>0%</code> keyframe were declared with the same property values that impact the element when no animation was applied—that is, unless another animation applied to that element is currently animating the same property (see <a data-type="xref" href="#the-animation-name-property">“Invoking a Named Animation”</a> for details). Similarly, if the <code>100%</code> or <code>to</code> keyframe is not defined and no other animations are being applied, the&#13;
browser creates a faux <code>100%</code> keyframe using the value the element would&#13;
have had if no animation had been set on it.</p>&#13;
&#13;
<p>Say we have a <code>background-color</code> change animation:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">change_bgcolor</code> <code class="p">{</code>&#13;
    <code class="nt">45%</code> <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">55%</code> <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>If the element originally had <code>background-color: red</code> set on it, it&#13;
would be as if the animation were as follows: <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/no0or100.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">change_bgcolor</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code>   <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">45%</code>  <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">55%</code>  <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Or, remembering that we can include multiple identical keyframes as a&#13;
comma-separated list, this faux animation also could be written&#13;
as shown here:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">change_bgcolor</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">45%</code>  <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">55%</code>  <code class="p">{</code> <code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Note the <code>background-color: red;</code> declarations are not part of&#13;
the original keyframe animation; they’ve just been filled in here for clarity. We can include this <code>change_bgcolor</code> animation on many elements, and the perceived animation will differ based on the element’s value for the <code>background-color</code> property in the nonanimated state. Thus, an element that has a yellow background will animate from yellow to green to blue and then back to yellow.</p>&#13;
&#13;
<p>Although we’ve been using exclusively integer values for our percentages, noninteger percentage values, such as <code>33.33%</code>, are perfectly&#13;
valid. Negative percentages, values greater than <code>100%</code>, and values that aren’t otherwise percentages or the keywords <code>to</code> or <code>from</code> are invalid and will be ignored.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Repeating Keyframe Properties" data-type="sect2"><div class="sect2" id="repeating-keyframe-properties">&#13;
<h2>Repeating Keyframe Properties</h2>&#13;
&#13;
<p>Much <a data-primary="keyframes" data-secondary="repeating properties" data-type="indexterm" id="idm45176063402448"/><a data-primary="properties" data-secondary="repeating in keyframes" data-type="indexterm" id="idm45176063401440"/><a data-primary="repeating elements" data-secondary="animation keyframe properties" data-type="indexterm" id="idm45176063400496"/>like the rest of CSS, the values in keyframe declaration blocks with identical keyframe values&#13;
cascade. Thus, the earlier <code>W</code> animation&#13;
can be written with the <code>to</code>, or <code>100%</code>, declared twice, overriding the&#13;
value of the <code>left</code> property:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
  <code class="nt">from</code><code class="o">,</code> <code class="nt">to</code> <code class="p">{</code>&#13;
    <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
    <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code>&#13;
    <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">50%</code> <code class="p">{</code>&#13;
    <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">to</code> <code class="p">{</code>&#13;
    <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Notice that <code>to</code> is declared along with <code>from</code> as&#13;
keyframe selectors for the first code block?  That sets both <code>top</code> and <code>left</code> for the <code>to</code> keyframe. Then, the <code>left</code> value is&#13;
overridden for the <code>to</code> in the last keyframe block.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animatable Properties" data-type="sect2"><div class="sect2" id="animatable-properties2">&#13;
<h2>Animatable Properties</h2>&#13;
&#13;
<p>It’s <a data-primary="animatable properties" data-type="indexterm" id="idm45176063319056"/><a data-primary="keyframes" data-secondary="animatable properties" data-type="indexterm" id="idm45176063318320"/><a data-primary="properties" data-secondary="animatable" data-type="indexterm" id="idm45176063317376"/>worth taking a moment to note that not all properties are <em>animatable</em>.  If you list a property that can’t be animated within an animation’s keyframes, it’s simply ignored.  (For that matter, so are properties and values that the browser doesn’t recognize at all, just like any other part of CSS.)</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Exceptions to the midpoint rule include <code>animating-timing-function</code> and <code>visibility</code>, which are discussed in the next section.</p>&#13;
</div>&#13;
&#13;
<p>As long as an animatable property is included in at least one block with&#13;
a value that is different from the nonanimated attribute value, and&#13;
there is a calculable midpoint between those two values, that property&#13;
will animate.</p>&#13;
&#13;
<p>If an animation is set between two property values that don’t have a calculable midpoint, the property may not animate correctly—or at all. For example, you shouldn’t declare an element’s height to animate between <code>height: auto</code> and <code>height: 300px</code>, because there is no easily defined midpoint between <code>auto</code> and <code>300px</code>. The element will still animate, but browsers will jump from the preanimated state to the postanimated state halfway through the animation.  Thus, for a 1-second animation, the element will jump from <code>auto</code> height to <code>300px</code> height at the 500-millisecond point in the animation. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/nomidpoint.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> Other properties may animate over the length of the same animation; e.g., if you change the background color, it will animate smoothly over the animation.  Only those properties that can’t be animated between will jump halfway through.</p>&#13;
&#13;
<p>The behavior of your animation will be most predictable if you declare&#13;
both a 0% and a 100% value for every property you animate. For example, if you declare <code>border-radius: 50%;</code> in your animation, you&#13;
may want to declare <code>border-radius: 0%;</code> as well, because the default value of&#13;
<code>border-radius</code> is <code>none</code>, not <code>0</code>, and there is no&#13;
midpoint between <code>none</code> and other values.  Consider the difference in the following two animations:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">round</code> <code class="p">{</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">border-radius</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">square_to_round</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code> <code class="p">{</code>&#13;
        <code class="k">border-radius</code><code class="o">:</code> <code class="m">0%</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">border-radius</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <code>round</code> animation will animate an element from the original <code>border-radius</code> value of that element to <code>border-radius</code>: <code>50%</code> over&#13;
the duration of the animation.  The <code>square_to_round</code> animation will animate an element from <code>border-radius: 0%</code> to <code>border-radius: 50%</code> over&#13;
the duration of the animation.  If the element starts out with square corners, the two animations will have exactly the same effect.  But if the element starts out with rounded corners, <code>square_to_round</code> will jump to <span class="keep-together">rectangular</span> corners before it starts&#13;
animating.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Nonanimatable Properties That Aren’t Ignored" data-type="sect2"><div class="sect2" id="non-animatable-properties-that-arent-ignored">&#13;
<h2>Using Nonanimatable Properties That Aren’t Ignored</h2>&#13;
&#13;
<p>Exceptions to the <a data-primary="keyframes" data-secondary="nonanimatable properties not ignored" data-type="indexterm" id="idm45176063254544"/><a data-primary="nonanimatable properties, using" data-type="indexterm" id="idm45176063237712"/>midpoint rule include <code>visibility</code> and&#13;
<code>animation-timing-function</code>.</p>&#13;
&#13;
<p>The <code>visibility</code> property<a data-primary="visibility property" data-secondary="animatability and" data-type="indexterm" id="idm45176063234992"/> is animatable, even though there is no midpoint&#13;
between <code class="keep-together">visibility:</code> <code>hidden</code> and <code>visibility: visible</code>. When you&#13;
animate from <code>hidden</code> to <code>visible</code>, the visibility value jumps from one&#13;
value to the next at the keyframe where the change is declared.  So you don’t get a smooth fade from visible to hidden, or vice versa.  The state changes in an instant.</p>&#13;
&#13;
<p>While <a data-primary="animation-timing-function property" data-type="indexterm" id="idm45176063231152"/>the <code>animation-timing-function</code> is not, in fact, an animatable&#13;
property, when included in a keyframe block, the animation timing will switch to&#13;
the newly declared value at that point in the animation for the&#13;
properties within that keyframe selector block. The change in animation&#13;
timing is not animated; it simply switches to the new value for those properties only, and only until the next keyframe.  This allows you to vary the &#13;
<span class="keep-together">timing</span> function from one keyframe to another.  (This is covered in <a data-type="xref" href="#changing-the-internal-timing-of-animations">“Changing the Internal Timing of Animations”</a>.)</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Scripting @keyframes Animations" data-type="sect2"><div class="sect2" id="scripting-keyframes-animations">&#13;
<h2>Scripting @keyframes Animations</h2>&#13;
&#13;
<p>The CSSKeyframesRule API <a data-primary="keyframes" data-secondary="scripting" data-type="indexterm" id="idm45176063226416"/><a data-primary="scripting @keyframes animations" data-type="indexterm" id="idm45176063225056"/><a data-primary="appendRule() method" data-type="indexterm" id="idm45176063224368"/><a data-primary="deleteRule() method" data-type="indexterm" id="idm45176063223696"/><a data-primary="findRule() method" data-type="indexterm" id="idm45176063223024"/>enables finding, appending, and deleting keyframe rules. You can change the content of a keyframe block within a given <code>@keyframes</code> declaration with <code>appendRule(</code><em><code>n</code></em><code>)</code> or <code>deleteRule(</code><em><code>n</code></em><code>)</code>, where <em><code>n</code></em> is the full selector of that keyframe. You can return the contents of a keyframe with <code>findRule(</code><em><code>n</code></em><code>)</code>. Consider this:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
  <code class="nt">from</code><code class="o">,</code> <code class="nt">to</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
  <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
  <code class="nt">50%</code>      <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code> <code class="p">}</code>&#13;
  <code class="nt">to</code>       <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <code>appendRule()</code>, <code>deleteRule()</code>, and <code>findRule()</code> methods take the full&#13;
keyframe selector as an argument, as shown in the following:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// Get the selector and content block for a keyframe</code>&#13;
<code class="kd">var</code> <code class="nx">aRule</code> <code class="o">=</code> <code class="nx">myAnimation</code><code class="p">.</code><code class="nx">findRule</code><code class="p">(</code><code class="s1">'25%, 75%'</code><code class="p">).</code><code class="nx">cssText</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// Delete the 50% keyframe</code>&#13;
<code class="nx">myAnimation</code><code class="p">.</code><code class="nx">deleteRule</code><code class="p">(</code><code class="s1">'50%'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Add a 53% keyframe to the end of the animation</code>&#13;
<code class="nx">myAnimation</code><code class="p">.</code><code class="nx">appendRule</code><code class="p">(</code><code class="s1">'53% {top: 50%;}'</code><code class="p">);</code></pre>&#13;
&#13;
<p>The statement <code>myAnimation.findRule('25%, 75%').cssText</code>, where&#13;
<code>myAnimation</code> is pointing to a keyframe animation, returns the keyframe&#13;
that matches <code>25%, 75%</code>. It would not match any block using either <code>25%</code> or <code>75%</code> only. If <code>myAnimation</code> refers to the <code>W</code> animation, <code>myAnimation.findRule('25%, 75%').cssText</code> returns <code>25%, 75% { top: 100%; }</code>.</p>&#13;
&#13;
<p>Similarly, <code>myAnimation.deleteRule('50%')</code> will delete the <em>last</em> 50%&#13;
keyframe—so if we have multiple <code>50%</code> keyframes, the last one listed will be the first to go.&#13;
Conversely, <code>myAnimation.appendRule('53% {top: 50%;}')</code> appends a 53% keyframe&#13;
after the last keyframe of the <code>@keyframes</code> block. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/appendRule.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>CSS has <a data-primary="animationend event" data-type="indexterm" id="idm45176063107440"/><a data-primary="animationiteration event" data-type="indexterm" id="idm45176063106352"/><a data-primary="animationstart event" data-type="indexterm" id="idm45176063105712"/>four animation events: <code>animationstart</code>, <code>animationend</code>,&#13;
<code>animationiteration</code>, and <code>animationcancel</code>.  The first two occur at the start and end&#13;
of an animation, and the last between the end of an iteration and the start of&#13;
a subsequent iteration. Any animation for which a valid keyframe rule is&#13;
defined will generate the start and end events, even animations with&#13;
empty keyframe rules. The <code>animationiteration</code> event occurs only when an&#13;
animation has more than one iteration, as the <code>animationiteration</code> event&#13;
does not fire if the <code>animationend</code> event would fire at the same time. The <code>animationcancel</code> event is fired whenever a running animation is stopped before reaching&#13;
its last keyframe.<a data-primary="" data-startref="ix_keyframe_selectors" data-type="indexterm" id="idm45176063101312"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animating Elements" data-type="sect1"><div class="sect1" id="animating-elements">&#13;
<h1>Animating Elements</h1>&#13;
&#13;
<p>Once you have <a data-primary="elements" data-secondary="animating" data-type="indexterm" id="ix_elem_animate"/><a data-primary="animation" data-secondary="applying to elements" data-type="indexterm" id="ix_animate_elem"/>created a keyframe animation, you can apply that&#13;
animation to elements and/or pseudo-elements.&#13;
CSS provides numerous animation properties to&#13;
attach a keyframe animation to an element and control its progression. At a minimum, you need to include the name of the animation for the element to animate, and a duration if you want the animation to be visible.  (Without a duration, the animation will happen in zero time.)</p>&#13;
&#13;
<p>You can attach animation properties to an element in two ways: include all the animation properties separately, or declare all the properties in one line by using the <code>animation</code> shorthand property (or a combination of shorthand and longhand properties). Let’s start with the individual properties.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Invoking a Named Animation" data-type="sect2"><div class="sect2" id="the-animation-name-property">&#13;
<h2>Invoking a Named Animation</h2>&#13;
&#13;
<p>The <code>animation-name</code> property<a data-primary="animation-name property" data-type="indexterm" id="ix_animate_name_prop"/><a data-primary="keyframes" data-secondary="named animation, invoking" data-type="indexterm" id="ix_keyframe_name_invoke"/><a data-primary="animation" data-secondary="naming" data-type="indexterm" id="ix_animate_name"/> takes as its value a&#13;
comma-separated list of names of keyframe animations you want to&#13;
apply to the selected elements.&#13;
The names are the unquoted identifiers or quoted strings (or a mixture of both) you created in your <code>@keyframes</code> rules.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-name">&#13;
<h1>animation-name</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ &lt;<em><code>single-animation-name</code></em>&gt; | <code>none</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>none</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>The default value is <code>none</code>, which means no animation is applied to the selected elements. The <code>none</code> value can be used to override any animation applied elsewhere in&#13;
the CSS cascade. (This is also the reason you don’t want to name your&#13;
animation <code>none</code>, unless you’re a masochist.) <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/badnames.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Using the <code>change_bgcolor</code> keyframe animation defined in <a data-type="xref" href="#omitting-from-and-to-values">“Omitting from and to Values”</a>, we have this:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"> <code class="nt">div</code> <code class="p">{</code>&#13;
     <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="p">;</code>&#13;
 <code class="p">}</code></pre>&#13;
&#13;
<p>This simple rule applies the <code>change_bgcolor</code> animation to all <code>&lt;div&gt;</code> elements, however many or few are on the page.  To apply more than one animation, include more than one comma-separated&#13;
animation name:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"> <code class="nt">div</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">round</code><code class="o">,</code> <code class="n">W</code><code class="p">;</code>&#13;
 <code class="p">}</code></pre>&#13;
&#13;
<p>If one of the included keyframe identifiers does not exist, the series&#13;
of animations will not fail; rather, the failed animation will be&#13;
ignored, and the valid animations will be applied. While ignored initially, the failed animation will be applied if and when that keyframe animation comes into existence as a valid animation. Consider the following:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"> <code class="nt">div</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">spin</code><code class="o">,</code> <code class="n">round</code><code class="o">,</code> <code class="n">W</code><code class="p">;</code>&#13;
 <code class="p">}</code></pre>&#13;
&#13;
<p>In this example, assume that no <code>spin</code> keyframe animation is defined. The&#13;
<code>spin</code> animation will not be applied, while the <code>change_bgcolor</code>, <code>round</code>, and <code>W</code> animations will occur. Should a <code>spin</code> keyframe animation come into existence through scripting, it will be applied at that time.  <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/nameaddedlater.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>If more <a data-primary="animation" data-secondary="multiples" data-type="indexterm" id="idm45176062950704"/>than one animation is applied to an&#13;
element and those animations have repeated properties, the later animations override&#13;
the property values in the earlier animations. For example, if more&#13;
than two background color changes are applied concurrently in two&#13;
different keyframe animations, whichever animation was listed later will&#13;
override the background property declarations of animations earlier in the list, but <em>only</em>&#13;
if the properties (background colors, in this case) are being animated at the same time. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/no0or100.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> For more&#13;
on this, see <a data-type="xref" href="#animation-specificity-and-precedence-order">“Animation, Specificity, and Precedence Order”</a>.</p>&#13;
&#13;
<p>For example, assume the following, and further assume that the animations happen over a period of 10 seconds:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code><code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">bg</code><code class="o">-</code><code class="n">shift</code><code class="p">;}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">bg-shift</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">cyan</code><code class="p">;}</code>&#13;
    <code class="nt">35%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">orange</code><code class="p">;}</code>&#13;
    <code class="nt">55%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;}</code>&#13;
    <code class="nt">65%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">purple</code><code class="p">;}</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">change_bgcolor</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;}</code>&#13;
    <code class="nt">45%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;}</code>&#13;
    <code class="nt">55%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The background will animate from cyan to orange to red to purple and then back to cyan, thanks to <code>bg-shift</code>. Because it comes last in the list of animations, its keyframes take precedence. Anytime multiple animations specify behavior for the same property at the same point in time, the animation listed last in the value of <code>animation-name</code> will be &#13;
<span class="keep-together">in effect.</span></p>&#13;
&#13;
<p>What’s interesting is what happens if the <code>from</code> (<code>0%</code>) or <code>to</code> (<code>100%</code>) keyframes are omitted from the animation in force.  For example, let’s remove the first keyframes defined in &#13;
<span class="keep-together"><code>bg-shift</code>:</span></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code><code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">bg</code><code class="o">-</code><code class="n">shift</code><code class="p">;}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">bg-shift</code> <code class="p">{</code>&#13;
    <code class="nt">35%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">orange</code><code class="p">;}</code>&#13;
    <code class="nt">55%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;}</code>&#13;
    <code class="nt">65%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">purple</code><code class="p">;}</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">change_bgcolor</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;}</code>&#13;
    <code class="nt">45%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;}</code>&#13;
    <code class="nt">55%</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Now no background colors are defined at the beginning and end of <code>bg-shift</code>.  In a situation like this, when a <code>0%</code> or <code>100%</code> keyframe is not specified, the user agent constructs a <code>0%</code>/<code>100%</code> keyframe by using the computed values of the properties being animated.</p>&#13;
&#13;
<p>These are concerns only when two different keyframe blocks are trying to change the same property’s values.  In this case, it is <code>background-color</code>.  On the other hand, if one keyframe block animates <code>background-color</code> while another animates <code>padding</code>, the two animations will not collide, and both the background color and padding will be animated together.</p>&#13;
&#13;
<p>Simply applying an animation to an element is not enough for the element&#13;
to visibly animate.  For that to happen, the animation must take place over some&#13;
amount of time. For that, we have the <code>animation-duration</code> property.<a data-primary="" data-startref="ix_animate_keyframe" data-type="indexterm" id="idm45176062737968"/><a data-primary="" data-startref="ix_keyframes_ch19" data-type="indexterm" id="idm45176062736960"/><a data-primary="" data-startref="ix_animate_name" data-type="indexterm" id="idm45176062736016"/><a data-primary="" data-startref="ix_animate_name_prop" data-type="indexterm" id="idm45176062735072"/><a data-primary="" data-startref="ix_keyframe_name_invoke" data-type="indexterm" id="idm45176062734128"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Defining Animation Lengths" data-type="sect2"><div class="sect2" id="defining-animation-lengths">&#13;
<h2>Defining Animation Lengths</h2>&#13;
&#13;
<p>The <code>animation-duration</code> property<a data-primary="animation-duration property" data-type="indexterm" id="ix_animate_dur_prop"/><a data-primary="animation" data-secondary="duration" data-type="indexterm" id="ix_animate_dur"/> defines how long a single animation&#13;
iteration should take in seconds (<code>s</code>) or milliseconds (<code>ms</code>).</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-duration">&#13;
<h1>animation-duration</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>&lt;<em><code>time</code></em>&gt;#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>0s</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>The <code>animation-duration</code> property<a data-primary="animationend event" data-type="indexterm" id="idm45176062698192"/><a data-primary="animationstart event" data-type="indexterm" id="idm45176062697456"/> defines the length of&#13;
time, either in seconds (<code>s</code>) or milliseconds (<code>ms</code>), it should take to complete&#13;
one cycle through all the keyframes of the animation.&#13;
If you don’t declare <code>animation-duration</code>, the animation will still&#13;
be run with a duration of <code>0s</code>, with <code>animationstart</code> and&#13;
<code>animationend</code> still being fired even though the animation, taking <code>0s</code>,&#13;
is imperceptible. Negative time values are not permitted for <code>animation-duration</code>.</p>&#13;
&#13;
<p>When specifying a duration, you must include the second (<code>s</code>) or&#13;
millisecond (<code>ms</code>) unit.&#13;
If you have more than one animation, you can include a different&#13;
<code>animation-duration</code> for each by including more than one&#13;
comma-separated time duration:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code>&#13;
   <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">round</code><code class="o">,</code> <code class="n">W</code><code class="p">;</code>&#13;
   <code class="k">animation-duration</code><code class="o">:</code> <code class="m">200ms</code><code class="o">,</code> <code class="m">100ms</code><code class="o">,</code> <code class="m">0.5s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
<p>If you supply an invalid value within your comma-separated list of&#13;
durations (e.g., <code>animation-duration: 200ms, 0, 0.5s</code>) the entire declaration will fail, and it <span class="keep-together">will behave</span> as if <code>animation-duration: 0s</code>&#13;
had been declared; <code>0</code> is not a valid time value. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/duration_broken_value.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Generally, you will want to include an <code>animation-duration</code> value for&#13;
each <code>animation-name</code> provided. If you have only one duration, all the&#13;
animations will last the same amount of time. Having fewer&#13;
<code>animation-duration</code> values than <code>animation-name</code> values in your&#13;
comma-separated property value list will not fail: rather, the values will be repeated as a group. Say we have the following:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">spin</code><code class="o">,</code> <code class="n">round</code><code class="o">,</code> <code class="n">W</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">200ms</code><code class="o">,</code> <code class="m">5s</code><code class="p">;</code>&#13;
       <code class="c">/* same effect as '200ms, 5s, 200ms, 5s' */</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <code>change_bgcolor</code> and <code>round</code> animations will be run over <code>200ms</code>, and the <code>spin</code> and <code>W</code> animations will run for <code>5s</code>.</p>&#13;
&#13;
<p>If you have a greater number of&#13;
<code>animation-duration</code> values than <code>animation-name</code> values, the extra&#13;
values will be ignored. If one of the included animations does not&#13;
exist, the series of animations and animation durations will not fail;&#13;
the failed animation, along with its duration, is ignored:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">change_bgcolor</code><code class="o">,</code> <code class="n">spinner</code><code class="o">,</code> <code class="n">round</code><code class="o">,</code> <code class="n">W</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">200ms</code><code class="o">,</code> <code class="m">5s</code><code class="o">,</code> <code class="m">100ms</code><code class="o">,</code> <code class="m">0.5s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In this example, the duration <code>5s</code> is associated with <code>spinner</code>.&#13;
There is no <code>spinner</code> animation, though, so <code>spinner</code> doesn’t exist, and&#13;
the <code>5s</code> and <code>spinner</code> are both ignored. Should a <code>spinner</code> animation come into existence, it will be applied to <code>&lt;div&gt;</code> elements and last &#13;
<span class="keep-together">5 seconds</span>.<a data-primary="" data-startref="ix_animate_dur" data-type="indexterm" id="idm45176062543568"/><a data-primary="" data-startref="ix_animate_dur_prop" data-type="indexterm" id="idm45176062542560"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Declaring Animation Iterations" data-type="sect2"><div class="sect2" id="defining-animation-iterations">&#13;
<h2>Declaring Animation Iterations</h2>&#13;
&#13;
<p>Simply <a data-primary="animation-iteration-count property" data-type="indexterm" id="ix_animate_iteration_count_prop"/><a data-primary="animation" data-secondary="iteration control" data-type="indexterm" id="ix_animate_iteration"/>including the required <code>animation-name</code> will lead to the animation playing once, and only once, resetting to the initial state at the end of the animation. If you want to iterate through the animation more or fewer times than the default one time, use the <code>animation-iteration-count</code> property.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-iteration-count">&#13;
<h1>animation-iteration-count</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ &lt;<em><code>number</code></em>&gt; | <code>infinite</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>1</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>By default, the animation will occur once (because the default value is <code>1</code>).&#13;
If another value is given for <code>animation-iteration-count</code>, and there isn’t a negative&#13;
value for the <code>animation-delay</code> property, the animation will repeat the&#13;
number of times specified by the value of the property, which can be any&#13;
number or the keyword <code>infinite</code>.  The following declarations will cause their animations to be repeated 2, 5, and 13 times, respectively:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">2</code><code class="p">;</code>&#13;
<code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">5</code><code class="p">;</code>&#13;
<code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">13</code><code class="p">;</code></pre>&#13;
&#13;
<p>If the value of <code>animation-iteration-count</code> is not an integer,&#13;
the animation will still run, but will cut off&#13;
mid-iteration on the final iteration. For example,&#13;
<code>animation-iteration-count: 1.25</code> will iterate through the animation one and a quarter&#13;
times, cutting off 25% of the way through the second iteration. If the value is <code>0.25</code>&#13;
on an 8-second animation, the animation will play about 25% of the way&#13;
through, ending after 2 seconds.</p>&#13;
<p>Negative numbers are not permitted. If an invalid value is given, the default value of <code>1</code> will lead to a default single iteration. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/odditeration.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Interestingly, <code>0</code> is a valid value for the <code>animation-iteration-count</code>&#13;
property. When set to <code>0</code>, the animation still occurs, but zero times. This&#13;
is similar to setting <code>animation-duration: 0s</code>: it will throw both an&#13;
<code>animationstart</code> and an <code>animationend</code> event.</p>&#13;
&#13;
<p>If you are attaching more than one animation to an element or&#13;
pseudo-element, include a comma-separated list of values for&#13;
<code>animation-name</code>, <code>animation-duration</code>, and <code>animation-iteration-count</code>:</p>&#13;
&#13;
<pre class="pagebreak-before" data-code-language="css" data-type="programlisting"><code class="nc">.flag</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">red</code><code class="o">,</code> <code class="nb">white</code><code class="o">,</code> <code class="nb">blue</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="o">,</code> <code class="m">4s</code><code class="o">,</code> <code class="m">6s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">3</code><code class="o">,</code> <code class="m">5</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <code>iteration-count</code> values (and all other animation property values)&#13;
will be assigned in the order of the comma-separated <code>animation-name</code>&#13;
property value. Extra values are ignored. Missing values cause&#13;
the existing values to be repeated, as with <code>animation-iteration-count</code> in the preceding scenario.</p>&#13;
&#13;
<p>The preceding example has more name values than count values, so the&#13;
count values will repeat: <code>red</code> and <code>blue</code> will iterate three times, and&#13;
<code>white</code> will iterate five times. We have the same number of name values&#13;
as duration values; therefore, the duration values will not repeat. The&#13;
<code>red</code> animation lasts 2 seconds, iterating three times, and therefore will run for a total of 6 seconds. The <code>white</code> animation lasts 4 seconds, iterating five times, for a total of 20 seconds. The <code>blue</code> animation is 6 seconds per iteration with the repeated three iterations value, animating for a total of 18 seconds.</p>&#13;
&#13;
<p>Invalid values will invalidate the entire declaration, leading to the animations being played once each.</p>&#13;
&#13;
<p>If we want all three animations to end at the same time, even though&#13;
their durations differ, we can control that with&#13;
<code>animation-iteration-count</code>:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.flag</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">red</code><code class="o">,</code> <code class="nb">white</code><code class="o">,</code> <code class="nb">blue</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="o">,</code> <code class="m">4s</code><code class="o">,</code> <code class="m">6s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">6</code><code class="o">,</code> <code class="m">3</code><code class="o">,</code> <code class="m">2</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In this example, the <code>red</code>, <code>white</code>, and <code>blue</code> animations will last&#13;
for a total of 12 seconds each, because the product of the durations and iteration counts in each case totals 12 &#13;
<span class="keep-together">seconds.</span></p>&#13;
&#13;
<p>You can also include the keyword <code>infinite</code> instead of a number, for a duration. This will make the animation iterate forever, or until something makes it stop, such as removing the animation name, removing the element from the DOM, or pausing the play state.<a data-primary="" data-startref="ix_animate_iteration" data-type="indexterm" id="idm45176062358800"/><a data-primary="" data-startref="ix_animate_iteration_count_prop" data-type="indexterm" id="idm45176062357824"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Setting an Animation Direction" data-type="sect2"><div class="sect2" id="setting-an-animation-direction">&#13;
<h2>Setting an Animation Direction</h2>&#13;
&#13;
<p>With the <code>animation-direction</code> property<a data-primary="animation-direction property" data-type="indexterm" id="ix_animate_dir_prop"/><a data-primary="animation" data-secondary="direction" data-type="indexterm" id="ix_animate_dir"/>, you can control whether the&#13;
animation progresses from the 0% keyframe to the 100% keyframe, or from&#13;
the 100% keyframe to the 0% keyframe. You can also define whether all the&#13;
iterations progress in the same direction, or set every other animation&#13;
cycle to progress in the opposite direction.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-direction">&#13;
<h1>animation-direction</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ <code>normal</code> | <code>reverse</code> | <code>alternate</code> | <code>alternate-reverse</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>normal</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>The <code>animation-direction</code> property defines the direction of the animation’s progression through the keyframes. It has four possible&#13;
values:</p>&#13;
<dl>&#13;
<dt><code>normal</code></dt>&#13;
<dd>&#13;
<p>Each iteration of the animation progresses from the 0% keyframe to the 100% keyframe; this value is the default.</p>&#13;
</dd>&#13;
<dt><code>reverse</code></dt>&#13;
<dd>&#13;
<p>Sets each <a data-primary="reverse keyword, animation-direction" data-type="indexterm" id="idm45176062327616"/>iteration to play in reverse keyframe&#13;
order, always progressing from the 100% keyframe to the 0% keyframe.&#13;
Reversing the animation direction also reverses the <code>animation-timing-function</code> (which is described in <a data-type="xref" href="#changing-the-internal-timing-of-animations">“Changing the Internal Timing of Animations”</a>).</p>&#13;
</dd>&#13;
<dt><code>alternate</code></dt>&#13;
<dd>&#13;
<p>The first <a data-primary="alternate keyword, animation-direction" data-type="indexterm" id="idm45176062324144"/>iteration (and each subsequent odd-numbered iteration) proceeds from 0% to 100%, and the second iteration (and each subsequent even-numbered cycle) reverses direction, proceeding from 100% to 0%. This has an effect only if you have more than one iteration.</p>&#13;
</dd>&#13;
<dt><code>alternate-reverse</code></dt>&#13;
<dd>&#13;
<p>Similar<a data-primary="alternate-reverse keyword, animation-direction" data-type="indexterm" id="idm45176062321808"/> to the <code>alternate</code> value, except it’s the reverse.&#13;
The first iteration (and each subsequent odd-numbered iteration) will proceed from 100% to 0%, and the second iteration (and each subsequent even-numbered cycle) reverses direction, proceeding from 100% to 0%:</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.ball</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">bouncing</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">400ms</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="n">infinite</code><code class="p">;</code>&#13;
    <code class="k">animation-direction</code><code class="o">:</code> <code class="n">alternate</code><code class="o">-</code><code class="n">reverse</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">bouncing</code> <code class="p">{</code>&#13;
    <code class="nt">from</code> <code class="p">{</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">500px</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">to</code> <code class="p">{</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In this example, we are bouncing a ball, but we want to start by dropping it, not by throwing it up in the air: we want it to&#13;
alternate between going down and up, rather than up and down, so&#13;
<code>animation-direction: alternate-reverse</code> is the most appropriate value&#13;
for our needs. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/ball6.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>This is a rudimentary way of making a ball bounce. When balls are&#13;
bouncing, they are moving slowest when they reach their apex and fastest&#13;
when they reach their nadir. We include this example here to illustrate&#13;
the <code>alternate-reverse</code> animation directions. We’ll revisit the bouncing&#13;
animation to make it more realistic with the addition of timing (in <a data-type="xref" href="#changing-the-internal-timing-of-animations">“Changing the Internal Timing of Animations”</a>).&#13;
We’ll also discuss how, when the animation is iterating in the&#13;
reverse direction, the <code>animation-timing-function</code> is reversed.<a data-primary="" data-startref="ix_animate_dir" data-type="indexterm" id="idm45176062267728"/><a data-primary="" data-startref="ix_animate_dir_prop" data-type="indexterm" id="idm45176062266752"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Delaying Animations" data-type="sect2"><div class="sect2" id="delaying-animations">&#13;
<h2>Delaying Animations</h2>&#13;
&#13;
<p>The <code>animation-delay</code> property<a data-primary="animation-delay property" data-type="indexterm" id="ix_animate_delay_prop"/><a data-primary="animation" data-secondary="delaying" data-type="indexterm" id="ix_animate_delay"/> defines how long the browser waits after&#13;
the animation is attached to the element before beginning the first&#13;
animation iteration.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-delay">&#13;
<h1>animation-delay</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>&lt;<em><code>time</code></em>&gt;#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>0s</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>By default, an animation begins iterating as soon as it is applied to the&#13;
element, with a &#13;
<span class="keep-together">0-second</span> delay.  A positive value for <code>animation-delay</code> delays the&#13;
start of the animation until the time listed as the value of&#13;
the property has elapsed.</p>&#13;
&#13;
<p>Negative values for&#13;
<code>animation-delay</code> are allowed and create interesting effects. A negative delay will&#13;
execute the animation immediately but will begin animating the element&#13;
partway through the attached animation. For example, if&#13;
<code>animation-delay: -4s</code> and <code>animation-duration: 10s</code> are set on an&#13;
element, the animation will begin immediately but will start&#13;
approximately 40% of the way through the first animation, and will end &#13;
<span class="keep-together">6 seconds</span> later.</p>&#13;
&#13;
<p>We say <em>approximately</em> because the <a data-primary="animation-timing-function property" data-type="indexterm" id="idm45176062214336"/>animation will not necessarily start at precisely the 40% keyframe block: when the 40% mark of an animation occurs depends on the value of the <code>animation-timing-function</code>. If&#13;
<code>animation-timing-function: linear</code> is set, the animation state will start 40% of the way through the animation:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">div</code> <code class="p">{</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">move</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">10s</code><code class="p">;</code>&#13;
  <code class="k">animation-delay</code><code class="o">:</code> <code class="m">-4s</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">linear</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">move</code> <code class="p">{</code>&#13;
  <code class="nt">from</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateX</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">to</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateX</code><code class="p">(</code><code class="m">1000px</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In this <code>linear</code> animation example, we have a 10-second animation&#13;
with a delay of –4 seconds. In this case, the animation will start&#13;
immediately 40% of the way through the animation, with the <code>&lt;div&gt;</code> translated 400 pixels to the right of its original position, and last only 6 seconds. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/fortypercent.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>If an animation is set to occur 10 times, with a delay of –600 milliseconds and&#13;
an animation duration of 200 milliseconds, the element will start animating right away, at the beginning of the fourth iteration:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.ball</code> <code class="p">{</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">bounce</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">200ms</code><code class="p">;</code>&#13;
  <code class="k">animation-delay</code><code class="o">:</code> <code class="m">-600ms</code><code class="p">;</code>&#13;
  <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">10</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="k">animation-direction</code><code class="o">:</code> <code class="n">alternate</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">bounce</code> <code class="p">{</code>&#13;
  <code class="nt">from</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">to</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">500px</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Instead of animating for 2,000 milliseconds (200 ms × 10 = 2,000 ms, or 2&#13;
seconds), starting in the normal direction, the ball will animate for&#13;
1,400 milliseconds (or 1.4 seconds) with the animation starting immediately—but at the start of the fourth iteration, <em>and</em> in the reverse direction.</p>&#13;
&#13;
<p>The animation starts out in reverse because&#13;
<code>animation-direction</code> is set to <code>alternate</code>, meaning every even-numbered iteration&#13;
proceeds from the 100% keyframe to the 0% <span class="keep-together">keyframe.</span>&#13;
The fourth iteration, which is an even-numbered iteration, is the first&#13;
visible iteration. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/ball_animation_delay_negative.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>In this case, the animation will throw the <code>animationstart</code> event immediately. The&#13;
<code>animationend</code> event will occur at the 1,400-millisecond mark. The ball will be&#13;
tossed up, rather <span class="keep-together">than bounced,</span> throwing six <code>animationiteration</code> events,&#13;
after 200, 400, 600, 800, 1,000, and 1,200 milliseconds. While the iteration count is&#13;
set to 10, we get only six <code>animationiteration</code> events because we are getting only seven iterations; three iterations don’t occur because of the negative <code>animation-delay</code>, and the last iteration <span class="keep-together">concludes</span> at the same time as the&#13;
<code>animationend</code> event. Remember, when an <code class="keep-together">animationiteration</code> event&#13;
would occur at the same time as an <code>animationend</code> event, the&#13;
<code>animationiteration</code> event does not occur.</p>&#13;
&#13;
<p>Let’s take a deeper look at animation events before continuing.<a data-primary="" data-startref="ix_animate_delay" data-type="indexterm" id="idm45176062078656"/><a data-primary="" data-startref="ix_animate_delay_prop" data-type="indexterm" id="idm45176062077680"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exploring Animation Events" data-type="sect2"><div class="sect2" id="animation-events">&#13;
<h2>Exploring Animation Events</h2>&#13;
&#13;
<p>The three types of <a data-primary="events" data-secondary="animation" data-type="indexterm" id="ix_event_animate"/><a data-primary="animation" data-secondary="events" data-type="indexterm" id="ix_animate_event"/>animation events are <code>animationstart</code>, <code>animationiteration</code>, and <code>animationend</code>. Each event has three read-only properties: <code>animationName</code>, <code>elapsedTime</code>, and <code>pseudoElement</code>.</p>&#13;
&#13;
<p>The <code>animationstart</code> event<a data-primary="animationstart event" data-type="indexterm" id="idm45176062068288"/> fires at the start of the animation: after&#13;
the <code>animation-delay</code> (if present) has expired, or immediately if no delay is set. If a negative <code>animation-delay</code> value is present, the&#13;
<code>animationstart</code> will fire immediately, with an <code>elapsedTime</code> equal to&#13;
the absolute value of the delay.</p>&#13;
&#13;
<p>The <code>animationend</code> event<a data-primary="animationend event" data-type="indexterm" id="idm45176062064640"/> fires when the animation finishes. If the&#13;
<code>animation-iteration-count</code> is set to <code>infinite</code>, then as long as the&#13;
<code>animation-duration</code> is set to a time greater than <code>0</code>, the <code>animationend</code> event will&#13;
never fire. If the <code>animation-duration</code> is set or defaults to 0 seconds, even&#13;
when the iteration count is infinite, <code>animationstart</code> and&#13;
<code class="keep-together">animationend</code> will occur virtually simultaneously, and in that order.  These are illustrated in the following code:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.noAnimationEnd</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">myAnimation</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="n">infinite</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nc">.startAndEndSimultaneously</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">myAnimation</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">0s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="n">infinite</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p class="pagebreak-before">The <code>animationiteration</code> event<a data-primary="animationiteration event" data-type="indexterm" id="idm45176062001328"/> fires <em>between</em> iterations. The <code>animationend</code> event <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/events.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> fires at the conclusion of iterations that do not occur at the same time as the conclusion of the animation itself; thus, the <code>animationiteration</code> and <code>animationend</code> events do <em>not</em> fire simultaneously:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.noAnimationIteration</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">myAnimation</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In the <code>.noAnimationIteration</code> example, with the&#13;
<code>animation-iteration-count</code> set to a single occurrence, the animation&#13;
ends at the conclusion of the first and only iteration. Whenever the&#13;
<code>animationiteration</code> event would occur at the same time as an <code class="keep-together">animationend</code> event, the <code>animationend</code> event occurs but&#13;
the <code>animationiteration</code> event does not.</p>&#13;
&#13;
<p>When the <code>animation-iteration-count</code> property is omitted, or when its&#13;
value is <code>1</code> or less, no <code>animationiteration</code> event will be fired. As long&#13;
as an iteration finishes (even if it’s a partial iteration) and another&#13;
iteration begins, if the duration of that subsequent iteration is greater than <code>0s</code>, an&#13;
<code>animationiteration</code> event will be fired:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.noAnimationIteration</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="n">myAnimation</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">4</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">-3s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>When an animation iterates through fewer cycles than listed in the&#13;
<code>animation-iteration-count</code> because of a negative <code>animation-delay</code>, there are no <code>animationiteration</code> events for the cycles that didn’t occur. The preceding example code has no <code>animationiteration</code> events, as the first three cycles do not occur (because of the <code>-3s</code> <code>animation-delay</code>), and the last&#13;
cycle finishes at the same time the animation ends. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/events2.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>In that example, the <code>elapsedTime</code> on the <code>animationstart</code> event is&#13;
<code>3</code>, as it is equal to the absolute value of the delay.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation chaining" data-type="sect3"><div class="sect3" id="animation-chaining">&#13;
<h3>Animation chaining</h3>&#13;
&#13;
<p>You can use <code>animation-delay</code> to <a data-primary="chaining" data-type="indexterm" id="ix_chaining_ch19"/><a data-primary="animation" data-secondary="chaining" data-type="indexterm" id="ix_animate_chain"/>chain animations together so the next&#13;
animation starts immediately after the conclusion of the preceding&#13;
animation:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.rainbow</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">red</code><code class="o">,</code> <code class="nb">orange</code><code class="o">,</code> <code class="nb">yellow</code><code class="o">,</code> <code class="nb">blue</code><code class="o">,</code> <code class="nb">green</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="o">,</code> <code class="m">3s</code><code class="o">,</code> <code class="m">5s</code><code class="o">,</code> <code class="m">7s</code><code class="o">,</code> <code class="m">11s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">3s</code><code class="o">,</code> <code class="m">4s</code><code class="o">,</code> <code class="m">7s</code><code class="o">,</code> <code class="m">12s</code><code class="o">,</code> <code class="m">19s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p class="pagebreak-before">In this example, the <code>red</code> animation starts after a 3-second delay and lasts 1 second, meaning the <code>animationend</code> event occurs at the 4-second mark. This example starts each subsequent animation at the conclusion of the previous animation. This is known as <em>CSS animation chaining</em>. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animationchain.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>By including a 4-second delay on the second animation, the <code>orange</code> animation will begin interpolating the <code>@keyframe</code> property values at the 4-second mark, starting the <code>orange</code> animation immediately at the conclusion of the <code>red</code> animation. The <code>orange</code> animation concludes at the 7-second mark—it lasts 3 seconds, starting after a 4-second delay—which is the delay set on the third, or <code>yellow</code>, animation, making the <code>yellow</code> animation begin immediately after the <code>orange</code> animation ends.</p>&#13;
&#13;
<p>This is an example of chaining animations on a single element. You can&#13;
also use the <code>animation-delay</code> property to chain the animations for&#13;
different elements:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nt">li</code><code class="nd">:first-of-type</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">3s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">2</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">orange</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">3s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">4s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">3</code><code class="o">)</code>  <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">5s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">4</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">12s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">5</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">11s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">19s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>If you want a group of list items to animate in order, <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animationchain2a.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> appearing as if&#13;
the animations were chained in sequence, the <code>animation-delay</code> of each&#13;
list item should be the combined time of the <code>animation-duration</code> and&#13;
<code>animation-delay</code> of the previous animation.</p>&#13;
&#13;
<p>While you can use JavaScript and the <code>animationend</code> event<a data-primary="animationend event" data-type="indexterm" id="ix_animationend"/> from one animation to determine when to attach a subsequent animation, which we discuss shortly, the <code>animation-delay</code> property is an appropriate method of using CSS&#13;
animation properties to chain animations. There is one caveat: animations are the lowest priority on the UI thread. Therefore, if you&#13;
have a script running that is occupying the UI&#13;
thread, depending on the browser and which properties <span class="keep-together">are being</span> animated&#13;
and what property values are set on the element, the browser may let the delays expire while waiting&#13;
until the UI thread is available before starting more animations.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45176035626592">&#13;
<h1>Animation Performance</h1>&#13;
<p>Some, but not all, <a data-primary="performance issues" data-secondary="animations" data-type="indexterm" id="idm45176035625216"/><a data-primary="animation" data-secondary="performance" data-type="indexterm" id="idm45176035624208"/><a data-primary="animation" data-secondary="UI thread usage by" data-type="indexterm" id="idm45176035623264"/>animations take place on the UI&#13;
thread. In most browsers, when opacity or transforms are being animated,&#13;
the animation takes place on the graphics processing unit (GPU) instead of the central processing unit (CPU), and doesn’t&#13;
rely on the UI thread’s availability. <a data-primary="animation" data-secondary="visual stuttering of (jank)" data-type="indexterm" id="idm45176035622192"/>If those properties are not part&#13;
of the animation, the unavailability of the UI thread can lead to visual stutters (sometimes called <em>jank</em>):</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="c">/* Don’t do this */</code>&#13;
<code class="o">*</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateZ</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Putting an element into 3D space by using 3D transforms (see <a data-type="xref" href="ch17.html#transforms">Chapter 17</a>) moves that element into its own layer, allowing for jank-free animations. For this reason, the <code>translateZ</code> <span class="keep-together">hack—the</span> thing we just told you not to do—became overused, and led to the creation of the <code>will-change</code> property (see <a data-type="xref" href="#will-change">“Using the will-change Property”</a> for more).</p>&#13;
&#13;
<p>While putting a few elements onto their own&#13;
layers with this hack is OK, some devices have limited video memory.&#13;
Each independent layer you create uses video memory and takes time&#13;
to move from the UI thread to the composited layer on the GPU. The&#13;
more layers you create, the higher the performance cost.</p>&#13;
&#13;
<p>For <a data-primary="box-model properties" data-type="indexterm" id="idm45176035614128"/>improved performance, whenever possible, include <code>transform</code> and&#13;
<code>opacity</code> in your animations rather than <code>top</code>, <code>left</code>, <code>bottom</code>, <code>right</code>, and <code>visibility</code>.&#13;
Not only does it improve performance by using the GPU over the CPU, but when&#13;
you change box-model properties, the browser needs to reflow and&#13;
repaint, which is bad for performance. Just don’t put everything on the&#13;
GPU, or you’ll run into different &#13;
<span class="keep-together">performance</span> issues.</p>&#13;
</div></aside>&#13;
&#13;
<p>If you are able to rely on JavaScript, another way of chaining&#13;
animations is listening for <code>animationend</code> events to start subsequent&#13;
animations: <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animationchain2.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="o">&lt;</code><code class="nt">script</code><code class="o">&gt;</code>&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">0</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">1</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'orange'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">1</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">2</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'yellow'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">2</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">3</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'green'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">3</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">4</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'blue'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
<code class="o">&lt;/</code><code class="nt">script</code><code class="o">&gt;</code>&#13;
&#13;
<code class="o">&lt;</code><code class="nt">style</code><code class="o">&gt;</code>&#13;
  <code class="nt">li</code><code class="nd">:first-of-type</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">2</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">3s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">3</code><code class="o">)</code>  <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">5s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">4</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">5</code><code class="o">)</code>  <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">11s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="o">&lt;/</code><code class="nt">style</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>In this example, there is an event handler on each of the first four list&#13;
items, listening for that list item’s <code>animationend</code> event. When the&#13;
<code>animationend</code> event occurs, the event listeners add an <code>animation-name</code>&#13;
to the subsequent list item.</p>&#13;
&#13;
<p>As you can see in the styles, this animation chaining method doesn’t employ <code>animation-delay</code> at all. Instead, the JavaScript event listeners&#13;
attach animations to each element by setting the <code>animation-name</code>&#13;
property when the <code>animationend</code> event <span class="keep-together">is thrown.</span></p>&#13;
&#13;
<p>You’ll also note that the <code>animation-name</code> is included&#13;
for only the first list item. The other list items have only an <code>animation-duration</code> with no <code>animation-name</code>, and therefore no attached&#13;
animations. Adding <code>animation-name</code> via JavaScript is what attaches and starts the&#13;
animation, at least in this example. To start or restart an animation, the animation name&#13;
must be removed and then added back—at which point all the&#13;
animation properties take effect, including <code>animation-delay</code>.</p>&#13;
&#13;
<p class="pagebreak-before">Instead of writing the following:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="o">&lt;</code><code class="nt">script</code><code class="o">&gt;</code>&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">2</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">3</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'green'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">3</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">4</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'blue'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
    <code class="nt">false</code> <code class="o">);</code>&#13;
<code class="o">&lt;/</code><code class="nt">script</code>&#13;
&#13;
<code class="o">&lt;</code><code class="nt">style</code><code class="o">&gt;</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">4</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">5</code><code class="o">)</code>  <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">11s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="o">&lt;/</code><code class="nt">style</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>we could have written this:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="o">&lt;</code><code class="nt">script</code><code class="o">&gt;</code>&#13;
  <code class="nt">document</code><code class="nc">.querySelectorAll</code><code class="o">(</code><code class="s1">'li'</code><code class="o">)[</code><code class="nt">2</code><code class="o">]</code><code class="nc">.addEventListener</code><code class="o">(</code> <code class="s1">'animationend'</code><code class="o">,</code>&#13;
    <code class="o">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">3</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'green'</code><code class="p">;</code>&#13;
        <code class="n">document</code><code class="o">.</code><code class="n">querySelectorAll</code><code class="p">(</code><code class="s1">'li'</code><code class="p">)[</code><code class="m">4</code><code class="p">]</code><code class="o">.</code><code class="n">style</code><code class="o">.</code><code class="n">animationName</code> <code class="o">=</code> <code class="s1">'blue'</code><code class="p">;</code>&#13;
    <code class="p">}</code><code class="o">,</code>&#13;
  <code class="nt">false</code> <code class="o">);</code>&#13;
<code class="o">&lt;/</code><code class="nt">script</code><code class="o">&gt;</code>&#13;
&#13;
<code class="o">&lt;</code><code class="nt">style</code><code class="o">&gt;</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">4</code><code class="o">)</code> <code class="p">{</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">li</code><code class="nd">:nth-of-type</code><code class="o">(</code><code class="nt">5</code><code class="o">)</code>  <code class="p">{</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">7s</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">11s</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="o">&lt;/</code><code class="nt">style</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>When the <code>blue</code> animation name is added to the fifth list item at the same time we added <code>green</code>, the delay on the fifth&#13;
element takes effect at that point in time and starts expiring.<a data-primary="" data-startref="ix_animationend" data-type="indexterm" id="idm45176035109984"/></p>&#13;
&#13;
<p>While changing the values of animation properties (other than name) on the element during an animation has no effect on the animation,&#13;
removing or adding an <code>animation-name</code> does have an impact. You can’t&#13;
change the animation duration from <code>100ms</code> to <code>400ms</code> in the middle of an&#13;
animation. You can’t switch the delay from <code>-200ms</code> to <code>5s</code> once the delay&#13;
has already been applied. You can, however, stop and start the animation&#13;
by removing it and reapplying it. In the preceding JavaScript example, we&#13;
started the animations by applying them to the elements.</p>&#13;
&#13;
<p>In addition, setting <code>display: none</code> on an element terminates <span class="keep-together">any&#13;
animation.</span> Updating the <code>display</code> back to a visible value restarts the animation from the beginning. If <code>animation-delay</code> has a positive value, the delay will have to expire before the&#13;
<code class="keep-together">animationstart</code> event happens and any animations occur. If the delay is&#13;
negative, the animation will start midway through an iteration, exactly as&#13;
it would have if the animation had been applied any other way.<a data-primary="" data-startref="ix_animate_chain" data-type="indexterm" id="idm45176035012752"/><a data-primary="" data-startref="ix_chaining_ch19" data-type="indexterm" id="idm45176035011904"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation iteration delay" data-type="sect3"><div class="sect3" id="animation-iteration-delay">&#13;
<h3>Animation iteration delay</h3>&#13;
&#13;
<p>What is an <a data-primary="animation" data-secondary="iteration control" data-type="indexterm" id="ix_animate_iteration_cont"/>animation iteration delay? Sometimes you want an animation to&#13;
occur multiple times but want to wait a specific amount of time between&#13;
each iteration.</p>&#13;
&#13;
<p>While there is no such thing as an animation iteration delay property, you&#13;
can employ the <code>animation-delay</code> property, incorporate delays within&#13;
your keyframe declaration, or use JavaScript to fake it. The best method&#13;
for faking it depends on the number of iterations, performance, and&#13;
whether the delays are all equal in length.</p>&#13;
&#13;
<p>Let’s say you want your element to grow three times, but want to wait 4&#13;
seconds between each 1-second iteration. You can include the delay within your keyframe definition and iterate through it three times:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.animate3times</code> <code class="p">{</code>&#13;
    <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="k">animation</code><code class="o">:</code> <code class="n">color_and_scale_after_delay</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">3</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">5s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">color_and_scale_after_delay</code> <code class="p">{</code>&#13;
    <code class="nt">80%</code> <code class="p">{</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">1</code><code class="p">);</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">80.1%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">0</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">1</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Note the first keyframe selector is at the 80% mark and matches the&#13;
default state. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animation-iteration-delay1.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> This will animate your element three times: it stays in the default state for 80% of the 5-second animation (not changing for 4 seconds) and then moves from green to yellow and small to big over the last 1 second of the animation before iterating again, stopping after three iterations.</p>&#13;
&#13;
<p>This method works for any number of iterations of the animation.&#13;
Unfortunately, it is a good solution only if the delay between&#13;
each iteration is identical and you don’t want to reuse the animation&#13;
with any other timing, such as a delay of 6 seconds. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animation-iteration-delay.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> If you want&#13;
to change the delay between each iteration while not changing the&#13;
duration of the change in size and color, you have to write a new&#13;
<code>@keyframes</code> definition.</p>&#13;
&#13;
<p>To enable multiple iteration delays between animations, we could create&#13;
a single animation and bake the effect of three different delays into the animation keyframe definition:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.animate3times</code> <code class="p">{</code>&#13;
    <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="k">animation</code><code class="o">:</code> <code class="n">color_and_scale_3_times</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">15s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">color_and_scale_3_times</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code><code class="o">,</code> <code class="nt">13.32%</code><code class="o">,</code> <code class="nt">20.01%</code><code class="o">,</code> <code class="nt">40%</code><code class="o">,</code> <code class="nt">46.67%</code><code class="o">,</code> <code class="nt">93.32%</code> <code class="p">{</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">1</code><code class="p">);</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
    <code class="nt">13.33%</code><code class="o">,</code> <code class="nt">40.01%</code><code class="o">,</code> <code class="nt">93.33%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">0</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
    <code class="nt">20%</code><code class="o">,</code> <code class="nt">46.66%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">1</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This method may be more difficult to code and maintain, however. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animation-iteration-delay2.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a>&#13;
It works for only a single cycle of the animation. To change the number of animations or the iteration delay durations, another <code>@keyframes</code> declaration would be required. This example is even less robust than the previous one, but it does allow for different between-iteration delays.</p>&#13;
&#13;
<p>A solution is specifically allowed in the animation specification: declare an animation multiple times, each&#13;
with a different <code>animation-delay</code> value: <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animation-iteration-delay3.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.animate3times</code> <code class="p">{</code>&#13;
  <code class="k">animation</code><code class="o">:</code> <code class="n">color_and_scale</code><code class="o">,</code> <code class="n">color_and_scale</code><code class="o">,</code> <code class="n">color_and_scale</code><code class="p">;</code>&#13;
  <code class="k">animation-delay</code><code class="o">:</code> <code class="m">0</code><code class="o">,</code> <code class="m">4s</code><code class="o">,</code> <code class="m">10s</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">color_and_scale</code> <code class="p">{</code>&#13;
    <code class="nt">0%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">green</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">0</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nt">100%</code> <code class="p">{</code>&#13;
        <code class="k">background-color</code><code class="o">:</code> <code class="nb">yellow</code><code class="p">;</code>&#13;
        <code class="k">transform</code><code class="o">:</code> <code class="n">scale</code><code class="p">(</code><code class="m">1</code><code class="o">.</code><code class="m">5</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Here, we’ve attached the animation three times, each with a different delay.&#13;
In this case, each animation iteration concludes before the next one&#13;
proceeds.</p>&#13;
<p>If animations overlap while they’re concurrently animating, the values&#13;
will be the values from the last declared animation. As is true whenever multiple animations are changing an element’s property at the&#13;
same time, the animation that occurs last in the sequence of animation&#13;
names will override any animations occurring before it in the list of&#13;
names. In declaring three <code>color_and_scale</code> animations but at different&#13;
intervals, the value of the property of the last iteration of the&#13;
<code>color_and_scale</code> animation will override the values of the previous&#13;
ones that haven’t yet concluded. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/animation-iteration-delay4.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>The safest, most robust, and most cross-browser-friendly method of faking&#13;
an animation iteration delay property is to use JavaScript’s  animation events. Detach the animation from the element on <code>animationend</code>, and  then reattach it after the iteration delay. If <span class="keep-together">all the</span> iteration delays are the same, you can use <code>setInterval</code>; if they vary, use <code class="keep-together">setTimeout</code>:<a data-primary="" data-startref="ix_animate_event" data-type="indexterm" id="idm45176034713152"/><a data-primary="" data-startref="ix_event_animate" data-type="indexterm" id="idm45176034658448"/><a data-primary="" data-startref="ix_animate_iteration_cont" data-type="indexterm" id="idm45176034657600"/></p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kd">let</code> <code class="nx">iteration</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">el</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'myElement'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">el</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'animationend'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kd">let</code> <code class="nx">time</code> <code class="o">=</code> <code class="o">++</code><code class="nx">iteration</code> <code class="o">*</code> <code class="mi">1000</code><code class="p">;</code>&#13;
&#13;
  <code class="nx">el</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">remove</code><code class="p">(</code><code class="s1">'animationClass'</code><code class="p">);</code>&#13;
&#13;
  <code class="nx">setTimeout</code><code class="p">(</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">el</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="s1">'animationClass'</code><code class="p">);</code>&#13;
  <code class="p">},</code> <code class="nx">time</code><code class="p">);</code>&#13;
&#13;
<code class="p">});</code></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Changing the Internal Timing of Animations" data-type="sect2"><div class="sect2" id="changing-the-internal-timing-of-animations">&#13;
<h2>Changing the Internal Timing of Animations</h2>&#13;
&#13;
<p>All right!  The <a data-primary="animation-timing-function property" data-type="indexterm" id="ix_animate_time_func_prop"/><a data-primary="timing functions" data-secondary="animations" data-type="indexterm" id="ix_time_func_animate"/><a data-primary="animation" data-secondary="timing of" data-type="indexterm" id="ix_animate_time"/>scripting was fun, but let’s get back to straight CSS and talk about timing functions.&#13;
Similar to the <code>transition-timing-function</code> property, the&#13;
<code>animation-timing-function</code> property describes how the animation will&#13;
progress from one keyframe to &#13;
<span class="keep-together">the next.</span></p>&#13;
<aside class="pagebreak-before" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-timing-function">&#13;
<h1>animation-timing-function</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ <code>ease</code> | <code>linear</code> | <code>ease-in</code> | <code>ease-out</code> | <code>ease-in-out</code> | <code>step-start</code> | <code class="keep-together">step-end</code> | <code>steps(</code>&lt;<em><code>integer</code></em>&gt;<code>, start)</code> | <code>steps(</code>&lt;<em><code>integer</code></em>&gt;<code>, end)</code> | <code class="keep-together">cubic-bezier</code><code>(</code>&lt;<em><code>number</code></em>&gt;, &lt;<em><code>number</code></em>&gt;, &lt;<em><code>number</code></em>&gt;, &lt;<em><code>number</code></em>&gt;<code>)</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>ease</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>Other than the step&#13;
timing functions, described in <a data-type="xref" href="#step-timing-functions">“Using step timing functions”</a>, the timing functions are all Bézier&#13;
curves. Just like the <code>transition-timing-function</code>, the CSS specification provides for five predefined Bézier curve&#13;
keywords, which we described in the preceding chapter (see <a data-type="xref" href="ch18.html#cubic_bezier">Table 18-1</a> and <a data-type="xref" href="ch18.html#tr_fig0203">Figure 18-3</a>).</p>&#13;
&#13;
<p>A handy tool to visualize <a data-primary="cubic-Bézier timing functions" data-type="indexterm" id="ix_cubic_bezier_func3"/><a data-primary="Bézier curve functions" data-type="indexterm" id="ix_bezier_func3"/>Bézier curves and to create your own is <a href="https://cubic-bezier.com">Lea Verou’s cubic Bézier visualizer</a>.</p>&#13;
&#13;
<p>The <a data-primary="ease-in-out timing function" data-type="indexterm" id="idm45176034526864"/><a data-primary="ease timing function" data-type="indexterm" id="idm45176034526192"/>default <code>ease</code> has a slow start, then speeds up, and ends slowly.&#13;
This <a data-primary="linear timing function" data-type="indexterm" id="idm45176034524944"/>function is similar to <code>ease-in-out</code>, which has a greater acceleration at the beginning. The <code>linear</code> timing function, as the name describes, creates an animation that animates at a constant speed.</p>&#13;
&#13;
<p>The <code>ease-in</code> timing<a data-primary="ease-in timing function" data-type="indexterm" id="idm45176034522432"/><a data-primary="ease-out timing function" data-type="indexterm" id="idm45176034521696"/> function creates an animation that is slow to start, gains speed, and then stops abruptly.&#13;
The opposite <code>ease-out</code> timing function starts at full speed, then slows&#13;
progressively as it reaches the conclusion of the animation iteration.</p>&#13;
&#13;
<p>If none of these suit your needs, you can create your own Bézier curve&#13;
timing function by passing four values, such as the following:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">cubic</code><code class="o">-</code><code class="n">bezier</code><code class="p">(</code><code class="m">0</code><code class="o">.</code><code class="m">2</code><code class="o">,</code> <code class="m">0</code><code class="o">.</code><code class="m">4</code><code class="o">,</code> <code class="m">0</code><code class="o">.</code><code class="m">6</code><code class="o">,</code> <code class="m">0</code><code class="o">.</code><code class="m">8</code><code class="p">);</code></pre>&#13;
&#13;
<p>While the <em>x</em> values must be between 0 and 1, by using values for <em>y</em> that&#13;
are greater than 1 or less than 0, you can create a bouncing effect,&#13;
making the animation bounce up and down between values, rather than&#13;
going consistently in a single direction.  Consider the following timing function, whose rather outlandish Bézier curve is (partly) illustrated in <a data-type="xref" href="#an-outlandish-bezier-curve">Figure 19-1</a>:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.snake</code> <code class="p">{</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">shrink</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">10s</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">cubic</code><code class="o">-</code><code class="n">bezier</code><code class="p">(</code><code class="m">0</code><code class="o">,</code> <code class="m">4</code><code class="o">,</code> <code class="m">1</code><code class="o">,</code> <code class="m">-4</code><code class="p">);</code>&#13;
  <code class="k">animation-fill-mode</code><code class="o">:</code> <code class="nb">both</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">shrink</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code> <code class="p">{</code>&#13;
    <code class="k">width</code><code class="o">:</code> <code class="m">500px</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">100%</code> <code class="p">{</code>&#13;
    <code class="k">width</code><code class="o">:</code> <code class="m">100px</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<figure><div class="figure" id="an-outlandish-bezier-curve">&#13;
<img alt="css5 1901" src="assets/css5_1901.png"/>&#13;
<h6><span class="label">Figure 19-1. </span>An outlandish Bézier curve</h6>&#13;
</div></figure>&#13;
&#13;
<p>This <code>animation-timing-function</code> curve makes the animated property’s values go&#13;
outside the boundaries of the values set in the <code>0%</code> and <code>100%</code>&#13;
keyframes. In this example, we are shrinking an element from <code>500px</code> to&#13;
<code>100px</code>. However, because of the <code>cubic-bezier</code> values, the element&#13;
we’re shrinking will actually grow to be wider than the <code>500px</code> width&#13;
defined in the <code>0%</code> keyframe and narrower than the <code>100px</code> width&#13;
defined in the <code>100%</code> keyframe, as shown in <a data-type="xref" href="#an_fig0303">Figure 19-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="an_fig0303">&#13;
<img alt="css5 1902" src="assets/css5_1902.png"/>&#13;
<h6><span class="label">Figure 19-2. </span>Effect of outlandish Bézier curve</h6>&#13;
</div></figure>&#13;
&#13;
<p>In this scenario, the element starts with a width of <code>500px</code>, defined in the <code>0%</code>&#13;
keyframe. It then quickly shrinks to a width of about <code>40px</code>, which&#13;
is narrower than <code>width: 100px</code> defined in the <code>100%</code>&#13;
keyframe. From there, it slowly expands to about <code>750px</code> wide, which is larger&#13;
than the original width of <code>500px</code>. It then quickly shrinks back to&#13;
<code>width: 100px</code>, ending the animation iteration.&#13;
<a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/cubicbezierprint.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>You may have realized that the curve created by our animation is the same&#13;
curve as the Bézier curve. Just as the S-curve goes outside the normal bounding box, the width&#13;
of the animated element goes narrower than the smaller width we set of <code>100px</code>,&#13;
and wider than the larger width we set of <code>500px</code>.</p>&#13;
&#13;
<p>The Bézier curve has the appearance of a snake because one <em>y</em> coordinate is positive, and the other negative. If&#13;
both are positive values greater than 1 or both are negative values less than –1,&#13;
the Bézier curve is arc-shaped, going above or below one of the values&#13;
set, but not bouncing out of bounds on both ends like the S-curve.</p>&#13;
&#13;
<p>Any timing function declared with <code>animation-timing-function</code> sets the&#13;
timing for the normal animation direction, when the animation is&#13;
progressing from the <code>0%</code> keyframe to the <code>100%</code> keyframe.&#13;
When the animation is running&#13;
in the reverse direction, from the <code>100%</code> keyframe to the <code>0%</code> keyframe, the&#13;
animation timing function is reversed.<a data-primary="" data-startref="ix_bezier_func3" data-type="indexterm" id="idm45176034369152"/><a data-primary="" data-startref="ix_cubic_bezier_func3" data-type="indexterm" id="idm45176034368176"/></p>&#13;
&#13;
<p>Remember the bouncing-ball example in <a data-type="xref" href="#animation-direction">“animation-direction”</a>?  The bouncing wasn’t very realistic, because the original example defaulted to <code>ease</code> for its timing function.&#13;
With <code>animation-timing-function</code>, we can apply <code>ease-in</code> to the animation so that when the ball is dropping, it gets faster as it nears&#13;
its nadir at the <code>100%</code> keyframe.&#13;
When it is bouncing upward, it animates in the reverse&#13;
direction, from <code>100%</code> to <code>0%</code>, so the <code>animating-timing-function</code> is&#13;
reversed as well—in this case, to <code>ease-out</code>—slowing down as it reaches the apex:&#13;
 <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/ball1.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.ball</code> <code class="p">{</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">bounce</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">1s</code><code class="p">;</code>&#13;
  <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="n">infinite</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="k">animation-direction</code><code class="o">:</code> <code class="n">alternate</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="k">@keyframes</code> <code class="nt">bounce</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">100%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">500px</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using step timing functions" data-type="sect3"><div class="sect3" id="step-timing-functions">&#13;
<h3>Using step timing functions</h3>&#13;
&#13;
<p>The step <a data-primary="step-end timing function" data-type="indexterm" id="ix_step_end_time_func"/><a data-primary="step-start timing function" data-type="indexterm" id="ix_step_strt_time_func"/><a data-primary="step timing functions" data-type="indexterm" id="ix_step_time_func2"/>timing functions, <code>step-start</code>, <code>step-end</code>, and <code>steps()</code>,&#13;
aren’t Bézier curves.  They’re not curves at all. Rather, they’re <em>tweening</em> definitions.  The <code>steps()</code> function is most useful when it comes to character or sprite animation.</p>&#13;
&#13;
<p>The <code>steps()</code> function divides the animation into a series of&#13;
equal-length steps. The function takes two parameters: the number of steps and the change point (more on that in a moment).</p>&#13;
&#13;
<p>The number-of-steps parameter value must be a&#13;
positive integer. The animation length will be divided equally into the number&#13;
of steps provided. For example, if the animation duration is 1 second&#13;
and the number of steps is 5, the animation will be divided into five&#13;
200-millisecond steps, with the element being redrawn to the page five times, at&#13;
200-millisecond intervals, moving 20% through the animation at each interval.</p>&#13;
&#13;
<p>To understand how this works, think of a flip book.&#13;
Each page in a flip book contains a single drawing or picture that changes&#13;
slightly from one page to the next, like one frame from a movie reel stamped onto each page. When the pages of a flip book are&#13;
rapidly flipped through (hence the name), the pictures appear as an&#13;
animated motion. You can create similar animations with CSS by using an&#13;
image sprite, the <code>background-position</code> property, and the <code>steps()</code>&#13;
timing function.</p>&#13;
&#13;
<p><a data-type="xref" href="#an_sprite">Figure 19-3</a> shows an image sprite containing several images that change just slightly,&#13;
like the drawings on the individual pages of a flip book.</p>&#13;
&#13;
<figure><div class="figure" id="an_sprite">&#13;
<img alt="css5 1903" src="assets/css5_1903.png"/>&#13;
<h6><span class="label">Figure 19-3. </span>Sprite of dancing</h6>&#13;
</div></figure>&#13;
&#13;
<p>We put all of our slightly differing images into a single image called a <em>sprite</em>. Each image in our sprite is a frame in the&#13;
single animated image we’re creating.</p>&#13;
&#13;
<p>We then create a container element that is the size of a single image of our&#13;
sprite, and attach the sprite as the container element’s background image. We animate the <code>background-position</code>, using the <code>steps()</code>&#13;
timing function so we see only a single instance of the changing image&#13;
of our sprite at a time. The number of steps in our <code>steps()</code> timing&#13;
function is the number of occurrences of the image in our sprite. The&#13;
number of steps defines how many stops our background image makes to&#13;
complete a single animation.</p>&#13;
&#13;
<p>The sprite in <a data-type="xref" href="#an_sprite">Figure 19-3</a> has 22 images, each 56 × 100 pixels. The total size of our&#13;
sprite is 1,232 × 100 pixels. We set our container to the individual image&#13;
size: 56 × 100 pixels. We set our sprite as our background image: the&#13;
initial or default value of <code>background-position</code> is <code>top left</code>, which&#13;
is the same as <code>0 0</code>. Our image will appear at <code>0 0</code>, which is a good&#13;
default. Browsers that don’t support CSS animation, like Opera Mini, will simply&#13;
display the first image from our sprite:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.dancer</code> <code class="p">{</code>&#13;
  <code class="k">height</code><code class="o">:</code> <code class="m">100px</code><code class="p">;</code>&#13;
  <code class="k">width</code><code class="o">:</code> <code class="m">56px</code><code class="p">;</code>&#13;
  <code class="k">background-image</code><code class="o">:</code> <code class="sx">url(../images/dancer.png)</code><code class="p">;</code>&#13;
  <code class="o">....</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The trick is to use <code>steps()</code> to change the <code>background-position</code> value&#13;
so that each frame is a view of a separate image within the sprite.&#13;
Instead of sliding in the background image from the left, the <code>steps()</code>&#13;
timing function will pop in the background image in the number of steps&#13;
we declared.</p>&#13;
&#13;
<p>So we create an animation that simply changes the left-right value&#13;
of the <code>background-position</code>. The image is 1,232 pixels wide, so we move&#13;
the background image from <code>0 0</code>, which is the left top, to&#13;
<code>0 -1232px</code>, putting the sprite fully outside of our 56 × 100 pixel&#13;
<code>&lt;div&gt;</code> viewport.</p>&#13;
&#13;
<p>The values of <code>-1232px 0</code> will move the image completely to the left,&#13;
outside of our containing block viewport. It will no longer show up as a&#13;
background image in our 100 × 56 pixel <code>&lt;div&gt;</code> at the 100% mark unless&#13;
<code>background-repeat</code> is set to repeat along the x-axis. We don’t want that to happen!</p>&#13;
&#13;
<p>This is what we want:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">dance_in_place</code> <code class="p">{</code>&#13;
  <code class="nt">from</code> <code class="p">{</code>&#13;
      <code class="k">background-position</code><code class="o">:</code> <code class="m">0</code> <code class="m">0</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">to</code> <code class="p">{</code>&#13;
      <code class="k">background-position</code><code class="o">:</code> <code class="m">-1232px</code> <code class="m">0</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nc">.dancer</code> <code class="p">{</code>&#13;
  <code class="o">....</code>&#13;
  <code class="k">background-image</code><code class="o">:</code> <code class="sx">url(../images/dancer.png)</code><code class="p">;</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">dance_in_place</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">4s</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">steps</code><code class="p">(</code><code class="m">22</code><code class="o">,</code> <code class="n">end</code><code class="p">);</code>&#13;
  <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="n">infinite</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>What may have seemed like a&#13;
complex animation is very simple: just as in a flip book, we see one&#13;
frame of the sprite at a time. Our keyframe animation simply moves the&#13;
background. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/sprite.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>So that covers the first parameter, the number of steps.&#13;
The second parameter takes one of a few values: <code>step-start</code>, <code>start</code>, <code>step-end</code>,&#13;
<code>end</code>, <code>jump-none</code>, and <code>jump-both</code>. The given value specifies whether the change for the first step’s interval takes place at the beginning or at the end of a given interval. (<a data-type="xref" href="ch18.html#x-transitions">Chapter 18</a> describes these values in more detail.)</p>&#13;
&#13;
<p>With the default value, <code>end</code>, or its equivalent <code>step-end</code>, the change take place at the end of the first step.  In other words, given 200-ms step lengths, the first change in the animation will not occur until 200 ms into the animation’s overall duration.  With <code>start</code> or <code>step-start</code>, the first change will take place at the beginning of the first step’s interval; that is to say, the instant the animation begins.  <a data-type="xref" href="#step-timing-change-point">Figure 19-4</a> provides a timeline diagram of how the two values work, based on the following styles:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">grayfade</code> <code class="p">{</code>&#13;
    <code class="nt">from</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="m">#BBB</code><code class="p">;}</code>&#13;
    <code class="nt">to</code> <code class="p">{</code><code class="k">background-color</code><code class="o">:</code> <code class="m">#333</code><code class="p">;}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nc">.slowfader</code>  <code class="p">{</code><code class="k">animation</code><code class="o">:</code> <code class="n">grayfade</code> <code class="m">1s</code> <code class="n">steps</code><code class="p">(</code><code class="m">5</code><code class="o">,</code><code class="n">end</code><code class="p">);}</code>&#13;
<code class="nc">.quickfader</code> <code class="p">{</code><code class="k">animation</code><code class="o">:</code> <code class="n">grayfade</code> <code class="m">1s</code> <code class="n">steps</code><code class="p">(</code><code class="m">5</code><code class="o">,</code><code class="n">start</code><code class="p">);}</code></pre>&#13;
&#13;
<figure><div class="figure" id="step-timing-change-point">&#13;
<img alt="css5 1904" src="assets/css5_1904.png"/>&#13;
<h6><span class="label">Figure 19-4. </span>Visualizing start and end change points</h6>&#13;
</div></figure>&#13;
&#13;
<p>The boxes embedded into each timeline represent the background color during that step interval.  Notice that in the <code>end</code> timeline, the first interval is the same as the background before the animation started.  This is because the animation waits until the end of the first frame to make the color change for the first step (the color between “Step 1” and &#13;
<span class="keep-together">“Step 2”).</span></p>&#13;
&#13;
<p>In the <code>start</code> timeline, on the other hand, the first interval makes that color change at the start of the interval, instantly switching from the starting background color to the color between “Step 1” and “Step 2.”  This is sort of like jumping ahead one interval, an impression reinforced by the fact that the background color in “Step 2” of the <code>end</code> timeline is the same as that in “Step 1” of the <code>start</code> timeline.</p>&#13;
&#13;
<p>A similar effect can be seen at the end of each animation, where the background in the fifth step of the <code>start</code> timeline is the same as the ending background color.  In the <code>end</code> timeline, it’s the color at the point between “Step 4” and “Step 5,” and doesn’t switch to the ending background color until the end of “Step 5,” when the animation is finished.</p>&#13;
&#13;
<p>The change parameter can be hard to keep straight. If it helps, think of it&#13;
this way: in a normal animation direction, the <code>start</code> value “skips” the 0% keyframe, because it makes the first change as soon as the animation starts, and the <code>end</code> value&#13;
“skips” the <code>100%</code> &#13;
<span class="keep-together">keyframe.</span></p>&#13;
&#13;
<p>The <code>step-start</code> value is equal to <code>steps(1, start)</code>, with only a single&#13;
step displaying the <code>100%</code> keyframe. The <code>step-end</code> value is equal to&#13;
<code>steps(1, end)</code>, which displays only the <code>0%</code> keyframe.<a data-primary="" data-startref="ix_step_time_func2" data-type="indexterm" id="idm45176034033264"/><a data-primary="" data-startref="ix_step_end_time_func" data-type="indexterm" id="idm45176034032256"/><a data-primary="" data-startref="ix_step_strt_time_func" data-type="indexterm" id="idm45176034031312"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animating the timing function" data-type="sect3"><div class="sect3" id="animating-the-timing-function">&#13;
<h3>Animating the timing function</h3>&#13;
&#13;
<p>The <code>animation-timing-function</code> is not an animatable property, but it&#13;
can be included in keyframes to alter the current timing of the&#13;
animation.</p>&#13;
&#13;
<p>Unlike animatable&#13;
properties, the <code>animation-timing-function</code> values aren’t interpolated&#13;
over time. When included in a keyframe within the <code>@keyframes</code> definition,&#13;
the timing function for the properties declared within that same keyframe will change to the new <code>animation-timing-function</code>&#13;
value when that keyframe is reached, as shown in <a data-type="xref" href="#an_timing">Figure 19-5</a>:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.pencil</code> <code class="p">{</code><code class="k">animation</code><code class="o">:</code> <code class="n">W</code> <code class="m">3s</code> <code class="n">infinite</code> <code class="n">linear</code><code class="p">;}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">width</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code> <code class="p">{</code>&#13;
    <code class="k">width</code><code class="o">:</code> <code class="m">200px</code><code class="p">;</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">linear</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">50%</code> <code class="p">{</code>&#13;
    <code class="k">width</code><code class="o">:</code> <code class="m">350px</code><code class="p">;</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">100%</code> <code class="p">{</code>&#13;
    <code class="k">width</code><code class="o">:</code> <code class="m">500px</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In the preceding example, as shown in <a data-type="xref" href="#an_timing">Figure 19-5</a>, halfway through the animation, we&#13;
switch from a linear animation progression for the <code>width</code> property to&#13;
one that eases in.  The <code>ease-in</code> timing starts from the keyframe in which the timing function changes.  <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/cubicbezierprint2.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Specifying the <code>animation-timing-function</code> within the <code>to</code> or <code>100%</code>&#13;
keyframe will have no effect on the animation. When included in any other keyframe, the animation will follow the&#13;
<code>animation-timing-function</code> specified in that keyframe definition until it reaches the next keyframe,&#13;
overriding the element’s default or declared <code>animation-timing-function</code>.</p>&#13;
&#13;
<figure><div class="figure" id="an_timing">&#13;
<img alt="css5 1905" src="assets/css5_1905.png"/>&#13;
<h6><span class="label">Figure 19-5. </span>Changing the animation timing function mid-animation</h6>&#13;
</div></figure>&#13;
&#13;
<p>If the <code>animation-timing-function</code> property is included in a keyframe,&#13;
only the properties also included in that keyframe block will have their&#13;
timing function impacted. The new timing function will be in play on that property until the next keyframe containing that property is reached, at which point it will change to the timing function declared within that block, or revert back to the original  timing function assigned to that element. Take our <code>W</code> animation as an example:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
    <code class="nt">from</code>     <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">50%</code>      <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">to</code>       <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This follows the idea that conceptually, when an animation is set on an&#13;
element or pseudo-element, it is as if a set of keyframes is created for&#13;
each property present in any of the keyframes, as if an&#13;
animation is run independently for each property being animated.&#13;
It’s as if the <code>W</code> animation were made up of two animations that run&#13;
simultaneously—<code>W_part1</code> and <code>W_part2</code>:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W_part1</code> <code class="p">{</code>&#13;
    <code class="nt">from</code><code class="o">,</code> <code class="nt">to</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">50%</code>      <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
<code class="k">@keyframes</code> <code class="nt">W_part2</code> <code class="p">{</code>&#13;
    <code class="nt">from</code> <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">to</code>   <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The <code>animation-timing-function</code> that is set on any of the keyframes is&#13;
added to the progression of only the properties defined at that&#13;
keyframe:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
    <code class="nt">from</code>     <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">50%</code>      <code class="p">{</code> <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">to</code>       <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The preceding code will change the <code>animation-timing-function</code> from whatever was set on the CSS selector block to <code>ease-in</code> for the <code>top</code> property only, not the <code>left</code> property, impacting only the <code>W_part1</code> section of our <code>W</code> animation, and only from the middle of the animation to the 75% mark.</p>&#13;
&#13;
<p>However, with the following animation, the <code>animation-timing-function</code> will have no effect, because it’s been placed in a&#13;
keyframe block that has no property-value <span class="keep-together">declarations:</span></p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">W</code> <code class="p">{</code>&#13;
    <code class="nt">from</code>     <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">25%</code><code class="o">,</code> <code class="nt">75%</code> <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">50%</code>      <code class="p">{</code> <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">50%</code>      <code class="p">{</code> <code class="k">top</code><code class="o">:</code> <code class="m">50%</code><code class="p">;</code> <code class="p">}</code>&#13;
    <code class="nt">to</code>       <code class="p">{</code> <code class="k">left</code><code class="o">:</code> <code class="m">100%</code><code class="p">;</code> <code class="k">top</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code> <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>How is it useful to change the timing function mid-animation? In the&#13;
bounce animation, we had a frictionless environment: the ball&#13;
bounced forever, never losing momentum. The ball sped up as it&#13;
dropped, and slowed as it rose, because the timing function was&#13;
inverted from <code>ease-in</code> to <code>ease-out</code> by default as the animation&#13;
proceeded from the <code>normal</code> to <code>reverse</code> direction every other iteration.</p>&#13;
&#13;
<p>In reality, friction exists; momentum is lost. Balls will not continue&#13;
to bounce indefinitely. If we want our bouncing ball to look natural, we&#13;
have to make it bounce less high as it loses energy with each impact. To&#13;
do this, we need a single animation that bounces multiple times, losing&#13;
momentum on each bounce, while switching between <code>ease-in</code> and <code>ease-out</code> at each&#13;
apex and nadir:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">bounce</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">30%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">100px</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">58%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">200px</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">80%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">300px</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">95%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">360px</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">15%</code><code class="o">,</code> <code class="nt">45%</code><code class="o">,</code> <code class="nt">71%</code><code class="o">,</code> <code class="nt">89%</code><code class="o">,</code> <code class="nt">100%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateY</code><code class="p">(</code><code class="m">380px</code><code class="p">);</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">out</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This animation loses height after a few bounces, eventually stopping.  <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/ball3.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>Since this new animation uses a single iteration, we can’t rely on <code>animation-direction</code> to change our timing function. We need to&#13;
ensure that while each bounce causes the ball to lose momentum, it still&#13;
speeds up with gravity and slows down as it reaches its apex. Because&#13;
we will have only a single iteration, we control the timing by including&#13;
<code>animation-timing-function</code> within our keyframes. At every apex, we&#13;
switch to <code>ease-in</code>, and at every nadir, or bounce, we switch to&#13;
<code>ease-out</code>.<a data-primary="" data-startref="ix_animate_time" data-type="indexterm" id="idm45176033439584"/><a data-primary="" data-startref="ix_animate_time_func_prop" data-type="indexterm" id="idm45176033438576"/><a data-primary="" data-startref="ix_time_func_animate" data-type="indexterm" id="idm45176033437616"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Setting the Animation Play State" data-type="sect2"><div class="sect2" id="setting-the-animation-play-state">&#13;
<h2>Setting the Animation Play State</h2>&#13;
&#13;
<p>If you <a data-primary="animation" data-secondary="play state setting" data-type="indexterm" id="idm45176033436000"/><a data-primary="animation-play-state property" data-type="indexterm" id="idm45176033434992"/>need to pause and resume animations,&#13;
the <code>animation-play-state</code> property defines whether the animation is&#13;
running or paused.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-play-state">&#13;
<h1>animation-play-state</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ <code>running</code> | <code>paused</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>running</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>When set to the default value of <code>running</code>, the animation proceeds as normal. If&#13;
set to <code>paused</code>, the animation will be, well, paused.  When <code>paused</code>, the&#13;
animation is still applied to the element, just frozen at the progress it had&#13;
made before being paused. If stopped mid-iteration, the properties  that were in the process of animating stay at their mid-iteration values. When set back to <code class="keep-together">running</code>, the animation restarts from where it left off, as if the&#13;
“clock” that controls the animation had stopped and started again.</p>&#13;
&#13;
<p>If the property is set to <code>paused</code> during the&#13;
delay phase of the animation, the delay clock is also paused and resumes as soon as <code>animation-play-state</code> is set back to running. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/ball4.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation Fill Modes" data-type="sect2"><div class="sect2" id="animation-fill-modes">&#13;
<h2>Animation Fill Modes</h2>&#13;
&#13;
<p>The <code>animation-fill-mode</code> property<a data-primary="animation-fill-mode property" data-type="indexterm" id="ix_animate_fill_mode_prop"/><a data-primary="animation" data-secondary="fill modes" data-type="indexterm" id="ix_animate_fill"/> enables us to define whether an element’s property values continue to be applied by the animation outside of the animation’s duration time.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-fill-mode">&#13;
<h1>animation-fill-mode</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ <code>none</code> | <code>forwards</code> | <code>backwards</code> | <code>both</code> ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>none</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>This property is useful because, by default, the changes in an animation apply only during the animation itself. Before the animation starts, the animation property values aren’t applied. Once the animation is done, the values will all revert to their pre-animation values.  Thus, if you take an element whose background is red, and then animate the background from green to blue, the background will (by default) stay red until the animation delay expires, and instantly revert to red after the animation finishes.</p>&#13;
&#13;
<p>Similarly, an animation will not affect the property values of the&#13;
element immediately if a positive <code>animation-delay</code> is applied.&#13;
Rather, animation property <span class="keep-together">values</span> are applied when the <code>animation-delay</code>&#13;
expires, at the moment the <code>animationstart</code> event is fired.</p>&#13;
&#13;
<p>With <code>animation-fill-mode</code>, we can define how the animation impacts the&#13;
element on which it is set before the <code>animationstart</code> and after the&#13;
<code>animationend</code> events are fired.  Property values&#13;
set in the 0% keyframe can be applied to the element during the expiration&#13;
of any animation delay, and property values can persist after the&#13;
<code>animationend</code> event is fired.</p>&#13;
&#13;
<p>The default value for <code>animation-fill-mode</code> is <code>none</code>, which means the animation has no effect when it is not executing. Property values from the animation’s 0% keyframe (or the 100% keyframe in reverse animations) are not applied to the animated element until the <code>animation-delay</code> has expired, when the <code>animationstart</code> event is fired.</p>&#13;
&#13;
<p>When the value is set to <code>backwards</code> and the <code>animation-direction</code> is either <code>normal</code> or <code>alternate</code>, the property values from the <code>0%</code> keyframe are applied immediately, without waiting for the <code>animation-delay</code> time to expire.  If the <code>animation-direction</code> is either <code>reversed</code> or <code>reversed-alternate</code>, the property values from the <code>100%</code> keyframe are applied.</p>&#13;
&#13;
<p>The value of <code>forwards</code> means that when the animation is done executing—that is, has concluded the last part of the last iteration as defined by the&#13;
<code>animation-iteration-count</code> value, and the <code>animationend</code> event has fired—it continues to apply the values of&#13;
the properties as they were when the <code>animationend</code> event&#13;
occurred. If the <code>iteration-count</code> has an integer value, this will be&#13;
either the <code>100%</code> keyframe, or, if the last iteration was in the reverse&#13;
direction, the <code>0%</code> keyframe.</p>&#13;
&#13;
<p>The <code>both</code> value applies both the <code>backwards</code> effect of applying the&#13;
property values as soon as the animation is attached to the element, <em>and</em> the&#13;
<code>forwards</code> value of persisting the property values past the&#13;
<code>animationend</code> event. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/halfiterationforwards.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
&#13;
<p>If the <code>animation-iteration-count</code> is a float value, and not an integer,&#13;
the last iteration will not end on the <code>0%</code> or <code>100%</code> keyframe; the&#13;
animation will instead end its execution partway through an animation cycle. If&#13;
the <code>animation-fill-mode</code> is set to <code>forwards</code> or <code>both</code>, the element&#13;
maintains the property values it had when the <code>animationend</code> event&#13;
occurred. For example, if the <code>animation-iteration-count</code> is <code>6.5</code>, and&#13;
the <code>animation-timing-function</code> is linear, the <code>animationend</code> event fires&#13;
and the values of the properties at the 50% mark (whether or not a 50%&#13;
keyframe is explicitly declared) will stick, as if the&#13;
<code>animation-play-state</code> had been set to <code>pause</code> at that point.</p>&#13;
&#13;
<p>For example, consider the following code:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="k">@keyframes</code> <code class="nt">move_me</code> <code class="p">{</code>&#13;
  <code class="nt">0%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateX</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
  <code class="nt">100%</code> <code class="p">{</code>&#13;
    <code class="k">transform</code><code class="o">:</code> <code class="n">translateX</code><code class="p">(</code><code class="m">1000px</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nc">.moved</code> <code class="p">{</code>&#13;
  <code class="k">transform</code><code class="o">:</code> <code class="n">translateX</code><code class="p">(</code><code class="m">0</code><code class="p">);</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">move_me</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">10s</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">linear</code><code class="p">;</code>&#13;
  <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">0</code><code class="o">.</code><code class="m">6</code><code class="p">;</code>&#13;
  <code class="k">animation-fill-mode</code><code class="o">:</code> <code class="n">forwards</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>The animation will go through only 0.6 iterations. Being a linear 10-second&#13;
animation, it will stop at the 60% mark, 6 seconds into the animation,&#13;
when the element is translated 600 pixels to the right. With&#13;
<code>animation-fill-mode</code> set to <code>forwards</code> or <code>both</code>, the animation will&#13;
stop animating when it is translated 600 pixels to the right, holding the&#13;
moved element 600 pixels to the right of its original position.  This will keep it translated indefinitely, or at least until the animation is detached from the element. Without the <code>animation-fill-mode</code>: <code>forwards</code>, the element with class <code>moved</code> will pop back to its original transform: <code>translateX(0)</code>, as defined in the moved selector code block.<a data-primary="" data-startref="ix_animate_elem" data-type="indexterm" id="idm45176033282064"/><a data-primary="" data-startref="ix_elem_animate" data-type="indexterm" id="idm45176033281088"/><a data-primary="" data-startref="ix_animate_fill" data-type="indexterm" id="idm45176033280144"/><a data-primary="" data-startref="ix_animate_fill_mode_prop" data-type="indexterm" id="idm45176033279200"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Bringing It All Together" data-type="sect1"><div class="sect1" id="the-animation-shorthand-property">&#13;
<h1>Bringing It All Together</h1>&#13;
&#13;
<p>The <code>animation</code> shorthand <a data-primary="animation property" data-type="indexterm" id="ix_animate_prop"/><a data-primary="animation" data-secondary="shorthand property" data-type="indexterm" id="ix_animate_shorthand"/>property allows you to use one declaration, instead of&#13;
eight, to define all the parameters for an element’s animation. The&#13;
<code>animation</code> property value is a list of space-separated values for the&#13;
various longhand animation properties. If you are setting multiple&#13;
animations on an element or pseudo-element, you can use a comma-separated list of animations.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="animation-property">&#13;
<h1>animation</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p>[ &lt;<em><code>animation-name</code></em>&gt; ‖ &lt;<em><code>animation-duration</code></em>&gt; ‖ &lt;<em><code>animation-timing-function</code></em>&gt; ‖ &lt;<em><code>animation-delay</code></em>&gt; ‖ &lt;<em><code>animation-iteration-count</code></em>&gt; ‖ &lt;<em><code>animation-direction</code></em>&gt; ‖ &lt;<em><code>animation-fill-mode</code></em>&gt; ‖ &lt;<em><code>animation-play-state</code></em>&gt; ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>0s ease 0s 1 normal none running none</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements, <code>::before</code> and <code>::after</code> pseudo-elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>The animation shorthand takes as its value all the other preceding animation&#13;
properties, including <code>animation-duration</code>,&#13;
<code>animation-timing-function</code>, <code>animation-delay</code>,&#13;
<code>animation-iteration-count</code>, <code>animation-direction</code>,&#13;
<code>animation-fill-mode</code>, <code>animation-play-state</code>, and <code>animation-name</code>.  For example, the following two rules are precisely equivalent:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nf">#animated</code> <code class="p">{</code>&#13;
  <code class="k">animation</code><code class="o">:</code> <code class="m">200ms</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code> <code class="m">50ms</code> <code class="m">1</code> <code class="n">normal</code> <code class="n">running</code> <code class="n">forwards</code> <code class="n">slidedown</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
<code class="nf">#animated</code> <code class="p">{</code>&#13;
  <code class="k">animation-name</code><code class="o">:</code> <code class="n">slidedown</code><code class="p">;</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">200ms</code><code class="p">;</code>&#13;
  <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="p">;</code>&#13;
  <code class="k">animation-delay</code><code class="o">:</code> <code class="m">50ms</code><code class="p">;</code>&#13;
  <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
  <code class="k">animation-fill-mode</code><code class="o">:</code> <code class="n">forwards</code><code class="p">;</code>&#13;
  <code class="k">animation-direction</code><code class="o">:</code> <code class="n">normal</code><code class="p">;</code>&#13;
  <code class="k">animation-play-state</code><code class="o">:</code> <code class="n">running</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>We didn’t have to declare all of the values in the animation shorthand;&#13;
any values that aren’t declared are set to the default or initial&#13;
values. In the preceding example, three of the&#13;
properties are set to their default values, so they are not strictly necessary, though sometimes it’s a good idea to write them in as a reminder to future you (or whoever takes over maintenance of your code).</p>&#13;
&#13;
<p>The order of the shorthand is important in two specific ways. First, two time properties are permitted, for &lt;<em><code>animation-duration</code></em>&gt; and &lt;<em><code>animation-delay</code></em>&gt;.  When two are listed, the first is <em>always</em> the duration. The second, if present, is interpreted as <span class="keep-together">the delay.</span></p>&#13;
&#13;
<p>Second, the placement of the <code>animation-name</code> is also important. If you use&#13;
an animation property value as an animation name—which you&#13;
shouldn’t, but let’s say you do—then&#13;
the <code>animation-name</code> should be placed as the <em>last</em> property&#13;
value in the <code>animation</code> shorthand. The first occurrence of a keyword&#13;
that is a valid value for any of the other animation properties, such as&#13;
<code>ease</code> or <code>running</code>, is assumed to be part of the shorthand of the&#13;
animation property the keyword is associated with, rather than the&#13;
<code>animation-name</code>.  The following rules are equivalent:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nf">#failedAnimation</code> <code class="p">{</code>&#13;
    <code class="k">animation</code><code class="o">:</code> <code class="n">paused</code> <code class="m">2s</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nf">#failedAnimation</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">0</code><code class="p">;</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
    <code class="k">animation-fill-mode</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>&#13;
    <code class="k">animation-direction</code><code class="o">:</code> <code class="n">normal</code><code class="p">;</code>&#13;
    <code class="k">animation-play-state</code><code class="o">:</code> <code class="n">paused</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This <a data-primary="animation" data-secondary="pausing and resuming" data-type="indexterm" id="ix_animate_pause_resume"/>happens because <code>paused</code> is a valid animation name.&#13;
While it may seem that the animation&#13;
named <code>paused</code> with a duration of <code>2s</code> is being attached to the element,&#13;
that is not what happens. Because words within the shorthand&#13;
animation are first checked against possible valid values of all&#13;
animation properties other than <code>animation-name</code>, <code>paused</code> is set as the value of the <code>animation-play-state</code> property.  Because no recognizable animation names are found,&#13;
the <code>animation-name</code> value remains at its default, <code>none</code>.</p>&#13;
&#13;
<p>Here’s another example of what you shouldn’t do:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nf">#anotherFailedAnimation</code> <code class="p">{</code>&#13;
    <code class="k">animation</code><code class="o">:</code> <code class="n">running</code> <code class="m">2s</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="o">-</code><code class="n">out</code> <code class="n">forwards</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nf">#anotherFailedAnimation</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">0s</code><code class="p">;</code>&#13;
    <code class="k">animation-timing-function</code><code class="o">:</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="o">-</code><code class="n">out</code><code class="p">;</code>&#13;
    <code class="k">animation-iteration-count</code><code class="o">:</code> <code class="m">1</code><code class="p">;</code>&#13;
    <code class="k">animation-fill-mode</code><code class="o">:</code> <code class="n">forwards</code><code class="p">;</code>&#13;
    <code class="k">animation-direction</code><code class="o">:</code> <code class="n">normal</code><code class="p">;</code>&#13;
    <code class="k">animation-play-state</code><code class="o">:</code> <code class="n">running</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Here, the author probably has a keyframe animation called <code>running</code>. The&#13;
browser, however, sees the term and assigns it to the&#13;
<code>animation-play-state</code> property rather than the <code>animation-name</code>&#13;
property. With no <code>animation-name</code> declared, no animation is attached to the element.</p>&#13;
&#13;
<p>The way to get around this is shown here:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nf">#aSuccessfulIfInadvisableAnimation</code> <code class="p">{</code>&#13;
    <code class="k">animation</code><code class="o">:</code> <code class="n">running</code> <code class="m">2s</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code><code class="o">-</code><code class="n">out</code> <code class="n">forwards</code> <code class="n">running</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This will apply the first <code>running</code> to <code>animation-play-state</code>, and the second <code>running</code> to <code>animation-name</code>.  Again: this is <em>not</em> advised.  The potential for confusion and error is too great.</p>&#13;
&#13;
<p>In light of all this, <code>animation: 2s 3s 4s;</code> may seem valid, as if the&#13;
following were being set:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nf">#invalidName</code> <code class="p">{</code>&#13;
    <code class="k">animation-name</code><code class="o">:</code> <code class="m">4s</code><code class="p">;</code>&#13;
    <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="p">;</code>&#13;
    <code class="k">animation-delay</code><code class="o">:</code> <code class="m">3s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>But as mentioned in <a data-type="xref" href="#setting-up-your-keyframe-animation">“Setting Up Keyframe Animations”</a>, <code>4s</code> is <em>not</em> a&#13;
valid identifier. Identifiers cannot start with a digit unless escaped.&#13;
For this animation to be valid, it would have to be written as&#13;
<code>animation: 2s 3s \4s;</code>.</p>&#13;
&#13;
<p>To attach multiple animations to a single element or pseudo-element,&#13;
comma-separate the animations:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.snowflake</code> <code class="p">{</code>&#13;
  <code class="k">animation</code><code class="o">:</code> <code class="m">3s</code> <code class="n">ease</code><code class="o">-</code><code class="n">in</code> <code class="m">200ms</code> <code class="m">32</code> <code class="n">forwards</code> <code class="n">falling</code><code class="o">,</code>&#13;
             <code class="m">1.5s</code> <code class="n">linear</code> <code class="m">200ms</code> <code class="m">64</code> <code class="n">spinning</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Each snowflake will fall while spinning for 96 seconds, spinning twice&#13;
during each 3-second fall. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/snowflake.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a> At the end of the last animation cycle, the&#13;
snowflake will stay fixed on the <code>100%</code> keyframe of the <code>falling</code> animation. We declared six of the eight animation properties for&#13;
the <code>falling</code> animation and five for the spinning animation, separating the&#13;
two animations with a comma.<a data-primary="" data-startref="ix_animate_pause_resume" data-type="indexterm" id="idm45176032854608"/></p>&#13;
&#13;
<p>While you’ll most often see the animation name as the first value—it’s easier to read that way, because of the issue with animation&#13;
property keywords being valid keyframe identifiers—it is not a best&#13;
practice. That is why we put the animation name at <span class="keep-together">the end.</span></p>&#13;
&#13;
<p>To sum up: using the <code>animation</code> shorthand is a fine idea. Just&#13;
remember that the placements of the duration, delay, and name within that&#13;
shorthand are important, and omitted values will be set to their default&#13;
values.</p>&#13;
&#13;
<p>Also note that although <code>none</code> is basically the only word that can’t be a valid animation name, using any animation keywords as your identifier is never a good idea.<a data-primary="" data-startref="ix_animate_shorthand" data-type="indexterm" id="idm45176032850832"/><a data-primary="" data-startref="ix_animate_prop" data-type="indexterm" id="idm45176032849856"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation, Specificity, and Precedence Order" data-type="sect1"><div class="sect1" id="animation-specificity-and-precedence-order">&#13;
<h1>Animation, Specificity, and Precedence Order</h1>&#13;
&#13;
<p>In <a data-primary="animation" data-secondary="precedence order" data-type="indexterm" id="ix_animate_prec"/>terms of specificity, the cascade, and which property values get&#13;
applied to an element, animations supersede all other values in the <span class="keep-together">cascade.</span></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Specificity and !important" data-type="sect2"><div class="sect2" id="specificity-and-important">&#13;
<h2>Specificity and !important</h2>&#13;
&#13;
<p>In general, the <a data-primary="specificity" data-secondary="animation" data-type="indexterm" id="idm45176032843920"/><a data-primary="animation" data-secondary="specificity" data-type="indexterm" id="idm45176032842912"/>weight of a property attached with an ID selector <code>1-0-0</code>&#13;
should take precedence over a property applied by an element selector&#13;
<code>0-0-1</code>. However, if that property value is changed via a keyframe&#13;
animation, the new value will be applied as if that property-value pair were added as an inline style and override the previous value.</p>&#13;
&#13;
<p>The <a data-primary="declarations" data-secondary="important" data-type="indexterm" id="idm45176032840400"/><a data-primary="important declarations" data-type="indexterm" id="idm45176032839392"/><a data-primary="rules" data-secondary="declarations" data-type="indexterm" id="idm45176032838720"/><a data-primary="! (exclamation point)" data-secondary="in !important flag" data-type="indexterm" id="idm45176032819744"/><a data-primary="exclamation point (!)" data-secondary="in !important flag" data-type="indexterm" id="idm45176032818896"/><a data-primary="!important flag" data-primary-sortas="important flag" data-type="indexterm" id="idm45176032818048"/>animation specification states, “Animations override all normal rules, but are overridden by <code>!important</code> rules.” That being said, don’t add <code>!important</code> to properties set inside your animation&#13;
declaration block; this use is invalid, and&#13;
the property-value combination to which <code>!important</code> is added will be ignored.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation Iteration and display: none;" data-type="sect2"><div class="sect2" id="animation-iteration-and-display-none">&#13;
<h2>Animation Iteration and display: none;</h2>&#13;
&#13;
<p>If the <code>display</code> property<a data-primary="animation" data-secondary="iteration control" data-type="indexterm" id="idm45176032813584"/> is set to <code>none</code> on an element, any animation&#13;
iterating on that element or its descendants will cease, as if the&#13;
animation were detached from the element. Updating the <code>display</code>&#13;
property back to a visible value will reattach all the animation&#13;
properties, restarting the animation from scratch:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.snowflake</code> <code class="p">{</code>&#13;
  <code class="k">animation</code><code class="o">:</code> <code class="n">spin</code> <code class="m">2s</code> <code class="n">linear</code> <code class="m">5s</code> <code class="m">20</code><code class="p">;</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>In this case, the snowflake will spin 20 times; each spin takes 2 seconds, with the&#13;
first spin starting after 5 seconds. If the snowflake element’s&#13;
<code>display</code> property gets set to <code>none</code> after 15 seconds, it would have&#13;
completed 5 spins before disappearing (after getting through the 5-second delay, then executing 5 spins at 2&#13;
seconds each). If the snowflake <code>display</code> property changes back to&#13;
anything other than <code>none</code>, the animation starts from scratch: a 5-second delay will elapse again before it starts spinning 20 times. It&#13;
makes no difference how many animation cycles iterated before it&#13;
disappeared from view the first time. <a class="play" href="https://meyerweb.github.io/csstdg5figs/19-animation/snowflake2.html"><span class="play"><img src="assets/play-icon-round.png"/></span></a></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animation and the UI Thread" data-type="sect2"><div class="sect2" id="animation-and-the-ui-thread">&#13;
<h2>Animation and the UI Thread</h2>&#13;
&#13;
<p>CSS <a data-primary="animation" data-secondary="UI thread usage by" data-type="indexterm" id="idm45176032783216"/>animations have the <em>lowest</em> priority on the UI thread. If you attach&#13;
multiple <span class="keep-together">animations</span> on page load with positive values for&#13;
<code>animation-delay</code>, the delays expire as specified, but the animations&#13;
may not begin until the UI thread is available <span class="keep-together">to animate.</span></p>&#13;
&#13;
<p class="pagebreak-before">Assume the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The animations all require the UI thread (that is, they aren’t on the GPU as&#13;
described in <a data-type="xref" href="#animation-chaining">“Animation chaining”</a>).</p>&#13;
</li>&#13;
<li>&#13;
<p>You have 20&#13;
animations with the <code>animation-delay</code> property&#13;
set to <code>1s</code>, <code>2s</code>, <code>3s</code>, <code>4s</code>, and so on in order to start each subsequent animation 1 second after the previous &#13;
<span class="keep-together">animation.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>The document or application takes&#13;
a long time to load, with 11 seconds between the time the animated elements&#13;
were drawn to the page and the time the JavaScript finished being&#13;
downloaded, parsed, and executed.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Given all that, the delays of the first 11 animations&#13;
will have expired once the UI thread is available,&#13;
and those first 11 animations will all commence simultaneously. Each remaining animation will then begin animating at 1-second intervals.<a data-primary="" data-startref="ix_animate_prec" data-type="indexterm" id="idm45176032758816"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using the will-change Property" data-type="sect1"><div class="sect1" id="will-change">&#13;
<h1>Using the will-change Property</h1>&#13;
&#13;
<p>You <a data-primary="will-change property" data-type="indexterm" id="ix_will_change_prop"/><a data-primary="animation" data-secondary="performance" data-type="indexterm" id="ix_animate_advance"/>could create animations so complex that they render badly, stuttering or displaying what’s sometimes referred to as <em>jank</em>. In situations such as these, it may be helpful to tell the browser what needs to be animated ahead of time via the <code>will-change</code> property.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="will-change-property">&#13;
<h1>will-change</h1><table>&#13;
&#13;
<tbody>&#13;
<tr>&#13;
<td><p><strong>Values</strong></p></td>&#13;
<td><p><code>auto</code> | [ <code>scroll-position</code> | <code>contents</code> | &lt;<em><code>custom-ident</code></em>&gt; ]#</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Initial value</strong></p></td>&#13;
<td><p><code>auto</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Applies to</strong></p></td>&#13;
<td><p>All elements</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Computed value</strong></p></td>&#13;
<td><p>As specified</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Inherited</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><strong>Animatable</strong></p></td>&#13;
<td><p>No</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></aside>&#13;
&#13;
<p>The general idea here is to give the browser hints about the sorts of pre-optimizations it can make if expensive calculations may be required.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>You should use <code>will-change</code> only when you have animation problems that you have been unable to resolve through other methods, such as simplifying the animation in subtle but significant ways, and that you believe pre-optimizations will address. If you try <code>will-change</code> and see no worthwhile improvement, you should remove <code>will-change</code> rather than leaving it in place.</p>&#13;
</div>&#13;
&#13;
<p>The default value of <code>auto</code> leaves optimization work to the browser, as per usual. The <code>scroll-position</code> value says that animation of, or at least some change of, the document’s scroll position is expected.  By default, browsers generally take only the contents of the viewport and a little of the content to either side of it into account. The <code>scroll-position</code> value might cause the browser to bring more of the content to either side of the viewport into its layout calculations.  Although this might produce smoother scroll animations, the expanded scope could easily slow the rendering of the content visible in the viewport.</p>&#13;
&#13;
<p>With <code>contents</code>, the browser is told to expect animation of the element’s contents.  This is most likely to cause browsers to reduce or eliminate caching of the layout of the viewport’s contents.  This would require the browser to recompute the layout of the page from scratch every frame.  Having to constantly recompute the page layout could slow the rendering of the page to slower than 60 frames per second, which is the benchmark that browser makers usually try to meet.  On the other hand, if the contents will be changed and animated quite a lot, telling the browser to cache less can make sense. Again, try this only if you already know the animations are overtaxing the browser—never assume ahead of time.</p>&#13;
&#13;
<p>It’s also possible to tell the browser which properties to watch out for by using a &lt;<em><code>custom-ident</code></em>&gt;, which, in this case, is a fancy way of saying “properties.”  For example, if you have a complicated animation set that changes position, filter, and text shadow, and they’re proving to be slow or stuttery, you could try this:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="n">will</code><code class="o">-</code><code class="n">change</code><code class="o">:</code> <code class="nb">top</code><code class="o">,</code> <code class="nb">left</code><code class="o">,</code> <code class="n">filter</code><code class="o">,</code> <code class="k">text-shadow</code><code class="p">;</code></pre>&#13;
&#13;
<p>If this smooths out the animation, it’s worth removing one property at a time to see if the smoothness remains.  You might, for example, discover that removing the <code>top</code> and <code>left</code> properties doesn’t affect the new smoothness, but removing either <code>filter</code> or <code>text-shadow</code> causes the stuttering to return.  In that case, keep it at <code>will-change: filter, text-shadow</code>.</p>&#13;
&#13;
<p>Also keep in mind that listing a shorthand property like <code>font</code> or <code>background</code> causes all of the longhand properties to be considered changeable.  Thus, the following two rules are equivalent:</p>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nc">.textAn</code> <code class="p">{</code><code class="n">will</code><code class="o">-</code><code class="n">change</code><code class="o">:</code> <code class="k">font</code><code class="p">;}</code>&#13;
&#13;
<code class="nc">.textAn</code> <code class="p">{</code><code class="n">will</code><code class="o">-</code><code class="n">change</code><code class="o">:</code> <code class="k">font-family</code><code class="o">,</code> <code class="k">font-size</code><code class="o">,</code> <code class="k">font-weight</code><code class="o">,</code> <code class="k">font-style</code><code class="o">,</code>&#13;
     <code class="k">font-variant</code><code class="o">,</code> <code class="k">line-height</code><code class="p">;}</code></pre>&#13;
&#13;
<p>This is why, in nearly any case, a shorthand property should not be listed in <code>will-change</code>. Instead, identify the longhand properties being animated, and list those.<a data-primary="" data-startref="ix_animate_advance" data-type="indexterm" id="idm45176032663184"/><a data-primary="" data-startref="ix_will_change_prop" data-type="indexterm" id="idm45176032662336"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Printing Animations" data-type="sect1"><div class="sect1" id="printing-considerations">&#13;
<h1>Printing Animations</h1>&#13;
&#13;
<p>When an <a data-primary="animation" data-secondary="printing" data-type="indexterm" id="idm45176032659600"/><a data-primary="printing" data-secondary="animations" data-type="indexterm" id="idm45176032658592"/>animated element is printed, its end state should print.&#13;
You can’t see the element animating on a piece of&#13;
paper; but if, for example, an animation causes an element to have a <code>border-radius</code> of <code>50%</code>, the printed element will have a <code>border-radius</code> of <code>50%</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45176032655696">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>As we hope this chapter shows, animations can be powerful additions to a user interface, as well as to decorative parts of a design.  Whether an animation is simple, complex, short, or lengthy, all these aspects and more are in your hands.<a data-primary="" data-startref="ix_animation_ch19" data-type="indexterm" id="idm45176032654336"/></p>&#13;
&#13;
<p>Always exercise caution, as animation can affect some users negatively, whether they have vestibular disorders or simply are sensitive to motion.  Fortunately, <code>prefers-reduced-motion</code> is available to reduce or eliminate animations for those who do not want them.</p>&#13;
</div></section>&#13;
</div></section></body></html>