<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. The Activity Lifecycle: Being an Activity"><div class="chapter" id="the_activity_lifecyclecolon_being_an_act">
<h1><span class="label">Chapter 5. </span>The Activity Lifecycle: <em>Being an Activity</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0169-01.png" alt="image" width="600" height="529"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activity lifecycle" id="idm46053741563216"/><a data-type="indexterm" data-primary="Stopwatch app" data-seealso="activity lifecycle" id="idm46053741562208"/><strong>Activities form the foundation of every Android app.</strong></p>
<p>So far you’ve seen how to create an activity, and use it to interact with the user. But if you don’t know about <strong>the activity lifecycle</strong>, some of its behavior <strong>might take you by surprise</strong>. In this chapter, you’ll learn what happens when an activity is <strong>created</strong> and <strong>destroyed</strong>, and how this can lead to <strong>unexpected consequences</strong>. You’ll find out how to control its behavior when it’s made <strong>visible</strong>, or <strong>hidden</strong>. You’ll even discover ways of <strong>saving and restoring your activity’s state</strong>, just when you need it. Read on to find out more…</p>
<section data-type="sect1" data-pdf-bookmark="How do activities really work?"><div class="sect1" id="how_do_activities_really_workquestion_ma">
<h1>How do activities really work?</h1>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" id="idm46053741556560"/><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="Stopwatch app" id="idm46053741553504"/>So far you’ve seen how to create an interactive app by specifying how the app should behave in its activity code. But there are still lots of things you don’t yet know about how activities function.</p>
<p>How long does an activity live for? What happens when your activity disappears from the screen? Is it still running? Is it still in memory? And what happens if your app gets interrupted by an incoming phone call?</p>
<p>You want to be able to control the behavior of your activities in a <em>whole range of different circumstances</em>, so we’re going to take a closer look at how activities work under the hood. We’ll look at some common ways in which your apps can break, and how you can fix them using the <strong>activity lifecycle methods</strong>. We’ll explore these functions using a Stopwatch app as an example.</p>
<section data-type="sect2" data-pdf-bookmark="Introducing the Stopwatch app"><div class="sect2" id="introducing_the_stopwatch_app">
<h2>Introducing the Stopwatch app</h2>
<p>The Stopwatch app has four views: a view that displays the elapsed time, a Start button that starts the stopwatch, a Pause button that pauses it, and a Reset button that sets the timer value back to 0. Here’s what the app looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0170-01.png" alt="image" width="600" height="356"/>
<h6/>
</div></figure>
<p>We’ll build the app over the next few pages, and we’ll start by creating a new project.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create a new project"><div class="sect1" id="create_a_new_project-id00053">
<h1>Create a new project</h1>
<p><a data-type="indexterm" data-primary="Chronometer view, Stopwatch app" id="idm46053741545328"/><a data-type="indexterm" data-primary="Stopwatch app" data-secondary="Chronometer view" id="idm46053741544400"/><a data-type="indexterm" data-primary="String resources" data-secondary="Stopwatch app" id="idm46053741541472"/>Create a new Android Studio project using the same steps you used in previous chapters. Choose the Empty Activity option, enter a name of “Stopwatch” and a package name of “com.hfad.stopwatch”, and accept the default save location. Make sure the language is set to Kotlin and the minimum SDK is API 21 so it will run on most Android devices.</p>
<section data-type="sect2" data-pdf-bookmark="Add String resources for the text labels"><div class="sect2" id="add_string_resources_for_the_text_labels">
<h2>Add String resources for the text labels</h2>
<p>The Stopwatch layout features three buttons labeled Start, Pause, and Reset. We’ll add these labels to <em>strings.xml</em> as !<code>String</code> resources so the app can look up their values at runtime.</p>
<p>To add the <code>String</code> resources, open the file <em>strings.xml</em> in the <em>app/src/main/res/values</em> folder, and update it so it includes the changes below:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0171-01.png" alt="image" width="600" height="203"/>
<h6/>
</div></figure>
<p>Now that we’ve added the <code>String</code> resources, let’s build the layout.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The layout includes a Chronometer view"><div class="sect2" id="the_layout_includes_a_chronometer_view">
<h2>The layout includes a Chronometer view</h2>
<p>The layout is comprised of three buttons, and a view that displays the number of seconds on the stopwatch. To display the number of seconds, we’ll use a <strong>chronometer</strong>.</p>
<p>A chronometer is a type of text view that acts as a simple timer. It has built-in methods you can use to start and stop it, and it displays the elapsed time.</p>
<p>You add a chronometer to your layout using the <code>&lt;Chronometer&gt;</code> element. The following code, for example, adds a <code>Chronometer</code> view with an ID of “stopwatch” that is just large enough for its contents:</p>
<pre data-type="programlisting"><strong>&lt;Chronometer</strong>
    <strong>android:id="@+id/stopwatch"</strong>
    <strong>android:layout_width="wrap_content"</strong>
    <strong>android:layout_height="wrap_content" /&gt;</strong></pre>
<figure class="informal"><div class="figure">
<img src="Images/f0171-02.png" alt="image" width="430" height="341"/>
<h6/>
</div></figure>
<p>You’ll learn more about how the chronometer works when we write the activity code. First, let’s look at the full code for the layout.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for activity_main.xml"><div class="sect1" id="the_full_code_for_activityunders-id00054">
<h1>The full code for activity_main.xml</h1>
<p>The full code for <em>activity_main.xml</em> features a <code>Chronometer</code> view and three buttons. Update your code in <em>activity_main.xml</em> so that it matches the code below:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0172-01.png" alt="image" width="600" height="637"/>
<h6/>
</div></figure>
<p>The layout is now complete. Next, let’s move on to the activity.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The activity code controls the stopwatch"><div class="sect1" id="the_activity_code_controls_the_stopwatch">
<h1>The activity code controls the stopwatch</h1>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" data-tertiary="Chronometer" id="idm46053741514352"/><a data-type="indexterm" data-primary="base property, Chronometer view" id="idm46053741512784"/><a data-type="indexterm" data-primary="properties" id="idm46053741511984"/><a data-type="indexterm" data-primary="properties" data-secondary="Chronometer" id="idm46053741511152"/><a data-type="indexterm" data-primary="start() method, Chronometer view" id="idm46053741510048"/><a data-type="indexterm" data-primary="stop() method, Chronometer view" id="idm46053741509248"/><a data-type="indexterm" data-primary="SystemClock.elapsedRealtime(), Chronometer view" id="idm46053741508448"/><a data-type="indexterm" data-primary="TextView" data-secondary="Chronometer view" id="idm46053741507648"/>The activity code needs to specify how the Start, Pause, and Reset buttons control the stopwatch. The Start button needs to start it running (if it’s not running already), the Pause button needs to pause it, and the Reset button needs to set it back to 0.</p>
<p>The buttons will control the stopwatch by accessing the <code>Chronometer</code> view’s built-in properties and methods. Let’s take a look at these.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0173-01.png" alt="image" width="458" height="386"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="The Chronometer’s key properties and methods"><div class="sect2" id="the_chronometerapostrophes_key_propertie">
<h2>The Chronometer’s key properties and methods</h2>
<p>As we said earlier, the <code>Chronometer</code> view is a type of <code>TextView</code>. It inherits all of <code>TextView</code>’s properties and methods, and defines some new ones too.</p>
<p>Here are all the <code>Chronometer</code> properties and methods we’ll be using in the <code>MainActivity</code> code:</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The base property"><div class="sect2" id="the_base_property">
<h2>The base property</h2>
<p>The <code>Chronometer base</code> property is used to set the start time: the time from which the chronometer will start counting.</p>
<p>You set the start time to the current time by setting the <code>base</code> property to <code>SystemClock.elapsedRealtime()</code> using code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0173-02.png" alt="image" width="600" height="41"/>
<h6/>
</div></figure>
<p><code>SystemClock.elapsedRealtime()</code> returns the number of milliseconds since the device was booted. Setting the <code>base</code> property to this value means that the time that’s displayed is set to 0.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The start() method"><div class="sect2" id="the_startleft_parenthesisright_parenthes">
<h2>The start() method</h2>
<p>The <code>start()</code> method makes the chronometer start counting from the base time:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0173-03.png" alt="image" width="356" height="58"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The stop() method"><div class="sect2" id="the_stopleft_parenthesisright_parenthesi">
<h2>The stop() method</h2>
<p>This pauses the chronometer so it stops counting:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0173-04.png" alt="image" width="461" height="29"/>
<h6/>
</div></figure>
<p>Now that you know about the <code>Chronometer</code> view’s properties and methods we’ll be using, let’s look at the activity code.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="serious_coding-id00055">
<h5><span class="inlineimage"><img src="Images/cap.png" alt="Images" width="91" height="93"/></span> Serious Coding</h5>
<p>You can find out more about using the Chronometer view in the online documentation here:</p>
<p><em><a href="https://developer.android.com/reference/android/widget/Chronometer">https://developer.android.com/reference/android/widget/Chronometer</a></em></p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for MainActivity.kt"><div class="sect1" id="the_full_code_for_mainactivitydo-id00056">
<h1>The full code for MainActivity.kt</h1>
<p><a data-type="indexterm" data-primary="click response" data-secondary="Stopwatch app" id="idm46053741479776"/><a data-type="indexterm" data-primary="offset property, Chronometer view" id="idm46053741475280"/><a data-type="indexterm" data-primary="OnClickListener" data-secondary="Stopwatch app" id="idm46053741474480"/><a data-type="indexterm" data-primary="running property, Chronometer view" id="idm46053741473376"/><a data-type="indexterm" data-primary="stopwatch property, Chronometer view" id="idm46053741472576"/>The code for <code>MainActivity</code> requires an <code>OnClickListener</code> for each button. The one for the Start button needs to start the stopwatch if it’s not already running, the one for the Pause button needs to pause it, and the Reset button’s <code>OnClickListener</code> needs to set the display back to 0.</p>
<p>We’re using three properties to help us with this: <code>stopwatch</code>, <code>running</code>, and <code>offset</code>.</p>
<p>The <code>stopwatch</code> property holds a reference to the <code>Chronometer</code> view.</p>
<p>The <code>running</code> property records whether the stopwatch is running. We’ll set it to <code>true</code> when the Start button’s clicked, and <code>false</code> when the user clicks the Pause button.</p>
<p>The <code>offset</code> property is used to display the correct time on the stopwatch if the stopwatch has been paused and restarted. Without this, the stopwatch will display the incorrect time.</p>
<p>We’ve also included two methods (<code>setBaseTime</code> and <code>saveOffset</code>) to help make the code more readable.</p>
<p>Here’s the full code for <em>MainActivity.kt</em>; update your code to include all of the changes:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0174-01.png" alt="image" width="600" height="319"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0175-01.png" alt="image" width="600" height="638"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="saveOffset() method, Chronometer view" id="idm46053741457760"/><a data-type="indexterm" data-primary="setBaseTime() method, Chronometer view" id="idm46053741456768"/>Let’s run through how we expect the code to work.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when you run the app"><div class="sect1" id="what_happens_when_you_run_the_app">
<h1>What happens when you run the app</h1>
<ol>
<li><p><strong>The user runs the app, and MainActivity starts.</strong></p>
<p>The <code>running</code> and <code>offset</code> properties are initialized. <code>running</code> is set to <code>false</code>, and <code>offset</code> is set to 0.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0176-01.png" alt="image" width="600" height="173"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity’s onCreate method gets called.</strong></p>
<p>The <em>activity_main.xml</em> layout is linked to the activity, and the <code>stopwatch</code> property is given a reference to the <code>Chronometer</code> view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0176-02.png" alt="image" width="591" height="226"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks the Start button.</strong></p>
<p>The <code>stopwatch.</code>b<code>ase</code> property is set to <code>SystemClock.elapsedRealTime()</code>, its <code>start()</code> method is called, and <code>running</code> is set to <code>true</code>. The stopwatch starts running.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0176-03.png" alt="image" width="600" height="174"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks the Pause button.</strong></p>
<p><code>MainActivity</code> updates the <code>offset</code> property and calls the stopwatch <code>stop()</code> method and <code>running</code> is set to <code>false</code>. The stopwatch pauses.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0177-01.png" alt="image" width="600" height="174"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks the Reset button.</strong></p>
<p>The <code>offset</code> property is set to <code>0</code>, and the <code>stopwatch.base</code> property is reset to <code>SystemClock.elapsedRealTime()</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0177-02.png" alt="image" width="600" height="189"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks the Start button again.</strong></p>
<p><code>MainActivity</code> uses the <code>offset</code> value to adjust the  <code>stopwatch.base</code> property, calls its <code>start()</code> method, and sets <code>running</code> to <code>true</code>. The stopwatch starts running again.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0177-03.png" alt="image" width="600" height="174"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00057">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p><a data-type="indexterm" data-primary="Android devices" data-secondary="rotation of" id="idm46053741420016"/><a data-type="indexterm" data-primary="rotation of device" id="idm46053741418720"/><a data-type="indexterm" data-primary="rotation of device" data-secondary="configuration changed by" id="idm46053741417888"/>When we run the app, it seems to work as we expect it to. We can start, pause, and reset the stopwatch without any problems.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0178-01.png" alt="image" width="600" height="311"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="But there’s just one problem…"><div class="sect2" id="but_thereapostrophes_just_one_problemhel">
<h2>But there’s just one problem…</h2>
<p>When we turn the device so the screen rotates, the app goes wrong. The stopwatch sets itself back to 0 and stops running.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0178-02.png" alt="image" width="600" height="385"/>
<h6/>
</div></figure>
<p>So why does the app break when we rotate the screen? Let’s go behind the scenes to find out more.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs">
<h1>What happens when the app runs</h1>
<p>The following things happen when the code runs:</p>
<ol>
<li><p><strong>Click on the Start button to start the stopwatch.</strong></p>
<p>The stopwatch starts, and the <code>running</code> property is set to <code>true</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0179-01.png" alt="image" width="600" height="168"/>
<h6/>
</div></figure></li>
<li><p><strong>Rotate the device screen.</strong></p>
<p>Android sees that the screen orientation has changed, and it <strong>destroys</strong> <code><strong>MainActivity</strong></code>. Its property values are lost.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0179-02.png" alt="image" width="584" height="277"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity restarts.</strong></p>
<p>The activity is recreated, all its properties are reinitialized, and <code>onCreate()</code> runs again. The stopwatch doesn’t restart as <code>onCreate()</code> doesn’t tell it to.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0179-03.png" alt="image" width="600" height="164"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Rotating the screen changes the device configuration"><div class="sect1" id="rotating_the_screen_changes_the_device_c">
<h1>Rotating the screen changes the device configuration</h1>
<p><a data-type="indexterm" data-primary="Android apps" data-secondary="activity states" id="idm46053741393152"/><a data-type="indexterm" data-primary="device configuration, StopWatch app" id="idm46053741391792"/><a data-type="indexterm" data-primary="screens" data-secondary="supporting different sizes" id="idm46053741390992"/><a data-type="indexterm" data-primary="Stopwatch app" data-secondary="device configuration" id="idm46053741389920"/>When Android runs your app and starts an activity, it takes into account the <strong>device configuration</strong>. By this we mean the configuration of the physical device (such as the screen size, screen orientation, and whether there’s a keyboard attached) and also configuration options specified by the user (such as the locale).</p>
<p>Android needs to know what the device configuration is when it starts an activity because the configuration can impact what resources are needed for the application. You may need to use a different layout if the device screen is in landscape mode rather than portrait, for instance, and a different set of <code>String</code> values if the locale is France.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0180-01.png" alt="image" width="600" height="602"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>The device configuration includes options specified by the user (such as the locale), and options relating to the physical device (such as the orientation and screen size). A change to any of these options results in the activity being destroyed and then recreated.</strong></p>
</blockquote>
<p>When the device configuration changes, anything that displays a user interface needs to be updated to match the new configuration. If you rotate the screen, for example, Android spots the orientation has changed, and classes this as a change to the device configuration. It destroys the current activity, and then recreates it so that resources appropriate to the new configuration get picked up.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="An activity’s states"><div class="sect1" id="an_activityapostrophes_states">
<h1>An activity’s states</h1>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" data-tertiary="onCreate() and onDestroy()" id="idm46053741382448"/><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="states in" id="idm46053741380928"/><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="activity lifecycle" id="idm46053741379488"/><a data-type="indexterm" data-primary="onDestroy() method, activity lifecycle" id="idm46053741378416"/><a data-type="indexterm" data-primary="setContentView() method, activity" data-secondary="overriding" id="idm46053741377616"/>When Android creates and destroys an activity, the activity moves from being launched to running to being destroyed.</p>
<p>The main state of an activity is when it’s <strong><em>running</em></strong> or <strong><em>active</em></strong>. An activity is running when it’s in the foreground of the screen, it has the focus, and the user can interact with it. The activity spends most of its life in this state. An activity starts running after it has been launched, and at the end of its life, the activity is <strong><em>destroyed</em></strong>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0181-01.png" alt="image" width="538" height="397"/>
<h6/>
</div></figure>
<p>When an activity moves from being launched to being destroyed, it triggers key activity lifecycle methods: the <code><strong>onCreate()</strong></code> and <code><strong>onDestroy()</strong></code> methods. These are lifecycle methods that the activity inherits, and that you can override.</p>
<p>The <code>onCreate()</code> method gets called immediately after your activity is launched. This method is where you do all your normal activity setup such as calling <code>setContentView()</code>. You should always override this method. If you <em>don’t</em> override it, you won’t be able to tell Android what layout your activity should use.</p>
<p>The <code>onDestroy()</code> method is the final call you get before the activity is destroyed. There are a number of situations in which an activity can get destroyed—for example, if it’s been told to finish, if the activity is being recreated due to a change in device configuration, or if Android has decided to destroy the activity in order to save space.</p>
<p>We’ll take a closer look at how these methods fit into the activity states on the next page.</p>
<blockquote>
<p><strong>An activity is running when it’s in the foreground of the screen.</strong></p>
<p><strong>onCreate() gets called when the activity is first created, and it’s where you do your normal activity setup.</strong></p>
<p><strong>onDestroy() gets called just before your activity gets destroyed.</strong></p>
</blockquote>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The activity lifecycle: from create to destroy"><div class="sect1" id="the_activity_lifecyclecolon_from_create">
<h1>The activity lifecycle: from create to destroy</h1>
<p><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="activity lifecycle" id="idm46053741361328"/><a data-type="indexterm" data-primary="onDestroy() method, activity lifecycle" id="idm46053741359808"/>Here’s an overview of the activity lifecycle from birth to death. As you’ll see later in the chapter, we’ve left out some of the details because at this point we’re just focusing on the <code>onCreate()</code> and <code>onDestroy()</code> methods.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0182-01.png" alt="image" width="225" height="736"/>
<h6/>
</div></figure>
<ol>
<li><p><strong>The activity gets launched.</strong></p>
<p>The activity object is created and its constructor is run.</p></li>
<li><p><strong>The onCreate() method runs immediately after the activity is launched.</strong></p>
<p>The <code>onCreate()</code> method is where any initialization code should go, as this method always gets called after the activity has launched but before it starts running.</p></li>
<li><p><strong>An activity is running when it’s visible in the foreground and the user can interact with it.</strong></p>
<p>This is where an activity spends most of its life.</p></li>
<li><p><strong>The onDestroy() method runs immediately before the activity is destroyed.</strong></p>
<p>The <code>onDestroy()</code> method enables you to perform any final cleanup such as freeing up resources.</p></li>
<li><p><strong>After the onDestroy() method has run, the activity is destroyed.</strong></p>
<p>The activity ceases to exist.</p></li>
</ol>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">If your device is extremely low on memory, onDestroy() might not get called before the activity is destroyed.</span></p>
</div>
<p>The <code>onCreate()</code> and <code>onDestroy()</code> methods are two of the activity lifecycle methods. So where do these methods come from?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your activity inherits the lifecycle methods"><div class="sect1" id="your_activity_inherits_the_lifecycle_met">
<h1>Your activity inherits the lifecycle methods</h1>
<p><a data-type="indexterm" data-primary="Activity class" id="idm46053741343248"/><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="inherited methods" id="idm46053741342368"/><a data-type="indexterm" data-primary="AppCompatActivity class" data-secondary="in activity lifecycle" id="idm46053741341200"/><a data-type="indexterm" data-primary="Context class" id="idm46053741340096"/><a data-type="indexterm" data-primary="ContextWrapper class" id="idm46053741339264"/>The activity lifecycle methods are defined in the <code>android.app.Activity</code> class. Each activity you create is a subtype of this class, so it inherits these methods.</p>
<p>Here’s a diagram showing the main classes in your activity’s class hierarchy:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0183-01.png" alt="image" width="600" height="585"/>
<h6/>
</div></figure>
<p>Now that you know more about how your activity gets its lifecycle methods, let’s see how you deal with device configuration changes.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Save the current state in a Bundle"><div class="sect1" id="save_the_current_state_in_a_bundle">
<h1>Save the current state in a Bundle</h1>
<p><a data-type="indexterm" data-primary="Android devices" data-secondary="rotation of" id="idm46053741333488"/><a data-type="indexterm" data-primary="Bundle" id="idm46053741332512"/><a data-type="indexterm" data-primary="Bundle" data-secondary="get methods to retrieve values" id="idm46053741331776"/><a data-type="indexterm" data-primary="Bundle" data-secondary="put methods to add values" id="idm46053741330800"/><a data-type="indexterm" data-primary="getBoolean() method, Bundle" id="idm46053741329728"/><a data-type="indexterm" data-primary="getLong() method, Bundle" id="idm46053741328928"/><a data-type="indexterm" data-primary="putBoolean() method" id="idm46053741328128"/><a data-type="indexterm" data-primary="putLong method" id="idm46053741327296"/><a data-type="indexterm" data-primary="rotation of device" data-secondary="saving activity state for" id="idm46053741326464"/><a data-type="indexterm" data-primary="Stopwatch app" data-secondary="saving activity state" id="idm46053741325392"/>As you saw earlier, the Stopwatch app went wrong when we rotated the device. <code>MainActivity</code> was destroyed and recreated, so all the property values were lost, and the <code>Chronometer</code> view was reset.</p>
<p>To fix this bug, we’ll save the state of the <code>Chronometer</code> and property values before the activity gets destroyed, and restore them when the activity gets recreated. We’ll save the values in a type of object called a <code><strong>Bundle</strong></code>.</p>
<p>A <code>Bundle</code> is a type of object that’s used to hold key/value pairs. Before the activity is destroyed, Android lets you put key/value pairs into a <code>Bundle</code>. This <code>Bundle</code> is then picked up by the new instance of the activity when it’s recreated. Using a <code>Bundle</code> therefore gives you a way of reinstating an activity’s state when you rotate the device screen.</p>
<p>Before we show you how the <code>Bundle</code> is passed between activity instances, let’s look at how you add and retrieve values.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0184-01.png" alt="image" width="309" height="380"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Add values using put methods"><div class="sect2" id="add_values_using_put_methods">
<h2>Add values using put methods</h2>
<p>You add key/value pairs to a <code>Bundle</code> using <code>put</code> methods. The <code>putLong</code> method puts a <code>Long</code> value into a <code>Bundle</code>, <code>putBoolean()</code> adds a <code>Boolean</code>, and so on. The following code, for example, puts a key of “answer” and an <code>Int</code> value of 42 into a <code>Bundle</code> named <code>bundle</code>:</p>
<pre data-type="programlisting"><strong>bundle.putInt("answer", 42)</strong></pre>
<p>You can save multiple key/value pairs to a <code>Bundle</code>. Each key must be of type <code>String?</code>, and the value must match the method call. You can’t, say, put an <code>Int</code> value into a <code>Bundle</code> using the <code>putString()</code> method without upsetting the compiler.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0184-02.png" alt="image" width="336" height="550"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Retrieve values using get methods"><div class="sect2" id="retrieve_values_using_get_methods">
<h2>Retrieve values using get methods</h2>
<p>Once you’ve put a key/value pair into a <code>Bundle</code>, you can retrieve the value using the <code>Bundle</code>’s <code>get</code> methods. The <code>getLong()</code> method lets you get a <code>Long</code> value, for example, and you use the <code>getBoolean()</code> method to retrieve a <code>Boolean</code>.</p>
<p>Each <code>get</code> method takes one parameter: the name of the key whose value you want to get. The following code, for example, gets the value that’s saved against a key of “answer” in a <code>Bundle</code> named <code>bundle</code>:</p>
<pre data-type="programlisting"><strong>val answerOfLife = bundle.getInt("answer")</strong></pre>
<p>Now that you know how to add and retrieve values using a <code>Bundle</code>, let’s find out how to use one to save and restore an activity’s state.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Save the state using onSaveInstanceState()"><div class="sect1" id="save_the_state_using_onsaveinstancestate">
<h1>Save the state using onSaveInstanceState()</h1>
<p><a data-type="indexterm" data-primary="Bundle" data-secondary="onCreate() method" id="idm46053741291840"/><a data-type="indexterm" data-primary="Bundle" data-secondary="onSaveInstanceState() method" id="idm46053741290800"/><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="Bundle" id="idm46053741289664"/><a data-type="indexterm" data-primary="onSaveInstanceState() method" id="idm46053741288592"/><a data-type="indexterm" data-primary="onSaveInstanceState() method" data-secondary="activities" id="idm46053741287792"/><code>Bundle</code>s are passed from one instance of an activity to another using two methods: <code><strong>onSaveInstanceState()</strong></code> and <code><strong>onCreate()</strong></code>. <code>onSaveInstanceState()</code> lets you add values to a <code>Bundle</code> before the activity is destroyed, and <code>onCreate()</code> picks the <code>Bundle</code> up again when the activity has been recreated.</p>
<p>Each activity inherits the <code>onSaveInstanceState()</code> method from its <code>Activity</code> superclass. It gets called just before the activity is destroyed, and takes one parameter: a <code>Bundle</code>.</p>
<p>You override the <code>onSaveInstanceState()</code> method in your activity using code like this:</p>
<pre data-type="programlisting"><strong>override fun onSaveInstanceState(savedInstanceState: Bundle) {</strong>
    <strong>savedInstanceState.putInt("answer", 42)</strong>
    <strong>super.onSaveInstanceState(savedInstanceState)</strong>
<strong>}</strong></pre>
<figure class="informal"><div class="figure">
<img src="Images/f0185-01.png" alt="image" width="390" height="682"/>
<h6/>
</div></figure>
<p>The above example puts a key of “answer” and an <code>Int</code> value of 42 into the <code>onSaveInstanceState()</code> method’s <code>Bundle</code> (named <code>savedInstanceState</code>). It then calls the superclass version of <code>onSaveInstanceState()</code>, which saves the state of the view hierarchy.</p>
<section data-type="sect2" data-pdf-bookmark="Restore the state using onCreate()"><div class="sect2" id="restore_the_state_using_oncreateleft_par">
<h2>Restore the state using onCreate()</h2>
<p>As you already know, the <code>onCreate()</code> method gets called when the activity is recreated, and it takes one parameter, a <code>Bundle?</code>. If the activity’s being created from scratch, the <code>Bundle?</code> will be <code>null</code>, but if the activity’s being recreated, it’s the same <code>Bundle</code> object that was used by <code>onSaveInstanceState()</code>.</p>
<p>You use the <code>onCreate()</code> method to get values from the <code>Bundle</code> using code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0185-02.png" alt="image" width="600" height="149"/>
<h6/>
</div></figure>
<p>So what code changes do we need to make to the Stopwatch app?</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The updated MainActivity.kt code"><div class="sect1" id="the_updated_mainactivitydotkt_code">
<h1>The updated MainActivity.kt code</h1>
<p><a data-type="indexterm" data-primary="Bundle" data-secondary="saving and retrieving activity state" id="idm46053741265680"/>We’ve updated the <code>MainActivity</code> code so that if the user rotates the device, its state gets saved in a <code>Bundle</code> using the <code>onSaveInstanceState()</code> method, and restored via <code>onCreate()</code>. Update your <em>MainActivity.kt</em> code to include these changes (below in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0186-01.png" alt="image" width="600" height="631"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0187-01.png" alt="image" width="600" height="676"/>
<h6/>
</div></figure>
<p>Let’s run through what the code does, and take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when you run the app"><div class="sect1" id="what_happens_when_you_run_the_ap-id00058">
<h1>What happens when you run the app</h1>
<ol>
<li><p><strong>The user starts the app, and clicks on the Start button.</strong></p>
<p>The stopwatch starts and the <code>running</code> property is set to <code>true</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0188-01.png" alt="image" width="600" height="179"/>
<h6/>
</div></figure></li>
<li><p><strong>The user rotates the device screen.</strong></p>
<p>Android views this as a configuration change, and gets ready to destroy the activity. Before the activity is destroyed, <code>onSaveInstanceState()</code> gets called. The <code>onSaveInstanceState()</code> method saves the <code>offset</code>, <code>running</code> and <code>stopwatch.base</code> values to a <code>Bundle</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0188-02.png" alt="image" width="600" height="411"/>
<h6/>
</div></figure></li>
<li><p><strong>Android destroys the activity, and then recreates it.</strong></p>
<p>The activity’s property values get reset.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0189-01.png" alt="image" width="600" height="237"/>
<h6/>
</div></figure></li>
<li><p><strong>The onCreate() method gets called.</strong></p>
<p>It uses the values saved in the <code>Bundle</code> to set the property values.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0189-02.png" alt="image" width="600" height="208"/>
<h6/>
</div></figure></li>
<li><p><strong>The stopwatch starts running again and displays the correct time.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0189-03.png" alt="image" width="159" height="106"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00059">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>Make the changes to your activity code, then run the app.</p>
<p>When we click on the Start button, the timer starts, and it continues when we rotate the device screen.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0190-01.png" alt="image" width="600" height="335"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00060">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Remind me, why does Android recreate the activity just because I rotate the screen?</strong></p>
<p><strong>A:</strong> The <code>onCreate()</code> method is normally used to set up the screen. If your code in <code>onCreate()</code> depends upon the screen configuration (for example, if you have different layouts for landscape and portrait), then you would want <code>onCreate()</code> to be called every time the configuration changes. Also, if the user changes their locale, you might want to recreate the UI in the local language.</p>
<p><strong>Q: Why doesn’t Android store every instance variable automatically? Why do I have to write all that code myself?</strong></p>
<p><strong>A:</strong> It’s because you might not want every instance variable to be stored. For example, you might have a variable that stores the current screen width. You would want that variable to be recalculated the next time <code>onCreate()</code> is called.</p>
<p><strong>Q: You mentioned</strong> <code><strong>AppCompatActivity</strong></code> <strong>is part of Android Jetpack. Is it in a separate library? Do I need to update the <em>build.gradle</em> files?</strong></p>
<p><strong>A:</strong> <code>AppCompatActivity</code> is part of the <code>AppCompat</code> library. We’ve not told you to update the <em>build.gradle</em> files because Android Studio should have already included this library for you. If you want to double-check, look for an <code>AppCompat</code> dependency in the app <em>build.gradle</em> file.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Activity Magnets"><div class="sect1" id="activity_magnets-id00061">
<h1>Activity Magnets</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="activity magnets exercise" id="idm46053741214048"/><a data-type="indexterm" data-primary="exercises" data-secondary="Magnets" id="idm46053741212608"/>The activity below is for a new Greetings app. You enter your name in an edit text (with the ID <code>name</code>), and when you click on a button (with the ID <code>button</code>), the text in the text view (with the ID <code>hello</code>) is updated to include your name.</p>
<p>When you run the app and rotate the screen, the text in the <code>hello</code> text view gets lost. Use the magnets below to make sure the text gets reinstated in this situation.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0191-01.png" alt="image" width="372" height="384"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0191-02.png" alt="image" width="600" height="510"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Activity Magnets Solution"><div class="sect1" id="activity_magnets_solution-id00062">
<h1>Activity Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p>The activity below is for a new Greetings app. You enter your name in an edit text (with the ID <code>name</code>), and when you click on a button (with the ID <code>button</code>), the text in the text view (with the ID <code>hello</code>) is updated to include your name.</p>
<p>When you run the app and rotate the screen, the text in the <code>hello</code> text view gets lost. Use the magnets below to make sure the text gets reinstated in this situation.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0192-01.png" alt="image" width="372" height="385"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0192-02.png" alt="image" width="600" height="510"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="There’s more to an activity’s life than create and destroy"><div class="sect1" id="thereapostrophes_more_to_an_activityapos">
<h1>There’s more to an activity’s life than create and destroy</h1>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="states in" id="idm46053741192368"/><a data-type="indexterm" data-primary="onStart() method, activity lifecycle" id="idm46053741190944"/><a data-type="indexterm" data-primary="onStop() method, activity lifecycle" id="idm46053741190144"/><a data-type="indexterm" data-primary="Stopwatch app" data-secondary="managing state changes" id="idm46053741189344"/>So far we’ve looked at the create and destroy parts of the activity lifecycle (and a little bit in between), and you’ve seen how to deal with configuration changes such as screen orientation. But there are other events in an activity’s life that you might want to deal with to get the app to behave the way you want.</p>
<p>As an example, suppose the stopwatch is running and you get a phone call. Even though the stopwatch isn’t visible, it will continue running. But what if you want the stopwatch to pause while it’s hidden, and resume once the app is visible again?</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">Even if you don’t really want your stopwatch to behave like this, just play along with us. It’s a great excuse to look at more lifecycle methods.</span></p>
</div>
<section data-type="sect2" data-pdf-bookmark="Start, stop, and restart"><div class="sect2" id="startcomma_stopcomma_and_restart">
<h2>Start, stop, and restart</h2>
<p>Fortunately, it’s easy to handle actions that relate to an activity’s visibility if you use the right lifecycle methods. In addition to the <code>onCreate()</code> and <code>onDestroy()</code> methods, which deal with the overall lifecycle of the activity, there are other lifecycle methods that deal with an activity’s visibility.</p>
<p>Specifically, there are three key lifecycle methods that deal with when an activity becomes visible or invisible to the user: <code>onStart()</code>, <code>onStop()</code>, and <code>onRestart()</code>. Just as with <code>onCreate()</code> and <code>onDestroy()</code>, your activity inherits them from the Android <code>Activity</code> class.</p>
<p>Here’s an overview of these methods:</p>
<blockquote>
<p><strong>An activity’s state is <u>stopped</u> if it’s completely hidden by another activity and isn’t visible to the user. The activity still exists in the background and maintains all state information.</strong></p>
</blockquote>
<table class="border">
<tbody>
<tr>
<td><strong>Method</strong></td>
<td><strong>When it’s called</strong></td>
</tr>
<tr>
<td><strong>onStart()</strong></td>
<td>When your activity becomes visible.</td>
</tr>
<tr>
<td><strong>onStop()</strong></td>
<td>When the activity has stopped being visible. This might be because it’s completely hidden by another activity that’s appeared on top of it, or because the activity is about to be destroyed.</td>
</tr>
<tr>
<td><strong>onRestart()</strong></td>
<td>After the activity has been made invisible, before it gets made visible again.</td>
</tr>
</tbody>
</table>
<p>We’ll take a closer look at how these fit in with the <code>onCreate()</code> and <code>onDestroy()</code> methods on the next page.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The visible lifecycle"><div class="sect1" id="the_visible_lifecycle">
<h1>The visible lifecycle</h1>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" data-tertiary="onStart(), onStop(), onRestart()" id="idm46053741167168"/><a data-type="indexterm" data-primary="onRestart() method, activity lifecycle" id="idm46053741165920"/><a data-type="indexterm" data-primary="onStart() method, activity lifecycle" id="idm46053741165040"/><a data-type="indexterm" data-primary="onStop() method, activity lifecycle" id="idm46053741164224"/>Let’s build on the lifecycle diagram you saw earlier in the chapter, this time including the <code>onStart()</code>, <code>onStop()</code>, and <code>onRestart()</code> methods (the new bits are in black):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0194-01.png" alt="image" width="366" height="764"/>
<h6/>
</div></figure>
<ol>
<li><p><strong>The activity gets launched, and the onCreate() method runs.</strong></p>
<p>Any activity initialization code in the <code>onCreate()</code> method runs. At this point, the activity isn’t yet visible, as no call to <code>onStart()</code> has been made.</p></li>
<li><p><strong>The onStart() method runs. It gets called when the activity is about to become visible.</strong></p>
<p>After the <code>onStart()</code> method has run, the user can see the activity on the screen.</p></li>
<li><p><strong>The onStop() method runs when the activity stops being visible to the user.</strong></p>
<p>After the <code>onStop()</code> method has run, the activity is no longer visible.</p></li>
<li><p><strong>If the activity becomes visible to the user again, the onRestart() method gets called followed by onStart().</strong></p>
<p>The activity may go through this cycle many times if the activity repeatedly loses visibility and then becomes visible again.</p></li>
<li><p><strong>Finally, the activity is destroyed.</strong></p>
<p>The <code>onStop()</code> method will get called before <code>onDestroy()</code>.</p></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We need to implement two more lifecycle methods"><div class="sect1" id="we_need_to_implement_two_more_lifecycle">
<h1>We need to implement two more lifecycle methods</h1>
<p><a data-type="indexterm" data-primary="onStop() method, activity lifecycle" id="idm46053741147840"/>There are two things we need to do to update the Stopwatch app. First, we need to implement the activity’s <code>onStop()</code> method so that the stopwatch pauses when the app isn’t visible. Once we’ve done that, we need to implement <code>onRestart()</code> so that the stopwatch starts again when the app is visible.</p>
<p>Let’s start with the <code>onStop()</code> method.</p>
<blockquote>
<p><strong>When you override any activity lifecycle method in your activity, you need to call the Activity superclass method or the compiler will complain.</strong></p>
</blockquote>
<section data-type="sect2" data-pdf-bookmark="Implement onStop() to pause the stopwatch"><div class="sect2" id="implement_onstopleft_parenthesisright_pa">
<h2>Implement onStop() to pause the stopwatch</h2>
<p>You override the <code>onStop()</code> method by adding the following method to your activity:</p>
<pre data-type="programlisting"><strong>override fun onStop() {</strong>
    <strong>super.onStop()</strong>
    <strong>//Code to run when the activity stops</strong>
<strong>}</strong></pre>
<p>The line:</p>
<pre data-type="programlisting"><strong>super.onStop()</strong></pre>
<p>calls the <code>onStop()</code> method in the <code>Activity</code> superclass. You need to add this line of code whenever you override the <code>onStop()</code> method to make sure the activity gets to perform any other actions in the superclass <code>onStop()</code> method. If you bypass this step, Android will generate an exception. This applies to all of the lifecycle methods; if you override any of the <code>Activity</code> lifecycle methods in your activity, you must call the superclass method or the compiler will get upset.</p>
<p>We need to get the stopwatch to stop if it’s running when the <code>onStop()</code> method is called. To do this, we need to call the <code>saveOffset()</code> method—which makes sure we can later restart the stopwatch from the same displayed time—and then stop the stopwatch. Here’s the code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0195-01.png" alt="image" width="600" height="229"/>
<h6/>
</div></figure>
<p>So now the stopwatch stops when the activity is no longer visible. The next thing we need to do is get the stopwatch to start again when the activity becomes visible.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Restart the stopwatch when the app becomes visible"><div class="sect1" id="restart_the_stopwatch_when_the_app_becom">
<h1>Restart the stopwatch when the app becomes visible</h1>
<p><a data-type="indexterm" data-primary="onRestart() method, activity lifecycle" id="idm46053741128464"/><a data-type="indexterm" data-primary="onStart() method, activity lifecycle" id="idm46053741127552"/>When the activity becomes visible again, two key lifecycle methods get called: <code>onStart()</code> and <code>onRestart()</code>.</p>
<p><code>OnStart()</code> is called when the activity is about to become visible. This can be when the activity is first created, or when it becomes visible again after losing its visibility.</p>
<p>You implement the <code>onStart()</code> method using code like this:</p>
<pre data-type="programlisting"><strong>override fun onStart() {</strong>
    <strong>super.onStart()</strong>
    <strong>//Code to run when the activity starts</strong>
<strong>}</strong></pre>
<p>As with the <code>onStop()</code> method, the line:</p>
<pre data-type="programlisting"><strong>super.onStart()</strong></pre>
<p>calls the <code>onStart()</code> method in the <code>Activity</code> superclass.</p>
<p>The <code>onRestart()</code> method is called before <code>onStart(</code>), but only when the activity becomes visible again after previously losing visibility. It’s <em>not</em> called when the activity first becomes visible.</p>
<p>You implement the <code>onRestart()</code> method using code like this:</p>
<pre data-type="programlisting"><strong>override fun onRestart() {</strong>
    <strong>super.onRestart()</strong>
    <strong>//Code to run when the activity restarts</strong>
<strong>}</strong></pre>
<blockquote>
<p><strong>onStart() gets called whenever the activity becomes visible.</strong></p>
<p><strong>onRestart() only gets called when the activity becomes visible again after losing visibility.</strong></p>
</blockquote>
<p>In the Stopwatch app, we want the stopwatch to start running again when the activity regains visibility, so we’ll implement the <code>onRestart()</code> method. The code looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0196-02.png" alt="image" width="600" height="210"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The updated MainActivity.kt code"><div class="sect1" id="the_updated_mainactivitydotkt_co-id00063">
<h1>The updated MainActivity.kt code</h1>
<p><a data-type="indexterm" data-primary="onRestart() method, activity lifecycle" id="idm46053741108144"/>Here is the code for <em>MainActivity.kt</em>, including the <code>onStop()</code> and <code>onRestart()</code> methods; update the code so it includes the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0197-01.png" alt="image" width="600" height="687"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when you run the app"><div class="sect1" id="what_happens_when_you_run_the_ap-id00064">
<h1>What happens when you run the app</h1>
<ol>
<li><p><strong>The user starts the app, and clicks the Start button to set the stopwatch going.</strong></p>
<p>The stopwatch starts, and the <code>running</code> property is set to <code>true</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0198-01.png" alt="image" width="600" height="167"/>
<h6/>
</div></figure></li>
<li><p><strong>The user navigates to the device’s home screen so the Stopwatch app is no longer visible.</strong></p>
<p>The <code>onStop()</code> method gets called, the <code>offset</code> property is updated, and the stopwatch is stopped.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0198-02.png" alt="image" width="600" height="141"/>
<h6/>
</div></figure></li>
<li><p><strong>The user navigates back to the Stopwatch app.</strong></p>
<p>The <code>onRestart()</code> method gets called, the <code>stopwatch.base</code> property is updated, the stopwatch starts, and the <code>offset</code> property is set to <code>0</code>. The stopwatch starts from the correct time.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0198-03.png" alt="image" width="600" height="172"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00065">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app and click on the Start button the timer starts. It stops when the app is no longer visible, and restarts when the app becomes visible again.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0199-01.png" alt="image" width="600" height="424"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00066">
<h5>there are no Dumb Questions</h5>
<p><strong>Q:Could we have used the</strong> <code><strong>onStart()</strong></code> <strong>method instead of</strong> <code><strong>onRestart()</strong></code> <strong>to set the stopwatch running again?</strong></p>
<p><strong>A:</strong> Yes. When an activity becomes visible after having previously been invisible, both <code>onRestart()</code> and <code>onStart()</code> get called, so we could have used either method.</p>
<p><strong>Q: So why did we use</strong> <code><strong>onRestart()</strong></code> <strong>and not</strong> <code><strong>onStart()</strong></code><strong>?</strong></p>
<p><strong>A:</strong> Unlike <code>onRestart()</code>, <code>onStart()</code> also gets called when the activity first becomes visible after it’s been created. This means that it’s slightly more efficient to use <code>onRestart()</code> than it is to use <code>onStart()</code>.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-id00067">
<h5><span class="inlineimage"><img src="Images/exercise.png" alt="Images" width="125" height="79"/></span> Exercise</h5>
<p><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" data-tertiary="exercise" id="idm46053741069872"/>The activity code on the right changes the value of a property named <code>x</code> at various stages of the activity lifecycle. See if you can determine which lifecycle methods get called and the final value of <code>x</code> after each of the actions below.</p>
<ol>
<li><p>The user opens the app and it starts running.</p></li>
<li><p>The user opens the app and it starts running. The user then rotates the device.</p></li>
<li><p>The user opens the app and it starts running. The user navigates to the Android Home screen, then returns to the app.</p></li>
</ol>
<pre data-type="programlisting">package com.hfad.lifecycleexercise

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle

class MainActivity : AppCompatActivity() {

    var x = 0

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        x = savedInstanceState?.getInt("x") ?: 2
    }

    override fun onRestart() {
        super.onRestart()
        x -= 7
    }

    override fun onStart() {
        super.onStart()
        x += 6
    }

    override fun onStop() {
        super.onStop()
        x *= 2
    }

    override fun onSaveInstanceState(savedInstanceState: Bundle) {
        savedInstanceState.putInt("x", x + 1)
        super.onSaveInstanceState(savedInstanceState)
    }
}</pre>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-id00068">
<h5><span class="inlineimage"><img src="Images/exercise.png" alt="Images" width="125" height="79"/></span> Exercise Solution</h5>
<p>The activity code on the right changes the value of a property named <code>x</code> at various stages of the activity lifecycle. See if you can determine which lifecycle methods get called and the final value of <code>x</code> after each of the actions below.</p>
<ol>
<li><p>The user opens the app and it starts running.</p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">onCreate(): x = 2</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStart():. x = 8</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">The final value of x is 8.</span></strong></p></li>
</ul></li>
<li><p>The user opens the app and it starts running. The user then rotates the device.</p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">onCreate(): x = 2</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStart(): x = 8</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStop(): x = 16</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onSaveInstanceState(): x = 16</span></strong></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">While onSaveInstanceState() saves a value of 17 to the Bundle, x isn’t set until the onCreate() method runs.</span></p>
</div></li>
<li><p><strong><span style="color:#004A8F;">onCreate(): x = 17</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStart(): x = 23</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">The final value of x is 23.</span></strong></p></li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">Here, onRestart() doesn’t get called because the app doesn’t lose visibility.</span></p>
</div></li>
<li><p>The user opens the app and it starts running. The user navigates to the Android Home screen, then returns to the app.</p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">onCreate(): x = 2</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStart(): x = 8</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStop(): x = 16</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onRestart(): x = 9</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">onStart(): x = 15</span></strong></p></li>
<li><p><strong><span style="color:#004A8F;">The final value of x is 15.</span></strong></p></li>
</ul></li>
</ol>
<pre data-type="programlisting">package com.hfad.lifecycleexercise

import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle

class MainActivity : AppCompatActivity() {

    var x = 0

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        x = savedInstanceState?.getInt("x") ?: 2
    }

    override fun onRestart() {
        super.onRestart()
        x -= 7
    }

    override fun onStart() {
        super.onStart()
        x += 6
    }

    override fun onStop() {
        super.onStop()
        x *= 2
    }

    override fun onSaveInstanceState(savedInstanceState: Bundle) {
        savedInstanceState.putInt("x", x + 1)
        super.onSaveInstanceState(savedInstanceState)
    }
}</pre>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What if an activity is only partially visible?"><div class="sect1" id="what_if_an_activity_is_only_partially_vi">
<h1>What if an activity is only partially visible?</h1>
<p><a data-type="indexterm" data-primary="focus, activities having" id="idm46053741024624"/><a data-type="indexterm" data-primary="onPause() method, activity lifecycle" id="idm46053741023792"/><a data-type="indexterm" data-primary="onResume() method, activity lifecycle" id="idm46053741022864"/><a data-type="indexterm" data-primary="paused activity" id="idm46053741022064"/>So far you’ve seen what happens when an activity gets created and destroyed, and you’ve also seen what happens when an activity becomes visible, and when it becomes invisible. But there’s one more situation you need to consider: <strong>when an activity is visible but doesn’t have the focus</strong>.</p>
<p>When an activity is visible but doesn’t have the focus, the activity is <strong>paused</strong>. This can happen if another activity appears on top of your activity that isn’t full-size or that’s transparent. The activity on top has the focus, but the one underneath is still visible and is therefore paused.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0204-01.png" alt="image" width="571" height="671"/>
<h6/>
</div></figure>
<blockquote>
<p><strong>An activity has a state of paused if it’s lost the focus but is still visible to the user. The activity is still alive and maintains all its state information.</strong></p>
</blockquote>
<p>There are two lifecycle methods that handle when the activity is paused and when it becomes active again: <code><strong>onPause()</strong></code> and <code><strong>onResume()</strong></code>. <code>onPause()</code> gets called when your activity is visible but another activity has the focus. <code>onResume()</code> is called immediately before your activity is about to start interacting with the user. Let’s look at how these methods fit in with the rest of the activity lifecycle.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The foreground lifecycle"><div class="sect1" id="the_foreground_lifecycle">
<h1>The foreground lifecycle</h1>
<p>Let’s build on the lifecycle diagram you saw earlier in the chapter, this time including the <code>onResume()</code> and <code>onPause()</code> methods (the new bits are in black):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0205-01.png" alt="image" width="362" height="800"/>
<h6/>
</div></figure>
<ol>
<li><p><strong>The activity gets launched, and the onCreate() and onStart() methods run.</strong></p>
<p>At this point, the activity is visible, but it doesn’t have the focus.</p></li>
<li><p><strong>The onResume() method runs. It gets called when the activity is about to move into the foreground.</strong></p>
<p>After the <code>onResume()</code> method has run, the activity has the focus and the user can interact with it.</p></li>
<li><p><strong>The onPause() method runs when the activity stops being in the foreground.</strong></p>
<p>After the <code>onPause()</code> method has run, the activity is still visible but doesn’t have the focus.</p></li>
<li><p><strong>If the activity moves into the foreground again, the onResume() method gets called.</strong></p>
<p>The activity may go through this cycle many times if the activity repeatedly loses and then regains the focus.</p></li>
<li><p><strong>If the activity stops being visible to the user, the onStop() method gets called.</strong></p>
<p>After the <code>onStop()</code> method has run, the activity is no longer visible.</p></li>
<li><p><strong>If the activity becomes visible to the user again, the onRestart() method gets called, followed by onStart() and onResume().</strong></p>
<p>The activity may go through this cycle many times.</p></li>
<li><p><strong>Finally, the activity is destroyed.</strong></p>
<p>As the activity moves from running to destroyed, the <code>onPause()</code> and <code>onStop()</code> methods get called before the activity is destroyed.</p></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pause the stopwatch if the activity’s paused"><div class="sect1" id="pause_the_stopwatch_if_the_activityapost">
<h1>Pause the stopwatch if the activity’s paused</h1>
<p>Let’s get back to the Stopwatch app.</p>
<p>So far we’ve made the stopwatch pause if the Stopwatch app isn’t visible, and made it restart when the app becomes visible again. We did this by overriding the <code>onStop()</code> and <code>onRestart()</code> methods.</p>
<p>Let’s get the app to have the same behavior if the app is only partially visible. We’ll get the stopwatch to pause if the activity is paused, and start again when the activity is resumed. So which lifecycle methods do we need to implement?</p>
<p>The easy answer is that we need to use the <code>onPause()</code> and <code>onResume()</code> methods, but we can take this one step further. We’ll use these methods to <em>replace</em> the calls to <code>onStop()</code> and <code>onRestart()</code> that we’ve already implemented.</p>
<p>If you look again at the lifecycle diagram, calls are made to <code>onPause()</code> and <code>onResume()</code>—in addition to <code>onStop()</code>, <code>onStart(),</code> and <code>onRestart()</code>—whenever an activity is stopped and restarted. Because we want the app to have the same behavior irrespective of whether the activity has been paused or stopped, we can use the <code>onPause()</code> and <code>onResume()</code> methods for both situations.</p>
<p>You implement the <code>onPause()</code> and <code>onResume()</code> methods using code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0206-01.png" alt="image" width="331" height="800"/>
<h6/>
</div></figure>
<pre data-type="programlisting"><strong>override fun onPause() {</strong>
    <strong>super.onPause()</strong>
    <strong>//Code to run when the activity pauses</strong>
<strong>}</strong>

<strong>override fun onResume() {</strong>
    <strong>super.onResume()</strong>
    <strong>//Code to run when the activity resumes</strong>
<strong>}</strong></pre>
<p>As before, the calls to <code>super.onPause()</code> and <code>super.onResume()</code> are mandatory. They call the <code>onPause()</code> and <code>onResume()</code> methods in the <code>Activity</code> superclass, and without these method calls, the code won’t compile.</p>
<p>We want to replace the <code>onStop()</code> and <code>onRestart()</code> methods in <em>MainActivity.kt</em> with implementations of <code>onPause()</code> and <code>onResume()</code>. See if you can figure out the required code changes by having a go at the following exercise.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00069">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil</h5>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen your pencil" id="idm46053740975664"/>We want the stopwatch to pause each time <code>MainActivity</code> loses the focus, and start when it regains it. Update the <em>MainActivity.kt</em> code below to include the required code changes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0207-01.png" alt="image" width="600" height="711"/>
<h6/>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00070">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil Solution</h5>
<p>We want the stopwatch to pause each time <code>MainActivity</code> loses the focus, and start when it regains it. Update the <em>MainActivity.kt</em> code below to include the required code changes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0208-01.png" alt="image" width="600" height="779"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The complete MainActivity.kt code"><div class="sect1" id="the_complete_mainactivitydotkt_code">
<h1>The complete MainActivity.kt code</h1>
<p>Here’s the full <em>MainActivity.kt</em> code for the finished app; update your code to include the changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0209-01.png" alt="image" width="600" height="738"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0210-01.png" alt="image" width="600" height="754"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0211-01.png" alt="image" width="600" height="576"/>
<h6/>
</div></figure>
<p>Before we take the app for a test drive, let’s go through what happens when the code runs.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when you run the app"><div class="sect1" id="what_happens_when_you_run_the_ap-id00071">
<h1>What happens when you run the app</h1>
<ol>
<li><p><strong>The user starts the app, and clicks the Start button to set the stopwatch going.</strong></p>
<p>The stopwatch starts and the <code>running</code> property is set to <code>true</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0212-01.png" alt="image" width="600" height="176"/>
<h6/>
</div></figure></li>
<li><p><strong>Another activity appears in the foreground, leaving MainActivity partially visible.</strong></p>
<p>The <code>onPause()</code> method gets called, the <code>offset</code> property is updated, and the stopwatch is stopped.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0212-02.png" alt="image" width="600" height="137"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity returns to the foreground.</strong></p>
<p>The <code>onResume()</code> method gets called, the <code>stopwatch.base</code> property is updated, the stopwatch starts, and the <code>offset</code> property is set to <code>0</code>. The stopwatch starts from the correct time.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0212-03.png" alt="image" width="600" height="179"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00072">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app and click on the Start button, the timer starts; it pauses when the app is partially obscured by another activity; and it starts again when the app is back in the foreground.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0213-01.png" alt="image" width="600" height="513"/>
<h6/>
</div></figure>
<p>Congratulations! You’ve built a working Stopwatch app, and learned how to use Android’s activity lifecycle methods to take control of your app’s behavior.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your handy guide to the activity lifecycle methods"><div class="sect1" id="your_handy_guide_to_the_activity_lifecyc">
<h1>Your handy guide to the activity lifecycle methods</h1>
<table class="border">
<tbody>
<tr>
<td><a data-type="indexterm" data-primary="activity lifecycle" data-secondary="properties and methods" data-tertiary="summary table" id="idm46053740932800"/><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="activity lifecycle" id="idm46053740931072"/><a data-type="indexterm" data-primary="onDestroy() method, activity lifecycle" id="idm46053740930000"/><a data-type="indexterm" data-primary="onPause() method, activity lifecycle" id="idm46053740929200"/><a data-type="indexterm" data-primary="onRestart() method, activity lifecycle" id="idm46053740928400"/><a data-type="indexterm" data-primary="onResume() method, activity lifecycle" id="idm46053740927600"/><a data-type="indexterm" data-primary="onStart() method, activity lifecycle" id="idm46053740926800"/><a data-type="indexterm" data-primary="onStop() method, activity lifecycle" id="idm46053740926000"/><strong>Method</strong></td>
<td><strong>When it’s called</strong></td>
<td><strong>Next method</strong></td>
</tr>
<tr>
<td><strong>onCreate()</strong></td>
<td>When the activity is first created. Use it for normal setup, such as creating views. It also gives you a <code>Bundle</code> that contains the previously saved state of the activity.</td>
<td><code>onStart()</code></td>
</tr>
<tr>
<td><strong>onRestart()</strong></td>
<td>When your activity has been stopped but just before it gets started again.</td>
<td><code>onStart()</code></td>
</tr>
<tr>
<td><strong>onStart()</strong></td>
<td>When your activity is becoming visible. It’s followed by <code>onResume()</code> if the activity comes into the foreground, or <code>onStop()</code> if the activity is made invisible.</td>
<td><code>onResume()</code> or <code>onStop()</code></td>
</tr>
<tr>
<td><strong>onResume()</strong></td>
<td>When your activity is in the foreground.</td>
<td><code>onPause()</code></td>
</tr>
<tr>
<td><strong>onPause()</strong></td>
<td>When your activity is no longer in the foreground because another activity is resuming. The next activity isn’t resumed until this method finishes, so any code in this method needs to be quick. It’s followed by <code>onResume()</code> if the activity returns to the foreground, or <code>onStop()</code> if it becomes invisible.</td>
<td><code>onResume()</code> or <code>onStop()</code></td>
</tr>
<tr>
<td><strong>onStop()</strong></td>
<td>When the activity is no longer visible. This can be because another activity is covering it, or because this activity is being destroyed. It’s followed by <code>onRestart()</code> if the activity becomes visible again, or <code>onDestroy()</code> if the activity is being destroyed.</td>
<td><code>onRestart()</code> or <code>onDestroy()</code></td>
</tr>
<tr>
<td><strong>onDestroy()</strong></td>
<td>When your activity is about to be destroyed or because the activity is finishing.</td>
<td>None</td>
</tr>
</tbody>
</table>
</div></section>
<section data-type="sect1" data-pdf-bookmark="BE the Activity"><div class="sect1" id="be_the_activity">
<h1>BE the Activity</h1>
<figure class="informal"><div class="figure">
<img src="Images/common04.png" alt="image" width="156" height="199"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Be the . . ." id="idm46053740901216"/><strong>On the right, you’ll see some activity code. Your job is to play like you’re the activity and say which code will run in each of the situations below. We’ve labeled the code we want you to consider. We’ve done the first one to start you off.</strong></p>
<p><strong>User starts the activity and starts using it.</strong></p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;"><strong>Code segments A, G, D. The activity is created, then made visible, then receives the focus.</strong></span></strong></p></li>
</ul>
<p><strong>User starts the activity, starts using it, then switches to another app.</strong></p>
<p><strong>User starts the activity, starts using it, rotates the device, switches to another app, then goes back to the activity.</strong></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">This one’s tough.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0215-01.png" alt="image" width="333" height="800"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="BE the Activity Solution"><div class="sect1" id="be_the_activity_solution">
<h1>BE the Activity Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common04.png" alt="image" width="156" height="199"/>
<h6/>
</div></figure>
<p><strong>On the right, you’ll see some activity code. Your job is to play like you’re the activity and say which code will run in each of the situations below. We’ve labeled the code we want you to consider. We’ve done the first one to start you off.</strong></p>
<p><strong>User starts the activity and starts using it.</strong></p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">Code segments A, G, D. The activity is created, then made visible, then receives the focus.</span></strong></p></li>
</ul>
<p><strong>User starts the activity, starts using it, then switches to another app.</strong></p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">Code segments A, G, D, B, E. The activity is created, then made visible, then receives the focus. When the user switches to another app, it loses the focus and is no longer visible to the user.</span></strong></p></li>
</ul>
<p><strong>User starts the activity, starts using it, rotates the device, switches to another app, then goes back to the activity.</strong></p>
<ul style="list-style-type:none;">
<li><p><strong><span style="color:#004A8F;">Code segments A, G, D, B, E, H, A, G, D, B, E, C, G, D. First, the activity is created, made visible, and receives the focus. When the device is rotated, the activity loses the focus, stops being visible, and is destroyed. It’s then created again, made visible, and receives the focus. When the user switches to another app and back again, the activity loses the focus, loses visibility, becomes visible again, and regains the focus.</span></strong></p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0216-01.png" alt="image" width="336" height="800"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00073">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#the_activity_lifecyclecolon_being_an_act">Chapter 5</a> under your belt and now you’ve added the activity lifecycle to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0217-01.png" alt="image" width="233" height="210"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0217-02.png" alt="image" width="417" height="800"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00074">
<h5>Bullet Points</h5>
<ul>
<li><p>The <code>Chronometer</code> view implements a simple timer. <code>Chronometer</code> is a subclass of <code>TextView</code>.</p></li>
<li><p>A device configuration change results in the activity being destroyed and recreated.</p></li>
<li><p>Your activity inherits the lifecycle methods from the <code>android.app.Activity</code> class. If you override any of these methods, you need to call up to the method in the superclass.</p></li>
<li><p><code>onSaveInstanceState(Bundle)</code> enables your activity to save its state before the activity gets destroyed. You can use the <code>Bundle</code> to restore state in <code>onCreate()</code>.</p></li>
<li><p>You add values to a <code>Bundle</code> in <code>onSaveInstanceState()</code> using <code>bundle.put...("name", value)</code>.</p></li>
<li><p>You retrieve values from the bundle in <code>onCreate()</code> using <code>bundle.get...("name")</code>.</p></li>
<li><p><code>onCreate()</code> and <code>onDestroy()</code> deal with the birth and death of the activity.</p></li>
<li><p><code>onRestart()</code>, <code>onStart()</code>, and <code>onStop()</code> deal with the visibility of the activity.</p></li>
<li><p><code>onResume()</code> and <code>onPause()</code> get called when the activity gains and loses the focus.</p></li>
</ul>
</div></aside>
</div></section>
</div></section></div></body></html>