<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 2. Working with Permissions and Privileged Accounts" data-type="chapter" epub:type="chapter"><div class="chapter" id="working_with_permissions_and_privileged">
<h1><span class="label">Chapter 2. </span>Working with Permissions <span class="keep-together">and Privileged Accounts</span></h1>
<p>For sysadmins, the CLI is home. <a contenteditable="false" data-primary="permissions and privileged accounts" data-type="indexterm" id="ix_perm"/>Typing at the keyboard is standard fare. You’ll need to become comfortable with the command line, its idiosyncrasies, and its shortcuts—yes, there are command-line shortcuts. <a contenteditable="false" data-primary="CLI (command-line interface)" data-secondary="power and usefulness of" data-type="indexterm" id="idm45657875778176"/>There’s a lot to learn about Linux at the command line. There are dozens of commands, each with dozens of options. Sure, you’ll only use a handful of commands and a limited number of options for each command, but you need to know how to find the options you need and how to use them when you need to.</p>
<p>The true power of the CLI is in its ease of use. The CLI was the first interface that users and programmers had with which to address their operating environments. The fact that the CLI is still in use some 50 years later is a testament to its power and usefulness to the sysadmin and user alike. This chapter teaches you to work at the command line as a regular user and as a root user. You also learn to set and modify file permissions and the effects that those permissions have on files.</p>
<section data-pdf-bookmark="Working as a Regular User" data-type="sect1"><div class="sect1" id="working_as_a_regular_user">
<h1>Working as a Regular User</h1>
<p>There are two user types on a Linux system: regular users and a root, or administrator, user. <a contenteditable="false" data-primary="users" data-secondary="regular user, working as" data-type="indexterm" id="idm45657875661296"/><a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="working as regular user" data-type="indexterm" id="idm45657885894864"/>Regular users each receive their own home directory and somewhat limited system use. The root user also has a home directory (<em>/root</em>). Regular users have almost unlimited power in their own home directories to create, modify, remove, and manipulate files but have almost no power outside of that single location. Many system commands are available to regular users. In contrast, other commands are restricted to those granted limited root user access through the <code>sudo</code> command or direct access to the root user account.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The general and most security-conscious rule is that you should always work as a regular user unless some task requires privileged (root user) access, which is covered in the next section.</p>
</div>
</div></section>
<section data-pdf-bookmark="Working as the Root User" data-type="sect1"><div class="sect1" id="working_as_the_root_user">
<h1>Working as the Root User</h1>
<p>The root user is the all-powerful account on any Linux system. <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="working as root user" data-type="indexterm" id="iz_permroot"/><a contenteditable="false" data-primary="root user" data-type="indexterm" id="ix_root"/>The root user can create, edit, move, or remove any file on the system. The root user can reboot, change runlevels, and shut down the system. There are three methods of becoming the root user:</p>
<ul>
<li>
<p>Logging in as the root user</p>
</li>
<li>
<p>Using the <code>su</code> (substitute user) command</p>
</li>
<li>
<p>Using the <code>sudo</code> command</p>
</li>
</ul>
<section data-pdf-bookmark="Logging in as Root" data-type="sect2"><div class="sect2" id="logging_in_as_root">
<h2>Logging in as Root</h2>
<p>On some Linux distributions, you can directly log in as the root user on a system via SSH across the network or interactively at the console.<a contenteditable="false" data-primary="root user" data-secondary="logging in as root" data-type="indexterm" id="idm45657875471856"/><a contenteditable="false" data-primary="SSH" data-secondary="root login via" data-type="indexterm" id="idm45657875470000"/> Some Linux distributions prevent SSH root logins by default, while others leave it up to the administrators to decide. It’s not recommended to SSH to a system and login as root. The primary reason is that if you allow across-the-network root access to a system, then it’s possible that malicious actors can attempt to brute force a root login. You don’t want this to happen. Later in the book, I’ll show you how to prevent SSH root logins, if not already disabled, on your distribution.</p>
<p>You shouldn’t directly log in as root at the console because doing so prevents system logging from recording who has logged in and become root. Recording who uses the root user account is important because when something goes wrong, you want to know which administrator performed the actions. This record-keeping’s purpose is not to lay blame. Still, it is necessary to meet some regulatory requirements and to correct the actions of a system administrator who needs a teachable moment or some advanced training. The next two options we discuss are better, safer ways to become the root user.</p>
</div></section>
<section data-pdf-bookmark="Using the su Command" data-type="sect2"><div class="sect2" id="using_the_su_command">
<h2>Using the su Command</h2>
<p>One of the appropriate methods of becoming the root user is to use the <code>su</code> (substitute user) command. <a contenteditable="false" data-primary="root user" data-secondary="using su command" data-type="indexterm" id="idm45657875738096"/><a contenteditable="false" data-primary="su (substitute user) command" data-type="indexterm" id="idm45657875468528"/>The caveat with using <code>su</code> is that the user must know the root user password. If administrative users know the root password, it’s difficult to prevent those same administrators from directly logging in as root. Using the <code>su</code> command to become root is acceptable, but only if the root password changes after each use. In larger enterprises, security groups maintain root passwords, and system administrators can check out the root password temporarily to perform maintenance.</p>
<p>The root user may <code>su</code> to any other user account on the system without knowing the user’s password. This power allows administrators to log in as, or become, any user for troubleshooting purposes because it’s often difficult for users to accurately describe problems they’re experiencing. It also prevents a user from revealing their password to an administrator, which should force the user to change their password.</p>
<p>To <code>su</code> to another account is a simple procedure. Issue the <code>su</code> command and the user account you wish to <code>su</code> to. <a contenteditable="false" data-primary="$ shell prompt" data-type="indexterm" id="idm45657875475728"/>For this example, I use the full prompt rather than just the <code>$</code> to demonstrate the user change:</p>
<pre data-type="programlisting">
[bjones@server1] $ su root
Password:
#</pre>
<p>The <code>#</code> prompt <a contenteditable="false" data-primary="shell prompt" data-secondary="# (root user)" data-type="indexterm" id="idm45657875487504"/>informs you that <a contenteditable="false" data-primary="# shell prompt" data-type="indexterm" id="idm45657875449424"/>you are now logged in as the root user. In this book, the user prompt is <code>$</code> and the root is <code>#</code>, to distinguish a standard user’s prompt from the root user’s. Any command you issue now is done with root privilege, which means that you must be careful because there are no restrictions on the account.</p>
<p>The better method of using <code>su</code> is using the <code>su -</code> command because <a contenteditable="false" data-primary="su (substitute user) command" data-secondary="- option" data-type="indexterm" id="idm45657880676288"/>the <code>-</code> means that you also want to take on the root user’s full environment rather than just the account privilege.<a contenteditable="false" data-primary="env command" data-type="indexterm" id="idm45657875446624"/> The display is much too long to show here, but if you issue the <code>env</code> command, you’ll see the original user’s environment variables rather than root’s:</p>
<pre data-type="programlisting">
# env</pre>
<p>Use the <code>exit</code> command to return to the original <a contenteditable="false" data-primary="exit command" data-type="indexterm" id="idm45657875446832"/>user account, as shown here:</p>
<pre data-type="programlisting">
# exit
[bjones@server1] $</pre>
<p>And now issue the <code>su</code> command with the <code>-</code> option. You don’t have to specify root in this command because the default is root:</p>
<pre data-type="programlisting">
[bjones@server1] $ su -
Password:
# env</pre>
<p>The root user’s environment variables are now displayed. Using the <code>su -</code> command is the equivalent of logging into the console as the root user. Any user may <code>su</code> to any other user account, which requires one to know the other user’s password:</p>
<pre data-type="programlisting">
[bjones@server1] $ su cdavis
Password:
[cdavis@server1] $</pre>
</div></section>
<section data-pdf-bookmark="Using the sudo Command" data-type="sect2"><div class="sect2" id="using_the_sudo_command">
<h2>Using the sudo Command</h2>
<p>The best method to obtain root access is to use the “substitute user do” or “execute a command as another user” (<code>sudo</code>) command.<a contenteditable="false" data-primary="sudo (substitute user do) command" data-type="indexterm" id="idm45657875484176"/><a contenteditable="false" data-primary="root user" data-secondary="using sudo command" data-type="indexterm" id="idm45657875434368"/> The <code>sudo</code> command allows an appropriately configured user account to issue individual commands as the root user. The <code>sudo</code> command must precede each command issued. On first use, the <code>sudo</code> command requires that the <em>sudoer</em> (a user account configured for <code>sudo</code> use) supply their own password, as shown in the following code listing. <a contenteditable="false" data-primary="sudoers" data-type="indexterm" id="idm45657875429952"/>Knowledge of the root password isn’t required.</p>
<pre data-type="programlisting">
$ sudo env
[sudo] password for bjones:
bjones is not in the sudoers file.  This incident will be reported.
[bjones@server1 ~]$</pre>
<p>The warning that the user is not in the <em>sudoers</em> file means that the user account, bjones, is not configured in the <em>/etc/sudoers</em> file. In the next section, I demonstrate how to set up a user to be a sudoer.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <code>sudo</code> command, the <em>/etc/sudoers</em> file, and the sudoer user label are interesting because they have their own unique pronunciations. The accepted pronunciation for <code>sudo</code> is “soodoo” and sudoer is “soodooer.” Some sysadmins pronounce them as “soodoe” and “soodoe-ers,” but no one takes issue with either pronunciation.</p>
</div>
</div></section>
<section data-pdf-bookmark="Creating a Sudoer" data-type="sect2"><div class="sect2" id="creating_a_sudoer">
<h2>Creating a Sudoer</h2>
<p>You must have root user access to edit the <em>/etc/sudoers</em> file and to use the <code>visudo</code> utility, whose only purpose is to edit the <em>/etc/sudoers</em> file. <a contenteditable="false" data-primary="root user" data-secondary="creating a sudoer" data-type="indexterm" id="idm45657875420736"/><a contenteditable="false" data-primary="sudoers" data-secondary="creating" data-type="indexterm" id="idm45657875419520"/>You shouldn’t edit it directly with vi, Emacs, or any other text editor.<a contenteditable="false" data-primary="visudo command" data-type="indexterm" id="idm45657875417120"/> To edit the <em>/etc/sudoers</em> file, issue the <code>visudo</code> command as root with no options:</p>
<pre data-type="programlisting">
# visudo</pre>
<p>The <em>/etc/sudoers</em> file is a simple text file describing users, groups, and commands that can work with root or other user privileges. You can create a sudoer with very restrictive permissions (i.e., to run a single command as root) or permissive: run any command as root without entering a password to do so. I prefer to configure a mixture of the two by creating sudoers who can run any command as root but must supply their password.</p>
<p>Hundreds of possible configuration scenarios exist for the <em>/etc/sudoers</em> file and sudoers. It’s out of the scope of this book to explore more than what’s given here as examples. In this first example, I demonstrate how I set up my user account to use <code>sudo</code>. My settings require me to enter my password when using <code>sudo</code>:</p>
<pre data-type="programlisting">
## Allow root to run any commands anywhere
root    ALL=(ALL)       ALL
khess   ALL=(ALL)       ALL</pre>
<p>I copy the root user’s setting and insert my user account in its place. The setting takes effect immediately. Setting up a user account to use <code>sudo</code> without issuing a password is not recommended. Using a password when issuing a command is an attempt to make it more difficult to make mistakes while wielding root privilege. The same can be said of the <code>sudo</code> command itself. The theory is that if an administrator has to issue the <code>sudo</code> command, they will make fewer mistakes as root because it requires them to think specifically about their command action and its results.<a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="working as root user" data-startref="iz_permroot" data-type="indexterm" id="idm45657875417600"/><a contenteditable="false" data-primary="root user" data-startref="ix_root" data-type="indexterm" id="idm45657875407488"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Reading and Modifying Permissions" data-type="sect1"><div class="sect1" id="reading_and_modifying_permissions">
<h1>Reading and Modifying Permissions</h1>
<p>This section teaches you how to read and modify file permissions. <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-type="indexterm" id="ix_permrdmod"/>You must learn file permissions to set and modify access to files and directories appropriately. Knowing file permissions helps troubleshoot when users can’t access a file or directory.</p>
<p>File permissions are simple but central to Linux security. Their simplicity can make them susceptible to neglect and misconfiguration. Frustrated sysadmins sometimes loosen permissions to solve a problem but never return to the issue or reset the permissions to their proper settings.</p>
<section data-pdf-bookmark="Read, Write, and Execute" data-type="sect2"><div class="sect2" id="readcomma_writecomma_and_execute">
<h2>Read, Write, and Execute</h2>
<p>The three <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-tertiary="read, write, and execute" data-type="indexterm" id="idm45657875455296"/>Linux <a contenteditable="false" data-primary="read, write, and execute permissions" data-type="indexterm" id="idm45657875568432"/>file permissions<a contenteditable="false" data-primary="write (w) permissions" data-type="indexterm" id="idm45657875401552"/> or modes are read (r), write (w), and <a contenteditable="false" data-primary="execute (x) permissions" data-type="indexterm" id="idm45657875400144"/>execute (x):</p>
<dl>
<dt>Read</dt>
<dd>View a file or list directory contents.</dd>
<dt>Write</dt>
<dd>Create and modify a file or copy, move, and create files in a directory.</dd>
<dt>Execute</dt>
<dd>Execute/run a file or <code>cd</code> into a directory.</dd>
</dl>
<p>As mentioned in <a data-type="xref" href="ch01.xhtml#getting_started_with_linux">Chapter 1</a>, a file’s name does not determine whether it’s executable, as is the case for MS Windows (<em>.exe</em> files, etc.). <a contenteditable="false" data-primary="executable files" data-type="indexterm" id="idm45657875393568"/>A Linux file is executable or not based on its permissions.<a contenteditable="false" data-primary="x" data-see="execute permissions" data-type="indexterm" id="idm45657875390352"/></p>
<p>Using <a contenteditable="false" data-primary="rwx designations in permissions" data-type="indexterm" id="idm45657875391184"/>the rwx designations <a contenteditable="false" data-primary="symbolic mode (permissions)" data-type="indexterm" id="idm45657875388768"/>in permissions is known as <em>symbolic mode</em>. The symbolic mode is one of two methods of identifying permissions. The other is the numeric mode, which assigns values to each of the rwx permissions.</p>
</div></section>
<section data-pdf-bookmark="Numerical Permission Values" data-type="sect2"><div class="sect2" id="numerical_permission_value">
<h2>Numerical Permission Values</h2>
<p>Each of the permission modes has its own assigned numerical value. <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-tertiary="numerical permission values" data-type="indexterm" id="idm45657875383776"/><a contenteditable="false" data-primary="numerical permission values" data-type="indexterm" id="idm45657875382160"/>This shortcut method makes setting permissions easier for sysadmins.</p>
<p>The read permission has a value of <code>4</code>, write has a value of <code>2</code>, and execute has a value of <code>1</code>. Permission values can range from <code>0</code> to <code>7</code>. A zero permission value means no permission. <a data-type="xref" href="#numerical_permission_values">Table 2-1</a> summarizes this idea.</p>
<table class="border" id="numerical_permission_values">
<caption><span class="label">Table 2-1. </span>Numerical permission values</caption>
<thead>
<tr>
<th>Permission mode</th>
<th>Numerical value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read</td>
<td><code>4</code></td>
</tr>
<tr>
<td>Write</td>
<td><code>2</code></td>
</tr>
<tr>
<td>Execute</td>
<td><code>1</code></td>
</tr>
<tr>
<td>None</td>
<td><code>0</code></td>
</tr>
</tbody>
</table>
<p>In the next section, you will find out how these permissions work together with group permissions to create a simple but complete file security system.</p>
</div></section>
<section data-pdf-bookmark="Group Permissions" data-type="sect2"><div class="sect2" id="group_permissions-id00001">
<h2>Group Permissions</h2>
<p>Four file permissions apply to a user’s group: user, group, others, and all.<a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-tertiary="group permissions" data-type="indexterm" id="idm45657875366192"/><a contenteditable="false" data-primary="group permissions" data-type="indexterm" id="idm45657875363296"/> The “all” group includes user, group, and others. <a contenteditable="false" data-primary="user permissions" data-type="indexterm" id="idm45657875365648"/>It is a shorthand method of globally assigning permissions to a file or directory. <a contenteditable="false" data-primary="all group permissions" data-type="indexterm" id="idm45657875360448"/><a contenteditable="false" data-primary="other permissions" data-type="indexterm" id="idm45657875359472"/>Each group has a shorthand designation as well, as shown in <a data-type="xref" href="#group_permissions">Table 2-2</a>.</p>
<table class="border" id="group_permissions">
<caption><span class="label">Table 2-2. </span>Group permissions</caption>
<thead>
<tr>
<th>Permission group</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>User</td>
<td><code>u</code></td>
</tr>
<tr>
<td>Group</td>
<td><code>g</code></td>
</tr>
<tr>
<td>Other</td>
<td><code>o</code></td>
</tr>
<tr>
<td>All</td>
<td><code>a</code></td>
</tr>
</tbody>
</table>
<p>Users and sysadmins may set permissions on files for each group individually or all groups simultaneously. Each Linux file and directory is assigned read, write, and execute permissions for each group. The next section ties all of the permissions settings together for you.</p>
</div></section>
<section data-pdf-bookmark="Bringing Permissions into Focus" data-type="sect2"><div class="sect2" id="bringing_permissions_into_focus">
<h2>Bringing Permissions into Focus</h2>
<p>In this subsection, I’ll create a <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-tertiary="file security system showing all permissions working together" data-type="indexterm" id="ix_permrdmodall"/>simple but complete file security system that shows how all the permissions we’ve discussed work together. The examples in this section will use the file <em>file.txt</em>. If you want to follow along with the example, issue the following command to set up your file:</p>
<pre data-type="programlisting">
$ touch file.txt</pre>
<p>This command creates an empty file named <em>file.txt</em> for you. Next, issue the <code>ls</code> command with the <code>-l</code> (long) option<a contenteditable="false" data-primary="ls (list) command" data-secondary="ls -l " data-type="indexterm" id="idm45657875339600"/> to see file permissions:</p>
<pre data-type="programlisting">
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 19 17:35 file.txt</pre>
<p><a data-type="xref" href="#special_character_position_and_usercomm">Figure 2-1</a> illustrates the positions and their designations (in bold). <a contenteditable="false" data-primary="special character position (in permissions)" data-type="indexterm" id="idm45657875335344"/>The first position is for special file types, such as directories with a <code>d</code> in that position (<code>dr-xr-xr-w</code>). Regular files have a <code>-</code> (<code>-rw-rw-rw-</code>) to show that they’re not directories or other special files. The next nine positions are user, group, and other permissions locations. <a contenteditable="false" data-primary="other permissions" data-type="indexterm" id="idm45657875333504"/><a contenteditable="false" data-primary="group permissions" data-type="indexterm" id="idm45657875367120"/>The first “triad,” or three positions, are for the user, the second for group, and the final three are for other users.<a contenteditable="false" data-primary="user permissions" data-type="indexterm" id="idm45657875331040"/><br/>
 </p>
<figure><div class="figure" id="special_character_position_and_usercomm"><img alt="" height="312" src="assets/plsa_0201.png" width="600"/>
<h6><span class="label">Figure 2-1. </span>Special character position and user, group, and other permission locations</h6>
</div></figure>
<p><a data-type="xref" href="#numerical_permission_values_and_usercom">Figure 2-2</a> shows the numerical permissions for each listing and then an explicit label for the user (<code>u</code>), group (<code>g</code>), and other (<code>o</code>) triads.<a contenteditable="false" data-primary="ugo designations in  permissions" data-type="indexterm" id="idm45657875323920"/><a contenteditable="false" data-primary="numerical permission values" data-type="indexterm" id="idm45657875323216"/></p>
<figure><div class="figure" id="numerical_permission_values_and_usercom"><img alt="" height="360" src="assets/plsa_0202.png" width="600"/>
<h6><span class="label">Figure 2-2. </span>Numerical permission values and user, group, and other (ugo) designations</h6>
</div></figure>
<p>As shown in <a data-type="xref" href="#numerical_permission_values_and_usercom">Figure 2-2</a>, numerical permissions are additive for each triad to create a permission profile for a file. For example, a file with <code>-rw-rw-r--</code> permissions has a numeric permission value of <code>664</code>. The read permission has a value of <code>4</code> added to the value of the write permission, which is <code>2</code>, which equals <code>6</code>. All three possible permissions, <code>rwx</code>, yield a value of <code>7</code>.</p>
<p>If a file has permission equal to <code>750</code>, the rwx representation is <code>-rwxr-x---</code>. This means that others outside the designated user and group have no permission for the file.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <em>other</em> group is often referred to as <em>world</em>. <a contenteditable="false" data-primary="world group" data-seealso="other permissions" data-type="indexterm" id="idm45657875311264"/>For example, if permissions for a file are <code>-rw-rw-r--</code>, this file is referred to as <em>world readable</em> rather than as <em>other readable</em>. <a contenteditable="false" data-primary="world readable files" data-type="indexterm" id="idm45657875308912"/>Permissions for the “other” group are especially sensitive because allowing write or execute permissions to files and directories to others (the world) can be a security risk.</p>
</div>
<p>Next, you’ll <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-startref="ix_permrdmodall" data-tertiary="file security system showing all permissions working together" data-type="indexterm" id="idm45657875666240"/><a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="reading and modifying permissions" data-startref="ix_permrdmod" data-type="indexterm" id="idm45657875305344"/>learn how to set and change file permissions using multiple methods.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Changing File Permissions" data-type="sect1"><div class="sect1" id="changing_file_permissions">
<h1>Changing File Permissions</h1>
<p>Setting and changing file permissions or <em>modes</em> is a common system administrator task. <a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="changing file permissions" data-type="indexterm" id="ix_permchg"/>Each file on the filesystem has permissions that allow or deny access to users, groups, and others. To change file permissions, you use the <code>chmod</code> (change mode) command. <a contenteditable="false" data-primary="chmod (change mode) command" data-type="indexterm" id="idm45657875332912"/>You can set or modify permissions with the <code>chmod</code> command in multiple ways. You don’t have to be consistent.<a contenteditable="false" data-primary="ugo designations in  permissions" data-type="indexterm" id="idm45657875295632"/><a contenteditable="false" data-primary="symbolic mode (permissions)" data-secondary="rwx and ugo designations" data-type="indexterm" id="idm45657875294528"/><a contenteditable="false" data-primary="rwx designations in permissions" data-type="indexterm" id="idm45657875293216"/> You can use <code>chmod</code> with either numeric designations or the rwx and ugo designations, but you can’t combine the two in the same command. I demonstrate several possibilities and practical examples in the following sections.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Some sysadmins find the symbolic (rwx and ugo) method easier to grasp than the numeric (0, 1, 2, 4) method. You can use either or both methods, because they are equivalent.</p>
</div>
<section data-pdf-bookmark="Symbolic Mode" data-type="sect2"><div class="sect2" id="symbolic_mode">
<h2>Symbolic Mode</h2>
<p>Changing permissions using the symbolic mode method is quite simple. <a contenteditable="false" data-primary="ls (list) command" data-secondary="ls -l" data-type="indexterm" id="idm45657875286064"/><a contenteditable="false" data-primary="symbolic mode (permissions)" data-secondary="using with ls -l to change permissions" data-type="indexterm" id="idm45657875284624"/><a contenteditable="false" data-primary="chmod (change mode) command" data-secondary="using with symbolic mode to change permissions" data-type="indexterm" id="idm45657875283312"/>Referring to the original <em>file.txt</em> file you created in a previous example, view the original permissions with the <code>ls -l</code> command:</p>
<pre data-type="programlisting">
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 19 17:35 file.txt</pre>
<p>The current file permissions aren’t adequate. You need to restrict anyone else but yourself from even reading this file. How do you do it? You remove the read permission from others. Removing is equivalent to subtraction because you are subtracting a permission from the current ones given to the file.<a contenteditable="false" data-primary="read, write, and execute permissions" data-secondary="adding to or subtracting from files using chmod with rwx" data-type="indexterm" id="idm45657875737104"/> So, to remove read permission from the file, you subtract read from others using the <code>chmod</code> command:</p>
<pre data-type="programlisting">
$ chmod o-r file.txt
$ ls -l
-rw-rw----. 1 khess khess 0 Jun 19 17:35 file.txt</pre>
<p>You have removed read permission from the file for others. Now, no one but you can read (or write to) this file.</p>
<p>When you create a shell script and attempt to execute it with <code>./file.sh</code> but nothing happens, you should check the file’s permissions to see if you’ve added the execute permission:</p>
<pre data-type="programlisting">
$ touch file.sh
$ echo "echo Hello" &gt; file.sh
$ ./file.sh
-bash: ./file.sh: Permission denied</pre>
<p>Permission denied? But I just created the file in my home directory! Checking permissions reveals the problem:</p>
<pre data-type="programlisting">
$ ls -l
-rw-rw-r--. 1 khess khess 11 Jun 29 19:58 file.sh</pre>
<p>The file, <em>file.sh</em>, is named with a <em>.sh</em> extension. Recall that extensions have no effect in Linux and realize that <em>file.sh</em> isn’t currently executable because it doesn’t have the execute permission. You receive the “Permission denied” message when attempting to execute it. To fix the problem, add the execute permission for yourself:</p>
<pre data-type="programlisting">
$ chmod u+x file.sh
$ ls -l
-rwxrw-r--. 1 khess khess 11 Jun 29 19:58 file.sh</pre>
<p>Now, <em>file.sh</em> is executable:</p>
<pre data-type="programlisting">
$ ./file.sh
Hello</pre>
<p>You can add or subtract multiple permissions from a file and even add and subtract permissions within the same command. Here are some examples of each action. The first command removes (deletes—<code>rm file.txt</code>) the file from any previous example.</p>
<p>To add multiple permissions to a file:</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 20:13 file.txt
$ chmod ug+x,o+w file.txt
-rwxrwxrw-. 1 khess khess 0 Jun 29 20:13 file.txt</pre>
<p>To subtract multiple permissions from a file:</p>
<pre data-type="programlisting">
$ ls -l
-rwxrwxrw-. 1 khess khess 0 Jun 29 20:13 file.txt
$ chmod a-x,o-rw file.txt
$ ls -l
-rw-rw----. 1 khess khess 0 Jun 29 20:13 file.txt</pre>
<p>Now add <a contenteditable="false" data-primary="group permissions" data-secondary="adding or removing using chmod with ugo" data-type="indexterm" id="idm45657875268960"/>execute permission for all groups and remove read permission for others:</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 20:13 file.txt
$ chmod a+x,o-r file.txt
$ ls -l
-rwxrwx--x. 1 khess khess 0 Jun 29 20:23 file.txt</pre>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Be careful to explicitly define which ugo group you want to add or subtract permissions for. Simply supplying a <code>+x</code> or <code>-r</code> defaults to all.</p>
</div>
<p>If you don’t specify which groups you wish to add permissions or subtract permissions for, the default behavior is for the system to assume the intended group is <em>all</em>. This can be dangerous from a security perspective. Never grant permissions to all groups unless that is what you intend to do. In the following example, the execute permission is granted to all groups because you didn’t explicitly define which group should receive it:</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 20:34 file.txt
$ chmod +x file.txt
$ ls -l
-rwxrwxr-x. 1 khess khess 0 Jun 29 20:35 file.txt</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>To execute an<a contenteditable="false" data-primary="executable files" data-secondary="executing file or script not in your path" data-type="indexterm" id="idm45657875261168"/> executable file or script that is not in your path, you must provide the explicit path to the file. <a contenteditable="false" data-primary="paths (file)" data-secondary="executing executable file or script not in your path" data-type="indexterm" id="idm45657875571376"/>If the file is in your current directory, you must tell the shell that it is in your current directory and that you’d like to execute it. Use <code>./script_name.sh</code> to inform the shell that the file is executable and in your current directory. Here, <code>script_name.sh</code> is the file you wish to execute.</p>
</div>
</div></section>
<section data-pdf-bookmark="Numeric Mode" data-type="sect2"><div class="sect2" id="numeric_mode">
<h2>Numeric Mode</h2>
<p>For clarity and comparison, the examples in this section are duplicates of the examples in the previous section. <a contenteditable="false" data-primary="numerical permission values" data-secondary="using with chmod to change permissions" data-type="indexterm" id="idm45657875257760"/><a contenteditable="false" data-primary="chmod (change mode) command" data-secondary="using with numeric mode to change permisions" data-type="indexterm" id="idm45657875256992"/>But here we use the numeric mode (rather than the symbolic mode) of changing permissions.</p>
<p>Create a new file and check its permissions:</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 21:12 file.txt</pre>
<p>Remove the read permission from the other group using the numeric method. <a contenteditable="false" data-primary="read, write, and execute permissions" data-secondary="changing with chmod using numeric mode" data-type="indexterm" id="idm45657875252128"/>First, calculate the current permission value of the file and then what you want the new value to be. Currently, the file’s permission value is <code>664</code>. The desired value is <code>660</code>:</p>
<pre data-type="programlisting">
$ chmod 660 file.txt
$ ls -l
-rw-rw----. 1 khess khess 0 Jun 29 20:12 file.txt</pre>
<p>Using the numeric method, there’s no adding or subtracting of permissions. You simply reassign a permission value to the file. The code shown next is a repeat of what you did just a page ago and is a symbolic example. You added the execute permission to all and subtracted the read permission from others:</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 20:13 file.txt
$ chmod a+x,o-r file.txt
$ ls -l
-rwxrwx--x. 1 khess khess 0 Jun 29 20:23 file.txt</pre>
<p>The numeric equivalent is to reassign the value of the original file (<code>664</code>) to the new one (<code>771</code>):</p>
<pre data-type="programlisting">
$ rm file.txt
$ touch file.txt
$ ls -l
-rw-rw-r--. 1 khess khess 0 Jun 29 20:13 file.txt
$ chmod 771 file.txt
$ ls -l
-rwxrwx--x. 1 khess khess 0 Jun 29 20:23 file.txt</pre>
<p>Either method of changing permissions is perfectly acceptable; it doesn’t matter which method you use. Like most sysadmins, I use both methods interchangeably. It depends more on context and how quickly I want to do something. Changing permissions will become automatic to you with some practice and a few mistakes along the way.</p>
</div></section>
<section data-pdf-bookmark="Default Permissions Explained: umask" data-type="sect2"><div class="sect2" id="default_permissions_explained_umask">
<h2>Default Permissions Explained: umask</h2>
<p>You might have noticed that when you create a new file, it’s created with specific permissions: <code>664</code> or <code>-rw-rw-r--</code>. <a contenteditable="false" data-primary="default permissions" data-type="indexterm" id="idm45657875480928"/>For the root user the default permissions for a new file are <code>644</code> or <code>-rw-r--r--</code>. You might now wonder how this happens. A global setting called a <code>umask</code> (user file-creation mask) masks or filters certain permissions from being given to files by default. <a contenteditable="false" data-primary="umask command" data-type="indexterm" id="idm45657875234640"/>The execute permission is never given by default, so the <code>umask</code> setting does not explicitly mask it.<a contenteditable="false" data-primary="user file-creation mask" data-see="umask command" data-type="indexterm" id="idm45657875236592"/> To find out your user account’s default <code>umask</code> value, use the <code>umask</code> command:</p>
<pre data-type="programlisting">
$ umask
0002</pre>
<p>You might now wonder why the <code>umask</code> reports four digits; we’ve only worked with three so far. The first (leftmost) digit is for special permissions such as <code>setuid</code>, <code>setgid</code>, and <code>sticky</code>, which I’ll cover in a later chapter. <a contenteditable="false" data-primary="setuid, setgid, and sticky permissions" data-type="indexterm" id="idm45657875229072"/>For now, focus only on the rightmost three digits: <code>002</code>. These three digits correspond to rwx permissions for user, group, and other, respectively. When you create a new file, certain permissions are filtered out. In the case of the <code>002 umask</code>, the write (<code>w</code>) permission is filtered out, so new files are created as <code>-rw-rw-r--</code>. The <code>2</code> is for write permission. When a new file is created, the write permission is masked from the “other” group and therefore isn’t given to the new file.</p>
<p>For the root user, the default <code>umask</code> on my system is <code>0022</code>. The write (<code>w</code>) permission is masked from both group and other. The reason for a <code>umask</code> is security. When a regular user creates a file, you don’t want everyone else to be able to write to it—you must explicitly grant this permission. For the root user, the <code>umask</code> prevents the root group and others from writing to files by default. This security feature prevents daemons or programs running as root from writing to certain sensitive files such as the <em>/etc/passwd</em> file. Everyone may read the file but only the root user may write to it.</p>
<p>You may change your <code>umask</code> value by issuing the <code>umask</code> command and a new value. This temporarily changes the <code>umask</code> during your current login session:</p>
<pre data-type="programlisting">
$ umask 006
$ touch test.txt
$ ls -l test.txt
-rw-rw----. 1 khess khess 0 Jun 29 22:16 test.txt</pre>
<p>To make this change permanent, which you may change later, do the following to append the new <code>umask</code> to the end of the <em>.bashrc</em> file that resides in your home directory:</p>
<pre data-type="programlisting">
$ echo umask 006 &gt;&gt; ~/.bashrc
$ source .bashrc
$ umask
0006</pre>
<p>Every time you log in, your <code>umask</code> is set to <code>006</code> or <code>0006</code> (which are equivalent) and yields a more secure <code>-rw-rw----</code> new default file permission.<a contenteditable="false" data-primary="permissions and privileged accounts" data-secondary="changing file permissions" data-startref="ix_permchg" data-type="indexterm" id="idm45657875216880"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="summary-id00002">
<h1>Summary</h1>
<p>In this chapter, you gained more experience working at the command line, learned some new commands, and perhaps more importantly, learned to read and modify file permissions.<a contenteditable="false" data-primary="permissions and privileged accounts" data-startref="ix_perm" data-type="indexterm" id="idm45657880563888"/> In <a data-type="xref" href="ch03.xhtml#customizing_the_user_experience">Chapter 3</a>, you will learn some file editing basics and how to modify the user’s default environment.</p>
</div></section>
</div></section></div></body></html>