<html><head></head><body><div id="sbo-rt-content"><section data-type="appendix" epub:type="appendix" data-pdf-bookmark="Appendix B. Chart Repository API"><div class="appendix" id="appendix_b_chart_respoitory_api">
<h1><span class="label">Appendix B. </span>Chart Repository API</h1>


<p class="lead">In <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a>, we covered chart repositories. This appendix briefly covers the <a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary="about" id="idm46125982601944"/>chart repository API,
the underlying specification that enables Helm to work with chart repositories.</p>

<p>The chart repository API is lightweight because there is only one required HTTP endpoint that must be implemented: <code>GET /index.yaml</code>.</p>

<p>In 99% of cases, chart repositories also serve chart package tarballs (<em>.tgz</em>) and any associated provenance files (<em>.prov</em>). However, it is also possible to host these files on a separate domain.</p>

<p>As described in detail in <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a>, <em>index.yaml</em> represents<a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="API version" id="idm46125982611320"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="API version" id="idm46125982615688"/> the repository index, containing a complete list of all the available chart versions in the repository. The format of this file is specific to Helm, and it currently has only one API version (<code>1</code>).</p>






<section data-type="sect1" data-pdf-bookmark="index.yaml"><div class="sect1" id="idm46125982643160">
<h1>index.yaml</h1>

<p>When implementing the chart repository API, your service must provide <a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary="index.yaml" id="idm46125982641704"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="chart repository API" id="idm46125982619832"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="API requirements" id="idm46125982619032"/>an HTTP <code>GET /index.yaml</code> route relative to the repository URL provided. The response from this request must return a status code <code>200 OK</code>, and the response body must be a valid <em>index.yaml</em> as described in the following.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <code>GET /index.yaml</code> endpoint does not need to be at the root of the URL path. For instance, given a provided repository URL such as <em><a href="https://example.com/charts"><em class="hyperlink">https://example.com/charts</em></a></em>, the <code>GET /index.yaml</code> route must be accessible at <em><a href="https://example.com/charts/index.yaml"><em class="hyperlink">https://example.com/charts/index.yaml</em></a></em>.</p>
</div>








<section data-type="sect2" data-pdf-bookmark="The index.yaml Format"><div class="sect2" id="idm46125982629976">
<h2>The index.yaml Format</h2>

<p>Following is a simple, valid <em>index.yaml</em> with a single chart version (<code>superapp-0.1.0</code>):<a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary="index.yaml format" id="idm46125982627576"/><a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="chart repository API" data-tertiary="format of index.yaml" id="idm46125982632328"/></p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">apiVersion</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">v1</code><code> </code><a class="co" id="co_chart_repository_api_CO1-1" href="#callout_chart_repository_api_CO1-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code class="nt">entries</code><code class="p">:</code><code> </code><a class="co" id="co_chart_repository_api_CO1-2" href="#callout_chart_repository_api_CO1-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code>  </code><code class="nt">superapp</code><code class="p">:</code><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">apiVersion</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">v2</code><code>
</code><code>    </code><code class="nt">appVersion</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">1.16.0</code><code>
</code><code>    </code><code class="nt">created</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">2020-04-28T10:12:22.507943-05:00</code><code class="s">"</code><code> </code><a class="co" id="co_chart_repository_api_CO1-3" href="#callout_chart_repository_api_CO1-3"><img src="Images/3.png" alt="3"/></a><code>
</code><code>    </code><code class="nt">description</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">A</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">Helm</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">chart</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">for</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">Kubernetes</code><code>
</code><code>    </code><code class="nt">digest</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">46f9ddeca12ec0bc257a702dac7d069af018aed2a87314d86b230454ac033672</code><code> </code><a class="co" id="co_chart_repository_api_CO1-4" href="#callout_chart_repository_api_CO1-4"><img src="Images/4.png" alt="4"/></a><code>
</code><code>    </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">superapp</code><code>
</code><code>    </code><code class="nt">type</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">application</code><code>
</code><code>    </code><code class="nt">urls</code><code class="p">:</code><code> </code><a class="co" id="co_chart_repository_api_CO1-5" href="#callout_chart_repository_api_CO1-5"><img src="Images/5.png" alt="5"/></a><code>
</code><code>    </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">superapp-0.1.0.tgz</code><code>
</code><code>    </code><code class="nt">version</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">0.1.0</code><code>
</code><code class="nt">generated</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">2020-04-28T11:34:26.779758-05:00</code><code class="s">"</code><code> </code><a class="co" id="co_chart_repository_api_CO1-6" href="#callout_chart_repository_api_CO1-6"><img src="Images/6.png" alt="6"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_chart_repository_api_CO1-1" href="#co_chart_repository_api_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The repository API version (must always be <code>v1</code>).</p></dd>
<dt><a class="co" id="callout_chart_repository_api_CO1-2" href="#co_chart_repository_api_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>A map of unique chart names in the repository to a list of all available versions.</p></dd>
<dt><a class="co" id="callout_chart_repository_api_CO1-3" href="#co_chart_repository_api_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The timestamp of when the tarball was created using <code>helm package</code>.</p></dd>
<dt><a class="co" id="callout_chart_repository_api_CO1-4" href="#co_chart_repository_api_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>A SHA-256 digest of the tarball.</p></dd>
<dt><a class="co" id="callout_chart_repository_api_CO1-5" href="#co_chart_repository_api_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>A list of URLs where the chart can be downloaded. These URLs can be absolute, and even hosted on separate domain(s). If a relative path is provided, it is considered relative to <em>index.yaml</em>. Usually only one URL entry is provided per chart version, but multiple can be provided, and Helm will try to download the next item in the list if the previous one is inaccessible.</p></dd>
<dt><a class="co" id="callout_chart_repository_api_CO1-6" href="#co_chart_repository_api_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>The timestamp of when this <em>index.yaml</em> file was generated, in RFC 3339 format.</p></dd>
</dl>

<p>With the exception of the fields <code>created</code>, <code>digest</code>, and <code>urls</code>, all of the fields on each individual chart version are defined by the chart API (<code>name</code>, <code>version</code>, etc.). Please see <a data-type="xref" href="app01.xhtml#appendix_a_chart_api_versions">Appendix A</a> for more info.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="When Is index.yaml Downloaded?"><div class="sect2" id="idm46125982203976">
<h2>When Is index.yaml Downloaded?</h2>

<p>There are five noteworthy scenarios when Helm downloads or redownloads the repository index:<a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="chart repository API" data-tertiary="downloading index.yaml" id="idm46125982202568"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary="index.yaml downloaded" id="idm46125982201352"/></p>
<ol>
<li>
<p>When initially adding a chart repository:</p>

<pre data-type="programlisting">$ helm repo add myrepo https://charts.example.com</pre>
</li>
<li>
<p>When updating all chart repositories:</p>

<pre data-type="programlisting">$ helm repo update</pre>
</li>
<li>
<p>When updating dependencies (disabled with the <code>--skip-refresh</code> flag):</p>

<pre data-type="programlisting">$ helm dependency update</pre>
</li>
<li>
<p>When building dependencies from a lock file (disabled with the <code>--skip-refresh</code> flag):</p>

<pre data-type="programlisting">$ helm dependency build</pre>
</li>
<li>
<p>When installing a local chart with dependencies using the <code>--dependency-update</code> flag:</p>

<pre data-type="programlisting">$ helm install myapp . --dependency-update</pre>
</li>

</ol>
</div></section>













<section data-type="sect2" data-pdf-bookmark="When Is the Cached Version of index.yaml Used?"><div class="sect2" id="idm46125982190200">
<h2>When Is the Cached Version of index.yaml Used?</h2>

<p>Once <em>index.yaml</em> is downloaded, it is stored in a local cache <a data-type="indexterm" data-primary="index.yaml of chart repositories" data-secondary="chart repository API" data-tertiary="cached version use" id="idm46125982188392"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary="index.yaml cached version use" id="idm46125982187128"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="API cached version use" id="idm46125982185896"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="API format of index.yaml" id="idm46125982184680"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="index.yaml" data-tertiary="API download of index.yaml" id="idm46125982183448"/>and used whenever you reference the unique name you have associated with the repository (e.g., “myrepo”).</p>

<p>There are five noteworthy scenarios when Helm makes use of the locally cached repository index:</p>
<ol>
<li>
<p>When pulling a chart from a repo:</p>

<pre data-type="programlisting">helm pull myrepo/mychart</pre>
</li>
<li>
<p>When installing a chart from a repo:</p>

<pre data-type="programlisting">helm install myapp myrepo/mychart</pre>
</li>
<li>
<p>When upgrading a release based on a chart from a repo:</p>

<pre data-type="programlisting">helm upgrade myapp myrepo/mychart</pre>
</li>
<li>
<p>When searching for charts to use:</p>

<pre data-type="programlisting">helm search repo myrepo/</pre>
</li>
<li>
<p>When updating dependencies using the <code>--skip-refresh</code> flag (and a dependency contains an <code>alias</code> subfield such as <code>"@myrepo"</code>):</p>

<pre data-type="programlisting">helm dependency update --skip-refresh</pre>
</li>

</ol>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark=".tgz Files"><div class="sect1" id="idm46125982171144">
<h1>.tgz Files</h1>

<p><em>.tgz</em> files in a repository represent individual chart versions, packaged as compressed tarballs.<a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary=".tgz files" data-tertiary-sortas="dot tgz files" id="idm46125982169416"/><a data-type="indexterm" data-primary=".tgz file handling by repository API" data-primary-sortas=". dot tgz" id="idm46125982167896"/><a data-type="indexterm" data-primary=".tgz file handling by repository API" data-primary-sortas="dot tgz" id="idm46125982166984"/><a data-type="indexterm" data-primary=".tgz file handling by repository API" data-primary-sortas="tgz" id="idm46125982166024"/></p>

<p>There is no requirement for the URL path for these files as they are hosted in the repository; however, they must be able to be downloaded when they are requested by Helm. The status code of the response must be a <code>200 OK</code>, and the response body should be the content of the <em>.tgz</em> in binary form.</p>








<section data-type="sect2" data-pdf-bookmark="When Are .tgz Files Downloaded?"><div class="sect2" id="idm46125982151368">
<h2>When Are .tgz Files Downloaded?</h2>

<p>There are three noteworthy scenarios when Helm downloads chart package <em>.tgz</em> files:</p>
<ol>
<li>
<p>When pulling a chart from a repo:</p>

<pre data-type="programlisting">helm pull myrepo/mychart</pre>
</li>
<li>
<p>When installing a chart from a repo:</p>

<pre data-type="programlisting">helm install myapp myrepo/mychart</pre>
</li>
<li>
<p>When upgrading a release based on a chart from a repo:</p>

<pre data-type="programlisting">helm upgrade myapp myrepo/mychart</pre>
</li>

</ol>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark=".prov Files"><div class="sect1" id="idm46125982144904">
<h1>.prov Files</h1>

<p><em>.prov</em> files in a repository represent chart version signature files, <a data-type="indexterm" data-primary=".prov files in repository" data-primary-sortas=". dot prov" id="idm46125982143272"/><a data-type="indexterm" data-primary=".prov files in repository" data-primary-sortas="dot prov" id="idm46125982142424"/><a data-type="indexterm" data-primary=".prov files in repository" data-primary-sortas="prov" id="idm46125982141576"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="API" data-tertiary=".prov files" data-tertiary-sortas="dot prov files" id="idm46125982140728"/>signed with GNU Privacy Guard. These files are <em>optional</em> and are used for verification purposes.</p>

<p>Unlike <em>.tgz</em> files, <em>.prov</em> files have a unique URL path requirement. They must be accessible at the path of the associated <em>.tgz</em> suffixed with <em>.prov</em>. For example, if a <em>.tgz</em> file is located at <em>https://charts.example.com/superapp-0.1.0.tgz</em>, then the <em>.prov</em> file must be located at 
<span class="keep-together"><em>https://charts.example.com/superapp-0.1.0.tgz.prov</em></span>.</p>

<p>The status code of the response must be a <code>200 OK</code>, and the response body should be the content of the <em>.prov</em> in binary form.</p>








<section data-type="sect2" data-pdf-bookmark="When Are .prov Files Downloaded?"><div class="sect2" id="idm46125982133576">
<h2>When Are .prov Files Downloaded?</h2>

<p>There are three noteworthy scenarios when Helm downloads chart signature <em>.prov</em> files:</p>
<ol>
<li>
<p>When pulling a chart from a repo with the <code>--verify</code> flag:</p>

<pre data-type="programlisting">helm pull myrepo/mychart --verify</pre>
</li>
<li>
<p>When installing a chart from a repo with the <code>--verify</code> flag:</p>

<pre data-type="programlisting">helm install myapp myrepo/mychart --verify</pre>
</li>
<li>
<p>When upgrading a release based on a chart from a repo with the <code>--verify</code> flag:</p>

<pre data-type="programlisting">helm upgrade myapp myrepo/mychart --verify</pre>
</li>

</ol>
</div></section>





</div></section>







</div></section></div></body></html>