<html><head></head><body><section data-pdf-bookmark="Chapter 9. React Server Components" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch09">&#13;
<h1><span class="label">Chapter 9. </span>React Server Components</h1>&#13;
&#13;
&#13;
<p>In the previous chapter, we dove into the world of React frameworks,&#13;
particularly focusing on Next.js and Remix. We explored the reasons why&#13;
you might choose to use a framework in the first place, including the&#13;
benefits of abstraction, the conventions that speed up development, the&#13;
comprehensive solutions they offer for common problems, and their overall&#13;
impact on enhancing productivity.</p>&#13;
&#13;
<p>We delved into the details of Remix and Next.js, demonstrating the&#13;
common approaches each framework takes to solve similar problems by&#13;
implementing our own bare-bones framework, and teased Next.js’&#13;
server-first direction, fully embracing React Server Components (RSCs)<a data-primary="React Server Components (RSCs)" data-type="indexterm" id="ix_ReactServerComponentsRSCs.09.14.71"/>.</p>&#13;
&#13;
<p>Speaking of RSCs, they are an interesting trend in&#13;
the React ecosystem designed to improve the performance, efficiency, and&#13;
user experience of React applications. This advanced application&#13;
architecture combines the best aspects of server rendered <a data-primary="multipage apps (MPAs)" data-type="indexterm" id="id1031"/><a data-primary="MPAs (multipage apps)" data-type="indexterm" id="id1032"/>multipage&#13;
apps (MPAs) and client-rendered SPAs<a data-primary="single-page applications (SPAs)" data-type="indexterm" id="id1033"/><a data-primary="SPAs (single-page applications)" data-type="indexterm" id="id1034"/>, delivering a&#13;
seamless user experience without compromising on performance or&#13;
maintainability. In this chapter, we will discuss the core concepts,&#13;
benefits, and underlying mental models and mechanisms around which RSCs&#13;
work. For the latest information, always visit <a class="orm:hideurl" href="https://react.dev">react.dev</a>.</p>&#13;
&#13;
<p>RSCs introduce a new type of component that “runs”&#13;
on the server and is otherwise excluded from the client-side JavaScript&#13;
bundle. These components can run during build time, allowing you to read&#13;
from the filesystem, fetch static content, or access your data layer. By&#13;
passing data as props from server components to interactive client&#13;
components in the browser, RSCs maintain a highly efficient and&#13;
performant &#13;
<span class="keep-together">application.</span></p>&#13;
&#13;
<p>How then do server components work? Let’s dive a little deeper into what&#13;
server components are to understand this with a little more fidelity.</p>&#13;
&#13;
<p>As just described, a server component is a special type of component&#13;
that is executed on the server alone. To understand this better, let’s&#13;
remember that a React component is nothing more than a function that&#13;
returns a React element:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="kd">const</code><code class="w"> </code><code class="nx">Component</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="nx">hi</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;;</code><code class="w"/></pre>&#13;
&#13;
<p>In this snippet, <code>Component</code> is a function that returns&#13;
<code>&lt;div&gt;hi!&lt;/div&gt;</code>. Of course, <code>&lt;div&gt;hi!&lt;/div&gt;</code> returns another React&#13;
element since <code>&lt;</code> in React is an alias for <code>React.createElement</code>. We&#13;
covered this in <a data-type="xref" href="ch02.html#ch02">Chapter 2</a> on JSX. In case you’re drawing blanks here,&#13;
now’s a good time to quickly refresh that information and come back.&#13;
Ultimately, all components return React elements, which is virtual DOM.</p>&#13;
&#13;
<p>Server components are no different. If <code>Component</code> is executed either on&#13;
the server or the client, it returns vDOM. In <a data-type="xref" href="ch03.html#ch03">Chapter 3</a>, we saw how&#13;
React elements are just JavaScript objects that have the following&#13;
schema:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
  <code class="nx">type</code><code class="o">:</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">({</code>&#13;
    <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
    <code class="nx">type</code><code class="o">:</code> <code class="s2">"div"</code><code class="p">,</code>&#13;
    <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">children</code><code class="o">:</code> <code class="p">[</code>&#13;
        <code class="p">{</code>&#13;
          <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
          <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
            <code class="nx">children</code><code class="o">:</code> <code class="s2">"hi!"</code>&#13;
          <code class="p">},</code>&#13;
        <code class="p">},</code>&#13;
      <code class="p">],</code>&#13;
    <code class="p">},</code>&#13;
  <code class="p">}),</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Invoking our <code>Component</code> function<a data-primary="Component function" data-type="indexterm" id="id1035"/> in both client and server environments&#13;
will return a React element, as shown.</p>&#13;
&#13;
<p>With server components, they are <em>only</em> invoked (or called) on the&#13;
server, and the resulting JavaScript object representing an element is&#13;
sent over the network to a client. Of course, client components are the&#13;
regular React components we’re used to.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Benefits" data-type="sect1"><div class="sect1" id="id186">&#13;
<h1>Benefits</h1>&#13;
&#13;
<p>Understanding this, we start to see some of the benefits<a data-primary="React Server Components (RSCs)" data-secondary="benefits" data-type="indexterm" id="id1036"/> of server&#13;
components:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>They execute only on the server side, on machines whose computational&#13;
power <em>we</em> control. This leads to more predictable performance, as we&#13;
don’t do computations on unpredictable client devices.</p>&#13;
</li>&#13;
<li>&#13;
<p>They execute in our secure server environments, so we can do secure&#13;
operations in server components without worrying about leaking tokens&#13;
and other secure information.</p>&#13;
</li>&#13;
<li>&#13;
<p>Server components can be asynchronous<a data-primary="asynchronous rendering" data-secondary="and server components" data-secondary-sortas="server components" data-type="indexterm" id="id1037"/> since we can wait for them to&#13;
complete executing on our servers before we share them with clients over&#13;
the network.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>This is the true power of server components. Going forward, let’s&#13;
explore how server components interplay with server-side rendering.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Server Rendering" data-type="sect1"><div class="sect1" id="id138">&#13;
<h1>Server Rendering</h1>&#13;
&#13;
<p>We’ve covered server rendering<a data-primary="React Server Components (RSCs)" data-secondary="and server rendering" data-secondary-sortas="server rendering" data-type="indexterm" id="ix_ReactServerComponentsRSCsandserverrendering.09.109.31"/><a data-primary="server-side rendering (SSR)" data-secondary="and server components" data-secondary-sortas="server components" data-type="indexterm" id="ix_serversiderenderingSSRandservercomponents.09.109.31"/> at length in prior chapters, so we won’t&#13;
go too far into its details here. Instead, we’ll focus specifically on&#13;
the interplay between server components and server rendering.</p>&#13;
&#13;
<p>Essentially, server components and server rendering can be thought of as&#13;
two separate independent processes where one process solely takes&#13;
care of rendering components on the server and generating a <a data-primary="tree of React elements" data-secondary="in server component/rendering relationship" data-secondary-sortas="server component and server rendering relationship" data-type="indexterm" id="id1038"/>tree of&#13;
React elements, and another process—the server renderer—further takes&#13;
this tree of React elements and converts it into markup that can be&#13;
streamed to clients over the network.</p>&#13;
&#13;
<p>If we consider these two processes, one to render components to React&#13;
elements, and another to render React elements to HTML strings or&#13;
streams, we start understanding how these&#13;
two concepts fit together. Let’s call the first process the <em>RSCs&#13;
renderer</em> that turns server components into a tree of React elements,&#13;
and the second process the <em>server renderer</em> that turns the React&#13;
elements into a stream of HTML.</p>&#13;
&#13;
<p>With this understanding, the interplay between server components and&#13;
server rendering can be understood as follows:</p>&#13;
<ol>&#13;
<li>&#13;
<p>On the server, a tree of JSX is turned into a tree of elements.</p>&#13;
&#13;
<p>This tree of JSX<a data-primary="JSX (JavaScript Syntax eXtension)" data-secondary="tree of elements in" data-type="indexterm" id="id1039"/>:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">hi</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="nx">I</code><code class="w"> </code><code class="nx">like</code><code class="w"> </code><code class="nx">React</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/></pre>&#13;
&#13;
<p>Becomes this tree of elements:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
  <code class="nx">type</code><code class="o">:</code> <code class="s2">"div"</code><code class="p">,</code>&#13;
  <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">children</code><code class="o">:</code> <code class="p">[</code>&#13;
      <code class="p">{</code>&#13;
        <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="s2">"h1"</code><code class="p">,</code>&#13;
        <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">children</code><code class="o">:</code> <code class="s2">"hi!"</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">},</code>&#13;
      <code class="p">{</code>&#13;
        <code class="nx">$$typeOf</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">),</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="s2">"p"</code><code class="p">,</code>&#13;
        <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">children</code><code class="o">:</code> <code class="s2">"I like React!"</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">},</code>&#13;
    <code class="p">],</code>&#13;
  <code class="p">},</code>&#13;
<code class="p">}</code></pre>&#13;
</li>&#13;
<li>&#13;
<p>On the server, this tree of elements is then further serialized<a data-primary="serialization" data-type="indexterm" id="ix_serialization.09.171.66"/><a data-primary="HTML" data-secondary="React elements into string or stream" data-type="indexterm" id="id1040"/> into a&#13;
string or stream.</p>&#13;
</li>&#13;
<li>&#13;
<p>This is sent to a client<a data-primary="client-side rendering (CSR)" data-type="indexterm" id="id1041"/><a data-primary="CSR (client-side rendering)" data-type="indexterm" id="id1042"/><a data-primary="rendering" data-secondary="client-side" data-type="indexterm" id="id1043"/> as a big stringified JSON object.</p>&#13;
</li>&#13;
<li>&#13;
<p>React on the client side can read this parsed JSON and render it as&#13;
usual.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>If we illustrate this as code from the server side, it would look&#13;
something like this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// server.js</code>&#13;
<code class="kr">const</code> <code class="nx">express</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"express"</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"path"</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">React</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"react"</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">ReactDOMServer</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"react-dom/server"</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">App</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s2">"./src/App"</code><code class="p">);</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">express</code><code class="p">();</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">express</code><code class="p">.</code><code class="kr">static</code><code class="p">(</code><code class="nx">path</code><code class="p">.</code><code class="nx">join</code><code class="p">(</code><code class="nx">__dirname</code><code class="p">,</code> <code class="s2">"build"</code><code class="p">)));</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"*"</code><code class="p">,</code> <code class="nx">async</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// This is the secret sauce</code>&#13;
  <code class="kr">const</code> <code class="nx">rscTree</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">turnServerComponentsIntoTreeOfElements</code><code class="p">(</code><code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;</code><code class="p">);</code>&#13;
  <code class="c1">// This is the secret sauce</code>&#13;
&#13;
  <code class="c1">// Render the awaited server components to a string</code>&#13;
  <code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="nx">ReactDOMServer</code><code class="p">.</code><code class="nx">renderToString</code><code class="p">(</code><code class="nx">rscTree</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Send it</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="sb">`</code>&#13;
<code class="sb">    &lt;!DOCTYPE html&gt;</code>&#13;
<code class="sb">    &lt;html&gt;</code>&#13;
<code class="sb">      &lt;head&gt;</code>&#13;
<code class="sb">        &lt;title&gt;My React App&lt;/title&gt;</code>&#13;
<code class="sb">      &lt;/head&gt;</code>&#13;
<code class="sb">      &lt;body&gt;</code>&#13;
<code class="sb">        &lt;div id="root"&gt;</code><code class="si">${</code><code class="nx">html</code><code class="si">}</code><code class="sb">&lt;/div&gt;</code>&#13;
<code class="sb">        &lt;script src="/static/js/main.js"&gt;&lt;/script&gt;</code>&#13;
<code class="sb">      &lt;/body&gt;</code>&#13;
<code class="sb">    &lt;/html&gt;</code>&#13;
<code class="sb">  `</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mi">3000</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"Server listening on port 3000"</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>This server code snippet is taken directly from <a data-type="xref" href="ch06.html#ch06">Chapter 6</a> where we&#13;
discussed server-side React, except we’ve added a step to process server&#13;
components before passing them to the server-side renderer—the second&#13;
process in our example.</p>&#13;
&#13;
<p>Logically, this is exactly how server components and server-side&#13;
rendering fit together: they are complementary processes.</p>&#13;
&#13;
<p>Again, it’s worth noting that we’re using <code>renderToString</code> just&#13;
for illustrative purposes and—as mentioned in <a data-type="xref" href="ch06.html#ch06">Chapter 6</a>—it’s almost&#13;
always better to lean on a more asynchronous, interruptible API like&#13;
<code>renderToPipeableStream</code> or similar for the vast majority of use cases.</p>&#13;
&#13;
<p>Now that we understand the interplay between server rendering and server&#13;
components, let’s dive a little bit deeper into this magical&#13;
<code>turnServerComponentsIntoTree​OfElements</code> function we invoked in the&#13;
previous code snippet. What is it doing? How does it turn server&#13;
components into a tree of elements? Is it a React renderer? Let’s find&#13;
out.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Under the Hood" data-type="sect2"><div class="sect2" id="id187">&#13;
<h2>Under the Hood</h2>&#13;
&#13;
<p>The short and potentially oversimplified answer<a data-primary="tree of React elements" data-secondary="in server component/rendering relationship" data-secondary-sortas="server component and server rendering relationship" data-type="indexterm" id="ix_treeofReactelementsinservercomponentrenderingrelationship.09.243.48"/> is yes,&#13;
<code>turnServerComponentsIntoTreeOfElements</code> is a kind of React renderer. It&#13;
recursively goes into a React tree, starting from a high level like&#13;
<code>&lt;App /&gt;</code>, and recursively calls each component to get the React element&#13;
(the plain JavaScript object) it returns.</p>&#13;
&#13;
<p>Let’s lay out a reference implementation of this and then discuss what&#13;
it does:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">turnServerComponentsIntoTreeOfElements</code><code class="p">(</code><code class="nx">jsx</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code>&#13;
    <code class="k">typeof</code> <code class="nx">jsx</code> <code class="o">===</code> <code class="s2">"string"</code> <code class="o">||</code>&#13;
    <code class="k">typeof</code> <code class="nx">jsx</code> <code class="o">===</code> <code class="s2">"number"</code> <code class="o">||</code>&#13;
    <code class="k">typeof</code> <code class="nx">jsx</code> <code class="o">===</code> <code class="s2">"boolean"</code> <code class="o">||</code>&#13;
    <code class="nx">jsx</code> <code class="o">==</code> <code class="kc">null</code>&#13;
  <code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// Don't need to do anything special with these types.</code>&#13;
    <code class="k">return</code> <code class="nx">jsx</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nb">Array</code><code class="p">.</code><code class="nx">isArray</code><code class="p">(</code><code class="nx">jsx</code><code class="p">))</code> <code class="p">{</code>&#13;
    <code class="c1">// Process each item in an array.</code>&#13;
    <code class="k">return</code> <code class="nx">await</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">(</code><code class="nx">jsx</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">child</code><code class="p">)));</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="c1">// If we're dealing with an object</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">jsx</code> <code class="o">!=</code> <code class="kc">null</code> <code class="o">&amp;&amp;</code> <code class="k">typeof</code> <code class="nx">jsx</code> <code class="o">===</code> <code class="s2">"object"</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// If the object is a React element,</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">jsx</code><code class="p">.</code><code class="nx">$$typeof</code> <code class="o">===</code> <code class="nx">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">))</code> <code class="p">{</code>&#13;
      <code class="c1">// `{ type } is a string for built-in components.</code>&#13;
      <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s2">"string"</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">// This is a built-in component like &lt;div /&gt;.</code>&#13;
        <code class="c1">// Go over its props to make sure they can be turned into JSON.</code>&#13;
        <code class="k">return</code> <code class="p">{</code>&#13;
          <code class="p">...</code><code class="nx">jsx</code><code class="p">,</code>&#13;
          <code class="nx">props</code><code class="o">:</code> <code class="nx">await</code> <code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">jsx</code><code class="p">.</code><code class="nx">props</code><code class="p">),</code>&#13;
        <code class="p">};</code>&#13;
      <code class="p">}</code>&#13;
      <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code> <code class="o">===</code> <code class="s2">"function"</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="c1">// This is a custom React component (like &lt;Footer /&gt;).</code>&#13;
        <code class="c1">// Call its function, and repeat the procedure for the JSX it returns.</code>&#13;
        <code class="kr">const</code> <code class="nx">Component</code> <code class="o">=</code> <code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code><code class="p">;</code>&#13;
        <code class="kr">const</code> <code class="nx">props</code> <code class="o">=</code> <code class="nx">jsx</code><code class="p">.</code><code class="nx">props</code><code class="p">;</code>&#13;
        <code class="kr">const</code> <code class="nx">returnedJsx</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">Component</code><code class="p">(</code><code class="nx">props</code><code class="p">);</code>&#13;
        <code class="k">return</code> <code class="nx">await</code> <code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">returnedJsx</code><code class="p">);</code>&#13;
      <code class="p">}</code>&#13;
      <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s2">"Not implemented."</code><code class="p">);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// This is an arbitrary object (props, or something inside them).</code>&#13;
      <code class="c1">// It's an object, but not a React element (we handled that case above).</code>&#13;
      <code class="c1">// Go over every value and process any JSX in it.</code>&#13;
      <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">fromEntries</code><code class="p">(</code>&#13;
        <code class="nx">await</code> <code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">(</code>&#13;
          <code class="nb">Object</code><code class="p">.</code><code class="nx">entries</code><code class="p">(</code><code class="nx">jsx</code><code class="p">).</code><code class="nx">map</code><code class="p">(</code><code class="nx">async</code> <code class="p">([</code><code class="nx">propName</code><code class="p">,</code> <code class="nx">value</code><code class="p">])</code> <code class="o">=&gt;</code> <code class="p">[</code>&#13;
            <code class="nx">propName</code><code class="p">,</code>&#13;
            <code class="nx">await</code> <code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">value</code><code class="p">),</code>&#13;
          <code class="p">])</code>&#13;
        <code class="p">)</code>&#13;
      <code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
  <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="s2">"Not implemented"</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>While this snippet can look a little scary, let’s be clear: it’s&#13;
just a big <code>if/else</code> tree that returns things based on its arguments.&#13;
Let’s go branch by branch and understand what happens, starting with its&#13;
input argument <code>jsx</code>.</p>&#13;
&#13;
<p>For the first branch, if we consider a React element like this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="nx">hi</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/></pre>&#13;
&#13;
<p>The child <code>"hi!"</code> is just a string. If we pass this string to our server&#13;
component renderer, we want to return the string as is. The idea is to&#13;
return types of things that React on the client side and on the server&#13;
side can understand. React can understand and render strings, numbers,&#13;
and booleans on the client and on the server side, so we’ll leave them&#13;
as is.</p>&#13;
&#13;
<p>Next up, if we’ve got an array, let’s map over it and recursively&#13;
process each element through our function. Arrays can be a bunch of&#13;
children, like this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="p">[</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="nx">hi</code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;,</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">hello</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;,</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">span</code><code class="p">&gt;</code><code class="nx">love</code><code class="w"> </code><code class="nx">u</code><code class="p">&lt;/</code><code class="nt">span</code><code class="p">&gt;,</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">(</code><code class="nx">props</code><code class="p">)</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">p</code> <code class="na">id</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">id</code><code class="p">}&gt;</code><code class="nx">lorem</code><code class="w"> </code><code class="nx">ipsum</code><code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;,</code><code class="w"/>&#13;
<code class="p">];</code><code class="w"/></pre>&#13;
&#13;
<p>Fragments, for example, represent children as arrays. So similarly, let’s&#13;
just process them by recursively calling our function on each child and&#13;
move on.</p>&#13;
&#13;
<p>Next is where it gets really interesting: we process objects. Let’s&#13;
keep in mind that all React elements are objects, but not all objects&#13;
are React elements. How do we know an object is a React element? It has&#13;
a <code>$$typeOf</code> property with a symbol value—specifically&#13;
<code>Symbol.for('react.element')</code>. Therefore, we check if the object has&#13;
this key/value pair, and if it does, we process it as a React&#13;
element. We do it in this section from the snippet:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">jsx</code><code class="p">.</code><code class="nx">$$typeof</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="nb">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">))</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="ow">typeof</code><code class="w"> </code><code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="s2">"string"</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="c1">// This is a component like &lt;div /&gt;.</code><code class="w"/>&#13;
<code class="w">    </code><code class="c1">// Go over its props to make sure they can be turned into JSON.</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">...</code><code class="nx">jsx</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">props</code><code class="o">:</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">jsx</code><code class="p">.</code><code class="nx">props</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">};</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="ow">typeof</code><code class="w"> </code><code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code><code class="w"> </code><code class="o">===</code><code class="w"> </code><code class="s2">"function"</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="c1">// This is a custom React component (like &lt;Footer /&gt;).</code><code class="w"/>&#13;
<code class="w">    </code><code class="c1">// Call its function, and repeat the procedure for the JSX it returns.</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">const</code><code class="w"> </code><code class="nx">Component</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">jsx</code><code class="p">.</code><code class="nx">type</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">const</code><code class="w"> </code><code class="nx">props</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">jsx</code><code class="p">.</code><code class="nx">props</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="kd">const</code><code class="w"> </code><code class="nx">returnedJsx</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">Component</code><code class="p">(</code><code class="nx">props</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">returnedJsx</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">}</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">throw</code><code class="w"> </code><code class="ow">new</code><code class="w"> </code><code class="ne">Error</code><code class="p">(</code><code class="s2">"Not implemented."</code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// This is an arbitrary object (props, or something inside of them).</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// Go over every value and process any JSX in it.</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nb">Object</code><code class="p">.</code><code class="nx">fromEntries</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">await</code><code class="w"> </code><code class="nb">Promise</code><code class="p">.</code><code class="nx">all</code><code class="p">(</code><code class="w"/>&#13;
<code class="w">      </code><code class="nb">Object</code><code class="p">.</code><code class="nx">entries</code><code class="p">(</code><code class="nx">jsx</code><code class="p">).</code><code class="nx">map</code><code class="p">(</code><code class="k">async</code><code class="w"> </code><code class="p">([</code><code class="nx">propName</code><code class="p">,</code><code class="w"> </code><code class="nx">value</code><code class="p">])</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">[</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">propName</code><code class="p">,</code><code class="w"/>&#13;
<code class="w">        </code><code class="k">await</code><code class="w"> </code><code class="nx">renderJSXToClientJSX</code><code class="p">(</code><code class="nx">value</code><code class="p">),</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">])</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">)</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Nested within the truthy branch of the <code>if</code> statement, we do another&#13;
check: is the <code>jsx.type</code> a <code>"string"</code> or a <code>"function"</code>? We do this&#13;
because React elements can have both as a type. Strings are used for&#13;
built-in DOM elements like <code>"div"</code>, <code>"span"</code>, etc. Functions are used&#13;
for custom components like <code>&lt;Footer /&gt;</code>. If it’s a string, we know it’s&#13;
a built-in DOM element, so we can just return it as is, but recursively&#13;
call our function on its props—since its props can have children that&#13;
are concurrent React components. If it’s a function, we know it’s a custom&#13;
component, so we call it with its props and recursively call our&#13;
function on the JSX it returns until it finally returns a string,&#13;
number, boolean, array of those types, or a React element with a string&#13;
type, which would fall into the other branch.</p>&#13;
&#13;
<p>Notice the <code>await</code> before we call the function component? Since this is&#13;
executed on the server side, we can <code>await</code> the function component in&#13;
case it’s a server component! This is the magic of server components: we&#13;
can <code>await</code> them on the server side, and they’ll return a React element&#13;
that we can then pass to <code>renderToString</code> or <code>renderToPipeableStream</code> to&#13;
render it to a string or a stream of strings that we can send to the&#13;
client. Indeed, this is what our function is doing: it’s just <code>await</code>ing all the&#13;
<code>async</code> things recursively to produce a tree of elements (a JavaScript&#13;
object) with all of its data dependencies resolved.</p>&#13;
&#13;
<p>Finally, if the object is not a React element, we know it’s just a&#13;
regular object, so we recursively call our function on each value in the&#13;
object and return the result. The object is usually just props, so in&#13;
the <code>else</code> branch, we’re just recursively calling our function on each&#13;
prop value and return the result, effectively unwrapping any components&#13;
that might be passed as props using patterns like render props, as&#13;
discussed in <a data-type="xref" href="ch05.html#ch05">Chapter 5</a>.</p>&#13;
&#13;
<p>That’s it! That’s our little minimal RSCs renderer. It’s not perfect, but&#13;
it’s a good start. We can use it to render our server components to&#13;
React elements that we can then send to clients.</p>&#13;
&#13;
<p>Once we have that, we just pass it to <code>renderToString</code> or&#13;
<code>renderToPipeableStream</code>, or even serialize it and send it directly to a&#13;
browser, and React on the client side will be able to render it because&#13;
it’s literally just a tree of React elements that React can understand.&#13;
There is, however, one more challenge to doing this that we need to&#13;
address: serialization.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Serialization" data-type="sect3"><div class="sect3" id="id139">&#13;
<h3>Serialization</h3>&#13;
&#13;
<p>Things get a little tricky when we try to serialize React elements.&#13;
Serializing React elements is a fundamental aspect of ensuring that your&#13;
application is rendered correctly and efficiently during the initial&#13;
load, because the same rendered output from the server needs to match&#13;
the client for React to correctly reconcile and diff things. When your&#13;
application is being rendered on the server, the React elements created&#13;
need to be turned into HTML strings that can be sent to the browser.&#13;
This process of turning React elements into strings is referred&#13;
to as <em>serialization</em>.</p>&#13;
&#13;
<p>In a typical React application, React elements are objects in memory.&#13;
They’re created by invoking <code>React.createElement</code> or using JSX syntax.&#13;
These elements represent the intended rendering of a component, but they&#13;
are not yet actual DOM elements. They’re more like instructions for how&#13;
the DOM should look:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="kd">const</code><code class="w"> </code><code class="nx">element</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">Hello</code><code class="p">,</code><code class="w"> </code><code class="nx">world</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;;</code><code class="w"/></pre>&#13;
&#13;
<p>When rendering on the server using a function like&#13;
<code>ReactDOMServer.renderToString</code>, these React elements are serialized&#13;
into HTML strings. This serialization process traverses the React&#13;
element tree, generates the corresponding HTML for each element, and&#13;
concatenates it all into a single HTML string:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">htmlString</code> <code class="o">=</code> <code class="nx">ReactDOMServer</code><code class="p">.</code><code class="nx">renderToString</code><code class="p">(</code><code class="nx">element</code><code class="p">);</code>&#13;
<code class="c1">// htmlString will be '&lt;h1&gt;Hello, world&lt;/h1&gt;'</code></pre>&#13;
&#13;
<p>This HTML string can then be sent to the client, where it will be used&#13;
as the initial markup for the page. Once the JavaScript bundle is loaded&#13;
on the client, React<a data-primary="hydration" data-type="indexterm" id="id1044"/><a data-primary="server-side rendering (SSR)" data-secondary="hydration" data-type="indexterm" id="id1045"/> will “hydrate” the DOM, attaching event handlers&#13;
and filling in any dynamic content.</p>&#13;
&#13;
<p>The serialization step is crucial for several reasons. First, it allows&#13;
the server to send a complete, ready-to-display HTML page to the client&#13;
as quickly as possible. This improves the perceived load time of the&#13;
page, as users can start interacting with the content sooner.</p>&#13;
&#13;
<p>Furthermore, serializing React elements into an HTML string allows for a&#13;
consistent and predictable initial render, irrespective of the&#13;
environment. The HTML produced is static and will look the same whether&#13;
rendered on the server or the client. This consistency is essential for&#13;
ensuring a smooth user experience, as it prevents any flickering or&#13;
layout shifts that might occur if the initial render were different from&#13;
the final render.</p>&#13;
&#13;
<p>Lastly, serialization facilitates the process of hydration on the&#13;
client side. When the JavaScript bundle loads on the client, React needs&#13;
to attach event handlers and fill in any dynamic content. Having a&#13;
serialized HTML string as the initial markup ensures that React has a&#13;
solid base to work from, making the rehydration process more efficient&#13;
and reliable.</p>&#13;
&#13;
<p>Even though we need to serialize components to strings, we can’t just&#13;
use <code>JSON.stringify</code> because React elements are not regular JavaScript&#13;
objects. They’re objects with a special <code>$$typeof</code> property that React&#13;
uses to identify them, and the value of these properties is a symbol.&#13;
Symbols cannot be serialized and sent over the network, so we need to do&#13;
something else.</p>&#13;
&#13;
<p>This isn’t actually that difficult thanks to built-in support from&#13;
JavaScript runtimes, including the browser and Node.js where our server&#13;
lives. This built-in support comes to us in the form of <code>JSON.stringify</code>&#13;
and <code>JSON.parse</code>. These functions<a data-primary="JSON.stringify" data-type="indexterm" id="id1046"/><a data-primary="JSON.parse function" data-type="indexterm" id="id1047"/> recursively either serialize or&#13;
deserialize JSON objects, which React elements are. Their API is as&#13;
follows:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">object</code><code class="p">,</code> <code class="nx">replacer</code><code class="p">);</code>&#13;
<code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">object</code><code class="p">,</code> <code class="nx">replacer</code><code class="p">);</code></pre>&#13;
&#13;
<p>where <code>replacer</code> is a function that receives a key and a value, and can&#13;
return a replacement value if certain conditions are met. In our case,&#13;
we want to replace the value of <code>$$typeof</code> with a serializable type,&#13;
like a string. Here’s how we’d do that:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">jsxTree</code><code class="p">,</code> <code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s2">"$$typeof"</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="s2">"react.element"</code><code class="p">;</code> <code class="c1">// &lt;- a string!!</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code> <code class="c1">// &lt;- return all other values as is</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>That’s it! We’re done. To deserialize this on the client side, we do the&#13;
opposite:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">serializedJsxTree</code><code class="p">,</code> <code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s2">"$$typeof"</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="nx">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">);</code> <code class="c1">// &lt;- a symbol!!</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code> <code class="c1">// &lt;- return all other values as is</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>And that’s it! We can now serialize and deserialize React elements. We&#13;
can now render server components on the server and send them to clients.&#13;
This handles our first load; however, we still need to handle updates&#13;
and navigation. Let’s tackle navigation first and deal with updates&#13;
later<a data-startref="ix_serialization.09.171.66" data-type="indexterm" id="id1048"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Navigation" data-type="sect3"><div class="sect3" id="id140">&#13;
<h3>Navigation</h3>&#13;
&#13;
<p>If we have a link<a data-primary="navigation, and server rendering" data-type="indexterm" id="ix_navigationandserverrendering.09.550.18"/> in our RSCs-enabled app, something like:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">a</code> <code class="na">href</code><code class="o">=</code><code class="s">"/blog"</code><code class="p">&gt;</code>Blog<code class="p">&lt;/</code><code class="nt">a</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>clicking on this would do a full-page navigation, which would cause the&#13;
browser to make a request to the server, which would then render the&#13;
page and send it back to the browser. This is how we used to do things&#13;
in PHP-land so many years ago, and it comes with certain friction and a&#13;
feeling of slowness. We can do better: with RSCs, we can implement soft&#13;
navigation, where state is persisted between route transitions. We do&#13;
this by sending the server the URL we want to navigate to, and the&#13;
server sends us back the JSX tree for that page. Then, React in the&#13;
browser rerenders the entire page with the new JSX tree, and we have a&#13;
new page without a full-page refresh. This is exactly what we’re going&#13;
to do.</p>&#13;
&#13;
<p>To do that, we need to tweak our client-side code a little bit. We need&#13;
to add an event listener<a data-primary="event listeners" data-type="indexterm" id="id1049"/> to all links in our app that prevents the&#13;
default behavior of the link, and instead sends a request to the server&#13;
for the new page. We can do that like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">tagName</code> <code class="o">!==</code> <code class="s2">"A"</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
  <code class="nx">navigate</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">href</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>We’re adding the event listener to the <code>window</code> because of performance:&#13;
we don’t want to add an event listener to every single link in our app,&#13;
which could be a large number of event listeners that could slow things&#13;
down. Instead, we add one event listener to the <code>window</code> and check if&#13;
the target of the click is a link. This is called <em>event delegation</em>.</p>&#13;
&#13;
<p>If the user does click on an <code>A</code> element, we then prevent the default&#13;
behavior of the link, and instead call a <code>navigate</code> function that we’ll&#13;
define in a second. This function will send a request to the server for&#13;
the new page, and then we’ll have React render it on the client.</p>&#13;
&#13;
<p>Let’s define the <code>navigate</code> function:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">navigate</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code> <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code> <code class="s2">"jsx-only"</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">});</code>&#13;
  <code class="kr">const</code> <code class="nx">jsxTree</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">jsxTree</code><code class="p">,</code> <code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s2">"$$typeof"</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">return</code> <code class="nx">Symbol</code><code class="p">.</code><code class="k">for</code><code class="p">(</code><code class="s2">"react.element"</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
  <code class="nx">root</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">element</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>What we’re doing here is pretty straightforward: we’re sending a request&#13;
to the server for the new page, deserializing the&#13;
response into a React element, and then rendering that element&#13;
into the root of our app. This will cause React to rerender the page&#13;
with the new JSX tree, and we’ll have a new page without a full-page&#13;
refresh. But what is <code>root</code>? To understand that, we need to look at our&#13;
full client-side JavaScript file:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">hydrateRoot</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"react-dom/client"</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">deserialize</code> <code class="p">}</code> <code class="nx">from</code> <code class="s2">"./serializer.js"</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">App</code> <code class="nx">from</code> <code class="s2">"./App"</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">root</code> <code class="o">=</code> <code class="nx">hydrateRoot</code><code class="p">(</code><code class="nb">document</code><code class="p">,</code> <code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;</code><code class="p">);</code> <code class="c1">// &lt;- this is root</code>&#13;
&#13;
<code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s2">"click"</code><code class="p">,</code> <code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">tagName</code> <code class="o">!==</code> <code class="s2">"a"</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
  <code class="nx">navigate</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">href</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">navigate</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">jsxTree</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="nx">element</code> <code class="o">=</code> <code class="nx">deserialize</code><code class="p">(</code><code class="nx">jsxTree</code><code class="p">);</code>&#13;
  <code class="nx">root</code><code class="p">.</code><code class="nx">render</code><code class="p">(</code><code class="nx">element</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>We get a root from React when we initially hydrate the page, and we can&#13;
use that root to render new elements into it. This is how React works&#13;
under the hood, and we’re just using the same API that React uses&#13;
internally. This is a good thing because it means we’re not doing&#13;
anything special or hacky, we’re just using React’s public API.</p>&#13;
&#13;
<p>Finally, we need to have our server respond with just the JSX tree&#13;
object for the next page when given a <code>jsx-only</code> header instead of&#13;
responding with a full HTML string. We can do that like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s2">"*"</code><code class="p">,</code> <code class="nx">async</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">jsxTree</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">turnServerComponentsIntoTreeOfElements</code><code class="p">(</code><code class="o">&lt;</code><code class="nx">App</code> <code class="o">/&gt;</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// This is the secret sauce</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">req</code><code class="p">.</code><code class="nx">headers</code><code class="p">[</code><code class="s2">"jsx-only"</code><code class="p">])</code> <code class="p">{</code>&#13;
    <code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code>&#13;
      <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">jsxTree</code><code class="p">,</code> <code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="nx">key</code> <code class="o">===</code> <code class="s2">"$$typeof"</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="k">return</code> <code class="s2">"react.element"</code><code class="p">;</code>&#13;
        <code class="p">}</code>&#13;
&#13;
        <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>&#13;
      <code class="p">})</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="nx">ReactDOMServer</code><code class="p">.</code><code class="nx">renderToString</code><code class="p">(</code><code class="nx">jsxTree</code><code class="p">);</code>&#13;
&#13;
    <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="sb">`</code>&#13;
<code class="sb">      &lt;!DOCTYPE html&gt;</code>&#13;
<code class="sb">      &lt;html&gt;</code>&#13;
<code class="sb">        &lt;head&gt;</code>&#13;
<code class="sb">          &lt;title&gt;My React App&lt;/title&gt;</code>&#13;
<code class="sb">        &lt;/head&gt;</code>&#13;
<code class="sb">        &lt;body&gt;</code>&#13;
<code class="sb">          &lt;div id="root"&gt;</code><code class="si">${</code><code class="nx">html</code><code class="si">}</code><code class="sb">&lt;/div&gt;</code>&#13;
<code class="sb">          &lt;script src="/static/js/main.js"&gt;&lt;/script&gt;</code>&#13;
<code class="sb">        &lt;/body&gt;</code>&#13;
<code class="sb">      &lt;/html&gt;</code>&#13;
<code class="sb">    `</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Notice how when the header is present, we’re not sending JSON but just a&#13;
string? This is because we need to <code>JSON.parse</code> this on the client side,&#13;
and <code>JSON.parse</code> expects a string<a data-primary="JSON.parse function" data-type="indexterm" id="id1050"/>, not a JSON object. This is just a&#13;
quirk of the API, but it’s not too bad<a data-startref="ix_navigationandserverrendering.09.550.18" data-type="indexterm" id="id1051"/><a data-startref="ix_treeofReactelementsinservercomponentrenderingrelationship.09.243.48" data-type="indexterm" id="id1052"/>.</p>&#13;
&#13;
<p>Now, we have a way to navigate to new pages without a full-page refresh.&#13;
We can now handle navigation in our RSCs-enabled app. All anchor link&#13;
navigations happen smoothly and fluently without a full-page refresh.&#13;
But what about updates? How do we handle updates? Let’s tackle that&#13;
next.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Making Updates" data-type="sect2"><div class="sect2" id="id141">&#13;
<h2>Making Updates</h2>&#13;
&#13;
<p>While there are a ton of positives<a data-primary="server-side rendering (SSR)" data-secondary="updating considerations" data-type="indexterm" id="ix_serversiderenderingSSRupdatingconsiderations.09.706.35"/> to RSCs, there are&#13;
also some limitations to be aware of, namely the added mental overhead&#13;
of having to think about two different types of components (server and&#13;
client). This is because not all components can be server components.</p>&#13;
&#13;
<p>For example, consider this simple counter component that increments the&#13;
counter value by 1 when a user clicks the + button:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="kd">function</code><code class="w"> </code><code class="nx">Counter</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">count</code><code class="p">,</code><code class="w"> </code><code class="nx">setCount</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="mf">0</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">Hello</code><code class="w"> </code><code class="nx">friends</code><code class="p">,</code><code class="w"> </code><code class="nx">look</code><code class="w"> </code><code class="nx">at</code><code class="w"> </code><code class="nx">my</code><code class="w"> </code><code class="nx">nice</code><code class="w"> </code><code class="nx">counter</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="nx">About</code><code class="w"> </code><code class="nx">me</code><code class="o">:</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">like</code><code class="w"> </code><code class="nx">pie</code><code class="o">!</code><code class="w"> </code><code class="nx">Sign</code><code class="w"> </code><code class="nx">my</code><code class="w"> </code><code class="nx">guest</code><code class="w"> </code><code class="nx">book</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="nx">Count</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="nx">count</code><code class="p">}&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="p">{()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">setCount</code><code class="p">(</code><code class="nx">count</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="mf">1</code><code class="p">)}&gt;</code><code class="o">+</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>This component<a data-primary="client components" data-secondary="required" data-type="indexterm" id="ix_clientcomponentsrequired.09.729.15"/> can never be a server component for two reasons:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>It uses <code>useState</code>, which is a client-side-only API. This means that&#13;
the server doesn’t know what the initial value of <code>count</code> is, so it&#13;
can’t render the initial HTML. This is a problem because the server&#13;
needs to render the initial HTML before the client can take over and&#13;
render the interactive UI.</p>&#13;
&#13;
<p>In a serverful environment, the concept<a data-primary="state management" data-secondary="client versus server components" data-type="indexterm" id="id1053"/><a data-primary="client components" data-secondary="state in versus server components" data-type="indexterm" id="id1054"/> of “state” is shared among&#13;
multiple clients. However, in React, prior to the introduction of RSCs, state was localized to the current application. This&#13;
difference poses a risk. It could lead to the leakage of state between&#13;
multiple clients, potentially exposing sensitive information. Due to&#13;
this discrepancy and the associated security risks, RSCs do not support the use of <code>useState</code> on the server side. This&#13;
is because server-side state is fundamentally different from client-side&#13;
state.</p>&#13;
&#13;
<p>Moreover, the dispatcher (<code>setState</code>) function from <code>useState</code> would need&#13;
to be serialized to be sent over the network to the client, and&#13;
functions are not serializable, so this would be impossible.</p>&#13;
</li>&#13;
<li>&#13;
<p>It uses <code>onClick</code>, which is a client-side-only API. This is because&#13;
servers aren’t interactive: you can’t click on a running process in a&#13;
server, so <code>onClick</code> in server components is a bit of an impossible&#13;
state. Moreover, all props for server components are supposed to be&#13;
serializable because the server needs to be able to serialize the props&#13;
and send them to the client, and functions are not serializable.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Therefore, what used to be a simple counter now needs to be broken apart&#13;
into a server part and a client part <em>if</em> we want to harness the power&#13;
of server components, like so:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// Server Component</code><code class="w"/>&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">ServerCounter</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">Hello</code><code class="w"> </code><code class="nx">friends</code><code class="p">,</code><code class="w"> </code><code class="nx">look</code><code class="w"> </code><code class="nx">at</code><code class="w"> </code><code class="nx">my</code><code class="w"> </code><code class="nx">nice</code><code class="w"> </code><code class="nx">counter</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">About</code><code class="w"> </code><code class="nx">me</code><code class="o">:</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">like</code><code class="w"> </code><code class="nx">to</code><code class="w"> </code><code class="nx">count</code><code class="w"> </code><code class="nx">things</code><code class="w"> </code><code class="nx">and</code><code class="w"> </code><code class="nx">I</code><code class="err">'</code><code class="nx">m</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="nx">counter</code><code class="w"> </code><code class="nx">and</code><code class="w"> </code><code class="nx">sometimes</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">count</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">things</code><code class="w"> </code><code class="nx">but</code><code class="w"> </code><code class="nx">other</code><code class="w"> </code><code class="nx">times</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">enjoy</code><code class="w"> </code><code class="nx">playing</code><code class="w"> </code><code class="nx">the</code><code class="w"> </code><code class="nx">Cello</code><code class="w"> </code><code class="nx">and</code><code class="w"> </code><code class="nx">one</code><code class="w"> </code><code class="nx">time</code><code class="w"> </code><code class="nx">at</code><code class="w"> </code><code class="nx">band</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">camp</code><code class="w"> </code><code class="nx">I</code><code class="w"> </code><code class="nx">counted</code><code class="w"> </code><code class="nx">to</code><code class="w"> </code><code class="mf">1000</code><code class="w"> </code><code class="nx">and</code><code class="w"> </code><code class="nx">a</code><code class="w"> </code><code class="nx">pirate</code><code class="w"> </code><code class="nx">appeared</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">InteractiveClientPart</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// Client Component</code><code class="w"/>&#13;
<code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">InteractiveClientPart</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">count</code><code class="p">,</code><code class="w"> </code><code class="nx">setCount</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="mf">0</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="nx">Count</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="nx">count</code><code class="p">}&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="p">{()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">setCount</code><code class="p">(</code><code class="nx">count</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="mf">1</code><code class="p">)}&gt;</code><code class="o">+</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>This is a bit of a contrived example, but it illustrates the point that&#13;
you can’t just take any React component and turn it into a server&#13;
component. You need to think about what parts of your component are&#13;
server renderable and what parts are client renderable. This introduces&#13;
a bit of friction where even though in this example it’s pretty obvious&#13;
what parts are server renderable and what parts are client renderable,&#13;
in a real-world application at scale, it may not be so obvious.</p>&#13;
&#13;
<p>The outcome of this, though, is largely rewarding because what we just&#13;
did was factor out a tiny portion of our counter application that&#13;
is intended to be interactive, and <em>only</em> this portion of our app will&#13;
actually make it to our users as part of a JavaScript bundle; the rest&#13;
will not. As a consequence, we ship drastically smaller JavaScript&#13;
bundles over the network, which means faster load times and better&#13;
performance for our users both in terms of CPU, with less work needing&#13;
to be done to parse and execute the JavaScript, and in terms of network,&#13;
with less data needing to be &#13;
<span class="keep-together">downloaded.</span></p>&#13;
&#13;
<p>This is why we want to render <em>as much as we can safely</em> on the server&#13;
to leave the code out of client-side bundles<a data-startref="ix_clientcomponentsrequired.09.729.15" data-type="indexterm" id="id1055"/>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Under the hood" data-type="sect3"><div class="sect3" id="id142">&#13;
<h3>Under the hood</h3>&#13;
&#13;
<p>The extra mental overhead aside, let’s talk about how React delineates&#13;
and works with server components and client components separately under&#13;
the hood. This is important to understand because it will help us&#13;
understand how to make updates to our application.</p>&#13;
&#13;
<p>Client components<a data-primary="use client directive" data-type="indexterm" id="id1056"/><a data-primary="client components" data-secondary="differentiation from server components" data-type="indexterm" id="ix_clientcomponentsdifferentiationfromservercomponents.09.821.18"/> are designated as such by adding a <code>"use client"</code>&#13;
directive at the top of a file containing a client component. RSCs require next-generation tooling to&#13;
differentiate server and client components based on the use of such&#13;
&#13;
<span class="keep-together">directives.</span></p>&#13;
&#13;
<p>Through the use of a next-generation bundler<a data-primary="bundlers" data-type="indexterm" id="ix_bundlers.09.826.45"/> or bundler configuration,&#13;
bundlers are able to produce separate module graphs for React apps: a&#13;
server graph and a client graph. The server graph<a data-primary="server graph separation from client graph" data-type="indexterm" id="id1057"/> is never rolled into a&#13;
bundle since it’s never served to users, but all files that start with&#13;
the <code>"use client"</code> directive are rolled into either one client bundle&#13;
or multiple bundles per component that can be lazy loaded. This&#13;
implementation detail is dependent on the frameworks that are built on&#13;
top of RSCs.</p>&#13;
&#13;
<p>So conceptually, we’ve got a server graph that executes on the server,&#13;
and one or more client bundles that are downloaded and executed when&#13;
they’re required on the client. But how does React know when to import&#13;
and execute client components? To understand this, we’ll have to&#13;
consider a typical React tree. Let’s do this using our counter example.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#figure9-1">Figure 9-1</a>, we visualize the tree of components for our&#13;
counter application where orange components are rendered on the server,&#13;
and green ones on the client. Since the root of the tree is a server&#13;
component, the entire tree is rendered on the server. However, the&#13;
<code>InteractiveClientPart</code> component is a client component, so it’s not&#13;
rendered on the server. Instead, the server renders a placeholder for&#13;
the client component, which is a reference to the specific module that&#13;
the client bundler produced. This module reference essentially says,&#13;
“when you get to this point in the tree, it’s time to use this specific&#13;
module.”</p>&#13;
&#13;
<figure><div class="figure" id="figure9-1">&#13;
<img alt="RSCs and Client Components" src="assets/frea_0901.png"/>&#13;
<h6><span class="label">Figure 9-1. </span>A component tree showing client and server components</h6>&#13;
</div></figure>&#13;
&#13;
<p>The module isn’t necessarily always only lazy loaded, but can be loaded&#13;
from the initial bundle as well, since bundlers add a whole bunch of&#13;
modules in the bundles we ship to users. It could literally be&#13;
<code>getModuleFromBundleAtPosition([0,4])</code> or something similar. The point&#13;
is that the server sends a reference to the right client module, and&#13;
React on the client side fills in the gap.</p>&#13;
&#13;
<p>When this happens, React will replace the module reference with the&#13;
actual module from the client bundle. This is a bit of a simplification,&#13;
but it should give us a good enough understanding of the mechanism. The&#13;
client component is then rendered on the client, and the client&#13;
component can then be interacted with as usual. This is why RSCs require&#13;
a next-generation bundler: they need to be able to produce separate&#13;
module graphs for server and client components.</p>&#13;
&#13;
<p>In practice, this means that in the case of our counter example,&#13;
the server would render the following tree:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
  <code class="nx">type</code><code class="o">:</code> <code class="s2">"div"</code><code class="p">,</code>&#13;
  <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">children</code><code class="o">:</code> <code class="p">[</code>&#13;
      <code class="p">{</code>&#13;
        <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="s2">"h1"</code><code class="p">,</code>&#13;
        <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">children</code><code class="o">:</code> <code class="s2">"Hello friends, look at my nice counter!"</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">},</code>&#13;
      <code class="p">{</code>&#13;
        <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="s2">"p"</code><code class="p">,</code>&#13;
        <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">children</code><code class="o">:</code> <code class="s2">"About me: I like to count things"</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">},</code>&#13;
      <code class="p">{</code>&#13;
        <code class="c1">// The ClientPart element placeholder with a module reference</code>&#13;
        <code class="c1">// Pay attention to this: it's a module reference!</code>&#13;
        <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">module</code><code class="p">.</code><code class="nx">reference</code><code class="p">),</code>&#13;
          <code class="nx">name</code><code class="o">:</code> <code class="s2">"default"</code><code class="p">,</code>&#13;
          <code class="nx">filename</code><code class="o">:</code> <code class="s2">"./src/ClientPart.js"</code><code class="p">,</code>&#13;
          <code class="nx">moduleId</code><code class="o">:</code> <code class="s2">"client-part-1234"</code>&#13;
        <code class="p">},</code>&#13;
        <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
          <code class="nx">children</code><code class="o">:</code> <code class="p">[</code>&#13;
            <code class="c1">// ...other server components and client module references</code>&#13;
            <code class="p">{</code>&#13;
              <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
              <code class="nx">type</code><code class="o">:</code> <code class="p">{</code>&#13;
                <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">module</code><code class="p">.</code><code class="nx">reference</code><code class="p">),</code>&#13;
                <code class="nx">name</code><code class="o">:</code> <code class="s2">"default"</code><code class="p">,</code>&#13;
                <code class="nx">filename</code><code class="o">:</code> <code class="s2">"./src/AnotherClientComponent.js"</code>&#13;
              <code class="p">},</code>&#13;
              <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
                <code class="nx">children</code><code class="o">:</code> <code class="p">[],</code>&#13;
              <code class="p">}</code>&#13;
            <code class="p">},</code>&#13;
            <code class="p">{</code>&#13;
              <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
              <code class="nx">type</code><code class="o">:</code> <code class="s2">"div"</code><code class="p">,</code>&#13;
              <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
                <code class="nx">children</code><code class="o">:</code> <code class="s2">"I am a server component"</code>&#13;
              <code class="p">}</code>&#13;
            <code class="p">}</code>&#13;
          <code class="p">]</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">]</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This tree would be sent to the client side, and as React renders it and&#13;
encounters the module reference, React would intelligently replace the&#13;
module reference with the actual module from the client bundle. This is&#13;
how React knows when to import and execute client components.</p>&#13;
&#13;
<p>Thus, we can see that the bundler is able to still render an entire tree&#13;
on the server, and only leave “holes” to be filled in on the client&#13;
while rendering even the children of client components recursively on&#13;
the server, producing a full tree. The client then fills any holes&#13;
necessary by downloading and executing client bundles<a data-startref="ix_clientcomponentsdifferentiationfromservercomponents.09.821.18" data-type="indexterm" id="id1058"/><a data-startref="ix_bundlers.09.826.45" data-type="indexterm" id="id1059"/>.</p>&#13;
&#13;
<p>Server components can also be wrapped into Suspense<a data-primary="Suspense" data-type="indexterm" id="id1060"/><a data-primary="React Suspense" data-type="indexterm" id="id1061"/> boundaries, with&#13;
frameworks doing the requisite work to stream them down to users from&#13;
the server side as they become “ready”: that is, as any data they&#13;
require is fetched and any other operations needed are completed&#13;
asynchronously.</p>&#13;
&#13;
<p>OK, hopefully now we understand how client components are split from&#13;
server components, enabling updates in RSCs-oriented applications. Client&#13;
components marked with <code>"use client"</code> can contain localized state and&#13;
event handlers like <code>onClick</code> without issue.</p>&#13;
&#13;
<p>Given that we’ve now closed the loop with client components and&#13;
understand how server components are executed on the server and how&#13;
client components are included in client bundles, we need to discuss&#13;
some nuance around these topics<a data-startref="ix_serversiderenderingSSRupdatingconsiderations.09.706.35" data-type="indexterm" id="id1062"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Nuance" data-type="sect2"><div class="sect2" id="id143">&#13;
<h2>Nuance</h2>&#13;
&#13;
<p>There’s a common misconception that server components execute only on&#13;
the server and client components execute only on the client. This isn’t&#13;
true. Server components do indeed execute only on the server and output&#13;
objects representing React elements, but client components<a data-primary="client components" data-secondary="as not executing exclusively on the client" data-secondary-sortas="not executing exclusively on the client" data-type="indexterm" id="ix_clientcomponentsasnotexecutingexclusivelyontheclient.09.968.59"/> do not&#13;
execute exclusively on the client.</p>&#13;
&#13;
<p>To understand this deeper, let’s discuss what “components execute”&#13;
even means. When we say “components execute,” we mean that the&#13;
function that represents the component is called. For example, let’s say we&#13;
have a component like this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="kd">function</code><code class="w"> </code><code class="nx">MyComponent</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="nx">hello</code><code class="w"> </code><code class="nx">world</code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>When we say "<code>MyComponent</code> executes,” we mean that the function&#13;
<code>MyComponent</code> is called with its props and returns a React element—which&#13;
is a plain JavaScript object that looks like this:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">$$typeof</code><code class="o">:</code> <code class="nx">Symbol</code><code class="p">(</code><code class="nx">react</code><code class="p">.</code><code class="nx">element</code><code class="p">),</code>&#13;
  <code class="nx">type</code><code class="o">:</code> <code class="s2">"div"</code><code class="p">,</code>&#13;
  <code class="nx">props</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">children</code><code class="o">:</code> <code class="s2">"hello world"</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>This is what we mean when we say “components execute.”</p>&#13;
&#13;
<p>During server rendering, client components execute on the server and&#13;
output objects representing React elements. These elements are then&#13;
serialized into a string of HTML and sent to the client where the&#13;
browser renders the HTML markup. Thus, client components also execute on&#13;
the server, return some objects representing React elements, and then&#13;
the server serializes them into HTML and sends them to the &#13;
<span class="keep-together">client.</span></p>&#13;
&#13;
<p>To get a more accurate representation of this, we can make the following&#13;
true &#13;
<span class="keep-together">statements:</span></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Server components execute on the server, output objects representing&#13;
React &#13;
<span class="keep-together">elements.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>Client components execute on the server, output objects representing&#13;
React &#13;
<span class="keep-together">elements.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>A big object representing all React elements from both client and&#13;
server components exists on the server.</p>&#13;
</li>&#13;
<li>&#13;
<p>This is turned into a string and sent to the client.</p>&#13;
</li>&#13;
<li>&#13;
<p>From this point, server components are never executed on the client.</p>&#13;
</li>&#13;
<li>&#13;
<p>Client components are executed exclusively on the client.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>With this perspective, the execution boundaries of both server and&#13;
client components become more clear. We may be splitting hairs here, but&#13;
it’s worth adding more detail to fully understand and appreciate the&#13;
interplay between both types of components<a data-startref="ix_ReactServerComponentsRSCsandserverrendering.09.109.31" data-type="indexterm" id="id1063"/><a data-startref="ix_serversiderenderingSSRandservercomponents.09.109.31" data-type="indexterm" id="id1064"/><a data-startref="ix_clientcomponentsasnotexecutingexclusivelyontheclient.09.968.59" data-type="indexterm" id="id1065"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Rules of Server Components" data-type="sect1"><div class="sect1" id="id188">&#13;
<h1>Rules of Server Components</h1>&#13;
&#13;
<p>Now that we understand how server components<a data-primary="React Server Components (RSCs)" data-secondary="rules of server components" data-type="indexterm" id="ix_ReactServerComponentsRSCsrulesofservercomponents.09.1027.45"/> work under the hood, let’s&#13;
discuss some rules that we need to follow when working with server&#13;
components, or more broadly, things to keep in mind when working with&#13;
server components.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Serializability Is King" data-type="sect2"><div class="sect2" id="id144">&#13;
<h2>Serializability Is King</h2>&#13;
&#13;
<p>With server components<a data-primary="serialization" data-type="indexterm" id="id1066"/>, all props must be serializable. This is because&#13;
the server needs to be able to serialize the props and send them to the&#13;
client, as we’ve discussed earlier. Therefore, props cannot be functions&#13;
or other nonserializable values in server components. This makes the&#13;
render props pattern we discussed in <a data-type="xref" href="ch05.html#ch05">Chapter 5</a> effectively obsolete.</p>&#13;
&#13;
<p>At this point, based on our understanding of how RSCs are rendered on&#13;
the server and then sent to the client on soft navigation, we should&#13;
understand why this rule exists. Let’s say we have a server component like&#13;
this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="kd">function</code><code class="w"> </code><code class="nx">ServerComponent</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">ClientComponent</code> <code class="na">onClick</code><code class="o">=</code><code class="p">{()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="nx">alert</code><code class="p">(</code><code class="s2">"hi"</code><code class="p">)}</code> <code class="p">/&gt;;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>This would cause an error. We could, however, work around this by encapsulating the&#13;
<code>onClick</code> prop inside the <code>ClientComponent</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="No Effectful Hooks" data-type="sect2"><div class="sect2" id="id145">&#13;
<h2>No Effectful Hooks</h2>&#13;
&#13;
<p>The server is a vastly different environment from the client. It’s not&#13;
interactive, it doesn’t have a DOM, and it doesn’t have a window.&#13;
Therefore, hooks that are effectful<a data-primary="effectful hooks, avoiding with server components" data-type="indexterm" id="id1067"/> are not supported in server&#13;
components.</p>&#13;
&#13;
<p>Some frameworks, like Next.js<a data-primary="Next.js" data-secondary="banning hooks in server components" data-type="indexterm" id="id1068"/>, have lint rules that completely ban all&#13;
hooks in server components, but this is not entirely necessary. RSCs can&#13;
use hooks that do not depend on state, effects, or browser-only APIs.&#13;
For example, the <code>useRef</code> hook is perfectly fine to use in server&#13;
components because it doesn’t depend on state, effects, or browser-only&#13;
APIs. However, this may not be all bad, since it biases us toward more&#13;
safely working with components.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="State Is Not State" data-type="sect2"><div class="sect2" id="id189">&#13;
<h2>State Is Not State</h2>&#13;
&#13;
<p>State<a data-primary="state management" data-secondary="client versus server components" data-type="indexterm" id="id1069"/><a data-primary="client components" data-secondary="state in versus server components" data-type="indexterm" id="id1070"/> in server components is not the same as state in client&#13;
components. This is because server components are rendered on the&#13;
server, and client components are rendered on the client. This means&#13;
that state in server components may be shared between clients since&#13;
server-client relationships are broadcast-style relationships instead of&#13;
unicast (one client, one state), and thus the risks of leaking state&#13;
between clients is high.</p>&#13;
&#13;
<p>Combined with the hooks rule, this means that any components that&#13;
require state via <code>useState</code> or <code>useReducer</code> or similar are best suited&#13;
to be client components.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Client Components Cannot Import Server Components" data-type="sect2"><div class="sect2" id="id146">&#13;
<h2>Client Components Cannot Import Server Components</h2>&#13;
&#13;
<p>Client components<a data-primary="client components" data-secondary="inability to import server components" data-type="indexterm" id="ix_clientcomponentsinabilitytoimportservercomponents.09.1086.18"/> cannot import server components. This is because&#13;
server components are executed only on the server, but client components&#13;
are executed on both, including on browsers.</p>&#13;
&#13;
<p>This means that if we have a client component like this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ServerComponent</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./ServerComponent"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">ClientComponent</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">Hey</code><code class="w"> </code><code class="nx">everyone</code><code class="p">,</code><code class="w"> </code><code class="nx">check</code><code class="w"> </code><code class="nx">out</code><code class="w"> </code><code class="nx">my</code><code class="w"> </code><code class="nx">great</code><code class="w"> </code><code class="nx">server</code><code class="w"> </code><code class="nx">component</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ServerComponent</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>it would cause an error because the client component is trying to import a&#13;
server component. This is impossible because, since server components&#13;
execute only on the server, the server component we’re importing here&#13;
may further import things that are not available in the client runtime&#13;
environment, like Node.js APIs. This would cause errors on the client.</p>&#13;
&#13;
<p>For all we know, the server component could look like this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">readFile</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"node:fs/promises"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">ServerComponent</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">content</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">readFile</code><code class="p">(</code><code class="s2">"./some-file.txt"</code><code class="p">,</code><code class="w"> </code><code class="s2">"utf-8"</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;{</code><code class="nx">content</code><code class="p">}&lt;/</code><code class="nt">div</code><code class="p">&gt;;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>When we try to run this on the client side because a client component&#13;
imported it, we’d get an error because the <code>readFile</code> function and the&#13;
<code>"node:fs/promises"</code> module are not available in the browser. This is why&#13;
client components cannot import server components.</p>&#13;
&#13;
<p>However, client components can <em>compose</em> server components via props.&#13;
For example, we could rewrite our client component to look like&#13;
this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">ClientComponent</code><code class="p">({</code><code class="w"> </code><code class="nx">children</code><code class="w"> </code><code class="p">})</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code class="nx">Hey</code><code class="w"> </code><code class="nx">everyone</code><code class="p">,</code><code class="w"> </code><code class="nx">check</code><code class="w"> </code><code class="nx">out</code><code class="w"> </code><code class="nx">my</code><code class="w"> </code><code class="nx">great</code><code class="w"> </code><code class="nx">server</code><code class="w"> </code><code class="nx">component</code><code class="o">!</code><code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">{</code><code class="nx">children</code><code class="p">}</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>and then in whatever parent server component contains this client&#13;
component, we could do this:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ServerComponent</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./ServerComponent"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">TheParentOfBothComponents</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">ClientComponent</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">ServerComponent</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/</code><code class="nt">ClientComponent</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>This would work because there’s no explicit import of a server component&#13;
from a client component, but the parent server component is passing a&#13;
server component as a prop to the client component. The only reason the&#13;
imports are forbidden is to &#13;
<span class="keep-together">prevent</span> the possibility of including server&#13;
components in the client bundle, and bundlers<a data-primary="bundlers" data-type="indexterm" id="id1071"/> only pay attention to&#13;
import statements, not prop composition<a data-startref="ix_clientcomponentsinabilitytoimportservercomponents.09.1086.18" data-type="indexterm" id="id1072"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Client Components Are Not Bad" data-type="sect2"><div class="sect2" id="id147">&#13;
<h2>Client Components Are Not Bad</h2>&#13;
&#13;
<p>It’s worth noting that up until server components were introduced,&#13;
client components<a data-primary="client components" data-secondary="value of" data-type="indexterm" id="id1073"/> were the only type of component we had in React. This&#13;
means that all of our existing components are client components, and&#13;
that’s OK. Client components are not bad, and they’re not going away.&#13;
They’re still the bread and butter of React applications, and they’re&#13;
still the most common type of component we’ll be writing.</p>&#13;
&#13;
<p>We mention that here because there has been some confusion around this&#13;
topic, and server components have been perceived by some as a superior&#13;
replacement for client components. This is not true. Server&#13;
components are a new type of component that we can use in addition to&#13;
client components, but they’re not a replacement for client components<a data-startref="ix_ReactServerComponentsRSCsrulesofservercomponents.09.1027.45" data-type="indexterm" id="id1074"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Server Actions" data-type="sect1"><div class="sect1" id="id148">&#13;
<h1>Server Actions</h1>&#13;
&#13;
<p>Server components are a powerful new feature in React, but they’re not&#13;
the only new feature. RSCs also work in tandem with a&#13;
new <a data-primary="use server directive" data-type="indexterm" id="id1075"/>directive <code>"use server"</code> that marks server-side functions that can be&#13;
called from client-side code. We call these functions<a data-primary="React Server Components (RSCs)" data-secondary="server actions" data-type="indexterm" id="ix_ReactServerComponentsRSCsserveractions.09.1191.54"/><a data-primary="server actions" data-type="indexterm" id="ix_serveractions.09.1191.54"/> <em>server actions</em>.</p>&#13;
&#13;
<p>Any async function can have <code>"use server"</code> as the first line of its body&#13;
to signal to React and to the bundler that this function can be called&#13;
from client-side code, but must only execute on the server. When calling&#13;
a server action on the client, it will make a network request to the&#13;
server that includes a serialized copy of any arguments passed. If the&#13;
server action returns a value, that value will be serialized and&#13;
returned to the client.</p>&#13;
&#13;
<p>Instead of individually marking functions with <code>"use server"</code>, you can&#13;
also add the directive to the top of a file to mark all exports within&#13;
that file as server actions that can be used anywhere, including&#13;
imported in client code.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Forms and Mutations" data-type="sect2"><div class="sect2" id="id149">&#13;
<h2>Forms and Mutations</h2>&#13;
&#13;
<p>In <a data-type="xref" href="ch08.html#ch08">Chapter 8</a>, we discussed how Next.js and Remix handle forms&#13;
and mutations<a data-primary="mutating data" data-type="indexterm" id="id1076"/><a data-primary="forms, and server actions" data-type="indexterm" id="id1077"/>. React is adding (or has added) first-class primitives for&#13;
these as well. Consider this form:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="c1">// App.js</code><code class="w"/>&#13;
&#13;
<code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">requestUsername</code><code class="p">(</code><code class="nx">formData</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="s1">'use server'</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">username</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'username'</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">  </code><code class="c1">// ...</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="k">export</code><code class="w"> </code><code class="k">default</code><code class="w"> </code><code class="nx">App</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;</code><code class="nt">form</code> <code class="na">action</code><code class="o">=</code><code class="p">{</code><code class="nx">requestUsername</code><code class="p">}&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">input</code> <code class="na">type</code><code class="o">=</code><code class="s">"text"</code> <code class="na">name</code><code class="o">=</code><code class="s">"username"</code> <code class="p">/&gt;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">type</code><code class="o">=</code><code class="s">"submit"</code><code class="p">&gt;</code><code class="nx">Request</code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">&lt;/</code><code class="nt">form</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>In this example, <code>requestUsername</code> is a server action passed to a <code>&lt;form&gt;</code>.&#13;
When a user submits this form, there is a network request to the server&#13;
function <code>requestUsername</code>. When calling a server action in a form,&#13;
React will supply the form’s <code>FormData</code> as the first argument to the&#13;
server action.</p>&#13;
&#13;
<p>By passing a server action to the form action, React can progressively&#13;
enhance the form. This means that forms can be submitted before the&#13;
JavaScript bundle is loaded.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Outside of Forms" data-type="sect2"><div class="sect2" id="id150">&#13;
<h2>Outside of Forms</h2>&#13;
&#13;
<p>It’s worth noting that server actions are exposed server endpoints and&#13;
can be called anywhere in client code.</p>&#13;
&#13;
<p>When using a server action outside of a form, we can call the server&#13;
action in a transition, which allows us to display a loading indicator,&#13;
show optimistic state updates, and handle unexpected errors. Here’s an&#13;
example of a server action outside of a form:</p>&#13;
&#13;
<pre data-code-language="jsx" data-type="programlisting"><code class="s2">"use client"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">incrementLike</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./actions"</code><code class="p">;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">useState</code><code class="p">,</code><code class="w"> </code><code class="nx">useTransition</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"react"</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="kd">function</code><code class="w"> </code><code class="nx">LikeButton</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">isPending</code><code class="p">,</code><code class="w"> </code><code class="nx">startTransition</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useTransition</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="p">[</code><code class="nx">likeCount</code><code class="p">,</code><code class="w"> </code><code class="nx">setLikeCount</code><code class="p">]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">useState</code><code class="p">(</code><code class="mf">0</code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">incrementLink</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">async</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="s2">"use server"</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="nx">likeCount</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="mf">1</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">};</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="kd">const</code><code class="w"> </code><code class="nx">onClick</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="nx">startTransition</code><code class="p">(</code><code class="k">async</code><code class="w"> </code><code class="p">()</code><code class="w"> </code><code class="p">=&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">      </code><code class="c1">// To read a server action return value, we await the promise returned.</code><code class="w"/>&#13;
<code class="w">      </code><code class="kd">const</code><code class="w"> </code><code class="nx">currentCount</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">incrementLike</code><code class="p">();</code><code class="w"/>&#13;
<code class="w">      </code><code class="nx">setLikeCount</code><code class="p">(</code><code class="nx">currentCount</code><code class="p">);</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">});</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">};</code><code class="w"/>&#13;
&#13;
<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code class="nx">Total</code><code class="w"> </code><code class="nx">Likes</code><code class="o">:</code><code class="w"> </code><code class="p">{</code><code class="nx">likeCount</code><code class="p">}&lt;/</code><code class="nt">p</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">onClick</code><code class="p">}</code> <code class="na">disabled</code><code class="o">=</code><code class="p">{</code><code class="nx">isPending</code><code class="p">}&gt;</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">Like</code><code class="w"/>&#13;
<code class="w">      </code><code class="p">&lt;/</code><code class="nt">button</code><code class="p">&gt;;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">&lt;/&gt;</code><code class="w"/>&#13;
<code class="w">  </code><code class="p">);</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/></pre>&#13;
&#13;
<p>Thus, we can see that server actions are a powerful new feature in React&#13;
that allow us to call server-side functions from client-side code. This&#13;
really is intended only to be used in libraries or frameworks, as&#13;
working with these directives in vanilla React is a bit cumbersome and&#13;
requires quite a bit of work wiring things up. However, it’s a powerful&#13;
feature that enables a lot of interesting use cases<a data-startref="ix_ReactServerComponentsRSCsserveractions.09.1191.54" data-type="indexterm" id="id1078"/><a data-startref="ix_serveractions.09.1191.54" data-type="indexterm" id="id1079"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Future of React Server Components" data-type="sect1"><div class="sect1" id="id151">&#13;
<h1>The Future of React Server Components</h1>&#13;
&#13;
<p>RSCs are expected to evolve and improve<a data-primary="React Server Components (RSCs)" data-secondary="future of RSCs specifically" data-type="indexterm" id="id1080"/> over time. The&#13;
React team is actively working on refining the implementation,&#13;
addressing potential issues, and expanding the feature set. Some areas&#13;
of ongoing development include:</p>&#13;
<dl>&#13;
<dt>Better bundler integration</dt>&#13;
<dd>&#13;
<p>The React team is partnering with&#13;
bundler developers to ensure better support for RSCs in bundlers<a data-primary="bundlers" data-type="indexterm" id="id1081"/> like&#13;
Webpack, Rollup, and others. This will make it easier to build&#13;
RSCs-compatible frameworks and applications.</p>&#13;
</dd>&#13;
<dt>Ecosystem support</dt>&#13;
<dd>&#13;
<p>As RSCs gain traction, more&#13;
tools<a data-primary="ecosystems and tooling" data-secondary="React server components" data-type="indexterm" id="id1082"/>, libraries, and frameworks will likely emerge to support and&#13;
extend this new application architecture. This will enable developers to&#13;
more easily adopt RSCs in their projects and benefit from their performance&#13;
and efficiency improvements.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>RSCs represent a significant advancement in the React&#13;
ecosystem, offering improved performance, simplified data fetching, and&#13;
a better user experience. As RSCs continue to evolve and gain adoption,&#13;
they’re expected to become an essential tool for building modern,&#13;
efficient, and user-friendly React applications. With this comprehensive&#13;
understanding of RSCs, you are now well-equipped to&#13;
explore and experiment with this cutting-edge experimental feature in&#13;
your own projects<a data-startref="ix_ReactServerComponentsRSCs.09.14.71" data-type="indexterm" id="id1083"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Chapter Review" data-type="sect1"><div class="sect1" id="id257">&#13;
<h1>Chapter Review</h1>&#13;
&#13;
<p>In this chapter, we exclusively focused on React Server Components (RSCs), a significant advancement in the React ecosystem aimed at enhancing the performance, &#13;
<span class="keep-together">efficiency,</span> and user experience of React applications. RSCs represent an innovative application architecture that combines the best attributes of server-rendered multipage apps (MPAs) and client-rendered single-page apps (SPAs). This approach &#13;
<span class="keep-together">delivers</span> a seamless user experience without compromising on performance or maintainability. We delved into the core concepts, benefits, and the underlying mental models and mechanisms of RSCs. A key highlight was the introduction of a new type of component that operates on the server, excluded from the client-side JavaScript bundle, and can run during build time. This advancement leads to a more efficient and effective application structure.</p>&#13;
&#13;
<p>It’s worth noting that, at the time of writing, RSCs are a hot topic in the React and web engineering space, and some of the details we covered may have changed. As always, we recommend having a look at <a class="orm:hideurl" href="https://react.dev">react.dev</a> and React’s various community channels for the latest information.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Review Questions" data-type="sect1"><div class="sect1" id="id258">&#13;
<h1>Review Questions</h1>&#13;
<ol>&#13;
<li>&#13;
<p>What is the main value of React server components?</p>&#13;
</li>&#13;
<li>&#13;
<p>Can client components import server components? Why or why not?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are some trade-offs between server components and traditional client-only React apps?</p>&#13;
</li>&#13;
<li>&#13;
<p>What are module references and how does React process them during &#13;
<span class="keep-together">reconciliation?</span></p>&#13;
</li>&#13;
<li>&#13;
<p>How do server actions make React apps more accessible?</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Up Next" data-type="sect1"><div class="sect1" id="id259">&#13;
<h1>Up Next</h1>&#13;
&#13;
<p>In the following chapter, we are going to take a slightly different&#13;
path. We’ve spent most of our journey so far deeply embedded in&#13;
the world of React, exploring its intricate inner workings, innovative&#13;
strategies for state management, asynchronous rendering capabilities,&#13;
and finally, its powerful frameworks. Now, we’re going to take a step&#13;
back and broaden our perspective.</p>&#13;
&#13;
<p>We’re going to venture beyond React, diving into the world of alternative&#13;
UI libraries and frameworks that have grown alongside and sometimes in&#13;
response to React’s dominance. These alternatives have not only adopted&#13;
some of React’s best features, but have also introduced unique&#13;
innovations of their own, giving us exciting new paradigms and&#13;
possibilities in UI development.</p>&#13;
&#13;
<p>In the forthcoming exploration, we will be delving into the workings and&#13;
philosophies of some of these other UI libraries, such as Vue, Angular,&#13;
Solid, Qwik, and Svelte. We will look at their unique strategies for&#13;
managing state, handling side effects, and how they compare to React in&#13;
terms of performance and developer experience. Each alternative comes with its own set of pros and cons, which might make&#13;
it a better fit for certain types of projects or developer&#13;
preferences:</p>&#13;
<dl>&#13;
<dt>Vue</dt>&#13;
<dd>&#13;
<p>Vue offers a progressive framework that is&#13;
incrementally adoptable, meaning you can start small and gradually adopt&#13;
more of Vue’s features as you need them. Vue is renowned for its elegant&#13;
API and focus on developer experience. It introduces a reactivity model&#13;
that’s simple yet powerful, driven by its core concept of reactive&#13;
dependencies tracked during render.</p>&#13;
</dd>&#13;
<dt>Angular</dt>&#13;
<dd>&#13;
<p>Angular is a complete, opinionated framework&#13;
with a steeper learning curve, but offers robust solutions&#13;
out of the box. Its dependency injection system and declarative&#13;
templates offer a different approach to application structure and state&#13;
management compared to React.</p>&#13;
</dd>&#13;
<dt>Solid</dt>&#13;
<dd>&#13;
<p>Solid is another contender that is gaining attention in the&#13;
JavaScript community. It promises fine-grained reactivity with a&#13;
programming model similar to React, but with a focus on faster, more&#13;
efficient rendering. How Solid tracks dependencies could be a breath&#13;
of fresh air for developers looking for more efficiency at runtime.</p>&#13;
</dd>&#13;
<dt>The Qwik framework</dt>&#13;
<dd>&#13;
<p>Qwik introduces an interesting approach by focusing on&#13;
optimal loading performance with “predictable” prefetching. It brings&#13;
a unique perspective to how we can structure and deliver our JavaScript&#13;
for optimal user experience.</p>&#13;
</dd>&#13;
<dt>Svelte</dt>&#13;
<dd>&#13;
<p>Svelte has been turning heads by compiling&#13;
components at build time into imperative code that directly manipulates&#13;
the DOM, leading to faster initial load times and smooth updates. Its&#13;
reactivity model, marked by reactive statements, offers an intriguing&#13;
contrast to the virtual DOM diffing strategy adopted by React.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>While exploring these frameworks and libraries, we’ll keep our knowledge&#13;
of React as a touchstone. This will not only help us understand the&#13;
other libraries better but also deepen our understanding of React by&#13;
offering points of comparison and contrast.</p>&#13;
&#13;
<p>Get ready to uncover the unique ways these alternate UI libraries&#13;
approach reactivity, state management, side effects, and more. By&#13;
studying these alternatives, we can glean insights that might inform our&#13;
approach to problem-solving, regardless of the library or framework we&#13;
choose to use. It’s a big, diverse world of JavaScript out there, and&#13;
we’re about to dive in headfirst.</p>&#13;
&#13;
<p>Buckle up! The journey is about to get even more exciting.</p>&#13;
</div></section>&#13;
</div></section></body></html>