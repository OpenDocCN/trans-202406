<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 10. View Binding: Bound Together"><div class="chapter" id="view_bindingcolon_bound_together">
<h1><span class="label">Chapter 10. </span>View Binding: <em>Bound Together</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0403-01.png" alt="image" width="600" height="444"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="findViewById() method" data-secondary="versus view binding" id="idm46053738321072"/><a data-type="indexterm" data-primary="views" data-secondary="findViewById() method" id="idm46053738319696"/><strong>It’s time to wave farewell to findViewById().</strong></p>
<p>As you’ve probably noticed by now, the more views you have and the more interactive your apps become, <strong>the more calls you need to make to <em>findViewById()</em></strong>. And if you’re getting tired of typing the code for this method every time you want to work with a view, <em>you’re not alone</em>. In this chapter, you’ll discover <strong>how to make <em>findViewById()</em> a thing of the past</strong> by implementing <strong>view binding</strong>. You’ll find out how to apply this technique to both <strong>activity and fragment code</strong>, and you’ll learn why this approach is a <strong>safer, more efficient</strong> way of accessing your layout’s views. Let’s get started…</p>
<section data-type="sect1" data-pdf-bookmark="Behind the scenes of findViewById()"><div class="sect1" id="behind_the_scenes_of_findviewbyidleft_pa">
<h1>Behind the scenes of findViewById()</h1>
<p>As you already know, each time you want to interact with a view in your activity or fragment code, you first call <code>findViewById()</code> to get a reference to it. The following activity code, for example, gets a reference to a <code>Button</code> with the ID <code>start_button</code> so that it can respond to clicks:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0404-01.png" alt="image" width="600" height="208"/>
<h6/>
</div></figure>
<p>But what actually happens when <code>findViewById()</code> gets called?</p>
<section data-type="sect2" data-pdf-bookmark="findViewById() looks for a view in the view hierarchy"><div class="sect2" id="findviewbyidleft_parenthesisright_parent">
<h2>findViewById() looks for a view in the view hierarchy</h2>
<p>The following things happen when the above code runs:</p>
<ol>
<li><p><strong>The MainActivity’s layout file (activity_main.xml) is inflated into a hierarchy of View objects.</strong></p>
<p>If the file describes a linear layout that contains a text view and a button, the layout gets inflated into <code>LinearLayout</code>, <code>TextView</code>, and <code>Button</code> objects. The <code>LinearLayout</code> is the root view of this hierarchy.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0404-02.png" alt="image" width="600" height="222"/>
<h6/>
</div></figure></li>
<li><p><strong>Android searches the View hierarchy for a View with a matching ID.</strong></p>
<p>We’re using <code>findViewById&lt;Button&gt;(R.id.start_button)</code>, so Android searches the view hierarchy for a <code>View</code> whose ID is <code>start_button</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0405-01.png" alt="image" width="600" height="208"/>
<h6/>
</div></figure></li>
<li><p><strong>Android returns the topmost View with this ID in the hierarchy, and casts it to the type specified in the call to findViewById().</strong></p>
<p>Here, <code>findViewById&lt;Button&gt;(R.id.start_button)</code> finds the first <code>View</code> in the hierarchy with an ID of <code>start_button</code>, and casts it as a <code>Button</code>. <code>MainActivity</code> can now interact with it.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0405-02.png" alt="image" width="600" height="236"/>
<h6/>
</div></figure></li>
</ol>
<p>So each time you use <code>findViewById()</code>, Android searches the layout’s hiearchy for a <code>View</code> with a matching ID, and casts it to the specified type.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id00150">
<h5><span class="inlineimage"><img src="Images/brain.png" alt="Images" width="113" height="131"/></span> Brain Power</h5>
<p>Now that you’ve seen how <code>findViewById()</code> works, what disadvantages can you see to its approach? What do you think could be done differently?</p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="There’s a downside to findViewById()"><div class="sect1" id="thereapostrophes_a_downside_to_findviewb">
<h1>There’s a downside to findViewById()</h1>
<p>Even though <code>findViewById()</code> is a useful way of getting references to views, it has several disadvantages.</p>
<ul style="list-style-type:none;">
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>It makes your code longer.</strong></p>
<p>The more views you need to interact with, the more calls you need to make. This can lead to longer code that’s harder to read.</p></li>
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>It’s inefficient.</strong></p>
<p>Each time you call <code>findViewById()</code>, Android has to search the layout’s hierarchy for a view with a matching ID. This is inefficient, particularly if your layout has many views in a deep hierarchy.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0406-01.png" alt="image" width="243" height="328"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>It’s not null-safe.</strong></p>
<p><code>findViewById()</code> is used to search for a view at runtime, which means the compiler can’t check for common errors.</p>
<p>It’s possible, for instance, to pass <code>findViewById()</code> an invalid ID: one that doesn’t exist in the layout. If you try using:</p>
<pre data-type="programlisting">val message = view.findViewById&lt;EditText&gt;(R.id.message)</pre>
<p>and the layout doesn’t include a <code>View</code> with an ID of <code>message</code>, a null pointer exception will get thrown, and the app will crash.</p></li>
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>It’s not type-safe.</strong></p>
<p>Another problem is that the compiler can’t check that you’ve specified the <code>View</code>’s type correctly, which can lead to a class cast exception.</p>
<p>Imagine you have a radio group named <code>pizza_group</code>, and you try to get a reference to it using this code:</p>
<pre data-type="programlisting">val pizzaGroup = view.findViewById&lt;ChipGroup&gt;(R.id.pizza_group)</pre>
<p>Even though the <code>ChipGroup</code> type is specified instead of <code>RadioGroup</code>, the code still compiles. The compiler doesn’t check whether the type is correct when it builds the code. When the app runs, it throws a class cast exception, and the app crashes.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0406-02.png" alt="image" width="558" height="238"/>
<h6/>
</div></figure>
<p>So if <code>findViewById()</code> has these disadvantages, what’s the alternative?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="View binding to the rescue"><div class="sect1" id="view_binding_to_the_rescue">
<h1>View binding to the rescue</h1>
<p><a data-type="indexterm" data-primary="Android Jetpack" data-secondary="view binding" data-see="view binding" id="idm46053738259376"/><a data-type="indexterm" data-primary="view binding" id="idm46053738255504"/><a data-type="indexterm" data-primary="views" data-seealso="view binding" id="idm46053738254672"/>An alternative to calling <code>findViewById()</code> each time you need a <code>View</code> reference is to use <strong>view binding</strong>. With view binding, you set up a binding object (which you’ll find out more about later) and use this to access each view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0407-01.png" alt="image" width="323" height="153"/>
<h6/>
</div></figure>
<p>As an example, suppose you have a layout that includes a button with an ID of <code>start_button</code>. If you wanted to make it do something when clicked, you could get a reference to it using <code>findViewById()</code> like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0407-02.png" alt="image" width="600" height="75"/>
<h6/>
</div></figure>
<p>With view binding, you no longer need to call <code>findViewById()</code> to get a reference to the button. Instead, you simply use the following:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0407-03.png" alt="image" width="600" height="75"/>
<h6/>
</div></figure>
<p>This code does the same thing, but it’s simpler to write, and can make your code shorter and easier to read.</p>
<section data-type="sect2" data-pdf-bookmark="View binding is safer and more efficient than findViewById()"><div class="sect2" id="view_binding_is_safer_and_more_efficient">
<h2>View binding is safer and more efficient than findViewById()</h2>
<p>When you use view binding, Android no longer needs to search your layout’s view hierarchy for a matching <code>View</code>: it simply uses the binding object to access it. This makes it much more efficient than using <code>findViewById()</code>.</p>
<p>Another advantage is <strong>the compiler prevents null pointer and class cast exceptions at compile time</strong>. As you access views using a binding object, the compiler knows which views are available and their types. It won’t let you reference a view that doesn’t exist, and you no longer have to cast it to a specific type because the compiler already knows what this is. Your code is much safer as a result.</p>
<p>Now that you know about the benefits of using view binding, let’s find out how to use it.</p>
<blockquote>
<p><strong>View binding is a type-safe, more efficient alternative to calling findViewById().</strong></p>
</blockquote>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s how we’ll use view binding"><div class="sect1" id="hereapostrophes_how_weapostrophell_use_v">
<h1>Here’s how we’ll use view binding</h1>
<p><a data-type="indexterm" data-primary="Stopwatch app" data-secondary="view binding" id="idm46053738234464"/>View binding code is slightly different for activities and fragments, so in this chapter we’re going to show you the code for both. Here are the steps we’ll go through:</p>
<ol>
<li><p><strong>Add view binding to the Stopwatch app’s activity code.</strong></p>
<p>In <a data-type="xref" href="ch05.xhtml#the_activity_lifecyclecolon_being_an_act">Chapter 5</a>, we built a Stopwatch app to teach you about Android’s activity lifecycle methods. We’ll revisit this app, and update its activity code so it uses view binding.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0408-01.png" alt="image" width="600" height="556"/>
<h6/>
</div></figure></li>
<li><p><strong>Add view binding to the Bits and Pizzas app’s fragment.</strong></p>
<p>We’ll then go back to the Bits and Pizzas app we created in the previous chapter and show you how to implement view binding in its fragment code.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0408-02.png" alt="image" width="600" height="567"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s get started.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Stopwatch app revisited"><div class="sect1" id="the_stopwatch_app_revisited">
<h1>The Stopwatch app revisited</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0409-01.png" alt="image" width="275" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activities" data-secondary="view binding" id="idm46053738222384"/><a data-type="indexterm" data-primary="view binding" data-secondary="activities" id="idm46053738221152"/>We’ll begin by changing up the Stopwatch app you created in <a data-type="xref" href="ch05.xhtml#the_activity_lifecyclecolon_being_an_act">Chapter 5</a>, so open the project for this app now.</p>
<p>As you may recall, the Stopwatch app displays a simple stopwatch that you can start, pause, and reset with the help of three buttons. It looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-02.png" alt="image" width="600" height="434"/>
<h6/>
</div></figure>
<p>The app uses a single activity—<code>MainActivity</code>—which has a layout file named <em>activity_main.xml</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0409-03.png" alt="image" width="315" height="296"/>
<h6/>
</div></figure>
<p>Each time it needs to interact with one of its views, it calls <code>findViewById()</code> to get a reference to it. To make its Start button respond to clicks, for example, it uses code like this:</p>
<pre data-type="programlisting">val startButton = findViewById&lt;Button&gt;(R.id.start_button)
startButton.setOnClickListener {
    //Code that runs when the button’s clicked
}</pre>
<p>Let’s find out how to update the app so that it uses view binding instead.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Enable view binding in the app build.gradle file"><div class="sect1" id="enable_view_binding_in_the_app_builddotg">
<h1>Enable view binding in the <u>app</u> build.gradle file</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0410-01.png" alt="image" width="275" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="ActivityMainBinding class" id="idm46053738207120"/><a data-type="indexterm" data-primary="layouts" data-secondary="view binding" id="idm46053738205952"/><a data-type="indexterm" data-primary="startButton property, ActivityMainBinding" id="idm46053738204848"/>To use view binding, you first need to enable it in the <code>android</code> section of the app’s <em>build.gradle</em> file. The code to enable view binding looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0410-02.png" alt="image" width="550" height="178"/>
<h6/>
</div></figure>
<p>We’re going to use view binding in the Stopwatch app, so make sure that you add the above change to the file <em>Stopwatch/app/build.gradle</em>. Then choose the Sync Now option to sync this change with the rest of your project.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">Remember to sync this change, or you’ll get errors in your code when you try to update the activity code.</span></p>
</div>
<section data-type="sect2" data-pdf-bookmark="Enabling view binding generates code for each layout"><div class="sect2" id="enabling_view_binding_generates_code_for">
<h2>Enabling view binding generates code for each layout</h2>
<p>When you enable view binding, it automatically creates a binding class for each of the layout files in your app. The Stopwatch app, for example, contains a layout file named <em>activity_main.xml</em>, so when you enable view binding, it automatically generates a binding class named <code>ActivityMainBinding</code>:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0410-04.png" alt="image" width="567" height="122"/>
<h6/>
</div></figure>
<p>Each binding class includes a property for each view in the layout that has an ID. The layout <em>activity_main.xml</em>, for example, includes a button with an ID of <code>start_button</code>, so the binding class <code>ActivityMainBinding</code> includes a property named <code>startButton</code> whose type is <code>Button</code>.</p>
<p>The binding classes are important because <strong>the layout’s views are bound to the binding class properties</strong>. Instead of calling <code>findViewById()</code> each time you need a view reference, you simply interact with that view’s property in the binding class.</p>
<p>Now that we’ve enabled view binding in the Stopwatch app, let’s see how to use it in the code for <code>MainActivity</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0410-05.png" alt="image" width="327" height="306"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How to add view binding to an activity"><div class="sect1" id="how_to_add_view_binding_to_an_activity">
<h1>How to add view binding to an activity</h1>
<p><a data-type="indexterm" data-primary="binding property" data-secondary="ActivityMainBinding" id="idm46053738188064"/><a data-type="indexterm" data-primary="inflate() method" id="idm46053738182880"/><a data-type="indexterm" data-primary="inflate() method" data-secondary="ActivityMainBinding" id="idm46053738182048"/><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="view binding" id="idm46053738180944"/><a data-type="indexterm" data-primary="setContentView() method, activity" data-secondary="binding object" id="idm46053738179872"/>The code to make an activity use view binding is virtually identical for every activity you create. It looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0411-02.png" alt="image" width="600" height="298"/>
<h6/>
</div></figure>
<p>The above code declares a property named <code>binding</code> whose type is <code>ActivityMainBinding</code>. This property gets set in the activity’s <code>onCreate()</code> method using the following code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0411-03.png" alt="image" width="600" height="37"/>
<h6/>
</div></figure>
<p>This calls <code>ActivityMainBinding</code>’s <code>inflate()</code> method, which creates an <code>ActivityMainBinding</code> object that’s linked to the activity’s layout.</p>
<p>The code:</p>
<pre data-type="programlisting">val view = binding.root
setContentView(view)</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0411-04.png" alt="image" width="500" height="258"/>
<h6/>
</div></figure>
<p>gets a reference to the <code>binding</code> object’s root view, and uses the <code>setContentView()</code> method to display it.</p>
<p>Once you’ve added view binding to an activity in this way, you can use the <code>binding</code> property to interact with the layout’s views. Let’s do this now.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use the binding property to interact with views"><div class="sect1" id="use_the_binding_property_to_interact_wit">
<h1>Use the binding property to interact with views</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0412-01.png" alt="image" width="275" height="59"/>
<h6/>
</div></figure>
<p>The current code for <code>MainActivity</code> interacts with its views in order to control the stopwatch and make its buttons respond to clicks. We can update this code so that instead of making calls to <code>findViewById()</code>, it accesses the views using the activity’s <code>binding</code> property.</p>
<p>To see how this works, let’s use <code>MainActivity</code>’s Start button as an example.</p>
<section data-type="sect2" data-pdf-bookmark="The layout code"><div class="sect2" id="the_layout_code">
<h2>The layout code</h2>
<p>The Start button is defined in <em>activity_main.xml</em> using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0412-02.png" alt="image" width="600" height="213"/>
<h6/>
</div></figure>
<p>As you can see, it has an ID of <code>start_button</code>.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The activity code"><div class="sect2" id="the_activity_code">
<h2>The activity code</h2>
<p><code>MainActivity</code> makes the button respond to clicks using <code>findViewById()</code> like so:</p>
<pre data-type="programlisting"><strong>val startButton = findViewById&lt;Button&gt;(R.id.start_button)</strong>
startButton.setOnClickListener {
    //Code that runs when the button’s clicked
}</pre>
<p>With view binding, we can change the code to:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0412-03.png" alt="image" width="600" height="169"/>
<h6/>
</div></figure>
<p>The code does the same thing as the original code, but it uses <code>MainActivity</code>’s <code>binding</code> property to interact with the button.</p>
<p>Let’s update the full code for <code>MainActivity</code> so it uses view binding.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for MainActivity.kt"><div class="sect1" id="the_full_code_for_mainactivitydo-id00151">
<h1>The full code for MainActivity.kt</h1>
<p><a data-type="indexterm" data-primary="view binding" data-secondary="code for" id="idm46053738144176"/>Here’s the updated code for <code>MainActivity</code>; update the code for <em>MainActivity.kt</em> so that it includes the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0413-02.png" alt="image" width="600" height="610"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0414-02.png" alt="image" width="600" height="670"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0415-02.png" alt="image" width="600" height="566"/>
<h6/>
</div></figure>
<p>Those are all the changes we need to make to the Stopwatch app to get it to use view binding. Let’s run through what happens when the code runs, and take it for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What the code does"><div class="sect1" id="what_the_code_does-id00152">
<h1>What the code does</h1>
<p><a data-type="indexterm" data-primary="ActivityMainBinding class" id="idm46053738133744"/><a data-type="indexterm" data-primary="binding property" id="idm46053738132416"/><a data-type="indexterm" data-primary="onCreate() method, activity" data-secondary="view binding" id="idm46053738131680"/>The following things happen when the app runs:</p>
<ol>
<li><p><strong>When the app launches, MainActivity gets created.</strong></p>
<p>It includes an <code>ActivityMainBinding</code> property named <code>binding</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-02.png" alt="image" width="337" height="113"/>
<h6/>
</div></figure></li>
<li><p><strong>When MainActivity’s onCreate() method runs, it assigns an ActivityMainBinding object to the binding property.</strong></p>
<p>The <code>binding</code> property gets set in <code>onCreate()</code> because this is when <code>MainActivity</code> first has access to views.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-03.png" alt="image" width="600" height="107"/>
<h6/>
</div></figure></li>
<li><p><strong>The ActivityMainBinding object includes a property for each view in the layout with an ID.</strong></p>
<p>The layout file <em>activity_main.xml</em> includes a button with an ID of <code>start_button</code>, for example, so the <code>ActivityMainBinding</code> object includes a <code>Button</code> property named <code>startButton</code>, which provides access to this view.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-04.png" alt="image" width="600" height="105"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity uses the binding property to access its views.</strong></p>
<p>It specifies how the Start button should respond to clicks, for example, by calling the <code>startButton</code> property’s <code>setOnClickListener()</code> method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0416-05.png" alt="image" width="600" height="79"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00153">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, it works in the same way as it did before. When we click on the Start button, the stopwatch starts, and it pauses and gets reset when we click on the Pause and Reset buttons.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0417-02.png" alt="image" width="459" height="496"/>
<h6/>
</div></figure>
<p>The difference, however, is that the <code>MainActivity</code> now uses view binding to intract with its views instead of making calls to <code>findViewById()</code>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00154">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Why didn’t you cover view binding earlier in the book?</strong></p>
<p><strong>A:</strong> We wanted you to get more activity and fragment experience under your belt before introducing you to view binding. View binding makes some parts of the code a bit more complicated, and we felt it was important for you to get used to the basics first.</p>
<p><strong>Q: Is it possible to stop a binding class from being generated for a particular layout file?</strong></p>
<p><strong>A:</strong> Yes. If you know that you won’t use view binding with a particular layout, you can stop its binding class from being generated by adding to its root view:</p>
<pre data-type="programlisting">tools:viewBindingIgnore="true"</pre>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Activity Magnets"><div class="sect1" id="activity_magnets-id00155">
<h1>Activity Magnets</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activities" data-secondary="view binding" id="idm46053738096096"/><a data-type="indexterm" data-primary="exercises" data-secondary="Magnets" id="idm46053738094736"/>An activity named <code>MainActivity</code> uses the file <em>activity_main.xml</em> for its layout. The layout includes a <code>Button</code> (with an ID of <code>pow_button</code>) and a <code>TextView</code> {with an ID of <code>pow_text</code>). When clicked, the <code>Button</code> needs to make the <code>TextView</code> display the text “Pow!”</p>
<p>Somebody used fridge magnets to write the <code>MainActivity</code> code, but a freak kitchen sandstorm dislodged some of the magnets. Can you piece the code back together again?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0418-01.png" alt="image" width="600" height="545"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fragments can use view binding too (but the code’s a little different)"><div class="sect1" id="fragments_can_use_view_binding_too_left">
<h1>Fragments can use view binding too (but the code’s a little different)</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0419-01.png" alt="image" width="276" height="64"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="view binding" id="idm46053738082896"/><a data-type="indexterm" data-primary="view binding" data-secondary="fragments" id="idm46053738081616"/>Now that you’ve learned how to implement view binding in your activity code, lets find out how to use it in fragments. As we said earlier, the code for fragments is slightly different to the code for activities.</p>
<section data-type="sect2" data-pdf-bookmark="Let’s implement view binding in the Bits and Pizzas app"><div class="sect2" id="letapostrophes_implement_view_binding_in">
<h2>Let’s implement view binding in the Bits and Pizzas app</h2>
<p>We’ll explore how view binding for fragments works by changing up the Bits and Pizzas app you created in <a data-type="xref" href="ch09.xhtml#material_viewscolon_a_material_world">Chapter 9</a>. Open the project for this app now.</p>
<p>As we’re sure you remember, the Bits and Pizzas app uses Material views such as collapsing toolbars and FABs to provide an interactive UI for a pizza app. The UI is defined by the app’s fragment, which is named <code>FragmentOrder</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0419-02.png" alt="image" width="600" height="643"/>
<h6/>
</div></figure>
<p>The code for <code>FragmentOrder</code> includes many calls to <code>findViewById()</code>. Let’s find out how to use view binding to replace these.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0419-03.png" alt="image" width="316" height="297"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Enable view binding for Bits and Pizzas"><div class="sect1" id="enable_view_binding_for_bits_and_pizzas">
<h1>Enable view binding for Bits and Pizzas</h1>
<p><a data-type="indexterm" data-primary="ActivityMainBinding class" id="idm46053738073616"/><a data-type="indexterm" data-primary="FragmentOrderBinding class" id="idm46053738069056"/>As before, to use view binding in the Bits and Pizzas project, you first need to enable it in the app’s <em>build.gradle</em> file.</p>
<p>Open the file <em>BitsandPizzas/app/build.gradle</em>, and add the following lines to the <code>android</code> section:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0420-02.png" alt="image" width="572" height="179"/>
<h6/>
</div></figure>
<p>Then choose the Sync Now option to sync the change with the rest of your project.</p>
<section data-type="sect2" data-pdf-bookmark="Binding classes are generated for every layout"><div class="sect2" id="binding_classes_are_generated_for_every">
<h2>Binding classes are generated for every layout</h2>
<p>Just as with the Stopwatch app, enabling view binding in the Bits and Pizzas app automatically creates a binding class for each of the app’s layout files. This app contains two layout files—<em>activity_main.xml</em> and <em>fragment_order.xml</em>—so two binding classes are generated: <code>ActivityMainBinding</code> and <code>FragmentOrderBinding</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0420-03.png" alt="image" width="600" height="148"/>
<h6/>
</div></figure>
<p>As before, each binding class includes a property for each view in its layout with an ID. The layout <em>fragment_order.xml</em>, for example, includes a radio group with an ID of <code>pizza_group</code>, so the binding class <code>FragmentOrderBinding</code> includes a property named <code>pizzaGroup</code> whose type is <code>RadioGroup</code>.</p>
<p>In the Bits and Pizzas app, the only code that interacts with views is in <em>OrderFragment.kt</em>, so we only need to update this file in order to use view binding.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0420-04.png" alt="image" width="382" height="200"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fragment view binding code is a little different"><div class="sect1" id="fragment_view_binding_code_is_a_little_d">
<h1>Fragment view binding code is a little different</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0421-01.png" alt="image" width="276" height="65"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activity lifecycle" id="idm46053738047728"/>As we said earlier, the view binding code you use in a fragment is slightly different to the code you use in an activity. Before we show you what fragment view binding code looks like, we’re going to dig a little deeper, and show you why the code is different.</p>
<section data-type="sect2" data-pdf-bookmark="Activities can access views from onCreate()"><div class="sect2" id="activities_can_access_views_from_oncreat">
<h2>Activities can access views from onCreate()</h2>
<p>As you already know, an activity first gets access to its layout when its <code>onCreate()</code> method runs. This is the first method in the activity’s lifecycle, and it’s used to inflate the layout (or bind to it with view binding) and perform any initial setup. If a button needs to respond to clicks, for example, the activity assigns an <code>OnClickListener</code> to it using code in its <code>onCreate()</code> method.</p>
<p>The activity continues to have access to its layout until its <code>onDestroy()</code> method has run. This is the final method in the activity’s lifecycle, and the activity is destroyed after this method has finished running.</p>
<p>Because the activity has access to the views in its layout from <code>onCreate()</code> to <code>onDestroy()</code>, it can interact with them in any of its methods:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0421-02.png" alt="image" width="600" height="367"/>
<h6/>
</div></figure>
<p>That’s what happens with activities, but for fragments the situation’s a little different. Let’s see how.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fragments can access views from onCreateView() to onDestroyView()"><div class="sect1" id="fragments_can_access_views_from_oncreate">
<h1>Fragments can access views from onCreateView() to onDestroyView()</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="lifecycle" id="idm46053738035808"/><a data-type="indexterm" data-primary="onDestroyView() method, fragments" id="idm46053738034672"/>As you know, a fragment first gets access to its layout when its <code>onCreateView()</code> method runs. This gets called when an activity needs access to the fragment’s layout, so it’s used to inflate the layout and perform any initial setup such as setting <code>OnClickListener</code>s.</p>
<p><code>onCreateView()</code>, however, isn’t the first method in the fragment’s lifecycle. There are other methods, such as <code>onCreate()</code>, that run before <code>onCreateView()</code>, so they can’t interact with the fragment’s views.</p>
<p>After its <code>onCreateView()</code> method has run, the fragment continues to have access to its views until its <code>onDestroyView()</code> method has finished running. This gets called when the activity no longer needs the fragment’s layout, which may be because the activity needs to navigate to a different fragment, or it’s being destroyed.</p>
<p><code>onDestroyView()</code>, however, isn’t the final method in the fragment’s lifecycle. There are other methods, such as <code>onDestroy(),</code> that run after <code>onDestroyView()</code>, so these can’t interact with the fragment’s views either:</p>
<blockquote>
<p><strong>An <u>activity</u> can interact with its views from onCreate() to onDestroy().</strong></p>
<p><strong>A <u>fragment</u> can only interact with its views from onCreate<u>View</u>() to onDestroy<u>View</u>().</strong></p>
</blockquote>
<figure class="informal"><div class="figure">
<img src="Images/f0422-02.png" alt="image" width="600" height="400"/>
<h6/>
</div></figure>
<p>We’ll show you an overview of the fragment lifecycle on the next page, and then see what fragment view binding code looks like.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="fragment_lifecycle_methods_up_close">
<h5>Fragment Lifecycle Methods Up Close <span class="inlineimage"><img src="Images/zoomr.png" alt="Images" width="134" height="81"/></span></h5>
<p>A fragment’s lifecycle is very similar to an activity’s, but it has a few extra steps. Here’s when the main fragment lifecycle methods get called, what you use them for, and how they fit in with the state of the activity the fragment is displayed in:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0423-01.png" alt="image" width="600" height="579"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What fragment view binding code looks like"><div class="sect1" id="what_fragment_view_binding_code_looks_li">
<h1>What fragment view binding code looks like</h1>
<p>You’re now ready to see what fragment view binding code is like. Just like activities, you enable view binding in fragments by getting them to use a binding property, but the way in which you do this is slightly different.</p>
<p>Here’s the code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0424-02.png" alt="image" width="600" height="542"/>
<h6/>
</div></figure>
<p>As you can see, the above code defines two extra properties: <code>binding</code> and <code>_binding</code>. Let’s take a closer look at what these two properties do.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-id00156">
<h5><span class="inlineimage"><img src="Images/cup.png" alt="Images" width="124" height="107"/></span> Relax</h5>
<p><strong>View binding code for fragments looks virtually identical for every fragment.</strong></p>
<p>Once you’ve included these changes, you can replace any <code>findViewById()</code> method calls as you did with activities.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="_binding refers to the binding object…"><div class="sect1" id="underscorebinding_refers_to_the_binding">
<h1>_binding refers to the binding object…</h1>
<p><a data-type="indexterm" data-primary="binding property" data-secondary="fragment" id="idm46053738004160"/><a data-type="indexterm" data-primary="_binding property, fragment" id="idm46053738003104"/><a data-type="indexterm" data-primary="FragmentOrderBinding? type" id="idm46053738002240"/>As you’ve just seen, the view binding code for fragments defines a <code>_binding</code> property like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-02.png" alt="image" width="600" height="106"/>
<h6/>
</div></figure>
<p>Its type is <code>FragmentOrderBinding?</code>, and it’s initialized with <code>null</code>.</p>
<p>The <code>_binding</code> property is set to an instance of <code>FragmentOrderBinding</code> in the fragment’s <code>onCreateView()</code> method using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-03.png" alt="image" width="600" height="159"/>
<h6/>
</div></figure>
<p>It’s set in this method because it’s when the fragment first has access to its views.</p>
<p>The <code>_binding</code> property is set back to <code>null</code> in the fragment’s <code>onDestroyView()</code> method:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0425-04.png" alt="image" width="600" height="109"/>
<h6/>
</div></figure>
<p>This is because the fragment can no longer access its views after its <code>onDestroyView()</code> method gets called.</p>
<section data-type="sect2" data-pdf-bookmark="...and the binding property provides non-null access to it"><div class="sect2" id="dotdotdotand_the_binding_property_provid">
<h2>...and the binding property provides non-null access to it</h2>
<p>The <code>binding</code> property uses a getter to return a non-<code>null</code> version of <code>_binding</code>, and throws a null pointer exception if <code>_binding</code> is <code>null</code>:</p>
<pre data-type="programlisting"><strong>private val binding get() = _binding!!</strong></pre>
<p>This means you can use the <code>binding</code> property to interact with the fragment’s views without performing lots of messy null-safety checks. To make a fragment’s FAB respond to clicks, for example, you simply use:</p>
<pre data-type="programlisting"><strong>binding.</strong>fab.setOnClickListener {
    //Code that does something
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0425-05.png" alt="image" width="460" height="396"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activities" data-secondary="view binding" id="idm46053737980064"/><strong>Activities and fragments get access to their views at different points in their lifecycles.</strong></p>
<p>An <em>activity</em> can interact with its views from when it’s been created and its <code>onCreate()</code> method is called. It continues to have access to these views until the activity is destroyed, which happens at the end of its lifecycle.</p>
<p>A <em>fragment</em>, however, can only interact with its views from when its <code>onCreateView()</code> method gets called. This means that the <code>_binding</code> property can <em>only</em> be set to a view binding object in this method.</p>
<p>The fragment continues to have access to its views until its <code>onDestroyView()</code> method runs. At this point, the fragment’s layout is discarded, so _<code>binding</code> needs to be set to null. This prevents the fragment from trying to use the view binding object when it can no longer interact with views.</p>
<p>You now know everything that you need in order to use view binding with a fragment, so let’s update the code for <code>OrderFragment</code> in the Bits and Pizzas app.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0426-02.png" alt="image" width="600" height="619"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for OrderFragment.kt"><div class="sect1" id="the_full_code_for_orderfragmentd-id00157">
<h1>The full code for OrderFragment.kt</h1>
<p><a data-type="indexterm" data-primary="OrderFragment" data-secondary="code for" id="idm46053737968960"/><a data-type="indexterm" data-primary="view binding" data-secondary="code for" id="idm46053737967456"/>Here’s the code to make <code>OrderFragment</code> use view binding; update the code for <em>OrderFragment.kt</em> so it includes the changes shown here (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0427-02.png" alt="image" width="600" height="531"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0428-02.png" alt="image" width="600" height="510"/>
<h6/>
</div></figure>
<p>That’s all the code we need to make <code>OrderFragment</code> use view binding. Let’s take the app for a test drive, and make sure that it still works.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00158">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, it works in the same way as it did before.</p>
<p>When we click on the FAB without selecting a pizza type, a toast asks us to choose a pizza.</p>
<p>When we select a pizza type and click on the FAB again, a snackbar appears at the bottom of the screen showing us details of our order.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0429-02.png" alt="image" width="600" height="528"/>
<h6/>
</div></figure>
<p>Congratulations! You now know how to implement view binding in your activity and fragment code. We’ll continue to use view binding through the rest of this book.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise-id00159">
<h5><span class="inlineimage"><img src="Images/exercise.png" alt="Images" width="125" height="79"/></span> Exercise</h5>
<p><a data-type="indexterm" data-primary="FAB (floating action button)" data-secondary="view binding exercise" id="idm46053737950704"/>The fragment code below makes a FAB (with an ID of <code>fab</code>) respond to clicks. When clicked, a snackbar is displayed on the device screen. The snackbar includes an action that displays a toast.</p>
<p>Can you update the fragment so that it uses view binding?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0430-01.png" alt="image" width="600" height="375"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="101" height="9"/></span> <strong>Answers in <a data-type="xref" href="#exercise_solution-id00161">“<span class="inlineimage"><img src="Images/exercise.png" alt="Images" width="125" height="79"/></span> Exercise Solution”</a></strong>.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Activity Magnets Solution"><div class="sect1" id="activity_magnets_solution-id00160">
<h1>Activity Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="activities" data-secondary="view binding" id="idm46053737939968"/>An activity named <code>MainActivity</code> uses the file <em>activity_main.xml</em> for its layout. The layout includes a <code>Button</code> (with an ID of <code>pow_button</code>) and a <code>TextView</code> {with an ID of <code>pow_text</code>). When clicked, the <code>Button</code> needs to make the <code>TextView</code> display the text “Pow!”</p>
<p>Somebody used fridge magnets to write the <code>MainActivity</code> code, but a freak kitchen sandstorm dislodged some of the magnets. Can you piece the code back together again?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0431-01.png" alt="image" width="600" height="549"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="exercise_solution-id00161">
<h5><span class="inlineimage"><img src="Images/exercise.png" alt="Images" width="125" height="79"/></span> Exercise Solution</h5>
<p><a data-type="indexterm" data-primary="FAB (floating action button)" data-secondary="view binding exercise" id="idm46053737929568"/>The fragment code below makes a FAB (with an ID of <code>fab</code>) respond to clicks. When clicked, a snackbar is displayed on the device screen. The snackbar includes an action that displays a toast.</p>
<p>Can you update the fragment so that it uses view binding?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0432-01.png" alt="image" width="600" height="584"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00162">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#view_bindingcolon_bound_together">Chapter 10</a> under your belt and now you’ve added view binding to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0433-01.png" alt="image" width="234" height="211"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00163">
<h5>Bullet Points</h5>
<ul>
<li><p>View binding is a type-safe way of interacting with views. It’s more efficient than using <code>findViewById()</code>, and less likely to produce errors at runtime.</p></li>
<li><p>View binding can be used in activity and fragment code.</p></li>
<li><p>Enable view binding in the app’s <em>build.gradle</em> file.</p></li>
<li><p>View binding generates a binding class for each of the app’s layout files.</p></li>
<li><p>Each binding class includes a property for each view in the layout with an ID.</p></li>
<li><p>When you use view binding with an activity, you set its binding property in the activity’s <code>onCreate()</code> method.</p></li>
<li><p>When you use view binding with a fragment, you set its binding property in the fragment’s <code>onCreateView()</code> method, and set it to null in <code>onDestroyView()</code>.</p></li>
<li><p>Fragments have lifecycle methods that are linked to an activity’s state.</p></li>
</ul>
</div></aside>
</div></section>
</div></section></div></body></html>