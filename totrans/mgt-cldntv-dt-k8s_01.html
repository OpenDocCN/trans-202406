<html><head></head><body><section data-pdf-bookmark="Preface" data-type="preface" epub:type="preface"><div class="preface" id="preface">&#13;
<h1>Preface</h1>&#13;
&#13;
<p>Is Kubernetes ready for stateful workloads?</p>&#13;
<p>This might be the question that got you to open this book. Since cloud computing first emerged, data infrastructure (NoSQL/NewSQL, streaming, analytics) and application infrastructure (Docker, Kubernetes) have been maturing rapidly but on separate tracks. In our view, it’s time to formalize bringing these two areas together. This isn’t an aspiration for the future; it is already happening with collaboration across multiple communities. Organizations that are trying to manage two distinct stacks for applications and data will soon find themselves at a competitive disadvantage.</p>&#13;
<p>For the first few years of Kubernetes’ existence after its public launch in 2014, the maxim that it was not ready for data and stateful workloads was rarely questioned. An example of the prevailing wisdom can be found in this Kelsey Hightower <a href="https://oreil.ly/d4jRU">tweet</a> from 2018:</p>&#13;
<blockquote>&#13;
<p>Kubernetes has made huge improvements in the ability to run stateful workloads including databases and message queues, but I still prefer not to run them on <span class="keep-together">Kubernetes.</span></p>&#13;
</blockquote>&#13;
<p>Over the past few years, the tide has turned. Problem-solving engineers took this challenge from Kelsey and turned it into action. In some sense, the maturation of Kubernetes for stateful workloads was inevitable, as the demand was so great. Those of us who can remember arguments about why a database had to run on a bare-metal machine or why you should never deploy data infrastructure in containers can relate to this concern.</p>&#13;
<p>We’ve also learned that there is a huge difference between “never” and “not yet.” Compute, storage, networking are now considered commodities; why not data management? The value proposition of Kubernetes for reducing cost and simplifying application development means that the migration of data infrastructure onto Kubernetes was inevitable. The changes are not just in Kubernetes. As you will see, projects in data infrastructure have been changing as well.</p>&#13;
<section data-pdf-bookmark="Why We Wrote This Book" data-type="sect1"><div class="sect1" id="why_we_wrote_this_book">&#13;
<h1>Why We Wrote This Book</h1>&#13;
<p>We were caught up in the trend of moving stateful workloads to Kubernetes when our “day job” responsibilities at DataStax challenged us to consider how to deploy and operate Apache Cassandra in Kubernetes effectively. In the spirit of open source development, we sought out other practitioners who were attempting similar feats (and succeeding) with databases and other stateful workloads. We found a group of like-minded individuals and helped launch the <a href="https://oreil.ly/WGlmp">Data on Kubernetes Community</a> (DoKC) in 2020. DoKC is now an independent organization and has hosted well over 100 meetups and several in-person events. The <a href="https://oreil.ly/b1imM">variety of topics and presenters</a> in the DoKC meetup is evidence of a vibrant community, working collaboratively to establish standards and best practices. Most importantly, we are learning together, applying lessons from the past and supporting each other as we build something new.</p>&#13;
<p>As we participated in these meetups, a set of common themes began to emerge. We heard, again and again, the virtues of the PersistentVolume subsystem, the pros and cons of StatefulSets, the promise of the operator pattern for making database operations more manageable, and the early hints of ideas for new types of data management. Over time, we developed a strong conviction that this fledgling community of practitioners needed a place for all of the wisdom scattered across multiple presentations and blog posts to be gathered and distilled into a digestible form. This book is the result of that process.</p>&#13;
<p>Much work remains to be done in the area of cloud native data, and many areas need further exploration, including operators, machine learning, data APIs, declarative management of data sets, and many more. Our hope is that this book opens the gates for a flood of additional books, blogs, presentations, and learning resources.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Who Is This Book For?" data-type="sect1"><div class="sect1" id="who_is_this_book_forquestion_mark">&#13;
<h1>Who Is This Book For?</h1>&#13;
<p>The primary audience for this book comprises the developers and architects who are designing, building, and running applications in the cloud. If that describes you and you’re picking up this book, chances are you’ve heard the thundering herd of organizations adopting Kubernetes and have joined that trend or are at least considering it. However, you may have also heard the reservations about stateful workloads on Kubernetes and are looking for help in how to proceed. You’ve come to the right place! By reading this book you will gain the following:</p>&#13;
<ul>&#13;
<li><p>An understanding of basic Kubernetes resources and how they are used to compose data infrastructure</p></li>&#13;
<li><p>An appreciation for how tools like Helm and operators can automate the deployment and operations of data infrastructure on Kubernetes</p></li>&#13;
<li><p>The ability to evaluate and select data infrastructure technologies for use in your applications</p></li>&#13;
<li><p>The knowledge of how to integrate these data infrastructure technologies into your overall stack</p></li>&#13;
<li><p>A view toward emerging technologies that will enhance your Kubernetes-based applications in the years to come</p></li>&#13;
</ul>&#13;
<p>A smaller but no less important audience includes core Kubernetes developers and data infrastructure developers, many of whom we’ve met through the DoKC. We hope to create a common set of principles and best practices that we can use as a framework to drive improvements into the Kubernetes core as well as the data infrastructure built to run in Kubernetes. Together we can push the practice of data on Kubernetes forward.</p>&#13;
<p>For everyone, know that our objective in this book is to shoot straight. Where the technology is mature and solid, we’ll let you know, but there are also many areas where the technology is still emerging. We’ll make sure to highlight those areas where improvement is needed.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="How to Read This Book" data-type="sect1"><div class="sect1" id="how_to_read_this_book">&#13;
<h1>How to Read This Book</h1>&#13;
<p>This book is designed to be read from start to finish, especially by readers who are less experienced with Kubernetes. The first few chapters introduce Kubernetes terminology and concepts that are referenced throughout the remainder of the book as we discuss more advanced topics. Here’s how this book is organized:</p>&#13;
<dl>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch01.html#introduction_to_cloud_native_data_infra">Chapter 1, “Introduction to <span class="keep-together">Cloud Native Data</span> Infrastructure: Persistence, <span class="keep-together">Streaming, and Batch Analytics</span>”</a></dt>&#13;
<dd>This chapter lays out the goal of modernizing your cloud native applications by putting not only stateless but also stateful workloads on Kubernetes. Of course we would say this, but you really should start here, as we define key goals and terms to give all readers a level playing field. Specifically, we propose a definition for the term <em>cloud native data</em> and define principles for cloud native data infrastructure that we’ll use to measure technologies throughout the rest of the book.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch02.html#managing_data_storage_on_kubernetes">Chapter 2, “Managing Data Storage on Kubernetes”</a></dt>&#13;
<dd>In this chapter, we’ll look at one of the foundational areas for data infrastructure on Kubernetes: storage. We’ll begin with how storage works in containerized systems starting with Docker, then moving to Kubernetes and its PersistentVolume subsystem. We’ll discuss the various types of storage available including file, block, and object storage, and the trade-offs of using local versus remote storage solutions.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch03.html#databases_on_kubernetes_the_hard_way">Chapter 3, “Databases on Kubernetes the Hard Way”</a></dt>&#13;
<dd>This chapter introduces Kubernetes compute resources such as Pods, Deployments, and StatefulSets and walks you through the step-by-step process of deploying databases like MySQL and Apache Cassandra using these resources. You’ll learn some of the strengths and weaknesses of StatefulSets for managing distributed databases.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch04.html#automating_database_deployment_on_kuber">Chapter 4, “Automating Database Deployment <span class="keep-together">on Kubernetes</span> with Helm”</a></dt>&#13;
<dd>Continuing the themes of the previous chapter, we revisit the deployment of MySQL and Cassandra on Kubernetes, this time in a more automated fashion using the Helm package manager. You’ll also learn about Kubernetes resources that help with configuration including ConfigMaps and Secrets. We discuss the role of Helm in your overall DevOps process and CI/CD toolset and some of its shortcomings with respect to managing database operations.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch05.html#automating_database_management_on_kuber">Chapter 5, “Automating Database Management <span class="keep-together">on Kubernetes with Operators</span>”</a></dt>&#13;
<dd>This chapter concludes our sequence on database deployment by introducing the operator pattern and demonstrating how operators can help manage “day two” database operations. We’ll examine how operators extend the Kubernetes control plane to manage databases, using Vitess (MySQL) and Cass Operator (Apache Cassandra) as examples. Along the way, you’ll learn how to assess operators’ maturity and even how to build your own operators by using frameworks such as the Operator SDK.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch06.html#integrating_data_infrastructure_in_a_ku">Chapter 6, “Integrating Data Infrastructure <span class="keep-together">in a Kubernetes Stack</span>”</a></dt>&#13;
<dd>In this chapter, we begin to expand the focus beyond just deploying and operating databases to consider how databases and other data infrastructure can be incorporated in your overall application stack. We’ll look at a project called K8ssandra that integrates Apache Cassandra along with tools for managing monitoring, security, and database backups, and an API layer for easier data access.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch07.html#the_kubernetes_native_database">Chapter 7, “The Kubernetes Native Database”</a></dt>&#13;
<dd>At this point, we take a step back and summarize what you’ve learned about cloud native data management in the book’s first half and use that knowledge to consider the question, “What is a Kubernetes native database?” More than just a debate about industry buzzwords, this discussion is an important one for you who are involved in selecting data infrastructure and those developing that infrastructure.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch08.html#streaming_data_on_kubernetes">Chapter 8, “Streaming Data on Kubernetes”</a></dt>&#13;
<dd>Moving beyond persistence, we’ll start working through the rest of the data infrastructure, starting with streaming technologies. Moving and processing data in cloud native applications is just as prevalent as database persistence, but requires different strategies in deployment: connecting endpoints securely and building in default resilience and elasticity. In this chapter, Apache Pulsar and Apache Flink will be used to demonstrate those important practices to build.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch09.html#data_analytics_on_kubernetes">Chapter 9, “Data Analytics on Kubernetes”</a></dt>&#13;
<dd>Ironically, the needs for large-scale analytics deployments are part of the origin story of many of the methodologies we see used in Kubernetes today—namely, orchestration and resource management. Coming full circle, running analytics in Kubernetes is now a top priority in many organizations. We highlight changes in Apache Spark to give you a head start for your use case and look at the leading edge of analytics in Kubernetes with the Dask and Ray projects.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch10.html#machine_learning_and_other_emerging_use">Chapter 10, “Machine Learning and Other <span class="keep-together">Emerging Use Cases</span>”</a></dt>&#13;
<dd>The topics of AI and machine learning are already on the cutting edge within infrastructure. Projects that have started in the past few years could start in Kubernetes first, and it’s an interesting thing to consider. There are other types of projects thinking in terms of cloud native first and providing some directionality to the future of data. This chapter is meant to be a survey of those projects and offered broadly as ideas and methodologies to consider as you move forward with cloud native data.</dd>&#13;
<dt><a data-type="xref" data-xrefstyle="chap-num-title" href="ch11.html#migrating_data_workloads_to_kubernetes">Chapter 11, “Migrating Data Workloads to Kubernetes”</a></dt>&#13;
<dd>All the knowledge you’ve obtained in reading the book goes to waste if you don’t put it into practice. In this chapter, we highlight the key teachings of the previous chapters and propose a framework of people, process, and technology changes you can make to migrate your stateful workloads to Kubernetes successfully. We conclude with a vision of what your organization’s data infrastructure could look like in the near future.</dd>&#13;
</dl>&#13;
<p>The discipline of managing data on Kubernetes is an emerging one with a lot of change in particular areas. We acknowledge that this, like any technical book, represents a snapshot of available knowledge at a specific point in time—in this case, late 2022. The real danger of writing a book about a fast-moving topic is how quickly irrelevant the information can become.</p>&#13;
<p>To best address this reality, you will see a common formula applied in this book: we provide plenty of examples but stress the fundamentals. As we progress through the book, the technology we examine becomes progressively less mature. Rather than looking for the copy-and-paste answer or the one-size-fits-all architecture, we encourage you to extract the core tenets you can apply to your unique use cases.</p>&#13;
<p>In particular, since Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch02.html#managing_data_storage_on_kubernetes">2</a>–<a data-type="xref" data-xrefstyle="select:labelnumber" href="ch05.html#automating_database_management_on_kuber">5</a> address well-established topics, you’ll find more in-depth explanations and hands-on examples in these chapters. Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch08.html#streaming_data_on_kubernetes">8</a>–<a data-type="xref" data-xrefstyle="select:labelnumber" href="ch10.html#machine_learning_and_other_emerging_use">10</a> get into data infrastructure that is still experiencing quite a bit of change, at least in terms of deployment on Kubernetes. In these cases, we point more frequently to third-party learning resources so that you can be sure to have the most up-to-date experience. In the spirit of this book’s inception, we encourage you to share new resources you find with others so we can move forward together.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Conventions Used in This Book" data-type="sect1"><div class="sect1" id="_conventions_used_in_this_book">&#13;
<h1>Conventions Used in This Book</h1>&#13;
<p>The following typographical conventions are used in this book:</p>&#13;
<dl>&#13;
<dt><em>Italic</em></dt>&#13;
<dd>&#13;
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>&#13;
</dd>&#13;
<dt><code>Constant width</code></dt>&#13;
<dd>&#13;
<p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>&#13;
</dd>&#13;
<dt><strong><code>Constant width bold</code></strong></dt>&#13;
<dd>&#13;
<p>Shows commands or other text that should be typed literally by the user.</p>&#13;
</dd>&#13;
<dt><em><code>Constant width italic</code></em></dt>&#13;
<dd>&#13;
<p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>This element signifies a tip or suggestion.</p>&#13;
</div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This element signifies a general note.</p>&#13;
</div>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>This element indicates a warning or caution.</p>&#13;
</div>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Using Code Examples" data-type="sect1"><div class="sect1" id="_using_code_examples">&#13;
<h1>Using Code Examples</h1>&#13;
<!--PROD: Please reach out to author to find out if they will be uploading code examples to oreilly.com or their own site (e.g., GitHub). If there is no code download, delete this whole section. If there is, when you email digidist with the link, let them know what you filled in for title_title (should be as close to book title as possible, i.e., learning_python_2e). This info will determine where digidist loads the files.-->&#13;
<p>Supplemental material (code examples, exercises, etc.) is available for download at <a href="https://github.com/data-on-k8s-book/examples"><em class="hyperlink">https://github.com/data-on-k8s-book/examples</em></a>.</p>&#13;
<p>If you have a technical question or a problem using the code examples, please send email to <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a>.</p>&#13;
<p>This book is here to help you get your job done. In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require permission.</p>&#13;
<p>We appreciate, but generally do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em>Managing Cloud Native Data on Kubernetes</em> by Jeff Carpenter and Patrick McFadin (O’Reilly). Copyright 2023 Jeffrey Carpenter and Patrick McFadin, 978-1-098-11139-7.”</p>&#13;
<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="email" href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="O’Reilly Online Learning" data-type="sect1"><div class="sect1" id="_safari_books_online">&#13;
<h1>O’Reilly Online Learning</h1>&#13;
<div class="ormenabled" data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>For more than 40 years, <a class="orm:hideurl" href="https://oreilly.com"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>&#13;
</div>&#13;
<p>Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, visit <a class="orm:hideurl" href="https://oreilly.com"><em>https://oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="How to Contact Us" data-type="sect1"><div class="sect1" id="_how_to_contact_us">&#13;
<h1>How to Contact Us</h1>&#13;
<p>Please address comments and questions concerning this book to the publisher:</p>&#13;
<ul class="simplelist">&#13;
  <li>O’Reilly Media, Inc.</li>&#13;
  <li>1005 Gravenstein Highway North</li>&#13;
  <li>Sebastopol, CA 95472</li>&#13;
  <li>800-998-9938 (in the United States or Canada)</li>&#13;
  <li>707-829-0515 (international or local)</li>&#13;
  <li>707-829-0104 (fax)</li>&#13;
</ul>&#13;
<p class="pagebreak-before">We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a href="https://oreil.ly/cloud-native-data-Kubernetes"><em class="hyperlink">https://oreil.ly/cloud-native-data-Kubernetes</em></a>.</p>&#13;
<!--Don't forget to update the link above.-->&#13;
<p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical questions about this book.</p>&#13;
&#13;
<p>For news and information about our books and courses, visit <a href="https://oreilly.com"><em class="hyperlink">https://oreilly.com</em></a>.</p>&#13;
<p>Find us on LinkedIn: <a href="https://linkedin.com/company/oreilly-media"><em class="hyperlink">https://linkedin.com/company/oreilly-media</em></a>.</p>&#13;
<p>Follow us on Twitter: <a href="https://twitter.com/oreillymedia"><em class="hyperlink">https://twitter.com/oreillymedia</em></a>.</p>&#13;
<p>Watch us on YouTube: <a href="https://youtube.com/oreillymedia"><em class="hyperlink">https://youtube.com/oreillymedia</em></a>.</p>&#13;
</div></section>&#13;
<section data-pdf-bookmark="Acknowledgments" data-type="sect1"><div class="sect1" id="acknowledgments">&#13;
<h1>Acknowledgments</h1>&#13;
<p>Thanks go first of all to Jess Haberman, who believed in the concept of this book from our first conversation and fought to make it happen, and to our editor Jill Leonard for her continual encouragement and wise counsel.</p>&#13;
<p>One of the key features of this book is the inclusion of sidebars based on our conversations with expert technologists and practitioners. We’ve tried to let their words speak for themselves with as little editing as possible. With that, we offer up our heartfelt thanks to those who shared their time and insights with us: Rick Vasquez, Kiran Mova, Maciej Szulik, John Sanda, Deepthi Sigireddi, Umair Mufti, Irfan Ur Rehman, Dongxu (Ed) Huang, Jake Luciani, Jesse Anderson, Josh van Leeuwen, Holden Karau, Dean Wampler, Theofilos Papapanagiotou, Willem Pienaar, Xiaofan Luan, Josh Patterson, Adi Polak, and Craig McLuckie.</p>&#13;
<p>These experts have not only contributed their words, but also influenced the direction of our research and the choice of technologies we discuss here. Deepthi, Jesse, Umair, and Rick also did double duty as technical reviewers of the book. We also appreciate the insights of our other technical reviewers: Wei Deng, Ali Ok, Aaron Morton, and Noah Gift.</p>&#13;
<p>The Data on Kubernetes Community (DoKC) has been a huge inspiration for this effort, and we’re especially grateful to Bart Farrell, Demitrios Brinkmann, and Melissa Logan for connecting us with many other community members and for their encouragement and support. We’d like to give special acknowledgment to Evan Powell, who birthed the DoKC by finding Demetrios and funding the initial meetups. That was the spark that has lit the forge for so many good things to come.</p>&#13;
<p>Sam Ramji was a major influence on this book, not only by writing the foreword but also in challenging our thought processes by reminding us: “You have to do the work to have an opinion.” Sam was always willing to get on a call, make an introduction, or share ideas over a beer.</p>&#13;
<p>This book was born during the early days of a global pandemic and nurtured throughout seasons of uncertainty, challenge, and renewal, both on a global and personal level. We’re so very grateful for the support of many friends and family who walked with us through these times and reminded us of the power of questions like “How’s the book going?” or even just a simple “How are you doing?”</p>&#13;
</div></section>&#13;
</div></section></body></html>