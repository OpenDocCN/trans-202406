<html><head></head><body><section data-pdf-bookmark="Chapter 13. Fetching Remote Data" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch13">&#13;
<h1><span class="label">Chapter 13. </span>Fetching Remote Data</h1>&#13;
&#13;
&#13;
<p><a data-primary="remote data" data-type="indexterm" id="ix_remote_data_ch13"/>The ability to receive and process data in the browser, without refreshing a page, is one of JavaScript’s super powers. Real-time data trackers, chat applications, social media feed updates, and much more, are all made possible through JavaScript’s ability to make a request to a server and update content on the page. In this chapter, we’ll cover how to make and process those requests.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="AJAX" data-type="indexterm" id="idm45475144855608"/>You may also hear the term “AJAX,” which is an abbreviation for Asynchronous JavaScript and XML. Although originally coined in reference to retrieving XML, AJAX has become a generalized term for retrieving and sending data to a remote server from a web browser.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Requesting Remote Data with Fetch" data-type="sect1"><div class="sect1" id="fetch">&#13;
<h1>Requesting Remote Data with Fetch</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475144836040">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="remote data" data-secondary="fetching" data-type="indexterm" id="ix_remote_data_fetch"/>You need to request remote data from a server.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475144833144">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-type="indexterm" id="ix_fetch_api"/><a data-primary="web apps/APIs" data-secondary="Fetch API" data-type="indexterm" id="ix_web_apps_fetchapi"/><a data-primary="data" data-secondary="Fetch API to request" data-type="indexterm" id="ix_data_fetch"/>Use the Fetch API, which allows you to make requests and manipulate the response. To make a simple request, pass a URL as a <code>fetch</code> parameter, which returns the response as a promise. The following example requests the URL, parses the JSON response, and logs the response to the console:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</code><code class="p">;</code>&#13;
<code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">));</code></pre>&#13;
&#13;
<p>Alternately, use the <code>async/await</code> syntax with <code>fetch</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchRequest</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">fetchRequest</code><code class="p">();</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475144689736">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The Fetch API provides a means for sending and retrieving data from a remote source. When working in a web browser environment, this means that data can be retrieved  without refreshing the page. As a web user, you may experience these types of requests frequently. The Fetch API can be used to:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Load additional items in a social media feed</p>&#13;
</li>&#13;
<li>&#13;
<p>Form autocomplete suggestions</p>&#13;
</li>&#13;
<li>&#13;
<p>“Like” a social media post</p>&#13;
</li>&#13;
<li>&#13;
<p>Update form field values based on a previous response</p>&#13;
</li>&#13;
<li>&#13;
<p>Submit a form without navigating away from the page</p>&#13;
</li>&#13;
<li>&#13;
<p>Add an item to a shopping cart</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>As you may imagine, the list can go on and on.</p>&#13;
&#13;
<p><a data-primary="fetch() method" data-type="indexterm" id="idm45475144645800"/><a data-primary="parameters" data-secondary="fetch" data-type="indexterm" id="idm45475144645096"/>The  <code>fetch()</code> method accepts two parameters:</p>&#13;
<dl>&#13;
<dt><code>url</code> (mandatory)</dt>&#13;
<dd>&#13;
<p>The URL to which you are making a request</p>&#13;
</dd>&#13;
<dt><code>options</code></dt>&#13;
<dd>&#13;
<p>An object of options when making the request</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The possible <code>options</code> include:</p>&#13;
<dl>&#13;
<dt><code>body</code></dt>&#13;
<dd>&#13;
<p>The body content of a request</p>&#13;
</dd>&#13;
<dt><code>cache</code></dt>&#13;
<dd>&#13;
<p>The cache mode of the request (<code>default</code>, <code>no-store</code>, <code>reload</code>, <code>no-cache</code>, <code>force-cache</code>, or <code>only-if-cached</code>)</p>&#13;
</dd>&#13;
<dt><code>credentials</code></dt>&#13;
<dd>&#13;
<p>The request credentials of the request (<code>omit</code>, <code>same-origin</code>, or <code>include</code>)</p>&#13;
</dd>&#13;
<dt><code>headers</code></dt>&#13;
<dd>&#13;
<p>Headers included with  the request</p>&#13;
</dd>&#13;
<dt><code>integrity</code></dt>&#13;
<dd>&#13;
<p>A subresource integrity value, used for verify resources</p>&#13;
</dd>&#13;
<dt><code>keepalive</code></dt>&#13;
<dd>&#13;
<p>Set to <code>true</code> for the request to outlive the page</p>&#13;
</dd>&#13;
<dt><code>method</code></dt>&#13;
<dd>&#13;
<p>The request method (<code>GET</code>, <code>POST</code>, <code>PUT</code>, or <code>DELETE</code>)</p>&#13;
</dd>&#13;
<dt><code>mode</code></dt>&#13;
<dd>&#13;
<p>The mode of the request (<code>cors</code>, <code>no-cors</code>,  or <code>same-origin</code>)</p>&#13;
</dd>&#13;
<dt><code>redirect</code></dt>&#13;
<dd>&#13;
<p>Sets behavior for redirects (<code>follow</code>, <code>error</code>, or <code>manual</code>)</p>&#13;
</dd>&#13;
<dt><code>referrer</code></dt>&#13;
<dd>&#13;
<p>Sets the value of the referrer header (<code>about:client</code>, the current URL, or an empty string)</p>&#13;
</dd>&#13;
<dt><code>referrerPolicy</code></dt>&#13;
<dd>&#13;
<p>Specifies the referrer policy (<code>no-referrer</code>, <code>no-referrer-when-downgrade</code>, <code>same-origin</code>, <code>origin</code>, <code>strict-origin</code>, <code>origin-when-cross-origin</code>, <code>strict-origin-when-cross-origin</code>, or <code>unsafe-url</code>)</p>&#13;
</dd>&#13;
<dt><code>signal</code></dt>&#13;
<dd>&#13;
<p><code>AbortController</code> object to abort request</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>As shown in the previous example, only the <code>url</code> parameter is required. When passed only a URL, the <code>fetch</code> method will perform a <code>GET</code> request. The following example demonstrates how to use the options object:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
  <code class="nx">method</code><code class="o">:</code> <code class="s1">'GET'</code><code class="p">,</code>&#13;
  <code class="nx">mode</code><code class="o">:</code> <code class="s1">'cors'</code><code class="p">,</code>&#13;
  <code class="nx">credentials</code><code class="o">:</code> <code class="s1">'omit'</code><code class="p">,</code>&#13;
  <code class="nx">redirect</code><code class="o">:</code> <code class="s1">'follow'</code><code class="p">,</code>&#13;
  <code class="nx">referrerPolicy</code><code class="o">:</code> <code class="s1">'no-referrer'</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p><code>fetch</code> makes use of JavaScript promises. The initial promise returns a <code>Response</code> object, which contains the full HTTP response, including the  body, headers, status code, redirect information, cors type, and URL.  With the response returned, you can then use an additional parsing method to parse the body of the request. In the example, I’m using the <code>json()</code> method to parse the body as JSON. Here are the possible parsing methods:</p>&#13;
<dl>&#13;
<dt><code>arrayBuffer()</code></dt>&#13;
<dd>&#13;
<p>Parse the body as an <code>ArrayBuffer</code></p>&#13;
</dd>&#13;
<dt><code>blob()</code></dt>&#13;
<dd>&#13;
<p>Parse the body as a <code>Blob</code></p>&#13;
</dd>&#13;
<dt><code>json()</code></dt>&#13;
<dd>&#13;
<p>Parse the body as JSON</p>&#13;
</dd>&#13;
<dt><code>text()</code></dt>&#13;
<dd>&#13;
<p>Parse the body as a UTF-8 string</p>&#13;
</dd>&#13;
<dt><code>formData()</code></dt>&#13;
<dd>&#13;
<p>Parse the body as a <code>FormData()</code> object</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="async function, await keyword in" data-type="indexterm" id="idm45475144443832"/><a data-primary="await keyword" data-type="indexterm" id="idm45475144443128"/><a data-primary="functions" data-secondary="async" data-type="indexterm" id="idm45475144442456"/>When using <code>fetch</code>, you can handle errors based on the server’s status response. In <code>async/await</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchRequestWithError</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;=</code> <code class="mi">200</code> <code class="o">&amp;&amp;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">400</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="c1">// Handle server error</code>&#13;
    <code class="c1">// example: INTERNAL SERVER ERROR: 500 error</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">statusText</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code><code class="si">}</code><code class="sb"> error`</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p><a data-primary="try…catch block" data-type="indexterm" id="idm45475144438088"/><a data-primary="errors (Error object)" data-secondary="handling with fetch()" data-type="indexterm" id="ix_error_fetch"/>For more robust error handling, you can wrap the entire <code>fetch</code> request in a <code>try/catch</code> block, which will allow you to handle any additional errors:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchRequestWithError</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;=</code> <code class="mi">200</code> <code class="o">&amp;&amp;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">400</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// Handle server error</code>&#13;
      <code class="c1">// example: INTERNAL SERVER ERROR: 500 error</code>&#13;
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">statusText</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code><code class="si">}</code><code class="sb"> error`</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// Generic error handler</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Errors can be handled similarly when using the the JavaScript <code>then</code> promise syntax:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">)</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">response</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;=</code> <code class="mi">200</code> <code class="o">&amp;&amp;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">400</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">return</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// Handle server error</code>&#13;
      <code class="c1">// example: INTERNAL SERVER ERROR: 500 error</code>&#13;
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">statusText</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">response</code><code class="p">.</code><code class="nx">status</code><code class="si">}</code><code class="sb"> error`</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">})</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>&#13;
  <code class="p">}).</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// Generic error handler</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">error</code><code class="p">);</code>&#13;
  <code class="p">};</code></pre>&#13;
&#13;
<p><a data-primary="AJAX" data-type="indexterm" id="idm45475144217800"/>If you’ve worked with AJAX requests in the past, you may have used the <code>XMLHttpRequest</code> (XHR) method (covered in <a data-type="xref" href="#xhr">“Using XMLHttpRequest”</a>).  Due to its promise-based syntax, simpler syntax, and broad browser support, the Fetch API is now the recommended method for making these requests. <code>fetch</code> is supported in all modern browsers (Chrome, Edge, Firefox, Safari), however it is not supported in Internet Explorer. <a data-primary="IE (Internet Explorer)" data-type="indexterm" id="idm45475144080632"/><a data-primary="polyfills" data-type="indexterm" id="idm45475144079928"/>If your application needs to support older versions of Internet Explorer, you may choose to use XHR (<code>XMLHttpRequest</code>) or make use of a <a href="https://github.com/github/fetch">fetch polyfill</a> alongside a <a href="https://github.com/taylorhakes/promise-polyfill">promise polyfill</a>.&#13;
<a data-primary="" data-startref="ix_data_fetch" data-type="indexterm" id="idm45475144077128"/><a data-primary="" data-startref="ix_fetch_api" data-type="indexterm" id="idm45475144076120"/><a data-primary="" data-startref="ix_web_apps_fetchapi" data-type="indexterm" id="idm45475144075176"/><a data-primary="" data-startref="ix_error_fetch" data-type="indexterm" id="idm45475144074232"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using XMLHttpRequest" data-type="sect1"><div class="sect1" id="xhr">&#13;
<h1>Using XMLHttpRequest</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475144072280">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="XMLHttpRequest() (XHR) method" data-type="indexterm" id="ix_xmlhttpreq_remote_data"/><a data-primary="remote data" data-secondary="XMLHttpRequest to request data" data-type="indexterm" id="ix_remote_data_xmlhttpreq"/>Your application needs to request remote data while supporting older browsers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475144068600">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>XMLHttpRequest</code> (XHR) in place of <code>fetch</code>. The following is an XHR <code>GET</code> request, which mirrors the example demonstrated in <a data-type="xref" href="#fetch">“Requesting Remote Data with Fetch”</a>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY'</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">request</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">XMLHttpRequest</code><code class="p">();</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="s1">'GET'</code><code class="p">,</code> <code class="nx">url</code><code class="p">);</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">send</code><code class="p">();</code>&#13;
&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">request</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;=</code> <code class="mi">200</code> <code class="o">&amp;&amp;</code> <code class="nx">request</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">400</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// successful request logs the returned JSON data</code>&#13;
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">request</code><code class="p">.</code><code class="nx">response</code><code class="p">);</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="c1">// server error</code>&#13;
    <code class="c1">// example: INTERNAL SERVER ERROR: 500 error</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`</code><code class="si">${</code><code class="nx">request</code><code class="p">.</code><code class="nx">statusText</code><code class="si">}</code><code class="sb">: </code><code class="si">${</code><code class="nx">request</code><code class="p">.</code><code class="nx">status</code><code class="si">}</code><code class="sb"> error`</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// request error</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">onerror</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">request</code><code class="p">.</code><code class="nx">statusText</code><code class="p">);</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475144063112">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><code>XMLHttpRequest</code> is the original syntax for making remote data requests. Though XML is in the name, it can be used to request all sorts of data. In the previous example, I’m making a request for JSON data. <a data-primary="fetch() method" data-secondary="XMLHttpRequest()" data-type="indexterm" id="idm45475143952664"/>So how does <code>XMLHttpRequest</code> differ from <code>fetch</code>?</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>fetch</code> makes heavy use of JavaScript promises, while <code>XMLHttpRequest</code> is based around the  <code>XMLHttpRequest()</code> constructor function.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>XMLHttpRequest</code> is supported in all browsers, including older versions of Internet Explorer. <code>fetch</code> will not work without a polyfill (which is based on <code>XMLHttpRequest</code>) in  Internet Explorer 11 or older, as well as some versions of modern auto-updating browsers from 2017 or earlier.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>XMLHttpRequest</code> defaults to sending cookies to the server with each request, while <code>fetch</code> requires that the <code>credentials</code> option be explicitly set.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>XMLHttpRequest</code> supports tracking upload progress, while, at the time of writing, <code>fetch</code> only supports download progress.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>fetch</code> does not support timeouts, leaving the length of the request up to the user’s browser.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Though the rest of this chapter will make use of the modern <code>fetch</code> syntax, <code>XMLHttpRequest</code> continues to be a reasonable choice due to its browser support and differentiating features, particularly when working with legacy applications.<a data-primary="" data-startref="ix_remote_data_xmlhttpreq" data-type="indexterm" id="idm45475143939544"/><a data-primary="" data-startref="ix_xmlhttpreq_remote_data" data-type="indexterm" id="idm45475143938504"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Submitting a Form" data-type="sect1"><div class="sect1" id="idm45475143937288">&#13;
<h1>Submitting a Form</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475143936312">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="data" data-secondary="form" data-type="indexterm" id="ix_data_form2"/><a data-primary="forms" data-secondary="fetching remote data submissions" data-type="indexterm" id="ix_form_sub_remote"/><a data-primary="remote data" data-secondary="form submission" data-type="indexterm" id="ix_remote_data_form"/>You want to submit a form from the client.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475143930984">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="fetch() method" data-secondary="form submission" data-type="indexterm" id="idm45475143929816"/>Make a <code>POST</code> request of a <code>FormData</code> object, using <code>fetch</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">myForm</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'my-form'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">myForm</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">async</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">formData</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">myForm</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'post'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">formData</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
  <code class="nx">alert</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475143924712">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="POST request" data-type="indexterm" id="ix_post_req"/>In the example code, I am selecting an HTML form element using <code>getElementById</code> and storing the URL to <code>POST</code> the form to as a variable. In this case, I am POSTing the form to a local development server, as shown in <a data-type="xref" href="#form-server">Example 13-1</a>. I’ve then added an event listener to the form and prevented the default form submission behavior, so that I can instead perform a JavaScript <code>POST</code> request using <code>fetch</code>.</p>&#13;
&#13;
<p>The complete HTML Markup and JavaScript is as follows:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Form POST<code class="nt">&lt;/title&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;h1&gt;</code>Form POST HTML<code class="nt">&lt;/h1&gt;</code>&#13;
&#13;
    <code class="nt">&lt;form</code> <code class="na">id=</code><code class="s">"my-form"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"name"</code><code class="nt">&gt;</code>Name:<code class="nt">&lt;/label&gt;</code>&#13;
      <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"text"</code> <code class="na">id=</code><code class="s">"name"</code> <code class="na">name=</code><code class="s">"name"</code> <code class="nt">/&gt;</code>&#13;
&#13;
      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"mail"</code><code class="nt">&gt;</code>E-mail:<code class="nt">&lt;/label&gt;</code>&#13;
      <code class="nt">&lt;input</code> <code class="na">type=</code><code class="s">"email"</code> <code class="na">id=</code><code class="s">"mail"</code> <code class="na">name=</code><code class="s">"email"</code> <code class="nt">/&gt;</code>&#13;
&#13;
      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"msg"</code><code class="nt">&gt;</code>Message:<code class="nt">&lt;/label&gt;</code>&#13;
      <code class="nt">&lt;textarea</code> <code class="na">id=</code><code class="s">"message"</code> <code class="na">name=</code><code class="s">"message"</code><code class="nt">&gt;&lt;/textarea&gt;</code>&#13;
&#13;
      <code class="nt">&lt;button&gt;</code>Submit<code class="nt">&lt;/button&gt;</code>&#13;
    <code class="nt">&lt;/form&gt;</code>&#13;
&#13;
    <code class="nt">&lt;script&gt;</code>&#13;
      <code class="kr">const</code> <code class="nx">myForm</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'my-form'</code><code class="p">);</code>&#13;
      <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/'</code><code class="p">;</code>&#13;
&#13;
      <code class="nx">myForm</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">async</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
      <code class="kr">const</code> <code class="nx">formData</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">myForm</code><code class="p">);</code>&#13;
      <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
      <code class="nx">method</code><code class="o">:</code> <code class="s1">'post'</code><code class="p">,</code>&#13;
      <code class="nx">body</code><code class="o">:</code> <code class="nx">formData</code>&#13;
      <code class="p">});</code>&#13;
&#13;
      <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
      <code class="nx">alert</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>&#13;
      <code class="p">});</code>&#13;
&#13;
    <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
&#13;
<p><a data-primary="key/value pairs" data-type="indexterm" id="idm45475143771944"/><a data-primary="FormData object" data-type="indexterm" id="ix_formdata_object"/>JavaScript’s <code>FormData</code> provides a means for easily creating key/value pairs of all the form data. This works with text-based form elements, as demonstrated in the example, as well as with file uploads. First, use the <code>FormData</code> constructor:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">myForm</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'my-form'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">formData</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">myForm</code><code class="p">);</code></pre>&#13;
&#13;
<p>You may also manipulate the data contained in the <code>FormData</code> with some helpful <span class="keep-together">methods</span>:</p>&#13;
<dl>&#13;
<dt><code>FormData.append(key, value)</code> or <code>FormData.append(key, blob, filename)</code></dt>&#13;
<dd>&#13;
<p>Appends new data to the form</p>&#13;
</dd>&#13;
<dt><code>FormData.delete(key)</code></dt>&#13;
<dd>&#13;
<p>Deletes a field</p>&#13;
</dd>&#13;
<dt><code>FormData.set(key, value)</code></dt>&#13;
<dd>&#13;
<p>Appends new data, removing a duplicate key, if present</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Here is how you would add an additional field to the previous example:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">myForm</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'my-form'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">myForm</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'submit'</code><code class="p">,</code> <code class="nx">async</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">formData</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">myForm</code><code class="p">);</code>&#13;
  <code class="c1">// add a new field using FormData.append</code>&#13;
  <code class="nx">formData</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'user'</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'post'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">formData</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">result</code><code class="p">);</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>The body of the <code>POST</code> request will now be:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nx">name</code><code class="o">:</code> <code class="s1">'Adam'</code><code class="p">,</code>&#13;
  <code class="nx">email</code><code class="o">:</code> <code class="s1">'adam@example.com'</code><code class="p">,</code>&#13;
  <code class="nx">message</code><code class="o">:</code> <code class="s1">'Hello'</code><code class="p">,</code>&#13;
  <code class="nx">user</code><code class="o">:</code> <code class="s1">'true'</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>It is also possible to work with the form values, using the <code>get</code> and <code>has</code> methods:</p>&#13;
<dl>&#13;
<dt><code>FormData.get(key)</code></dt>&#13;
<dd>&#13;
<p>Gets the value of a specific key</p>&#13;
</dd>&#13;
<dt><code>FormData.has(key)</code></dt>&#13;
<dd>&#13;
<p>Checks for a value with a given key and returns a Boolean</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>While <code>FormData</code> is incredibly useful, it is not the only value type of a <code>POST</code> body.  The following types can be sent in a POST request:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A string</p>&#13;
</li>&#13;
<li>&#13;
<p>An encoded string, such as JSON or XML</p>&#13;
</li>&#13;
<li>&#13;
<p>A <code>URLSearchParams</code> object</p>&#13;
</li>&#13;
<li>&#13;
<p>A <code>Blob</code> or <code>BufferSource</code> of binary data</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In <a data-type="xref" href="#selection-list">“Populating a Selection List from the Server”</a> I will demonstrate how to send a JSON <code>POST</code> request with <code>fetch</code>.</p>&#13;
&#13;
<p>Finally, <a data-type="xref" href="#form-server">Example 13-1</a> is an example Node.js Express server that processes the request:</p>&#13;
<div data-type="example" id="form-server">&#13;
<h5><span class="label">Example 13-1. </span>Express form server example</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">express</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'express'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">formidable</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'formidable'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">cors</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'cors'</code><code class="p">);</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">express</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="nx">port</code> <code class="o">=</code> <code class="mi">8080</code><code class="p">;</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">cors</code><code class="p">());</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s1">'Example server for receiving JS POST requests'</code><code class="p">)</code>&#13;
<code class="p">);</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">post</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">form</code> <code class="o">=</code> <code class="nx">formidable</code><code class="p">();</code>&#13;
&#13;
  <code class="nx">form</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">fields</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">return</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'POST body:'</code><code class="p">,</code> <code class="nx">fields</code><code class="p">);</code>&#13;
    <code class="nx">res</code><code class="p">.</code><code class="nx">sendStatus</code><code class="p">(</code><code class="mi">200</code><code class="p">);</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="nx">port</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Example app listening at http://localhost:</code><code class="si">${</code><code class="nx">port</code><code class="si">}</code><code class="sb">`</code><code class="p">)</code>&#13;
<code class="p">);</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>We cover Express in detail in <a data-type="xref" href="ch21.html#ch21">Chapter 21</a>.<a data-primary="" data-startref="ix_remote_data_form" data-type="indexterm" id="idm45475143354936"/><a data-primary="" data-startref="ix_form_sub_remote" data-type="indexterm" id="idm45475143145928"/><a data-primary="" data-startref="ix_data_form2" data-type="indexterm" id="idm45475143145096"/><a data-primary="" data-startref="ix_formdata_object" data-type="indexterm" id="idm45475143144152"/><a data-primary="" data-startref="ix_post_req" data-type="indexterm" id="idm45475143143208"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Populating a Selection List from the Server" data-type="sect1"><div class="sect1" id="selection-list">&#13;
<h1>Populating a Selection List from the Server</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475143140824">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="lists" data-secondary="populating selection lists" data-type="indexterm" id="ix_lists_pop"/><a data-primary="forms" data-secondary="populating selection lists" data-type="indexterm" id="ix_forms_select_list"/><a data-primary="selection list population from server" data-type="indexterm" id="ix_select_list_pop"/><a data-primary="remote data" data-secondary="selection list population from server" data-type="indexterm" id="ix_remote_data_select_list"/>Based on a user’s actions with another form element, you want to populate a selection list with values.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475143134408">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="change event" data-type="indexterm" id="idm45475143133000"/><a data-primary="events" data-secondary="change" data-type="indexterm" id="idm45475143132296"/>Capture the <code>change</code> event for the form element:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">niceThings</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'nice-thing'</code><code class="p">);</code>&#13;
<code class="nx">niceThings</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// GET request and events go here</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p><a data-primary="formatting" data-secondary="JSON formatted strings" data-type="indexterm" id="idm45475143129032"/><a data-primary="JSON" data-secondary="formatted strings" data-type="indexterm" id="idm45475143119336"/><a data-primary="objects (Object type)" data-secondary="converting to JSON formatted strings" data-type="indexterm" id="idm45475143118424"/><a data-primary="strings (String object)" data-secondary="JSON formatted" data-type="indexterm" id="idm45475143117512"/>In the event handler function, make a <code>fetch</code> request as a <code>POST</code> with the form data as JSON:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">niceThings</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'nice-thing'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/select'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// perform GET request when select value changes</code>&#13;
<code class="nx">niceThings</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// object containing select value</code>&#13;
  <code class="kr">const</code> <code class="nx">selection</code> <code class="o">=</code> <code class="p">{</code>&#13;
    <code class="nx">niceThing</code><code class="o">:</code> <code class="nx">niceThings</code><code class="p">.</code><code class="nx">value</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="c1">// GET request to server</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'post'</code><code class="p">,</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json;charset=utf-8'</code>&#13;
    <code class="p">},</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">selection</code><code class="p">)</code>&#13;
  <code class="p">});</code>&#13;
&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Populate the selection list with the result:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">select</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'nicestuff'</code><code class="p">);</code>&#13;
&#13;
<code class="k">if</code> <code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">ok</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
  <code class="c1">// empty the select element</code>&#13;
  <code class="nx">select</code><code class="p">.</code><code class="nx">length</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>&#13;
  <code class="c1">// add a default display option with text and no value</code>&#13;
  <code class="nx">select</code><code class="p">.</code><code class="nx">options</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Option</code><code class="p">(</code><code class="s1">'--Please choose an option--'</code><code class="p">,</code> <code class="s1">''</code><code class="p">);</code>&#13;
  <code class="c1">// populate the select with the returned values</code>&#13;
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">result</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">select</code><code class="p">.</code><code class="nx">options</code><code class="p">[</code><code class="nx">select</code><code class="p">.</code><code class="nx">length</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Option</code><code class="p">(</code><code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">],</code> <code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">]);</code>&#13;
  <code class="p">}</code>&#13;
  <code class="c1">// display the select element</code>&#13;
  <code class="nx">select</code><code class="p">.</code><code class="nx">style</code><code class="p">.</code><code class="nx">display</code> <code class="o">=</code> <code class="s1">'block'</code><code class="p">;</code>&#13;
<code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
  <code class="c1">// if there's a problem fetching the data, display an error</code>&#13;
  <code class="nx">alert</code><code class="p">(</code><code class="s1">'Error'</code><code class="p">);</code>&#13;
  <code class="p">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475142982728">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="select element" data-type="indexterm" id="ix_select_elem"/><a data-primary="HTML5" data-secondary="select element" data-type="indexterm" id="ix_html5_select"/>Populating a <code>select</code> or other form element based on a choice made by the user is a common user interface interaction. Instead of populating a <code>select</code> element with many options, or building a set of 10 or 20 radio buttons, you can capture the user’s choice in another form element, query a server application based on the value, and build the other form elements based on the value—all without leaving the page.</p>&#13;
&#13;
<p><a data-type="xref" href="#creating_an_on-demand_select">Example 13-2</a> demonstrates a simple page that captures the change event for a select element, makes a fetch request with the value of the selected value, and populates a new selection list by parsing the returned data.  <a data-primary="change event" data-type="indexterm" id="idm45475142837112"/><a data-primary="events" data-secondary="change" data-type="indexterm" id="idm45475142836440"/>In the example, the data is returned as an array, and new options are created with the returned text having both an option label and option value. Before populating the <code>select</code> element, its length is set to 0. This is a quick and easy way to truncate the <code>select</code> element—removing all existing options and starting fresh.</p>&#13;
<div data-type="example" id="creating_an_on-demand_select">&#13;
<h5><span class="label">Example 13-2. </span>Creating an on-demand <code>select</code> list</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Select List<code class="nt">&lt;/title&gt;</code>&#13;
    <code class="nt">&lt;style&gt;</code>&#13;
      <code class="nf">#nicestuff</code> <code class="p">{</code>&#13;
        <code class="k">display</code><code class="o">:</code> <code class="nb">none</code><code class="p">;</code>&#13;
        <code class="k">margin</code><code class="o">:</code> <code class="m">10px</code> <code class="m">0</code><code class="p">;</code>&#13;
      <code class="p">}</code>&#13;
&#13;
      <code class="nt">label</code><code class="o">,</code>&#13;
      <code class="nt">legend</code> <code class="p">{</code>&#13;
        <code class="k">display</code><code class="o">:</code> <code class="nb">block</code><code class="p">;</code>&#13;
        <code class="k">font-size</code><code class="o">:</code> <code class="m">1.6rem</code><code class="p">;</code>&#13;
        <code class="k">font-weight</code><code class="o">:</code> <code class="m">700</code><code class="p">;</code>&#13;
        <code class="k">margin-bottom</code><code class="o">:</code> <code class="m">0.5rem</code><code class="p">;</code>&#13;
      <code class="p">}</code>&#13;
    <code class="nt">&lt;/style&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;h1&gt;</code>Select List<code class="nt">&lt;/h1&gt;</code>&#13;
&#13;
    <code class="nt">&lt;form</code> <code class="na">id=</code><code class="s">"my-form"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;label</code> <code class="na">for=</code><code class="s">"pet-select"</code><code class="nt">&gt;</code>Select a nice thing:<code class="nt">&lt;/label&gt;</code>&#13;
&#13;
      <code class="nt">&lt;select</code> <code class="na">name=</code><code class="s">"nicething"</code> <code class="na">id=</code><code class="s">"nice-thing"</code><code class="nt">&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;</code>--Please choose an option--<code class="nt">&lt;/option&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"birds"</code><code class="nt">&gt;</code>Birds<code class="nt">&lt;/option&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"flowers"</code><code class="nt">&gt;</code>Flowers<code class="nt">&lt;/option&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"sweets"</code><code class="nt">&gt;</code>Sweets<code class="nt">&lt;/option&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">"critters"</code><code class="nt">&gt;</code>Cute Critters<code class="nt">&lt;/option&gt;</code>&#13;
      <code class="nt">&lt;/select&gt;</code>&#13;
      <code class="nt">&lt;select</code> <code class="na">id=</code><code class="s">"nicestuff"</code><code class="nt">&gt;</code>&#13;
        <code class="nt">&lt;option</code> <code class="na">value=</code><code class="s">""</code><code class="nt">&gt;</code>--Please choose an option--<code class="nt">&lt;/option&gt;</code>&#13;
      <code class="nt">&lt;/select&gt;</code>&#13;
    <code class="nt">&lt;/form&gt;</code>&#13;
    <code class="nt">&lt;script&gt;</code>&#13;
    <code class="kr">const</code> <code class="nx">niceThings</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'nice-thing'</code><code class="p">);</code>&#13;
    <code class="kr">const</code> <code class="nx">select</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'nicestuff'</code><code class="p">);</code>&#13;
    <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/select'</code><code class="p">;</code>&#13;
&#13;
    <code class="c1">// perform GET request when select value changes</code>&#13;
    <code class="nx">niceThings</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// object containing select value</code>&#13;
    <code class="kr">const</code> <code class="nx">selection</code> <code class="o">=</code> <code class="p">{</code>&#13;
      <code class="nx">niceThing</code><code class="o">:</code> <code class="nx">niceThings</code><code class="p">.</code><code class="nx">value</code>&#13;
    <code class="p">};</code>&#13;
&#13;
    <code class="c1">// GET request to server</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
      <code class="nx">method</code><code class="o">:</code> <code class="s1">'post'</code><code class="p">,</code>&#13;
      <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json;charset=utf-8'</code>&#13;
      <code class="p">},</code>&#13;
      <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">selection</code><code class="p">)</code>&#13;
    <code class="p">});</code>&#13;
&#13;
    <code class="c1">// if fetch is successful</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">response</code><code class="p">.</code><code class="nx">ok</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
      <code class="c1">// empty the select element</code>&#13;
      <code class="nx">select</code><code class="p">.</code><code class="nx">length</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>&#13;
      <code class="c1">// add a default display option with text and no value</code>&#13;
      <code class="nx">select</code><code class="p">.</code><code class="nx">options</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Option</code><code class="p">(</code><code class="s1">'--Please choose an option--'</code><code class="p">,</code> <code class="s1">''</code><code class="p">);</code>&#13;
      <code class="c1">// populate the select with the returned values</code>&#13;
      <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">i</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="nx">i</code> <code class="o">&lt;</code> <code class="nx">result</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code> <code class="nx">i</code> <code class="o">+=</code> <code class="mi">1</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">select</code><code class="p">.</code><code class="nx">options</code><code class="p">[</code><code class="nx">select</code><code class="p">.</code><code class="nx">length</code><code class="p">]</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Option</code><code class="p">(</code><code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">],</code> <code class="nx">result</code><code class="p">[</code><code class="nx">i</code><code class="p">]);</code>&#13;
      <code class="p">}</code>&#13;
      <code class="c1">// display the select element</code>&#13;
      <code class="nx">select</code><code class="p">.</code><code class="nx">style</code><code class="p">.</code><code class="nx">display</code> <code class="o">=</code> <code class="s1">'block'</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="c1">// if there's a problem fetching the data, display an error</code>&#13;
      <code class="nx">alert</code><code class="p">(</code><code class="s1">'Error'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
&#13;
    <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre></div>&#13;
&#13;
<p>The example uses a Node application to populate the selection list, but could be written in any server-side programming language. Node is covered in detail in <a data-type="xref" href="part03.html#part3">Part III</a>.<a data-primary="" data-startref="ix_html5_select" data-type="indexterm" id="idm45475142823208"/><a data-primary="" data-startref="ix_select_elem" data-type="indexterm" id="idm45475142822296"/></p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">express</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'express'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">formidable</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'formidable'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">cors</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'cors'</code><code class="p">);</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">app</code> <code class="o">=</code> <code class="nx">express</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="nx">port</code> <code class="o">=</code> <code class="mi">8080</code><code class="p">;</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">use</code><code class="p">(</code><code class="nx">cors</code><code class="p">());</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s1">'Example server for receiving JS POST requests'</code><code class="p">)</code>&#13;
<code class="p">);</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">post</code><code class="p">(</code><code class="s1">'/select'</code><code class="p">,</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">form</code> <code class="o">=</code> <code class="nx">formidable</code><code class="p">();</code>&#13;
&#13;
  <code class="nx">form</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="nx">fields</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="k">return</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">fields</code><code class="p">.</code><code class="nx">niceThing</code> <code class="o">===</code> <code class="s1">'critters'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">([</code><code class="s1">'puppies'</code><code class="p">,</code> <code class="s1">'kittens'</code><code class="p">,</code> <code class="s1">'guinea pigs'</code><code class="p">]);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">fields</code><code class="p">.</code><code class="nx">niceThing</code> <code class="o">===</code> <code class="s1">'sweets'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">([</code><code class="s1">'licorice'</code><code class="p">,</code> <code class="s1">'cake'</code><code class="p">,</code> <code class="s1">'cookies'</code><code class="p">,</code> <code class="s1">'custard'</code><code class="p">]);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">fields</code><code class="p">.</code><code class="nx">niceThing</code> <code class="o">===</code> <code class="s1">'birds'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">([</code><code class="s1">'robin'</code><code class="p">,</code> <code class="s1">'mockingbird'</code><code class="p">,</code> <code class="s1">'finch'</code><code class="p">,</code> <code class="s1">'dove'</code><code class="p">]);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">fields</code><code class="p">.</code><code class="nx">niceThing</code> <code class="o">===</code> <code class="s1">'flowers'</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">([</code><code class="s1">'roses'</code><code class="p">,</code> <code class="s1">'lilys'</code><code class="p">,</code> <code class="s1">'daffodils'</code><code class="p">,</code> <code class="s1">'pansies'</code><code class="p">]);</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
      <code class="nx">res</code><code class="p">.</code><code class="nx">send</code><code class="p">([</code><code class="s1">'No Nice Things Found'</code><code class="p">]);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">app</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="nx">port</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Example app listening at http://localhost:</code><code class="si">${</code><code class="nx">port</code><code class="si">}</code><code class="sb">`</code><code class="p">)</code>&#13;
<code class="p">);</code></pre>&#13;
&#13;
<p>Progressively building form elements isn’t necessary in all applications, but it is a great way to ensure a more effective form in cases where the data can change, or the form is complex.<a data-primary="" data-startref="ix_remote_data_fetch" data-type="indexterm" id="idm45475142386120"/><a data-primary="" data-startref="ix_remote_data_select_list" data-type="indexterm" id="idm45475142385272"/><a data-primary="" data-startref="ix_forms_select_list" data-type="indexterm" id="idm45475142384392"/><a data-primary="" data-startref="ix_select_list_pop" data-type="indexterm" id="idm45475142292648"/><a data-primary="" data-startref="ix_lists_pop" data-type="indexterm" id="idm45475142291704"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Parsing Returned JSON" data-type="sect1"><div class="sect1" id="idm45475142290632">&#13;
<h1>Parsing Returned JSON</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475142289656">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JSON" data-secondary="parsing of returned" data-type="indexterm" id="ix_json_parse_return"/><a data-primary="remote data" data-secondary="parsing of returned JSON" data-type="indexterm" id="ix_remote_data_json"/>You want to safely create a JavaScript object from JSON. You also want to replace the numeric representation of true and false (1 and 0, respectively) with their Boolean counterparts (<code>true</code> and <code>false</code>).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475142284568">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="parse() method" data-secondary="JSON" data-type="indexterm" id="idm45475142283336"/>Parse the object with the <code>JSON.parse</code> capability. <a data-primary="reviver function" data-type="indexterm" id="idm45475142281848"/>To transform the numeric values to their Boolean counterparts, create a <em>reviver</em> function:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">jsonobj</code> <code class="o">=</code> <code class="s1">'{"test" : "value1", "test2" : 3.44, "test3" : 0}'</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">obj</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">jsonobj</code><code class="p">,</code> <code class="p">(</code><code class="nx">key</code><code class="p">,</code> <code class="nx">value</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">value</code> <code class="o">===</code> <code class="s1">'number'</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="nx">value</code> <code class="o">===</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">value</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nx">value</code> <code class="o">===</code> <code class="mi">1</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">value</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">obj</code><code class="p">.</code><code class="nx">test3</code><code class="p">);</code> <code class="c1">// false</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475142278968">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>To figure out how to create JSON, think about how you create an object literal and just translate it into a string (with some caveats).</p>&#13;
&#13;
<p>If the object is an array:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">arr</code> <code class="o">=</code> <code class="k">new</code> <code class="nb">Array</code><code class="p">(</code><code class="s2">"one"</code><code class="p">,</code><code class="s2">"two"</code><code class="p">,</code><code class="s2">"three"</code><code class="p">);</code></pre>&#13;
&#13;
<p>the JSON notation would be equivalent to the literal notation for the array:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">[</code><code class="s2">"one"</code><code class="p">,</code><code class="s2">"two"</code><code class="p">,</code><code class="s2">"three"</code><code class="p">];</code></pre>&#13;
&#13;
<p>Note the use of double quotes (<code>""</code>) rather than single, which are not allowed in JSON.</p>&#13;
&#13;
<p>If you’re working with an object:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">obj3</code> <code class="o">=</code> <code class="p">{</code>&#13;
   <code class="nx">prop1</code> <code class="o">:</code> <code class="s2">"test"</code><code class="p">,</code>&#13;
   <code class="nx">result</code> <code class="o">:</code> <code class="kc">true</code><code class="p">,</code>&#13;
   <code class="nx">num</code> <code class="o">:</code> <code class="mf">5.44</code><code class="p">,</code>&#13;
   <code class="nx">name</code> <code class="o">:</code> <code class="s2">"Joe"</code><code class="p">,</code>&#13;
   <code class="nx">cts</code> <code class="o">:</code> <code class="p">[</code><code class="mi">45</code><code class="p">,</code><code class="mi">62</code><code class="p">,</code><code class="mi">13</code><code class="p">]</code>&#13;
 <code class="p">};</code></pre>&#13;
&#13;
<p>the JSON notation would be:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">{</code><code class="s2">"prop1"</code><code class="o">:</code><code class="s2">"test"</code><code class="p">,</code><code class="s2">"result"</code><code class="o">:</code><code class="kc">true</code><code class="p">,</code><code class="s2">"num"</code><code class="o">:</code><code class="mf">5.44</code><code class="p">,</code><code class="s2">"name"</code><code class="o">:</code><code class="s2">"Joe"</code><code class="p">,</code><code class="s2">"cts"</code><code class="o">:</code><code class="p">[</code><code class="mi">45</code><code class="p">,</code><code class="mi">62</code><code class="p">,</code><code class="mi">13</code><code class="p">]}</code></pre>&#13;
&#13;
<p>Notice in JSON how the property names are in quotes, but the values are only quoted when they’re strings. In addition, if the object contains other objects, such as an array, it’s also transformed into its JSON equivalent. However, the object <em>cannot</em> contain methods. If it does, an error is thrown. JSON works with data only.</p>&#13;
&#13;
<p><a data-primary="stringify() method" data-type="indexterm" id="idm45475141826248"/><a data-primary="parse() method" data-secondary="JSON" data-type="indexterm" id="idm45475141825416"/>The JSON static object isn’t complex, as it only provides two methods: <code>stringify()</code> and <code>parse()</code>. The <code>parse()</code> method takes two arguments: a JSON-formatted string and an optional <code>reviver</code> function. <a data-primary="key/value pairs" data-type="indexterm" id="idm45475141782376"/>This function takes a key/value pair as parameters, and returns either the original value or a modified result.</p>&#13;
&#13;
<p><a data-primary="strings (String object)" data-secondary="JSON formatted" data-type="indexterm" id="idm45475141781256"/><a data-primary="formatting" data-secondary="JSON formatted strings" data-type="indexterm" id="idm45475141780280"/><a data-primary="JSON" data-secondary="formatted strings" data-type="indexterm" id="idm45475141779336"/>In the solution, the JSON-formatted string is an object with three properties: a string, a numeric, and a third property, which has a numeric value but is really a Boolean with a numeric representation—0 is false, 1 is true.</p>&#13;
&#13;
<p>To transform all 0, 1 values into <code>false</code>, <code>true</code>, a function is provided as the second argument to <code>JSON.parse()</code>. It checks each property of the object to see if it is a numeric. If it is, the function checks to see if the value is 0 or 1. If the value is 0, the return value is set to <code>false</code>; if 1, the return value is set to <code>true</code>; otherwise, the original value is returned.</p>&#13;
&#13;
<p><a data-primary="JSONP (JSON with padding)" data-type="indexterm" id="idm45475141774952"/>The ability to transform incoming JSON-formatted data is essential, especially if you’re processing the result of an AJAX request or JSONP response. You can’t always control the structure of the data you get from a service.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>There are restrictions on the JSON: strings must be double quoted, and there are no hexadecimal values and no tabs in strings.<a data-primary="" data-startref="ix_remote_data_json" data-type="indexterm" id="idm45475141772792"/><a data-primary="" data-startref="ix_json_parse_return" data-type="indexterm" id="idm45475141771816"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fetching and Parsing XML" data-type="sect1"><div class="sect1" id="idm45475141770616">&#13;
<h1>Fetching and Parsing XML</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475141769640">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="fetch() method" data-secondary="XML" data-type="indexterm" id="ix_fetch_xml"/><a data-primary="web apps/APIs" data-secondary="DomParser API" data-type="indexterm" id="ix_web_apps_domparser"/><a data-primary="XML" data-secondary="fetching and parsing of" data-type="indexterm" id="ix_xml_remote_data"/><a data-primary="remote data" data-secondary="XML, fetching and parsing" data-type="indexterm" id="ix_remote_data_xml"/>You need to retrieve a remote XML file and parse its contents.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475141763144">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="DomParser API" data-type="indexterm" id="ix_dom_parser"/>Use <code>fetch</code> along with the <code>DomParser</code> API, which provides the ability to parse XML from a string.</p>&#13;
&#13;
<p>First, you will need to use <code>fetch</code> to request the XML file. In this example I’m requesting the XML feed of the <em>New York Times</em>' home page:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchAndParse</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">fetchAndParse</code><code class="p">();</code></pre>&#13;
&#13;
<p>Next, use <code>DOMParser</code> to parse the returned XML string, and then use the DOM methods to query the document for data:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchAndParse</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="nx">parser</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DOMParser</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="nx">XMLDocument</code> <code class="o">=</code> <code class="nx">parser</code><code class="p">.</code><code class="nx">parseFromString</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code> <code class="s1">'text/xml'</code><code class="p">);</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">XMLDocument</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">fetchAndParse</code><code class="p">();</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475141693992">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When using <code>fetch</code> to retrieve XML, the document is returned as plain text. You can then use the <code>DOMParser</code> API to enable DOM methods to query the document and process the results.</p>&#13;
&#13;
<p><code>DOMParser</code> enables you to interact with the XML content using DOM querying methods such as <code>getElementsByTagName</code>. <code>DOMParser</code> requires two arguments. The first argument is the string to be parsed. The second argument is a <code>mimeType</code>, which specifies the document type. The <code>mimeType</code> options are:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>text/html</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>text/xml</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>application/xml</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>applicatiom/xhtml+html</code></p>&#13;
</li>&#13;
<li>&#13;
<p><code>image/svg+xml</code></p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The following example extends the XML parser to use DOM query selectors to output the names of the latest articles to a web page:<a data-primary="" data-startref="ix_remote_data_xml" data-type="indexterm" id="idm45475141609528"/><a data-primary="" data-startref="ix_xml_remote_data" data-type="indexterm" id="idm45475141608552"/><a data-primary="" data-startref="ix_dom_parser" data-type="indexterm" id="idm45475141607608"/><a data-primary="" data-startref="ix_fetch_xml" data-type="indexterm" id="idm45475141606664"/><a data-primary="" data-startref="ix_web_apps_domparser" data-type="indexterm" id="idm45475141605720"/></p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">(</code><code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml'</code><code class="p">;</code>&#13;
&#13;
  <code class="c1">// fetch and parse the XML document</code>&#13;
  <code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchAndParse</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
    <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
    <code class="kr">const</code> <code class="nx">parser</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">DOMParser</code><code class="p">();</code>&#13;
    <code class="kr">const</code> <code class="nx">XMLDocument</code> <code class="o">=</code> <code class="nx">parser</code><code class="p">.</code><code class="nx">parseFromString</code><code class="p">(</code><code class="nx">data</code><code class="p">,</code> <code class="s1">'text/xml'</code><code class="p">);</code>&#13;
    <code class="k">return</code> <code class="nx">XMLDocument</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="kd">function</code> <code class="nx">displayTitles</code><code class="p">(</code><code class="nx">xml</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// HTML element where the results will be displayed</code>&#13;
    <code class="c1">// the markup contains a ul with an id of "results"</code>&#13;
    <code class="kr">const</code> <code class="nx">listElem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'results'</code><code class="p">);</code>&#13;
    <code class="c1">// get the article titles</code>&#13;
    <code class="c1">// each is wrapped in a &lt;title&gt; tag within an &lt;item&gt; tag</code>&#13;
    <code class="kr">const</code> <code class="nx">titles</code> <code class="o">=</code> <code class="nx">xml</code><code class="p">.</code><code class="nx">querySelectorAll</code><code class="p">(</code><code class="s1">'item title'</code><code class="p">);</code>&#13;
    <code class="c1">// loop over each title in the XML; append its text content to the HTML list</code>&#13;
    <code class="nx">titles</code><code class="p">.</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">title</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="nx">listItem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'li'</code><code class="p">);</code>&#13;
      <code class="nx">listItem</code><code class="p">.</code><code class="nx">innerText</code> <code class="o">=</code> <code class="nx">title</code><code class="p">.</code><code class="nx">textContent</code><code class="p">;</code>&#13;
      <code class="nx">listElem</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">listItem</code><code class="p">);</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">xml</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetchAndParse</code><code class="p">();</code>&#13;
  <code class="nx">displayTitles</code><code class="p">(</code><code class="nx">xml</code><code class="p">);</code>&#13;
<code class="p">})();</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sending Binary Data and Loading into an Image" data-type="sect1"><div class="sect1" id="sending_binary_data">&#13;
<h1>Sending Binary Data and Loading into an Image</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475141601272">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="binary data, sending and loading into image" data-type="indexterm" id="ix_binary_data_image"/><a data-primary="remote data" data-secondary="sending binary data and loading into image" data-type="indexterm" id="ix_remote_data_binary"/><a data-primary="images (img element)" data-secondary="sending as binary data" data-type="indexterm" id="ix_image_binary_data"/>You want to request a server-side image as binary data.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475141399896">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="fetch() method" data-secondary="binary data request" data-type="indexterm" id="ix_fetch_binary"/><a data-primary="blob() response type" data-type="indexterm" id="idm45475141397480"/>Getting binary data via a <code>fetch</code> request is a matter of setting the response type to <em><code>blob</code></em> and then manipulating the data when returned. In the solution, the data is then converted and loaded into an <code>img</code> element:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Binary Data<code class="nt">&lt;/title&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;h1&gt;</code>Binary Data<code class="nt">&lt;/h1&gt;</code>&#13;
&#13;
    <code class="nt">&lt;img</code> <code class="na">id=</code><code class="s">"result"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;script&gt;</code>&#13;
      <code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchImage</code><code class="p">()</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'logo.png'</code><code class="p">;</code>&#13;
      <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
      <code class="kr">const</code> <code class="nx">blob</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">blob</code><code class="p">();</code>&#13;
&#13;
      <code class="c1">// add returned url to image element</code>&#13;
      <code class="kr">const</code> <code class="nx">img</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'result'</code><code class="p">);</code>&#13;
      <code class="nx">img</code><code class="p">.</code><code class="nx">src</code> <code class="o">=</code> <code class="nx">URL</code><code class="p">.</code><code class="nx">createObjectURL</code><code class="p">(</code><code class="nx">blob</code><code class="p">);</code>&#13;
      <code class="p">}</code>&#13;
&#13;
      <code class="nx">fetchImage</code><code class="p">();</code>&#13;
    <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475141197656">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>A benefit of the CORS specification is support for binary data (also known as <em>typed arrays</em>) in fetch requests. The key requirement to a binary request is to set the response type to one of the following:</p>&#13;
<dl>&#13;
<dt><code>arraybuffer</code></dt>&#13;
<dd>&#13;
<p>Fixed-length raw binary data buffer</p>&#13;
</dd>&#13;
<dt><code>blob</code></dt>&#13;
<dd>&#13;
<p>File-like immutable raw data</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In the solution, I used the <code>URL.createObjectURL()</code> method to convert the <code>blob</code> to a DOMString (generally mapped to JavaScript String) with the URL of the passed object. The URL is assigned to the <code>img</code> element’s <code>src</code> property.</p>&#13;
&#13;
<p>Of course, it would be just as simple to assign the URL of the PNG file to the <code>src</code> attribute in the first place. However, the ability to manipulate binary data is a necessity with various technologies, such as Web Workers and WebGL.<a data-primary="" data-startref="ix_remote_data_binary" data-type="indexterm" id="idm45475141348008"/><a data-primary="" data-startref="ix_binary_data_image" data-type="indexterm" id="idm45475141347032"/><a data-primary="" data-startref="ix_image_binary_data" data-type="indexterm" id="idm45475141346088"/><a data-primary="" data-startref="ix_fetch_binary" data-type="indexterm" id="idm45475141345144"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sharing HTTP Cookies Across Domains" data-type="sect1"><div class="sect1" id="sharing_cookies_cors">&#13;
<h1>Sharing HTTP Cookies Across Domains</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475141342760">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="cross-domain communication" data-type="indexterm" id="ix_cross-domain_comm"/><a data-primary="data" data-secondary="cookies" data-type="indexterm" id="ix_data_cookie2"/><a data-primary="client-server communication" data-secondary="sharing cookies across domains" data-type="indexterm" id="ix_client-server_cookies"/><a data-primary="cookies" data-type="indexterm" id="ix_cookie_share_http"/><a data-primary="HTTP" data-secondary="cookie sharing across domains" data-type="indexterm" id="ix_http_cookie_share"/><a data-primary="remote data" data-secondary="HTTP cookie sharing across domains" data-type="indexterm" id="ix_remote_data_http_cookie"/>You want to access a resource from another domain as a <em>credentialed</em> request, including HTTP cookies and any authentication information.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475141333784">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="credentialed requests" data-type="indexterm" id="idm45475141332344"/>Changes have to be made in both the client and the server applications to support credentialed requests. In the following example, the client application is served at <em>somedomain.com</em> while the server is at <em>api.example.com</em>. Because these are different domains, by default credentialed requests would not be shared from the client to the server.</p>&#13;
&#13;
<p>In the client, we have to test the <code>credentials</code> property on the <code>fetch</code> request:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">fetch</code><code class="p">(</code><code class="s1">'https://api.example.com'</code><code class="p">,</code> <code class="p">{</code>&#13;
  <code class="nx">credentials</code><code class="o">:</code> <code class="s2">"include"</code>&#13;
<code class="p">})</code></pre>&#13;
&#13;
<p>In the server, the <code>Access-Control-Allow-Controls</code> header value must be set to <code>true</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">http</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'http'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">Cookies</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'cookies'</code><code class="p">);</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">server</code> <code class="o">=</code> <code class="nx">http</code><code class="p">.</code><code class="nx">createServer</code><code class="p">((</code><code class="nx">req</code><code class="p">,</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// Set CORS headers</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s1">'Content-type'</code><code class="p">,</code> <code class="s1">'text/plain'</code><code class="p">);</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s1">'Access-Control-Allow-Origin'</code><code class="p">,</code> <code class="s1">'https://somedomain.com'</code><code class="p">);</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">setHeader</code><code class="p">(</code><code class="s1">'Access-Control-Allow-Credentials'</code><code class="p">,</code> <code class="kc">true</code><code class="p">);</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">cookies</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Cookies</code> <code class="p">(</code><code class="nx">req</code><code class="p">,</code> <code class="nx">res</code><code class="p">);</code>&#13;
  <code class="nx">cookies</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s2">"apple"</code><code class="p">,</code><code class="s2">"red"</code><code class="p">);</code>&#13;
&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">writeHead</code><code class="p">(</code><code class="mi">200</code><code class="p">);</code>&#13;
  <code class="nx">res</code><code class="p">.</code><code class="nx">end</code><code class="p">(</code><code class="s2">"Hello cross-domain"</code><code class="p">);</code>&#13;
&#13;
<code class="p">});</code>&#13;
&#13;
<code class="nx">server</code><code class="p">.</code><code class="nx">listen</code><code class="p">(</code><code class="mi">8080</code><code class="p">);</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>When using Express, I recommend using the <a href="https://oreil.ly/vNPPC">CORS middleware</a>. We cover Express in detail in <a data-type="xref" href="ch21.html#ch21">Chapter 21</a>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475141058920">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="CORS (Cross-Origin Resource Sharing)" data-type="indexterm" id="idm45475141057720"/>Sharing information across domains is referred to as Cross-Origin Resource Sharing or CORS. For security reasons, browsers restrict information shared across domains, such as cookies and credential headers. Being able to send HTTP cookies or send authentication headers across domains is possible by configuring CORS extension, as long as both the client and the server signal agreement.</p>&#13;
&#13;
<p><a data-primary="remote data" data-secondary="XMLHttpRequest to request data" data-type="indexterm" id="idm45475141056264"/><a data-primary="withCredentials property" data-type="indexterm" id="idm45475141055128"/><a data-primary="XMLHttpRequest() (XHR) method" data-type="indexterm" id="idm45475141054488"/>If using <code>XMLHttpRequest</code> on the client in place of <code>fetch</code>, set the <code>withCredentials</code> property:<a data-primary="" data-startref="ix_remote_data_http_cookie" data-type="indexterm" id="idm45475141052392"/><a data-primary="" data-startref="ix_cookie_share_http" data-type="indexterm" id="idm45475141051320"/><a data-primary="" data-startref="ix_http_cookie_share" data-type="indexterm" id="idm45475141050376"/><a data-primary="" data-startref="ix_client-server_cookies" data-type="indexterm" id="idm45475141049432"/><a data-primary="" data-startref="ix_cross-domain_comm" data-type="indexterm" id="idm45475141048472"/><a data-primary="" data-startref="ix_data_cookie2" data-type="indexterm" id="idm45475141047528"/></p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">request</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">XMLHttpRequest</code><code class="p">();</code>&#13;
&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">onreadystatechange</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">if</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">readyState</code> <code class="o">==</code> <code class="mi">4</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">status</code><code class="p">);</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">status</code> <code class="o">==</code> <code class="mi">200</code><code class="p">)</code> <code class="p">{</code>&#13;
            <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'result'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">responseText</code><code class="p">;</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">};</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="s1">'GET'</code><code class="p">,</code><code class="s1">'http://localhost:8080/'</code><code class="p">);</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">withCredentials</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
<code class="nx">request</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Websockets to Establish a Two-Way Communication Between Client and Server" data-type="sect1"><div class="sect1" id="establishing_two_way_communication">&#13;
<h1>Using Websockets to Establish a Two-Way Communication Between Client and Server</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475140939992">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="client-server communication" data-secondary="bidirectional" data-type="indexterm" id="ix_client-serv_bi-direct"/><a data-primary="bidirectional communication, client-server" data-type="indexterm" id="ix_bi-direct_comm"/><a data-primary="client-server communication" data-secondary="with Websockets" data-secondary-sortas="Websockets" data-type="indexterm" id="ix_client-server_comm"/><a data-primary="WebSockets" data-type="indexterm" id="ix_websockets"/><a data-primary="remote data" data-secondary="WebSockets for client-server communication" data-type="indexterm" id="ix_remote_data_websockets"/>You want to initiate two-way, real-time communication between a server and web page client.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475140932568">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="HTTP" data-secondary="mixed content security issue" data-type="indexterm" id="idm45475140931160"/><a data-primary="security issues" data-secondary="mixed content (HTTP and HTTPS)" data-type="indexterm" id="idm45475140930168"/>WebSockets allows you to support bidirectional communication between the client and server. The client creates a new WebSockets object, passing in the URI for the WebSockets server. Notice that the <code>ws:</code> protocol is used in place of <code>http</code> or <code>https</code>. When the client gets a message, it converts the message text to an object, retrieves the number counter, increments it, and then uses it in the object’s string member.</p>&#13;
&#13;
<p>In the following example, the client print outs every other number, starting with 2. State is maintained between the client and server by passing the string to be printed out within the message:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Using Websockets<code class="nt">&lt;/title&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;h1&gt;</code>Using Websockets<code class="nt">&lt;/h1&gt;</code>&#13;
&#13;
    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"output"</code><code class="nt">&gt;&lt;/div&gt;</code>&#13;
    <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>&#13;
      <code class="kr">const</code> <code class="nx">socket</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">WebSocket</code><code class="p">(</code><code class="s1">'ws://localhost:8080'</code><code class="p">);</code>&#13;
      <code class="nx">socket</code><code class="p">.</code><code class="nx">onmessage</code> <code class="o">=</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="kr">const</code> <code class="nx">msg</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">);</code>&#13;
        <code class="nx">msg</code><code class="p">.</code><code class="nx">counter</code> <code class="o">=</code> <code class="nb">Number</code><code class="p">(</code><code class="nx">msg</code><code class="p">.</code><code class="nx">counter</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code>&#13;
        <code class="nx">msg</code><code class="p">.</code><code class="nx">strng</code> <code class="o">+=</code> <code class="err">`</code><code class="nx">$</code><code class="p">{</code><code class="nx">msg</code><code class="p">.</code><code class="nx">counter</code><code class="p">}</code><code class="o">-</code><code class="err">`</code><code class="p">;</code>&#13;
        <code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="err">`</code><code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code> <code class="nx">$</code><code class="p">{</code><code class="nx">msg</code><code class="p">.</code><code class="nx">strng</code><code class="p">}</code> <code class="o">&lt;</code><code class="err">/p&gt;`;</code>&#13;
        <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'output'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="nx">html</code><code class="p">;</code>&#13;
        <code class="nx">socket</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">msg</code><code class="p">));</code>&#13;
      <code class="p">};</code>&#13;
    <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
&#13;
<p>For the server, I’m using the <code>ws</code> Node module. Once the server is created, it starts the communication with the client by sending through a JavaScript object with two members: a number counter and a string. The object must first be converted to string. The code listens for both an incoming message and a <code>close</code> event. When it gets an incoming message, it increments the counter and sends the object:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">var</code> <code class="nx">wsServer</code> <code class="o">=</code> <code class="nx">require</code><code class="p">(</code><code class="s1">'ws'</code><code class="p">).</code><code class="nx">Server</code><code class="p">;</code>&#13;
<code class="kd">var</code> <code class="nx">wss</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">wsServer</code><code class="p">({</code><code class="nx">port</code><code class="o">:</code><code class="mi">8001</code><code class="p">});</code>&#13;
<code class="nx">wss</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'connection'</code><code class="p">,</code> <code class="p">(</code><code class="kd">function</code> <code class="p">(</code><code class="nx">conn</code><code class="p">)</code> <code class="p">{</code>&#13;
&#13;
    <code class="c1">// object being passed back and forth between</code>&#13;
    <code class="c1">// client and server</code>&#13;
    <code class="kd">var</code> <code class="nx">counter</code> <code class="o">=</code> <code class="p">{</code><code class="nx">counter</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="nx">strng</code><code class="o">:</code> <code class="s1">''</code><code class="p">};</code>&#13;
&#13;
    <code class="c1">// send first communication to client</code>&#13;
    <code class="nx">conn</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">counter</code><code class="p">));</code>&#13;
&#13;
    <code class="c1">// on response back</code>&#13;
    <code class="nx">conn</code><code class="p">.</code><code class="nx">on</code><code class="p">(</code><code class="s1">'message'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">message</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="kd">var</code> <code class="nx">ct</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">message</code><code class="p">);</code>&#13;
        <code class="nx">ct</code><code class="p">.</code><code class="nx">counter</code> <code class="o">=</code> <code class="nb">parseInt</code><code class="p">(</code><code class="nx">ct</code><code class="p">.</code><code class="nx">counter</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">;</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="nx">ct</code><code class="p">.</code><code class="nx">counter</code> <code class="o">&lt;</code> <code class="mi">100</code><code class="p">)</code> <code class="p">{</code>&#13;
           <code class="nx">conn</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">ct</code><code class="p">));</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
<code class="p">}));</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475140764680">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Bidirectional communication, also known as <em>full-duplex</em> communication, is two-way communication that can occur at the same time. Think of it as a two-way road, with traffic going both ways. All modern browsers support the WebSockets specification, and as you can see, it’s extremely easy to use.</p>&#13;
&#13;
<p>The advantage to WebSockets, other than being unbelievably easy to work with in browsers, is its ability to traverse both proxies and firewalls, something that isn’t trivial or even possible with other bidirectional communication techniques, such as long polling. And to ensure that applications are secure, user agents such as Chrome and Firefox prohibit mixed content (i.e., using both HTTP and HTTPS).</p>&#13;
&#13;
<p>WebSockets supports binary data, as well as text. And as the examples demonstrated, you can transmit JSON by calling <code>JSON.stringify()</code> on the object before sending, and <code>JSON.parse()</code> on the string in the receiving end.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45475140545304">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>See the website for more information on <a href="https://www.websocket.org">WebSockets</a>.<a data-primary="" data-startref="ix_remote_data_websockets" data-type="indexterm" id="idm45475140543160"/><a data-primary="" data-startref="ix_client-server_comm" data-type="indexterm" id="idm45475140542136"/><a data-primary="" data-startref="ix_websockets" data-type="indexterm" id="idm45475140541192"/><a data-primary="" data-startref="ix_bi-direct_comm" data-type="indexterm" id="idm45475140540248"/><a data-primary="" data-startref="ix_client-serv_bi-direct" data-type="indexterm" id="idm45475140539304"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Long Polling a Remote Data Source" data-type="sect1"><div class="sect1" id="idm45475140538088">&#13;
<h1>Long Polling a Remote Data Source</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475140537112">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="polling" data-type="indexterm" id="ix_polling2"/><a data-primary="errors (Error object)" data-secondary="long polling" data-type="indexterm" id="ix_error_polling"/><a data-primary="client-server communication" data-secondary="long polling" data-type="indexterm" id="ix_client-serv_poll"/><a data-primary="long polling a remote data source" data-type="indexterm" id="ix_long_polling_remote"/><a data-primary="remote data" data-secondary="long polling a remote data source" data-type="indexterm" id="ix_remote_data_long_poll"/>You would like to keep a connection open with a server so that the client is immediately updated with new information, but the server does not use WebSockets.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475140529720">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="fetch() method" data-secondary="long polling" data-type="indexterm" id="ix_fetch_poll"/>Use long polling, a technique where the client maintains a connection to the server by using an asynchronous <code>fetch</code> function that calls itself after a response. At its most basic, client-side long polling looks like this:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">longPoll</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
  <code class="c1">// if message received, log response to console and call polling function</code>&#13;
  <code class="kr">const</code> <code class="nx">message</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">);</code>&#13;
  <code class="nx">await</code> <code class="nx">longPoll</code><code class="p">();</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">longPoll</code><code class="p">();</code></pre>&#13;
&#13;
<p>This can be improved by adding some error handling, which when an error is received will wait a specified amount of time and then attempt to poll the server:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="s1">'http://localhost:8080/'</code><code class="p">;</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">longPoll</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="c1">// if message received, log response to console and call polling function</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
    <code class="kr">const</code> <code class="nx">message</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">response</code><code class="p">.</code><code class="nx">text</code><code class="p">();</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">message</code><code class="p">);</code>&#13;
    <code class="nx">await</code> <code class="nx">longPoll</code><code class="p">();</code>&#13;
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// if fetch returns an error, wait 1 second and try again</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="sb">`Request failed </code><code class="si">${</code><code class="nx">error</code><code class="si">}</code><code class="sb">`</code><code class="p">);</code>&#13;
    <code class="nx">await</code> <code class="k">new</code> <code class="nb">Promise</code><code class="p">(</code><code class="nx">resolve</code> <code class="o">=&gt;</code> <code class="nx">setTimeout</code><code class="p">(</code><code class="nx">resolve</code><code class="p">,</code> <code class="mi">1000</code><code class="p">));</code>&#13;
    <code class="nx">await</code> <code class="nx">longPoll</code><code class="p">();</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">longPoll</code><code class="p">();</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475140703656">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Long polling a server involves making a request and maintaining a connection to that server until a response is sent. Once the client receives the response, it immediately reconnects to the server and waits for a new response. The process can be broken down in this way:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Client sends request to the server.</p>&#13;
</li>&#13;
<li>&#13;
<p>Client stays connected to server while it waits for a response.</p>&#13;
</li>&#13;
<li>&#13;
<p>Server sends a response to the client.</p>&#13;
</li>&#13;
<li>&#13;
<p>Client reconnects to the server and the process repeats itself.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>I find that a chat program is a helpful way to think about long polling. Imagine a chat program where we have two users who are chatting with each other, Riley and Harlow. Each of them is connected to a the server. When Riley sends a message, the server sends a response to Harlow’s browser, which immediately reconnects and waits for the next message.</p>&#13;
&#13;
<p>The limitation of long polling is in the number of open connections that the server can maintain. Node was designed to handle many concurrent connections, while some languages have limitations. All languages are limited by the hardware of the server itself. <a data-primary="" data-startref="ix_remote_data_ch13" data-type="indexterm" id="idm45475140365496"/><a data-primary="" data-startref="ix_remote_data_long_poll" data-type="indexterm" id="idm45475140364520"/><a data-primary="" data-startref="ix_long_polling_remote" data-type="indexterm" id="idm45475140363560"/><a data-primary="" data-startref="ix_client-serv_poll" data-type="indexterm" id="idm45475140362616"/><a data-primary="" data-startref="ix_error_polling" data-type="indexterm" id="idm45475140361672"/><a data-primary="" data-startref="ix_fetch_poll" data-type="indexterm" id="idm45475140360728"/><a data-primary="" data-startref="ix_polling2" data-type="indexterm" id="idm45475140359784"/>Though long polling is a simple and effective method maintaining a connection,  WebSockets (as covered in <a data-type="xref" href="#establishing_two_way_communication">“Using Websockets to Establish a Two-Way Communication Between Client and Server”</a>) is a more efficient means of two-way communication between the client and server.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>