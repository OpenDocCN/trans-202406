<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Applications, Package Management, &#10;and Containers"><div class="chapter" id="running-apps">
<h1><span class="label">Chapter 6. </span>Applications, Package Management, 
<span class="keep-together">and Containers</span></h1>


<p><a data-type="indexterm" data-primary="applications" data-secondary="terminology" id="idm45805434223280"/>In this chapter, we talk about applications in Linux. Sometimes, the term
<em>application</em> (or simply <em>app</em>) is used interchangeably with <em>program</em>, <em>binary</em>,
or <em>executable</em>. We’ll explain the differences between these terms and
initially will be focusing on terminology, including the definition of applications
and packages.</p>

<p>We discuss how Linux starts up and brings all the services we depend on into being.
This is also known as the <em>boot process</em>. We will focus on init systems,
specifically on the de-facto standard, the <code>systemd</code> ecosystem.</p>

<p>We then move on to package management, where we first review the application
supply chain in general terms and see what the different moving parts are about.
Then, to give you some context about existing mechanisms
and challenges, we focus on how apps were traditionally distributed and installed.
We discuss package management in traditional Linux distros,
from Red Hat to Debian-based systems, and also have a peek at
programming language–specific package managers such as Python or Rust.</p>

<p>In the next part of the chapter, we focus on containers: what they are and
how they work. We’ll review the building blocks of containers, what
tooling you have available, and good practices around using containers.</p>

<p>To round off this chapter, we look at modern ways to manage Linux apps,
especially in desktop environments. Most of those modern package manager
solutions are also making use of containers in some form or another.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="app-greeter">
<h5>Running Example: greeter</h5>
<p>To demonstrate certain technologies in this chapter, we’ll use a running example
called <code>greeter</code>. It’s a simple shell script that echoes the name provided or
a fallback greeting if nothing is provided.</p>

<p>If you want to follow along, now is a good time to paste the following bash
script into a file called <em>greeter.sh</em>. Make it executable using <code>chmod 750 greeter.sh</code>
(and if you don’t recall what this means, read up on it in <a data-type="xref" href="ch04.xhtml#file-permissions">“File Permissions”</a>):</p>

<pre data-type="programlisting" data-code-language="shell"><code class="ch">#!/usr/bin/env bash</code>

<code class="nb">set</code> -o errexit
<code class="nb">set</code> -o errtrace
<code class="nb">set</code> -o pipefail

<code class="nv">name</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="nv">1</code><code class="si">}</code><code class="s2">"</code>

<code class="k">if</code> <code class="o">[</code> -z <code class="s2">"</code><code class="nv">$name</code><code class="s2">"</code> <code class="o">]</code>
<code class="k">then</code>
  <code class="nb">printf</code> <code class="s2">"You are awesome!\n"</code>
<code class="k">else</code>
  <code class="nb">printf</code> <code class="s2">"Hello %s, you are awesome!\n"</code> <code class="si">${</code><code class="nv">name</code><code class="si">}</code>
<code class="k">fi</code></pre>
</div></aside>

<p>And now, without further ado, let’s see what an application is and what
other related terms there are.</p>






<section data-type="sect1" data-pdf-bookmark="Basics"><div class="sect1" id="apps-basics">
<h1>Basics</h1>

<p>Before we get into the nitty-gritty details of application management, init systems,
and containers, let’s start with relevant definitions for this chapter and beyond.
The reason why we only now go into details concerning apps is that there are a
number of prerequisites (such as the Linux kernel, shell, filesystems, and security aspects)
that you need to fully understand apps, and now that we’re in a position to
build on what we’ve learned so far, we can tackle apps:</p>
<dl>
<dt>Program</dt>
<dd>
<p><a data-type="indexterm" data-primary="program, defined" id="idm45805434181952"/>This is usually either a binary file or a shell script that Linux can load
into memory and execute. Another way to refer to this entity is <em>executable</em>.
The type of the executable determines what exactly takes care of running it—for example, a shell (see <a data-type="xref" href="ch03.xhtml#shells">“Shells”</a>) would interpret and execute a shell script.</p>
</dd>
<dt>Process</dt>
<dd>
<p><a data-type="indexterm" data-primary="process" data-secondary="defined" id="idm45805434178464"/>A running entity based on a program, loaded into main memory and either
using the CPU or I/O, when not sleeping. See also <a data-type="xref" href="ch02.xhtml#kernel-process-management">“Process Management”</a>
and <a data-type="xref" href="ch03.xhtml#shells-scripting">Chapter 3</a>.</p>
</dd>
<dt>Daemon</dt>
<dd>
<p><a data-type="indexterm" data-primary="daemon" id="idm45805434174576"/>Short for <em>daemon process</em>, sometimes called <em>service</em>, this is a background process
that provides a certain function to other processes. For example, a printer
daemon allows you to print. There are also daemons for web services, logging,
time, and many more utilities you rely on on a daily basis.</p>
</dd>
<dt>Application</dt>
<dd>
<p><a data-type="indexterm" data-primary="applications" data-secondary="defined" id="idm45805434171440"/>A program including its dependencies. Usually a substantial program, including
a user interface. We usually associate the term <em>application</em> with the
entire life cycle of a program, its configuration, and its data: from finding
and installing to upgrading to removing it.</p>
</dd>
<dt>Package</dt>
<dd>
<p><a data-type="indexterm" data-primary="package, defined" id="idm45805434136912"/>A file that contains programs and configurations; used to distribute software
applications.</p>
</dd>
<dt>Package manager</dt>
<dd>
<p>A program that takes a package as an input and, based on its content and
the user instruction, installs it, upgrades it, or removes it from a Linux
environment.</p>
</dd>
<dt>Supply Chain</dt>
<dd>
<p><a data-type="indexterm" data-primary="supply chain" data-secondary="defined" id="idm45805434133600"/>A collection of software producers and distributors that enable you to
find and use applications based on packages; see <a data-type="xref" href="#supply-chain">“Linux Application Supply Chains”</a> for details.</p>
</dd>
<dt>Booting</dt>
<dd>
<p><a data-type="indexterm" data-primary="booting, defined" id="idm45805434130368"/>The startup sequence in Linux that involves hardware and operating system
initialization steps, including loading the kernel and launching service (or
daemon) programs with the goal to bring Linux into a state that it can be used;
see <a data-type="xref" href="#linux-boot">“The Linux Startup Process”</a> for details.</p>
</dd>
</dl>

<p>Equipped with these high-level definitions, we quite literally start at the
beginning: let’s have a look at how Linux starts up and how all the daemons
get launched so that we can use Linux to do our work.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Linux Startup Process"><div class="sect1" id="linux-boot">
<h1>The Linux Startup Process</h1>

<p><a data-type="indexterm" data-primary="boot process" id="ix_ch06-asciidoc0"/>The Linux <a href="https://oreil.ly/fbnk3">boot process</a> is
typically a multiphase effort in which hardware and the kernel work together.</p>

<p>In <a data-type="xref" href="#fig-boot-process">Figure 6-1</a>, you can see the boot process end to end, with the
following five steps:</p>

<figure><div id="fig-boot-process" class="figure">
<img src="Images/lmlx_0601.png" alt="lmlx 0601" width="600" height="384"/>
<h6><span class="label">Figure 6-1. </span>The Linux startup process</h6>
</div></figure>
<ol>
<li>
<p><a data-type="indexterm" data-primary="UEFI (Unified Extensible Firmware Interface)" id="idm45805434120096"/>In modern environments, the <a href="https://uefi.org">Unified Extensible Firmware Interface</a>
(UEFI) spec defines the boot configuration (stored in NVRAM) and the boot
loader. In older systems, in this step, after the Power On Self Test (POST) is
completed, the Basic I/O System (BIOS; see <a data-type="xref" href="ch02.xhtml#def-bios">“The BIOS and UEFI”</a>) would initialize hardware
(managing I/O ports and interrupts) and hand over control to the boot loader.</p>
</li>
<li>
<p>The boot loader has one goal: to bootstrap the kernel. Depending on the boot
medium, the details may differ slightly. There are a range of boot
loader options, both current (e.g., GRUB 2, systemd-boot, SYSLINUX, rEFInd) and legacy (e.g., LILO, GRUB 1).</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="kernel" data-secondary="boot process and" id="idm45805434115840"/>The kernel is usually located in the <em>/boot</em> directory in a compressed form.
That means the first step is to extract and load the kernel into main memory.
After the initialization of its subsystems, filesystems, and drivers
(as discussed in <a data-type="xref" href="ch02.xhtml#kernel">Chapter 2</a> and <a data-type="xref" href="ch05.xhtml#fs-mount">“Mounting filesystems”</a>), the kernel hands over control to the
init system, and with that the boot process proper ends.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="init systems" data-secondary="and boot process" id="idm45805434111936"/>The init system is responsible for launching daemons (service processes) system-wide.
This init process is the root of the process hierarchy and
with it has the process ID (PID) 1. In other words, the process with PID 1 runs
until you power off the system. Besides being responsible for launching other daemons,
the PID 1 process traditionally also takes care of orphaned processes (processes
that don’t have a parent process anymore).</p>
</li>
<li>
<p>Usually, some other user-space-level initialization takes place after this,
depending on the environment:</p>

<ul>
<li>
<p>There is usually a terminal, environment, and shell initialization going on,
as discussed in <a data-type="xref" href="ch03.xhtml#shells-scripting">Chapter 3</a>.</p>
</li>
<li>
<p>Display manager, graphical server, and the like, for desktop environments with a GUI
are launched, taking user preferences and configurations into account.</p>
</li>
</ul>
</li>

</ol>

<p>With this high-level overview of the Linux startup process, we conclude our
introductory section and focus on a vital, user-facing component: the init systems.
This part (the preceding steps 4 and 5) is the most relevant for you, in the
context of this book, allowing you to customize and extend your Linux
installation.</p>

<p>There is a good <a href="https://oreil.ly/Vn6pu">comparison
of init systems</a> available via the Gentoo wiki. We’ll restrict our discussion
to <code>systemd</code>, which almost all current Linux distributions are using.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805434104528">
<h5>System V Init</h5>
<p><a data-type="indexterm" data-primary="init systems" data-secondary="System V" id="idm45805434103328"/><a data-type="indexterm" data-primary="System V–style init programs" id="idm45805434102128"/><a href="https://oreil.ly/ho4eI"><em>System V–style init</em> programs</a>
(or <em>SysV init</em> for short) were the traditional init system in Linux. Linux
inherited SysV from Unix, which defines so-called <em>runlevels</em> (think: system
states such as <code>halt</code>, <code>single-user</code>, <code>multi-user</code> mode, or <code>GUI</code> mode) with the
configuration usually stored in <em>/etc/init.d</em>. However, the sequential
way of starting up daemons and the distro-specific handling of the
configuration made this a not-very-portable option.</p>

<p>Here’s a fun fact: one of the book reviewers, Chris, was the first person to
document SysV init in about 1984 (which an engineer designed over a weekend,
reportedly).<a data-type="indexterm" data-startref="ix_ch06-asciidoc0" id="idm45805434096960"/></p>
</div></aside>
</div></section>













<section data-type="sect1" data-pdf-bookmark="systemd"><div class="sect1" id="systemd">
<h1>systemd</h1>

<p><a data-type="indexterm" data-primary="init systems" data-secondary="systemd" id="ix_ch06-asciidoc1"/><a data-type="indexterm" data-primary="systemd" id="ix_ch06-asciidoc2"/><a href="https://systemd.io"><code>systemd</code></a> was initially an init system, a replacement for
<code>initd</code>, but today it’s a powerful supervisor that includes functions such
as logging, network configuration, and network time synchronization. It provides
for a flexible, portable way to define daemons and their dependencies, and
a uniform interface to control the configuration.</p>

<p>Almost all current Linux distributions are using <code>systemd</code>, including
Fedora since May 2011, openSUSE since September 2012, CentOS since April 2014, RHEL since
June 2014, SUSE Linux since October 2014, Debian since April 2015, and Ubuntu since
April 2015.</p>

<p>In particular, <code>systemd</code> addresses the shortcomings of previous init systems
by doing the following:</p>

<ul>
<li>
<p>Providing a uniform way to manage startup across distros</p>
</li>
<li>
<p>Implementing a faster, more comprehensible service configuration</p>
</li>
<li>
<p>Offering a modern management suite including monitoring, resource usage control
(via cgroups), and built-in auditing</p>
</li>
</ul>

<p>Additionally, <code>init</code> starts services at initialization time in sequence (that
is, in alphanumeric order), while <code>systemd</code> can start any service that has
had its dependencies met, potentially speeding up the startup time.</p>

<p>The way you tell <code>systemd</code> what to run, when to run, and how to run is via units.</p>








<section data-type="sect2" data-pdf-bookmark="Units"><div class="sect2" id="idm45805434082784">
<h2>Units</h2>

<p><a data-type="indexterm" data-primary="systemd" data-secondary="units" id="idm45805434081408"/><a data-type="indexterm" data-primary="unit, in systemd" id="idm45805434080432"/>A unit in <code>systemd</code> is a logical grouping with different semantics depending
on its function and/or the resource it targets. <code>systemd</code> distinguishes a number of
units, depending on the target resource:</p>
<dl>
<dt><code>service</code> units</dt>
<dd>
<p>Describe how to manage a service or application</p>
</dd>
<dt><code>target</code> units</dt>
<dd>
<p>Capture dependencies</p>
</dd>
<dt><code>mount</code> units</dt>
<dd>
<p>Define a mountpoint</p>
</dd>
<dt><code>timer</code> units</dt>
<dd>
<p>Define timers for cron jobs and the like</p>
</dd>
</dl>

<p>Other, less important unit types include the following:</p>
<dl>
<dt><code>socket</code></dt>
<dd>
<p>Describes a network or IPC socket</p>
</dd>
<dt><code>device</code></dt>
<dd>
<p>For <code>udev</code> or <code>sysfs</code> filesystems</p>
</dd>
<dt><code>automount</code></dt>
<dd>
<p>Configures automatic mountpoints</p>
</dd>
<dt><code>swap</code></dt>
<dd>
<p>Describes swap space</p>
</dd>
<dt><code>path</code></dt>
<dd>
<p>For path-based activation</p>
</dd>
<dt><code>snapshot</code></dt>
<dd>
<p>Allows for reconstructing the current state of the system after changes</p>
</dd>
<dt><code>slice</code></dt>
<dd>
<p>Associated with cgroups (see <a data-type="xref" href="#cgroups">“Linux cgroups”</a>)</p>
</dd>
<dt><code>scope</code></dt>
<dd>
<p>Manages sets of system processes created externally</p>
</dd>
</dl>

<p>To be known to <code>systemd</code>, a unit needs to be serialized into a file.
<code>systemd</code> looks for unit files in multiple locations. The three most important filepaths are the following:</p>
<dl>
<dt><em>/lib/systemd/system</em></dt>
<dd>
<p>Package-installed units</p>
</dd>
<dt><em>/etc/systemd/system</em></dt>
<dd>
<p>System admin–configured units</p>
</dd>
<dt><em>/run/systemd/system</em></dt>
<dd>
<p>Nonpersistent runtime modifications</p>
</dd>
</dl>

<p>With the basic unit of work (no pun intended) in <code>systemd</code> defined, let’s move on
to how you control it via the command line.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Management with systemctl"><div class="sect2" id="idm45805434049680">
<h2>Management with systemctl</h2>

<p><a data-type="indexterm" data-primary="systemctl" id="idm45805434048256"/><a data-type="indexterm" data-primary="systemd" data-secondary="systemctl" id="idm45805434047552"/>The tool you use to interact with <code>systemd</code> to manage services is
<a href="https://oreil.ly/kigFH"><code>systemctl</code></a>.</p>

<p>In <a data-type="xref" href="#table-systemctl-commands">Table 6-1</a> I’ve compiled a list of often-used <code>systemctl</code>
commands.</p>
<table id="table-systemctl-commands">
<caption><span class="label">Table 6-1. </span>Useful <code>systemd</code> commands</caption>
<thead>
<tr>
<th>Command</th>
<th>Use case</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>systemctl enable XXXXX.service</code></p></td>
<td><p>Enable the service; ready to be started</p></td>
</tr>
<tr>
<td><p><code>systemctl daemon-reload</code></p></td>
<td><p>Reload all unit files and re-create entire dependency tree</p></td>
</tr>
<tr>
<td><p><code>systemctl start XXXXX.service</code></p></td>
<td><p>Start the service</p></td>
</tr>
<tr>
<td><p><code>systemctl stop XXXXX.service</code></p></td>
<td><p>Stop the service</p></td>
</tr>
<tr>
<td><p><code>systemctl restart XXXXX.service</code></p></td>
<td><p>Stop and then start the service</p></td>
</tr>
<tr>
<td><p><code>systemctl reload XXXXX.service</code></p></td>
<td><p>Issue <code>reload</code> command to service; falls back to <code>restart</code></p></td>
</tr>
<tr>
<td><p><code>systemctl kill XXXXX.service</code></p></td>
<td><p>Stop service execution</p></td>
</tr>
<tr>
<td><p><code>systemctl status XXXXX.service</code></p></td>
<td><p>Get a short summary of service state including some log lines</p></td>
</tr>
</tbody>
</table>

<p>Note that there are many more commands that <code>systemctl</code> offers, from
dependency management and query to controlling the overall system (<code>reboot</code>,
for example).</p>

<p>The <code>systemd</code> ecosystem has a number of other command-line tools you may
find handy and that you should at least be aware of. This includes but is not
limited to the following:</p>
<dl>
<dt><a href="https://oreil.ly/WNKjd"><code>bootctl</code></a></dt>
<dd>
<p>Allows you to check the boot loader status and manage available boot loaders.</p>
</dd>
<dt><code>timedatectl</code></dt>
<dd>
<p>Allows you to set and view <a href="https://oreil.ly/hmgxb">time- and date-related
  information</a>.</p>
</dd>
<dt><code>coredumpctl</code></dt>
<dd>
<p>Enables you to process saved core dumps. Consider this tool when you’re 
<span class="keep-together">troubleshooting.</span></p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Monitoring with journalctl"><div class="sect2" id="idm45805434015600">
<h2>Monitoring with journalctl</h2>

<p><a data-type="indexterm" data-primary="journalctl" id="idm45805434014432"/><a data-type="indexterm" data-primary="systemd" data-secondary="journalctl" id="idm45805434013504"/>The journal is a component of <code>systemd</code>; technically it is a binary file managed
by the <code>systemd-journald</code> daemon, providing a centralized location for all
messages logged by <code>systemd</code> components. We’ll cover it in detail in
<a data-type="xref" href="ch08.xhtml#journalctl">“journalctl”</a>. All you need to know for now is that this is the tool that
allows you to view <code>systemd</code>-managed logs.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Example: scheduling greeter"><div class="sect2" id="idm45805434009664">
<h2>Example: scheduling greeter</h2>

<p><a data-type="indexterm" data-primary="systemd" data-secondary="scheduling greeter example" id="ix_ch06-asciidoc3"/>After all that theory, let’s see <code>systemd</code> in action. As a simple use case
example, let’s assume we want to launch our greeter app (see <a data-type="xref" href="#app-greeter">“Running Example: greeter”</a>) every
hour.</p>

<p>First, we define a <code>systemd</code> unit file of type <code>service</code>. This tells <code>systemd</code>
how to start the greeter app; store the following in a file called <em>greeter.service</em>
(in any directory, could be a temporary one):</p>

<pre data-type="programlisting" data-code-language="toml"><code class="k">[Unit]</code><code class="w">
</code><code class="n">Description</code><code class="o">=</code><code class="n">My</code><code class="w"> </code><code class="n">Greeting</code><code class="w"> </code><code class="n">Service</code><code class="w"> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO1-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="w">
</code><code class="w">
</code><code class="k">[Service]</code><code class="w">
</code><code class="n">Type</code><code class="o">=</code><code class="n">oneshot</code><code class="w">
</code><code class="n">ExecStart</code><code class="o">=</code><code class="err">/</code><code class="n">home</code><code class="err">/</code><code class="n">mh9</code><code class="err">/</code><code class="n">greeter</code><code class="p">.</code><code class="n">sh</code><code class="w"> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO1-2" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO1-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The description of our services, shown when we use <code>systemctl status</code></p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO1-2" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The location of our app</p></dd>
</dl>

<p>Next, we define a <a href="https://oreil.ly/Qv8qt">timer unit</a>
to launch the greeter service every hour. Store the following in a file called
<em>greeter.timer</em>:</p>

<pre data-type="programlisting" data-code-language="toml"><code class="k">[Unit]</code><code class="w">
</code><code class="n">Description</code><code class="o">=</code><code class="n">Runs</code><code class="w"> </code><code class="n">Greeting</code><code class="w"> </code><code class="n">service</code><code class="w"> </code><code class="n">at</code><code class="w"> </code><code class="n">the</code><code class="w"> </code><code class="n">top</code><code class="w"> </code><code class="n">of</code><code class="w"> </code><code class="n">the</code><code class="w"> </code><code class="n">hour</code><code class="w">
</code><code class="w">
</code><code class="k">[Timer]</code><code class="w">
</code><code class="n">OnCalendar</code><code class="o">=</code><code class="n">hourly</code><code class="w"> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO2-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO2-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Defines the schedule using the
<a href="https://oreil.ly/pinVc">systemd time and date format</a></p></dd>
</dl>

<p>Now we copy both unit files to <em>/run/systemd/system</em> so that <code>systemd</code> recognizes
them:</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo ls -al /run/systemd/system/
total <code class="m">8</code>
drwxr-xr-x  <code class="m">2</code> root root  <code class="m">80</code> Sep <code class="m">12</code> <code class="m">13</code>:08 .
drwxr-xr-x <code class="m">21</code> root root <code class="m">500</code> Sep <code class="m">12</code> <code class="m">13</code>:09 ..
-rw-r--r--  <code class="m">1</code> root root <code class="m">117</code> Sep <code class="m">12</code> <code class="m">13</code>:08 greeter.service
-rw-r--r--  <code class="m">1</code> root root <code class="m">107</code> Sep <code class="m">12</code> <code class="m">13</code>:08 greeter.timer</pre>

<p>We’re now in a position to use the greeter timer, since <code>systemd</code> automatically
picked it up when we copied it into the respective directory.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Debian-based systems such as Ubuntu enable and start service units by default.
Red Hat family systems won’t start the service without an explicit
<code>systemctl start greeter.timer</code>. This is also true for enabling services on boot,
where Debian-based distros enable services by default, whereas Red Hat distros
require an explicit confirmation in the form of <code>systemctl enable</code>.</p>
</div>

<p>Let’s check the status of our greeter timer:</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo systemctl status greeter.timer
● greeter.timer - Runs Greeting service at the top of the hour
   Loaded: loaded <code class="o">(</code>/run/systemd/system/greeter.timer<code class="p">;</code> static<code class="p">;</code> <code class="se">\</code>
   vendor preset: enabled<code class="o">)</code>
   Active: active <code class="o">(</code>waiting<code class="o">)</code> since Sun <code class="m">2021</code>-09-12 <code class="m">13</code>:10:35 IST<code class="p">;</code> 2s ago
  Trigger: Sun <code class="m">2021</code>-09-12 <code class="m">14</code>:00:00 IST<code class="p">;</code> 49min left
Sep <code class="m">12</code> <code class="m">13</code>:10:35 starlite systemd<code class="o">[</code><code class="m">1</code><code class="o">]</code>: <code class="se">\</code>
Started Runs Greeting service at the top of the hour.</pre>

<p>So <code>systemd</code> confirms that it knows about our greeter and that it’s
scheduled to run. But how do you know if it worked? Let’s check the logs (note that the output was edited and that the <code>stdout</code> output is going directly
to the logs):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>journalctl</code><code> </code><code>-f</code><code> </code><code>-u</code><code> </code><code>greeter.service</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO3-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>--</code><code> </code><code>Logs</code><code> </code><code>begin</code><code> </code><code>at</code><code> </code><code>Sun</code><code> </code><code class="m">2021</code><code>-01-24</code><code> </code><code class="m">14</code><code>:36:30</code><code> </code><code>GMT.</code><code> </code><code>--</code><code>
</code><code>Sep</code><code> </code><code class="m">12</code><code> </code><code class="m">14</code><code>:00:01</code><code> </code><code>starlite</code><code> </code><code>systemd</code><code class="o">[</code><code class="m">1</code><code class="o">]</code><code>:</code><code> </code><code>Starting</code><code> </code><code>My</code><code> </code><code>Greeting</code><code> </code><code>Service...</code><code>
</code><code>Sep</code><code> </code><code class="m">12</code><code> </code><code class="m">14</code><code>:00:01</code><code> </code><code>starlite</code><code> </code><code>greeter.sh</code><code class="o">[</code><code class="m">21071</code><code class="o">]</code><code>:</code><code> </code><code>You</code><code> </code><code>are</code><code> </code><code>awesome!</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO3-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Using <code>journalctl</code> to look at and follow (<code>-f</code>) the logs of the <em>greeter.service</em>
unit (selected with <code>-u</code>)</p></dd>
</dl>

<p>With this high-level <code>systemd</code> overview, let’s move on to how to manage
applications the traditional way, with general-purpose package managers<a data-type="indexterm" data-startref="ix_ch06-asciidoc3" id="idm45805433723904"/>.<a data-type="indexterm" data-startref="ix_ch06-asciidoc2" id="idm45805433723072"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc1" id="idm45805433722368"/>
But before we get into the technicalities of packages, let’s step back a bit
and discuss apps, packages, and package managers in the context of a broader
concept: supply chains.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Linux Application Supply Chains"><div class="sect1" id="supply-chain">
<h1>Linux Application Supply Chains</h1>

<p><a data-type="indexterm" data-primary="applications" data-secondary="supply chain" id="ix_ch06-asciidoc4"/><a data-type="indexterm" data-primary="supply chain" id="ix_ch06-asciidoc5"/>Let’s start with what we mean by <a href="https://oreil.ly/EegdU"><em>supply chain</em></a>:
a system of organizations and individuals supplying a product to a consumer.
While you may not think about supply chains a lot, you’re dealing with them on a daily
basis—for example, when you buy food or fuel your car. In our discussion, the products are
applications made up of software artifacts, and you can think of the consumer
as either yourself as the person using an app or as a tool that manages the apps
for you.</p>

<p>On a conceptual level, <a data-type="xref" href="#fig-supply-chain">Figure 6-2</a> shows the main actors and phases of a
typical Linux application supply chain.</p>

<figure><div id="fig-supply-chain" class="figure">
<img src="Images/lmlx_0602.png" alt="lmlx 0602" width="600" height="498"/>
<h6><span class="label">Figure 6-2. </span>Linux app supply chain</h6>
</div></figure>

<p>The three distinct areas in a Linux application supply are as follows:</p>
<dl>
<dt>Software maintainers</dt>
<dd>
<p>These include individual developers, open source projects,
  and companies, such as independent software vendors (ISVs), that produce software
  artifacts and publish them, for example, as packages to a repository (repo).</p>
</dd>
<dt>Repository</dt>
<dd>
<p>This lists the package that contains all or part of an app together with metadata.
  The package usually captures the dependencies of an app. Dependencies are
  other packages that an app needs in order to function. This can be a library,
  some kind of exporters or importers, or other service programs. Keeping these
  dependencies up to date is hard.</p>
</dd>
<dt>Tooling (a package manager)</dt>
<dd>
<p>On the target-system side, this can look up packages in the repository and install, update, and remove apps
  as instructed by the human user. Note that one or more packages can represent
  the app and its dependencies.</p>
</dd>
</dl>

<p>While the details may differ from distribution to distribution and depend on
the environment (server, desktop, etc.), the app supply chains all
have the elements shown in <a data-type="xref" href="#fig-supply-chain">Figure 6-2</a> in common.</p>

<p>There are many options available for package and dependency management,
such as traditional package managers, container-based solutions, and more
recent approaches.</p>

<p>In <a data-type="xref" href="#fig-package-man-universe">Figure 6-3</a>, I’ve tried to give you a high-level overview, without
claiming this is a complete picture.</p>

<figure><div id="fig-package-man-universe" class="figure">
<img src="Images/lmlx_0603.png" alt="lmlx 0603" width="600" height="356"/>
<h6><span class="label">Figure 6-3. </span>The Linux package management and application dependency management universe</h6>
</div></figure>

<p class="pagebreak-after">A few notes on the three primary categories of options for package and dependency management:</p>
<dl>
<dt class="less_space">Traditional package managers</dt>
<dd>
<p>Within this category, we
  usually differentiate between low-level and high-level tooling. If a package
  manager can resolve dependencies and provides a high-level interface (install,
  update, remove), we call it a <em>high-level</em> package manager.</p>
</dd>
<dt>Container-based solutions</dt>
<dd>
<p>These initially came out of the server
  and cloud computing realm. Given their capabilities, one use case, but not
  necessarily their primary one, is application management. In other words,
  as a developer you’ll love containers since they enable you to easily
  test things and make it straightforward to ship your production-ready app. See also <a data-type="xref" href="#containers">“Containers”</a>.</p>
</dd>
<dt>Modern package managers</dt>
<dd>
<p>These have their roots in
  desktop environments, and the main goal here is to make it as easy as possible
  for the end user to consume apps. See also <a data-type="xref" href="#modern-package-man">“Modern Package Managers”</a>.<a data-type="indexterm" data-startref="ix_ch06-asciidoc5" id="idm46317739854368"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc4" id="idm46317739853664"/></p>
</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Packages and Package Managers"><div class="sect1" id="package-managers">
<h1>Packages and Package Managers</h1>

<p><a data-type="indexterm" data-primary="package managers" id="ix_ch06-asciidoc6"/>In this section, we discuss package formats and package managers that have
been in use for a long time, in some cases decades. These usually stem
from two major Linux distribution families: Red Hat (RHEL, Fedora, CentOS,
etc.) and Debian-based systems (Debian, Ubuntu, etc.).</p>

<p>The two concepts relevant to our discussions here are the following:</p>
<dl>
<dt>The packages themselves</dt>
<dd>
<p>Technically a file that usually is zipped and may contain metadata.</p>
</dd>
<dt>The tooling (called <em>package managers</em>)</dt>
<dd>
<p>Deals with those packages on the target system,
  to install and maintain apps. A package manager usually interacts with the
  repo on your behalf and maintains a local cache of packages.</p>
</dd>
</dl>

<p>The target system may be a desktop environment on your laptop or a server VM
instance in the cloud, for example. Depending on the environment, packages
may be more or less applicable—for example, a GUI app on a server is not
necessarily something that makes sense.</p>








<section data-type="sect2" data-pdf-bookmark="RPM Package Manager"><div class="sect2" id="idm45805433660336">
<h2>RPM Package Manager</h2>

<p><a data-type="indexterm" data-primary="package managers" data-secondary="RPM" id="ix_ch06-asciidoc7"/><a data-type="indexterm" data-primary="RPM Package Manager" id="ix_ch06-asciidoc8"/><a href="https://oreil.ly/Ef2FC">RPM Package Manager</a> (for which the recursive acronym RPM is used)
was originally created by Red Hat but is now widely
used in various distros. The <em>.rpm</em> file format is used in Linux Standard Base
and can contain binary or source files. The packages can be cryptographically
verified and support delta updates via patch files.</p>

<p>Package managers that use RPM include the following:</p>
<dl>
<dt><a href="https://oreil.ly/sPb2H"><code>yum</code></a></dt>
<dd>
<p>In Amazon Linux, CentOS, Fedora, and RHEL</p>
</dd>
<dt><a href="https://oreil.ly/0Pcod">DNF</a></dt>
<dd>
<p>In CentOS, Fedora, and RHEL</p>
</dd>
<dt><a href="https://oreil.ly/OVize">Zypper</a></dt>
<dd>
<p>In openSUSE and SUSE Linux Enterprise</p>
</dd>
</dl>

<p><a data-type="indexterm" data-primary="yum" id="ix_ch06-asciidoc9"/>Let’s see RPM in action: let’s say we have a fresh developer environment and
want to install the Go programming language tool chain using <code>yum</code>.</p>

<p>Note that the output in the following shell sessions has been edited and shortened to fit
the space (there are many lines in the output that
are not relevant to understanding the usage).</p>

<p>First off, we need to find the package for Go:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="c1"># yum search golang </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO4-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="c1">
</code><code>Loaded</code><code> </code><code>plugins:</code><code> </code><code>ovl,</code><code> </code><code class="nv">priorities</code><code>
</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code> </code><code>N/S</code><code> </code><code>matched:</code><code> </code><code class="nv">golang</code><code> </code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>
</code><code>golang-bin.x86_64</code><code> </code><code>:</code><code> </code><code>Golang</code><code> </code><code>core</code><code> </code><code>compiler</code><code> </code><code>tools</code><code>
</code><code>golang-docs.noarch</code><code> </code><code>:</code><code> </code><code>Golang</code><code> </code><code>compiler</code><code> </code><code>docs</code><code>
</code><code>...</code><code>
</code><code>golang-googlecode-net-devel.noarch</code><code> </code><code>:</code><code> </code><code>Supplementary</code><code> </code><code>Go</code><code> </code><code>networking</code><code> </code><code>libraries</code><code>
</code><code>golang-googlecode-sqlite-devel.x86_64</code><code> </code><code>:</code><code> </code><code>Trivial</code><code> </code><code>sqlite3</code><code> </code><code>binding</code><code> </code><code class="k">for</code><code> </code><code>Go</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO4-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Search for the Go package. Note the <code>#</code> prompt, suggesting we’re logged in
as root. Perhaps a better way would be to use <code>sudo yum</code>.</p></dd>
</dl>

<p>Equipped with this info about the package, we can now install it using the following:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="c1"># yum install golang </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO5-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="c1">
</code><code>Loaded</code><code> </code><code>plugins:</code><code> </code><code>ovl,</code><code> </code><code>priorities</code><code>
</code><code>Resolving</code><code> </code><code>Dependencies</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO5-2" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>--&gt;</code><code> </code><code>Running</code><code> </code><code>transaction</code><code> </code><code>check</code><code>
</code><code>---&gt;</code><code> </code><code>Package</code><code> </code><code>golang.x86_64</code><code> </code><code class="m">0</code><code>:1.15.14-1.amzn2.0.1</code><code> </code><code>will</code><code> </code><code>be</code><code> </code><code>installed</code><code>
</code><code>--&gt;</code><code> </code><code>Processing</code><code> </code><code>Dependency:</code><code> </code><code>golang-src</code><code> </code><code class="o">=</code><code> </code><code class="m">1</code><code>.15.14-1.amzn2.0.1</code><code> </code><code class="k">for</code><code> </code><code>package:</code><code>
    </code><code>golang-1.15.14-1.amzn2.0.1.x86_64</code><code>
</code><code>...</code><code>
</code><code>Transaction</code><code> </code><code class="nv">Summary</code><code>
</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>
</code><code>Install</code><code>  </code><code class="m">1</code><code> </code><code>Package</code><code> </code><code class="o">(</code><code>+101</code><code> </code><code>Dependent</code><code> </code><code>packages</code><code class="o">)</code><code>

</code><code>Total</code><code> </code><code>download</code><code> </code><code>size:</code><code> </code><code class="m">183</code><code> </code><code>M</code><code>
</code><code>Installed</code><code> </code><code>size:</code><code> </code><code class="m">624</code><code> </code><code>M</code><code>
</code><code>Is</code><code> </code><code>this</code><code> </code><code>ok</code><code> </code><code class="o">[</code><code>y/d/N</code><code class="o">]</code><code>:</code><code> </code><code>y</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO5-3" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>Dependencies</code><code> </code><code class="nv">Resolved</code><code>

</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>
 </code><code>Package</code><code>                     </code><code>Arch</code><code>    </code><code>Version</code><code>             </code><code>Repository</code><code>    </code><code class="nv">Size</code><code>
</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>
</code><code>Installing:</code><code>
 </code><code>golang</code><code>                      </code><code>x86_64</code><code>  </code><code class="m">1</code><code>.15.14-1.amzn2.0.1</code><code> </code><code>amzn2-core</code><code>    </code><code class="m">705</code><code> </code><code>k</code><code>
</code><code>Installing</code><code> </code><code class="k">for</code><code> </code><code>dependencies:</code><code>
 </code><code>acl</code><code>                         </code><code>x86_64</code><code>  </code><code class="m">2</code><code>.2.51-14.amzn2</code><code>     </code><code>amzn2-core</code><code>     </code><code class="m">82</code><code> </code><code>k</code><code>
 </code><code>apr</code><code>                         </code><code>x86_64</code><code>  </code><code class="m">1</code><code>.6.3-5.amzn2.0.2</code><code>   </code><code>amzn2-core</code><code>    </code><code class="m">118</code><code> </code><code>k</code><code>
 </code><code>...</code><code>

  </code><code>Verifying</code><code>  </code><code>:</code><code> </code><code>groff-base-1.22.2-8.amzn2.0.2.x86_64</code><code>                     </code><code class="m">101</code><code>/102</code><code>
  </code><code>Verifying</code><code>  </code><code>:</code><code> </code><code>perl-Text-ParseWords-3.29-4.amzn2.noarch</code><code>                 </code><code class="m">102</code><code>/102</code><code>

</code><code>Installed:</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO5-4" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
  </code><code>golang.x86_64</code><code> </code><code class="m">0</code><code>:1.15.14-1.amzn2.0.1</code><code>

</code><code>Dependency</code><code> </code><code>Installed:</code><code>
  </code><code>acl.x86_64</code><code> </code><code class="m">0</code><code>:2.2.51-14.amzn2</code><code>   </code><code>apr.x86_64</code><code> </code><code class="m">0</code><code>:1.6.3-5.amzn2.0.2</code><code>
  </code><code>...</code><code>

</code><code>Complete!</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Install the Go package.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-2" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>yum</code>’s first step is to determine Go’s dependencies.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-3" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Here <code>yum</code> provides us with a summary of what it found in terms of
dependencies and tells us what it plans to do. I need to confirm here
interactively by entering a <code>y</code>. However, in a script I would use the
<code>yum install golang -y</code> form of the command to automatically accept this.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO5-4" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>After verifying that all dependencies and the main package are installed, <code>yum</code> reports success.</p></dd>
</dl>

<p>Last but not least, we want to verify the package, checking exactly what we have installed
and where:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="c1"># yum info golang</code>
Loaded plugins: ovl, priorities
Installed Packages
Name        : golang
Arch        : x86_64
Version     : <code class="m">1</code>.15.14
Release     : <code class="m">1</code>.amzn2.0.1
Size        : <code class="m">7</code>.8 M
Repo        : installed
From repo   : amzn2-core
Summary     : The Go Programming Language
URL         : http://golang.org/
License     : BSD and Public Domain
Description : The Go Programming Language.</pre>

<p>Next<a data-type="indexterm" data-startref="ix_ch06-asciidoc9" id="idm45805439611392"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc8" id="idm45805439610784"/>, <a data-type="indexterm" data-startref="ix_ch06-asciidoc7" id="idm45805439610016"/>let’s have a look at the other widely used package manager using Debian

<span class="keep-together">packages.</span></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Debian deb"><div class="sect2" id="idm45805433659712">
<h2>Debian deb</h2>

<p><a data-type="indexterm" data-primary="deb package manager" id="ix_ch06-asciidoc10"/><a data-type="indexterm" data-primary="package managers" data-secondary="Debian deb" id="ix_ch06-asciidoc11"/><a href="https://oreil.ly/sctS1">deb</a> packages and the <em>.deb</em> file format originate
from the Debian distro. The deb packages can also contain binary or source files.
Multiple package managers use deb, including low-level, no-dependency-management ones
such as <code>dpkg</code>, and high-level ones such as <code>apt-get</code>, <code>apt</code>, and <code>aptitude</code>.
Given that Ubuntu is a Debian-based distro, deb packages are widely
used, on the desktop and server alike.</p>

<p>To see deb packages in action, let’s assume we want to install the
<code>curl</code> utility with <code>apt</code>. This is a useful tool to interact with HTTP APIs
and to download files from a range of locations. Note that we again edited the
output to make it fit.</p>

<p>First, we search for the <code>curl</code> package:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="c1"># apt search curl </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO6-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="c1">
</code><code>Sorting...</code><code> </code><code>Done</code><code>
</code><code>Full</code><code> </code><code>Text</code><code> </code><code>Search...</code><code> </code><code>Done</code><code>
</code><code>curl/focal-updates,focal-security</code><code> </code><code class="m">7</code><code>.68.0-1ubuntu2.6</code><code> </code><code>amd64</code><code>
  </code><code class="nb">command</code><code> </code><code>line</code><code> </code><code>tool</code><code> </code><code class="k">for</code><code> </code><code>transferring</code><code> </code><code>data</code><code> </code><code>with</code><code> </code><code>URL</code><code> </code><code>syntax</code><code>

</code><code>curlftpfs/focal</code><code> </code><code class="m">0</code><code>.9.2-9build1</code><code> </code><code>amd64</code><code>
  </code><code>filesystem</code><code> </code><code>to</code><code> </code><code>access</code><code> </code><code>FTP</code><code> </code><code>hosts</code><code> </code><code>based</code><code> </code><code>on</code><code> </code><code>FUSE</code><code> </code><code>and</code><code> </code><code>cURL</code><code>

</code><code>flickcurl-doc/focal</code><code> </code><code class="m">1</code><code>.26-5</code><code> </code><code>all</code><code>
  </code><code>utilities</code><code> </code><code>to</code><code> </code><code>call</code><code> </code><code>the</code><code> </code><code>Flickr</code><code> </code><code>API</code><code> </code><code>from</code><code> </code><code class="nb">command</code><code> </code><code>line</code><code> </code><code>-</code><code> </code><code>documentation</code><code>

</code><code>flickcurl-utils/focal</code><code> </code><code class="m">1</code><code>.26-5</code><code> </code><code>amd64</code><code>
  </code><code>utilities</code><code> </code><code>to</code><code> </code><code>call</code><code> </code><code>the</code><code> </code><code>Flickr</code><code> </code><code>API</code><code> </code><code>from</code><code> </code><code class="nb">command</code><code> </code><code>line</code><code>

</code><code>gambas3-gb-net-curl/focal</code><code> </code><code class="m">3</code><code>.14.3-2ubuntu3.1</code><code> </code><code>amd64</code><code>
  </code><code>Gambas</code><code> </code><code>advanced</code><code> </code><code>networking</code><code> </code><code>component</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO6-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Search for the <code>curl</code> package with <code>apt</code>. Note that there were overall
dozens of more search results shown, most of them libraries
and language-specific bindings (Python, Ruby, Go, Rust, etc.).</p></dd>
</dl>

<p>Next, we install the <code>curl</code> package like so:</p>

<pre data-type="programlisting" data-code-language="shell" class="widows29"><code class="c1"># apt install curl </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO7-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="c1">
</code><code>Reading</code><code> </code><code>package</code><code> </code><code>lists...</code><code> </code><code>Done</code><code>
</code><code>Building</code><code> </code><code>dependency</code><code> </code><code>tree</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO7-2" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>Reading</code><code> </code><code>state</code><code> </code><code>information...</code><code> </code><code>Done</code><code>
</code><code>The</code><code> </code><code>following</code><code> </code><code>additional</code><code> </code><code>packages</code><code> </code><code>will</code><code> </code><code>be</code><code> </code><code>installed:</code><code>
  </code><code>ca-certificates</code><code> </code><code>krb5-locales</code><code> </code><code>libasn1-8-heimdal</code><code> </code><code>libbrotli1</code><code> </code><code>...</code><code>

</code><code>Suggested</code><code> </code><code>packages:</code><code>
  </code><code>krb5-doc</code><code> </code><code>krb5-user</code><code> </code><code>libsasl2-modules-gssapi-mit</code><code> </code><code>...</code><code>

</code><code>The</code><code> </code><code>following</code><code> </code><code>NEW</code><code> </code><code>packages</code><code> </code><code>will</code><code> </code><code>be</code><code> </code><code>installed:</code><code>
  </code><code>ca-certificates</code><code> </code><code>curl</code><code> </code><code>krb5-locales</code><code> </code><code>libasn1-8-heimdal</code><code> </code><code>...</code><code>

</code><code class="m">0</code><code> </code><code>upgraded,</code><code> </code><code class="m">32</code><code> </code><code>newly</code><code> </code><code>installed,</code><code> </code><code class="m">0</code><code> </code><code>to</code><code> </code><code>remove</code><code> </code><code>and</code><code> </code><code class="m">2</code><code> </code><code>not</code><code> </code><code>upgraded.</code><code>
</code><code>Need</code><code> </code><code>to</code><code> </code><code>get</code><code> </code><code class="m">5447</code><code> </code><code>kB</code><code> </code><code>of</code><code> </code><code>archives.</code><code>
</code><code>After</code><code> </code><code>this</code><code> </code><code>operation,</code><code> </code><code class="m">16</code><code>.7</code><code> </code><code>MB</code><code> </code><code>of</code><code> </code><code>additional</code><code> </code><code>disk</code><code> </code><code>space</code><code> </code><code>will</code><code> </code><code>be</code><code> </code><code>used.</code><code>
</code><code>Do</code><code> </code><code>you</code><code> </code><code>want</code><code> </code><code>to</code><code> </code><code class="k">continue</code><code>?</code><code> </code><code class="o">[</code><code>Y/n</code><code class="o">]</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO7-3" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>

</code><code>Get:1</code><code> </code><code>http://archive.ubuntu.com/ubuntu</code><code> </code><code>focal-updates/main</code><code> </code><code>amd64</code><code>
      </code><code>libssl1.1</code><code> </code><code>amd64</code><code> </code><code class="m">1</code><code>.1.1f-1ubuntu2.8</code><code> </code><code class="o">[</code><code class="m">1320</code><code> </code><code>kB</code><code class="o">]</code><code>
</code><code>Get:2</code><code> </code><code>http://archive.ubuntu.com/ubuntu</code><code> </code><code>focal-updates/main</code><code> </code><code>amd64</code><code>
      </code><code>openssl</code><code> </code><code>amd64</code><code> </code><code class="m">1</code><code>.1.1f-1ubuntu2.8</code><code> </code><code class="o">[</code><code class="m">620</code><code> </code><code>kB</code><code class="o">]</code><code>
</code><code>...</code><code>
</code><code>Fetched</code><code> </code><code class="m">5447</code><code> </code><code>kB</code><code> </code><code class="k">in</code><code> </code><code>1s</code><code> </code><code class="o">(</code><code class="m">3882</code><code> </code><code>kB/s</code><code class="o">)</code><code>
</code><code>Selecting</code><code> </code><code>previously</code><code> </code><code>unselected</code><code> </code><code>package</code><code> </code><code>libssl1.1:amd64.</code><code>
</code><code class="o">(</code><code>Reading</code><code> </code><code>database</code><code> </code><code>...</code><code> </code><code class="m">4127</code><code> </code><code>files</code><code> </code><code>and</code><code> </code><code>directories</code><code> </code><code>currently</code><code> </code><code>installed.</code><code class="o">)</code><code>
</code><code>Preparing</code><code> </code><code>to</code><code> </code><code>unpack</code><code> </code><code>.../00-libssl1.1_1.1.1f-1ubuntu2.8_amd64.deb</code><code> </code><code>...</code><code>
</code><code>Unpacking</code><code> </code><code>libssl1.1:amd64</code><code> </code><code class="o">(</code><code class="m">1</code><code>.1.1f-1ubuntu2.8</code><code class="o">)</code><code> </code><code>...</code><code>
</code><code>...</code><code>
</code><code>Setting</code><code> </code><code>up</code><code> </code><code>libkeyutils1:amd64</code><code> </code><code class="o">(</code><code class="m">1</code><code>.6-6ubuntu1</code><code class="o">)</code><code> </code><code>...</code><code>
</code><code>...</code><code>
</code><code>Processing</code><code> </code><code>triggers</code><code> </code><code class="k">for</code><code> </code><code>ca-certificates</code><code> </code><code class="o">(</code><code class="m">20210119</code><code>~20.04.1</code><code class="o">)</code><code> </code><code>...</code><code>
</code><code>Updating</code><code> </code><code>certificates</code><code> </code><code class="k">in</code><code> </code><code>/etc/ssl/certs...</code><code>
</code><code class="m">1</code><code> </code><code>added,</code><code> </code><code class="m">0</code><code> </code><code>removed</code><code class="p">;</code><code> </code><code class="k">done</code><code>.</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO7-4" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>Running</code><code> </code><code>hooks</code><code> </code><code class="k">in</code><code> </code><code>/etc/ca-certificates/update.d...</code><code>
</code><code>Done.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Install the <code>curl</code> package.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-2" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>apt</code>’s first step is to determine the dependencies.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-3" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Here <code>apt</code> provides us with a dependencies summary and tells us what it
will install. Interactive confirmation is needed here; in a script I would
use <code>apt install curl -y</code> to automatically accept it.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO7-4" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>After verifying that all dependencies and the main package are installed, <code>apt</code> reports success.</p></dd>
</dl>

<p>And finally we verify the <code>curl</code> package:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="c1"># apt show curl</code>
Package: curl
Version: <code class="m">7</code>.68.0-1ubuntu2.6
Priority: optional
Section: web
Origin: Ubuntu
Maintainer: Ubuntu Developers &lt;ubuntu-devel-discuss@lists.ubuntu.com&gt;
Original-Maintainer: Alessandro Ghedini &lt;ghedo@debian.org&gt;
Bugs: https://bugs.launchpad.net/ubuntu/+filebug
Installed-Size: <code class="m">411</code> kB
Depends: libc6 <code class="o">(</code>&gt;<code class="o">=</code> <code class="m">2</code>.17<code class="o">)</code>, libcurl4 <code class="o">(=</code> <code class="m">7</code>.68.0-1ubuntu2.6<code class="o">)</code>, zlib1g <code class="o">(</code>&gt;<code class="o">=</code> <code class="m">1</code>:1.1.4<code class="o">)</code>
Homepage: http://curl.haxx.se
Task: server, cloud-image, ubuntu-budgie-desktop
Download-Size: <code class="m">161</code> kB
APT-Manual-Installed: yes
APT-Sources: http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages
Description: <code class="nb">command</code> line tool <code class="k">for</code> transferring data with URL syntax

N: There is <code class="m">1</code> additional record. Please use the <code class="s1">'-a'</code> switch to see it</pre>

<p>Let’s now move on to programming language–specific package managers.<a data-type="indexterm" data-startref="ix_ch06-asciidoc11" id="idm45805432922448"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc10" id="idm45805432921840"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Language-Specific Package Managers"><div class="sect2" id="idm45805433343072">
<h2>Language-Specific Package Managers</h2>

<p><a data-type="indexterm" data-primary="language-specific package managers" id="idm45805432952544"/><a data-type="indexterm" data-primary="package managers" data-secondary="language-specific" id="idm45805432951776"/>There are also programming language–specific package managers, such as the 
<span class="keep-together">following:</span></p>
<dl>
<dt>C/C++</dt>
<dd>
<p>Have <a href="https://oreil.ly/ibEK2">many different package managers</a>, including Conan and vcpkg</p>
</dd>
<dt>Go</dt>
<dd>
<p>Has package management built in (<code>go get</code>, <code>go mod</code>)</p>
</dd>
<dt>Node.js</dt>
<dd>
<p>Has <code>npm</code> and others</p>
</dd>
<dt>Java</dt>
<dd>
<p>Has <code>maven</code> and <code>nuts</code> and others</p>
</dd>
<dt>Python</dt>
<dd>
<p>Has <code>pip</code> and PyPM</p>
</dd>
<dt>Ruby</dt>
<dd>
<p>Has <code>rubygems</code> and Rails</p>
</dd>
<dt>Rust</dt>
<dd>
<p>Has <code>cargo</code></p>
</dd>
</dl>

<p>With that, let’s look at containers and how you can manage applications
with them.<a data-type="indexterm" data-startref="ix_ch06-asciidoc6" id="idm45805432860704"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Containers"><div class="sect1" id="containers">
<h1>Containers</h1>

<p><a data-type="indexterm" data-primary="containers" data-seealso="modern distros" id="ix_ch06-asciidoc12"/>In the context of this book, we understand a <em>container</em> as a Linux process group
that uses Linux namespaces, cgroups, and optionally CoW filesystems to provide
application-level dependency management. Use cases for containers range from
local <a href="https://oreil.ly/6RPcT">testing and development</a>
to working with distributed systems—for example, working with containerized
microservices in <a href="https://kubernetes.io">Kubernetes</a>.</p>

<p>While containers are very useful for developers and sys admins, as an end user
you will more likely be comfortable using higher-level tooling to manage applications—for example, the ones discussed in <a data-type="xref" href="#modern-package-man">“Modern Package Managers”</a>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805432840640">
<h5>If Only I Had Containers</h5>
<p>In a previous job, I once had to put together a proof of concept that
involved a time series database called InfluxDB. The overall setup required
a number of prerequisites (directories created, data copied) as well as
dependencies installed. When it came to handing it over to a colleague for
demonstration to the customer, I ended up writing up a detailed document that
enumerated all the steps and checks to make sure everything worked as planned.</p>

<p>If only at that time container solutions such as Docker had been
available, I could have saved myself and my colleague a lot of time by
simply packaging up everything into a container. This would not only have made
it easy to use for my colleague, but I could also guarantee that it would run
in their environment exactly as it did on my laptop.</p>
</div></aside>

<p>Containers are, per se, nothing new in Linux. However, they’ve enjoyed mainstream
adoption only due to Docker, starting in roughly 2014. Before that, we had a number
of attempts to introduce containers, often targeting system administrators
rather than developers, including the following:</p>

<ul>
<li>
<p><a href="https://oreil.ly/A5Uri">Linux-VServer (2001)</a></p>
</li>
<li>
<p><a href="https://oreil.ly/yM3Tm">OpenVZ (2005)</a></p>
</li>
<li>
<p><a href="https://oreil.ly/BDSjL">LXC (2008)</a></p>
</li>
<li>
<p><a href="https://oreil.ly/xpmMx">Let Me Contain That for You (lmctfy) (2013)</a></p>
</li>
</ul>

<p>What all of these approaches have in common is that they use the basic building
blocks the Linux kernel provides, such as namespaces or cgroups, to allow users to
run applications.</p>

<p>Docker innovated on the concept and introduced two groundbreaking elements:
a standardized way to define the packaging via container images and a
human-friendly user interface (for example, <code>docker run</code>). The way container images
are defined and distributed, as well as how containers are executed, formed the basis
for what is now known as the <a href="https://opencontainers.org">Open Container Initiative (OCI)</a>
core 
<span class="keep-together">specifications.</span> <a data-type="indexterm" data-primary="OCI (Open Container Initiative)" id="idm45805432829808"/><a data-type="indexterm" data-primary="Open Container Initiative (OCI)" id="idm45805432829008"/>When we talk about containers here, we focus on
OCI-compliant 
<span class="keep-together">implementations.</span></p>

<p>The three core OCI container specifications are as follows:</p>
<dl>
<dt><a href="https://oreil.ly/vrN0V">Runtime specification</a></dt>
<dd>
<p>Defines what a runtime needs to support, including operations and life-cycle
  phases</p>
</dd>
<dt><a href="https://oreil.ly/p0WCY">Image format specification</a></dt>
<dd>
<p>Defines how container images are constructed, based on metadata and layers</p>
</dd>
<dt><a href="https://oreil.ly/kNNeA">Distribution specification</a></dt>
<dd>
<p>Defines how container images are shipped, effectively the way repositories
  work in the context of containers</p>
</dd>
</dl>

<p><a data-type="indexterm" data-primary="immutability" id="idm45805432821344"/>Another idea associated with containers is <em>immutability</em>. This means
that once a configuration is put together, you cannot change it during its usage.
In other words, changes require creating a new (static) configuration and a new
resource (such as a process) with it. We will revisit this in the context of
container images.</p>

<p>Now that you’re aware of what containers are on a conceptual level,
let’s have a closer look at the building blocks of OCI-compliant containers.</p>








<section data-type="sect2" data-pdf-bookmark="Linux Namespaces"><div class="sect2" id="namespaces">
<h2>Linux Namespaces</h2>

<p><a data-type="indexterm" data-primary="containers" data-secondary="namespaces" id="ix_ch06-asciidoc13"/><a data-type="indexterm" data-primary="namespaces" id="ix_ch06-asciidoc14"/>As we discussed in <a data-type="xref" href="ch01.xhtml#intro-to-linux">Chapter 1</a>, Linux initially
had a global view on resources. To allow processes to have a local
view on a resource (such as a filesystem, networking, or even users), Linux
introduced namespaces.</p>

<p>In other words, <a href="https://oreil.ly/3SvR1">Linux namespaces</a>
are all about resource visibility and can be used to isolate different aspects of
the operating system resources. Isolation in this context is mostly
about what a process sees, not necessarily a hard boundary (from a security
perspective).</p>

<p>To create namespaces, you have three relevant syscalls at your disposal:</p>
<dl>
<dt><a href="https://oreil.ly/JNot8"><code>clone</code></a></dt>
<dd>
<p>Used to create a
  child process that can share parts of its execution context with the parent process</p>
</dd>
<dt><a href="https://oreil.ly/9BXiz"><code>unshare</code></a></dt>
<dd>
<p>Used to remove a shared execution context from an existing process</p>
</dd>
<dt><a href="https://oreil.ly/PKGHm"><code>setns</code></a></dt>
<dd>
<p>Used to join an existing process to an existing namespace</p>
</dd>
</dl>

<p>The preceding syscalls take a range of flags as parameters, enabling you to
have fine-grained control over the namespaces you want to create, join, or leave:</p>
<dl>
<dt><code>CLONE_NEWNS</code></dt>
<dd>
<p>Use for <a href="https://oreil.ly/i1Igl">filesystem mount points</a>. Visible via <em>/proc/$PID/mounts</em>. Supported since Linux 2.4.19.</p>
</dd>
<dt><code>CLONE_NEWUTS</code></dt>
<dd>
<p>Use to create <a href="https://oreil.ly/7lB3U">hostname and (NIS) domain name</a> isolation. Visible via <code>uname -n</code> and <code>hostname -f</code>. Supported since Linux 2.6.19.</p>
</dd>
<dt><code>CLONE_NEWIPC</code></dt>
<dd>
<p>Use to do <a href="https://oreil.ly/h9tlW">interprocess communication (IPC)</a> resource
  
<span class="keep-together">isolation</span> like System V IPC objects or POSIX message queues. Visible via 
<span class="keep-together"><em>/proc/sys/fs/mqueue</em></span>, <em>/proc/sys/kernel</em>,
  and <em>/proc/sysvipc</em>. Supported since Linux 2.6.19.</p>
</dd>
<dt><code>CLONE_NEWPID</code></dt>
<dd>
<p>Use for <a href="https://oreil.ly/Czzu7">PID number space isolation</a>
  (PID inside/PID outside the namespace). You can gather details about it via <em>/proc/$PID/status</em>. Supported since Linux 2.6.24.</p>
</dd>
<dt><code>CLONE_NEWNET</code></dt>
<dd>
<p>Use to control visibility of <a href="https://oreil.ly/X9klx">network system resources</a>
  such as network devices, IP addresses, IP routing tables, and port numbers. You
  can view it via <code>ip netns list</code>, <em>/proc/net</em>, and <em>/sys/class/net</em>. Supported since Linux 2.6.29.</p>
</dd>
<dt><code>CLONE_NEWUSER</code></dt>
<dd>
<p>Use to map <a href="https://oreil.ly/uClq3">UID+GIDs</a> inside/outside the namespace. You can query
  UIDs and GIDs and their mappings via the
  <code>id</code> command and <em>/proc/$PID/uid_map</em> and 
<span class="keep-together"><em>/proc/$PID/gid_map</em></span>. Supported since Linux 3.8.</p>
</dd>
<dt><code>CLONE_NEWCGROUP</code></dt>
<dd>
<p>Use to manage <a href="https://oreil.ly/YAGGb">cgroups
  in a namespace</a>. You can see
  it via <em>/sys/fs/cgroup</em>, <em>/proc/cgroups</em>, and <em>/proc/$PID/cgroup</em>. Supported since Linux 4.6.</p>
</dd>
</dl>

<p>One way to view namespaces in use on your system is as follows (output edited
to fit):</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo lsns
        NS TYPE   NPROCS   PID USER             COMMAND
<code class="m">4026531835</code> cgroup    <code class="m">251</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531836</code> pid       <code class="m">245</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531837</code> user      <code class="m">245</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531838</code> uts       <code class="m">251</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531839</code> ipc       <code class="m">251</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531840</code> mnt       <code class="m">241</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026531860</code> mnt         <code class="m">1</code>    <code class="m">33</code> root             kdevtmpfs
<code class="m">4026531992</code> net       <code class="m">244</code>     <code class="m">1</code> root             /sbin/init splash
<code class="m">4026532233</code> mnt         <code class="m">1</code>   <code class="m">432</code> root             /lib/systemd/systemd-udevd
<code class="m">4026532250</code> user        <code class="m">1</code>  <code class="m">5319</code> mh9              /opt/google/chrome/nacl_helper
<code class="m">4026532316</code> mnt         <code class="m">1</code>   <code class="m">684</code> systemd-timesync /lib/systemd/systemd-timesyncd
<code class="m">4026532491</code> mnt         <code class="m">1</code>   <code class="m">688</code> systemd-resolve  /lib/systemd/systemd-resolved
...</pre>

<p>The next container building block focuses on resource consumption limits and
reporting on resource usage.<a data-type="indexterm" data-startref="ix_ch06-asciidoc14" id="idm45805432509344"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc13" id="idm45805432464752"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Linux cgroups"><div class="sect2" id="cgroups">
<h2>Linux cgroups</h2>

<p><a data-type="indexterm" data-primary="cgroups" id="ix_ch06-asciidoc15"/><a data-type="indexterm" data-primary="containers" data-secondary="cgroups" id="ix_ch06-asciidoc16"/>Where namespaces are about visibility, <a href="https://oreil.ly/m4wBr"><em>cgroups</em></a>
provide a different kind of functionality: they are a mechanism to organize process
groups. Along with the hierarchical organization, you can use cgroups to control
system resources usage. In addition, cgroups
provide resource usage tracking; for example, they show how much RAM or CPU seconds
a process (group) is using. Think of cgroups as the declarative unit and the controller
as a piece of kernel code that enforces a certain resource limitation or
reports on its usage.</p>

<p>At this time of writing, there are two versions of cgroups available in the kernel:
cgroups v1 and v2. cgroup v1 is still widely used, but v2 will eventually
replace v1, so you should focus on v2.</p>










<section data-type="sect3" data-pdf-bookmark="cgroup v1"><div class="sect3" id="idm45805432459328">
<h3>cgroup v1</h3>

<p>With <a href="https://oreil.ly/iOEcV">cgroup v1</a>,
the community had an ad hoc approach, adding new cgroups and controllers
as needed. The following v1 cgroups and controllers exist (ordered from oldest to newest; note that
the docs are all over the place and inconsistent):</p>
<dl>
<dt><a href="https://oreil.ly/vGu0Y">CFS bandwidth control</a></dt>
<dd>
<p>Used via the <code>cpu</code> cgroup. Supported since Linux 2.6.24.</p>
</dd>
<dt><a href="https://oreil.ly/7NSLN">CPU accounting controller</a></dt>
<dd>
<p>Used via the <code>cpuacct</code> cgroup. Supported since Linux 2.6.24.</p>
</dd>
<dt><a href="https://oreil.ly/sJp4X"><code>cpusets</code> cgroup</a></dt>
<dd>
<p>Allows you to assign CPU and memory to a task. Supported since Linux 2.6.24.</p>
</dd>
<dt><a href="https://oreil.ly/VjsXY">Memory resource controller</a></dt>
<dd>
<p>Allows you to isolate the memory behavior of tasks. Supported since Linux 2.6.25.</p>
</dd>
<dt><a href="https://oreil.ly/DklEJ">Device whitelist controller</a></dt>
<dd>
<p>Allows you to control device file usage. Supported since Linux 2.6.26.</p>
</dd>
<dt><a href="https://oreil.ly/waLVz"><code>freezer</code> cgroup</a></dt>
<dd>
<p>Used for batch job management. Supported since Linux 2.6.28.</p>
</dd>
<dt><a href="https://oreil.ly/fGcWg">Network classifier cgroup</a></dt>
<dd>
<p>Used to assign different priorities to packets. Supported since Linux 2.6.29.</p>
</dd>
<dt><a href="https://oreil.ly/V3Zto">Block IO controller</a></dt>
<dd>
<p>Allows you to throttle block I/D. Supported since Linux 2.6.33.</p>
</dd>
<dt><a href="https://oreil.ly/AMWei"><code>perf_event</code> command</a></dt>
<dd>
<p>Allows you to collect performance data. Supported since Linux 2.6.39.</p>
</dd>
<dt><a href="https://oreil.ly/4e9f2">Network priority cgroup</a></dt>
<dd>
<p>Allows you to dynamically set the priority of network traffic. Supported since Linux 3.3.</p>
</dd>
<dt><a href="https://oreil.ly/dzl7L">HugeTLB controller</a></dt>
<dd>
<p>Allows you to limit HugeTLB usage. Supported since Linux 3.5.</p>
</dd>
<dt><a href="https://oreil.ly/WkBss">Process number controller</a></dt>
<dd>
<p>Used to allow a cgroup hierarchy to create new processes after a certain limit is reached. Supported since Linux 4.3.</p>
</dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="cgroup v2"><div class="sect3" id="idm45805432456496">
<h3>cgroup v2</h3>

<p><a href="https://oreil.ly/YWCEi">cgroup v2</a>
is a total rewrite of cgroups with the lessons learned from v1. This is true
both in terms of consistent configuration and use of the cgroups as well as the
(centralized and uniform) documentation. Unlike the per-process cgroup v1 design,
cgroup v2 has only single hierarchy, and all controllers are managed the same
way. Here are the v2 controllers:</p>
<dl>
<dt>CPU controller</dt>
<dd>
<p>Regulates distribution of CPU cycles, supporting different
  models (weight, max) and includes usage reporting</p>
</dd>
<dt>Memory controller</dt>
<dd>
<p>Regulates distribution of memory with a range
  of control parameters, supporting user-space memory, kernel data structures
  such as dentries and inodes, and TCP socket buffers</p>
</dd>
<dt>I/O controller</dt>
<dd>
<p>Regulates the distribution of I/O resources with
  both weight-based and absolute bandwidth or I/O operations per second (IOPS) limits, reporting
  on bytes and IOPS read/writes</p>
</dd>
<dt>Process number (PID) controller</dt>
<dd>
<p>Is similar to the v1 version</p>
</dd>
<dt><code>cpuset</code> controller</dt>
<dd>
<p>Is similar to the v1 version</p>
</dd>
<dt><code>device</code> controller</dt>
<dd>
<p>Manages access to device files, implemented on top of eBPF</p>
</dd>
<dt><code>rdma</code> controller</dt>
<dd>
<p>Regulates the distribution and accounting of
  <a href="https://oreil.ly/a5Wk3">remote direct memory access (RDMA) resources</a></p>
</dd>
<dt>HugeTLB controller</dt>
<dd>
<p>Is similar to the v1 version</p>
</dd>
</dl>

<p>There are also miscellaneous cgroups in v2 that allow resource limits and
  tracking mechanisms for scalar resources (which can’t be abstracted like other
  cgroup resources).</p>

<p>You can view all of the v2 cgroups in your Linux system in a nice tree rendering
via the <code>systemctl</code> command, as shown in the following example (output shortened and
edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>systemctl</code><code> </code><code>status</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO8-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>starlite</code><code>
    </code><code>State:</code><code> </code><code>degraded</code><code>
     </code><code>Jobs:</code><code> </code><code class="m">0</code><code> </code><code>queued</code><code>
   </code><code>Failed:</code><code> </code><code class="m">1</code><code> </code><code>units</code><code>
    </code><code>Since:</code><code> </code><code>Tue</code><code> </code><code class="m">2021</code><code>-09-07</code><code> </code><code class="m">11</code><code>:49:08</code><code> </code><code>IST</code><code class="p">;</code><code> </code><code class="m">1</code><code> </code><code>weeks</code><code> </code><code class="m">1</code><code> </code><code>days</code><code> </code><code>ago</code><code>
   </code><code>CGroup:</code><code> </code><code>/</code><code>
           </code><code>├─22160</code><code> </code><code>bpfilter_umh</code><code>
           </code><code>├─user.slice</code><code>
           </code><code>│</code><code> </code><code>└─user-1000.slice</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO8-2" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
           </code><code>│</code><code>   </code><code>├─user@1000.service</code><code>
           </code><code>│</code><code>   </code><code>│</code><code> </code><code>├─gvfs-goa-volume-monitor.service</code><code>
           </code><code>│</code><code>   </code><code>│</code><code> </code><code>│</code><code> </code><code>└─14497</code><code> </code><code>/usr/lib/gvfs/gvfs-goa-volume-monitor</code><code>
   </code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO8-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Using the <code>systemctl</code> tool to render cgroups</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO8-2" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>An example of a specific cgroup that <code>systemd</code> manages</p></dd>
</dl>

<p>Another useful view on cgroups is interactive resource usage, as shown in the
following (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell">$ systemd-cgtop
Control Group                        Tasks   %CPU   Memory  Input/s Output/s
/                                      <code class="m">623</code>   <code class="m">15</code>.7     <code class="m">5</code>.8G        -        -
/docker                                  -      -    <code class="m">48</code>.3M        -        -
/system.slice                          <code class="m">122</code>    <code class="m">6</code>.2     <code class="m">1</code>.6G        -        -
/system.slice/ModemManager.service       <code class="m">3</code>      -   <code class="m">748</code>.0K        -        -
...
/system.slice/rsyslog.service            <code class="m">4</code>      -   <code class="m">420</code>.0K        -        -
/system.slice/snapd.service             <code class="m">17</code>      -     <code class="m">5</code>.1M        -        -</pre>

<p>Going forward, you can expect that, as modern kernel versions are more widely used,
the cgroups v2 will become the standard. There are indeed certain distros, such as
<a href="https://oreil.ly/rxFF2">Arch</a>, Fedora 31+, and Ubuntu 21.10,
that already have v2 by default.<a data-type="indexterm" data-startref="ix_ch06-asciidoc16" id="idm45805432332832"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc15" id="idm45805432332224"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Copy-on-Write Filesystems"><div class="sect2" id="idm45805432316160">
<h2>Copy-on-Write Filesystems</h2>

<p><a data-type="indexterm" data-primary="containers" data-secondary="CoW filesystems and" id="idm45805432315024"/><a data-type="indexterm" data-primary="copy on write (CoW) filesystems" id="idm45805432314048"/>The third building block of containers are CoW filesystems, as discussed in
greater detail in <a data-type="xref" href="ch05.xhtml#cowfs">“Copy-on-Write Filesystems”</a>. These are used at build time. They package
the application and all of its dependencies into a single, self-contained file
that you can distribute. Usually the CoW filesystems are used in combination
with <a href="https://oreil.ly/BS4nK">bind mounts</a> to layer the
content of the different dependencies on top of each other in an efficient
manner.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Docker"><div class="sect2" id="docker">
<h2>Docker</h2>

<p><a data-type="indexterm" data-primary="containers" data-secondary="Docker" id="ix_ch06-asciidoc17"/><a data-type="indexterm" data-primary="Docker" id="ix_ch06-asciidoc18"/>Docker is a human-friendly container implementation developed and
popularized by Docker Inc. in 2014. With Docker, it’s easy
to package up programs and their dependencies and launch them in a range
of environments, from desktops to the cloud. What’s so unique about Docker
is not the building blocks (namespaces, cgroups, CoW filesystems, and bind
mounts). These existed a while before Docker came into being. What’s
so special is that Docker combined these building blocks in a way that
makes them easy to use by hiding the complexity of managing the low-level bits
like namespaces and cgroups.</p>

<p>As shown in <a data-type="xref" href="#fig-docker-arch">Figure 6-4</a> and described in the passage that follows, there are two main concepts in Docker: the image
and the running container.</p>

<figure class="pagebreak-after"><div id="fig-docker-arch" class="figure">
<img src="Images/lmlx_0604.png" alt="lmlx 0604" width="600" height="352"/>
<h6><span class="label">Figure 6-4. </span>High-level Docker architecture</h6>
</div></figure>
<dl>
<dt class="less_space">The container image</dt>
<dd>
<p>A compressed archive file that contains metadata in JSON files
  and the layers, which are effectively directories. The Docker daemon pulls the
  container images as needed from a container registry.</p>
</dd>
<dt>The container as the runtime artifact (for example, app A/B/C)</dt>
<dd>
<p>You can start,
  stop, kill, and remove it. You interact with the Docker daemon using a client
  CLI tool (<code>docker</code>). This CLI tool sends commands to the daemon, which in turn
  executes the respective operation, such as building or running a container.</p>
</dd>
</dl>

<p><a data-type="xref" href="#tab-dockercmds">Table 6-2</a> presents a short reference of often-used
Docker CLI commands, covering both the build-time and the runtime
phases. To get the full reference, including use cases, refer to the
<a href="https://oreil.ly/y1c1W">Docker docs</a>.</p>
<table id="tab-dockercmds">
<caption><span class="label">Table 6-2. </span>Often-used Docker commands</caption>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>run</code></p></td>
<td><p>Launch a container</p></td>
<td><p>Run NGINX as a daemon and remove container on exit: <code>docker run -d --rm nginx:1.21</code></p></td>
</tr>
<tr>
<td><p><code>ps</code></p></td>
<td><p>List containers</p></td>
<td><p>List all containers (including nonrunning): <code>docker ps -a</code></p></td>
</tr>
<tr>
<td><p><code>inspect</code></p></td>
<td><p>Display low-level info</p></td>
<td><p>To query the container IP: <code>docker inspect -f '{{.Network​Set⁠tings.IPAddress}}'</code></p></td>
</tr>
<tr>
<td><p><code>build</code></p></td>
<td><p>Generate a container image locally</p></td>
<td><p>Build image based on current directory and tag: <code>docker build -t some:tag .</code></p></td>
</tr>
<tr>
<td><p><code>push</code></p></td>
<td><p>Upload a container image to a registry</p></td>
<td><p>Push to AWS registry: <code>docker push public.ecr.aws/some:tag</code></p></td>
</tr>
<tr>
<td><p><code>pull</code></p></td>
<td><p>Download a container image from a registry</p></td>
<td><p>Pull from AWS registry: <code>docker pull public.ecr.aws/some:tag</code></p></td>
</tr>
<tr>
<td><p><code>images</code></p></td>
<td><p>List local container images</p></td>
<td><p>List images from a certain registry: <code>docker images ubuntu</code></p></td>
</tr>
<tr>
<td><p><code>image</code></p></td>
<td><p>Manage container images</p></td>
<td><p>Remove all unused images: <code>docker image prune -all</code></p></td>
</tr>
</tbody>
</table>

<p>Let’s now have a closer look at the build-time artifact: the container image
that Docker uses.</p>










<section data-type="sect3" data-pdf-bookmark="Container Images"><div class="sect3" id="idm45805432253920">
<h3>Container Images</h3>

<p><a data-type="indexterm" data-primary="Docker" data-secondary="container images" id="idm45805432252512"/><a data-type="indexterm" data-primary="Dockerfile" id="idm45805432251536"/>To define the instructions on how to build a container image, you use
a plain text file format called
<a href="https://oreil.ly/dM8LO">Dockerfile</a>.</p>

<p>There are different directives you can have in a Dockerfile:</p>
<dl class="pagebreak-before">
<dt class="less_space">Base images</dt>
<dd>
<p><code>FROM</code>; can be multiple for build/run phases</p>
</dd>
<dt>Metadata</dt>
<dd>
<p><code>LABEL</code> for lineage</p>
</dd>
<dt>Arguments and environment variables</dt>
<dd>
<p><code>ARGS</code>, <code>ENV</code></p>
</dd>
<dt>Build-time specifications</dt>
<dd>
<p><code>COPY</code>, <code>RUN</code>, etc., which define how the image is
  constructed, layer for layer</p>
</dd>
<dt>Runtime specifications</dt>
<dd>
<p><code>CMD</code> and <code>ENTRYPOINT</code>, which define how the
  container can be run</p>
</dd>
</dl>

<p>Using the <code>docker build</code> command, you turn a collection of files that represent
your application (either as source or in binary format), along with the Dockerfile,
into a container image. This container image is the artifact that you can then
run or push to a registry, in order to distribute it for others to pull and
eventually run.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Running containers"><div class="sect3" id="idm45805432238224">
<h3>Running containers</h3>

<p><a data-type="indexterm" data-primary="Docker" data-secondary="running containers" id="idm45805432237024"/>You can run containers with interactive input (terminal attached) or as
daemons (background). The <a href="https://oreil.ly/87YZq"><code>docker run</code></a>
command takes a container image and a set of runtime inputs, such as environment
variables, ports to expose, and volumes to mount. With this information, Docker
creates the necessary namespaces and cgroups and launches the application
defined in the container image (<code>CMD</code> or <code>ENTRYPOINT</code>).</p>

<p>With the Docker theory out of the way, let’s see it in action.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Example: containerized greeter"><div class="sect3" id="idm45805432233168">
<h3>Example: containerized greeter</h3>

<p><a data-type="indexterm" data-primary="Docker" data-secondary="containerized greeter example" id="ix_ch06-asciidoc19"/>Let’s now put our <code>greeter</code> app (see <a data-type="xref" href="#app-greeter">“Running Example: greeter”</a>) into a container and run it.</p>

<p>First off, we need to define the Dockerfile, which contains the instructions
to build the container image:</p>
<pre data-type="programlisting" data-code-language="shell"><code>FROM</code><code> </code><code>ubuntu:20.04</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-1" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>LABEL</code><code> </code><code>org.opencontainers.image.authors</code><code class="o">=</code><code class="s2">"Michael Hausenblas"</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-2" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>COPY</code><code> </code><code>greeter.sh</code><code> </code><code>/app/</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-3" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>WORKDIR</code><code> </code><code>/app</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-4" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>RUN</code><code> </code><code>chown</code><code> </code><code>-R</code><code> </code><code class="m">1001</code><code>:1</code><code> </code><code>/app</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-5" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>USER</code><code> </code><code class="m">1001</code><code>
</code><code>ENTRYPOINT</code><code> </code><code class="o">[</code><code class="s2">"/app/greeter.sh"</code><code class="o">]</code><code> </code><a class="co" id="custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-6" href="#custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></pre>
<dl class="calloutlist pagebreak-before">
<dt class="less_space"><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-1" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Define the base image using an explicit tag (<code>20.04</code>).</p></dd>
<dt><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-2" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Assign some metadata via a <a href="https://oreil.ly/eYWVo">label</a>.</p></dd>
<dt><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-3" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Copy shell script. This could be a binary, a JAR file, or a Python script.</p></dd>
<dt><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-4" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Set the working directory.</p></dd>
<dt><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-5" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>This and the next line define the user running the app. If you don’t do this,
it will unnecessarily run as <code>root</code>.</p></dd>
<dt><a class="co" id="custom_callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-6" href="#custom_co_applications__package_management____span_class__keep_together__and_containers__span__CO9-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Define what to run, in our case the shell script. The way we defined it,
using <code>ENTRYPOINT</code>, it is possible to pass a parameter by running
<code>docker run greeter:1 _SOME_PARAMETER_</code>.</p></dd>
</dl>

<p>Next, we build the container image:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>docker</code><code> </code><code>build</code><code> </code><code>-t</code><code> </code><code>greeter:1</code><code> </code><code>.</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO9-1" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Sending</code><code> </code><code>build</code><code> </code><code>context</code><code> </code><code>to</code><code> </code><code>Docker</code><code> </code><code>daemon</code><code>  </code><code class="m">3</code><code>.072kB</code><code>
</code><code>Step</code><code> </code><code class="m">1</code><code>/7</code><code> </code><code>:</code><code> </code><code>FROM</code><code> </code><code>ubuntu:20.04</code><code> </code><a class="co" id="co_applications__package_management____span_class__keep_together__and_containers__span__CO9-2" href="#callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">20</code><code>.04:</code><code> </code><code>Pulling</code><code> </code><code>from</code><code> </code><code>library/ubuntu</code><code>
</code><code>35807b77a593:</code><code> </code><code>Pull</code><code> </code><code class="nb">complete</code><code>
</code><code>Digest:</code><code> </code><code>sha256:9d6a8699fb5c9c39cf08a0871bd6219f0400981c570894cd8cbea30d3424a31f</code><code>
</code><code>Status:</code><code> </code><code>Downloaded</code><code> </code><code>newer</code><code> </code><code>image</code><code> </code><code class="k">for</code><code> </code><code>ubuntu:20.04</code><code>
 </code><code>---&gt;</code><code> </code><code>fb52e22af1b0</code><code>
</code><code>Step</code><code> </code><code class="m">2</code><code>/7</code><code> </code><code>:</code><code> </code><code>LABEL</code><code> </code><code>org.opencontainers.image.authors</code><code class="o">=</code><code class="s2">"Michael Hausenblas"</code><code>
 </code><code>---&gt;</code><code> </code><code>Running</code><code> </code><code class="k">in</code><code> </code><code>6aa921276c3b</code><code>
</code><code>Removing</code><code> </code><code>intermediate</code><code> </code><code>container</code><code> </code><code>6aa921276c3b</code><code>
 </code><code>---&gt;</code><code> </code><code>def717e3352b</code><code>
</code><code>Step</code><code> </code><code class="m">3</code><code>/7</code><code> </code><code>:</code><code> </code><code>COPY</code><code> </code><code>greeter.sh</code><code> </code><code>/app/</code><code>
 </code><code>---&gt;</code><code> </code><code>5f3eb160fea3</code><code>
</code><code>Step</code><code> </code><code class="m">4</code><code>/7</code><code> </code><code>:</code><code> </code><code>WORKDIR</code><code> </code><code>/app</code><code>
 </code><code>---&gt;</code><code> </code><code>Running</code><code> </code><code class="k">in</code><code> </code><code>698c29938a96</code><code>
</code><code>Removing</code><code> </code><code>intermediate</code><code> </code><code>container</code><code> </code><code>698c29938a96</code><code>
 </code><code>---&gt;</code><code> </code><code>d73572886c13</code><code>
</code><code>Step</code><code> </code><code class="m">5</code><code>/7</code><code> </code><code>:</code><code> </code><code>RUN</code><code> </code><code>chown</code><code> </code><code>-R</code><code> </code><code class="m">1001</code><code>:1</code><code> </code><code>/app</code><code>
 </code><code>---&gt;</code><code> </code><code>Running</code><code> </code><code class="k">in</code><code> </code><code>5b5eb5d1935a</code><code>
</code><code>Removing</code><code> </code><code>intermediate</code><code> </code><code>container</code><code> </code><code>5b5eb5d1935a</code><code>
 </code><code>---&gt;</code><code> </code><code>42c35a6db6e2</code><code>
</code><code>Step</code><code> </code><code class="m">6</code><code>/7</code><code> </code><code>:</code><code> </code><code>USER</code><code> </code><code class="m">1001</code><code>
 </code><code>---&gt;</code><code> </code><code>Running</code><code> </code><code class="k">in</code><code> </code><code>bec92deaac6e</code><code>
</code><code>Removing</code><code> </code><code>intermediate</code><code> </code><code>container</code><code> </code><code>bec92deaac6e</code><code>
 </code><code>---&gt;</code><code> </code><code>b6e0e27f253b</code><code>
</code><code>Step</code><code> </code><code class="m">7</code><code>/7</code><code> </code><code>:</code><code> </code><code>CMD</code><code> </code><code class="o">[</code><code class="s2">"/app/greeter.sh"</code><code class="o">]</code><code>
 </code><code>---&gt;</code><code> </code><code>Running</code><code> </code><code class="k">in</code><code> </code><code>6d3b439f7e50</code><code>
</code><code>Removing</code><code> </code><code>intermediate</code><code> </code><code>container</code><code> </code><code>6d3b439f7e50</code><code>
 </code><code>---&gt;</code><code> </code><code>433a5f10d84e</code><code>
</code><code>Successfully</code><code> </code><code>built</code><code> </code><code>433a5f10d84e</code><code>
</code><code>Successfully</code><code> </code><code>tagged</code><code> </code><code>greeter:1</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-1" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Build the container image and label it (with <code>-t greeter:1</code>). The <code>.</code> means that it uses the
current directory and assumes that a Dockerfile is present there.</p></dd>
<dt><a class="co" id="callout_applications__package_management____span_class__keep_together__and_containers__span__CO9-2" href="#co_applications__package_management____span_class__keep_together__and_containers__span__CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This and the next lines pull the base image and build it layer by layer.</p></dd>
</dl>

<p>Let’s check if the container image is there:</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo docker images
REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
greeter      <code class="m">1</code>         433a5f10d84e   <code class="m">35</code> seconds ago   <code class="m">72</code>.8MB
ubuntu       <code class="m">20</code>.04     fb52e22af1b0   <code class="m">2</code> weeks ago      <code class="m">72</code>.8MB</pre>

<p>Now we can run a container based on the <code>greeter:1</code> image, like so:</p>

<pre data-type="programlisting" data-code-language="shell"> $ sudo docker run greeter:1
You are awesome!</pre>

<p>That wraps up our Docker 101<a data-type="indexterm" data-startref="ix_ch06-asciidoc19" id="idm45805431974496"/>.<a data-type="indexterm" data-startref="ix_ch06-asciidoc18" id="idm45805431973568"/><a data-type="indexterm" data-startref="ix_ch06-asciidoc17" id="idm45805431972960"/> We’ll now take a quick look at related tooling.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Other Container Tooling"><div class="sect2" id="idm45805432310624">
<h2>Other Container Tooling</h2>

<p><a data-type="indexterm" data-primary="containers" data-secondary="alternatives to Docker" id="idm45805432129952"/>You don’t have to use Docker to work with OCI containers; as an alternative, you can use a
<a data-type="indexterm" data-primary="buildah" id="idm45805432128512"/><a data-type="indexterm" data-primary="podman" id="idm45805432127840"/>Red Hat–led and –sponsored combo:
<a href="https://podman.io"><code>podman</code></a> and <a href="https://buildah.io"><code>buildah</code></a>. These
daemon-less tools allow you to build OCI container images (<code>buildah</code>) and
run them (<code>podman</code>).</p>

<p>In addition, there are a number of tools that make working with OCI containers,
namespaces, and cgroups easier, including but not limited to the following:</p>
<dl>
<dt><a href="https://oreil.ly/mIKkm"><code>containerd</code></a></dt>
<dd>
<p>A daemon that manages the OCI container
  life cycle, from image transfer and storage to container runtime supervision</p>
</dd>
<dt><a href="https://oreil.ly/UAom6"><code>skopeo</code></a></dt>
<dd>
<p>For container image manipulation
  (copying, inspecting manifest, etc.)</p>
</dd>
<dt><a href="https://oreil.ly/aDgBa"><code>systemd-cgtop</code></a></dt>
<dd>
<p>A kind of cgroups-aware variant of <code>top</code> that shows resource usage interactively</p>
</dd>
<dt><a href="https://oreil.ly/D0Gbc"><code>nsenter</code></a></dt>
<dd>
<p>Allows you to
  execute a program in a specified, existing namespace</p>
</dd>
<dt><a href="https://oreil.ly/oOigx"><code>unshare</code></a></dt>
<dd>
<p>Allows you to run a program with
  specific namespaces (opt in via flags)</p>
</dd>
<dt><a href="https://oreil.ly/jY7Q6"><code>lsns</code></a></dt>
<dd>
<p>Lists information
  about Linux namespaces</p>
</dd>
<dt><a href="https://oreil.ly/yaiMo"><code>cinf</code></a></dt>
<dd>
<p>Lists information about Linux
  namespaces and cgroups associated with process IDs</p>
</dd>
</dl>

<p>With this we end our containers tour. Let’s now look at modern package managers
and how they utilize containers to isolate applications from each other.<a data-type="indexterm" data-startref="ix_ch06-asciidoc12" id="idm45805432080848"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Modern Package Managers"><div class="sect1" id="modern-package-man">
<h1>Modern Package Managers</h1>

<p><a data-type="indexterm" data-primary="package managers" data-secondary="modern" id="idm45805432078576"/>In addition to the more traditional package managers that often are
distribution-specific, there is a new sort of package manager. These
modern solutions often make use of containers and aim to be
cross-distribution or target specific environments. For example, they can make
it easy for Linux desktop users to install GUI apps.</p>
<dl>
<dt><a href="https://oreil.ly/n4fe6">Snap</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Snap" id="idm45805432075376"/>A Canonical Ltd.–designed and –promoted software packaging
and deployment system. It comes with a refined
<a href="https://oreil.ly/ImWPH">sandboxing</a> setup and
can be used in desktop, cloud, and IoT environments.</p>
</dd>
<dt><a href="https://oreil.ly/sEEu1">Flatpak</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Flatpak" id="idm45805432072176"/>Optimized for Linux desktop environments,
using cgroups, namespaces, bind mounts, and seccomp as its building blocks.
While initially from the Red Hat part of the Linux distro universe, it is
now available for dozens of distros, including Fedora, Mint, Ubuntu, Arch,
Debian, openSUSE, and Chrome OS.</p>
</dd>
<dt><a href="https://oreil.ly/76Uhu">AppImage</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="AppImage" id="idm45805432069472"/>Has been around for years and promotes the
idea that one app equals one file; that is, it requires no dependencies other
than what is included in the targeted Linux system. Over time, a number of
interesting features have found their way into AppImage, from efficient updates
to desktop integration to software 
<span class="keep-together">catalogs.</span></p>
</dd>
<dt><a href="https://oreil.ly/XegIz">Homebrew</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Homebrew" id="idm45805432066528"/>Originally from the macOS world but available for Linux
and enjoying increasing popularity. It’s written in Ruby and has a powerful
yet intuitive user interface.</p>
</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45805432065184">
<h1>Conclusion</h1>

<p>In this chapter, we covered a wide range of topics, all related to how to
install, maintain, and use applications on Linux.</p>

<p>We first defined basic application terms, then we looked at the Linux
startup process, discussing <code>systemd</code>, the now standard way of managing
startup and 
<span class="keep-together">components.</span></p>

<p>To distribute applications, Linux uses packages and package managers. We
discussed various managers in this context and how you can use containers
for development and testing as well as dependency management. Docker containers
use Linux primitives (cgroups, namespaces, CoW filesystems) to provide you
with application-level dependency management (via container images).</p>

<p>Finally, we looked at custom solutions for app management, including Snap and 
<span class="keep-together">others.</span></p>

<p>If you’re interested in further reading on the topics in this chapter,
have a look at the following resources:</p>
<dl>
<dt>Startup process and init systems</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/bYPw5">“Analyzing the Linux Boot Process”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/k90in">“Stages of Linux Booting Process”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/tvaMe">“How to Configure a Linux Service to Start Automatically After a Crash or Reboot”</a></p>
</li>
</ul>
</dd>
<dt>Package management</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/66mo5">“2021 State of the Software Supply Chain”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/MFGlL">“Linux Package Management”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/jiRj8">“Understanding RPM Package Management Tutorial”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/DmAvc">Debian packages</a></p>
</li>
</ul>
</dd>
<dt>Containers</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/zn69i">“A Practical Introduction to Container Terminology”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/NUxrE">“From Docker to OCI: What Is a Container?”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/VofA0">“Building Containers Without Docker”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/KJB9O">“Why Red Hat Is Investing in CRI-O and Podman”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/Anvty">“Demystifying Containers”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/FLTHf">“Rootless Containers”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/8QPPh">“Docker Storage Drivers Deep Dive”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/MLAom">“The Hunt for a Better Dockerfile”</a></p>
</li>
</ul>
</dd>
</dl>

<p>Now that you know all the basics around applications let’s move on from the
scope of a single Linux system to an interconnected setup and its necessary
precondition: 
<span class="keep-together">networking.</span></p>
</div></section>







</div></section></div></body></html>