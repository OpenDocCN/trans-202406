<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Writing MySQL-Based Programs"><div class="chapter" id="nch-api"><h1><span class="label">Chapter 4. </span>Writing MySQL-Based Programs</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820409184624"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="4.0 Introduction"><div class="sect1" id="nch-api-api-intro"><h1>4.0 Introduction</h1><p>This chapter discusses how to use MySQL from within the context of a general-purpose
    programming language. It covers basic application programming interface
    (API) operations that are fundamental to and form the basis for the
    programming recipes developed in later chapters. These operations include
    connecting to the MySQL server, executing statements, and retrieving the
    results.</p><p>MySQL-based client programs can be written using many languages.
    This book covers the languages and interfaces shown in the <a data-type="xref" href="#nch-api-api-intro-langs">Table 4-1</a>
    (for information on obtaining the interface software, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>):</p><table id="nch-api-api-intro-langs"><caption><span class="label">Table 4-1. </span>Languages and interfaces, covered in this book</caption><thead><tr><th>Language</th><th>Interface</th></tr></thead><tbody><tr><td>Perl</td><td>Perl DBI</td></tr><tr><td>Ruby</td><td>Mysql2 gem</td></tr><tr><td>PHP</td><td>PDO</td></tr><tr><td>Python</td><td>DB API</td></tr><tr><td>Go</td><td>Go sql</td></tr><tr><td>Java</td><td>JDBC</td></tr></tbody></table><p>MySQL client APIs provide the following capabilities, each covered in a
    section of this chapter:</p><dl><dt>Connecting to the MySQL server, selecting a database, and
        disconnecting from the <span class="keep-together">server</span></dt><dd><p>Every program that uses MySQL must first establish a
          connection to the server. Most programs also select a default
          database, and well-behaved MySQL programs close the connection to
          the server when they’re done with it.</p></dd><dt>Checking for errors</dt><dd><p>Any database operation can fail. If you know how to
          find out when that occurs and why, you can take appropriate action
          such as terminating the program or informing the user of the
          problem.</p></dd><dt>Executing SQL statements and retrieving results</dt><dd><p>The point of connecting to a database server is to execute SQL
          statements. Each API provides at least one way to do this, as well
          as methods for processing statement results.</p></dd><dt>Handling special characters and <code>NULL</code> values in statements</dt><dd><p>Data values can be embedded directly in statement strings.
          However, some characters such as quotes and backslashes have special
          meaning, and their use requires certain precautions. The same is
          true for <code>NULL</code> values. If you
          handle these improperly, your programs will generate SQL statements
          that are erroneous or yield unexpected results. If you incorporate
          data from external sources into queries, your program might become
          subject to SQL injection attacks. Most APIs enable you to avoid
          these problems by using placeholders, which refer to data values
          symbolically in a statement to be executed and supply those values
          separately. The API inserts data into the statement string after
          properly encoding any special characters or <code>NULL</code> values. Placeholders are also known
          as parameter markers.</p></dd><dt>Identifying <code>NULL</code> values in
        result sets</dt><dd><p><code>NULL</code> values are special not
          only when you construct statements, but also in results returned
          from them. Each API provides a convention for recognizing and
          dealing with them.</p></dd></dl><p>No matter which programming language you use, it’s necessary to know
    how to perform each of the fundamental database API operations just
    described, so this chapter shows each operation in all five languages.
    Seeing how each API handles a given operation should help you see the
    correspondences between APIs more easily and better understand the recipes
    shown in the following chapters, even if they’re written in a language you
    don’t use much. (Later chapters usually implement recipes using only one
    or two languages.)</p><p>It may seem overwhelming to see each recipe in several languages if
    your interest is in only one particular API. If so, we advise you to read
    just the introductory recipe part that provides the general background,
    then go directly to the section for the language in which you’re
    interested. Skip the other languages; should you develop an interest in
    them later, come back and read about them then.</p><p>This chapter also discusses the following topics, which are not
    directly part of the MySQL APIs but help you use them more easily:</p><dl><dt>Writing library files</dt><dd><p>As you write program after program, you find that you carry out certain
          operations repeatedly. Library files enable encapsulating code for
          those operations so they can be performed easily from multiple
          scripts without repeating the code in each one. This reduces code
          duplication and makes your programs more portable. This chapter
          shows how to write a library file for each API that includes a
          routine for connecting to the server—one operation that every
          program that uses MySQL must perform. Later chapters develop
          additional library routines for other operations.</p></dd><dt>Additional techniques for obtaining connection parameters</dt><dd><p>An early section on establishing connections to the MySQL
          server relies on connection parameters hardwired into the code.
          However, there are other (and better) ways to obtain parameters,
          ranging from storing them in a separate file to enabling the user to
          specify them at runtime.</p></dd></dl><p>To avoid manually typing in the example programs, get a copy of the
    <code>recipes</code> source distribution (see the
    <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>). Then, when an example says
    something like <q>create a file named <em class="filename">xyz</em> that contains the following information
    ...,</q> you can use the corresponding file from the <code>recipes</code> distribution. Most scripts for this
    chapter are located under the <em class="filename">api</em>
    directory; library files are located in the <em class="filename">lib</em> directory.</p><p>The primary table used for examples in this chapter is named
    <code>profile</code>. It first appears in <a data-type="xref" href="#nch-api-api-statement">Recipe 4.4</a>, which you should know in case you skip
    around in the chapter and wonder where it came from. See also the section
    at the very end of the chapter about resetting the <code>profile</code> table to a known state for use in other
    chapters.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>The programs discussed here can be run from the command line. For
      instructions on invoking programs for each language covered here, read
      <code>cmdline.pdf</code> in the recipes distribution.</p></div><section data-type="sect2" data-pdf-bookmark="Assumptions"><div class="sect2" id="idm45820409155568"><h2>Assumptions</h2><p>To use the material in this chapter most effectively, make sure to
      satisfy these requirements:</p><ul><li><p>Install MySQL programming support for any languages that you
          plan to use (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p></li><li><p>You should already have set up a MySQL user account for
          accessing the server and a database for executing SQL statements. As
          described in <a data-type="xref" href="ch01.xhtml#nch-mysql-mysql-account">Recipe 1.1</a>, the
          examples in this book use a MySQL account that has a username and
          password of <code>cbuser</code> and <code>cbpass</code>, and we’ll connect to a MySQL
          server running on the local host to access a database named <code>cookbook</code>. To create the account or the
          database, see the instructions in that recipe.</p></li><li><p>The discussion here shows how to use each API language to
          perform database operations, but assumes a basic understanding of
          the language itself. If a recipe uses programming constructs with
          which you’re unfamiliar, consult a general reference for the
          language of interest.</p></li><li><p>Proper execution of some of the programs might require that
          you set certain environment variables. General syntax for doing so
          is covered in <code>cmdline.pdf</code> in the recipes distribution (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>). For details about environment
          variables that apply specifically to library file locations, see
          <a data-type="xref" href="#nch-api-api-library">Recipe 4.3</a>.</p></li></ul></div></section><section data-type="sect2" data-pdf-bookmark="MySQL Client API Architecture"><div class="sect2" id="idm45820409146656"><h2>MySQL Client API Architecture</h2><p>Each MySQL programming interface covered in this book uses a two-level
      architecture:</p><ul><li><p>The upper level provides database-independent methods that
          implement database access in a portable way that’s the same whether
          you use MySQL, PostgreSQL, Oracle, or whatever.</p></li><li><p>The lower level consists of a set of drivers, each of which
          implements the details for a single database system.</p></li></ul><p>This two-level architecture enables application programs to use an
      abstract interface not tied to details specific to any particular
      database server. This enhances portability of your programs: to use a
      different database system, just select a different lower-level driver.
      However, perfect portability is elusive:</p><ul><li><p>The interface methods provided by the upper level of the
          architecture are consistent regardless of the driver you use, but
          it’s still possible to write SQL statements that use constructs
          supported only by a particular server. For example, MySQL has
          <code>SHOW</code> statements that provide information about database and table
          structure, but using <code>SHOW</code> with a
          non-MySQL server likely will produce an error.</p></li><li><p>Lower-level drivers often extend the abstract interface to
          make it more convenient to access database-specific features. For
          example, the MySQL driver for Perl DBI makes the most recent
          <code>AUTO_INCREMENT</code> value available as
          a database handle attribute accessible as <code>$dbh-&gt;{mysql_insertid}</code>. Such features
          make a program easier to write, but less portable. To use the
          program with another database system will require some
          rewriting.</p></li></ul><p>Despite these factors that compromise portability to some extent,
      the general portability characteristics of the two-level architecture
      provide significant benefits for MySQL developers.</p><p>Another characteristic common to the APIs used in this book is
      that they are object oriented. Whether you write in Perl, Ruby, PHP,
      Python, Java or Go, the operation that connects to the MySQL server returns
      an object that enables you to process statements in an object-oriented
      manner. For example, when you connect to the database server, you get a
      database connection object with which to further interact with the
      server. The interfaces also provide objects for statements, result sets,
      metadata, and so forth.</p><p>Now let’s see how to use these programming interfaces to perform
      the most fundamental MySQL operations: connecting to and disconnecting
      from the server.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.1 Connecting, Selecting a Database, and Disconnecting"><div class="sect1" id="nch-api-api-connect"><h1>4.1 Connecting, Selecting a Database, and Disconnecting</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820409139072"><h2>Problem</h2><p>You need to establish a connection to the database server and shut down the
      connection when you’re done.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820409138000"><h2>Solution</h2><p>Each API provides routines for connecting and disconnecting. The
      connection routines require that you provide parameters specifying the
      host on which the MySQL server is running and the MySQL account to use.
      You can also select a default database.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820409136768"><h2>Discussion</h2><p>This section shows how to perform some fundamental operations
      common to most MySQL programs:</p><dl><dt>Establishing a connection to the MySQL server</dt><dd><p>Every program that uses MySQL does this, no matter which API
            you use. The details on specifying connection parameters vary
            between APIs, and some APIs provide more flexibility than others.
            However, there are many common parameters, such as the host on
            which the server is running, and the username and password of the
            MySQL account to use for accessing the server.</p></dd><dt>Selecting a database</dt><dd><p>Most MySQL programs select a default database.</p></dd><dt>Disconnecting from the server</dt><dd><p>Each API provides a way to close an open connection. It’s
            best to do so as soon as you’re done using the server. If your
            program holds the connection open longer than necessary, the
            server cannot free up resources allocated to servicing the
            connection. It’s also preferable to close the connection
            explicitly. If a program simply terminates, the MySQL server
            eventually notices, but an explicit close on the user end enables
            the server to perform an immediate orderly close on its
            end.</p></dd></dl><p>This section includes example programs that show how to use each
      API to connect to the server, select the <code>cookbook</code> database, and disconnect. The
      discussion for each API also indicates how to connect without selecting
      any default database. This might be the case if you plan to execute a
      statement that doesn’t require a default database, such as <code>SHOW</code> <code>VARIABLES</code> or <code>SELECT</code> <code>VERSION()</code>. Or perhaps you’re writing a program
      that enables the user to specify the database after the connection has
      been made.</p><div data-type="tip"><h6>Tip</h6><p>The scripts shown here use <code>localhost</code> as the hostname. If they produce a
        connection error indicating that a socket file cannot be found, try
        changing <code>localhost</code> to <code>127.0.0.1</code>, the TCP/IP address of the local
        host. This tip applies throughout the book.</p></div><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820409127792"><h3>Perl</h3><p>To write MySQL scripts in Perl, the DBI module must be installed, as well as the MySQL-specific driver
        module, DBD::mysql. To obtain these modules if they’re not already
        installed, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>.</p><p>The following Perl script, <em class="filename">connect.pl</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="perl"><code class="ch">#!/usr/bin/perl</code>
<code class="c1"># connect.pl: connect to the MySQL server</code>

<code class="k">use</code> <code class="nn">strict</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">warnings</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">DBI</code><code class="p">;</code>

<code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:host=localhost;database=cookbook"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">)</code>
            <code class="ow">or</code> <code class="nb">die</code> <code class="s">"Cannot connect to server\n"</code><code class="p">;</code>
<code class="k">print</code> <code class="s">"Connected\n"</code><code class="p">;</code>
<code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">disconnect</code> <code class="p">();</code>
<code class="k">print</code> <code class="s">"Disconnected\n"</code><code class="p">;</code></pre><p>To try <span class="command"><em>connect.pl</em></span>, locate it
        under the <em class="filename">api</em> directory of the
        <code>recipes</code> distribution and run it
        from the command line. The program should print two lines indicating
        that it connected and disconnected successfully:</p><pre data-type="programlisting">$ <strong><code>perl connect.pl</code></strong>
Connected
Disconnected</pre><p>
         In the rest of the section we will walk through the code and explain how it works.
       </p><div data-type="tip"><h6>Tip</h6><p>
            If you get <code>Access Denied</code> error when connect to MySQL 8.0 ensure that the version of DBD::MySQL is linked with the MySQL 8.0 client library or use authentication plugin <code>mysql_native_password</code> instead of default <code>caching_sha2_password</code> plugin. We discuss authentication plugins in <a data-type="xref" href="ch24.xhtml#nch-security-account-management">Recipe 24.2</a>
          </p></div><p>For background on running Perl programs, read <code>cmdline.pdf</code> in the recipes distribution (see
        the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p>The <code>use</code> <code>strict</code> line turns on strict variable checking and causes Perl to
        complain about any variables that are used without having been
        declared first. This precaution helps find errors that might otherwise
        go undetected.</p><p>The <code>use</code> <code>warnings</code> line turns on warning mode so that
        Perl produces warnings for any questionable constructs. Our example
        script has none, but it’s a good idea to get in the habit of enabling
        warnings to catch problems that occur during the script development
        process. <code>use</code> <code>warnings</code> is similar to specifying the Perl
        <code class="option">-w</code> command-line option, but provides more control over which warnings to
        display. (For more information, execute a <span class="command"><em>perldoc</em></span>
        <span class="command"><em>warnings</em></span> command.)</p><p>The <code>use</code> <code>DBI</code> statement tells Perl to load the DBI
        module. It’s unnecessary to load the MySQL driver module (DBD::mysql)
        explicitly. DBI does that itself when the script connects to the
        database server.</p><p>The next two lines establish the connection to MySQL by setting
        up a data source name (DSN) and calling the DBI <code>connect()</code> method. The arguments to <code>connect()</code> are the DSN, the MySQL username and password, and any
        connection attributes you want to specify. The DSN is required. The
        other arguments are optional, although usually it’s necessary to
        supply a username and password.</p><p>The DSN specifies which database driver to use and other options
        that indicate where to connect. For MySQL programs, the DSN has the
        format <code>DBI:mysql:<em><code>options</code></em></code>.
        The second colon in the DSN is required even if you specify no
        following options.</p><p>Use the DSN components as follows:</p><ul><li><p>The first component is always <code>DBI</code>. It’s not case sensitive.</p></li><li><p>The second component tells DBI which database driver to use,
            and it <em>is</em> case sensitive. For MySQL, the name
            must be <code>mysql</code>.</p></li><li><p>The third component, if present, is a semicolon-separated
            list of <em><code>name</code></em><code>=</code><em><code>value</code></em> pairs
            that specify additional connection options, in any order. For our
            purposes, the two most relevant options are <code>host</code> and
            <code>database</code>, to specify the
            hostname where the MySQL server is running and the default
            database.</p></li></ul><p>Based on that information, the DSN for connecting to the
        <code>cookbook</code> database on the local host
        <em class="filename">localhost</em> looks like this:</p><pre data-type="programlisting" data-code-language="perl"><code class="n">DBI:mysql:host</code><code class="o">=</code><code class="n">localhost</code><code class="p">;</code><code class="n">database</code><code class="o">=</code><code class="n">cookbook</code></pre><p>If you omit the <code>host</code> option,
        its default value is <code>localhost</code>.
        These two DSNs are <span class="keep-together">equivalent</span>:</p><pre data-type="programlisting" data-code-language="perl"><code class="n">DBI:mysql:host</code><code class="o">=</code><code class="n">localhost</code><code class="p">;</code><code class="n">database</code><code class="o">=</code><code class="n">cookbook</code>
<code class="n">DBI:mysql:database</code><code class="o">=</code><code class="n">cookbook</code></pre><p>To select no default database, omit the <code>database</code> option.</p><p>The second and third arguments of the <code>connect()</code> call are your MySQL username and
        password. Following the password, you can also provide a fourth
        argument to specify attributes that control DBI’s behavior when errors
        occur. With no attributes, DBI by default prints error messages when
        errors occur but does not terminate your script. That’s why <span class="command"><em>connect.pl</em></span> checks whether <code>connect()</code> returns <code>undef</code>, which indicates failure:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">)</code>
            <code class="ow">or</code> <code class="nb">die</code> <code class="s">"Cannot connect to server\n"</code><code class="p">;</code></pre><p>Other error-handling strategies are possible. For example, to
        tell DBI to terminate the script if an error occurs in any DBI call,
        disable the <code>PrintError</code>
        attribute and enable <code>RaiseError</code>
        instead:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">,</code>
                        <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">});</code></pre><p>Then you need not check for errors yourself. The trade-off is
        that you also lose the ability to decide how your program recovers
        from errors. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses error
        handling further.</p><p>Another common attribute is <code>AutoCommit</code>, which sets the connection’s auto-commit mode for transactions.
        MySQL enables this by default for new connections, but we’ll set it
        from this point on to make the initial connection state
        explicit:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">,</code>
                        <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">});</code></pre><p>As shown, the fourth argument to <code>connect()</code> is a reference to a hash of
        attribute name/value pairs. An alternative way of writing this code
        follows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"cbuser"</code><code class="p">,</code> <code class="s">"cbpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p>Use whichever style you prefer. Scripts in this book use the
        <code>$conn_attr</code> hashref to make <code>connect()</code> calls simpler to read.</p><p>Assuming that <code>connect()</code>
        succeeds, it returns a database handle that contains information about
        the state of the connection. (In DBI parlance, references to objects
        are called handles.) Later we’ll see other handles such as statement
        handles, which are associated with particular statements. Perl DBI
        scripts in this book conventionally use <code>$dbh</code> and <code>$sth</code> to signify database and statement
        handles.</p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820408745520"><h4>Additional connection parameters</h4><p>To specify the path to a socket file for <em class="filename">localhost</em> connections on Unix, provide a
          <code>mysql_socket</code> option in the DSN:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:host=localhost;database=cookbook"</code>
          <code class="o">.</code> <code class="s">";mysql_socket=/var/tmp/mysql.sock"</code><code class="p">;</code></pre><p>To specify the port number for non-<em class="filename">localhost</em> (TCP/IP) connections,
          provide a <code>port</code>
          option:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:host=127.0.0.1;database=cookbook;port=3307"</code><code class="p">;</code></pre></div></section></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820405879664"><h3>Ruby</h3><p>
          To write MySQL scripts in Ruby, the Mysql2 gem must be installed. To obtain this gem if it is not already installed, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>.
        </p><p>The following Ruby script, <em class="filename">connect.rb</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="ruby"><code class="ch">#!/usr/bin/ruby -w</code>
<code class="c1"># connect.rb: connect to the MySQL server</code>

<code class="nb">require</code> <code class="s2">"mysql2"</code>

<code class="k">begin</code>
  <code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:host</code> <code class="o">=&gt;</code> <code class="s2">"localhost"</code><code class="p">,</code> 
                              <code class="ss">:username</code> <code class="o">=&gt;</code> <code class="s2">"cbuser"</code><code class="p">,</code>
                              <code class="ss">:password</code> <code class="o">=&gt;</code> <code class="s2">"cbpass"</code><code class="p">,</code>
                              <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code>
  <code class="nb">puts</code> <code class="s2">"Connected"</code>
<code class="k">rescue</code> <code class="o">=&gt;</code> <code class="n">e</code>
  <code class="nb">puts</code> <code class="s2">"Cannot connect to server"</code>
  <code class="nb">puts</code> <code class="n">e</code><code class="o">.</code><code class="n">backtrace</code>
  <code class="nb">exit</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="k">ensure</code>
  <code class="n">client</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
  <code class="nb">puts</code> <code class="s2">"Disconnected"</code>
<code class="k">end</code></pre><p>To try <span class="command"><em>connect.rb</em></span>, locate it
        under the <em class="filename">api</em> directory of the
        <code>recipes</code> distribution and run it
        from the command line. The program should print two lines indicating
        that it connected and disconnected successfully:</p><pre data-type="programlisting">$ <strong><code>ruby connect.rb</code></strong>
Connected
Disconnected</pre><p>For background on running Ruby programs, read <code>cmdline.pdf</code> in the recipes distribution (see
        the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p>The <code class="option">-w</code> option turns on warning mode so that Ruby produces warnings for any
        questionable constructs. Our example script has no such constructs,
        but it’s a good idea to get in the habit of using <code class="option">-w</code>
        to catch problems that occur during the script development
        process.</p><p>The <code>require</code> statement tells
        Ruby to load the Mysql2 module.
        </p><p>
          To establish the connection, create a <code>Mysql2::Client</code> object. Pass connection parameters as named arguments for the method <code>new</code>.
        </p><p>To select no default database, omit the <code>database</code> option.</p><p>Assuming that the <code>Mysql2::Client</code> object successfully created, it will act as a database handle that contains information
        about the state of the connection. Ruby scripts in this book
        conventionally use <code>client</code> to signify a
        database handle object.</p><p>If the <code>new()</code> method
        fails, it raises an exception. To handle exceptions, put the
        statements that might fail inside a <code>begin</code> block, and use a <code>rescue</code> clause that contains the
        error-handling code. Exceptions that occur at the top level of a
        script (that is, outside of any <code>begin</code> block) are caught by the default
        exception handler, which prints a stack trace and exits. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses error handling
        further.</p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820405707520"><h4>Additional connection parameters</h4><p>To specify the path to a socket file for <em class="filename">localhost</em> connections on Unix, provide a
          <code>socket</code> option for the method <code>new</code>:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:host</code> <code class="o">=&gt;</code> <code class="s2">"localhost"</code><code class="p">,</code>
                            <code class="ss">:socket</code> <code class="o">=&gt;</code> <code class="s2">"/var/tmp/mysql.sock"</code><code class="p">,</code>
                            <code class="ss">:username</code> <code class="o">=&gt;</code> <code class="s2">"cbuser"</code><code class="p">,</code>
                            <code class="ss">:password</code> <code class="o">=&gt;</code> <code class="s2">"cbpass"</code><code class="p">,</code>
                            <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code></pre><p>To specify the port number for non-<em class="filename">localhost</em> (TCP/IP) connections,
          provide a <code>port</code>
          option:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:host</code> <code class="o">=&gt;</code> <code class="s2">"127.0.0.1"</code><code class="p">,</code>
                            <code class="ss">:port</code> <code class="o">=&gt;</code> <code class="mi">3307</code><code class="p">,</code>
                            <code class="ss">:username</code> <code class="o">=&gt;</code> <code class="s2">"cbuser"</code><code class="p">,</code>
                            <code class="ss">:password</code> <code class="o">=&gt;</code> <code class="s2">"cbpass"</code><code class="p">,</code>
                            <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820405673984"><h3>PHP</h3><p>To write PHP scripts that use MySQL, your PHP interpreter must have MySQL support compiled in. If
        your scripts are unable to connect to your MySQL server, check the
        instructions included with your PHP distribution to see how to enable
        MySQL support.</p><p>PHP actually has multiple extensions that enable the use of
        MySQL, such as <code>mysql</code>, the original
        (and now deprecated) MySQL extension; <code>mysqli</code>, the <q>MySQL improved</q>
        extension; and, more recently, the MySQL driver for the PDO (PHP Data Objects) interface. PHP scripts in
        this book use PDO. To obtain PHP and PDO if they’re not already
        installed, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>.</p><p>PHP scripts usually are written for use with a web server. I
        assume that if you use PHP that way, you can copy PHP scripts into
        your server’s document tree, request them from your browser, and they
        will execute. For example, if you run Apache as the web server on the
        host <em class="filename">localhost</em> and you install a
        PHP script named <span class="command"><em>myscript.php</em></span> at
        the top level of the Apache document tree, you should be able to
        access the script by requesting this URL:</p><pre data-type="programlisting">http://localhost/myscript.php</pre><p>This book uses the <em class="filename">.php</em>
        extension (suffix) for PHP script filenames, so your web server must
        be configured to recognize the <em class="filename">.php</em> extension. Otherwise, when you
        request a PHP script from your browser, the server simply sends the
        literal text of the script and that’s what appears in your browser
        window. You don’t want this to happen, particularly if the script
        contains the username and password for connecting to MySQL.</p><p>PHP scripts often are written as a mixture of HTML and PHP code,
        with the PHP code embedded between the special <code>&lt;?php</code> and <code>?&gt;</code> tags. Here is an example:</p><pre data-type="programlisting" data-code-language="php"><code class="o">&lt;</code><code class="nx">html</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">head</code><code class="o">&gt;&lt;</code><code class="nx">title</code><code class="o">&gt;</code><code class="nx">A</code> <code class="nx">simple</code> <code class="nx">page</code><code class="o">&lt;/</code><code class="nx">title</code><code class="o">&gt;&lt;/</code><code class="nx">head</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">body</code><code class="o">&gt;</code>
<code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
<code class="o">&lt;?</code><code class="nx">php</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"I am PHP code, hear me roar!"</code><code class="p">);</code>
<code class="cp">?&gt;</code><code class="x"/>
<code class="x">&lt;/p&gt;</code>
<code class="x">&lt;/body&gt;</code>
<code class="x">&lt;/html&gt;</code></pre><p>For brevity in examples consisting entirely of PHP code,
        typically I’ll omit the enclosing <code>&lt;?php</code> and <code>?&gt;</code> tags. If you see no tags in a PHP
        example, assume that <code>&lt;?php</code> and
        <code>?&gt;</code> surround the entire block of
        code that is shown. Examples that switch between HTML and PHP code do
        include the tags, to make it clear what is PHP code and what is
        not.</p><p>PHP can be configured to recognize <q>short</q> tags as
        well, written as <code>&lt;?</code> and <code>?&gt;</code>. This book does not assume that you
        have short tags enabled and does not use them.</p><p>The following PHP script, <em class="filename">connect.php</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="php"><code class="o">&lt;?</code><code class="nx">php</code>
<code class="c1"># connect.php: connect to the MySQL server</code>

<code class="k">try</code>
<code class="p">{</code>
  <code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=localhost;dbname=cookbook"</code><code class="p">;</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">PDO</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s2">"cbuser"</code><code class="p">,</code> <code class="s2">"cbpass"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">catch</code> <code class="p">(</code><code class="nx">PDOException</code> <code class="nv">$e</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">die</code> <code class="p">(</code><code class="s2">"Cannot connect to server</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>
<code class="nv">$dbh</code> <code class="o">=</code> <code class="k">NULL</code><code class="p">;</code>
<code class="k">print</code> <code class="p">(</code><code class="s2">"Disconnected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="cp">?&gt;</code><code class="x"/></pre><p>To try <span class="command"><em>connect.php</em></span>, locate it
        under the <em class="filename">api</em> directory of the
        <code>recipes</code> distribution, copy it to
        your web server’s document tree, and request it using your browser.
        Alternatively, if you have a standalone version of the PHP interpreter
        for use from the command line, execute the script directly:</p><pre data-type="programlisting">$ <strong><code>php connect.php</code></strong>
Connected
Disconnected</pre><p>For background on running PHP programs, read <code>cmdline.pdf</code> in the recipes distribution (see
        the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p><code>$dsn</code> is the data source name
        (DSN) that indicates how to connect to the database
        server. It has this general syntax:</p><pre data-type="programlisting"><em><code>driver</code></em>:<em><code>name=value</code></em>;<em><code>name=value</code></em> ...</pre><p>The <em><code>driver</code></em> value is the PDO driver
        type. For MySQL, this is <code>mysql</code>.</p><p>Following the driver name, semicolon-separated
        <em><code>name</code></em><code>=</code><em><code>value</code></em> pairs
        specify connection parameters, in any order. For our purposes, the two
        most relevant options are <code>host</code> and <code>dbname</code>, to specify the hostname where the
        MySQL server is running and the default database. To select no default
        database, omit the <code>dbname</code>
        option.</p><p>To establish the connection, invoke the <code>new</code> <code>PDO()</code> class constructor, passing to it the
        appropriate arguments. The DSN is required. The other arguments are
        optional, although usually it’s necessary to supply a username and
        password. If the connection attempt succeeds, <code>new</code> <code>PDO()</code>
        returns a database-handle object that is used to access other
        MySQL-related methods. PHP scripts in this book conventionally use
        <code>$dbh</code> to signify a database
        handle.</p><p>If the connection attempt fails, PDO raises an exception. To
        handle this, put the connection attempt within a <code>try</code> block and use a <code>catch</code> block that contains the error-handling
        code, or just let the exception terminate your script. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses error handling
        further.</p><p>To disconnect, set the database handle to <code>NULL</code>. There is no explicit disconnect
        call.</p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820405387232"><h4>Additional connection parameters</h4><p>To specify the path to a socket file for <em class="filename">localhost</em> connections on Unix, provide
          a <code>unix_socket</code>
          option in the DSN:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=localhost;dbname=cookbook"</code>
         <code class="o">.</code> <code class="s2">";unix_socket=/var/tmp/mysql.sock"</code><code class="p">;</code></pre><p>To specify the port number for non-<em class="filename">localhost</em>
          (TCP/IP) connections, provide a <code>port</code> option:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=127.0.0.1;database=cookbook;port=3307"</code><code class="p">;</code></pre></div></section></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820405379872"><h3>Python</h3><p>To write MySQL programs in Python, a module must be installed that provides MySQL
        connectivity for the Python DB API, also known as Python Database API
        Specification v2.0 (PEP 249). This book uses MySQL Connector/Python.
        To obtain it if it’s not already installed, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>.</p><p>To use the DB API, import the database driver module that you
        want to use (which is <code>mysql.connector</code> for MySQL programs that use
        Connector/Python). Then create a database connection object by calling
        the driver’s <code>connect()</code>
        method. This object provides access to other DB API methods, such as
        the <code>close()</code> method
        that serves the connection to the database server.</p><p>The following Python script, <em class="filename">connect.py</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="python"><code class="ch">#!/usr/bin/python3</code>
<code class="c1"># connect.py: connect to the MySQL server</code>

<code class="kn">import</code> <code class="nn">mysql.connector</code>

<code class="k">try</code><code class="p">:</code>
  <code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="n">database</code><code class="o">=</code><code class="s2">"cookbook"</code><code class="p">,</code>
                                 <code class="n">host</code><code class="o">=</code><code class="s2">"localhost"</code><code class="p">,</code>
                                 <code class="n">user</code><code class="o">=</code><code class="s2">"cbuser"</code><code class="p">,</code>
                                 <code class="n">password</code><code class="o">=</code><code class="s2">"cbpass"</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code>
<code class="k">except</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Cannot connect to server"</code><code class="p">)</code>
<code class="k">else</code><code class="p">:</code>
  <code class="n">conn</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Disconnected"</code><code class="p">)</code></pre><p>To try <span class="command"><em>connect.py</em></span>, locate it
        under the <em class="filename">api</em> directory of the
        <code>recipes</code> distribution and run it
        from the command line. The program should print two lines indicating
        that it connected and disconnected successfully:</p><pre data-type="programlisting">$ <strong><code>python3 connect.py</code></strong>
Connected
Disconnected</pre><p>For background on running Python programs, read <code>cmdline.pdf</code> in the recipes distribution (see
        the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p>The <code>import</code> line tells Python
        to load the <code>mysql.connector</code> module.
        Then the script attempts to establish a connection to the MySQL server
        by calling <code>connect()</code> to obtain a
        connection object. Python scripts in this book conventionally use
        <code>conn</code> to signify connection
        objects.</p><p>If the <code>connect()</code> method
        fails, Connector/Python raises an exception. To handle exceptions, put
        the statements that might fail inside a <code>try</code> statement and
        use an <code>except</code> clause that contains
        the error-handling code. Exceptions that occur at the top level of a
        script (that is, outside of any <code>try</code>
        statement) are caught by the default exception handler, which prints a
        stack trace and exits. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses
        error handling further.</p><p>The <code>else</code> clause contains
        statements that execute if the <code>try</code>
        clause produces no exception. It’s used here to close the successfully
        opened connection.</p><p>Because the <code>connect()</code> call
        uses named arguments, their order does not matter. If you omit the
        <code>host</code> argument from the <code>connect()</code> call, its default value is
        <code>127.0.0.1</code>. To select no default
        database, omit the <code>database</code>
        argument or pass a <code>database</code> value
        of <code>""</code> (the empty string) or
        <code>None</code>.</p><p>Another way to connect is to specify the parameters using a
        Python dictionary and pass the dictionary to <code>connect()</code>:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"host"</code><code class="p">:</code> <code class="s2">"localhost"</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"cbpass"</code><code class="p">,</code>
<code class="p">}</code>
<code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="o">**</code><code class="n">conn_params</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code></pre><p>This book generally uses that style from now on.</p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820405139424"><h4>Additional connection parameters</h4><p>To specify the path to a socket file for local host
          connections on Unix, omit the <code>host</code> parameter and provide a <code>unix_socket</code>
          parameter:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"unix_socket"</code><code class="p">:</code> <code class="s2">"/var/tmp/mysql.sock"</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"cbpass"</code><code class="p">,</code>
<code class="p">}</code>
<code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="o">**</code><code class="n">conn_params</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code></pre><p>To specify the port number for TCP/IP connections, include the <code>host</code>
          parameter and provide an integer-valued <code>port</code> parameter:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"host"</code><code class="p">:</code> <code class="s2">"127.0.0.1"</code><code class="p">,</code>
  <code class="s2">"port"</code><code class="p">:</code> <code class="mi">3307</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"cbpass"</code><code class="p">,</code>
<code class="p">}</code>
<code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="o">**</code><code class="n">conn_params</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820405095088"><h3>Go</h3><p>To write MySQL programs in Go, a Go SQL Driver must be installed.
        This book uses <a href="https://github.com/go-sql-driver/mysql">Go-MySQL-Driver</a>.
        To obtain it if it’s not already installed, install <span class="command"><em>Git</em></span>, then issue the following command.</p><pre data-type="programlisting">$ go get -u github.com/go-sql-driver/mysql</pre><p>To use the Go SQL interface, import <code>database/sql</code> package and your driver package. Then create a database connection object by calling
        the <code>sql.Open()</code>
        function. This object provides access to other <code>database/sql</code> package functions, such as
        the <code>db.Close()</code>
        that closes the connection to the database server. We also use <code>defer</code>
        statement to call the <code>db.Close()</code> to make sure the 
        function call is performed later in the program execution. 
        You will see this usage throughout this chapter.</p><div data-type="tip"><h6>Tip</h6><p>
            Go package <code>database/sql</code> and the Go-MySQL-Driver support context cancellation. This means that you can cancel database operations, such as running a query, if cancel the context. To use this feature you need to call context-aware functions of the <code>sql</code> interface. For the brevity we would not use <code>Context</code> in our examples in this chapter. We will have example of using <code>Context</code> when discuss transaction handling in <a data-type="xref" href="ch20.xhtml#nch-xact-xact-go-context">Recipe 20.9</a>.
          </p></div><p>The following Go script, <em class="filename">connect.go</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="go"><code class="c1">// connect.go: connect to MySQL server</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">    </code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">    </code><code class="s">"fmt"</code><code class="w"/>
<code class="w">    </code><code class="s">"log"</code><code class="w"/>

<code class="w">    </code><code class="nx">_</code><code class="w"> </code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>

<code class="w">    </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"> </code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook"</code><code class="p">)</code><code class="w"/>

<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>
<code class="w">    </code>
<code class="w">    </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Ping</code><code class="p">()</code><code class="w"/>

<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>


<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Connected!"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>To try <span class="command"><em>connect.go</em></span>, locate it
        under the <em class="filename">api/01_connect</em> directory of the
        <code>recipes</code> distribution and run it
        from the command line. The program should print single line indicating
        that it connected:</p><pre data-type="programlisting">$ <strong><code>go run connect.go</code></strong>
Connected!</pre><p>The <code>import</code> line tells Go
        to load the <code>go-sql-driver/mysql</code> package.
        
        Then the script validates connection parameters and obtains a connection object by calling <code>sql.Open()</code>. <em>No MySQL connection established yet!</em>
        </p><p>If the <code>sql.Open()</code> method
        fails, <code>go-sql-driver/mysql</code> returns an error. To handle the error, store it into a variable (in our example <code>err</code>) and
        use an <code>if</code> block that contains
        the error-handling code. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses
        error handling further.</p><p>
        The <code>db.Ping()</code> call establishes the database connection. Only at this moment we can say that we connected to the MySQL server successfully.
        </p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820404836784"><h4>Additional connection parameters</h4><p>To specify the path to a socket file for local host
          connections on Unix, omit the <code>tcp</code> parameter in the DSN and provide a <code>unix</code>
          parameter:</p><pre data-type="programlisting" data-code-language="go"><code class="c1">// connect_socket.go : Connect MySQL server using socket</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">    </code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">    </code><code class="s">"fmt"</code><code class="w"/>
<code class="w">    </code><code class="s">"log"</code><code class="w"/>

<code class="w">    </code><code class="nx">_</code><code class="w"> </code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="s">"cbuser:cbpass@unix(/tmp/mysql.sock)/cookbook"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>


<code class="w">    </code><code class="kd">var</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">QueryRow</code><code class="p">(</code><code class="s">"SELECT USER()"</code><code class="p">).</code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">user</code><code class="p">)</code><code class="w"/>

<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Connected User:"</code><code class="p">,</code><code class="w"> </code><code class="nx">user</code><code class="p">,</code><code class="w"> </code><code class="s">"via MySQL socket"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
            Run this program:
            </p><pre data-type="programlisting" data-code-language="sh">$ <strong><code>go run connect_socket.go</code></strong>
Connected User: cbuser@localhost via MySQL socket</pre><p>            
          </p><p>To specify the port number for TCP/IP connections, include the <code>tcp</code>
          parameter into the DSN and provide an integer-valued <code>port</code> port number:</p><pre data-type="programlisting" data-code-language="go"><code class="c1">// connect_tcpport.go : Connect MySQL server using tcp port number</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">	</code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">	</code><code class="s">"fmt"</code><code class="w"/>
<code class="w">	</code><code class="s">"log"</code><code class="w"/>

<code class="w">	</code><code class="nx">_</code><code class="w"> </code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"/>
<code class="w">	</code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook?charset=utf8mb4"</code><code class="p">)</code><code class="w"/>

<code class="w">	</code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>

<code class="w">	</code><code class="kd">var</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="kt">string</code><code class="w"/>
<code class="w">	</code><code class="nx">err2</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">QueryRow</code><code class="p">(</code><code class="s">"SELECT USER()"</code><code class="p">).</code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">user</code><code class="p">)</code><code class="w"/>

<code class="w">	</code><code class="k">if</code><code class="w"> </code><code class="nx">err2</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err2</code><code class="p">)</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>

<code class="w">	</code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Connected User:"</code><code class="p">,</code><code class="w"> </code><code class="nx">user</code><code class="p">,</code><code class="w"> </code><code class="s">"via MySQL TCP/IP localhost on port 3306"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>Run this program:</p><pre data-type="programlisting">$  <strong><code>go run connect_tcpport.go</code></strong>
Connected User: cbuser@localhost via MySQL TCP/IP localhost on port 3306</pre><p>Go accepts DSN (Data Source Name) in this form:</p><pre data-type="programlisting">[username[:password]@][protocol[(address)]]/dbname[?param1=value1&amp;..&amp;paramN=valueN]</pre><p>
            Where <code>protocol</code> could be either <code>tcp</code> or <code>unix</code>.
          </p><p>A DSN in its fullest form is:</p><pre data-type="programlisting">username:password@protocol(address)/dbname?param=value</pre></div></section></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820404836480"><h3>Java</h3><p>Database programs in Java use the JDBC interface, together with a driver
        for the particular database engine you want to access. That is, the
        JDBC architecture provides a generic interface used in conjunction
        with a database-specific driver.</p><p>Java programming requires a Java Development Kit (JDK), and you must set your <code>JAVA_HOME</code>
        environment variable to the location where your JDK is installed. To
        write MySQL-based Java programs, you’ll also need a MySQL-specific
        JDBC driver. Programs in this book use MySQL Connector/J. To obtain it
        if it’s not already installed, see the Preface. For information about
        obtaining a JDK and setting <code>JAVA_HOME</code>, read <code>cmdline.pdf</code> in the recipes distribution (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p>The following Java program, <em class="filename">Connect.java</em>, connects to the MySQL server,
        selects <code>cookbook</code> as the default
        database, and disconnects:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// Connect.java: connect to the MySQL server</code>

<code class="kn">import</code> <code class="nn">java.sql.*</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Connect</code> <code class="o">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code> <code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Connection</code> <code class="n">conn</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://localhost/cookbook"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">userName</code> <code class="o">=</code> <code class="s">"cbuser"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">password</code> <code class="o">=</code> <code class="s">"cbpass"</code><code class="o">;</code>

    <code class="k">try</code> <code class="o">{</code>
      <code class="n">conn</code> <code class="o">=</code> <code class="n">DriverManager</code><code class="o">.</code><code class="na">getConnection</code> <code class="o">(</code><code class="n">url</code><code class="o">,</code> <code class="n">userName</code><code class="o">,</code> <code class="n">password</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Connected"</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Cannot connect to server"</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">exit</code> <code class="o">(</code><code class="mi">1</code><code class="o">);</code>
    <code class="o">}</code>
    
    <code class="k">if</code> <code class="o">(</code><code class="n">conn</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
      <code class="k">try</code> <code class="o">{</code>
        <code class="n">conn</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Disconnected"</code><code class="o">);</code>
      <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code> <code class="cm">/* ignore close errors */</code> <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre><p>To try <span class="command"><em>Connect.java</em></span>, locate
        it under the <em class="filename">api</em> directory of the
        <code>recipes</code> distribution, compile it,
        and execute it. The <code>class</code> statement
        indicates the program’s name, which in this case is
        <code>Connect</code>. The name of the file
        containing the program must match this name and include a <em class="filename">.java</em> extension, so the filename for the
        program is <em class="filename">Connect.java</em>. Compile
        the program using <span class="command"><em>javac</em></span>:</p><pre data-type="programlisting">$ <strong><code>javac Connect.java</code></strong></pre><p>If you prefer a different Java compiler, substitute its name for
        <span class="command"><em>javac</em></span>.</p><p>The Java compiler generates compiled byte code to produce a
        class file named <em class="filename">Connect.class</em>.
        Use the <span class="command"><em>java</em></span> program to run the
        class file (specified without the <em class="filename">.class</em> extension). The program should print
        two lines indicating that it connected and disconnected
        successfully:</p><pre data-type="programlisting">$ <strong><code>java Connect</code></strong>
Connected
Disconnected</pre><p>You might need to set your <code>CLASSPATH</code> environment variable before the example program will compile and
        run. The value of <code>CLASSPATH</code> should
        include at least your current directory (<code>.</code>) and the path to the Connector/J JDBC
        driver. For background on running Java programs or setting <code>CLASSPATH</code>, read <code>cmdline.pdf</code> in the recipes distribution (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><div data-type="tip"><h6>Tip</h6><p>
            Starting from Java 11, you can skip <span class="command"><em>javac</em></span> call for a single-file program and run it as:
            </p><pre data-type="programlisting">$ <strong><code>java Connect.java</code></strong>
Connected
Disconnected</pre><p>
          </p></div><p>The <code>import</code> <code>java.sql.*</code> statement references the classes and interfaces that provide
        access to the data types used to manage different aspects of your
        interaction with the database server. These are required for all JDBC
        programs.</p><p>To connect to the server call <code>DriverManager.getConnection()</code> to initiate
        the connection and obtain a <code>Connection</code> object that maintains information
        about the state of the connection. Java programs in this book
        conventionally use <code>conn</code> to signify
        connection objects.</p><p><code>DriverManager.getConnection()</code>
        takes three arguments: a URL that describes where to connect
        and the database to use, the MySQL username, and the password. The URL
        string has this format:</p><pre data-type="programlisting">jdbc:<em><code>driver</code></em>://<em><code>host_name</code></em>/<em><code>db_name</code></em></pre><p>This format follows the Java convention that the URL for
        connecting to a network resource begins with a protocol designator.
        For JDBC programs, the protocol is <code>jdbc</code>, and you’ll also need a subprotocol
        designator that specifies the driver name (<code>mysql</code>, for MySQL programs). Many parts of
        the connection URL are optional, but the leading protocol and
        subprotocol designators are not. If you omit
        <em><code>host_name</code></em>, the default host value is
        <code>localhost</code>. To select no default
        database, omit the database name. However, you should not omit any of
        the slashes in any case. For example, to connect to the local host
        without selecting a default database, the URL is:</p><pre data-type="programlisting">jdbc:mysql:///</pre><p>In JDBC, you don’t test method calls for return values that
        indicate an error. Instead, provide handlers to be called when
        exceptions are thrown. <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> discusses
        error handling further.</p><p>Some JDBC drivers (Connector/J among them) permit you to specify
        the username and password as parameters at the end of the URL. In this
        case, omit the second and third arguments of the <code>getConnection()</code> call. Using that URL style,
        write the code that establishes the connection in the example program
        like this:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// connect using username and password included in URL</code>
<code class="n">Connection</code> <code class="n">conn</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
<code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://localhost/cookbook?user=cbuser&amp;password=cbpass"</code><code class="o">;</code>

<code class="k">try</code>
<code class="o">{</code>
  <code class="n">conn</code> <code class="o">=</code> <code class="n">DriverManager</code><code class="o">.</code><code class="na">getConnection</code> <code class="o">(</code><code class="n">url</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"Connected"</code><code class="o">);</code>
<code class="o">}</code></pre><p>The character that separates the <code>user</code> and <code>password</code> parameters should be <code>&amp;</code>, not <code>;</code>.</p><section data-type="sect4" data-pdf-bookmark="Additional connection parameters"><div class="sect4" id="idm45820389028480"><h4>Additional connection parameters</h4><p>Connector/J does not natively support Unix domain socket file connections, so even
          connections for which the hostname is <em class="filename">localhost</em> are made via TCP/IP. To specify
          an explicit port number, add <code>:</code><em><code>port_num</code></em><code/> to the hostname in the connection URL:</p><pre data-type="programlisting" data-code-language="java"><code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://127.0.0.1:3307/cookbook"</code><code class="o">;</code></pre><p>
            However, you can use 3rd-party libraries that provide support for connections via socket. See <a href="https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-unix-socket.html">Connecting Using Unix Domain Sockets</a> user reference manual page for details.
          </p></div></section></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.2 Checking for Errors"><div class="sect1" id="nch-api-api-error"><h1>4.2 Checking for Errors</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820389000080"><h2>Problem</h2><p>Something went wrong with your program, and you don’t know what.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820389012176"><h2>Solution</h2><p>Everyone has problems getting programs to work correctly. But if
      you don’t anticipate problems by checking for errors, the job becomes
      much more difficult. Add some error-checking code so your programs can
      help you figure out what went wrong.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820389011296"><h2>Discussion</h2><p>After working through <a data-type="xref" href="#nch-api-api-connect">Recipe 4.1</a>, you
      know how to connect to the MySQL server. It’s also a good idea to know
      how to check for errors and how to retrieve specific error information
      from the API, so we cover that next. You’re probably anxious to do more
      interesting things (such as executing statements and getting back the
      results), but error checking is fundamentally important. Programs
      sometimes fail, especially during development, and if you can’t
      determine why failures occur, you’re flying blind. Plan
      for failure by checking for errors so that you can take appropriate
      action.</p><p>When an error occurs, MySQL provides three values:</p><ul><li><p>A MySQL-specific error number</p></li><li><p>A MySQL-specific descriptive text error message</p></li><li><p>A five-character SQLSTATE error code defined according to the ANSI and ODBC
          standards</p></li></ul><p>This recipe show how to access this information.
      The example programs are deliberately designed to fail, so that the
      error-handling code executes. That’s why they attempt to connect using a
      username and password of <code>baduser</code> and
      <code>badpass</code>.</p><div data-type="tip"><h6>Tip</h6><p>A general debugging aid not specific to any API is to use the
        available logs. Check the MySQL server’s general query log to see what
        statements the server is receiving. (This requires that log to be
        enabled; see <a data-type="xref" href="ch22.xhtml#nch-admin-server-logs">Recipe 22.3</a>.) The general query log
        might show that your program is not constructing the SQL statement
        string you expect. Similarly, if you run a script under a web server
        and it fails, check the web server’s error log.</p></div><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820388992624"><h3>Perl</h3><p>The DBI module provides two attributes that control what happens when DBI method
        invocations fail:</p><ul><li><p><code>PrintError</code>, if enabled,
            causes DBI to print an error message using <code>warn()</code>.</p></li><li><p><code>RaiseError</code>, if enabled,
            causes DBI to print an error message using <code>die()</code>. This terminates your
            script.</p></li></ul><p>By default, <code>PrintError</code> is
        enabled and <code>RaiseError</code> is disabled,
        so a script continues executing after printing a message if an error
        occurs. Either or both attributes can be specified in the <code>connect()</code> call. Setting an attribute to 1 or
        0 enables or disables it, respectively. To specify either or both
        attributes, pass them in a hash reference as the fourth argument to
        the <code>connect()</code>
        call.</p><p>The following code sets only the <code>AutoCommit</code>
        attribute and uses the default settings for the error-handling
        attributes. If the <code>connect()</code> call
        fails, a warning message results, but the script continues to
        execute:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"baduser"</code><code class="p">,</code> <code class="s">"badpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p>Because you really can’t do much if the connection attempt
        fails, it’s often prudent to exit instead after DBI prints a
        message:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"baduser"</code><code class="p">,</code> <code class="s">"badpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">)</code>
            <code class="ow">or</code> <code class="nb">exit</code><code class="p">;</code></pre><p>To print your own error messages, leave <code>RaiseError</code> disabled and disable <code>PrintError</code> as well. Then test the results of
        DBI method calls yourself. When a method fails, the <code>$DBI::err</code>, <code>$DBI::errstr</code>, and <code>$DBI::state</code> variables contain the MySQL
        error number, a descriptive error string, and the SQLSTATE value,
        respectively:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"baduser"</code><code class="p">,</code> <code class="s">"badpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">)</code>
            <code class="ow">or</code> <code class="nb">die</code> <code class="s">"Connection error: "</code>
                   <code class="o">.</code> <code class="s">"$DBI::errstr ($DBI::err/$DBI::state)\n"</code><code class="p">;</code></pre><p>If no error occurs, <code>$DBI::err</code>
        is 0 or <code>undef</code>, <code>$DBI::errstr</code> is the empty string or <code>undef</code>, and <code>$DBI::state</code> is empty or <code>00000</code>.</p><p>When you check for errors, access these variables immediately
        after invoking the DBI method that sets them. If you invoke another
        method before using them, DBI resets their values.</p><p>If you print your own messages, the default settings (<code>PrintError</code> enabled, <code>RaiseError</code> disabled) are not so useful. DBI
        prints a message automatically, then your script prints its own
        message. This is redundant, as well as confusing to the person using
        the script.</p><p>If you enable <code>RaiseError</code>, you
        can call DBI methods without checking for return values that indicate
        errors. If a method fails, DBI prints an error and terminates your
        script. If the method returns, you can assume it succeeded. This is
        the easiest approach for script writers: let DBI do all the error
        checking! However, if both <code>PrintError</code> and <code>RaiseError</code> are enabled, DBI may call
        <code>warn()</code> and <code>die()</code> in succession, resulting in error
        messages being printed twice. To avoid this problem, disable <code>PrintError</code> whenever you enable <code>RaiseError</code>:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s">"baduser"</code><code class="p">,</code> <code class="s">"badpass"</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p>This book generally uses that approach. If you don’t want the
        all-or-nothing behavior of enabling <code>RaiseError</code> for automatic error checking
        versus having to do all your own checking, adopt a mixed approach.
        Individual handles have <code>PrintError</code>
        and <code>RaiseError</code> attributes that can
        be enabled or disabled selectively. For example, you can enable
        <code>RaiseError</code> globally by turning it
        on when you call <code>connect()</code>, and
        then disable it selectively on a per-handle basis.</p><p>Suppose that a script reads the username and password from the
        command-line arguments, and then loops while the user enters
        statements to be executed. In this case, you’d probably want DBI to
        die and print the error message automatically if the connection fails
        (you cannot proceed to the statement-execution loop in that case).
        After connecting, however, you wouldn’t want the script to exit just
        because the user enters a syntactically invalid statement. Instead,
        print an error message and loop to get the next statement. The
        following code shows how to do this. The <code>do()</code> method used in the example executes a statement and returns <code>undef</code> to
        indicate an error:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$user_name</code> <code class="o">=</code> <code class="nb">shift</code> <code class="p">(</code><code class="nv">@ARGV</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$password</code> <code class="o">=</code> <code class="nb">shift</code> <code class="p">(</code><code class="nv">@ARGV</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nv">$user_name</code><code class="p">,</code> <code class="nv">$password</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code>
<code class="nv">$dbh</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">RaiseError</code><code class="p">}</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code> <code class="c1"># disable automatic termination on error</code>
<code class="k">print</code> <code class="s">"Enter statements to execute, one per line; terminate with Control-D\n"</code><code class="p">;</code>
<code class="k">while</code> <code class="p">(</code><code class="o">&lt;&gt;</code><code class="p">)</code>              <code class="c1"># read and execute queries</code>
<code class="p">{</code>
  <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="nv">$_</code><code class="p">)</code> <code class="ow">or</code> <code class="nb">warn</code> <code class="s">"Statement failed: $DBI::errstr ($DBI::err)\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p>If <code>RaiseError</code> is enabled, you
        can execute code within an <code>eval</code>
        block to trap errors without terminating your program. If an error
        occurs, <code>eval</code> returns a message in
        the <code>$@</code> variable:</p><pre data-type="programlisting" data-code-language="perl"><code class="nb">eval</code>
<code class="p">{</code>
  <code class="c1"># statements that might fail go here...</code>
<code class="p">};</code>
<code class="k">if</code> <code class="p">(</code><code class="vg">$@</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="s">"An error occurred: $@\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p>This <code>eval</code> technique is
        commonly used to perform transactions (see <a data-type="xref" href="ch20.xhtml#nch-xact-xact-perl">Recipe 20.4</a>).</p><p>Using <code>RaiseError</code> in
        combination with <code>eval</code> differs from
        using <code>RaiseError</code> alone:</p><ul><li><p>Errors terminate only the <code>eval</code> block, not the entire
            script.</p></li><li><p>Any error terminates the <code>eval</code> block, whereas <code>RaiseError</code> applies only to DBI-related
            errors.</p></li></ul><p>When you use <code>eval</code> with
        <code>RaiseError</code> enabled, disable
        <code>PrintError</code>. Otherwise, in some
        versions of DBI, an error may simply cause <code>warn()</code> to be called without terminating the
        <code>eval</code> block as you expect.</p><p>In addition to using the error-handling attributes <code>PrintError</code> and <code>RaiseError</code>, lots of information about your
        script’s execution is available using DBI’s tracing mechanism. Invoke
        the <code>trace()</code> method with an argument
        indicating the trace level. Levels 1 to 9 enable tracing with
        increasingly more verbose output, and level 0 disables tracing:</p><pre data-type="programlisting" data-code-language="perl"><code class="nn">DBI</code><code class="o">-&gt;</code><code class="n">trace</code> <code class="p">(</code><code class="mi">1</code><code class="p">);</code> <code class="c1"># enable tracing, minimal output</code>
<code class="nn">DBI</code><code class="o">-&gt;</code><code class="n">trace</code> <code class="p">(</code><code class="mi">3</code><code class="p">);</code> <code class="c1"># elevate trace level</code>
<code class="nn">DBI</code><code class="o">-&gt;</code><code class="n">trace</code> <code class="p">(</code><code class="mi">0</code><code class="p">);</code> <code class="c1"># disable tracing</code></pre><p>Individual database and statement handles also have <code>trace()</code> methods, so you can localize tracing
        to a single handle if you want.</p><p>Trace output normally goes to your terminal (or, in the case of
        a web script, to the web server’s error log). To write trace output to
        a specific file, provide a second argument that indicates the
        filename:</p><pre data-type="programlisting" data-code-language="perl"><code class="nn">DBI</code><code class="o">-&gt;</code><code class="n">trace</code> <code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s">"/tmp/trace.out"</code><code class="p">);</code></pre><p>If the trace file already exists, its contents are not cleared
        first; trace output is appended to the end. Beware of turning on a
        file trace while developing a script, but forgetting to disable the
        trace when you put the script into production. You’ll eventually find
        to your chagrin that the trace file has become quite large. Or worse,
        a filesystem will fill up, and you’ll have no idea why!</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820388992160"><h3>Ruby</h3><p>Ruby signals errors by raising exceptions and Ruby programs handle
        errors by catching exceptions in a <code>rescue</code> clause of a <code>begin</code> block. Ruby Mysql2 methods raise
        exceptions when they fail and provide error information by means of a
        <code>Mysql2::Error</code> object.
        To get the MySQL error number, error message, and
        SQLSTATE value, access the <code>errno</code>,
        <code>message</code>, and <code>sql_state</code> methods of this object. The following
        example shows how to trap exceptions and access error information in a
        Ruby script:</p><pre data-type="programlisting" data-code-language="ruby"><code class="k">begin</code>
  <code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:host</code> <code class="o">=&gt;</code> <code class="s2">"localhost"</code><code class="p">,</code>
                              <code class="ss">:username</code> <code class="o">=&gt;</code> <code class="s2">"baduser"</code><code class="p">,</code>
                              <code class="ss">:password</code> <code class="o">=&gt;</code> <code class="s2">"badpass"</code><code class="p">,</code>
                              <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code>
  <code class="nb">puts</code> <code class="s2">"Connected"</code>
<code class="k">rescue</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Error</code> <code class="o">=&gt;</code> <code class="n">e</code>
  <code class="nb">puts</code> <code class="s2">"Cannot connect to server"</code>
  <code class="nb">puts</code> <code class="s2">"Error code: </code><code class="si">#{</code><code class="n">e</code><code class="o">.</code><code class="n">errno</code><code class="si">}</code><code class="s2">"</code>
  <code class="nb">puts</code> <code class="s2">"Error message: </code><code class="si">#{</code><code class="n">e</code><code class="o">.</code><code class="n">message</code><code class="si">}</code><code class="s2">"</code>
  <code class="nb">puts</code> <code class="s2">"Error SQLSTATE: </code><code class="si">#{</code><code class="n">e</code><code class="o">.</code><code class="n">sql_state</code><code class="si">}</code><code class="s2">"</code>
  <code class="nb">exit</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="k">ensure</code>
  <code class="n">client</code><code class="o">.</code><code class="n">close</code><code class="p">()</code><code class="n">s</code>
<code class="k">end</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820388535024"><h3>PHP</h3><p>The <code>new</code> <code>PDO()</code> constructor raises an exception if it fails, but other PDO methods
        by default indicate success or failure by their return value. To cause
        all PDO methods to raise exceptions for errors, use the database
        handle resulting from a successful connection attempt to set the
        error-handling mode. This enables uniform handling of all PDO errors
        without checking the result of every call. The following example shows
        how to set the error mode if the connection attempt succeeds and how
        to handle exceptions if it fails:</p><pre data-type="programlisting" data-code-language="php"><code class="k">try</code>
<code class="p">{</code>
  <code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=localhost;dbname=cookbook"</code><code class="p">;</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">PDO</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="s2">"baduser"</code><code class="p">,</code> <code class="s2">"badpass"</code><code class="p">);</code>
  <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">setAttribute</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">ATTR_ERRMODE</code><code class="p">,</code> <code class="nx">PDO</code><code class="o">::</code><code class="na">ERRMODE_EXCEPTION</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">catch</code> <code class="p">(</code><code class="nx">PDOException</code> <code class="nv">$e</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Cannot connect to server</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error code: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getCode</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error message: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getMessage</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code></pre><p>When PDO raises an exception, the resulting <code>PDOException</code> object provides error information. The <code>getCode()</code> method returns the SQLSTATE value.
        The <code>getMessage()</code> method returns a string containing the SQLSTATE value, MySQL
        error number, and error message.</p><p>Database and statement handles also provide information when an
        error occurs. For either type of handle, <code>errorCode()</code> returns the SQLSTATE value and <code>errorInfo()</code> returns a three-element array
        containing the SQLSTATE value and a driver-specific error code and
        message. For MySQL, the latter two values are the error number and
        message string. The following example demonstrates how to get
        information from the exception object and the database handle:</p><pre data-type="programlisting" data-code-language="php"><code class="k">try</code>
<code class="p">{</code>
  <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">query</code> <code class="p">(</code><code class="s2">"SELECT"</code><code class="p">);</code> <code class="c1"># malformed query</code>
<code class="p">}</code>
<code class="k">catch</code> <code class="p">(</code><code class="nx">PDOException</code> <code class="nv">$e</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Cannot execute query</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error information using exception object:</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"SQLSTATE value: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getCode</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error message: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getMessage</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>

  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error information using database handle:</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error code: "</code> <code class="o">.</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">errorCode</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="nv">$errorInfo</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">errorInfo</code> <code class="p">();</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"SQLSTATE value: "</code> <code class="o">.</code> <code class="nv">$errorInfo</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error number: "</code> <code class="o">.</code> <code class="nv">$errorInfo</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error message: "</code> <code class="o">.</code> <code class="nv">$errorInfo</code><code class="p">[</code><code class="mi">2</code><code class="p">]</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820388311808"><h3>Python</h3><p>Python signals errors by raising exceptions, and Python programs handle
        errors by catching exceptions in the <code>except</code> clause of a <code>try</code> statement. To obtain MySQL-specific
        error information, name an exception class, and provide a variable to
        receive the information. Here’s an example:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"host"</code><code class="p">:</code> <code class="s2">"localhost"</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"baduser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"badpass"</code>
<code class="p">}</code>

<code class="k">try</code><code class="p">:</code>
  <code class="n">conn</code> <code class="o">=</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="o">**</code><code class="n">conn_params</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code>
<code class="k">except</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">Error</code> <code class="k">as</code> <code class="n">e</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Cannot connect to server"</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Error code: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">e</code><code class="o">.</code><code class="n">errno</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Error message: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">e</code><code class="o">.</code><code class="n">msg</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Error SQLSTATE: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">e</code><code class="o">.</code><code class="n">sqlstate</code><code class="p">)</code></pre><p>If an exception occurs, the <code>errno</code>, <code>msg</code>, and <code>sqlstate</code> members of the exception object
        contain the error number, error message, and SQLSTATE values,
        respectively. Note that access to the <code>Error</code> class is through the driver module
        name.</p></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820388019264"><h3>Go</h3><p>Go does not support exceptions. Instead, its multi-value returns make it easy to pass error when needed. To handle errors in Go, store returned value of the type <code>Error</code> into a variable (we use variable name <code>err</code> here) and handle it accordingly. To handle errors Go offers <code>defer</code> statement, <code>Panic()</code> and <code>Recover()</code> built-in functions.</p><table id="nch-api-api-error-go"><caption><span class="label">Table 4-2. </span>Error handling in Go</caption><thead><tr><th>Function or statement</th><th>Meaning</th></tr></thead><tbody><tr><td><code>defer</code></td><td>Defers statement execution until the calling function returns.</td></tr><tr><td><code>Panic()</code></td><td>The calling function normal execution stops, all deferred functions are executed, then the function returns a call to panic up the stack. The process continues. Finally, the program crashes.</td></tr><tr><td><code>Recover()</code></td><td>Allows to regain control in the panicking goroutine, so the program would not crash and continue executing. Only works in the deferred functions. If called in the function that is not deferred, does nothing and returns <code>nil</code>.</td></tr></tbody></table><pre data-type="programlisting" data-code-language="go"><code class="c1">// mysql_error.go : MySQL error handling</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">    </code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">    </code><code class="s">"log"</code><code class="w"/>
<code class="w">    </code><code class="s">"fmt"</code><code class="w"/>

<code class="w">    </code><code class="nx">_</code><code class="w"> </code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">var</code><code class="w"> </code><code class="nx">actor</code><code class="w"> </code><code class="kt">string</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>

<code class="w">    </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"> </code><code class="s">"cbuser:cbpass!@tcp(127.0.0.1:3306)/cookbook"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">QueryRow</code><code class="p">(</code><code class="s">"SELECT actor FROM actors where actor='Dwayne Johnson'"</code><code class="p">).</code><code class="err">↩</code><code class="w"/>
<code class="w">          </code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">actor</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">ErrNoRows</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Print</code><code class="p">(</code><code class="s">"There were no rows, but otherwise no error occurred"</code><code class="p">)</code><code class="w"/>
<code class="w">	    </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">err</code><code class="p">.</code><code class="nx">Error</code><code class="p">())</code><code class="w"/>
<code class="w">	    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="nx">actor</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>If an error occurs, the function returns an object of the type <code>error</code>. Its function <code>Error()</code> returns MySQL error code and message for the errors, raised by the <code>Go-MySQL-Driver</code>.</p><p>
          There is exceptional case for the function <code>QueryRow()</code> with subsequent <code>Scan()</code> call. By default <code>Scan()</code> returns <code>nil</code> if there is no error and <code>error</code> if there is any error. However, in case if the query run successfully but returned no rows this function returns <code>sql.ErrNoRows</code>.
        </p></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820387651312"><h3>Java</h3><p>Java programs handle errors by catching exceptions. To do the minimum
        amount of work, print a stack trace to inform the user where the
        problem lies:</p><pre data-type="programlisting" data-code-language="java"><code class="k">try</code>
<code class="o">{</code>
  <code class="cm">/* ... some database operation ... */</code>
<code class="o">}</code>
<code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code>
<code class="o">{</code>
  <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code> <code class="o">();</code>
<code class="o">}</code></pre><p>The stack trace shows the location of the problem but not
        necessarily what the problem was. Also, it may not be meaningful
        except to you, the program’s developer. To be more specific, print the
        error message and code associated with an exception:</p><ul><li><p>All <code>Exception</code> objects
            support the <code>getMessage()</code> method. JDBC methods may throw exceptions using <code>SQLException</code> objects; these are like
            <code>Exception</code> objects but also
            support <code>getErrorCode()</code> and <code>getSQLState()</code> methods. <code>getErrorCode()</code> and <code>getMessage()</code> return the MySQL-specific
            error number and message string, and <code>getSQLState()</code>
            returns a string containing the SQLSTATE value.</p></li><li><p>Some methods generate <code>SQLWarning</code>
            objects to provide information about nonfatal warnings. <code>SQLWarning</code> is a subclass of <code>SQLException</code>, but warnings are
            accumulated in a list rather than thrown immediately. They don’t
            interrupt your program, and you can print them at your
            leisure.</p></li></ul><p>The following example program, <em class="filename">Error.java</em>, demonstrates how to access
        error messages by printing all the error information available to it.
        It attempts to connect to the MySQL server and prints exception
        information if the attempt fails. Then it executes a statement and
        prints exception and warning information if the statement fails:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// Error.java: demonstrate MySQL error handling</code>

<code class="kn">import</code> <code class="nn">java.sql.*</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Error</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Connection</code> <code class="n">conn</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://localhost/cookbook"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">userName</code> <code class="o">=</code> <code class="s">"baduser"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">password</code> <code class="o">=</code> <code class="s">"badpass"</code><code class="o">;</code>

    <code class="k">try</code> <code class="o">{</code>
      <code class="n">conn</code> <code class="o">=</code> <code class="n">DriverManager</code><code class="o">.</code><code class="na">getConnection</code><code class="o">(</code><code class="n">url</code><code class="o">,</code> <code class="n">userName</code><code class="o">,</code> <code class="n">password</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Connected"</code><code class="o">);</code>
      <code class="n">tryQuery</code><code class="o">(</code><code class="n">conn</code><code class="o">);</code>    <code class="c1">// issue a query</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Cannot connect to server"</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">e</code> <code class="k">instanceof</code> <code class="n">SQLException</code><code class="o">)</code>  <code class="c1">// JDBC-specific exception?</code>
      <code class="o">{</code>
        <code class="c1">// e must be cast from Exception to SQLException to</code>
        <code class="c1">// access the SQLException-specific methods</code>
        <code class="n">printException</code><code class="o">((</code><code class="n">SQLException</code><code class="o">)</code> <code class="n">e</code><code class="o">);</code>
      <code class="o">}</code>
    <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">conn</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">try</code> <code class="o">{</code>
          <code class="n">conn</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code>
          <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Disconnected"</code><code class="o">);</code>
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">SQLException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
          <code class="n">printException</code> <code class="o">(</code><code class="n">e</code><code class="o">);</code>
        <code class="o">}</code>
      <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">tryQuery</code><code class="o">(</code><code class="n">Connection</code> <code class="n">conn</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">try</code> <code class="o">{</code>
      <code class="c1">// issue a simple query</code>
      <code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code><code class="o">();</code>
      <code class="n">s</code><code class="o">.</code><code class="na">execute</code><code class="o">(</code><code class="s">"USE cookbook"</code><code class="o">);</code>
      <code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>

      <code class="c1">// print any accumulated warnings</code>
      <code class="n">SQLWarning</code> <code class="n">w</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">getWarnings</code><code class="o">();</code>
      <code class="k">while</code> <code class="o">(</code><code class="n">w</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"SQLWarning: "</code> <code class="o">+</code> <code class="n">w</code><code class="o">.</code><code class="na">getMessage</code><code class="o">());</code>
        <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"SQLState: "</code> <code class="o">+</code> <code class="n">w</code><code class="o">.</code><code class="na">getSQLState</code><code class="o">());</code>
        <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Vendor code: "</code> <code class="o">+</code> <code class="n">w</code><code class="o">.</code><code class="na">getErrorCode</code><code class="o">());</code>
        <code class="n">w</code> <code class="o">=</code> <code class="n">w</code><code class="o">.</code><code class="na">getNextWarning</code><code class="o">();</code>
      <code class="o">}</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">SQLException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">printException</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>
    <code class="o">}</code>
  <code class="o">}</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">printException</code><code class="o">(</code><code class="n">SQLException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// print general message, plus any database-specific message</code>
    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"SQLException: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getMessage</code> <code class="o">());</code>
    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"SQLState: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getSQLState</code> <code class="o">());</code>
    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Vendor code: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getErrorCode</code> <code class="o">());</code>
  <code class="o">}</code>
<code class="o">}</code></pre></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.3 Writing Library Files"><div class="sect1" id="nch-api-api-library"><h1>4.3 Writing Library Files</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820387271248"><h2>Problem</h2><p>You notice that you’re repeating code to perform common operations in multiple
      <span class="keep-together">programs</span>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820387269744"><h2>Solution</h2><p>Write routines to perform those operations, put them in a library
      file, and arrange for your programs to access the library. This enables
      you to write the code only once. You might need to set an environment
      variable so that your scripts can find the library.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820387268768"><h2>Discussion</h2><p>This section describes how to put code for common operations in
      library files. Encapsulation (or modularization) isn’t really a
      <q>recipe</q> so much as a programming technique. Its principal
      benefit is that you need not repeat code in each program you write.
      Instead, simply call a routine that’s in the library. For example, by
      putting the code for connecting to the <code>cookbook</code> database into a library routine, you
      need not write out all the parameters associated with making that
      connection. Simply invoke the routine from your program, and you’re
      connected.</p><p>Connection establishment isn’t the only operation you can
      encapsulate, of course. Later sections in this book develop other
      utility functions to be placed in library files. All such files,
      including those shown in this section, are located under the <em class="filename">lib</em> directory of the <code>recipes</code> distribution. As you write your own
      programs, be on the lookout for operations that you perform often and
      that are good candidates for inclusion in a library. Use the techniques
      in this section to write your own library files.</p><p>Library files have other benefits besides making it easier to
      write programs, such as promoting portability. If you write connection
      parameters directly into each program that connects to the MySQL server,
      you must change all those programs if you move them to another machine
      that uses different parameters. If instead you write your programs to
      connect to the database by calling a library routine, it’s necessary
      only to modify the affected library routine, not all the programs that
      use it.</p><p>Code encapsulation can also improve security. If you make a
      private library file readable only to yourself, only scripts run by you
      can execute routines in the file. Or suppose that you have some scripts
      located in your web server’s document tree. A properly configured server
      executes the scripts and sends their output to remote clients. But if
      the server becomes misconfigured somehow, the result can be that it
      sends your scripts to clients as plain text, thus displaying your MySQL
      username and password.
      If you place the code for establishing a connection to the MySQL server
      in a library file located outside the document tree, those parameters
      won’t be exposed to clients.</p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>Be aware that if you install a library file to be readable by
        your web server, you don’t have much security if other developers use
        the same server. Any of those developers can write a web script to
        read and display your library file because, by default, the script
        runs with the permissions of the web server and thus will have access
        to the library.</p></div><p>The recipes that follow demonstrate how to write, for each API, a
      library file that contains a routine for connecting to the <code>cookbook</code> database on the MySQL server. The
      calling program can use the error-checking techniques discussed in <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a> to determine whether a connection attempt
      fails. The connection routine for each language returns a database
      handle or connection object when it succeeds or raises an exception if
      the connection cannot be established.</p><p>Libraries are of no utility in themselves, so the following
      discussion illustrates each one’s use by a short <a href="https://en.wikipedia.org/wiki/Test_harness"><q>test
      harness</q></a> program. To use any of these harness programs as the
      basis for creating new programs, make a copy of the file and add your
      own code between the connect and disconnect calls.</p><p>Library-file writing involves not only the question of what to put
      in the file but also subsidiary issues such as where to install the file
      so it is accessible by your programs, and (on multiuser systems such as
      Unix) how to set its access privileges so its contents aren’t exposed to
      people who shouldn’t see it.</p><section data-type="sect3" data-pdf-bookmark="Choosing a library-file installation location"><div class="sect3" id="idm45820387543744"><h3>Choosing a library-file installation location</h3><p>If you install a library file in a directory that a language processor searches by default,
        programs written in that language need do nothing special to access
        the library. However, if you install a library file in a directory
        that the language processor does not search by default, you must tell
        your scripts how to find it. There are two common ways to do
        this:</p><ul><li><p>Most languages provide a statement that can be used within a
            script to add directories to the language processor search path.
            This requires that you modify each script that needs the
            library.</p></li><li><p>You can set an environment or configuration variable that changes the language
            processor search path. With this approach, each user who executes
            scripts that require the library must set the appropriate
            variable. Alternatively, if the language processor has a
            configuration file, you might be able to set a parameter in the
            file that affects scripts globally for all users.</p></li></ul><p>We’ll use the second approach. For our API languages, the
        <a data-type="xref" href="#nch-api-api-library-path">Table 4-3</a> shows the relevant variables. In each case, the
        variable value is a directory or list of directories:</p><table id="nch-api-api-library-path"><caption><span class="label">Table 4-3. </span>Default Library Paths</caption><thead><tr><th>Language</th><th>Variable name</th><th>Variable type</th></tr></thead><tbody><tr><td>Perl</td><td><code>PERL5LIB </code></td><td>Environment variable</td></tr><tr><td>Ruby</td><td><code>RUBYLIB </code></td><td>Environment variable</td></tr><tr><td>PHP</td><td><code>include_path </code></td><td>Configuration variable</td></tr><tr><td>Python</td><td><code>PYTHONPATH </code></td><td>Environment variable</td></tr><tr><td>Go</td><td><code>GOPATH </code></td><td>Environment variable</td></tr><tr><td>Java</td><td><code>CLASSPATH </code></td><td>Environment variable</td></tr></tbody></table><p>For general information on setting environment variables, read
        <code>cmdline.pdf</code> in the recipes distribution (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>). You can use those instructions
        to set environment variables to the values in the following
        discussion.</p><p>Suppose that you want to install library files in a directory
        that language processors do not search by default. For purposes of
        illustration, let’s use <em class="filename">/usr/local/lib/mcb</em> on Unix and <em class="filename">C:\lib\mcb</em> on Windows. (To put the files
        somewhere else, adjust the pathnames in the variable settings
        accordingly. For example, you might want to use a different directory,
        or you might want to put libraries for each language in separate
        directories.)</p><p>Under Unix, if you put Perl library files in the <em class="filename">/usr/local/lib/mcb</em> directory, set the
        <code>PERL5LIB</code> environment variable
        appropriately. For a shell in the Bourne shell family (<span class="command"><em>sh</em></span>, <span class="command"><em>bash</em></span>,
        <span class="command"><em>ksh</em></span>), set the variable like this in
        the appropriate startup file:</p><pre data-type="programlisting">export PERL5LIB=/usr/local/lib/mcb</pre><div data-type="note" epub:type="note"><h6>Note</h6><p>For the original Bourne shell, <span class="command"><em>sh</em></span>, you may need to split this into two
          commands:</p><pre data-type="programlisting">PERL5LIB=/usr/local/lib/mcb
export PERL5LIB</pre></div><p>For a shell in the C shell family (<span class="command"><em>csh</em></span>, <span class="command"><em>tcsh</em></span>), set <code>PERL5LIB</code> like this in your <em class="filename">.login</em> file:</p><pre data-type="programlisting">setenv PERL5LIB /usr/local/lib/mcb</pre><p>Under Windows, if you put Perl library files in <em class="filename">C:\lib\mcb</em>, set <code>PERL5LIB</code> as follows:</p><pre data-type="programlisting">PERL5LIB=C:\lib\mcb</pre><p>In each case, the variable value tells Perl to look in the
        specified directory for library files, in addition to any other
        directories it searches by default. If you set <code>PERL5LIB</code> to name multiple directories, the
        separator character between directory pathnames is colon (<code>:</code>) on Unix or
        semicolon (<code>;</code>) on
        Windows.</p><p>Specify the other environment variables (<code>RUBYLIB</code>, <code>PYTHONPATH</code>, and <code>CLASSPATH</code>) using the same syntax.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>Setting these environment variables as just discussed should
          suffice for scripts that you run from the command line. For scripts
          intended to be executed by a web server, you likely must configure
          the server as well so that it can find the library files.</p></div><p>For PHP, the search path is defined by the value of the <code>include_path</code> variable in the <em class="filename">php.ini</em> PHP initialization file. On Unix,
        the file’s pathname is likely <em class="filename">/usr/lib/php.ini</em> or <em class="filename">/usr/local/lib/php.ini</em>. Under Windows, the
        file is likely found in the Windows directory or under the main PHP
        installation directory. To determine the location, run this
        commmand:</p><pre data-type="programlisting">$ <strong><code>php --ini</code></strong></pre><p>Define the value of <code>include_path</code> in <em class="filename">php.ini</em> with a line like this:</p><pre data-type="programlisting">include_path = "<em><code>value</code></em>"</pre><p>Specify <em><code>value</code></em> using the same syntax
        as for environment variables that name directories. That is, it’s a
        list of directory names, with the names separated by colons on Unix or
        semicolons on Windows. On Unix, if you want PHP to look for include
        files in the current directory and in <em class="filename">/usr/local/lib/mcb</em>, set <code>include_path</code> like this:</p><pre data-type="programlisting">include_path = ".:/usr/local/lib/mcb"</pre><p>On Windows, to search the current directory and <em class="filename">C:\lib\mcb</em>, set <code>include_path</code> like this:</p><pre data-type="programlisting">include_path = ".;C:\lib\mcb"</pre><p>If PHP is running as an Apache module, restart Apache to make
        <em class="filename">php.ini</em> changes take
        effect.</p></div></section><section data-type="sect3" data-pdf-bookmark="Setting library-file access privileges"><div class="sect3" id="idm45820387543280"><h3>Setting library-file access privileges</h3><p>If you use a multiple-user system such as Unix, you must make decisions about library-file
        ownership and access mode:</p><ul><li><p>If a library file is private and contains code to be used
            only by you, place the file under your own account and make it
            accessible only to you. Assuming that a library file named
            <em class="filename">mylib</em> is already owned by
            you, you can make it private like this:</p><pre data-type="programlisting">$ <strong><code>chmod 600 mylib</code></strong></pre></li><li><p>If the library file is to be used only by your web server,
            install it in a server library directory and make it owned by and
            accessible only to the server user ID. You may need to be <code>root</code> to do this. For example, if the web
            server runs as <code>wwwusr</code>, the
            following commands make the file private to that user:</p><pre data-type="programlisting"># <strong><code>chown wwwusr mylib</code></strong>
# <strong><code>chmod 600 mylib</code></strong></pre></li><li><p>If the library file is public, you can place it in a
            location that your programming language searches automatically
            when it looks for libraries. (Most language processors search for
            libraries in some default set of directories, although this set
            can be influenced by setting environment variables as described
            previously.) You may need to be <code>root</code> to install files in one of these
            directories. Then you can make the file world readable:</p><pre data-type="programlisting"># <strong><code>chmod 444 mylib</code></strong></pre></li></ul><p>Now let’s construct a library for each API. Each section here
        demonstrates how to write the library file itself and discusses how to
        use the library from within programs.</p></div></section><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820387186144"><h3>Perl</h3><p>In Perl, library files are called modules and typically have an extension of
        <em class="filename">.pm</em> (<q>Perl module</q>).
        It’s conventional for the basename of a module file to be the same as
        the identifier on the <code>package</code> line
        in the file. The following file, <em class="filename">Cookbook.pm</em>, implements a module named
        <code>Cookbook</code>:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">package</code> <code class="nn">Cookbook</code><code class="p">;</code>
<code class="c1"># Cookbook.pm: library file with utility method for connecting to MySQL</code>
<code class="c1"># using the Perl DBI module</code>

<code class="k">use</code> <code class="nn">strict</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">warnings</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">DBI</code><code class="p">;</code>

<code class="k">my</code> <code class="nv">$db_name</code> <code class="o">=</code> <code class="s">"cookbook"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$host_name</code> <code class="o">=</code> <code class="s">"localhost"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$user_name</code> <code class="o">=</code> <code class="s">"cbuser"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$password</code> <code class="o">=</code> <code class="s">"cbpass"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$port_num</code> <code class="o">=</code> <code class="nb">undef</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$socket_file</code> <code class="o">=</code> <code class="nb">undef</code><code class="p">;</code>

<code class="c1"># Establish a connection to the cookbook database, returning a database</code>
<code class="c1"># handle.  Raise an exception if the connection cannot be established.</code>

<code class="k">sub</code> <code class="nf">connect</code>
<code class="p">{</code>
<code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:host=$host_name"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>

  <code class="nv">$dsn</code> <code class="o">.=</code> <code class="s">";database=$db_name"</code> <code class="k">if</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$db_name</code><code class="p">);</code>
  <code class="nv">$dsn</code> <code class="o">.=</code> <code class="s">";mysql_socket=$socket_file"</code> <code class="k">if</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$socket_file</code><code class="p">);</code>
  <code class="nv">$dsn</code> <code class="o">.=</code> <code class="s">";port=$port_num"</code> <code class="k">if</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$port_num</code><code class="p">);</code>

  <code class="k">return</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nv">$user_name</code><code class="p">,</code> <code class="nv">$password</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code>
<code class="p">}</code>

<code class="mi">1</code><code class="p">;</code>  <code class="c1"># return true</code></pre><p>The module encapsulates the code for establishing a connection
        to the MySQL server into a <code>connect()</code> method, and the <code>package</code> identifier establishes a <code>Cookbook</code> namespace for the module. To invoke
        the <code>connect()</code> method, use the
        module name:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">Cookbook::</code><code class="nb">connect</code> <code class="p">();</code></pre><p>The final line of the module file is a statement that trivially
        evaluates to true. (If the module doesn’t return a true value, Perl
        assumes that something is wrong with it and exits.)</p><p>Perl locates library files by searching the list of directories
        named in its <code>@INC</code> array. To
        check the default value of this variable on your system, invoke Perl
        as follows at the command line:</p><pre data-type="programlisting">$ <strong><code>perl -V</code></strong></pre><p>The last part of the output from the command shows the
        directories listed in <code>@INC</code>. If you
        install a library file in one of those directories, your scripts will
        find it automatically. If you install the module somewhere else, tell
        your scripts where to find it by setting the <code>PERL5LIB</code>
        environment variable, as discussed in the introductory part of this
        recipe.</p><p>After installing the <em class="filename">Cookbook.pm</em> module, try it from a test
        harness script, <span class="command"><em>harness.pl</em></span>:</p><pre data-type="programlisting" data-code-language="perl"><code class="ch">#!/usr/bin/perl</code>
<code class="c1"># harness.pl: test harness for Cookbook.pm library</code>

<code class="k">use</code> <code class="nn">strict</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">warnings</code><code class="p">;</code>
<code class="k">use</code> <code class="nn">Cookbook</code><code class="p">;</code>

<code class="k">my</code> <code class="nv">$dbh</code><code class="p">;</code>
<code class="nb">eval</code>
<code class="p">{</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">Cookbook::</code><code class="nb">connect</code> <code class="p">();</code>
  <code class="k">print</code> <code class="s">"Connected\n"</code><code class="p">;</code>
<code class="p">};</code>
<code class="nb">die</code> <code class="s">"$@"</code> <code class="k">if</code> <code class="vg">$@</code><code class="p">;</code>
<code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">disconnect</code> <code class="p">();</code>
<code class="k">print</code> <code class="s">"Disconnected\n"</code><code class="p">;</code></pre><p><span class="command"><em>harness.pl</em></span> has no <code>use</code> <code>DBI</code>
        statement. It’s unnecessary because the <code>Cookbook</code> module itself imports DBI; any
        script that uses <code>Cookbook</code> also
        gains access to DBI.</p><p>If you don’t catch connection errors explicitly with <code>eval</code>, you can write the script body more
        simply:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">Cookbook::</code><code class="nb">connect</code> <code class="p">();</code>
<code class="k">print</code> <code class="s">"Connected\n"</code><code class="p">;</code>
<code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">disconnect</code> <code class="p">();</code>
<code class="k">print</code> <code class="s">"Disconnected\n"</code><code class="p">;</code></pre><p>In this case, Perl catches any connection exception and
        terminates the script after printing the error message generated
        by the <code>connect()</code>
        method.</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820387185840"><h3>Ruby</h3><p>The following Ruby library file, <em class="filename">Cookbook.rb</em>, defines a <code>Cookbook</code> class that implements a <code>connect</code> class
        method:</p><pre data-type="programlisting" data-code-language="ruby"><code class="c1"># Cookbook.rb: library file with utility method for connecting to MySQL</code>
<code class="c1"># using the Ruby Mysql2 module</code>

<code class="nb">require</code> <code class="s2">"mysql2"</code>

<code class="c1"># Establish a connection to the cookbook database, returning a database</code>
<code class="c1"># handle.  Raise an exception if the connection cannot be established.</code>

<code class="k">class</code> <code class="nc">Cookbook</code>
  <code class="vc">@@host_name</code> <code class="o">=</code> <code class="s2">"localhost"</code>
  <code class="vc">@@db_name</code> <code class="o">=</code> <code class="s2">"cookbook"</code>
  <code class="vc">@@user_name</code> <code class="o">=</code> <code class="s2">"cbuser"</code>
  <code class="vc">@@password</code> <code class="o">=</code> <code class="s2">"cbpass"</code>

  <code class="c1"># Class method for connecting to server to access the</code>
  <code class="c1"># cookbook database; returns a database handle object.</code>

  <code class="k">def</code> <code class="nc">Cookbook</code><code class="o">.</code><code class="nf">connect</code>
    <code class="k">return</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:host</code> <code class="o">=&gt;</code> <code class="vc">@@host_name</code><code class="p">,</code>
                              <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="vc">@@db_name</code><code class="p">,</code>
                              <code class="ss">:username</code> <code class="o">=&gt;</code> <code class="vc">@@user_name</code><code class="p">,</code> 
                              <code class="ss">:password</code> <code class="o">=&gt;</code> <code class="vc">@@password</code><code class="p">)</code>
  <code class="k">end</code>
<code class="k">end</code></pre><p>The <code>connect</code> method is defined
        in the library as <code>Cookbook.connect</code>
        because Ruby class methods are defined as
        <em><code>class_name.method_name</code></em>.</p><p>Ruby locates library files by searching the list of directories
        named in its <code>$LOAD_PATH</code>
        variable (also known as <code>$:</code>), which
        is an array. To check the default value of this variable on your
        system, use interactive Ruby to execute this statement:</p><pre data-type="programlisting">$ <strong><code>irb</code></strong>
&gt;&gt; <strong><code>puts $LOAD_PATH</code></strong></pre><p>If you install a library file in one of those directories, your
        scripts will find it automatically. If you install the file somewhere
        else, tell your scripts where to find it by setting the <code>RUBYLIB</code>
        environment variable, as discussed in the introductory part of this
        recipe.</p><p>After installing the <em class="filename">Cookbook.rb</em> library file, try it from a
        test harness script, <span class="command"><em>harness.rb</em></span>:</p><pre data-type="programlisting" data-code-language="ruby"><code class="ch">#!/usr/bin/ruby -w</code>
<code class="c1"># harness.rb: test harness for Cookbook.rb library</code>

<code class="nb">require</code> <code class="s2">"Cookbook"</code>

<code class="k">begin</code>
  <code class="n">client</code> <code class="o">=</code> <code class="no">Cookbook</code><code class="o">.</code><code class="n">connect</code>
  <code class="nb">print</code> <code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code>
<code class="k">rescue</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Error</code> <code class="o">=&gt;</code> <code class="n">e</code>
  <code class="nb">puts</code> <code class="s2">"Cannot connect to server"</code>
  <code class="nb">puts</code> <code class="s2">"Error code: </code><code class="si">#{</code><code class="n">e</code><code class="o">.</code><code class="n">errno</code><code class="si">}</code><code class="s2">"</code>
  <code class="nb">puts</code> <code class="s2">"Error message: </code><code class="si">#{</code><code class="n">e</code><code class="o">.</code><code class="n">message</code><code class="si">}</code><code class="s2">"</code>
  <code class="nb">exit</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
<code class="k">ensure</code>
  <code class="n">client</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
  <code class="nb">print</code> <code class="s2">"Disconnected</code><code class="se">\n</code><code class="s2">"</code>
<code class="k">end</code></pre><p><span class="command"><em>harness.rb</em></span> has no <code>require</code> statement for the Mysql2 module. It’s
        unnecessary because the <code>Cookbook</code>
        module itself imports Mysql2; any script that imports <code>Cookbook</code> also gains access to Mysql2.</p><p>If you want a script to die if an error occurs without checking
        for an exception yourself, write the script body like this:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Cookbook</code><code class="o">.</code><code class="n">connect</code>
<code class="nb">print</code> <code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code>
<code class="n">client</code><code class="o">.</code><code class="n">close</code>
<code class="nb">print</code> <code class="s2">"Disconnected</code><code class="se">\n</code><code class="s2">"</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820386732320"><h3>PHP</h3><p>PHP library files are written like regular PHP scripts. A <em class="filename">Cookbook.php</em> file that implements a
        <code>Cookbook</code> class with a <code>connect()</code>
        method looks like this:</p><pre data-type="programlisting" data-code-language="php"><code class="o">&lt;?</code><code class="nx">php</code>
<code class="c1"># Cookbook.php: library file with utility method for connecting to MySQL</code>
<code class="c1"># using the PDO module</code>

<code class="k">class</code> <code class="nc">Cookbook</code>
<code class="p">{</code>
  <code class="k">public</code> <code class="k">static</code> <code class="nv">$host_name</code> <code class="o">=</code> <code class="s2">"localhost"</code><code class="p">;</code>
  <code class="k">public</code> <code class="k">static</code> <code class="nv">$db_name</code> <code class="o">=</code> <code class="s2">"cookbook"</code><code class="p">;</code>
  <code class="k">public</code> <code class="k">static</code> <code class="nv">$user_name</code> <code class="o">=</code> <code class="s2">"cbuser"</code><code class="p">;</code>
  <code class="k">public</code> <code class="k">static</code> <code class="nv">$password</code> <code class="o">=</code> <code class="s2">"cbpass"</code><code class="p">;</code>

  <code class="c1"># Establish a connection to the cookbook database, returning a database</code>
  <code class="c1"># handle.  Raise an exception if the connection cannot be established.</code>
  <code class="c1"># In addition, cause exceptions to be raised for errors.</code>

  <code class="k">public</code> <code class="k">static</code> <code class="k">function</code> <code class="nf">connect</code> <code class="p">()</code>
  <code class="p">{</code>
    <code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host="</code> <code class="o">.</code> <code class="nx">self</code><code class="o">::</code><code class="nv">$host_name</code> <code class="o">.</code> <code class="s2">";dbname="</code> <code class="o">.</code> <code class="nx">self</code><code class="o">::</code><code class="nv">$db_name</code><code class="p">;</code>
    <code class="nv">$dbh</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">PDO</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nx">self</code><code class="o">::</code><code class="nv">$user_name</code><code class="p">,</code> <code class="nx">self</code><code class="o">::</code><code class="nv">$password</code><code class="p">);</code>
    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">setAttribute</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">ATTR_ERRMODE</code><code class="p">,</code> <code class="nx">PDO</code><code class="o">::</code><code class="na">ERRMODE_EXCEPTION</code><code class="p">);</code>
    <code class="k">return</code> <code class="p">(</code><code class="nv">$dbh</code><code class="p">);</code>
  <code class="p">}</code>

<code class="p">}</code> <code class="c1"># end Cookbook</code>
<code class="cp">?&gt;</code><code class="x"/></pre><p>The <code>connect()</code> routine within
        the class is declared using the <code>static</code> keyword to make it a class method
        rather than an instance method. This designates it as directly
        callable without instantiating an object through which to invoke
        it.</p><p>The <code>new</code> <code>PDO()</code> constructor raises an exception if the connection attempt fails.
        Following a successful attempt, <code>connect()</code> sets the error-handling mode so
        that other PDO calls raise exceptions for failure as well. This way,
        individual calls need not be tested for an error return value.</p><p>Although most PHP examples throughout this book don’t show the
        <code>&lt;?php</code> and <code>?&gt;</code> tags, I’ve shown them as part of
        <em class="filename">Cookbook.php</em> here to emphasize
        that library files must enclose all PHP code within those tags. The
        PHP interpreter makes no assumptions about the contents of a library
        file when it begins parsing it because you might include a file that
        contains nothing but HTML. Therefore, you must use <code>&lt;?php</code> and <code>?&gt;</code> to specify explicitly which parts of
        the library file should be considered as PHP code rather than as HTML,
        just as you do in the main script.</p><p>PHP looks for libraries by searching the directories named in
        the <code>include_path</code> variable in the
        PHP initialization file, as described in the introductory part of this
        recipe.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>PHP scripts often are placed in the document tree of your web
          server, and clients can request them directly. For PHP library
          files, we <span class="keep-together">recommend</span> that you
          place them somewhere outside the document tree, especially if (like
          <em class="filename">Cookbook.php</em>) they contain a
          username and password.</p></div><p>After installing <em class="filename">Cookbook.php</em> in one of the <code>include_path</code> directories, try it from a test harness script, <span class="command"><em>harness.php</em></span>:</p><pre data-type="programlisting" data-code-language="php"><code class="o">&lt;?</code><code class="nx">php</code>
<code class="c1"># harness.php: test harness for Cookbook.php library</code>

<code class="k">require_once</code> <code class="s2">"Cookbook.php"</code><code class="p">;</code>

<code class="k">try</code>
<code class="p">{</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="nx">Cookbook</code><code class="o">::</code><code class="na">connect</code> <code class="p">();</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">catch</code> <code class="p">(</code><code class="nx">PDOException</code> <code class="nv">$e</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Cannot connect to server</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error code: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getCode</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Error message: "</code> <code class="o">.</code> <code class="nv">$e</code><code class="o">-&gt;</code><code class="na">getMessage</code> <code class="p">()</code> <code class="o">.</code> <code class="s2">"</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="k">exit</code> <code class="p">(</code><code class="mi">1</code><code class="p">);</code>
<code class="p">}</code>
<code class="nv">$dbh</code> <code class="o">=</code> <code class="k">NULL</code><code class="p">;</code>
<code class="k">print</code> <code class="p">(</code><code class="s2">"Disconnected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="cp">?&gt;</code><code class="x"/></pre><p>The <code>require_once</code> statement
        accesses the <span class="command"><em>Cookbook.php</em></span> file that is required to use
        the <code>Cookbook</code> class. <code>require_once</code> is one of several PHP
        file-inclusion statements:</p><ul><li><p><code>require</code> and <code>include</code> instruct PHP to read the named file. They are similar, but <code>require</code> terminates the script if the
            file cannot be found; <code>include</code>
            produces only a warning.</p></li><li><p><code>require_once</code> and <code>include_once</code> are like <code>require</code> and <code>include</code> except that if the file has
            already been read, its contents are not processed again. This is useful for avoiding
            multiple-declaration problems that can easily occur when library
            files include other library files.</p></li></ul></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820386530000"><h3>Python</h3><p>Python libraries are written as modules and referenced from scripts using
        <code>import</code> statements. To create a method for connecting to MySQL, write a module
        file, <em class="filename">cookbook.py</em> (Python module
        names should be lowercase):</p><pre data-type="programlisting" data-code-language="python"><code class="c1"># cookbook.py: library file with utility method for connecting to MySQL</code>
<code class="c1"># using the Connector/Python module</code>

<code class="kn">import</code> <code class="nn">mysql.connector</code>

<code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"host"</code><code class="p">:</code> <code class="s2">"localhost"</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"cbpass"</code><code class="p">,</code>
<code class="p">}</code>

<code class="c1"># Establish a connection to the cookbook database, returning a connection</code>
<code class="c1"># object.  Raise an exception if the connection cannot be established.</code>

<code class="k">def</code> <code class="nf">connect</code><code class="p">():</code>
  <code class="k">return</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">connect</code><code class="p">(</code><code class="o">**</code><code class="n">conn_params</code><code class="p">)</code></pre><p>The filename basename determines the module name, so the module
        is called <code>cookbook</code>. Module methods
        are accessed through the module name; thus, import the <code>cookbook</code> module and invoke its <code>connect()</code>
        method like this:</p><pre data-type="programlisting" data-code-language="python"><code class="kn">import</code> <code class="nn">cookbook</code>

<code class="n">conn</code> <code class="o">=</code> <code class="n">cookbook</code><code class="o">.</code><code class="n">connect</code><code class="p">();</code></pre><p>The Python interpreter searches for modules in directories named
        in the <code>sys.path</code> variable. To check
        the default value of <code>sys.path</code> on
        your system, run Python interactively and enter a few
        commands:</p><pre data-type="programlisting">$ <strong><code>python</code></strong>
&gt;&gt;&gt; <strong><code>import sys</code></strong>
&gt;&gt;&gt; <strong><code>sys.path</code></strong></pre><p>If you install <em class="filename">cookbook.py</em>
        in one of the directories named by <code>sys.path</code>, your scripts will find it with no
        special handling. If you install <em class="filename">cookbook.py</em> somewhere else, you must
        set the <code>PYTHONPATH</code>
        environment variable, as discussed in the introductory part of this
        recipe.</p><p>After installing the <em class="filename">cookbook.py</em> library file, try it from a
        test harness script, <span class="command"><em>harness.py</em></span>:</p><pre data-type="programlisting" data-code-language="python"><code class="ch">#!/usr/bin/python</code>
<code class="c1"># harness.py: test harness for cookbook.py library</code>

<code class="kn">import</code> <code class="nn">mysql.connector</code>
<code class="kn">import</code> <code class="nn">cookbook</code>

<code class="k">try</code><code class="p">:</code>
  <code class="n">conn</code> <code class="o">=</code> <code class="n">cookbook</code><code class="o">.</code><code class="n">connect</code><code class="p">()</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code>
<code class="k">except</code> <code class="n">mysql</code><code class="o">.</code><code class="n">connector</code><code class="o">.</code><code class="n">Error</code> <code class="k">as</code> <code class="n">e</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Cannot connect to server"</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Error code: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">e</code><code class="o">.</code><code class="n">errno</code><code class="p">)</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Error message: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="n">e</code><code class="o">.</code><code class="n">msg</code><code class="p">)</code>
<code class="k">else</code><code class="p">:</code>
  <code class="n">conn</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"Disconnected"</code><code class="p">)</code></pre><p>The <em class="filename">cookbook.py</em> file
        imports the <code>mysql.connector</code> module,
        but a script that imports <code>cookbook</code>
        does not thereby gain access to <code>mysql.connector</code>. If the script needs
        Connector/Python-specific information (such as <code>mysql.connector.Error</code>), the script itself
        must import <code>mysql.connector</code>.</p><p>If you want a script to die if an error occurs without checking
        for an exception yourself, write the script body like this:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn</code> <code class="o">=</code> <code class="n">cookbook</code><code class="o">.</code><code class="n">connect</code><code class="p">()</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Connected"</code><code class="p">)</code>
<code class="n">conn</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Disconnected"</code><code class="p">)</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820386157360"><h3>Go</h3><p>Go programs are organized into packages that are a collection of the source files, located in the same directory. Packages, in their turn, are organized into modules that are collections of Go packages that are released together. Modules belong to a Go repository. A typical Go repository contains only one module, but you may have several modules in the same repository.
        </p><p>The Go interpreter searches for packages in directories named
        in the <code>$GOPATH/src/{domain}/{project}</code> variable.
        However, when using modules, Go is no longer uses <code>GOPATH</code>. You do not need to change this variable no matter where your module is installed. We will use modules for our examples.
        </p><p>
          To create a method for connecting to MySQL, write a package
        file, <em class="filename">cookbook.go</em>:</p><pre data-type="programlisting" data-code-language="go"><code class="kn">package</code><code class="w"> </code><code class="nx">cookbook</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">  </code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">  </code><code class="nx">_</code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">Connect</code><code class="p">()</code><code class="w"> </code><code class="p">(</code><code class="o">*</code><code class="nx">sql</code><code class="p">.</code><code class="nx">DB</code><code class="p">,</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">  </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook"</code><code class="p">)</code><code class="w"/>

<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nb">panic</code><code class="p">(</code><code class="nx">err</code><code class="p">.</code><code class="nx">Error</code><code class="p">())</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>

<code class="w">  </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Ping</code><code class="p">()</code><code class="w"/>

<code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>The filename basename does not determine the package name: Go searches through all files in the import path until it finds the one with the required package declaration. Package methods
        are accessed via the package name.</p><p>
          To test the package you can specify relative path to the directory where the package file is located:
        </p><pre data-type="programlisting" data-code-language="go"><code class="kn">import</code><code class="w"> </code><code class="s">"../../lib"</code><code class="w"/></pre><p>
          This is very easy way to quickly test your libraries but such commands, as <span class="command"><em>go install</em></span> would not work for packages, imported this way. As a result, your program will be rebuilt from scratch each time you access it.
        </p><p>
          Better way to work with packages is to publish them as part of modules. To do it, run following in the directory where you store <code>cookbook.go</code>:
        </p><pre data-type="programlisting" data-code-language="bash">go mod init cookbook</pre><p>
          This will create file <code>go.mod</code> that will have your module name and version of Go. You can name the module as you wish.
        </p><p>
          You can publish your module on the Internet and access it from the local program as you would do with any other module. However, during development, it would be useful to have the module only locally. In this case you need to make few adjustments in the program directory that will use it.
        </p><p>
          First, create a program that will call the package, <code>harness.go</code>:
        </p><pre data-type="programlisting" data-code-language="go"><code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">  </code><code class="s">"fmt"</code><code class="w"/>
<code class="w">  </code><code class="s">"github.com/svetasmirnova/mysqlcookbook/recipes/lib"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">  </code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cookbook</code><code class="p">.</code><code class="nx">Connect</code><code class="p">()</code><code class="w"/>

<code class="w">  </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Cannot connect to server"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"Error message: %s\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="p">.</code><code class="nx">Error</code><code class="p">())</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Connected"</code><code class="p">)</code><code class="w"/>
<code class="w">  </code><code class="p">}</code><code class="w"/>
<code class="w">  </code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
          Then, in the directory, there the package is installed, initialize the module:
        </p><pre data-type="programlisting" data-code-language="bash">go mod init harness</pre><p>
          Once the module is initialized and <code>go.mod</code> is created edit it with:
        </p><pre data-type="programlisting" data-code-language="bash">go mod edit -replace ↩
github.com/svetasmirnova/mysqlcookbook/recipes/lib<code class="o">=</code>↩
/home/sveta/src/mysqlcookbook/recipes/lib</pre><p>
          Replace URL and the local path with the ones, valid in your environment.
        </p><p>
         This command will tell Go to replace remote module path with local directory.
       </p><p>
          Once done, you can test your connection:
        </p><pre data-type="programlisting" data-code-language="bash">$ <strong><code>go run harness.go</code></strong>
Connected</pre></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820386109936"><h3>Java</h3><p>Java library files are similar to Java programs in most ways:</p><ul><li><p>The <code>class</code> line in the
            source file indicates a class name.</p></li><li><p>The file should have the same name as the class (with a
            <em class="filename">.java</em> extension).</p></li><li><p>Compile the <em class="filename">.java</em> file
            to produce a <em class="filename">.class</em>
            file.</p></li></ul><p>Java library files also differ from Java programs in some
        ways:</p><ul><li><p>Unlike regular program files, Java library files have no
            <code>main()</code> function.</p></li><li><p>A library file should begin with a <code>package</code> identifier that specifies the
            position of the class within the Java namespace.</p></li></ul><p>A common convention for Java package identifiers is to use the
        domain of the code author as a prefix; this helps make identifiers
        unique and avoids conflict with classes written by other authors.
        Domain names proceed right to left from more general to more specific
        within the domain namespace, whereas the Java class namespace proceeds
        left to right from general to specific. Thus, to use a domain as the
        prefix for a package name within the Java class namespace, it’s
        necessary to reverse it. For example, Paul’s domain is <em class="filename">kitebird.com</em>, so if he writes a library file
        and places it under <code>mcb</code> within his
        domain’s namespace, the library begins with a <code>package</code> statement like this:</p><pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">com</code><code class="o">.</code><code class="na">kitebird</code><code class="o">.</code><code class="na">mcb</code><code class="o">;</code></pre><p>Java packages developed for this book are placed within the
        <code>com.kitebird.mcb</code> namespace to
        ensure their uniqueness in the package namespace.</p><p>The following library file, <em class="filename">Cookbook.java</em>, defines a <code>Cookbook</code> class that implements a <code>connect()</code> method for connecting to the
        <code>cookbook</code> database. <code>connect()</code> returns a <code>Connection</code> object if it succeeds and throws
        an exception otherwise. To help the caller deal with failures, the
        <code>Cookbook</code> class also defines
        <code>getErrorMessage()</code> and <code>printErrorMessage()</code> utility methods that
        return the error message as a string and print it to <code>System.err</code>, respectively:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// Cookbook.java: library file with utility methods for connecting to MySQL</code>
<code class="c1">// using MySQL Connector/J and for handling exceptions</code>

<code class="kn">package</code> <code class="n">com</code><code class="o">.</code><code class="na">kitebird</code><code class="o">.</code><code class="na">mcb</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.sql.*</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Cookbook</code> <code class="o">{</code>
  <code class="c1">// Establish a connection to the cookbook database, returning</code>
  <code class="c1">// a connection object.  Throw an exception if the connection</code>
  <code class="c1">// cannot be established.</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">Connection</code> <code class="nf">connect</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
    <code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://localhost/cookbook"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">user</code> <code class="o">=</code> <code class="s">"cbuser"</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">password</code> <code class="o">=</code> <code class="s">"cbpass"</code><code class="o">;</code>

    <code class="k">return</code> <code class="o">(</code><code class="n">DriverManager</code><code class="o">.</code><code class="na">getConnection</code><code class="o">(</code><code class="n">url</code><code class="o">,</code> <code class="n">user</code><code class="o">,</code> <code class="n">password</code><code class="o">));</code>
  <code class="o">}</code>

  <code class="c1">// Return an error message as a string</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">String</code> <code class="nf">getErrorMessage</code><code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">StringBuffer</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringBuffer</code> <code class="o">();</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">e</code> <code class="k">instanceof</code> <code class="n">SQLException</code><code class="o">)</code> <code class="o">{</code> <code class="c1">// JDBC-specific exception?</code>
      <code class="c1">// print general message, plus any database-specific message</code>
      <code class="n">s</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"Error message: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getMessage</code> <code class="o">()</code> <code class="o">+</code> <code class="s">"\n"</code><code class="o">);</code>
      <code class="n">s</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"Error code: "</code> <code class="o">+</code> <code class="o">((</code><code class="n">SQLException</code><code class="o">)</code> <code class="n">e</code><code class="o">).</code><code class="na">getErrorCode</code><code class="o">()</code> <code class="o">+</code> <code class="s">"\n"</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
      <code class="n">s</code><code class="o">.</code><code class="na">append</code> <code class="o">(</code><code class="n">e</code> <code class="o">+</code> <code class="s">"\n"</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="na">toString</code><code class="o">());</code>
  <code class="o">}</code>

  <code class="c1">// Get the error message and print it to System.err</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">printErrorMessage</code><code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">Cookbook</code><code class="o">.</code><code class="na">getErrorMessage</code><code class="o">(</code><code class="n">e</code><code class="o">));</code>
  <code class="o">}</code>
<code class="o">}</code></pre><p>The routines within the class are declared using the <code>static</code> keyword,
        which makes them class methods rather than instance methods. That is
        done here because the class is used directly rather than creating an
        object from it and invoking the methods through the object.</p><p>To use the <em class="filename">Cookbook.java</em>
        file, compile it to produce <em class="filename">Cookbook.class</em>, then install the class file
        in a directory that corresponds to the package identifier. </p><p>This means
        that <em class="filename">Cookbook.class</em> should be
        installed in a directory named <em class="filename">com/kitebird/mcb</em> (Unix) or <em class="filename">com\kitebird\mcb</em> (Windows) that is located
        under some directory named in your <code>CLASSPATH</code> setting. For example, if <code>CLASSPATH</code> includes <em class="filename">/usr/local/lib/mcb</em> under Unix, you can
        install <em class="filename">Cookbook.class</em> in the
        <em class="filename">/usr/local/lib/mcb/com/kitebird/mcb</em>
        directory. (For more information about the <code>CLASSPATH</code> variable, see the Java discussion
        in <a data-type="xref" href="#nch-api-api-connect">Recipe 4.1</a>.)</p><p>To use the <code>Cookbook</code> class
        from within a Java program, import it and invoke the <code>Cookbook.connect()</code> method. The following
        test harness program, <em class="filename">Harness.java</em>, shows how to do this:</p><pre data-type="programlisting" data-code-language="java"><code class="c1">// Harness.java: test harness for Cookbook library class</code>

<code class="kn">import</code> <code class="nn">java.sql.*</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">com.kitebird.mcb.Cookbook</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Harness</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Connection</code> <code class="n">conn</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="k">try</code> <code class="o">{</code>
      <code class="n">conn</code> <code class="o">=</code> <code class="n">Cookbook</code><code class="o">.</code><code class="na">connect</code> <code class="o">();</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Connected"</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">Cookbook</code><code class="o">.</code><code class="na">printErrorMessage</code> <code class="o">(</code><code class="n">e</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">exit</code> <code class="o">(</code><code class="mi">1</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">finally</code>  <code class="o">{</code>
      <code class="k">if</code> <code class="o">(</code><code class="n">conn</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">try</code> <code class="o">{</code>
          <code class="n">conn</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>
          <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Disconnected"</code><code class="o">);</code>
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
          <code class="n">String</code> <code class="n">err</code> <code class="o">=</code> <code class="n">Cookbook</code><code class="o">.</code><code class="na">getErrorMessage</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>
          <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">err</code><code class="o">);</code>
        <code class="o">}</code>
      <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre><p><em class="filename">Harness.java</em> also shows how
        to use the error message utility methods from the <code>Cookbook</code> class when a MySQL-related
        exception occurs:</p><ul><li><p><code>printErrorMessage()</code> takes
            the exception object and uses it to print an error message to
            <code>System.err</code>.</p></li><li><p><code>getErrorMessage()</code> returns
            the error message as a string. You can display the <span class="keep-together">message</span> yourself, write it to a
            logfile, or whatever.</p></li></ul></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.4 Executing Statements and Retrieving Results"><div class="sect1" id="nch-api-api-statement"><h1>4.4 Executing Statements and Retrieving Results</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820385392560"><h2>Problem</h2><p>You want a program to send an SQL statement to the MySQL server and retrieve its
      result.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820385391536"><h2>Solution</h2><p>Some statements return only a status code; others return a result
      set (a set of rows). Some APIs provide different methods for executing
      each type of statement. If so, use the appropriate method for the
      statement to be executed.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820385281296"><h2>Discussion</h2><p>You can execute two general categories of SQL statements. Some
      retrieve information from the database; others change that information or the database itself.
      Statements in the two categories are handled differently. In addition,
      some APIs provide multiple routines for executing statements,
      complicating matters further. Before we get to examples demonstrating
      how to execute statements from within each API, we’ll describe the
      database table the examples use, and then further discuss the two
      statement categories and outline a general strategy for processing
      statements in each category.</p><p>In <a data-type="xref" href="ch01.xhtml#nch-mysql">Chapter 1</a>, we created a table named <code>limbs</code> to try some sample statements. In this
      chapter, we’ll use a different table named <code>profile</code>. It’s based on the idea of a
      <q>buddy list,</q> that is, the set of people we like to keep in
      touch with while we’re online. The table definition looks like
      this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">profile</code>
<code class="p">(</code>
  <code class="n">id</code>    <code class="nb">INT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="n">name</code>  <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">)</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="n">birth</code> <code class="nb">DATE</code><code class="p">,</code>
  <code class="n">color</code> <code class="n">ENUM</code><code class="p">(</code><code class="s1">'blue'</code><code class="p">,</code><code class="s1">'red'</code><code class="p">,</code><code class="s1">'green'</code><code class="p">,</code><code class="s1">'brown'</code><code class="p">,</code><code class="s1">'black'</code><code class="p">,</code><code class="s1">'white'</code><code class="p">),</code>
  <code class="n">foods</code> <code class="k">SET</code><code class="p">(</code><code class="s1">'lutefisk'</code><code class="p">,</code><code class="s1">'burrito'</code><code class="p">,</code><code class="s1">'curry'</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="s1">'fadge'</code><code class="p">,</code><code class="s1">'pizza'</code><code class="p">),</code>
  <code class="n">cats</code>  <code class="nb">INT</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">)</code>
<code class="p">);</code></pre><p>The <code>profile</code> table indicates the
      things that are important to us about each buddy: name, age, favorite
      color, favorite foods, and number of cats. 
      Additionally, the table uses several different data types for its columns, and these
      come in handy to illustrate how to solve problems that pertain to
      specific data types.</p><p>The table also includes an <code>id</code>
      column containing unique values so that we can distinguish one row from
      another, even if two buddies have the same name. <code>id</code> and <code>name</code>
      are declared as <code>NOT</code> <code>NULL</code> because they’re each required to have a
      value. The other columns are implicitly permitted to be <code>NULL</code> (and that is also their default value)
      because we might not know the value to assign them for any given
      individual. That is, <code>NULL</code> signifies
      <q>unknown.</q></p><p>Notice that although we want to keep track of age, there is no
      <code>age</code> column in the table. Instead,
      there is a <code>birth</code> column of <code>DATE</code> type. Ages change, so if we store age
      values, we’d have to keep updating them. Storing birth dates is better:
      they don’t change and can be used to calculate age any time (see <a data-type="xref" href="ch08.xhtml#nch-dates-dates-age">Recipe 8.14</a>). <code>color</code> is an <code>ENUM</code> column; color values can be any one of
      the listed values. <code>foods</code> is a
      <code>SET</code>, which permits the value to be
      any combination of the individual set members. That way we can record
      multiple favorite foods for any buddy.</p><p>To create the table, use the <em class="filename">profile.sql</em> script in the <em class="filename">tables</em> directory of the <code>recipes</code> distribution. Change location into
      that directory, then run this command:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; profile.sql</code></strong></pre><p>The script also loads sample data into the table. You can
      experiment with the table, then restore it if you change its contents by
      running the script again. (See the final section of this chapter on the
      importance of restoring the <code>profile</code>
      table after modifying it.)</p><p>The contents of the <code>profile</code>
      table as loaded by the <em class="filename">profile.sql</em>
      script look like this:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM profile;</code></strong>
+----+---------+------------+-------+-----------------------+------+
| id | name    | birth      | color | foods                 | cats |
+----+---------+------------+-------+-----------------------+------+
|  1 | Sybil   | 1970-04-13 | black | lutefisk,fadge,pizza  |    0 |
|  2 | Nancy   | 1969-09-30 | white | burrito,curry,eggroll |    3 |
|  3 | Ralph   | 1973-11-02 | red   | eggroll,pizza         |    4 |
|  4 | Lothair | 1963-07-04 | blue  | burrito,curry         |    5 |
|  5 | Henry   | 1965-02-14 | red   | curry,fadge           |    1 |
|  6 | Aaron   | 1968-09-17 | green | lutefisk,fadge        |    1 |
|  7 | Joanna  | 1952-08-20 | green | lutefisk,fadge        |    0 |
|  8 | Stephen | 1960-05-01 | white | burrito,pizza         |    0 |
+----+---------+------------+-------+-----------------------+------+</pre><p>Although most of the columns in the <code>profile</code> table permit <code>NULL</code> values, none of the rows in the sample
      dataset actually contain <code>NULL</code> yet. (We
      want to defer the complications of <code>NULL</code> value processing to <a data-type="xref" href="#nch-api-api-quoting">Recipe 4.5</a> and
      <a data-type="xref" href="#nch-api-api-null">Recipe 4.7</a>.)</p><section data-type="sect3" data-pdf-bookmark="SQL statement categories"><div class="sect3" id="idm45820385163280"><h3>SQL statement categories</h3><p>SQL statements can be grouped into two broad categories, depending on whether
        they return a result set (a set of rows):</p><ul><li><p>Statements that return no result set, such as <code>INSERT</code>, <code>DELETE</code>, or <code>UPDATE</code>. As a general rule, statements of this type generally
            change the database in some way. There are some exceptions, such
            as <code>USE</code>
            <em><code>db_name</code></em>, which changes the default (current) database for your
            session without making any changes to the database itself. The
            example data-modifying statement used in this section is an
            <code>UPDATE</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">UPDATE</code> <code class="n">profile</code> <code class="k">SET</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">cats</code><code class="o">+</code><code class="mi">1</code> <code class="k">WHERE</code> <code class="n">name</code> <code class="o">=</code> <code class="s1">'Sybil'</code><code class="p">;</code></pre><p>We’ll cover how to execute this statement and determine the
            number of rows that it affects.</p></li><li><p>Statements that return a result set, such as <code>SELECT</code>,
            <code>SHOW</code>, <code>EXPLAIN</code>, or <code>DESCRIBE</code>. I refer to such statements
            generically as <code>SELECT</code>
            statements, but you should understand that category to include any
            statement that returns rows. The example row-retrieval statement
            used in this section is a <code>SELECT</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="n">id</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">cats</code> <code class="k">FROM</code> <code class="n">profile</code><code class="p">;</code></pre><p>We’ll cover how to execute this statement, fetch the rows in
            the result set, and determine the number of rows and columns in
            the result set. (To get information such as the column names or
            data types, access the result set metadata. That’s <a data-type="xref" href="ch12.xhtml#nch-meta-meta-result">Recipe 12.2</a>.)</p></li></ul><p>The first step in processing an SQL statement is to send it to the MySQL server for
        execution. Some APIs (those for Perl, and Java, for example)
        recognize a distinction between the two categories of statements and
        provide separate calls for executing them. Other APIs (such as the one
        for Python or Ruby) have a single call used for all statements. However, one
        thing all APIs have in common is that no special character indicates
        the end of the statement. No terminator is necessary because the end
        of the statement string terminates it. This differs from executing
        statements in the <span class="command"><em>mysql</em></span> program,
        where you terminate statements using a semicolon (<code>;</code>) or <code>\g</code>.
        (It also differs from how this book usually includes semicolons in
        examples to make it clear where statements end.)</p><p>When you send a statement to the server, be prepared to handle errors if it did not execute
        successfully. If a statement
        fails and you proceed on the basis that it succeeded, your program
        won’t work. For the most part, this section does not show
        error-checking code, but that is for brevity. Production code always should include error handling. The sample scripts in
        the <code>recipes</code> distribution from which
        the examples are taken do include error handling, based on the
        techniques illustrated in <a data-type="xref" href="#nch-api-api-error">Recipe 4.2</a>.</p><p>If a statement does execute without error, your next step
        depends on the statement type. If it’s one that returns no result set,
        there’s nothing else to do, unless you want to check how many rows
        were affected. If the statement does return a result set, fetch its
        rows, then close the result set. In a context where you don’t know
        whether a statement returns a result set, <a data-type="xref" href="ch12.xhtml#nch-meta-meta-result">Recipe 12.2</a> discusses how to tell.</p></div></section><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820385094640"><h3>Perl</h3><p>The Perl DBI module provides two basic approaches to SQL statement
        execution, depending on whether you expect to get back a result set.
        For a statement such as <code>INSERT</code> or
        <code>UPDATE</code> that returns no result set,
        use the database handle <code>do()</code>
        method. It executes the statement and returns the number of rows
        affected by it, or <code>undef</code> if an
        error occurs. If Sybil gets a new cat, the following
        statement increments her <code>cats</code> count
        by one:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="s">"UPDATE profile SET cats = cats+1</code>
<code class="s">                       WHERE name = 'Sybil'"</code><code class="p">);</code>
<code class="k">if</code> <code class="p">(</code><code class="nv">$count</code><code class="p">)</code>   <code class="c1"># print row count if no error occurred</code>
<code class="p">{</code>
  <code class="nv">$count</code> <code class="o">+=</code> <code class="mi">0</code><code class="p">;</code>
  <code class="k">print</code> <code class="s">"Number of rows updated: $count\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p>If the statement executes successfully but affects no rows,
        <code>do()</code> returns a special value,
        <code>"0E0"</code> (the value zero in scientific
        notation, expressed as a string). <code>"0E0"</code> can be used for testing the execution
        status of a statement because it is true in Boolean contexts (unlike
        <code>undef</code>). For successful statements,
        it can also be used when counting how many rows were affected because
        it is treated as the number zero in numeric contexts. Of course, if
        you print that value as is, you’ll print <code>"0E0"</code>, which might look odd to people who
        use your program. The preceding example makes sure that doesn’t happen
        by adding zero to the value to coerce it to numeric form so that it
        displays as <code>0</code>. Alternatively, use
        <code>printf</code> with a <code>%d</code> format specifier to cause an implicit numeric
        conversion:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">if</code> <code class="p">(</code><code class="nv">$count</code><code class="p">)</code>   <code class="c1"># print row count if no error occurred</code>
<code class="p">{</code>
  <code class="nb">printf</code> <code class="s">"Number of rows updated: %d\n"</code><code class="p">,</code> <code class="nv">$count</code><code class="p">;</code>
<code class="p">}</code></pre><p>If <code>RaiseError</code> is enabled,
        your script terminates automatically for DBI-related
        errors, so you need not check <code>$count</code> to find out whether <code>do()</code> failed and consequently can simplify
        the code:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="s">"UPDATE profile SET cats = cats+1</code>
<code class="s">                       WHERE name = 'Sybil'"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="s">"Number of rows updated: %d\n"</code><code class="p">,</code> <code class="nv">$count</code><code class="p">;</code></pre><p>To process a statement such as <code>SELECT</code> that does return a result set, use a
        different approach that involves these steps:</p><ol><li><p>Specify the statement to be executed by calling <code>prepare()</code> using the database handle.
            <code>prepare()</code> returns a statement handle to use with all subsequent
            operations on the statement. (If an error occurs, the script
            terminates if <code>RaiseError</code> is
            enabled; otherwise, <code>prepare()</code>
            returns <code>undef</code>.)</p></li><li><p>Call <code>execute()</code> to execute
            the statement and generate the result set.</p></li><li><p>Loop to fetch the rows returned by the statement. DBI
            provides several methods for this; we cover them shortly.</p></li><li><p>If you don’t fetch the entire result set, release resources
            associated with it by calling <code>finish()</code>.</p></li></ol><p>The following example illustrates these steps, using <code>fetchrow_array()</code> as the row-fetching method
        and assuming that <code>RaiseError</code> is
        enabled so that errors terminate the script:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT id, name, cats FROM profile"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">@val</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_array</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="s">"id: $val[0], name: $val[1], cats: $val[2]\n"</code><code class="p">;</code>
  <code class="o">++</code><code class="nv">$count</code><code class="p">;</code>
<code class="p">}</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">finish</code> <code class="p">();</code>
<code class="k">print</code> <code class="s">"Number of rows returned: $count\n"</code><code class="p">;</code></pre><p>The row array size indicates the number of columns in the result
        set.</p><p>The row-fetching loop just shown is followed by a call to
        <code>finish()</code>, which closes the result
        set and tells the server to free any resources associated with it. If
        you fetch every row in the set, DBI notices when you reach the end and
        releases the resources for you. Thus, the example could omit the
        <code>finish()</code> call without ill
        effect.</p><p>As the example illustrates, to determine how many rows a result
        set contains, count them while fetching them. Do not use the DBI
        <code>rows()</code> method for this purpose. The
        DBI documentation discourages this practice because <code>rows()</code> is not necessarily reliable for <code>SELECT</code>
        statements—due to differences in
        behavior among database engines and drivers.</p><p>DBI has several methods that fetch a row at a time. The one used
        in the preceding example, <code>fetchrow_array()</code>, returns an array
        containing the next row, or an empty list when there are no more rows.
        Array elements are present in the order named in the <code>SELECT</code> statement. Access them as <code>$val[0]</code>, <code>$val[1]</code>, and so forth.</p><p>The <code>fetchrow_array()</code> method
        is most useful for statements that explicitly name the columns to
        select. (With <code>SELECT</code> <code>*</code>, there are no guarantees about the
        positions of columns within the array.)</p><p><code>fetchrow_arrayref()</code> is
        like <code>fetchrow_array()</code>, except that it returns a
        reference to the array, or <code>undef</code>
        when there are no more rows. As with <code>fetchrow_array()</code>, array elements are present
        in the order named in the statement. Access them as <code>$ref-&gt;[0]</code>, <code>$ref-&gt;[1]</code>, and so forth:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_arrayref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="s">"id: $ref-&gt;[0], name: $ref-&gt;[1], cats: $ref-&gt;[2]\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p><code>fetchrow_hashref()</code> returns a
        reference to a hash structure, or <code>undef</code> when there are no more rows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_hashref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="s">"id: $ref-&gt;{id}, name: $ref-&gt;{name}, cats: $ref-&gt;{cats}\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p>To access the elements of the hash, use the names of the columns
        selected by the statement (<code>$ref-&gt;{id}</code>, <code>$ref-&gt;{name}</code>, and so forth). <code>fetchrow_hashref()</code> is particularly useful
        for <code>SELECT</code> <code>*</code> statements because you can access elements
        of rows without knowing anything about the order in which columns are
        returned. You need know only their names. On the other hand, it’s more
        expensive to set up a hash than an array, so <code>fetchrow_hashref()</code> is slower than <code>fetchrow_array()</code> or <code>fetchrow_arrayref()</code>. It’s also possible to
        <q>lose</q> row elements if they have the same name because
        column names must be unique. Same-name columns are not uncommon for
        joins between tables. For solutions to this problem, see <a data-type="xref" href="ch16.xhtml#nch-multi-multi-api-col-names">Recipe 16.11</a>.</p><p>In addition to the statement execution methods just described,
        DBI provides several high-level retrieval methods that execute a
        statement and return the result set in a single operation. All are
        database-handle methods that create and dispose of the statement
        handle internally before returning the result set. The methods differ
        in the form in which they return the result. Some return the entire
        result set, others return a single row or column of the set, as
        summarized in the <a data-type="xref" href="#nch-api-api-statement-select">Table 4-4</a>:</p><table id="nch-api-api-statement-select"><caption><span class="label">Table 4-4. </span>Perl methods to retrieve results</caption><thead><tr><th>Method</th><th>Return value</th></tr></thead><tbody><tr><td><code>selectrow_array() </code></td><td>First row of result
                set as an array</td></tr><tr><td><code>selectrow_arrayref() </code></td><td>First row of result set
                as a reference to an array</td></tr><tr><td><code>selectrow_hashref() </code></td><td>First row of result
                set as a reference to a hash</td></tr><tr><td><code>selectcol_arrayref() </code></td><td>First column of result
                set as a reference to an array</td></tr><tr><td><code>selectall_arrayref() </code></td><td>Entire result set as a
                reference to an array of array
                references</td></tr><tr><td><code>selectall_hashref() </code></td><td>Entire result set as a reference to a hash of hash
                references</td></tr></tbody></table><p>Most of these methods return a reference. The exception is
        <code>selectrow_array()</code>, which selects
        the first row of the result set and returns an array or a scalar,
        depending on how you call it. In array context, <code>selectrow_array()</code> returns the entire row as
        an array (or the empty list if no row was selected). This is useful
        for statements from which you expect to obtain only a single row. The
        return value can be used to determine the result set size. The column
        count is the number of elements in the array, and the row count is 1
        or 0:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">@val</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectrow_array</code> <code class="p">(</code><code class="s">"SELECT name, birth, foods FROM profile</code>
<code class="s">                                  WHERE id = 3"</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nv">@val</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nv">$ncols</code> <code class="p">?</code> <code class="mi">1</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code></pre><p><code>selectrow_arrayref()</code> and
        <code>selectrow_hashref()</code> select the
        first row of the result set and return a reference to it, or <code>undef</code> if no row was selected. To access the
        column values, treat the reference the same way you treat the return
        value from <code>fetchrow_arrayref()</code> or
        <code>fetchrow_hashref()</code>. The reference
        also provides the row and column counts:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectrow_arrayref</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="p">)</code> <code class="p">?</code> <code class="nv">@</code><code class="p">{</code><code class="nv">$ref</code><code class="p">}</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nv">$ncols</code> <code class="p">?</code> <code class="mi">1</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code>

<code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectrow_hashref</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="p">)</code> <code class="p">?</code> <code class="nb">keys</code> <code class="p">(</code><code class="nv">%</code><code class="p">{</code><code class="nv">$ref</code><code class="p">})</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nv">$ncols</code> <code class="p">?</code> <code class="mi">1</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code></pre><p><code>selectcol_arrayref()</code> returns
        a reference to a single-column array representing the first column of
        the result set. Assuming a non-<code>undef</code> return value, access elements of the
        array as <code>$ref-&gt;[</code><em><code>i</code></em><code>]</code> for the value from row
        <em><code>i</code></em>. The number of rows is the number of
        elements in the array, and the column count is 1 or 0:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectcol_arrayref</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="p">)</code> <code class="p">?</code> <code class="nv">@</code><code class="p">{</code><code class="nv">$ref</code><code class="p">}</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nv">$nrows</code> <code class="p">?</code> <code class="mi">1</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code></pre><p><code>selectall_arrayref()</code> returns
        a reference to an array containing an element for each row of the
        result. Each element is a reference to an array. To access row
        <em><code>i</code></em> of the result set, use <code>$ref-&gt;[</code><em><code>i</code></em><code>]</code> to get a reference to the row. Then treat
        the row reference the same way as a return value from <code>fetchrow_arrayref()</code> to access individual
        column values in the row. The result set row and column counts are
        available as follows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectall_arrayref</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="p">)</code> <code class="p">?</code> <code class="nv">@</code><code class="p">{</code><code class="nv">$ref</code><code class="p">}</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nv">$nrows</code> <code class="p">?</code> <code class="nv">@</code><code class="p">{</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">[</code><code class="mi">0</code><code class="p">]}</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code></pre><p><code>selectall_hashref()</code> returns a
        reference to a hash, each element of which is a hash reference to a
        row of the result. To call it, specify an argument that indicates
        which column to use for hash keys. For example, if you retrieve rows
        from the <code>profile</code> table, the primary
        key is the <code>id</code> column:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectall_hashref</code> <code class="p">(</code><code class="s">"SELECT * FROM profile"</code><code class="p">,</code> <code class="s">"id"</code><code class="p">);</code></pre><p>Access rows using the keys of the hash. For a row that has a key
        column value of <code>12</code>, the hash
        reference for the row is <code>$ref-&gt;{12}</code>. That row value is keyed on
        column names, which you can use to access individual column elements
        (for example, <code>$ref-&gt;{12}-&gt;{name}</code>). The result set
        row and column counts are available as follows:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">@keys</code> <code class="o">=</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="p">)</code> <code class="p">?</code> <code class="nb">keys</code> <code class="p">(</code><code class="nv">%</code><code class="p">{</code><code class="nv">$ref</code><code class="p">})</code> <code class="p">:</code> <code class="p">();</code>
<code class="k">my</code> <code class="nv">$nrows</code> <code class="o">=</code> <code class="nb">scalar</code> <code class="p">(</code><code class="nv">@keys</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$ncols</code> <code class="o">=</code> <code class="nv">$nrows</code> <code class="p">?</code> <code class="nb">keys</code> <code class="p">(</code><code class="nv">%</code><code class="p">{</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="nv">$keys</code><code class="p">[</code><code class="mi">0</code><code class="p">]}})</code> <code class="p">:</code> <code class="mi">0</code><code class="p">;</code></pre><p>The <code>selectall_</code><em><code>XXX</code></em><code>()</code> methods are useful when you need to
        process a result set more than once because Perl DBI provides no way
        to <q>rewind</q> a result set. By assigning the entire result
        set to a variable, you can iterate through its elements multiple
        times.</p><p>Take care when using the high-level methods if you have <code>RaiseError</code> disabled. In that case, a
        method’s return value may not enable you to distinguish an error from
        an empty result set. For example, if you call <code>selectrow_array()</code> in scalar context to
        retrieve a single value, an <code>undef</code>
        return value is ambiguous because it may indicate any of three things:
        an error, an empty result set, or a result set consisting of a single
        <code>NULL</code> value. To test for an error,
        check the value of <code>$DBI::errstr</code>, <code>$DBI::err</code>, or <code>$DBI::state</code>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820385094176"><h3>Ruby</h3><p>
          The Ruby Mysql2 API uses the same calls for SQL statements that do not return a result
set and those that do. To process a statement in Ruby use method <code>query</code>.
        If the statement fails with an
        error, <code>query</code> raises an exception. Otherwise, method <code>affected_rows</code> returns number of rows changed for the last statement that modify data.</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="s2">"UPDATE profile SET cats = cats+1 WHERE name = 'Sybil'"</code><code class="p">)</code>
<code class="nb">puts</code> <code class="s2">"Number of rows updated: </code><code class="si">#{</code><code class="n">client</code><code class="o">.</code><code class="n">affected_rows</code><code class="si">}</code><code class="s2">"</code></pre><p>For statements such as <code>SELECT</code> that return
          a result set, method <code>query</code> returns the result set as an instance of the class <code>Mysql2::Result</code>. Method <code>affected_rows</code> will return number of rows in the result set for such statements. You may also obtain number of rows in the result set by using method <code>count</code> of the <code>Mysql2::Result</code> object.
        </p><pre data-type="programlisting" data-code-language="ruby"><code class="n">result</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile"</code><code class="p">)</code>
<code class="nb">puts</code> <code class="s2">"Number of rows returned: </code><code class="si">#{</code><code class="n">client</code><code class="o">.</code><code class="n">affected_rows</code><code class="si">}</code><code class="s2">"</code>
<code class="nb">puts</code> <code class="s2">"Number of rows returned: </code><code class="si">#{</code><code class="n">result</code><code class="o">.</code><code class="n">count</code><code class="si">}</code><code class="s2">"</code>
<code class="n">result</code><code class="o">.</code><code class="n">each</code> <code class="k">do</code> <code class="o">|</code><code class="n">row</code><code class="o">|</code>
  <code class="nb">printf</code> <code class="s2">"id: %s, name: %s, cats: %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="n">row</code><code class="o">[</code><code class="s2">"id"</code><code class="o">]</code><code class="p">,</code> <code class="n">row</code><code class="o">[</code><code class="s2">"name"</code><code class="o">]</code><code class="p">,</code> <code class="n">row</code><code class="o">[</code><code class="s2">"cats"</code><code class="o">]</code>
<code class="k">end</code></pre><p>
          <code>result.fields</code> contains the names of the columns in the result set.
        </p></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820384220240"><h3>PHP</h3><p>PDO has two connection-object methods to execute SQL statements:
        <code>exec()</code> for statements that do not
        return a result set and <code>query()</code> for
        those that do. If you have PDO exceptions enabled, both methods raise
        an exception if statement execution fails. (Another approach couples
        the <code>prepare()</code> and <code>execute()</code> methods; see <a data-type="xref" href="#nch-api-api-quoting">Recipe 4.5</a>.)</p><p>To execute statements such as <code>INSERT</code> or <code>UPDATE</code> that don’t return rows, use <code>exec()</code>. It
        returns a count to indicate how many rows were changed:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">exec</code> <code class="p">(</code><code class="s2">"UPDATE profile SET cats = cats+1 WHERE name = 'Sybil'"</code><code class="p">);</code>
<code class="nb">printf</code> <code class="p">(</code><code class="s2">"Number of rows updated: %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$count</code><code class="p">);</code></pre><p>For statements such as <code>SELECT</code> that return
        a result set, the <code>query()</code> method
        returns a statement handle. Generally, you use this object to call a
        row-fetching method in a loop, and count the rows if you need to know
        how many there are:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">query</code> <code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile"</code><code class="p">);</code>
<code class="nv">$count</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
<code class="k">while</code> <code class="p">(</code><code class="nv">$row</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">fetch</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_NUM</code><code class="p">))</code>
<code class="p">{</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"id: %s, name: %s, cats: %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">2</code><code class="p">]);</code>
  <code class="nv">$count</code><code class="o">++</code><code class="p">;</code>
<code class="p">}</code>
<code class="nb">printf</code> <code class="p">(</code><code class="s2">"Number of rows returned: %d</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$count</code><code class="p">);</code></pre><p>To determine the number of columns in the result set, call the
        statement handle <code>columnCount()</code>
        method.</p><p>The example demonstrates the statement handle <code>fetch()</code>
        method, which returns the next row of the result set or <code>FALSE</code> when there are no more. <code>fetch()</code> takes an optional argument that
        indicates what type of value it should return. As shown, with an
        argument of <code>PDO::FETCH_NUM</code>,
        <code>fetch()</code> returns an array with
        elements accessed using numeric subscripts, beginning with 0. The
        array size indicates the number of result set columns.</p><p>With an argument of <code>PDO::FETCH_ASSOC</code>, <code>fetch()</code> returns an associative array
        containing values accessed by column name (<code>$row["id"]</code>, <code>$row["name"]</code>, <code>$row["cats"]</code>).</p><p>With an argument of <code>PDO::FETCH_OBJ</code>, <code>fetch()</code> returns an object having members
        accessed using the column names (<code>$row-&gt;id</code>, <code>$row-&gt;name</code>, <code>$row-&gt;cats</code>).</p><p><code>fetch()</code> uses the default
        fetch mode if you invoke it with no argument. Unless you have changed
        the mode, it’s <code>PDO::FETCH_BOTH</code>,
        which is like a combination of <code>PDO::FETCH_NUM</code> and <code>PDO::FETCH_ASSOC</code>. To set the default fetch
        mode for all statements executed within a connection, use the <code>setAttribute</code>
        database-handle method:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">setAttribute</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">ATTR_DEFAULT_FETCH_MODE</code><code class="p">,</code> <code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_ASSOC</code><code class="p">);</code></pre><p>To set the mode for a given statement, call its <code>setFetchMode()</code>
        method after executing the statement and before fetching the
        results:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">setFetchMode</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_OBJ</code><code class="p">);</code></pre><p>It’s also possible to use a statement handle as an iterator. The
        handle uses the current default fetch mode:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">setFetchMode</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_NUM</code><code class="p">);</code>
<code class="k">foreach</code> <code class="p">(</code><code class="nv">$sth</code> <code class="k">as</code> <code class="nv">$row</code><code class="p">)</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"id: %s, name: %s, cats: %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">2</code><code class="p">]);</code></pre><p>The <code>fetchAll()</code> method
        fetches and returns the entire result set as an array of
        rows. It permits an optional fetch-mode argument:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$rows</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">fetchAll</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_NUM</code><code class="p">);</code>
<code class="k">foreach</code> <code class="p">(</code><code class="nv">$rows</code> <code class="k">as</code> <code class="nv">$row</code><code class="p">)</code>
  <code class="nb">printf</code> <code class="p">(</code><code class="s2">"id: %s, name: %s, cats: %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="nv">$row</code><code class="p">[</code><code class="mi">2</code><code class="p">]);</code></pre><p>In this case, the row count is the number of elements in
        <code>$rows</code>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820383928688"><h3>Python</h3><p>The Python DB API uses the same calls for SQL statements that do not
        return a result set and those that do. To process a statement in
        Python, use your database connection object to get a cursor object.
        Then use the cursor’s <code>execute()</code>
        method to send the statement to the server. If the statement
        fails with an error, <code>execute()</code>
        raises an exception. Otherwise, if there is no result set, statement
        execution is complete, and the cursor’s <code>rowcount</code> attribute indicates how many rows were changed:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"UPDATE profile SET cats = cats+1 WHERE name = 'Sybil'"</code><code class="p">)</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows updated: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="n">conn</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><div data-type="note" epub:type="note"><h6>Note</h6><p>The Python DB API specification indicates that database connections should begin with
          auto-commit mode <em>disabled</em>, so Connector/Python
          disables auto-commit when it connects to the MySQL server. If you
          use transactional tables, modifications to them are rolled back when
          you close the connection unless you commit the changes first, which
          is why the preceding example invokes the <code>commit()</code> method. For more information on auto-commit mode, see
          <a data-type="xref" href="ch20.xhtml#nch-xact">Chapter 20</a>, particularly <a data-type="xref" href="ch20.xhtml#nch-xact-xact-python">Recipe 20.7</a>).</p></div><p>If the statement returns a result set, fetch its rows, then
        close the cursor. The <code>fetchone()</code> method
        returns the next row as a sequence, or <code>None</code> when there are no more rows:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile"</code><code class="p">)</code>
<code class="k">while</code> <code class="bp">True</code><code class="p">:</code>
  <code class="n">row</code> <code class="o">=</code> <code class="n">cursor</code><code class="o">.</code><code class="n">fetchone</code><code class="p">()</code>
  <code class="k">if</code> <code class="n">row</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>
    <code class="k">break</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"id: </code><code class="si">%s</code><code class="s2">, name: </code><code class="si">%s</code><code class="s2">, cats: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">2</code><code class="p">]))</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows returned: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>As you can see from the preceding example, the <code>rowcount</code> attribute is useful for <code>SELECT</code>
        statements, too; it indicates the number of rows in the result
        set.</p><p><code>len(row)</code> tells you the number
        of columns in the result set.</p><p>Alternatively, use the cursor itself as an iterator that returns
        each row in turn:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile"</code><code class="p">)</code>
<code class="k">for</code> <code class="p">(</code><code class="nb">id</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">cats</code><code class="p">)</code> <code class="ow">in</code> <code class="n">cursor</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"id: </code><code class="si">%s</code><code class="s2">, name: </code><code class="si">%s</code><code class="s2">, cats: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="nb">id</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">cats</code><code class="p">))</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows returned: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>The <code>fetchall()</code> method
        returns the entire result set as a list of tuples. Iterate through the list to access the rows:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile"</code><code class="p">)</code>
<code class="n">rows</code> <code class="o">=</code> <code class="n">cursor</code><code class="o">.</code><code class="n">fetchall</code><code class="p">()</code>
<code class="k">for</code> <code class="n">row</code> <code class="ow">in</code> <code class="n">rows</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"id: </code><code class="si">%s</code><code class="s2">, name: </code><code class="si">%s</code><code class="s2">, cats: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">2</code><code class="p">]))</code>
<code class="k">print</code><code class="p">(</code><code class="s2">"Number of rows returned: </code><code class="si">%d</code><code class="s2">"</code> <code class="o">%</code> <code class="n">cursor</code><code class="o">.</code><code class="n">rowcount</code><code class="p">)</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>DB API provides no way to rewind a result set, so <code>fetchall()</code> can be convenient when you must
        iterate through the rows of the result set more than once or access
        individual values directly. For example, if <code>rows</code> holds the result set, you can access
        the value of the third column in the second row as <code>rows[1][2]</code> (indexes begin at 0, not 1).</p></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820383572768"><h3>Go</h3><p>The Go <code>sql</code> interface has two connection-object functions to execute SQL statements: <code>Exec()</code> for statements that do not return result set and <code>Query()</code> for the statements that do. Both return <code>error</code> if the statement fails.
        </p><p>
          To run a statement that does not return any row, such as <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code>, use the function <code>Exec()</code>. It’s return values can have one of the types: <code>Result</code> or <code>error</code>. Interface <code>Result</code> has a function <code>RowsAffected()</code> that indicates how many rows were changed.
        </p><pre data-type="programlisting" data-code-language="go"><code class="nx">sql</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">"UPDATE profile SET cats = cats+1 WHERE name = 'Sybil'"</code><code class="w"/>
<code class="nx">res</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Exec</code><code class="p">(</code><code class="nx">sql</code><code class="p">)</code><code class="w"/>

<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nb">panic</code><code class="p">(</code><code class="nx">err</code><code class="p">.</code><code class="nx">Error</code><code class="p">())</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="nx">affectedRows</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">RowsAffected</code><code class="p">()</code><code class="w"/>

<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"The statement affected %d rows\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">affectedRows</code><code class="p">)</code><code class="w"/></pre><p>
         For the satements that return a result set, typically <code>SELECT</code>, use the function <code>Query()</code>. This function returns cursor to the object of type <code>Rows</code> that holds the result of the query. Call the function <code>Next()</code> to iterate through the result and store returned values in the variables using function <code>Scan()</code>. If <code>Next()</code> returns <code>false</code> this means that there is no result.
       </p><pre data-type="programlisting" data-code-language="go"><code class="nx">res</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Query</code><code class="p">(</code><code class="s">"SELECT id, name, cats FROM profile"</code><code class="p">)</code><code class="w"/>

<code class="k">defer</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="k">for</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Next</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>

<code class="w">	</code><code class="kd">var</code><code class="w"> </code><code class="nx">profile</code><code class="w"> </code><code class="nx">Profile</code><code class="w"/>
<code class="w">	</code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">cats</code><code class="p">)</code><code class="w"/>

<code class="w">	</code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>

<code class="w">	</code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"%+v\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
          If <code>Next()</code> is called and returns <code>false</code> the <code>Rows</code> are closed automatically. Otherwise you need to close them using function <code>Close()</code>.
        </p><p>
          For the queries that expect to return at most one row exists a special function <code>QueryRow()</code> that returns a <code>Row</code> object that could be immediately scanned. <code>QueryRow()</code> never returns error until <code>Scan()</code> is called. If the query returns no row, <code>Scan()</code> returns <code>ErrNoRows</code>.
        </p><pre data-type="programlisting" data-code-language="go"><code class="nx">row</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">QueryRow</code><code class="p">(</code><code class="s">"SELECT id, name, cats FROM profile where id=3"</code><code class="p">)</code><code class="w"/>

<code class="kd">var</code><code class="w"> </code><code class="nx">profile</code><code class="w"> </code><code class="nx">Profile</code><code class="w"/>
<code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">row</code><code class="p">.</code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">id</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">cats</code><code class="p">)</code><code class="w"/>

<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">ErrNoRows</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"No row matched!"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	</code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"%v\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820383299264"><h3>Java</h3><p>The JDBC interface provides specific object types for the various phases of
        SQL statement processing. Statements are executed in JDBC using Java
        objects of one type. The results, if any, are returned as objects of
        another type.</p><p>To execute a statement, first get a <code>Statement</code> object by calling the <code>createStatement()</code> method of your <code>Connection</code> object:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code></pre><p>Then use the <code>Statement</code> object
        to send the statement to the server. JDBC provides several
        methods for doing this. Choose the one that’s appropriate for the type
        of statement: <code>executeUpdate()</code> for
        statements that don’t return a result set, <code>executeQuery()</code> for statements that do, and
        <code>execute()</code> when you don’t know. Each
        method raises an exception if the statement fails.</p><p>The <code>executeUpdate()</code> method
        sends a statement that generates no result set to the server and
        returns a count indicating the number of affected rows. When you’re
        done with the statement object, close it:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code>
<code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">executeUpdate</code><code class="o">(</code>
               <code class="s">"UPDATE profile SET cats = cats+1 WHERE name = 'Sybil'"</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>   <code class="c1">// close statement</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Number of rows updated: "</code> <code class="o">+</code> <code class="n">count</code><code class="o">);</code></pre><p>For statements that return a result set, use <code>executeQuery()</code>. Then get a result set
        object, and use it to retrieve the row values. When you’re done, close
        the result set and statement objects:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code> <code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code><code class="o">(</code><code class="s">"SELECT id, name, cats FROM profile"</code><code class="o">);</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSet</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">count</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
<code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code> <code class="o">{</code> <code class="c1">// loop through rows of result set\</code>
  <code class="kt">int</code> <code class="n">id</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getInt</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>   <code class="c1">// extract columns 1, 2, and 3</code>
  <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>
  <code class="kt">int</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getInt</code><code class="o">(</code><code class="mi">3</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"id: "</code> <code class="o">+</code> <code class="n">id</code>
                     <code class="o">+</code> <code class="s">", name: "</code> <code class="o">+</code> <code class="n">name</code>
                     <code class="o">+</code> <code class="s">", cats: "</code> <code class="o">+</code> <code class="n">cats</code><code class="o">);</code>
  <code class="o">++</code><code class="n">count</code><code class="o">;</code>
<code class="o">}</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code>  <code class="c1">// close result set</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code> <code class="o">();</code>   <code class="c1">// close statement</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code> <code class="o">(</code><code class="s">"Number of rows returned: "</code> <code class="o">+</code> <code class="n">count</code><code class="o">);</code></pre><p>The <code>ResultSet</code> object
        returned by the <code>getResultSet()</code> method of your <code>Statement</code> object has its own methods, such
        as <code>next()</code> to fetch rows and various
        <code>get</code><em><code>XXX</code></em><code>()</code> methods that access columns of the
        current row. Initially, the result set is positioned just before the
        first row of the set. Call <code>next()</code>
        to fetch each row in succession until it returns false. To determine
        the number of rows in a result set, count them yourself, as shown in
        the preceding example.</p><div data-type="tip"><h6>Tip</h6><p>
            For queries that return single result set it is not necessary to call <span class="command"><em>getResultSet</em></span>. Code above could be written as:
            </p><pre data-type="programlisting" data-code-language="java"><code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code><code class="o">(</code><code class="s">"SELECT id, name, cats FROM profile"</code><code class="o">);</code></pre><p>.
            Separate call is needed when your query can return multiple result sets, for example, if you call a stored routine.
          </p></div><p>To access column values, use methods such as <code>getInt()</code>, <code>getString()</code>, <code>getFloat()</code>, and <code>getDate()</code>. To obtain the column value as a
        generic object, use <code>getObject()</code>. The
        argument to a <code>get</code><em><code>XXX</code></em><code>()</code> call can indicate either column position
        (beginning at 1, not 0) or column name. The previous example shows how
        to retrieve the <code>id</code>, <code>name</code>, and <code>cats</code> columns by position. To access columns
        by name instead, write the row-fetching loop as follows:</p><pre data-type="programlisting" data-code-language="java"><code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code> <code class="o">{</code> <code class="c1">// loop through rows of result set</code>
  <code class="kt">int</code> <code class="n">id</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getInt</code><code class="o">(</code><code class="s">"id"</code><code class="o">);</code>
  <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
  <code class="kt">int</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getInt</code><code class="o">(</code><code class="s">"cats"</code><code class="o">);</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"id: "</code> <code class="o">+</code> <code class="n">id</code>
                     <code class="o">+</code> <code class="s">", name: "</code> <code class="o">+</code> <code class="n">name</code>
                     <code class="o">+</code> <code class="s">", cats: "</code> <code class="o">+</code> <code class="n">cats</code><code class="o">);</code>
  <code class="o">++</code><code class="n">count</code><code class="o">;</code>
<code class="o">}</code></pre><p>To retrieve a given column value, use any <code>get</code><em><code>XXX</code></em><code>()</code> call that makes sense for the data type.
        For example, <code>getString()</code> retrieves
        any column value as a string:</p><pre data-type="programlisting" data-code-language="java"><code class="n">String</code> <code class="n">id</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"id"</code><code class="o">);</code>
<code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
<code class="n">String</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"cats"</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"id: "</code> <code class="o">+</code> <code class="n">id</code>
                   <code class="o">+</code> <code class="s">", name: "</code> <code class="o">+</code> <code class="n">name</code>
                   <code class="o">+</code> <code class="s">", cats: "</code> <code class="o">+</code> <code class="n">cats</code><code class="o">);</code></pre><p>Or use <code>getObject()</code> to
        retrieve values as generic objects and convert the values as
        necessary. The following example uses <code>toString()</code> to convert object values to printable form:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Object</code> <code class="n">id</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getObject</code><code class="o">(</code><code class="s">"id"</code><code class="o">);</code>
<code class="n">Object</code> <code class="n">name</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getObject</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
<code class="n">Object</code> <code class="n">cats</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getObject</code><code class="o">(</code><code class="s">"cats"</code><code class="o">);</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"id: "</code> <code class="o">+</code> <code class="n">id</code><code class="o">.</code><code class="na">toString</code><code class="o">()</code>
                   <code class="o">+</code> <code class="s">", name: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">.</code><code class="na">toString</code><code class="o">()</code>
                   <code class="o">+</code> <code class="s">", cats: "</code> <code class="o">+</code> <code class="n">cats</code><code class="o">.</code><code class="na">toString</code><code class="o">());</code></pre><p>To determine the number of columns in the result set, access its
        metadata:</p><pre data-type="programlisting" data-code-language="java"><code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSet</code><code class="o">();</code>
<code class="n">ResultSetMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getMetaData</code><code class="o">();</code> <code class="c1">// get result set metadata</code>
<code class="kt">int</code> <code class="n">ncols</code> <code class="o">=</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnCount</code><code class="o">();</code>         <code class="c1">// get column count from metadata</code></pre><p>The third JDBC statement-execution method, <code>execute()</code>, works for either type of
        statement. It’s particularly useful when you receive a statement
        string from an external source and don’t know whether it generates a
        result set or returns multiple result sets. The return value from <code>execute()</code> indicates the statement type so
        that you can process it appropriately: if <code>execute()</code> returns true, there is a result
        set, otherwise not. Typically, you’d use it something like this, where
        <code>stmtStr</code> represents an arbitrary
        SQL statement:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code><code class="o">();</code>
<code class="k">if</code> <code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="na">execute</code><code class="o">(</code><code class="n">stmtStr</code><code class="o">))</code> <code class="o">{</code>
  <code class="c1">// there is a result set</code>
  <code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSe</code><code class="o">();</code>

  <code class="c1">// ... process result set here ...</code>

  <code class="n">rs</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>  <code class="c1">// close result set</code>
<code class="o">}</code> <code class="k">else</code> <code class="o">{</code>
  <code class="c1">// there is no result set, just print the row count</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Number of rows affected: "</code> <code class="o">+</code> <code class="n">s</code><code class="o">.</code><code class="na">getUpdateCount</code> <code class="o">());</code>
<code class="o">}</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>   <code class="c1">// close statement</code></pre></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.5 Handling Special Characters and NULL Values in Statements"><div class="sect1" id="nch-api-api-quoting"><h1>4.5 Handling Special Characters and NULL Values in Statements</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820382411632"><h2>Problem</h2><p>You need to construct SQL statements that refer to data values containing
      special characters such as quotes or backslashes, or special values such
      as <code>NULL</code>. Or you are constructing
      statements using data obtained from external sources and want to prevent
      SQL injection attacks.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820382460800"><h2>Solution</h2><p>Use your API’s placeholder mechanism or quoting function to make data safe for
      insertion.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820382459808"><h2>Discussion</h2><p>Up to this point in the chapter, our statements have used
      <q>safe</q> data values that require no special treatment. For
      example, we can easily construct the following SQL statements from
      within a program by writing the data values literally in the statement
      strings:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">profile</code> <code class="k">WHERE</code> <code class="n">age</code> <code class="o">&gt;</code> <code class="mi">40</code> <code class="k">AND</code> <code class="n">color</code> <code class="o">=</code> <code class="s1">'green'</code><code class="p">;</code>

<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">color</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'Gary'</code><code class="p">,</code><code class="s1">'blue'</code><code class="p">);</code></pre><p>However, some data values are not so easily handled and cause
      problems if you are not careful. Statements might use values that
      contain special characters such as quotes, backslashes, binary data, or
      values that are <code>NULL</code>. The following
      discussion describes the difficulties these values cause and the proper
      techniques for handling them.</p><p>Suppose that you want to execute this <code>INSERT</code>
      statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'Alison'</code><code class="p">,</code><code class="s1">'1973-01-12'</code><code class="p">,</code><code class="s1">'blue'</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>There’s nothing unusual about that. But if you change the <code>name</code> column value to something like <code>De'Mont</code> that contains a single quote, the
      statement becomes syntactically invalid:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">','</code><code class="n">blue</code><code class="s1">','</code><code class="n">eggroll</code><code class="err">'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>The problem is the single quote inside a single-quoted string. To
      make the statement legal by escaping the quote, precede it with either a
      single quote or a backslash:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De''Mont'</code><code class="p">,</code><code class="s1">'1973-01-12'</code><code class="p">,</code><code class="s1">'blue'</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De\'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">','</code><code class="n">blue</code><code class="s1">','</code><code class="n">eggroll</code><code class="err">'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>Alternatively, quote the <code>name</code>
      value itself within double quotes rather than within single quotes
      (assuming that the <code>ANSI_QUOTES</code> SQL
      mode is not enabled):</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="ss">"De'Mont"</code><code class="p">,</code><code class="s1">'1973-01-12'</code><code class="p">,</code><code class="s1">'blue'</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>If you are writing a statement literally in your program, you can
      escape or quote the <code>name</code> value by
      hand because you know what the value is. But if the name is stored in a
      variable, you don’t necessarily know what the variable’s value is. Worse
      yet, single quote isn’t the only character you must be prepared to deal
      with; double quotes and backslashes cause problems, too. And if the
      database stores binary data such as images or sound clips, a value might
      contain anything—not only quotes or backslashes, but other characters
      such as nulls (zero-valued bytes). The need to handle special characters
      properly is particularly acute in a web environment where statements are
      constructed using form input (for example, if you search for rows that
      match search terms entered by the remote user). You must be able to
      handle any kind of input in a general way because you can’t predict in
      advance what kind of information a user will supply. It is not uncommon
      for malicious users to enter garbage values containing problematic
      characters in a deliberate attempt to compromise the security of your
      server and even execute fatal commands, such as <code>DROP TABLE</code>. That is a standard technique for exploiting insecure
      scripts, called <a href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a>.</p><p>The SQL <code>NULL</code> value is not a
      special character, but it too requires special treatment. In SQL,
      <code>NULL</code> indicates <q>no
      value.</q> This can have several meanings depending on context, such
      as <q>unknown,</q> <q>missing,</q> <q>out of
      range,</q> and so forth. Our statements thus far have not used
      <code>NULL</code> values, to avoid dealing with
      the complications that they introduce, but now it’s time to address
      these issues. For example, if you don’t know De’Mont’s favorite color,
      you can set the <code>color</code> column to
      <code>NULL</code>—but not by writing the statement
      like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De''Mont'</code><code class="p">,</code><code class="s1">'1973-01-12'</code><code class="p">,</code><code class="s1">'NULL'</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>Instead, the <code>NULL</code> value must
      have no enclosing quotes:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De''Mont'</code><code class="p">,</code><code class="s1">'1973-01-12'</code><code class="p">,</code><code class="k">NULL</code><code class="p">,</code><code class="s1">'eggroll'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>Were you writing the statement literally in your program, you’d
      simply write the word <q>NULL</q> without enclosing quotes. But
      if the <code>color</code> value comes from a
      variable, the proper action is not so obvious. You must know whether the
      variable’s value represents <code>NULL</code> to
      determine whether to enclose it within quotes when you construct the
      statement.</p><p>You have two means at your disposal for dealing with special
      characters such as quotes and backslashes, and with special values such
      as <code>NULL</code>:</p><ul><li><p>Use placeholders in the statement string to refer to data
          values symbolically, then bind the data values to the placeholders
          when you execute the statement. This is the preferred method because
          the API itself does all or most of the work for you of providing
          quotes around values as necessary, quoting or escaping special
          characters within the data value, and possibly interpreting a
          special value to map onto <code>NULL</code>
          without enclosing quotes.</p></li><li><p>Use a quoting function (if your API provides one) for
          converting data values to a safe form that is suitable for use in
          statement strings.</p></li></ul><p>This section shows how to use these techniques to handle special
      characters and <code>NULL</code> values for each
      API. One of the examples demonstrated here shows how to insert a
      <code>profile</code> table row that contains
      <code>De'Mont</code> for the <code>name</code> value and <code>NULL</code> for the <code>color</code> value. However, the principles shown
      here have general utility and handle any special characters, including
      those found in binary data. Also, the principles are not limited to <code>INSERT</code> statements. They work for other kinds
      of statements as well, such as <code>SELECT</code>. One of the other examples shown here
      demonstrates how to execute a <code>SELECT</code>
      statement using placeholders.</p><p>Processing of special characters and <code>NULL</code> values comes up in other contexts covered
      elsewhere:</p><ul><li><p>The placeholder and quoting techniques described here are
          <em>only</em> for data values and not for identifiers
          such as database or table names. For discussion of identifier
          quoting, refer to <a data-type="xref" href="#nch-api-api-ident-quoting">Recipe 4.6</a>.</p></li><li><p>Comparisons of <code>NULL</code> values
          require different operators than non-<code>NULL</code> values. <a data-type="xref" href="ch05.xhtml#nch-select-select-null-compare">Recipe 5.6</a> discusses how to
          construct SQL statements that perform <code>NULL</code> comparisons from within
          programs.</p></li><li><p>This section covers the issue of getting special characters
          <em>into</em> your database. A related issue is the
          inverse operation of transforming special characters in values
          returned <em>from</em> your database for display in
          various contexts. For example, if you generate HTML pages that
          include values taken from your database, you must perform output
          encoding to convert <code>&lt;</code> and
          <code>&gt;</code> characters in those values
          to the HTML entities <code>&amp;lt;</code> and
          <code>&amp;gt;</code> to make sure they
          display properly.</p></li></ul><section data-type="sect3" data-pdf-bookmark="Using placeholders"><div class="sect3" id="idm45820381965696"><h3>Using placeholders</h3><p>Placeholders enable you to avoid writing data values literally
        in SQL statements. Using this approach, you write statements using
        placeholders—special markers that indicate where the values go. Two
        common parameter markers are <code>?</code> and
        <code>%s</code>. Depending on the marker,
        rewrite the <code>INSERT</code> statement to use
        placeholders like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="o">?</code><code class="p">,</code><code class="o">?</code><code class="p">,</code><code class="o">?</code><code class="p">,</code><code class="o">?</code><code class="p">,</code><code class="o">?</code><code class="p">);</code>

<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="o">%</code><code class="n">s</code><code class="p">,</code><code class="o">%</code><code class="n">s</code><code class="p">,</code><code class="o">%</code><code class="n">s</code><code class="p">,</code><code class="o">%</code><code class="n">s</code><code class="p">,</code><code class="o">%</code><code class="n">s</code><code class="p">);</code></pre><p>Then pass the statement string to the database server and supply
        the data values separately. The API binds the values to the
        placeholders to replace them, resulting in a statement that contains
        the data values.</p><p>One benefit of placeholders is that parameter-binding operations
        automatically handle escaping of characters such as quotes and
        backslashes. This is especially useful for inserting binary data such
        as images into your database or using data values with unknown content
        such as input submitted by a remote user through a form in a web page.
        Also, there is usually some special value that you bind to a
        placeholder to indicate that you want an SQL <code>NULL</code> value in the resulting
        statement.</p><p>A second benefit of placeholders is that you can
        <q>prepare</q> a statement in advance, then reuse it by
        binding different values to it each time it’s executed. Prepared
        statements thus encourage statement reuse. Statements become more
        generic because they contain placeholders rather than specific data
        values. If you perform an operation over and over, you may be able to
        reuse a prepared statement and simply bind different data values to it
        each time you execute it. Some database systems (MySQL not among them)
        have the capability of performing some preparsing or even execution
        planning prior to executing a prepared statement. For a statement that
        is executed multiple times later, this reduces overhead because
        anything that can be done prior to execution need be done only once,
        not once per execution. For example, if a program executes a
        particular type of <code>SELECT</code> statement
        several times while it runs, such a database system can construct a
        plan for the statement and then reuse it each time, rather than
        rebuild the plan over and over. MySQL doesn’t build query plans in
        advance, so you get no performance boost from using prepared
        statements. However, if you port a program to a database that does
        reuse query plans and you’ve written your program to use prepared
        statements, you can get this advantage of prepared statements
        automatically. You need not convert from nonprepared statements to
        enjoy that benefit.</p><p>A third (admittedly subjective) benefit is that code that uses
        placeholder-based statements can be easier to read. As you work
        through this section, compare the statements used here with those from
        <a data-type="xref" href="#nch-api-api-statement">Recipe 4.4</a> that did not use placeholders
        to see which you prefer.</p></div></section><section data-type="sect3" data-pdf-bookmark="Using a quoting function"><div class="sect3" id="idm45820381880512"><h3>Using a quoting function</h3><p>Some APIs provide a quoting function that takes a data value as
        its argument and returns a properly quoted and escaped value suitable
        for safe insertion into an SQL statement. This is less common than
        using placeholders, but it can be useful for constructing statements
        that you do not intend to execute immediately. However, you must have
        a connection open to the database server while you use such a quoting
        function because the API cannot select the proper quoting rules until
        the database driver is known. (The rules differ among database
        systems.)</p><div data-type="note" epub:type="note"><h6>Note</h6><p>As we’ll indicate later, some APIs quote as strings all
          non-<code>NULL</code> values, even numbers,
          when binding them to parameter markers. This can be an issue in
          contexts that <em>require</em> numbers, as described
          further in <a data-type="xref" href="ch05.xhtml#nch-select-select-limit-calc">Recipe 5.11</a>.</p></div><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820381877152"><h5>Generating a List of Placeholders</h5><p>You cannot bind an array of data values to a single placeholder. Each value
          must be bound to a separate placeholder. To use placeholders for a
          list of data values that may vary in number, construct a list of
          placeholder characters. In Perl, the following statement creates a
          string consisting of <em><code>n</code></em> placeholder
          characters separated by commas:</p><pre data-type="programlisting" data-code-language="perl">$str = join (",", ("?") x <em><code>n</code></em>);</pre><p>The <code>x</code> repetition operator,
          when applied to a list, produces
          <em><code>n</code></em> copies of the list, so the <code>join()</code> call joins these lists to produce a
          single string containing <em><code>n</code></em>
          comma-separated instances of the <code>?</code> character. This is handy for binding an
          array of data values to a list of placeholders in a statement string
          because the size of the array is the number of placeholders
          needed:</p><pre data-type="programlisting" data-code-language="perl"><code class="nv">$str</code> <code class="o">=</code> <code class="nb">join</code> <code class="p">(</code><code class="s">","</code><code class="p">,</code> <code class="p">(</code><code class="s">"?"</code><code class="p">)</code> <code class="n">x</code> <code class="nv">@values</code><code class="p">);</code></pre><p>In Ruby, use the <code>*</code> operator
          to similar effect:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">str</code> <code class="o">=</code> <code class="p">(</code><code class="o">[</code><code class="s2">"?"</code><code class="o">]</code> <code class="o">*</code> <code class="n">values</code><code class="o">.</code><code class="n">size</code><code class="p">)</code><code class="o">.</code><code class="n">join</code><code class="p">(</code><code class="s2">","</code><code class="p">)</code></pre><p>A less cryptic method is to use a loop approach, here
          illustrated in Python:</p><pre data-type="programlisting" data-code-language="python"><code class="nb">str</code> <code class="o">=</code> <code class="s2">""</code>
<code class="k">if</code> <code class="nb">len</code><code class="p">(</code><code class="n">values</code><code class="p">)</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="p">:</code>
  <code class="nb">str</code> <code class="o">=</code> <code class="s2">"?"</code>
<code class="k">for</code> <code class="n">i</code> <code class="ow">in</code> <code class="nb">range</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="nb">len</code><code class="p">(</code><code class="n">values</code><code class="p">)):</code>
  <code class="nb">str</code> <code class="o">+=</code> <code class="s2">",?"</code></pre></div></aside></div></section><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820381840896"><h3>Perl</h3><p>To use placeholders with Perl DBI, put a <code>?</code> in
        your SQL statement string at each data value location. Then
        bind the values to the statement by passing them to <code>do()</code> or <code>execute()</code>, or by calling a DBI method
        specifically intended for placeholder substitution. Use <code>undef</code> to bind a <code>NULL</code> value to a placeholder.</p><p>With <code>do()</code>, add the <code>profile</code> row for
        De’Mont by passing the statement string and the data values in the
        same call:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="s">"INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s">                       VALUES(?,?,?,?,?)"</code><code class="p">,</code>
                      <code class="nb">undef</code><code class="p">,</code>
                      <code class="s">"De'Mont"</code><code class="p">,</code> <code class="s">"1973-01-12"</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="s">"eggroll"</code><code class="p">,</code> <code class="mi">4</code><code class="p">);</code></pre><p>The arguments following the statement string are <code>undef</code>, then one data value for each
        placeholder. The <code>undef</code> argument is
        a historical artifact, but must be present.</p><p>Alternatively, pass the statement string to <code>prepare()</code> to get a statement handle, then use that handle to pass the data
        values to <code>execute()</code>:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s">                          VALUES(?,?,?,?,?)"</code><code class="p">);</code>
<code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">(</code><code class="s">"De'Mont"</code><code class="p">,</code> <code class="s">"1973-01-12"</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="s">"eggroll"</code><code class="p">,</code> <code class="mi">4</code><code class="p">);</code></pre><p>In either case, DBI generates this statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De\'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">',NULL,'</code><code class="n">eggroll</code><code class="s1">','</code><code class="mi">4</code><code class="err">'</code><code class="p">);</code></pre><p>The Perl DBI placeholder mechanism provides quotes around data
        values when they are bound to the statement string, so don’t put
        quotes around the <code>?</code> characters in
        the string.</p><p>Note that the placeholder mechanism adds quotes around numeric
        values. DBI relies on the MySQL server to perform type conversion as
        necessary to convert strings to numbers. If you bind <code>undef</code> to
        a placeholder, DBI puts a <code>NULL</code> into
        the statement and correctly refrains from adding enclosing
        quotes.</p><p>To execute the same statement over and over again, use <code>prepare()</code> once, then call <code>execute()</code> with appropriate data values each
        time you run it.</p><p>You can use these methods for other types of statements as well.
        For example, the following <code>SELECT</code>
        statement uses a placeholder to look for rows that have a <code>cats</code> value larger than 2:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT * FROM profile WHERE cats &gt; ?"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">(</code><code class="mi">2</code><code class="p">);</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_hashref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="s">"id: $ref-&gt;{id}, name: $ref-&gt;{name}, cats: $ref-&gt;{cats}\n"</code><code class="p">;</code>
<code class="p">}</code></pre><p>High-level retrieval methods such as <code>selectrow_array()</code> and <code>selectall_arrayref()</code> can be used with
        placeholders, too. Like the <code>do()</code>
        method, the arguments are the statement string, <code>undef</code>, and the data values to bind to the
        placeholders. Here’s an example:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">selectall_arrayref</code> <code class="p">(</code>
  <code class="s">"SELECT name, birth, foods FROM profile WHERE id &gt; ? AND color = ?"</code><code class="p">,</code>
  <code class="nb">undef</code><code class="p">,</code> <code class="mi">3</code><code class="p">,</code> <code class="s">"green"</code>
<code class="p">);</code></pre><p>The Perl DBI <code>quote()</code>
        database- handle method is an alternative to using placeholders.
        Here’s how to use <code>quote()</code> to create
        a statement string that inserts a new row in the <code>profile</code> table. Write the <code>%s</code> format specifiers without enclosing
        quotes because <code>quote()</code> provides
        them automatically as necessary. Non-<code>undef</code> values are inserted with quotes, and
        <code>undef</code> values are inserted as
        <code>NULL</code> without quotes:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$stmt</code> <code class="o">=</code> <code class="nb">sprintf</code> <code class="p">(</code><code class="s">"INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s">                     VALUES(%s,%s,%s,%s,%s)"</code><code class="p">,</code>
                    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">quote</code> <code class="p">(</code><code class="s">"De'Mont"</code><code class="p">),</code>
                    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">quote</code> <code class="p">(</code><code class="s">"1973-01-12"</code><code class="p">),</code>
                    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">quote</code> <code class="p">(</code><code class="nb">undef</code><code class="p">),</code>
                    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">quote</code> <code class="p">(</code><code class="s">"eggroll"</code><code class="p">),</code>
                    <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">quote</code> <code class="p">(</code><code class="mi">4</code><code class="p">));</code>
<code class="k">my</code> <code class="nv">$count</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="k">do</code> <code class="p">(</code><code class="nv">$stmt</code><code class="p">);</code></pre><p>The statement string generated by this code is the same as when
        you use placeholders.</p></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820381785792"><h3>Ruby</h3><p>Ruby DBI uses <code>?</code> as the
        placeholder character in SQL statements and <code>nil</code> as the value for binding an SQL <code>NULL</code> value to a placeholder.</p><p>To use the <code>?</code>, pass the statement string to <code>prepare</code> to get a
        statement handle, then use that handle to invoke <code>execute</code> with
        the data values:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="s2">"INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s2">                   VALUES(?,?,?,?,?)"</code><code class="p">)</code>
<code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"De'Mont"</code><code class="p">,</code> <code class="s2">"1973-01-12"</code><code class="p">,</code> <code class="kp">nil</code><code class="p">,</code> <code class="s2">"eggroll"</code><code class="p">,</code> <code class="mi">4</code><code class="p">)</code></pre><p>Mysql2 includes
        properly escaped quotes and a properly unquoted <code>NULL</code> value in the resulting statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De\'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">',NULL,'</code><code class="n">eggroll</code><code class="err">'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>The Ruby Mysql2 placeholder mechanism provides quotes around data
        values as necessary when they are bound to the statement string, so
        don’t put quotes around the <code>?</code>
        characters in the string.</p></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820381347296"><h3>PHP</h3><p>To use placeholders with the PDO extension, pass a statement string
        to <code>prepare()</code> to get a
        statement object. The string can contain <code>?</code> characters as placeholder markers. Use
        this object to invoke <code>execute()</code>,
        passing to it the array of data values to bind to the
        placeholders. Use the PHP <code>NULL</code>
        value to bind an SQL <code>NULL</code> value to
        a placeholder. The code to add the <code>profile</code> table row for De’Mont looks like
        this:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">prepare</code> <code class="p">(</code><code class="s2">"INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s2">                          VALUES(?,?,?,?,?)"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">execute</code> <code class="p">(</code><code class="k">array</code> <code class="p">(</code><code class="s2">"De'Mont"</code><code class="p">,</code><code class="s2">"1973-01-12"</code><code class="p">,</code><code class="k">NULL</code><code class="p">,</code><code class="s2">"eggroll"</code><code class="p">,</code><code class="mi">4</code><code class="p">));</code></pre><p>The resulting statement includes a properly escaped quote and a
        properly unquoted <code>NULL</code>
        value:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De\'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">',NULL,'</code><code class="n">eggroll</code><code class="s1">','</code><code class="mi">4</code><code class="err">'</code><code class="p">);</code></pre><p>The PDO placeholder mechanism provides quotes around data values
        when they are bound to the statement string, so don’t put quotes
        around the <code>?</code> characters in the
        string. (Note that even the numeric value <code>4</code> is quoted; PDO relies on MySQL to perform
        type conversion as necessary when the statement executes.)</p></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820381183920"><h3>Python</h3><p>The Connector/Python module implements placeholders using <code>%s</code> format specifiers in the SQL statement string. (To place
        a literal <code>%</code> character
        into the statement, use <code>%%</code> in the
        statement string.) To use placeholders, invoke the <code>execute()</code> method
        with two arguments: a statement string containing format specifiers
        and a sequence containing the values to bind to the statement string.
        Use <code>None</code> to bind a <code>NULL</code> value to a placeholder. The code to add
        the <code>profile</code> table row for De’Mont
        looks like this:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s1">'''</code>
<code class="s1">               INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s1">               VALUES(</code><code class="si">%s</code><code class="s1">,</code><code class="si">%s</code><code class="s1">,</code><code class="si">%s</code><code class="s1">,</code><code class="si">%s</code><code class="s1">,</code><code class="si">%s</code><code class="s1">)</code>
<code class="s1">               '''</code><code class="p">,</code> <code class="p">(</code><code class="s2">"De'Mont"</code><code class="p">,</code> <code class="s2">"1973-01-12"</code><code class="p">,</code> <code class="bp">None</code><code class="p">,</code> <code class="s2">"eggroll"</code><code class="p">,</code> <code class="mi">4</code><code class="p">))</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code>
<code class="n">conn</code><code class="o">.</code><code class="n">commit</code><code class="p">()</code></pre><p>The statement sent to the server by the preceding <code>execute()</code> call looks like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">profile</code> <code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="n">birth</code><code class="p">,</code><code class="n">color</code><code class="p">,</code><code class="n">foods</code><code class="p">,</code><code class="n">cats</code><code class="p">)</code>
<code class="k">VALUES</code><code class="p">(</code><code class="s1">'De\'</code><code class="n">Mont</code><code class="s1">','</code><code class="mi">1973</code><code class="o">-</code><code class="mi">01</code><code class="o">-</code><code class="mi">12</code><code class="s1">',NULL,'</code><code class="n">eggroll</code><code class="err">'</code><code class="p">,</code><code class="mi">4</code><code class="p">);</code></pre><p>The Connector/Python placeholder mechanism provides quotes
        around data values as necessary when they are bound to the statement
        string, so don’t put quotes around the <code>%s</code> format specifiers in the string.</p><p>If you have only a single value <em><code>val</code></em>
        to bind to a placeholder, write it as a sequence using the syntax
        <code>(</code><em><code>val</code></em>,<code>)</code>:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT id, name, cats FROM profile WHERE cats = </code><code class="si">%s</code><code class="s2">"</code><code class="p">,</code> <code class="p">(</code><code class="mi">2</code><code class="p">,))</code>
<code class="k">for</code> <code class="p">(</code><code class="nb">id</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">cats</code><code class="p">)</code> <code class="ow">in</code> <code class="n">cursor</code><code class="p">:</code>
  <code class="k">print</code><code class="p">(</code><code class="s2">"id: </code><code class="si">%s</code><code class="s2">, name: </code><code class="si">%s</code><code class="s2">, cats: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="nb">id</code><code class="p">,</code> <code class="n">name</code><code class="p">,</code> <code class="n">cats</code><code class="p">))</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>Alternatively, write the value as a list using the syntax
        <code>[</code><em><code>val</code></em><code>]</code>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820380970224"><h3>Go</h3><p>Go <code>sql</code> package uses question marks (<code>?</code>) as a placeholder markers. You can use placeholders with single <code>Exec()</code> or <code>Query()</code> calls, and also you can prepare the statement in advance and execute it later. Latter method is good when you need to execute the statement multiple times.
        
        The code to add
        the <code>profile</code> table row for De’Mont
        looks like this:</p><pre data-type="programlisting" data-code-language="go"><code class="nx">stmt</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">`INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s">           VALUES(?,?,?,?,?)`</code><code class="w"/>
<code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Exec</code><code class="p">(</code><code class="nx">stmt</code><code class="p">,</code><code class="w"> </code><code class="s">"De'Mont"</code><code class="p">,</code><code class="w"> </code><code class="s">"1973-01-12"</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="p">,</code><code class="w"> </code><code class="s">"eggroll"</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">)</code><code class="w"/></pre><p>
          The same code with the <code>Prepare()</code> call will look like this:
        </p><pre data-type="programlisting" data-code-language="go"><code class="nx">pstmt</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Prepare</code><code class="p">(</code><code class="s">`INSERT INTO profile (name,birth,color,foods,cats)</code>
<code class="s">                 VALUES(?,?,?,?,?)`</code><code class="p">)</code><code class="w"/>
<code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">  </code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/>
<code class="k">defer</code><code class="w"> </code><code class="nx">pstmt</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">pstmt</code><code class="p">.</code><code class="nx">Exec</code><code class="p">(</code><code class="s">"De'Mont"</code><code class="p">,</code><code class="w"> </code><code class="s">"1973-01-12"</code><code class="p">,</code><code class="w"> </code><code class="kc">nil</code><code class="p">,</code><code class="w"> </code><code class="s">"eggroll"</code><code class="p">,</code><code class="w"> </code><code class="mi">4</code><code class="p">)</code><code class="w"/></pre></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820380910592"><h3>Java</h3><p>JDBC provides support for placeholders if you use prepared statements. Recall that
        the process for executing nonprepared statements in JDBC is to create
        a <code>Statement</code> object, and then pass the statement string to the <code>executeUpdate()</code>,
        <code>executeQuery()</code>, or <code>execute()</code> function. To use a prepared
        statement instead, create a <code>PreparedStatement</code> object by passing a
        statement string containing <code>?</code>
        placeholder characters to your connection object’s <code>prepareStatement()</code> method. Then bind the
        data values to the statement using <code>set</code><em><code>XXX</code></em><code>()</code> methods. Finally, execute the statement
        by calling <code>executeUpdate()</code>,
        <code>executeQuery()</code>, or <code>execute()</code> with an empty argument
        list.</p><p>Here is an example that uses <code>executeUpdate()</code> to execute an <code>INSERT</code> statement that adds the <code>profile</code> table row for De’Mont:</p><pre data-type="programlisting" data-code-language="java"><code class="n">PreparedStatement</code> <code class="n">s</code><code class="o">;</code>
<code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">prepareStatement</code><code class="o">(</code>
            <code class="s">"INSERT INTO profile (name,birth,color,foods,cats)"</code>
            <code class="o">+</code> <code class="s">" VALUES(?,?,?,?,?)"</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">setString</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="s">"De'Mont"</code><code class="o">);</code>         <code class="c1">// bind values to placeholders</code>
<code class="n">s</code><code class="o">.</code><code class="na">setString</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="s">"1973-01-12"</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">setNull</code><code class="o">(</code><code class="mi">3</code><code class="o">,</code> <code class="n">java</code><code class="o">.</code><code class="na">sql</code><code class="o">.</code><code class="na">Types</code><code class="o">.</code><code class="na">CHAR</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">setString</code><code class="o">(</code><code class="mi">4</code><code class="o">,</code> <code class="s">"eggroll"</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">setInt</code><code class="o">(</code><code class="mi">5</code><code class="o">,</code> <code class="mi">4</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>   <code class="c1">// close statement</code></pre><p>The <code>set</code><em><code>XXX</code></em><code>()</code> methods that bind data values to
        statements take two arguments: a placeholder position (beginning with
        1, not 0) and the value to bind to the placeholder. Choose each
        value-binding call to match the data type of the column to which the
        value is bound: <code>setString()</code> to
        bind a string to the <code>name</code> column,
        <code>setInt()</code> to bind an integer to the <code>cats</code> column, and so forth. (Actually, I
        cheated a bit by using <code>setString()</code>
        to treat the date value for <code>birth</code>
        as a string.)</p><p>One difference between JDBC and the other APIs is that you don’t
        bind a <code>NULL</code> to a placeholder by
        specifying some special value (such as <code>undef</code> in Perl or <code>nil</code> in Ruby). Instead, invoke <code>setNull()</code> with
        a second argument that indicates the type of the column: <code>java.sql.Types.CHAR</code> for a string, <code>java.sql.Types.INTEGER</code> for an integer, and
        so forth.</p><p>The <code>set</code><em><code>XXX</code></em><code>()</code> calls add quotes around data values if
        necessary, so don’t put quotes around the <code>?</code> placeholder characters in the statement
        string.</p><p>To handle a statement that returns a result set, the process is similar, but execute the prepared statement
        with <code>executeQuery()</code> rather than
        <code>executeUpdate()</code>:</p><pre data-type="programlisting" data-code-language="java"><code class="n">PreparedStatement</code> <code class="n">s</code><code class="o">;</code>
<code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">prepareStatement</code><code class="o">(</code><code class="s">"SELECT * FROM profile WHERE cats &gt; ?"</code><code class="o">);</code>
<code class="n">s</code><code class="o">.</code><code class="na">setInt</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">);</code>  <code class="c1">// bind 2 to first placeholder</code>
<code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code><code class="o">();</code>
<code class="c1">// ... process result set here ...</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>     <code class="c1">// close statement</code></pre></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.6 Handling Special Characters in Identifiers"><div class="sect1" id="nch-api-api-ident-quoting"><h1>4.6 Handling Special Characters in Identifiers</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820380641200"><h2>Problem</h2><p>You need to construct SQL statements that refer to identifiers containing special
      characters.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820380631856"><h2>Solution</h2><p>Quote each identifier so it can be inserted safely into statement strings.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820380630976"><h2>Discussion</h2><p><a data-type="xref" href="#nch-api-api-quoting">Recipe 4.5</a> discusses how to handle
      special characters in data values by using placeholders or quoting
      methods. Special characters also can be present in identifiers such as
      database, table, and column names. For example, the table name <code>some table</code> contains a space, which is not
      permitted by default:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE some table (i INT);</code></strong>
ERROR 1064 (42000): You have an error in your SQL syntax near 'table (i INT)'</pre><p>Special characters are handled differently in identifiers than in
      data values. To make an identifier safe for insertion into an SQL
      statement, quote it by enclosing it within backticks:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE `some table` (i INT);</code></strong>
Query OK, 0 rows affected (0.04 sec)</pre><p>In MySQL, backticks are always permitted for identifier quoting.
      The double-quote character is permitted as well, if the <code>ANSI_QUOTES</code> SQL mode is enabled. Thus, with <code>ANSI_QUOTES</code>
      enabled, both of these statements are equivalent:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="o">`</code><code class="k">some</code> <code class="k">table</code><code class="o">`</code> <code class="p">(</code><code class="n">i</code> <code class="nb">INT</code><code class="p">);</code>
<code class="k">CREATE</code> <code class="k">TABLE</code> <code class="ss">"some table"</code> <code class="p">(</code><code class="n">i</code> <code class="nb">INT</code><code class="p">);</code></pre><p>If it’s necessary to know which identifier quoting characters are
      permitted, execute a <code>SELECT</code>
      <code>@@sql_mode</code> statement to retrieve the
      SQL mode for your session and check whether its value includes <code>ANSI_QUOTES</code>.</p><p>If a quoting character appears within the identifier itself,
      double it when quoting the identifier. For example, quote <code>abc`def</code> as <code>`abc``def`</code>.</p><p>Be aware that although string data values in MySQL normally can be
      quoted using either single-quote or double-quote
      characters (<code>'abc'</code>, <code>"abc"</code>), that is not true when <code>ANSI_QUOTES</code> is enabled. In that case, MySQL
      interprets <code>'abc'</code> as a string and
      <code>"abc"</code> as an identifier, so you must
      use only single quotes for strings.</p><p>Within a program, you can use an identifier-quoting routine if
      your API provides one, or write one yourself if not. Perl DBI has a
      <code>quote_identifier()</code> method that returns a properly quoted identifier. For an API that
      has no such method, you can quote an identifier by enclosing it within
      backticks and doubling any backticks that occur within the identifier.
      Here’s a PHP routine that does so:</p><pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">quote_identifier</code> <code class="p">(</code><code class="nv">$ident</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="s1">'`'</code> <code class="o">.</code> <code class="nb">str_replace</code><code class="p">(</code><code class="s1">'`'</code><code class="p">,</code> <code class="s1">'``'</code><code class="p">,</code> <code class="nv">$ident</code><code class="p">)</code> <code class="o">.</code> <code class="s1">'`'</code><code class="p">);</code>
<code class="p">}</code></pre><p>Portability note: If you write your own identifier-quoting
      routines, remember that other DBMSs may require different quoting
      conventions.</p><p>In contexts where identifiers are used as data values, handle them
      as such. If you select information from the <code>INFORMATION_SCHEMA</code> metadata database,
      it’s common to indicate which rows to return by specifying
      database object names in the <code>WHERE</code> clause. For
      example, this statement retrieves the column names for the <code>profile</code> table in the <code>cookbook</code> database:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SELECT</code> <code class="k">COLUMN_NAME</code> <code class="k">FROM</code> <code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">COLUMNS</code>
<code class="k">WHERE</code> <code class="n">TABLE_SCHEMA</code> <code class="o">=</code> <code class="s1">'cookbook'</code> <code class="k">AND</code> <code class="k">TABLE_NAME</code> <code class="o">=</code> <code class="s1">'profile'</code><code class="p">;</code></pre><p>The database and table names are used here as data values, not as
      identifiers. Were you to construct this statement within a program,
      parameterize them using placeholders, not identifier quoting. For example, in
      Ruby, do this:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">sth</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">prepare</code><code class="p">(</code><code class="s2">"SELECT COLUMN_NAME</code>
<code class="s2">                        FROM INFORMATION_SCHEMA.COLUMNS</code>
<code class="s2">                        WHERE TABLE_SCHEMA = ? AND TABLE_NAME = ?"</code><code class="p">)</code>
<code class="n">names</code> <code class="o">=</code> <code class="n">sth</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="n">db_name</code><code class="p">,</code> <code class="n">tbl_name</code><code class="p">)</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.7 Identifying NULL Values in Result Sets"><div class="sect1" id="nch-api-api-null"><h1>4.7 Identifying NULL Values in Result Sets</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820380425312"><h2>Problem</h2><p>A query result includes <code>NULL</code> values,
      but you’re not sure how to identify them.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820380424048"><h2>Solution</h2><p>Your API probably has some special value that represents <code>NULL</code> by convention. You just have to know what
      it is and how to test for it.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820380422720"><h2>Discussion</h2><p><a data-type="xref" href="#nch-api-api-quoting">Recipe 4.5</a> describes how to refer to
      <code>NULL</code> values when you send statements
      <em>to</em> the database server. In this section, we’ll deal
      instead with the question of how to recognize and process <code>NULL</code> values returned <em>from</em>
      the database server. In general, this is a matter of knowing what
      special value the API maps <code>NULL</code>
      values to, or what method to call. The <a data-type="xref" href="#nch-api-api-nul-detect">Table 4-5</a> shows these
      values:</p><table id="nch-api-api-nul-detect"><caption><span class="label">Table 4-5. </span>Detected NULL values</caption><thead><tr><th>Language</th><th>NULL-detection value or method</th></tr></thead><tbody><tr><td>Perl DBI</td><td><code>undef</code> value</td></tr><tr><td>Ruby Mysql2 gem</td><td><code>nil</code> value</td></tr><tr><td>PHP PDO</td><td><code>NULL</code> value</td></tr><tr><td>Python DB API</td><td><code>None</code> value</td></tr><tr><td>Go <code>sql</code> interface</td><td>Go Null type implementation for the nullable data types.</td></tr><tr><td>Java JDBC</td><td><code>wasNull()</code> method</td></tr></tbody></table><p>The following sections show a very simple application of <code>NULL</code> value detection. The examples retrieve a
      result set and print all values in it, mapping <code>NULL</code> values onto the printable string <code>"NULL"</code>.</p><p>To make sure that the <code>profile</code>
      table has a row that contains some <code>NULL</code> values, use <span class="command"><em>mysql</em></span> to execute the following <code>INSERT</code> statement, then execute the <code>SELECT</code> statement to verify that the resulting row has the expected
      values:</p><pre data-type="programlisting">mysql&gt; <strong><code>INSERT INTO profile (name) VALUES('Amabel');</code></strong>
mysql&gt; <strong><code>SELECT * FROM profile WHERE name = 'Amabel';</code></strong>
+----+--------+-------+-------+-------+------+
| id | name   | birth | color | foods | cats |
+----+--------+-------+-------+-------+------+
|  9 | Amabel | NULL  | NULL  | NULL  | NULL |
+----+--------+-------+-------+-------+------+</pre><p>The <code>id</code> column might contain a
      different number, but the other columns should appear as shown, with
      values of <code>NULL</code>.</p><section data-type="sect3" data-pdf-bookmark="Perl"><div class="sect3" id="idm45820380406192"><h3>Perl</h3><p>Perl DBI represents <code>NULL</code>
        values using <code>undef</code>. To detect
        such values, use the <code>defined()</code> function; it’s particularly important to do so if you enable
        warnings with the Perl <code class="option">-w</code> option or by including a <code>use</code>
        <code>warnings</code> line in your script.
        Otherwise, accessing <code>undef</code> values
        causes Perl to issue <code>Use</code> <code>of</code> <code>uninitialized</code> <code>value</code> warnings.</p><p>To prevent these warnings, test column values that might be
        <code>undef</code> with <code>defined()</code> before using them. The following
        code selects a few columns from the <code>profile</code> table and prints <code>"NULL"</code> for any undefined values in each row.
        This makes <code>NULL</code> values explicit in
        the output without activating any warning messages:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT name, birth, foods FROM profile"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_hashref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="nb">printf</code> <code class="s">"name: %s, birth: %s, foods: %s\n"</code><code class="p">,</code>
         <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">name</code><code class="p">})</code> <code class="p">?</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">name</code><code class="p">}</code> <code class="p">:</code> <code class="s">"NULL"</code><code class="p">,</code>
         <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">birth</code><code class="p">})</code> <code class="p">?</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">birth</code><code class="p">}</code> <code class="p">:</code> <code class="s">"NULL"</code><code class="p">,</code>
         <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">foods</code><code class="p">})</code> <code class="p">?</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">foods</code><code class="p">}</code> <code class="p">:</code> <code class="s">"NULL"</code><code class="p">;</code>
<code class="p">}</code></pre><p>Unfortunately, testing multiple column values is ponderous and
        becomes worse the more columns there are. To avoid this, test and set
        undefined values using a loop or <code>map</code> prior to printing them. The following
        example uses <code>map</code>:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT name, birth, foods FROM profile"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">$ref</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_hashref</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="nb">map</code> <code class="p">{</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="nv">$_</code><code class="p">}</code> <code class="o">=</code> <code class="s">"NULL"</code> <code class="k">unless</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="nv">$_</code><code class="p">});</code> <code class="p">}</code> <code class="nb">keys</code> <code class="p">(</code><code class="nv">%</code><code class="p">{</code><code class="nv">$ref</code><code class="p">});</code>
  <code class="nb">printf</code> <code class="s">"name: %s, birth: %s, foods: %s\n"</code><code class="p">,</code>
         <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">name</code><code class="p">},</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">birth</code><code class="p">},</code> <code class="nv">$ref</code><code class="o">-&gt;</code><code class="p">{</code><code class="n">foods</code><code class="p">};</code>
<code class="p">}</code></pre><p>With this technique, the amount of code to perform the tests is
        constant, not proportional to the number of columns to be tested.
        Also, there is no reference to specific column names, so it can more
        easily be used in other programs or as the basis for a utility
        routine.</p><p>If you fetch rows into an array rather than into a hash, use
        <code>map</code> like this to convert <code>undef</code> values:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="n">prepare</code> <code class="p">(</code><code class="s">"SELECT name, birth, foods FROM profile"</code><code class="p">);</code>
<code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">execute</code> <code class="p">();</code>
<code class="k">while</code> <code class="p">(</code><code class="k">my</code> <code class="nv">@val</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="n">fetchrow_array</code> <code class="p">())</code>
<code class="p">{</code>
  <code class="nv">@val</code> <code class="o">=</code> <code class="nb">map</code> <code class="p">{</code> <code class="nb">defined</code> <code class="p">(</code><code class="nv">$_</code><code class="p">)</code> <code class="p">?</code> <code class="nv">$_</code> <code class="p">:</code> <code class="s">"NULL"</code> <code class="p">}</code> <code class="nv">@val</code><code class="p">;</code>
  <code class="nb">printf</code> <code class="s">"name: %s, birth: %s, foods: %s\n"</code><code class="p">,</code>
         <code class="nv">$val</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="nv">$val</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="nv">$val</code><code class="p">[</code><code class="mi">2</code><code class="p">];</code>
<code class="p">}</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="Ruby"><div class="sect3" id="idm45820380229968"><h3>Ruby</h3><p>Ruby Mysql2 module represents <code>NULL</code>
        values using <code>nil</code>, which can be
        identified by applying the <code>nil?</code>
        method to a value. The following example uses the <code>nil?</code> method and ternary operator to determine whether to print result
        set values as is or as the string <code>"NULL"</code> for <code>NULL</code> values:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">result</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="n">query</code><code class="p">(</code><code class="s2">"SELECT name, birth, foods FROM profile"</code><code class="p">)</code>
<code class="n">result</code><code class="o">.</code><code class="n">each</code> <code class="k">do</code> <code class="o">|</code><code class="n">row</code><code class="o">|</code>
  <code class="nb">printf</code> <code class="s2">"name %s, birth: %s, foods: %s</code><code class="se">\n</code><code class="s2">"</code><code class="p">,</code> 
         <code class="n">row</code><code class="o">[</code><code class="s2">"name"</code><code class="o">].</code><code class="n">nil?</code> <code class="p">?</code> <code class="s2">"NULL"</code> <code class="p">:</code> <code class="n">row</code><code class="o">[</code><code class="s2">"name"</code><code class="o">]</code><code class="p">,</code> 
         <code class="n">row</code><code class="o">[</code><code class="s2">"birth"</code><code class="o">].</code><code class="n">nil?</code> <code class="p">?</code> <code class="s2">"NULL"</code> <code class="p">:</code> <code class="n">row</code><code class="o">[</code><code class="s2">"birth"</code><code class="o">]</code><code class="p">,</code> 
         <code class="n">row</code><code class="o">[</code><code class="s2">"foods"</code><code class="o">].</code><code class="n">nil?</code> <code class="p">?</code> <code class="s2">"NULL"</code> <code class="p">:</code> <code class="n">row</code><code class="o">[</code><code class="s2">"foods"</code><code class="o">]</code>
<code class="k">end</code></pre></div></section><section data-type="sect3" data-pdf-bookmark="PHP"><div class="sect3" id="idm45820380103776"><h3>PHP</h3><p>PHP represents SQL <code>NULL</code> values in
        result sets as the PHP <code>NULL</code> value.
        To determine whether a value from a result set represents a <code>NULL</code> value, compare it to the PHP <code>NULL</code> value using the <code>===</code> <q>triple
        equal</q> operator:</p><pre data-type="programlisting" data-code-language="php"><code class="k">if</code> <code class="p">(</code><code class="nv">$val</code> <code class="o">===</code> <code class="k">NULL</code><code class="p">)</code>
<code class="p">{</code>
  <code class="c1"># $val is a NULL value</code>
<code class="p">}</code></pre><p>In PHP, the triple equal operator means <q>exactly equal
        to.</q> The usual <code>==</code>
        <q>equal to</q> comparison operator is not suitable here: with <code>==</code>, PHP considers the <code>NULL</code> value, the empty string, and <code>0</code> all equal.</p><p>The following code uses the <code>===</code> operator to identify <code>NULL</code> values in a result set and print them
        as the string <code>"NULL"</code>:</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$sth</code> <code class="o">=</code> <code class="nv">$dbh</code><code class="o">-&gt;</code><code class="na">query</code> <code class="p">(</code><code class="s2">"SELECT name, birth, foods FROM profile"</code><code class="p">);</code>
<code class="k">while</code> <code class="p">(</code><code class="nv">$row</code> <code class="o">=</code> <code class="nv">$sth</code><code class="o">-&gt;</code><code class="na">fetch</code> <code class="p">(</code><code class="nx">PDO</code><code class="o">::</code><code class="na">FETCH_NUM</code><code class="p">))</code>
<code class="p">{</code>
  <code class="k">foreach</code> <code class="p">(</code><code class="nb">array_keys</code> <code class="p">(</code><code class="nv">$row</code><code class="p">)</code> <code class="k">as</code> <code class="nv">$key</code><code class="p">)</code>
  <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="nv">$row</code><code class="p">[</code><code class="nv">$key</code><code class="p">]</code> <code class="o">===</code> <code class="k">NULL</code><code class="p">)</code>
      <code class="nv">$row</code><code class="p">[</code><code class="nv">$key</code><code class="p">]</code> <code class="o">=</code> <code class="s2">"NULL"</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"name: </code><code class="si">$row[0]</code><code class="s2">, birth: </code><code class="si">$row[1]</code><code class="s2">, foods: </code><code class="si">$row[2]</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code></pre><p>An alternative to <code>===</code> for
        <code>NULL</code> value tests is <code>is_null()</code>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Python"><div class="sect3" id="idm45820379879664"><h3>Python</h3><p>Python DB API programs represent <code>NULL</code> in
        result sets using <code>None</code>. The
        following example shows how to detect <code>NULL</code> values:</p><pre data-type="programlisting" data-code-language="python"><code class="n">cursor</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="n">cursor</code><code class="p">()</code>
<code class="n">cursor</code><code class="o">.</code><code class="n">execute</code><code class="p">(</code><code class="s2">"SELECT name, birth, foods FROM profile"</code><code class="p">)</code>

<code class="k">for</code> <code class="n">row</code> <code class="ow">in</code> <code class="n">cursor</code><code class="p">:</code>
  <code class="n">row</code> <code class="o">=</code> <code class="nb">list</code><code class="p">(</code><code class="n">row</code><code class="p">)</code>  <code class="c1"># convert nonmutable tuple to mutable list</code>
  
  <code class="k">for</code> <code class="n">i</code><code class="p">,</code> <code class="n">value</code> <code class="ow">in</code> <code class="nb">enumerate</code><code class="p">(</code><code class="n">row</code><code class="p">):</code>
    <code class="k">if</code> <code class="n">value</code> <code class="ow">is</code> <code class="bp">None</code><code class="p">:</code>  <code class="c1"># is the column value NULL?</code>
      <code class="n">row</code><code class="p">[</code><code class="n">i</code><code class="p">]</code> <code class="o">=</code> <code class="s2">"NULL"</code>
      
  <code class="k">print</code><code class="p">(</code><code class="s2">"name: </code><code class="si">%s</code><code class="s2">, birth: </code><code class="si">%s</code><code class="s2">, foods: </code><code class="si">%s</code><code class="s2">"</code> <code class="o">%</code> <code class="p">(</code><code class="n">row</code><code class="p">[</code><code class="mi">0</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">1</code><code class="p">],</code> <code class="n">row</code><code class="p">[</code><code class="mi">2</code><code class="p">]))</code>
  
<code class="n">cursor</code><code class="o">.</code><code class="n">close</code><code class="p">()</code></pre><p>The inner loop checks for <code>NULL</code> column values by looking for <code>None</code> and converts them to the string
        <code>"NULL"</code>. The example converts
        <code>row</code> to a mutable object (list) prior to
        the loop because <code>fetchall()</code>
        returns rows as sequence values, which are nonmutable (read
        only).</p></div></section><section data-type="sect3" data-pdf-bookmark="Go"><div class="sect3" id="idm45820379874880"><h3>Go</h3><p>Go <code>sql</code> interface provides special data types to handle values in the result set that may contain NULL values. They are defined for the standard Go types. <a data-type="xref" href="#nch-api-api-null-go">Table 4-6</a> contains the list of the standard data types and their nullable equivalents.</p><table id="nch-api-api-null-go"><caption><span class="label">Table 4-6. </span>Handling NULL values in Go</caption><thead><tr><th>Standard Go Type</th><th>Type that can contain NULL values</th></tr></thead><tbody><tr><td><code>bool</code></td><td><code>NullBool</code></td></tr><tr><td><code>float64</code></td><td><code>NullFloat64</code></td></tr><tr><td><code>int32</code></td><td><code>NullInt32</code></td></tr><tr><td><code>int64</code></td><td><code>NullInt64</code></td></tr><tr><td><code>string</code></td><td><code>NullString</code></td></tr><tr><td><code>time.Time</code></td><td><code>NullTime</code></td></tr></tbody></table><p>
          To define a variable that can take both <code>NULL</code> and non-<code>NULL</code> value when passed as an argument to the function <code>Scan()</code>, use the corresponding nullable type.
        </p><p>
          All nullable types contains two functions: <code>Valid()</code> that returns <code>true</code> if the value is not <code>NULL</code> and <code>false</code> if the value is <code>NULL</code>. Second function is the type name, started from the capital letter. For example, <code>String()</code> for <code>string</code> values and <code>Time()</code> for <code>time.Time</code> values. This method returns actual value when it is not <code>NULL</code>.
        </p><p>
          Here is the example on how to handle <code>NULL</code> values in Go.
        </p><pre data-type="programlisting" data-code-language="go"><code class="c1">// null-in-result.go : Selecting NULL values in Go</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">	</code><code class="s">"database/sql"</code><code class="w"/>
<code class="w">	</code><code class="s">"fmt"</code><code class="w"/>
<code class="w">	</code><code class="s">"log"</code><code class="w"/>

<code class="w">	</code><code class="nx">_</code><code class="w"> </code><code class="s">"github.com/go-sql-driver/mysql"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">type</code><code class="w"> </code><code class="nx">Profile</code><code class="w"> </code><code class="kd">struct</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">name</code><code class="w">     </code><code class="kt">string</code><code class="w"/>
<code class="w">    </code><code class="nx">birth</code><code class="w">    </code><code class="nx">sql</code><code class="p">.</code><code class="nx">NullString</code><code class="w"/>
<code class="w">    </code><code class="nx">foods</code><code class="w">    </code><code class="nx">sql</code><code class="p">.</code><code class="nx">NullString</code><code class="w"/>
<code class="p">}</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>

<code class="w">	</code><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"> </code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook"</code><code class="p">)</code><code class="w"/>

<code class="w">	</code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>
<code class="w">	</code><code class="k">defer</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">	</code><code class="nx">sql</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">"SELECT name, birth, foods FROM profile"</code><code class="w"/>
<code class="w">	</code><code class="nx">res</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Query</code><code class="p">(</code><code class="nx">sql</code><code class="p">)</code><code class="w"/>

<code class="w">	</code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>
<code class="w">	</code><code class="k">defer</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/>

<code class="w">	</code><code class="k">for</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Next</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">		</code><code class="kd">var</code><code class="w"> </code><code class="nx">profile</code><code class="w"> </code><code class="nx">Profile</code><code class="w"/>
<code class="w">		</code><code class="nx">err</code><code class="w"> </code><code class="p">=</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Scan</code><code class="p">(</code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">birth</code><code class="p">,</code><code class="w"> </code><code class="o">&amp;</code><code class="nx">profile</code><code class="p">.</code><code class="nx">foods</code><code class="p">)</code><code class="w"/>
<code class="w">		</code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">			</code><code class="nx">log</code><code class="p">.</code><code class="nx">Fatal</code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">		</code><code class="p">}</code><code class="w"/>

<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">profile</code><code class="p">.</code><code class="nx">birth</code><code class="p">.</code><code class="nx">Valid</code><code class="w"> </code><code class="o">&amp;&amp;</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">foods</code><code class="p">.</code><code class="nx">Valid</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">          </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"name: %s, birth: %s, foods: %s\n"</code><code class="p">,</code><code class="w"> </code>
<code class="w">                      </code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">birth</code><code class="p">.</code><code class="nx">String</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">foods</code><code class="p">.</code><code class="nx">String</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">birth</code><code class="p">.</code><code class="nx">Valid</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">          </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"name: %s, birth: %s, foods: NULL\n"</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">birth</code><code class="p">.</code><code class="nx">String</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">foods</code><code class="p">.</code><code class="nx">Valid</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">          </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"name: %s, birth: NULL, foods: %s\n"</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">,</code><code class="w"> </code><code class="nx">profile</code><code class="p">.</code><code class="nx">foods</code><code class="p">.</code><code class="nx">String</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">          </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"name: %s, birth: NULL, foods: NULL\n"</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="nx">profile</code><code class="p">.</code><code class="nx">name</code><code class="p">)</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">	</code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
            We used type <code>NullString</code> for the <code>birth</code> column for simplicity. If you want to use type <code>NullTime</code> you need to add parameter <code>parseTime=true</code> to your connection string.
          </p></div><div data-type="tip"><h6>Tip</h6><p>
        Alternatively you can use MySQL’s <code>COALESCE()</code> function to convert null value
        to a string during the query execution.</p><pre data-type="programlisting" data-code-language="go"><code class="nx">sql</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="s">`SELECT name, </code>
<code class="s">               COALESCE(birth, '') as birthday</code>
<code class="s">        FROM profile WHERE id = 9`</code><code class="w"/>
<code class="nx">res</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">db</code><code class="p">.</code><code class="nx">Query</code><code class="p">(</code><code class="nx">sql</code><code class="p">)</code><code class="w"/>
<code class="k">defer</code><code class="w"> </code><code class="nx">res</code><code class="p">.</code><code class="nx">Close</code><code class="p">()</code><code class="w"/></pre></div></div></section><section data-type="sect3" data-pdf-bookmark="Java"><div class="sect3" id="idm45820379463216"><h3>Java</h3><p>For JDBC programs, if it’s possible for a column in a result set to contain
        <code>NULL</code> values, it’s best to check for
        them explicitly. The way to do this is to fetch the value and then
        invoke <code>wasNull()</code>,
        which returns true if the column is <code>NULL</code> and false otherwise. For
        example:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Object</code> <code class="n">obj</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getObject</code> <code class="o">(</code><code class="n">index</code><code class="o">);</code>
<code class="k">if</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">wasNull</code> <code class="o">())</code>
<code class="o">{</code> <code class="cm">/* the value's a NULL */</code> <code class="o">}</code></pre><p>The preceding example uses <code>getObject()</code>, but
        the principle holds for other <code>get</code><em><code>XXX</code></em><code>()</code> calls as well.</p><p>Here’s an example that prints each row of a result set as a
        comma-separated list of values, with <code>"NULL"</code> printed for each <code>NULL</code>
        value:</p><pre data-type="programlisting" data-code-language="java"><code class="n">Statement</code> <code class="n">s</code> <code class="o">=</code> <code class="n">conn</code><code class="o">.</code><code class="na">createStatement</code><code class="o">();</code>
<code class="n">s</code><code class="o">.</code><code class="na">executeQuery</code><code class="o">(</code><code class="s">"SELECT name, birth, foods FROM profile"</code><code class="o">);</code>
<code class="n">ResultSet</code> <code class="n">rs</code> <code class="o">=</code> <code class="n">s</code><code class="o">.</code><code class="na">getResultSet</code><code class="o">();</code>
<code class="n">ResultSetMetaData</code> <code class="n">md</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getMetaData</code><code class="o">();</code>
<code class="kt">int</code> <code class="n">ncols</code> <code class="o">=</code> <code class="n">md</code><code class="o">.</code><code class="na">getColumnCount</code><code class="o">();</code>
<code class="k">while</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">next</code> <code class="o">())</code> <code class="o">{</code> <code class="c1">// loop through rows of result set</code>
  <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">ncols</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code> <code class="c1">// loop through columns</code>
    <code class="n">String</code> <code class="n">val</code> <code class="o">=</code> <code class="n">rs</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="n">i</code><code class="o">+</code><code class="mi">1</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">i</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">", "</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">rs</code><code class="o">.</code><code class="na">wasNull</code><code class="o">())</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">"NULL"</code><code class="o">);</code>
    <code class="k">else</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">val</code><code class="o">);</code>
  <code class="o">}</code>
  <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">();</code>
<code class="o">}</code>
<code class="n">rs</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>  <code class="c1">// close result set</code>
<code class="n">s</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>   <code class="c1">// close statement</code></pre></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.8 Obtaining Connection Parameters"><div class="sect1" id="nch-api-api-param"><h1>4.8 Obtaining Connection Parameters</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820379012048"><h2>Problem</h2><p>You need to obtain connection parameters for a script so that it can
      connect to a MySQL server.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820379011056"><h2>Solution</h2><p>There are several ways to do this. Take your pick from the
      alternatives described here.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820379010064"><h2>Discussion</h2><p>Any program that connects to MySQL specifies connection parameters such as the username, password, and
      hostname. The recipes shown so far have put connection parameters
      directly into the code that attempts to establish the connection, but
      that is not the only way for your programs to obtain the parameters.
      This discussion briefly surveys some of the available techniques:</p><dl><dt>Hardwire the parameters into the program</dt><dd><p>The parameters can be given either in the main source file
            or in a library file used by the program. This technique is
            convenient because users need not enter the values themselves, but
            it’s also inflexible. To change parameters, you must modify your
            program. It is also insecure, because everyone who accesses the library would be able to read your database credentials.</p></dd><dt>Ask for the parameters interactively</dt><dd><p>In a command-line environment, you can ask the user a series
            of questions. In a web or GUI environment, you might do this by
            presenting a form or dialog. Either way, this becomes tedious for
            people who use the application frequently, due to the need to
            enter the parameters each time.</p></dd><dt>Get the parameters from the command line</dt><dd><p>You can use this method either for commands run
            interactively or from within a script. Like the method of
            obtaining parameters interactively, you must supply parameters for
            each command invocation. (A factor that mitigates this burden is
            that many shells enable you to easily recall commands from your
            history list for re-execution.) This method could be insecure if you provide your credentials this way.</p></dd><dt>Get the parameters from the execution environment</dt><dd><p>The most common way to do this is to set the appropriate
            environment variables in one of your shell’s startup
            files (such as <em class="filename">.profile</em> for
            <span class="command"><em>sh</em></span>, <span class="command"><em>bash</em></span>, <span class="command"><em>ksh</em></span>; or <em class="filename">.login</em> for <span class="command"><em>csh</em></span> or <span class="command"><em>tcsh</em></span>). Programs that you run during your
            login session then can get parameter values by examining their
            environment.</p></dd><dt>Get the parameters from a separate file</dt><dd><p>With this method, store information such as the username and
            password in a file that programs can read before connecting to the
            MySQL server. Reading parameters from a file that’s separate from
            your program gives you the benefit of not having to enter them
            each time you use the program, without hardwiring the values into
            it. Also, storing the values in a file enables you to centralize
            parameters for use by multiple programs, and for security purposes
            you can set the file access mode to keep other users from reading
            the file.</p><p>The MySQL client library itself supports an option file
            mechanism, although not all APIs provide access to it. For those
            that don’t, workarounds may exist. (As an example, Java supports
            the use of properties files and supplies utility routines for
            reading them.)</p></dd><dt>Use a combination of methods</dt><dd><p>It’s often useful to combine methods, to give users the
            flexibility of providing parameters different ways. For example,
            MySQL clients such as <span class="command"><em>mysql</em></span> and
            <span class="command"><em>mysqladmin</em></span> look for option
            files in several locations and read any that are present. They
            then check the command-line arguments for further parameters. This
            enables users to specify connection parameters in an option file
            or on the command line.</p></dd></dl><p>These methods of obtaining connection parameters do involve
      security issues:</p><ul><li><p>Any method that stores connection parameters in a file may
          compromise your system’s security unless the file is protected
          against access by unauthorized users. This is true whether
          parameters are stored in a source file, an option file, or a script
          that invokes a command and specifies the parameters on the command
          line. (Web scripts that can be read only by the web server don’t
          qualify as secure if other users have administrative access to the
          server.)</p></li><li><p>Parameters specified on the command line or in environment
          variables are not particularly secure. While a program is executing,
          its command-line arguments and environment may be visible to other
          users who run process status commands such as <span class="command"><em>ps</em></span> <code class="option">-e</code>. In particular,
          storing the password in an environment variable perhaps is best
          limited to those situations in which you’re the only user on the
          machine or you trust all other users.</p></li></ul><p>The rest of this section discusses how to process command-line
      arguments to get connection parameters and how to read parameters from
      option files.</p><section data-type="sect3" data-pdf-bookmark="Getting parameters from the command line"><div class="sect3" id="idm45820378933552"><h3>Getting parameters from the command line</h3><p>The convention used by standard clients such as <span class="command"><em>mysql</em></span> and <span class="command"><em>mysqladmin</em></span> for command-line arguments is to
        permit parameters to be specified using either a short option or a
        long option. For example, the username <code>cbuser</code> can be specified either as <code class="option">-u</code> <code class="option">cbuser</code> (or
        <code class="option">-ucbuser</code>) or <code class="option">--user=cbuser</code>. In
        addition, for either of the password options (<code class="option">-p</code> or
        <code class="option">--password</code>), the password value may be omitted after the option name to cause the
        program to prompt for the password interactively.</p><p>The standard flags for these command options are <code class="option">-h</code> or <code class="option">--host</code>,
        <code class="option">-u</code> or <code class="option">--user</code>, and
        <code class="option">-p</code> or <code class="option">--password</code>. You could write
        your own code to iterate through the argument list, but it’s much
        easier to use existing option-processing modules written for that
        purpose. Under the <em class="filename">api</em> directory
        of the <code>recipes</code> distribution, you’ll
        find example programs that show how to process command arguments to
        obtain the hostname, username, and password for Perl, Ruby, Python,
        and Java. An accompanying PDF file explains how each one works.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>Insofar as possible, the programs mimic option-handling
          behavior of the standard MySQL clients. An exception is that
          option-processing libraries may not permit making the password value
          optional, and they provide no way of prompting the user for a
          password interactively if a password option is specified without a
          password value. Consequently, the programs are written so that if
          you use <code class="option">-p</code> or <code class="option">--password</code>, you must
          provide the password value following the option.</p></div></div></section><section data-type="sect3" data-pdf-bookmark="Getting parameters from option files"><div class="sect3" id="idm45820378917984"><h3>Getting parameters from option files</h3><p>If your API supports it, you can specify connection parameters in a MySQL option
        file and let the API read the parameters from the file for you. For
        APIs that do not support option files directly, you may be able to
        arrange to read other types of files in which parameters are stored or
        to write your own functions that read option files.</p><p><a data-type="xref" href="ch01.xhtml#nch-mysql-mysql-options">Recipe 1.4</a> describes the format
        of MySQL option files. We assume that you’ve read the discussion there
        and concentrate here on how to use option files from within programs.
        You can find files containing the code discussed here under the
        <em class="filename">api</em> directory of the
        <code>recipes</code> distribution.</p><p>Under Unix, user-specific options are specified by convention in <em class="filename">~/.my.cnf</em> (that is, in the <em class="filename">.my.cnf</em> file in your home directory).
        However, the MySQL option-file mechanism can look in several different
        files if they exist, although no option file is
        <em>required</em> to exist. (For the list of standard
        locations in which MySQL programs look for them, see <a data-type="xref" href="ch01.xhtml#nch-mysql-mysql-options">Recipe 1.4</a>.) If multiple option files exist
        and a given parameter is specified in several of them, the last value
        found takes precedence.</p><p>Programs you write do not use MySQL option files unless you tell
        them to:</p><ul><li><p>Perl DBI and Ruby Mysql2 gem provide direct API support for reading
            option files; simply indicate that you want to use them at the
            time that you connect to the server. It’s possible to specify that
            only a particular file should be read, or that the standard search
            order should be used to look for multiple option files.</p></li><li><p>PHP PDO, Connector/Python, Java and Go do not support option
            files. (The PDO MySQL driver does, but not if you use <code>mysqlnd</code> as the underlying library.) As a
            workaround for PHP, we’ll write a simple option-file parsing
            function. For Java, we’ll adopt a different approach that uses
            properties files. For Go we will utilize <code>INI</code>
            parsing library.</p></li></ul><p>Although the conventional name under Unix for the user-specific
        option file is <em class="filename">.my.cnf</em> in the
        current user’s home directory, there’s no rule that your own programs
        must use this particular file. You can name an option file anything
        you like and put it wherever you want. For example, you might set up a
        file named <em class="filename">mcb.cnf</em> and install it
        in the <em class="filename">/usr/local/lib/mcb</em>
        directory for use by scripts that access the <code>cookbook</code> database. Under some circumstances,
        you might even want to create multiple option files. Then, from within
        any given script, select the file that’s appropriate for the access
        privileges the script needs. For example, you might have one option
        file, <em class="filename">mcb.cnf</em>, that lists
        parameters for a full-access MySQL account, and another file,
        <em class="filename">mcb-readonly.cnf</em>, that lists
        connection parameters for an account that needs only read-only access
        to MySQL. Another possibility is to list multiple groups within the
        same option file and have your scripts select options from the
        appropriate group.</p><section data-type="sect4" data-pdf-bookmark="Perl"><div class="sect4" id="idm45820378908736"><h4>Perl</h4><p>Perl DBI scripts can use option files. To take advantage of this, place the
          appropriate option specifiers in the third component of the data
          source name (DSN) string:</p><ul><li><p>To specify an option group, use <code>mysql_read_default_group=<em><code>groupname</code></em></code>.
              This tells MySQL to search the standard option files for options
              in the named group and in the <code>[client]</code> group. Write the
              <em><code>groupname</code></em> value without the
              surrounding square brackets. (If a group in an option file
              begins with a <code>[my_prog]</code> line,
              specify the <em><code>groupname</code></em> value as
              <code>my_prog</code>.) To search the
              standard files but look only in the <code>[client]</code> group,
              <em><code>groupname</code></em> should be <code>client</code>.</p></li><li><p>To name a specific option file, use <code>mysql_read_default_file=<em><code>filename</code></em></code>
              in the DSN. When you do this, MySQL looks only in that file and
              only for options in the <code>[client]</code> group.</p></li><li><p>If you specify both an option file and an option group,
              MySQL reads only the named file, but looks for options both in
              the named group and in the <code>[client]</code> group.</p></li></ul><p>The following example tells MySQL to use the standard
          option-file search order to look for options in both the <code>[cookbook]</code> and <code>[client]</code> groups:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="c1"># basic DSN</code>
<code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:database=cookbook"</code><code class="p">;</code>
<code class="c1"># look in standard option files; use [cookbook] and [client] groups</code>
<code class="nv">$dsn</code> <code class="o">.=</code> <code class="s">";mysql_read_default_group=cookbook"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p>The next example explicitly names the option file located in
          <code>$ENV{HOME}</code>, the home directory of
          the user running the script. Thus, MySQL looks only in that file and
          uses options from the <code>[client]</code>
          group:</p><pre data-type="programlisting" data-code-language="perl"><code class="k">my</code> <code class="nv">$conn_attrs</code> <code class="o">=</code> <code class="p">{</code><code class="n">PrintError</code> <code class="o">=&gt;</code> <code class="mi">0</code><code class="p">,</code> <code class="n">RaiseError</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">,</code> <code class="n">AutoCommit</code> <code class="o">=&gt;</code> <code class="mi">1</code><code class="p">};</code>
<code class="c1"># basic DSN</code>
<code class="k">my</code> <code class="nv">$dsn</code> <code class="o">=</code> <code class="s">"DBI:mysql:database=cookbook"</code><code class="p">;</code>
<code class="c1"># look in user-specific option file owned by the current user</code>
<code class="nv">$dsn</code> <code class="o">.=</code> <code class="s">";mysql_read_default_file=$ENV{HOME}/.my.cnf"</code><code class="p">;</code>
<code class="k">my</code> <code class="nv">$dbh</code> <code class="o">=</code> <code class="nn">DBI</code><code class="o">-&gt;</code><code class="nb">connect</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="nb">undef</code><code class="p">,</code> <code class="nv">$conn_attrs</code><code class="p">);</code></pre><p>If you pass an empty value (<code>undef</code> or the empty string) for the
          username or password arguments of the <code>connect()</code> call, <code>connect()</code> uses whatever values are found in the option file or files. A
          nonempty username or password in the <code>connect()</code> call overrides any option-file
          value. Similarly, a host named in the DSN overrides any option-file
          value. Use this behavior to enable DBI scripts to obtain connection
          parameters both from option files as well as from the command line
          as follows:</p><ol><li><p>Create <code>$host_name</code>,
              <code>$user_name</code>, and <code>$password</code> variables, each with a value
              of <code>undef</code>. Then parse the
              command-line arguments to set the variables to non-<code>undef</code> values if the corresponding
              options are present on the command line. (The <span class="command"><em>cmdline.pl</em></span> Perl script under the
              <em class="filename">api</em> directory of the
              <code>recipes</code> distribution
              demonstrates how to do this.)</p></li><li><p>After parsing the command arguments, construct the DSN
              string, and call <code>connect()</code>.
              Use <code>mysql_read_default_group</code>
              and <code>mysql_read_default_file</code>
              in the DSN to specify how you want option files to be used, and,
              if <code>$host_name</code> is not <code>undef</code>, add <code>host=$host_name</code> to the DSN. In
              addition, pass <code>$user_name</code> and
              <code>$password</code> as the username and
              password arguments to <code>connect()</code>. These will be <code>undef</code> by default; if they were set
              from the command-line arguments, they will have non-<code>undef</code> values that override any
              option-file values.</p></li></ol><p>If a script follows this procedure, parameters given by the
          user on the command line are passed to <code>connect()</code> and take precedence over the
          contents of option files.</p></div></section><section data-type="sect4" data-pdf-bookmark="Ruby"><div class="sect4" id="idm45820378904592"><h4>Ruby</h4><p>Ruby Mysql2 scripts can read option files, specified by the <code>default_file</code> connection parameter. If you want to specify default group, use option <code>default_group</code>.</p><p>This example uses the standard option-file search order to
          look for options in both the <code>[cookbook]</code> and <code>[client]</code> groups:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:default_group</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">,</code> <code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code></pre><p>The following example uses the <em class="filename">.my.cnf</em> file in the current user’s home
          directory to obtain parameters from the <code>[client]</code> group:</p><pre data-type="programlisting" data-code-language="ruby"><code class="n">client</code> <code class="o">=</code> <code class="no">Mysql2</code><code class="o">::</code><code class="no">Client</code><code class="o">.</code><code class="n">new</code><code class="p">(</code><code class="ss">:default_file</code> <code class="o">=&gt;</code> <code class="s2">"</code><code class="si">#{</code><code class="no">ENV</code><code class="o">[</code><code class="s1">'HOME'</code><code class="o">]</code><code class="si">}</code><code class="s2">/.my.cnf"</code><code class="p">,</code><code class="err">↩</code>
<code class="ss">:database</code> <code class="o">=&gt;</code> <code class="s2">"cookbook"</code><code class="p">)</code></pre></div></section><section data-type="sect4" data-pdf-bookmark="PHP"><div class="sect4" id="idm45820378716272"><h4>PHP</h4><p>As mentioned earlier, the PDO MySQL driver does not necessarily
          support using MySQL option files (it does not if you use <code>mysqlnd</code> as the underlying library). To
          work around that limitation, use a function that reads an option
          file, such as the <code>read_mysql_option_file()</code> function shown in
          the following listing. It takes as arguments the name of an option
          file and an option group name or an array containing group names.
          (Group names should be written without square brackets.) It then
          reads any options present in the file for the named group or groups.
          If no option group argument is given, the function looks by default
          in the <code>[client]</code> group. The return
          value is an array of option name/value pairs, or <code>FALSE</code> if an error occurs. It is not an
          error for the file not to exist. (Note that quoted option values and
          trailing <code>#</code>-style comments
          following option values are legal in MySQL option files, but this
          function does not handle those constructs.)</p><pre data-type="programlisting" data-code-language="php"><code class="k">function</code> <code class="nf">read_mysql_option_file</code> <code class="p">(</code><code class="nv">$filename</code><code class="p">,</code> <code class="nv">$group_list</code> <code class="o">=</code> <code class="s2">"client"</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nb">is_string</code> <code class="p">(</code><code class="nv">$group_list</code><code class="p">))</code>           <code class="c1"># convert string to array</code>
    <code class="nv">$group_list</code> <code class="o">=</code> <code class="k">array</code> <code class="p">(</code><code class="nv">$group_list</code><code class="p">);</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nb">is_array</code> <code class="p">(</code><code class="nv">$group_list</code><code class="p">))</code>           <code class="c1"># hmm ... garbage argument?</code>
    <code class="k">return</code> <code class="p">(</code><code class="k">FALSE</code><code class="p">);</code>
  <code class="nv">$opt</code> <code class="o">=</code> <code class="k">array</code> <code class="p">();</code>                       <code class="c1"># option name/value array</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!@</code><code class="p">(</code><code class="nv">$fp</code> <code class="o">=</code> <code class="nb">fopen</code> <code class="p">(</code><code class="nv">$filename</code><code class="p">,</code> <code class="s2">"r"</code><code class="p">)))</code>  <code class="c1"># if file does not exist,</code>
    <code class="k">return</code> <code class="p">(</code><code class="nv">$opt</code><code class="p">);</code>                       <code class="c1"># return an empty list</code>
  <code class="nv">$in_named_group</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>  <code class="c1"># set nonzero while processing a named group</code>
  <code class="k">while</code> <code class="p">(</code><code class="nv">$s</code> <code class="o">=</code> <code class="nb">fgets</code> <code class="p">(</code><code class="nv">$fp</code><code class="p">,</code> <code class="mi">1024</code><code class="p">))</code>
  <code class="p">{</code>
    <code class="nv">$s</code> <code class="o">=</code> <code class="nb">trim</code> <code class="p">(</code><code class="nv">$s</code><code class="p">);</code>
    <code class="k">if</code> <code class="p">(</code><code class="nb">preg_match</code> <code class="p">(</code><code class="s2">"/^[#;]/"</code><code class="p">,</code> <code class="nv">$s</code><code class="p">))</code>              <code class="c1"># skip comments</code>
      <code class="k">continue</code><code class="p">;</code>
    <code class="k">if</code> <code class="p">(</code><code class="nb">preg_match</code> <code class="p">(</code><code class="s2">"/^\[([^]]+)]/"</code><code class="p">,</code> <code class="nv">$s</code><code class="p">,</code> <code class="nv">$arg</code><code class="p">))</code>  <code class="c1"># option group line</code>
    <code class="p">{</code>
      <code class="c1"># check whether we are in one of the desired groups</code>
      <code class="nv">$in_named_group</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>
      <code class="k">foreach</code> <code class="p">(</code><code class="nv">$group_list</code> <code class="k">as</code> <code class="nv">$group_name</code><code class="p">)</code>
      <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="nv">$arg</code><code class="p">[</code><code class="mi">1</code><code class="p">]</code> <code class="o">==</code> <code class="nv">$group_name</code><code class="p">)</code>
        <code class="p">{</code>
          <code class="nv">$in_named_group</code> <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>    <code class="c1"># we are in a desired group</code>
          <code class="k">break</code><code class="p">;</code>
        <code class="p">}</code>
      <code class="p">}</code>
      <code class="k">continue</code><code class="p">;</code>
    <code class="p">}</code>
    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nv">$in_named_group</code><code class="p">)</code>         <code class="c1"># we are not in a desired</code>
      <code class="k">continue</code><code class="p">;</code>                   <code class="c1"># group, skip the line</code>
    <code class="k">if</code> <code class="p">(</code><code class="nb">preg_match</code> <code class="p">(</code><code class="s2">"/^([^ </code><code class="se">\t</code><code class="s2">=]+)[ </code><code class="se">\t</code><code class="s2">]*=[ </code><code class="se">\t</code><code class="s2">]*(.*)/"</code><code class="p">,</code> <code class="nv">$s</code><code class="p">,</code> <code class="nv">$arg</code><code class="p">))</code>
      <code class="nv">$opt</code><code class="p">[</code><code class="nv">$arg</code><code class="p">[</code><code class="mi">1</code><code class="p">]]</code> <code class="o">=</code> <code class="nv">$arg</code><code class="p">[</code><code class="mi">2</code><code class="p">];</code>    <code class="c1"># name=value</code>
    <code class="k">else</code> <code class="k">if</code> <code class="p">(</code><code class="nb">preg_match</code> <code class="p">(</code><code class="s2">"/^([^ </code><code class="se">\t</code><code class="s2">]+)/"</code><code class="p">,</code> <code class="nv">$s</code><code class="p">,</code> <code class="nv">$arg</code><code class="p">))</code>
      <code class="nv">$opt</code><code class="p">[</code><code class="nv">$arg</code><code class="p">[</code><code class="mi">1</code><code class="p">]]</code> <code class="o">=</code> <code class="s2">""</code><code class="p">;</code>         <code class="c1"># name only</code>
    <code class="c1"># else line is malformed</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="p">(</code><code class="nv">$opt</code><code class="p">);</code>
<code class="p">}</code></pre><p>Here are two examples showing how to use <code>read_mysql_option_file()</code>. The first reads
          a user’s option file to get the <code>[client]</code> group parameters and uses them to
          connect to the server. The second reads the system-wide option file,
          <em class="filename">/etc/my.cnf</em>, and prints the
          server startup parameters that are found there (that is, the
          parameters in the <code>[mysqld]</code> and
          <code>[server]</code> groups):</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$opt</code> <code class="o">=</code> <code class="nx">read_mysql_option_file</code> <code class="p">(</code><code class="s2">"/home/paul/.my.cnf"</code><code class="p">);</code>
<code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:dbname=cookbook"</code><code class="p">;</code>
<code class="k">if</code> <code class="p">(</code><code class="nb">isset</code> <code class="p">(</code><code class="nv">$opt</code><code class="p">[</code><code class="s2">"host"</code><code class="p">]))</code>
  <code class="nv">$dsn</code> <code class="o">.=</code> <code class="s2">";host="</code> <code class="o">.</code> <code class="nv">$opt</code><code class="p">[</code><code class="s2">"host"</code><code class="p">];</code>
<code class="nv">$user</code> <code class="o">=</code> <code class="nv">$opt</code><code class="p">[</code><code class="s2">"user"</code><code class="p">];</code>
<code class="nv">$password</code> <code class="o">=</code> <code class="nv">$opt</code><code class="p">[</code><code class="s2">"password"</code><code class="p">];</code>
<code class="k">try</code>
<code class="p">{</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">PDO</code> <code class="p">(</code><code class="nv">$dsn</code><code class="p">,</code> <code class="nv">$user</code><code class="p">,</code> <code class="nv">$password</code><code class="p">);</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Connected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
  <code class="nv">$dbh</code> <code class="o">=</code> <code class="k">NULL</code><code class="p">;</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Disconnected</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>
<code class="k">catch</code> <code class="p">(</code><code class="nx">PDOException</code> <code class="nv">$e</code><code class="p">)</code>
<code class="p">{</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"Cannot connect to server</code><code class="se">\n</code><code class="s2">"</code><code class="p">);</code>
<code class="p">}</code>

<code class="nv">$opt</code> <code class="o">=</code> <code class="nx">read_mysql_option_file</code> <code class="p">(</code><code class="s2">"/etc/my.cnf"</code><code class="p">,</code> <code class="k">array</code> <code class="p">(</code><code class="s2">"mysqld"</code><code class="p">,</code> <code class="s2">"server"</code><code class="p">));</code>
<code class="k">foreach</code> <code class="p">(</code><code class="nv">$opt</code> <code class="k">as</code> <code class="nv">$name</code> <code class="o">=&gt;</code> <code class="nv">$value</code><code class="p">)</code>
  <code class="k">print</code> <code class="p">(</code><code class="s2">"</code><code class="si">$name</code><code class="s2"> =&gt; </code><code class="si">$value\n</code><code class="s2">"</code><code class="p">);</code></pre><p>PHP does have a <code>parse_ini_file()</code> function that is intended for parsing <em class="filename">.ini</em> files. These have a syntax that is
          similar to MySQL option files, so you might find this function of
          use. However, there are some differences to watch out for. Suppose
          that you have a file written like this:</p><pre data-type="programlisting">[client]
user=paul

[client]
host=127.0.0.1

[mysql]
no-auto-rehash</pre><p>Standard MySQL option parsing considers both the <code>user</code> and <code>host</code> values part of the <code>[client]</code> group, whereas <code>parse_ini_file()</code> returns only the contents
          of the final <code>[client]</code> stanza; the
          <code>user</code> option is lost. Also,
          <code>parse_ini_file()</code> ignores options
          that are given without a value, so the <code>no-auto-rehash</code> option is lost.</p></div></section><section data-type="sect4" data-pdf-bookmark="Go"><div class="sect4" id="idm45820378560400"><h4>Go</h4><p>The Go-MySQL-Driver doesn’t support option files. However, the INI parsing  
           library supports reading properties files that contain lines in the
          <em><code>name=value</code></em> format. Here is a sample properties file:</p><pre data-type="programlisting"># this file lists parameters for connecting to the MySQL server
[client]
user=cbuser
password=cbpass
host=localhost</pre><p>Function <code>MyCnf()</code> shows one way to read
          a properties file named <em class="filename">~/.my.cnf</em> to obtain connection
          parameters:</p><pre data-type="programlisting" data-code-language="go"><code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">        </code><code class="s">"fmt"</code><code class="w"/>
<code class="w">        </code><code class="s">"os"</code><code class="w"/>
<code class="w">        </code><code class="s">"gopkg.in/ini.v1"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="c1">// Configuration Parser</code><code class="w"/>
<code class="kd">func</code><code class="w"> </code><code class="nx">MyCnf</code><code class="p">(</code><code class="nx">client</code><code class="w"> </code><code class="kt">string</code><code class="p">)</code><code class="w"> </code><code class="p">(</code><code class="kt">string</code><code class="p">,</code><code class="w"> </code><code class="kt">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">cfg</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">ini</code><code class="p">.</code><code class="nx">LoadSources</code><code class="p">(</code><code class="nx">ini</code><code class="p">.</code><code class="nx">LoadOptions</code><code class="p">{</code><code class="nx">AllowBooleanKeys</code><code class="p">:</code><code class="w"> </code><code class="kc">true</code><code class="p">},</code><code class="w"> </code><code class="err">↩</code><code class="w"/>
<code class="w">                                </code><code class="nx">os</code><code class="p">.</code><code class="nx">Getenv</code><code class="p">(</code><code class="s">"HOME"</code><code class="p">)</code><code class="o">+</code><code class="s">"/.my.cnf"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="s">""</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">for</code><code class="w"> </code><code class="nx">_</code><code class="p">,</code><code class="w"> </code><code class="nx">s</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="k">range</code><code class="w"> </code><code class="nx">cfg</code><code class="p">.</code><code class="nx">Sections</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="nx">client</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="s">""</code><code class="w"> </code><code class="o">&amp;&amp;</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Name</code><code class="p">()</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="nx">client</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">continue</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="nx">host</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Key</code><code class="p">(</code><code class="s">"host"</code><code class="p">).</code><code class="nx">String</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="nx">port</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Key</code><code class="p">(</code><code class="s">"port"</code><code class="p">).</code><code class="nx">String</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="nx">dbname</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Key</code><code class="p">(</code><code class="s">"dbname"</code><code class="p">).</code><code class="nx">String</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="nx">user</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Key</code><code class="p">(</code><code class="s">"user"</code><code class="p">).</code><code class="nx">String</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="nx">password</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">s</code><code class="p">.</code><code class="nx">Key</code><code class="p">(</code><code class="s">"password"</code><code class="p">).</code><code class="nx">String</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Sprintf</code><code class="p">(</code><code class="s">"%s:%s@tcp(%s:%s)/%s"</code><code class="p">,</code><code class="w"> </code><code class="nx">user</code><code class="p">,</code><code class="w"> </code><code class="nx">password</code><code class="p">,</code><code class="w"> </code><code class="nx">host</code><code class="p">,</code><code class="w"> </code><code class="nx">port</code><code class="p">,</code><code class="w"> </code><code class="nx">dbname</code><code class="p">),</code><code class="err">↩</code><code class="w"/>
<code class="w">               </code><code class="kc">nil</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="k">return</code><code class="w"> </code><code class="s">""</code><code class="p">,</code><code class="w"> </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Errorf</code><code class="p">(</code><code class="s">"No matching entry found in ~/.my.cnf"</code><code class="p">)</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>
            The function <code>MyCnf()</code> defined in the <em class="filename">cookbook.go</em>, developed elsewhere in the chapter (see <a data-type="xref" href="#nch-api-api-library">Recipe 4.3</a>). It is used in the file <em class="filename">mycnf.go</em> which you will find in the directory <em class="filename">api/06_conn_params</em> in the <code>recipes</code> distribution:
          </p><pre data-type="programlisting" data-code-language="go"><code class="c1">// mycnf.go : Reads ~/.my.cnf file for DSN construct</code><code class="w"/>
<code class="kn">package</code><code class="w"> </code><code class="nx">main</code><code class="w"/>

<code class="kn">import</code><code class="w"> </code><code class="p">(</code><code class="w"/>
<code class="w">	</code><code class="s">"fmt"</code><code class="w"/>
<code class="w">	</code><code class="s">"github.com/svetasmirnova/mysqlcookbook/recipes/lib"</code><code class="w"/>
<code class="p">)</code><code class="w"/>

<code class="kd">func</code><code class="w"> </code><code class="nx">main</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Println</code><code class="p">(</code><code class="s">"Calling db.MyCnf()"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="kd">var</code><code class="w"> </code><code class="nx">dsn</code><code class="w"> </code><code class="kt">string</code><code class="w"/>

<code class="w">    </code><code class="nx">dsn</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">cookbook</code><code class="p">.</code><code class="nx">MyCnf</code><code class="p">(</code><code class="s">"client"</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="k">if</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">!=</code><code class="w"> </code><code class="kc">nil</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	  </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"error: %v\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">	  </code><code class="nx">fmt</code><code class="p">.</code><code class="nx">Printf</code><code class="p">(</code><code class="s">"DSN is: %s\n"</code><code class="p">,</code><code class="w"> </code><code class="nx">dsn</code><code class="p">)</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre><p>The function <code>MyCnf()</code> accepts section name as a parameter. If you want to replace section <code>[client]</code> with any other name call <code>MyCnf()</code> as <code>MyCnf("other")</code> where <code>other</code> is the name of the section.</p></div></section><section data-type="sect4" data-pdf-bookmark="Java"><div class="sect4" id="idm45820377867488"><h4>Java</h4><p>The JDBC MySQL Connector/J driver doesn’t support option files. However, the Java class
          library supports reading properties files that contain lines in
          <em><code>name=value</code></em> format. This is similar but
          not identical to MySQL option-file format (for example, properties
          files do not permit <code>[<em><code>groupname</code></em>]</code>
          lines). Here is a simple properties file:</p><pre data-type="programlisting"># this file lists parameters for connecting to the MySQL server
user=cbuser
password=cbpass
host=localhost</pre><p>The following program, <em class="filename">ReadPropsFile.java</em>, shows one way to read
          a properties file named <em class="filename">Cookbook.properties</em> to obtain connection
          parameters. The file must be in some directory named in your
          <code>CLASSPATH</code> variable, or you must
          specify it using a full pathname (the example shown
          here assumes that the file is in a <code>CLASSPATH</code> directory):</p><pre data-type="programlisting" data-code-language="java"><code class="kn">import</code> <code class="nn">java.sql.*</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.*</code><code class="o">;</code>   <code class="c1">// need this for properties file support</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReadPropsFile</code> <code class="o">{</code>
  <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">Connection</code> <code class="n">conn</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">url</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
    <code class="n">String</code> <code class="n">propsFile</code> <code class="o">=</code> <code class="s">"Cookbook.properties"</code><code class="o">;</code>
    <code class="n">Properties</code> <code class="n">props</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Properties</code><code class="o">();</code>

    <code class="k">try</code> <code class="o">{</code>
      <code class="n">props</code><code class="o">.</code><code class="na">load</code><code class="o">(</code><code class="n">ReadPropsFile</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="n">propsFile</code><code class="o">));</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Cannot read properties file"</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">exit</code> <code class="o">(</code><code class="mi">1</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">try</code> <code class="o">{</code>
      <code class="c1">// construct connection URL, encoding username</code>
      <code class="c1">// and password as parameters at the end</code>
      <code class="n">url</code> <code class="o">=</code> <code class="s">"jdbc:mysql://"</code>
            <code class="o">+</code> <code class="n">props</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"host"</code><code class="o">)</code>
            <code class="o">+</code> <code class="s">"/cookbook"</code>
            <code class="o">+</code> <code class="s">"?user="</code> <code class="o">+</code> <code class="n">props</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"user"</code><code class="o">)</code>
            <code class="o">+</code> <code class="s">"&amp;password="</code> <code class="o">+</code> <code class="n">props</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"password"</code><code class="o">);</code>
      <code class="n">conn</code> <code class="o">=</code> <code class="n">DriverManager</code><code class="o">.</code><code class="na">getConnection</code><code class="o">(</code><code class="n">url</code><code class="o">);</code>
      <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Connected"</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Cannot connect to server"</code><code class="o">);</code>
    <code class="o">}</code> <code class="k">finally</code> <code class="o">{</code>
      <code class="k">try</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">conn</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>
          <code class="n">conn</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>
          <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Disconnected"</code><code class="o">);</code>
        <code class="o">}</code>
      <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">SQLException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code> <code class="cm">/* ignore close errors */</code> <code class="o">}</code>
    <code class="o">}</code>
  <code class="o">}</code>
<code class="o">}</code></pre><p>To have <code>getProperty()</code>
          return a particular default value when the named property is
          not found, pass that value as a second argument. For example, to use
          <code>127.0.0.1</code> as the default <code>host</code> value, call <code>getProperty()</code> like this:</p><pre data-type="programlisting" data-code-language="java"><code class="n">String</code> <code class="n">hostName</code> <code class="o">=</code> <code class="n">props</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"host"</code><code class="o">,</code> <code class="s">"127.0.0.1"</code><code class="o">);</code></pre><p>The <em class="filename">Cookbook.java</em> library
          file developed elsewhere in the chapter (see <a data-type="xref" href="#nch-api-api-library">Recipe 4.3</a>) includes an extra library call in
          the version of the file that you’ll find in the <em class="filename">lib</em> directory of the <code>recipes</code> distribution: a <code>propsConnect()</code> routine that is based on
          the concepts discussed here. To use it, set up the contents of the
          properties file, <em class="filename">Cookbook.properties</em>, and copy the file to
          the same location where you installed <em class="filename">Cookbook.class</em>. You can then establish a
          connection within a program by importing the <code>Cookbook</code> class and calling <code>Cookbook.propsConnect()</code> rather than by
          calling <code>Cookbook.connect()</code>.</p></div></section></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="4.9 Resetting the profile Table"><div class="sect1" id="nch-api-api-conclusion"><h1>4.9 Resetting the profile Table</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820377416880"><h2>Problem</h2><p>
        While working on examples in this chapter you changed original content of the table <code>profile</code> and now want it back, so you can use it while working with other recipes.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820377392912"><h2>Solution</h2><p>
        Reload the table using the <span class="command"><em>mysql</em></span> client.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820377391280"><h2>Discussion</h2><p>It’s a good idea to reset the <code>profile</code> table used in this chapter to a known
    state. Change location into the <em class="filename">tables</em> directory of the <code>recipes</code> distribution, and run these
    commands:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; profile.sql</code></strong>
$ <strong><code>mysql cookbook &lt; profile2.sql</code></strong></pre><p>Several statements in later chapters use the <code>profile</code> table; by reinitializing it, you’ll get
    the same results displayed in those chapters when you run the statements
    shown there.</p><p>This chapter discussed the basic operations provided by each of our
    APIs for handling various aspects of interaction with the MySQL server.
    These operations enable you to write programs that execute any kind of
    statement and retrieve the results. Up to this point, we’ve used simple
    statements because the focus is on the APIs rather than on SQL. The next
    chapter focuses on SQL instead, to show how to ask the database server
    more complex questions.</p></div></section></div></section></div></section></div></body></html>