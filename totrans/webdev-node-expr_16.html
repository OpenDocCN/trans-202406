<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 16. Single-Page Applications"><div class="chapter" id="ch_single_page_applications">
<h1><span class="label">Chapter 16. </span>Single-Page Applications</h1>


<p><a data-type="indexterm" data-primary="single-page applications (SPAs)" id="ix_ch-16-single_page_applications-asciidoc0"/>The term <em>single-page application</em> (SPA) is something of a misnomer, or it
is at least confusing two meanings of the word “page.”  SPAs, from the
user’s perspective, can (and usually do) still appear to have different
pages: the home page, the Vacations page, the About page, and so on.
As a matter of fact, you could create a traditional server-side rendered
application and an SPA that were indistinguishable to the user.</p>

<p>The “single page” has more to do with where and how the HTML is constructed
than the user’s experience.  In an SPA, the server delivers a single HTML
bundle when the user first loads the application,<sup><a data-type="noteref" id="idm45053580304888-marker" href="ch16.xhtml#idm45053580304888">1</a></sup> and any
changes in the UI (which may appear as different pages to the user) are the
result of JavaScript manipulating the DOM in response to user activity or
network events.</p>

<p>SPAs still need to communicate frequently with the server, but HTML is
usually only sent as part of that first request.  After that, only JSON
data and static assets are transferred between the client and server.</p>

<p>Understanding the reason for this now-dominant approach to web application
development requires a little history….</p>






<section data-type="sect1" data-pdf-bookmark="A Short History of Web Application Development"><div class="sect1" id="idm45053580302200">
<h1>A Short History of Web Application Development</h1>

<p><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="web application development history" id="ix_ch-16-single_page_applications-asciidoc1"/><a data-type="indexterm" data-primary="web application development, brief history of" id="ix_ch-16-single_page_applications-asciidoc2"/>The way we approach web development has undergone a massive shift in the
last 10 years, but one thing has remained relatively consistent: the
components involved in a website or web application.  Namely:</p>

<ul>
<li>
<p>HTML and the Document Object Model (DOM)</p>
</li>
<li>
<p>JavaScript</p>
</li>
<li>
<p>CSS</p>
</li>
<li>
<p>Static assets (generally multimedia: images and videos, etc.)</p>
</li>
</ul>

<p>Put together by a browser, these components are what provide the user
experience.</p>

<p><em>How</em> that experience is constructed, however, started shifting drastically
around 2012.  Today, the dominant paradigm for web development is
<em>single-page applications</em>, or SPAs.</p>

<p><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="origins" id="ix_ch-16-single_page_applications-asciidoc3"/>To understand SPAs, we need to understand what to contrast them with, so
we’re going to go even further back in time, to 1998, the year before the
term “Web 2.0” was first whispered, and eight years before jQuery was
introduced.</p>

<p>In 1998, the dominant method for delivering web applications was for web
servers to send HTML, CSS, JavaScript, and multimedia assets <em>in response
to every request</em>.  Imagine you’re watching TV, and you want to change the
channel.  The metaphorical equivalent here is that you would have to throw
away your TV, go buy another one, schlep it into your house, and set it up—just to change the channel (navigate to a different page, even on the same
site).</p>

<p>The problem with this approach is that there’s a lot of overhead involved.
Sometimes the HTML—or large chunks of it—wouldn’t change at all.
The CSS changed even less.  Browsers mitigated some of this overhead cost
by caching assets, but the pace of innovation in web applications was
straining this model.</p>

<p>In 1999, the term “Web 2.0” was coined to try to describe the richness of
experience that people were beginning to expect from websites.  The years
between 1999 and 2012 saw technological advancements that were laying the
groundwork for SPAs.</p>

<p>Clever web developers began to realize that if they were going to keep
their users engaged, the overhead of shipping the entire website every time
the user wanted to (metaphorically) change the channel was unacceptable.
These developers realized that not every change in an application required
information from the server, and not every change that required information
from the server needed the entire application just to deliver a small
change.</p>

<p>In this period from 1999 to 2012, pages were still generally pages: when you
first went to a website, you got the HTML, the CSS, and the static assets.
When you navigated to a different page, you would get different HTML,
different static assets, and sometimes different CSS.  However, on each
page, the page itself might change in response to user interaction, and
instead of asking the server for a whole new application, JavaScript would
change the DOM directly.  If information needed to be fetched from the
server, that information was sent in XML or JSON, without all the attendant
HTML.  It was, once again, up to the JavaScript to interpret the data and
change the user interface accordingly.  In 2006, jQuery was introduced,
which significantly eased the burden of DOM manipulation <em>and</em> dealing with
network requests.</p>

<p>Many of these changes were being driven by the increasing power of
computers and—by extension—browsers, Web developers were finding that
more and more of the work to make a website or web application look pretty
could be done directly on the user’s computer instead of being done on the
server and then sent to the user.</p>

<p>This shift in approach went into overdrive in the late 2000s, when
smartphones were introduced.  Now, not only were browsers capable of doing
more, but people wanted to access web applications <em>over wireless networks</em>.
Suddenly, the overhead cost of sending data went up, making it even more
attractive to ship as little as possible over the network, and let the
browser do as much work as possible.</p>

<p>By 2012, it was common practice to try to send as little information as
possible over the network, and do as much as possible in the browser.  Like
the primordial soup giving rise to the first life, this rich environment
provided the conditions for the natural evolution of the this technique:
the single-page application.</p>

<p>The idea is simple enough: for any given web application, the HTML,
JavaScript, and CSS (if any) are shipped <em>exactly once</em>. Once the browser has
the HTML, it is up to the JavaScript to make all changes to the DOM to make
the user feel that they are navigating to a different page. No more does the
server need to send different HTML when you navigate from the home page to
the Vacations page, for example.</p>

<p>Of course the server is still involved: it’s still responsible for
providing up-to-date data, and being the “single source of truth” in a
multiuser application.  But in an SPA architecture, the way the
application appears to the user is no longer the concern of the server:
it’s the concern of JavaScript and the frameworks that enable this clever
illusion.</p>

<p>While Angular is generally considered the first SPA framework, it has been
joined by many others: React, Vue, and Ember being the most prominent among
Angular’s competition.</p>

<p>If you are new to development, SPAs may be your only frame of reference,
making this simply some interesting history.  But if you’re a veteran, you
may find the shift confusing and jarring.  Whichever group you fall into,
this chapter is designed to help you understand how web applications are
delivered as SPAs, and what the role of Express is in that.</p>

<p>This history is relevant to Express because the role of the server has
changed during this shift in web development techniques.  When the first
edition of this book was published, Express was still commonly used to
serve multi-page applications (along with the APIs that supported Web
2.0–like functionality).  Now Express is almost entirely used to serve
SPAs, development servers, and APIs, reflecting the changing nature of web
development.</p>

<p>Interestingly, there are still valid reasons for a web application to be able to serve a specific page (instead of the “generic” page, which will be reformatted by the browser).  While this may seem like we are coming full-circle, or throwing away the gains of SPAs, the technique to do this better mirrors the architecture of SPAs.  Called <em>server-side rendering</em> (SSR), this technique allows the servers to use the same code that the browser uses to create individual pages to increase first-page load.  The key here is that the server doesn’t have to do much thinking: it simply uses the same techniques as the browser to generate a specific page.  This kind of SSR is usually done to enhance first-page loading experience, and to support search engine optimization.  It’s a more advanced topic that we won’t be covering here, but you should be aware of the practice.f1603.450</p>

<p>Now that we have some insight into how and why SPAs came into being, let’s look at the SPA frameworks that are available today.<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc3" id="idm45053580275304"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc2" id="idm45053580274568"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="SPA Technologies"><div class="sect1" id="idm45053580301256">
<h1>SPA Technologies</h1>

<p><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="technology choices" id="idm45053580272808"/>There are many choices for SPA technologies now:</p>
<dl>
<dt><a data-type="indexterm" data-primary="Facebook" data-secondary="React and" id="idm45053580270760"/><a data-type="indexterm" data-primary="React" data-secondary="about" id="idm45053580269752"/>React</dt>
<dd>
<p>For the moment, React seems to be the king of the SPA hill, though there are former greats (Angular) on one side of it, and ambitious usurpers (Vue) on the other side.  Sometime in 2018, React surpassed Angular in usage statics.  React is an open source library, but it started its life as a Facebook project, and Facebook is still an active contributor.  We’ll be using React for our Meadowlark Travel refactor.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Angular" id="idm45053580267096"/><a data-type="indexterm" data-primary="Google" data-secondary="Angular" id="idm45053580266392"/>Angular</dt>
<dd>
<p>By most accounts, the “original” SPA, Google’s Angular became
massively popular but was eventually dethroned by React.  In late 2014,
Angular announced version 2, which was a massive change from the first
version, and alienated many existing users and scared off new ones.  I
believe this shift (while probably necessary) contributed to React
eventually outpacing Angular.  Another reason is that Angular is a
much larger framework than React.  This has advantages and disadvantages:
Angular provides a much more complete architecture for building full
applications, and there’s always a clear “Angular way” to do things,
whereas frameworks like React and Vue leave a lot more up to personal
choice and creativity.  Regardless of which approach is better, bigger
frameworks are more ponderous and slow to evolve, which gave React an
innovation edge.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Vue.js" id="idm45053580263288"/>Vue.js</dt>
<dd>
<p>An upstart challenger to React, and the brainchild of a single developer, Evan You.  In a remarkably short time, it has gained an impressive following, and it is extremely well-liked by its adherents, but it is still far behind React’s runaway popularity.  I have had some experience with Vue, and I appreciate its clear documentation and lightweight approach, but I have come to prefer React’s architecture and philosophy.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Ember" id="idm45053580260856"/>Ember</dt>
<dd>
<p>Like Angular, Ember offers a comprehensive application framework.  There’s a large and active development community and, while not as innovative as React or Vue, it offers a lot of functionality and clarity.  I have found I far prefer lighter frameworks, and have stuck with React for this reason.</p>
</dd>
<dt><a data-type="indexterm" data-primary="Polymer" id="idm45053580258552"/>Polymer</dt>
<dd>
<p>I have no experience with Polymer, but it is backed by Google, which lends it credibility.  People seem to be curious about what Polymer is bringing to the table, but I haven’t seen a lot of people rushing to adopt it.</p>
</dd>
</dl>

<p>If you’re looking for a robust out-of-the-box framework, and you don’t mind coloring within the lines, you should consider Angular or Ember.  If you want room for creative expression and innovation, I recommend React or Vue.  I don’t yet know where Polymer fits in yet, but it’s worth keeping an eye on.</p>

<p>Now that we’ve seen the players, let’s move forward with React, and refactor Meadowlark Travel as an SPA!</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Creating a React App"><div class="sect1" id="idm45053580255368">
<h1>Creating a React App</h1>

<p><a data-type="indexterm" data-primary="create-react-app (CRA) utility" id="idm45053580011800"/><a data-type="indexterm" data-primary="React" data-secondary="creating app with" id="idm45053580011192"/>The best way to get started with a React app is to use the <code>create-react-app</code> (CRA) utility, which creates all of the boilerplate, developer tooling, and provides a minimal starter application that you can build on.  Furthermore, <code>create-react-app</code> will keep its configuration up-to-date so you can focus on building your application instead of on framework tooling.  That said, if you ever reach the point where you need to configure your tooling, you can “eject” your application: you’ll lose the ability to keep up-to-date with the latest CRA tooling, but you’ll have full control over all of the application configuration.</p>

<p>Unlike what we’ve been doing so far, where all of our application artifacts lived alongside our Express application, SPAs are best thought of as a completely separate, independent application.  To that end, we’ll have <em>two</em> application roots instead of one.  For clarity, when I’m referring to the directory where your Express application lives, I’ll say the <em>server root</em>, and for the directory where your React application lives, I’ll say the <em>client root</em>.  The <em>application root</em> is where both of those directories now live.</p>

<p>So go to your application root and create a directory called <em>server</em>; this
is where your Express server will live.  Don’t create a directory for your
client app; CRA will do that for us.</p>

<p><a data-type="indexterm" data-primary="Yarn" id="idm45053580004968"/>Before we run CRA, we should install <a href="https://yarnpkg.com">Yarn</a>.  Yarn is a package manager like npm…actually, yarn is mostly a drop-in replacement for npm.  It’s not mandatory for React development, but it is the de facto standard, and not using it would be swimming upstream.  There are some minor differences in usage between Yarn and npm, but the only one you’ll probably notice is that you run <code>yarn add</code> instead of <code>npm install</code>.  To install Yarn, simply follow <a href="http://bit.ly/2xHZ2Cx">the Yarn installation instructions</a>.</p>

<p>Once you’ve installed Yarn, run the following from your application root:</p>

<pre data-type="programlisting">yarn create react-app client</pre>

<p>Now go into your client directory and type <code>yarn start</code>. After a few seconds, you’ll see a new browser window pop up, with your React app running in it!</p>

<p>Go ahead and leave the terminal window running. CRA has really good support for “hot reloading,” so when you make changes in your source code, it will get built <em>very</em> quickly and the browser will automatically reload.  Once you get used to it, you won’t be able to live without it.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="React Basics"><div class="sect1" id="idm45053579998056">
<h1>React Basics</h1>

<p><a data-type="indexterm" data-primary="React" data-secondary="basics" id="ix_ch-16-single_page_applications-asciidoc4"/>React has excellent documentation, which I won’t re-create here.  So if you’re new to React, start with the <a href="http://bit.ly/36VdKUq">Intro to React</a> tutorial, and then the <a href="http://bit.ly/2KgT939">Main Concepts</a> guide.</p>

<p><a data-type="indexterm" data-primary="components, React" id="idm45053579992936"/>You’ll find that React is organized around <em>components</em>, which are the main building blocks of React.  Everything the user sees or interacts with is generally a component in React.  Let’s take a look at <em>client/src/App.js</em> (the contents of yours may differ slightly—CRA does change over time):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>
<code class="kr">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s1">'./logo.svg'</code><code class="p">;</code>
<code class="kr">import</code> <code class="s1">'./App.css'</code><code class="p">;</code>

<code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">header</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App-header"</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"App-logo"</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"logo"</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>
          <code class="nx">Edit</code> <code class="o">&lt;</code><code class="nx">code</code><code class="o">&gt;</code><code class="nx">src</code><code class="o">/</code><code class="nx">App</code><code class="p">.</code><code class="nx">js</code><code class="o">&lt;</code><code class="err">/code&gt; and save to reload.</code>
        <code class="o">&lt;</code><code class="err">/p&gt;</code>
        <code class="o">&lt;</code><code class="nx">a</code>
          <code class="nx">className</code><code class="o">=</code><code class="s2">"App-link"</code>
          <code class="nx">href</code><code class="o">=</code><code class="s2">"https://reactjs.org"</code>
          <code class="nx">target</code><code class="o">=</code><code class="s2">"_blank"</code>
          <code class="nx">rel</code><code class="o">=</code><code class="s2">"noopener noreferrer"</code>
        <code class="o">&gt;</code>
          <code class="nx">Learn</code> <code class="nx">React</code>
        <code class="o">&lt;</code><code class="err">/a&gt;</code>
      <code class="o">&lt;</code><code class="err">/header&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">);</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">App</code><code class="p">;</code></pre>

<p>One of the core concepts in React is that the UI is generated by <em>functions</em>.  And the simplest React component is just a function that returns HTML, as we see here.  You may be looking at this and thinking that it isn’t valid JavaScript; it looks like HTML is mixed in!  The reality is a little more complicated.  <a data-type="indexterm" data-primary="JSX" id="idm45053579987768"/>React, by default, enables a superset of JavaScript called JSX.  JSX allows you to write what looks like HTML.  It’s not <em>actually</em> HTML; it creates React elements, and the purpose of a React element is to (eventually) correspond to a DOM element.</p>

<p>At the end of the day, however, you can think of it as HTML.  Here, <code>App</code> is a function that will render the HTML corresponding to the JSX it returns.</p>

<p>A couple of things to note: since JSX is close to—but not exactly—HTML, there are some subtle differences.  You may have already noticed we use <code>className</code> instead of <code>class</code>, which is because <code>class</code> is a reserved word in JavaScript.</p>

<p>All you have to do to specify HTML is to start an HTML element anywhere an expression is expected.  You can also “go back to” JavaScript with curly braces within the HTML.  For example:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">value</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code><code class="o">*</code><code class="mi">6</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code>
<code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code><code class="nx">You</code> <code class="nx">rolled</code> <code class="nx">a</code> <code class="p">{</code><code class="nx">value</code><code class="p">}</code><code class="o">!&lt;</code><code class="err">/div&gt;</code></pre>

<p>In this example, the <code>&lt;div&gt;</code> starts the HTML, and the curly brackets around <code>value</code> drop back into JavaScript to provide the number stored in <code>value</code>.  We could have just as easily inlined the calculation:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code><code class="nx">You</code> <code class="nx">rolled</code> <code class="nx">a</code> <code class="p">{</code><code class="nb">Math</code><code class="p">.</code><code class="nx">floor</code><code class="p">(</code><code class="nb">Math</code><code class="p">.</code><code class="nx">random</code><code class="p">()</code><code class="o">*</code><code class="mi">6</code><code class="p">)</code> <code class="o">+</code> <code class="mi">1</code><code class="p">}</code><code class="o">!&lt;</code><code class="err">/div&gt;</code></pre>

<p>Any valid JavaScript expression can be contained within curly brackets within JSX—including other HTML elements!  A common use case of this is rendering lists:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">colors</code> <code class="o">=</code> <code class="p">[</code><code class="s1">'red'</code><code class="p">,</code> <code class="s1">'green'</code><code class="p">,</code> <code class="s1">'blue'</code><code class="p">]</code>
<code class="kr">const</code> <code class="nx">html</code> <code class="o">=</code> <code class="p">(</code>
  <code class="o">&lt;</code><code class="nx">ul</code><code class="o">&gt;</code>
    <code class="p">{</code><code class="nx">colors</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">color</code> <code class="o">=&gt;</code>
      <code class="o">&lt;</code><code class="nx">li</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">color</code><code class="p">}</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">color</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/li&gt;</code>
    <code class="p">)}</code>
  <code class="o">&lt;</code><code class="err">/ul&gt;</code>
<code class="p">)</code></pre>

<p>A couple of things to note about this example.  First, note that we mapped over our colors to return the <code>&lt;li&gt;</code> elements.  This is critical: JSX works entirely by evaluating <em>expressions</em>.  So the <code>&lt;ul&gt;</code> has to contain either an expression or an array of expressions.  If you changed the <code>map</code> to a <code>forEach</code>, you would find that the <code>&lt;li&gt;</code> elements would not get rendered.  Second, note that the <code>&lt;li&gt;</code> elements receive a property <code>key</code>: this is a performance concession.  For React to know when to re-render the elements in an array, it needs a unique key for each element.  Since our array elements are unique, we just used that value, but commonly you would use a an ID or—if nothing else is available—the index of the item in the array.</p>

<p>I encourage you to play around with some of these examples in the JSX in <em>client/src/App.js</em> before moving on. If you’ve left <code>yarn start</code> running, every time you save your changes, they will be automatically reflected in the browser, which should speed up your learning cycle.</p>

<p><a data-type="indexterm" data-primary="state" data-secondary="React and" id="idm45053579689976"/>We have one more topic to touch on before we move on from React basics, and that concept is <em>state</em>.  Every component can have its own state, which basically means that “data associated with the component that can change.”  A shopping cart is a great example of this.  A shopping cart component’s state would contain a list of items; as you add and remove items from the cart, the component’s state is changing.  It may seem like an overly simple or obvious concept, but most of the details of making a React application come down to effectively designing and managing the state of your components.  We’ll see an example of state when we tackle the Vacations page.</p>

<p>Let’s move on and create our Meadowlark Travel home page.</p>








<section data-type="sect2" data-pdf-bookmark="The Home Page"><div class="sect2" id="idm45053579687352">
<h2>The Home Page</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="homepage" id="idm45053579685912"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="homepage" id="idm45053579684936"/>Recall from our Handlebars views that we had a main “layout” file that established the primary look and feel of our website.  Let’s start by focusing on what’s in the <code>&lt;body&gt;</code> tag (except the scripts):</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;div</code> <code class="na">class=</code><code class="s">"container"</code><code class="nt">&gt;</code>
  <code class="nt">&lt;header&gt;</code>
    <code class="nt">&lt;h1&gt;</code>Meadowlark Travel<code class="nt">&lt;/h1&gt;</code>
    <code class="nt">&lt;a</code> <code class="na">href=</code><code class="s">"/"</code><code class="nt">&gt;&lt;img</code> <code class="na">src=</code><code class="s">"/img/logo.png"</code> <code class="na">alt=</code><code class="s">"Meadowlark Travel Logo"</code><code class="nt">&gt;&lt;/a&gt;</code>
  <code class="nt">&lt;/header&gt;</code>
  {{{body}}}
<code class="nt">&lt;/div&gt;</code></pre>

<p>This will be pretty easy to refactor into a React component.  First, we copy our own logo into the <em>client/src</em> directory.  Why not the <em>public</em> directory?  For small or commonly used graphical items, it may be more efficient to inline them in the JavaScript bundle, and the bundler that you got with CRA will make an intelligent choice about that.  The example app you got from CRA placed its logo directly in the <em>client/src</em> directory, but I still like collecting image assets in a subdirectory, so put our logo (<em>logo.png</em>) in <em>client/src/img/logo.png</em>.</p>

<p>The only other tricky bit is what to do about <code>{{{body}}}</code>?  In our views, this is where another view would be rendered—the content for the specific page you’re on.  We can replicate the same basic idea in React.  Since all content is rendered in the form of components, we’re just going to render another component here.  We’ll start with an empty Home component and build that out in a moment:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code>
<code class="kr">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s1">'./img/logo.png'</code>
<code class="kr">import</code> <code class="s1">'./App.css'</code>

<code class="kd">function</code> <code class="nx">Home</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">coming</code> <code class="nx">soon</code><code class="o">&lt;</code><code class="err">/i&gt;)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"container"</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">header</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Meadowlark</code> <code class="nx">Travel</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
        <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Meadowlark Travel Logo"</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="err">/header&gt;</code>
      <code class="o">&lt;</code><code class="nx">Home</code> <code class="o">/&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">App</code></pre>

<p><a data-type="indexterm" data-primary="CSS" data-secondary="React and" id="idm45053579659928"/>We’re using the same approach that the sample app did for CSS: we can simply create a CSS file and import it.  So we can edit that file and apply whatever styles we need to.  We’ll keep things basic for this example, though nothing fundamental has changed in the way we style HTML with CSS, so we still have all the tools we’re used to.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-type="indexterm" data-primary="create-react-app (CRA) utility" id="idm45053579514104"/><a data-type="indexterm" data-primary="linting" data-secondary="CRA and" id="idm45053579513432"/>CRA sets up linting for you, and as you progress through this chapter, you’ll probably see warnings (both in the CRA terminal output and in your browser’s JavaScript console).  This is only because we’re adding things incrementally; by the time we reach the end of this chapter, there should be no more warnings…if there are, make sure you haven’t missed a step!  You can also check the companion repository.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Routing"><div class="sect2" id="idm45053579658952">
<h2>Routing</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="routing" id="ix_ch-16-single_page_applications-asciidoc5"/><a data-type="indexterm" data-primary="routing" data-secondary="React apps" id="ix_ch-16-single_page_applications-asciidoc6"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="routing" id="ix_ch-16-single_page_applications-asciidoc7"/>The core concept of routing we learned about in <a data-type="xref" href="ch14.xhtml#ch_routing">Chapter 14</a> hasn’t
changed: we’re still using the URL path to determine what part of the
interface the user is seeing.  The difference is that it’s up to the client
application to handle that.  Changing the UI based on the route is the
client app’s responsibility: if the navigation requires new or updated data
from the server, that’s fine, and it’s up to the client app to request
that from the server.</p>

<p>There are a lot of options for—and a lot of strong opinions about—routing in React apps.  <a data-type="indexterm" data-primary="React Router library" id="ix_ch-16-single_page_applications-asciidoc8"/>However, there is a dominant library for routing: <a href="http://bit.ly/32GvAXK">React Router</a>.  There’s quite a lot I don’t like about React Router, but it’s so common that you’re bound to come across it.  Furthermore, it is a good option to get something basic up and running, and for those two reasons, we’ll be using it here.</p>

<p>We’ll get started by installing the DOM version of React Router (there’s also a version for React Native, for mobile development):</p>

<pre data-type="programlisting">yarn add react-router-dom</pre>

<p>Now we’ll hook up the router, and add an About and a Not Found page.  We’ll also link the site logo back to the home page:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code>
<code class="kr">import</code> <code class="p">{</code>
  <code class="nx">BrowserRouter</code> <code class="nx">as</code> <code class="nx">Router</code><code class="p">,</code>
  <code class="nx">Switch</code><code class="p">,</code>
  <code class="nx">Route</code><code class="p">,</code>
  <code class="nx">Link</code>
<code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-router-dom'</code>
<code class="kr">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s1">'./img/logo.png'</code>
<code class="kr">import</code> <code class="s1">'./App.css'</code>

<code class="kd">function</code> <code class="nx">Home</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Welcome</code> <code class="nx">to</code> <code class="nx">Meadowlark</code> <code class="nx">Travel</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>
      <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Check</code> <code class="nx">out</code> <code class="nx">our</code> <code class="s2">"&lt;Link to="</code><code class="o">/</code><code class="nx">about</code><code class="s2">"&gt;About&lt;/Link&gt;"</code> <code class="nx">page</code><code class="o">!&lt;</code><code class="err">/p&gt;</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">About</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">coming</code> <code class="nx">soon</code><code class="o">&lt;</code><code class="err">/i&gt;)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">NotFound</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code><code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">Not</code> <code class="nx">Found</code><code class="o">&lt;</code><code class="err">/i&gt;)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">App</code><code class="p">()</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">Router</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"container"</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="nx">header</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">h1</code><code class="o">&gt;</code><code class="nx">Meadowlark</code> <code class="nx">Travel</code><code class="o">&lt;</code><code class="err">/h1&gt;</code>
          <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="s2">"/"</code><code class="o">&gt;&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Meadowlark Travel Logo"</code> <code class="o">/&gt;&lt;</code><code class="err">/Link&gt;</code>
        <code class="o">&lt;</code><code class="err">/header&gt;</code>
        <code class="o">&lt;</code><code class="nx">Switch</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/"</code> <code class="nx">exact</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Home</code><code class="p">}</code> <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/about"</code> <code class="nx">exact</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">About</code><code class="p">}</code> <code class="o">/&gt;</code>
          <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">NotFound</code><code class="p">}</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/Switch&gt;</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="o">&lt;</code><code class="err">/Router&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">App</code></pre>

<p>The first thing to notice is that we’re wrapping our entire application in a <code>&lt;Router&gt;</code> component.  This is what enables the routing, as you might expect.  Inside <code>&lt;Router&gt;</code>, we can use <code>&lt;Route&gt;</code> to conditionally render a component based on the URL path.  We’ve placed our content routes inside a <code>&lt;Switch&gt;</code> component: this ensures that only <em>one</em> of the components contained therein gets rendered.</p>

<p>There are some subtle differences between the routing we’ve done with Express and React Router.  In Express, we would render the page according to the first successful match (or the 404 page if one couldn’t be found).  With React Router, the path is simply a “hint” to determine what combination of components should display.  In this way, it’s more flexible than routing with Express.  Because of this, React Router routes behave by default as if they have an asterisk (<code>*</code>) at the end.  That is, the route <code>/</code> would, by default, match <em>every</em> page (since they all start with a forward slash).  Because of this, we use the <code>exact</code> property to make this route behave more like an Express route.  Similarly, without the <code>exact</code> property, the <code>/about</code> route would also match <code>/about/contact</code>, which is probably not what we want.  For your main content routing, it’s likely that you’ll want all of your routes (except the Not Found route) to have <code>exact</code>. Otherwise, you will have to make sure to arrange them correctly within the <code>&lt;Switch&gt;</code> so they match in the correct order.</p>

<p>The second thing to notice is the use of <code>&lt;Link&gt;</code>.  You might be wondering why we don’t just use <code>&lt;a&gt;</code> tags.  The problem with <code>&lt;a&gt;</code> tags is that—without some extra work—the browser will dutifully treat them as “going elsewhere” even if it’s on the same site, and it will result in a new HTTP request to the server…and the HTML and the CSS will be downloaded again, defeating the SPA agenda.  It will <em>work</em> in the sense that when the page loads, React Router will do the right thing, but it won’t be as fast or efficient, invoking unnecessary network requests.  Seeing the difference is actually an instructive exercise that should drive home the nature of SPAs.  As an experiment, create two navigation elements, one using <code>&lt;Link&gt;</code> and another using <code>&lt;a&gt;</code>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="s2">"/"</code><code class="o">&gt;</code><code class="nx">Home</code> <code class="p">(</code><code class="nx">SPA</code><code class="p">)</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>
<code class="o">&lt;</code><code class="nx">a</code> <code class="nx">href</code><code class="o">=</code><code class="s2">"/"</code><code class="o">&gt;</code><code class="nx">Home</code> <code class="p">(</code><code class="nx">reload</code><code class="p">)</code><code class="o">&lt;</code><code class="err">/Link&gt;</code></pre>

<p>Then open your dev tools, open the Network tab, clear the traffic, and click “Preserve log” (on Chrome).  Now click the “Home (SPA)” link and notice there’s no network traffic at all.  Click the “Home (reload)” link and observe the network traffic.  And that, in a nutshell, is the nature of an SPA<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc8" id="idm45053579229640"/>.<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc7" id="idm45053579228840"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc6" id="idm45053579228168"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc5" id="idm45053579227496"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Vacations Page—Visual Design"><div class="sect2" id="idm45053579511208">
<h2>Vacations Page—Visual Design</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="visual design for vacations page example" id="idm45053579220088"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="visual design" id="idm45053579219144"/>So far we’ve just been building a pure frontend application…so where does Express come in?  Our server is still the single source of truth.  In particular, it maintains the database of vacations that we want to display on our site.  Fortunately, we’ve already done most of the work in <a data-type="xref" href="ch15.xhtml#ch_rest_apis_and_json">Chapter 15</a>: we exposed an API that will return our vacations in JSON format, ready for use in a React application.</p>

<p>Before we hook those two things up, however, let’s go ahead and build our Vacations page. There won’t be any vacations to render, but let’s not let that stop us.</p>

<p>In the previous section, we included all of the content pages in <em>client/src/App.js</em>, which is generally considered poor practice: its more conventional for each component to live in its own file.  So we’ll take the time to break our <code>Vacations</code> component out into its own component.  Create the file <em>client/src/Vacations.js</em>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code><code class="p">,</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code>
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Link</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-router-dom'</code>

<code class="kd">function</code> <code class="nx">Vacations</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">vacations</code><code class="p">,</code> <code class="nx">setVacations</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">([])</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Vacations</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"vacations"</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">vacations</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">vacation</code> <code class="o">=&gt;</code>
          <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">sku</code><code class="p">}</code><code class="o">&gt;</code>
            <code class="o">&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">name</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/h3&gt;</code>
            <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">description</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/p&gt;</code>
            <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"price"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">price</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/span&gt;</code>
          <code class="o">&lt;</code><code class="err">/div&gt;</code>
        <code class="p">)}</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">Vacations</code></pre>

<p>What we have so far is pretty simple: we’re just returning a <code>&lt;div&gt;</code> that contains additional <code>&lt;div&gt;</code> elements, each of which represents a vacation.  So where is this <code>vacations</code> variable coming from?  <a data-type="indexterm" data-primary="hooks, React" id="idm45053579048392"/><a data-type="indexterm" data-primary="React hooks" id="idm45053579047864"/>In this example, we’re using a newer feature of React, called <em>React hooks</em>.  Prior to hooks, if a component wanted to have its own state (in this case, a list of vacations), you had to use a class implementation.  Hooks enable us to have function-based components that have their own state.  In our <code>Vacations</code> function, we call <code>useState</code> to set up our state.  Note we pass an empty array to <code>useState</code>: that will be the initial value of <code>vacations</code> in state (we’ll discuss how we populate that shortly).  What <code>setState</code> returns is an array containing the state value itself (<code>vacations</code>) and a way to update the state (<code>setVacations</code>).</p>

<p>You may wonder why we can’t modify <code>vacations</code> directly: it’s just an array, so couldn’t we call <code>push</code> to add vacations to it?  We could, but this would be defeating the very purpose of React’s state management system, which ensures consistency, performance, and communication between components.</p>

<p>You may also be wondering about what looks like an empty component (<code>&lt;&gt;…&lt;/&gt;</code>) surrounding our vacations.  This is called a <a href="http://bit.ly/2ryneVj"><em>fragment</em></a>.  The fragment is necessary because every component must render a single element.  In our case, we have two elements, the <code>&lt;h2&gt;</code> and the <code>&lt;div&gt;</code>.  The fragment simply provides a “transparent” root element in which to contain these two elements so we can render a single element.</p>

<p>Let’s add our <code>Vacations</code> component to our application, even though there aren’t yet any vacations to show.  In <em>client/src/App.js</em>, first import your vacations page:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">Vacations</code> <code class="nx">from</code> <code class="s1">'./Vacations'</code></pre>

<p>Then all we have to do is create a route for it in our router’s <code>&lt;Switch&gt;</code> component:</p>

<pre data-type="programlisting" data-code-language="js"><code class="o">&lt;</code><code class="nx">Switch</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/"</code> <code class="nx">exact</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Home</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/about"</code> <code class="nx">exact</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">About</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/vacations"</code> <code class="nx">exact</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Vacations</code><code class="p">}</code> <code class="o">/&gt;</code>
  <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">NotFound</code><code class="p">}</code> <code class="o">/&gt;</code>
<code class="o">&lt;</code><code class="err">/Switch&gt;</code></pre>

<p>Go ahead and save that; your application should automatically reload, and you can navigate to your <em>/vacations</em> page, though there isn’t much interesting to see yet.  Now that we have most of the client infrastructure in place, let’s turn our attention to integrating with Express.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Vacations Page—Server Integration"><div class="sect2" id="idm45053579221032">
<h2>Vacations Page—Server Integration</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="server integration for vacations page" id="ix_ch-16-single_page_applications-asciidoc9"/><a data-type="indexterm" data-primary="server integration" id="ix_ch-16-single_page_applications-asciidoc10"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="server integration" id="ix_ch-16-single_page_applications-asciidoc11"/>We’ve already done most of the work necessary for the Vacations page; we have an API endpoint that gets vacations from the database and returns them in JSON format.  Now we have to figure out how to get the server and the client communicating.</p>

<p>We can start with our work from <a data-type="xref" href="ch15.xhtml#ch_rest_apis_and_json">Chapter 15</a>; we don’t need to add anything to it, but we can take some things away that we no longer need.  We can remove the following:</p>

<ul>
<li>
<p>Handlebars and views support (we’ll leave the static middleware, though, for reasons we’ll see later).</p>
</li>
<li>
<p>Cookies and sessions (our SPA may still use cookies, but it no longer needs the server’s help here…and we think about sessions in a completely different way).</p>
</li>
<li>
<p>All routes that render a view (we obviously keep the API routes, however).</p>
</li>
</ul>

<p>This leaves us with a much simplified server.  So what do we do with it
now?  The first thing we have to do is address the fact that we’ve been
using port 3000, and the CRA development server also uses port 3000 by
default.  We could change either, so I’m going to arbitrarily suggest
changing the Express port.  I usually use 3033—just because I like the
sound of that number.  You’ll recall that we set the default port in our
<em>meadowlark.js</em>, so we just need to change it:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">const</code> <code class="nx">port</code> <code class="o">=</code> <code class="nx">process</code><code class="p">.</code><code class="nx">env</code><code class="p">.</code><code class="nx">PORT</code> <code class="o">||</code> <code class="mi">3033</code></pre>

<p>We could, of course, use an environment variable to control it, but since we’re going to frequently use it together with our SPA dev server, we might as well change the code.</p>

<p>Now that both servers are running, we can communicate between them.  But how?  In our React app, we could do something like this:</p>

<pre data-type="programlisting" data-code-language="js"><code class="nx">fetch</code><code class="p">(</code><code class="s1">'http://localhost:3033/api/vacations'</code><code class="p">)</code></pre>

<p>The problem with that approach is that we’re going to be making requests like that all over our application…and now we’re embedding <code><a href="http://localhost:3033"><em class="hyperlink">http://localhost:3033</em></a></code> all over the place…which isn’t going to work in production, and it may not work on your colleague’s computer because maybe it needs to use different ports, and maybe the port needs to be different for the testing servers…and on and on.  Using this approach is asking for a configuration headache.  Yes, you could store the base URL as a variable that you use everywhere, but there’s a better way.</p>

<p>In the ideal world, from your application’s perspective, everything’s
hosted from the same place: it’s the same protocol, host, and port to get
the HTML, the static assets, and the API.  It simplifies a lot of things
and ensures consistency in your source code.  If everything’s coming from
the same place, you can simply omit the protocol, host and port, and just
call <code>fetch(<em>/api/vacations</em>)</code>.  It’s a nice approach, and fortunately
very easy to do!</p>

<p>The configuration for CRA comes with <em>proxy</em> support, allowing you to pass web requests on to your API.  Edit your <em>client/package.json</em> file, and add the following:</p>

<pre data-type="programlisting" data-code-language="js"><code class="s2">"proxy"</code><code class="o">:</code> <code class="s2">"http://localhost:3033"</code><code class="p">,</code></pre>

<p>It doesn’t matter where you add it. I usually put it between <code>"private"</code> and <code>"dependencies"</code> just because I like to see it high in the file.  Now—as long as your Express server is running on port 3033—your CRA development server will pass API requests through to your Express server.</p>

<p>Now that that configuration is in place, let’s use an <em>effect</em> (another React hook) to fetch and update vacation data.  Here’s the entire <code>Vacations</code> component with the <code>useEffect</code> hook:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">function</code> <code class="nx">Vacations</code><code class="p">()</code> <code class="p">{</code>
  <code class="c1">// set up state</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">vacations</code><code class="p">,</code> <code class="nx">setVacations</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">([])</code>

  <code class="c1">// fetch initial data</code>
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/vacations'</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">res</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setVacations</code><code class="p">)</code>
  <code class="p">},</code> <code class="p">[])</code>

  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Vacations</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"vacations"</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">vacations</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">vacation</code> <code class="o">=&gt;</code>
          <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">sku</code><code class="p">}</code><code class="o">&gt;</code>
            <code class="o">&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">name</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/h3&gt;</code>
            <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">description</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/p&gt;</code>
            <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"price"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">price</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/span&gt;</code>
          <code class="o">&lt;</code><code class="err">/div&gt;</code>
        <code class="p">)}</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">)</code>
<code class="p">}</code></pre>

<p>As before, <code>useState</code> is configuring our component state to have a <code>vacations</code> array, with a companion setter.  Now we’ve added <code>useEffect</code>, which calls our API to retrieve vacations, and then calls that setter asynchronously.  Note that we pass in an empty array as the second argument to <code>useEffect</code>; this is a signal to React that this effect should be run only once, when the component is mounted.  <a data-type="indexterm" data-primary="hooks, React" id="idm45053578641416"/><a data-type="indexterm" data-primary="React hooks" id="idm45053578640712"/>On the surface, that may seem like an odd way to signal that, but once you learn more about hooks, you’ll see that it’s actually quite consistent.  To learn more about hooks, see the <a href="http://bit.ly/34MGSeK">React hooks documentation</a>.</p>

<p>Hooks are relatively new—they were added in version 16.8 in February 2019—so even if you have some experience with React, you may not be familiar with hooks.  I firmly believe that hooks are an excellent innovation in the React architecture, and, while they may seem alien at first, you’ll find that they actually simplify your components and reduce some of the trickier state-related mistakes that people commonly make.</p>

<p>Now that we’ve learned how to retrieve data from the server, let’s turn our attention to sending information the other way.<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc11" id="idm45053578637752"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc10" id="idm45053578636952"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc9" id="idm45053578636248"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sending Information to the Server"><div class="sect2" id="idm45053578904776">
<h2>Sending Information to the Server</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="sending information to the server" id="ix_ch-16-single_page_applications-asciidoc12"/><a data-type="indexterm" data-primary="server, sending information to" id="ix_ch-16-single_page_applications-asciidoc13"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="sending information to the server" id="ix_ch-16-single_page_applications-asciidoc14"/>We already have an API endpoint to make changes on the server; we have an endpoint to be emailed when is back in season.  Let’s go ahead and modify our <code>Vacations</code> component to show a sign-up form for vacations that are out of season.  In true React fashion, we’ll create two new components: we’ll break out the individual vacation view into <code>Vacation</code> and a <code>NotifyWhenInSeason</code> component.  We could do it all in one, but the recommended approach to React development is to have many specific-purpose components instead of gigantic multipurpose components (for the sake of brevity, however, we are going to stop short of putting these components in their own files: I’ll leave that as a reader’s exercise):</p>

<pre data-type="programlisting" data-code-language="js"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code><code class="p">,</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code>

<code class="kd">function</code> <code class="nx">NotifyWhenInSeason</code><code class="p">({</code> <code class="nx">sku</code> <code class="p">})</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">Notify</code> <code class="nx">me</code> <code class="nx">when</code> <code class="k">this</code> <code class="nx">vacation</code> <code class="nx">is</code> <code class="k">in</code> <code class="nx">season</code><code class="o">:&lt;</code><code class="err">/i&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code> <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"(your email)"</code> <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">button</code><code class="o">&gt;</code><code class="nx">OK</code><code class="o">&lt;</code><code class="err">/button&gt;</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">Vacation</code><code class="p">({</code> <code class="nx">vacation</code> <code class="p">})</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">sku</code><code class="p">}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">h3</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">name</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/h3&gt;</code>
      <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">description</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/p&gt;</code>
      <code class="o">&lt;</code><code class="nx">span</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"price"</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">price</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/span&gt;</code>
      <code class="p">{</code><code class="o">!</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">inSeason</code> <code class="o">&amp;&amp;</code>
        <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">This</code> <code class="nx">vacation</code> <code class="nx">is</code> <code class="nx">not</code> <code class="nx">currently</code> <code class="k">in</code> <code class="nx">season</code><code class="p">.</code><code class="o">&lt;</code><code class="err">/i&gt;&lt;/p&gt;</code>
          <code class="o">&lt;</code><code class="nx">NotifyWhenInSeason</code> <code class="nx">sky</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">sku</code><code class="p">}</code> <code class="o">/&gt;</code>
        <code class="o">&lt;</code><code class="err">/div&gt;</code>
      <code class="p">}</code>
    <code class="o">&lt;</code><code class="err">/div&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">Vacations</code><code class="p">()</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">vacations</code><code class="p">,</code> <code class="nx">setVacations</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">([])</code>
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/vacations'</code><code class="p">)</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">res</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">setVacations</code><code class="p">)</code>
  <code class="p">},</code> <code class="p">[])</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;&gt;</code>
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Vacations</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>
      <code class="o">&lt;</code><code class="nx">div</code> <code class="nx">className</code><code class="o">=</code><code class="s2">"vacations"</code><code class="o">&gt;</code>
        <code class="p">{</code><code class="nx">vacations</code><code class="p">.</code><code class="nx">map</code><code class="p">(</code><code class="nx">vacation</code> <code class="o">=&gt;</code>
          <code class="o">&lt;</code><code class="nx">Vacation</code> <code class="nx">key</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">.</code><code class="nx">sku</code><code class="p">}</code> <code class="nx">vacation</code><code class="o">=</code><code class="p">{</code><code class="nx">vacation</code><code class="p">}</code> <code class="o">/&gt;</code>
        <code class="p">)}</code>
      <code class="o">&lt;</code><code class="err">/div&gt;</code>
    <code class="o">&lt;</code><code class="err">/&gt;</code>
  <code class="p">)</code>
<code class="p">}</code>

<code class="kr">export</code> <code class="k">default</code> <code class="nx">Vacations</code></pre>

<p>Now, if you have any vacations that have <code>inSeason</code> as <code>false</code> (and you will, unless you changed your database or initialization scripts), you will update the form.  Now let’s hook up our button to make the API call.  Modify <code>NotifyWhenInSeason</code>:</p>

<pre data-type="programlisting" data-code-language="js"><code class="kd">function</code> <code class="nx">NotifyWhenInSeason</code><code class="p">({</code> <code class="nx">sku</code> <code class="p">})</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">registeredEmail</code><code class="p">,</code> <code class="nx">setRegisteredEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code>
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">(</code><code class="s1">''</code><code class="p">)</code>
  <code class="kd">function</code> <code class="nx">onSubmit</code><code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="sb">`/api/vacation/</code><code class="si">${</code><code class="nx">sku</code><code class="si">}</code><code class="sb">/notify-when-in-season`</code><code class="p">,</code> <code class="p">{</code>
        <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>
        <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">email</code> <code class="p">}),</code>
        <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code> <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json'</code> <code class="p">},</code>
      <code class="p">})</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">res</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="k">if</code><code class="p">(</code><code class="nx">res</code><code class="p">.</code><code class="nx">status</code> <code class="o">&lt;</code> <code class="mi">200</code> <code class="o">||</code> <code class="nx">res</code><code class="p">.</code><code class="nx">status</code> <code class="o">&gt;</code> <code class="mi">299</code><code class="p">)</code>
          <code class="k">return</code> <code class="nx">alert</code><code class="p">(</code><code class="s1">'We had a problem processing this...please try again.'</code><code class="p">)</code>
        <code class="nx">setRegisteredEmail</code><code class="p">(</code><code class="nx">email</code><code class="p">)</code>
      <code class="p">})</code>
    <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">()</code>
  <code class="p">}</code>
  <code class="k">if</code><code class="p">(</code><code class="nx">registeredEmail</code><code class="p">)</code> <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">You</code> <code class="nx">will</code> <code class="nx">be</code> <code class="nx">notified</code> <code class="nx">at</code> <code class="p">{</code><code class="nx">registeredEmail</code><code class="p">}</code> <code class="nx">when</code>
    <code class="k">this</code> <code class="nx">vacation</code> <code class="nx">is</code> <code class="nx">back</code> <code class="k">in</code> <code class="nx">season</code><code class="o">!&lt;</code><code class="err">/i&gt;</code>
  <code class="p">)</code>
  <code class="k">return</code> <code class="p">(</code>
    <code class="o">&lt;</code><code class="nx">form</code> <code class="nx">onSubmit</code><code class="o">=</code><code class="p">{</code><code class="nx">onSubmit</code><code class="p">}</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="nx">i</code><code class="o">&gt;</code><code class="nx">Notify</code> <code class="nx">me</code> <code class="nx">when</code> <code class="k">this</code> <code class="nx">vacation</code> <code class="nx">is</code> <code class="k">in</code> <code class="nx">season</code><code class="o">:&lt;</code><code class="err">/i&gt;</code>
      <code class="o">&lt;</code><code class="nx">input</code>
        <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code>
        <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"(your email)"</code>
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>
        <code class="nx">onChange</code><code class="o">=</code><code class="p">{({</code> <code class="nx">target</code><code class="o">:</code> <code class="p">{</code> <code class="nx">value</code> <code class="p">}</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">value</code><code class="p">)}</code>
        <code class="o">/&gt;</code>
      <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">OK</code><code class="o">&lt;</code><code class="err">/button&gt;</code>
    <code class="o">&lt;</code><code class="err">/form&gt;</code>
  <code class="p">)</code>
<code class="p">}</code></pre>

<p>We’re choosing here to have the component track two different values: the email address as the user types it, and the final value after they press OK.  <a data-type="indexterm" data-primary="controlled components" id="idm45053578441144"/>The former is a technique known as <em>controlled components</em>, and you can read more about it on the <a href="http://bit.ly/2X9P9qh">React forms documentation</a>.  The latter we’re keeping track of so we can know when the user took the action of pressing OK so we can change the UI accordingly.  We could have also had a simple boolean “registered,” but this allows our UI to remind the user what email they registered with.</p>

<p>We also had to do a little more work with our API communication: we had to specify the method (<code>POST</code>), encode the body as JSON, and specify the content type.</p>

<p>Note that we make a decision about which UI to return.  If the user has
already registered, we return a simple message, and if they haven’t, we
render the form.  This is a very common pattern in React.</p>

<p>Whew!  It seems like a lot of work for that small bit of
functionality…and pretty crude functionality at that.  Our error-handling
if there’s something wrong with the API call is functional, but less than
user-friendly, and while the component will remember which vacations we’ve
signed up for, it will do so only while we’re on this page. If we navigate
away and come back, we’ll see the form again.</p>

<p>There are steps we could take to make this code a little more palatable.  For starters, we might write an API wrapper that will handle the messy details of encoding input and determining errors; that will certainly pay dividends as we use more and more API endpoints.  There are also many popular form-processing frameworks for React that go a long way to ease the burden of form processing.</p>

<p>Addressing the problem of “remembering” what vacations the user has signed up for is a little trickier.  What would really serve us would be a way for our vacation objects to have that information available (whether or not the user had registered).  However, our special-purpose component doesn’t know anything about the vacation; it’s only given the SKU.  In the next section, we’ll talk about <em>state management</em>, which points to a solution to that problem.<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc14" id="idm45053578049576"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc13" id="idm45053578048776"/><a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc12" id="idm45053578048072"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="State Management"><div class="sect2" id="idm45053578634952">
<h2>State Management</h2>

<p><a data-type="indexterm" data-primary="React" data-secondary="state management" id="idm45053578045960"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="state management" id="idm45053578044760"/><a data-type="indexterm" data-primary="state" data-secondary="management" id="idm45053578043848"/>Most of the architectural work that goes into planning and designing a React application is focused around state management—and not usually the state management of single components, but how they share and coordinate state.  Our sample application does share some state: the <code>Vacations</code> component passes down a vacation object to the <code>Vacation</code> component, and the <code>Vacation</code> component in turn passes down the vacation’s SKU to the <code>NotifyWhenInSeason</code> listener.  But so far, our information is only flowing <em>down</em> the tree; what happens when information needs to go back <em>up</em>?</p>

<p>The most common approach is to pass functions around that are responsible for updating state.  For example, the <code>Vacations</code> component might have a function for modifying a vacation, which it could pass to <code>Vacation</code>, which could in turn be passed down to <code>NotifyWhenInSeason</code>.  When <code>NotifyWhenInSeason</code> calls it to modify the vacation, <code>Vacations</code>, at the top of the tree, would recognize that things had changed, which would cause it to re-render, which in turns causes all of its descendants to re-render.</p>

<p>It sounds exhausting and complicated, and sometimes it can be, but there are techniques that can help.  They are so varied and sometimes complex that we can’t completely cover them here (nor is this a book about React), but I can point you to some further reading:</p>
<dl>
<dt><a href="https://redux.js.org">Redux</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Redux" id="idm45053578034456"/>Redux is usually the first thing that comes to people’s minds when they think about comprehensive state management for React applications.  It was one of the first formalized state management architectures, and it is still incredibly popular.  In concept, it is extremely simple, and it is still the state management framework that I prefer.  Even if you don’t end up choosing Redux, I recommend you watch the <a href="https://egghead.io/courses/getting-started-with-redux">free tutorial videos</a> by its creator, Dan Abramov.</p>
</dd>
<dt><a href="https://mobx.js.org">MobX</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="MobX" id="idm45053578030856"/>MobX came along after Redux. It has gained an impressive following in a short amount of time and is probably the second most popular state container, behind Redux.  MobX can certainly result in code that seems easier to write, but I still feel that Redux has an edge in providing a good framework as your application scales, even with its increased boilerplate.</p>
</dd>
<dt><a href="https://www.apollographql.com">Apollo</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Apollo" id="idm45053578028072"/>Apollo isn’t a state management library <em>per se</em>, but the way its used often takes the place of one.  It’s essentially a frontend interface for <a href="https://graphql.org">GraphQL</a>--an alternative to REST APIs—that offers a lot of integration with React.  If you’re using GraphQL (or interested in it), it’s definitely worth looking into.</p>
</dd>
<dt><a href="https://reactjs.org/docs/context.html">React Context</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Context API (React)" id="idm45053578024280"/><a data-type="indexterm" data-primary="React Context" id="idm45053578023576"/>React itself has gotten into the game by providing the Context API, now built into React.  It accomplishes some of the same things that Redux does with less boilerplate. However, I feel that React Context is less robust and that Redux is a better choice for applications as they grow.</p>
</dd>
</dl>

<p>When you start out with React, you can essentially ignore the complexities of state management across your application, but pretty quickly you’ll realize the need for a more organized way to manage state.  When you reach that point, you’ll want to look into some of these options and pick one that resonates with you.</p>
</div></section>













<section data-type="sect2" class="pagebreak-before" data-pdf-bookmark="Deployment Options"><div class="sect2" id="idm45053578021496">
<h2>Deployment Options</h2>

<p><a data-type="indexterm" data-primary="deployment" data-secondary="single-page applications" id="idm45053578019784"/><a data-type="indexterm" data-primary="React" data-secondary="SPA deployment options" id="idm45053578018840"/><a data-type="indexterm" data-primary="single-page applications (SPAs)" data-secondary="deployment options" id="idm45053578017896"/>So far, we’ve been using CRA’s built-in development server—which really is the best choice for development, and I recommend sticking with it.  However, when it comes time for deployment, it’s not a suitable choice.  Fortunately, CRA comes loaded with a build script that creates a bundle optimized for production, and then you have many options.  When you’re ready to create a deployment bundle, simply run <code>yarn build</code>, and a <em>build</em> directory will be created.  All of the assets in the <em>build</em> directory are static and can be deployed anywhere.</p>

<p><a data-type="indexterm" data-primary="Amazon" data-secondary="S3" id="idm45053578014824"/><a data-type="indexterm" data-primary="S3" id="idm45053578013848"/>My current deployment of choice is to put the CRA build in an AWS S3 bucket with <a href="https://amzn.to/3736fuT">Static Website Hosting</a> turned on.  This is far from the only option: every major cloud provider and CDN offers something similar.</p>

<p>In this configuration, we have to create routing so that the API calls are routed to your Express server and your static bundle is served from a CDN.  <a data-type="indexterm" data-primary="Amazon" data-secondary="AWS CloudFront" id="idm45053578011688"/><a data-type="indexterm" data-primary="AWS CloudFront" id="idm45053578010712"/><a data-type="indexterm" data-primary="CloudFront" id="idm45053578010040"/>For my AWS deployments, I use <a href="https://amzn.to/2KglZRb">AWS CloudFront</a> to perform this routing; the static assets are served from the aforementioned S3 bucket, and the API requests are routed to either an Express server on an EC2 instance, or on a Lambda.</p>

<p>Another option is to let Express do the whole thing.  This has the advantage of being able to consolidate your entire application onto a single server, which makes for a pretty simple deployment, and makes management easy.  It may not be ideal for scalability or performance, but it’s a valid choice for small applications.</p>

<p>To serve your application entirely from Express, simply take contents of the <em>build</em> directory that was created when you ran <code>yarn build</code>, and copy it into the <em>public</em> directory in your Express application.  As long as you have your static middleware linked in, it will automatically serve the <em>index.html</em> file, which is all you need.</p>

<p>Go ahead and try it: if your Express server is still running on port 3033, you should be able to visit <em>http://localhost:3033</em> and see the same application that your CRA dev server is providing!</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-type="indexterm" data-primary="create-react-app (CRA) utility" id="idm45053578003432"/><a data-type="indexterm" data-primary="webpack-dev-server" id="idm45053578002664"/>In case you’re wondering how CRA’s dev server works, it uses a package called <code>webpack-dev-server</code>, which uses Express under the hood!  So it all comes back to Express in the end!<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc4" id="idm45053578001480"/></p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45053579997144">
<h1>Conclusion</h1>

<p>This chapter has only scratched the surface of React, and the technologies that swirl around it.  If you want to take a deeper dive into React, <a href="https://oreil.ly/ROqku"><em>Learning React</em></a> by Alex Banks and Eve Porcello (O’Reilly) is a great place to start.  This book also covers state management with Redux (however, it does not currently cover hooks).  The <a href="http://bit.ly/37377Qb">official React documentation</a> is also comprehensive and well-written.</p>

<p>SPAs have certainly changed the way we think about and deliver web applications, and have enabled significant performance improvements, especially on mobile.  Even though Express was written in an era when most HTML was still substantially rendered on the server, it has certainly not made Express obsolete.  Quite the contrary, the need to provide APIs to single-page applications has, if anything, given Express new life!</p>

<p>It should also be clear from reading this chapter that it’s really all the same game: data getting sent back and forth between browsers and servers.  It’s only the nature of that data that’s changed, and getting used to changing HTML through dynamic DOM manipulation.<a data-type="indexterm" data-startref="ix_ch-16-single_page_applications-asciidoc1" id="idm45053577996088"/></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45053580304888"><sup><a href="ch16.xhtml#idm45053580304888-marker">1</a></sup> For performance reasons, the bundle might be split into “chunks” that are loaded as needed (called <em>lazy loading</em>), but the principle is the same.</p></div></div></section></div>



  </body></html>