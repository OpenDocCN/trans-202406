<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:epub="http://www.idpf.org/2007/ops" lang="en" xml:lang="en" xsi:schemaLocation="http://www.w3.org/2002/06/xhtml2/ http://www.w3.org/MarkUp/SCHEMA/xhtml2.xsd">
  <head>
    <title>Unknown</title>
    <link rel="stylesheet" type="text/css" href="../stylesheet.css"/>
    <link rel="stylesheet" type="text/css" href="../page_styles.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  </head>
  <body class="calibre"><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 12. Helm" class="praise"><div class="dedication" id="helm">
<h1 class="calibre14"><span class="keep-together">Chapter 12. </span>Helm</h1>


<p class="author1"><a href="https://helm.sh" class="calibre10">Helm</a> is a templating engine and package manager for a set of Kubernetes manifests. At runtime, it replaces placeholders in YAML template files with actual, end-user-defined values. The artifact produced by the Helm executable is a so-called <em class="calibre3">chart file</em> bundling the manifests that comprise the API resources of an application. You can upload the chart file to a <em class="calibre3">chart repository</em> so that other teams can be use it to deploy the bundled manifests. The Helm ecosystem offers a wide range of reusable charts for common use cases searchable on <a href="https://artifacthub.io/" class="calibre10">Artifact Hub</a> (for example, for running Grafana or PostgreSQL).</p>

<p class="author1">Due to the wealth of functionality available to Helm, we’ll discuss only the basics. The exam does not expect you be a Helm expert; rather, it wants you to be familiar with the workflow of installing existing packages with Helm. Building and publishing your own charts is outside the scope of the exam. For more detailed information on Helm, see the <a href="https://helm.sh/docs" class="calibre10">user documentation</a>. The version of Helm used to describe the functionality here is 3.13.0.</p>
<aside data-type="sidebar" epub:type="sidebar" class="calibre48"><div class="sidebar" id="id481">
<h1 class="calibre49">Coverage of Curriculum Objectives</h1>
<p class="author1">This chapter addresses the following curriculum objective:</p>

<ul class="printings">
<li class="calibre13">
<p class="author1">Use the Helm package manager to deploy existing packages</p>
</li>
</ul>
</div></aside>






<section data-type="sect1" data-pdf-bookmark="Managing an Existing Chart" class="praise"><div class="dedication" id="id284">
<h1 class="calibre17">Managing an Existing Chart</h1>

<p class="author1">As a developer, you want to reuse existing functionality instead of putting in the work to define and configure it yourself. For example, you may want to install the open source monitoring service Prometheus on your cluster.</p>

<p class="author1">Prometheus requires the installation of multiple Kubernetes primitives. Thankfully, the Kubernetes community provided a Helm chart making it very easy to install and configure all the moving parts in the form of a <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" class="calibre10">Kubernetes operator</a>.</p>

<p class="author1">The following list shows the typical workflow for consuming and managing a Helm chart. Most of those steps need to use the <code class="calibre15">helm</code> executable:</p>
<ol class="calibre55">
<li class="calibre56">
<p class="author1">Identifying the chart you’d like to install</p>
</li>
<li class="calibre56">
<p class="author1">Adding the repository containing the chart</p>
</li>
<li class="calibre56">
<p class="author1">Installing the chart from the repository</p>
</li>
<li class="calibre56">
<p class="author1">Verifying the Kubernetes objects that have been installed by the chart</p>
</li>
<li class="calibre56">
<p class="author1">Rendering the list of installed charts</p>
</li>
<li class="calibre56">
<p class="author1">Upgrading an installed chart</p>
</li>
<li class="calibre56">
<p class="author1">Uninstalling a chart if its functionality is no longer needed</p>
</li>

</ol>

<p class="author1">The following sections will explain each of the steps.</p>








<section data-type="sect2" data-pdf-bookmark="Identifying a Chart" class="praise"><div class="dedication" id="id285">
<h2 class="calibre33">Identifying a Chart</h2>

<p class="author1">Over the years, the Kubernetes community implemented and published thousands of Helm charts. Artifact Hub provides a web-based search capability for discovering charts by keyword.</p>

<p class="author1">Say you wanted to find a chart that installs the Continuous Integration solution Jenkins. All you’d need to do is to enter the term “jenkins” into the search box and press the enter key. <a data-type="xref" href="#artifact_hub_search_jenkins" class="calibre10">Figure 12-1</a> shows the list of results in Artifact Hub.</p>

<figure class="width"><div id="artifact_hub_search_jenkins" class="figure">
<img src="Images/ckd2_1201.png" alt="ckd2 1201" width="3485" height="2097" class="calibre90"/>
<h6 class="calibre32"><span class="keep-together">Figure 12-1. </span>Searching for a Jenkins chart on Artifact Hub</h6>
</div></figure>

<p class="author1">At the time of writing, there are 141 matches for the search term. You will be able to inspect details about the chart by clicking on one of the search results, which includes a high-level description and the repository that the chart file resides in. Moreover, you can inspect the templates bundled with the chart file, indicating the objects that will be created upon installation and their configuration options. <a data-type="xref" href="#artifact_hub_jenkins_chart_details" class="calibre10">Figure 12-2</a> shows the page for the official Jenkins chart.</p>

<figure class="calibre35"><div id="artifact_hub_jenkins_chart_details" class="figure">
<img src="Images/ckd2_1202.png" alt="ckd2 1202" class="calibre91"/>
<h6 class="calibre32"><span class="keep-together">Figure 12-2. </span>Jenkins chart details</h6>
</div></figure>

<p class="author1">You cannot install a chart directly from Artifact Hub. You must install it from the repository hosting the chart file.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Adding a Chart Repository" class="praise"><div class="dedication" id="id286">
<h2 class="calibre33">Adding a Chart Repository</h2>

<p class="author1">The chart description may mention the repository that hosts the chart file. Alternatively, you can click on the “Install” button to render repository details and the command for adding it. <a data-type="xref" href="#artifact_hub_jenkins_chart_install" class="calibre10">Figure 12-3</a> shows the contextual pop-up that appears after clicking the “Install” button.</p>

<p class="author1">By default, a Helm installation defines no external repositories. The following command shows how to list all registered repositories. No repositories have been registered yet:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm repo list</strong>
Error: no repositories to show
</pre>

<figure class="calibre35"><div id="artifact_hub_jenkins_chart_install" class="figure">
<img src="Images/ckd2_1203.png" alt="ckd2 1203" class="calibre92"/>
<h6 class="calibre32"><span class="keep-together">Figure 12-3. </span>Jenkins chart installation instructions</h6>
</div></figure>

<p class="author1">As you can see from the screenshot, the chart file lives in the repository with the URL <a href="https://charts.jenkins.io" class="calibre10"><em class="calibre3">https://charts.jenkins.io</em></a>. We will need to add this repository. This is an one-time operation. You can install other charts from that repository or you can update a chart that originated from that repository with commands we’ll discuss in a later section.</p>

<p class="author1">You need to provide a name for the repository when registering one. Make the repository name as descriptive as possible. The following command registers the repository with the name <code class="calibre15">jenkinsci</code>:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm repo add jenkinsci https://charts.jenkins.io/</strong>
"jenkinsci" has been added to your repositories
</pre>

<p class="author1">Listing the repositories now shows the mapping between name and URL:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm repo list</strong>
NAME        URL
jenkinsci   https://charts.jenkins.io/
</pre>

<p class="author1">You permanently added the repository to the Helm installation.</p>
</div></section>








<section data-type="sect2" class="praise" data-pdf-bookmark="Searching for a Chart in a Repository"><div class="dedication" id="id287">
<h2 class="calibre33">Searching for a Chart in a Repository</h2>

<p class="author1">The “Install” pop-up window already provided the command to install the chart. You can also search the repository for available charts in case you do not know their names or latest versions. Add the <code class="calibre15">--versions</code> flag to list all available versions:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm search repo jenkinsci</strong>
NAME                CHART VERSION   APP VERSION   DESCRIPTION
jenkinsci/jenkins   4.6.5           2.414.2       ...
</pre>

<p class="author1">The latest version available is 4.6.5. This may be different if you run the command on your machine, given that the Jenkins project may have released a newer version.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Installing a Chart" class="praise"><div class="dedication" id="id288">
<h2 class="calibre33">Installing a Chart</h2>

<p class="author1">Let’s assume that the latest version of the Helm chart contains a security vulnerability. Therefore, we decide to install the Jenkins chart with the previous version, 4.6.4. You need to assign a name to be able to identify an installed chart. The name we’ll use here is <code class="calibre15">my-jenkins</code>:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm install my-jenkins jenkinsci/jenkins --version 4.6.4</strong>
NAME: my-jenkins
LAST DEPLOYED: Thu Sep 28 09:47:21 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
...
</pre>

<p class="author1">The chart automatically created the Kubernetes objects in the <code class="calibre15">default</code> namespace. You can use the following command to discover the most important resource types:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ kubectl get all</strong>
NAME               READY   STATUS    RESTARTS   AGE
pod/my-jenkins-0   2/2     Running   0          12m

NAME                       TYPE        CLUSTER-IP       EXTERNAL-IP    ...
service/my-jenkins         ClusterIP   10.99.166.189    &lt;none&gt;         ...
service/my-jenkins-agent   ClusterIP   10.110.246.141   &lt;none&gt;         ...

NAME                          READY   AGE
statefulset.apps/my-jenkins   1/1     12m
</pre>

<p class="author1">The chart has been installed with the default configuration options. You can inspect those default values by clicking on the “Default Values” button on the chart page, as shown in <a data-type="xref" href="#artifact_hub_jenkins_chart_default_values" class="calibre10">Figure 12-4</a>.</p>

<figure class="calibre35"><div id="artifact_hub_jenkins_chart_default_values" class="figure">
<img src="Images/ckd2_1204.png" alt="ckd2 1204" class="calibre93"/>
<h6 class="calibre32"><span class="keep-together">Figure 12-4. </span>Jenkins chart default values</h6>
</div></figure>

<p class="author1">You can also discover those configuration options using the following command. The output shown renders only a subset of values, the admin username and its password, represented by <code class="calibre15">controller.adminUser</code> and <code class="calibre15">controller.adminPassword</code>:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm show values jenkinsci/jenkins</strong>
...
controller:
  # When enabling LDAP or another non-Jenkins identity source, the built-in \
  # admin account will no longer exist.
  # If you disable the non-Jenkins identity store and instead use the Jenkins \
  # internal one,
  # you should revert controller.adminUser to your preferred admin user:
  adminUser: "admin"
  # adminPassword: &lt;defaults to random&gt;
...
</pre>

<p class="author1">You can customize any configuration value when installing the chart. To pass configuration data during the install processing use one of the following flags:</p>

<ul class="printings">
<li class="calibre13">
<p class="author1"><code class="calibre15">--values</code>: Specifies the overrides in the form of a pointer to a YAML manifest file.</p>
</li>
<li class="calibre13">
<p class="author1"><code class="calibre15">--set</code>: Specifies the overrides directly from the command line.</p>
</li>
</ul>

<p class="author1">For more information, see <a href="https://helm.sh/docs/intro/using_helm/#customizing-the-chart-before-installing" class="calibre10">“Customizing the Chart Before Installing”</a> in the Helm documentation.</p>

<p class="author1">You can decide to install the chart into a custom namespace. Use the <code class="calibre15">-n</code> flag to provide the name of an existing namespace. Add the flag <code class="calibre15">--create-namespace</code> to automatically create the namespace if it doesn’t exist yet.</p>

<p class="author1">The following command shows how to customize some of the values and the namespace used during the installation process:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm install my-jenkins jenkinsci/jenkins --version 4.6.4 \
--set controller.adminUser=boss --set controller.adminPassword=password \
-n jenkins --create-namespace</strong>
</pre>

<p class="author1">We specifically set the username and the password for the admin user. Helm created the objects controlled by the chart into the <code class="calibre15">jenkins</code> namespace.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Listing Installed Charts" class="praise"><div class="dedication" id="id289">
<h2 class="calibre33">Listing Installed Charts</h2>

<p class="author1">Charts can live in the <code class="calibre15">default</code> namespace or a custom namespace. You can inspect the list of installed charts using the <code class="calibre15">helm list</code> command. If you do not know which namespace, simply add the <code class="calibre15">--all-namespaces</code> flag to the command:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm list --all-namespaces</strong>
NAME         NAMESPACE   REVISION   UPDATED         STATUS     CHART
my-jenkins   default     1          2023-09-28...   deployed   jenkins-4.6.4
</pre>

<p class="author1">The output of the command includes the column <code class="calibre15">NAMESPACE</code> that shows the namespace used by a particular chart. Similar to the use of <code class="calibre15">kubectl</code>, the <code class="calibre15">helm list</code> command provides the option <code class="calibre15">-n</code> for spelling out a namespace. Providing no flag(s) with the command will return the result for the <code class="calibre15">default</code> namespace.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Upgrading an Installed Chart" class="praise"><div class="dedication" id="id290">
<h2 class="calibre33">Upgrading an Installed Chart</h2>

<p class="author1">Upgrading an installed chart usually means moving to a new chart version. You can poll for new versions available in the repository by running this command:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm repo update</strong>
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "jenkinsci" chart repository
Update Complete. ⎈Happy Helming!⎈
</pre>

<p class="author1">What if you want to upgrade your existing chart installation to a newer chart version? Run the following command to upgrade the chart to that specific version with the default configuration:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm upgrade my-jenkins jenkinsci/jenkins --version 4.6.5</strong>
Release "my-jenkins" has been upgraded. Happy Helming!
...
</pre>

<p class="author1">As with the <code class="calibre15">install</code> command, you will have to provide custom configuration values if you want to tweak the chart’s runtime behavior when upgrading a chart.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Uninstalling a Chart" class="praise"><div class="dedication" id="id291">
<h2 class="calibre33">Uninstalling a Chart</h2>

<p class="author1">Sometimes you no longer need to run a chart. The command for uninstalling a chart is straightforward, as shown here. It will delete all objects controlled by the chart. Don’t forgot to provide the <code class="calibre15">-n</code> flag if you previously installed the chart into a namespace other than <code class="calibre15">default</code>:</p>
<pre data-type="programlisting" class="calibre37">
<strong class="calibre38">$ helm uninstall my-jenkins</strong>
release "my-jenkins" uninstalled
</pre>

<p class="author1">Executing the command may take up to 30 seconds, as Kubernetes needs to wait for the workload grace period to end.</p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Summary" class="praise"><div class="dedication" id="id292">
<h1 class="calibre17">Summary</h1>

<p class="author1">Helm has evolved to become a de facto tool for deploying application stacks to Kubernetes. The artifact that contains the manifest files, default configuration values, and metadata is called a chart. A team or an individual can publish charts to a chart repository. Users can discover a published chart through the Artifact Hub user interface and install it to a Kubernetes cluster.</p>

<p class="author1">One of the primary developer workflows when using Helm consists of finding, installing, and upgrading a chart with a specific version. You start by registering the repository containing chart files you want to consume. The <code class="calibre15">helm install</code> command downloads the chart file and stores it in a local cache. It also creates the Kubernetes objects described by the chart.</p>

<p class="author1">The installation process is configurable. A developer can provide overrides for customizable configuration values. The <code class="calibre15">helm upgrade</code> command lets you upgrade the version of an already installed chart. To uninstall a chart and delete all Kubernetes objects managed by the chart, run the <code class="calibre15">helm uninstall</code> command.</p>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Exam Essentials" class="praise"><div class="dedication" id="id293">
<h1 class="calibre17">Exam Essentials</h1>
<dl class="calibre18">
<dt class="calibre19">Assume that the Helm executable is preinstalled</dt>
<dd class="calibre20">
<p class="calibre21">Unfortunately, the <a href="https://docs.linuxfoundation.org/tc-docs/certification/faq-cka-ckad-cks" class="calibre10">exam FAQ</a> does not mention any details about the Helm executable or the Helm version to expect. It’s fair to assume that it will be preinstalled for you and therefore you do not need to memorize installation instructions. You will be able to browse the <a href="https://helm.sh/docs" class="calibre10">Helm documentation pages</a>.</p>
</dd>
<dt class="calibre19">Become familiar with Artifact Hub</dt>
<dd class="calibre20">
<p class="calibre21">Artifact Hub provides a web-based UI for Helm charts. It’s worthwhile to explore the search capabilities and the details provided by individual charts, more specifically the repository the chart file lives in, and its configurable values. During the exam, you’ll likely not be asked to navigate to Artifact Hub because its URL hasn’t been listed as one of the permitted documentation pages. You can assume that the exam question will provide you with the repository URL.</p>
</dd>
<dt class="calibre19">Practice commands needed to consume existing Helm charts</dt>
<dd class="calibre20">
<p class="calibre21">The exam does not ask you to build and publish your own chart file. All you need to understand is how to consume an existing chart. You will need to be familiar with the <code class="calibre15">helm repo add</code> command to register a repository, the <code class="calibre15">helm search repo</code> to find available chart versions, and the <code class="calibre15">helm install</code> command to install a chart. You should have a basic understanding of the upgrade process for an already installed Helm chart using the <code class="calibre15">helm upgrade</code> command.</p>
</dd>
</dl>
</div></section>






<section data-type="sect1" data-pdf-bookmark="Sample Exercises" class="praise"><div class="dedication" id="id294">
<h1 class="calibre17">Sample Exercises</h1>

<p class="author1">Solutions to these exercises are available in <a href="app01_split_008.xhtml#appendix_a_helm" class="calibre10">Appendix A</a>.</p>
<ol class="calibre55">
<li class="calibre56">
<p class="author1">In this exercise, you will use Helm to install Kubernetes objects needed for the open source monitoring solution <a href="https://prometheus.io/" class="calibre10">Prometheus</a>. The easiest way to install Prometheus on top of Kubernetes is with the help of the <a href="https://prometheus-operator.dev/" class="calibre10">prometheus-operator</a> Helm chart.</p>

<p class="author1">You can search for the <a href="https://artifacthub.io/packages/helm/prometheus-community/kube-prometheus-stack" class="calibre10">kube-prometheus-stack</a> on Artifact Hub. Add the repository to the list of known repositories accessible by Helm with the name <code class="calibre15">prometheus-community</code>.</p>

<p class="author1">Update to the latest information about charts from the respective chart 
<span class="keep-together">repository.</span></p>

<p class="author1">Run the Helm command for listing available Helm charts and their versions. Identify the latest chart version for <code class="calibre15">kube-prometheus-stack</code>.</p>

<p class="author1">Install the the chart <code class="calibre15">kube-prometheus-stack</code>. List the installed Helm chart.</p>

<p class="author1">List the Service named <code class="calibre15">prometheus-operated</code> created by the Helm chart. The object resides in the <code class="calibre15">default</code> namespace.</p>

<p class="author1">Use the kubectl <code class="calibre15">port-forward</code> command to forward the local port 8080 to the port 9090 of the Service. Open a browser and bring up the Prometheus 
<span class="keep-together">dashboard.</span></p>

<p class="author1">Stop port forwarding and uninstall the Helm chart.</p>
</li>

</ol>
</div></section>
</div></section></div></body>
</html>