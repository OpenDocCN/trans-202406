<html><head></head><body><section data-pdf-bookmark="Chapter 9. Frontend and Backend Frameworks" data-type="chapter" epub:type="chapter"><div class="chapter" id="frameworks">&#13;
<h1><span class="label">Chapter 9. </span>Frontend and Backend Frameworks</h1>&#13;
&#13;
&#13;
<p>While you could build every part of your application yourself from the ground up—the networking and database layers on the server, a user interface framework and state management solution on the frontend—you probably shouldn’t.<a data-primary="frameworks" data-type="indexterm" id="ix_frmwk"/> It’s hard to get the details right, and luckily for us, lots of these hard problems on the frontend and backend have already been solved by other engineers. By taking advantage of existing tools, libraries, and frameworks to build things both on the frontend and the backend, we can iterate quickly and on stable ground when building our own <span class="keep-together">applications</span>.</p>&#13;
&#13;
<p>In this chapter, we’ll go through some of the most popular tools and frameworks that solve common problems on both the client and the server. We’ll talk about what you might use each framework for, and how to safely integrate it into your TypeScript application.<a data-primary="frameworks" data-secondary="frontend" data-type="indexterm" id="ix_frmwkfr"/></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Frontend Frameworks" data-type="sect1"><div class="sect1" id="idm46304955348216">&#13;
<h1>Frontend Frameworks</h1>&#13;
&#13;
<p>TypeScript is a natural fit for the world of frontend applications. With its rich support for JSX and its ability to safely model mutability, TypeScript lends structure and safety to your application and makes it easier to write correct, maintainable code in the fast-paced environment that is frontend development.</p>&#13;
&#13;
<p>Of course, all of the built-in DOM APIs are typesafe.<a data-primary="frameworks" data-secondary="frontend" data-tertiary="enabling DOM APIs in tsconfig.json" data-type="indexterm" id="idm46304955345768"/><a data-primary="TSC compiler" data-secondary="enabling DOM APIs" data-type="indexterm" id="idm46304955344552"/><a data-primary="DOM (Document Object Model)" data-secondary="enabling DOM APIs in TSC compiler" data-type="indexterm" id="idm46304955343608"/> To use them from TypeScript, just include their type declarations in your project’s <em>tsconfig.json</em>:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>&#13;
    <code class="nt">"lib"</code><code class="p">:</code> <code class="p">[</code><code class="s2">"dom"</code><code class="p">,</code> <code class="s2">"es2015"</code><code class="p">]</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>That will tell TypeScript to include <em>lib.dom.d.ts</em>—its built-in browser and DOM type declarations—when typechecking your code.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>lib</code> <em>tsconfig.json</em> option just tells TypeScript to include a set of specific type declarations when processing the code in your project; it won’t emit any extra code,<a data-primary="tsconfig.json" data-secondary="lib option" data-type="indexterm" id="idm46304955336120"/><a data-primary="lib tsconfig.json option" data-type="indexterm" id="idm46304955335144"/> or generate any JavaScript that will exist at runtime. It won’t, for example, make the DOM magically work in a NodeJS environment (your code will compile, but it will fail at runtime)—it’s on you to make sure that your type declarations match up to what your JavaScript environment actually supports at runtime. Jump ahead to <a data-type="xref" href="ch12.html#building">“Building Your TypeScript Project”</a> to learn more.</p>&#13;
</div>&#13;
&#13;
<p>With DOM type declarations enabled, you’ll<a data-primary="types" data-secondary="DOM type declarations, enabling" data-type="indexterm" id="idm46304955332616"/> be able to safely consume DOM and browser APIs to do things like:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="c1">// Read properties from the global window object</code>&#13;
<code class="kd">let</code> <code class="nx">model</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">url</code>: <code class="kt">window.location.href</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// Create an &lt;input /&gt; element</code>&#13;
<code class="kd">let</code> <code class="nx">input</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'input'</code><code class="p">)</code>&#13;
&#13;
<code class="c1">// Give it some CSS classes</code>&#13;
<code class="nx">input</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="s1">'Input'</code><code class="p">,</code> <code class="s1">'URLInput'</code><code class="p">)</code>&#13;
&#13;
<code class="c1">// When the user types, update the model</code>&#13;
<code class="nx">input</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code>&#13;
  <code class="nx">model</code><code class="p">.</code><code class="nx">url</code> <code class="o">=</code> <code class="nx">input</code><code class="p">.</code><code class="nx">value</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">()</code>&#13;
<code class="p">)</code>&#13;
&#13;
<code class="c1">// Inject the &lt;input /&gt; into the DOM</code>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">input</code><code class="p">)</code></pre>&#13;
&#13;
<p>Of course, all of that code is typechecked and comes with the normal goodies like in-editor autocompletion.<a data-primary="editors" data-secondary="autocompletion in" data-type="indexterm" id="idm46304955279288"/> For example, consider something <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2339" data-type="indexterm" id="idm46304955190072"/>like this:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'.Element'</code><code class="p">).</code><code class="nx">value</code> <code class="c1">// Error TS2339: Property 'value' does</code>&#13;
                                         <code class="c1">// not exist on type 'Element'.</code></pre>&#13;
&#13;
<p>TypeScript will throw an error because the return type of <code>querySelector</code> is nullable.</p>&#13;
&#13;
<p>While for simple frontend applications these low-level DOM APIs are enough and will give you what you need to do safe, type-guided programming for the browser, most real-world frontend applications use a framework to abstract away how DOM rendering and rerendering, data binding, and events work. The following sections will give some pointers on how to effectively use TypeScript with a few of the most popular browser frameworks.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="React" data-type="sect2"><div class="sect2" id="idm46304955180152">&#13;
<h2>React</h2>&#13;
&#13;
<p>React is among the most popular frontend frameworks today, and is a great choice when it comes to type safety.<a data-primary="frameworks" data-secondary="frontend" data-tertiary="React" data-type="indexterm" id="ix_frwkfrRea"/><a data-primary="React" data-type="indexterm" id="ix_React"/></p>&#13;
&#13;
<p>The reason React is so safe is because React components—the basic building blocks of React applications—are both defined and consumed in TypeScript.<a data-primary="components" data-secondary="React" data-type="indexterm" id="idm46304955170376"/> This property is hard to find among frontend frameworks, and means that both component definitions and consumers are typechecked. You can use types to say things like “this component takes a user ID and a color” or “this component can only have list items as children.” These constraints are then enforced by TypeScript, verifying that your components do what they say they do.</p>&#13;
&#13;
<p>This safety around component definitions and consumers—the <em>view layer</em> of a frontend application—is killer.<a data-primary="view layer of frontend applications (React)" data-type="indexterm" id="idm46304955168072"/> The view is traditionally the place where typos, missed attributes, mistyped parameters, and improperly nested elements cause programmers to collectively spend thousands of hours tearing their hair out and indignantly refreshing their browsers. The day you start typing your views with TypeScript and React is the day you double your and your team’s productivity on the frontend.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A JSX primer" data-type="sect3"><div class="sect3" id="idm46304955166744">&#13;
<h3>A JSX primer</h3>&#13;
&#13;
<p>When using React, you define your views using a special DSL called <em>JavaScript XML</em> (JSX) that you embed straight into your JavaScript code.<a data-primary="React" data-secondary="JSX primer" data-type="indexterm" id="idm46304955164792"/><a data-primary="JSX (JavaScript XML)" data-type="indexterm" id="idm46304955163816"/><a data-primary="XML" data-secondary="JSX (JavaScript XML)" data-type="indexterm" id="idm46304955163144"/> It sort of looks like HTML in your JavaScript. You then run your JavaScript through a JSX compiler that rewrites that funky JSX syntax into regular JavaScript function calls.</p>&#13;
&#13;
<p>The process looks something like this. Say you’re building a menu app for your friend’s restaurant, and you list out a few items on the brunch menu with the following JSX:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="nt">&lt;ul</code> <code class="na">class=</code><code class="s">'list'</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;li&gt;</code>Homemade granola with yogurt<code class="nt">&lt;/li&gt;</code>&#13;
  <code class="nt">&lt;li&gt;</code>Fantastic french toast with fruit<code class="nt">&lt;/li&gt;</code>&#13;
  <code class="nt">&lt;li&gt;</code>Tortilla Española with salad<code class="nt">&lt;/li&gt;</code>&#13;
<code class="nt">&lt;/ul&gt;</code></pre>&#13;
&#13;
<p>After running that code through a JSX compiler like Babel’s <a href="http://bit.ly/2uENY4M"><code>transform-react-jsx</code> plugin</a>, you’ll get the following output:</p>&#13;
<pre class="c_less_space" data-code-language="js" data-type="programlisting">&#13;
<code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>&#13;
  <code class="s1">'ul'</code><code class="p">,</code>&#13;
  <code class="p">{</code><code class="s1">'class'</code><code class="o">:</code> <code class="s1">'list'</code><code class="p">},</code>&#13;
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>&#13;
    <code class="s1">'li'</code><code class="p">,</code>&#13;
    <code class="kc">null</code><code class="p">,</code>&#13;
    <code class="s1">'Homemade granola with yogurt'</code>&#13;
  <code class="p">),</code>&#13;
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>&#13;
    <code class="s1">'li'</code><code class="p">,</code>&#13;
    <code class="kc">null</code><code class="p">,</code>&#13;
    <code class="s1">'Fantastic French toast with fruit'</code>&#13;
  <code class="p">),</code>&#13;
  <code class="nx">React</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code>&#13;
    <code class="s1">'li'</code><code class="p">,</code>&#13;
    <code class="kc">null</code><code class="p">,</code>&#13;
    <code class="s1">'Tortilla Española with salad'</code>&#13;
  <code class="p">)</code>&#13;
<code class="p">);</code>&#13;
</pre>&#13;
<div data-type="tip"><h1>TSC Flag: esModuleInterop</h1>&#13;
<p>Because JSX compiles to a call to <code>React.createElement</code>, be sure to import the React library into each file where you use JSX so that<a data-primary="esModuleInterop TSC flag" data-type="indexterm" id="idm46304955032008"/><a data-primary="TSC compiler" data-secondary="esModuleInterop flag" data-type="indexterm" id="idm46304955031320"/> you have a variable named <code>React</code> in scope:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code></pre>&#13;
&#13;
<p>Don’t worry—if you forget, TypeScript will warn you:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="o">&lt;</code><code class="nx">ul</code> <code class="o">/&gt;</code> <code class="c1">// Error TS2304: Cannot find name 'React'.</code></pre>&#13;
&#13;
<p>Also note <a data-primary="errors" data-secondary="TypeScript errors" data-tertiary="TS2304" data-type="indexterm" id="idm46304955010776"/>that I’ve set <code>{"esModuleInterop": true}</code> in my <em>tsconfig.json</em> to support importing <code>React</code> without a wildcard (<code>*</code>) import. If you’re following along, either enable <code>esModuleInterop</code> in your own <em>tsconfig.json</em>, or use a wildcard import instead:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code> <code class="o">*</code> <code class="kr">as</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code></pre>&#13;
</div>&#13;
&#13;
<p>The nice thing about JSX is you can write what looks a lot like normal HTML, then compile it automatically to a JavaScript engine–friendly format. As an engineer you only use a familiar, high-level, declarative DSL, and you don’t have to deal with the implementation details.</p>&#13;
&#13;
<p>You don’t need JSX to work with React (you can write that compiled code directly and it’ll work fine), and you can use JSX without React (the specific function call that JSX tags compile to—<code>React.createElement</code> in the previous example—is configurable), but the combination of React with JSX is magical, and makes writing views really fun, and really, really safe.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="TSX = JSX + TypeScript" data-type="sect3"><div class="sect3" id="tsx-jsx-ts">&#13;
<h3>TSX = JSX + TypeScript</h3>&#13;
&#13;
<p>Files that contain JSX use the file extension <em>.jsx</em>. And TypeScript files that contain JSX use the <em>.tsx</em> extension.<a data-primary="XML" data-secondary="TSX (JSX and TypeScript)" data-type="indexterm" id="idm46304955021944"/><a data-primary="JSX (JavaScript XML)" data-secondary="TSX and" data-type="indexterm" id="idm46304955020968"/><a data-primary="TSC compiler" data-secondary="jsx flag" data-type="indexterm" id="idm46304955020024"/><a data-primary="React" data-secondary="TSX or JSX support in TypeScript" data-type="indexterm" id="idm46304955019080"/> TSX is to JSX what TypeScript is to JavaScript—a compile-time safety and assistance layer to help you be more productive and produce code with fewer mistakes. To enable TSX support for your project, add the following line to your <em>tsconfig.json</em>:</p>&#13;
<pre class="c_less_space" data-code-language="json" data-type="programlisting">&#13;
<code class="p">{</code>&#13;
  <code class="nt">"compilerOptions"</code><code class="p">:</code> <code class="p">{</code>&#13;
    <code class="nt">"jsx"</code><code class="p">:</code> <code class="s2">"react"</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
</pre>&#13;
&#13;
<p>The <code>jsx</code> directive has three modes<a data-primary="jsx directive" data-type="indexterm" id="idm46304954916872"/> at the time of writing:</p>&#13;
<dl>&#13;
<dt><code>react</code></dt>&#13;
<dd>&#13;
<p>Compile JSX to a <em>.js</em> file using the JSX pragma (by default, <code>React.createElement</code>).</p>&#13;
</dd>&#13;
<dt><code>react-native</code></dt>&#13;
<dd>&#13;
<p>Preserve JSX without compiling it, but do emit a file with a <em>.js</em> extension.</p>&#13;
</dd>&#13;
<dt><code>preserve</code></dt>&#13;
<dd>&#13;
<p>Typecheck JSX but don’t compile it away, and emit a file with a <em>.jsx</em> extension.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Under the hood, TypeScript exposes a few hooks for typing TSX in a pluggable way. These are special types on the <code>global.JSX</code> namespace that TypeScript looks at as the source of<a data-primary="global.JSX namespace" data-type="indexterm" id="idm46304954888984"/> truth for TSX types throughout your program. If you’re just using React, you don’t need to go that low-level; but if you’re building your own TypeScript library that uses TSX (and doesn’t use React)—or if you’re curious how the React type declarations do it—head over to <a data-type="xref" href="app07.html#tsx-reference">Appendix G</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using TSX with React" data-type="sect3"><div class="sect3" id="idm46304954886920">&#13;
<h3>Using TSX with React</h3>&#13;
&#13;
<p>React lets us declare two kinds of components: function components and class components.<a data-primary="XML" data-secondary="using TSX with React" data-type="indexterm" id="ix_XMLTSX"/><a data-primary="JSX (JavaScript XML)" data-secondary="using TSX with React" data-type="indexterm" id="ix_JSXTSX"/><a data-primary="TSX" data-secondary="using with React" data-type="indexterm" id="ix_TSX"/><a data-primary="React" data-secondary="using TSX with" data-type="indexterm" id="idm46304954881400"/> Both kinds of components take some properties and render some TSX. From a consumer’s point of view, they are identical.<a data-primary="components" data-secondary="React" data-tertiary="function and class components" data-type="indexterm" id="idm46304954880184"/></p>&#13;
&#13;
<p>Declaring and rendering a function component looks like this:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code><code> </code><code class="nx">React</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'react'</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-1" id="co_frontend_and_backend_frameworks_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
&#13;
</code><code class="nx">type</code><code> </code><code class="nx">Props</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-2" id="co_frontend_and_backend_frameworks_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
  </code><code class="nx">isDisabled?</code><code>: </code><code class="kt">boolean</code><code>&#13;
  </code><code class="nx">size</code><code class="o">:</code><code> </code><code class="s1">'Big'</code><code> </code><code class="o">|</code><code> </code><code class="s1">'Small'</code><code>&#13;
  </code><code class="nx">text</code><code>: </code><code class="kt">string</code><code>&#13;
  </code><code class="nx">onClick</code><code class="p">(</code><code class="nx">event</code><code>: </code><code class="kt">React.MouseEvent</code><code class="o">&lt;</code><code class="nx">HTMLButtonElement</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code><code> </code><code class="k">void</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-3" id="co_frontend_and_backend_frameworks_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kr">export</code><code> </code><code class="kd">function</code><code> </code><code class="nx">FancyButton</code><code class="p">(</code><code class="nx">props</code><code>: </code><code class="kt">Props</code><code class="p">)</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-4" id="co_frontend_and_backend_frameworks_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
  </code><code class="kr">const</code><code> </code><code class="p">[</code><code class="nx">toggled</code><code class="p">,</code><code> </code><code class="nx">setToggled</code><code class="p">]</code><code> </code><code class="o">=</code><code> </code><code class="nx">React</code><code class="p">.</code><code class="nx">useState</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-5" id="co_frontend_and_backend_frameworks_CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
  </code><code class="k">return</code><code> </code><code class="o">&lt;</code><code class="nx">button</code><code>&#13;
    </code><code class="nx">className</code><code class="o">=</code><code class="p">{</code><code class="s1">'Size-'</code><code> </code><code class="o">+</code><code> </code><code class="nx">props</code><code class="p">.</code><code class="nx">size</code><code class="p">}</code><code>&#13;
    </code><code class="nx">disabled</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">isDisabled</code><code> </code><code class="o">||</code><code> </code><code class="kc">false</code><code class="p">}</code><code>&#13;
    </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="nx">event</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code>&#13;
      </code><code class="nx">setToggled</code><code class="p">(</code><code class="o">!</code><code class="nx">toggled</code><code class="p">)</code><code>&#13;
      </code><code class="nx">props</code><code class="p">.</code><code class="nx">onClick</code><code class="p">(</code><code class="nx">event</code><code class="p">)</code><code>&#13;
    </code><code class="p">}</code><code class="p">}</code><code>&#13;
  </code><code class="o">&gt;</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">text</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/</code><code class="err">b</code><code class="err">u</code><code class="err">t</code><code class="err">t</code><code class="err">o</code><code class="err">n</code><code class="err">&gt;</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kd">let</code><code> </code><code class="nx">button</code><code> </code><code class="o">=</code><code> </code><code class="o">&lt;</code><code class="nx">FancyButton</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO1-6" id="co_frontend_and_backend_frameworks_CO1-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
  </code><code class="nx">size</code><code class="o">=</code><code class="s1">'Big'</code><code>&#13;
  </code><code class="nx">text</code><code class="o">=</code><code class="s1">'Sign Up Now'</code><code>&#13;
  </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Clicked!'</code><code class="p">)</code><code class="p">}</code><code>&#13;
</code><code class="err">/</code><code class="err">&gt;</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-1" id="callout_frontend_and_backend_frameworks_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We have to bring the <code>React</code> variable into the current scope in order to use TSX with React. Since TSX is compiled to <code>React.createElement</code> function calls, that means we need to import <code>React</code> so that it’s defined at runtime.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-2" id="callout_frontend_and_backend_frameworks_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We start by declaring the specific set of props we can pass to our <code>FancyButton</code> component. <code>Props</code> is always an object type, and is named <code>Props</code> by convention. For our <code>FancyButton</code> component, <code>isDisabled</code> is optional, while the rest of our props are required.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-3" id="callout_frontend_and_backend_frameworks_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>React has its own set of wrapper types for DOM events. When using React events, be sure to use React’s event types rather than regular DOM event types.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-4" id="callout_frontend_and_backend_frameworks_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>A function component is just a regular function that has up to one parameter (the <code>props</code> object) and returns a React-renderable type. React is permissive and can render a wide range of types: TSX, strings, numbers, booleans, <code>null</code>, and <code>undefined</code>.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-5" id="callout_frontend_and_backend_frameworks_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use React’s <code>useState</code> hook to declare local state for a function component. <code>useState</code> is one of a handful of hooks available in React, which you can combine to create your own custom hooks. Note that because we passed the initial value <code>false</code> to <code>useState</code>, TypeScript was able to infer that the piece of state is a <code>boolean</code>; if we’d instead used a type that TypeScript wasn’t able to infer—for example, an array—we would have bound the type explicitly (e.g., with useState&lt;number[]&gt;;([])).</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO1-6" id="callout_frontend_and_backend_frameworks_CO1-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We use TSX syntax to create an instance of <code>FancyButton</code>. The <code>&lt;FancyButton /&gt;</code> syntax is almost identical to calling <code>FancyButton</code>, but it lets React manage the lifecycle of <code>FancyButton</code> for us.</p></dd>&#13;
</dl>&#13;
&#13;
<p>That’s it. TypeScript enforces that:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>JSX is well formed. Tags are closed and properly nested, and tag names aren’t misspelled.</p>&#13;
</li>&#13;
<li>&#13;
<p>When we instantiate a <code>&lt;FancyButton /&gt;</code> we pass all required—plus any optional—props to <code>FancyButton</code> (<code>size</code>, <code>text</code>, and <code>onClick</code>), and that the props are all correctly typed.</p>&#13;
</li>&#13;
<li>&#13;
<p>We don’t pass any extraneous props to <code>FancyButton</code>, just the ones that are required.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>A class component is similar:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code><code> </code><code class="nx">React</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'react'</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-1" id="co_frontend_and_backend_frameworks_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code class="nx">FancyButton</code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'./FancyButton'</code><code>&#13;
&#13;
</code><code class="nx">type</code><code> </code><code class="nx">Props</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-2" id="co_frontend_and_backend_frameworks_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
  </code><code class="nx">firstName</code><code>: </code><code class="kt">string</code><code>&#13;
  </code><code class="nx">userId</code><code>: </code><code class="kt">string</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="nx">type</code><code> </code><code class="nx">State</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-3" id="co_frontend_and_backend_frameworks_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
  </code><code class="nx">isLoading</code><code>: </code><code class="kt">boolean</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kr">class</code><code> </code><code class="nx">SignupForm</code><code> </code><code class="kr">extends</code><code> </code><code class="nx">React</code><code class="p">.</code><code class="nx">Component</code><code class="o">&lt;</code><code class="nx">Props</code><code class="p">,</code><code> </code><code class="nx">State</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-4" id="co_frontend_and_backend_frameworks_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
  </code><code class="nx">state</code><code> </code><code class="o">=</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-5" id="co_frontend_and_backend_frameworks_CO2-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
    </code><code class="nx">isLoading</code><code>: </code><code class="kt">false</code><code>&#13;
  </code><code class="p">}</code><code>&#13;
  </code><code class="nx">render() {</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-6" id="co_frontend_and_backend_frameworks_CO2-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
    </code><code class="k">return</code><code> </code><code class="o">&lt;</code><code class="o">&gt;</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-7" id="co_frontend_and_backend_frameworks_CO2-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
      </code><code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code><code> </code><code class="nx">up</code><code> </code><code class="k">for</code><code> </code><code class="nx">a</code><code> </code><code class="mi">7</code><code class="o">-</code><code class="nx">day</code><code> </code><code class="nx">supply</code><code> </code><code class="nx">of</code><code> </code><code class="nx">our</code><code> </code><code class="nx">tasty</code><code>&#13;
          </code><code class="nx">toothpaste</code><code> </code><code class="nx">now</code><code class="p">,</code><code> </code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">firstName</code><code class="p">}</code><code class="p">.</code><code class="o">&lt;</code><code class="err">/</code><code class="err">h</code><code class="err">2</code><code class="err">&gt;</code><code>&#13;
</code><code>      </code><code class="o">&lt;</code><code class="nx">FancyButton</code><code>&#13;
        </code><code class="nx">isDisabled</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">state</code><code class="p">.</code><code class="nx">isLoading</code><code class="p">}</code><code>&#13;
        </code><code class="nx">size</code><code class="o">=</code><code class="s1">'Big'</code><code>&#13;
        </code><code class="nx">text</code><code class="o">=</code><code class="s1">'Sign Up Now'</code><code>&#13;
        </code><code class="nx">onClick</code><code class="o">=</code><code class="p">{</code><code class="k">this</code><code class="p">.</code><code class="nx">signUp</code><code class="p">}</code><code>&#13;
      </code><code class="o">/</code><code class="o">&gt;</code><code>&#13;
    </code><code class="o">&lt;</code><code class="err">/</code><code class="err">&gt;</code><code>&#13;
</code><code>  </code><code class="p">}</code><code>&#13;
  </code><code class="kr">private</code><code> </code><code class="nx">signUp</code><code> </code><code class="o">=</code><code> </code><code class="nx">async</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-8" id="co_frontend_and_backend_frameworks_CO2-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
    </code><code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">(</code><code class="p">{</code><code class="nx">isLoading</code><code>: </code><code class="kt">true</code><code class="p">}</code><code class="p">)</code><code>&#13;
    </code><code class="k">try</code><code> </code><code class="p">{</code><code>&#13;
      </code><code class="nx">await</code><code> </code><code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/signup?userId='</code><code> </code><code class="o">+</code><code> </code><code class="k">this</code><code class="p">.</code><code class="nx">props</code><code class="p">.</code><code class="nx">userId</code><code class="p">)</code><code>&#13;
    </code><code class="p">}</code><code> </code><code class="k">finally</code><code> </code><code class="p">{</code><code>&#13;
      </code><code class="k">this</code><code class="p">.</code><code class="nx">setState</code><code class="p">(</code><code class="p">{</code><code class="nx">isLoading</code><code>: </code><code class="kt">false</code><code class="p">}</code><code class="p">)</code><code>&#13;
    </code><code class="p">}</code><code>&#13;
  </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="kd">let</code><code> </code><code class="nx">form</code><code> </code><code class="o">=</code><code> </code><code class="o">&lt;</code><code class="nx">SignupForm</code><code> </code><code class="nx">firstName</code><code class="o">=</code><code class="s1">'Albert'</code><code> </code><code class="nx">userId</code><code class="o">=</code><code class="s1">'13ab9g3'</code><code> </code><code class="o">/</code><code class="o">&gt;</code><code> </code><a class="co" href="#callout_frontend_and_backend_frameworks_CO2-9" id="co_frontend_and_backend_frameworks_CO2-9"><img alt="9" src="assets/9.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-1" id="callout_frontend_and_backend_frameworks_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Like before, we import <code>React</code> to bring it into scope.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-2" id="callout_frontend_and_backend_frameworks_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Like before, we declare a <code>Props</code> type to define what data we need to pass in when creating an instance of <code>&lt;SignupForm /&gt;</code>.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-3" id="callout_frontend_and_backend_frameworks_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We declare a <code>State</code> type to model our component’s local state.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-4" id="callout_frontend_and_backend_frameworks_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>To declare a class component, we extend the <code>React.Component</code> base class.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-5" id="callout_frontend_and_backend_frameworks_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use a property initializer to declare default values for local state.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-6" id="callout_frontend_and_backend_frameworks_CO2-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Like with function components, a class component’s <code>render</code> method returns something renderable by React: TSX, a string, a number, a boolean, <code>null</code>, or <span class="keep-together">undefined</span>.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-7" id="callout_frontend_and_backend_frameworks_CO2-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>TSX supports fragments using the special <code>&lt;&gt;...&lt;/&gt;</code> syntax. A fragment is a nameless TSX element that wraps other TSX, and is a way to avoid rendering extra DOM elements in places where you need to return a single TSX element. For example, a React component’s <code>render</code> method needs to return a single TSX element; to do that, we could have wrapped our code with a <code>&lt;div&gt;</code> or any other element, but that would have incurred unnecessary overhead during rendering.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-8" id="callout_frontend_and_backend_frameworks_CO2-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We define <code>signUp</code> using an arrow function, to make sure that <code>this</code> in the function doesn’t get re-bound.</p></dd>&#13;
<dt><a class="co" href="#co_frontend_and_backend_frameworks_CO2-9" id="callout_frontend_and_backend_frameworks_CO2-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>Finally, we instantiate our <code>SignupForm</code>. Like when instantiating function components, we could have directly <code>new</code>-ed it with <code>new SignupForm({firstName: 'Albert', userId: '13ab9g3'})</code> instead, but that would mean that React couldn’t manage the <code>SignupForm</code> instance’s lifecycle for us.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Notice how we mix and match value-based (<code>FancyButton</code>, <code>SignupForm</code>) and intrinsic (<code>section</code>, <code>h2</code>) components in this example. We put TypeScript to work to verify things like:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>That all required state fields were defined either in the <code>state</code> initializer, or in the constructor</p>&#13;
</li>&#13;
<li>&#13;
<p>That whatever we access on <code>props</code> and <code>state</code> actually exists, and is of the type we think it is</p>&#13;
</li>&#13;
<li>&#13;
<p>That we don’t write to <code>this.state</code> directly, because in React, state updates have to go through the <code>setState</code> API</p>&#13;
</li>&#13;
<li>&#13;
<p>That calling <code>render</code> really returns some JSX</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>With TypeScript you can make your React code safer, and become a better, happier person as a result.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>We didn’t use React’s <code>PropTypes</code> feature, which is a way to declare and check props’ types at runtime. Since TypeScript is already checking types for us at compile time, we don’t need to do it again.<a data-primary="XML" data-secondary="using TSX with React" data-startref="ix_XMLTSX" data-type="indexterm" id="idm46304954485544"/><a data-primary="JSX (JavaScript XML)" data-secondary="using TSX with React" data-startref="ix_JSXTSX" data-type="indexterm" id="idm46304954484296"/><a data-primary="TSX" data-secondary="using with React" data-startref="ix_TSX" data-type="indexterm" id="idm46304954483080"/><a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frwkfrRea" data-tertiary="React" data-type="indexterm" id="idm46304954481864"/><a data-primary="React" data-startref="ix_React" data-type="indexterm" id="idm46304954275752"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Angular 6/7" data-type="sect2"><div class="sect2" id="Angular">&#13;
<h2>Angular 6/7</h2>&#13;
&#13;
<p class="byline">Contributed by Shyam Seshadri</p>&#13;
&#13;
<p>Angular is a more fully featured frontend framework <a data-primary="Angular 6/7" data-type="indexterm" id="ix_Angu"/><a data-primary="frameworks" data-secondary="frontend" data-tertiary="Angular 6/7" data-type="indexterm" id="ix_frmwkfrAng"/>than React, and comes with support not just for rendering views but also for sending and managing network requests, routing, and dependency injection. It’s built from the ground up to work with TypeScript (in fact, the framework itself is written in TypeScript!).</p>&#13;
&#13;
<p>Central to the way <a data-primary="Ahead-of-Time (AoT) compiler (Angular)" data-type="indexterm" id="idm46304954269560"/>Angular works is the Ahead-of-Time (AoT) compiler built into Angular CLI, Angular’s command-line utility,<a data-primary="CLI (command-line interface) in Angular" data-type="indexterm" id="idm46304954268696"/> that grabs the type information you gave it with your TypeScript annotations and uses that information to compile your code down to regular JavaScript. Instead of calling TypeScript directly, Angular applies a whole bunch of optimizations and transformations to your code before ultimately delegating to TypeScript and compiling it down to JavaScript.</p>&#13;
&#13;
<p>Let’s see how Angular uses TypeScript and its AoT compiler to make writing frontend applications safe.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Scaffolding" data-type="sect3"><div class="sect3" id="idm46304954266952">&#13;
<h3>Scaffolding</h3>&#13;
&#13;
<p>To initialize a new Angular project, start by <a data-primary="Angular 6/7" data-secondary="installing CLI" data-type="indexterm" id="idm46304954265576"/><a data-primary="CLI (command-line interface) in Angular" data-secondary="installing" data-type="indexterm" id="idm46304954264728"/>globally installing Angular CLI using NPM:</p>&#13;
&#13;
<pre data-code-language="sh" data-type="programlisting">npm install @angular/cli --global</pre>&#13;
&#13;
<p>Then, use Angular CLI to initialize a new Angular application:</p>&#13;
&#13;
<pre data-code-language="sh" data-type="programlisting">ng new my-angular-app</pre>&#13;
&#13;
<p>Follow the prompts, and Angular CLI will set up a bare-bones Angular application for you.<a data-primary="Angular 6/7" data-secondary="initializing a project" data-type="indexterm" id="idm46304954260712"/></p>&#13;
&#13;
<p>In this book we won’t go into depth on how an Angular application is structured, or how to configure and run it. For detailed information, head over to the <a href="https://angular.io/docs">official Angular documentation</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Components" data-type="sect3"><div class="sect3" id="idm46304954222424">&#13;
<h3>Components</h3>&#13;
&#13;
<p>Let’s build an Angular component.<a data-primary="components" data-secondary="Angular" data-type="indexterm" id="idm46304954220856"/><a data-primary="Angular 6/7" data-secondary="components" data-type="indexterm" id="idm46304954219880"/> Angular components are like React components, and include a way to describe a component’s DOM structure, styling, and controller. With Angular, you generate component boilerplate with Angular CLI, then fill in the details by hand. An Angular component consists of a few different files:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A template, which describes the DOM a component renders</p>&#13;
</li>&#13;
<li>&#13;
<p>A set of CSS styles</p>&#13;
</li>&#13;
<li>&#13;
<p>A component class, which is a TypeScript class that dictates your components’ business logic</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Let’s start with the component class:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code><code class="nx">Component</code><code class="p">,</code> <code class="nx">OnInit</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'@angular/core'</code>&#13;
&#13;
<code class="err">@</code><code class="nx">Component</code><code class="p">({</code>&#13;
  <code class="nx">selector</code><code class="o">:</code> <code class="s1">'simple-message'</code><code class="p">,</code>&#13;
  <code class="nx">styleUrls</code><code class="o">:</code> <code class="p">[</code><code class="s1">'./simple-message.component.css'</code><code class="p">],</code>&#13;
  <code class="nx">templateUrl</code><code class="o">:</code> <code class="s1">'./simple-message.component.html'</code>&#13;
<code class="p">})</code>&#13;
<code class="kr">export</code> <code class="kr">class</code> <code class="nx">SimpleMessageComponent</code> <code class="kr">implements</code> <code class="nx">OnInit</code> <code class="p">{</code>&#13;
  <code class="nx">message</code>: <code class="kt">string</code>&#13;
  <code class="nx">ngOnInit() {</code>&#13;
    <code class="k">this</code><code class="p">.</code><code class="nx">message</code> <code class="o">=</code> <code class="s1">'No messages, yet'</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>For the most part, this is a pretty standard TypeScript class, with just a few differences that bring out how Angular leverages TypeScript. Namely:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Angular’s <a data-primary="lifecycle hooks (Angular)" data-type="indexterm" id="idm46304954170200"/>lifecycle hooks are available as TypeScript interfaces—just declare which ones you <code>implement</code> (<code>ngOnChanges</code>, <code>ngOnInit</code>, etc.).<a data-primary="interfaces" data-secondary="Angular lifecycle hooks" data-type="indexterm" id="idm46304954168200"/> TypeScript then enforces that you implement methods that comply with the lifecycle hooks you want. In this example we implemented the <code>OnInit</code> interface, which requires that we implement the <code>ngOnInit</code> method.</p>&#13;
</li>&#13;
<li>&#13;
<p>Angular<a data-primary="decorators" data-secondary="use by Angular" data-type="indexterm" id="idm46304954165064"/> makes heavy use of TypeScript decorators (see <a data-type="xref" href="ch05.html#decorators">“Decorators”</a>) to declare metadata related to your Angular components, services, and modules. <a data-primary="HTML templates (Angular)" data-type="indexterm" id="idm46304954163064"/>In this example, we used a <code>selector</code> to declare how people can consume our component, and we used <code>templateUrls</code> and <code>styleUrl</code> to link an HTML template and CSS stylesheet to our component.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="tip"><h1>TSC Flag: fullTemplateTypeCheck</h1>&#13;
<p>To enable typechecking for your<a data-primary="typechecking" data-secondary="for Angular templates" data-type="indexterm" id="idm46304954159608"/> Angular templates (you should!),<a data-primary="TSC compiler" data-secondary="fullTemplateTypeCheck flag" data-type="indexterm" id="idm46304954158456"/><a data-primary="fullTemplateTypeCheck TSC flag" data-type="indexterm" id="idm46304954157448"/> be sure to enable <code>fullTemplateTypeCheck</code> in your <em>tsconfig.json</em>:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nt">"angularCompilerOptions"</code><code class="p">:</code> <code class="p">{</code>&#13;
    <code class="nt">"fullTemplateTypeCheck"</code><code class="p">:</code> <code class="kc">true</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Note that <code>angularCompilerOptions</code> isn’t specifying options for TSC.<a data-primary="angularCompilerOptions" data-type="indexterm" id="idm46304954147400"/><a data-primary="compilers" data-secondary="angularCompilerOptions" data-type="indexterm" id="idm46304954146760"/> Rather, it defines compiler flags specific to Angular’s AoT compiler.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Services" data-type="sect3"><div class="sect3" id="idm46304954145432">&#13;
<h3>Services</h3>&#13;
&#13;
<p>Angular comes with a built-in dependency injector (DI), which is a way for the framework to take care of instantiating services and passing them in as arguments to components and services that depend on them.<a data-primary="dependency injector (Angular)" data-type="indexterm" id="idm46304954143672"/><a data-primary="services (Angular)" data-type="indexterm" id="idm46304954100136"/><a data-primary="Angular 6/7" data-secondary="services" data-type="indexterm" id="idm46304954099432"/> This can make it easier to instantiate and test services and components.</p>&#13;
&#13;
<p>Let’s update <code>SimpleMessageComponent</code> to inject a dependency, <code>MessageService</code>, responsible for fetching messages from the server:</p>&#13;
<pre data-code-language="ts" data-type="programlisting">&#13;
<code class="kr">import</code><code> </code><code class="p">{</code><code class="nx">Component</code><code class="p">,</code><code> </code><code class="nx">OnInit</code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'@angular/core'</code><code>&#13;
</code><strong><code class="kr">import</code><code> </code><code class="p">{</code><code class="nx">MessageService</code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'../services/message.service'</code></strong><code>&#13;
&#13;
</code><code class="err">@</code><code class="nx">Component</code><code class="p">(</code><code class="p">{</code><code>&#13;
  </code><code class="nx">selector</code><code class="o">:</code><code> </code><code class="s1">'simple-message'</code><code class="p">,</code><code>&#13;
  </code><code class="nx">templateUrl</code><code class="o">:</code><code> </code><code class="s1">'./simple-message.component.html'</code><code class="p">,</code><code>&#13;
  </code><code class="nx">styleUrls</code><code class="o">:</code><code> </code><code class="p">[</code><code class="s1">'./simple-message.component.css'</code><code class="p">]</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code><code>&#13;
</code><code class="kr">export</code><code> </code><code class="kr">class</code><code> </code><code class="nx">SimpleMessageComponent</code><code> </code><code class="kr">implements</code><code> </code><code class="nx">OnInit</code><code> </code><code class="p">{</code><code>&#13;
  </code><code class="nx">message</code><code>: </code><code class="kt">string</code><code>&#13;
  </code><strong><code class="kr">constructor</code><code class="p">(</code><code>&#13;
    </code><code class="kr">private</code><code> </code><code class="nx">messageService</code><code>: </code><code class="kt">MessageService</code><code>&#13;
  </code><code class="p">)</code><code> </code><code class="p">{</code><code class="p">}</code></strong><code>&#13;
  </code><code class="nx">ngOnInit() {</code><code>&#13;
    </code><strong><code class="k">this</code><code class="p">.</code><code class="nx">messageService</code><code class="p">.</code><code class="nx">getMessage</code><code class="p">(</code><code class="p">)</code><code class="p">.</code><code class="nx">subscribe</code><code class="p">(</code><code class="nx">response</code><code> </code><code class="o">=</code><code class="o">&gt;</code><code>&#13;
      </code><code class="k">this</code><code class="p">.</code><code class="nx">message</code><code> </code><code class="o">=</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">message</code><code>&#13;
    </code><code class="p">)</code></strong><code>&#13;
  </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code>&#13;
</code></pre>&#13;
&#13;
<p>Angular’s AoT compiler looks at the parameters that your component’s <code>constructor</code> takes, plucks out their types (e.g., <code>MessageService</code>), and searches the relevant <a data-primary="Ahead-of-Time (AoT) compiler (Angular)" data-type="indexterm" id="idm46304953985896"/><a data-primary="compilers" data-secondary="AoT Angular compiler" data-type="indexterm" id="idm46304953985400"/>dependency injector’s dependency map for a dependency of that specific type. It then instantiates that dependency (<code>new</code>-ing it) if it hasn’t been instantiated yet, and passes it into the <code>SimpleMessageComponent</code> instance’s constructor. All of this DI stuff is pretty complicated, but it can be convenient as your application grows and you have multiple dependencies you might use depending on how the app is configured (e.g., <code>ProductionAPIService</code> versus <code>DevelopmentAPIService</code>) or when testing it (<code>MockAPIService</code>).</p>&#13;
&#13;
<p>Now let’s take a quick look at how to define a service:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code><code class="nx">Injectable</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'@angular/core'</code>&#13;
<code class="kr">import</code> <code class="p">{</code><code class="nx">HttpClient</code><code class="p">}</code> <code class="nx">from</code> <code class="s1">'@angular/common/http'</code>&#13;
&#13;
<code class="err">@</code><code class="nx">Injectable</code><code class="p">({</code>&#13;
  <code class="nx">providedIn</code><code class="o">:</code> <code class="s1">'root'</code>&#13;
<code class="p">})</code>&#13;
<code class="kr">export</code> <code class="kr">class</code> <code class="nx">MessageService</code> <code class="p">{</code>&#13;
  <code class="kr">constructor</code><code class="p">(</code><code class="kr">private</code> <code class="nx">http</code>: <code class="kt">HttpClient</code><code class="p">)</code> <code class="p">{}</code>&#13;
  <code class="nx">getMessage() {</code>&#13;
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">http</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'/api/message'</code><code class="p">)</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Whenever we create a service in Angular, we again use TypeScript decorators to register it as something that is <code>Injectable</code>, and we define whether it is provided at the root level of the application or in a submodule. Here, we registered the service <code>Mess<span class="keep-together">ageService</span></code>, allowing us to inject it anywhere in our application. In the constructor of any component or service, we can just ask for a <code>MessageService</code> and Angular will magically take care of passing it in.</p>&#13;
&#13;
<p>With how to safely use these two popular frontend frameworks out of the way, let’s move on to typing the interface between your frontend and your backend.<a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frmwkfrAng" data-tertiary="Angular 6/7" data-type="indexterm" id="idm46304953915880"/><a data-primary="Angular 6/7" data-startref="ix_Angu" data-type="indexterm" id="idm46304953914360"/><a data-primary="frameworks" data-secondary="frontend" data-startref="ix_frmwkfr" data-type="indexterm" id="idm46304953913416"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Typesafe APIs" data-type="sect1"><div class="sect1" id="APIs">&#13;
<h1>Typesafe APIs</h1>&#13;
&#13;
<p class="byline">Contributed by Nick Nance</p>&#13;
&#13;
<p>Regardless of which frontend and backend frameworks you decide to use, you’ll want a way to safely communicate across machines—from client to server, server to client, server to server, and client to client.<a data-primary="client/server communications" data-type="indexterm" id="ix_clsrv"/><a data-primary="frameworks" data-secondary="typesafe APIs for" data-type="indexterm" id="ix_frmwkAPI"/><a data-primary="APIs" data-secondary="typesafe, for use with frameworks and TypeScript" data-type="indexterm" id="ix_APIsfrmwk"/></p>&#13;
&#13;
<p>There are a few competing tools and standards in this space. But before we explore what they are and how they work, let’s think about how we might build our own solution, and what benefits and drawbacks it might have (we are engineers, after all).</p>&#13;
&#13;
<p>The problem we want to solve is this: though our clients and servers might be 100% typesafe—bastions of safety—at some point they’ll need to talk to each other over untyped network protocols like HTTP, TCP, or some other socket-based protocols. How might we make this communication typesafe?<a data-primary="protocols" data-secondary="client/server communications over" data-type="indexterm" id="idm46304953904520"/></p>&#13;
&#13;
<p>A good starting point could be a typesafe protocol like the one we developed in <a data-type="xref" href="ch08.html#typesafe-protocols">“Typesafe protocols”</a>. It might <a data-primary="protocols" data-secondary="typesafe" data-type="indexterm" id="idm46304953902360"/>look something like this:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="nx">type</code> <code class="nx">Request</code> <code class="o">=</code>&#13;
  <code class="o">|</code> <code class="p">{</code><code class="nx">entity</code><code class="o">:</code> <code class="s1">'user'</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">User</code><code class="p">}</code>&#13;
  <code class="o">|</code> <code class="p">{</code><code class="nx">entity</code><code class="o">:</code> <code class="s1">'location'</code><code class="p">,</code> <code class="nx">data</code>: <code class="kt">Location</code><code class="p">}</code>&#13;
&#13;
<code class="c1">// client.ts</code>&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">get</code><code class="o">&lt;</code><code class="nx">R</code> <code class="kr">extends</code> <code class="nx">Request</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">entity</code>: <code class="kt">R</code><code class="p">[</code><code class="s1">'entity'</code><code class="p">])</code><code class="o">:</code> <code class="nx">Promise</code><code class="o">&lt;</code><code class="nx">R</code><code class="p">[</code><code class="s1">'data'</code><code class="p">]</code><code class="o">&gt;</code> <code class="p">{</code>&#13;
  <code class="kd">let</code> <code class="nx">res</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="sr">/api/</code><code class="nx">$</code><code class="p">{</code><code class="nx">entity</code><code class="p">})</code>&#13;
  <code class="kd">let</code> <code class="nx">json</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">()</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">json</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">throw</code> <code class="nx">ReferenceError</code><code class="p">(</code><code class="s1">'Empty response'</code><code class="p">)</code>&#13;
  <code class="p">}</code>&#13;
  <code class="k">return</code> <code class="nx">json</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// app.ts</code>&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">startApp() {</code>&#13;
  <code class="kd">let</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">get</code><code class="p">(</code><code class="s1">'user'</code><code class="p">)</code>  <code class="c1">// User</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>You could build corresponding <code>post</code> and <code>put</code> functions to write back to your REST API, and add a type for each entity your server supports. On the backend, you’d then implement a corresponding set of handlers for each type of entity, reading from your database to return to the client whatever entity it asked for.</p>&#13;
&#13;
<p>But what happens if your server isn’t written in TypeScript, or if you aren’t able to share your <code>Request</code> type between the client and server (leading to the two getting out of sync over time), or if you don’t use REST (maybe you use GraphQL instead)? Or what if you have other clients to support, like Swift clients on iOS or Java clients on Android?</p>&#13;
&#13;
<p>That’s where typed, code-generated APIs come in. They come in a lot of flavors, each with libraries available in a bunch of languages (including TypeScript)—for example:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://github.com/swagger-api/swagger-codegen">Swagger</a> for RESTful APIs</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://www.npmjs.com/package/apollo">Apollo</a> and <a href="https://facebook.github.io/relay/">Relay</a> for GraphQL</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://grpc.io/">gRPC</a> and <a href="https://thrift.apache.org/">Apache Thrift</a> for RPC</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These tools rely on a common source of truth for both server and clients—data models for Swagger, GraphQL schemas for Apollo, Protocol Buffers for gRPC—which are then compiled into language-specific bindings for whatever language you might be using (in our case, that’s TypeScript).</p>&#13;
&#13;
<p>This code generation is what prevents your client and server (or multiple clients) from getting out of sync with each other; since every platform shares a common schema, you won’t run into the case where you updated your iOS app to support a field, but forgot to press Merge on your pull request to add server support for it.</p>&#13;
&#13;
<p>Diving into the details of each framework is out of scope for this book. Pick one for your project, and head over to its documentation to learn more.<a data-primary="client/server communications" data-startref="ix_clsrv" data-type="indexterm" id="idm46304953743832"/><a data-primary="frameworks" data-secondary="typesafe APIs for" data-startref="ix_frmwkAPI" data-type="indexterm" id="idm46304953742840"/><a data-primary="APIs" data-secondary="typesafe, for use with frameworks and TypeScript" data-startref="ix_APIsfrmwk" data-type="indexterm" id="idm46304953741624"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Backend Frameworks" data-type="sect1"><div class="sect1" id="idm46304953898648">&#13;
<h1>Backend Frameworks</h1>&#13;
&#13;
<p>When you build an application that interacts with a database, you might start with raw SQL or API calls, <a data-primary="databases, application interacting with" data-type="indexterm" id="idm46304953738888"/><a data-primary="SQL calls" data-type="indexterm" id="idm46304953738168"/><a data-primary="APIs" data-secondary="application interacting with databases" data-type="indexterm" id="idm46304953737496"/><a data-primary="frameworks" data-secondary="backend" data-type="indexterm" id="idm46304953736536"/><a data-primary="backend frameworks" data-type="indexterm" id="idm46304953735592"/>which are inherently untyped:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="c1">// PostgreSQL, using node-postgres</code>&#13;
<code class="kd">let</code> <code class="nx">client</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Client</code>&#13;
<code class="kd">let</code> <code class="nx">res</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">client</code><code class="p">.</code><code class="nx">query</code><code class="p">(</code>&#13;
  <code class="s1">'SELECT name FROM users where id = $1'</code><code class="p">,</code>&#13;
  <code class="p">[</code><code class="mi">739311</code><code class="p">]</code>&#13;
<code class="p">)</code> <code class="c1">// any</code>&#13;
&#13;
<code class="c1">// MongoDB, using node-mongodb-native</code>&#13;
<code class="nx">db</code><code class="p">.</code><code class="nx">collection</code><code class="p">(</code><code class="s1">'users'</code><code class="p">)</code>&#13;
  <code class="p">.</code><code class="nx">find</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code>&#13;
  <code class="p">.</code><code class="nx">toArray</code><code class="p">((</code><code class="nx">err</code><code class="p">,</code> <code class="nx">user</code><code class="p">)</code> <code class="o">=&gt;</code>&#13;
    <code class="c1">// user is any</code>&#13;
  <code class="p">)</code></pre>&#13;
&#13;
<p>With a bit of manual typing you can make these APIs safer and get rid of most of your <code>any</code>s:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="nx">db</code><code class="p">.</code><code class="nx">collection</code><code class="p">(</code><code class="s1">'users'</code><code class="p">)</code>&#13;
  <code class="p">.</code><code class="nx">find</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code>&#13;
  <code class="p">.</code><code class="nx">toArray</code><code class="p">((</code><code class="nx">err</code><code class="p">,</code> <code class="nx">user</code>: <code class="kt">User</code><code class="p">)</code> <code class="o">=&gt;</code>&#13;
    <code class="c1">// user is any</code>&#13;
  <code class="p">)</code></pre>&#13;
&#13;
<p>However, raw SQL APIs are still fairly low-level, and it’s still easy to use the wrong type, or forget a type and accidentally end up with <code>any</code>s.</p>&#13;
&#13;
<p>That’s where <em>object-relational mappers</em> (ORMs) come in.<a data-primary="object-relational mappers (ORMs)" data-type="indexterm" id="idm46304953634056"/><a data-primary="ORMs (object-relational mappers)" data-type="indexterm" id="idm46304953633496"/> ORMs generate code from your database schema, giving you high-level APIs to express queries, updates, deletions, and so on. In statically typed languages, these APIs are typesafe, so you don’t have to worry about typing things correctly and manually binding generic type parameters.</p>&#13;
&#13;
<p>When accessing your database from TypeScript, consider using an ORM. At the time of writing, Umed Khudoiberdiev’s excellent <a href="https://www.npmjs.com/package/typeorm">TypeORM</a> is the most complete ORM for TypeScript, and supports MySQL, PostgreSQL, Microsoft SQL Server, Oracle, and even MongoDB. Using TypeORM, your query to get a user’s first name might look like this:</p>&#13;
&#13;
<pre data-code-language="ts" data-type="programlisting"><code class="kd">let</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">UserRepository</code>&#13;
  <code class="p">.</code><code class="nx">findOne</code><code class="p">({</code><code class="nx">id</code>: <code class="kt">739311</code><code class="p">})</code> <code class="c1">// User | undefined</code></pre>&#13;
&#13;
<p>Notice the high-level API, which is both safe (in that it prevents things like SQL injection attacks) and typesafe by default (in that we know what type <code>findOne</code> returns without having to manually annotate it). Always use an ORM when working with databases—it’s more convenient, and it will save you from getting woken up at four in the morning because the <code>saleAmount</code> field is <code>null</code> because you updated it to <span class="keep-together"><code>orderAmount</code></span> the night before and your coworker decided to run your database migration for you in anticipation of your pull request landing while you were out, but then around midnight your pull request failed even though the migration succeeded, and your sales team in New York woke up to realize that all your clients’ orders were for exactly <code>null</code> dollars (this happened to… a friend).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm46304953740120">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>In this chapter we’ve covered a lot: directly manipulating the DOM; using React and Angular; adding type safety to your APIs with tools like Swagger, gRPC, and GraphQL; and using TypeORM to safely interact with your database.</p>&#13;
&#13;
<p>JavaScript frameworks change at a rapid pace, and by the time you read this, the specific APIs and frameworks described here may be on their way to becoming museum exhibits. Use your newfound intuition for <em>what problems typesafe frameworks solve</em> to identify places where you can take advantage of someone else’s work to make your code safer, more abstract, and more modular. The big idea to take away from this chapter isn’t what the best framework to use in the year 2019 is, but what sorts of problems can be better solved with frameworks.</p>&#13;
&#13;
<p>With the combination of typesafe UI code, a typed API layer, and a typesafe backend, you can eliminate entire classes of bugs from your application, and sleep better at night as a result.<a data-primary="frameworks" data-startref="ix_frmwk" data-type="indexterm" id="idm46304953556520"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>