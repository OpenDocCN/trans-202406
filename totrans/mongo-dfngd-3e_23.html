<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 18. Seeing What Your Application Is Doing"><div class="chapter" id="chapter-seeing"><h1><span class="label">Chapter 18. </span>Seeing What Your Application Is Doing</h1><p>Once<a data-type="indexterm" data-primary="administration, of applications" data-secondary="application operations" id="AAcurrent18"/> you have an application up and running, how do you know what
  it’s doing? This chapter covers how to figure out what kinds of queries
  MongoDB is running, how much data is being written, and other details about
  what it’s actually doing. You’ll learn about:</p><ul><li><p>Finding slow operations and killing them</p></li><li><p>Getting and interpreting statistics about your collections and
      databases</p></li><li><p>Using command-line tools to give you a picture of what MongoDB is
      doing</p></li></ul><section data-type="sect1" data-pdf-bookmark="Seeing the Current Operations"><div class="sect1" id="idm45882338403192"><h1>Seeing the Current Operations</h1><p>An<a data-type="indexterm" data-primary="application operations" data-secondary="seeing current" id="idm45882338402072"/> easy way to<a data-type="indexterm" data-primary="slow application operations" id="idm45882338400808"/><a data-type="indexterm" data-primary="application operations" data-secondary="finding slow" id="idm45882338399976"/> find slow operations is to see what is running. Anything
    slow is more likely to show up and have been running for longer. It’s not
    guaranteed, but it’s a good first step to see what might be slowing down
    an application.</p><p>To see the operations that are running, use the <code class="function">db.currentOp()<a data-type="indexterm" data-primary="db.currentOp()" id="idm45882338397672"/></code> function:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">currentOp</code><code class="p">()</code>
<code class="p">{</code>
  <code class="s2">"inprog"</code><code class="o">:</code> <code class="p">[{</code>
    <code class="s2">"type"</code> <code class="o">:</code> <code class="s2">"op"</code><code class="p">,</code>
    <code class="s2">"host"</code> <code class="o">:</code> <code class="s2">"eoinbrazil-laptop-osx:27017"</code><code class="p">,</code>
    <code class="s2">"desc"</code> <code class="o">:</code> <code class="s2">"conn3"</code><code class="p">,</code>
    <code class="s2">"connectionId"</code> <code class="o">:</code> <code class="mi">3</code><code class="p">,</code>
    <code class="s2">"client"</code> <code class="o">:</code> <code class="s2">"127.0.0.1:57181"</code><code class="p">,</code>
    <code class="s2">"appName"</code> <code class="o">:</code> <code class="s2">"MongoDB Shell"</code><code class="p">,</code>
    <code class="s2">"clientMetadata"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"application"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"name"</code> <code class="o">:</code> <code class="s2">"MongoDB Shell"</code>
        <code class="p">},</code>
        <code class="s2">"driver"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"name"</code> <code class="o">:</code> <code class="s2">"MongoDB Internal Client"</code><code class="p">,</code>
            <code class="s2">"version"</code> <code class="o">:</code> <code class="s2">"4.2.0"</code>
        <code class="p">},</code>
        <code class="s2">"os"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"type"</code> <code class="o">:</code> <code class="s2">"Darwin"</code><code class="p">,</code>
            <code class="s2">"name"</code> <code class="o">:</code> <code class="s2">"Mac OS X"</code><code class="p">,</code>
            <code class="s2">"architecture"</code> <code class="o">:</code> <code class="s2">"x86_64"</code><code class="p">,</code>
            <code class="s2">"version"</code> <code class="o">:</code> <code class="s2">"18.7.0"</code>
        <code class="p">}</code>
    <code class="p">},</code>
    <code class="s2">"active"</code> <code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
    <code class="s2">"currentOpTime"</code> <code class="o">:</code> <code class="s2">"2019-09-03T23:25:46.380+0100"</code><code class="p">,</code>
    <code class="s2">"opid"</code> <code class="o">:</code> <code class="mi">13594</code><code class="p">,</code>
    <code class="s2">"lsid"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"id"</code> <code class="o">:</code> <code class="nx">UUID</code><code class="p">(</code><code class="s2">"63b7df66-ca97-41f4-a245-eba825485147"</code><code class="p">),</code>
        <code class="s2">"uid"</code> <code class="o">:</code> <code class="nx">BinData</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="s2">"47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU="</code><code class="p">)</code>
    <code class="p">},</code>
    <code class="s2">"secs_running"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">0</code><code class="p">),</code>
    <code class="s2">"microsecs_running"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">969</code><code class="p">),</code>
    <code class="s2">"op"</code> <code class="o">:</code> <code class="s2">"insert"</code><code class="p">,</code>
    <code class="s2">"ns"</code> <code class="o">:</code> <code class="s2">"sample_mflix.items"</code><code class="p">,</code>
    <code class="s2">"command"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"insert"</code> <code class="o">:</code> <code class="s2">"items"</code><code class="p">,</code>
        <code class="s2">"ordered"</code> <code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
        <code class="s2">"lsid"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"id"</code> <code class="o">:</code> <code class="nx">UUID</code><code class="p">(</code><code class="s2">"63b7df66-ca97-41f4-a245-eba825485147"</code><code class="p">)</code>
        <code class="p">},</code>
        <code class="s2">"$readPreference"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"mode"</code> <code class="o">:</code> <code class="s2">"secondaryPreferred"</code>
        <code class="p">},</code>
        <code class="s2">"$db"</code> <code class="o">:</code> <code class="s2">"sample_mflix"</code>
    <code class="p">},</code>
    <code class="s2">"numYields"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"locks"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"ParallelBatchWriterMode"</code> <code class="o">:</code> <code class="s2">"r"</code><code class="p">,</code>
        <code class="s2">"ReplicationStateTransition"</code> <code class="o">:</code> <code class="s2">"w"</code><code class="p">,</code>
        <code class="s2">"Global"</code> <code class="o">:</code> <code class="s2">"w"</code><code class="p">,</code>
        <code class="s2">"Database"</code> <code class="o">:</code> <code class="s2">"w"</code><code class="p">,</code>
        <code class="s2">"Collection"</code> <code class="o">:</code> <code class="s2">"w"</code>
    <code class="p">},</code>
    <code class="s2">"waitingForLock"</code> <code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
    <code class="s2">"lockStats"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"ParallelBatchWriterMode"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"r"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"ReplicationStateTransition"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"w"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"Global"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"w"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"Database"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"w"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"Collection"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"w"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"Mutex"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"r"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">196</code><code class="p">)</code>
            <code class="p">}</code>
        <code class="p">}</code>
    <code class="p">},</code>
    <code class="s2">"waitingForFlowControl"</code> <code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
    <code class="s2">"flowControlStats"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">4</code><code class="p">)</code>
    <code class="p">}</code>
  <code class="p">}],</code>
  <code class="s2">"ok"</code><code class="o">:</code> <code class="mi">1</code>
<code class="p">}</code></pre><p>This<a data-type="indexterm" data-primary="application operations" data-secondary="important fields" id="idm45882338371800"/> displays a list of operations that the database is
    performing. Here are some of the more important fields in the
    output:</p><dl><dt><code>"opid"</code></dt><dd><p>The operation’s unique identifier. You can use this number to
          kill an operation (see <a data-type="xref" href="#sect2-killing">“Killing Operations”</a>).</p></dd><dt><code>"active"</code></dt><dd><p>Whether this operation is running. If this field is <code>false</code>, it means the operation has yielded
          or is waiting for a lock.</p></dd><dt><code>"secs_running"</code></dt><dd><p>The duration of this operation in seconds. You can use this to
          find queries that are taking too long.</p></dd><dt><code>"microsecs_running"</code></dt><dd><p>The duration of this operation in microseconds. You can use
          this to find queries that are taking too long.</p></dd><dt><code>"op"</code></dt><dd><p>The type of operation. This is generally <code>"query"</code>, <code>"insert"</code>, <code>"update"</code>, or <code>"remove"</code>. Note that database commands are
          processed as queries.</p></dd><dt><code>"desc"</code></dt><dd><p>An identifier for the client. This can be correlated with
          messages in the logs. Every log message related to the connection in
          our example will be prefixed with <code>[conn3]</code>, so you can use this to grep the
          logs for relevant information.</p></dd><dt><code>"locks"</code></dt><dd><p>A description of the types of locks taken by this
          operation.</p></dd><dt><code>"waitingForLock"</code></dt><dd><p>Whether this operation is currently blocking, waiting to
          acquire a lock.</p></dd><dt><code>"numYields"</code></dt><dd><p>The number of times this operation has
          <span class="firstterm">yielded</span>, releasing its lock to allow other
          operations to go. Generally, any operation that searches for
          documents (queries, updates, and removes) can yield. An operation
          will only yield if there are other operations enqueued and waiting
          to take its lock. Basically, if there are no operations in the
          <code>"waitingForLock"</code> state, the
          current operations will not yield.</p></dd><dt><code>"lockstats.timeAcquiringMicros"</code></dt><dd><p>How long it took this operation to acquire the locks it
          needed.</p></dd></dl><p>You can filter <code class="function">currentOp</code> to
    only look for operations fulfilling certain criteria, such as operations
    on a<a data-type="indexterm" data-primary="namespaces" data-secondary="filtering for operations on certain" id="idm45882338062408"/> certain namespace or ones that have been running for a
    certain length of time. You filter the results by passing in a query
    argument:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">currentOp</code><code class="p">(</code>
   <code class="p">{</code>
     <code class="s2">"active"</code> <code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
     <code class="s2">"secs_running"</code> <code class="o">:</code> <code class="p">{</code> <code class="s2">"$gt"</code> <code class="o">:</code> <code class="mi">3</code> <code class="p">},</code>
     <code class="s2">"ns"</code> <code class="o">:</code> <code class="sr">/^db1\./</code>
   <code class="p">}</code>
<code class="p">)</code></pre><p>You can query on any field in <code class="function">currentOp</code>, using all the normal query
    operators.</p><section data-type="sect2" data-pdf-bookmark="Finding Problematic Operations"><div class="sect2" id="idm45882338043304"><h2>Finding Problematic Operations</h2><p>The<a data-type="indexterm" data-primary="problematic operations" id="idm45882338042424"/><a data-type="indexterm" data-primary="application operations" data-secondary="finding problematic" id="idm45882338039512"/> most common use for <code class="function">db.currentOp()<a data-type="indexterm" data-primary="db.currentOp()" id="idm45882338037688"/></code> is looking for slow operations. You can use
      the filtering technique described in the previous section to find all
      queries that take longer than a certain amount of time, which may
      suggest a missing index or improper field filtering.</p><p>Sometimes people will find that unexpected queries are running,
      generally because there’s an app server running an old or buggy version
      of the software. The <code>"client"</code> field
      can help you track down where unexpected operations are coming
      from.</p></div></section><section data-type="sect2" data-pdf-bookmark="Killing Operations"><div class="sect2" id="sect2-killing"><h2>Killing Operations</h2><p>If<a data-type="indexterm" data-primary="operations, killing" data-seealso="application operations" id="idm45882338034376"/><a data-type="indexterm" data-primary="application operations" data-secondary="killing" id="idm45882338033240"/> you find an operation that you want to stop, you can kill
      it by passing <code class="function">db.killOp()<a data-type="indexterm" data-primary="db.killOp()" id="idm45882338031448"/></code> its <code>"opid"</code>:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">killOp</code><code class="p">(</code><code class="mi">123</code><code class="p">)</code></pre><p>Not all operations can be killed. In general, operations can only
      be killed when they yield—so updates, finds, and removes can all be
      killed, but operations holding or waiting for a lock usually cannot be
      killed.</p><p>Once you have sent a “kill” message to an operation, it will have
      a <code>"killed"</code> field in the <code class="function">db.currentOp()</code> output. However, it won’t
      actually be dead until it disappears from the list of current
      operations.</p><p>In MongoDB 4.0, the<a data-type="indexterm" data-primary="killOP method" id="idm45882338023848"/> <code>killOP</code> method was
      extended to allow it to run on a <em class="filename">mongos</em>. It can now kill queries (read
      operations) that are running across more than one shard in a cluster. In
      previous versions, this involved manually issuing the kill command
      across each shard on the respective primary <em class="filename">mongod</em>.</p></div></section><section data-type="sect2" data-pdf-bookmark="False Positives"><div class="sect2" id="idm45882338020888"><h2>False Positives</h2><p>If<a data-type="indexterm" data-primary="application operations" data-secondary="genuinely long-running" id="idm45882338019688"/> you look for slow operations, you may see some
      long-running internal operations listed. There are several long-running
      requests<a data-type="indexterm" data-primary="long-running requests" id="idm45882338018264"/> MongoDB may have running, depending on your setup. The
      most common are the<a data-type="indexterm" data-primary="replication" data-secondary="replication thread" id="idm45882337983896"/> replication thread (which will continue fetching more
      operations from the sync source for as long as possible) and the
      writeback listener for<a data-type="indexterm" data-primary="sharding, administration of" data-secondary="seeing current state" data-tertiary="writeback listener" id="idm45882337982488"/> sharding. Any long-running query on <em class="filename">local.oplog.rs<a data-type="indexterm" data-primary="local.oplog.rs" id="idm45882337980456"/></em> can be ignored, as well<a data-type="indexterm" data-primary="writebacklistener commands" id="idm45882337979464"/> as any <a href="https://oreil.ly/95e3x"><span class="command"><em>writebacklistener</em></span> commands</a>.</p><p>If you kill either of these operations, MongoDB will just restart
      them. However, you generally should not do that. Killing the replication
      thread will briefly halt replication, and killing the writeback listener
      may cause <em class="filename">mongos</em> to miss legitimate
      write errors.</p></div></section><section data-type="sect2" data-pdf-bookmark="Preventing Phantom Operations"><div class="sect2" id="idm45882337976056"><h2>Preventing Phantom Operations</h2><p>There<a data-type="indexterm" data-primary="phantom operations" id="idm45882337975144"/><a data-type="indexterm" data-primary="application operations" data-secondary="preventing phantom" id="idm45882337974280"/> is an odd, MongoDB-specific issue that you may run into,
      particularly if you’re bulk-loading data into a collection. Suppose you
      have a job that is firing thousands of update operations at MongoDB and
      MongoDB is grinding to a halt. You quickly stop the job and kill off all
      the updates that are currently occurring. However, you continue to see
      new updates appearing as soon as you kill the old ones, even though the
      job is no longer running!</p><p>If you are loading data using unacknowledged writes, your
      application will fire writes at MongoDB, potentially faster than MongoDB
      can process them. If MongoDB gets backed up, these writes will pile up
      in the operating system’s socket buffer. When you kill the writes
      MongoDB is working on, this allows MongoDB to start processing the
      writes in the buffer. Even if you stop the client from sending writes,
      any writes that made it into the buffer will get processed by MongoDB,
      since they’ve already been “received” (just not processed).</p><p>The best way to prevent these phantom writes is to do
      <em>acknowledged</em> writes<a data-type="indexterm" data-primary="writes" data-secondary="acknowledged" id="idm45882337950024"/><a data-type="indexterm" data-primary="acknowledged writes" id="idm45882337948888"/>: make each write wait until the previous write is
      complete, not just until the previous write is sitting in a buffer on
      the database server.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="Using the System Profiler"><div class="sect1" id="idm45882338402888"><h1>Using the System Profiler</h1><p>To<a data-type="indexterm" data-primary="system profiler" id="sysprof18"/><a data-type="indexterm" data-primary="slow application operations" id="idm45882337945880"/><a data-type="indexterm" data-primary="application operations" data-secondary="finding slow" id="idm45882337945080"/> find slow operations you can use the <span class="firstterm">system
    profiler</span>, which records operations in a special <em class="filename">system.profile</em> collection. The profiler can
    give you tons of information about operations that are taking a long time,
    but at a cost: it slows down <em class="filename">mongod</em>’s
    overall performance. Thus, you may only want to turn on the profiler
    periodically to capture a slice of traffic. If your system is already
    heavily loaded, you may wish to use another technique described in this
    chapter to diagnose issues.</p><p>By default, the profiler is off and does not record anything. You
    can turn it on by running <code class="function">db.setProfilingLevel()<a data-type="indexterm" data-primary="db.setProfilingLevel()" id="idm45882337940488"/></code> in the shell:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">setProfilingLevel</code><code class="p">(</code><code class="mi">2</code><code class="p">)</code>
<code class="p">{</code> <code class="s2">"was"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="s2">"slowms"</code> <code class="o">:</code> <code class="mi">100</code><code class="p">,</code> <code class="s2">"ok"</code> <code class="o">:</code> <code class="mi">1</code> <code class="p">}</code></pre><p>Level 2 means “profile everything.” Every read and write request
    received by the database will be recorded in the <em class="filename">system.profile</em> collection of the current
    database. Profiling is enabled per-database and incurs a heavy performance
    penalty: every write has to be written an extra time and every read has to
    take a write lock (because it must write an entry to the <em class="filename">system.profile</em> collection). However, it will
    give you an exhaustive listing of what your system is doing:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">foo</code><code class="p">.</code><code class="nx">insert</code><code class="p">({</code><code class="nx">x</code><code class="o">:</code><code class="mi">1</code><code class="p">})</code>
<code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">foo</code><code class="p">.</code><code class="nx">update</code><code class="p">({},{</code><code class="nx">$set</code><code class="o">:</code><code class="p">{</code><code class="nx">x</code><code class="o">:</code><code class="mi">2</code><code class="p">}})</code>
<code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">foo</code><code class="p">.</code><code class="nx">remove</code><code class="p">()</code>
<code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">system</code><code class="p">.</code><code class="nx">profile</code><code class="p">.</code><code class="nx">find</code><code class="p">().</code><code class="nx">pretty</code><code class="p">()</code>
<code class="p">{</code>
    <code class="s2">"op"</code> <code class="o">:</code> <code class="s2">"insert"</code><code class="p">,</code>
    <code class="s2">"ns"</code> <code class="o">:</code> <code class="s2">"sample_mflix.foo"</code><code class="p">,</code>
    <code class="s2">"command"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"insert"</code> <code class="o">:</code> <code class="s2">"foo"</code><code class="p">,</code>
        <code class="s2">"ordered"</code> <code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
        <code class="s2">"lsid"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"id"</code> <code class="o">:</code> <code class="nx">UUID</code><code class="p">(</code><code class="s2">"63b7df66-ca97-41f4-a245-eba825485147"</code><code class="p">)</code>
        <code class="p">},</code>
        <code class="s2">"$readPreference"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"mode"</code> <code class="o">:</code> <code class="s2">"secondaryPreferred"</code>
        <code class="p">},</code>
        <code class="s2">"$db"</code> <code class="o">:</code> <code class="s2">"sample_mflix"</code>
    <code class="p">},</code>
    <code class="s2">"ninserted"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"keysInserted"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"numYield"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"locks"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code> <code class="p">},</code>
    <code class="s2">"flowControl"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">3</code><code class="p">)</code>
    <code class="p">},</code>
    <code class="s2">"responseLength"</code> <code class="o">:</code> <code class="mi">45</code><code class="p">,</code>
    <code class="s2">"protocol"</code> <code class="o">:</code> <code class="s2">"op_msg"</code><code class="p">,</code>
    <code class="s2">"millis"</code> <code class="o">:</code> <code class="mi">33</code><code class="p">,</code>
    <code class="s2">"client"</code> <code class="o">:</code> <code class="s2">"127.0.0.1"</code><code class="p">,</code>
    <code class="s2">"appName"</code> <code class="o">:</code> <code class="s2">"MongoDB Shell"</code><code class="p">,</code>
    <code class="s2">"allUsers"</code> <code class="o">:</code> <code class="p">[</code> <code class="p">],</code>
    <code class="s2">"user"</code> <code class="o">:</code> <code class="s2">""</code>
<code class="p">}</code>
<code class="p">{</code>
    <code class="s2">"op"</code> <code class="o">:</code> <code class="s2">"update"</code><code class="p">,</code>
    <code class="s2">"ns"</code> <code class="o">:</code> <code class="s2">"sample_mflix.foo"</code><code class="p">,</code>
    <code class="s2">"command"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"q"</code> <code class="o">:</code> <code class="p">{</code>

        <code class="p">},</code>
        <code class="s2">"u"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"$set"</code> <code class="o">:</code> <code class="p">{</code>
                <code class="s2">"x"</code> <code class="o">:</code> <code class="mi">2</code>
            <code class="p">}</code>
        <code class="p">},</code>
        <code class="s2">"multi"</code> <code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
        <code class="s2">"upsert"</code> <code class="o">:</code> <code class="kc">false</code>
    <code class="p">},</code>
    <code class="s2">"keysExamined"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"docsExamined"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"nMatched"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"nModified"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"numYield"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"locks"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code> <code class="p">},</code>
    <code class="s2">"flowControl"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
    <code class="p">},</code>
    <code class="s2">"millis"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"planSummary"</code> <code class="o">:</code> <code class="s2">"COLLSCAN"</code><code class="p">,</code>
    <code class="s2">"execStats"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code>
        <code class="s2">"inputStage"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="p">...</code>
        <code class="p">}</code>
    <code class="p">},</code>
    <code class="s2">"ts"</code> <code class="o">:</code> <code class="nx">ISODate</code><code class="p">(</code><code class="s2">"2019-09-03T22:39:33.856Z"</code><code class="p">),</code>
    <code class="s2">"client"</code> <code class="o">:</code> <code class="s2">"127.0.0.1"</code><code class="p">,</code>
    <code class="s2">"appName"</code> <code class="o">:</code> <code class="s2">"MongoDB Shell"</code><code class="p">,</code>
    <code class="s2">"allUsers"</code> <code class="o">:</code> <code class="p">[</code> <code class="p">],</code>
    <code class="s2">"user"</code> <code class="o">:</code> <code class="s2">""</code>
<code class="p">}</code>
<code class="p">{</code>
     <code class="s2">"op"</code> <code class="o">:</code> <code class="s2">"remove"</code><code class="p">,</code>
    <code class="s2">"ns"</code> <code class="o">:</code> <code class="s2">"sample_mflix.foo"</code><code class="p">,</code>
    <code class="s2">"command"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"q"</code> <code class="o">:</code> <code class="p">{</code>

        <code class="p">},</code>
        <code class="s2">"limit"</code> <code class="o">:</code> <code class="mi">0</code>
    <code class="p">},</code>
    <code class="s2">"keysExamined"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"docsExamined"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"ndeleted"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"keysDeleted"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"numYield"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"locks"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code> <code class="p">},</code>
    <code class="s2">"flowControl"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"acquireCount"</code> <code class="o">:</code> <code class="nx">NumberLong</code><code class="p">(</code><code class="mi">1</code><code class="p">)</code>
    <code class="p">},</code>
    <code class="s2">"millis"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"planSummary"</code> <code class="o">:</code> <code class="s2">"COLLSCAN"</code><code class="p">,</code>
    <code class="s2">"execStats"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code>
        <code class="s2">"inputStage"</code> <code class="o">:</code> <code class="p">{</code> <code class="p">...</code> <code class="p">}</code>
    <code class="p">},</code>
    <code class="s2">"ts"</code> <code class="o">:</code> <code class="nx">ISODate</code><code class="p">(</code><code class="s2">"2019-09-03T22:39:33.858Z"</code><code class="p">),</code>
    <code class="s2">"client"</code> <code class="o">:</code> <code class="s2">"127.0.0.1"</code><code class="p">,</code>
    <code class="s2">"appName"</code> <code class="o">:</code> <code class="s2">"MongoDB Shell"</code><code class="p">,</code>
    <code class="s2">"allUsers"</code> <code class="o">:</code> <code class="p">[</code> <code class="p">],</code>
    <code class="s2">"user"</code> <code class="o">:</code> <code class="s2">""</code>
<code class="p">}</code></pre><p>You can use the <code>"client"</code> field to
    see which users are sending which operations to the database. If you’re
    using authentication, you can see which user is doing each operation,
    too.</p><p>Often, you do not care about most of the operations that your
    database is doing, just the slow ones. For this, you can set the profiling
    level to 1. By default, level 1 profiles operations that take longer than
    100 ms. You can also specify a second argument, which defines what “slow”
    means to you. This would record all operations that took longer than 500
    ms:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">setProfilingLevel</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="mi">500</code><code class="p">)</code>
<code class="p">{</code> <code class="s2">"was"</code> <code class="o">:</code> <code class="mi">2</code><code class="p">,</code> <code class="s2">"slowms"</code> <code class="o">:</code> <code class="mi">100</code><code class="p">,</code> <code class="s2">"ok"</code> <code class="o">:</code> <code class="mi">1</code> <code class="p">}</code></pre><p>To turn profiling off, set the profiling level to 0:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">setProfilingLevel</code><code class="p">(</code><code class="mi">0</code><code class="p">)</code>
<code class="p">{</code> <code class="s2">"was"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="s2">"slowms"</code> <code class="o">:</code> <code class="mi">500</code><code class="p">,</code> <code class="s2">"ok"</code> <code class="o">:</code> <code class="mi">1</code> <code class="p">}</code></pre><p>It’s generally not a good idea to set <code class="option">slowms</code> to a
    low value. Even with profiling off, <code class="option">slowms</code> has an effect
    on <em class="filename">mongod</em>: it sets the threshold for
    printing slow operations in the log. Thus, if you set
    <code class="option">slowms</code> to <code>2</code>, every
    operation that takes longer than 2 ms will show up in the log, even with
    profiling off. So, if you lower <code class="option">slowms</code> to profile
    something, you might want to raise it again before turning off
    profiling.</p><p>You can see the current profiling level with <code class="function">db.getProfilingLevel()<a data-type="indexterm" data-primary="db.getProfilingLevel()" id="idm45882337242552"/></code>. The profiling level is not persistent:
    restarting the database clears the level.</p><p>There<a data-type="indexterm" data-primary="--slowms" data-primary-sortas="slowms" id="idm45882337241304"/><a data-type="indexterm" data-primary="--profile level" data-primary-sortas="profile level" id="idm45882337240200"/> are command-line options for configuring the profiling
    level, namely <code class="option">--profile <em><code>level</code></em></code>
    and <code class="option">--slowms <em><code>time</code></em></code>, but bumping
    up the profiling level is generally a temporary debugging measure, not
    something you want to add to your configuration long-term.</p><p>In MongoDB 4.2, profiler entries and diagnostic log messages were
    extended for read/write operations to help improve the identification of
    slow queries, with the addition of the <code>queryHash</code> and <code>planCacheKey</code> fields. The <code>queryHash</code> string represents a hash of the query
    shape and is dependent only on the query shape. Each query shape is
    associated with a <code>queryHash</code>, making it
    easier to highlight those queries using the same shape. The <code>planCacheKey</code> is the hash of the key for the plan
    cache entry associated with the query. It includes the details of both the
    query shape and the currently available indexes for the shape. These help
    you correlate the available information from the profiler to assist with
    query performance diagnosis.</p><p>If you turn on profiling and the <em class="filename">system.profile</em> collection does not already
    exist, MongoDB creates a small capped collection for it (a few megabytes
    in size). If you want to run the profiler for an extended period of time,
    this may not be enough space for the number of operations you need to
    record. You can make a larger <em class="filename">system.profile</em> collection by turning off
    profiling, dropping the <em class="filename">system.profile</em> collection, and creating a new
    <em class="filename">system.profile</em> capped collection that
    is the size you desire. Then enable profiling on the<a data-type="indexterm" data-startref="sysprof18" id="idm45882337229704"/> database.</p></div></section><section data-type="sect1" data-pdf-bookmark="Calculating Sizes"><div class="sect1" id="idm45882337972872"><h1>Calculating Sizes</h1><p>In order to provision the correct amount of disk and RAM, it is
    useful to know how much space documents, indexes, collections, and
    databases are taking up. See <a data-type="xref" href="ch22.xhtml#working-set">“Calculating the Working Set”</a> for
    information on calculating your working set.</p><section data-type="sect2" data-pdf-bookmark="Documents"><div class="sect2" id="idm45882337226904"><h2>Documents</h2><p>The<a data-type="indexterm" data-primary="documents" data-secondary="calculating size of" id="idm45882337225928"/><a data-type="indexterm" data-primary="application operations" data-secondary="calculating sizes" data-tertiary="documents" id="idm45882337224696"/> easiest way to get the size of a document is to use the
      shell’s <code class="function">Object.bsonsize()<a data-type="indexterm" data-primary="Object.bsonsize()" id="idm45882337222536"/></code> function. Pass in any document to get the size
      it would be when stored in MongoDB.</p><p>For<a data-type="indexterm" data-primary="ObjectIDs" data-secondary="storing _ids as" id="idm45882337200616"/> example, you can see that storing <code>_id</code>s as <code class="classname">ObjectId</code>s is
      more efficient than storing them as strings:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">bsonsize</code><code class="p">({</code><code class="nx">_id</code><code class="o">:</code><code class="nx">ObjectId</code><code class="p">()})</code>
<code class="mi">22</code>
<code class="o">&gt;</code> <code class="c1">// ""+ObjectId() converts the ObjectId to a string</code>
<code class="o">&gt;</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">bsonsize</code><code class="p">({</code><code class="nx">_id</code><code class="o">:</code><code class="s2">""</code><code class="o">+</code><code class="nx">ObjectId</code><code class="p">()})</code>
<code class="mi">39</code></pre><p>More practically, you can pass in documents directly from your
      collections:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">bsonsize</code><code class="p">(</code><code class="nx">db</code><code class="p">.</code><code class="nx">users</code><code class="p">.</code><code class="nx">findOne</code><code class="p">())</code></pre><p>This shows you exactly how many bytes a document is taking up on
      disk. However, this does not count padding or indexes, which can often
      be significant factors in the size of a collection.</p></div></section><section data-type="sect2" data-pdf-bookmark="Collections"><div class="sect2" id="idm45882337156456"><h2>Collections</h2><p>For<a data-type="indexterm" data-primary="stats function" id="idm45882337155576"/><a data-type="indexterm" data-primary="collections" data-secondary="calculating size of" id="idm45882337175672"/><a data-type="indexterm" data-primary="application operations" data-secondary="calculating sizes" data-tertiary="collections" id="idm45882337174568"/> seeing information about a whole collection, there is a
      <code class="function">stats</code> function:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code><code class="nx">db</code><code class="p">.</code><code class="nx">movies</code><code class="p">.</code><code class="nx">stats</code><code class="p">()</code>
<code class="p">{</code>
    <code class="s2">"ns"</code> <code class="o">:</code> <code class="s2">"sample_mflix.movies"</code><code class="p">,</code>
    <code class="s2">"size"</code> <code class="o">:</code> <code class="mi">65782298</code><code class="p">,</code>
    <code class="s2">"count"</code> <code class="o">:</code> <code class="mi">45993</code><code class="p">,</code>
    <code class="s2">"avgObjSize"</code> <code class="o">:</code> <code class="mi">1430</code><code class="p">,</code>
    <code class="s2">"storageSize"</code> <code class="o">:</code> <code class="mi">45445120</code><code class="p">,</code>
    <code class="s2">"capped"</code> <code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
    <code class="s2">"wiredTiger"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"metadata"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"formatVersion"</code> <code class="o">:</code> <code class="mi">1</code>
        <code class="p">},</code>
        <code class="s2">"creationString"</code> <code class="o">:</code> <code class="s2">"access_pattern_hint=none,allocation_size=4KB,\</code>
<code class="s2">         app_metadata=(formatVersion=1),assert=(commit_timestamp=none,\</code>
<code class="s2">         read_timestamp=none),block_allocation=best,block_compressor=\</code>
<code class="s2">         snappy,cache_resident=false,checksum=on,colgroups=,collator=,\</code>
<code class="s2">         columns=,dictionary=0,encryption=(keyid=,name=),exclusive=\</code>
<code class="s2">         false,extractor=,format=btree,huffman_key=,huffman_value=,\</code>
<code class="s2">         ignore_in_memory_cache_size=false,immutable=false,internal_item_\</code>
<code class="s2">         max=0,internal_key_max=0,internal_key_truncate=true,internal_\</code>
<code class="s2">         page_max=4KB,key_format=q,key_gap=10,leaf_item_max=0,leaf_key_\</code>
<code class="s2">         max=0,leaf_page_max=32KB,leaf_value_max=64MB,log=(enabled=true),\</code>
<code class="s2">         lsm=(auto_throttle=true,bloom=true,bloom_bit_count=16,bloom_\</code>
<code class="s2">         config=,bloom_hash_count=8,bloom_oldest=false,chunk_count_limit\</code>
<code class="s2">         =0,chunk_max=5GB,chunk_size=10MB,merge_custom=(prefix=,start_\</code>
<code class="s2">         generation=0,suffix=),merge_max=15,merge_min=0),memory_page_image\</code>
<code class="s2">         _max=0,memory_page_max=10m,os_cache_dirty_max=0,os_cache_max=0,\</code>
<code class="s2">         prefix_compression=false,prefix_compression_min=4,source=,split_\</code>
<code class="s2">         deepen_min_child=0,split_deepen_per_child=0,split_pct=90,type=file,\</code>
<code class="s2">         value_format=u"</code><code class="p">,</code>
        <code class="s2">"type"</code> <code class="o">:</code> <code class="s2">"file"</code><code class="p">,</code>
        <code class="s2">"uri"</code> <code class="o">:</code> <code class="s2">"statistics:table:collection-14--2146526997547809066"</code><code class="p">,</code>
        <code class="s2">"LSM"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"bloom filter false positives"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"bloom filter hits"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"bloom filter misses"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"bloom filter pages evicted from cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"bloom filter pages read into cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"bloom filters in the LSM tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"chunks in the LSM tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"highest merge generation in the LSM tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"queries that could have benefited from a Bloom filter </code>
<code class="s2">                that did not exist"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"sleep for LSM checkpoint throttle"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"sleep for LSM merge throttle"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"total size of bloom filters"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"block-manager"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"allocations requiring file extension"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"blocks allocated"</code> <code class="o">:</code> <code class="mi">1358</code><code class="p">,</code>
            <code class="s2">"blocks freed"</code> <code class="o">:</code> <code class="mi">1322</code><code class="p">,</code>
            <code class="s2">"checkpoint size"</code> <code class="o">:</code> <code class="mi">39219200</code><code class="p">,</code>
            <code class="s2">"file allocation unit size"</code> <code class="o">:</code> <code class="mi">4096</code><code class="p">,</code>
            <code class="s2">"file bytes available for reuse"</code> <code class="o">:</code> <code class="mi">6209536</code><code class="p">,</code>
            <code class="s2">"file magic number"</code> <code class="o">:</code> <code class="mi">120897</code><code class="p">,</code>
            <code class="s2">"file major version number"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="s2">"file size in bytes"</code> <code class="o">:</code> <code class="mi">45445120</code><code class="p">,</code>
            <code class="s2">"minor version number"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"btree"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"btree checkpoint generation"</code> <code class="o">:</code> <code class="mi">22</code><code class="p">,</code>
            <code class="s2">"column-store fixed-size leaf pages"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"column-store internal pages"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"column-store variable-size RLE encoded values"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"column-store variable-size deleted values"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"column-store variable-size leaf pages"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"fixed-record size"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"maximum internal page key size"</code> <code class="o">:</code> <code class="mi">368</code><code class="p">,</code>
            <code class="s2">"maximum internal page size"</code> <code class="o">:</code> <code class="mi">4096</code><code class="p">,</code>
            <code class="s2">"maximum leaf page key size"</code> <code class="o">:</code> <code class="mi">2867</code><code class="p">,</code>
            <code class="s2">"maximum leaf page size"</code> <code class="o">:</code> <code class="mi">32768</code><code class="p">,</code>
            <code class="s2">"maximum leaf page value size"</code> <code class="o">:</code> <code class="mi">67108864</code><code class="p">,</code>
            <code class="s2">"maximum tree depth"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"number of key/value pairs"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"overflow pages"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages rewritten by compaction"</code> <code class="o">:</code> <code class="mi">1312</code><code class="p">,</code>
            <code class="s2">"row-store empty values"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"row-store internal pages"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"row-store leaf pages"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"cache"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"bytes currently in the cache"</code> <code class="o">:</code> <code class="mi">40481692</code><code class="p">,</code>
            <code class="s2">"bytes dirty in the cache cumulative"</code> <code class="o">:</code> <code class="mi">40992192</code><code class="p">,</code>
            <code class="s2">"bytes read into cache"</code> <code class="o">:</code> <code class="mi">37064798</code><code class="p">,</code>
            <code class="s2">"bytes written from cache"</code> <code class="o">:</code> <code class="mi">37019396</code><code class="p">,</code>
            <code class="s2">"checkpoint blocked page eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"data source pages selected for eviction unable to be evicted"</code> <code class="o">:</code> <code class="mi">32</code><code class="p">,</code>
            <code class="s2">"eviction walk passes of a file"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walk target pages histogram - 0-9"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walk target pages histogram - 10-31"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walk target pages histogram - 128 and higher"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walk target pages histogram - 32-63"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walk target pages histogram - 64-128"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks abandoned"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks gave up because they restarted their walk twice"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks gave up because they saw too many pages </code>
<code class="s2">            and found no candidates"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks gave up because they saw too many pages </code>
<code class="s2">            and found too few candidates"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks reached end of tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks started from root of tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"eviction walks started from saved location in tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"hazard pointer blocked page eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"in-memory page passed criteria to be split"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"in-memory page splits"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"internal pages evicted"</code> <code class="o">:</code> <code class="mi">8</code><code class="p">,</code>
            <code class="s2">"internal pages split during eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"leaf pages split during eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"modified pages evicted"</code> <code class="o">:</code> <code class="mi">1312</code><code class="p">,</code>
            <code class="s2">"overflow pages read into cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"page split during eviction deepened the tree"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"page written requiring cache overflow records"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages read into cache"</code> <code class="o">:</code> <code class="mi">1330</code><code class="p">,</code>
            <code class="s2">"pages read into cache after truncate"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages read into cache after truncate in prepare state"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages read into cache requiring cache overflow entries"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages requested from the cache"</code> <code class="o">:</code> <code class="mi">3383</code><code class="p">,</code>
            <code class="s2">"pages seen by eviction walk"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"pages written from cache"</code> <code class="o">:</code> <code class="mi">1334</code><code class="p">,</code>
            <code class="s2">"pages written requiring in-memory restoration"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"tracked dirty bytes in the cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"unmodified pages evicted"</code> <code class="o">:</code> <code class="mi">8</code>
        <code class="p">},</code>
        <code class="s2">"cache_walk"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"Average difference between current eviction generation </code>
<code class="s2">            when the page was last considered"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Average on-disk page image size seen"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Average time in cache for pages that have been visited </code>
<code class="s2">            by the eviction server"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Average time in cache for pages that have not been visited</code>
<code class="s2">            by the eviction server"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Clean pages currently in cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Current eviction generation"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Dirty pages currently in cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Entries in the root page"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Internal pages currently in cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Leaf pages currently in cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Maximum difference between current eviction generation </code>
<code class="s2">            when the page was last considered"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Maximum page size seen"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Minimum on-disk page image size seen"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Number of pages never visited by eviction server"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"On-disk page image sizes smaller than a single allocation unit"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Pages created in memory and never written"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Pages currently queued for eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Pages that could not be queued for eviction"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Refs skipped during cache traversal"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Size of the root page"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"Total number of pages currently in cache"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"compression"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"compressed page maximum internal page size </code>
<code class="s2">            prior to compression"</code> <code class="o">:</code> <code class="mi">4096</code><code class="p">,</code>
            <code class="s2">"compressed page maximum leaf page size </code>
<code class="s2">            prior to compression "</code> <code class="o">:</code> <code class="mi">131072</code><code class="p">,</code>
            <code class="s2">"compressed pages read"</code> <code class="o">:</code> <code class="mi">1313</code><code class="p">,</code>
            <code class="s2">"compressed pages written"</code> <code class="o">:</code> <code class="mi">1311</code><code class="p">,</code>
            <code class="s2">"page written failed to compress"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="s2">"page written was too small to compress"</code> <code class="o">:</code> <code class="mi">22</code>
        <code class="p">},</code>
        <code class="s2">"cursor"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"bulk loaded cursor insert calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"cache cursors reuse count"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"close calls that result in cache"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"create calls"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="s2">"insert calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"insert key and value bytes"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"modify"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"modify key and value bytes affected"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"modify value bytes modified"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"next calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"open cursor count"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"operation restarted"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"prev calls"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="s2">"remove calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"remove key bytes removed"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"reserve calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"reset calls"</code> <code class="o">:</code> <code class="mi">2</code><code class="p">,</code>
            <code class="s2">"search calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"search near calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"truncate calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"update calls"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"update key and value bytes"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"update value size change"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"reconciliation"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"dictionary matches"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"fast-path pages deleted"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"internal page key bytes discarded using suffix compression"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"internal page multi-block writes"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"internal-page overflow keys"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"leaf page key bytes discarded using prefix compression"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"leaf page multi-block writes"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"leaf-page overflow keys"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"maximum blocks required for a page"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
            <code class="s2">"overflow values written"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"page checksum matches"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
            <code class="s2">"page reconciliation calls"</code> <code class="o">:</code> <code class="mi">1334</code><code class="p">,</code>
            <code class="s2">"page reconciliation calls for eviction"</code> <code class="o">:</code> <code class="mi">1312</code><code class="p">,</code>
            <code class="s2">"pages deleted"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">},</code>
        <code class="s2">"session"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"object compaction"</code> <code class="o">:</code> <code class="mi">4</code>
        <code class="p">},</code>
        <code class="s2">"transaction"</code> <code class="o">:</code> <code class="p">{</code>
            <code class="s2">"update conflicts"</code> <code class="o">:</code> <code class="mi">0</code>
        <code class="p">}</code>
    <code class="p">},</code>
    <code class="s2">"nindexes"</code> <code class="o">:</code> <code class="mi">5</code><code class="p">,</code>
    <code class="s2">"indexBuilds"</code> <code class="o">:</code> <code class="p">[</code> <code class="p">],</code>
    <code class="s2">"totalIndexSize"</code> <code class="o">:</code> <code class="mi">46292992</code><code class="p">,</code>
    <code class="s2">"indexSizes"</code> <code class="o">:</code> <code class="p">{</code>
        <code class="s2">"_id_"</code> <code class="o">:</code> <code class="mi">446464</code><code class="p">,</code>
        <code class="s2">"$**_text"</code> <code class="o">:</code> <code class="mi">44474368</code><code class="p">,</code>
        <code class="s2">"genres_1_imdb.rating_1_metacritic_1"</code> <code class="o">:</code> <code class="mi">724992</code><code class="p">,</code>
        <code class="s2">"tomatoes_rating"</code> <code class="o">:</code> <code class="mi">307200</code><code class="p">,</code>
        <code class="s2">"getMovies"</code> <code class="o">:</code> <code class="mi">339968</code>
    <code class="p">},</code>
    <code class="s2">"scaleFactor"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"ok"</code> <code class="o">:</code> <code class="mi">1</code>
<code class="p">}</code></pre><p><code class="function">stats</code> starts with the
      namespace (<code>"sample_mflix.movies"</code>) and
      then the count of all documents in the collection. The next couple of
      fields have to do with the size of the collection. <code>"size"</code> is what you’d get if you called
      <code class="function">Object.bsonsize()</code> on each element
      in the collection and added up all the sizes: it’s the actual number of
      bytes in memory the documents in the collection are taking up when
      uncompressed. Equivalently, if you take the <code>"avgObjSize"</code> and multiply it by <code>"count"</code>, you’ll get <code>"size"</code> uncompressed in memory.</p><p>As mentioned earlier, a total count of the documents’ bytes leaves
      out the space saved by compressing a collection. <code>"storageSize"</code> can be a smaller figure than
      <code>"size"</code>, reflecting the space saved by
      compression.</p><p><code>"nindexes"</code> is the number of
      indexes on the collection. An index is not counted in <code>"nindexes"</code> until it finishes being built and
      cannot be used until it appears in this list. In general, indexes will
      be a lot larger than the amount of data they store. You can minimize
      this free space by having<a data-type="indexterm" data-primary="right-balanced indexes" id="idm45882336750840"/><a data-type="indexterm" data-primary="indexes" data-secondary="right-balanced" id="idm45882336750008"/> right-balanced indexes (as described in <a data-type="xref" href="ch05.xhtml#sec2-compound">“Introduction to Compound Indexes”</a>). Indexes that are randomly distributed will
      generally be approximately 50% free space, whereas ascending-order
      indexes will be 10% free space.</p><p>As your collections get bigger, it may become difficult to read
      <code class="function">stats</code> output with sizes in the
      billions of bytes or beyond. Thus, you can pass in a scaling factor:
      <code>1024</code> for kilobytes, <code>1024*1024</code> for megabytes, and so on. For
      example, this would get the collection stats in terabytes:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">big</code><code class="p">.</code><code class="nx">stats</code><code class="p">(</code><code class="mi">1024</code><code class="o">*</code><code class="mi">1024</code><code class="o">*</code><code class="mi">1024</code><code class="o">*</code><code class="mi">1024</code><code class="p">)</code></pre></div></section><section data-type="sect2" data-pdf-bookmark="Databases"><div class="sect2" id="idm45882336745464"><h2>Databases</h2><p>Databases<a data-type="indexterm" data-primary="databases" data-secondary="calculating size of" id="idm45882336738040"/><a data-type="indexterm" data-primary="application operations" data-secondary="calculating sizes" data-tertiary="databases" id="idm45882336737000"/> have a <code class="function">stats</code>
      function that’s similar to collections’:</p><pre data-type="programlisting" data-code-language="javascript"><code class="o">&gt;</code> <code class="nx">db</code><code class="p">.</code><code class="nx">stats</code><code class="p">()</code>
<code class="p">{</code>
    <code class="s2">"db"</code> <code class="o">:</code> <code class="s2">"sample_mflix"</code><code class="p">,</code>
    <code class="s2">"collections"</code> <code class="o">:</code> <code class="mi">5</code><code class="p">,</code>
    <code class="s2">"views"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"objects"</code> <code class="o">:</code> <code class="mi">98308</code><code class="p">,</code>
    <code class="s2">"avgObjSize"</code> <code class="o">:</code> <code class="mf">819.8680982219148</code><code class="p">,</code>
    <code class="s2">"dataSize"</code> <code class="o">:</code> <code class="mi">80599593</code><code class="p">,</code>
    <code class="s2">"storageSize"</code> <code class="o">:</code> <code class="mi">53620736</code><code class="p">,</code>
    <code class="s2">"numExtents"</code> <code class="o">:</code> <code class="mi">0</code><code class="p">,</code>
    <code class="s2">"indexes"</code> <code class="o">:</code> <code class="mi">12</code><code class="p">,</code>
    <code class="s2">"indexSize"</code> <code class="o">:</code> <code class="mi">47001600</code><code class="p">,</code>
    <code class="s2">"scaleFactor"</code> <code class="o">:</code> <code class="mi">1</code><code class="p">,</code>
    <code class="s2">"fsUsedSize"</code> <code class="o">:</code> <code class="mi">355637043200</code><code class="p">,</code>
    <code class="s2">"fsTotalSize"</code> <code class="o">:</code> <code class="mi">499963174912</code><code class="p">,</code>
    <code class="s2">"ok"</code> <code class="o">:</code> <code class="mi">1</code>
<code class="p">}</code></pre><p>First, we have the name of the database, the number of collections
      it contains, and the number of views for the database. <code>"objects"</code> is the total count of documents
      across all collections in this database.</p><p>The bulk of the document contains information about the size of
      your data. <span class="keep-together"><code>"fsTotalSize"</code></span> should always be the
      largest: it is the total size of the disk capacity on the filesystem
      where the MongoDB instance stores data. <code>"fsUsedSize"</code> represents the total space used
      in that filesystem by MongoDB currently. This should correspond to the
      total space used by all the files in your data directory.</p><p>The next-largest field is generally going to be <code>"dataSize"</code>, which is the size of the
      uncompressed data held in this database. This doesn’t match <code>"storageSize"</code> because data is typically
      compressed in WiredTiger. <code>"indexSize"</code>
      is the amount of space all of the indexes for this database take
      up.</p><p><code class="function">db.stats()</code> can take a scale
      argument the same way that the collections’ <code class="function">stats</code> function can. If you call <code class="function">db.stats(<a data-type="indexterm" data-primary="db.stats()" id="idm45882335900792"/>)</code> on a nonexistent database, the values will
      all be zero.</p><p>Keep in mind that listing databases on a system with a high lock
      percent can be very slow and block other operations. Avoid doing it, if
      possible.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="Using mongotop and mongostat"><div class="sect1" id="idm45882335899240"><h1>Using mongotop and mongostat</h1><p>MongoDB<a data-type="indexterm" data-primary="mongostat" id="idm45882335898360"/><a data-type="indexterm" data-primary="mongotop" id="idm45882335897496"/><a data-type="indexterm" data-primary="stats, printing" data-seealso="application operations" id="idm45882335896664"/><a data-type="indexterm" data-primary="application operations" data-secondary="printing stats every few seconds" id="idm45882335895560"/> comes with a few command-line tools that can help you
    determine what it’s doing by printing stats every few seconds.</p><p>mongotop is similar to the <em>top</em> Unix
    utility<a data-type="indexterm" data-primary="top Unix utility" id="idm45882335893320"/>: it gives you an overview of which<a data-type="indexterm" data-primary="collections" data-secondary="determining busiest" id="idm45882335892328"/> collections are busiest. You can also run <code>mongotop --locks</code> to give you locking
    statistics<a data-type="indexterm" data-primary="locking statistics" id="idm45882335890616"/> for each<a data-type="indexterm" data-primary="databases" data-secondary="locking statistics on" id="idm45882335889656"/> database.</p><p>mongostat gives<a data-type="indexterm" data-primary="servers" data-secondary="printing statistics about" id="idm45882335888232"/> server-wide information. By default, <code>mongostat</code> prints out a list of statistics once
    per second, although this is configurable by passing a different number of
    seconds on the command line. Each of the fields gives a count of how many
    times the activity has happened since the field was last printed:</p><dl><dt><code>insert/query/update/delete/getmore/command</code></dt><dd><p>Simple counts of how many of each of these operations there
          have been.</p></dd><dt><code>flushes</code></dt><dd><p>How many times <em class="filename">mongod</em> has
          flushed data to disk.</p></dd><dt><code>mapped</code></dt><dd><p>The amount of memory <em class="filename">mongod</em> has mapped. This is generally
          roughly the size of your data directory.</p></dd><dt><code>vsize</code></dt><dd><p>The amount of virtual memory <em class="filename">mongod</em> is using. This is generally twice
          the size of your data directory (once for the mapped files, once
          again for journaling).</p></dd><dt><code>res</code></dt><dd><p>The amount of memory <em class="filename">mongod</em> is using. This should generally be
          as close as possible to all the memory on the machine.</p></dd><dt><code>locked db</code></dt><dd><p>The database that spent the most time locked in the last
          timeslice. This field reports the percent of time the database was
          locked combined with how long the global lock was held, meaning that
          this value might be over 100%.</p></dd><dt><code>idx miss %</code></dt><dd><p>The percentage of index accesses that had to page fault
          (because the index entry or section of index being searched was not
          in memory, so <em class="filename">mongod</em> had to go
          to disk). This is the most confusingly named field in the
          output.</p></dd><dt><code>qr|qw</code></dt><dd><p>The queue size for reads and writes (i.e., how many reads and
          writes are blocking, waiting to be processed).</p></dd><dt><code>ar|aw</code></dt><dd><p>How many active clients there are (i.e., clients currently
          performing reads and writes).</p></dd><dt><code>netIn</code></dt><dd><p>The number of network bytes in, as counted by MongoDB (not
          necessarily the same as what the OS would measure).</p></dd><dt><code>netOut</code></dt><dd><p>The number of network bytes out, as counted by MongoDB.</p></dd><dt><code>conn</code></dt><dd><p>The number of connections this server has open, both incoming
          and outgoing.</p></dd><dt><code>time</code></dt><dd><p>The time at which these statistics were taken.</p></dd></dl><p>You can run <em class="filename">mongostat</em> on a
    replica set or sharded cluster. If you use the <code class="option">--discover</code>
    option, <em class="filename">mongostat</em> will try to find
    all the members of the set or cluster from the member it initially
    connects to and will print one line per server per second for each. For a
    large cluster, this can get unmanageable fast, but it can be useful for
    small clusters and tools that can consume the data and present it in a
    more readable form.</p><p><em class="filename">mongostat</em> is a great way to get
    a quick snapshot of what your database is doing, but for long-term
    monitoring a tool like MongoDB Atlas or Ops Manager<a data-type="indexterm" data-startref="AAcurrent18" id="idm45882335866824"/> is preferred (see
    <a data-type="xref" href="ch22.xhtml#chapter-mms">Chapter 22</a>).</p></div></section></div></section></div>



  </body></html>