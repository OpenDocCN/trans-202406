<html><head></head><body><section data-pdf-bookmark="Chapter 3. Getting Kubernetes" data-type="chapter" epub:type="chapter"><div class="chapter" id="gettingk8s">&#13;
<h1><span class="label">Chapter 3. </span>Getting Kubernetes</h1>&#13;
&#13;
<blockquote class="epigraph">&#13;
<p>Perplexity is the beginning of knowledge.</p>&#13;
<p data-type="attribution">Kahlil Gibran</p>&#13;
</blockquote>&#13;
&#13;
<p><a data-primary="Kubernetes" data-secondary="installation and management" data-type="indexterm" id="ix_03-clusters-adoc0"/>Kubernetes is the operating system of the cloud native world, providing a reliable and scalable platform for running containerized workloads. But how should you run Kubernetes? Should you host it yourself? On cloud instances? On bare-metal servers? Or should you use a managed Kubernetes service? Or a managed platform that’s based on Kubernetes, but extends it with workflow tools, dashboards, and web interfaces?</p>&#13;
&#13;
<p>That’s a lot of questions for one chapter to answer, but we’ll try.</p>&#13;
&#13;
<p>It’s worth noting that we won’t be particularly concerned here with the technical details of operating Kubernetes itself, such as building, tuning, and troubleshooting clusters. There are many excellent resources to help you with that, of which we particularly recommend Brendan Burns’ and Craig Tracey’s book <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920146667.do"><em>Managing Kubernetes: Operating Kubernetes Clusters in the Real World</em></a> (O’Reilly).</p>&#13;
&#13;
<p>Instead, we’ll focus on helping you understand the basic architecture of a cluster, and give you the information you need to decide how to run Kubernetes. We’ll outline the pros and cons of managed services, and look at some of the popular vendors.</p>&#13;
&#13;
<p>If you want to run your own Kubernetes cluster, we list some of the best installation tools available to help you set up and manage clusters.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cluster Architecture" data-type="sect1"><div class="sect1" id="idm45979390168240">&#13;
<h1>Cluster Architecture</h1>&#13;
&#13;
<p><a data-primary="clusters" data-secondary="architecture" data-type="indexterm" id="ix_03-clusters-adoc1"/><a data-primary="installation and management" data-secondary="cluster architecture" data-type="indexterm" id="ix_03-clusters-adoc2"/>You know that Kubernetes connects multiple servers into a <em>cluster</em>, but what is a cluster, and how does it work? The technical details don’t matter for the purposes of this book, but you should understand the basic components of Kubernetes and how they fit together, in order to understand what your options are when it comes to building or buying Kubernetes clusters.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Control Plane" data-type="sect2"><div class="sect2" id="idm45979390163712">&#13;
<h2>The Control Plane</h2>&#13;
&#13;
<p><a data-primary="control plane" data-secondary="purpose of" data-type="indexterm" id="idm45979390162336"/>The cluster’s brain is called the <em>control plane</em>, and it runs all the tasks required for Kubernetes to do its job: scheduling containers, managing Services, serving API requests, and so on (see <a data-type="xref" href="#img-cluster">Figure 3-1</a>).</p>&#13;
&#13;
<figure><div class="figure" id="img-cluster">&#13;
<img alt="Diagram of a Kubernetes cluster" src="assets/cndk_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>How a Kubernetes cluster works</h6>&#13;
</div></figure>&#13;
&#13;
<p>The control plane is actually made up of several components:</p>&#13;
<dl>&#13;
<dt><a data-primary="kube-apiserver" data-type="indexterm" id="idm45979390156096"/><code>kube-apiserver</code></dt>&#13;
<dd>&#13;
<p>This is the frontend server for the control plane, handling API requests.</p>&#13;
</dd>&#13;
<dt><a data-primary="etcd" data-type="indexterm" id="idm45979390153984"/><code>etcd</code></dt>&#13;
<dd>&#13;
<p>This is the database where Kubernetes stores all its information: what nodes exist, what resources exist on the cluster, and so on.</p>&#13;
</dd>&#13;
<dt><a data-primary="kube-scheduler" data-type="indexterm" id="idm45979390151872"/><a data-primary="scheduler" data-secondary="kube-scheduler" data-type="indexterm" id="idm45979390151168"/><code>kube-scheduler</code></dt>&#13;
<dd>&#13;
<p>This decides where to run newly created Pods.</p>&#13;
</dd>&#13;
<dt><a data-primary="kube-controller-manager" data-type="indexterm" id="idm45979390148816"/><code>kube-controller-manager</code></dt>&#13;
<dd>&#13;
<p>This is responsible for running resource controllers, such as Deployments.</p>&#13;
</dd>&#13;
<dt><a data-primary="cloud-controller-manager" data-type="indexterm" id="idm45979390146704"/><code>cloud-controller-manager</code></dt>&#13;
<dd>&#13;
<p>This interacts with the cloud provider (in cloud-based clusters), managing resources such as load balancers and disk volumes.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The control-plane components in a production cluster typically run on multiple servers to ensure high availability.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Node Components" data-type="sect2"><div class="sect2" id="nodecomponents">&#13;
<h2>Node Components</h2>&#13;
&#13;
<p><a data-primary="clusters" data-secondary="node types" data-type="indexterm" id="idm45979390142544"/>Cluster members that run user workloads are called <em>worker nodes</em>.</p>&#13;
&#13;
<p><a data-primary="worker nodes" data-secondary="components" data-type="indexterm" id="idm45979390140672"/>Each worker node in a Kubernetes cluster runs these components:</p>&#13;
<dl>&#13;
<dt><a data-primary="kubelet" data-type="indexterm" id="idm45979390138720"/><code>kubelet</code></dt>&#13;
<dd>&#13;
<p>This is responsible for driving the container runtime to start workloads that are scheduled on the node, and monitoring their status.</p>&#13;
</dd>&#13;
<dt><a data-primary="kube-proxy" data-type="indexterm" id="idm45979390136432"/><code>kube-proxy</code></dt>&#13;
<dd>&#13;
<p>This does the networking magic that routes requests between Pods on different nodes, and between Pods and the internet.</p>&#13;
</dd>&#13;
<dt><a data-primary="containers" data-secondary="runtime" data-type="indexterm" id="idm45979390134192"/><em>Container runtime</em></dt>&#13;
<dd>&#13;
<p>This actually starts and stops containers and handles their communications. Historically the most popular option has been Docker, but Kubernetes supports other container runtimes as well, such as <a href="https://containerd.io">containerd</a> and <a href="https://oreil.ly/RsqHR">CRI-O</a>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Other than running different containerized components, there’s no intrinsic difference between a node running control plane components and worker nodes that run application workloads. Typically, nodes running the control plane components do not also run user-created workloads, except in very small clusters (like Docker Desktop or Minikube).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="High Availability" data-type="sect2"><div class="sect2" id="highavailability">&#13;
<h2>High Availability</h2>&#13;
&#13;
<p><a data-primary="high availability" data-secondary="configuring" data-type="indexterm" id="idm45979390128496"/>A correctly configured Kubernetes cluster has multiple control plane nodes, making it <em>highly available</em>; that is, if any individual node fails or is shut down, or one of the control plane components on it stops running, the cluster will still work properly. A highly available control plane will also handle the situation where the control plane nodes are working properly, but some of them cannot communicate with the others, due to a network failure (known as a <em>network partition</em>).</p>&#13;
&#13;
<p>The <code>etcd</code> database is replicated across multiple nodes, and can survive the failure of individual nodes, so long as a quorum of over half the original number of <code>etcd</code> replicas is still available.</p>&#13;
&#13;
<p>If all of this is configured correctly, the control plane can survive a reboot or temporary failure of individual nodes.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Control plane failure" data-type="sect3"><div class="sect3" id="idm45979390124592">&#13;
<h3>Control plane failure</h3>&#13;
&#13;
<p><a data-primary="control plane" data-secondary="failure" data-type="indexterm" id="idm45979390122976"/>A damaged control plane doesn’t necessarily mean that your applications will go down, although it might well cause strange and erratic behavior.</p>&#13;
&#13;
<p>For example, if you were to stop all the control plane nodes in your cluster, the Pods on the worker nodes would keep on running—at least for a while. But you would be unable to deploy any new containers or change any Kubernetes resources, and controllers such as Deployments would stop working.</p>&#13;
&#13;
<p>Therefore, high availability of the control plane is critical to a properly functioning cluster. <a data-primary="master nodes, minimum number" data-type="indexterm" id="idm45979390120800"/>You need to have enough control plane nodes available that the cluster can maintain a <em>quorum</em> even if one fails; for production clusters, the workable minimum is three (see <a data-type="xref" href="ch06.html#smallest">“The smallest cluster”</a>).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Worker node failure" data-type="sect3"><div class="sect3" id="idm45979390118528">&#13;
<h3>Worker node failure</h3>&#13;
&#13;
<p><a data-primary="worker nodes" data-secondary="failure" data-type="indexterm" id="idm45979390117152"/>By contrast, the failure of any single worker node shouldn’t really matter as long as applications are configured to run with more than one replica. Kubernetes will detect the failure and reschedule the node’s Pods somewhere else, so long as the control plane is still working.</p>&#13;
&#13;
<p>If a large number of nodes fail at once, this might mean that the cluster no longer has enough resources to run all the workloads you need. Fortunately, this doesn’t happen often, and even if it does, Kubernetes will keep as many of your Pods running as it can while you replace the missing nodes.</p>&#13;
&#13;
<p>It’s worth bearing in mind, though, that the fewer worker nodes you have, the greater the proportion of the cluster’s capacity that each one represents. You should assume that a single-node failure could happen at any time, especially in the cloud, and two simultaneous failures are not unheard of.</p>&#13;
&#13;
<p>A rare, but entirely possible, kind of failure is losing a whole cloud <em>availability zone</em>. Cloud vendors like AWS and Google Cloud provide multiple availability zones in each region, each corresponding roughly to a single datacenter. For this reason, rather than having all your worker nodes in the same zone, it’s a good idea to distribute them across two or even three zones.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Trust, but verify" data-type="sect3"><div class="sect3" id="trustbutverify">&#13;
<h3>Trust, but verify</h3>&#13;
&#13;
<p><a data-primary="high availability" data-secondary="testing" data-type="indexterm" id="idm45979390112736"/>Although high availability should enable your cluster to survive losing some nodes, it’s always wise to <em>actually test</em> this. During a scheduled maintenance window, or outside of peak hours, try rebooting a worker and see what happens. (Hopefully, nothing, or nothing that’s visible to users of your applications.) Then, if you can, try rebooting a control plane node. See if you are able to continue running <code>kubectl</code> commands while the node is down.</p>&#13;
&#13;
<p>For a more demanding test, reboot one of the control plane nodes. (Managed services such as Amazon EKS, Azure AKS, or Google Kubernetes Engine (GKE), which we’ll discuss later in the chapter, don’t allow you to do this). Still, a production-grade cluster should survive this with no problems whatsoever.<a data-startref="ix_03-clusters-adoc2" data-type="indexterm" id="idm45979390110288"/><a data-startref="ix_03-clusters-adoc1" data-type="indexterm" id="idm45979390109584"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Costs of Self-Hosting Kubernetes" data-type="sect1"><div class="sect1" id="selfhosted">&#13;
<h1>The Costs of Self-Hosting Kubernetes</h1>&#13;
&#13;
<p><a data-primary="clusters" data-secondary="self-hosted" data-type="indexterm" id="ix_03-clusters-adoc3"/><a data-primary="installation and management" data-secondary="self-hosting costs" data-type="indexterm" id="ix_03-clusters-adoc4"/><a data-primary="self-hosting" data-type="indexterm" id="ix_03-clusters-adoc5"/>The most important decision facing anyone who’s considering running production workloads in Kubernetes is <em>buy or build?</em> Should you run your own clusters, or pay someone else to run them? Let’s look at some of the options.</p>&#13;
&#13;
<p>The most basic choice of all is self-hosted Kubernetes. By <em>self-hosted</em> we mean that you, personally, or a team in your organization, install and configure Kubernetes, on machines that you own or control, just as you might do with any other software that you use, such as Redis, PostgreSQL, or NGINX.</p>&#13;
&#13;
<p>This is the option that gives you the maximum flexibility and control. You can decide what versions of Kubernetes to run, what options and features are enabled, when and whether to upgrade clusters, and so on. But there are some significant downsides, as we’ll see in the next section.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="It’s More Work Than You Think" data-type="sect2"><div class="sect2" id="idm45979390101280">&#13;
<h2>It’s More Work Than You Think</h2>&#13;
&#13;
<p>The self-hosted option also requires the maximum resources, in terms of people, skills, engineering time, maintenance, and troubleshooting. Just setting up a working Kubernetes cluster is pretty simple, but that’s a long way from a cluster that’s ready for production. You need to consider at least the following questions:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Is the control plane highly available? That is, if any node goes down or becomes unresponsive, does your cluster still work? Can you still deploy or update apps? Will your running applications still be fault-tolerant without the control plane? (See <a data-type="xref" href="#highavailability">“High Availability”</a>.)</p>&#13;
</li>&#13;
<li>&#13;
<p>Is your pool of worker nodes highly available? That is, if an outage should take down several worker nodes, or even a whole cloud availability zone, will your workloads stop running? Will your cluster keep working? Will it be able to automatically provision new nodes to heal itself, or will it require manual intervention?</p>&#13;
</li>&#13;
<li>&#13;
<p>Is your cluster set up <em>securely</em>? Do its internal components communicate using TLS encryption and trusted certificates? Do users and applications have minimal rights and permissions for cluster operations? Are container security defaults set properly? Do nodes have unnecessary access to control plane components? Is access to the underlying <code>etcd</code> database properly controlled and authenticated?</p>&#13;
</li>&#13;
<li>&#13;
<p>Are all services in your cluster secure? If they’re accessible from the internet, are they properly authenticated and authorized? Is access to the cluster API strictly limited?</p>&#13;
</li>&#13;
<li>&#13;
<p>Is your cluster <em>conformant</em>? Does it meet the standards for Kubernetes clusters defined by the Cloud Native Computing Foundation? (See <a data-type="xref" href="ch06.html#conformance">“Conformance Checking”</a> for details.)</p>&#13;
</li>&#13;
<li>&#13;
<p>Are your cluster nodes fully <em>config-managed</em>, rather than being set up by imperative shell scripts and then left alone? The operating system and kernel on each node needs to be updated, have security patches applied, and so on.</p>&#13;
</li>&#13;
<li>&#13;
<p>Is the data in your cluster properly backed up, including any persistent storage? What is your restore process? How often do you test restores?</p>&#13;
</li>&#13;
<li>&#13;
<p>Once you have a working cluster, how do you maintain it over time? How do you provision new nodes? Roll out config changes to existing nodes? Roll out Kubernetes updates? Scale in response to demand? Enforce policies?</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="It’s Not Just About the Initial Setup" data-type="sect2"><div class="sect2" id="idm45979390088528">&#13;
<h2>It’s Not Just About the Initial Setup</h2>&#13;
&#13;
<p>Now bear in mind that you need to pay attention to these factors not just when setting up the first cluster for the first time, but for all your clusters for all time. When you make changes or upgrades to your Kubernetes infrastructure, you need to consider the impact on high availability, security, and so on.</p>&#13;
&#13;
<p>You’ll need to have monitoring in place to make sure the cluster nodes and all the Kubernetes components are working properly. You’ll also need an alerting system so that staff can be paged to deal with any problems, day or night.</p>&#13;
&#13;
<p>Kubernetes is still in rapid development, and new features and updates are being released all the time. You’ll need to keep your cluster up-to-date with those, and understand how the changes affect your existing setup. You may need to reprovision your cluster to get the full benefit of the latest Kubernetes functionality.</p>&#13;
&#13;
<p>It’s also not enough to read a few books or articles, configure the cluster the right way, and leave it at that. You need to test and verify the configuration on a regular basis—by taking down any random control plane node and making sure everything still works, for example.</p>&#13;
&#13;
<p>Automated resilience testing tools such as <a href="https://oreil.ly/WbiHD">Netflix’s Chaos Monkey</a> can help with this, by randomly killing nodes, Pods, or network connections every so often. Depending on the reliability of your cloud provider, you may find that Chaos Monkey is unnecessary, as regular real-world failures will also test the resilience of your cluster and the services running on it (see <a data-type="xref" href="ch06.html#chaos">“Chaos Testing”</a>).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Tools Don’t Do All the Work for You" data-type="sect2"><div class="sect2" id="idm45979390083072">&#13;
<h2>Tools Don’t Do All the Work for You</h2>&#13;
&#13;
<p>There are tools—lots and lots of tools—to help you set up and configure Kubernetes clusters, and many of them advertise themselves as being more or less point-and-click, zero-effort, instant solutions. The sad fact is that in our opinion, the large majority of these tools solve only the easy problems, and ignore the hard ones.</p>&#13;
&#13;
<p>On the other hand, powerful, flexible, enterprise-grade commercial tools tend to be very expensive, or not even available to the public, since there’s more money to be made selling a managed service than there is selling a general-purpose cluster management tool.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Kubernetes the Hard Way" data-type="sect2"><div class="sect2" id="idm45979390081104">&#13;
<h2>Kubernetes the Hard Way</h2>&#13;
&#13;
<p><a data-primary="Hightower, Kelsey" data-type="indexterm" id="idm45979390079904"/><a data-primary="Kubernetes The Hard Way (Hightower)" data-type="indexterm" id="idm45979390079200"/>Kelsey Hightower’s <a href="https://oreil.ly/Chk5v"><em>Kubernetes the Hard Way</em></a> tutorial is perhaps one of the best ways to get familiar with all of the underlying components of a Kubernetes cluster. It illustrates the complexity of the moving parts involved and it’s an exercise worth doing for anyone considering running Kubernetes, even as a managed service, just to get a sense of how it all works under the hood.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Kubernetes Is Hard" data-type="sect2"><div class="sect2" id="idm45979390077232">&#13;
<h2>Kubernetes Is Hard</h2>&#13;
&#13;
<p>Despite the widespread notion that it’s simple to set up and manage, the truth is that <em>Kubernetes is hard</em>. Considering what it does, it’s remarkably simple and well designed, but it has to deal with very complex situations, and that leads to complex software.</p>&#13;
&#13;
<p>Make no mistake, there is a significant investment of time and energy involved in both learning how to manage your own clusters properly, and actually doing it from day to day, month to month. We don’t want to discourage you from using Kubernetes, but we want you to have a clear understanding of what’s involved in running Kubernetes yourself. This will help you to make an informed decision about the costs and benefits of self-hosting, as opposed to using managed services.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Administration Overhead" data-type="sect2"><div class="sect2" id="idm45979390074736">&#13;
<h2>Administration Overhead</h2>&#13;
&#13;
<p><a data-primary="clusters" data-secondary="administration overhead" data-type="indexterm" id="idm45979390073536"/>If your organization is large, with resources to spare for a dedicated Kubernetes cluster operations team, this may not be such a big problem. But for small to medium enterprises, or even startups with a handful of engineers, the administration overhead of running your own Kubernetes clusters may be prohibitive.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Given a limited budget and number of staff available for IT operations, what proportion of your resources do you want to spend on administering Kubernetes itself? Would those resources be better used to support your business’s workloads instead? Can you operate Kubernetes more cost-effectively with your own staff, or by using a managed service?</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Start with Managed Services" data-type="sect2"><div class="sect2" id="idm45979390071072">&#13;
<h2>Start with Managed Services</h2>&#13;
&#13;
<p>You might be a little surprised that, in a Kubernetes book, we recommend that you don’t run Kubernetes! At least, don’t run the control plane yourself. For the reasons we’ve outlined in the previous sections, we think that using managed services is likely to be far more cost-effective than self-hosting Kubernetes clusters. Unless you want to do something strange and experimental with Kubernetes that isn’t supported by any managed provider, there are basically no good reasons to go the self-hosted route.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>In our experience, and that of many of the people we interviewed for this book, a managed service is the best way to run Kubernetes, period.</p>&#13;
</div>&#13;
&#13;
<p>If you’re considering whether Kubernetes is even an option for you, using a managed service is a great way to try it out. You can get a fully working, secure, highly available, production-grade cluster in a few minutes, for a few dollars a day. (Most cloud providers even offer a free tier that lets you run a Kubernetes cluster for weeks or months without incurring any charges.)&#13;
Even if you decide, after a trial period, that you’d prefer to run your own Kubernetes cluster, the managed services will show you how it should be done.</p>&#13;
&#13;
<p>On the other hand, if you’ve already experimented with setting up Kubernetes yourself, you’ll be delighted with how much easier managed services make the process. You probably didn’t build your own house; why build your own cluster, when it’s cheaper and quicker to have someone else do it, and the results are better?</p>&#13;
&#13;
<p>In the next section, we’ll outline some of the most popular managed Kubernetes services, tell you what we think of them, and recommend our favorite. If you’re still not convinced, the second half of the chapter will explore Kubernetes installers you can use to build your own clusters (see <a data-type="xref" href="#installers">“Kubernetes Installers”</a>).</p>&#13;
&#13;
<p>We should say at this point that neither of the authors is affiliated with any cloud provider or commercial Kubernetes vendor. Nobody’s paying us to recommend their product or service. The opinions here are our own, based on personal experience and the views of hundreds of Kubernetes users we spoke to while writing this book.</p>&#13;
&#13;
<p>Naturally, things move quickly in the Kubernetes world, and the managed services marketplace is especially competitive. Expect the features and services described here to change rapidly. The list presented here is not complete, but we’ve tried to include the services we feel are the best, the most widely used, or otherwise important.<a data-startref="ix_03-clusters-adoc5" data-type="indexterm" id="idm45979390065216"/><a data-startref="ix_03-clusters-adoc4" data-type="indexterm" id="idm45979390064512"/><a data-startref="ix_03-clusters-adoc3" data-type="indexterm" id="idm45979390063840"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Managed Kubernetes Services" data-type="sect1"><div class="sect1" id="managedclusters">&#13;
<h1>Managed Kubernetes Services</h1>&#13;
&#13;
<p><a data-primary="installation and management" data-secondary="managed Kubernetes services" data-type="indexterm" id="ix_03-clusters-adoc6"/>Managed <a data-primary="managed services" data-secondary="benefits of" data-type="indexterm" id="idm45979390059696"/>Kubernetes services relieve you of almost all the administration overhead of setting up and running Kubernetes clusters, particularly the control plane. Effectively, a managed service means you pay for someone else (such as Microsoft, Amazon, or Google) to run the cluster for you.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Google Kubernetes Engine (GKE)" data-type="sect2"><div class="sect2" id="gke">&#13;
<h2>Google Kubernetes Engine (GKE)</h2>&#13;
&#13;
<p><a data-primary="GKE" data-see="Google Kubernetes Engine" data-type="indexterm" id="idm45979390056880"/><a data-primary="Google Kubernetes Engine (GKE)" data-secondary="benefits of" data-type="indexterm" id="idm45979390055840"/><a data-primary="managed services" data-secondary="Google Kubernetes Engine" data-type="indexterm" id="idm45979390054880"/>As you’d expect from the originators of Kubernetes, Google offers a <a href="https://oreil.ly/srHGH">fully managed Kubernetes service</a> that is completely integrated with the Google Cloud Platform (GCP). You can deploy clusters using the GCP web console <code>gcloud CLI</code>, or their <a href="https://oreil.ly/xPD8J">Terraform module</a>. Within a few minutes, your cluster will be ready to use.</p>&#13;
&#13;
<p>Google takes care of monitoring and replacing failed nodes, and auto-applying security patches. You can set your clusters to automatically upgrade to the latest version of Kubernetes that’s available, during a maintenance window of your choice.</p>&#13;
&#13;
<p><a data-primary="high availability" data-secondary="Google Kubernetes Engine" data-type="indexterm" id="idm45979390051040"/>For extended high availability, you can create <em>multizone</em> clusters, which spread worker nodes across multiple failure zones (roughly equivalent to individual datacenters). Your workloads will keep on running, even if a whole failure zone is affected by an outage.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cluster Autoscaling" data-type="sect2"><div class="sect2" id="idm45979390049296">&#13;
<h2>Cluster Autoscaling</h2>&#13;
&#13;
<p><a data-primary="autoscaling" data-secondary="clusters" data-type="indexterm" id="idm45979390048096"/><a data-primary="clusters" data-secondary="autoscaling" data-type="indexterm" id="idm45979390047120"/><a data-primary="managed services" data-secondary="cluster autoscaling" data-type="indexterm" id="idm45979390046176"/>GKE also offers a cluster autoscaling option (see <a data-type="xref" href="ch06.html#autoscaling">“Autoscaling”</a>). With autoscaling enabled, if there are pending workloads that are waiting for a node to become available, the system will add new nodes automatically to accommodate the demand.</p>&#13;
&#13;
<p>Conversely, if there is spare capacity, the autoscaler will consolidate Pods onto a smaller number of nodes and remove the unused nodes. Since billing for GKE is based on the number of worker nodes, this helps you control costs.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Autopilot" data-type="sect2"><div class="sect2" id="idm45979390043408">&#13;
<h2>Autopilot</h2>&#13;
&#13;
<p><a data-primary="Autopilot" data-type="indexterm" id="idm45979390042208"/><a data-primary="Google Kubernetes Engine (GKE)" data-secondary="Autopilot tier" data-type="indexterm" id="idm45979390041504"/><a data-primary="managed services" data-secondary="Autopilot" data-type="indexterm" id="idm45979390040592"/>Google also offers a tier for GKE called <em>Autopilot</em> that takes the managed service one step further. While most hosted offerings take care of managing the control plane node, Autopilot also fully manages the worker nodes. You are billed for the CPU and memory that your Pods request, and the actual worker node VMs are abstracted away from you. For teams that want the flexibility of Kubernetes, but do not care much about the underlying servers where the containers end up running, this would be an option worth considering.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Amazon Elastic Kubernetes Service (EKS)" data-type="sect2"><div class="sect2" id="idm45979390038320">&#13;
<h2>Amazon Elastic Kubernetes Service (EKS)</h2>&#13;
&#13;
<p><a data-primary="Elastic Kubernetes Service (EKS)" data-type="indexterm" id="idm45979390036976"/><a data-primary="Elastic Container Service (ECS)" data-type="indexterm" id="idm45979390036208"/><a data-primary="managed services" data-secondary="Elastic Container Service for Kubernetes" data-type="indexterm" id="idm45979390035520"/>Amazon has also been providing managed container cluster services for a long time, but until very recently the only option was Elastic Container Service (ECS), Amazon’s proprietary technology for running containers on EC2 virtual machines. While perfectly usable, <a href="https://aws.amazon.com/ecs">ECS</a> is not as powerful or flexible as Kubernetes, and evidently even Amazon has decided that the future is Kubernetes, with the launch of Elastic Kubernetes Service (EKS).</p>&#13;
&#13;
<p>Amazon has the most popular public cloud offering today, and most cloud deployments of Kubernetes are running in AWS. If you already have your infrastructure in AWS and are looking to migrate your applications to Kubernetes, then EKS is a sensible choice. Amazon takes care of managing the control plane nodes, and you deploy your containers to EC2 instance worker nodes.</p>&#13;
&#13;
<p>If you wish to set up <a href="https://oreil.ly/3cux9">centralized logging with CloudWatch</a> or <a href="https://oreil.ly/dNxd2">cluster auto-scaling</a>, you’ll need to configure those once the cluster is up and running. This makes for less of a “batteries-included” experience than some of the other hosted offerings on the market, but depending on your environment and use-case, you may wish to customize or leave out these features anyway.</p>&#13;
&#13;
<p id="eksctl">There are a few options for deploying EKS clusters including using the AWS Management Console, the <code>aws</code> CLI tool, an open source CLI tool called <a href="https://eksctl.io"><code>eksctl</code></a>, and there is a popular <a href="https://oreil.ly/ZupGB">EKS Terraform module</a>. Each of these tools can automate creating the various IAM, VPC, and EC2 resources needed for a functioning Kubernetes cluster. <code>eksctl</code> can additionally handle setting up additional components, like CloudWatch logging, or installing various add-ons as part of provisioning the cluster, making it a more full-featured out-of-box Kubernetes experience.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Azure Kubernetes Service (AKS)" data-type="sect2"><div class="sect2" id="idm45979390027472">&#13;
<h2>Azure Kubernetes Service (AKS)</h2>&#13;
&#13;
<p><a data-primary="AKS (Azure Kubernetes Service)" data-type="indexterm" id="idm45979390026304"/><a data-primary="Azure Kubernetes Service (AKS)" data-type="indexterm" id="idm45979390025536"/><a data-primary="managed services" data-secondary="Azure Kubernetes Service" data-type="indexterm" id="idm45979390024848"/><a href="https://oreil.ly/f1Eab">Azure Kubernetes Service (AKS)</a> is the Microsoft option for hosted Kubernetes clusters on Azure. AKS has traditionally rolled out support for newer versions of Kubernetes before their GKE or EKS competitors. You can create clusters from the Azure web interface or using the Azure <code>az</code> command-line tool, or their <a href="https://oreil.ly/rKCtD">Terraform AKS module</a>.</p>&#13;
&#13;
<p>As with GKE and EKS, you have the option to hand off managing the control plane nodes, and your billing is based on the number of worker nodes in your cluster. AKS also supports <a href="https://oreil.ly/997iu">cluster autoscaling</a> to adjust the number of worker nodes based on usage.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="IBM Cloud Kubernetes Service" data-type="sect2"><div class="sect2" id="idm45979390020192">&#13;
<h2>IBM Cloud Kubernetes Service</h2>&#13;
&#13;
<p><a data-primary="IBM Cloud Kubernetes Service" data-type="indexterm" id="idm45979390018976"/><a data-primary="managed services" data-secondary="IBM Cloud Kubernetes Service" data-type="indexterm" id="idm45979390018208"/>Naturally, the venerable IBM is not to be left out in the field of managed Kubernetes services. <a href="https://oreil.ly/i5d38">IBM Cloud Kubernetes Service</a> is pretty simple and straightforward, allowing you to set up a vanilla Kubernetes cluster in IBM Cloud.</p>&#13;
&#13;
<p>You can access and manage your IBM Cloud cluster through the default Kubernetes CLI and the provided command-line tool, or a basic GUI. There are no real killer features that differentiate IBM’s offering from the other major cloud providers, but it’s a logical option if you’re already using IBM Cloud.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="DigitalOcean Kubernetes" data-type="sect2"><div class="sect2" id="idm45979390015264">&#13;
<h2>DigitalOcean Kubernetes</h2>&#13;
&#13;
<p><a data-primary="DigitalOcean Kubernetes" data-type="indexterm" id="idm45979390014064"/><a data-primary="managed services" data-secondary="DigitalOcean Kubernetes" data-type="indexterm" id="idm45979390013360"/>DigitalOcean is known for providing a simple cloud offering with excellent documentation and tutorials for developers. Recently they started offering a managed Kubernetes offering called, not surprisingly, <a href="https://oreil.ly/nGwZj">DigitalOcean Kubernetes</a>. Like AKS, they do not charge for running the managed control plane nodes, and you are billed for the worker nodes where your applications run.<a data-startref="ix_03-clusters-adoc6" data-type="indexterm" id="idm45979390011472"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Kubernetes Installers" data-type="sect1"><div class="sect1" id="installers">&#13;
<h1>Kubernetes Installers</h1>&#13;
&#13;
<p><a data-primary="installation and management" data-secondary="Kubernetes installers" data-type="indexterm" id="ix_03-clusters-adoc7"/>If managed or turnkey clusters won’t work for you, then you’ll need to consider some level of Kubernetes self-hosting: that is, setting up and running Kubernetes yourself on your own machines.</p>&#13;
&#13;
<p>It’s very unlikely that you’ll deploy and run Kubernetes completely from scratch, except for learning and demo purposes. The vast majority of people use one or more of the available Kubernetes installer tools or services to set up and manage their <span class="keep-together">clusters</span>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="kops" data-type="sect2"><div class="sect2" id="kops">&#13;
<h2>kops</h2>&#13;
&#13;
<p><a data-primary="kops" data-type="indexterm" id="idm45979390004176"/><a data-primary="Kubernetes operations (kops)" data-type="indexterm" id="idm45979390003472"/><a href="https://oreil.ly/pP3GI">kops</a> is a command-line tool for automated provisioning of Kubernetes clusters. It’s part of the Kubernetes project, and has been around a long time as an AWS-specific tool, but is now adding alpha and beta support for other providers as well including Google Cloud, DigitalOcean, Azure, and OpenStack.</p>&#13;
&#13;
<p>kops supports building high-availability clusters, which makes it suitable for production Kubernetes deployments. It uses declarative configuration, just like Kubernetes resources themselves, and it can not only provision the necessary cloud resources and set up a cluster, but also scale it up and down, resize nodes, perform upgrades, and do other useful admin tasks.</p>&#13;
&#13;
<p>Like everything in the Kubernetes world, kops is under rapid development, but it’s a relatively mature and sophisticated tool that is widely used. If you’re planning to run self-hosted Kubernetes in AWS, kops is a good choice.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Kubespray" data-type="sect2"><div class="sect2" id="idm45979390000848">&#13;
<h2>Kubespray</h2>&#13;
&#13;
<p><a data-primary="Kubespray" data-type="indexterm" id="idm45979389999648"/><a href="https://oreil.ly/tFRoX">Kubespray</a> (formerly known as Kargo), a project under the Kubernetes umbrella, is a tool for easily deploying production-ready clusters. It offers lots of options, including high availability, and support for multiple platforms.</p>&#13;
&#13;
<p>Kubespray is focused on installing Kubernetes on existing machines, especially on-premise and bare-metal servers. However, it’s also suitable for any cloud environment, including private cloud (virtual machines that run on your own servers). It uses Ansible Playbooks, so if you have experience using Ansible for configuration management of your servers, then this would be an option worth exploring.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="kubeadm" data-type="sect2"><div class="sect2" id="idm45979389997616">&#13;
<h2>kubeadm</h2>&#13;
&#13;
<p><a data-primary="kubeadm" data-type="indexterm" id="idm45979389996416"/><a href="https://oreil.ly/MeyTC">kubeadm</a> is part of the Kubernetes distribution, and it aims to help you install and maintain a Kubernetes cluster according to best practices. kubeadm does not provision the infrastructure for the cluster itself, so it’s suitable for installing Kubernetes on bare-metal servers or cloud instances of any flavor.</p>&#13;
&#13;
<p>Many of the other tools and services we’ll mention in this chapter use kubeadm internally to handle cluster-admin operations, but there’s nothing to stop you using it directly, if you want to.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Rancher Kubernetes Engine (RKE)" data-type="sect2"><div class="sect2" id="idm45979389994064">&#13;
<h2>Rancher Kubernetes Engine (RKE)</h2>&#13;
&#13;
<p><a data-primary="Rancher Kubernetes Engine (RKE)" data-type="indexterm" id="idm45979389992896"/><a data-primary="RKE (Rancher Kubernetes Engine)" data-type="indexterm" id="idm45979389992176"/><a href="https://oreil.ly/K09qx">RKE</a> aims to be a simple, fast Kubernetes installer. It doesn’t provision the nodes for you, and you have to install Docker on the nodes yourself before you can use RKE to install the cluster. RKE supports high availability of the Kubernetes control plane.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Puppet Kubernetes Module" data-type="sect2"><div class="sect2" id="puppet">&#13;
<h2>Puppet Kubernetes Module</h2>&#13;
&#13;
<p><a data-primary="Puppet Kubernetes Module" data-type="indexterm" id="idm45979389988864"/>Puppet is a powerful, mature, and sophisticated general configuration management tool that is very widely used and has a large open source module ecosystem. The officially supported <a href="https://oreil.ly/6KgK0">Kubernetes module</a> installs and configures Kubernetes on existing nodes, including high availability support for both the control plane and <code>etcd</code>.<a data-startref="ix_03-clusters-adoc7" data-type="indexterm" id="idm45979389986560"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Buy or Build: Our Recommendations" data-type="sect1"><div class="sect1" id="buyorbuild">&#13;
<h1>Buy or Build: Our Recommendations</h1>&#13;
&#13;
<p><a data-primary="installation and management" data-secondary="recommendations for" data-type="indexterm" id="ix_03-clusters-adoc8"/>This has necessarily been a quick tour of some of the options available for managing Kubernetes clusters, because the range of offerings is large and varied, and growing all the time. However, we can make a few recommendations based on commonsense principles. One of these is the philosophy of <a href="https://oreil.ly/egxan"><em>run less software</em></a>.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Run Less Software" data-type="sect2"><div class="sect2" id="runlesssoftware">&#13;
<h2>Run Less Software</h2>&#13;
<blockquote>&#13;
<p><a data-primary="run less software philosophy" data-type="indexterm" id="idm45979389979168"/>There are three pillars of the Run Less Software philosophy, all of which will help you manipulate time and defeat your enemies.</p>&#13;
<ol>&#13;
<li>&#13;
<p>Choose standard technology</p>&#13;
</li>&#13;
<li>&#13;
<p>Outsource undifferentiated heavy lifting</p>&#13;
</li>&#13;
<li>&#13;
<p>Create enduring competitive advantage</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
<p data-type="attribution">Rich Archbold</p>&#13;
</blockquote>&#13;
&#13;
<p>While using innovative new technologies is fun and exciting, it doesn’t always make sense from a business point of view. Using <em>boring</em> software that everybody else is using is generally a good bet. It probably works, it’s probably well supported, and you’re not going to be the one taking the risks and dealing with the inevitable bugs.</p>&#13;
&#13;
<p>If you’re running containerized workloads and cloud native applications, Kubernetes is the boring choice, in the best possible way. Given that, you should opt for the most mature, stable, and widely used Kubernetes tools and services.</p>&#13;
&#13;
<p><a data-primary="undifferentiated heavy lifting" data-type="indexterm" id="idm45979389972528"/><em>Undifferentiated heavy lifting</em> is a term coined at Amazon to denote all the hard work and effort that goes into things like installing and managing software, maintaining infrastructure, and so on. There’s nothing special about this work; it’s the same for you as it is for every other company out there. It costs you money, instead of making you money.</p>&#13;
&#13;
<p>The run less software philosophy says that you should outsource undifferentiated heavy lifting because it’ll be cheaper in the long run, and it frees up resources you can use to work on your core business.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use Managed Kubernetes if You Can" data-type="sect2"><div class="sect2" id="usemanaged">&#13;
<h2>Use Managed Kubernetes if You Can</h2>&#13;
&#13;
<p><a data-primary="managed services" data-secondary="recommendations for" data-type="indexterm" id="idm45979389969424"/>With the run less software principles in mind, we recommend that you outsource your Kubernetes cluster operations to a managed service. Installing, configuring, maintaining, securing, upgrading, and making your Kubernetes cluster reliable is undifferentiated heavy lifting, so it makes sense for almost all businesses not to <span class="keep-together">do it themselves.</span></p>&#13;
<blockquote data-type="quote">&#13;
<p>Cloud native is the practice of accelerating your business by not running stuff that doesn’t differentiate you.&#13;
&#13;
It’s not a cloud provider, it’s not Kubernetes, it’s not containers, it’s not a technology.</p>&#13;
<p data-type="attribution"><a href="https://oreil.ly/Zdlmn">Justin Garrison</a></p>&#13;
</blockquote>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="But What About Vendor Lock-in?" data-type="sect2"><div class="sect2" id="idm45979389965056">&#13;
<h2>But What About Vendor Lock-in?</h2>&#13;
&#13;
<p><a data-primary="vendor lock-in" data-type="indexterm" id="idm45979389963664"/>If you commit to a managed Kubernetes service from a particular vendor, such as Google Cloud, will that lock you in to the vendor and reduce your options in the future? Not necessarily. Kubernetes is a standard platform, so any applications and services you build to run on GKE will also work on any other certified Kubernetes provider’s system with possibly some minor tweaks.</p>&#13;
&#13;
<p>Does managed Kubernetes make you more prone to lock-in than running your own Kubernetes cluster? We think it’s the other way around. Self-hosting Kubernetes involves a lot of machinery and configuration to maintain, all of which is intimately tied in to a specific cloud provider’s API. Provisioning AWS virtual machines to run Kubernetes, for example, requires completely different code than the same operation on Google Cloud. Some Kubernetes setup assistants, like the ones we’ve mentioned in this chapter, support multiple cloud providers, but many don’t.</p>&#13;
&#13;
<p>Part of the point of Kubernetes is to abstract away the technical details of the underlying infrastructure, and present developers with a standard, familiar interface that works the same way whether it happens to be running on Azure or your own bare-metal servers.</p>&#13;
&#13;
<p>As long as you design your applications and automation to target Kubernetes itself, rather than the cloud infrastructure directly, you’re as free from vendor lock-in as you can reasonably be. Each infrastructure provider will have some differences as to how they define compute, networking, and storage, but to Kubernetes those present as minor tweaks to the Kubernetes manifests. The majority of Kubernetes deployments will work the same way, regardless of where they are running.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Bare-Metal and On-Prem" data-type="sect2"><div class="sect2" id="baremetal">&#13;
<h2>Bare-Metal and On-Prem</h2>&#13;
&#13;
<p><a data-primary="bare-metal servers, Kubernetes on" data-type="indexterm" id="idm45979389959344"/>It may come as a surprise to you that being cloud native doesn’t actually require being <em>in the cloud</em>, in the sense of outsourcing your infrastructure to a public cloud provider such as Azure or AWS.</p>&#13;
&#13;
<p>Many organizations run part or all of their infrastructure on bare-metal hardware, whether colocated in datacenters or on-premises. Everything we’ve said in this book about Kubernetes and containers applies just as well to in-house infrastructure as it does to the cloud.</p>&#13;
&#13;
<p>You can run Kubernetes on your own hardware machines; if your budget is limited, you can even run it on a stack of Raspberry Pis (<a data-type="xref" href="#img-pikube">Figure 3-2</a>). Some businesses run a <em>private cloud</em>, consisting of virtual machines hosted by on-prem hardware.</p>&#13;
&#13;
<figure><div class="figure" id="img-pikube">&#13;
<img alt="A stack of Raspberry Pis running Kubernetes" src="assets/cnd2_0302.png"/>&#13;
<h6><span class="label">Figure 3-2. </span>Kubernetes on a budget: a Raspberry Pi cluster (photo by David Merrick)</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Multicloud Kubernetes Clusters" data-type="sect2"><div class="sect2" id="multicloud">&#13;
<h2>Multicloud Kubernetes Clusters</h2>&#13;
&#13;
<p><a data-primary="clusters" data-secondary="multicloud" data-type="indexterm" id="idm45979389951616"/><a data-primary="multicloud clusters" data-type="indexterm" id="idm45979389950640"/>In some organizations, developers deploy applications to multiple types of infrastructure, including public cloud and private on-premise environments. Because <span class="keep-together">Kubernetes</span> can run anywhere, it has become a useful tool to standardize the experience between these multicloud or hybrid-cloud situations. There are tools available to make it easier to manage workloads across different Kubernetes clusters running in such environments.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="VMware Tanzu" data-type="sect3"><div class="sect3" id="idm45979389948784">&#13;
<h3>VMware Tanzu</h3>&#13;
&#13;
<p><a data-primary="managed services" data-secondary="VMware Tanzu" data-type="indexterm" id="idm45979389947584"/><a data-primary="Tanzu" data-type="indexterm" id="idm45979389946608"/><a data-primary="VMware Tanzu" data-type="indexterm" id="idm45979389945936"/>VMware has traditionally been associated with making tools for managing virtual machines and the related VM infrastructure. They now also have tooling for <span class="keep-together">Kubernetes</span> environments with a suite of tools called Tanzu. Specifically, <a href="https://oreil.ly/o3Bym">Tanzu Mission Control</a> allows you to centrally manage multiple Kubernetes clusters, regardless of where they are running. There are also tools for building, deploying, and monitoring the containerized workloads.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="OpenShift" data-type="sect2"><div class="sect2" id="idm45979389943328">&#13;
<h2>OpenShift</h2>&#13;
&#13;
<p><a data-primary="managed services" data-secondary="OpenShift" data-type="indexterm" id="idm45979389941792"/><a data-primary="OpenShift" data-type="indexterm" id="idm45979389940816"/><a data-primary="PaaS (Platform-as-a-Service)" data-type="indexterm" id="idm45979389940144"/><a data-primary="Platform-as-a-Service (PaaS)" data-type="indexterm" id="idm45979389939456"/><a href="https://www.openshift.com">OpenShift</a> is more than just a managed Kubernetes service: it’s a full <em>Platform-as-a-Service</em> (PaaS) product, which aims to manage the whole software development life cycle, including continuous integration and build tools, test runner, application deployment, monitoring, and orchestration.</p>&#13;
&#13;
<p>OpenShift can be deployed to bare-metal servers, virtual machines, private clouds, and public clouds, so you can create a single Kubernetes cluster that spans all these environments. This makes it a good choice for very large organizations, or those with very heterogeneous infrastructure.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Anthos" data-type="sect2"><div class="sect2" id="idm45979389936624">&#13;
<h2>Anthos</h2>&#13;
&#13;
<p><a data-primary="Anthos" data-type="indexterm" id="idm45979389935424"/><a data-primary="managed services" data-secondary="Anthos" data-type="indexterm" id="idm45979389934720"/>Similar to VMware Tanzu, Google’s <a href="https://cloud.google.com/anthos">Anthos</a> tooling makes it possible to centrally manage Kubernetes workloads in clusters that are running in multiple clouds, such as GKE, AWS, and on-premise Kubernetes environments. They also allow you to hook your on-premise infrastructure into the other services that Google Cloud offers, like their hosted container registry, build pipeline tooling, and networking layer.</p>&#13;
&#13;
<p>Most small- and mid-sized teams likely do not need to start out focused on multicloud infrastructures. These types of environments come with additional complexity and cost. We recommend starting out with the basics and building up from there. Putting your applications into containers and deploying to a managed Kubernetes cloud offering is already going a long way toward setting yourself up for future flexibility, should you ever end up needing to run your applications in multiple clouds simultaneously.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use Standard Kubernetes Self-Hosting Tools if You Must" data-type="sect2"><div class="sect2" id="idm45979389932256">&#13;
<h2>Use Standard Kubernetes Self-Hosting Tools if You Must</h2>&#13;
&#13;
<p>If you already know that you have special requirements that mean managed Kubernetes offerings won’t work for you, only then should you consider running <span class="keep-together">Kubernetes</span> yourself.</p>&#13;
&#13;
<p>If that’s the case, you should go with the most mature, powerful, and widely used tools available. We recommend starting with kubeadm, and then compare that to something like kops or Kubespray to see if they meet your requirements.</p>&#13;
&#13;
<p>On the other hand, if you need your cluster to span multiple clouds or platforms, including bare-metal servers, and you want to keep your options open, consider looking into VMware Tanzu or Google Anthos. Since most of the administration overhead of Kubernetes is in setting up and maintaining the control plane, this is a good compromise.<a data-startref="ix_03-clusters-adoc8" data-type="indexterm" id="idm45979389929408"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Clusterless Container Services" data-type="sect1"><div class="sect1" id="clusterless">&#13;
<h1>Clusterless Container Services</h1>&#13;
&#13;
<p><a data-primary="installation and management" data-secondary="clusterless container services" data-type="indexterm" id="idm45979389926560"/>If you really want to minimize the overhead of running container workloads, there’s yet another level above fully managed Kubernetes services. These are so-called <span class="keep-together"><em>clusterless</em></span> services, such as Azure Container Instances (ACI), AWS Fargate, and Google Cloud Run. Although there really is a cluster under the hood, you don’t have access to it via tools like <code>kubectl</code>. Instead, you specify a container image to run, and a few parameters like the CPU and memory requirements of your application, and the service does the rest.</p>&#13;
&#13;
<p>These types of managed services can be great for getting containers up and running quickly, but you may run into a limitation around something like how the networking or storage works on a particular cloud provider, and you may need to turn to something a little more powerful and flexible for your applications, like the full Kubernetes platform.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="AWS Fargate" data-type="sect2"><div class="sect2" id="idm45979389923440">&#13;
<h2>AWS Fargate</h2>&#13;
&#13;
<p><a data-primary="Elastic Container Service (ECS)" data-type="indexterm" id="idm45979389922240"/><a data-primary="Fargate" data-type="indexterm" id="idm45979389921520"/>According to Amazon, “Fargate is like EC2, but instead of a virtual machine, you get a container.” Unlike ECS, there’s no need to provision cluster nodes yourself and then connect them to a control plane. You just define a task, which is essentially a set of instructions for how to run your container image, and launch it. Pricing is per second based on the amount of CPU and memory resources that the task consumes.</p>&#13;
&#13;
<p>It’s probably fair to say that <a href="https://aws.amazon.com/fargate">Fargate</a> makes sense for simple, self-contained, long-running compute tasks or batch jobs (such as data crunching) that don’t require much customization or integration with other services. It’s also ideal for build containers, which tend to be short-lived, and for any situation where the overhead of managing worker nodes isn’t justified.</p>&#13;
&#13;
<p>If you’re already using ECS with EC2 worker nodes, switching to Fargate will relieve you of the need to provision and manage those nodes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Azure Container Instances (ACI)" data-type="sect2"><div class="sect2" id="idm45979389918752">&#13;
<h2>Azure Container Instances (ACI)</h2>&#13;
&#13;
<p><a data-primary="ACI (Azure Container Instances)" data-type="indexterm" id="idm45979389917232"/><a data-primary="Azure Container Instances (ACI)" data-type="indexterm" id="idm45979389916464"/><a href="https://oreil.ly/9sFxO">Microsoft’s Azure Container Instances (ACI)</a> service is similar to Fargate, but also offers integration with the Azure Kubernetes Service (AKS). For example, you can configure your AKS cluster to provision temporary extra Pods inside ACI to handle spikes or bursts in demand.</p>&#13;
&#13;
<p>Similarly, you can run batch jobs in ACI in an ad hoc way, without having to keep idle nodes around when there’s no work for them to do. Microsoft calls this idea <em>serverless containers</em>, but we find that terminology both confusing (<em>serverless</em> usually refers to cloud functions, or functions as a service [FaaS]) and inaccurate (there are servers; you just can’t access them).</p>&#13;
&#13;
<p><a data-primary="Azure Event Grid" data-type="indexterm" id="idm45979389913104"/>ACI is also integrated with Azure Event Grid, Microsoft’s managed event routing service. Using Event Grid, ACI containers can communicate with cloud services, cloud functions, or Kubernetes applications running in AKS.</p>&#13;
&#13;
<p>You can create, run, or pass data to ACI containers using Azure Functions. The advantage of this is that you can run any workload from a cloud function, not just those using the officially supported (<em>blessed</em>) languages, such as Python or JavaScript.</p>&#13;
&#13;
<p>If you can containerize your workload, you can run it as a cloud function, with all the associated tooling. For example, Microsoft Power Automate allows even nonprogrammers to build up workflows graphically, connecting containers, functions, and events.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Google Cloud Run" data-type="sect2"><div class="sect2" id="idm45979389910000">&#13;
<h2>Google Cloud Run</h2>&#13;
&#13;
<p><a data-primary="Google Cloud Run" data-type="indexterm" id="idm45979389908800"/>Similar to ACI and Fargate, Google Cloud Run is another “container-as-a-service” offering that hides all of the server infrastructure from you. You simply publish a container image and tell Cloud Run to run that container for every incoming web request or received <a href="https://cloud.google.com/pubsub">Pub/Sub</a> message, their hosted message-bus service. By default, the launched containers timeout after 5 minutes, although you can extend this up to 60 minutes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45979389906464">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>Kubernetes is everywhere! Our journey through the extensive landscape of <span class="keep-together">Kubernetes</span> tools, services, and products has been necessarily brief, but we hope you found it useful.</p>&#13;
&#13;
<p>While our coverage of specific products and features is as up-to-date as we can make it, the world moves pretty fast, and we expect a lot will have changed even by the time you read this.</p>&#13;
&#13;
<p>However, we think the basic point stands: it’s not worth managing Kubernetes clusters yourself if a service provider can do it better and cheaper.</p>&#13;
&#13;
<p>In our experience of consulting for companies migrating to Kubernetes, this is often a surprising idea, or at least not one that occurs to a lot of people. We often find that organizations have taken their first steps with self-hosted clusters, using tools like kops, and hadn’t really thought about using a managed service such as GKE. It’s well worth thinking about.</p>&#13;
&#13;
<p class="less_space pagebreak-before">More things to bear in mind:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Kubernetes clusters are made up of the <em>control plane</em>, and <em>worker nodes</em>, which run your workloads.</p>&#13;
</li>&#13;
<li>&#13;
<p>Production clusters must be <em>highly available</em>, meaning that the failure of a control plane node won’t lose data or affect the operation of the cluster.</p>&#13;
</li>&#13;
<li>&#13;
<p>It’s a long way from a simple demo cluster to one that’s ready for critical production workloads. High availability, security, and node management are just some of the issues involved.</p>&#13;
</li>&#13;
<li>&#13;
<p>Managing your own clusters requires a significant investment of time, effort, and expertise. Even then, you can still get it wrong.</p>&#13;
</li>&#13;
<li>&#13;
<p>Managed services like GKE, EKS, AKS, and other similar offerings do all the heavy lifting for you, at much lower cost than self-hosting.</p>&#13;
</li>&#13;
<li>&#13;
<p>If you have to host your own cluster, kops and Kubespray are mature and widely used tools that can provision and manage production-grade clusters on AWS and Google Cloud.</p>&#13;
</li>&#13;
<li>&#13;
<p>Tools like VMware Tanzu and Google Anthos make it possible to centrally manage Kubernetes clusters running in multiple clouds and on-premise infrastructure.</p>&#13;
</li>&#13;
<li>&#13;
<p>Don’t self-host your cluster without sound business reasons. If you do self-host, don’t underestimate the engineering time involved for the initial setup and ongoing maintenance overhead.<a data-startref="ix_03-clusters-adoc0" data-type="indexterm" id="idm45979389892160"/></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>