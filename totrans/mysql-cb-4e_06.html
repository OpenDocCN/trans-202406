<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Table Management"><div class="chapter" id="nch-tblmgmt"><h1><span class="label">Chapter 6. </span>Table Management</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820375251856"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="6.0 Introduction"><div class="sect1" id="nch-tblmgmt-tblmgmt-intro"><h1>6.0 Introduction</h1><p>This chapter covers topics that relate to creating and populating
    tables, including:</p><ul><li><p>Cloning a table</p></li><li><p>Copying from one table to another</p></li><li><p>Using temporary tables</p></li><li><p>Generating unique table names</p></li><li><p>Determining what storage engine a table uses or converting it
        from one storage engine to another</p></li></ul><p>Many of the examples in this chapter use a table named <code>mail</code> containing rows that track mail message
    traffic between users on a set of hosts (see <a data-type="xref" href="ch05.xhtml#nch-select-select-intro">Recipe 5.0</a>). To create and load this table,
    change location into the <em class="filename">tables</em>
    directory of the <code>recipes</code> distribution
    and run this command:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; mail.sql</code></strong></pre></div></section><section data-type="sect1" data-pdf-bookmark="6.1 Cloning a Table"><div class="sect1" id="nch-tblmgmt-tblmgmt-clone"><h1>6.1 Cloning a Table</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820375085072"><h2>Problem</h2><p>You want to create a table that has exactly the same structure as an existing
      table.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820375083984"><h2>Solution</h2><p>Use <code>CREATE</code> <code>TABLE</code> … <code>LIKE</code> to clone the table structure. To
      also copy some or all of the rows from the original table
      to the new one, use <code>INSERT</code> <code>INTO</code> … <code>SELECT</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820375082992"><h2>Discussion</h2><p>To create a new table that is just like an existing table, use
      this statement:</p><pre data-type="programlisting" data-code-language="sql">CREATE TABLE <em><code>new_table</code></em> LIKE <em><code>original_table</code></em>;</pre><p>The structure of the new table is the same as that of the original
      table, with a few exceptions: <code>CREATE</code>
      <code>TABLE</code> … <code>LIKE</code> does not copy foreign key definitions,
      and it doesn’t copy any <code>DATA</code> <code>DIRECTORY</code> or <code>INDEX</code> <code>DIRECTORY</code> table options that the table might
      use.</p><p>The new table is empty. If you also want the contents to be the
      same as the original table, copy the rows using an <code>INSERT</code> <code>INTO</code>
      … <code>SELECT</code> statement:</p><pre data-type="programlisting" data-code-language="sql">INSERT INTO <em><code>new_table</code></em> SELECT * FROM <em><code>original_table</code></em>;</pre><p>To copy only part of the table, add an appropriate <code>WHERE</code>
      clause that identifies which rows to copy. For example, these statements
      create a copy of the <code>mail</code> table named
      <code>mail2</code>, populated only with the rows
      for mail sent by <code>barb</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">mail2</code> <code class="k">LIKE</code> <code class="n">mail</code><code class="p">;</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">mail2</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">mail</code> <code class="k">WHERE</code> <code class="n">srcuser</code> <code class="o">=</code> <code class="s1">'barb'</code><code class="p">;</code></pre><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
         Selecting everything from the large table could be slow and not recommended on the production servers. We discuss how to copy huge tables in <a data-type="xref" href="#nch-tblmgmt-tblmgmt-copy-tablespaces">Recipe 6.7</a> and <a data-type="xref" href="#nch-tblmgmt-tblmgmt-copy-myisam-sdi">Recipe 6.8</a>
       </p></div></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820375033776"><h2>See Also</h2><p>For additional information about <code>INSERT</code> … <code>SELECT</code>, see <a data-type="xref" href="#nch-tblmgmt-tblmgmt-into-table">Recipe 6.2</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.2 Saving a Query Result in a Table"><div class="sect1" id="nch-tblmgmt-tblmgmt-into-table"><h1>6.2 Saving a Query Result in a Table</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820375029104"><h2>Problem</h2><p>You want to save the result from a <code>SELECT</code>
      statement to a table rather than display it.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820375027664"><h2>Solution</h2><p>If the table exists, retrieve rows into it using <code>INSERT</code> <code>INTO</code>
      … <code>SELECT</code>. If the table does not
      exist, create it on the fly using <code>CREATE</code> <code>TABLE</code> … <code>SELECT</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820375026720"><h2>Discussion</h2><p>The MySQL server normally returns the result of a <code>SELECT</code> statement to the client that executed
      the statement. For example, when you execute a statement from within the
      <span class="command"><em>mysql</em></span> program, the server returns the
      result to <span class="command"><em>mysql</em></span>, which in turn
      displays it on the screen. It’s possible to save the results of a
      <code>SELECT</code> statement in a table instead,
      which is useful in several ways:</p><ul><li><p>You can easily create a complete or partial copy of a table.
          If you’re developing an algorithm for your application that modifies a table, it’s safer
          to work with a copy of a table so that you need not worry about the
          consequences of mistakes. If the original table is large, creating a
          partial copy can speed the development process because queries run
          against it take less time.</p></li><li><p>For a data-loading operation based on information that might
          be malformed, load new rows into a test temporary table, perform some
          preliminary checks, and correct the rows as necessary. When you’re
          satisfied that the new rows are okay, copy them from the temporary
          table to your main table.</p></li><li><p>Some applications maintain a large repository table and a
          smaller working table into which rows are inserted on a regular
          basis, copying the working table rows to the repository periodically
          and clearing the working table.</p></li><li><p>To perform summary operations on a large table more
          efficiently, avoid running expensive summary operations repeatedly
          on it. Instead, select summary information once into a second table
          and use that for further analysis.</p></li></ul><p>This recipe shows how to retrieve a result set into a table. The
      table names <code>src_tbl</code> and <code>dst_tbl</code> in the examples refer to the source
      table from which rows are selected and the destination table into which
      they are stored, respectively.</p><p>If the destination table already exists, use <code>INSERT</code> … <code>SELECT</code> to copy the result set into it. For
      example, if <code>dst_tbl</code> contains an
      integer column <code>i</code> and a string column
      <code>s</code>, the following statement copies
      rows from <code>src_tbl</code> into <code>dst_tbl</code>, assigning column <code>val</code> to <code>i</code>
      and column <code>name</code> to <code>s</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">dst_tbl</code> <code class="p">(</code><code class="n">i</code><code class="p">,</code> <code class="n">s</code><code class="p">)</code> <code class="k">SELECT</code> <code class="n">val</code><code class="p">,</code> <code class="n">name</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><p>The number of columns to be inserted must match the number of selected columns,
      with the correspondence between columns based on position rather than
      name. To copy all columns, you can shorten the statement to this
      form:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><p>To copy only certain rows, add a <code>WHERE</code>
      clause that selects those rows:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code>
<code class="k">WHERE</code> <code class="n">val</code> <code class="o">&gt;</code> <code class="mi">100</code> <code class="k">AND</code> <code class="n">name</code> <code class="k">LIKE</code> <code class="s1">'A%'</code><code class="p">;</code></pre><p>The <code>SELECT</code> statement can
      produce values from expressions, too. For example, the following
      statement counts the number of times each name occurs in <code>src_tbl</code> and stores both the counts and the
      names in <code>dst_tbl</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">dst_tbl</code> <code class="p">(</code><code class="n">i</code><code class="p">,</code> <code class="n">s</code><code class="p">)</code> <code class="k">SELECT</code> <code class="k">COUNT</code><code class="p">(</code><code class="o">*</code><code class="p">),</code> <code class="n">name</code>
<code class="k">FROM</code> <code class="n">src_tbl</code> <code class="k">GROUP</code> <code class="k">BY</code> <code class="n">name</code><code class="p">;</code></pre><p>If the destination table does not exist, create it first with a
      <code>CREATE</code> <code>TABLE</code> statement, then copy rows into it with
      <code>INSERT</code> … <code>SELECT</code>. Alternatively, use <code>CREATE</code> <code>TABLE</code> … <code>SELECT</code> to create the destination table
      directly from the result of the <code>SELECT</code>. For example, to create <code>dst_tbl</code> and copy the entire contents of
      <code>src_tbl</code> into it, do this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          </p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="p">...</code> <code class="k">SELECT</code> <code class="p">...</code></pre><p> does not copy indexes from the source table. If you use this syntax and destination table should have indexes add them after the statement completes. We discuss indexes in <a data-type="xref" href="ch21.xhtml#nch-queryperf-queryperf-create-index">Recipe 21.1</a>.
        </p></div><p>MySQL creates the columns in <code>dst_tbl</code> based on the name, number, and type of
      the columns in <code>src_tbl</code>. To copy only
      certain rows, add an appropriate <code>WHERE</code> clause. To create an empty table, use a
      <code>WHERE</code> clause that selects no
      rows:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code> <code class="k">WHERE</code> <code class="k">FALSE</code><code class="p">;</code></pre><p>To copy only some of the columns, name the ones you want in the
      <code>SELECT</code> part of the statement. For
      example, if <code>src_tbl</code> contains columns
      <code>a</code>, <code>b</code>, <code>c</code>, and
      <code>d</code>, copy just <code>b</code> and <code>d</code>
      like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="n">b</code><code class="p">,</code> <code class="n">d</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><p>To create columns in an order different from that in which they
      appear in the source table, name them in the desired order. If the
      source table contains columns <code>a</code>,
      <code>b</code>, and <code>c</code> that should appear in the destination table
      in the order <code>c</code>, <code>a</code>, <code>b</code>, do
      this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="k">SELECT</code> <code class="k">c</code><code class="p">,</code> <code class="n">a</code><code class="p">,</code> <code class="n">b</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><p>To create columns in the destination table in addition to those
      selected from the source table, provide appropriate column definitions
      in the <code>CREATE</code> <code>TABLE</code> part of the statement. The following
      statement creates <code>id</code> as
      an <code>AUTO_INCREMENT</code> column in <code>dst_tbl</code> and adds columns <code>a</code>, <code>b</code>, and
      <code>c</code> from <code>src_tbl</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code>
<code class="p">(</code>
  <code class="n">id</code> <code class="nb">INT</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">)</code>
<code class="p">)</code>
<code class="k">SELECT</code> <code class="n">a</code><code class="p">,</code> <code class="n">b</code><code class="p">,</code> <code class="k">c</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre><p>The resulting table contains four columns in the order <code>id</code>, <code>a</code>,
      <code>b</code>, <code>c</code>. Defined columns are assigned their default
      values. This means that <code>id</code>, being an
      <code>AUTO_INCREMENT</code> column, is assigned
      successive sequence numbers starting from 1 (see <a data-type="xref" href="ch15.xhtml#nch-sequences-seq-create-col">Recipe 15.1</a>).</p><p>If you derive a column’s values from an expression, its default
      name is the expression itself, which can be difficult to work with
      later. In this case, it’s prudent to give the column a better name by
      providing an alias (see <a data-type="xref" href="ch05.xhtml#nch-select-select-column-alias">Recipe 5.2</a>). Suppose that <code>src_tbl</code> contains invoice information that
      lists items in each invoice. The following statement generates a summary
      that lists each invoice named in the table and the total cost of its
      items, using an alias for the expression:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code>
<code class="k">SELECT</code> <code class="n">inv_no</code><code class="p">,</code> <code class="k">SUM</code><code class="p">(</code><code class="n">unit_cost</code><code class="o">*</code><code class="n">quantity</code><code class="p">)</code> <code class="k">AS</code> <code class="n">total_cost</code>
<code class="k">FROM</code> <code class="n">src_tbl</code> <code class="k">GROUP</code> <code class="k">BY</code> <code class="n">inv_no</code><code class="p">;</code></pre><p><code>CREATE</code> <code>TABLE</code> … <code>SELECT</code> is extremely convenient, but has some
      limitations that arise from the fact that the information available from
      a result set is not as extensive as what you can specify in a <code>CREATE</code> <code>TABLE</code> statement. For example, MySQL has no
      idea whether a result set column should be indexed or what its default
      value is. If it’s important to include this information in the
      destination table, use the following techniques:</p><ul><li><p>To make the destination table an <em>exact</em>
          copy of the source table, use the cloning technique described in
          <a data-type="xref" href="#nch-tblmgmt-tblmgmt-clone">Recipe 6.1</a>.</p></li><li><p>To include indexes in the destination table, specify them
          explicitly. For example, if <code>src_tbl</code> has a <code>PRIMARY</code> <code>KEY</code> on the <code>id</code> column, and
          a multiple-column index on <code>state</code>
          and <code>city</code>, specify them for
          <code>dst_tbl</code> as well:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="p">(</code><code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">),</code> <code class="k">INDEX</code><code class="p">(</code><code class="n">state</code><code class="p">,</code><code class="n">city</code><code class="p">))</code>
<code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code></pre></li><li><p>Column attributes such as <code>AUTO_INCREMENT</code> and a column’s default
          value are not copied to the destination table. To preserve these
          attributes, create the table, then use <code>ALTER</code> <code>TABLE</code> to apply the appropriate
          modifications to the column definition. For example, if <code>src_tbl</code> has an <code>id</code> column that is not only a <code>PRIMARY</code> <code>KEY</code> but also an <code>AUTO_INCREMENT</code> column, copy the table
          and modify the copy:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="p">(</code><code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">))</code> <code class="k">SELECT</code> <code class="o">*</code> <code class="k">FROM</code> <code class="n">src_tbl</code><code class="p">;</code>
<code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">dst_tbl</code> <code class="k">MODIFY</code> <code class="n">id</code> <code class="nb">INT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">;</code></pre></li></ul></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.3 Creating Temporary Tables"><div class="sect1" id="nch-tblmgmt-tblmgmt-temp"><h1>6.3 Creating Temporary Tables</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820374477040"><h2>Problem</h2><p>You need a table only for a short time, after which you want it to
      disappear automatically.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820374447744"><h2>Solution</h2><p>Create a table using the <code>TEMPORARY</code>
      keyword, and let MySQL take care of removing it.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820374446480"><h2>Discussion</h2><p>Some operations require a table that exists only temporarily and
      that should disappear when it’s no longer needed. You can, of course,
      execute a <code>DROP</code> <code>TABLE</code> statement explicitly to remove a table
      when you’re done with it. Another option is to use <code>CREATE</code> <code>TEMPORARY</code> <code>TABLE</code>. This statement is like <code>CREATE</code> <code>TABLE</code> but creates a transient table that
      disappears when your session with the server ends, if you haven’t
      already removed it yourself. This is extremely useful behavior because
      MySQL drops the table for you automatically; you need not remember to do
      it. <code>TEMPORARY</code> can be used with the
      usual table-creation methods:</p><ul><li><p>Create the table from explicit column definitions:</p><pre data-type="programlisting" data-code-language="sql">CREATE TEMPORARY TABLE <em><code>tbl_name</code></em> (<em><code>...column definitions...</code></em>);</pre></li><li><p>Create the table from an existing table:</p><pre data-type="programlisting" data-code-language="sql">CREATE TEMPORARY TABLE <em><code>new_table</code></em> LIKE <em><code>original_table</code></em>;</pre></li><li><p>Create the table on the fly from a result set:</p><pre data-type="programlisting" data-code-language="sql">CREATE TEMPORARY TABLE <em><code>tbl_name</code></em> SELECT ... ;</pre></li></ul><p>Temporary tables are session-specific, so multiple clients can
      each create a temporary table having the same name without interfering
      with each other. This makes it easier to write applications that use
      transient tables because you need not ensure that the tables have unique
      names for each client. (For further discussion of table-naming issues,
      see <a data-type="xref" href="#nch-tblmgmt-tblmgmt-unique-name">Recipe 6.4</a>.)</p><p>A temporary table can have the same name as a permanent table. In
      this case, the temporary table <q>hides</q> the permanent table
      for the duration of its existence, which can be useful for making a copy
      of a table that you can modify without affecting the original by
      mistake. The <code>DELETE</code> statement
      in the following example removes rows from a temporary
      <code>mail</code> table, leaving the original
      permanent table unaffected:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TEMPORARY TABLE mail SELECT * FROM mail;</code></strong>
mysql&gt; <strong><code>SELECT COUNT(*) FROM mail;</code></strong>
+----------+
| COUNT(*) |
+----------+
|       16 |
+----------+
mysql&gt; <strong><code>DELETE FROM mail;</code></strong>
mysql&gt; <strong><code>SELECT COUNT(*) FROM mail;</code></strong>
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+
mysql&gt; <strong><code>DROP TEMPORARY TABLE mail;</code></strong>
mysql&gt; <strong><code>SELECT COUNT(*) FROM mail;</code></strong>
+----------+
| COUNT(*) |
+----------+
|       16 |
+----------+</pre><p>Although temporary tables created with <code>CREATE</code> <code>TEMPORARY</code> <code>TABLE</code> have the benefits just discussed, keep
      the following caveats in mind:</p><ul><li><p>To reuse a temporary table within a given session, you must
          still drop it explicitly before re-creating it. Attempting to create
          a second temporary table with the same name results in an
          error.</p></li><li><p>If you modify a temporary table that <q>hides</q> a
          permanent table with the same name, be sure to test for errors
          resulting from dropped connections if you use a programming
          interface that has reconnect capability enabled. If a client program
          automatically reconnects after detecting a dropped connection,
          modifications affect the permanent table after the reconnect, not
          the temporary table.</p></li><li><p>Some APIs support persistent connections or connection pools.
          These prevent temporary tables from being dropped as you expect when
          your script ends because the connection remains open for reuse by
          other scripts. Your script has no control over when the connection
          closes. This means it can be prudent to execute the following
          statement prior to creating a temporary table, just in case it’s
          still in existence from a previous execution of the script:</p><pre data-type="programlisting" data-code-language="sql">DROP TEMPORARY TABLE IF EXISTS <em><code>tbl_name</code></em>;</pre><p>The <code>TEMPORARY</code> keyword is
          useful here if the temporary table has already been dropped, to
          avoid dropping any permanent table that has the same name.</p></li></ul></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.4 Generating Unique Table Names"><div class="sect1" id="nch-tblmgmt-tblmgmt-unique-name"><h1>6.4 Generating Unique Table Names</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820374419344"><h2>Problem</h2><p>You need to create a table with a name guaranteed not to exist.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820374418432"><h2>Solution</h2><p>Generate a value that is unique to your client
      program and incorporate it into the table name.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820374417376"><h2>Discussion</h2><p>MySQL is a multiple-client database server, so if a given script
      that creates a transient table might be invoked by several clients
      simultaneously, take care that multiple invocations of the script do not
      fight over the same table name. If the script creates tables using
      <code>CREATE</code> <code>TEMPORARY</code> <code>TABLE</code>, there is no problem because different
      clients can create temporary tables having the same name without
      clashing.</p><p>If you cannot or do not want to use a <code>TEMPORARY</code> table, make sure that each
      invocation of the script creates a uniquely named table and drops the
      table when it is no longer needed. To accomplish this, incorporate into
      the name some value guaranteed to be unique per invocation. A timestamp
      won’t work if it’s possible for two instances of a script to be invoked
      within the timestamp resolution. A random number may be better, but
      random numbers only reduce the possibility of name clashes, not
      eliminate it. Values, generated bu function <code>UUID</code> are a better source for unique values. Function <code>UUID</code> returns  a Universal Unique Identifier (UUID) generated according to <a href="http://www.ietf.org/rfc/rfc4122.txt">RFC 4122, “A Universally Unique IDentifier (UUID) URN Namespace</a> and designed to produce 128 bits string that is unique in space and time. While the value generated by this function, is not necessary unique, it is enough to generate unique temporary table name.
      </p><p>It’s possible to incorporate a <code>UUID</code> into a table name
      within SQL by using prepared statements. The following example
      illustrates this, referring to the table name in the <code>CREATE</code> <code>TABLE</code> statement and a precautionary <code>DROP</code> <code>TABLE</code>
      statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">SET</code> <code class="o">@</code><code class="n">tbl_name</code> <code class="o">=</code> <code class="n">CONCAT</code><code class="p">(</code><code class="s1">'tmp_tbl_'</code><code class="p">,</code> <code class="n">UUID</code><code class="p">());</code>
<code class="k">SET</code> <code class="o">@</code><code class="n">stmt</code> <code class="o">=</code> <code class="n">CONCAT</code><code class="p">(</code><code class="s1">'CREATE TABLE `'</code><code class="p">,</code> <code class="o">@</code><code class="n">tbl_name</code><code class="p">,</code> <code class="s1">'` (i INT)'</code><code class="p">);</code>
<code class="k">PREPARE</code> <code class="n">stmt</code> <code class="k">FROM</code> <code class="o">@</code><code class="n">stmt</code><code class="p">;</code>
<code class="k">EXECUTE</code> <code class="n">stmt</code><code class="p">;</code>
<code class="k">DEALLOCATE</code> <code class="k">PREPARE</code> <code class="n">stmt</code><code class="p">;</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.5 Checking or Changing a Table Storage Engine"><div class="sect1" id="nch-tblmgmt-tblmgmt-table-engine"><h1>6.5 Checking or Changing a Table Storage Engine</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820374352672"><h2>Problem</h2><p>You want to check which storage engine a table uses so that you can
      determine what engine capabilities are applicable. Or you need to change
      a table’s storage engine because you realize that the capabilities of
      another engine are more suitable for the way you use the table.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820374386544"><h2>Solution</h2><p>To determine a table’s storage engine, you can use any of several statements. To change
      the table’s engine, use <code>ALTER</code>
      <code>TABLE</code> with an <code>ENGINE</code> clause.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820374384384"><h2>Discussion</h2><p>MySQL supports multiple storage engines, which have differing
      characteristics. For example, the InnoDB engine supports transactions, whereas Memory does not. If you need to know whether a table
      supports transactions, check which storage engine it uses. If the
      table’s engine does not support transactions, you can convert the table
      to use a transaction-capable engine.</p><p>To determine the current engine for a table, check <code>INFORMATION_SCHEMA</code> or use the <code>SHOW</code> <code>TABLE</code>
      <code>STATUS</code> or <code>SHOW</code> <code>CREATE</code>
      <code>TABLE</code> statement. For the <code>mail</code> table,
      obtain engine information as follows:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT ENGINE FROM INFORMATION_SCHEMA.TABLES</code></strong>
    -&gt; <strong><code>WHERE TABLE_SCHEMA = 'cookbook' AND TABLE_NAME = 'mail';</code></strong>
+--------+
| ENGINE |
+--------+
| InnoDB |
+--------+

mysql&gt; <strong><code>SHOW TABLE STATUS LIKE 'mail'\G</code></strong>
*************************** 1. row ***************************
           Name: mail
         Engine: InnoDB
…

mysql&gt; <strong><code>SHOW CREATE TABLE mail\G</code></strong>
*************************** 1. row ***************************
       Table: mail
Create Table: CREATE TABLE `mail` (
<em><code>... column definitions ...</code></em>
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</pre><p>To change the storage engine for a table, use <code>ALTER</code> <code>TABLE</code>
      with an <code>ENGINE</code> specifier. For
      example, to convert the <code>mail</code> table to
      use the Memory storage engine, use this statement:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">mail</code> <code class="n">ENGINE</code> <code class="o">=</code> <code class="n">Memory</code><code class="p">;</code></pre><p>Be aware that converting a large table to a different storage
      engine might take a long time and be expensive in terms of CPU and I/O
      activity.</p><p>To determine which storage engines your MySQL server supports,
      check the output from the <code>SHOW</code> <code>ENGINES</code> statement or query the <code>INFORMATION_SCHEMA</code> <code>ENGINES</code> table.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.6 Copying a Table Using mysqldump"><div class="sect1" id="nch-tblmgmt-tblmgmt-copy-mysqldump"><h1>6.6 Copying a Table Using mysqldump</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820374322784"><h2>Problem</h2><p>You want to copy a table or tables, either among the databases managed by a MySQL
      server, or from one server to another.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820374321808"><h2>Solution</h2><p>Use the <span class="command"><em>mysqldump</em></span>
      program.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820374307616"><h2>Discussion</h2><p>The <span class="command"><em>mysqldump</em></span> program makes a
      backup file that can be reloaded to re-create the original table or
      tables:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail &gt; mail.sql</code></strong></pre><p>The output file <em class="filename">mail.sql</em>
      consists of a <code>CREATE</code> <code>TABLE</code> statement to create the <code>mail</code>
      table and a set of <code>INSERT</code> statements
      to insert its rows. You can reload the file to re-create the
      table should the original be lost:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; mail.sql</code></strong></pre><p>This method also makes it easy to deal with any triggers the table
      has. By default, <span class="command"><em>mysqldump</em></span> writes the
      triggers to the dump file, so reloading the file copies the triggers
      along with the table with no special handling.</p><p>
        By default <span class="command"><em>mysqldump</em></span> includes statement <code>DROP TABLE IF EXISTS</code> before <code>CREATE TABLE</code>. If you do not want to drop the table when loading the dump and prefer the operation to fail instead run <span class="command"><em>mysqldump</em></span>  with option <code>--skip-add-drop-table</code>.
      </p><p>In addition to restoring tables, <span class="command"><em>mysqldump</em></span> can be used to make
      copies of them, by reloading the output into a
      different database. (If the destination database does not exist, create
      it first.) The following examples show some useful table-copying
      commands.</p><section data-type="sect3" data-pdf-bookmark="Copying tables within a single MySQL server"><div class="sect3" id="idm45820374294384"><h3>Copying tables within a single MySQL server</h3><ul><li><p>Copy a single table to a different database:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail &gt; mail.sql</code></strong>
$ <strong><code>mysql other_db &lt; mail.sql</code></strong></pre><p>To dump multiple tables, name them all following the
            database name argument.</p></li><li><p>Copy all tables in a database to a different
            database:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook &gt; cookbook.sql</code></strong>
$ <strong><code>mysql other_db &lt; cookbook.sql</code></strong></pre><p>When you name no tables after the database name, <span class="command"><em>mysqldump</em></span> dumps them all. To also
            include stored routines and events, add the <code class="option">--routines</code> and
            <code class="option">--events</code> options to the <span class="command"><em>mysqldump</em></span> command. (There is also
            a <code class="option">--triggers</code> option, but it’s
            unneeded because, as mentioned previously, <span class="command"><em>mysqldump</em></span> dumps triggers with their
            associated tables by default.)</p></li><li><p>Copy a table, using a different name for the copy:</p><ol><li><p>Dump the table:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail &gt; mail.sql</code></strong></pre></li><li><p>Reload the table into a different database that does
                <em>not</em> contain a table with that
                name:</p><pre data-type="programlisting">$ <strong><code>mysql other_db &lt; mail.sql</code></strong></pre></li><li><p>Rename the table:</p><pre data-type="programlisting">$ <strong><code>mysql other_db</code></strong>
mysql&gt; <strong><code>RENAME mail TO mail2;</code></strong></pre><p>Or, to move the table into another database at the same
                time, qualify the new name with the database name:</p><pre data-type="programlisting">$ <strong><code>mysql other_db</code></strong>
mysql&gt; <strong><code>RENAME mail TO cookbook.mail2;</code></strong></pre></li></ol></li></ul><p>To perform a table-copying operation without an intermediary
        file, use a pipe to connect the <span class="command"><em>mysqldump</em></span> and <span class="command"><em>mysql</em></span> commands:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail | mysql other_db</code></strong>
$ <strong><code>mysqldump cookbook | mysql other_db</code></strong></pre><div data-type="tip"><h6>Tip</h6><p>
            You may consider using newer tool <span class="command"><em>mysqlpump</em></span> that works similarly to <span class="command"><em>mysqldump</em></span>, but supports smarter filters and parallel processing. We discuss <span class="command"><em>mysqlpump</em></span> in <a data-type="xref" href="ch13.xhtml#nch-xfer-xfer-export-sql">Recipe 13.13</a>.
          </p></div></div></section><section data-type="sect3" data-pdf-bookmark="Copying tables between MySQL servers"><div class="sect3" id="idm45820374254256"><h3>Copying tables between MySQL servers</h3><p>The preceding commands use <span class="command"><em>mysqldump</em></span> to copy tables among the databases
        managed by a single MySQL server. Output from <span class="command"><em>mysqldump</em></span> can also be used to copy tables
        from one server to another. Suppose that you want to copy the <code>mail</code> table from the <code>cookbook</code> database on the local host to the
        <code>other_db</code> database on the host
        <em class="filename">other-host.example.com</em>. One way
        to do this is to dump the output into a file:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail &gt; mail.sql</code></strong></pre><p>Then copy <em class="filename">mail.sql</em> to
        <em class="filename">other-host.example.com</em>, and run
        the following command there to load the table into that MySQL server’s
        <code>other_db</code> database:</p><pre data-type="programlisting">$ <strong><code>mysql other_db &lt; mail.sql</code></strong></pre><p>To accomplish this without an intermediary file, use a pipe to
        send the output of <span class="command"><em>mysqldump</em></span>
        directly over the network to the remote MySQL server. If you can
        connect to both servers from your local host, use this command:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail | mysql -h other-host.example.com other_db</code></strong></pre><p>The <span class="command"><em>mysqldump</em></span> half of the
        command connects to the local server and writes the dump output to the
        pipe. The <span class="command"><em>mysql</em></span> half of the command
        connects to the remote MySQL server on <em class="filename">other-host.example.com</em>. It reads the pipe
        for input and sends each statement to the <em class="filename">other-host.example.com</em> server.</p><p>If you cannot connect directly to the remote server using
        <span class="command"><em>mysql</em></span> from your local host, send
        the dump output into a pipe that uses <span class="command"><em>ssh</em></span> to invoke <span class="command"><em>mysql</em></span> remotely on <em class="filename">other-host.example.com</em>:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook mail | ssh other-host.example.com mysql other_db</code></strong></pre><p><span class="command"><em>ssh</em></span> connects to <em class="filename">other-host.example.com</em> and launches
        <span class="command"><em>mysql</em></span> there. It then reads the
        <span class="command"><em>mysqldump</em></span> output from the pipe and
        passes it to the remote <span class="command"><em>mysql</em></span>
        process. <span class="command"><em>ssh</em></span> can be useful to send
        a dump over the network to a machine that has the MySQL port blocked
        by a firewall but that permits connections on the SSH port.</p><p>Regarding which table or tables to copy, similar principles
        apply as for local copies. To copy multiple tables over the network,
        name them all following the database argument of the <span class="command"><em>mysqldump</em></span> command. To copy an entire
        database, don’t specify any table names after the database name;
        <span class="command"><em>mysqldump</em></span> dumps all its tables. To copy all databases that reside on your MySQL instance specify option <code>--all-databases</code>.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.7 Copying an InnoDB Table Using Transportable Tablespaces"><div class="sect1" id="nch-tblmgmt-tblmgmt-copy-tablespaces"><h1>6.7 Copying an InnoDB Table Using Transportable Tablespaces</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820374226192"><h2>Problem</h2><p>
        You want to copy an InnoDB table, but the table is too big, and dumping data from it in human-readable format takes long time. Reload is not fast either.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820374225024"><h2>Solution</h2><p>
        Use transportable tablespaces.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820374224016"><h2>Discussion</h2><p>
        Tools like <span class="command"><em>mysqldump</em></span> or <span class="command"><em>mysqlpump</em></span> are good when you work with comparatively small table or if you want to examine resulting SQL dump yourself before applying it to the target server. However, copying in such a way a table that occupies few gigabytes on the disk will take high amount of time. It will also create additional load on the server. To make things worse protection mechanisms will affect other connections that use the same table.
      </p><p>
        To resolve such an issue binary backup and restore methods exist. These methods work on the binary table files without doing any additional data manipulations, therefore performance is the same as if you run command <span class="command"><em>cp</em></span> on Linux or <span class="command"><em>copy</em></span> on Windows.
      </p><p>
        As of version 8.0 MySQL stores table definitions in the data dictionary while data is stored in the separate files. Format and name of such files depend from the storage engine. In case of InnoDB they are individual, general and system tablespaces. Individual tablespace files store data for each table individually and could be used for the method we describe in this section. If your tables are stored in the system or general tablespaces you first need to convert them to use individual tablespace format.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">tbl_name</code> <code class="n">TABLESPACE</code> <code class="o">=</code> <code class="n">innodb_file_per_table</code><code class="p">;</code></pre><p>
      </p><p>
        To find out if your table resides in the system or general tablespaces, query table <code>INNODB_TABLES</code> in the Information Schema:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">NAME</code><code class="p">,</code><code> </code><code class="n">SPACE_TYPE</code><code> </code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">INNODB_TABLES</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">NAME</code><code> </code><code class="k">LIKE</code><code> </code><code class="s1">'test/%'</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">----------------------------------------+------------+
</code><code class="o">|</code><code> </code><code class="n">NAME</code><code>                                   </code><code class="o">|</code><code> </code><code class="n">SPACE_TYPE</code><code> </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------------+------------+
</code><code class="o">|</code><code> </code><code class="n">test</code><code class="o">/</code><code class="n">residing_in_system_tablespace</code><code>     </code><code class="o">|</code><code> </code><code class="k">System</code><code>     </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">test</code><code class="o">/</code><code class="n">residing_in_individual_tablespace</code><code> </code><code class="o">|</code><code> </code><code class="n">Single</code><code>     </code><code class="o">|</code><code>
</code><code class="o">|</code><code> </code><code class="n">test</code><code class="o">/</code><code class="n">residing_in_general_tablespace</code><code>    </code><code class="o">|</code><code> </code><code class="k">General</code><code>    </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">----------------------------------------+------------+</code></pre><p>
      </p><p>
        Once you are ready to copy the tablespace login into the <span class="command"><em>mysql</em></span> client and execute:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">FLUSH</code> <code class="n">TABLES</code> <code class="n">limbs</code> <code class="k">FOR</code> <code class="n">EXPORT</code><code class="p">;</code></pre><p>
        This command will prepare tablespace file for being copied and additionally create configuation file with extension <code>.cfg</code> that will contain table metadata.
      </p><p>
        Keep the MySQL client open and in the another terminal window copy the tablespace and configuation files into the desired location.
        </p><pre data-type="programlisting" data-code-language="shell">cp /var/lib/mysql/cookbook/limbs.<code class="o">{</code>cfg,ibd<code class="o">}</code> .</pre><p>
      </p><p>
        Once copy finishes unlock the table.
         </p><pre data-type="programlisting" data-code-language="sql"><code class="n">UNLOCK</code> <code class="n">TABLES</code><code class="p">;</code></pre><p>
      </p><p>
        Now you can import the tablespace into remote server or into a different database on the same local server.
      </p><p>
        First step would be to create a table with the exactly same definition as the original one. You can find the table definition if run command <span class="command"><em>SHOW CREATE TABLE</em></span>.
         </p><pre data-type="programlisting" data-code-language="sql"><code class="k">source</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="n">limbs</code><code class="err">\</code><code class="k">G</code></strong><code>
</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code> </code><code class="mi">1</code><code class="p">.</code><code> </code><code class="k">row</code><code> </code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code class="o">*</code><code>
       </code><code class="k">Table</code><code class="p">:</code><code> </code><code class="n">limbs</code><code>
</code><code class="k">Create</code><code> </code><code class="k">Table</code><code class="p">:</code><code> </code><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="o">`</code><code class="n">limbs</code><code class="o">`</code><code> </code><code class="p">(</code><code>
  </code><code class="o">`</code><code class="n">thing</code><code class="o">`</code><code> </code><code class="nb">varchar</code><code class="p">(</code><code class="mi">20</code><code class="p">)</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code class="p">,</code><code>
  </code><code class="o">`</code><code class="n">legs</code><code class="o">`</code><code> </code><code class="nb">int</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code class="p">,</code><code>
  </code><code class="o">`</code><code class="n">arms</code><code class="o">`</code><code> </code><code class="nb">int</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code>
</code><code class="p">)</code><code> </code><code class="n">ENGINE</code><code class="o">=</code><code class="n">InnoDB</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="n">CHARSET</code><code class="o">=</code><code class="n">utf8mb4</code><code> </code><code class="k">COLLATE</code><code class="o">=</code><code class="n">utf8mb4_0900_ai_ci</code><code>
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        Once you obtained it connect to the destination database and create a table.
         </p><pre data-type="programlisting" data-code-language="sql"><code class="n">destination</code><code class="o">&gt;</code><code> </code><strong><code class="n">USE</code><code> </code><code class="n">cookbook_copy</code><code class="p">;</code></strong><code>
</code><code class="k">Database</code><code> </code><code class="n">changed</code><code>
</code><code class="n">destination</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="o">`</code><code class="n">limbs</code><code class="o">`</code><code> </code><code class="p">(</code></strong><code>
          </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="o">`</code><code class="n">thing</code><code class="o">`</code><code> </code><code class="nb">varchar</code><code class="p">(</code><code class="mi">20</code><code class="p">)</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code class="p">,</code></strong><code>
          </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="o">`</code><code class="n">legs</code><code class="o">`</code><code> </code><code class="nb">int</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code><code class="p">,</code></strong><code>
          </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code>  </code><code class="o">`</code><code class="n">arms</code><code class="o">`</code><code> </code><code class="nb">int</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="k">NULL</code></strong><code>
          </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">)</code><code> </code><code class="n">ENGINE</code><code class="o">=</code><code class="n">InnoDB</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="n">CHARSET</code><code class="o">=</code><code class="n">utf8mb4</code><code> </code><code class="k">COLLATE</code><code class="o">=</code><code class="n">utf8mb4_0900_ai_ci</code><code class="p">;</code></strong><code>
</code><code class="n">Query</code><code> </code><code class="n">OK</code><code class="p">,</code><code> </code><code class="mi">0</code><code> </code><code class="k">rows</code><code> </code><code class="n">affected</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">.</code><code class="mi">03</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
      </p><p>
        After new empty table is created discard its tablespace:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">limbs</code> <code class="n">DISCARD</code> <code class="n">TABLESPACE</code><code class="p">;</code></pre><p>
      </p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          <code>DISCARD TABLESPACE</code> removes tablespace files. Be very carefull with this command. If you make a typo and discard a tablespace for the wrong table it could not be restored.
        </p></div><p>
        After tablespace discarded copy table files into the new database directory.
        </p><pre data-type="programlisting" data-code-language="bash">$ <strong><code>sudo cp limbs.{cfg,ibd} /var/lib/mysql/cookbook_copy</code></strong>
$ <strong><code>sudo chown mysql:mysql /var/lib/mysql/cookbook_copy/limbs.{cfg,ibd}</code></strong></pre><p>
        Then import the tablespace.
        </p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">limbs</code> <code class="n">IMPORT</code> <code class="n">TABLESPACE</code><code class="p">;</code></pre><p>
      </p></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820374223552"><h2>See Also</h2><p>For additional information about exchanging tablespace files between MySQL databases and servers,
      see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-table-import.html">Importing InnoDB Tables</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="6.8 Copying a MyISAM Table Using an sdi File"><div class="sect1" id="nch-tblmgmt-tblmgmt-copy-myisam-sdi"><h1>6.8 Copying a MyISAM Table Using an sdi File</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373721120"><h2>Problem</h2><p>
        You want to copy a large MyISAM table on MySQL 8.0.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373720176"><h2>Solution</h2><p> 
        Use <code>IMPORT TABLE</code> command.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373718784"><h2>Discussion</h2><p>
	    Tables which use MyISAM storage engine support import of the raw table files with help of the <span class="command"><em>IMPORT TABLE</em></span> statement. To export MyISAM tables without risk to corrupt data during migration open a MySQL connection first and flush the table files to the disk with read lock.
	    </p><pre data-type="programlisting" data-code-language="sql"><code class="n">FLUSH</code> <code class="n">TABLES</code> <code class="n">limbs_myisam</code> <code class="k">WITH</code> <code class="k">READ</code> <code class="k">LOCK</code><code class="p">;</code></pre><p>
	      Then copy table data, index and metadata files into the backup location.
	    </p><pre data-type="programlisting" data-code-language="bash">$ <strong><code>sudo cp /var/lib/mysql/cookbook/limbs_myisam.{MYD,MYI} .</code></strong>
$ <strong><code>sudo bash -c 'cp /var/lib/mysql/cookbook/limbs_myisam_*.sdi . '</code></strong></pre><p>
	  Unlock the original table. 
	  </p><p>
	    Table metadata file with the extension <code>.sdi</code> has random sequence of digits in its name, therefore use <span class="command"><em>sudo</em></span> to copy it to allow shell process to expand the file glob pattern.
	  </p><p>
	    To copy MyISAM table into the desired destination put the table metadata file with extension <code>sdi</code> into the directory, specified by the option <code>--secure-file-priv</code>, or into any directory, readable by the target MySQL server if such an option is not set. Then copy index and data file into the target database directory.
	    </p><pre data-type="programlisting" data-code-language="bash">$ <strong><code>sudo cp limbs_myisam.{MYD,MYI} /var/lib/mysql/cookbook_copy/</code></strong>
$ <strong><code>sudo chown mysql:mysql /var/lib/mysql/cookbook_copy/limbs_myisam.{MYD,MYI}</code></strong></pre><p>
	    Then connect to the database and import the table.
	    </p><pre data-type="programlisting" data-code-language="sql"><code class="n">IMPORT</code> <code class="k">TABLE</code> <code class="k">FROM</code> <code class="s1">'/tmp/limbs_myisam_11560.sdi'</code><code class="p">;</code></pre><p>
	  </p><p>
	    If you are copying the table into a database with different name you need to edit the <code>sdi</code> file manually and replace value of the <code>schema_ref</code> with the target database name.
	  </p></div></section></div></section></div></section></div></body></html>