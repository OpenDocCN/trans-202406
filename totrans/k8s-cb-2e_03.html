<html><head></head><body><section data-pdf-bookmark="Chapter 3. Learning to Use the Kubernetes Client" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_kubectl_basics">&#13;
<h1><span class="label">Chapter 3. </span>Learning to Use the Kubernetes Client</h1>&#13;
&#13;
&#13;
<p>This chapter gathers recipes around the basic usage of the Kubernetes CLI, <code>kubectl</code>. See <a data-type="xref" href="ch01.html#ch_getting_started">Chapter 1</a> for how to install the CLI tool; for advanced use cases, see <a data-type="xref" href="ch07.html#ch_kube_api">Chapter 7</a>, where we show how to use the Kubernetes API.<a data-primary="clients" data-seealso="kubectl" data-type="indexterm" id="id617"/></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="3.1 Listing Resources" data-type="sect1"><div class="sect1" id="listing_resources">&#13;
<h1>3.1 Listing Resources</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id176">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to list Kubernetes resources of a certain kind.<a data-primary="kubectl" data-secondary="listing resources" data-type="indexterm" id="id618"/><a data-primary="resources" data-secondary="listing with kubectl" data-type="indexterm" id="id619"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id26">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>get</code> verb of <code>kubectl</code> along with the resource type. To list all pods, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get pods</strong></pre>&#13;
&#13;
<p>To list all services and<a data-primary="services" data-secondary="listing with kubectl" data-type="indexterm" id="id620"/><a data-primary="deployments" data-secondary="listing with kubectl" data-type="indexterm" id="id621"/><a data-primary="get command (kubectl)" data-type="indexterm" id="id622"/> deployments (note that there is no space after the comma), do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get services,deployments</strong></pre>&#13;
&#13;
<p>To list a specific deployment, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get deployment <em>&lt;deployment-name&gt;</em></strong></pre>&#13;
&#13;
<p>To list all resources, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get all</strong></pre>&#13;
&#13;
<p>Note that <code>kubectl get</code> is a very basic but extremely useful command to get a quick overview what is going on in the cluster—​it’s essentially the equivalent to <code>ps</code> on Unix.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id623">&#13;
<h1>Short Names for Kubernetes Resources</h1>&#13;
<p>Many resources have short names you can use with <code>kubectl</code>, saving your time and sanity. <a data-primary="resources" data-secondary="short names for" data-type="indexterm" id="id624"/>Here are some examples:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>configmaps</code> (aka <code>cm</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>daemonsets</code> (aka <code>ds</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>deployments</code> (aka <code>deploy</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>endpoints</code> (aka <code>ep</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>events</code> (aka <code>ev</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>horizontalpodautoscalers</code> (aka <code>hpa</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>ingresses</code> (aka <code>ing</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>namespaces</code> (aka <code>ns</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>nodes</code> (aka <code>no</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>persistentvolumeclaims</code> (aka <code>pvc</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>persistentvolumes</code> (aka <code>pv</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>pods</code> (aka <code>po</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>replicasets</code> (aka <code>rs</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>replicationcontrollers</code> (aka <code>rc</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>resourcequotas</code> (aka <code>quota</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>serviceaccounts</code> (aka <code>sa</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p><code>services</code> (aka <code>svc</code>)</p>&#13;
</li>&#13;
</ul>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id27">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>We strongly recommend enabling autocompletion to avoid having to remember all the Kubernetes resource names.<a data-primary="autocompletion for kubectl" data-type="indexterm" id="id625"/> Head to <a data-type="xref" href="ch12.html#kubectl_autocomplete">Recipe 12.1</a> for details on how to do this.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="3.2 Deleting Resources" data-type="sect1"><div class="sect1" id="deleting_resources">&#13;
<h1>3.2 Deleting Resources</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id177">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You no longer need resources and want to get rid of them.<a data-primary="resources" data-secondary="deleting with kubectl" data-type="indexterm" id="ix_resdel"/><a data-primary="kubectl" data-secondary="deleting resources" data-type="indexterm" id="ix_kubctldel"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id28">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>delete</code> verb of <code>kubectl</code> along with the type and name of the resource you want to delete.<a data-primary="delete command (kubectl)" data-type="indexterm" id="id626"/></p>&#13;
&#13;
<p>To delete all <a data-primary="namespaces" data-secondary="deleting resources in" data-type="indexterm" id="id627"/>resources in the namespace <code>my-app</code>, as well as the namespace itself, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get ns</strong>&#13;
NAME          STATUS    AGE&#13;
default       Active    2d&#13;
kube-public   Active    2d&#13;
kube-system   Active    2d&#13;
my-app        Active    20m&#13;
&#13;
$ <strong>kubectl delete ns my-app</strong>&#13;
namespace "my-app" deleted</pre>&#13;
&#13;
<p>Note that you cannot delete the <code>default</code> namespace in Kubernetes.<a data-primary="default namespace" data-secondary="resource deletions and" data-type="indexterm" id="id628"/> This is another reason why it is worth creating your own namespaces, as it can be much easier to clean up the environment. Having said that, you can still delete all objects in a namespace, such as the <code>default</code> namespace, with the following command:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl delete all --all -n <em>&lt;namespace&gt;</em></strong></pre>&#13;
&#13;
<p>If you’re wondering how to create a namespace, see <a data-type="xref" href="ch07.html#namespace">Recipe 7.3</a>.</p>&#13;
&#13;
<p>You can also delete specific resources and/or influence the process by which they are destroyed.<a data-primary="services" data-secondary="deleting with kubectl" data-type="indexterm" id="id629"/><a data-primary="deployments" data-secondary="deleting with kubectl" data-type="indexterm" id="id630"/> To delete services and deployments labeled with <code>app=niceone</code>, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl delete svc,deploy -l app=niceone</strong></pre>&#13;
&#13;
<p>To force deletion of<a data-primary="pods" data-secondary="deleting with kubectl" data-type="indexterm" id="id631"/> a pod named <code>hangingpod</code>, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl delete pod hangingpod --grace-period=0 --force</strong></pre>&#13;
&#13;
<p>To delete all pods in the namespace <code>test</code>, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl delete pods --all --namespace test</strong></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id29">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Do not delete supervised objects such as pods or replica sets that are directly controlled by a deployment.<a data-primary="replica sets" data-secondary="controlled by a deployment, deletions and" data-type="indexterm" id="id632"/> Rather, kill their supervisors or use dedicated operations to get rid of the managed resources. For example, if you scale a deployment to zero replicas (see <a data-type="xref" href="ch09.html#scaling-deployments">Recipe 9.1</a>), then you effectively delete all the pods it looks after.</p>&#13;
&#13;
<p class="pagebreak-before">Another aspect to take into account is cascading versus direct deletion—​for example, when you delete a custom resource definition (CRD), as shown in <a data-type="xref" href="ch15.html#writing_crd">Recipe 15.4</a>, all its dependent objects are deleted too. <a data-primary="cascading versus direct deletion" data-type="indexterm" id="id633"/>To learn more about how to influence the cascading deletion policy, read <a href="https://oreil.ly/8AcpW">Garbage Collection</a> in the Kubernetes documentation.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="3.3 Watching Resource Changes with kubectl" data-type="sect1"><div class="sect1" id="watching_resources">&#13;
<h1>3.3 Watching Resource Changes with kubectl</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id178">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to watch the changes to Kubernetes objects in an interactive manner in the terminal.<a data-primary="kubectl" data-secondary="deleting resources" data-startref="ix_kubctldel" data-type="indexterm" id="id634"/><a data-primary="resources" data-secondary="deleting with kubectl" data-startref="ix_resdel" data-type="indexterm" id="id635"/><a data-primary="kubectl" data-secondary="watching resource changes with" data-type="indexterm" id="id636"/><a data-primary="resources" data-secondary="changes in, watching with kubectl" data-type="indexterm" id="id637"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id30">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>The <code>kubectl</code> command has a <code>--watch</code> option that gives you this behavior. <a data-primary="--watch option (kubectl)" data-primary-sortas="watch" data-type="indexterm" id="id638"/><a data-primary="pods" data-secondary="watching changes in with kubectl" data-type="indexterm" id="id639"/>For example, to watch pods, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get pods --watch</strong></pre>&#13;
&#13;
<p>Note that this is a blocking and auto-updating command, akin to <code>top</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id31">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>--watch</code> option is useful, but <a data-primary="Linux" data-secondary="watch command" data-type="indexterm" id="id640"/><a data-primary="watch command (Linux)" data-type="indexterm" id="id641"/>some prefer the formatting of the output from the <a href="https://oreil.ly/WPueN"><code>watch</code> command</a>, as in:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>watch kubectl get pods</strong></pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="3.4 Editing Objects with kubectl" data-type="sect1"><div class="sect1" id="editing_resources">&#13;
<h1>3.4 Editing Objects with kubectl</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id32">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to update the properties of a Kubernetes object.<a data-primary="kubectl" data-secondary="editing objects with" data-type="indexterm" id="id642"/><a data-primary="edit command (kubectl)" data-type="indexterm" id="id643"/><a data-primary="objects (Kubernetes)" data-secondary="editing with kubectl" data-type="indexterm" id="id644"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id179">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>edit</code> verb of <code>kubectl</code> along with the object type:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl run nginx --image=nginx</strong>&#13;
$ <strong>kubectl edit pod/nginx</strong></pre>&#13;
&#13;
<p>Now edit the <code>nginx</code> pod in your editor—​for example, add a new label called <code>mylabel</code> with the value <code>true</code>. <a data-primary="NGINX" data-secondary="editing nginx pod with kubectl" data-type="indexterm" id="id645"/>Once you save, you’ll see something like this:</p>&#13;
<pre data-type="programlisting">&#13;
pod/nginx edited</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id33">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If your editor isn’t opening or you want to specify which editor should be used, set the <code>EDITOR</code> or <code>KUBE_EDITOR</code> environment variable to the name of the editor you’d like to use.<a data-primary="KUBE_EDITOR environment variable" data-type="indexterm" id="id646"/><a data-primary="EDITOR environment variable" data-type="indexterm" id="id647"/> For example:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>export EDITOR=vi</strong></pre>&#13;
&#13;
<p>Also be aware that not all changes trigger an object update.</p>&#13;
&#13;
<p>Some triggers<a data-primary="container images" data-secondary="updating for resources with kubectl set image" data-type="indexterm" id="id648"/><a data-primary="kubectl" data-secondary="set image command" data-type="indexterm" id="id649"/> have shortcuts; for example, if you want to change the image version a deployment uses, simply use <code>kubectl set image</code>, which updates the existing container images of resources (valid for deployments, replica sets/replication controllers, daemon sets, jobs, and simple pods).<a data-primary="container images" data-secondary="updating with kubectl" data-type="indexterm" id="id650"/><a data-primary="resources" data-secondary="updating existing container images with kubectl" data-type="indexterm" id="id651"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="3.5 Asking kubectl to Explain Resources and Fields" data-type="sect1"><div class="sect1" id="explaining_resources">&#13;
<h1>3.5 Asking kubectl to Explain Resources and Fields</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id34">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to gain a deeper understanding of a certain resource—for example, a <code>Service</code>—and/or understand what exactly a certain field in a Kubernetes manifest means, including default values and if it’s required or optional.<a data-primary="explain command (kubectl)" data-secondary="asking kubectl to explain resources and fields" data-type="indexterm" id="id652"/><a data-primary="kubectl" data-secondary="asking to explain resources and fields" data-type="indexterm" id="id653"/><a data-primary="resources" data-secondary="explaining using kubectl" data-type="indexterm" id="id654"/><a data-primary="manifests" data-secondary="explaining fields in with kubectl" data-type="indexterm" id="id655"/><a data-primary="fields, explaining using kubectl" data-type="indexterm" id="id656"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id657">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>explain</code> verb of <code>kubectl</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl explain svc</strong>&#13;
KIND:       Service&#13;
VERSION:    v1&#13;
&#13;
DESCRIPTION:&#13;
Service is a named abstraction of software service (for example, mysql)&#13;
consisting of local port (for example 3306) that the proxy listens on, and the&#13;
selector that determines which pods will answer requests sent through the proxy.&#13;
&#13;
FIELDS:&#13;
   status       &lt;Object&gt;&#13;
     Most recently observed status of the service. Populated by the system.&#13;
     Read-only. More info: https://git.k8s.io/community/contributors/devel/&#13;
     api-conventions.md#spec-and-status/&#13;
&#13;
   apiVersion   &lt;string&gt;&#13;
     APIVersion defines the versioned schema of this representation of an&#13;
     object. Servers should convert recognized schemas to the latest internal&#13;
     value, and may reject unrecognized values. More info:&#13;
     https://git.k8s.io/community/contributors/devel/api-conventions.md#resources&#13;
&#13;
   kind &lt;string&gt;&#13;
     Kind is a string value representing the REST resource this object&#13;
     represents. Servers may infer this from the endpoint the client submits&#13;
     requests to. Cannot be updated. In CamelCase. More info:&#13;
     https://git.k8s.io/community/contributors/devel/api-conventions&#13;
     .md#types-kinds&#13;
&#13;
   metadata     &lt;Object&gt;&#13;
     Standard object's metadata. More info:&#13;
     https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata&#13;
&#13;
   spec &lt;Object&gt;&#13;
     Spec defines the behavior of a service. https://git.k8s.io/community/&#13;
     contributors/devel/api-conventions.md#spec-and-status/&#13;
&#13;
$ <strong>kubectl explain svc.spec.externalIPs</strong>&#13;
KIND:       Service&#13;
VERSION:    v1&#13;
&#13;
FIELD: externalIPs &lt;[]string&gt;&#13;
&#13;
DESCRIPTION:&#13;
     externalIPs is a list of IP addresses for which nodes in the cluster will&#13;
     also accept traffic for this service.  These IPs are not managed by&#13;
     Kubernetes.  The user is responsible for ensuring that traffic arrives at a&#13;
     node with this IP.  A common example is external load-balancers that are not&#13;
     part of the Kubernetes system.</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id35">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <a href="https://oreil.ly/chI_-"><code>kubectl explain</code></a> command pulls the descriptions of resources and fields from the <a href="https://oreil.ly/19vi3">Swagger/OpenAPI definitions</a>, exposed by the API server.</p>&#13;
&#13;
<p>You can think of <code>kubectl explain</code> as a way to describe the structure of Kubernetes resources, whereas <code>kubectl describe</code> is a way to describe the values of objects, which are instances of those structured resources.<a data-primary="explain command (kubectl)" data-secondary="describe command versus" data-type="indexterm" id="id658"/><a data-primary="describe command (kubectl)" data-type="indexterm" id="id659"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id660">&#13;
<h2>See Also</h2>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Ross Kukulinski’s blog post, <a href="https://oreil.ly/LulwG">“kubectl explain — #HeptioProTip”</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>