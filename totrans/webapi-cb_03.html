<html><head></head><body><section data-pdf-bookmark="Chapter 3. URLs and Routing" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_urls">&#13;
<h1><span class="label">Chapter 3. </span>URLs and Routing</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id37">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="URLs" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc0"/>Most <a data-primary="URLs" data-secondary="basics" data-type="indexterm" id="id770"/>web pages and applications deal with URLs in some way. This could be an action like crafting a link with certain query parameters, or URL-based routing in a single-page application (SPA).</p>&#13;
&#13;
<p><a data-primary="RFC 3986 (Uniform Resource Identifier: Generic Syntax)" data-type="indexterm" id="id771"/><a data-primary="URLs" data-secondary="defined" data-type="indexterm" id="id772"/>A URL is just a string that complies with some syntax rules as defined in <a href="https://oreil.ly/SUziR">RFC 3986, “Uniform Resource Identifier (URI): Generic Syntax”</a>. There are several component parts of a URL that you may need to parse or manipulate. Doing so with techniques like regular expressions or string concatenation isn’t always reliable.</p>&#13;
&#13;
<p>Today, browsers support the URL API. This API provides a <code>URL</code> constructor that can create, derive, and manipulate URLs. This API was somewhat limited at first, but later updates added utilities like the <code>URLSearchParams</code> interface that simplified building and reading query strings.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Parts of a URL" data-type="sect2"><div class="sect2" id="id264">&#13;
<h2>Parts of a URL</h2>&#13;
&#13;
<p><a data-primary="URLs" data-secondary="parts" data-type="indexterm" id="id773"/>When you call the <code>URL</code> constructor with a string representing a valid URL, the resulting object contains properties representing the URL’s different component parts. <a data-type="xref" href="#urlParts">Figure 3-1</a> shows the most commonly used of these:</p>&#13;
<dl>&#13;
<dt><code>protocol</code> (1)</dt>&#13;
<dd>&#13;
<p>For web URLs, this is typically <code>http:</code> or <code>https:</code> (note that the colon is included, but not the slashes). Other protocols are possible such as <code>file:</code> (for a local file not hosted on a server) or <code>ftp:</code> (a resource on an FTP server).</p>&#13;
</dd>&#13;
<dt><code>hostname</code> (2)</dt>&#13;
<dd>&#13;
<p>The domain or host name (<code>example.com</code>).</p>&#13;
</dd>&#13;
<dt><code>pathname</code> (3)</dt>&#13;
<dd>&#13;
<p>The path of the resource relative to the root, with leading slash (<code>/admin/login</code>).</p>&#13;
</dd>&#13;
<dt><code>search</code> (4)</dt>&#13;
<dd>&#13;
<p>Any query parameters. The <code>?</code> character is included (<code>?username=sysadmin</code>).</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<figure class="width-90"><div class="figure" id="urlParts">&#13;
<img alt="An example URL with its component parts highlighted" src="assets/wacb_0301.png"/>&#13;
<h6><span class="label">Figure 3-1. </span>An example URL with its component parts highlighted</h6>&#13;
</div></figure>&#13;
&#13;
<p>Some other parts of the <code>URL</code> include:</p>&#13;
<dl>&#13;
<dt><code>hash</code></dt>&#13;
<dd>&#13;
<p>If the URL contains a hash, returns the hash portion (including the hash symbol, <code>#</code>). This is sometimes used for internal navigation for older SPAs. For the URL <em>https://example.com/app#profile</em>, the value of <code>hash</code> would be <code>#profile</code>.</p>&#13;
</dd>&#13;
<dt><code>host</code></dt>&#13;
<dd>&#13;
<p>Similar to <code>hostname</code>, but also includes the port number (if specified), for example <code>localhost:8443</code>.</p>&#13;
</dd>&#13;
<dt><code>origin</code></dt>&#13;
<dd>&#13;
<p>The origin of the URL. This usually includes the protocol, hostname, and port (if specified).</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>You can get the entire URL string by calling <code>toString</code> on it, or by accessing its <code>href</code> property.</p>&#13;
&#13;
<p>If an invalid URL string is passed to the <code>URL</code> constructor, it throws an exception.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Resolving a Relative URL" data-type="sect1"><div class="sect1" id="id415">&#13;
<h1>Resolving a Relative URL</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id38">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="relative URLs, resolving" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc1"/><a data-primary="resolving relative URLs" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc2"/><a data-primary="URLs" data-secondary="resolving a relative URL" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc3"/>You have a partial or relative URL like <code>/api/users</code> that you want to resolve to a full, absolute URL like <em>https://example.com/api/users</em>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id416">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <code>URL</code> object, passing the relative URL and the desired base URL, as shown in <a data-type="xref" href="#createRelativeUrl">Example 3-1</a>.</p>&#13;
<div data-type="example" id="createRelativeUrl">&#13;
<h5><span class="label">Example 3-1. </span>Creating relative URLs</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Given a relative path and a base URL, resolves a full absolute URL.</code>&#13;
<code class="cm"> * @param relativePath The relative path for the URL</code>&#13;
<code class="cm"> * @param baseUrl A valid URL to use as the base</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">resolveUrl</code><code class="p">(</code><code class="nx">relativePath</code><code class="p">,</code> <code class="nx">baseUrl</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="nx">relativePath</code><code class="p">,</code> <code class="nx">baseUrl</code><code class="p">).</code><code class="nx">href</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// https://example.com/api/users</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">resolveUrl</code><code class="p">(</code><code class="s1">'/api/users'</code><code class="p">,</code> <code class="s1">'https://example.com'</code><code class="p">));</code></pre></div>&#13;
&#13;
<p>Without the second argument, the <code>URL</code> constructor would throw an error because <code>/api/users</code> is not a valid URL. The second argument is the base for constructing a new URL. It constructs the URL by assuming the given path is relative to the base URL.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id39">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The second argument must be a valid URL. To construct the final URL, the typical rules for a valid relative URL are applied depending on the first argument.</p>&#13;
&#13;
<p>If the first argument starts with a leading slash, the pathname of the base URL is ignored and the new URL is relative to the root of the base URL:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// https://example.com/api/v1/users</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">resolveUrl</code><code class="p">(</code><code class="s1">'/api/v1/users'</code><code class="p">,</code> <code class="s1">'https://example.com'</code><code class="p">));</code>&#13;
&#13;
<code class="c1">// https://example.com/api/v1/users</code>&#13;
<code class="c1">// Note that /api/v2 is discarded due to the leading slash in /api/v1/users</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">resolveUrl</code><code class="p">(</code><code class="s1">'/api/v1/users'</code><code class="p">,</code> <code class="s1">'https://example.com/api/v2'</code><code class="p">));</code></pre>&#13;
&#13;
<p>Otherwise, the URL is calculated relative to the base URL:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// https://example.com/api/v1/users</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">resolveUrl</code><code class="p">(</code><code class="s1">'../v1/users/'</code><code class="p">,</code> <code class="s1">'https://example.com/api/v2'</code><code class="p">));</code>&#13;
&#13;
<code class="c1">// https://example.com/api/v1/users</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">resolveUrl</code><code class="p">(</code><code class="s1">'users'</code><code class="p">,</code> <code class="s1">'https://example.com/api/v1/groups'</code><code class="p">));</code></pre>&#13;
&#13;
<p>If the first argument is a valid URL on its own, the base URL is ignored.</p>&#13;
&#13;
<p>If the constructor’s second argument is not a string, <code>toString</code> is called on it and the resulting string is used. This means you can pass other <code>URL</code> objects, or even other objects that are similar to <code>URL</code>. You can&#13;
even pass <code>window.location</code> (a <code>Location</code> object, which has similar properties to a <code>URL</code>) to generate a new URL on the current origin (see <a data-type="xref" href="#createRelativeUrl3">Example 3-2</a>)<a data-startref="ix_03-urls-and-routing-asciidoc3" data-type="indexterm" id="id774"/><a data-startref="ix_03-urls-and-routing-asciidoc2" data-type="indexterm" id="id775"/><a data-startref="ix_03-urls-and-routing-asciidoc1" data-type="indexterm" id="id776"/>.</p>&#13;
<div data-type="example" id="createRelativeUrl3">&#13;
<h5><span class="label">Example 3-2. </span>Creating a relative URL on the same origin</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">usersApiUrl</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'/api/users'</code><code class="p">,</code> <code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Removing Query Parameters From a URL" data-type="sect1"><div class="sect1" id="id417">&#13;
<h1>Removing Query Parameters From a URL</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id265">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="routing" data-secondary="removing query parameters for URLs" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc4"/><a data-primary="URLs" data-secondary="removing query parameters" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc5"/>You want to remove all query parameters from a URL.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id418">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <code>URL</code> object and set its <code>search</code> property to an empty string, as shown in <a data-type="xref" href="#removeQueryParams">Example 3-3</a>.</p>&#13;
<div data-type="example" id="removeQueryParams">&#13;
<h5><span class="label">Example 3-3. </span>Removing a URL’s query parameters</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Removes all parameters from an input URL.</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * @param inputUrl a URL string containing query parameters</code>&#13;
<code class="cm"> * @returns a new URL string with all query parameters removed</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">removeAllQueryParameters</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">);</code>&#13;
  <code class="nx">url</code><code class="p">.</code><code class="nx">search</code> <code class="o">=</code> <code class="s1">''</code><code class="p">;</code>&#13;
  <code class="k">return</code> <code class="nx">url</code><code class="p">.</code><code class="nx">toString</code><code class="p">();</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// Results in 'https://example.com/api/users'</code>&#13;
<code class="nx">removeAllQueryParams</code><code class="p">(</code><code class="s1">'https://example.com/api/users?user=sysadmin&amp;q=user'</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id40">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The query parameters in the URL are represented in two ways: with the <code>search</code> property and the <code>searchParams</code> property.</p>&#13;
&#13;
<p>The <code>search</code> property is a single string containing all of the query parameters along with the leading <code>?</code> character. If you want to delete the entire query string, you can set this to an empty string.</p>&#13;
&#13;
<p>Note that the <code>search</code> property is set to an empty string. If you set it to <code>null</code>, you’ll get the literal string <code>null</code> in the query string (see <a data-type="xref" href="#example3-4">Example 3-4</a>).</p>&#13;
<div data-type="example" id="example3-4">&#13;
<h5><span class="label">Example 3-4. </span>Incorrectly trying to remove all query parameters</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/users?user=sysadmin&amp;q=user'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">search</code> <code class="o">=</code> <code class="kc">null</code><code class="p">;</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">url</code><code class="p">.</code><code class="nx">toString</code><code class="p">());</code> <code class="c1">// https://example.com/api/users?null</code></pre></div>&#13;
&#13;
<p>The <code>searchParams</code> property is a <code>URLSearchParams</code> object. It has methods to view, add, and remove query parameters. When adding query parameters, it automatically handles encoding characters. If you want to remove just a single query parameter, you can call <code>delete</code> on this object, as shown in <a data-type="xref" href="#example3-5">Example 3-5</a><a data-startref="ix_03-urls-and-routing-asciidoc5" data-type="indexterm" id="id777"/><a data-startref="ix_03-urls-and-routing-asciidoc4" data-type="indexterm" id="id778"/>.</p>&#13;
<div data-type="example" id="example3-5">&#13;
<h5><span class="label">Example 3-5. </span>Removing a single query parameter</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Removes a single parameter from an input URL</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * @param inputUrl a URL string containing query parameters</code>&#13;
<code class="cm"> * @param paramName the name of the parameter to remove</code>&#13;
<code class="cm"> * @returns a new URL string with the given query parameter removed</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">removeQueryParameter</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">,</code> <code class="nx">paramName</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">);</code>&#13;
  <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="k">delete</code><code class="p">(</code><code class="nx">paramName</code><code class="p">);</code>&#13;
  <code class="k">return</code> <code class="nx">url</code><code class="p">.</code><code class="nx">toString</code><code class="p">();</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code>&#13;
  <code class="nx">removeQueryParameter</code><code class="p">(</code>&#13;
    <code class="s1">'https://example.com/api/users?user=sysadmin&amp;q=user'</code><code class="p">,</code>&#13;
    <code class="s1">'q'</code>&#13;
  <code class="p">)</code>&#13;
<code class="p">);</code> <code class="c1">// https://example.com/api/users?user=sysadmin</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Adding Query Parameters to a URL" data-type="sect1"><div class="sect1" id="id419">&#13;
<h1>Adding Query Parameters to a URL</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id266">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="query parameters, for URLs" data-secondary="adding" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc6"/><a data-primary="routing" data-secondary="adding query parameters for URLs" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc7"/><a data-primary="URLs" data-secondary="adding query parameters to" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc8"/><a data-primary="URLSearchParams object" data-secondary="for adding query parameters to URL" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc9"/>You have an existing URL that may already have some query parameters in it, and you want to add additional query parameters.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id420">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>URLSearchParams</code> object, accessible via the <code>searchParams</code> property, to add the additional parameters (see <a data-type="xref" href="#addQueryParams">Example 3-6</a>).</p>&#13;
<div data-type="example" id="addQueryParams">&#13;
<h5><span class="label">Example 3-6. </span>Adding additional query parameters</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/search?objectType=user'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'userRole'</code><code class="p">,</code> <code class="s1">'admin'</code><code class="p">);</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'userRole'</code><code class="p">,</code> <code class="s1">'user'</code><code class="p">);</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'luke'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Prints</code>&#13;
<code class="s2">"https://example.com/api/search?objectType=user&amp;userRole=admin&amp;userRole=user</code>&#13;
<code class="s2">&amp;name=luke"</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">url</code><code class="p">.</code><code class="nx">toString</code><code class="p">());</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id41">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This URL already has a query parameter (<code>objectType=user</code>). The code uses the  <code>searchParams</code> property of the parsed URL to append a few more query parameters. Two <code>userRole</code> parameters are added. When you use <code>append</code>, it adds new values and keeps existing values. To replace all parameters of that name with the new value, you can use <code>set</code> instead.</p>&#13;
&#13;
<p>With the new parameters, the full URL now is:</p>&#13;
&#13;
<pre data-type="programlisting">https://example.com/api/search?objectType=user&amp;userRole=admin&amp;userRole=user&#13;
&amp;name=luke</pre>&#13;
&#13;
<p>If you call <code>append</code> with a parameter name but no value, you’ll get an exception, as shown in <a data-type="xref" href="#example3-7">Example 3-7</a>.</p>&#13;
<div data-type="example" id="example3-7">&#13;
<h5><span class="label">Example 3-7. </span>Attempting to call <code>append</code> without a value</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/search?objectType=user'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// TypeError: Failed to execute 'append' on 'URLSearchParams':</code>&#13;
<code class="c1">// 2 arguments required, but only 1 present.</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'name'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>This method gracefully handles other argument types. If it doesn’t receive a string value, it converts the value to a string (see <a data-type="xref" href="#example3-8">Example 3-8</a>).</p>&#13;
<div data-type="example" id="example3-8">&#13;
<h5><span class="label">Example 3-8. </span>Appending nonstring parameters</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/search?objectType=user'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// The resulting URL has the query string:</code>&#13;
<code class="c1">//  ?objectType=user&amp;name=null&amp;role=undefined</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code> <code class="kc">null</code><code class="p">);</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'role'</code><code class="p">,</code> <code class="kc">undefined</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Using <code>URLSearchParams</code> to add query parameters automatically handles any potential encoding issues. If you’re adding a parameter with a reserved character (as defined in RFC 3986) such as <code>&amp;</code> or <code>?</code>, <code>URLSearchParams</code> automatically encodes these to ensure a valid URL. <a data-primary="percent encoding" data-type="indexterm" id="id779"/>It uses <em>percent encoding</em>, which adds a percent sign followed by the hexadecimal digits representing that character. For example, <code>&amp;</code> becomes <code>%26</code> because <code>0x26</code> is the hex code for an ampersand.</p>&#13;
&#13;
<p>You can see this encoding in action by appending a query parameter containing some reserved characters together, as shown in <a data-type="xref" href="#example3-9">Example 3-9</a>:</p>&#13;
<div data-type="example" id="example3-9">&#13;
<h5><span class="label">Example 3-9. </span>Encoding reserved characters in a query parameter</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/search'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Contrived example string demonstrating several reserved characters</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'q'</code><code class="p">,</code> <code class="s1">'admin&amp;user?luke'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>The resulting URL becomes:</p>&#13;
&#13;
<pre data-type="programlisting">https://example.com/api/search?q=admin%26user%3Fluke</pre>&#13;
&#13;
<p>The URL contains <code>%26</code> in place of <code>&amp;</code>, and <code>%3F</code> in place of <code>?</code>. These characters have special meaning in a URL. <code>?</code> indicates the beginning of the query string, and <code>&amp;</code> is a separator between parameters.</p>&#13;
&#13;
<p>As <a data-type="xref" href="#addQueryParams">Example 3-6</a> shows, calling <code>append</code> multiple times with the same key adds a new query parameter with the given key. When you call <code>.append('userRole', 'user')</code>, it adds the parameter <code>userRole=user</code> and keeps the previous <code>userRole=admin</code>. <code>URLSearchParams</code> also has a <code>set</code> method. <code>set</code> adds query parameters as well, but with different behavior. <code>set</code> replaces any existing parameters under the given key with the new one (see <a data-type="xref" href="#setQueryParams">Example 3-10</a>). If you constructed the same URL again using <code>set</code>, the result would be different.</p>&#13;
<div data-type="example" id="setQueryParams">&#13;
<h5><span class="label">Example 3-10. </span>Adding query parameters with <code>set</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="s1">'https://example.com/api/search?objectType=user'</code><code class="p">);</code>&#13;
&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'userRole'</code><code class="p">,</code> <code class="s1">'admin'</code><code class="p">);</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'userRole'</code><code class="p">,</code> <code class="s1">'user'</code><code class="p">);</code>&#13;
<code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'name'</code><code class="p">,</code> <code class="s1">'luke'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>When you use <code>set</code> instead of <code>append</code>, the second <code>userRole</code> parameter overwrites the first one, and the resulting URL is:</p>&#13;
&#13;
<pre data-type="programlisting">https://example.com/api/search?objectType=user&amp;userRole=user&amp;name=luke</pre>&#13;
&#13;
<p>Note that there is only one <code>userRole</code> parameter—the last one that was added<a data-startref="ix_03-urls-and-routing-asciidoc9" data-type="indexterm" id="id780"/><a data-startref="ix_03-urls-and-routing-asciidoc8" data-type="indexterm" id="id781"/><a data-startref="ix_03-urls-and-routing-asciidoc7" data-type="indexterm" id="id782"/><a data-startref="ix_03-urls-and-routing-asciidoc6" data-type="indexterm" id="id783"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Reading Query Parameters" data-type="sect1"><div class="sect1" id="id421">&#13;
<h1>Reading Query Parameters</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id267">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="query parameters, for URLs" data-secondary="reading" data-type="indexterm" id="id784"/><a data-primary="query parameters, for URLs" data-secondary="removing" data-type="indexterm" id="id785"/><a data-primary="URLs" data-secondary="reading query parameters" data-type="indexterm" id="id786"/>You want to parse and list the query parameters in a URL.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id268">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="URLSearchParams object" data-secondary="forEach method" data-type="indexterm" id="id787"/>Use the <code>forEach</code> method of <code>URLSearchParams</code> to list the keys and values (see <a data-type="xref" href="#readQueryParams">Example 3-11</a>).</p>&#13;
<div data-type="example" id="readQueryParams">&#13;
<h5><span class="label">Example 3-11. </span>Reading query parameters</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Takes a URL and returns an array of its query parameters</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * @param inputUrl A URL string</code>&#13;
<code class="cm"> * @returns An array of objects with key and value properties</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">getQueryParameters</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="c1">// Can't use an object here because there may be multiple</code>&#13;
  <code class="c1">// parameters with the same key, and we want to return all parameters.</code>&#13;
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="p">[];</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">url</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URL</code><code class="p">(</code><code class="nx">inputUrl</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Add each key/value pair to the result array.</code>&#13;
  <code class="nx">url</code><code class="p">.</code><code class="nx">searchParams</code><code class="p">.</code><code class="nx">forEach</code><code class="p">((</code><code class="nx">value</code><code class="p">,</code> <code class="nx">key</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">result</code><code class="p">.</code><code class="nx">push</code><code class="p">({</code> <code class="nx">key</code><code class="p">,</code> <code class="nx">value</code> <code class="p">});</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="c1">// Results are ready!</code>&#13;
  <code class="k">return</code> <code class="nx">result</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id422">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When listing the query parameters on a URL, any percent-encoded reserved characters are decoded back to their original values (see <a data-type="xref" href="#example3-12">Example 3-12</a>).</p>&#13;
<div data-type="example" id="example3-12">&#13;
<h5><span class="label">Example 3-12. </span>Using the <code>getQueryParameters</code> function</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">getQueryParameters</code><code class="p">(</code><code class="s1">'https://example.com/api/search?name=luke%26ben'</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_urls_and_routing_CO1-1" id="co_urls_and_routing_CO1-1"><img alt="1" src="assets/1.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_urls_and_routing_CO1-1" id="callout_urls_and_routing_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>name</code> parameter contains a percent-encoded ampersand character (<code>%26</code>).</p></dd>&#13;
</dl></div>&#13;
&#13;
<p class="pagebreak-before">This code prints the parameter <code>name=luke%26ben</code> with the original unencoded value:</p>&#13;
&#13;
<pre data-type="programlisting">name: luke&amp;ben</pre>&#13;
&#13;
<p><code>forEach</code> iterates over each unique key/value pair combination. Even if the URL has multiple query parameters with the same key, this prints each unique key/value pair separately.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Simple Client-Side Router" data-type="sect1"><div class="sect1" id="id423">&#13;
<h1>Creating a Simple Client-Side Router</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id42">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="client-side routers" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc10"/><a data-primary="routers" data-secondary="client-side" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc11"/><a data-primary="routing" data-secondary="creating a simple client-side router" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc12"/><a data-primary="URLs" data-secondary="creating a simple client-side router" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc13"/>You have a single-page application and want to add client-side routing. This lets the user navigate between different URLs without making a new network request and replacing the content on the client side.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id43">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="history.pushState method" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc14"/><a data-primary="popstate event" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc15"/>Use <code>history.pushState</code> and the <code>popstate</code> event to implement a simple router. This simple router renders the contents of a template when the URL matches a known route (see <a data-type="xref" href="#simpleRouter">Example 3-13</a>).</p>&#13;
<div data-type="example" id="simpleRouter">&#13;
<h5><span class="label">Example 3-13. </span>A simple client-side router</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Route definitions. Each route has a path and some content to render.</code>&#13;
<code class="kr">const</code> <code class="nx">routes</code> <code class="o">=</code> <code class="p">[</code>&#13;
  <code class="p">{</code> <code class="nx">path</code><code class="o">:</code> <code class="s1">'/'</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'&lt;h1&gt;Home&lt;/h1&gt;'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">path</code><code class="o">:</code> <code class="s1">'/about'</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'&lt;h1&gt;About&lt;/h1&gt;'</code> <code class="p">}</code>&#13;
<code class="p">];</code>&#13;
&#13;
<code class="kd">function</code> <code class="nx">navigate</code><code class="p">(</code><code class="nx">path</code><code class="p">,</code> <code class="nx">pushState</code> <code class="o">=</code> <code class="kc">true</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="c1">// Find the matching route and render its content.</code>&#13;
  <code class="kr">const</code> <code class="nx">route</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">routes</code><code class="p">.</code><code class="nx">find</code><code class="p">(</code><code class="nx">route</code> <code class="o">=&gt;</code> <code class="nx">route</code><code class="p">.</code><code class="nx">path</code> <code class="o">===</code> <code class="nx">path</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// Be careful using innerHTML in a real app, which can be a security risk.</code>&#13;
  <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#main'</code><code class="p">).</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="nx">route</code><code class="p">.</code><code class="nx">content</code><code class="p">;</code>&#13;
&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">pushState</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// Change the URL to match the new route.</code>&#13;
    <code class="nx">history</code><code class="p">.</code><code class="nx">pushState</code><code class="p">({},</code> <code class="s1">''</code><code class="p">,</code> <code class="nx">path</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>With this router in place, you can add links:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting" id="clientSideLinks"><code class="p">&lt;</code><code class="nt">a</code> <code class="na">href</code><code class="o">=</code><code class="s">"/"</code><code class="p">&gt;</code>Home<code class="p">&lt;/</code><code class="nt">a</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">a</code> <code class="na">href</code><code class="o">=</code><code class="s">"/about"</code><code class="p">&gt;</code>About<code class="p">&lt;/</code><code class="nt">a</code><code class="p">&gt;</code></pre>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id788">&#13;
<h1>history.pushState and the popstate Event</h1>&#13;
<p>The global <code>history</code> object’s <code>pushState</code> method changes the current URL without reloading the page. It adds the new URL to the browser’s history.</p>&#13;
&#13;
<p>The method takes three arguments:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>First, an object containing arbitrary data to associate with the new history entry. This state data is available from the <code>popstate</code> event as well.</p>&#13;
</li>&#13;
<li>&#13;
<p>The second argument is unused, but must be given. You can use an empty string here.</p>&#13;
</li>&#13;
<li>&#13;
<p>Finally, the new URL. This can be an absolute URL, or a relative path. If you use an absolute URL, it must be on the same origin as the current page or the browser throws an exception.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Each call to <code>pushState</code> creates a history entry. Whenever the current history entry changes (usually by using the browser’s back and forward buttons), the window triggers a <code>popstate</code> event.</p>&#13;
</div></aside>&#13;
&#13;
<p>When you click these links, the browser attempts to navigate to a new page, making a request to the server. This likely results in a 404 error, which is not what you want. To use the client-side router, you need to intercept the click events and integrate with the router from <a data-type="xref" href="#simpleRouter">Example 3-13</a>, as shown in <a data-type="xref" href="#routeListeners">Example 3-14</a>.</p>&#13;
<div data-type="example" id="routeListeners">&#13;
<h5><span class="label">Example 3-14. </span>Adding click handlers to route links</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nb">document</code><code class="p">.</code><code class="nx">querySelectorAll</code><code class="p">(</code><code class="s1">'a'</code><code class="p">).</code><code class="nx">forEach</code><code class="p">(</code><code class="nx">link</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">link</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// Prevent the browser from trying to load the new URL from the server!</code>&#13;
    <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
    <code class="nx">navigate</code><code class="p">(</code><code class="nx">link</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'href'</code><code class="p">));</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>When you click one of these links, the <code>preventDefault</code> call stops the browser’s default behavior (performing a full page navigation). Instead, it takes the <code>href</code> attribute and passes it to the client-side router. If it finds a matching route, it renders the content for that route.</p>&#13;
&#13;
<p>To make this a full solution, there is one more necessary piece. If you click one of these client-side routes, then click the browser’s Back button, nothing happens. This is because the page isn’t actually navigating, but just popping the previous state from the router. To handle this scenario, you need to also listen for the browser’s <code>popstate</code> event and render the correct content, as shown in <a data-type="xref" href="#popState">Example 3-15</a>.</p>&#13;
<div data-type="example" id="popState">&#13;
<h5><span class="label">Example 3-15. </span>Listening for the popstate event</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nb">window</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'popstate'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">navigate</code><code class="p">(</code><code class="nb">window</code><code class="p">.</code><code class="nx">location</code><code class="p">.</code><code class="nx">pathname</code><code class="p">,</code> <code class="kc">false</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>When the user clicks the Back button, the browser fires the <code>popstate</code> event. This changes the page URL back, and you just need to look up the content for the route matching the URL. In this case, you don’t want to call <code>pushState</code> because that adds a new history state, which probably isn’t what you want since you just popped an old history state off of the stack.<a data-startref="ix_03-urls-and-routing-asciidoc15" data-type="indexterm" id="id789"/><a data-startref="ix_03-urls-and-routing-asciidoc14" data-type="indexterm" id="id790"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id44">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This client-side router is working, but there’s one issue. If you click the About link, then click the Refresh button, the browser makes a new network request, which probably results in a 404 error. To fix this last problem, the server needs to be configured to return the main HTML and JavaScript content regardless of the URL’s pathname. This loads the router code, which is called with the value of <code>window.location.pathname</code>. If everything is configured right, the client-side route handler executes and renders the correct content.</p>&#13;
&#13;
<p>When using client-side routing, navigating between pages can be faster since there is no round trip to the server. It makes navigation smoother and more responsive. There are disadvantages too. To support the quick page transition, you often have to load a lot of extra JavaScript up front, so the initial page load may be slower<a data-startref="ix_03-urls-and-routing-asciidoc13" data-type="indexterm" id="id791"/><a data-startref="ix_03-urls-and-routing-asciidoc12" data-type="indexterm" id="id792"/><a data-startref="ix_03-urls-and-routing-asciidoc11" data-type="indexterm" id="id793"/><a data-startref="ix_03-urls-and-routing-asciidoc10" data-type="indexterm" id="id794"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Matching URLs to Patterns" data-type="sect1"><div class="sect1" id="id424">&#13;
<h1>Matching URLs to Patterns</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id425">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to define a pattern of valid URLs that you can match URLs against. You may also want to extract part of a URL’s path. For example, given the URL <em>https://example.com/api/users/123/profile</em>, you want the user ID (<code>123</code>).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id45">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="URL Pattern API" data-type="indexterm" id="ix_03-urls-and-routing-asciidoc16"/>Use the URL Pattern API to define the expected pattern and extract the part you need.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This API may not be supported by all browsers yet. See <a href="https://oreil.ly/Eb-k2">CanIUse</a> for the latest compatibility data.</p>&#13;
</div>&#13;
&#13;
<p>With this API, you can create a <code>URLPattern</code> object that defines a pattern that you can use to match URLs (see <a data-type="xref" href="#urlPattern">Example 3-16</a>). It’s created with a string defining the pattern to match. The string can contain named groups that, when matching against a URL string, are extracted. You can access the extracted values by their index. These groups are similar to capturing groups in a regular expression.</p>&#13;
<div data-type="example" id="urlPattern">&#13;
<h5><span class="label">Example 3-16. </span>Creating a <code>URLPattern</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">profilePattern</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URLPattern</code><code class="p">({</code> <code class="nx">pathname</code><code class="o">:</code> <code class="s1">'/api/users/:userId/profile'</code> <code class="p">});</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#urlPattern">Example 3-16</a> shows a simple URL pattern with a single named group <code>userId</code>. The group name is preceded by a colon character. You can use this pattern object to match URLs and, if they match, extract the user ID from them. <a data-type="xref" href="#urlMatching">Example 3-17</a> explores some different URLs and how to test them against <code>profilePattern</code> using the <code>test</code> method.</p>&#13;
<div data-type="example" id="urlMatching">&#13;
<h5><span class="label">Example 3-17. </span>Testing URLs against a pattern</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// The pattern won't match a pathname alone; it must be a valid URL.</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">profilePattern</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="s1">'/api/users/123/profile'</code><code class="p">));</code>&#13;
&#13;
<code class="c1">// This URL matches because the pathname matches the pattern.</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">profilePattern</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="s1">'https://example.com/api/users/123/profile'</code><code class="p">));</code>&#13;
&#13;
<code class="c1">// It also matches URL objects.</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">profilePattern</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="k">new</code> <code class="nx">URL</code>&#13;
<code class="p">(</code><code class="s1">'https://example.com/api/users/123/profile'</code><code class="p">)));</code>&#13;
&#13;
<code class="c1">// The pathname must match exactly, so this won't match.</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">profilePattern</code><code class="p">.</code><code class="nx">test</code><code class="p">(</code><code class="s1">'https://example.com/v1/api/users/123/profile'</code><code class="p">));</code></pre></div>&#13;
&#13;
<p>The <code>profilePattern</code> specifies an exact pathname match, which is why the last example in <a data-type="xref" href="#urlMatching">Example 3-17</a> did not work. You can define a less strict version that uses a wildcard character (<code>*</code>) so it needn’t be exact. With this new pattern, you can match on partial pathnames.</p>&#13;
<div data-type="example" id="urlPatternWildcard">&#13;
<h5><span class="label">Example 3-18. </span>Using a wildcard in the pattern</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">wildcardProfilePattern</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URLPattern</code>&#13;
<code class="p">({</code> <code class="nx">pathname</code><code class="o">:</code> <code class="s1">'/*/api/users/:userId/profile'</code> <code class="p">});</code>&#13;
&#13;
<code class="c1">// This matches now because the /v1 portion of the URL matches the wildcard.</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">wildcardProfilePattern</code><code class="p">.</code><code class="nx">test</code>&#13;
<code class="p">(</code><code class="s1">'https://example.com/v1/api/users/123/profile'</code><code class="p">));</code></pre></div>&#13;
&#13;
<p>You can use the pattern’s <code>exec</code> method to get more data about the match. If the pattern matches the URL, <code>exec</code> returns an object containing any matches to parts of the URL. Each nested object has an <code>input</code> property indicating which part of the URL matched, and a <code>groups</code> property that has any named groups defined in the pattern.</p>&#13;
&#13;
<p>You can use <code>exec</code> to extract the user ID from matching URLs in <a data-type="xref" href="#urlExec">Example 3-19</a>.</p>&#13;
<div data-type="example" id="urlExec">&#13;
<h5><span class="label">Example 3-19. </span>Extracting the user ID</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">profilePattern</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">URLPattern</code><code class="p">({</code> <code class="nx">pathname</code><code class="o">:</code> <code class="s1">'/api/users/:userId/profile'</code> <code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">match</code> <code class="o">=</code> <code class="nx">profilePattern</code><code class="p">.</code><code class="nx">exec</code><code class="p">(</code><code class="s1">'https://example.com/api/users/123/profile'</code><code class="p">);</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">match</code><code class="p">.</code><code class="nx">pathname</code><code class="p">.</code><code class="nx">input</code><code class="p">);</code> <code class="c1">// '/api/users/123/profile'</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">match</code><code class="p">.</code><code class="nx">pathname</code><code class="p">.</code><code class="nx">groups</code><code class="p">.</code><code class="nx">userId</code><code class="p">);</code> <code class="c1">// '123'</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id46">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>While it doesn’t have full browser support yet, this is a very flexible API. You can define patterns for any parts of the URL, matching inputs and extracting<a data-startref="ix_03-urls-and-routing-asciidoc16" data-type="indexterm" id="id795"/> groups<a data-primary="patterns, matching routers to" data-type="indexterm" id="id796"/><a data-primary="routers" data-secondary="matching to patterns" data-type="indexterm" id="id797"/><a data-primary="URLs" data-secondary="matching to patterns" data-type="indexterm" id="id798"/>.<a data-startref="ix_03-urls-and-routing-asciidoc0" data-type="indexterm" id="id799"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>