- en: Chapter 18\. Building an Internet Firewall/Router on Raspberry Pi
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第18章。在Raspberry Pi上构建Internet防火墙/路由器
- en: The Raspberry Pi (RPi) makes a great internet firewall/router for small networks,
    and it does not cost a lot of money. You can use any Raspberry Pi, but I recommend
    the Raspberry Pi 4B because it is more powerful than the older Pis and is the
    first Pi with a dedicated gigabit Ethernet port.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Raspberry Pi（RPi）非常适合小型网络的Internet防火墙/路由器，成本不高。您可以使用任何Raspberry Pi，但我推荐Raspberry
    Pi 4B，因为它比旧版Pi更强大，并且是第一个配备专用千兆以太网端口的Pi。
- en: Overview
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概述
- en: In this chapter you will learn how to install Raspberry Pi OS, connect your
    Pi to a computer monitor or TV, use the Raspberry Pi OS recovery mode, run your
    Pi headless, add a second Ethernet port, share an internet connection, and use
    the Pi for LAN name services.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习如何安装Raspberry Pi OS，将您的Pi连接到计算机显示器或电视，使用Raspberry Pi OS恢复模式，无头运行您的Pi，添加第二个以太网口，共享Internet连接，并使用Pi进行LAN名称服务。
- en: Note
  id: totrans-4
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 注意
- en: The examples in this chapter are all on a Raspberry Pi 4 Model B, using the
    Raspberry Pi OS. Raspberry Pi OS used to be called Raspbian. Underneath it is
    Debian Linux, so if you are accustomed to Debian, Ubuntu, Mint, or any other Debian
    variant, it’s the same Linux.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的示例均基于Raspberry Pi 4 Model B，在Raspberry Pi OS上运行。Raspberry Pi OS以前称为Raspbian。其底层是Debian
    Linux，因此如果您习惯于Debian、Ubuntu、Mint或其他任何Debian变体，它都是相同的Linux。
- en: Pros and Cons of a Raspberry Pi Firewall/Router
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Raspberry Pi防火墙/路由器的优缺点
- en: The Raspberry Pi is a general-purpose computer, not a specialized firewall/router.
    It has WiFi, Ethernet, and Bluetooth, and it runs Linux. In comparison, a common
    choice for small networks is the small combination firewall/router/wireless access
    point/ Ethernet switch, like the Linksys AC1900 or the TP-Link Archer AX20\. These
    have WiFi, gigabit Ethernet, multiple antennas, and support for “smart” services
    like Alexa and smartphone administration apps.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Raspberry Pi是通用计算机，而不是专用防火墙/路由器。它具有WiFi、以太网和蓝牙，并运行Linux。相比之下，小型网络的常见选择是类似Linksys
    AC1900或TP-Link Archer AX20的小型组合防火墙/路由器/无线接入点/以太网交换机，它们具有WiFi、千兆以太网、多个天线，并支持像Alexa和智能手机管理应用程序等“智能”服务。
- en: The drawback to these devices is their inflexibility, especially limited storage
    and operating system support. If you want to replace the vendor software, you
    must use specialized router distributions like OpenWRT, DD-WRT, pfSense, or OPNsense,
    which are all excellent, but it is not easy, and you have to find supported devices.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 这些设备的缺点在于其不灵活性，特别是存储和操作系统支持有限。如果您想替换供应商软件，必须使用像OpenWRT、DD-WRT、pfSense或OPNsense这样的专门的路由器发行版，这些都非常出色，但并不容易，并且您必须找到受支持的设备。
- en: 'These are some of the advantages Raspberry Pi has over the all-in-one boxes:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Raspberry Pi相比于一体化设备具有以下优势：
- en: Flexibility, just like any general-purpose Linux computer
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 灵活性，就像任何通用Linux计算机一样
- en: More memory and storage
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更多的内存和存储
- en: Connects to a computer monitor or TV, keyboard, and mouse
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到计算机显示器或电视、键盘和鼠标
- en: Runs a number of Linux distributions, so you can use your existing knowledge
    and not have to learn some weird new interface or command set
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行多种Linux发行版，因此您可以利用现有的知识，无需学习一些奇怪的新界面或命令集
- en: Runs a number of *bsd operating systems, Windows 10, Android, Chromium, and
    others
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行多种*bsd操作系统、Windows 10、Android、Chromium和其他操作系统
- en: Tethers to a mobile hotspot
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 连接到移动热点
- en: 64-bit support
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 支持64位
- en: You can run the Raspberry Pi with a graphical desktop, with no graphical desktop,
    and headless via SSH, just like any Linux system.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以像任何Linux系统一样，通过图形桌面、无图形桌面和SSH无头运行Raspberry Pi。
- en: 'Downsides of Raspberry Pi:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: Raspberry Pi的缺点：
- en: Cannot function as an Ethernet switch, like the all-in-one devices
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不能像一体化设备那样作为以太网交换机运行
- en: WiFi is not as strong as all-in-one devices
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WiFi不如一体化设备强
- en: Raspberry Pi models 3 and older have poor Ethernet performance because the Ethernet
    port shares the USB bus; RPi 4 cures this with a dedicated gigabit Ethernet port
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Raspberry Pi模型3及更早版本的以太网性能较差，因为以太网端口共享USB总线；RPi 4通过专用千兆以太网端口解决了这个问题
- en: There are a number of customized Linux operating systems for Raspberry Pi. The
    official operating system is Raspberry Pi OS, which is based on Debian Linux.
    SUSE, Ubuntu, Fedora, Arch Linux ARM, and MX Linux have Raspberry Pi variants.
    There are also specialized media server and gaming distros. In this chapter we’ll
    stick with Raspberry Pi OS because it is optimized for the Pi, and you get a full
    graphical desktop with decent performance even on the older RPi models. Raspberry
    Pi OS is just like any other Linux, so anything you can do on a big Linux machine
    you can do on Raspberry Pi.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: Hardware Architecture
  id: totrans-23
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The RPi is powered by a Broadcom system-on-a-chip (SoC). The CPU, GPU, and I/O
    are all on a single chip. This is especially impressive on the Raspberry Pi 4
    Model B, which supports running two screens at the same time. It handles high-definition
    movies without a hiccup.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: The Broadcom SoC is an ARM chip, rather than the x86_64 architecture that dominates
    the PC market. ARM processors are less complex, using a reduced instruction set
    (RISC). x86_64 processors are CISC, complex instruction set computers. x86_64
    processors work a lot harder, are considerably more complex, and consume more
    power.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: Rasberry Pi Banquet of Products
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Every Raspberry Pi model ever made is still available, including updated releases
    of the Raspberry Pi 1, models A and B. The A models are the lower-cost versions
    of every release, and the B models cost a little more for more features.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: 'You have many other Pis to choose from, such as:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi Zero, the smallest Pi for $5
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Raspberry Pi Zero W includes WiFi, $10
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Raspberry Pi 400 Personal Computer Kit, a complete system integrated into a
    compact keyboard (all you need to add is a display), $100
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RPi prices have been stable since the first RPi was released, though of course
    this could change.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: 'There is a giant thundering herd of accessories: cases, touchscreens, heat
    sinks, fans, breakout boards, hats (expansion boards), all manner of cables and
    adapters, motors, cameras, audio boards, little wireless keyboards with touchpads,
    gaming emulators, RGB matrices, powered USB hubs, real-time clocks, tiny displays…it
    is one of the best playgrounds ever.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: History and Purpose
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Raspberry Pi is a real phenomenon. The original intent of its creator, Eben
    Upton, was to produce a small and inexpensive computer to encourage young students
    to study computing, especially students who could not afford to buy a PC. The
    first Raspberry Pi, Version 1 Model B, cost about $35\. Add a keyboard and mouse,
    connect to a TV or monitor, and for less than a tenth the price of a PC you had
    a working Linux computer with audio, video, Ethernet, and USB. The open hardware
    design, combined with open source software, encourages hacking and learning.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-36
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The Broadcom chipsets that power the Pi are not open. This has been a point
    of contention since the first Pi was released. The schematics are open, available
    on [RaspberryPi.org](https://raspberrypi.org), and the operating system and BIOS
    are open source. In my moderately humble opinion, a completely open source platform
    is preferable and would be great, and having something that works and is available
    now is better than not having something that works and is available now.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: 'The first Raspberry Pi was an immediate success, selling over 500,000 units
    in the first 6 months after its release in February 2012\. Since then around 30
    million Raspberry Pis have been sold. The current version, Version 4 Model B,
    is a significant upgrade, the most powerful model yet, featuring:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: 2 USB 2 ports
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2 USB 3 ports
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2 micro HDMI ports, supporting 2 4K displays
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 1 dedicated gigabit Ethernet port
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Supports RAM from 2 GB–8 GB
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Broadcom BCM2711, 1.5 GHz Quad-core Cortex-A72 (ARM v8) 64-bit SoC
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2.4 GHz and 5.0 GHz IEEE 802.11ac WiFi
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bluetooth
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 40-pin GPIO header
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compared to modern Intel and AMD CPUs, these specs are far from bragworthy,
    but it’s enough horsepower to run a Linux graphical desktop, play music, movies,
    surf the web, write documents…it is quite capable for its size and price.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: The Raspberry Pi is developed and produced by the Raspberry Pi Foundation, a
    registered nonprofit charity. The foundation supports numerous education projects
    for teachers and students; visit [*https://raspberrypi.org*](https://raspberrypi.org)
    for current educational materials and information.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: 18.1 Starting and Shutting Down Raspberry Pi
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You don’t see a power switch on your Raspberry Pi (RPi), and you want to turn
    it on and off.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Power it up by plugging in the power connector. Shut it down from the menu in
    your operating system, then unplug it.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you shut down your RPi, you have to disconnect and then reconnect the power
    to start it up again.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: It wouldn’t surprise me if there is a power switch out there somewhere made
    for the RPi, though I have not seen one. One alternative is to plug it into a
    switched power strip.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[*https://raspberrypi.org*](https://raspberrypi.org)'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.2 Finding Hardware and How-Tos
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You bought a Raspberry Pi 4 Model B, and you want to know what other hardware
    devices you need in order to use it.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Presumably you already have a computer monitor or TV, mouse, and keyboard.
    You also need:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi power supply
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: HDMI-to-micro-HDMI cable
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Micro SD card of at least 16 GB
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cooling fan, or heat sinks on the CPU, RAM module, and USB controller
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Case
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Micro SD card reader
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Start by installing Raspberry Pi OS to your micro SD card on another computer.
    While that is running, assemble your hardware. When everything is ready, connect
    the power and watch your new system boot up. (See Recipes [18.4](#rec-install-pi)
    and [18.5](#rec-install-noobs) to learn how to install Raspberry Pi OS.)
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: To learn all about RPi, there are numerous sources of schematics, specifications,
    how-tos, and clever ideas. The “See Also” section of this recipe lists a nice
    selection to get you started.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If your display does not have an HDMI port, see [Recipe 18.6](#rec-no-hdmi).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: You may use any micro SD card at least 16 GB in size. High-speed cards make
    a noticeable performance improvement. 16 GB is pretty small, and you can use as
    large a card as you like.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: The RPi 4B has three RAM options, 2 GB, 4 GB, and 8 GB. It is not upgradable,
    so whatever you buy is what you will have. 2 GB is more than enough for an internet
    gateway, and using your Pi as a lightweight Linux desktop. More memory is good
    for multimedia processing, compiling code, games, and other memory-intensive tasks.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: The RPi 4B is quite a bit more powerful than older Pis, and it runs hotter than
    older versions. See [Recipe 18.3](#cooling-rpi) to learn how to keep it cool.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: With 4 USB ports, the RPi 4B has a lot of flexibility. You can use standard
    USB keyboards and mice, a keyboard with a trackpad, and USB-to-PS/2 adapters for
    older keyboards and mice. You can attach a USB hard drive for more storage or
    backups, and any other USB devices just like on a big computer. The 40-pin GPIO
    header supports attaching nearly any expansion board.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: There are many nice kits that bundle everything you need to get started. My
    favorite store is [Adafruit.com](https://adafruit.com), and you can find many
    more listed on [*https://raspberrypi.org*](https://raspberrypi.org).
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'These sites publish excellent Raspberry Pi tutorials:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Adafruit](https://oreil.ly/5qwn5)'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MagPi](https://oreil.ly/EuMY7)'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Hackspace](https://oreil.ly/5KY5B)'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Maker Pro](https://oreil.ly/NQcB0)'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Makezine](https://oreil.ly/foZqS)'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.3 Cooling the Raspberry Pi
  id: totrans-88
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your Raspberry Pi feels hot to the touch, and you want to install some kind
    of cooling for it.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Install a cooling fan in the case, or heat sinks on the CPU, RAM module, and
    USB controller. Install a fan and heat sinks on the Raspberry Pi 4, which runs
    hotter than older Pis.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the built-in *vcgencmd* command to measure CPU temperatures before and
    after installing cooling devices, and before and after running computationally
    intensive tasks such as compiling code or playing videos. The following example
    is a fanless board at idle with the case lid removed, and then after five minutes
    of playing a movie at 1080p:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This example shows the effect of a cooling fan when playing the same movie:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The temperature should not go over 70°C. 40°C to 60°C is a good operating range.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Adafruit](https://oreil.ly/5qwn5)'
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MagPi](https://oreil.ly/EuMY7)'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.4 Installing Raspberry Pi OS with Imager and dd
  id: totrans-102
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You have your hardware, and you want to install the operating system.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You will create a bootable micro SD card on another computer, then load the
    SD card into your Raspberry Pi and start it up.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: 'There are four ways to get a bootable SD card:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: Use the Raspberry Pi Imager (currently only for *.deb* systems such as Debian,
    Ubuntu, or Mint)
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use the NOOBS installer ([Recipe 18.5](#rec-install-noobs))
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Copy your installation image to your micro SD card with the *dd* command
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Buy a micro SD card with the installer already loaded
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I favor NOOBs because it works on all Linuxes, and it creates a rescue boot
    mode.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: 'To install the Raspberry Pi Imager from the *.deb* package, download it from
    [*https://raspberrypi.org*](https://raspberrypi.org). Then install the package:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Alternatively, Ubuntu users can install the Raspberry Pi Imager with *apt*:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Plug your SD card into your computer. Locate it with *lsblk -p* (see [Recipe
    10.9](ch10.xhtml#rec-lsblk-hardware)).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: Start the Raspberry Pi Imager from your system menu, and enjoy its cheery raspberry
    logo. Click Operating System to select the operating system you want to install,
    and the Imager will download it and copy it to your SD card. If you have already
    downloaded an image, scroll down the selection menu to Use Custom to select your
    downloaded image. You will see a screen like [Figure 18-1](#fig-rpi-1).
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a bootable micro SD card with Raspberry Pi Imager](Images/lcb2_1801.png)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
- en: Figure 18-1\. Creating a bootable micro SD card with Raspberry Pi Imager
  id: totrans-120
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click SD Card to select the device, and then click Write to install the operating
    system.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: 'If you don’t have an Ubuntu system, download your chosen operating system image
    from [*https://raspberrypi.org*](https://raspberrypi.org) and use the *dd* command
    to copy it to your SD card. The following example unzips and copies *2021-03-24-raspios-buster-armhf.zip*
    to the SD card:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: When the SD card is ready, insert it in your Raspberry Pi and power it on. When
    it boots up, you will complete a short setup, and then it is ready to use.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: The default user is *pi*. Look in */home/pi/Bookshelf* for a PDF copy of *The
    Official Raspberry Pi Beginner’s Guide* by Gareth Halfacree (Raspberry Pi Press).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You do not have to format your SD card before copying with *dd*.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: 'The imager creates two partitions: a 256 MB FAT32 */boot* partition, and an
    Ext4 *rootfs* partition just big enough to hold the filesystem. On my test system
    that is 3.4 GB, and the rest of the card is unallocated space.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: When you boot up your new system for the first time, the root filesystem is
    expanded to fill all the unallocated space. You may shrink the root filesystem
    and create more partitions with GParted ([Chapter 9](ch09.xhtml#cha-partitioning-gparted))
    or *parted* ([Chapter 8](ch08.xhtml#cha-partitioning-parted)).
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.5 Installing Raspberry Pi with NOOBS
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to use NOOBS to install Raspberry Pi.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NOOBS (New Out Of the Box Software) is an older installer. It works on all Linux
    distributions and creates a recovery boot mode, which Raspberry Pi Imager does
    not do.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: NOOBS（New Out Of the Box Software）是一个较旧的安装程序。它适用于所有 Linux 发行版，并创建了一个恢复引导模式，而
    Raspberry Pi Imager 则不会这样做。
- en: Download NOOBS on another computer, unzip the download archive, copy all of
    its files to a micro SD card, then load the SD card into your Raspberry Pi and
    start it up.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在另一台计算机上下载 NOOBS，解压下载的存档文件，将所有文件复制到 micro SD 卡上，然后将 SD 卡插入您的 Raspberry Pi 并启动它。
- en: 'Download NOOBS from [*https://raspberrypi.org*](https://raspberrypi.org). There
    are two versions: NOOBS and NOOBS Lite. NOOBS includes Raspberry Pi OS, and a
    network installer for other operating systems. NOOBS Lite includes only the network
    installer.'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 从 [*https://raspberrypi.org*](https://raspberrypi.org) 下载 NOOBS。有两个版本：NOOBS
    和 NOOBS Lite。NOOBS 包括 Raspberry Pi OS 和其他操作系统的网络安装程序。NOOBS Lite 仅包括网络安装程序。
- en: 'Unpack NOOBS after downloading:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在下载后解压缩 NOOBS：
- en: '[PRE5]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Plug your SD card into your computer. Locate it with *lsblk -p* (see [Recipe
    10.9](ch10.xhtml#rec-lsblk-hardware)).
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 将您的 SD 卡插入计算机中。使用 *lsblk -p* 查找它（参见 [配方 10.9](ch10.xhtml#rec-lsblk-hardware)）。
- en: Format your micro SD card as a single FAT32 partition.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 将您的 micro SD 卡格式化为单个 FAT32 分区。
- en: Copy all the NOOBS files to your SD card, then use it to boot your Raspberry
    Pi. First you will see a cool rainbow colored screen, then NOOBS boots to the
    installation menu ([Figure 18-2](#fig-rpi-8)). Set up networking to use the network
    installer or to get updates after installation. Select your operating system,
    then go find something to do until it is finished.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 将所有 NOOBS 文件复制到您的 SD 卡，然后使用它启动您的 Raspberry Pi。首先，您会看到一个酷炫的彩虹色屏幕，然后 NOOBS 启动安装菜单（[图 18-2](#fig-rpi-8)）。设置网络以使用网络安装程序或在安装后获取更新。选择您的操作系统，然后找些事情做，直到安装完成。
- en: '![NOOBS installation screen.](Images/lcb2_1802.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![NOOBS 安装屏幕。](Images/lcb2_1802.png)'
- en: Figure 18-2\. NOOBS installation screen
  id: totrans-145
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
  zh: 图 18-2\. NOOBS 安装屏幕
- en: After installation is complete, you will go through a brief setup process, and
    then your Raspberry Pi is ready to use.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，您将进行简短的设置过程，然后您的 Raspberry Pi 就可以使用了。
- en: The default user is *pi*. Look in */home/pi/Bookshelf* for a PDF copy of *The
    Official Raspberry Pi Beginner’s Guide* by Gareth Halfacree (Raspberry Pi Press).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 默认用户是 *pi*。在 */home/pi/Bookshelf* 中查找由 Gareth Halfacree（Raspberry Pi Press）编写的
    *The Official Raspberry Pi Beginner’s Guide* 的 PDF 版本。
- en: Discussion
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: NOOBS is a simple unzip and copy, so it works on any computer.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: NOOBS 是一个简单的解压和复制过程，因此适用于任何计算机。
- en: Copying the NOOBS files to your SD card can take a long time. Usually it is
    faster to copy the ZIP file to the SD card, then unzip it on the card. You can
    delete the ZIP file after installation.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 将 NOOBS 文件复制到您的 SD 卡可能需要很长时间。通常情况下，将 ZIP 文件复制到 SD 卡上，然后在卡上解压缩会更快。安装完成后，您可以删除
    ZIP 文件。
- en: See Also
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: '[Chapter 9](ch09.xhtml#cha-partitioning-gparted)'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第九章](ch09.xhtml#cha-partitioning-gparted)'
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
- en: 18.6 Connecting to a Video Display Without HDMI
  id: totrans-154
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 18.6 连接到没有 HDMI 的视频显示器
- en: Problem
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 问题
- en: You have a TV or computer monitor that does not have HDMI ports, and you want
    to connect your Raspberry Pi to it.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 您有一台没有 HDMI 端口的电视或计算机显示器，并且想要将您的 Raspberry Pi 连接到它。
- en: Solution
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 解决方案
- en: 'There are four ways to connect a screen to the RPi 4B. You can use:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 有四种方法可以将屏幕连接到 RPi 4B。您可以使用以下方法之一：
- en: Small screens made for the Raspberry Pi
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为 Raspberry Pi 制造的小屏幕
- en: DVI-to-HDMI adapter
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DVI 到 HDMI 适配器
- en: VGA-to-HDMI adapter
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: VGA 到 HDMI 适配器
- en: RCA composite video (use cables made for Raspberry Pi)
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: RCA 复合视频（使用专为 Raspberry Pi 制作的电缆）
- en: 'There is quite a variety of screens made for the RPi: touchscreens, LED, LCD,
    OLED, eInk—you name it, there is probably an RPi version. Follow the installation
    instructions that come with the screen.'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 有多种适用于 RPi 的屏幕类型：触摸屏、LED、LCD、OLED、电子墨水等等，应有尽有。遵循随屏幕附带的安装说明进行安装。
- en: The DVI-to-HDMI and VGA-to-HDMI adapters connect to your screen, and then your
    HDMI-to-micro-HDMI cable connects to the adapter. When you connect to a single
    HDMI display on the RPi 4B, plug into the HDMI 0 port, which is the one closest
    to the power port.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: DVI 到 HDMI 和 VGA 到 HDMI 适配器连接到您的屏幕，然后您的 HDMI 到 micro-HDMI 电缆连接到适配器。当您连接到 RPi
    4B 上的单个 HDMI 显示器时，请插入 HDMI 0 端口，即靠近电源端口的端口。
- en: 'Composite video requires some extra steps on the RPi 4B because it is disabled
    by default. The easy way is to find an HDMI screen to use when you boot your Pi
    for the first time and complete your installation. After your installation is
    complete, open the configuration tool to enable composite video:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Arrow-key down to 6 Advanced Options, then select A8 HDMI/Composite. Select
    V2 Enable Composite. Exit *raspi-config*, shut down your Pi, connect your Pi to
    your composite video screen, then start it up again. It should default to your
    composite video screen.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Older flat-panel screens usually have VGA and composite video connectors, so
    you could use either composite video or a VGA-to-HDMI adapter. Technically, HDMI
    delivers a higher-quality image than composite video, but most people cannot tell
    the difference.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 18-3](#fig-rpi-4) shows a Rocketfish DVI-to-HDMI adapter, a composite
    cable bundle, a Rasberry Pi 4B in a CanaKit case with the top removed, and a micro
    SD card.'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: '![Raspberry Pi 4B with accessories](Images/lcb2_1803.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
- en: Figure 18-3\. Raspberry Pi 4B with accessories
  id: totrans-172
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The RCA composite audio/video cable set, the one with the yellow, red, and
    white connectors, plugs into the nifty little 3.5 mm TRRS port on the RPi. You
    need one made for the RPi because there is no standard for how the TRRS plug is
    ordered. You might find some that don’t work as they are supposed to, which is
    yellow for video, and red and white for audio. Avoid composite cables made for
    camcorders and MP3 players, which have their own weird ordering that puts the
    ground ring in the wrong place. The TRRS (tip-ring-ring-sleeve) plug should be
    configured like this:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: There are several options for tweaking your composite video settings in */boot/config.txt*.
    If you plan to use composite video, use the NOOBS installer. Then if you need
    to correct its settings, you can boot to recovery mode ([Recipe 18.7](Images/#rec-recovery-mode))
    and have access to */boot/config.txt*.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: '*sdtv_mode=* sets the TV standard. *sdtv_mode=0* is the default for North America.
    Most of the world uses PAL; see [Table 18-1](#table18-1) for the settings.'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: Table 18-1\. sdtv_mode settings
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '| value | mode |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
- en: '| 0 | Normal NTSC (default) |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
- en: '| 1 | Japanese version of NTSC |'
  id: totrans-181
  prefs: []
  type: TYPE_TB
- en: '| 2 | Normal PAL |'
  id: totrans-182
  prefs: []
  type: TYPE_TB
- en: '| 3 | Brazilian version of PAL |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
- en: '| 16 | Progressive scan NTSC |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
- en: '| 18 | Progressive scan PAL |'
  id: totrans-185
  prefs: []
  type: TYPE_TB
- en: '*sdtv_aspect=* command defines the aspect ratio ([Table 18-2](#table18-2)).'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: Table 18-2\. sdtv_aspect screen ratio settings
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: '| value | ratio |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
- en: '| 1 | 4:3 (default) |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
- en: '| 2 | 14:9 |'
  id: totrans-191
  prefs: []
  type: TYPE_TB
- en: '| 3 | 16:9 |'
  id: totrans-192
  prefs: []
  type: TYPE_TB
- en: See Also
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Video options in config.txt](https://oreil.ly/yp7Mu)'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.7 Booting into Recovery Mode
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-196
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to know how to boot into recovery mode in case you ever have problems.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-198
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have installed your operating system with NOOBS because that is the
    only installer that sets up a recovery mode. Power on your Pi and watch your startup
    screen. A screen with the Raspberry Pi logo and a “For recovery mode, hold Shift”
    message appears briefly. Press and hold the shift key until the recovery screen
    appears ([Figure 18-2](#fig-rpi-8); the recovery screen is the same as the NOOBS
    installation screen).
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
- en: The recovery screen is a nice graphical utility for performing some basic operations.
    You can connect to the internet, browse the online help, edit the */boot/cinfig.txt*,
    or blow away your installation and install something else.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-201
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The recovery screen is the same as the NOOBS installation screen. You have this
    recovery option only when you install Raspberry Pi with NOOBS, though by the time
    you read this it could be different.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-203
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.8 Adding a Second Ethernet Interface
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to use your Raspberry Pi as an internet firewall/router, but it has
    only one Ethernet port, and you really want two Ethernet ports.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-208
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There are two ways to get a second Ethernet port: with a USB-to-Ethernet adapter
    or by installing an Ethernet port that connects to the GPIO pins.'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
- en: USB-to-Ethernet is easy; just plug it in.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
- en: A wired Ethernet port is a little more work. You need an Ethernet adapter powered
    by an ENC28J60 Ethernet controller module ([Figure 18-4](#fig-rpi-6)).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: '![ENC28J60 Ethernet adapter.](Images/lcb2_1804.png)'
  id: totrans-212
  prefs: []
  type: TYPE_IMG
- en: Figure 18-4\. ENC28J60 Ethernet adapter
  id: totrans-213
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The HanRun HR911105A adapter in the photo needs seven female-to-female jumper
    wires to connect to the GPIO pins. You can buy multicolor bundles that supply
    an assortment of wires for cheap.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: Before connecting the wires, generate your own handy pinout diagram by running
    the *pinout* command on your Raspberry Pi ([Figure 18-5](#fig-rpi-9)).
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 18-6](#fig-rpi-10) shows the diagram from RaspberryPi.org numbers and
    labels the GPIO pinouts.'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: '![Pinout diagram generated by pinout command.](Images/lcb2_1805.png)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
- en: Figure 18-5\. Pinout diagram generated by pinout command
  id: totrans-218
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '![Pinout diagram from raspberrypi.org.](Images/lcb2_1806.png)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
- en: Figure 18-6\. Pinout diagram from RaspberryPi.org
  id: totrans-220
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Edit */boot/config.txt* to enable the new Ethernet port and load the drivers:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Keep a copy of the pinout diagram available and power off your Raspberry Pi.
    Connect the jumper wires in the following locations on your RPi and ENC28J60 module:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Note the orientation of the GPIO pins: pin #1 is on the same end of the RPi
    board as the SD card slot. Start with 3V3 pin 17, then all of your wires are in
    the same area, and the other 3V3 pin is free for a case fan.'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
- en: 'When all of the wires are in place, power up your RPi. Run *ifconfig* to see
    your new Ethernet interface. It should be *eth1*:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: There it is, all ready to be configured.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The ENC28J60 Ethernet controller supports only 10 MBps. If your internet speeds
    are no better 10 MBps, then this is fine. On the Raspberry Pi 4 you will get as
    much as 900 MBps with a USB 3.0 Ethernet adapter.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: Older Raspberry Pis have slower Ethernet because it runs over the USB 2.0 bus.
    The RPi 4B is the first Pi to have a dedicated Ethernet bus.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
- en: Keep an eye on new product releases for dual gigabit Ethernet options, as there
    are likely to be some soon.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
- en: The *pinout* command is provided by the *python3-gpiozero* package. This is
    installed by default in the Raspberry Pi OS desktop image, but not on Raspberry
    Pi OS Lite. Install it with *apt install python3-gpiozero*.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[GPIO diagram](https://oreil.ly/0pgXZ)'
  id: totrans-235
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Technical information and datasheet for ENC28J60 controller](https://oreil.ly/HjlAM)'
  id: totrans-236
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.9 Setting Up an Internet Connection Sharing Firewall with firewalld
  id: totrans-237
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to configure a simple firewall on your Raspberry Pi that shares your
    internet connection and keeps the bad bits out.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will use *firewalld* to filter incoming packets, allowing only responses
    to traffic that originated from inside the LAN and disallowing external connection
    requests.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: Your internet gateway setup looks something like [Figure 18-7](#fig-rpi-3).
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
- en: '![Raspberry Pi firewall/router](Images/lcb2_1807.png)'
  id: totrans-243
  prefs: []
  type: TYPE_IMG
- en: Figure 18-7\. Raspberry Pi firewall/router
  id: totrans-244
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The big bad internet comes in through whatever device connects you to your ISP,
    which connects to your Raspberry Pi, which filters and routes traffic to your
    LAN through an Ethernet switch.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: You need two network interfaces on your RPi, one that connects from your internet
    box to the RPi, and a second interface to connect your RPi to your LAN. In this
    recipe we will use two Ethernet interfaces.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
- en: 'Install *firewalld*, and optionally *firewall-config* and *firewall-applet*.
    *firewall-config* provides a graphical configuration tool, and *firewall-applet*
    sits in the panel and provides quick access to some commands, such as the panic
    button and lockdown:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Find your default router/gateway:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '*default via 192.168.1.1* is your default gateway.'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: Make *eth1* the external interface by connecting it to your internet box. *eth0*
    is your internal interface, connected to your LAN switch. The two interfaces should
    be on different subnets. *eth1* should be on the same subnet as your internet
    box. Suppose the LAN interface of your internet box is 192.168.1.1, then *eth1*
    could be 192.168.1.2.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: '*eth0* is on your LAN subnet, for example, 192.168.2.1.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure the two interfaces in */etc/dhcpcd.conf*:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Reboot to apply the changes.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
- en: 'The next step is to set up *firewalld*. The two interfaces must be in two different
    firewall zones. *eth1* goes in the *external* zone, and *eth0* goes in the *internal*
    zone, then verify your changes:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'List the configuration for each zone:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Note that *ssh* access is the default for the external zone. You may add or
    remove any services that you wish. You must leave *masquerade* enabled because
    this is what enables internet access.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: 'Make your changes permanent:'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-263
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: IPv4 forwarding is also enabled by default in the *external* zone, which you
    can verify by reading */proc*. IPv4 forwarding enables routing; otherwise, all
    the packets entering your RPi would not be routed to other hosts on your network.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 1 means it is enabled, 0 is not enabled.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-267
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: IPv4 masquerading is network address translation, or NAT. NAT was created to
    extend the limited pool of IPv4 addresses (which is officially exhausted). NAT
    allows us to freely use the private IPv4 address spaces on our internal networks
    without having to purchase public IPv4 addresses. Your internet provider gives
    you at least one public IPv4 address. Your private addresses are translated to
    appear as your one public IPv4 address; otherwise, your internal hosts would have
    no internet access.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
- en: You can add and remove services from your zones; see [Chapter 14](ch14.xhtml#cha-firewalld).
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 14](ch14.xhtml#cha-firewalld)'
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Debian Bug report logs - #914694](https://oreil.ly/SuHLL)'
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.10 Running Your Raspberry Pi Headless
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-274
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You are using your Raspberry Pi as an internet firewall/router, LAN router,
    or some kind of lightweight LAN server, and you want to reduce the load by running
    it without a graphical desktop.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-276
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: Set up SSH access on your RPi ([Chapter 12](ch12.xhtml#cha-ssh)).
  id: totrans-278
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run *raspi-config* to disable the graphical desktop.
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Reboot.
  id: totrans-280
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Launch *sudo raspi-config*, then navigate to 1 System Options → S5 Boot / Auto
    Login (see [Figure 18-8](#fig-rpi-5)).
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the next boot to console, not GUI, then reboot.
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As long as you can open an SSH session to your RPi, you will be able to access
    it without a screen.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
- en: You can launch your graphical environment from the text console by typing the
    **`startx`** command.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
- en: '![Set the next boot to console, no GUI](Images/lcb2_1808.png)'
  id: totrans-285
  prefs: []
  type: TYPE_IMG
- en: Figure 18-8\. Set the next boot to console, not GUI
  id: totrans-286
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Discussion
  id: totrans-287
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*rpi-config* uses the *ncurses* interface. *ncurses* is a console interface
    that looks like a simple GUI.'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
- en: When you run the Raspberry Pi headless, it needs only power and network connections,
    because you control it over an SSH session from another computer.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 12](ch12.xhtml#cha-ssh)'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.11 Building a DNS/DHCP Server with Raspberry Pi
  id: totrans-293
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  id: totrans-294
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your internet box does not offer much in the way of administration features,
    and you want control of your local name services, DNS and DHCP.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  id: totrans-296
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Disable the name services on your internet box, and set up a second Raspberry
    Pi to provide your LAN name services with Dnsmasq ([Chapter 16](ch16.xhtml#cha-dns-dhcp)).
    Use DHCP to supply all services and addresses to your LAN hosts, including static
    addresses, except for your internet gateway, which should be independent of any
    internal services.
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的互联网盒子上禁用命名服务，并设置第二台树莓派来使用Dnsmasq提供你的局域网命名服务（[第16章](ch16.xhtml#cha-dns-dhcp)）。使用DHCP为所有局域网主机提供所有服务和地址，包括静态地址，但不包括你的互联网网关，它应独立于任何内部服务。
- en: Discussion
  id: totrans-298
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 讨论
- en: You could install your name server on your internet firewall/gateway, but it
    is not a good security practice to put internal services on a host that is directly
    connected to the internet. Your Raspberry Pi DNS/DHCP server needs only a single
    network interface, like any other LAN server.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以将你的域名服务器安装在你的互联网防火墙/网关上，但是把内部服务放在直接连接到互联网的主机上并不是一个良好的安全实践。你的树莓派DNS/DHCP服务器只需要一个单独的网络接口，就像任何其他局域网服务器一样。
- en: See Also
  id: totrans-300
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参阅
- en: '[Chapter 16](ch16.xhtml#cha-dns-dhcp)'
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第16章](ch16.xhtml#cha-dns-dhcp)'
