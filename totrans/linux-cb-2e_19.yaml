- en: Chapter 18\. Building an Internet Firewall/Router on Raspberry Pi
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Raspberry Pi (RPi) makes a great internet firewall/router for small networks,
    and it does not cost a lot of money. You can use any Raspberry Pi, but I recommend
    the Raspberry Pi 4B because it is more powerful than the older Pis and is the
    first Pi with a dedicated gigabit Ethernet port.
  prefs: []
  type: TYPE_NORMAL
- en: Overview
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter you will learn how to install Raspberry Pi OS, connect your
    Pi to a computer monitor or TV, use the Raspberry Pi OS recovery mode, run your
    Pi headless, add a second Ethernet port, share an internet connection, and use
    the Pi for LAN name services.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The examples in this chapter are all on a Raspberry Pi 4 Model B, using the
    Raspberry Pi OS. Raspberry Pi OS used to be called Raspbian. Underneath it is
    Debian Linux, so if you are accustomed to Debian, Ubuntu, Mint, or any other Debian
    variant, it’s the same Linux.
  prefs: []
  type: TYPE_NORMAL
- en: Pros and Cons of a Raspberry Pi Firewall/Router
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Raspberry Pi is a general-purpose computer, not a specialized firewall/router.
    It has WiFi, Ethernet, and Bluetooth, and it runs Linux. In comparison, a common
    choice for small networks is the small combination firewall/router/wireless access
    point/ Ethernet switch, like the Linksys AC1900 or the TP-Link Archer AX20\. These
    have WiFi, gigabit Ethernet, multiple antennas, and support for “smart” services
    like Alexa and smartphone administration apps.
  prefs: []
  type: TYPE_NORMAL
- en: The drawback to these devices is their inflexibility, especially limited storage
    and operating system support. If you want to replace the vendor software, you
    must use specialized router distributions like OpenWRT, DD-WRT, pfSense, or OPNsense,
    which are all excellent, but it is not easy, and you have to find supported devices.
  prefs: []
  type: TYPE_NORMAL
- en: 'These are some of the advantages Raspberry Pi has over the all-in-one boxes:'
  prefs: []
  type: TYPE_NORMAL
- en: Flexibility, just like any general-purpose Linux computer
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: More memory and storage
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Connects to a computer monitor or TV, keyboard, and mouse
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Runs a number of Linux distributions, so you can use your existing knowledge
    and not have to learn some weird new interface or command set
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Runs a number of *bsd operating systems, Windows 10, Android, Chromium, and
    others
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tethers to a mobile hotspot
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 64-bit support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can run the Raspberry Pi with a graphical desktop, with no graphical desktop,
    and headless via SSH, just like any Linux system.
  prefs: []
  type: TYPE_NORMAL
- en: 'Downsides of Raspberry Pi:'
  prefs: []
  type: TYPE_NORMAL
- en: Cannot function as an Ethernet switch, like the all-in-one devices
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: WiFi is not as strong as all-in-one devices
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Raspberry Pi models 3 and older have poor Ethernet performance because the Ethernet
    port shares the USB bus; RPi 4 cures this with a dedicated gigabit Ethernet port
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There are a number of customized Linux operating systems for Raspberry Pi. The
    official operating system is Raspberry Pi OS, which is based on Debian Linux.
    SUSE, Ubuntu, Fedora, Arch Linux ARM, and MX Linux have Raspberry Pi variants.
    There are also specialized media server and gaming distros. In this chapter we’ll
    stick with Raspberry Pi OS because it is optimized for the Pi, and you get a full
    graphical desktop with decent performance even on the older RPi models. Raspberry
    Pi OS is just like any other Linux, so anything you can do on a big Linux machine
    you can do on Raspberry Pi.
  prefs: []
  type: TYPE_NORMAL
- en: Hardware Architecture
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The RPi is powered by a Broadcom system-on-a-chip (SoC). The CPU, GPU, and I/O
    are all on a single chip. This is especially impressive on the Raspberry Pi 4
    Model B, which supports running two screens at the same time. It handles high-definition
    movies without a hiccup.
  prefs: []
  type: TYPE_NORMAL
- en: The Broadcom SoC is an ARM chip, rather than the x86_64 architecture that dominates
    the PC market. ARM processors are less complex, using a reduced instruction set
    (RISC). x86_64 processors are CISC, complex instruction set computers. x86_64
    processors work a lot harder, are considerably more complex, and consume more
    power.
  prefs: []
  type: TYPE_NORMAL
- en: Rasberry Pi Banquet of Products
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Every Raspberry Pi model ever made is still available, including updated releases
    of the Raspberry Pi 1, models A and B. The A models are the lower-cost versions
    of every release, and the B models cost a little more for more features.
  prefs: []
  type: TYPE_NORMAL
- en: 'You have many other Pis to choose from, such as:'
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi Zero, the smallest Pi for $5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Raspberry Pi Zero W includes WiFi, $10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Raspberry Pi 400 Personal Computer Kit, a complete system integrated into a
    compact keyboard (all you need to add is a display), $100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RPi prices have been stable since the first RPi was released, though of course
    this could change.
  prefs: []
  type: TYPE_NORMAL
- en: 'There is a giant thundering herd of accessories: cases, touchscreens, heat
    sinks, fans, breakout boards, hats (expansion boards), all manner of cables and
    adapters, motors, cameras, audio boards, little wireless keyboards with touchpads,
    gaming emulators, RGB matrices, powered USB hubs, real-time clocks, tiny displays…it
    is one of the best playgrounds ever.'
  prefs: []
  type: TYPE_NORMAL
- en: History and Purpose
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Raspberry Pi is a real phenomenon. The original intent of its creator, Eben
    Upton, was to produce a small and inexpensive computer to encourage young students
    to study computing, especially students who could not afford to buy a PC. The
    first Raspberry Pi, Version 1 Model B, cost about $35\. Add a keyboard and mouse,
    connect to a TV or monitor, and for less than a tenth the price of a PC you had
    a working Linux computer with audio, video, Ethernet, and USB. The open hardware
    design, combined with open source software, encourages hacking and learning.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The Broadcom chipsets that power the Pi are not open. This has been a point
    of contention since the first Pi was released. The schematics are open, available
    on [RaspberryPi.org](https://raspberrypi.org), and the operating system and BIOS
    are open source. In my moderately humble opinion, a completely open source platform
    is preferable and would be great, and having something that works and is available
    now is better than not having something that works and is available now.
  prefs: []
  type: TYPE_NORMAL
- en: 'The first Raspberry Pi was an immediate success, selling over 500,000 units
    in the first 6 months after its release in February 2012\. Since then around 30
    million Raspberry Pis have been sold. The current version, Version 4 Model B,
    is a significant upgrade, the most powerful model yet, featuring:'
  prefs: []
  type: TYPE_NORMAL
- en: 2 USB 2 ports
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2 USB 3 ports
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2 micro HDMI ports, supporting 2 4K displays
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 1 dedicated gigabit Ethernet port
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Supports RAM from 2 GB–8 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Broadcom BCM2711, 1.5 GHz Quad-core Cortex-A72 (ARM v8) 64-bit SoC
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 2.4 GHz and 5.0 GHz IEEE 802.11ac WiFi
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Bluetooth
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 40-pin GPIO header
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Compared to modern Intel and AMD CPUs, these specs are far from bragworthy,
    but it’s enough horsepower to run a Linux graphical desktop, play music, movies,
    surf the web, write documents…it is quite capable for its size and price.
  prefs: []
  type: TYPE_NORMAL
- en: The Raspberry Pi is developed and produced by the Raspberry Pi Foundation, a
    registered nonprofit charity. The foundation supports numerous education projects
    for teachers and students; visit [*https://raspberrypi.org*](https://raspberrypi.org)
    for current educational materials and information.
  prefs: []
  type: TYPE_NORMAL
- en: 18.1 Starting and Shutting Down Raspberry Pi
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You don’t see a power switch on your Raspberry Pi (RPi), and you want to turn
    it on and off.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Power it up by plugging in the power connector. Shut it down from the menu in
    your operating system, then unplug it.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you shut down your RPi, you have to disconnect and then reconnect the power
    to start it up again.
  prefs: []
  type: TYPE_NORMAL
- en: It wouldn’t surprise me if there is a power switch out there somewhere made
    for the RPi, though I have not seen one. One alternative is to plug it into a
    switched power strip.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[*https://raspberrypi.org*](https://raspberrypi.org)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.2 Finding Hardware and How-Tos
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You bought a Raspberry Pi 4 Model B, and you want to know what other hardware
    devices you need in order to use it.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Presumably you already have a computer monitor or TV, mouse, and keyboard.
    You also need:'
  prefs: []
  type: TYPE_NORMAL
- en: Raspberry Pi power supply
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: HDMI-to-micro-HDMI cable
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Micro SD card of at least 16 GB
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Cooling fan, or heat sinks on the CPU, RAM module, and USB controller
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Case
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Micro SD card reader
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Start by installing Raspberry Pi OS to your micro SD card on another computer.
    While that is running, assemble your hardware. When everything is ready, connect
    the power and watch your new system boot up. (See Recipes [18.4](#rec-install-pi)
    and [18.5](#rec-install-noobs) to learn how to install Raspberry Pi OS.)
  prefs: []
  type: TYPE_NORMAL
- en: To learn all about RPi, there are numerous sources of schematics, specifications,
    how-tos, and clever ideas. The “See Also” section of this recipe lists a nice
    selection to get you started.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If your display does not have an HDMI port, see [Recipe 18.6](#rec-no-hdmi).
  prefs: []
  type: TYPE_NORMAL
- en: You may use any micro SD card at least 16 GB in size. High-speed cards make
    a noticeable performance improvement. 16 GB is pretty small, and you can use as
    large a card as you like.
  prefs: []
  type: TYPE_NORMAL
- en: The RPi 4B has three RAM options, 2 GB, 4 GB, and 8 GB. It is not upgradable,
    so whatever you buy is what you will have. 2 GB is more than enough for an internet
    gateway, and using your Pi as a lightweight Linux desktop. More memory is good
    for multimedia processing, compiling code, games, and other memory-intensive tasks.
  prefs: []
  type: TYPE_NORMAL
- en: The RPi 4B is quite a bit more powerful than older Pis, and it runs hotter than
    older versions. See [Recipe 18.3](#cooling-rpi) to learn how to keep it cool.
  prefs: []
  type: TYPE_NORMAL
- en: With 4 USB ports, the RPi 4B has a lot of flexibility. You can use standard
    USB keyboards and mice, a keyboard with a trackpad, and USB-to-PS/2 adapters for
    older keyboards and mice. You can attach a USB hard drive for more storage or
    backups, and any other USB devices just like on a big computer. The 40-pin GPIO
    header supports attaching nearly any expansion board.
  prefs: []
  type: TYPE_NORMAL
- en: There are many nice kits that bundle everything you need to get started. My
    favorite store is [Adafruit.com](https://adafruit.com), and you can find many
    more listed on [*https://raspberrypi.org*](https://raspberrypi.org).
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'These sites publish excellent Raspberry Pi tutorials:'
  prefs: []
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Adafruit](https://oreil.ly/5qwn5)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MagPi](https://oreil.ly/EuMY7)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Hackspace](https://oreil.ly/5KY5B)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Maker Pro](https://oreil.ly/NQcB0)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Makezine](https://oreil.ly/foZqS)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.3 Cooling the Raspberry Pi
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your Raspberry Pi feels hot to the touch, and you want to install some kind
    of cooling for it.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Install a cooling fan in the case, or heat sinks on the CPU, RAM module, and
    USB controller. Install a fan and heat sinks on the Raspberry Pi 4, which runs
    hotter than older Pis.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use the built-in *vcgencmd* command to measure CPU temperatures before and
    after installing cooling devices, and before and after running computationally
    intensive tasks such as compiling code or playing videos. The following example
    is a fanless board at idle with the case lid removed, and then after five minutes
    of playing a movie at 1080p:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'This example shows the effect of a cooling fan when playing the same movie:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The temperature should not go over 70°C. 40°C to 60°C is a good operating range.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Adafruit](https://oreil.ly/5qwn5)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[MagPi](https://oreil.ly/EuMY7)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.4 Installing Raspberry Pi OS with Imager and dd
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You have your hardware, and you want to install the operating system.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You will create a bootable micro SD card on another computer, then load the
    SD card into your Raspberry Pi and start it up.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are four ways to get a bootable SD card:'
  prefs: []
  type: TYPE_NORMAL
- en: Use the Raspberry Pi Imager (currently only for *.deb* systems such as Debian,
    Ubuntu, or Mint)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use the NOOBS installer ([Recipe 18.5](#rec-install-noobs))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Copy your installation image to your micro SD card with the *dd* command
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Buy a micro SD card with the installer already loaded
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: I favor NOOBs because it works on all Linuxes, and it creates a rescue boot
    mode.
  prefs: []
  type: TYPE_NORMAL
- en: 'To install the Raspberry Pi Imager from the *.deb* package, download it from
    [*https://raspberrypi.org*](https://raspberrypi.org). Then install the package:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Alternatively, Ubuntu users can install the Raspberry Pi Imager with *apt*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Plug your SD card into your computer. Locate it with *lsblk -p* (see [Recipe
    10.9](ch10.xhtml#rec-lsblk-hardware)).
  prefs: []
  type: TYPE_NORMAL
- en: Start the Raspberry Pi Imager from your system menu, and enjoy its cheery raspberry
    logo. Click Operating System to select the operating system you want to install,
    and the Imager will download it and copy it to your SD card. If you have already
    downloaded an image, scroll down the selection menu to Use Custom to select your
    downloaded image. You will see a screen like [Figure 18-1](#fig-rpi-1).
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a bootable micro SD card with Raspberry Pi Imager](Images/lcb2_1801.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-1\. Creating a bootable micro SD card with Raspberry Pi Imager
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Click SD Card to select the device, and then click Write to install the operating
    system.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you don’t have an Ubuntu system, download your chosen operating system image
    from [*https://raspberrypi.org*](https://raspberrypi.org) and use the *dd* command
    to copy it to your SD card. The following example unzips and copies *2021-03-24-raspios-buster-armhf.zip*
    to the SD card:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: When the SD card is ready, insert it in your Raspberry Pi and power it on. When
    it boots up, you will complete a short setup, and then it is ready to use.
  prefs: []
  type: TYPE_NORMAL
- en: The default user is *pi*. Look in */home/pi/Bookshelf* for a PDF copy of *The
    Official Raspberry Pi Beginner’s Guide* by Gareth Halfacree (Raspberry Pi Press).
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You do not have to format your SD card before copying with *dd*.
  prefs: []
  type: TYPE_NORMAL
- en: 'The imager creates two partitions: a 256 MB FAT32 */boot* partition, and an
    Ext4 *rootfs* partition just big enough to hold the filesystem. On my test system
    that is 3.4 GB, and the rest of the card is unallocated space.'
  prefs: []
  type: TYPE_NORMAL
- en: When you boot up your new system for the first time, the root filesystem is
    expanded to fill all the unallocated space. You may shrink the root filesystem
    and create more partitions with GParted ([Chapter 9](ch09.xhtml#cha-partitioning-gparted))
    or *parted* ([Chapter 8](ch08.xhtml#cha-partitioning-parted)).
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.5 Installing Raspberry Pi with NOOBS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to use NOOBS to install Raspberry Pi.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NOOBS (New Out Of the Box Software) is an older installer. It works on all Linux
    distributions and creates a recovery boot mode, which Raspberry Pi Imager does
    not do.
  prefs: []
  type: TYPE_NORMAL
- en: Download NOOBS on another computer, unzip the download archive, copy all of
    its files to a micro SD card, then load the SD card into your Raspberry Pi and
    start it up.
  prefs: []
  type: TYPE_NORMAL
- en: 'Download NOOBS from [*https://raspberrypi.org*](https://raspberrypi.org). There
    are two versions: NOOBS and NOOBS Lite. NOOBS includes Raspberry Pi OS, and a
    network installer for other operating systems. NOOBS Lite includes only the network
    installer.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Unpack NOOBS after downloading:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Plug your SD card into your computer. Locate it with *lsblk -p* (see [Recipe
    10.9](ch10.xhtml#rec-lsblk-hardware)).
  prefs: []
  type: TYPE_NORMAL
- en: Format your micro SD card as a single FAT32 partition.
  prefs: []
  type: TYPE_NORMAL
- en: Copy all the NOOBS files to your SD card, then use it to boot your Raspberry
    Pi. First you will see a cool rainbow colored screen, then NOOBS boots to the
    installation menu ([Figure 18-2](#fig-rpi-8)). Set up networking to use the network
    installer or to get updates after installation. Select your operating system,
    then go find something to do until it is finished.
  prefs: []
  type: TYPE_NORMAL
- en: '![NOOBS installation screen.](Images/lcb2_1802.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-2\. NOOBS installation screen
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: After installation is complete, you will go through a brief setup process, and
    then your Raspberry Pi is ready to use.
  prefs: []
  type: TYPE_NORMAL
- en: The default user is *pi*. Look in */home/pi/Bookshelf* for a PDF copy of *The
    Official Raspberry Pi Beginner’s Guide* by Gareth Halfacree (Raspberry Pi Press).
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NOOBS is a simple unzip and copy, so it works on any computer.
  prefs: []
  type: TYPE_NORMAL
- en: Copying the NOOBS files to your SD card can take a long time. Usually it is
    faster to copy the ZIP file to the SD card, then unzip it on the card. You can
    delete the ZIP file after installation.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 9](ch09.xhtml#cha-partitioning-gparted)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.6 Connecting to a Video Display Without HDMI
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You have a TV or computer monitor that does not have HDMI ports, and you want
    to connect your Raspberry Pi to it.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There are four ways to connect a screen to the RPi 4B. You can use:'
  prefs: []
  type: TYPE_NORMAL
- en: Small screens made for the Raspberry Pi
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DVI-to-HDMI adapter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: VGA-to-HDMI adapter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RCA composite video (use cables made for Raspberry Pi)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'There is quite a variety of screens made for the RPi: touchscreens, LED, LCD,
    OLED, eInk—you name it, there is probably an RPi version. Follow the installation
    instructions that come with the screen.'
  prefs: []
  type: TYPE_NORMAL
- en: The DVI-to-HDMI and VGA-to-HDMI adapters connect to your screen, and then your
    HDMI-to-micro-HDMI cable connects to the adapter. When you connect to a single
    HDMI display on the RPi 4B, plug into the HDMI 0 port, which is the one closest
    to the power port.
  prefs: []
  type: TYPE_NORMAL
- en: 'Composite video requires some extra steps on the RPi 4B because it is disabled
    by default. The easy way is to find an HDMI screen to use when you boot your Pi
    for the first time and complete your installation. After your installation is
    complete, open the configuration tool to enable composite video:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Arrow-key down to 6 Advanced Options, then select A8 HDMI/Composite. Select
    V2 Enable Composite. Exit *raspi-config*, shut down your Pi, connect your Pi to
    your composite video screen, then start it up again. It should default to your
    composite video screen.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Older flat-panel screens usually have VGA and composite video connectors, so
    you could use either composite video or a VGA-to-HDMI adapter. Technically, HDMI
    delivers a higher-quality image than composite video, but most people cannot tell
    the difference.
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 18-3](#fig-rpi-4) shows a Rocketfish DVI-to-HDMI adapter, a composite
    cable bundle, a Rasberry Pi 4B in a CanaKit case with the top removed, and a micro
    SD card.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Raspberry Pi 4B with accessories](Images/lcb2_1803.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-3\. Raspberry Pi 4B with accessories
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'The RCA composite audio/video cable set, the one with the yellow, red, and
    white connectors, plugs into the nifty little 3.5 mm TRRS port on the RPi. You
    need one made for the RPi because there is no standard for how the TRRS plug is
    ordered. You might find some that don’t work as they are supposed to, which is
    yellow for video, and red and white for audio. Avoid composite cables made for
    camcorders and MP3 players, which have their own weird ordering that puts the
    ground ring in the wrong place. The TRRS (tip-ring-ring-sleeve) plug should be
    configured like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: There are several options for tweaking your composite video settings in */boot/config.txt*.
    If you plan to use composite video, use the NOOBS installer. Then if you need
    to correct its settings, you can boot to recovery mode ([Recipe 18.7](Images/#rec-recovery-mode))
    and have access to */boot/config.txt*.
  prefs: []
  type: TYPE_NORMAL
- en: '*sdtv_mode=* sets the TV standard. *sdtv_mode=0* is the default for North America.
    Most of the world uses PAL; see [Table 18-1](#table18-1) for the settings.'
  prefs: []
  type: TYPE_NORMAL
- en: Table 18-1\. sdtv_mode settings
  prefs: []
  type: TYPE_NORMAL
- en: '| value | mode |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 0 | Normal NTSC (default) |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | Japanese version of NTSC |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | Normal PAL |'
  prefs: []
  type: TYPE_TB
- en: '| 3 | Brazilian version of PAL |'
  prefs: []
  type: TYPE_TB
- en: '| 16 | Progressive scan NTSC |'
  prefs: []
  type: TYPE_TB
- en: '| 18 | Progressive scan PAL |'
  prefs: []
  type: TYPE_TB
- en: '*sdtv_aspect=* command defines the aspect ratio ([Table 18-2](#table18-2)).'
  prefs: []
  type: TYPE_NORMAL
- en: Table 18-2\. sdtv_aspect screen ratio settings
  prefs: []
  type: TYPE_NORMAL
- en: '| value | ratio |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | 4:3 (default) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | 14:9 |'
  prefs: []
  type: TYPE_TB
- en: '| 3 | 16:9 |'
  prefs: []
  type: TYPE_TB
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Video options in config.txt](https://oreil.ly/yp7Mu)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.7 Booting into Recovery Mode
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to know how to boot into recovery mode in case you ever have problems.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must have installed your operating system with NOOBS because that is the
    only installer that sets up a recovery mode. Power on your Pi and watch your startup
    screen. A screen with the Raspberry Pi logo and a “For recovery mode, hold Shift”
    message appears briefly. Press and hold the shift key until the recovery screen
    appears ([Figure 18-2](#fig-rpi-8); the recovery screen is the same as the NOOBS
    installation screen).
  prefs: []
  type: TYPE_NORMAL
- en: The recovery screen is a nice graphical utility for performing some basic operations.
    You can connect to the internet, browse the online help, edit the */boot/cinfig.txt*,
    or blow away your installation and install something else.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The recovery screen is the same as the NOOBS installation screen. You have this
    recovery option only when you install Raspberry Pi with NOOBS, though by the time
    you read this it could be different.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.8 Adding a Second Ethernet Interface
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to use your Raspberry Pi as an internet firewall/router, but it has
    only one Ethernet port, and you really want two Ethernet ports.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There are two ways to get a second Ethernet port: with a USB-to-Ethernet adapter
    or by installing an Ethernet port that connects to the GPIO pins.'
  prefs: []
  type: TYPE_NORMAL
- en: USB-to-Ethernet is easy; just plug it in.
  prefs: []
  type: TYPE_NORMAL
- en: A wired Ethernet port is a little more work. You need an Ethernet adapter powered
    by an ENC28J60 Ethernet controller module ([Figure 18-4](#fig-rpi-6)).
  prefs: []
  type: TYPE_NORMAL
- en: '![ENC28J60 Ethernet adapter.](Images/lcb2_1804.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-4\. ENC28J60 Ethernet adapter
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The HanRun HR911105A adapter in the photo needs seven female-to-female jumper
    wires to connect to the GPIO pins. You can buy multicolor bundles that supply
    an assortment of wires for cheap.
  prefs: []
  type: TYPE_NORMAL
- en: Before connecting the wires, generate your own handy pinout diagram by running
    the *pinout* command on your Raspberry Pi ([Figure 18-5](#fig-rpi-9)).
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 18-6](#fig-rpi-10) shows the diagram from RaspberryPi.org numbers and
    labels the GPIO pinouts.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Pinout diagram generated by pinout command.](Images/lcb2_1805.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-5\. Pinout diagram generated by pinout command
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: '![Pinout diagram from raspberrypi.org.](Images/lcb2_1806.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-6\. Pinout diagram from RaspberryPi.org
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: 'Edit */boot/config.txt* to enable the new Ethernet port and load the drivers:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'Keep a copy of the pinout diagram available and power off your Raspberry Pi.
    Connect the jumper wires in the following locations on your RPi and ENC28J60 module:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'Note the orientation of the GPIO pins: pin #1 is on the same end of the RPi
    board as the SD card slot. Start with 3V3 pin 17, then all of your wires are in
    the same area, and the other 3V3 pin is free for a case fan.'
  prefs: []
  type: TYPE_NORMAL
- en: 'When all of the wires are in place, power up your RPi. Run *ifconfig* to see
    your new Ethernet interface. It should be *eth1*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: There it is, all ready to be configured.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The ENC28J60 Ethernet controller supports only 10 MBps. If your internet speeds
    are no better 10 MBps, then this is fine. On the Raspberry Pi 4 you will get as
    much as 900 MBps with a USB 3.0 Ethernet adapter.
  prefs: []
  type: TYPE_NORMAL
- en: Older Raspberry Pis have slower Ethernet because it runs over the USB 2.0 bus.
    The RPi 4B is the first Pi to have a dedicated Ethernet bus.
  prefs: []
  type: TYPE_NORMAL
- en: Keep an eye on new product releases for dual gigabit Ethernet options, as there
    are likely to be some soon.
  prefs: []
  type: TYPE_NORMAL
- en: The *pinout* command is provided by the *python3-gpiozero* package. This is
    installed by default in the Raspberry Pi OS desktop image, but not on Raspberry
    Pi OS Lite. Install it with *apt install python3-gpiozero*.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[GPIO diagram](https://oreil.ly/0pgXZ)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Technical information and datasheet for ENC28J60 controller](https://oreil.ly/HjlAM)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.9 Setting Up an Internet Connection Sharing Firewall with firewalld
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You want to configure a simple firewall on your Raspberry Pi that shares your
    internet connection and keeps the bad bits out.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will use *firewalld* to filter incoming packets, allowing only responses
    to traffic that originated from inside the LAN and disallowing external connection
    requests.
  prefs: []
  type: TYPE_NORMAL
- en: Your internet gateway setup looks something like [Figure 18-7](#fig-rpi-3).
  prefs: []
  type: TYPE_NORMAL
- en: '![Raspberry Pi firewall/router](Images/lcb2_1807.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-7\. Raspberry Pi firewall/router
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: The big bad internet comes in through whatever device connects you to your ISP,
    which connects to your Raspberry Pi, which filters and routes traffic to your
    LAN through an Ethernet switch.
  prefs: []
  type: TYPE_NORMAL
- en: You need two network interfaces on your RPi, one that connects from your internet
    box to the RPi, and a second interface to connect your RPi to your LAN. In this
    recipe we will use two Ethernet interfaces.
  prefs: []
  type: TYPE_NORMAL
- en: 'Install *firewalld*, and optionally *firewall-config* and *firewall-applet*.
    *firewall-config* provides a graphical configuration tool, and *firewall-applet*
    sits in the panel and provides quick access to some commands, such as the panic
    button and lockdown:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'Find your default router/gateway:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '*default via 192.168.1.1* is your default gateway.'
  prefs: []
  type: TYPE_NORMAL
- en: Make *eth1* the external interface by connecting it to your internet box. *eth0*
    is your internal interface, connected to your LAN switch. The two interfaces should
    be on different subnets. *eth1* should be on the same subnet as your internet
    box. Suppose the LAN interface of your internet box is 192.168.1.1, then *eth1*
    could be 192.168.1.2.
  prefs: []
  type: TYPE_NORMAL
- en: '*eth0* is on your LAN subnet, for example, 192.168.2.1.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Configure the two interfaces in */etc/dhcpcd.conf*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Reboot to apply the changes.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next step is to set up *firewalld*. The two interfaces must be in two different
    firewall zones. *eth1* goes in the *external* zone, and *eth0* goes in the *internal*
    zone, then verify your changes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'List the configuration for each zone:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Note that *ssh* access is the default for the external zone. You may add or
    remove any services that you wish. You must leave *masquerade* enabled because
    this is what enables internet access.
  prefs: []
  type: TYPE_NORMAL
- en: 'Make your changes permanent:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: IPv4 forwarding is also enabled by default in the *external* zone, which you
    can verify by reading */proc*. IPv4 forwarding enables routing; otherwise, all
    the packets entering your RPi would not be routed to other hosts on your network.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 1 means it is enabled, 0 is not enabled.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: IPv4 masquerading is network address translation, or NAT. NAT was created to
    extend the limited pool of IPv4 addresses (which is officially exhausted). NAT
    allows us to freely use the private IPv4 address spaces on our internal networks
    without having to purchase public IPv4 addresses. Your internet provider gives
    you at least one public IPv4 address. Your private addresses are translated to
    appear as your one public IPv4 address; otherwise, your internal hosts would have
    no internet access.
  prefs: []
  type: TYPE_NORMAL
- en: You can add and remove services from your zones; see [Chapter 14](ch14.xhtml#cha-firewalld).
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 14](ch14.xhtml#cha-firewalld)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Debian Bug report logs - #914694](https://oreil.ly/SuHLL)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.10 Running Your Raspberry Pi Headless
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You are using your Raspberry Pi as an internet firewall/router, LAN router,
    or some kind of lightweight LAN server, and you want to reduce the load by running
    it without a graphical desktop.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Follow these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Set up SSH access on your RPi ([Chapter 12](ch12.xhtml#cha-ssh)).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Run *raspi-config* to disable the graphical desktop.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Reboot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Launch *sudo raspi-config*, then navigate to 1 System Options → S5 Boot / Auto
    Login (see [Figure 18-8](#fig-rpi-5)).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Set the next boot to console, not GUI, then reboot.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As long as you can open an SSH session to your RPi, you will be able to access
    it without a screen.
  prefs: []
  type: TYPE_NORMAL
- en: You can launch your graphical environment from the text console by typing the
    **`startx`** command.
  prefs: []
  type: TYPE_NORMAL
- en: '![Set the next boot to console, no GUI](Images/lcb2_1808.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-8\. Set the next boot to console, not GUI
  prefs:
  - PREF_H6
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*rpi-config* uses the *ncurses* interface. *ncurses* is a console interface
    that looks like a simple GUI.'
  prefs: []
  type: TYPE_NORMAL
- en: When you run the Raspberry Pi headless, it needs only power and network connections,
    because you control it over an SSH session from another computer.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 12](ch12.xhtml#cha-ssh)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[The Raspberry Pi Foundation](https://oreil.ly/Ji4j2)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 18.11 Building a DNS/DHCP Server with Raspberry Pi
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Problem
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your internet box does not offer much in the way of administration features,
    and you want control of your local name services, DNS and DHCP.
  prefs: []
  type: TYPE_NORMAL
- en: Solution
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Disable the name services on your internet box, and set up a second Raspberry
    Pi to provide your LAN name services with Dnsmasq ([Chapter 16](ch16.xhtml#cha-dns-dhcp)).
    Use DHCP to supply all services and addresses to your LAN hosts, including static
    addresses, except for your internet gateway, which should be independent of any
    internal services.
  prefs: []
  type: TYPE_NORMAL
- en: Discussion
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You could install your name server on your internet firewall/gateway, but it
    is not a good security practice to put internal services on a host that is directly
    connected to the internet. Your Raspberry Pi DNS/DHCP server needs only a single
    network interface, like any other LAN server.
  prefs: []
  type: TYPE_NORMAL
- en: See Also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Chapter 16](ch16.xhtml#cha-dns-dhcp)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
