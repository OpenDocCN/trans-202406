<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Shells and Scripting"><div class="chapter" id="shells-scripting">
<h1><span class="label">Chapter 3. </span>Shells and Scripting</h1>


<p>In this chapter, we’ll focus on interacting with Linux on the terminal,
that is, via the shell that exposes a command-line interface (CLI).
It is vitally important to be able to use the shell effectively to
accomplish everyday tasks, and to that end we focus on usability here.</p>

<p>First, we review some terminology and provide a gentle and concise introduction
to shell basics. Then we have a look at modern, human-friendly shells, such as
the Fish shell. We’ll also look at configuration and common tasks in the shell.
Then, we move on to the topic of how to effectively work on the CLI using a
terminal multiplexer, enabling you to work with multiple sessions, local or
remote. In the last part of this chapter, we switch gears and focus on
automating tasks in the shell using scripts, including best practices for writing scripts in a safe, secure, and portable manner and also how to lint and
test scripts.</p>

<p>There are two major ways to interact with Linux, from a CLI perspective.
The first way is manually—that is, a human user sits in front of the terminal,
interactively typing commands and consuming the output. This ad-hoc interaction
works for most of the things you want to do in the shell on a day-to-day basis, including the following:</p>

<ul>
<li>
<p>Listing directories, finding files, or looking for content in files</p>
</li>
<li>
<p>Copying files between directories or to remote machines</p>
</li>
<li>
<p>Reading emails or the news or sending a Tweet from the terminal</p>
</li>
</ul>

<p>Further, we’ll learn how to conveniently and efficiently work with
multiple shell sessions at the same time.</p>

<p>The other mode of operation is the automated processing of a series of
commands in a special kind of file that the shell interprets for you and in
turn executes. <a data-type="indexterm" data-primary="scripting" data-secondary="defined" id="idm45805439962480"/>This mode is usually called <em>shell scripting</em> or just <em>scripting</em>.
You typically want to use a script rather than manually repeating certain tasks.
Also, scripts are the basis of many config and install systems.
Scripts are indeed very convenient. However, they can also pose a danger
if used without precautions. So, whenever you think about writing a script,
keep the XKCD web comic shown in <a data-type="xref" href="#fig-xkcd-automation">Figure 3-1</a>
in mind.</p>

<figure><div id="fig-xkcd-automation" class="figure">
<img src="Images/lmlx_0301.png" alt="lmlx 0301" width="600" height="607"/>
<h6><span class="label">Figure 3-1. </span>XKCD on <a href="https://oreil.ly/GSKUb">automation</a>. <em>Credit</em>: Randall Munroe (shared under CC BY-NC 2.5 license)</h6>
</div></figure>

<p>I strongly recommend that you have a Linux environment available and try out the
examples shown here right away. With that, are you ready for some (inter)action?
If so, then let’s start with some terminology and basic shell usage.</p>






<section data-type="sect1" data-pdf-bookmark="Basics"><div class="sect1" id="shell-basics">
<h1>Basics</h1>

<p>Before we get into different options and configurations, let’s focus on some
basic terms such as <em>terminal</em> and <em>shell</em>. In this section I’ll define
the terminology and show you how to accomplish everyday tasks in the shell.
We’ll also review modern commands and see them in action.</p>








<section data-type="sect2" data-pdf-bookmark="Terminals"><div class="sect2" id="terminals">
<h2>Terminals</h2>

<p><a data-type="indexterm" data-primary="terminal" id="idm45805439951280"/>We start with the terminal, or terminal emulator, or soft terminal,
all of which refer to the same thing: a <em>terminal</em> is a program that provides
a textual user interface. That is, a terminal supports reading characters
from the keyboard and displaying them on the screen. Many years ago, these
used to be integrated devices (keyboard and screen together), but nowadays
terminals are simply apps.</p>

<p><a data-type="indexterm" data-primary="escape sequences" id="idm45805439949648"/>In addition to the basic character-oriented input and output, terminals support
so-called <a href="https://oreil.ly/AT5qC"><em>escape sequences</em>, or
<em>escape codes</em></a>, for cursor and screen handling and potentially support for colors.
For example, pressing Ctrl+H causes a backspace, which deletes
the character to the left of the cursor.</p>

<p>The environment variable <code>TERM</code> has the terminal emulator in use, and its
configuration is available via <code>infocmp</code> as follows (note that the output
has been shortened):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>infocmp</code><code> </code><a class="co" id="co_shells_and_scripting_CO1-1" href="#callout_shells_and_scripting_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="c1">#       Reconstructed via infocmp from file: /lib/terminfo/s/screen-256color
</code><code>screen-256color</code><code class="p">|</code><code>GNU</code><code> </code><code>Screen</code><code> </code><code>with</code><code> </code><code class="m">256</code><code> </code><code>colors,</code><code>
        </code><code>am,</code><code> </code><code>km,</code><code> </code><code>mir,</code><code> </code><code>msgr,</code><code> </code><code>xenl,</code><code>
        </code><code>colors#0x100,</code><code> </code><code>cols#80,</code><code> </code><code>it#8,</code><code> </code><code>lines#24,</code><code> </code><code>pairs#0x10000,</code><code>
        </code><code class="nv">acsc</code><code class="o">=</code><code>++</code><code class="se">\,</code><code class="se">\,</code><code>--..00</code><code class="sb">`</code><code class="sb">`</code><code>aaffgghhiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz</code><code class="o">{</code><code class="o">{</code><code class="o">||</code><code class="o">}</code><code class="o">}</code><code>~~,</code><code>
        </code><code class="nv">bel</code><code class="o">=</code><code>^G,</code><code> </code><code class="nv">blink</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>5m,</code><code> </code><code class="nv">bold</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>1m,</code><code> </code><code class="nv">cbt</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>Z,</code><code> </code><code class="nv">civis</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>?25l,</code><code>
        </code><code class="nv">clear</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>H</code><code class="se">\E</code><code class="o">[</code><code>J,</code><code> </code><code class="nv">cnorm</code><code class="o">=</code><code class="se">\E</code><code class="o">[</code><code>34h</code><code class="se">\E</code><code class="o">[</code><code>?25h,</code><code> </code><code class="nv">cr</code><code class="o">=</code><code class="se">\r</code><code>,</code><code>
        </code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO1-1" href="#co_shells_and_scripting_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The output of <code>infocmp</code> is not easy to digest. If you want to learn about
the capabilities in detail, consult the
<a href="https://oreil.ly/qjwiv">terminfo</a>
database. For example, in my concrete output, the terminal supports 80
columns (<code>cols#80</code>) and 24 lines (<code>lines#24</code>) for output as well as 256
colors (<code>colors#0x100</code>, in hexadecimal notation).</p></dd>
</dl>

<p>Examples of terminals include not only <code>xterm</code>, <code>rxvt</code>, and the Gnome terminator
but also new generation ones that utilize the GPU, such as
<a href="https://oreil.ly/zm9M9">Alacritty</a>,
<a href="https://oreil.ly/oxyMn">kitty</a>, and
<a href="https://oreil.ly/WBG9S">warp</a>.</p>

<p>In <a data-type="xref" href="#terminal-mux">“Terminal Multiplexer”</a>, we will come back to the topic of the terminal.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Shells"><div class="sect2" id="shells">
<h2>Shells</h2>

<p><a data-type="indexterm" data-primary="shell" id="ix_ch03-asciidoc0"/><a data-type="indexterm" data-primary="shell" data-secondary="elements of" id="ix_ch03-asciidoc1"/>Next up is the <em>shell</em>, a program that runs inside the terminal and acts as
a command interpreter. The shell offers input and output handling via streams,
supports variables, has some built-in commands you can use, deals with
command execution and status, and usually supports both interactive usage as
well as scripted usage (<a data-type="xref" href="#scripting">“Scripting”</a>).</p>

<p><a data-type="indexterm" data-primary="POSIX (Portable Operating System Interface)" id="idm45805439824512"/>The shell is formally defined in <a href="https://oreil.ly/ISxwU"><code>sh</code></a>,
and we often come across the term <a href="https://oreil.ly/rkfqG">POSIX shell</a>,
which will become more important in the context of scripts and portability.</p>

<p><a data-type="indexterm" data-primary="bash" data-secondary="origins" id="idm45805439821760"/>Originally, we had the Bourne shell <code>sh</code>, named after the author, but nowadays
it’s usually replaced with the
<a href="https://oreil.ly/C9coL">bash</a> shell—a wordplay on
the original version, short for “Bourne Again Shell”—which is widely used as the
default.</p>

<p>If you are curious about what you’re using, use the <code>file -h /bin/sh</code>
command to find out, or if that fails, try <code>echo $0</code> or <code>echo $SHELL</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In this section, we assume the bash shell (<code>bash</code>),
unless we call it out explicitly.</p>
</div>

<p>There are many more implementations of <code>sh</code> as well as other variants, such as
the Korn shell, <code>ksh</code>, and C shell, <code>csh</code>, which are not widely used today. We will,
however, review modern <code>bash</code> replacements in <a data-type="xref" href="#human-friendly-shells">“Human-Friendly Shells”</a>.</p>

<p>Let’s start our shell basics with two fundamental features: streams and
variables.</p>










<section data-type="sect3" data-pdf-bookmark="Streams"><div class="sect3" id="shell-streams">
<h3>Streams</h3>

<p><a data-type="indexterm" data-primary="I/O streams" id="ix_ch03-asciidoc2"/><a data-type="indexterm" data-primary="shell" data-secondary="and streams" id="ix_ch03-asciidoc3"/><a data-type="indexterm" data-primary="streams" id="ix_ch03-asciidoc4"/>Let’s start with the topic of input (streams) and output (streams), or I/O for
short. How can you feed a program some input? How do you control where the output
of a program lands, say, on the terminal or in a file?</p>

<p>First off, the shell equips every process with three default file descriptors (FDs)
for input and output:</p>

<ul>
<li>
<p><code>stdin</code> (FD 0)</p>
</li>
<li>
<p><code>stdout</code> (FD 1)</p>
</li>
<li>
<p><code>stderr</code> (FD 2)</p>
</li>
</ul>

<p>These FDs are, as depicted in <a data-type="xref" href="#fig-shell-streams">Figure 3-2</a>, by default
connected to your screen and keyboard, respectively. In other words, unless you
specify something else, a command you enter in the shell will take its input
(<code>stdin</code>) from your keyboard, and it will deliver its output (<code>stdout</code>) to your
screen.</p>

<p>The following shell interaction demonstrates this default behavior:</p>

<pre data-type="programlisting" data-code-language="shell">$ cat
This is some input I <code class="nb">type</code> on the keyboard and <code class="nb">read</code> on the screen^C</pre>

<p>In the preceding example using <code>cat</code>, you see the defaults in action. Note
that I used Ctrl+C (shown as <code>^C</code>) to terminate the command.</p>

<figure><div id="fig-shell-streams" class="figure">
<img src="Images/lmlx_0302.png" alt="lmlx 0302" width="600" height="577"/>
<h6><span class="label">Figure 3-2. </span>Shell I/O default streams</h6>
</div></figure>

<p>If you don’t want to use the defaults the shell gives you—for example,
you don’t want <code>stderr</code> to be outputted on the screen but want to save it
in a file—you can <a href="https://oreil.ly/pOIjp">redirect</a>
the streams.</p>

<p>You redirect the output stream of a process using <code>$FD&gt;</code> and <code>&lt;$FD</code>, with <code>$FD</code>
being the file descriptor—for example, <code>2&gt;</code> means redirect the <code>stderr</code> stream.
Note that <code>1&gt;</code> and <code>&gt;</code> are the same since <code>stdout</code> is the default. If you want
to redirect both <code>stdout</code> and <code>stderr</code>, use <code>&amp;&gt;</code>, and when you
want to get rid of a stream, you can use <code>/dev/null</code>.</p>

<p>Let’s see how that works in the context of a concrete example, downloading
some HTML content via <code>curl</code>:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>curl</code><code> </code><code>https://example.com</code><code> </code><code class="p">&amp;</code><code>&gt;</code><code> </code><code>/dev/null</code><code> </code><a class="co" id="co_shells_and_scripting_CO2-1" href="#callout_shells_and_scripting_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code>curl</code><code> </code><code>https://example.com</code><code> </code><code>&gt;</code><code> </code><code>/tmp/content.txt</code><code> </code><code class="m">2</code><code>&gt;</code><code> </code><code>/tmp/curl-status</code><code> </code><a class="co" id="co_shells_and_scripting_CO2-2" href="#callout_shells_and_scripting_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>$</code><code> </code><code>head</code><code> </code><code>-3</code><code> </code><code>/tmp/content.txt</code><code>
</code><code>&lt;</code><code>!doctype</code><code> </code><code>html&gt;</code><code>
</code><code>&lt;</code><code>html&gt;</code><code>
</code><code>&lt;</code><code>head&gt;</code><code>
</code><code>$</code><code> </code><code>cat</code><code> </code><code>/tmp/curl-status</code><code>
  </code><code>%</code><code> </code><code>Total</code><code>    </code><code>%</code><code> </code><code>Received</code><code> </code><code>%</code><code> </code><code>Xferd</code><code>  </code><code>Average</code><code> </code><code>Speed</code><code>   </code><code>Time</code><code>    </code><code>Time</code><code>     </code><code>Time</code><code>  </code><code>Current</code><code>
                                 </code><code>Dload</code><code>  </code><code>Upload</code><code>   </code><code>Total</code><code>   </code><code>Spent</code><code>    </code><code>Left</code><code>  </code><code>Speed</code><code>
</code><code class="m">100</code><code>  </code><code class="m">1256</code><code>  </code><code class="m">100</code><code>  </code><code class="m">1256</code><code>    </code><code class="m">0</code><code>     </code><code class="m">0</code><code>   </code><code class="m">3187</code><code>      </code><code class="m">0</code><code> </code><code>--:--:--</code><code> </code><code>--:--:--</code><code> </code><code>--:--:--</code><code>  </code><code class="m">3195</code><code>

</code><code>$</code><code> </code><code>cat</code><code> </code><code>&gt;</code><code> </code><code>/tmp/interactive-input.txt</code><code> </code><a class="co" id="co_shells_and_scripting_CO2-3" href="#callout_shells_and_scripting_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code>tr</code><code> </code><code>&lt;</code><code> </code><code>/tmp/curl-status</code><code> </code><code class="o">[</code><code>A-Z</code><code class="o">]</code><code> </code><code class="o">[</code><code>a-z</code><code class="o">]</code><code> </code><a class="co" id="co_shells_and_scripting_CO2-4" href="#callout_shells_and_scripting_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
  </code><code>%</code><code> </code><code>total</code><code>    </code><code>%</code><code> </code><code>received</code><code> </code><code>%</code><code> </code><code>xferd</code><code>  </code><code>average</code><code> </code><code>speed</code><code>   </code><code class="nb">time</code><code>    </code><code class="nb">time</code><code>     </code><code class="nb">time</code><code>  </code><code>current</code><code>
                                 </code><code>dload</code><code>  </code><code>upload</code><code>   </code><code>total</code><code>   </code><code>spent</code><code>    </code><code>left</code><code>  </code><code>speed</code><code>
</code><code class="m">100</code><code>  </code><code class="m">1256</code><code>  </code><code class="m">100</code><code>  </code><code class="m">1256</code><code>    </code><code class="m">0</code><code>     </code><code class="m">0</code><code>   </code><code class="m">3187</code><code>      </code><code class="m">0</code><code> </code><code>--:--:--</code><code> </code><code>--:--:--</code><code> </code><code>--:--:--</code><code>  </code><code class="m">3195</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO2-1" href="#co_shells_and_scripting_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Discard all output by redirecting both <code>stdout</code> and <code>stderr</code> to <em>/dev/null</em>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO2-2" href="#co_shells_and_scripting_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Redirect the output and status to different files.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO2-3" href="#co_shells_and_scripting_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Interactively enter input and save to file; use Ctrl+D to stop capturing
and store the content.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO2-4" href="#co_shells_and_scripting_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Lowercase all words, using the <code>tr</code> command that reads from <code>stdin</code>.</p></dd>
</dl>

<p>Shells usually understand a number of special characters, such as:</p>
<dl>
<dt>Ampersand (<code>&amp;</code>)</dt>
<dd>
<p><a data-type="indexterm" data-primary="&amp; (ampersand)" id="idm45805439587152"/><a data-type="indexterm" data-primary="ampersand (&amp;)" id="idm45805439586656"/>Placed at the end of a command, executes the command in the background (see also <a data-type="xref" href="#job-control">“Job control”</a>)</p>
</dd>
<dt>Backslash (<code>\</code>)</dt>
<dd>
<p><a data-type="indexterm" data-primary="\ (backslash)" id="idm45805439583776"/><a data-type="indexterm" data-primary="backslash (\)" id="idm45805439583168"/>Used to continue a command on the next line, for better readability of
  long 
<span class="keep-together">commands</span></p>
</dd>
<dt>Pipe (<code>|</code>)</dt>
<dd>
<p><a data-type="indexterm" data-primary="| (pipe)" id="idm45805439580304"/><a data-type="indexterm" data-primary="pipes (|)" id="idm45805439579600"/>Connects <code>stdout</code> of one process with the <code>stdin</code> of the next
   process, allowing you to pass data without having to store it in files as a
   temporary place</p>
</dd>
</dl>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805439577584">
<h5>Pipes and the UNIX Philosophy</h5>
<p><a data-type="indexterm" data-primary="pipes (|)" data-secondary="and UNIX philosophy" id="idm45805439576416"/>While <a href="https://oreil.ly/ipSgr">pipes</a> might seem not too exciting at first glance, there’s much more to them.
I once had a nice interaction with Doug McIlroy, the inventor of pipes.
I wrote an article,
<a href="https://oreil.ly/KTU4q">“Revisiting the Unix Philosophy in 2018”</a>,
in which I drew parallels between UNIX and microservices. Someone commented on the
article, and that comment led to Doug sending me an email (very
unexpectedly, and I had to verify to believe it) to clarify things.</p>
</div></aside>

<p>Again, let’s see some of the theoretical content in action. Let’s try to figure
out how many lines an HTML file contains by downloading it using <code>curl</code> and then
piping the content to the <code>wc</code> tool:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>curl</code><code> </code><code>https://example.com</code><code> </code><code class="m">2</code><code>&gt;</code><code> </code><code>/dev/null</code><code> </code><code class="p">|</code><code> </code><code class="se">\ </code><a class="co" id="co_shells_and_scripting_CO3-1" href="#callout_shells_and_scripting_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code>wc</code><code> </code><code>-l</code><code> </code><a class="co" id="co_shells_and_scripting_CO3-2" href="#callout_shells_and_scripting_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">46</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO3-1" href="#co_shells_and_scripting_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>curl</code> to download the content from the URL, and discard the status that
it outputs on <code>stderr</code>. (Note: in practice, you’d use the <code>-s</code> option of
<code>curl</code>, but we want to learn how to apply our hard-gained knowledge, right?)</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO3-2" href="#co_shells_and_scripting_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>stdout</code> of <code>curl</code> is fed to <code>stdin</code> of <code>wc</code>, which counts the number
of lines with the <code>-l</code> option.<a data-type="indexterm" data-startref="ix_ch03-asciidoc4" id="idm45805439523808"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc3" id="idm45805439523072"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc2" id="idm45805439522400"/></p></dd>
</dl>

<p>Now that you have a basic understanding of commands, streams, and redirection,
let’s move on to another core shell feature, the handling of variables.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Variables"><div class="sect3" id="shell-variables">
<h3>Variables</h3>

<p><a data-type="indexterm" data-primary="shell" data-secondary="variables" id="ix_ch03-asciidoc5"/><a data-type="indexterm" data-primary="variables, in shell" id="ix_ch03-asciidoc6"/>A term you will come across often in the context of shells is <em>variables</em>.
Whenever you don’t want to or cannot hardcode a value, you can use a variable
to store and change a value. Use cases include the following:</p>

<ul>
<li>
<p>When you want to handle configuration items that Linux exposes—for example, the place where the
shell looks for executables captured in the <code>$PATH</code> variable. This is kind
of an interface where a variable might be read/write.</p>
</li>
<li>
<p>When you want to interactively query the user for a value, say, in the context of
a script.</p>
</li>
<li>
<p>When you want to shorten input by defining a long value once—for example,
the URL of an HTTP API. This use case roughly corresponds to a <code>const</code> value
in a program language since you don’t change the value after you have
declared the variable.</p>
</li>
</ul>

<p>We distinguish between two kinds of variables:</p>
<dl>
<dt>Environment variables</dt>
<dd>
<p><a data-type="indexterm" data-primary="environment variables" id="ix_ch03-asciidoc7"/><a data-type="indexterm" data-primary="shell variables" id="ix_ch03-asciidoc8"/>Shell-wide settings; list them with <code>env</code>.</p>
</dd>
<dt>Shell variables</dt>
<dd>
<p>Valid in the context of the current execution; list with
  <code>set</code> in bash. Shell variables are not inherited by subprocesses.</p>
</dd>
</dl>

<p>You can, in bash, use <code>export</code> to create an environment variable. When you want
to access the value of a variable, put a <code>$</code> in front of it,
and when you want to get rid of it, use <code>unset</code>.</p>

<p>OK, that was a lot of information. Let’s see how that looks in practice (in bash):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code class="nb">set</code><code> </code><code class="nv">MY_VAR</code><code class="o">=</code><code class="m">42</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-1" href="#callout_shells_and_scripting_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>$</code><code> </code><code class="nb">set</code><code> </code><code class="p">|</code><code> </code><code>grep</code><code> </code><code>MY_VAR</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-2" href="#callout_shells_and_scripting_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">_</code><code class="o">=</code><code class="nv">MY_VAR</code><code class="o">=</code><code class="m">42</code><code>

</code><code>$</code><code> </code><code class="nb">export</code><code> </code><code class="nv">MY_GLOBAL_VAR</code><code class="o">=</code><code class="s2">"fun with vars"</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-3" href="#callout_shells_and_scripting_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code class="nb">set</code><code> </code><code class="p">|</code><code> </code><code>grep</code><code> </code><code class="s1">'MY_*'</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-4" href="#callout_shells_and_scripting_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="nv">MY_GLOBAL_VAR</code><code class="o">=</code><code class="s1">'fun with vars'</code><code>
</code><code class="nv">_</code><code class="o">=</code><code class="nv">MY_VAR</code><code class="o">=</code><code class="m">42</code><code>

</code><code>$</code><code> </code><code>env</code><code> </code><code class="p">|</code><code> </code><code>grep</code><code> </code><code class="s1">'MY_*'</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-5" href="#callout_shells_and_scripting_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code class="nv">MY_GLOBAL_VAR</code><code class="o">=</code><code>fun</code><code> </code><code>with</code><code> </code><code>vars</code><code>

</code><code>$</code><code> </code><code>bash</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-6" href="#callout_shells_and_scripting_CO4-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>$</code><code> </code><code class="nb">echo</code><code> </code><code class="nv">$MY_GLOBAL_VAR</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-7" href="#callout_shells_and_scripting_CO4-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>fun</code><code> </code><code>with</code><code> </code><code>vars</code><code>

</code><code>$</code><code> </code><code class="nb">set</code><code> </code><code class="p">|</code><code> </code><code>grep</code><code> </code><code class="s1">'MY_*'</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-8" href="#callout_shells_and_scripting_CO4-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
</code><code class="nv">MY_GLOBAL_VAR</code><code class="o">=</code><code class="s1">'fun with vars'</code><code>

</code><code>$</code><code> </code><code class="nb">exit</code><code> </code><a class="co" id="co_shells_and_scripting_CO4-9" href="#callout_shells_and_scripting_CO4-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a><code>
</code><code>$</code><code> </code><code class="nb">unset</code><code> </code><code class="nv">$MY_VAR</code><code>
</code><code>$</code><code> </code><code class="nb">set</code><code> </code><code class="p">|</code><code> </code><code>grep</code><code> </code><code class="s1">'MY_*'</code><code>
</code><code class="nv">MY_GLOBAL_VAR</code><code class="o">=</code><code class="s1">'fun with vars'</code></pre>
<dl class="calloutlist pagebreak-after">
<dt><a class="co" id="callout_shells_and_scripting_CO4-1" href="#co_shells_and_scripting_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Create a shell variable called <code>MY_VAR</code>, and assign a value of 42.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-2" href="#co_shells_and_scripting_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>List shell variables and filter out <code>MY_VAR</code>. Note the <code>_=</code>, indicating it’s
not exported.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-3" href="#co_shells_and_scripting_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Create a new environment variable called <code>MY_GLOBAL_VAR</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-4" href="#co_shells_and_scripting_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>List shell variables and filter out all that start with <code>MY_</code>. We see,
as expected, both of the variables we created in the previous steps.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-5" href="#co_shells_and_scripting_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>List environment variables. We see <code>MY_GLOBAL_VAR</code>, as we would hope.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-6" href="#co_shells_and_scripting_CO4-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Create a new shell session—that is, a child process of the current shell session
that doesn’t inherit <code>MY_VAR</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-7" href="#co_shells_and_scripting_CO4-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Access the environment variable <code>MY_GLOBAL_VAR</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-8" href="#co_shells_and_scripting_CO4-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>List the shell variables, which gives us only <code>MY_GLOBAL_VAR</code> since we’re in a
child 
<span class="keep-together">process.</span></p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO4-9" href="#co_shells_and_scripting_CO4-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>Exit the child process, remove the <code>MY_VAR</code> shell variable, and list our shell
variables. As expected, <code>MY_VAR</code> is gone.</p></dd>
</dl>

<p>In <a data-type="xref" href="#table-common-variables">Table 3-1</a> I put together common shell and environment variables.
You will find those variables almost everywhere, and they are important to understand
and to use. For any of the variables, you can have a look at the respective value
using <code>echo $XXX</code>, with <code>XXX</code> being the variable name.</p>
<table id="table-common-variables">
<caption><span class="label">Table 3-1. </span>Common shell and environment variables</caption>
<thead>
<tr>
<th>Variable</th>
<th>Type</th>
<th>Semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>EDITOR</code></p></td>
<td><p>Environment</p></td>
<td><p>The path to program used by default to edit files</p></td>
</tr>
<tr>
<td><p><code>HOME</code></p></td>
<td><p>POSIX</p></td>
<td><p>The path of the home directory of the current user</p></td>
</tr>
<tr>
<td><p><code>HOSTNAME</code></p></td>
<td><p>bash shell</p></td>
<td><p>The name of the current host</p></td>
</tr>
<tr>
<td><p><code>IFS</code></p></td>
<td><p>POSIX</p></td>
<td><p>List of characters to separate fields; used when the shell splits words on expansion</p></td>
</tr>
<tr>
<td><p><code>PATH</code></p></td>
<td><p>POSIX</p></td>
<td><p>Contains a list of directories in which the shell looks for executable programs (binaries or scripts)</p></td>
</tr>
<tr>
<td><p><code>PS1</code></p></td>
<td><p>Environment</p></td>
<td><p>The primary prompt string in use</p></td>
</tr>
<tr>
<td><p><code>PWD</code></p></td>
<td><p>Environment</p></td>
<td><p>The full path of the working directory</p></td>
</tr>
<tr>
<td><p><code>OLDPWD</code></p></td>
<td><p>bash shell</p></td>
<td><p>The full path of the directory before the last <code>cd</code> command</p></td>
</tr>
<tr>
<td><p><code>RANDOM</code></p></td>
<td><p>bash shell</p></td>
<td><p>A random integer between 0 and 32767</p></td>
</tr>
<tr>
<td><p><code>SHELL</code></p></td>
<td><p>Environment</p></td>
<td><p>Contains the currently used shell</p></td>
</tr>
<tr>
<td><p><code>TERM</code></p></td>
<td><p>Environment</p></td>
<td><p>The terminal emulator used</p></td>
</tr>
<tr>
<td><p><code>UID</code></p></td>
<td><p>Environment</p></td>
<td><p>Current user unique ID (integer value)</p></td>
</tr>
<tr>
<td><p><code>USER</code></p></td>
<td><p>Environment</p></td>
<td><p>Current user name</p></td>
</tr>
<tr>
<td><p><code>_</code></p></td>
<td><p>bash shell</p></td>
<td><p>Last argument to the previous command executed in the foreground</p></td>
</tr>
<tr>
<td><p><code>?</code></p></td>
<td><p>bash shell</p></td>
<td><p>Exit status; see <a data-type="xref" href="#shell-exit-status">“Exit status”</a></p></td>
</tr>
<tr>
<td><p><code>$</code></p></td>
<td><p>bash shell</p></td>
<td><p>The ID of the current process (integer value)</p></td>
</tr>
<tr>
<td><p><code>0</code></p></td>
<td><p>bash shell</p></td>
<td><p>The name of the current process</p></td>
</tr>
</tbody>
</table>

<p>Further, check out the full list of
<a href="https://oreil.ly/EIgVc">bash-specific
variables</a>, and also note that the variables from <a data-type="xref" href="#table-common-variables">Table 3-1</a> will <a data-type="indexterm" data-startref="ix_ch03-asciidoc8" id="idm45805439280576"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc7" id="idm45805439279872"/>
come in handy again in the context of <a data-type="xref" href="#scripting">“Scripting”</a>.<a data-type="indexterm" data-startref="ix_ch03-asciidoc6" id="idm45805439278224"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc5" id="idm45805439277520"/></p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Exit status"><div class="sect3" id="shell-exit-status">
<h3>Exit status</h3>

<p class="pagebreak-after"><a data-type="indexterm" data-primary="exit status" id="idm45805439275424"/><a data-type="indexterm" data-primary="shell" data-secondary="exit status" id="idm45805439274720"/>The shell communicates the completion of a command execution to the caller
using what is called the <em>exit status</em>. In general, it is expected that a
Linux command returns a status when it terminates. This can either be a normal
termination (happy path) or an abnormal termination (something went wrong).
A <code>0</code> exit status means that the command was successfully run, without any errors,
whereas a nonzero value between 1 and 255 signals a failure. To query the
exit status, use <code>echo $?</code>.</p>

<p>Be careful with exit status handling in a pipeline, since some shells
make only the last status available. You can work around that limitation
<a href="https://oreil.ly/mMz9k">by using <code>$PIPESTATUS</code></a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Built-in commands"><div class="sect3" id="idm45805439270448">
<h3>Built-in commands</h3>

<p><a data-type="indexterm" data-primary="shell" data-secondary="built-in commands" id="idm45805439269072"/>Shells come with a number of built-in commands. Some useful examples are
<code>yes</code>, <code>echo</code>, <code>cat</code>, or <code>read</code> (depending on the Linux distro, some of those
commands might not be built-ins but located in <em>/usr/bin</em>). You can use the
<code>help</code> command to list built-ins. Do remember, however, that everything else is
a shell-external program that you usually can find in <em>/usr/bin</em> (for user
commands) or in  <em>/usr/sbin</em> (for administrative commands).</p>

<p>How do you know where to find an executable? Here are some ways:</p>

<pre data-type="programlisting" data-code-language="shell">$ which ls
/usr/bin/ls

$ <code class="nb">type</code> ls
ls is aliased to <code class="sb">`</code>ls --color<code class="o">=</code>auto<code class="err">'</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>One of the technical reviewers of this book rightfully pointed out that <code>which</code>
is a non-POSIX, external program that may not always be available. Also, they
suggested using <code><em>command</em> -v</code> rather than <code>which</code> to get the program path
and or shell alias/function. See also the <a href="https://oreil.ly/5toUM">shellcheck
docs</a> for further details on the matter.</p>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Job control"><div class="sect3" id="job-control">
<h3>Job control</h3>

<p><a data-type="indexterm" data-primary="job control" id="idm45805439257792"/><a data-type="indexterm" data-primary="shell" data-secondary="job control" id="idm45805439256864"/>A feature most shells support is called
<a href="https://oreil.ly/zeMsU"><em>job control</em></a>.
By default, when you enter a command, it takes control of the screen and the keyboard,
which we usually call <em>running in the foreground</em>. But what if you don’t want to run something
interactively, or, in case of a server, what if there is no input from <code>stdin</code> at
all? Enter job control and background jobs: to launch a process in the background,
put an <code>&amp;</code> at the end, or to send a foreground process to the background, press
Ctrl+Z.</p>

<p>The following example shows this in action, giving you a rough idea:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>watch</code><code> </code><code>-n</code><code> </code><code class="m">5</code><code> </code><code class="s2">"ls"</code><code> </code><code class="p">&amp;</code><code> </code><a class="co" id="co_shells_and_scripting_CO5-1" href="#callout_shells_and_scripting_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code class="nb">jobs</code><code> </code><a class="co" id="co_shells_and_scripting_CO5-2" href="#callout_shells_and_scripting_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>Job</code><code>     </code><code>Group</code><code>   </code><code>CPU</code><code>     </code><code>State</code><code>   </code><code>Command</code><code>
</code><code class="m">1</code><code>       </code><code class="m">3021</code><code>    </code><code class="m">0</code><code>%</code><code>      </code><code>stopped</code><code> </code><code>watch</code><code> </code><code>-n</code><code> </code><code class="m">5</code><code> </code><code class="s2">"ls"</code><code> </code><code class="p">&amp;</code><code>

</code><code>$</code><code> </code><code class="nb">fg</code><code> </code><a class="co" id="co_shells_and_scripting_CO5-3" href="#callout_shells_and_scripting_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>Every</code><code> </code><code class="m">5</code><code>.0s:</code><code> </code><code>ls</code><code>                                         </code><code>Sat</code><code> </code><code>Aug</code><code> </code><code class="m">28</code><code> </code><code class="m">11</code><code>:34:32</code><code> </code><code class="m">2021</code><code>

</code><code>Dockerfile</code><code>
</code><code>app.yaml</code><code>
</code><code>example.json</code><code>
</code><code>main.go</code><code>
</code><code>script.sh</code><code>
</code><code class="nb">test</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO5-1" href="#co_shells_and_scripting_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>By putting the <code>&amp;</code> at the end, we launch the command in the background.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO5-2" href="#co_shells_and_scripting_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>List all jobs.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO5-3" href="#co_shells_and_scripting_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>With the <code>fg</code> command, we can bring a process to the foreground. If you want
to quit the <code>watch</code> command, use Ctrl+C.</p></dd>
</dl>

<p>If you want to keep a background process running, even after you close
the shell you can prepend the <code>nohup</code> command. Further, for a process that is
already running and wasn’t prepended with <code>nohup</code>, you can use <code>disown</code> after the
fact to achieve the same effect. Finally, if you want to get rid of a running
process, you can use the <code>kill</code> command with various levels of forcefulness
(see <a data-type="xref" href="ch09.xhtml#signals">“Signals”</a> for more details).</p>

<p>Rather than job control, I recommend using terminal multiplexer, as discussed
in <a data-type="xref" href="#terminal-mux">“Terminal Multiplexer”</a>. These programs take care of the most common use cases
(shell closes, multiple processes running and need coordination, etc.) and
also support working with remote systems.<a data-type="indexterm" data-startref="ix_ch03-asciidoc1" id="idm45805439132448"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc0" id="idm45805439131776"/></p>

<p>Let’s move on to discuss modern replacements for frequently
used core commands that have been around forever.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Modern Commands"><div class="sect2" id="idm45805439829296">
<h2>Modern Commands</h2>

<p><a data-type="indexterm" data-primary="modern commands" id="ix_ch03-asciidoc9"/><a data-type="indexterm" data-primary="shell" data-secondary="modern commands" id="ix_ch03-asciidoc10"/>There are a handful of commands you will find yourself using over and over again
on a daily basis. These include commands for navigating directories (<code>cd</code>), listing the content
of a directory (<code>ls</code>), finding files (<code>find</code>), and displaying the content of files
(<code>cat</code>, <code>less</code>). Given that you are using these commands so often, you want
to be as efficient as possible—every keystroke counts.</p>

<p>Modern variations exist for some of these often-used commands. Some
of them are drop-in replacements, and others extend the functionality. All of them
offer somewhat sane default values for common operations and rich output that is
generally easier to comprehend, and they usually lead to you typing less
to accomplish the same task. This reduces the friction when you work with the shell,
making it more enjoyable and improving the flow. If you want to learn more about
modern tooling, check out <a data-type="xref" href="app02.xhtml#appendix-modern">Appendix B</a>. In this context, a word of
caution, especially if you’re applying this knowledge in an
enterprise environment: I have no stake in any of these tools and purely
recommend them because I have found them useful myself. A good way to go about
installing and using any of these tools is to use a version of the tool
that has been vetted by your Linux distro of choice.</p>










<section data-type="sect3" data-pdf-bookmark="Listing directory contents with exa"><div class="sect3" id="idm45805439123248">
<h3>Listing directory contents with exa</h3>

<p><a data-type="indexterm" data-primary="exa" id="idm45805439122016"/><a data-type="indexterm" data-primary="modern commands" data-secondary="listing directory contents with exa" id="idm45805439121088"/>Whenever you want to know what a directory contains, you use <code>ls</code> or one of
its variants with parameters. For example, in bash I used to have <code>l</code> aliased
to <code>ls -GAhltr</code>. But there’s a better way: <a href="https://oreil.ly/5lPAl"><code>exa</code></a>, a
modern replacement for <code>ls</code>, written in Rust, with built-in support for Git
and tree rendering. In this context, what would you guess is the most often
used command after you’ve listed the directory content? In my experience it’s
to clear the screen, and very often people use <code>clear</code>. That’s typing five
characters and then hitting <code>ENTER</code>. You can have the same effect much faster—simply use Ctrl+L.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Viewing file contents with bat"><div class="sect3" id="idm45805439116416">
<h3>Viewing file contents with bat</h3>

<p><a data-type="indexterm" data-primary="bat" id="idm45805439115248"/><a data-type="indexterm" data-primary="modern commands" data-secondary="viewing file contents with bat" id="idm45805439114320"/>Let’s assume that you listed a directory’s contents and found a file you want
to inspect. You’d use <code>cat</code>, maybe? There’s something better I recommend you
have a look at: <a href="https://oreil.ly/w3K76"><code>bat</code></a>. The <code>bat</code> command,
shown in <a data-type="xref" href="#fig-bat-rendering">Figure 3-3</a>, comes with syntax highlighting, shows nonprintable
characters, supports Git, and has an integrated pager (the page-wise viewing of files longer
than what can be displayed on the screen).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Finding content in files with rg"><div class="sect3" id="idm45805439110512">
<h3>Finding content in files with rg</h3>

<p><a data-type="indexterm" data-primary="modern commands" data-secondary="finding content in files with rg" id="idm45805439109232"/><a data-type="indexterm" data-primary="rg" id="idm45805439108288"/>Traditionally, you would use <code>grep</code> to find something in a file. However,
there’s a modern command, <a href="https://oreil.ly/u3Sfw"><code>rg</code></a>,
that is fast and powerful.</p>

<p>We’re going to compare <code>rg</code> to a <code>find</code> and <code>grep</code> combination in this example,
where we want to find YAML files that contain the string “sample”:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>find</code><code> </code><code>.</code><code> </code><code>-type</code><code> </code><code>f</code><code> </code><code>-name</code><code> </code><code class="s2">"*.yaml"</code><code> </code><code>-exec</code><code> </code><code>grep</code><code> </code><code class="s2">"sample"</code><code> </code><code class="s1">'{}'</code><code> </code><code class="se">\;</code><code> </code><code>-print</code><code> </code><a class="co" id="co_shells_and_scripting_CO6-1" href="#callout_shells_and_scripting_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
      </code><code>app:</code><code> </code><code>sample</code><code>
        </code><code>app:</code><code> </code><code>sample</code><code>
</code><code>./app.yaml</code><code>

</code><code>$</code><code> </code><code>rg</code><code> </code><code>-t</code><code> </code><code class="s2">"yaml"</code><code> </code><code>sample</code><code> </code><a class="co" id="co_shells_and_scripting_CO6-2" href="#callout_shells_and_scripting_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>app.yaml</code><code>
</code><code class="m">9</code><code>:</code><code>      </code><code>app:</code><code> </code><code>sample</code><code>
</code><code class="m">14</code><code>:</code><code>        </code><code>app:</code><code> </code><code>sample</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO6-1" href="#co_shells_and_scripting_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>find</code> and <code>grep</code> together to find a string in YAML files.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO6-2" href="#co_shells_and_scripting_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Use <code>rg</code> for the same task.</p></dd>
</dl>

<p>If you compare the commands and the results in the previous example, you see
that not only is <code>rg</code> easier to use but the results are more informative
(providing context, in this case the line number).</p>

<figure class="pagebreak-after"><div id="fig-bat-rendering" class="figure">
<img src="Images/lmlx_0303.png" alt="lmlx 0303" width="600" height="741"/>
<h6><span class="label">Figure 3-3. </span>Rendering of a Go file (top) and a YAML file (bottom) by <code>bat</code></h6>
</div></figure>
</div></section>













<section data-type="sect3" class="less_space" data-pdf-bookmark="JSON data processing with jq"><div class="sect3" id="idm45805439029424">
<h3>JSON data processing with jq</h3>

<p><a data-type="indexterm" data-primary="jq" id="idm45805439027808"/><a data-type="indexterm" data-primary="JSON" id="idm45805439027104"/><a data-type="indexterm" data-primary="modern commands" data-secondary="JSON data processing with jq" id="idm45805439026432"/>And now for a bonus command. This one, <code>jq</code>, is not an actual replacement but
more like a specialized tool for JSON, a popular textual data format. You find
JSON in HTTP APIs and configuration files alike.</p>

<p>So, use <a href="https://oreil.ly/9s7yh"><code>jq</code></a> rather than <code>awk</code> or <code>sed</code> to pick
out certain values. For example, by using a
<a href="https://oreil.ly/bcT9d">JSON generator</a> to generate some random data,
I have a 2.4 kB JSON file 
<span class="keep-together"><em>example.json</em></span> that looks something like this
(only showing the first record here):</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">[</code><code class="w"/>
<code class="w">  </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nt">"_id"</code><code class="p">:</code><code class="w"> </code><code class="s2">"612297a64a057a3fa3a56fcf"</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="nt">"latitude"</code><code class="p">:</code><code class="w"> </code><code class="mf">-25.750679</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="nt">"longitude"</code><code class="p">:</code><code class="w"> </code><code class="mf">130.044327</code><code class="p">,</code><code class="w"/>
<code class="w">    </code><code class="nt">"friends"</code><code class="p">:</code><code class="w"> </code><code class="p">[</code><code class="w"/>
<code class="w">      </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nt">"id"</code><code class="p">:</code><code class="w"> </code><code class="mi">0</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Tara Holland"</code><code class="w"/>
<code class="w">      </code><code class="p">},</code><code class="w"/>
<code class="w">      </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nt">"id"</code><code class="p">:</code><code class="w"> </code><code class="mi">1</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Giles Glover"</code><code class="w"/>
<code class="w">      </code><code class="p">},</code><code class="w"/>
<code class="w">      </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="nt">"id"</code><code class="p">:</code><code class="w"> </code><code class="mi">2</code><code class="p">,</code><code class="w"/>
<code class="w">        </code><code class="nt">"name"</code><code class="p">:</code><code class="w"> </code><code class="s2">"Pennington Shannon"</code><code class="w"/>
<code class="w">      </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">],</code><code class="w"/>
<code class="w">    </code><code class="nt">"favoriteFruit"</code><code class="p">:</code><code class="w"> </code><code class="s2">"strawberry"</code><code class="w"/>
<code class="w">  </code><code class="p">},</code><code class="w"/>
<code class="err">...</code><code class="w"/></pre>

<p>Let’s say we’re interested in all “first” friends—that is, entry 0 in the
<code>friends</code> array—of people whose favorite fruit is “strawberry.” With <code>jq</code>
you would do the following:</p>

<pre data-type="programlisting" data-code-language="shell">$ jq <code class="s1">'select(.[].favoriteFruit=="strawberry") | .[].friends[0].name'</code> example.json
<code class="s2">"Tara Holland"</code>
<code class="s2">"Christy Mullins"</code>
<code class="s2">"Snider Thornton"</code>
<code class="s2">"Jana Clay"</code>
<code class="s2">"Wilma King"</code></pre>

<p>That was some CLI fun, right? If you’re interested in finding out more about
the topic of modern commands and what other candidates there might be for you
to replace, check out the <a href="https://oreil.ly/cBAXt">modern-unix
repo</a>, which lists suggestions.<a data-type="indexterm" data-startref="ix_ch03-asciidoc10" id="idm45805438934352"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc9" id="idm45805438933744"/> Let’s now move our focus to some common tasks
beyond directory navigation and file content viewing and how to go about them.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Common Tasks"><div class="sect2" id="idm45805438864096">
<h2>Common Tasks</h2>

<p><a data-type="indexterm" data-primary="shell" data-secondary="common tasks" id="ix_ch03-asciidoc11"/>There are a number of things you likely find yourself doing often, and there are certain tricks you can use to speed up your tasks in the shell.
Let’s review these common tasks and see how we can be more efficient.</p>










<section data-type="sect3" data-pdf-bookmark="Shorten often-used commands"><div class="sect3" id="idm45805438861184">
<h3>Shorten often-used commands</h3>

<p><a data-type="indexterm" data-primary="shell" data-secondary="shortening often-used commands" id="idm45805438860048"/>One fundamental insight with interfaces is that commands that you are using
very often should take the least effort—they should be quick to enter. Now apply this
idea to the shell: rather than <code>git diff --color-moved</code>, I type <code>d</code> (a single
character), since I’m viewing changes in my repositories many hundreds of times
per day. Depending on the shell, there are different ways to achieve this:
in bash this is called an <a href="https://oreil.ly/fbBvm"><em>alias</em></a>, and in
Fish (<a data-type="xref" href="#fish-shell">“Fish Shell”</a>) there are <a href="https://oreil.ly/rrmNI">abbreviations</a>
you can use.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Navigating"><div class="sect3" id="idm45805438837024">
<h3>Navigating</h3>

<p><a data-type="indexterm" data-primary="navigation shortcuts" id="idm45805438836016"/><a data-type="indexterm" data-primary="shell" data-secondary="navigating" id="idm45805438835408"/><a data-type="indexterm" data-primary="shortcuts" id="idm45805438834560"/>When you enter commands on the shell prompt, there are a number of things
you might want to do, such as navigating the line (for example, moving the cursor to the
start) or manipulating the line (say, deleting everything left of the
cursor). <a data-type="xref" href="#table-shell-shortcuts">Table 3-2</a> lists common shell shortcuts.</p>
<table id="table-shell-shortcuts">
<caption><span class="label">Table 3-2. </span>Shell navigation and editing shortcuts</caption>
<thead>
<tr>
<th>Action</th>
<th>Command</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Move cursor to start of line</p></td>
<td><p>Ctrl+a</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Move cursor to end of line</p></td>
<td><p>Ctrl+e</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Move cursor forward one character</p></td>
<td><p>Ctrl+f</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Move cursor back one character</p></td>
<td><p>Ctrl+b</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Move cursor forward one word</p></td>
<td><p>Alt+f</p></td>
<td><p>Works only with left Alt</p></td>
</tr>
<tr>
<td><p>Move cursor back one word</p></td>
<td><p>Alt+b</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Delete current character</p></td>
<td><p>Ctrl+d</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Delete character left of cursor</p></td>
<td><p>Ctrl+h</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Delete word left of cursor</p></td>
<td><p>Ctrl+w</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Delete everything right of cursor</p></td>
<td><p>Ctrl+k</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Delete everything left of cursor</p></td>
<td><p>Ctrl+u</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Clear screen</p></td>
<td><p>Ctrl+l</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Cancel command</p></td>
<td><p>Ctrl+c</p></td>
<td><p>-</p></td>
</tr>
<tr>
<td><p>Undo</p></td>
<td><p>Ctrl+_</p></td>
<td><p>bash only</p></td>
</tr>
<tr>
<td><p>Search history</p></td>
<td><p>Ctrl+r</p></td>
<td><p>Some shells</p></td>
</tr>
<tr>
<td><p>Cancel search</p></td>
<td><p>Ctrl+g</p></td>
<td><p>Some shells</p></td>
</tr>
</tbody>
</table>

<p>Note that not all shortcuts may be supported in all shells, and
certain actions such as history management may be implemented differently
in certain shells. In addition, you might want to know that these shortcuts
are based on Emacs editing keystrokes. Should you prefer <code>vi</code>, you can use
<code>set -o vi</code> in your <em>.bashrc</em> file, for example, to perform command-line editing
based on <code>vi</code> keystrokes. Finally, taking <a data-type="xref" href="#table-shell-shortcuts">Table 3-2</a>
as a starting point, try out what your shell supports and see how you can
configure it to suit your needs.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="File content management"><div class="sect3" id="idm45805438790784">
<h3>File content management</h3>

<p><a data-type="indexterm" data-primary="file content management" id="idm45805438789408"/><a data-type="indexterm" data-primary="shell" data-secondary="file content management" id="idm45805438788704"/><a data-type="indexterm" data-primary="text, manipulating" id="idm45805438787760"/>You don’t always want to fire up an editor such as <code>vi</code> to add a single
line of text. And sometimes you can’t do it—for example,
in the context of writing a shell script (<a data-type="xref" href="#scripting">“Scripting”</a>).</p>

<p>So, how can you manipulate textual content? Let’s have a look at a few examples:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code class="nb">echo</code><code> </code><code class="s2">"First line"</code><code> </code><code>&gt;</code><code> </code><code>/tmp/something</code><code> </code><a class="co" id="co_shells_and_scripting_CO7-1" href="#callout_shells_and_scripting_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code>cat</code><code> </code><code>/tmp/something</code><code> </code><a class="co" id="co_shells_and_scripting_CO7-2" href="#callout_shells_and_scripting_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>First</code><code> </code><code>line</code><code>

</code><code>$</code><code> </code><code class="nb">echo</code><code> </code><code class="s2">"Second line"</code><code> </code><code>&gt;&gt;</code><code> </code><code>/tmp/something</code><code> </code><code class="o">&amp;&amp;</code><code> </code><code class="se">\ </code><a class="co" id="co_shells_and_scripting_CO7-3" href="#callout_shells_and_scripting_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
  </code><code>cat</code><code> </code><code>/tmp/something</code><code>
</code><code>First</code><code> </code><code>line</code><code>
</code><code>Second</code><code> </code><code>line</code><code>

</code><code>$</code><code> </code><code>sed</code><code> </code><code class="s1">'s/line/LINE/'</code><code> </code><code>/tmp/something</code><code> </code><a class="co" id="co_shells_and_scripting_CO7-4" href="#callout_shells_and_scripting_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>First</code><code> </code><code>LINE</code><code>
</code><code>Second</code><code> </code><code>LINE</code><code>

</code><code>$</code><code> </code><code>cat</code><code> </code><code class="s">&lt;&lt; 'EOF' &gt; /tmp/another </code><a class="co" id="co_shells_and_scripting_CO7-5" href="#callout_shells_and_scripting_CO7-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code class="s">
First line
Second line
Third line
EOF</code><code>

</code><code>$</code><code> </code><code>diff</code><code> </code><code>-y</code><code> </code><code>/tmp/something</code><code> </code><code>/tmp/another</code><code> </code><a class="co" id="co_shells_and_scripting_CO7-6" href="#callout_shells_and_scripting_CO7-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>First</code><code> </code><code>line</code><code>                                                      </code><code>First</code><code> </code><code>line</code><code>
</code><code>Second</code><code> </code><code>line</code><code>                                                     </code><code>Second</code><code> </code><code>line</code><code>
                                                              </code><code>&gt;</code><code> </code><code>Third</code><code> </code><code>line</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO7-1" href="#co_shells_and_scripting_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Create a file by redirecting the <code>echo</code> output.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO7-2" href="#co_shells_and_scripting_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>View content of file.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO7-3" href="#co_shells_and_scripting_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Append a line to file using the <code>&gt;&gt;</code> operator and then view content.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO7-4" href="#co_shells_and_scripting_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Replace content from file using <code>sed</code> and output to <code>stdout</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO7-5" href="#co_shells_and_scripting_CO7-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Create a file using the <a href="https://oreil.ly/FPWqT">here document</a>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO7-6" href="#co_shells_and_scripting_CO7-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Show differences between the files we created.</p></dd>
</dl>

<p>Now that you know the basic file content manipulation techniques, let’s have a
look at the advanced viewing of file contents.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Viewing long files"><div class="sect3" id="idm45805438665968">
<h3>Viewing long files</h3>

<p><a data-type="indexterm" data-primary="shell" data-secondary="viewing long files" id="idm45805438664464"/>For long files—that is, files that have more lines than the shell can display
on your screen—you can use pagers like <code>less</code> or <code>bat</code> (<code>bat</code> comes with a built-in
pager). With paging, a program splits the output into pages where
each page fits into what the screen can display and some commands to navigate
the pages (view next page, previous page, etc.).</p>

<p>Another way to deal with long files is to display only a select region of
the file, like the first few lines. There are two handy commands for this:
<code>head</code> and <code>tail</code>.</p>

<p>For example, to display the beginning of a file:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code class="k">for</code><code> </code><code>i</code><code> </code><code class="k">in</code><code> </code><code class="o">{</code><code class="m">1</code><code>..100</code><code class="o">}</code><code> </code><code class="p">;</code><code> </code><code class="k">do</code><code> </code><code class="nb">echo</code><code> </code><code class="nv">$i</code><code> </code><code>&gt;&gt;</code><code> </code><code>/tmp/longfile</code><code> </code><code class="p">;</code><code> </code><code class="k">done</code><code> </code><a class="co" id="co_shells_and_scripting_CO8-1" href="#callout_shells_and_scripting_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>$</code><code> </code><code>head</code><code> </code><code>-5</code><code> </code><code>/tmp/longfile</code><code> </code><a class="co" id="co_shells_and_scripting_CO8-2" href="#callout_shells_and_scripting_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">1</code><code>
</code><code class="m">2</code><code>
</code><code class="m">3</code><code>
</code><code class="m">4</code><code>
</code><code class="m">5</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO8-1" href="#co_shells_and_scripting_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Create a long file (100 lines here).</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO8-2" href="#co_shells_and_scripting_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Display the first five lines of the long file.</p></dd>
</dl>

<p>Or, to get live updates of a file that is constantly growing,
we could use:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>tail</code><code> </code><code>-f</code><code> </code><code>/var/log/Xorg.0.log</code><code> </code><a class="co" id="co_shells_and_scripting_CO9-1" href="#callout_shells_and_scripting_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="o">[</code><code> </code><code class="m">36065</code><code>.898</code><code class="o">]</code><code> </code><code class="o">(</code><code>II</code><code class="o">)</code><code> </code><code>event14</code><code> </code><code>-</code><code> </code><code>ALPS01:00</code><code> </code><code class="m">0911</code><code>:5288</code><code> </code><code>Mouse:</code><code> </code><code>device</code><code> </code><code>is</code><code> </code><code>a</code><code> </code><code>pointer</code><code>
</code><code class="o">[</code><code> </code><code class="m">36065</code><code>.900</code><code class="o">]</code><code> </code><code class="o">(</code><code>II</code><code class="o">)</code><code> </code><code>event15</code><code> </code><code>-</code><code> </code><code>ALPS01:00</code><code> </code><code class="m">0911</code><code>:5288</code><code> </code><code>Touchpad:</code><code> </code><code>device</code><code> </code><code>is</code><code> </code><code>a</code><code> </code><code>touchpad</code><code>
</code><code class="o">[</code><code> </code><code class="m">36065</code><code>.901</code><code class="o">]</code><code> </code><code class="o">(</code><code>II</code><code class="o">)</code><code> </code><code>event4</code><code>  </code><code>-</code><code> </code><code>Intel</code><code> </code><code>HID</code><code> </code><code>events:</code><code> </code><code>is</code><code> </code><code>tagged</code><code> </code><code>by</code><code> </code><code>udev</code><code> </code><code>as:</code><code> </code><code>Keyboard</code><code>
</code><code class="o">[</code><code> </code><code class="m">36065</code><code>.901</code><code class="o">]</code><code> </code><code class="o">(</code><code>II</code><code class="o">)</code><code> </code><code>event4</code><code>  </code><code>-</code><code> </code><code>Intel</code><code> </code><code>HID</code><code> </code><code>events:</code><code> </code><code>device</code><code> </code><code>is</code><code> </code><code>a</code><code> </code><code>keyboard</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO9-1" href="#co_shells_and_scripting_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Display the end of a log file using <code>tail</code>, with the <code>-f</code> option
meaning to follow, or to update automatically.</p></dd>
</dl>

<p>Lastly, in this section we look at dealing with date and time.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Date and time handling"><div class="sect3" id="idm45805438665376">
<h3>Date and time handling</h3>

<p><a data-type="indexterm" data-primary="date command" id="idm45805438508720"/><a data-type="indexterm" data-primary="shell" data-secondary="date/time handling" id="idm45805438508016"/><a data-type="indexterm" data-primary="time/date handling" id="idm45805438507072"/>The <code>date</code> command can be a useful way to generate unique file names. It allows
you to generate dates in various formats, including the
<a href="https://oreil.ly/xB7UG">Unix time stamp</a>,
as well as to convert between different date and time formats.</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>date</code><code> </code><code>+%s</code><code> </code><a class="co" id="co_shells_and_scripting_CO10-1" href="#callout_shells_and_scripting_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="m">1629582883</code><code>

</code><code>$</code><code> </code><code>date</code><code> </code><code>-d</code><code> </code><code>@1629742883</code><code> </code><code class="s1">'+%m/%d/%Y:%H:%M:%S'</code><code> </code><a class="co" id="co_shells_and_scripting_CO10-2" href="#callout_shells_and_scripting_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">08</code><code>/21/2021:21:54:43</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO10-1" href="#co_shells_and_scripting_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Create a UNIX time stamp.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO10-2" href="#co_shells_and_scripting_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Convert a UNIX time stamp to a human-readable date.</p></dd>
</dl>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805438458416">
<h5>On the UNIX Epoch Time</h5>
<p><a data-type="indexterm" data-primary="UNIX epoch time" id="idm45805438457248"/>The UNIX epoch time (or simply UNIX time) is the number of seconds elapsed since
1970-01-01T00:00:00Z. UNIX time treats every day as exactly 86,400 seconds long.</p>

<p>If you’re dealing with software that stores UNIX time as a signed 32-bit integer,
you might want to pay attention since this will cause issues on 2038-01-19, as
then the counter will overflow, which is also known as the
<a href="https://oreil.ly/dKiWx">Year 2038 problem</a>.</p>

<p>You can use <a href="https://oreil.ly/Z1a4A">online converters</a> for more advanced
operations, supporting microseconds and milliseconds resolutions.</p>
</div></aside>

<p>With that we wrap up the shell basics section.<a data-type="indexterm" data-startref="ix_ch03-asciidoc11" id="idm45805438431088"/> By now you should have a good
understanding of what terminals and shells are and how to use them to do basic
tasks such as navigating the filesystem, finding files, and more. We now move
on to the topic of human-friendly shells.</p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Human-Friendly Shells"><div class="sect1" id="human-friendly-shells">
<h1>Human-Friendly Shells</h1>

<p><a data-type="indexterm" data-primary="shell" data-secondary="human-friendly" id="ix_ch03-asciidoc12"/>While the <a href="https://oreil.ly/9GNyA">bash shell</a> is
likely still the most widely used shell, it is not necessarily the most
human-friendly one. It has been around since the late 1980s, and its age
sometimes shows. There are a number of modern, human-friendly shells I strongly
recommend you evaluate and use instead of bash.</p>

<p>We’ll first examine in detail one concrete example of a
modern, human-friendly shell called the Fish shell and then briefly discuss
others, just to make sure you have an idea about the range of choices.
We wrap up this section with a quick recommendation and conclusion
in <a data-type="xref" href="#which-shell-should-you-use">“Which Shell Should I Use?”</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Fish Shell"><div class="sect2" id="fish-shell">
<h2>Fish Shell</h2>

<p><a data-type="indexterm" data-primary="Fish shell" id="ix_ch03-asciidoc13"/><a data-type="indexterm" data-primary="shell" data-secondary="Fish shell" id="ix_ch03-asciidoc14"/>The <a href="https://fishshell.com/">Fish shell</a> describes itself as a smart and
user-friendly command-line shell. Let’s have a look at some basic usage
first and then move on to configuration topics.</p>










<section data-type="sect3" data-pdf-bookmark="Basic usage"><div class="sect3" id="idm45805438419680">
<h3>Basic usage</h3>

<p><a data-type="indexterm" data-primary="bash" data-secondary="fish versus" id="idm45805438418128"/><a data-type="indexterm" data-primary="Fish shell" data-secondary="basic usage" id="idm45805438417152"/>For many daily tasks, you won’t notice a big difference from bash in
terms of input; most of the commands provided in <a data-type="xref" href="#table-shell-shortcuts">Table 3-2</a> are
valid. However, there are two areas where <code>fish</code> is different from and much more convenient
than <code>bash</code>:</p>
<dl>
<dt>There is no explicit history management.</dt>
<dd>
<p>You simply type and you get previous
executions of a command shown. You can use the up and down key to select one (see <a data-type="xref" href="#fig-fish-history">Figure 3-4</a>).</p>
</dd>
<dt>Autosuggestions are available for many commands.</dt>
<dd>
<p>This is shown in <a data-type="xref" href="#fig-fish-autocompletion">Figure 3-5</a>.
In addition, when you press Tab, the Fish shell will try to complete the
command, argument, or path, giving you visual hints such as coloring your
input red if it doesn’t recognize the command.</p>
</dd>
</dl>

<figure><div id="fig-fish-history" class="figure">
<img src="Images/lmlx_0304.png" alt="lmlx 0304" width="600" height="59"/>
<h6><span class="label">Figure 3-4. </span>Fish history handling in action</h6>
</div></figure>

<figure><div id="fig-fish-autocompletion" class="figure">
<img src="Images/lmlx_0305.png" alt="lmlx 0305" width="600" height="223"/>
<h6><span class="label">Figure 3-5. </span>Fish autosuggestion in action</h6>
</div></figure>

<p class="pagebreak-before"><a data-type="xref" href="#table-fish-reference">Table 3-3</a> lists some common <code>fish</code> commands. In this context, note specifically the handling of environment variables.</p>
<table id="table-fish-reference">
<caption><span class="label">Table 3-3. </span>Fish shell reference</caption>
<thead>
<tr>
<th>Task</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Export environment variable <code>KEY</code> with value <code>VAL</code></p></td>
<td><p><code>set -x KEY VAL</code></p></td>
</tr>
<tr>
<td><p>Delete environment variable <code>KEY</code></p></td>
<td><p><code>set -e KEY</code></p></td>
</tr>
<tr>
<td><p>Inline env var <code>KEY</code> for command <code>cmd</code></p></td>
<td><p><code>env KEY=VAL cmd</code></p></td>
</tr>
<tr>
<td><p>Change path length to 1</p></td>
<td><p><code>set -g fish_prompt_pwd_dir_length 1</code></p></td>
</tr>
<tr>
<td><p>Manage abbreviations</p></td>
<td><p><code>abbr</code></p></td>
</tr>
<tr>
<td><p>Manage functions</p></td>
<td><p><code>functions</code> and <code>funcd</code></p></td>
</tr>
</tbody>
</table>

<p>Unlike other shells, <code>fish</code> stores the exit status of the last command in a
variable called <code>$status</code> instead of in <code>$?</code>.</p>

<p>If you’re coming from bash, you may also want to consult the <a href="https://oreil.ly/Nk2S2">Fish
FAQ</a>, which addresses most of the
gotchas.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Configuration"><div class="sect3" id="idm45805438384352">
<h3>Configuration</h3>

<p><a data-type="indexterm" data-primary="Fish shell" data-secondary="configuration" id="ix_ch03-asciidoc15"/>To <a href="https://oreil.ly/FCSne">configure
the Fish shell</a>, you simply enter the <code>fish_config</code> command (you might need to
add the <code>browse</code> subcommand, depending on your distro), and <code>fish</code> will
launch a server via <em><a href="http://localhost:8000"><em class="hyperlink">http://localhost:8000</em></a></em> and automatically open
your default browser with a fancy UI, shown in <a data-type="xref" href="#fig-fish-config-ui">Figure 3-6</a>, which
allows you to view and change settings.</p>

<figure><div id="fig-fish-config-ui" class="figure">
<img src="Images/lmlx_0306.png" alt="lmlx 0306" width="600" height="286"/>
<h6><span class="label">Figure 3-6. </span>Fish shell configuration via browser</h6>
</div></figure>
<div data-type="tip"><h6>Tip</h6>
<p>To switch between <code>vi</code> and Emacs (default) key bindings for
command-line navigation, use the <code>fish_vi_key_bindings</code> to start <code>vi</code> mode,
and use <code>fish_default_key_bindings</code> to reset it to Emacs. Note that the
changes will take place in all active shell sessions immediately.</p>
</div>

<p>Let’s now see how I have configured my environment. In fact, my config is
rather short; in <em>config.fish</em> I have the following:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="nb">set</code> -x FZF_DEFAULT_OPTS <code class="s2">"-m --bind='ctrl-o:execute(nvim {})+abort'"</code>
<code class="nb">set</code> -x FZF_DEFAULT_COMMAND <code class="s1">'rg --files'</code>
<code class="nb">set</code> -x EDITOR nvim
<code class="nb">set</code> -x KUBE_EDITOR nvim
<code class="nb">set</code> -ga fish_user_paths /usr/local/bin</pre>

<p>My prompt, defined in <em>fish_prompt.fish</em>, looks as follows:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="k">function</code> fish_prompt
    <code class="nb">set</code> -l retc red
    <code class="nb">test</code> <code class="nv">$status</code> <code class="o">=</code> <code class="m">0</code><code class="p">;</code> and <code class="nb">set</code> retc blue

    <code class="nb">set</code> -q __fish_git_prompt_showupstream
    or <code class="nb">set</code> -g __fish_git_prompt_showupstream auto

    <code class="k">function</code> _nim_prompt_wrapper
        <code class="nb">set</code> retc <code class="nv">$argv</code><code class="o">[</code><code class="m">1</code><code class="o">]</code>
        <code class="nb">set</code> field_name <code class="nv">$argv</code><code class="o">[</code><code class="m">2</code><code class="o">]</code>
        <code class="nb">set</code> field_value <code class="nv">$argv</code><code class="o">[</code><code class="m">3</code><code class="o">]</code>

        set_color normal
        set_color <code class="nv">$retc</code>
        <code class="nb">echo</code> -n <code class="s1">'─'</code>
        set_color -o blue
        <code class="nb">echo</code> -n <code class="s1">'['</code>
        set_color normal
        <code class="nb">test</code> -n <code class="nv">$field_name</code>
        and <code class="nb">echo</code> -n <code class="nv">$field_name</code>:
        set_color <code class="nv">$retc</code>
        <code class="nb">echo</code> -n <code class="nv">$field_value</code>
        set_color -o blue
        <code class="nb">echo</code> -n <code class="s1">']'</code>
    end

    set_color <code class="nv">$retc</code>
    <code class="nb">echo</code> -n <code class="s1">'┬─'</code>
    set_color -o blue
    <code class="nb">echo</code> -n <code class="o">[</code>
    set_color normal
    set_color c07933
    <code class="nb">echo</code> -n <code class="o">(</code>prompt_pwd<code class="o">)</code>
    set_color -o blue
    <code class="nb">echo</code> -n <code class="s1">']'</code>
     <code class="c1"># Virtual Environment</code>
    <code class="nb">set</code> -q VIRTUAL_ENV_DISABLE_PROMPT
    or <code class="nb">set</code> -g VIRTUAL_ENV_DISABLE_PROMPT <code class="nb">true</code>
    <code class="nb">set</code> -q VIRTUAL_ENV
    and _nim_prompt_wrapper <code class="nv">$retc</code> V <code class="o">(</code>basename <code class="s2">"</code><code class="nv">$VIRTUAL_ENV</code><code class="s2">"</code><code class="o">)</code>

    <code class="c1"># git</code>
    <code class="nb">set</code> prompt_git <code class="o">(</code>fish_git_prompt <code class="p">|</code> string trim -c <code class="s1">' ()'</code><code class="o">)</code>
    <code class="nb">test</code> -n <code class="s2">"</code><code class="nv">$prompt_git</code><code class="s2">"</code>
    and _nim_prompt_wrapper <code class="nv">$retc</code> G <code class="nv">$prompt_git</code>

    <code class="c1"># New line</code>
    <code class="nb">echo</code>

    <code class="c1"># Background jobs</code>
    set_color normal
    <code class="k">for</code> job <code class="k">in</code> <code class="o">(</code><code class="nb">jobs</code><code class="o">)</code>
        set_color <code class="nv">$retc</code>
        <code class="nb">echo</code> -n <code class="s1">'│ '</code>
        set_color brown
        <code class="nb">echo</code> <code class="nv">$job</code>
    end
    set_color blue
    <code class="nb">echo</code> -n <code class="s1">'╰─&gt; '</code>
        set_color -o blue
    <code class="nb">echo</code> -n <code class="s1">'$ '</code>
    set_color normal
end</pre>

<p>The preceding prompt definition yields the prompt shown in <a data-type="xref" href="#fig-fish-prompt">Figure 3-7</a>; note the difference between a directory that contains a Git repo and one
that does not, a built-in visual cue to speed up
your flow. Also, notice the current time on the righthand side.</p>

<figure><div id="fig-fish-prompt" class="figure">
<img src="Images/lmlx_0307.png" alt="lmlx 0307" width="600" height="88"/>
<h6><span class="label">Figure 3-7. </span>Fish shell prompt</h6>
</div></figure>

<p>My abbreviations—think of these as <code>alias</code> replacements, as found in other shells—look as
follows:</p>

<pre data-type="programlisting" data-code-language="shell">$ abbr
abbr -a -U -- :q <code class="nb">exit</code>
abbr -a -U -- cat bat
abbr -a -U -- d <code class="s1">'git diff --color-moved'</code>
abbr -a -U -- g git
abbr -a -U -- grep <code class="s1">'grep --color=auto'</code>
abbr -a -U -- k kubectl
abbr -a -U -- l <code class="s1">'exa --long --all --git'</code>
abbr -a -U -- ll <code class="s1">'ls -GAhltr'</code>
abbr -a -U -- m make
abbr -a -U -- p <code class="s1">'git push'</code>
abbr -a -U -- pu <code class="s1">'git pull'</code>
abbr -a -U -- s <code class="s1">'git status'</code>
abbr -a -U -- stat <code class="s1">'stat -x'</code>
abbr -a -U -- vi nvim
abbr -a -U -- wget <code class="s1">'wget -c'</code></pre>

<p>To add a new abbreviation, use <code>abbr --add</code>. Abbreviations are handy for simple
commands that take no arguments. What if you have a more complicated construct
you want to shorten? Say you want to shorten a sequence involving <code>git</code> that
also takes an argument. Meet functions in Fish.</p>

<p>Let’s now take a look at an example function, which is defined in the file
named <em>c.fish</em>. We can use the <code>functions</code> command to list all defined functions,
the 
<span class="keep-together"><code>function</code></span> command to create a new function, and in this case the command
<code>function c</code> to edit it as follows:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="k">function</code> c
    git add --all
    git commit -m <code class="s2">"</code><code class="nv">$argv</code><code class="s2">"</code>
end</pre>

<p>With that we have reached the end of the Fish section<a data-type="indexterm" data-startref="ix_ch03-asciidoc15" id="idm45805438199072"/>, in which we walked through a usage
tutorial and configuration tips.<a data-type="indexterm" data-startref="ix_ch03-asciidoc14" id="idm45805438198336"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc13" id="idm45805438197728"/> Now let’s have a quick look at other modern shells.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Z-shell"><div class="sect2" id="idm45805438383760">
<h2>Z-shell</h2>

<p><a data-type="indexterm" data-primary="shell" data-secondary="Z-shell" id="idm45805438195744"/><a data-type="indexterm" data-primary="Z-shell" id="idm45805438194544"/><a href="https://oreil.ly/6y06N">Z-shell</a>, or <code>zsh</code>, is a Bourne-like shell
with a powerful <a href="https://oreil.ly/bqS8y">completion</a> system and
rich theming support. With <a href="https://ohmyz.sh">Oh My Zsh</a>, you can pretty much
configure and use <code>zsh</code> in the way you’ve seen earlier on with <code>fish</code> while
retaining wide backward compatibility with bash.</p>

<p><code>zsh</code> uses five startup files, as shown in the following example (note that if
<code>$ZDOTDIR</code> is not set, <code>zsh</code> uses <code>$HOME</code> instead):</p>

<pre data-type="programlisting" data-code-language="shell"><code class="nv">$ZDOTDIR</code><code>/.zshenv</code><code> </code><a class="co" id="co_shells_and_scripting_CO11-1" href="#callout_shells_and_scripting_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nv">$ZDOTDIR</code><code>/.zprofile</code><code> </code><a class="co" id="co_shells_and_scripting_CO11-2" href="#callout_shells_and_scripting_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">$ZDOTDIR</code><code>/.zshrc</code><code> </code><a class="co" id="co_shells_and_scripting_CO11-3" href="#callout_shells_and_scripting_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nv">$ZDOTDIR</code><code>/.zlogin</code><code> </code><a class="co" id="co_shells_and_scripting_CO11-4" href="#callout_shells_and_scripting_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="nv">$ZDOTDIR</code><code>/.zlogout</code><code> </code><a class="co" id="co_shells_and_scripting_CO11-5" href="#callout_shells_and_scripting_CO11-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO11-1" href="#co_shells_and_scripting_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sourced on all invocations of the shell. It should contain commands to set the
search path, plus other important environment variables. But it should not
contain commands that produce output or assume the shell is attached to a <code>tty</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO11-2" href="#co_shells_and_scripting_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Meant as an alternative to <em>.zlogin</em> for <code>ksh</code> fans (these two are not intended to be used together);
similar to <em>.zlogin</em>, except that it is sourced before <em>.zshrc</em>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO11-3" href="#co_shells_and_scripting_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sourced in interactive shells. It should contain commands to set up aliases,
functions, options, key bindings, and so on.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO11-4" href="#co_shells_and_scripting_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Sourced in login shells. It should contain commands that should be executed only in login shells.
Note that <em>.zlogin</em> is not the place for alias definitions, options, environment variable settings, and the like.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO11-5" href="#co_shells_and_scripting_CO11-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Sourced when login shells exit.</p></dd>
</dl>

<p>For more <code>zsh</code> plug-ins, see also the
<a href="https://oreil.ly/XHwBd">awesome-zsh-plugins repo on
GitHub</a>. If you want to learn <code>zsh</code>, consider reading
<a href="https://oreil.ly/cMfnw">“An Introduction to the Z Shell”</a>
by Paul Falstad and Bas de Bakker.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Other Modern Shells"><div class="sect2" id="idm45805438044544">
<h2>Other Modern Shells</h2>

<p>In addition to <code>fish</code> and <code>zsh</code>, there are a number of other interesting—but
not necessarily always bash-compatible—shells available out there. When you
have a look at those, ask yourself what the focus of the respective shell is
(interactive usage vs. scripting) and how active the community around it is.</p>

<p>Some examples of modern shells for Linux I came across and can recommend you
have a look at include the following:</p>
<dl>
<dt><a href="https://www.oilshell.org">Oil shell</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Oil shell" id="idm45805438039312"/>Targets Python and JavaScript users.
  Put in other words, the focus is less on interactive use but more on
  scripting.</p>
</dd>
<dt><a href="https://murex.rocks">murex</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="murex" id="idm45805438036784"/>A POSIX shell that sports interesting features
  such as an integrated testing framework, typed pipelines, and event-driven
  programming.</p>
</dd>
<dt><a href="https://www.nushell.sh">Nushell</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Nushell" id="idm45805438034400"/>An experimental new shell paradigm,
  featuring tabular output with a powerful query language. Learn more via the
  detailed <a href="https://oreil.ly/jIa5w">Nu Book</a>.</p>
</dd>
<dt><a href="https://oreil.ly/bYKnd">PowerShell</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="PowerShell" id="idm45805438031152"/>A cross-platform shell
  that started off as a fork of the Windows PowerShell and offers a different
  set of semantics and interactions than POSIX shells.</p>
</dd>
</dl>

<p>There are many more options out there. Keep looking and see what works best for you.
Try thinking beyond bash and optimize for your use case.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Which Shell Should I Use?"><div class="sect2" id="which-shell-should-you-use">
<h2>Which Shell Should I Use?</h2>

<p><a data-type="indexterm" data-primary="shell" data-secondary="choosing a shell" id="idm45805438027968"/>At this point in time, every modern shell—other than bash—seems like a
good choice, from a human-centric perspective. Smooth auto-complete, easy
config, and smart environments are no luxury in 2022, and given the time you
usually spend on the command line, you should try out different shells and pick
the one you like most. I personally use the Fish shell, but many of my peers
are super happy with the Z-shell.</p>

<p>You may have issues that make you hesitant to move away from bash, such as the 
<span class="keep-together">following:</span></p>

<ul>
<li>
<p>You work in remote systems and/or cannot install your own shell.</p>
</li>
<li>
<p>You’ve stayed with bash due to compatibility and/or muscle memory. It can be hard to get rid of certain habits.</p>
</li>
<li>
<p>Almost all instructions (implicitly) assume bash. For example, you’ll
see instructions like <code>export FOO=BAR</code>, which is bash specific.</p>
</li>
</ul>

<p>It turns out that these issues are by and large not relevant to most users.
While you may have to temporarily use bash in a remote
system, most of the time you will be working in an environment that you
control. There is a learning curve, but the investment pays off in the long run.<a data-type="indexterm" data-startref="ix_ch03-asciidoc12" id="idm45805438021712"/></p>

<p>With that, let’s focus on another way to boost your productivity in the
terminal: 
<span class="keep-together">multiplexer.</span></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Terminal Multiplexer"><div class="sect1" id="terminal-mux">
<h1>Terminal Multiplexer</h1>

<p><a data-type="indexterm" data-primary="terminal multiplexer" id="ix_ch03-asciidoc16"/>We came across terminals at the beginning of this chapter, in
<a data-type="xref" href="#terminals">“Terminals”</a>. Now let’s dive deeper into the topic of how to improve your
terminal usage, building on a concept that is both simple and powerful:
multiplexing.</p>

<p>Think of it in this way: you usually work on different things that
can be grouped together. For example, you may work on an open source project,
author a blog post or docs, access a server remotely, interact with an
HTTP API to test things, and so forth. These tasks may each require one or more
terminal windows, and often you want or need to do potentially
interdependent tasks in two windows at the same time. For example:</p>

<ul>
<li>
<p>You are using the <code>watch</code> command to periodically execute a directory listing
and at the same time edit a file.</p>
</li>
<li>
<p>You start a server process (a web server or application server) and want to
have it running in the foreground (see also <a data-type="xref" href="#job-control">“Job control”</a>) to keep an eye
on the logs.</p>
</li>
<li>
<p>You want to edit a file using <code>vi</code> and at the same time use <code>git</code> to query
the status and commit changes.</p>
</li>
<li>
<p>You have a VM running in the public cloud and want to <code>ssh</code> into it while
having the possibility to manage files locally.</p>
</li>
</ul>

<p>Think of all these examples as things that logically belong together
and that in terms of time duration can range from short term (a few minutes) to
long term (days and weeks). The grouping of those tasks is usually called a
<em>session</em>.</p>

<p>Now, there are a number of challenges if you want to achieve this grouping:</p>

<ul>
<li>
<p>You need multiple windows, so one solution is to launch multiple terminals
or, if the UI supports it, multiple instances (tabs).</p>
</li>
<li>
<p>You would like to have all the windows and paths around, even if you
close the terminal or the remote side closes down.</p>
</li>
<li>
<p>You want to expand or zoom in and out to focus on certain tasks
while keeping an overview of all your sessions and being able to navigate
between them.</p>
</li>
</ul>

<p>To enable these tasks, people came up with the idea of overlaying a terminal
with multiple windows (and sessions, to group windows)—in other words,
multiplexing the terminal I/O.</p>

<p>Let’s have a brief look at the original implementation of terminal multiplexing,
called <code>screen</code>. Then we’ll focus in-depth on a widely used implement called <code>tmux</code>
and wrap up with other options in this space.</p>








<section data-type="sect2" data-pdf-bookmark="screen"><div class="sect2" id="idm45805438002160">
<h2>screen</h2>

<p><a data-type="indexterm" data-primary="screen (terminal multiplexer)" id="idm45805438000960"/><a data-type="indexterm" data-primary="terminal multiplexer" data-secondary="screen" id="idm45805438000192"/><a href="https://oreil.ly/xx3ik"><code>screen</code></a> is the original terminal
multiplexer and is still used. Unless you’re in a remote environment
where nothing else is available and/or you can’t install another multiplexer,
you should probably not be using <code>screen</code>. One reason is that it’s
not actively maintained anymore, and another is that it’s not very flexible and
lacks a number of features modern terminal multiplexers have.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="tmux"><div class="sect2" id="idm45805437997696">
<h2>tmux</h2>

<p><a data-type="indexterm" data-primary="terminal multiplexer" data-secondary="tmux" id="ix_ch03-asciidoc17"/><a data-type="indexterm" data-primary="tmux (terminal mulitplexer)" id="ix_ch03-asciidoc18"/><a href="https://oreil.ly/kVg7M"><code>tmux</code></a> is a flexible and rich terminal multiplexer
that you can bend to your needs. As you can see in <a data-type="xref" href="#fig-tmux-concept">Figure 3-8</a>, there
are three core elements you’re interacting with in <code>tmux</code>, from coarse-grained
to fine-grained units:</p>

<figure><div id="fig-tmux-concept" class="figure">
<img src="Images/lmlx_0308.png" alt="" width="600" height="454"/>
<h6><span class="label">Figure 3-8. </span>The <code>tmux</code> elements: sessions, windows, and panes</h6>
</div></figure>
<dl>
<dt>Sessions</dt>
<dd>
<p>A logical unit that you can think of as a working environment
  dedicated to a specific task such as “working on project X” or “writing
  blog post Y.” It’s the container for all other units.</p>
</dd>
<dt>Windows</dt>
<dd>
<p>You can think of a window as a tab in a browser, belonging to a
  session. It’s optional to use, and often you only have one window per session.</p>
</dd>
<dt>Panes</dt>
<dd>
<p>These are your workhorses, effectively a single shell instance running.
  A pane is part of a window, and you can easily split it vertically or
  horizontally, as well as expand/collapse it (think: zoom) and close panes
  as you need them.</p>
</dd>
</dl>

<p>Just like <code>screen</code>, in <code>tmux</code> you have the ability to attach and detach a session. Let’s assume we start from scratch, let’s launch it with a session
called <code>test</code>:</p>

<pre data-type="programlisting" data-code-language="shell">$ tmux new -s <code class="nb">test</code></pre>

<p>With the preceding command, <code>tmux</code> is running as a server, and you find yourself in a
shell you’ve configured in <code>tmux</code>, running as the client. This client/server
model allows you to create, enter, leave, and destroy sessions and use the shells
running in it without having to think of the processes running (or failing)
in it.</p>

<p><code>tmux</code> uses Ctrl+b as the <a data-type="indexterm" data-primary="prefix" id="idm45805437960256"/><a data-type="indexterm" data-primary="trigger" id="idm45805437979264"/>default keyboard shortcut, also called <em>prefix</em> or <em>trigger</em>.
So for example, to list all windows, you would press Ctrl+b and then w, or to
expand the current (active) pane, you would use Ctrl+b and then z.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In <code>tmux</code> the default trigger is Ctrl+b. To improve the flow, I mapped the
trigger to an unused key, so a single keystroke is sufficient. I did this by first mapping the trigger to the Home key in <code>tmux</code> and

<span class="keep-together">then mapping</span> that Home key to the Caps Lock key by changing 
<span class="keep-together">its mapping</span> in
<em>/usr/share/X11/xkb/symbols/pc</em> to <code>key &lt;CAPS&gt; { [ Home ] };</code>.</p>

<p>This double-mapping was a workaround I needed to do. Depending
on your target key or terminal, you might not have to do this, but I
encourage you to map Ctrl+b to an unused key you can easily reach since
you will press it many times a day.</p>
</div>

<p>You can now use any of the commands listed in <a data-type="xref" href="#table-tmux-reference">Table 3-4</a> to manage
further sessions, windows, and panes. Also, when pressing Ctrl+b+d, you can
detach sessions. This means effectively that you put <code>tmux</code> into the background.</p>

<p>When you then start a new terminal instance or, say, you <code>ssh</code> to your machine
from a remote place, you can then attach to an existing session, so let’s do
that with the <code>test</code> session we created earlier:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>tmux</code><code> </code><code>attach</code><code> </code><code>-t</code><code> </code><code class="nb">test</code><code> </code><a class="co" id="co_shells_and_scripting_CO12-1" href="#callout_shells_and_scripting_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO12-1" href="#co_shells_and_scripting_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Attach to existing session called <code>test</code>. Note that if you want to detach
the session from its previous terminal, you would also supply the <code>-d</code> parameter.</p></dd>
</dl>

<p><a data-type="xref" href="#table-tmux-reference">Table 3-4</a> lists common <code>tmux</code> commands grouped by the units
discussed, from widest scope (session) to narrowest (pane).</p>
<table id="table-tmux-reference">
<caption><span class="label">Table 3-4. </span><code>tmux</code> reference</caption>
<thead>
<tr>
<th>Target</th>
<th>Task</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Session</p></td>
<td><p>Create new</p></td>
<td><p><code>:new -s NAME</code></p></td>
</tr>
<tr>
<td><p>Session</p></td>
<td><p>Rename</p></td>
<td><p>trigger + <code>$</code></p></td>
</tr>
<tr>
<td><p>Session</p></td>
<td><p>List all</p></td>
<td><p>trigger + <code>s</code></p></td>
</tr>
<tr>
<td><p>Session</p></td>
<td><p>Close</p></td>
<td><p>trigger<br/></p></td>
</tr>
<tr>
<td><p>Window</p></td>
<td><p>Create new</p></td>
<td><p>trigger + <code>c</code></p></td>
</tr>
<tr>
<td><p>Window</p></td>
<td><p>Rename</p></td>
<td><p>trigger + <code>,</code></p></td>
</tr>
<tr>
<td><p>Window</p></td>
<td><p>Switch to</p></td>
<td><p>trigger + <code>1</code> … <code>9</code></p></td>
</tr>
<tr>
<td><p>Window</p></td>
<td><p>List all</p></td>
<td><p>trigger + <code>w</code></p></td>
</tr>
<tr>
<td><p>Window</p></td>
<td><p>Close</p></td>
<td><p>trigger + <code>&amp;</code></p></td>
</tr>
<tr>
<td><p>Pane</p></td>
<td><p>Split horizontal</p></td>
<td><p>trigger + <code>"</code></p></td>
</tr>
<tr>
<td><p>Pane</p></td>
<td><p>Split vertical</p></td>
<td><p>trigger + <code>%</code></p></td>
</tr>
<tr>
<td><p>Pane</p></td>
<td><p>Toggle</p></td>
<td><p>trigger + <code>z</code></p></td>
</tr>
<tr>
<td><p>Pane</p></td>
<td><p>Close</p></td>
<td><p>trigger + <code>x</code></p></td>
</tr>
</tbody>
</table>

<p>Now that you have a basic idea of how to use <code>tmux</code>, let’s turn our attention to configuring and customizing it. My <em>.tmux.conf</em> looks as follows:</p>

<pre data-type="programlisting" data-code-language="shell"><code>unbind</code><code> </code><code>C-b</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-1" href="#callout_shells_and_scripting_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>prefix</code><code> </code><code>Home</code><code>
</code><code class="nb">bind</code><code> </code><code>Home</code><code> </code><code>send-prefix</code><code>
</code><code class="nb">bind</code><code> </code><code>r</code><code> </code><code>source-file</code><code> </code><code>~/.tmux.conf</code><code> </code><code class="se">\;</code><code> </code><code>display</code><code> </code><code class="s2">"tmux config reloaded :)"</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-2" href="#callout_shells_and_scripting_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nb">bind</code><code> </code><code class="se">\\</code><code> </code><code>split-window</code><code> </code><code>-h</code><code> </code><code>-c</code><code> </code><code class="s2">"#{pane_current_path}"</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-3" href="#callout_shells_and_scripting_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nb">bind</code><code> </code><code>-</code><code> </code><code>split-window</code><code> </code><code>-v</code><code> </code><code>-c</code><code> </code><code class="s2">"#{pane_current_path}"</code><code>
</code><code class="nb">bind</code><code> </code><code>X</code><code> </code><code>confirm-before</code><code> </code><code>kill-session</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-4" href="#callout_shells_and_scripting_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-s</code><code> </code><code>escape-time</code><code> </code><code class="m">1</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-5" href="#callout_shells_and_scripting_CO13-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>set-option</code><code> </code><code>-g</code><code> </code><code>mouse</code><code> </code><code>on</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-6" href="#callout_shells_and_scripting_CO13-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>default-terminal</code><code> </code><code class="s2">"screen-256color"</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-7" href="#callout_shells_and_scripting_CO13-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>set-option</code><code> </code><code>-g</code><code> </code><code>status-position</code><code> </code><code>top</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-8" href="#callout_shells_and_scripting_CO13-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>status-bg</code><code> </code><code>colour103</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>status-fg</code><code> </code><code>colour215</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>status-right-length</code><code> </code><code class="m">120</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>status-left-length</code><code> </code><code class="m">50</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>window-status-style</code><code> </code><code class="nv">fg</code><code class="o">=</code><code>colour215</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>pane-active-border-style</code><code> </code><code class="nv">fg</code><code class="o">=</code><code>colour215</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>@plugin</code><code> </code><code class="s1">'tmux-plugins/tmux-resurrect'</code><code> </code><a class="co" id="co_shells_and_scripting_CO13-9" href="#callout_shells_and_scripting_CO13-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>@plugin</code><code> </code><code class="s1">'tmux-plugins/tmux-continuum'</code><code>
</code><code class="nb">set</code><code> </code><code>-g</code><code> </code><code>@continuum-restore</code><code> </code><code class="s1">'on'</code><code>
</code><code>run</code><code> </code><code class="s1">'~/.tmux/plugins/tpm/tpm'</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO13-1" href="#co_shells_and_scripting_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This line and the next two lines change the trigger to <code>Home</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-2" href="#co_shells_and_scripting_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Reload config via trigger + r.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-3" href="#co_shells_and_scripting_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This line and the next redefine pane splitting; retain current directory of existing pane.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-4" href="#co_shells_and_scripting_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Adds shortcuts for new and kill sessions.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-5" href="#co_shells_and_scripting_CO13-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>No delays.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-6" href="#co_shells_and_scripting_CO13-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Enable mouse selections.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-7" href="#co_shells_and_scripting_CO13-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Set the default terminal mode to 256-color mode.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-8" href="#co_shells_and_scripting_CO13-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>Theme settings (next six lines).</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO13-9" href="#co_shells_and_scripting_CO13-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>From here to the end: plug-in management.</p></dd>
</dl>

<p>First install <a href="https://oreil.ly/hsoau">tpm</a>, the <code>tmux</code> plug-in manager,
and then trigger 
<span class="keep-together">+ I</span> for the plug-ins. The plug-ins used here are the following:</p>
<dl class="pagebreak-before">
<dt class="less_space"><a href="https://oreil.ly/JugvE">tmux-resurrect</a></dt>
<dd>
<p>Allows you to restore
  sessions with Ctrl+s (safe) and Ctrl+r (restore)</p>
</dd>
<dt><a href="https://oreil.ly/KvT7l">tmux-continuum</a></dt>
<dd>
<p>Automatically
  saves/restores a session (15-minute interval)</p>
</dd>
</dl>

<p><a data-type="xref" href="#fig-tmux-example">Figure 3-9</a> shows my Alacritty terminal running <code>tmux</code>. You can see the
sessions with the shortcuts 0 to 9, located in the left upper corner.</p>

<figure><div id="fig-tmux-example" class="figure">
<img src="Images/lmlx_0309.png" alt="lmlx 0309" width="600" height="373"/>
<h6><span class="label">Figure 3-9. </span>An example <code>tmux</code> instance in action, showing available sessions</h6>
</div></figure>

<p>While <code>tmux</code> certainly is an excellent choice, there are indeed other options
than <code>tmux</code>, so let’s have a peek<a data-type="indexterm" data-startref="ix_ch03-asciidoc18" id="idm45805437672304"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc17" id="idm45805437671600"/>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Other Multiplexers"><div class="sect2" id="idm45805437996752">
<h2>Other Multiplexers</h2>

<p>Other terminal multiplexers you can have a look at and try out include the following:</p>
<dl>
<dt><a href="https://oreil.ly/JyWmA">tmuxinator</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="tmuxinator" id="idm45805437667520"/>A meta-tool allowing
  you to manage <code>tmux</code> sessions</p>
</dd>
<dt><a href="https://oreil.ly/pJLa2">Byobu</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Byobu" id="idm45805437664688"/>A wrapper around either <code>screen</code> or <code>tmux</code>;
  it’s especially interesting if you’re using the Ubuntu- or Debian-based Linux distros</p>
</dd>
<dt><a href="https://oreil.ly/ZRHnX">Zellij</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="Zellij" id="idm45805437661280"/>Calls itself a terminal workspace, is
  written in Rust, and goes beyond what <code>tmux</code> offers, including a layout engine
  and a powerful plug-in system</p>
</dd>
<dt><a href="https://oreil.ly/yaTan">dvtm</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="dvtim" id="idm45805437658384"/>Brings the concept of tiling window management
  to the terminal; it’s powerful but has a learning curve like <code>tmux</code></p>
</dd>
<dt><a href="https://oreil.ly/S6nvV">3mux</a></dt>
<dd>
<p><a data-type="indexterm" data-primary="3mux" data-primary-sortas="three" id="idm45805437655584"/>A simple terminal multiplexer
  written in Go; it’s easy to use but not as powerful as <code>tmux</code></p>
</dd>
</dl>

<p>With this quick review of multiplexer options out of the way, let’s talk about
selecting one.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805437653488">
<h5>Bringing It All Together: Terminal, mux, and shell</h5>
<p><a data-type="indexterm" data-primary="Alacritty" id="idm45805437652080"/>I’m using Alacritty as my terminal. It’s fast, and best of all, to configure it
I’m using a YAML configuration file that I can version in Git, allowing me to
use it on any target system in seconds. This config file called <em>alacritty.yml</em>
defines all my settings for the terminal, from colors to key bindings to font sizes.</p>

<p>Most of the settings apply right away (hot-reload), others when I save the file.
One setting, called <code>shell</code>, defines the integration between the terminal multiplexer
I use (<code>tmux</code>) and the shell I use (<code>fish</code>) and looks as follows:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nn">...</code><code class="w"/>
<code class="nt">shell</code><code class="p">:</code><code class="w"/>
<code class="w">  </code><code class="nt">program</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">/usr/local/bin/fish</code><code class="w"/>
<code class="w">  </code><code class="nt">args</code><code class="p">:</code><code class="w"/>
<code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="l-Scalar-Plain">-l</code><code class="w"/>
<code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="l-Scalar-Plain">-i</code><code class="w"/>
<code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="l-Scalar-Plain">-c</code><code class="w"/>
<code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="s">"tmux</code><code class="nv"> </code><code class="s">new-session</code><code class="nv"> </code><code class="s">-A</code><code class="nv"> </code><code class="s">-s</code><code class="nv"> </code><code class="s">zzz"</code><code class="w"/>
<code class="nn">...</code><code class="w"/></pre>

<p>In the preceding snippet, I configure Alacritty to use <code>fish</code> as the default shell,
but also, when I launch the terminal, it automatically attaches
to a specific session. Together with the <code>tmux-continuum</code> plug-in, this gives me
peace of mind. Even if I switch off the computer, once I restart I find my
terminal with all its sessions, windows, and panes (almost) exactly in the
state it was in before a crash, besides the shell variables<a data-type="indexterm" data-startref="ix_ch03-asciidoc16" id="idm45805437560592"/>.</p>
</div></aside>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Which Multiplexer Should I Use?"><div class="sect2" id="idm45805437559600">
<h2>Which Multiplexer Should I Use?</h2>

<p><a data-type="indexterm" data-primary="terminal multiplexer" data-secondary="choosing a multiplexer" id="idm45805437558432"/>Unlike with shells for human users, <a data-type="indexterm" data-primary="tmux (terminal mulitplexer)" data-secondary="reasons to use" id="idm45805437612416"/>I do have a concrete preference here in the
context of terminal multiplexer: use <code>tmux</code>. The reasons are manifold: it is mature,
stable, rich (has many available plug-ins), and flexible. Many folks are using it, so there’s
plenty of material out there to read up on as well as help available. The other 
<span class="keep-together">multiplexers</span>
are exciting but relatively new or are, as is the case with <code>screen</code>, no longer in their prime.</p>

<p>With that, I hope I was able to convince you to consider using a terminal
multiplexer to improve your terminal and shell experience, speed up your
tasks, and make the overall flow smoother.</p>

<p>Now, we turn our attention to the last topic in this chapter, automating
tasks with shell scripts.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Scripting"><div class="sect1" id="scripting">
<h1>Scripting</h1>

<p><a data-type="indexterm" data-primary="scripting" id="ix_ch03-asciidoc19"/>In the previous sections of this chapter, we focused on the manual, interactive
usage of the shell. Once you’ve done a certain task over and over again manually
on the prompt, it’s likely time to automate the task. This is where scripts come
in.</p>

<p><a data-type="indexterm" data-primary="bash" data-secondary="scripting in" id="idm45805437605104"/>Here we focus on writing scripts in bash. This is due to two reasons:</p>

<ul>
<li>
<p>Most of the scripts out there are written in bash, and hence you
will find a lot of examples and help available for bash scripts.</p>
</li>
<li>
<p>The likelihood of finding bash available on a target system is high,
making your potential user base bigger than if you used a
(potentially more powerful but esoteric or not widely used) alternative to bash.</p>
</li>
</ul>

<p>Just to provide you with some context before we start, there are shell
scripts out there that clock in at
<a href="https://oreil.ly/0oWzI">several
thousands</a> of lines of code. Not that I encourage you to aim for this—quite
the opposite: if you find yourself writing long scripts, ask yourself if
a proper scripting language such as Python or Ruby is the better choice.</p>

<p>Let’s step back now and develop a short but useful example,
applying good practices along the way. Let’s assume we want to automate the task
of displaying a single statement on the screen that, given a user’s GitHub
handle, shows when the user joined, using their full name, something along
the lines of the following:</p>

<pre data-type="programlisting">XXXX XXXXX joined GitHub in YYYY</pre>

<p>How do we go about automating this task with a script? Let’s start with the
basics, then review portability, and work our way up to the “business logic”
of the script.</p>








<section data-type="sect2" data-pdf-bookmark="Scripting Basics"><div class="sect2" id="idm45805437598976">
<h2>Scripting Basics</h2>

<p><a data-type="indexterm" data-primary="scripting" data-secondary="basics" id="ix_ch03-asciidoc20"/>The good news is that by interactively using a shell, you already know most
of the relevant terms and techniques. In addition to variables, streams
and redirection, and common commands, there are a few specific things
you want to be familiar with in the context of scripts, so let’s review them.</p>










<section data-type="sect3" data-pdf-bookmark="Advanced data types"><div class="sect3" id="idm45805437596032">
<h3>Advanced data types</h3>

<p><a data-type="indexterm" data-primary="scripting" data-secondary="advanced data types" id="idm45805437594624"/>While shells usually treat everything as strings (if you want to
perform some more complicated numerical tasks, you should probably not use
a shell script), they do support some advanced data types such as arrays.</p>

<p>Let’s have a look at arrays in action:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="nv">os</code><code class="o">=</code><code class="o">(</code><code class="s1">'Linux'</code><code> </code><code class="s1">'macOS'</code><code> </code><code class="s1">'Windows'</code><code class="o">)</code><code> </code><a class="co" id="co_shells_and_scripting_CO14-1" href="#callout_shells_and_scripting_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nb">echo</code><code> </code><code class="s2">"</code><code class="si">${</code><code class="nv">os</code><code class="p">[0]</code><code class="si">}</code><code class="s2">"</code><code> </code><a class="co" id="co_shells_and_scripting_CO14-2" href="#callout_shells_and_scripting_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nv">numberofos</code><code class="o">=</code><code class="s2">"</code><code class="si">${#</code><code class="nv">os</code><code class="p">[@]</code><code class="si">}</code><code class="s2">"</code><code> </code><a class="co" id="co_shells_and_scripting_CO14-3" href="#callout_shells_and_scripting_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO14-1" href="#co_shells_and_scripting_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Define an array with three elements.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO14-2" href="#co_shells_and_scripting_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Access the first element; this would print <code>Linux</code>.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO14-3" href="#co_shells_and_scripting_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Get the length of the array, resulting in <code>numberofos</code> being 3.</p></dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Flow control"><div class="sect3" id="idm45805437472256">
<h3>Flow control</h3>

<p><a data-type="indexterm" data-primary="flow control" id="idm45805437470912"/><a data-type="indexterm" data-primary="scripting" data-secondary="flow control" id="idm45805437470208"/>Flow control allows you to branch (<code>if</code>) or repeat (<code>for</code> and <code>while</code>) in your
script, making the execution dependent on a certain condition.</p>

<p>Some usage examples of flow control:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="k">for</code><code> </code><code>afile</code><code> </code><code class="k">in</code><code> </code><code>/tmp/*</code><code> </code><code class="p">;</code><code> </code><code class="k">do</code><code> </code><a class="co" id="co_shells_and_scripting_CO15-1" href="#callout_shells_and_scripting_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code class="nb">echo</code><code> </code><code class="s2">"</code><code class="nv">$afile</code><code class="s2">"</code><code>
</code><code class="k">done</code><code>

</code><code class="k">for</code><code> </code><code>i</code><code> </code><code class="k">in</code><code> </code><code class="o">{</code><code class="m">1</code><code>..10</code><code class="o">}</code><code class="p">;</code><code> </code><code class="k">do</code><code> </code><a class="co" id="co_shells_and_scripting_CO15-2" href="#callout_shells_and_scripting_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="nb">echo</code><code> </code><code class="s2">"</code><code class="nv">$i</code><code class="s2">"</code><code>
</code><code class="k">done</code><code>

</code><code class="k">while</code><code> </code><code>true</code><code class="p">;</code><code> </code><code class="k">do</code><code>
  </code><code>...</code><code>
</code><code class="k">done</code><code> </code><a class="co" id="co_shells_and_scripting_CO15-3" href="#callout_shells_and_scripting_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO15-1" href="#co_shells_and_scripting_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Basic loop iterating over a directory, printing each file name</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO15-2" href="#co_shells_and_scripting_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Range loop</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO15-3" href="#co_shells_and_scripting_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Forever loop; break out with Ctrl+C</p></dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Functions"><div class="sect3" id="idm45805437418928">
<h3>Functions</h3>

<p><a data-type="indexterm" data-primary="functions, in scripting" id="idm45805437417520"/><a data-type="indexterm" data-primary="scripting" data-secondary="functions" id="idm45805437385840"/>Functions allow you to write more modular and reusable scripts. You have
to define the function before you use it since the shell interprets the
script from top to bottom.</p>

<p>A simple function example:</p>

<pre data-type="programlisting" data-code-language="shell"><code>sayhi</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_shells_and_scripting_CO16-1" href="#callout_shells_and_scripting_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="nb">echo</code><code> </code><code class="s2">"</code><code class="s2">Hi </code><code class="nv">$1</code><code class="s2"> hope you are well!</code><code class="s2">"</code><code>
</code><code class="o">}</code><code>

</code><code>sayhi</code><code> </code><code class="s2">"Michael"</code><code> </code><a class="co" id="co_shells_and_scripting_CO16-2" href="#callout_shells_and_scripting_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO16-1" href="#co_shells_and_scripting_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Function definition; parameters implicitly passed via <code>$n</code></p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO16-2" href="#co_shells_and_scripting_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Function invocation; the output is “Hi Michael hope you are well!”</p></dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Advanced I/O"><div class="sect3" id="idm45805437360560">
<h3>Advanced I/O</h3>

<p><a data-type="indexterm" data-primary="scripting" data-secondary="advanced I/O" id="idm45805437359152"/>With <code>read</code> you can read user input from <code>stdin</code> that you can use
to elicit runtime input—for example, with a menu of options. Further, rather
than using <code>echo</code>, consider <code>printf</code>, which allows you fine-grained control
over the output, including colors. <code>printf</code> is also more portable than <code>echo</code>.</p>

<p>Following is an example usage of the advanced I/O in action:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="nb">read</code><code> </code><code>name</code><code> </code><a class="co" id="co_shells_and_scripting_CO17-1" href="#callout_shells_and_scripting_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nb">printf</code><code> </code><code class="s2">"Hello %s"</code><code> </code><code class="s2">"</code><code class="nv">$name</code><code class="s2">"</code><code> </code><a class="co" id="co_shells_and_scripting_CO17-2" href="#callout_shells_and_scripting_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO17-1" href="#co_shells_and_scripting_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Read value from user input.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO17-2" href="#co_shells_and_scripting_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Output value read in the previous step.</p></dd>
</dl>

<p>There are other, more advanced concepts available for you, such as
<a href="https://oreil.ly/JsV1v">signals
and traps</a>. Given that we want to provide only an overview and introduction to the scripting
topic here, I will refer you to the excellent <a href="https://oreil.ly/nVjhN">bash Scripting Cheatsheet</a>
for a comprehensive reference of all the relevant constructs. If you are
serious about writing shell scripts, I recommend you read
<a class="orm:hideurl" href="https://oreil.ly/0jEt9"><em>bash
Cookbook</em></a> by Carl Albing, JP Vossen, and Cameron Newham, which contains lots
and lots of great snippets you can use as a starting point.<a data-type="indexterm" data-startref="ix_ch03-asciidoc20" id="idm45805437286240"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Writing Portable bash Scripts"><div class="sect2" id="idm45805437285440">
<h2>Writing Portable bash Scripts</h2>

<p><a data-type="indexterm" data-primary="bash scripts" data-secondary="writing portable scripts" id="ix_ch03-asciidoc21"/><a data-type="indexterm" data-primary="portable bash scripts" id="ix_ch03-asciidoc22"/>We’ll now look at what it means to write portable scripts in bash. But wait.
What does <em>portable</em> mean, and why should you care?</p>

<p>At the beginning of <a data-type="xref" href="#shells">“Shells”</a>, we defined what <em>POSIX</em> means, so let’s build on
that. When I say “portable,” I mean  that we are not making too many
assumptions—implicitly or explicitly—about the environment a script will
be executed in. If a script is portable, it runs on many different systems
(shells, Linux distros, etc.).</p>

<p>But remember that, even if you pin down the type of shell, in our case to bash,
not all features work the same way across different versions of a shell.
At the end of the day, it boils down to the number of different
environments you can test your script in.</p>










<section data-type="sect3" data-pdf-bookmark="Executing portable scripts"><div class="sect3" id="idm45805437278768">
<h3>Executing portable scripts</h3>

<p><a data-type="indexterm" data-primary="portable bash scripts" data-secondary="executing" id="idm45805437277552"/>How are scripts executed? First, let’s state that scripts really are simply
text files; the extension doesn’t matter, although often you find <em>.sh</em> used as a
convention. But there are two things that turn a text file into a script
that is executable and able to be run by the shell:</p>

<ul>
<li>
<p>The text file needs to declare the interpreter in the first line, using what is
called <a href="https://oreil.ly/88BcE"><em>shebang</em></a> (or <em>hashbang</em>), which is written
as <code>#!</code> (see also the first line of the template that follows).</p>
</li>
<li>
<p>Then, you need to make the script executable using, for example, <code>chmod +x</code>,
which allows everyone to run it, or, even better, <code>chmod 750</code>, which is more
along the lines of the least privileges principle, as it allows only the user and group
associated with the script to run it. We’ll dive deep into this topic in
<a data-type="xref" href="ch04.xhtml#access-control">Chapter 4</a>.</p>
</li>
</ul>

<p>Now that you know the basics, let’s have a look at a concrete template
we can use as a starting point.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="A skeleton template"><div class="sect3" id="idm45805437269264">
<h3>A skeleton template</h3>

<p><a data-type="indexterm" data-primary="portable bash scripts" data-secondary="skeleton template" id="idm45805437267888"/>A skeleton template for a portable bash shell script that you can use as a seed
looks as follows:</p>

<pre data-type="programlisting" data-code-language="shell"><code class="ch">#!/usr/bin/env bash </code><a class="co" id="co_shells_and_scripting_CO18-1" href="#callout_shells_and_scripting_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="ch">
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>errexit</code><code> </code><a class="co" id="co_shells_and_scripting_CO18-2" href="#callout_shells_and_scripting_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>nounset</code><code> </code><a class="co" id="co_shells_and_scripting_CO18-3" href="#callout_shells_and_scripting_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>pipefail</code><code> </code><a class="co" id="co_shells_and_scripting_CO18-4" href="#callout_shells_and_scripting_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>

</code><code class="nv">firstargument</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="nv">1</code><code class="k">:-</code><code class="nv">somedefaultvalue</code><code class="si">}</code><code class="s2">"</code><code> </code><a class="co" id="co_shells_and_scripting_CO18-5" href="#callout_shells_and_scripting_CO18-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>

</code><code class="nb">echo</code><code> </code><code class="s2">"</code><code class="nv">$firstargument</code><code class="s2">"</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_shells_and_scripting_CO18-1" href="#co_shells_and_scripting_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The <a href="https://oreil.ly/l6xNO">hashbang</a> instructs the
program loader that we want it to use <code>bash</code> to interpret this script.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO18-2" href="#co_shells_and_scripting_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Define that we want to stop the script execution if an error happens.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO18-3" href="#co_shells_and_scripting_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Define that we treat unset variables as an error (so the script is less
likely to fail silently).</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO18-4" href="#co_shells_and_scripting_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Define that when one part of a pipe fails, the whole pipe should be
considered failed. This helps to avoid silent failures.</p></dd>
<dt><a class="co" id="callout_shells_and_scripting_CO18-5" href="#co_shells_and_scripting_CO18-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>An example command-line parameter with a default value.</p></dd>
</dl>

<p>We will use this template later in this section to implement our GitHub
info script.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Good practices"><div class="sect3" id="idm45805437185328">
<h3>Good practices</h3>

<p><a data-type="indexterm" data-primary="portable bash scripts" data-secondary="good practices" id="idm45805437184192"/>I’m using <em>good</em> practices instead of <em>best</em> practices because what you should
do depends on the situation and how far you want to go. There is a difference
between a script you write for yourself and one that you ship to thousands of
users, but in general, high-level good practices writing scripts are as follows:</p>
<dl>
<dt>Fail fast and loud</dt>
<dd>
<p>Avoid silent fails, and fail fast; things like <code>errexit</code> and <code>pipefail</code> do that
for you. Since bash tends to fail silently by default, failing fast is almost always
a good idea.</p>
</dd>
<dt>Sensitive information</dt>
<dd>
<p><a data-type="indexterm" data-primary="security" data-secondary="scripting good practices" id="idm45805437177776"/>Don’t hardcode any sensitive information such as passwords into the script.
Such information should be provided at runtime, via user input or calling
out to an API. Also, consider that a <code>ps</code> reveals program parameters and more, which is another way that sensitive information can be leaked.</p>
</dd>
<dt>Input sanitization</dt>
<dd>
<p>Set and provide sane defaults for variables where possible,
and sanitize the input you receive from users or other sources.
For example, launch parameters provided or interactively ingested via the
<code>read</code> command to avoid situations where an innocent-looking
<code>rm -rf "$PROJECTHOME/"*</code> wipes your drive because the variable wasn’t set.</p>
</dd>
<dt>Check dependencies</dt>
<dd>
<p>Don’t assume that a certain tool or command is available, unless it’s a build-in
or you know your target environment. Just because your machine has <code>curl</code> installed
doesn’t mean the target machine has. If possible, provide fallbacks—for example,
if no <code>curl</code> is available, use <code>wget</code>.</p>
</dd>
<dt>Error handling</dt>
<dd>
<p>When your script fails (and it’s not a matter of if but when and where), provide
actionable instructions for your users. For example, rather than <code>Error 123</code>,
say what has failed and how your user can fix the situation, such as
<code>Tried to write to /project/xyz/ but seems this is read-only for me</code>.</p>
</dd>
<dt>Documentation</dt>
<dd>
<p>Document your scripts inline (using <code># Some doc here</code>) for main blocks,
and try to stick to 80-column width for readability and diffing.</p>
</dd>
<dt>Versioning</dt>
<dd>
<p>Consider versioning your scripts using Git.</p>
</dd>
<dt>Testing</dt>
<dd>
<p>Lint and <em>test</em> the scripts. Since this is such an important practice, we will
discuss it in greater detail in the next section.</p>
</dd>
</dl>

<p>Let’s now move on to making scripts safe(r) by linting them while developing
and testing them before you distribute them.<a data-type="indexterm" data-startref="ix_ch03-asciidoc22" id="idm45805437163408"/><a data-type="indexterm" data-startref="ix_ch03-asciidoc21" id="idm45805437162704"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Linting and Testing Scripts"><div class="sect2" id="linting-testing-scripts">
<h2>Linting and Testing Scripts</h2>

<p><a data-type="indexterm" data-primary="bash scripts" data-secondary="linting/testing" id="idm45805437160064"/>While you’re developing, you want to check and lint your scripts, making
sure that you’re using commands and instructions correctly. <a data-type="indexterm" data-primary="ShellCheck" id="idm45805437158576"/>There’s a nice
way to do that, depicted in <a data-type="xref" href="#fig-shellcheck">Figure 3-10</a>, with the program
<a href="https://oreil.ly/Z3blD">ShellCheck</a>;
you can download and install it locally, or you can also use the online
version via <a class="orm:hideurl" href="https://oreil.ly/EVVRg"><em>shell​​check.net</em></a>.
Also, consider formatting your script with <a href="https://oreil.ly/obaKQ">shfmt</a>.
It automatically fixes issues that can be reported later by 
<span class="keep-together"><code>shellcheck</code></span>.</p>

<figure><div id="fig-shellcheck" class="figure">
<img src="Images/lmlx_0310.png" alt="lmlx 0310" width="600" height="565"/>
<h6><span class="label">Figure 3-10. </span>A screenshot of the online ShellCheck tool</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="bats (Bash Automated Testing System)" id="idm45805437151344"/>And further, before you check your script into a repo, consider using <code>bats</code>
to test it. <a href="https://oreil.ly/uVNgh"><code>bats</code></a>, short for Bash Automated Testing System,
allows you to define test files as a bash script with special syntax for
test cases. Each test case is simply a bash function with a description, and
you would typically invoke these scripts as part of a CI pipeline—for example,
as a GitHub action.</p>

<p>Now we’ll put our good practices for script writing, linting, and testing into use.
Let’s implement the example script we specified in the beginning of this section.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="End-to-End Example: GitHub User Info Script"><div class="sect2" id="idm45805437148688">
<h2>End-to-End Example: GitHub User Info Script</h2>

<p><a data-type="indexterm" data-primary="scripting" data-secondary="end-to-end example: GitHub user info script" id="ix_ch03-asciidoc23"/>In this end-to-end example, we bring all of the preceding tips and tooling together to
implement our example script that is supposed to take a GitHub user handle and
print out a message that contains what year the user joined, along with their full name.</p>

<p>This is how one implementation looks, taking the good practices into
account. Store the following in a file called <em>gh-user-info.sh</em>, and make it
executable:</p>
<pre data-type="programlisting" data-code-language="shell"><code class="ch">#!/usr/bin/env bash
</code><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>errexit</code><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>errtrace</code><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>nounset</code><code>
</code><code class="nb">set</code><code> </code><code>-o</code><code> </code><code>pipefail</code><code>

</code><code class="c1">### Command line parameter:
</code><code class="nv">targetuser</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="nv">1</code><code class="k">:-</code><code class="nv">mhausenblas</code><code class="si">}</code><code class="s2">"</code><code> </code><a class="co" id="custom_co_shells_and_scripting_CO19-1" href="#custom_callout_shells_and_scripting_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code class="c1">### Check if our dependencies are met:
</code><code class="k">if</code><code> </code><code>!</code><code> </code><code class="o">[</code><code> </code><code>-x</code><code> </code><code class="s2">"</code><code class="k">$(</code><code class="nb">command</code><code> </code><code>-v</code><code> </code><code>jq</code><code class="k">)</code><code class="s2">"</code><code> </code><code class="o">]</code><code>
</code><code class="k">then</code><code>
  </code><code class="nb">echo</code><code> </code><code class="s2">"jq is not installed"</code><code> </code><code>&gt;</code><code class="p">&amp;</code><code class="m">2</code><code>
  </code><code class="nb">exit</code><code> </code><code class="m">1</code><code>
</code><code class="k">fi</code><code>

</code><code class="c1">### Main:
</code><code class="nv">githubapi</code><code class="o">=</code><code class="s2">"https://api.github.com/users/"</code><code>
</code><code class="nv">tmpuserdump</code><code class="o">=</code><code class="s2">"</code><code class="s2">/tmp/ghuserdump_</code><code class="nv">$targetuser</code><code class="s2">.json</code><code class="s2">"</code><code>

</code><code class="nv">result</code><code class="o">=</code><code class="k">$(</code><code>curl</code><code> </code><code>-s</code><code> </code><code class="nv">$githubapi</code><code class="nv">$targetuser</code><code class="k">)</code><code> </code><a class="co" id="custom_co_shells_and_scripting_CO19-2" href="#custom_callout_shells_and_scripting_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nb">echo</code><code> </code><code class="nv">$result</code><code> </code><code>&gt;</code><code> </code><code class="nv">$tmpuserdump</code><code>

</code><code class="nv">name</code><code class="o">=</code><code class="k">$(</code><code>jq</code><code> </code><code>.name</code><code> </code><code class="nv">$tmpuserdump</code><code> </code><code>-r</code><code class="k">)</code><code> </code><a class="co" id="custom_co_shells_and_scripting_CO19-3" href="#custom_callout_shells_and_scripting_CO19-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="nv">created_at</code><code class="o">=</code><code class="k">$(</code><code>jq</code><code> </code><code>.created_at</code><code> </code><code class="nv">$tmpuserdump</code><code> </code><code>-r</code><code class="k">)</code><code>

</code><code class="nv">joinyear</code><code class="o">=</code><code class="k">$(</code><code class="nb">echo</code><code> </code><code class="nv">$created_at</code><code> </code><code class="p">|</code><code> </code><code>cut</code><code> </code><code>-f1</code><code> </code><code>-d</code><code class="s2">"-"</code><code class="k">)</code><code> </code><a class="co" id="custom_co_shells_and_scripting_CO19-4" href="#custom_callout_shells_and_scripting_CO19-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="nb">echo</code><code> </code><code class="nv">$name</code><code> </code><code>joined</code><code> </code><code>GitHub</code><code> </code><code class="k">in</code><code> </code><code class="nv">$joinyear</code><code> </code><a class="co" id="custom_co_shells_and_scripting_CO19-5" href="#custom_callout_shells_and_scripting_CO19-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist pagebreak-before">
<dt class="less_space"><a class="co" id="custom_callout_shells_and_scripting_CO19-1" href="#custom_co_shells_and_scripting_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Provide a default value to use if user doesn’t supply one.</p></dd>
<dt><a class="co" id="custom_callout_shells_and_scripting_CO19-2" href="#custom_co_shells_and_scripting_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Using <code>curl</code>, access the <a href="https://oreil.ly/A7CLS">GitHub API</a>
to download the user information as a JSON file, and store it in a temporary file (next line).</p></dd>
<dt><a class="co" id="custom_callout_shells_and_scripting_CO19-3" href="#custom_co_shells_and_scripting_CO19-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Using <code>jq</code>, pull out the fields we need. Note that the <code>created_at</code> field
has a value that looks something like <code>"2009-02-07T16:07:32Z"</code>.</p></dd>
<dt><a class="co" id="custom_callout_shells_and_scripting_CO19-4" href="#custom_co_shells_and_scripting_CO19-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Using <code>cut</code>, extract the year from the <code>created_at</code> field in the JSON file.</p></dd>
<dt><a class="co" id="custom_callout_shells_and_scripting_CO19-5" href="#custom_co_shells_and_scripting_CO19-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Assemble the output message and print to screen.</p></dd>
</dl>

<p>Now let’s run it with the defaults:</p>

<pre data-type="programlisting" data-code-language="shell">$ ./gh-user-info.sh
Michael Hausenblas joined GitHub <code class="k">in</code> <code class="m">2009</code></pre>

<p>Congratulations, you now have everything at your disposal to use the shell,
both interactively on the prompt and for scripting. Before we wrap up,
take a moment to think about the following concerning our <em>gh-user-info.sh</em>
script:</p>

<ul>
<li>
<p>What if the JSON blob the GitHub API returns is not valid? What if we
encounter a 500 HTTP error? Maybe adding a message along the lines of “try later”
is more useful if there’s nothing the user can do themselves.</p>
</li>
<li>
<p>For the script to work, you need network access, otherwise the <code>curl</code> call will
fail. What could you do about a lack of network access? Informing the user
about it and suggesting what they can do to check networking may be an option.</p>
</li>
<li>
<p>Think about improvements around dependency checks—for example, we
implicitly assume here that <code>curl</code> is installed. Can you maybe add a check
that makes the binary variable and falls back to <code>wget</code>?</p>
</li>
<li>
<p>How about adding some usage help? If the script is called with
an <code>-h</code> or <code>--help</code> parameter, perhaps show a concrete usage example and the options
that users can use to influence the execution (ideally, including defining
default values used).</p>
</li>
</ul>

<p>You see now that, although this script looks good and works in most cases, there’s
always something you can improve, such as making the script more robust and providing actionable error messages. In this context, consider using frameworks such as
<a href="https://oreil.ly/gLmlB">bashing</a>, <a href="https://oreil.ly/t8U9u">rerun</a>,
or <a href="https://oreil.ly/7F2lT">rr</a> to improve modularity<a data-type="indexterm" data-startref="ix_ch03-asciidoc23" id="idm45805437010912"/>.<a data-type="indexterm" data-startref="ix_ch03-asciidoc19" id="idm45805437042800"/></p>
</div></section>





</div></section>













<section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45805437608112">
<h1>Conclusion</h1>

<p>In this chapter, we focused on working with Linux in the terminal, a textual user interface.
We discussed shell terminology, provided a hands-on introduction to using the shell
basics, and reviewed common tasks and how you can improve your shell productivity
using modern variants of certain commands (such as <code>exa</code> rather than <code>ls</code>).</p>

<p>Then, we looked at modern, human-friendly shells, specifically at <code>fish</code>, and how to
configure and use them. Further, we covered the terminal multiplexer by using <code>tmux</code> as
the hands-on example, enabling you to work with multiple local or remote sessions.
Using modern shells and multiplexers can dramatically improve your efficiency
on the command line, and I strongly recommend you consider adopting them.</p>

<p>Lastly, we discussed automating tasks by writing safe and portable shell scripts,
including linting and testing said scripts. Remember that shells are effectively
command interpreters, and as with any kind of language, you have to practice to
get fluent. Having said this, now that you’re equipped with the basics of using
Linux from the command line, you can already work with the majority of
Linux-based systems out there, be it an embedded system or a cloud VM. In any
case, you’ll find a way to get hold of a terminal and issue commands
interactively or via executing scripts.</p>

<p>If you want to dive deeper into the topics discussed in this chapter, here are
some additional resources:</p>
<dl>
<dt>Terminals</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/u2CFr">“Anatomy of a Terminal Emulator”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/8GT6s">“The TTY Demystified”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/vyVAV">“The Terminal, the Console and the Shell—What Are They?”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/E0EGG">“What Is a TTY on Linux? (and How to Use the tty Command)”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/xIEoZ">“Your Terminal Is Not a Terminal: An Introduction to Streams”</a></p>
</li>
</ul>
</dd>
<dt>Shells</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/4pepC">“Unix Shells: bash, Fish, ksh, tcsh, zsh”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/RQfS6">“Comparison of Command Shells”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/kseEe">“bash vs zsh” thread on reddit</a></p>
</li>
<li>
<p><a href="https://oreil.ly/1KGz6">“Ghost in the Shell—Part 7—ZSH Setup”</a></p>
</li>
</ul>
</dd>
<dt class="pagebreak-before less_space">Terminal multiplexer</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/soqPv">“A tmux Crash Course”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/0hVCS">“A Quick and Easy Guide to tmux”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/Q75TR">“How to Use tmux on Linux (and Why It’s Better Than screen)”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/QDsYI"><em>The Tao of tmux</em></a></p>
</li>
<li>
<p><a href="https://oreil.ly/eO9y2"><em>tmux 2: Productive Mouse-Free Development</em></a></p>
</li>
<li>
<p><a href="https://oreil.ly/SWCa5">Tmux Cheat Sheet &amp; Quick Reference website</a></p>
</li>
</ul>
</dd>
<dt>Shell scripts</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/3cxAw">“Shell Style Guide”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/zfy1v">“bash Style Guide”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/eC1ol">“bash Best Practices”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/nVroM">“bash Scripting Cheatsheet”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/D0zwe">“Writing
bash Scripts That Are Not Only bash: Checking for bashisms and Testing with Dash”</a></p>
</li>
</ul>
</dd>
</dl>

<p>With the shell basics at our disposal, we now turn our focus to access control
and enforcement in Linux.</p>
</div></section>







</div></section></div></body></html>