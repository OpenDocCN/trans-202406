<html><head></head><body><div id="sbo-rt-content"><section class="pagenumrestart" data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 1. Using the mysql Client Program"><div class="chapter" id="nch-mysql"><h1><span class="label">Chapter 1. </span>Using the mysql Client Program</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820416565600"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="1.0 Introduction"><div class="sect1" id="nch-mysql-mysql-intro"><h1>1.0 Introduction</h1><p>The MySQL database system uses a client-server architecture. The
    server, <span class="command"><em>mysqld</em></span>, is the program that actually manipulates databases. To tell the
    server what to do, use a client program that communicates your intent by
    means of statements written in Structured Query Language (SQL). Client programs are written
    for diverse purposes, but each interacts with the server by connecting to
    it, sending SQL statements to have database operations performed, and
    receiving the results.</p><p>Clients are installed locally on the machine from which you want to
    access MySQL, but the server can be installed anywhere, as long as clients
    can connect to it. Because MySQL is an inherently networked database
    system, clients can communicate with a server running locally on your own
    machine or somewhere on the other side of the planet.</p><p>The <span class="command"><em>mysql</em></span> program is one of the clients included in MySQL distributions. When
    used interactively, <span class="command"><em>mysql</em></span> prompts you
    for a statement, sends it to the MySQL server for execution, and displays
    the results. <span class="command"><em>mysql</em></span> also can be used
    noninteractively in batch mode to read statements stored in files or
    produced by programs. This enables use of <span class="command"><em>mysql</em></span> from within scripts or <span class="command"><em>cron</em></span> jobs, or in conjunction with other
    applications.</p><p>This chapter describes <span class="command"><em>mysql</em></span>’s
    capabilities so that you can use it more effectively:</p><ul><li><p>Setting up a MySQL account for using the <code>cookbook</code> database</p></li><li><p>Specifying connection parameters and using option files</p></li><li><p>Executing SQL statements interactively and in batch mode</p></li><li><p>Controlling <span class="command"><em>mysql</em></span> output
        format</p></li><li><p>Using user-defined variables to save information</p></li></ul><p>To try for yourself the examples shown in this book, you need a
    MySQL user account and a database. The first two recipes in this chapter
    describe how to use <span class="command"><em>mysql</em></span> to set those
    up, based on these assumptions:</p><ul><li><p>The MySQL server is running locally on your own system</p></li><li><p>Your MySQL username and password are <code>cbuser</code> and <code>cbpass</code></p></li><li><p>Your database is named <code>cookbook</code></p></li></ul><p>If you like, you can violate any of the assumptions. Your server
    need not be running locally, and you need not use the username, password,
    or database name that are used in this book. Naturally, in such cases, you
    must modify the examples accordingly.</p><p>Even if you choose not to use <code>cookbook</code> as your database name, we recommend that
    you use a database dedicated to the examples shown here, not one that you
    also use for other purposes. Otherwise, the names of existing tables may
    conflict with those used in the examples, and you’ll have to make
    modifications that would be unnecessary with a dedicated database.</p><p>Scripts that create the tables used in this chapter are located in
    the <em class="filename">tables</em> directory of the <code>recipes</code> distribution that accompanies
    <em>MySQL Cookbook</em>. Other scripts are located in the
    <em class="filename">mysql</em> directory. To get the <code>recipes</code> distribution, see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>.</p><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820416547504"><h5>Alternatives to the mysql Program</h5><p>The <span class="command"><em>mysql</em></span> client is not the only program you can use for executing queries.
      For example, you might prefer the graphical MySQL Workbench program, which provides a point-and-click
      interface to MySQL servers. Another popular interface is phpMyAdmin,
      which enables you to access MySQL through your web browser. <a data-type="xref" href="ch02.xhtml#nch-mysqlshell">Chapter 2</a> covers MySQL Shell: powerful command line client that supports SQL, JavaScript, and Python modes for running your queries using both SQL and NoSQL syntaxes. However, please note that if
      you execute queries other than by using <span class="command"><em>mysql</em></span>, some concepts covered in this chapter
      may not apply.</p></div></aside></div></section><section data-type="sect1" data-pdf-bookmark="1.1 Setting Up a MySQL User Account"><div class="sect1" id="nch-mysql-mysql-account"><h1>1.1 Setting Up a MySQL User Account</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820416539248"><h2>Problem</h2><p>You need an account for connecting to your MySQL server.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820416538272"><h2>Solution</h2><p>Use <code>CREATE</code> <code>USER</code> and <code>GRANT</code> statements to set up the account. Then use the account name and password
      to make connections to the server.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820416535856"><h2>Discussion</h2><p>Connecting to a MySQL server requires a username and password. You may also need to specify the name of the
      host on which the server is running. If you don’t specify connection
      parameters explicitly, <span class="command"><em>mysql</em></span> assumes
      default values. For example, given no explicit hostname, <span class="command"><em>mysql</em></span> assumes that the server is running on
      the local host.</p><p>If someone else has already set up an account for you and granted privileges, alloying to create and modify <code>cookbook</code> database, just use
      that account. Otherwise, the following example shows how to use the
      <span class="command"><em>mysql</em></span> program to connect to the
      server and issue the statements that set up a user account with
      privileges for accessing a database named <code>cookbook</code>. The arguments to <span class="command"><em>mysql</em></span> include <code class="option">-h</code>
      <code class="option">localhost</code> to connect to the MySQL server running on the local
      host, <code class="option">-u</code> <code class="option">root</code> to connect
      as the MySQL <code>root</code> user, and
      <code class="option">-p</code> to tell <span class="command"><em>mysql</em></span> to
      prompt for a password:</p><pre data-type="programlisting">$ <strong><code>mysql -h localhost -u root -p</code></strong>
Enter password: <strong><code>******</code></strong>
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 54117
Server version: 8.0.27 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; <strong><code>CREATE USER 'cbuser'@'localhost' IDENTIFIED BY 'cbpass';</code></strong>
mysql&gt; <strong><code>GRANT ALL ON cookbook.* TO 'cbuser'@'localhost';</code></strong>
Query OK, 0 rows affected (0.09 sec)
mysql&gt; <strong><code>GRANT PROCESS ON *.* to  `cbuser`@`localhost` ;</code></strong>
Query OK, 0 rows affected (0,01 sec)
mysql&gt; <strong><code>quit</code></strong>
Bye</pre><div data-type="tip"><h6>Tip</h6><p>
          <code>PROCESS</code> privilege is required if you need to generate a dump file of your MySQL data. See also <a data-type="xref" href="#nch-mysql-mysql-options">Recipe 1.4</a>
        </p></div><p>If when you attempt to invoke <span class="command"><em>mysql</em></span> the result is an error message that it cannot be found or is an invalid
      command, that means your command interpreter doesn’t know where <span class="command"><em>mysql</em></span> is installed. See <a data-type="xref" href="#nch-mysql-mysql-notfound">Recipe 1.3</a> for information about setting the
      <code>PATH</code> environment variable that the
      interpreter uses to find commands.</p><p>In the commands shown, the <code>$</code>
      represents the prompt displayed by your shell or command interpreter, and
      <code>mysql&gt;</code> is the prompt displayed by
      <span class="command"><em>mysql</em></span>. Text that you type is shown in
      bold. Nonbold text (including the prompts) is program output; don’t type
      any of that.</p><p>When <span class="command"><em>mysql</em></span> prints the password
      prompt, enter the MySQL <code>root</code> password
      where you see the <code>******</code>; if
      the MySQL <code>root</code> user has no password,
      just press the Enter (or Return) key at the password prompt. You will see MySQL welcome prompt that could be slightly different for the MySQL version you use. Then enter
      the <code>CREATE</code> <code>USER</code> and <code>GRANT</code> statements as shown.</p><p>The <code>quit</code> command terminates your <span class="command"><em>mysql</em></span>
      session. You can also terminate a session by using an <code>exit</code> command or (under Unix) by typing Ctrl-D.</p><p>To grant the <code>cbuser</code> account
      access to a database other than <code>cookbook</code>, substitute the database name where
      you see <code>cookbook</code> in the <code>GRANT</code> statement. To grant access for the
      <code>cookbook</code> database to an existing
      account, omit the <code>CREATE</code> <code>USER</code> statement and substitute that account for
      <code>'cbuser'@'localhost'</code> in the <code>GRANT</code> statement.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>
          MySQL user account record contains of two parts: username and the host. Username is an identified or the user who is accessing MySQL server. You can specify anything for this part. Hostname is IP address or name of the host from which this user will connect to MySQL server to. We discuss MySQL security model and user accounts in <a data-type="xref" href="ch24.xhtml#nch-security-security-intro">Recipe 24.0</a>.
        </p></div><p>The hostname part of <code>'cbuser'@'localhost'</code> indicates the host
      <em>from which</em> you’ll connect to the MySQL server. To
      set up an account that will connect to a server running on the local
      host, use <code>localhost</code>, as shown. If you
      plan to connect to the server from another host, substitute that host in
      the <code>CREATE</code> <code>USER</code> and <code>GRANT</code> statements. For example, if you’ll
      connect to the server from a host named <em class="filename">myhost.example.com</em>, the statements look like
      this:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE USER 'cbuser'@'myhost.example.com' IDENTIFIED BY 'cbpass';</code></strong>
mysql&gt; <strong><code>GRANT ALL ON cookbook.* TO 'cbuser'@'myhost.example.com';</code></strong></pre><p>It may have occurred to you that there’s a paradox in the
      procedure just described: to set up a <code>cbuser</code> account that can connect to the MySQL
      server, you must first connect to the server so that you can execute the
      <code>CREATE</code> <code>USER</code> and <code>GRANT</code> statements. I’m assuming that you can
      already connect as the MySQL <code>root</code>
      user because <code>CREATE</code> <code>USER</code> and <code>GRANT</code> can be used only by a user such as
      <code>root</code> that has the administrative
      privileges needed to set up other user accounts. If you can’t connect to
      the server as <code>root</code>, ask your MySQL
      administrator to create the <code>cbuser</code>
      account for you.</p><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820415140720"><h5>MySQL Accounts and Login Accounts</h5><p>MySQL accounts differ from login accounts for your operating system. For
        example, the MySQL <code>root</code> user and
        the Unix <code>root</code> user are separate and have nothing to do with each other, even
        though the username is the same in each case. This means you don’t create new
        MySQL accounts by creating login accounts for your operating system;
        use <code>CREATE</code> <code>USER</code> and <code>GRANT</code> instead.</p></div></aside><p>After creating the <code>cbuser</code>
      account, verify that you can use it to connect to the MySQL server. From
      the host that was named in the <code>CREATE</code>
      <code>USER</code> statement, run the following
      command to do this (the host named after <code class="option">-h</code> should be
      the host where the MySQL server is running):</p><pre data-type="programlisting">$ <strong><code>mysql -h localhost -u cbuser -p</code></strong>
Enter password: <strong><code>cbpass</code></strong></pre><p>Now you can proceed to create the <code>cookbook</code> database and tables within it, as
      described in <a data-type="xref" href="#nch-mysql-mysql-db">Recipe 1.2</a>. To make it easier to
      invoke <span class="command"><em>mysql</em></span> without specifying
      connection parameters each time, put them in an option file (see <a data-type="xref" href="#nch-mysql-mysql-options">Recipe 1.4</a>).</p></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820416535552"><h2>See Also</h2><p>For additional information about administering MySQL accounts,
      see <a data-type="xref" href="ch24.xhtml#nch-security">Chapter 24</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.2 Creating a Database and a Sample Table"><div class="sect1" id="nch-mysql-mysql-db"><h1>1.2 Creating a Database and a Sample Table</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820415121984"><h2>Problem</h2><p>You want to create a database and set up tables within it.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820415121008"><h2>Solution</h2><p>Use a <code>CREATE</code> <code>DATABASE</code> statement to create the database, a <code>CREATE</code> <code>TABLE</code> statement for each table, and <code>INSERT</code> statements to add rows to the
      tables.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820415120016"><h2>Discussion</h2><p>The <code>GRANT</code> statement shown in
      <a data-type="xref" href="#nch-mysql-mysql-account">Recipe 1.1</a> sets up privileges for
      accessing the <code>cookbook</code> database but
      does not create the database. This section shows how to do that, and
      also how to create a table and load it with the sample data used for
      examples in the following sections. Similar instructions apply for
      creating other tables used elsewhere in this book.</p><p>Connect to the MySQL server as shown at the end of <a data-type="xref" href="#nch-mysql-mysql-account">Recipe 1.1</a>, then create the database like
      this:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE DATABASE cookbook;</code></strong></pre><p>Now that you have a database, you can create tables in it. First,
      select <code>cookbook</code> as the default
      database:</p><pre data-type="programlisting">mysql&gt; <strong><code>USE cookbook;</code></strong></pre><p>Then create a simple table:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE limbs (thing VARCHAR(20), legs INT, arms INT, PRIMARY KEY(thing));</code></strong></pre><p>And populate it with a few rows:</p><pre data-type="programlisting">mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('human',2,2);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('insect',6,0);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('squid',0,10);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('fish',0,0);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('centipede',99,0);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('table',4,0);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('armchair',4,2);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('phonograph',0,1);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('tripod',3,0);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('Peg Leg Pete',1,2);</code></strong>
mysql&gt; <strong><code>INSERT INTO limbs (thing,legs,arms) VALUES('space alien',NULL,NULL);</code></strong></pre><div data-type="tip"><h6>Tip</h6><p>For entering the <code>INSERT</code> statements more easily: after entering the first one, press the up arrow
          to recall it, press Backspace (or Delete) a few times to erase
          characters back to the last open parenthesis, then type the data values
          for the next statement. Or, to avoid typing the <code>INSERT</code> 
          statements altogether, skip ahead to <a data-type="xref" href="#nch-mysql-mysql-batch">Recipe 1.6</a>.
        </p></div><p>The table you just created is named <code>limbs</code> and contains three columns to record the
      number of legs and arms possessed by various life forms and objects. The
      physiology of the alien in the last row is such that the proper values
      for the <code>arms</code> and <code>legs</code> columns cannot be determined; <code>NULL</code>
      indicates <q>unknown value.</q></p><p>
        The <code>PRIMARY KEY</code> clause defines primary key that uniquely identifies table row. This prevents inserting ambigious data into the table and also helps MySQL to perform queriesfaster. We discuss ambigious data in <a data-type="xref" href="ch18.xhtml#nch-dups">Chapter 18</a> and performance issues in <a data-type="xref" href="ch21.xhtml#nch-queryperf">Chapter 21</a>.
      </p><p>Verify that the rows were added to the <code>limbs</code> table by executing a <code>SELECT</code> statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM limbs;</code></strong>
+--------------+------+------+
| thing        | legs | arms |
+--------------+------+------+
| human        |    2 |    2 |
| insect       |    6 |    0 |
| squid        |    0 |   10 |
| fish         |    0 |    0 |
| centipede    |   99 |    0 |
| table        |    4 |    0 |
| armchair     |    4 |    2 |
| phonograph   |    0 |    1 |
| tripod       |    3 |    0 |
| Peg Leg Pete |    1 |    2 |
| space alien  | NULL | NULL |
+--------------+------+------+
11 rows in set (0,01 sec)</pre><p>At this point, you’re all set up with a database and a table. For
      additional information about executing SQL statements, see <a data-type="xref" href="#nch-mysql-mysql-interactive">Recipe 1.5</a> and
      <a data-type="xref" href="#nch-mysql-mysql-batch">Recipe 1.6</a>.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>In this book, statements show SQL keywords such as <code>SELECT</code> or <code>INSERT</code> in uppercase for distinctiveness.
        That’s only a typographical convention; keywords can be any
        lettercase.</p></div></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.3 Finding mysql Client"><div class="sect1" id="nch-mysql-mysql-notfound"><h1>1.3 Finding mysql Client</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820415087664"><h2>Problem</h2><p>When you invoke <span class="command"><em>mysql</em></span> client from the
      command line, your command interpreter can’t find
      it.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820415085808"><h2>Solution</h2><p>Add the directory where <span class="command"><em>mysql</em></span>
      is installed to your <code>PATH</code> setting. Then
      you can run <span class="command"><em>mysql</em></span> from any directory
      easily.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820415082672"><h2>Discussion</h2><p>If your shell or command interpreter can’t find <span class="command"><em>mysql</em></span> when you invoke it, you’ll see some sort
      of error message. It might look like this under Unix:</p><pre data-type="programlisting">$ <strong><code>mysql</code></strong>
mysql: Command not found.</pre><p>Or like this under Windows:</p><pre data-type="programlisting">C:\&gt; <strong><code>mysql.exe</code></strong>
'mysql.exe' is not recognized as an internal or external command,↩
operable program or batch file.</pre><p>One way to tell your command interpreter where to find <span class="command"><em>mysql</em></span> is to type its full pathname each time
      you run it. The command might look like this under Unix:</p><pre data-type="programlisting">$ <strong><code>/usr/local/mysql/bin/mysql</code></strong></pre><p>Or like this under Windows:</p><pre data-type="programlisting">C:\&gt; <strong><code>"C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql"</code></strong></pre><p>Typing long pathnames gets tiresome pretty quickly. You can avoid
      doing so by changing location into the directory where <span class="command"><em>mysql</em></span> is installed before you run it. But if
      you do that, you may be tempted to put all your datafiles and SQL batch
      files in the same directory as <span class="command"><em>mysql</em></span>,
      thus unnecessarily cluttering up a location intended only for
      programs.</p><p>A better solution is to modify your <code>PATH</code> search-path environment variable, which
      specifies directories where the command interpreter looks for commands.
      Add to the <code>PATH</code> value the directory
      where <span class="command"><em>mysql</em></span> is installed. Then you
      can invoke <span class="command"><em>mysql</em></span> from any location by
      entering only its name, which eliminates pathname typing. For
      instructions on setting your <code>PATH</code>
      variable, read <q>Executing Programs from the Command Line</q>
      on the companion website (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>).</p><p>On Windows, another way to avoid typing the pathname or changing
      into the <span class="command"><em>mysql</em></span> directory is to create
      a shortcut and place it in a more convenient location such as the
      desktop. This makes it easy to start <span class="command"><em>mysql</em></span> simply by opening the shortcut. To
      specify command options or the startup directory, edit the shortcut’s
      properties. If you don’t always invoke <span class="command"><em>mysql</em></span> with the same options, it might be
      useful to create one shortcut for each set of options you need. For
      example, create one shortcut to connect as an ordinary user for general
      work and another to connect as the MySQL <code>root</code> user for administrative purposes.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.4 Specifying mysql Command Options"><div class="sect1" id="nch-mysql-mysql-options"><h1>1.4 Specifying mysql Command Options</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820414738112"><h2>Problem</h2><p>When you invoke the <span class="command"><em>mysql</em></span>
      program without command options, it exits immediately with an
      error message.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820414736144"><h2>Solution</h2><p>You must specify connection parameters. Do this on the command
      line, in an option file, or using a mix of the two.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820414735088"><h2>Discussion</h2><p>If you invoke <span class="command"><em>mysql</em></span> with no
      command options, the result may be an <q>access
      denied</q> error. To avoid that, connect to the MySQL server as
      shown in <a data-type="xref" href="#nch-mysql-mysql-account">Recipe 1.1</a>, using <span class="command"><em>mysql</em></span> like this:</p><pre data-type="programlisting">$ <strong><code>mysql -h localhost -u cbuser -p</code></strong>
Enter password: <strong><code>cbpass</code></strong></pre><p>Each option is the single-dash <q>short</q> form: <code class="option">-h</code> and <code class="option">-u</code> to
      specify the hostname and username, and <code class="option">-p</code> to be
      prompted for the password. There are also corresponding double-dash
      <q>long</q> forms: <code class="option">--host</code>,
      <code class="option">--user</code>, and <code class="option">--password</code>. Use them like
      this:</p><pre data-type="programlisting">$ <strong><code>mysql --host=localhost --user=cbuser --password</code></strong>
Enter password: <strong><code>cbpass</code></strong></pre><p>To see all options that <span class="command"><em>mysql</em></span>
      supports, use this command:</p><pre data-type="programlisting">$ <strong><code>mysql --help</code></strong></pre><p>The way you specify command options for <span class="command"><em>mysql</em></span> also applies to other MySQL programs
      such as <span class="command"><em>mysqldump</em></span> and <span class="command"><em>mysqladmin</em></span>. For example, to generate
      a dump file named <em class="filename">cookbook.sql</em> that contains a backup of the
      tables in the <code>cookbook</code> database,
      execute <span class="command"><em>mysqldump</em></span> like this:</p><pre data-type="programlisting">$ <strong><code>mysqldump -h localhost -u cbuser -p cookbook &gt; cookbook.sql</code></strong>
Enter password: <strong><code>cbpass</code></strong></pre><p>Some operations require an administrative MySQL account. The
      <span class="command"><em>mysqladmin</em></span> program can perform
      operations that are available only to the MySQL <code>root</code> account. For example, to stop the server,
      invoke <span class="command"><em>mysqladmin</em></span> as follows:</p><pre data-type="programlisting">$ <strong><code>mysqladmin -h localhost -u root -p shutdown</code></strong>
Enter password:        <code class="lineannotation">← enter MySQL root account password here</code></pre><p>If the value that you use for an option is the same as its default
      value, you can omit the option. However, there is no default password.
      If you like, you can specify the password directly on the command line
      by using <code class="option">-p</code><em><code>password</code></em> (with
      <em>no space</em> between the option and the password) or
      <code class="option">--password</code><code>=</code><em><code>password</code></em>. 
      </p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          We don’t recommend this because the password is visible to onlookers and, on
          multiple-user systems, may be discoverable to other users who run tools
          such as <span class="command"><em>ps</em></span> that report process
          information or can read content of your shell history file.
        </p></div><p>Because the default host is <code>localhost</code>, the same value we’ve been
      specifying explicitly, you can omit the <code class="option">-h</code> (or
      <code class="option">--host</code>) option from the command line:</p><pre data-type="programlisting">$ <strong><code>mysql -u cbuser -p</code></strong></pre><p>But suppose that you’d really rather not specify
      <em>any</em> options. How can you get <span class="command"><em>mysql</em></span> to <q>just know</q> what values
      to use? That’s easy because MySQL programs support option files:</p><ul><li><p>If you put an option in an option file, you need not specify
          it on the command line each time you invoke a given program.</p></li><li><p>You can mix command-line and option-file options. This enables
          you to store the most commonly used option values in a file but
          override them as desired on the command line.</p></li></ul><p>The rest of this section describes these capabilities.</p><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820414697488"><h5>The Meaning of localhost in MySQL</h5><p>One of the parameters you specify when connecting to a MySQL server is the host where the
        server is running. Most programs treat the hostname <em class="filename">localhost</em> and the IP address <code>127.0.0.1</code> as synonyms for <q>the local
        host.</q> Under Unix, MySQL programs behave differently: by convention, they
        treat the hostname <em class="filename">localhost</em>
        specially and attempt to connect to the local server using a Unix
        domain socket file. To force a TCP/IP connection to the local server,
        use the IP address <code>127.0.0.1</code> (or
        <code>::1</code> if your system is configured to
        support IPv6) rather than the hostname <em class="filename">localhost</em>. Alternatively, you can specify a
        <code class="option">--protocol=tcp</code> option to force use of TCP/IP for connecting.</p><p>The default port number is 3306 for TCP/IP connections. The pathname for
        the Unix domain socket varies, although it’s often <em class="filename">/tmp/mysql.sock</em>. To name the socket file
        pathname explicitly for the <span class="command"><em>mysql</em></span> client in the connection string, use <code class="option">-S</code>
        <em><code>file_name</code></em> or
        <code class="option">--socket=</code><em><code>file_name</code></em>.</p></div></aside><section data-type="sect3" data-pdf-bookmark="Specifying connection parameters using option files"><div class="sect3" id="idm45820414691056"><h3>Specifying connection parameters using option files</h3><p>To avoid entering options on the command line each time you invoke
        <span class="command"><em>mysql</em></span>, put them in an option file
        for <span class="command"><em>mysql</em></span> to read automatically.
        Option files are plain-text files:</p><ul><li><p>Under Unix, your personal option file is named <em class="filename">.my.cnf</em>
            in your home directory. There are also site-wide option files that
            administrators can use to specify parameters that apply globally
            to all users. You can use the <em class="filename">my.cnf</em> file in the <em class="filename">/etc</em> or <em class="filename">/etc/mysql</em> directory, or in the
            <em class="filename">etc</em> directory under the MySQL
            installation directory.</p></li><li><p>Under Windows, files you can use include the <em class="filename">my.ini</em> or <em class="filename">my.cnf</em> file in your MySQL installation
            directory (for example, <em class="filename">C:\Program
            Files\MySQL\MySQL Server 8.0</em>), your Windows directory
            (likely <em class="filename">C:\WINDOWS</em>), or the
            <em class="filename">C:\</em> directory.</p></li></ul><p>To see the exact list of permitted option-file locations, invoke
        <span class="command"><em>mysql</em></span>
        <code class="option">--help</code>.</p><p>The following example illustrates the format used in MySQL
        option files:</p><pre data-type="programlisting"># general client program connection options
[client]
host     = localhost
user     = cbuser
password = cbpass

# options specific to the mysql program
[mysql]
skip-auto-rehash
pager="/usr/bin/less -i" # specify pager for interactive mode</pre><p>With connection parameters listed in the <code>[client]</code> group as just shown, you can
        connect as <code>cbuser</code> by invoking
        <span class="command"><em>mysql</em></span> with no options on the
        command line:</p><pre data-type="programlisting">$ <strong><code>mysql</code></strong></pre><p>The same holds for other MySQL client programs, such as <span class="command"><em>mysqldump</em></span>.</p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>The option <code class="option">password</code> is stored in the configuraiton
          file in plain text format and any user, who has access to this file,
          can read it. If you want to secure the connection credentials you
          should use <span class="command"><em>mysql_config_editor</em></span> to
          store them securely.</p><p><span class="command"><em>mysql_config_editor</em></span> stores
          connection credentials in a file, named <em class="filename">.mylogin.cnf</em>, located in your home
          directory under Unix and in the <em class="filename">%APPDATA%\MySQL</em> directory under Windows.
          It only supports connection parameters <code class="option">host</code>,
          <code class="option">user</code>, <code class="option">password</code> and
          <code class="option">socket</code>. Option <code class="option">--login-path</code>
          specifies a group under which credentials are stored. Default is
          <code class="option">[client]</code></p><p>Here is an example on how to use <span class="command"><em>mysql_config_editor</em></span> to create encrypted
          login file.</p><pre data-type="programlisting">$ <strong><code>mysql_config_editor set --login-path=client \</code></strong>
&gt; <strong><code>--host=localhost --user=cbuser --password</code></strong>
Enter password: <strong><code>cbpass</code></strong>

# print stored credentials
$ <strong><code>mysql_config_editor print --all</code></strong>
[client]
user = cbuser
password = *****
host = localhost</pre></div><p>MySQL option files have these characteristics:</p><ul><li><p>Lines are written in groups (or sections). The first line of
            a group specifies the group name within square brackets, and the
            remaining lines specify options associated with the group. The
            example file just shown has a <code>[client]</code> group and a <code>[mysql]</code> group. To specify options for
            the server, <span class="command"><em>mysqld</em></span>, put them in
            a <code>[mysqld]</code> group.</p></li><li><p>The usual option group for specifying client connection
            parameters is <code>[client]</code>. This
            group actually is used by all the standard MySQL clients. By
            listing an option in this group, you make it easier to invoke not
            only <span class="command"><em>mysql</em></span>, but also other
            programs such as <span class="command"><em>mysqldump</em></span>
            and <span class="command"><em>mysqladmin</em></span>. Just make sure
            that any option you put in this group is understood by
            <em>all</em> client programs. Otherwise, invoking any
            client that does not understand it results in an <q>unknown
            option</q> error.</p></li><li><p>You can define multiple groups in an option file. By
            convention, MySQL clients look for parameters in the <code>[client]</code> group and in the group named
            for the program itself. This provides a convenient way to list
            general client parameters that you want all client programs to
            use, but you can still specify options that apply only to a
            particular program. The preceding sample option file illustrates
            this convention for the <span class="command"><em>mysql</em></span>
            program, which gets general connection parameters from the
            <code>[client]</code> group and also picks
            up the <code>skip-auto-rehash</code> and <code>pager</code> options from the <code>[mysql]</code> group.</p></li><li><p>Within a group, write option lines in
            <em><code>name=value</code></em> format, where
            <em><code>name</code></em> corresponds to an option name
            (without leading dashes) and <em><code>value</code></em> is
            the option’s value. If an option takes no value (such as <code>skip-auto-rehash</code>), list the name by
            itself with no trailing <em><code>=value</code></em>
            part.</p></li><li><p>In option files, only the long form of an option is
            permitted, not the short form. For example, on the command line,
            the hostname can be given using either <code class="option">-h</code>
            <em><code>host_name</code></em> or
            <code class="option">--host</code><code>=</code><em><code>host_name</code></em>.
            In an option file, only <code>host=</code><em><code>host_name</code></em>
            is permitted.</p></li><li><p>Many programs, <span class="command"><em>mysql</em></span> and
            <span class="command"><em>mysqld</em></span> included, have program
            variables in addition to command options. (For the server, these
            are called <em>system variables</em>; see <a data-type="xref" href="ch22.xhtml#nch-admin-server-config">Recipe 22.1</a>.) Program variables can be
            specified in option files, just like options. Internally, program
            variable names use underscores, but in option files, you can write
            options and variables using dashes or underscores interchangeably.
            For example, <code class="option">skip-auto-rehash</code> and
            <code class="option">skip_auto_rehash</code> are equivalent. To set
            the server’s <code>sql_mode</code> system variable in a <code>[mysqld]</code> option group,
            <code class="option">sql_mode=</code><em><code>value</code></em> and
            <code class="option">sql-mode=</code><em><code>value</code></em> are
            equivalent. (Interchangeability of dash and underscore also
            applies for options or variables specified on the command
            line.)</p></li><li><p>In option files, spaces are permitted around the <code>=</code> that separates an option name and
            value. This contrasts with command lines, where no spaces around
            <code>=</code> are permitted.
            If an option value contains spaces or other special
            characters, you can quote it using single or double quotes. The
            <code>pager</code> option illustrates
            this.</p></li><li><p>It’s common to use an option file to specify options for
            connection parameters (such as <code>host</code>, <code>user</code>, and <code>password</code>). However, the file can list
            options that have other purposes. The <code>pager</code> option shown for the <code>[mysql]</code> group specifies the paging
            program that <span class="command"><em>mysql</em></span> should use
            for displaying output in interactive mode. It has nothing to do
            with how the program connects to the server. We do not recommend to put <code>password</code> into the option file, because it is stored as plain text and could be discovered by users who have filesystem access to the configuration file while not necessary has access to the MySQL installation.</p></li><li><p>If a parameter appears multiple times in an option file, the
            last value found takes precedence. Normally, you should list any
            program-specific groups following the <code>[client]</code> group so that if there is any
            overlap in the options set by the two groups, the more general
            options are overridden by the program-specific values.</p></li><li><p>Lines beginning with <code>#</code> or
            <code>;</code> characters are ignored as comments. Blank lines are ignored, too.
            <code>#</code> can be used to write comments
            at the end of option lines, as shown for the <code>pager</code> option.</p></li><li><p>Options that specify file or directory pathnames should be
            written using <code>/</code> as the
            pathname separator character, even under Windows, which uses <code>\</code> as the pathname separator.
            Alternatively, write <code>\</code> by
            doubling it as <code>\\</code> (this is
            necessary because <code>\</code> is the
            MySQL escape character in strings).</p></li></ul><p>To find out which options the <span class="command"><em>mysql</em></span> program will read from option files,
        use this command:</p><pre data-type="programlisting">$ <strong><code>mysql --print-defaults</code></strong></pre><p>You can also use the <span class="command"><em>my_print_defaults</em></span> utility, which takes as arguments the names of the option-file
        groups that it should read. For example, <span class="command"><em>mysqldump</em></span> looks in both the <code>[client]</code> and <code>[mysqldump]</code> groups for options. To check
        which option-file settings are in those groups, use this
        command:</p><pre data-type="programlisting">$ <strong><code>my_print_defaults client mysqldump</code></strong></pre></div></section><section data-type="sect3" data-pdf-bookmark="Mixing command-line and option-file parameters"><div class="sect3" id="idm45820414686624"><h3>Mixing command-line and option-file parameters</h3><p>It’s possible to mix command-line options and options in option
        files. Perhaps you want to list your username and server host in an
        option file, but would rather not store your password there. That’s
        okay; MySQL programs first read your option file to see what
        connection parameters are listed there, then check the command line
        for additional parameters. This means you can specify some options one
        way, and some the other way. For example, you can list your username
        and hostname in an option file, but use a password option on the
        command line:</p><pre data-type="programlisting">$ <strong><code>mysql -p</code></strong>
Enter password:        <code class="lineannotation">← enter your password here</code></pre><p>Command-line parameters take precedence over parameters found in
        your option file, so to override an option file parameter, just
        specify it on the command line. For example, you can list your regular
        MySQL username and password in the option-file for general-purpose
        use. Then, if you must connect on occasion as the MySQL <code>root</code> user, specify the user and password
        options on the command line to override the option-file values:</p><pre data-type="programlisting">$ <strong><code>mysql -u root -p</code></strong>
Enter password:        <code class="lineannotation">← enter MySQL root account password here</code></pre><p>To explicitly specify <q>no password</q> when there is a
        nonempty password in the option file, use
        <code class="option">--skip-password</code> on the command line:</p><pre data-type="programlisting">$ <strong><code>mysql --skip-password</code></strong></pre><div data-type="note" epub:type="note"><h6>Note</h6><p>From this point on, I’ll usually show commands for MySQL
          programs with no connection-parameter options. I assume that you’ll
          supply any parameters that you need, either on the command line or
          in an option file.</p></div></div></section><section data-type="sect3" data-pdf-bookmark="Protecting option files from other users"><div class="sect3" id="idm45820413223104"><h3>Protecting option files from other users</h3><p>On a multiple-user operating system such as Unix, protect the option file located in your home directory
        to prevent other users from reading it and finding out how to connect
        to MySQL using your account. Use <span class="command"><em>chmod</em></span> to
        make the file private by setting its mode to enable access only by
        yourself. Either of the following commands do this:</p><pre data-type="programlisting">$ <strong><code>chmod 600 .my.cnf</code></strong>
$ <strong><code>chmod go-rwx .my.cnf</code></strong></pre><p>On Windows, you can use Windows Explorer to set file permissions.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.5 Executing SQL Statements Interactively"><div class="sect1" id="nch-mysql-mysql-interactive"><h1>1.5 Executing SQL Statements Interactively</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820413218480"><h2>Problem</h2><p>You’ve started <span class="command"><em>mysql</em></span>. Now you
      want to send SQL statements to the MySQL server to be
      executed.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820413216688"><h2>Solution</h2><p>Just type them in, letting <span class="command"><em>mysql</em></span> know where each one ends. Alternatively, specify
      <q>one-liners</q> directly on the command line.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820413214352"><h2>Discussion</h2><p>When you invoke <span class="command"><em>mysql</em></span>, by default, it
      displays a <code>mysql&gt;</code> prompt to tell
      you that it’s ready for input. To execute an SQL statement at the
      <code>mysql&gt;</code> prompt, type it in, add a
      semicolon (<code>;</code>) at the end to signify
      the end of the statement, and press Enter. An explicit statement
      terminator is necessary; <span class="command"><em>mysql</em></span>
      doesn’t interpret Enter as a terminator because you can enter a
      statement using multiple input lines. The semicolon is the most common terminator, but you can
      also use <code>\g</code>
      (<q>go</q>) as a synonym for the semicolon. Thus, the following
      examples are equivalent ways of issuing the same statement, even though
      they are entered differently and terminated differently:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT NOW();</code></strong>
+---------------------+
| NOW()               |
+---------------------+
| 2014-04-06 17:43:52 |
+---------------------+
mysql&gt; <strong><code>SELECT</code></strong>
    -&gt; <strong><code>NOW()\g</code></strong>
+---------------------+
| NOW()               |
+---------------------+
| 2014-04-06 17:43:57 |
+---------------------+</pre><p>For the second statement, <span class="command"><em>mysql</em></span>
      changes the prompt from <code>mysql&gt;</code> to
      <code>-&gt;</code> to let you know that it’s still
      waiting to see the statement terminator.</p><p>The <code>;</code> and <code>\g</code> statement terminators are not part of the
      statement itself. They’re conventions used by the <span class="command"><em>mysql</em></span> program, which recognizes these
      terminators and strips them from the input before sending the statement
      to the MySQL server.</p><p>Some statements generate output lines that are so long they take
      up more than one line on your terminal, which can make query results
      difficult to read. To avoid this problem, generate
      <q>vertical</q> output by terminating the statement with
      <code>\G</code> rather than with <code>;</code> or <code>\g</code>.
      The output shows column values on separate lines:</p><pre data-type="programlisting">mysql&gt;  <strong><code>USE cookbook</code></strong>
mysql&gt; <strong><code>SHOW FULL COLUMNS FROM limbs LIKE 'thing'\G</code></strong>
*************************** 1. row ***************************
     Field: thing
      Type: varchar(20)
 Collation: utf8mb4_0900_ai_ci
      Null: YES
       Key:
   Default: NULL
     Extra:
Privileges: select,insert,update,references
   Comment:</pre><p>To produce vertical output for all statements executed within a session, invoke <span class="command"><em>mysql</em></span> with the <code class="option">-E</code> (or
      <code class="option">--vertical</code>) option. To produce vertical output only for
      those results that exceed your terminal width, use <code class="option">--auto-vertical-output</code>.</p><p>To execute a statement directly from the command line, specify it
      using the <code class="option">-e</code> (or <code class="option">--execute</code>)
      option. This is useful for <q>one-liners.</q> For example, to
      count the rows in the <code>limbs</code> table,
      use this command:</p><pre data-type="programlisting">$ <strong><code>mysql -e "SELECT COUNT(*) FROM limbs" cookbook</code></strong>
+----------+
| COUNT(*) |
+----------+
|       11 |
+----------+</pre><p>To execute multiple statements, separate them with
      semicolons:</p><pre data-type="programlisting">$ <strong><code>mysql -e "SELECT COUNT(*) FROM limbs;SELECT NOW()" cookbook</code></strong>
+----------+
| COUNT(*) |
+----------+
|       11 |
+----------+
+---------------------+
| NOW()               |
+---------------------+
| 2014-04-06 17:43:57 |
+---------------------+</pre><p><span class="command"><em>mysql</em></span> can also read statements
      from a file or from another program (see <a data-type="xref" href="#nch-mysql-mysql-batch">Recipe 1.6</a>).</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.6 Executing SQL Statements Read from a File or Program"><div class="sect1" id="nch-mysql-mysql-batch"><h1>1.6 Executing SQL Statements Read from a File or Program</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820415796960"><h2>Problem</h2><p>You want <span class="command"><em>mysql</em></span> to read
      statements stored in a file so that you need not enter them manually. Or you want
      <span class="command"><em>mysql</em></span> to read the output from another
      program.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820415793920"><h2>Solution</h2><p>To read a file, redirect <span class="command"><em>mysql</em></span>’s input, or use the <code>source</code> command.
      To read from a program, use a pipe.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820415791680"><h2>Discussion</h2><p>By default, the <span class="command"><em>mysql</em></span> program
      reads input interactively from the terminal, but you can feed it
      statements using other input sources such as a file or program.</p><p>For this purpose MySQL supports batch mode that is convenient for executing a set of statements on
      repeated occasions without entering them manually each time. Batch mode
      makes it easy to set up <span class="command"><em>cron</em></span> jobs
      that run with no user intervention.</p><p>To create an SQL script for <span class="command"><em>mysql</em></span> to execute in batch mode, put your
      statements in a text file. Then invoke <span class="command"><em>mysql</em></span> and redirect its input to read from that
      file:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>file_name</code></em></pre><p>Statements read from an input file substitute for what you’d
      normally enter interactively by hand, so they must be terminated with
      <code>;</code>, <code>\g</code>, or <code>\G</code>,
      just as if you were entering them manually. Interactive and batch modes
      do differ in default output format. For interactive mode, the default is
      tabular (boxed) format. For batch mode, the default is tab-delimited
      format. To override the default, use the appropriate command option (see
      <a data-type="xref" href="#nch-mysql-mysql-output">Recipe 1.7</a>).</p><p>SQL scripts also are useful for
      distributing sets of SQL statements to other people. That is, in fact, how we
      distribute SQL examples for this book. Many of the examples shown here
      can be run using script files available in the accompanying <code>recipes</code> distribution (see the <a data-type="link" href="preface01.xhtml#nch-preface">Preface</a>). Feed these files to <span class="command"><em>mysql</em></span> in batch mode to avoid typing statements
      yourself. For example, when a recipe shows a <code>CREATE</code> <code>TABLE</code> statement that defines a table, you’ll
      usually find an SQL batch file in the <code>recipes</code> distribution that you can use to
      create (and perhaps load data into) the table. Recall that <a data-type="xref" href="#nch-mysql-mysql-db">Recipe 1.2</a> shows the statements for creating and
      populating the <code>limbs</code> table. Those
      statements were shown as you would enter them manually, but the
      <em class="filename">tables</em> directory of the <code>recipes</code> distribution includes a <em class="filename">limbs.sql</em> file that contains statements to do
      the same thing. The file looks like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">DROP</code> <code class="k">TABLE</code> <code class="n">IF</code> <code class="k">EXISTS</code> <code class="n">limbs</code><code class="p">;</code>
<code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">limbs</code>
<code class="p">(</code>
  <code class="n">thing</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">20</code><code class="p">),</code>  <code class="o">#</code> <code class="n">what</code> <code class="n">the</code> <code class="n">thing</code> <code class="k">is</code>
  <code class="n">legs</code>  <code class="nb">INT</code><code class="p">,</code>          <code class="o">#</code> <code class="nb">number</code> <code class="k">of</code> <code class="n">legs</code> <code class="n">it</code> <code class="n">has</code>
  <code class="n">arms</code>  <code class="nb">INT</code><code class="p">,</code>          <code class="o">#</code> <code class="nb">number</code> <code class="k">of</code> <code class="n">arms</code> <code class="n">it</code> <code class="n">has</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code><code class="p">(</code><code class="n">thing</code><code class="p">)</code>
<code class="p">);</code>

<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'human'</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">2</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'insect'</code><code class="p">,</code><code class="mi">6</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'squid'</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">10</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'fish'</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'centipede'</code><code class="p">,</code><code class="mi">99</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'table'</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'armchair'</code><code class="p">,</code><code class="mi">4</code><code class="p">,</code><code class="mi">2</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'phonograph'</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">1</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'tripod'</code><code class="p">,</code><code class="mi">3</code><code class="p">,</code><code class="mi">0</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'Peg Leg Pete'</code><code class="p">,</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">);</code>
<code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">limbs</code> <code class="p">(</code><code class="n">thing</code><code class="p">,</code><code class="n">legs</code><code class="p">,</code><code class="n">arms</code><code class="p">)</code> <code class="k">VALUES</code><code class="p">(</code><code class="s1">'space alien'</code><code class="p">,</code><code class="k">NULL</code><code class="p">,</code><code class="k">NULL</code><code class="p">);</code></pre><p>To execute the statements in this SQL script file, change location
      into the <em class="filename">tables</em> directory of the
      <code>recipes</code> distribution and run this
      command:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt; limbs.sql</code></strong></pre><p>You’ll note that the script contains a statement to drop the table
      if it exists before creating the table anew and loading it with data.
      That enables you to experiment with the table, perhaps making changes to
      it, confident that you can easily restore it to its baseline state any
      time by running the script again.</p><p>The command just shown illustrates how to specify an input file
      for <span class="command"><em>mysql</em></span> on the command line.
      Alternatively, to read a file of SQL statements from within a <span class="command"><em>mysql</em></span> session, use a <code>source</code> <em><code>filename</code></em>
      command (or <code>\.</code>
      <em><code>filename</code></em>, which is synonymous):</p><pre data-type="programlisting">mysql&gt; <strong><code>source limbs.sql</code></strong>
mysql&gt; <strong><code>\. limbs.sql</code></strong></pre><p>SQL scripts can themselves include <code>source</code> or <code>\.</code> commands to include other scripts. This
      gives you additional flexibility, but take care to avoid loops.</p><p>A file to be read by <span class="command"><em>mysql</em></span> need
      not be written by hand; it could be program generated. For example, the
      <span class="command"><em>mysqldump</em></span> utility generates database
      backups by writing a set of SQL statements that re-create the database.
      To reload <span class="command"><em>mysqldump</em></span> output, feed it
      to <span class="command"><em>mysql</em></span>. For example, you can copy a
      database over the network to another MySQL server like this:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook &gt; dump.sql</code></strong>
$ <strong><code>mysql -h other-host.example.com cookbook &lt; dump.sql</code></strong></pre><p><span class="command"><em>mysql</em></span> can also read a pipe, so
      it can take output from other programs as its input.
      <em>Any</em> command that produces output consisting of
      properly terminated SQL statements can be used as an input source for
      <span class="command"><em>mysql</em></span>. The dump-and-reload example
      can be rewritten to connect the two programs directly with a pipe,
      avoiding the need for an intermediary file:</p><pre data-type="programlisting">$ <strong><code>mysqldump cookbook | mysql -h other-host.example.com cookbook</code></strong></pre><p>Program-generated SQL also can be useful for populating a table
      with test data without writing the <code>INSERT</code> statements by hand. Create a program
      that generates the statements, then send its output to <span class="command"><em>mysql</em></span> using a pipe:</p><pre data-type="programlisting">$ <strong><code>generate-test-data | mysql cookbook</code></strong></pre><p><a data-type="xref" href="ch06.xhtml#nch-tblmgmt-tblmgmt-copy-mysqldump">Recipe 6.6</a> discusses
      <span class="command"><em>mysqldump</em></span> further.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.7 Controlling mysql Output Destination and Format"><div class="sect1" id="nch-mysql-mysql-output"><h1>1.7 Controlling mysql Output Destination and Format</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820414642608"><h2>Problem</h2><p>You want <span class="command"><em>mysql</em></span> output to
      go somewhere other than your screen. And you don’t
      necessarily want the default output format.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820414640624"><h2>Solution</h2><p>Redirect the output to a file, or use a pipe to send the output to
      a program. You can also control other aspects of <span class="command"><em>mysql</em></span> output to produce tabular,
      tab-delimited, HTML, or XML output; suppress column headers; or make
      <span class="command"><em>mysql</em></span> more or less verbose.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820414637776"><h2>Discussion</h2><p>Unless you send <span class="command"><em>mysql</em></span> output
      elsewhere, it goes to your screen. To save output from <span class="command"><em>mysql</em></span> in a file, use your shell’s redirection
      capability:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &gt;</code></strong> <em><code>outputfile</code></em></pre><p>If you run <span class="command"><em>mysql</em></span> interactively
      with the output redirected, you can’t see what you type, so in this case
      you usually also read the input from a file (or another program):</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code>&gt;</code></strong> <em><code>outputfile</code></em></pre><p>To send the output to another program (for example, parse the
      output of the query, use a pipe:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code>| sed -e "s/\t/:/g" &gt; outputfile</code></strong></pre><p>The rest of this section shows how to control <span class="command"><em>mysql</em></span> output format.</p><section data-type="sect3" data-pdf-bookmark="Producing tabular or tab-delimited output"><div class="sect3" id="idm45820414625824"><h3>Producing tabular or tab-delimited output</h3><p><span class="command"><em>mysql</em></span> chooses its default
        output format by whether it runs interactively or
        noninteractively. For interactive use, <span class="command"><em>mysql</em></span> writes
        output to the terminal using tabular (boxed) format:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook</code></strong>
mysql&gt; <strong><code>SELECT * FROM limbs WHERE legs=0;</code></strong>
+------------+------+------+
| thing      | legs | arms |
+------------+------+------+
| squid      |    0 |   10 |
| fish       |    0 |    0 |
| phonograph |    0 |    1 |
+------------+------+------+
3 rows in set (0.00 sec)</pre><p>For noninteractive use (when the input or output is redirected), <span class="command"><em>mysql</em></span> writes tab-delimited output:</p><pre data-type="programlisting">$ <strong><code>echo "SELECT * FROM limbs WHERE legs=0" | mysql cookbook</code></strong>
thing   legs    arms
squid   0       10
fish    0       0
phonograph      0       1</pre><p>To override the default output format, use the appropriate
        command option. Consider a <span class="command"><em>sed</em></span> command shown earlier and change its parameters to
        obfuscate the output:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code>| sed -e "s/table/XXXXX/g" </code></strong></pre><pre data-type="programlisting">$ <strong><code>mysql cookbook -e "SELECT * FROM limbs where legs=4" |</code></strong> ↩
        <strong><code>sed -e "s/table/XXXXX/g"</code></strong>
 thing legs arms 
 XXXXX 4 0 
 armchair 4 2</pre><p>Because <span class="command"><em>mysql</em></span> runs
        noninteractively in that context, it produces tab-delimited output,
        which could be difficult to read than tabular output. Use the <code class="option">-t</code> (or
        <code class="option">--table</code>) option to produce more readable tabular
        output:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook -t -e "SELECT * FROM limbs where legs=4" |</code></strong> ↩
        <strong><code>sed -e "s/table/XXXXX/g"</code></strong>

+----------+------+------+
| thing    | legs | arms |
+----------+------+------+
| XXXXX    |    4 |    0 |
| armchair |    4 |    2 |
+----------+------+------+</pre><p>The inverse operation is to produce batch (tab-delimited) output
        in interactive mode. To do this, use <code class="option">-B</code> or
        <code class="option">--batch</code>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Producing HTML or XML output"><div class="sect3" id="idm45820414607840"><h3>Producing HTML or XML output</h3><p><span class="command"><em>mysql</em></span> generates an HTML table
        from each query result set if you use the <code class="option">-H</code> (or
        <code class="option">--html</code>) option. This enables you to easily produce
        output for inclusion in a web page that shows a query result. Here’s
        an example (with line breaks added to make the output easier to
        read):</p><pre data-type="programlisting">$ <strong><code>mysql -H -e "SELECT * FROM limbs WHERE legs=0" cookbook</code></strong>
&lt;TABLE BORDER=1&gt;
&lt;TR&gt;&lt;TH&gt;thing&lt;/TH&gt;&lt;TH&gt;legs&lt;/TH&gt;&lt;TH&gt;arms&lt;/TH&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;squid&lt;/TD&gt;&lt;TD&gt;0&lt;/TD&gt;&lt;TD&gt;10&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;fish&lt;/TD&gt;&lt;TD&gt;0&lt;/TD&gt;&lt;TD&gt;0&lt;/TD&gt;&lt;/TR&gt;
&lt;TR&gt;&lt;TD&gt;phonograph&lt;/TD&gt;&lt;TD&gt;0&lt;/TD&gt;&lt;TD&gt;1&lt;/TD&gt;&lt;/TR&gt;
&lt;/TABLE&gt;</pre><p>The first row of the table contains column headings. If you
        don’t want a header row, see the next section for instructions.</p><p>You can save the output in a file, then view it with a web
        browser. For example, on Mac OS X, do this:</p><pre data-type="programlisting">$ <strong><code>mysql -H -e "SELECT * FROM limbs WHERE legs=0" cookbook &gt; limbs.html</code></strong>
$ <strong><code>open -a safari limbs.html</code></strong></pre><p>To generate an XML document instead of HTML, use the <code class="option">-X</code> (or <code class="option">--xml</code>)
        option:</p><pre data-type="programlisting">$ <strong><code>mysql -X -e "SELECT * FROM limbs WHERE legs=0" cookbook</code></strong>
&lt;?xml version="1.0"?&gt;

&lt;resultset statement="select * from limbs where legs=0
"&gt;
  &lt;row&gt;
    &lt;field name="thing"&gt;squid&lt;/field&gt;
    &lt;field name="legs"&gt;0&lt;/field&gt;
    &lt;field name="arms"&gt;10&lt;/field&gt;
  &lt;/row&gt;

  &lt;row&gt;
    &lt;field name="thing"&gt;fish&lt;/field&gt;
    &lt;field name="legs"&gt;0&lt;/field&gt;
    &lt;field name="arms"&gt;0&lt;/field&gt;
  &lt;/row&gt;

  &lt;row&gt;
    &lt;field name="thing"&gt;phonograph&lt;/field&gt;
    &lt;field name="legs"&gt;0&lt;/field&gt;
    &lt;field name="arms"&gt;1&lt;/field&gt;
  &lt;/row&gt;
&lt;/resultset&gt;</pre><p>You can reformat XML to suit a variety of purposes by running it
        through XSLT transforms. This enables you to use the
        same input to produce many output formats.</p><p>The <code class="option">-H</code>, <code class="option">--html</code>
        <code class="option">-X</code>, and <code class="option">--xml</code> options produce output
        only for statements that generate a result set, not for statements
        such as <code>INSERT</code> or <code>UPDATE</code>.</p><p>To write your own programs that generate XML from query results,
        see <a data-type="xref" href="ch13.xhtml#nch-xfer-xfer-xml-export">Recipe 13.15</a>.</p></div></section><section data-type="sect3" data-pdf-bookmark="Suppressing column headings in query&#10;        output"><div class="sect3" id="suppress_ch"><h3>Suppressing column headings in query
        output</h3><p>Tab-delimited format is convenient for generating datafiles for import into
        other programs. However, the first row of output for each query lists
        the column headings by default, which may not always be what you want.
        Suppose that a program named <span class="command"><em>summarize</em></span> produces descriptive statistics
        for a column of numbers. If you produce output from <span class="command"><em>mysql</em></span> to be used with this program, a column
        header row would throw off the results because <span class="command"><em>summarize</em></span> would treat it as data. To create
        output that contains only data values, suppress the header row with
        the <code class="option">--skip-column-names</code> option:</p><pre data-type="programlisting">$ <strong><code>mysql --skip-column-names -e "SELECT arms FROM limbs" cookbook | summarize</code></strong></pre><p>Specifying the <q>silent</q> option (<code class="option">-s</code>
        or <code class="option">--silent</code>) twice achieves the same effect:</p><pre data-type="programlisting">$ <strong><code>mysql -ss -e "SELECT arms FROM limbs" cookbook | summarize</code></strong></pre></div></section><section data-type="sect3" data-pdf-bookmark="Specifying the output column delimiter"><div class="sect3" id="idm45820413817072"><h3>Specifying the output column delimiter</h3><p>In noninteractive mode, <span class="command"><em>mysql</em></span>
        separates output columns by tabs and there is no option for
        specifying the output delimiter. To produce output that uses a
        different delimiter, postprocess <span class="command"><em>mysql</em></span> output. Suppose that you want to
        create an output file for use by a program that expects values to be
        separated by colon characters (<code>:</code>)
        rather than tabs. Under Unix, you can convert tabs to arbitrary delimiters by using a
        utility such as <span class="command"><em>tr</em></span> or
        <span class="command"><em>sed</em></span>. Any of the following commands
        change tabs to colons (<em><code>TAB</code></em> indicates where
        you type a tab character):</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code> | sed -e "s/</code></strong><em><code>TAB</code></em><strong><code>/:/g" &gt;</code></strong> <em><code>outputfile</code></em>
$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code> | tr "</code></strong><em><code>TAB</code></em><strong><code>" ":" &gt;</code></strong> <em><code>outputfile</code></em>
$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code> | tr "\011" ":" &gt;</code></strong> <em><code>outputfile</code></em></pre><p>The syntax differs among versions of <span class="command"><em>tr</em></span>; consult your local documentation. Also,
        some shells use the tab character for special purposes such as
        filename completion. For such shells, type a literal tab into the
        command by preceding it with Ctrl-V.</p><p><span class="command"><em>sed</em></span> is more powerful than
        <span class="command"><em>tr</em></span> because it understands regular
        expressions and permits multiple substitutions. This is useful for
        producing output in something like comma-separated values (CSV) format, which requires
        three substitutions:</p><ol><li><p>Escape any quote characters that appear in the data by
            doubling them, so that when you use the resulting CSV file, they
            won’t be interpreted as column delimiters.</p></li><li><p>Change the tabs to commas.</p></li><li><p>Surround column values with quotes.</p></li></ol><p><span class="command"><em>sed</em></span> permits all three
        substitutions to be performed in a single command line:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em><strong><code> \</code></strong>
    <strong><code>| sed -e 's/"/""/g' -e 's/</code></strong><em><code>TAB</code></em><strong><code>/","/g' -e 's/^/"/' -e 's/$/"/' &gt;</code></strong> <em><code>outputfile</code></em></pre><p>That’s cryptic, to say the least. You can achieve the same
        result with other languages that may be easier to read. Here’s a short
        Perl script that does the same thing as the <span class="command"><em>sed</em></span> command (it converts tab-delimited input
        to CSV output), and includes comments to document how it works:</p><pre data-type="programlisting" data-code-language="perl"><code class="ch">#!/usr/bin/perl</code>
<code class="c1"># csv.pl: convert tab-delimited input to comma-separated values output</code>
<code class="k">while</code> <code class="p">(</code><code class="o">&lt;&gt;</code><code class="p">)</code>        <code class="c1"># read next input line</code>
<code class="p">{</code>
  <code class="sr">s/"/""/g</code><code class="p">;</code>       <code class="c1"># double quotes within column values</code>
  <code class="sr">s/\t/","/g</code><code class="p">;</code>     <code class="c1"># put "," between column values</code>
  <code class="sr">s/^/"/</code><code class="p">;</code>         <code class="c1"># add " before the first value</code>
  <code class="sr">s/$/"/</code><code class="p">;</code>         <code class="c1"># add " after the last value</code>
  <code class="k">print</code><code class="p">;</code>          <code class="c1"># print the result</code>
<code class="p">}</code></pre><p>If you name the script <span class="command"><em>csv.pl</em></span>, use it like this:</p><pre data-type="programlisting">$ <strong><code>mysql cookbook &lt;</code></strong> <em><code>inputfile</code></em> <strong><code> | perl csv.pl &gt;</code></strong> <em><code>outputfile</code></em></pre><p><span class="command"><em>tr</em></span> and <span class="command"><em>sed</em></span> normally are unavailable under Windows.
        Perl may be more suitable as a cross-platform solution because it runs
        under both Unix and Windows. (On Unix systems, Perl is usually
        preinstalled. On Windows, it is freely available for you to
        install.)</p><p>Another way to produce CSV output is to use the Perl
        Text::CSV_XS module, which was designed for that purpose. Utility <span class="command"><em>cvt_file.pl</em></span>, available in the recipes distribution, uses this module
        to construct a general-purpose file reformatter.</p></div></section><section data-type="sect3" data-pdf-bookmark="Controlling mysql’s verbosity level"><div class="sect3" id="idm45820413816768"><h3>Controlling mysql’s verbosity level</h3><p>When you run <span class="command"><em>mysql</em></span>
        noninteractively, not only does the default output format change, but it becomes
        more terse. For example, <span class="command"><em>mysql</em></span>
        doesn’t print row counts or indicate how long statements took to
        execute. To tell <span class="command"><em>mysql</em></span> to be more
        verbose, use <code class="option">-v</code> or <code class="option">--verbose</code>,
        specifying the option multiple times for increasing verbosity. Try the
        following commands to see how the output differs:</p><pre data-type="programlisting">$ <strong><code>echo "SELECT NOW()" | mysql</code></strong>
$ <strong><code>echo "SELECT NOW()" | mysql -v</code></strong>
$ <strong><code>echo "SELECT NOW()" | mysql -vv</code></strong>
$ <strong><code>echo "SELECT NOW()" | mysql -vvv</code></strong></pre><p>The counterparts of <code class="option">-v</code> and
        <code class="option">--verbose</code> are <code class="option">-s</code> and
        <code class="option">--silent</code>, which also can be used multiple times for increased effect.</p></div></section></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.8 Using User-Defined Variables in SQL Statements"><div class="sect1" id="nch-mysql-mysql-vars"><h1>1.8 Using User-Defined Variables in SQL Statements</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820404144128"><h2>Problem</h2><p>You want to use a value in one statement that is produced by an earlier
      statement.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820410759504"><h2>Solution</h2><p>Save the value in a user-defined variable to store it for later
      use.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820410036928"><h2>Discussion</h2><p>To save a value returned by a <code>SELECT</code> statement, assign it to a user-defined variable. This enables you to
      refer to it in other statements later in the same session (but not
      <em>across</em> sessions). User variables are a
      MySQL-specific extension to standard SQL. They will not work with other
      database engines.</p><p>To assign a value to a user variable within a <code>SELECT</code> statement, use <code>@</code><em><code>var_name</code></em> <code>:=</code> <em><code>value</code></em> syntax.
      The variable can be used in subsequent statements wherever an expression
      is permitted, such as in a <code>WHERE</code> clause or
      in an <code>INSERT</code> statement.</p><p>Here is an example that assigns a value to a user variable, then
      refers to that variable later. This is a simple way to determine a value
      that characterizes some row in a table, then select that particular
      row:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT MAX(arms+legs) INTO @max_limbs FROM limbs;</code></strong>
Query OK, 1 row affected (0,01 sec)
mysql&gt; <strong><code>SELECT * FROM limbs WHERE arms+legs = @max_limbs;</code></strong>
+-----------+------+------+
| thing     | legs | arms |
+-----------+------+------+
| centipede |   99 |    0 |
+-----------+------+------+</pre><p>Another use for a variable is to save the result from <code>LAST_INSERT_ID()</code>
      after creating a new row in a table that has an <code>AUTO_INCREMENT</code> column:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT @last_id := LAST_INSERT_ID();</code></strong></pre><p><code>LAST_INSERT_ID()</code> returns the
      most recent <code>AUTO_INCREMENT</code> value. By saving it in a
      variable, you can refer to the value several times in subsequent
      statements, even if you issue other statements that create their own
      <code>AUTO_INCREMENT</code> values and thus change
      the value returned by <code>LAST_INSERT_ID()</code>. <a data-type="xref" href="ch15.xhtml#nch-sequences-seq-simultaneous">Recipe 15.10</a> discusses this technique
      further.</p><p>User variables hold single values. If a statement returns multiple
      rows, the statement will fail with an error but the value from the first row is assigned:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT thing FROM limbs WHERE legs = 0;</code></strong>
+------------+
| thing      |
+------------+
| squid      |
| fish       |
| phonograph |
+------------+
3 rows in set (0,00 sec)

mysql&gt; <strong><code>SELECT thing INTO @name FROM limbs WHERE legs = 0;</code></strong>
ERROR 1172 (42000): Result consisted of more than one row
mysql&gt; <strong><code>SELECT @name;</code></strong>
+-------+
| @name |
+-------+
| squid |
+-------+</pre><p>If the statement returns no rows, no assignment takes place, and
      the variable retains its previous value. If the variable has not been
      used previously, its value is <code>NULL</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT thing INTO @name2 FROM limbs WHERE legs &lt; 0;</code></strong>
Query OK, 0 rows affected, 1 warning (0,00 sec)

mysql&gt; <strong><code>SHOW WARNINGS;</code></strong>
+---------+------+-----------------------------------------------------+
| Level   | Code | Message                                             |
+---------+------+-----------------------------------------------------+
| Warning | 1329 | No data - zero rows fetched, selected, or processed |
+---------+------+-----------------------------------------------------+
1 row in set (0,00 sec)

mysql&gt; <strong><code>select @name2;</code></strong>
+--------+
| @name2 |
+--------+
| NULL   |
+--------+
1 row in set (0,00 sec)</pre><div data-type="tip"><h6>Tip</h6><p>
          SQL command <code>SHOW WARNINGS</code> returns informational messages about recoverable errors, such as assigning empty result to a variable or use of a deprecated feature.
        </p></div><p>To set a variable explicitly to a particular value, use a <code>SET</code>
      statement. <code>SET</code> syntax can use either
      <code>:=</code> or <code>=</code> as the assignment operator:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @sum = 4 + 7;</code></strong>
mysql&gt; <strong><code>SELECT @sum;</code></strong>
+------+
| @sum |
+------+
|   11 |
+------+</pre><p>You can assign a <code>SELECT</code> result
      to a variable, provided that you write it as a scalar subquery (a query
      within parentheses that returns a single value):</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @max_limbs = (SELECT MAX(arms+legs) FROM limbs);</code></strong></pre><p>User variable names are not case sensitive:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @x = 1, @X = 2; SELECT @x, @X;</code></strong>
+------+------+
| @x   | @X   |
+------+------+
| 2    | 2    |
+------+------+</pre><p>User variables can appear only where expressions are permitted,
      not where constants or literal identifiers must be provided. It’s
      tempting to attempt to use variables for such things as table names, but
      it doesn’t work. For example, if you try to generate a temporary table
      name using a variable as follows, it fails:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @tbl_name = CONCAT('tmp_tbl_', CONNECTION_ID());</code></strong>
mysql&gt; <strong><code>CREATE TABLE @tbl_name (int_col INT);</code></strong>
ERROR 1064 (42000): You have an error in your SQL syntax; ↩
check the manual that corresponds to your MySQL server version for ↩
the right syntax to use near '@tbl_name (int_col INT)' at line 1</pre><p>However, you <em>can</em> generate a prepared SQL
      statement that incorporates <code>@tbl_name</code>, then execute the result. <a data-type="xref" href="ch06.xhtml#nch-tblmgmt-tblmgmt-unique-name">Recipe 6.4</a> shows how.</p><p><code>SET</code> is also used to assign
      values to stored program parameters and local variables, and to
      system variables. For examples, see <a data-type="xref" href="ch11.xhtml#nch-routines">Chapter 11</a> and <a data-type="xref" href="ch22.xhtml#nch-admin-server-config">Recipe 22.1</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.9 Customizing mysql Prompt"><div class="sect1" id="nch-mysql-mysql-prompt"><h1>1.9 Customizing mysql Prompt</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820410673952"><h2>Problem</h2><p>You opened several connections in different terminal windows and
      want to visually distinguish them.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820410670832"><h2>Solution</h2><p>Set <span class="command"><em>mysql</em></span> prompt to custom
      value</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820410566768"><h2>Discussion</h2><p>You can customize <span class="command"><em>mysql</em></span> prompt
      by providing option <code>--prompt</code> on
      start: </p><pre data-type="programlisting">$ <strong><code>mysql --prompt="MySQL Cookbook&gt; "</code></strong>
MySQL Cookbook&gt;</pre><p>If the client already has been started you can use command
      <span class="command"><em>prompt</em></span> to change it interactively:
      </p><pre data-type="programlisting">mysql&gt; <strong><code>prompt MySQL Cookbook&gt; </code></strong>
PROMPT set to 'MySQL Cookbook&gt; '
MySQL Cookbook&gt;</pre><p>Command <span class="command"><em>prompt</em></span>, like other
      <span class="command"><em>mysql</em></span> commands, supports short
      version: <span class="command"><em>\R</em></span>. </p><pre data-type="programlisting">mysql&gt; <strong><code>\R MySQL Cookbook&gt; </code></strong>
PROMPT set to 'MySQL Cookbook&gt; '
MySQL Cookbook&gt;</pre><p>To specify prompt value in the configuration file put option
      <span class="command"><em>prompt</em></span> under <code>[mysql]</code> section: </p><pre data-type="programlisting">[mysql]
prompt="MySQL Cookbook&gt; "</pre><p> Quotes are optional and required only when you want
      to have special characters, such as a space in the end of the prompt
      string.</p><p>Finally, you can specify prompt using environment variable
      <code>MYSQL_PS1</code>: </p><pre data-type="programlisting">$ <strong><code>export MYSQL_PS1="MySQL Cookbook&gt; "</code></strong>
$ <strong><code>mysql</code></strong>
MySQL Cookbook&gt;</pre><p>To reset prompt to its default value run command <span class="command"><em>prompt</em></span> without arguments: </p><pre data-type="programlisting">MySQL Cookbook&gt; <strong><code>prompt</code></strong>
Returning to default PROMPT of mysql&gt; 
mysql&gt;</pre><div data-type="tip"><h6>Tip</h6><p>If you used <code>MYSQL_PS1</code>
        environment variable the prompt default will be value of the <code>MYSQL_PS1</code> variable instead of <code>mysql</code>.</p></div><p><span class="command"><em>mysql</em></span> prompt is highly
      customizable. You can set it to show current date, time, user account,
      default database, server host and other information about your database
      connection. You will find the full list of supported options in the <a href="https://dev.mysql.com/doc/refman/8.0/en/mysql-commands.html">MySQL
      User Reference Manual</a></p><p>To have a user account in the prompt use either special sequence
      <code>\u</code> to display just a user name or
      <code>\U</code> to show the full user account:
      </p><pre data-type="programlisting">mysql&gt; <strong><code>prompt \U&gt; </code></strong>
PROMPT set to '\U&gt; '
cbuser@localhost&gt;</pre><p>If you connect to MySQL servers on different machines you may want
      to see the MySQL server host name in the prompt. A special sequence <code>\h</code> exists just for this: </p><pre data-type="programlisting">mysql&gt; <strong><code>\R \h&gt; </code></strong>
PROMPT set to '\h&gt; '
Delly-7390&gt;</pre><p>To have the current default database in the prompt use the special
      sequence <code>\d</code>: </p><pre data-type="programlisting">mysql&gt; <strong><code>\R \d&gt; </code></strong>
PROMPT set to '\d&gt; '
(none)&gt; <strong><code>use cookbook</code></strong>
Database changed
cookbook&gt;</pre><p><span class="command"><em>mysql</em></span> supports multiple options
      to include time into the prompt. You can have full date and time
      information or just part of it. </p><pre data-type="programlisting">mysql&gt; <strong><code>prompt \R:\m:\s&gt; </code></strong>
PROMPT set to '\R:\m:\s&gt; '
15:30:10&gt;
15:30:10&gt; <strong><code>prompt \D&gt; </code></strong>
PROMPT set to '\D&gt; '
Sat Sep 19 15:31:19 2020&gt;</pre><p> 
      </p><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>You cannot specify current day of month unless
        you use full current date. This was reported at <a href="https://bugs.mysql.com/bug.php?id=72071">MySQL Bug #72071</a>
        and still is not fixed.</p></div><p>Special sequences can be combined together and with any other
      text. <span class="command"><em>mysql</em></span> uses UTF-8 character set
      and, if your terminal supports UTF-8 too, you can use smiley characters to make your prompt more impressive.
      For example, to have on hand information about connected user account,
      MySQL host, default database and current time you can set prompt to
      <code>\u@\h [ߓᜤ] (ߕᜒ:\m:\s)&gt; </code>:  </p><pre data-type="programlisting">mysql&gt; <strong><code>prompt \u@\h [ߓᜤ] (ߕᜒ:\m:\s)&gt; </code></strong>
PROMPT set to '\u@\h [ߓᜤ] (ߕᜒ:\m:\s)&gt; '
cbuser@Delly-7390 [ߓᣯokbook] (ߕᱶ:15:41)&gt;</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.10 Using External Programs"><div class="sect1" id="idm45820410566400"><h1>1.10 Using External Programs</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820410539488"><h2>Problem</h2><p>You want to use external program without leaving <span class="command"><em>mysql</em></span> client command
      prompt.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820410537696"><h2>Solution</h2><p>Use command <span class="command"><em>system</em></span> to call a
      program.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820410535904"><h2>Discussion</h2><p>While MySQL allows to generate random passwords for itw own internal user accountes, it still does does not have an internal function which could be used to
        generate a safe user password for all other cases. Run command <span class="command"><em>system</em></span> to use one of the Operating System
        tools: </p><pre data-type="programlisting">mysql&gt; <strong><code>system openssl rand -base64 16</code></strong>
p1+iSG9rveeKc6v0+lFUHA==</pre><p> <span class="command"><em>\!</em></span> is a short
        version of the <span class="command"><em>system</em></span> command:
        </p><pre data-type="programlisting">mysql&gt; <strong><code>\! pwgen -synBC 16 1</code></strong>
Nu=3dWvrH7o_tWiE</pre><p>
          <span class="command"><em>pwgen</em></span>  maybe not installed on your operating system. You need to install <code>pwgen</code> package before running this example. 
        </p><p><span class="command"><em>system</em></span> is a command of the
        <span class="command"><em>mysql</em></span> client and executed locally,
        using permissions belonging to the client. By default MySQL Server is
        running as user <code>mysql</code> though you can
        connect using any user account. In this case you will be able to
        access only those programs and files which are permitted for your
        operating system account. Thus regular user cannot access data
        directory, that belongs to the special user <span class="command"><em>mysqld</em></span> process is running as.
        </p><pre data-type="programlisting">mysql&gt; <strong><code>select @@datadir;</code></strong>
+-----------------+
| @@datadir       |
+-----------------+
| /var/lib/mysql/ |
+-----------------+
1 row in set (0,00 sec)

mysql&gt; <strong><code>system ls /var/lib/mysql/</code></strong>
ls: cannot open directory '/var/lib/mysql/': Permission denied
mysql&gt; <strong><code>\! id</code></strong>
uid=1000(sveta) gid=1000(sveta) groups=1000(sveta)</pre><p>For the same reason <span class="command"><em>system</em></span>
        does not execute any command on the remote server.</p><p>You may use any program,
        specify options, redirect output and pipe it to other commands. One
        useful insight which you can get from the operating system is how
        much physical resources are occupied by the <span class="command"><em>mysqld</em></span> process and compare it with data
        collected internally by the MySQL Server itself.
        </p><p>MySQL stores information about memory usage in <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-memory-summary-tables.html"><code>Performance Schema</code></a>. Its companion
        <a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-memory-summary-tables.html"><code>sys</code> schema</a> contains views, allowing you
        to access this information easily. Particularly, you can find the total
        amount of allocated memory in human-readable format by querying view
        <code>sys.memory_global_total</code>.
        </p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT * FROM sys.memory_global_total;</code></strong>
+-----------------+
| total_allocated |
+-----------------+
| 253.90 MiB      |
+-----------------+
1 row in set (0.00 sec)

mysql&gt; <strong><code>\! ps -o rss hp `pidof mysqld` | awk '{print $1/1024}'</code></strong>
298.66</pre><p> The chain of the operating system commands requests
        statistics about physical memory usage from the operating system and converts it into human-readable format. This
        example shows that not all allocated memory is instrumented inside
        MySQL Server.</p><p>
          Note, that you need to run <span class="command"><em>mysql</em></span> client on the same machine with your MySQL server for this to work.
        </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="1.11 Filtering and Processing Output"><div class="sect1" id="nch-mysql-mysql-filter"><h1>1.11 Filtering and Processing Output</h1><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>This recipe works only on UNIX platforms!</p></div><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820410513872"><h2>Problem</h2><p>
        You want to change output format of the MySQL client beyond its built-in capabilities.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820410512816"><h2>Solution</h2><p>
        Set <span class="command"><em>pager</em></span> to a chain of commands, filtering output in a way you wish.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820410510992"><h2>Discussion</h2><p>Sometimes formatting capabilities of the <span class="command"><em>mysql</em></span> client do not allow you to work with the result set easily.
        For example, the number of returned rows could be too big to fit the
        screen. Or the number of columns makes the result too wide to comfortably read
        it on the screen. Standard operating system pagers, such as <span class="command"><em>less</em></span> or <span class="command"><em>more</em></span>, allow you to work with long wide texts
        more comfortably.</p><p>You can specify which pager to use either by providing option
        <code>--pager</code> when you start <span class="command"><em>mysql</em></span> client or interactively, by using
        <span class="command"><em>pager</em></span> command and its shorter
        version <span class="command"><em>\P</em></span>. You can specify any
        argument for the pager.</p><p>To tell <span class="command"><em>mysql</em></span> to use <span class="command"><em>less</em></span> as a pager specify option <code>--pager=less</code> or assign this value
        interactively. Provide configuration parameters for the command
        similarly as when you are working in your favorite shell. In the
        example below I specified options <code>-F</code> and <code>-X</code>
        so <span class="command"><em>less</em></span> exits if result set is
        small enough to fit the screen and works normally when needed.
        </p><pre data-type="programlisting">mysql&gt; <strong><code>pager less -F -X</code></strong>
PAGER set to 'less -F -X'
mysql&gt; <strong><code>SELECT * FROM city;</code></strong>
+----------------+----------------+----------------+
| state          | capital        | largest        |
+----------------+----------------+----------------+
| Alabama        | Montgomery     | Birmingham     |
| Alaska         | Juneau         | Anchorage      |
| Arizona        | Phoenix        | Phoenix        |
| Arkansas       | Little Rock    | Little Rock    |
| California     | Sacramento     | Los Angeles    |
| Colorado       | Denver         | Denver         |
| Connecticut    | Hartford       | Bridgeport     |
| Delaware       | Dover          | Wilmington     |
| Florida        | Tallahassee    | Jacksonville   |
| Georgia        | Atlanta        | Atlanta        |
| Hawaii         | Honolulu       | Honolulu       |
| Idaho          | Boise          | Boise          |
| Illinois       | Springfield    | Chicago        |
| Indiana        | Indianapolis   | Indianapolis   |
| Iowa           | Des Moines     | Des Moines     |
| Kansas         | Topeka         | Wichita        |
| Kentucky       | Frankfort      | Louisville     |
:
mysql&gt; <strong><code>SELECT * FROM movies;</code></strong>
+----+------+----------------------------+
| id | year | movie                      |
+----+------+----------------------------+
|  1 | 1997 | The Fifth Element          |
|  2 | 1999 | The Phantom Menace         |
|  3 | 2001 | The Fellowship of the Ring |
|  4 | 2005 | Kingdom of Heaven          |
|  5 | 2010 | Red                        |
|  6 | 2011 | Unknown                    |
+----+------+----------------------------+
6 rows in set (0,00 sec)</pre><p>You can use <code>pager</code> not only to
        beautify output, but to run any command which can process text. One
        common use is to search for a pattern in the data, printed by the
        diagnostic statement, using <span class="command"><em>grep</em></span>.
        For example, to watch only <code>History list
        length</code> in the long <code>SHOW ENGINE
        INNODB STATUS</code> output, use <span class="command"><em>\P grep
        “History list length”</em></span>. Once you are done with the search,
        reset pager with empty <span class="command"><em>pager</em></span>
        command or instruct <span class="command"><em>mysql</em></span> to
        disable <code>pager</code> and print to <code>STDOUT</code> using <span class="command"><em>nopager</em></span> or <span class="command"><em>\n</em></span>. </p><pre data-type="programlisting">mysql&gt; <strong><code>\P grep "History list length"</code></strong>
PAGER set to 'grep "History list length"'
mysql&gt; <strong><code>SHOW ENGINE INNODB STATUS\G</code></strong>
History list length 30
1 row in set (0,00 sec)

mysql&gt; <strong><code>SELECT SLEEP(60);</code></strong>
1 row in set (1 min 0,00 sec)

mysql&gt; <strong><code>SHOW ENGINE INNODB STATUS\G</code></strong>
History list length 37
1 row in set (0,00 sec)

mysql&gt; <strong><code>nopager</code></strong>
PAGER set to stdout</pre><p>Another useful option during diagnostic is sending output
        nowhere. For example, to measure effectiveness of a query you may want
        to examine session status variables <code>Handler_*</code>. In this case you are not
        interested in the result of the query, but only in the output of the
        following diagnostic command. Even more, you may want to send
        diagnostic data to professional database consultants, but do not want
        them to see actual query output due to security considerations. In
        this case instruct <code>pager</code> to use a
        hashing function or to send output to nowhere. </p><pre data-type="programlisting">mysql&gt; <strong><code>pager md5sum</code></strong>
PAGER set to 'md5sum'
mysql&gt; <strong><code>SELECT 'Output of this statement is a hash';</code></strong>
8d83fa642dbf6a2b7922bcf83bc1d861  -
1 row in set (0,00 sec)

mysql&gt; <strong><code>pager cat &gt; /dev/null</code></strong>
PAGER set to 'cat &gt; /dev/null'
mysql&gt; <strong><code>SELECT 'Output of this statement goes to nowhere';</code></strong>
1 row in set (0,00 sec)

mysql&gt; <strong><code>pager</code></strong>
Default pager wasn't set, using stdout.
mysql&gt; <strong><code>SELECT 'Output of this statement is visible';</code></strong>
+-------------------------------------+
| Output of this statement is visible |
+-------------------------------------+
| Output of this statement is visible |
+-------------------------------------+
1 row in set (0,00 sec)</pre><div data-type="tip"><h6>Tip</h6><p>To redirect output of a query, information messages, and all commands you type into a file use <span class="command"><em>pager cat &gt; FILENAME</em></span>. To redirect to a
          file and still see the output use redirect to <span class="command"><em>tee</em></span> or <span class="command"><em>mysql</em></span> own command <span class="command"><em>tee</em></span> and its short version <span class="command"><em>\T</em></span>. Built-in command <span class="command"><em>tee</em></span> works on both UNIX and Windows
          platforms.</p></div><p>You can chain together <span class="command"><em>pager</em></span>
        commands using pipes. For example, to print content of the <code>limbs</code> table in different font styles set <span class="command"><em>pager</em></span> to chain of calls: </p><ol><li><p><span class="command"><em>tr -d ' '</em></span> to remove
              extra spaces</p></li><li><p><span class="command"><em>awk -F'|' '{print “+"$2"+\033[3m"$3"\033[0m+\033[1m"$4"\033[0m"$5"+"}'</em></span>
              to add styles to the text</p></li><li><p><span class="command"><em>column -s '+' -t’</em></span> for
              nicely formatted output</p></li></ol><p>  </p><pre data-type="programlisting">
mysql&gt; <strong><code>\P tr -d ' ' | </code></strong>↩
<strong><code>awk -F'|' '{print "+"$2"+\033[3m"$3"\033[0m+\033[1m"$4"\033[0m"$5"+"}' | </code></strong>↩
<strong><code>column -s '+' -t</code></strong>
PAGER set to 'tr -d ' ' | ↩
awk -F'|' '{print "+"$2"+\033[3m"$3"\033[0m+\033[1m"$4"\033[0m"$5"+"}' | ↩
column -s '+' -t'
mysql&gt; <strong><code>select * from limbs;</code></strong>
                  
thing       <em>legs</em>  <strong>arms</strong>
                  
human       <em>2</em>     <strong>2</strong>
insect      <em>6</em>     <strong>0</strong>
squid       <em>0</em>     <strong>10</strong>
fish        <em>0</em>     <strong>0</strong>
centipede   <em>99</em>    <strong>0</strong>
table       <em>4</em>     <strong>0</strong>
armchair    <em>4</em>     <strong>2</strong>
phonograph  <em>0</em>     <strong>1</strong>
tripod      <em>3</em>     <strong>0</strong>
PegLegPete  <em>1</em>     <strong>2</strong>
spacealien  <em>NULL</em>  <strong>NULL</strong>
                  
11 rows in set (0,00 sec)</pre></div></section></div></section></div></section></div></body></html>