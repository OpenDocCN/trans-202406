<html><head></head><body><section data-pdf-bookmark="Chapter 6. Managing Application Manifests" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_managing_manifests">&#13;
<h1><span class="label">Chapter 6. </span>Managing Application Manifests</h1>&#13;
&#13;
&#13;
<p>In this chapter, we take a look at ways to simplify the management of applications on Kubernetes with the use of tools such as Helm, <code>kompose</code>, and kapp. These tools primarily focus on managing your YAML manifests.<a data-primary="manifests" data-secondary="managing application manifests" data-type="indexterm" id="ix_maniapp"/><a data-primary="Helm" data-secondary="installing" data-type="indexterm" id="id788"/> Helm is a YAML templating, packaging, and deployment tool, whereas Kompose is a tool that assists you with migrating your Docker Compose files to Kubernetes resource manifests. kapp is a relatively new tool that allows you to manage a group of YAML files as an application and thereby manage their deployment as a single application.<a data-primary="application manifests" data-see="manifests" data-type="indexterm" id="id789"/><a data-primary="package manager (Kubernetes)" data-see="Helm" data-type="indexterm" id="id790"/></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.1 Installing Helm, the Kubernetes Package Manager" data-type="sect1"><div class="sect1" id="helm_install">&#13;
<h1>6.1 Installing Helm, the Kubernetes Package Manager</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id286">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You do not want to write all your Kubernetes manifests by hand.<a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="installing Helm" data-type="indexterm" id="id791"/> Instead, you want to be able to search for a package in a repository and download and install it with a command-line interface.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id200">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <a href="https://helm.sh">Helm</a>. Helm consists of a client-side CLI called <code>helm</code> and is used to search for and deploy charts on a Kubernetes cluster.<a data-primary="CLI (command-line interface)" data-secondary="helm" data-type="indexterm" id="id792"/></p>&#13;
&#13;
<p class="pagebreak-after">You can download Helm from the GitHub <a href="https://oreil.ly/0A7Ty">release page</a> and move the <code>helm</code> binary into your <code>$PATH</code>. For example, on macOS (Intel), for the v3.12.3 release, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>wget https://get.helm.sh/helm-v3.12.3-darwin-amd64.tar.gz</strong>&#13;
$ <strong>tar -xvf helm-v3.12.3-darwin-amd64.tar.gz</strong>&#13;
$ <strong>sudo mv darwin-amd64/helm /usr/local/bin</strong>&#13;
</pre>&#13;
&#13;
<p>Alternatively, you can use the handy <a href="https://oreil.ly/V6_bt">installer script</a> to install the latest version of Helm:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>wget -O get_helm.sh https://raw.githubusercontent.com/helm/helm/main/&#13;
scripts/get-helm-3</strong>&#13;
&#13;
$ <strong>chmod +x get_helm.sh</strong>&#13;
$ <strong>./get_helm.sh</strong>&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id55">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Helm is the Kubernetes package manager; it defines a Kubernetes package as a set of manifests and some metadata.<a data-primary="packages (Kubernetes), Helm definition of" data-type="indexterm" id="id793"/> The manifests are actually templates. The values in the templates are filled when the package is instantiated by Helm. A Helm package is called a <em>chart</em>, and packaged charts are made available to users in chart repositories.<a data-primary="charts" data-type="indexterm" id="id794"/></p>&#13;
&#13;
<p>Another method of installing Helm on Linux or macOS is to use the <a href="https://brew.sh">Homebrew</a> package manager:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>brew install helm</strong>&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.2 Adding Chart Repositories to Helm" data-type="sect1"><div class="sect1" id="helm_add_repositories">&#13;
<h1>6.2 Adding Chart Repositories to Helm</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id201">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the <code>helm</code> client (see <a data-type="xref" href="#helm_install">Recipe 6.1</a>), and now you want to find and add chart repositories to Helm.<a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="adding chart repositories to Helm" data-type="indexterm" id="id795"/><a data-primary="charts" data-secondary="adding chart repositories to Helm" data-type="indexterm" id="id796"/><a data-primary="Helm" data-secondary="adding chart repositories to" data-type="indexterm" id="id797"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id56">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>A chart repository consists of packaged charts and some metadata that enables Helm to search for charts in the repository. Before you can begin installing an application with Helm, you need to find and add the chart repository that provides the chart.<a data-primary="Artifact Hub" data-type="indexterm" id="id798"/></p>&#13;
&#13;
<p>As illustrated in <a data-type="xref" href="#artifacthub">Figure 6-1</a>, <a href="https://artifacthub.io">Artifact Hub</a> is a web-based service that allows you to search <a href="https://oreil.ly/0olJi">more than 10,000 charts</a> from various publishers and add chart repositories to Helm.<a data-primary="Artifact Hub" data-secondary="searching for Helm chart for Redis" data-type="indexterm" id="id799"/><a data-primary="Redis" data-secondary="Helm chart for, finding on Artifact Hub" data-type="indexterm" id="id800"/></p>&#13;
&#13;
<figure><div class="figure" id="artifacthub">&#13;
<img alt="Screenshot of the Artifact Hub, searching for a Helm chart for Redis" src="assets/kcb2_0601.png"/>&#13;
<h6><span class="label">Figure 6-1. </span>Artifact Hub, searching for a Helm chart for Redis</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id57">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>helm</code> command also integrates with Artifact Hub, which allows you to search Artifact Hub directly from the <code>helm</code> command line.</p>&#13;
&#13;
<p>Let’s assume you would like to search for a publisher that provides a Redis chart. You can use the <code>helm search hub</code> command to find one:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm search hub --list-repo-url redis</strong>&#13;
URL                      CHART VER... APP VER...  DESCRIPTION    REPO URL&#13;
https://art...s/redis    0.1.1        6.0.8.9     A Helm cha...  https://spy8...&#13;
https://art...s-arm/...  17.8.0       7.0.8       Redis(R) i...  https://libr...&#13;
https://art...ontain...  0.15.2       0.15.0      Provides e...  https://ot-c...&#13;
...&#13;
</pre>&#13;
&#13;
<p>If you<a data-primary="Bitnami (chart publisher)" data-type="indexterm" id="id801"/> want to deploy the chart published by <a href="https://oreil.ly/jL7Xz">Bitnami</a>, a well-known publisher of more than 100 production-quality charts, add the chart repository using the following:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm repo add bitnami https://charts.bitnami.com/bitnami</strong>&#13;
</pre>&#13;
&#13;
<p>You’re all set now to install charts from the repository.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.3 Using Helm to Install Applications" data-type="sect1"><div class="sect1" id="using_helm">&#13;
<h1>6.3 Using Helm to Install Applications</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id202">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve added a chart repository to Helm (see <a data-type="xref" href="#helm_add_repositories">Recipe 6.2</a>), and now you want to search for charts and deploy them.<a data-primary="Helm" data-secondary="using to install applications" data-type="indexterm" id="id802"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="using Helm to install applications" data-type="indexterm" id="id803"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id58">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Let’s assume you want to deploy the Redis chart from the <a href="https://oreil.ly/TAPRO">Bitnami chart repository</a>.</p>&#13;
&#13;
<p>Before you search a chart repository, it’s a good practice to update the locally cached index of the chart<a data-primary="Redis" data-secondary="deploying Redis chart from Bitnami repository" data-type="indexterm" id="id804"/><a data-primary="Bitnami (chart publisher)" data-secondary="deploying Redis chart from" data-type="indexterm" id="id805"/> repositories:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm repo update</strong>&#13;
Hang tight while we grab the latest from your chart repositories...&#13;
...Successfully got an update from the "bitnami" chart repository&#13;
Update Complete. ⎈Happy Helming!⎈&#13;
</pre>&#13;
&#13;
<p>Search for <code>redis</code> in the Bitnami chart repository:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm search repo bitnami/redis</strong>&#13;
NAME                  CHART VERSION APP VERSION DESCRIPTION&#13;
bitnami/redis         18.0.1        7.2.0       Redis(R) is an...&#13;
bitnami/redis-cluster 9.0.1         7.2.0       Redis(R) is an...&#13;
</pre>&#13;
&#13;
<p>And use <code>helm install</code> to deploy the chart:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm install redis bitnami/redis</strong>&#13;
</pre>&#13;
&#13;
<p>Helm will use the default chart configuration and create a Helm release named <code>redis</code>. A Helm release is the collection of all Kubernetes objects defined in a chart that you can manage as a single unit.<a data-primary="releases (Helm)" data-type="indexterm" id="id806"/></p>&#13;
&#13;
<p>After a while you should see the <code>redis</code> pods running:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get all -l app.kubernetes.io/name=redis</strong>&#13;
NAME                   READY   STATUS    RESTARTS   AGE&#13;
pod/redis-master-0     1/1     Running   0          114s&#13;
pod/redis-replicas-0   1/1     Running   0          114s&#13;
pod/redis-replicas-1   1/1     Running   0          66s&#13;
pod/redis-replicas-2   1/1     Running   0          38s&#13;
&#13;
NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE&#13;
service/redis-headless  ClusterIP   None            &lt;none&gt;        6379/TCP   114s&#13;
service/redis-master    ClusterIP   10.105.20.184   &lt;none&gt;        6379/TCP   114s&#13;
service/redis-replicas  ClusterIP   10.105.27.109   &lt;none&gt;        6379/TCP   114s&#13;
&#13;
NAME                              READY   AGE&#13;
statefulset.apps/redis-master     1/1     114s&#13;
statefulset.apps/redis-replicas   3/3     114s&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id807">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The output of the <code>helm install</code> command could contain important information about the deployment, such as passwords retrieved from secrets, deployed services, etc. You can use the <code>helm list</code> command to list existing helm installations, and then <code>helm status <em>&lt;name&gt;</em></code> to view the details of that installation:</p>&#13;
<pre data-type="programlisting">&#13;
% helm status redis&#13;
NAME: redis&#13;
LAST DEPLOYED: Fri Nov 10 09:42:17 2023&#13;
NAMESPACE: default&#13;
STATUS: deployed&#13;
...&#13;
</pre>&#13;
&#13;
<p>To learn more about Helm charts and how to create your own charts, see <a data-type="xref" href="#create_chart">Recipe 6.8</a>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.4 Inspecting the Customizable Parameters of a Chart" data-type="sect1"><div class="sect1" id="chart_parameters">&#13;
<h1>6.4 Inspecting the Customizable Parameters of a Chart</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id203">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to know the customizable parameters of a chart and their default values.<a data-primary="charts" data-secondary="inspecting customizable parameters of" data-type="indexterm" id="id808"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="inspecting customizable parameters of a chart" data-type="indexterm" id="id809"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id810">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Chart publishers expose various parameters of a chart that can be configured while installing the chart. The default values of these parameters are configured in a <em>Values</em> file whose contents can be viewed using the <code>helm show values</code> command—for example:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm show values bitnami/redis</strong>&#13;
...&#13;
...&#13;
## @param architecture Redis® architecture. Allowed values: `standalone` or&#13;
`replication`&#13;
##&#13;
architecture: replication&#13;
...&#13;
...&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id59">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p class="pagebreak-after">It’s a common practice for publishers to document chart parameters in the <em>Values</em> file. <a data-primary="Readme file, viewing for charts" data-type="indexterm" id="id811"/><a data-primary="Values file, chart parameters in" data-type="indexterm" id="id812"/>However, a chart’s <em>Readme</em> file can provide more extensive documentation of the various parameters, along with specific usage instructions. To view a chart’s <em>Readme</em> file, use the <code>helm show readme</code> command. For example:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm show readme bitnami/redis</strong>&#13;
...&#13;
...&#13;
### Redis® common configuration parameters&#13;
&#13;
| Name                       | Description                     | Value         |&#13;
| -------------------------- | --------------------------------| ------------- |&#13;
| `architecture`             | Redis® architecture...          | `replication` |&#13;
| `auth.enabled`             | Enable password authentication  | `true`        |&#13;
...&#13;
...&#13;
</pre>&#13;
&#13;
<p>It’s worth noting that this <em>Readme</em> is the same as the one rendered for the chart on <a href="https://oreil.ly/dIYpI">Artifact Hub</a>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.5 Overriding Chart Parameters" data-type="sect1"><div class="sect1" id="overriding_chart_parameters">&#13;
<h1>6.5 Overriding Chart Parameters</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id204">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve learned about the various customizable parameters of a chart (see <a data-type="xref" href="#chart_parameters">Recipe 6.4</a>), and now you want to customize the chart deployment.<a data-primary="charts" data-secondary="overriding parameters of" data-type="indexterm" id="id813"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="overriding chart parameters" data-type="indexterm" id="id814"/><a data-primary="Helm" data-secondary="overriding default chart parameters" data-type="indexterm" id="id815"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id816">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>The default parameters of a Helm chart can be overridden by passing the <code>--set</code> <code><em>key</em></code><code>=</code><code><em>value</em></code> flag while installing the chart. The flag can be specified multiple times, or you can separate key/value pairs with commas like so: <code>key1=value1,key2=value2</code>.</p>&#13;
&#13;
<p>For example, you can override the deployment configuration of the <code>bitnami/redis</code> chart to use the <code>standalone</code> architecture as follows:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm install redis bitnami/redis --set architecture=standalone</strong>&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id817">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When overriding many chart parameters, you can provide the <code>--values</code> flag to input a YAML-formatted file with all the parameters you want to override. For the previous example, create a file named <em>values.yaml</em>  containing this line:</p>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nt">architecture</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">standalone</code><code class="w"/></pre>&#13;
&#13;
<p>Then input the file to <code>helm install</code>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm install redis bitnami/redis --values values.yaml</strong>&#13;
</pre>&#13;
&#13;
<p class="pagebreak-before">The <code>standalone</code> configuration of the <code>bitnami/redis</code> chart spawns fewer pod resources and is suitable for development purposes. Let’s take a look:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kubectl get pods</strong>&#13;
NAME             READY   STATUS    RESTARTS   AGE&#13;
redis-master-0   1/1     Running   0          3m14s&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.6 Getting the User-Supplied Parameters of a &#10;Helm Release" data-type="sect1"><div class="sect1" id="query_user_supplied_values">&#13;
<h1>6.6 Getting the User-Supplied Parameters of a &#13;
<span class="keep-together">Helm Release</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id205">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>Your Kubernetes cluster has a Helm release, and you want to know the user-supplied chart parameters that were specified when the chart was installed.<a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="getting user-supplied parameters of Helm release" data-type="indexterm" id="id818"/><a data-primary="Helm" data-secondary="getting user-defined parameters of Helm release" data-type="indexterm" id="id819"/><a data-primary="releases (Helm)" data-secondary="getting user-supplied parameters of" data-type="indexterm" id="id820"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id821">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>The <code>helm list</code> command gets the list of Helm release objects present in the cluster:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm list</strong>&#13;
NAME  NAMESPACE REVISION  UPDATED              STATUS    CHART        APP VERSION&#13;
redis default   1         2022-12-30 14:02...  deployed  redis-17.4.0 7.0.7&#13;
</pre>&#13;
&#13;
<p>You can get extended information about a Helm release, such as the user-supplied values, using the <code>helm get</code> command:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm get values redis</strong>&#13;
USER-SUPPLIED VALUES:&#13;
architecture: standalone&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id822">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>In addition to the <code>values</code>, you can also retrieve the YAML manifests, post-deployment notes, and the hooks configured in the chart using the <code>helm get</code> &#13;
<span class="keep-together">command.</span></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.7 Uninstalling Applications with Helm" data-type="sect1"><div class="sect1" id="uninstalling_release">&#13;
<h1>6.7 Uninstalling Applications with Helm</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id206">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You no longer want an application that was installed using Helm (see <a data-type="xref" href="#using_helm">Recipe 6.3</a>) and want to remove it.<a data-primary="Helm" data-secondary="uninstalling applications with" data-type="indexterm" id="id823"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="uninstalling applications with Helm" data-type="indexterm" id="id824"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id825">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>When you install an application using a chart, it creates a Helm release that can be managed as a single unit. To remove an application that was installed using Helm, all you need to do is remove the <em>release</em> using the <code>helm uninstall</code> command.</p>&#13;
&#13;
<p>Let’s assume you want to remove a Helm release named <em>redis</em>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm uninstall redis</strong>&#13;
release "redis" uninstalled&#13;
</pre>&#13;
&#13;
<p>Helm will remove all the Kubernetes objects associated with the release and free up the cluster resources associated with their objects.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.8 Creating Your Own Chart to Package Your &#10;Application with Helm" data-type="sect1"><div class="sect1" id="create_chart">&#13;
<h1>6.8 Creating Your Own Chart to Package Your &#13;
<span class="keep-together">Application with Helm</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id207">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You have written an application with multiple Kubernetes manifests and want to package it as a Helm chart.<a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="creating your own chart to package application with Helm" data-type="indexterm" id="id826"/><a data-primary="charts" data-secondary="creating your own to package application with Helm" data-type="indexterm" id="id827"/><a data-primary="Helm" data-secondary="creating your own chart to package application with Helm" data-type="indexterm" id="id828"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id829">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>helm create</code> and <code>helm package</code> commands.</p>&#13;
&#13;
<p>With <code>helm create</code>, generate the skeleton of your chart. Issue the command in your terminal, specifying the name of your chart. For example, to create an <code>oreilly</code> chart:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm create oreilly</strong>&#13;
Creating oreilly&#13;
&#13;
$ <strong>tree oreilly/</strong>&#13;
oreilly/&#13;
├── Chart.yaml&#13;
├── charts&#13;
├── templates&#13;
│   ├── NOTES.txt&#13;
│   ├── _helpers.tpl&#13;
│   ├── deployment.yaml&#13;
│   ├── hpa.yaml&#13;
│   ├── ingress.yaml&#13;
│   ├── service.yaml&#13;
│   ├── serviceaccount.yaml&#13;
│   └── tests&#13;
│       └── test-connection.yaml&#13;
└── values.yaml&#13;
&#13;
3 directories, 10 files&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id830">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>helm create</code> command generates a scaffolding for a typical web application. You can edit the generated scaffolding and adapt it for your application, or if you have your manifests already written, you can delete the contents of the <em>templates/</em> directory and copy your existing templates into it. If you want to templatize your manifests, then write the values that need to be substituted in the manifests in the <em>values.yaml</em> file. Edit the metadata file <em>Chart.yaml</em>, and if you have any dependent charts, put them in the <em>/charts</em> directory.</p>&#13;
&#13;
<p>You can test your chart locally by running this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm install oreilly-app ./oreilly</strong>&#13;
</pre>&#13;
&#13;
<p>Finally, you can package it with <code>helm package oreilly/</code> to generate a re-distributable tarball of your chart. If you want to publish the chart to a chart repository, copy it to the repository and generate a new <em>index.yaml</em> using the command <code>helm repo index .</code>. After the updates to the chart registry are completed, and provided that you have added the chart repository to Helm (see <a data-type="xref" href="#helm_add_repositories">Recipe 6.2</a>), <code>helm search repo oreilly</code> should return your chart:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>helm search repo oreilly</strong>&#13;
NAME            	VERSION	DESCRIPTION&#13;
oreilly/oreilly 	0.1.0  	A Helm chart for Kubernetes&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="id831">&#13;
<h2>See Also</h2>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://oreil.ly/fGfgF">“Create Your First Helm Chart”</a> in the VMware Application Catalog docs</p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/kcznF">“The Chart Best Practices Guide”</a> in the Helm docs</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.9 Installing Kompose" data-type="sect1"><div class="sect1" id="kompose_install">&#13;
<h1>6.9 Installing Kompose</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id832">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve started using containers with Docker and written some Docker compose files to define your multicontainer application. Now you want to start using Kubernetes and wonder if and how you can reuse your Docker compose files.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id208">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <a href="https://kompose.io">Kompose</a>. Kompose is a tool that converts Docker compose files into Kubernetes (or OpenShift) manifests.<a data-primary="Kompose" data-secondary="installing" data-type="indexterm" id="id833"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="installing Kompose" data-type="indexterm" id="id834"/><a data-primary="GitHub" data-secondary="downloading kompose from" data-type="indexterm" id="id835"/></p>&#13;
&#13;
<p>To start, download <code>kompose</code> from the GitHub <a href="https://oreil.ly/lmiCJ">release page</a> and move it to your <code>$PATH</code>, for convenience.</p>&#13;
&#13;
<p>For example, on macOS, do the following:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>wget https://github.com/kubernetes/kompose/releases/download/v1.27.0/&#13;
kompose-darwin-amd64 -O kompose</strong>&#13;
&#13;
$ <strong>sudo install -m 755 kompose /usr/local/bin/kompose</strong>&#13;
$ <strong>kompose version</strong>&#13;
</pre>&#13;
&#13;
<p>Alternatively, Linux and macOS users can install the <code>kompose</code> CLI using the <a href="https://brew.sh">Homebrew</a> package manager:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>brew install kompose</strong>&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.10 Converting Your Docker Compose Files to &#10;Kubernetes Manifests" data-type="sect1"><div class="sect1" id="using_kompose">&#13;
<h1>6.10 Converting Your Docker Compose Files to &#13;
<span class="keep-together">Kubernetes Manifests</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id209">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the <code>kompose</code> command (see <a data-type="xref" href="#kompose_install">Recipe 6.9</a>), and now you want to convert your Docker compose file into Kubernetes manifests.<a data-primary="Kompose" data-secondary="converting Docker compose files to Kubernetes manifests" data-type="indexterm" id="id836"/><a data-primary="compose files (Docker)" data-secondary="converting to Kubernetes manifests" data-type="indexterm" id="id837"/><a data-primary="Docker" data-secondary="compose files, conversion to Kubernetes manifests" data-type="indexterm" id="id838"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id210">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Suppose you have the following Docker compose <a data-primary="Redis" data-secondary="Docker compose file, converting to Kubernetes manifest" data-type="indexterm" id="id839"/>file that starts a <code>redis</code> container:</p>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nt">version</code><code class="p">:</code><code class="w"> </code><code class="s">'2'</code><code class="w"/>&#13;
&#13;
<code class="nt">services</code><code class="p">:</code><code class="w"/>&#13;
<code class="w">  </code><code class="nt">redis</code><code class="p">:</code><code class="w"/>&#13;
<code class="w">    </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">redis:7.2.0</code><code class="w"/>&#13;
<code class="w">    </code><code class="nt">ports</code><code class="p">:</code><code class="w"/>&#13;
<code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="s">"6379:6379"</code><code class="w"/></pre>&#13;
&#13;
<p>Using Kompose, you can automatically convert this into Kubernetes manifests with the following command:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kompose convert</strong>&#13;
</pre>&#13;
&#13;
<p>Kompose will read the contents of the Docker compose file and generate the Kubernetes manifests in the current directory. Then you can use <code>kubectl apply</code> to create these resources in your cluster.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id840">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Adding the <code>--stdout</code> argument to the <code>kompose convert</code> command will generate the YAML, which can be directly piped to <code>kubectl apply</code> like so:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kompose convert --stdout | kubectl apply -f -</strong>&#13;
</pre>&#13;
&#13;
<p>Some Docker compose directives are not converted to Kubernetes. In this case, <code>kompose</code> prints out a warning informing you that the conversion did not happen.</p>&#13;
&#13;
<p>While in general it doesn’t cause problems, it is possible that the conversion may not result in a working manifest in Kubernetes. This is expected, as this type of transformation cannot be perfect. However, it will get you close to a working Kubernetes manifest. Most notably, handling volumes and network isolation will typically require manual, custom work from your side.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.11 Converting Your Docker Compose File to a &#10;Helm Chart" data-type="sect1"><div class="sect1" id="creating_helm_chart_using_kompose">&#13;
<h1>6.11 Converting Your Docker Compose File to a &#13;
<span class="keep-together">Helm Chart</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id211">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You’ve installed the <code>kompose</code> command (see <a data-type="xref" href="#kompose_install">Recipe 6.9</a>), and now you want to create a Helm chart from your Docker compose file.<a data-primary="Kompose" data-secondary="converting Docker compose files to Helm chart" data-type="indexterm" id="id841"/><a data-primary="compose files (Docker)" data-secondary="converting to Helm charts" data-type="indexterm" id="id842"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="converting Docker compose file to Helm chart" data-type="indexterm" id="id843"/><a data-primary="charts" data-secondary="conversion of Docker compose file to Helm chart" data-type="indexterm" id="id844"/><a data-primary="Helm" data-secondary="conversion of Docker compose file to Helm chart" data-type="indexterm" id="id845"/><a data-primary="Docker" data-secondary="converting compose file to Helm chart" data-type="indexterm" id="id846"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id847">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>As well as using Kompose to convert your Docker compose files to Kubernetes manifests (see <a data-type="xref" href="#using_kompose">Recipe 6.10</a>), you can also use it to generate a Helm chart for the converted objects.</p>&#13;
&#13;
<p>Generate a Helm chart from your Docker compose file using Kompose like so:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kompose convert --chart</strong>&#13;
</pre>&#13;
&#13;
<p>A new Helm chart will be generated in the current directory. This chart can be packaged, deployed, and managed using the <code>helm</code> CLI (see <a data-type="xref" href="#using_helm">Recipe 6.3</a>).</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.12 Installing kapp" data-type="sect1"><div class="sect1" id="install_kapp">&#13;
<h1>6.12 Installing kapp</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id212">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You have written the YAML files to deploy your application to the cluster and want to deploy and manage the lifecycle of the deployment, but you don’t want to package it as a Helm chart.<a data-primary="kapp" data-secondary="installing" data-type="indexterm" id="id848"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="installing kapp" data-type="indexterm" id="id849"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id213">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <a href="https://carvel.dev/kapp">kapp</a>, which is a CLI tool that enables you to manage resources in bulk. Unlike Helm, kapp considers YAML templating outside of its scope and focuses on managing application deployments.<a data-primary="YAML" data-secondary="templating outside of kapp scope" data-type="indexterm" id="id850"/></p>&#13;
&#13;
<p>To install kapp, use the <a href="https://oreil.ly/iAQPd">download script</a> to download the latest version for your platform from the GitHub <a href="https://oreil.ly/9g2f3">release page</a>:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>mkdir local-bin/</strong>&#13;
$ <strong>wget https://carvel.dev/install.sh -qO - | \&#13;
    K14SIO_INSTALL_BIN_DIR=local-bin bash</strong>&#13;
&#13;
$ <strong>sudo install -m 755 local-bin/kapp /usr/local/bin/kapp</strong>&#13;
$ <strong>kapp version</strong>&#13;
</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id851">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Linux and macOS users can also install kapp using the <a href="https://brew.sh">Homebrew</a> package manager:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>brew tap vmware-tanzu/carvel</strong>&#13;
$ <strong>brew install kapp</strong>&#13;
$ <strong>kapp version</strong>&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="6.13 Deploying YAML Manifests Using kapp" data-type="sect1"><div class="sect1" id="using_kapp">&#13;
<h1>6.13 Deploying YAML Manifests Using kapp</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id214">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You have installed kapp (see <a data-type="xref" href="#install_kapp">Recipe 6.12</a>), and now you want to deploy and manage your YAML manifests using kapp.<a data-primary="kapp" data-secondary="deploying YAML manifests with" data-type="indexterm" id="ix_kappdeply"/><a data-primary="YAML" data-secondary="deploying YAML manifests using kapp" data-type="indexterm" id="ix_YAMLkapp"/><a data-primary="manifests" data-secondary="managing application manifests" data-tertiary="deploying YAML manifests using kapp" data-type="indexterm" id="ix_maniappkapp"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id852">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>kapp considers a set of resources with the same label as an application. Suppose you have a folder named <em>manifests/</em> that contains the YAML file to deploy an NGINX server. kapp will treat all these manifests as a single application:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>cat manifests/deploy.yaml</strong>&#13;
apiVersion: apps/v1&#13;
kind: Deployment&#13;
metadata:&#13;
  name: nginx&#13;
  labels:&#13;
    app: nginx&#13;
spec:&#13;
  replicas: 1&#13;
  selector:&#13;
    matchLabels:&#13;
      app: nginx&#13;
  template:&#13;
    metadata:&#13;
      labels:&#13;
        app: nginx&#13;
    spec:&#13;
      containers:&#13;
      - name: nginx&#13;
        image: nginx:1.25.2&#13;
        ports:&#13;
        - containerPort: 80&#13;
&#13;
$ <strong>cat manifests/svc.yaml</strong>&#13;
apiVersion:  v1&#13;
kind: Service&#13;
metadata:&#13;
  name: nginx&#13;
spec:&#13;
  selector:&#13;
    app: nginx&#13;
  ports:&#13;
  - port: 80&#13;
</pre>&#13;
&#13;
<p>To deploy these manifests as an application with the label <code>nginx</code>, use the following:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kapp deploy -a nginx -f manifests/</strong>&#13;
...&#13;
Namespace  Name   Kind        Age  Op      Op st.  Wait to    Rs  Ri&#13;
default    nginx  Deployment  -    create  -       reconcile  -   -&#13;
^          nginx  Service     -    create  -       reconcile  -   -&#13;
...&#13;
Continue? [yN]:&#13;
</pre>&#13;
&#13;
<p>kapp will provide an overview of the resources that will be created on the cluster and ask for confirmation from the user. To update the application, all you need to do is update the YAML files in the <em>manifests/</em> folder and rerun the <code>deploy</code> command. You can add the <code>--diff-changes</code> option to view a diff of the updated YAML.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id215">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>After deploying applications using kapp, you can manage their lifecycle as well. For example, to inspect the resources created for an app deployment, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kapp inspect -a nginx</strong>&#13;
...&#13;
Name   Namespaces  Lcs   Lca&#13;
nginx  default     true  4s&#13;
...&#13;
</pre>&#13;
&#13;
<p>To list all the deployed applications, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kapp ls</strong>&#13;
...&#13;
Name   Namespaces  Lcs   Lca&#13;
nginx  default     true  4s&#13;
...&#13;
</pre>&#13;
&#13;
<p>And to delete an application <a data-primary="kapp" data-secondary="deploying YAML manifests with" data-startref="ix_kappdeply" data-type="indexterm" id="id853"/><a data-primary="YAML" data-secondary="deploying YAML manifests using kapp" data-startref="ix_YAMLkapp" data-type="indexterm" id="id854"/><a data-primary="manifests" data-secondary="managing application manifests" data-startref="ix_maniappkapp" data-tertiary="deploying YAML manifests using kapp" data-type="indexterm" id="id855"/><a data-primary="manifests" data-secondary="managing application manifests" data-startref="ix_maniapp" data-type="indexterm" id="id856"/>deployed using kapp, do this:</p>&#13;
<pre data-type="programlisting">&#13;
$ <strong>kapp delete -a nginx</strong>&#13;
</pre>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>