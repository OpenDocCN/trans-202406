<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Helm Plugins and Starters"><div class="chapter" id="helm_plugins_and_starters">
<h1><span class="label">Chapter 8. </span>Helm Plugins and Starters</h1>


<p class="lead">As we’ve seen throughout this book, Helm has plenty of features and methods that aid in delivering applications on Kubernetes. However, it is also possible to customize and extend the functionality provided by Helm.</p>

<p>In this chapter we will discuss two ways to further enhance and customize your usage of Helm: <em>plugins</em> and <em>starters</em>.</p>

<p>Plugins allow you to add extra functionality to Helm and integrate seamlessly<a data-type="indexterm" data-primary="plugins" data-secondary="about" id="idm46125984560136"/><a data-type="indexterm" data-primary="Helm" data-secondary="helm client" data-tertiary="plugins" id="idm46125984559160"/> with the CLI, making them a popular choice for users with unique workflow requirements. There are a number of third-party plugins available online for common use cases, such as secrets management. In addition, plugins are incredibly easy to build on your own for unique, one-off tasks.</p>

<p>Starters expand the possibilities of using <code>helm create</code> to generate <a data-type="indexterm" data-primary="starters" data-secondary="about" id="idm46125984556712"/><a data-type="indexterm" data-primary="Helm" data-secondary="helm client" data-tertiary="starters" id="idm46125984555704"/><a data-type="indexterm" data-primary="create command" data-secondary="starters" data-seealso="starters" id="idm46125984554488"/>new Helm charts for different types of applications. For example, you might have a Helm chart built for an internal microservice that fits perfectly as an example for future microservices. You could convert the chart into a starter, which you can then use each time you begin a new project with similar requirements.</p>

<p>By leveraging plugins and starters, we can build on top of Helm’s out-of-the-box functionality to simplify and automate everyday workflow tasks.</p>






<section data-type="sect1" data-pdf-bookmark="Plugins"><div class="sect1" id="idm46125984552136">
<h1>Plugins</h1>

<p>Helm plugins are external tools that are accessible directly from the Helm CLI. They allow you to add custom subcommands to Helm without making any modifications to Helm’s Go source code. This is similar in design to how plugin systems are implemented in other tools, such as <code>kubectl</code> (the Kubernetes CLI).</p>

<p>Additionaly, downloader plugins allow you to specify a custom protocol for <a data-type="indexterm" data-primary="plugins" data-secondary="downloader plugins" id="idm46125984549320"/><a data-type="indexterm" data-primary="downloader plugins" id="idm46125984548344"/><a data-type="indexterm" data-primary="protocol handling by downloader plugins" id="idm46125984547672"/>communicating with chart repositories. This can be useful if you have some custom authentication method, or if you need to somehow modify the method in which Helm fetches charts from repositories</p>








<section data-type="sect2" data-pdf-bookmark="Installing Third-Party Plugins"><div class="sect2" id="idm46125984546472">
<h2>Installing Third-Party Plugins</h2>

<p>Many third-party plugins are made open source and publicly available on GitHub.<a data-type="indexterm" data-primary="installing third-party plugins" id="idm46125984544520"/><a data-type="indexterm" data-primary="plugins" data-secondary="installing third-party" id="idm46125984543784"/> Many of these plugins use the “helm-plugin” tag/topic to make them easy to find. Refer to the<a data-type="indexterm" data-primary="plugins" data-secondary="documentation" id="idm46125984542600"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="plugin documentation" id="idm46125984541656"/> <a href="https://oreil.ly/3KwNb">documentation for Helm plugins on GitHub</a>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46125984539608">
<h5>Sample Publicly-Available Plugins</h5>
<p>Here are just a few of the Helm plugins you can find on GitHub:</p>
<dl>
<dt>helm/helm-2to3</dt>
<dd>
<p>Plugin for converting Helm 2 releases to Helm 3 releases in place<a data-type="indexterm" data-primary="plugins" data-secondary="helm-2to3 for converting releases" id="idm46125984536248"/><a data-type="indexterm" data-primary="helm-2to3 plugin for converting releases" id="idm46125984535176"/><a data-type="indexterm" data-primary="versions of Helm" data-secondary="helm-2to3 plugin for converting" id="idm46125984534408"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="helm-2to3 plugin for converting" id="idm46125984533448"/><a data-type="indexterm" data-primary="releases" data-secondary="helm-2to3 plugin for converting" id="idm46125984532216"/></p>
</dd>
<dt>jkroepke/helm-secrets</dt>
<dd>
<p>Plugin for effectively managing secrets in YAML format<a data-type="indexterm" data-primary="helm-secrets plugin for managing secrets" id="idm46125984529976"/><a data-type="indexterm" data-primary="plugins" data-secondary="helm-secrets for managing secrets" id="idm46125984529176"/><a data-type="indexterm" data-primary="Secrets (Kubernetes)" data-secondary="helm-secrets plugin" id="idm46125984528216"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="Secrets" data-tertiary="helm-secrets plugin" id="idm46125984527272"/><a data-type="indexterm" data-primary="YAML" data-secondary="helm-secrets plugin" id="idm46125984526056"/></p>
</dd>
<dt>maorfr/helm-backup</dt>
<dd>
<p>Plugin to backup/restore Helm releases to/from a text file<a data-type="indexterm" data-primary="helm-backup plugin" id="idm46125984523832"/><a data-type="indexterm" data-primary="plugins" data-secondary="helm-backup" id="idm46125984523048"/><a data-type="indexterm" data-primary="releases" data-secondary="helm-backup plugin" id="idm46125984522104"/><a data-type="indexterm" data-primary="backup plugin" id="idm46125984521160"/></p>
</dd>
<dt>karuppiah7890/helm-schema-gen</dt>
<dd>
<p>Plugin to generate <em>values.schema.json</em> based on <em>values.yaml</em> (see <a data-type="xref" href="ch06.xhtml#advanced_charts">Chapter 6</a> for more info on schematized values)<a data-type="indexterm" data-primary="schematizing values.yaml files" data-secondary="helm-schema-gen plugin" id="idm46125984517256"/><a data-type="indexterm" data-primary="values.yaml file" data-secondary="schematizing" data-tertiary="helm-schema-gen plugin" id="idm46125984516248"/><a data-type="indexterm" data-primary="helm-schema-gen plugin for schematizing values" id="idm46125984515032"/><a data-type="indexterm" data-primary="plugins" data-secondary="helm-schema-gen for schematizing values" id="idm46125984514328"/></p>
</dd>
<dt>hickeyma/helm-mapkubeapis</dt>
<dd>
<p>Plugin to update Helm release metadata that contains deprecated Kubernetes APIs<a data-type="indexterm" data-primary="helm-mapkubeapis plugin for deprecated APIs" id="idm46125984512248"/><a data-type="indexterm" data-primary="plugins" data-secondary="helm-mapkubeapis for deprecated APIs" id="idm46125984511416"/></p>
</dd>
</dl>
</div></aside>

<p>Once you have found a plugin to install, obtain its version control URL.<a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" id="idm46125984509944"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" id="idm46125984509032"/> This will be used as the means of obtaining the correct version of <em>plugin.yaml</em> and the rest of the plugin source code.</p>

<p>Git, SVN, Bazaar (Bzr), and Mercurial (Hg) URLs are currently supported. For Git, the version control URL looks something like <em><code>https://example.com/myorg/myrepo.git</code></em>.</p>

<p>For example, there is a simple plugin for managing Helm starters located in a git repo at<a data-type="indexterm" data-primary="plugins" data-secondary="helm-starter for managing starters" id="idm46125984505768"/><a data-type="indexterm" data-primary="helm-starter plugin for managing starters" id="idm46125984504728"/><a data-type="indexterm" data-primary="starters" data-secondary="helm-starter plugin for managing" id="idm46125984503960"/> <a href="https://github.com/salesforce/helm-starter"><em class="hyperlink">https://github.com/salesforce/helm-starter</em></a>. The version control URL for this plugin is <code>https://github.com/salesforce/helm-starter.git</code>.</p>

<p>To install this plugin, run <code>helm plugin install</code> passing the version control URL as the first argument:</p>

<pre data-type="programlisting">$ helm plugin install https://github.com/salesforce/helm-starter.git
Installed plugin: starter</pre>

<p>If the installation succeeds, you can proceed to use the plugin:</p>

<pre data-type="programlisting">$ helm starter --help
Fetch, list, and delete helm starters from github.

Available Commands:
    helm starter fetch GITURL       Install a bare Helm starter from Github
                                      (e.g., git clone)
    helm starter list               List installed Helm starters
    helm starter delete NAME        Delete an installed Helm starter
    --help                          Display this text</pre>

<p>To list all installed plugins, use the <code>helm plugin list</code> command:<a data-type="indexterm" data-primary="plugins" data-secondary="listing installed plugins" id="idm46125984497048"/></p>

<pre data-type="programlisting">$ helm plugin list
NAME   	VERSION	DESCRIPTION
starter	1.0.0  	This plugin fetches, lists, and deletes helm starters from github.</pre>

<p>To attempt to update the plugin, use the <code>helm plugin update</code> command:<a data-type="indexterm" data-primary="plugins" data-secondary="updating" id="idm46125984494280"/></p>

<pre data-type="programlisting">$ helm plugin update starter
Updated plugin: starter</pre>

<p>If you wish to the uninstall the plugin from your system, use the <code>helm plugin remove</code> command:<a data-type="indexterm" data-primary="plugins" data-secondary="removing installed" id="idm46125984491640"/></p>

<pre data-type="programlisting">$ helm plugin remove starter
Uninstalled plugin: starter</pre>

<p>Unless otherwise specified, Helm will use the <em>plugin.yaml</em> and source code<a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" id="idm46125984489000"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" id="idm46125984487992"/> located on the default branch of the Git repo when installing a plugin. If you wish to specify a Git tag to use, use the <code>--version</code> flag on install:</p>

<pre data-type="programlisting">$ helm plugin install https://github.com/databus23/helm-diff.git --version v3.1.0</pre>

<p>It is also possible to install plugins directly from a tarball URL. Helm will download the tarball and unpack it into the plugins directory:</p>

<pre data-type="programlisting">$ helm plugin install https://example.com/archives/myplugin-0.6.0.tar.gz</pre>

<p>In addition, you can install a plugin from a local directory:</p>

<pre data-type="programlisting">$ helm plugin install /path/to/myplugin</pre>

<p>Instead of copying the files, Helm will create symlinks to the original files:</p>

<pre data-type="programlisting">$ ls -la "$(helm env HELM_PLUGINS)"
total 8
drwxrwxr-x 2 myuser myuser 4096 Jul  3 21:49 .
drwxrwxr-x 4 myuser myuser 4096 Jul  1 21:38 ..
lrwxrwxrwx 1 myuser myuser   21 Jul  3 21:49 myplugin -&gt; /path/to/myplugin</pre>

<p>This might be useful, for example, if you are actively developing a plugin. Making changes to <em>plugin.yaml</em> and other source files will be recognized immediately when invoking a symlinked plugin.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Custom Subcommands"><div class="sect2" id="idm46125984545560">
<h2>Custom Subcommands</h2>

<p>Plugins have a number of useful features that enable seemless integration<a data-type="indexterm" data-primary="plugins" data-secondary="custom subcommands" id="idm46125984479528"/> with the existing Helm user experience. Probably the most notable feature of Helm plugins is that each plugin supplies Helm with a custom, top-level subcommand. These subcommands even have the ability to leverage shell completion (covered later in this chapter).</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46125984478024">
<h5>A Bit of Helm Plugin History</h5>
<p>One of the original features of Helm plugins was that they were provided<a data-type="indexterm" data-primary="plugins" data-secondary="history of" id="idm46125984476616"/><a data-type="indexterm" data-primary="Helm" data-secondary="helm client" data-tertiary="plugins history" id="idm46125984475544"/><a data-type="indexterm" data-primary="versions of Helm" data-secondary="Tiller of Helm 2" id="idm46125984474328"/><a data-type="indexterm" data-primary="Helm" data-secondary="versions" data-tertiary="Tiller of Helm 2" id="idm46125984473384"/> with environment settings for connecting to Tiller, the deprecated Helm server-side component that existed in Helm 2. This was an important concept for plugin subcommands that needed to integrate closely with Helm, since anything involving Helm releases needed to route through Tiller.</p>

<p>In Helm 3, Tiller has been removed, and all communication to the Kubernetes API is performed by the Helm client itself. The plugin system, however, has remained.</p>
</div></aside>

<p>Once a plugin is installed, a new command will become available for you to use based on the plugin’s name. This new command integrates directly with Helm and will even show up in <code>helm help</code>.<a data-type="indexterm" data-primary="help command and plugins" id="idm46125984470024"/><a data-type="indexterm" data-primary="plugins" data-secondary="custom subcommands" data-tertiary="helm help command and" id="idm46125984469224"/></p>

<p>For example, let’s say we have a plugin installed called <code>inspect-templates</code> that gives us extra information about the YAML templates found within a chart. This plugin will provide you with an extra Helm command:</p>

<pre data-type="programlisting">$ helm inspect-templates [args]</pre>

<p>This will execute the <code>inspect-templates</code> plugin, passing along any arguments or flags provided to the underlying tool that the plugin executes upon invocation. The author of the plugin specifies some command that Helm should run as a subprocess each time the plugin is invoked (more info on how to specify this in <a data-type="xref" href="#building_a_plugin">“Building a Plugin”</a>).</p>

<p>Plugins offer a happy alternative to augment Helm’s existing feature set without the need to make any modifications to Helm itself.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Building a Plugin"><div class="sect2" id="building_a_plugin">
<h2>Building a Plugin</h2>

<p>Building a Helm plugin is a fairly straightforward process. <a data-type="indexterm" data-primary="plugins" data-secondary="building" id="ch08-build"/><a data-type="indexterm" data-primary="building a plugin" id="ch08-build2"/>Depending on the requirements and overall complexity of the plugin, it may require some programming knowledge; however, many plugins run just a basic shell command.</p>










<section data-type="sect3" data-pdf-bookmark="The underlying implementation"><div class="sect3" id="idm46125984459192">
<h3>The underlying implementation</h3>

<p>Consider the following Bash script, <em>inspect-templates.sh</em>, the <a data-type="indexterm" data-primary="plugins" data-secondary="building" data-tertiary="code executed" id="idm46125984457064"/><a data-type="indexterm" data-primary="inspect-templates example plugin" id="idm46125984455784"/><a data-type="indexterm" data-primary="plugins" data-secondary="inspect-templates example plugin" id="idm46125984455048"/><a data-type="indexterm" data-primary="Bash scripts" data-secondary="inspect-templates plugin" id="idm46125984454088"/><a data-type="indexterm" data-primary="plugins" data-secondary="code executed" data-tertiary="building a plugin" id="idm46125984453128"/>underlying implementation for our example <code>inspect-templates</code> plugin:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="c">#!/usr/bin/env bash</code>
<code class="nb">set</code> -e

<code class="c"># First argument on the command line, a relative path to a chart directory</code>
<code class="nv">CHART_DIRECTORY</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="nv">1</code><code class="si">}</code><code class="s2">"</code>

<code class="c"># Fail if no chart directory provided or is invalid</code>
<code class="k">if</code> <code class="o">[[</code> <code class="s2">"</code><code class="si">${</code><code class="nv">CHART_DIRECTORY</code><code class="si">}</code><code class="s2">"</code> <code class="o">==</code> <code class="s2">""</code> <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
    <code class="nb">echo</code> <code class="s2">"Usage: helm inspect-templates &lt;chart_directory&gt;"</code>
    <code class="nb">exit </code>1
<code class="k">elif</code> <code class="o">[[</code> ! -d <code class="s2">"</code><code class="si">${</code><code class="nv">CHART_DIRECTORY</code><code class="si">}</code><code class="s2">"</code> <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
    <code class="nb">echo</code> <code class="s2">"Invalid chart directory provided: </code><code class="si">${</code><code class="nv">CHART_DIRECTORY</code><code class="si">}</code><code class="s2">"</code>
    <code class="nb">exit </code>1
<code class="k">fi</code>

<code class="c"># Print a summary of the chart's templates</code>
<code class="nb">cd</code> <code class="s2">"</code><code class="si">${</code><code class="nv">CHART_DIRECTORY</code><code class="si">}</code><code class="s2">"</code>
<code class="nb">cd </code>templates/
<code class="nb">echo</code> <code class="s2">"----------------------"</code>
<code class="nb">echo</code> <code class="s2">"Chart template summary"</code>
<code class="nb">echo</code> <code class="s2">"----------------------"</code>
<code class="nb">echo</code> <code class="s2">""</code>
<code class="nv">total</code><code class="o">=</code><code class="s2">"</code><code class="k">$(</code>find . -type f -name <code class="s1">'*.yaml'</code> -maxdepth <code class="m">1</code> <code class="p">|</code> wc -l <code class="p">|</code> tr -d <code class="s1">'[:space:]'</code><code class="k">)</code><code class="s2">"</code>
<code class="nb">echo</code> <code class="s2">" Total number: </code><code class="si">${</code><code class="nv">total</code><code class="si">}</code><code class="s2">"</code>
<code class="nb">echo</code> <code class="s2">""</code>
<code class="nb">echo</code> <code class="s2">" List of templates:"</code>
<code class="k">for</code> filename in <code class="k">$(</code>find . -type f -name <code class="s1">'*.yaml'</code> -maxdepth <code class="m">1</code> <code class="p">|</code> sed <code class="s1">'s|^\./||'</code><code class="k">)</code><code class="p">;</code> <code class="k">do</code>
    <code class="nv">kind</code><code class="o">=</code><code class="k">$(</code>cat <code class="s2">"</code><code class="si">${</code><code class="nv">filename</code><code class="si">}</code><code class="s2">"</code> <code class="p">|</code> grep kind: <code class="p">|</code> head -1 <code class="p">|</code> awk <code class="s1">'{print $2}'</code><code class="k">)</code>
    <code class="nb">echo</code> <code class="s2">"  - </code><code class="si">${</code><code class="nv">filename</code><code class="si">}</code><code class="s2"> (</code><code class="si">${</code><code class="nv">kind</code><code class="si">}</code><code class="s2">)"</code>
<code class="k">done</code>
<code class="nb">echo</code> <code class="s2">""</code></pre>

<p>This script is what Helm will execute behind the scenes when a user runs <code>helm inspect-templates</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Underlying plugin implementations are not required to be written in Bash, Go, or any specific programming language. To the end-user of this plugin, it should appear to be just another part of the Helm CLI.</p>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="The plugin manifest"><div class="sect3" id="idm46125984446680">
<h3>The plugin manifest</h3>

<p>Each plugin is defined by a YAML file called <em>plugin.yaml</em>. This file <a data-type="indexterm" data-primary="plugins" data-secondary="building" data-tertiary="manifest" id="idm46125984313544"/><a data-type="indexterm" data-primary="manifests" data-secondary="plugin creation" id="idm46125984312264"/>contains plugin metadata and  information regarding what command to run when the plugin is invoked.</p>

<p>Here’s a basic example of <em>plugin.yaml</em> for the <code>inspect-templates</code> plugin:<a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" data-tertiary="inspect-templates example plugin" id="idm46125984309832"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" data-tertiary="inspect-templates example plugin" id="idm46125984308536"/></p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">inspect-templates</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO1-1" href="#callout_helm_plugins_and_starters_CO1-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code class="nt">version</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">0.1.0</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO1-2" href="#callout_helm_plugins_and_starters_CO1-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code class="nt">description</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">get</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">a</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">summary</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">of</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">a</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">chart's</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">templates</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO1-3" href="#callout_helm_plugins_and_starters_CO1-3"><img src="Images/3.png" alt="3"/></a><code>
</code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">${HELM_PLUGIN_DIR}/inspect-templates.sh</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO1-4" href="#callout_helm_plugins_and_starters_CO1-4"><img src="Images/4.png" alt="4"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_helm_plugins_and_starters_CO1-1" href="#co_helm_plugins_and_starters_CO1-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>The name of the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO1-2" href="#co_helm_plugins_and_starters_CO1-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>The version of the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO1-3" href="#co_helm_plugins_and_starters_CO1-3"><img src="Images/3.png" alt="3"/></a></dt>
<dd><p>A basic description of the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO1-4" href="#co_helm_plugins_and_starters_CO1-4"><img src="Images/4.png" alt="4"/></a></dt>
<dd><p>The command to run when this plugin is invoked.</p></dd>
</dl>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Manual installation"><div class="sect3" id="idm46125984230952">
<h3>Manual installation</h3>

<p>First check the configured path for the plugin storage root directory:<a data-type="indexterm" data-primary="plugins" data-secondary="building" data-tertiary="manual installation" id="idm46125984229576"/></p>

<pre data-type="programlisting">$ HELM_PLUGINS="$(helm env HELM_PLUGINS)"
$ echo "${HELM_PLUGINS}"
/home/myuser/.local/share/helm/plugins</pre>
<div data-type="tip"><h1>Using a Custom Root Directory for Plugins</h1>
<p>The root directory for plugins can be overridden by providing a <a data-type="indexterm" data-primary="plugins" data-secondary="root directory override" id="idm46125984226280"/><a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_PLUGINS" id="idm46125984225304"/><a data-type="indexterm" data-primary="HELM_PLUGINS" id="idm46125984224360"/><a data-type="indexterm" data-primary="root directory of plugins" id="idm46125984223688"/>custom path for the <code>HELM_PLUGINS</code> environment variable in the current environment.</p>
</div>

<p>Create a directory matching the name of the plugin (<code>inspect-templates</code>) inside the plugin storage root directory:</p>

<pre data-type="programlisting">$ PLUGIN_ROOT="${HELM_PLUGINS}/inspect-templates"
$ mkdir -p "${PLUGIN_ROOT}"</pre>

<p>Next, copy over <em>plugin.yaml</em> and <em>inspect-templates.sh</em> to the new directory, and make sure the script is executable:</p>

<pre data-type="programlisting">$ cp plugin.yaml "${PLUGIN_ROOT}"
$ cp inspect-templates.sh "${PLUGIN_ROOT}"
$ chmod +x "${PLUGIN_ROOT}/inspect-templates.sh"</pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="The end result"><div class="sect3" id="idm46125984218392">
<h3>The end result</h3>

<p>Here’s what our <code>inspect-templates</code> plugin looks like in action:<a data-type="indexterm" data-primary="plugins" data-secondary="building" data-tertiary="end result" id="idm46125984216616"/></p>

<pre data-type="programlisting">$ helm inspect-templates
Usage: helm inspect-templates &lt;chart_directory&gt;
Error: plugin "inspect-templates" exited with error

$ helm inspect-templates nonexistant/
Invalid chart directory provided: nonexistant/
Error: plugin "inspect-templates" exited with error

$ helm create mychart
Creating mychart

$ helm inspect-templates mychart/
----------------------
Chart template summary
----------------------

 Total number: 5

 List of templates:
  - serviceaccount.yaml (ServiceAccount)
  - deployment.yaml (Deployment)
  - service.yaml (Service)
  - hpa.yaml (HorizontalPodAutoscaler)
  - ingress.yaml (Ingress)</pre>

<p>Notice how the command-line arguments provided (i.e., <code>mychart/</code>) are passed directly to the script. This makes it easy for plugin authors to build standalone tools that accept any number of arguments or custom flags.<a data-type="indexterm" data-startref="ch08-build" id="idm46125984213016"/><a data-type="indexterm" data-startref="ch08-build2" id="idm46125984212312"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="plugin.yaml"><div class="sect2" id="idm46125984211384">
<h2>plugin.yaml</h2>

<p><em>plugin.yaml</em> is the name of the plugin manifest file that describes <a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" id="ch08-yaml"/><a data-type="indexterm" data-primary="manifests" data-secondary="plugin creation" data-tertiary="plugin.yaml" id="ch08-yaml2"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" id="ch08-yaml3"/>a plugin, its invocation command, and other important details.</p>

<p>Here is an example <em>plugin.yaml</em> that contains all possible options you can specify for your plugin:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">myplugin</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-1" href="#callout_helm_plugins_and_starters_CO2-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code class="nt">version</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">0.3.0</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-2" href="#callout_helm_plugins_and_starters_CO2-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code class="nt">usage</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">helm</code><code class="nv"> </code><code class="s">myplugin</code><code class="nv"> </code><code class="s">--help</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-3" href="#callout_helm_plugins_and_starters_CO2-3"><img src="Images/3.png" alt="3"/></a><code>
</code><code class="l-Scalar-Plain">description</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">"a</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">plugin</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">that</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">belongs</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">to</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">me"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-4" href="#callout_helm_plugins_and_starters_CO2-4"><img src="Images/4.png" alt="4"/></a><code>
</code><code class="nt">platformCommand</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-5" href="#callout_helm_plugins_and_starters_CO2-5"><img src="Images/5.png" alt="5"/></a><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">os</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">windows</code><code>
</code><code>    </code><code class="nt">arch</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">amd64</code><code>
</code><code>    </code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">bin/myplugin.exe</code><code class="s">"</code><code>
</code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">bin/myplugin</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-6" href="#callout_helm_plugins_and_starters_CO2-6"><img src="Images/6.png" alt="6"/></a><code>
</code><code class="nt">ignoreFlags</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">false</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-7" href="#callout_helm_plugins_and_starters_CO2-7"><img src="Images/7.png" alt="7"/></a><code>
</code><code class="nt">hooks</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-8" href="#callout_helm_plugins_and_starters_CO2-8"><img src="Images/8.png" alt="8"/></a><code>
</code><code>  </code><code class="nt">install</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/install-hook.sh</code><code class="s">"</code><code>
</code><code>  </code><code class="nt">update</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/update-hook.sh</code><code class="s">"</code><code>
</code><code>  </code><code class="nt">delete</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/delete-hook.sh</code><code class="s">"</code><code>
</code><code class="nt">downloaders</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO2-9" href="#callout_helm_plugins_and_starters_CO2-9"><img src="Images/9.png" alt="9"/></a><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">bin/myplugin-myp-downloader</code><code class="s">"</code><code>
</code><code>    </code><code class="nt">protocols</code><code class="p">:</code><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="s">"</code><code class="s">myp</code><code class="s">"</code><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="s">"</code><code class="s">myps</code><code class="s">"</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-1" href="#co_helm_plugins_and_starters_CO2-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>The name of the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-2" href="#co_helm_plugins_and_starters_CO2-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>The plugin version.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-3" href="#co_helm_plugins_and_starters_CO2-3"><img src="Images/3.png" alt="3"/></a></dt>
<dd><p>The usage instructions for this plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-4" href="#co_helm_plugins_and_starters_CO2-4"><img src="Images/4.png" alt="4"/></a></dt>
<dd><p>A description of the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-5" href="#co_helm_plugins_and_starters_CO2-5"><img src="Images/5.png" alt="5"/></a></dt>
<dd><p>Platform-specific commands. If a client matches an os/arch combo, run that command instead of the default one.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-6" href="#co_helm_plugins_and_starters_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Command to run when this plugin is invoked.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-7" href="#co_helm_plugins_and_starters_CO2-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Whether or not to supress Helm global flags passed (such as <code>--debug</code>) when passed as arguments to the plugin.</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-8" href="#co_helm_plugins_and_starters_CO2-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>Plugin hooks (see <a data-type="xref" href="#hooks">“Hooks”</a>).</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO2-9" href="#co_helm_plugins_and_starters_CO2-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>Downloaders and associated protocols (see <a data-type="xref" href="#downloader_plugins">“Downloader Plugins”</a>).</p></dd>
</dl>

<p>The <code>name</code> of the plugin will be the subcommand used to invoke this plugin from the Helm CLI (e.g., <code>helm myplugin</code>). Due to this, plugin names should not match any existing Helm subcommands (<code>install</code>, <code>repo</code>, etc.). The name can only contain the characters a–z, A–Z, 0–9, _, and -.</p>

<p>The plugin <code>version</code> should be a valid SemVer 2 version.</p>

<p>The <code>usage</code> and <code>description</code> for the plugin will be displayed when you run <code>helm help</code> and <code>helm help myplugin</code>. However, the plugin itself must handle its own flag parsing for things like <code>helm myplugin --help</code>.</p>

<p>The <code>command</code> is what Helm will execute in a subprocess when this plugin is invoked. If a section for <code>platformCommands</code> is defined, Helm will first check if the system matches the provided <code>os</code> (operating system) and <code>arch</code> (architecture), and if so, Helm will instead use the <code>command</code> defined in the matching entry. The <code>arch</code> field is optional, and if missing, just the <code>os</code> will be checked.</p>

<p>Here is the exact order in which Helm determines which command to run<a data-type="indexterm" data-primary="plugins" data-secondary="code executed" data-tertiary="which command to run" id="idm46125983947288"/><a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" data-tertiary="which command to run" id="idm46125983946200"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" data-tertiary="which command to run" id="idm46125983945112"/><a data-type="indexterm" data-primary="manifests" data-secondary="plugin creation" data-tertiary="which code to run" id="idm46125983944024"/> when a plugin is invoked, based on the contents of <em>plugin.yaml</em> and the runtime environment:</p>
<ol>
<li>
<p>If <code>platformCommand</code> is present, it will be searched first.</p>
</li>
<li>
<p>If both <code>os</code> and <code>arch</code> match the current platform, search will stop and the platform-specific command will be executed.</p>
</li>
<li>
<p>If <code>os</code> matches and there is no more specific match, the platform-specific command will be executed.</p>
</li>
<li>
<p>If no <code>os</code>/<code>arch</code> match is found, the default top-level <code>command</code> will be executed.</p>
</li>
<li>
<p>Helm will exit with an error if no top-level <code>command</code> is present and no matches are found in <code>platformCommand</code>.<a data-type="indexterm" data-startref="ch08-yaml" id="idm46125983934552"/><a data-type="indexterm" data-startref="ch08-yaml2" id="idm46125983933944"/><a data-type="indexterm" data-startref="ch08-yaml3" id="idm46125983933336"/></p>
</li>

</ol>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Hooks"><div class="sect2" id="hooks">
<h2>Hooks</h2>

<p>Plugin hooks allow you to take additional actions when the plugin is installed, updated, or deleted.<a data-type="indexterm" data-primary="plugins" data-secondary="hooks" id="idm46125983930712"/><a data-type="indexterm" data-primary="hooks" data-secondary="plugins" id="idm46125983929800"/></p>

<p>For example, the underlying implementation for your plugin may be a platform-specific binary that must be downloaded from the internet. The URL for the binary varies depending on the user’s operating system.</p>

<p>A script to handle this logic based on operating system might look something like the following:<a data-type="indexterm" data-primary="Bash scripts" data-secondary="install-hook for plugins" id="idm46125983927688"/><a data-type="indexterm" data-primary="install-hook script for plugins" id="idm46125983926744"/><a data-type="indexterm" data-primary="hooks" data-secondary="install-hook script for plugins" id="idm46125983926104"/><a data-type="indexterm" data-primary="plugins" data-secondary="building" data-tertiary="install-hook script" id="idm46125983925192"/><a data-type="indexterm" data-primary="plugins" data-secondary="code executed" data-tertiary="install-hook script" id="idm46125983923976"/></p>

<pre data-type="programlisting" data-code-language="bash"><code class="c">#!/usr/bin/env bash</code>

<code class="nb">set</code> -e

<code class="nv">URL</code><code class="o">=</code><code class="s2">""</code>
<code class="nv">EXTRACT_TO</code><code class="o">=</code><code class="s2">""</code>

<code class="k">if</code> <code class="o">[[</code> <code class="s2">"</code><code class="k">$(</code>uname<code class="k">)</code><code class="s2">"</code> <code class="o">=</code> <code class="s2">"Darwin"</code> <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
    <code class="nv">URL</code><code class="o">=</code><code class="s2">"https://example.com/releases/myplugin-mac"</code>
    <code class="nv">EXTRACT_TO</code><code class="o">=</code><code class="s2">"myplugin"</code>
<code class="k">elif</code> <code class="o">[[</code> <code class="s2">"</code><code class="k">$(</code>uname<code class="k">)</code><code class="s2">"</code> <code class="o">=</code> <code class="s2">"Linux"</code> <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
    <code class="nv">URL</code><code class="o">=</code><code class="s2">"https://example.com/releases/myplugin-linux"</code>
    <code class="nv">EXTRACT_TO</code><code class="o">=</code><code class="s2">"myplugin"</code>
<code class="k">else</code>
    <code class="nv">URL</code><code class="o">=</code><code class="s2">"https://example.com/releases/myplugin-windows"</code>
    <code class="nv">EXTRACT_TO</code><code class="o">=</code><code class="s2">"myplugin.exe"</code>
<code class="k">fi</code>

mkdir -p bin/
curl -sSL <code class="s2">"</code><code class="si">${</code><code class="nv">URL</code><code class="si">}</code><code class="s2">"</code> -o <code class="s2">"bin/</code><code class="si">${</code><code class="nv">EXTRACT_TO</code><code class="si">}</code><code class="s2">"</code></pre>

<p>By defining an install hook for our plugin, we can make it so that this script runs when a user installs this plugin.</p>

<p>To define a hook, add a <code>hooks</code> section to your <em>plugin.yaml</em>, <a data-type="indexterm" data-primary="plugins" data-secondary="plugin.yaml" data-tertiary="hooks" id="idm46125983854040"/><a data-type="indexterm" data-primary="YAML" data-secondary="plugin.yaml" data-tertiary="hooks" id="idm46125983852760"/>defining commands for each event you want to respond to:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nn">...</code><code>
</code><code class="nt">hooks</code><code class="p">:</code><code>
</code><code>  </code><code class="nt">install</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/install-hook.sh</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO3-1" href="#callout_helm_plugins_and_starters_CO3-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code>  </code><code class="nt">update</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/update-hook.sh</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO3-2" href="#callout_helm_plugins_and_starters_CO3-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code>  </code><code class="nt">delete</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">scripts/delete-hook.sh</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO3-3" href="#callout_helm_plugins_and_starters_CO3-3"><img src="Images/3.png" alt="3"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_helm_plugins_and_starters_CO3-1" href="#co_helm_plugins_and_starters_CO3-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>Command to run on <code>helm plugin install</code></p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO3-2" href="#co_helm_plugins_and_starters_CO3-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>Command to run on <code>helm plugin update</code></p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO3-3" href="#co_helm_plugins_and_starters_CO3-3"><img src="Images/3.png" alt="3"/></a></dt>
<dd><p>Command to run on <code>helm plugin remove</code></p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Downloader Plugins"><div class="sect2" id="downloader_plugins">
<h2>Downloader Plugins</h2>

<p>Some plugins have special functionality that allows them to be used as an alternative for downloading charts.<a data-type="indexterm" data-primary="downloader plugins" id="ch08-down2"/><a data-type="indexterm" data-primary="plugins" data-secondary="downloader plugins" id="ch08-down"/><a data-type="indexterm" data-primary="protocol handling by downloader plugins" id="ch08-down3"/><a data-type="indexterm" data-primary="security" data-secondary="downloader plugin for protocol handling" id="ch08-down4"/></p>

<p>This is useful if you are storing charts in some way that is different than a pure chart repository, or if your chart repository implementation has extra requirements.</p>

<p>A <em>downloader plugin</em> defines one (or more) protocols that, if detected on the command line, will instruct Helm to download <em>index.yaml</em> or chart <em>.tgz</em> packages using the plugin versus Helm’s internal download mechanism.</p>

<p>Here is an example of a <em>plugin.yaml</em> for a downloader plugin called “super-secure,” which registers the <code>ss://</code> protocol:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">super-secure</code><code>
</code><code class="nt">version</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">0.1.0</code><code>
</code><code class="nt">description</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">a</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">super</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">secure</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">chart</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">downloader</code><code>
</code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">${HELM_PLUGIN_DIR}/super-secure.sh</code><code class="s">"</code><code>
</code><code class="nt">downloaders</code><code class="p">:</code><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">command</code><code class="p">:</code><code> </code><code class="s">"</code><code class="s">super-secure-downloader.sh</code><code class="s">"</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO4-1" href="#callout_helm_plugins_and_starters_CO4-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code>    </code><code class="nt">protocols</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO4-2" href="#callout_helm_plugins_and_starters_CO4-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="s">"</code><code class="s">ss</code><code class="s">"</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_helm_plugins_and_starters_CO4-1" href="#co_helm_plugins_and_starters_CO4-1"><img src="Images/1.png" alt="1"/></a></dt>
<dd><p>Command to run when this plugin is invoked as a downloader</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO4-2" href="#co_helm_plugins_and_starters_CO4-2"><img src="Images/2.png" alt="2"/></a></dt>
<dd><p>Custom protocols declared by this plugin</p></dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Keep in mind that all plugins, including downloader plugins, define a custom top-level command (i.e., <code>helm super-secure</code>). The command for the plugin downloader can be identical to the 
<span class="keep-together"><code>command</code></span> field; just beware that if you wish to use the plugin as both a standard plugin and as a downloader, it might become challenging to determine how it’s being used. One way you could determine if the plugin is being used as a downloader is to check if the command is invoked with exactly four command-line arguments.</p>
</div>

<p>Downloader commands are always invoked with the following arguments:</p>

<pre data-type="programlisting">&lt;command&gt; certFile keyFile caFile full-URL</pre>

<p>The <code>certFile</code>, <code>keyFile</code>, and <code>caFile</code> arguments are derived from <a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_REPOSITORY_CONFIG" id="idm46125983681464"/><a data-type="indexterm" data-primary="HELM_REPOSITORY_CONFIG" id="idm46125983680488"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="HELM_REPOSITORY_CONFIG" id="idm46125983658152"/>entries in a YAML configuration file, whose path is returned by <code>$(helm env HELM_REPOSITORY_CONFIG)</code>, and are set when a repository is added using <code>helm repo add</code> (see <a data-type="xref" href="ch07.xhtml#chart_repositories">Chapter 7</a> for more background). The <code>full-URL</code> argument is the full URL for the resource that is being downloaded, either an <em>index.yaml</em>, or chart <em>.tgz</em>/<em>.prov</em> file.</p>

<p>Let’s check out the implementation for the <code>ss://</code> protocol downloader defined by the <code>super-secure</code> plugin:<a data-type="indexterm" data-primary="Bash scripts" data-secondary="downloader plugin" id="idm46125983653240"/><a data-type="indexterm" data-primary="scripts" data-see="Bash scripts" id="idm46125983652392"/></p>

<pre data-type="programlisting" data-code-language="bash"><code class="c">#!/usr/bin/env bash</code>
<code class="nb">set</code> -e

<code class="c"># The fourth argument is the URL to the resource to download from the repo</code>
<code class="nv">URL</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="nv">4</code><code class="si">}</code><code class="s2">"</code>

<code class="c"># Replace "ss://" with "https://"</code>
<code class="nv">URL</code><code class="o">=</code><code class="s2">"</code><code class="k">$(</code><code class="nb">echo</code> <code class="si">${</code><code class="nv">URL</code><code class="si">}</code> <code class="p">|</code> sed <code class="s1">'s/ss:/https:/'</code><code class="k">)</code><code class="s2">"</code>

<code class="c"># Request the resource using the token, outputting contents to stdout</code>
<code class="nb">echo</code> <code class="s2">"Downloading </code><code class="k">$(</code>basename <code class="si">${</code><code class="nv">URL</code><code class="si">}</code><code class="k">)</code><code class="s2"> using super-secure plugin..."</code> 1&gt;<code class="p">&amp;</code>2
curl -sL -H <code class="s2">"Authorization: Bearer </code><code class="si">${</code><code class="nv">SUPER_SECURE_TOKEN</code><code class="si">}</code><code class="s2">"</code> <code class="s2">"</code><code class="si">${</code><code class="nv">URL</code><code class="si">}</code><code class="s2">"</code></pre>

<p>This downloader allows us to use a chart repository protected with token/bearer auth. It expects that the environment variable <code>SUPER_SECURE_TOKEN</code> is set, which will be used to formulate the header <code>Authorization: Bearer &lt;token&gt;</code> used when requesting a resource from a chart repository.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>While the <code>super-secure</code> plugin is a great example of a simple downloader plugin, future versions of Helm may actually support bearer token auth out of the box.</p>
</div>

<p>Downloader plugins are expected to output the contents of the <a data-type="indexterm" data-primary="stderr for plugin logging" id="idm46125983602696"/><a data-type="indexterm" data-primary="stdout for plugin output" id="idm46125983602024"/>resource to <code>stdout</code>, so any extra logs etc. should be printed to <code>stderr</code>. This is why, in the line starting with <code>echo</code>, we redirect this message to <code>stderr</code> using <code>1&gt;&amp;2</code>.</p>

<p>Once this plugin is installed, here’s how we would add a chart repository protected by token auth:<a data-type="indexterm" data-primary="chart repositories" data-secondary="adding a chart repository" data-tertiary="token auth protection" id="idm46125983598584"/></p>

<pre data-type="programlisting">$ export SUPER_SECURE_TOKEN="abc123"
$ helm repo add my-secure-repo ss://secure.example.com
Downloading index.yaml using super-secure plugin...
"my-secure-repo" has been added to your repositories</pre>

<p>This repository URL will now show up in the local list of repositories, containing the <code>ss://</code> protocol:</p>

<pre data-type="programlisting">$ helm repo list
NAME          	URL
my-secure-repo	ss://secure.example.com</pre>

<p>Now the repository can be used just like any other repository, to download remote chart packages:</p>

<pre data-type="programlisting">$ export SUPER_SECURE_TOKEN="abc123"
$ helm pull my-secure-repo/superapp
Downloading superapp-0.1.0.tgz using super-secure plugin...
$ ls
superapp-0.1.0.tgz</pre>

<p>Downloader plugins provide a way for Helm users to extend the transfer mechanism for working with chart repositories by defining custom protocols. When Helm detects a custom protocol being used, it will attempt to locate an installed plugin that can handle it, then defers the resource request to that plugin.<a data-type="indexterm" data-startref="ch08-down" id="idm46125983592776"/><a data-type="indexterm" data-startref="ch08-down2" id="idm46125983592072"/><a data-type="indexterm" data-startref="ch08-down3" id="idm46125983591400"/><a data-type="indexterm" data-startref="ch08-down4" id="idm46125983590728"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Execution Environment"><div class="sect2" id="idm46125983816168">
<h2>Execution Environment</h2>

<p>Since plugins are meant to extend Helm’s functionality, they might <a data-type="indexterm" data-primary="plugins" data-secondary="environment variables available to" id="idm46125983588872"/><a data-type="indexterm" data-primary="environment variables" data-secondary="plugin access to" id="idm46125983587928"/>need access to some of Helm’s internal configuration files, or global flags provided on the command line.</p>

<p>To provide plugins access to this type of information, a series of known environment variables are provided to the plugin at runtime.</p>

<p>Here is a current list of all the environment variables available to plugins, in alphabetical order:</p>
<dl>
<dt><code>HELM_BIN</code></dt>
<dd>
<p>The path to the Helm command being executed<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_BIN" id="idm46125983583336"/><a data-type="indexterm" data-primary="HELM_BIN" id="idm46125983582360"/></p>
</dd>
<dt><code>HELM_DEBUG</code></dt>
<dd>
<p>Value set for the global boolean <code>--debug</code> option (“true” or “false”)<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_DEBUG" id="idm46125983579864"/><a data-type="indexterm" data-primary="HELM_DEBUG" id="idm46125983578888"/><a data-type="indexterm" data-primary="debugging and troubleshooting" data-secondary="HELM_DEBUG environment variable" id="idm46125983578216"/></p>
</dd>
<dt><code>HELM_KUBECONTEXT</code></dt>
<dd>
<p>Value set for the global <code>--kube-context &lt;context&gt;</code> option<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_KUBECONTEXT" id="idm46125983575320"/><a data-type="indexterm" data-primary="HELM_KUBECONTEXT" id="idm46125983574344"/></p>
</dd>
<dt><code>HELM_NAMESPACE</code></dt>
<dd>
<p>Value set for the global <code>--namespace &lt;namespace&gt;</code> option<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_NAMESPACE" id="idm46125983571800"/><a data-type="indexterm" data-primary="HELM_NAMESPACE" id="idm46125983570792"/><a data-type="indexterm" data-primary="namespace (Kubernetes)" data-secondary="HELM_NAMESPACE" id="idm46125983570120"/><a data-type="indexterm" data-primary="Kubernetes" data-secondary="namespace" data-tertiary="HELM_NAMESPACE" id="idm46125983569176"/></p>
</dd>
<dt><code>HELM_PLUGIN_DIR</code></dt>
<dd>
<p>Root directory of the current plugin<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_PLUGIN_DIR" id="idm46125983566504"/><a data-type="indexterm" data-primary="HELM_PLUGIN_DIR" id="idm46125983565528"/><a data-type="indexterm" data-primary="plugins" data-secondary="environment variables available to" data-tertiary="HELM_PLUGIN_DIR" id="idm46125983564856"/></p>
</dd>
<dt><code>HELM_PLUGIN_NAME</code></dt>
<dd>
<p>Name of the current plugin<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_PLUGIN_NAME" id="idm46125983562168"/><a data-type="indexterm" data-primary="HELM_PLUGIN_NAME" id="idm46125983561192"/><a data-type="indexterm" data-primary="plugins" data-secondary="environment variables available to" data-tertiary="HELM_PLUGIN_NAME" id="idm46125983560520"/></p>
</dd>
<dt><code>HELM_PLUGINS</code></dt>
<dd>
<p>Top-level directory containing all plugins<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_PLUGINS" id="idm46125983557768"/><a data-type="indexterm" data-primary="HELM_PLUGINS" id="idm46125983527960"/><a data-type="indexterm" data-primary="plugins" data-secondary="environment variables available to" data-tertiary="HELM_PLUGINS" id="idm46125983527352"/></p>
</dd>
<dt><code>HELM_REGISTRY_CONFIG</code></dt>
<dd>
<p>Root directory for registry configuration<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_REGISTRY_CONFIG" id="idm46125983524792"/><a data-type="indexterm" data-primary="HELM_REGISTRY_CONFIG" id="idm46125983523816"/></p>
</dd>
<dt><code>HELM_REPOSITORY_CACHE</code></dt>
<dd>
<p>Root directory for repository cache<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_REPOSITORY_CACHE" id="idm46125983521736"/><a data-type="indexterm" data-primary="HELM_REPOSITORY_CACHE" id="idm46125983520760"/><a data-type="indexterm" data-primary="cache for chart" data-secondary="path environment variable" id="idm46125983520088"/><a data-type="indexterm" data-primary="OCI (open container initiative) registries" data-secondary="cache" data-tertiary="path environment variable" id="idm46125983519080"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="HELM_REPOSITORY_CACHE" id="idm46125983517752"/></p>
</dd>
<dt><code>HELM_REPOSITORY_CONFIG</code></dt>
<dd>
<p>Root directory for repository configuration<a data-type="indexterm" data-primary="environment variables" data-secondary="HELM_REPOSITORY_CONFIG" id="idm46125983515400"/><a data-type="indexterm" data-primary="HELM_REPOSITORY_CONFIG" id="idm46125983514424"/><a data-type="indexterm" data-primary="chart repositories" data-secondary="HELM_REPOSITORY_CONFIG" id="idm46125983513752"/></p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Shell Completion"><div class="sect2" id="idm46125983584600">
<h2>Shell Completion</h2>

<p>Helm has built-in support for shell autocompletion for both Bash and <a data-type="indexterm" data-primary="Z shell (Zsh) autocompletion" id="idm46125983511592"/><a data-type="indexterm" data-primary="Bash scripts" data-secondary="shell autocompletion built in" id="idm46125983510840"/><a data-type="indexterm" data-primary="shells" data-secondary="autocompletion" id="idm46125983509880"/><a data-type="indexterm" data-primary="completion command" id="idm46125983508936"/>Z shell (Zsh) (see <code>helm completion --help</code>). This is helpful in situations where you cannot remember the name of a subcommand or flag you are attempting to use.</p>

<p>Plugins also have the ability to supply their own custom shell completions by using one of two methods: static autocompletion and dynamic completion.</p>










<section data-type="sect3" data-pdf-bookmark="Static autocompletion"><div class="sect3" id="idm46125983506888">
<h3>Static autocompletion</h3>

<p>By including a file called <em>completion.yaml</em> in the root of the plugin<a data-type="indexterm" data-primary="plugins" data-secondary="completions" data-tertiary="static autocompletion" id="idm46125983504760"/><a data-type="indexterm" data-primary="completion.yaml file" id="idm46125983503512"/><a data-type="indexterm" data-primary="completion.yaml file" data-secondary="shell completions" id="idm46125983502840"/><a data-type="indexterm" data-primary="static autocompletion" id="idm46125983501896"/><a data-type="indexterm" data-primary="completions by plugins" data-secondary="static autocompletion" id="idm46125983501224"/> directory, Helm plugins can specify all of the expected flags and commands available for the plugin statically.</p>

<p>Here is an example <em>completion.yaml</em> for an imaginary <code>zoo</code> plugin:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">zoo</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO5-1" href="#callout_helm_plugins_and_starters_CO5-1"><img src="Images/1.png" alt="1"/></a><code>
</code><code class="nt">flags</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO5-2" href="#callout_helm_plugins_and_starters_CO5-2"><img src="Images/2.png" alt="2"/></a><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">disable-smells</code><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">disable-snacks</code><code>
</code><code class="nt">commands</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO5-3" href="#callout_helm_plugins_and_starters_CO5-3"><img src="Images/3.png" alt="3"/></a><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">price</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO5-4" href="#callout_helm_plugins_and_starters_CO5-4"><img src="Images/4.png" alt="4"/></a><code>
</code><code>    </code><code class="nt">flags</code><code class="p">:</code><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">kids-discount</code><code>
</code><code>  </code><code class="p-Indicator">-</code><code> </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">animals</code><code>
</code><code>    </code><code class="nt">commands</code><code class="p">:</code><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">list</code><code>
</code><code>        </code><code class="nt">validArgs</code><code class="p">:</code><code> </code><a class="co" id="co_helm_plugins_and_starters_CO5-5" href="#callout_helm_plugins_and_starters_CO5-5"><img src="Images/5.png" alt="5"/></a><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">birds</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">reptiles</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">cats</code><code>
</code><code>      </code><code class="p-Indicator">-</code><code> </code><code class="nt">name</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">describe</code><code>
</code><code>        </code><code class="nt">flags</code><code class="p">:</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">format-json</code><code>
</code><code>        </code><code class="nt">validArgs</code><code class="p">:</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">birds</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">reptiles</code><code>
</code><code>          </code><code class="p-Indicator">-</code><code> </code><code class="l-Scalar-Plain">cats</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_helm_plugins_and_starters_CO5-1" href="#co_helm_plugins_and_starters_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The name of the plugin that this completion file is for</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO5-2" href="#co_helm_plugins_and_starters_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>A list of flags available (Note: these should not include a  <code>-</code> or <code>--</code> prefix)</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO5-3" href="#co_helm_plugins_and_starters_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>A list of subcommands available</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO5-4" href="#co_helm_plugins_and_starters_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Name of an individual subcommand</p></dd>
<dt><a class="co" id="callout_helm_plugins_and_starters_CO5-5" href="#co_helm_plugins_and_starters_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>A list of valid options for the first parameter following a subcommand</p></dd>
</dl>

<p>Underneath the top-level <code>commands</code> section, another <code>commands</code> section can be specified for nested subcommands (and recursively as many times as necessary). Each command in a <code>commands</code> section can contain its own list of <code>flags</code> and <code>validArgs</code>.</p>

<p>Helm’s global flags, such as <code>--debug</code> or <code>--namespace</code>, are already handled by Helm’s built-in shell completion, so it is not necessary to list these under <code>flags</code>.</p>

<p>If we begin trying to run the example <code>zoo</code> plugin, then press the Tab key, it should show us all of the available subcommands:</p>

<pre data-type="programlisting">$ helm zoo  # (click tab)
animals  price</pre>

<p>Now if we do the same, but add a <code>--disable-s</code> suffix prior to pressing the Tab key, we should see our flags:</p>

<pre data-type="programlisting">$ helm zoo --disables-s  # (click tab)
--disable-smells  --disable-snacks</pre>

<p>Using static completion, we are able to achieve parity with Helm’s existing shell completions, making plugins feel even more tightly integrated with the Helm user 
<span class="keep-together">experience</span>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you are in the process of developing a plugin, you must open a new terminal window for static shell completions to be refreshed.</p>

<p>Alternatively, you can run one of the following to get the latest completions in the current terminal:</p>

<pre data-type="programlisting">source &lt;(helm completion bash) # for Bash
source &lt;(helm completion zsh)  # for Z shell</pre>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Dynamic completion"><div class="sect3" id="idm46125983506264">
<h3>Dynamic completion</h3>

<p>In some cases, the valid arguments for a given command may not be known ahead of time.<a data-type="indexterm" data-primary="plugins" data-secondary="completions" data-tertiary="dynamic completion" id="idm46125983342456"/><a data-type="indexterm" data-primary="dynamic completion" id="idm46125983341368"/><a data-type="indexterm" data-primary="completions by plugins" data-secondary="dynamic completion" id="idm46125983340760"/> For example, you may want to provide a list of Helm release names in your cluster as valid arguments for your plugin. This can be achieved using dynamic 
<span class="keep-together">completion</span>.</p>

<p>To enable dynamic completion, include an executable file <a data-type="indexterm" data-primary="plugin.complete file" id="idm46125983338600"/>named <em>plugin.complete</em> in the root of the plugin directory. This file can be any type of executable; for example, a shell script or binary.</p>

<p>For plugins containing a <em>plugin.complete</em> file, when completion is requested (i.e., pressing the Tab key), Helm will run this executable, passing along the text that needs completion as the first argument. This program should then return a list of possible results, each separated by a new line, and exit successfully (i.e., return code 0).</p>

<p>You might even decide to supply this completion functionality as part of the primary plugin program, using a simple wrapper script to trigger it using a flag such as 
<span class="keep-together"><code>--complete</code></span>. Here is an example of a basic <em>plugin.complete</em> executable that does just this:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="c">#!/usr/bin/env sh</code>
<code class="nv">$HELM_PLUGIN_DIR</code>/my-plugin-program --complete <code class="s2">"</code><code class="nv">$@</code><code class="s2">"</code></pre>

<p>Building on the <code>zoo</code> plugin example, let’s say the list of available animal categories is constantly changing and stored in a file called <em>animals.txt</em> in the user’s home directory. Here’s what <em>animals.txt</em> might look like:</p>

<pre data-type="programlisting">birds
reptiles
cats</pre>

<p>We want to be able to dynamically provide completion based on the contents of this file. Here is an example of a <em>plugin.complete</em> executable (Bash script) that could be used to provide dynamic completion:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="c">#!/usr/bin/env bash</code>
<code class="nb">set</code> -e
<code class="nv">INPUT</code><code class="o">=</code><code class="s2">"</code><code class="si">${</code><code class="p">@</code><code class="si">}</code><code class="s2">"</code>
<code class="k">if</code> <code class="o">[[</code> <code class="s2">"</code><code class="si">${</code><code class="nv">INPUT</code><code class="si">}</code><code class="s2">"</code> <code class="o">==</code> <code class="s2">"animals list"</code>* <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
    <code class="nv">INPUT</code><code class="o">=</code><code class="s2">"</code><code class="k">$(</code><code class="nb">echo</code> <code class="s2">"</code><code class="si">${</code><code class="nv">INPUT</code><code class="si">}</code><code class="s2">"</code> <code class="p">|</code> sed -e <code class="s1">'s/^animals list //'</code><code class="k">)</code><code class="s2">"</code>
    <code class="k">for</code> flag in <code class="k">$(</code>cat <code class="s2">"</code><code class="si">${</code><code class="nv">HOME</code><code class="si">}</code><code class="s2">/animals.txt"</code><code class="k">)</code><code class="p">;</code> <code class="k">do</code>
        <code class="k">if</code> <code class="o">[[</code> <code class="s2">"</code><code class="si">${</code><code class="nv">flag</code><code class="si">}</code><code class="s2">"</code> <code class="o">==</code> <code class="s2">"</code><code class="si">${</code><code class="nv">INPUT</code><code class="si">}</code><code class="s2">"</code>* <code class="o">]]</code><code class="p">;</code> <code class="k">then</code>
            <code class="nb">echo</code> <code class="s2">"</code><code class="si">${</code><code class="nv">flag</code><code class="si">}</code><code class="s2">"</code>
        <code class="k">fi</code>
    <code class="k">done</code>
<code class="k">fi</code></pre>

<p>Now if we run the plugin and type in <code>animals list</code>, then press the Tab key, it should show us a list of all the available animal categories for listing:</p>

<pre data-type="programlisting">$ helm zoo animals list  # (press Tab key)
birds     cats      reptiles</pre>

<p>To ensure it’s dynamic, let’s add an extra category “monkeys” to <em>animals.txt</em> and try again:</p>

<pre data-type="programlisting">$ echo "monkeys" &gt;&gt; "${HOME}/animals.txt"
$ helm zoo animals list  # (press Tab key)
birds     cats      monkeys   reptiles</pre>

<p>It works!</p>

<p>This is just a simple example of using dynamic completion, but keep in mind that you could also query something remote, such as resources in your Kubernetes cluster, making this a powerful feature for plugins.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you are already using static completion using a <em>completion.yaml</em> file, then<a data-type="indexterm" data-primary="static autocompletion" id="idm46125983211480"/><a data-type="indexterm" data-primary="plugin.complete file" id="idm46125983210744"/><a data-type="indexterm" data-primary="YAML" data-secondary="completion.yaml file" id="idm46125983210072"/><a data-type="indexterm" data-primary="completion.yaml file" id="idm46125983209128"/> dynamic completion is not used, even if a 
<span class="keep-together"><code>plugin.complete</code></span> executable is present in the plugin’s root 
<span class="keep-together">directory</span>.</p>
</div>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Starters"><div class="sect1" id="idm46125984551640">
<h1>Starters</h1>

<p>Starters, or starter packs, are similar to Helm charts, except that <a data-type="indexterm" data-primary="starters" data-secondary="about" id="idm46125983205352"/>they are meant to be used as templates for new charts.</p>

<p>When you use the <code>helm create</code> command to create a new chart, this generates a new chart using Helm’s built-in starter, which is a general-purpose chart using best 
<span class="keep-together">practices</span>.</p>

<p>To specify a custom starter, you can use the <code>--starter</code> option when creating a new chart:<a data-type="indexterm" data-primary="create command" data-secondary="starters" id="idm46125983201576"/><a data-type="indexterm" data-primary="charts" data-secondary="building" data-tertiary="starters" id="idm46125983200600"/></p>

<pre data-type="programlisting">$ helm create --starter basic-webapp superapp</pre>

<p>Using starters allows us to leverage a chart that has been previously built for an application with a similar purpose. This is useful for bootstrapping new projects with similar requirements to be instantly ready to deploy to your Kubernetes environment.</p>








<section data-type="sect2" data-pdf-bookmark="Converting a Chart to a Starter"><div class="sect2" id="idm46125983197848">
<h2>Converting a Chart to a Starter</h2>

<p>Any Helm chart can be converted into a starter. The only thing that <a data-type="indexterm" data-primary="starters" data-secondary="converting chart to" id="idm46125983196312"/><a data-type="indexterm" data-primary="charts" data-secondary="starters converted from" id="idm46125983195336"/><a data-type="indexterm" data-primary="ConfigMaps (Kubernetes)" data-secondary="converting to starter" id="idm46125983194392"/><a data-type="indexterm" data-primary="templates" data-secondary="starter dynamic references" data-seealso="starters" id="idm46125983193448"/>separates a starter from a standard chart is the presence of dynamic references to the chart name in a starter’s templates.</p>

<p>To convert a standard chart into a starter, replace any hardcoded <a data-type="indexterm" data-primary="names" data-secondary="starters" data-tertiary="converting chart to starter" id="idm46125983191608"/>references to the chart’s name with the string <code>&lt;CHARTNAME&gt;</code>.</p>

<p>To demonstrate, let’s take this simple ConfigMap template from a chart called <em>mychart</em>:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">kind</code><code class="p">:</code> <code class="l-Scalar-Plain">ConfigMap</code>
<code class="nt">metadata</code><code class="p">:</code>
  <code class="nt">name</code><code class="p">:</code> <code class="p-Indicator">{{</code> <code class="nv">include "mychart.fullname" .</code> <code class="p-Indicator">}}</code>
  <code class="nt">labels</code><code class="p">:</code>
    <code class="p-Indicator">{{</code><code class="nv">- include "mychart.labels" . | nindent 4</code> <code class="p-Indicator">}}</code>
<code class="nt">data</code><code class="p">:</code>
  <code class="nt">hello</code><code class="p">:</code> <code class="p-Indicator">{{</code> <code class="nv">.Values.hello | quote</code> <code class="p-Indicator">}}</code></pre>

<p>Here’s what that template would look like instead in a starter:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">apiVersion</code><code class="p">:</code> <code class="l-Scalar-Plain">v1</code>
<code class="nt">kind</code><code class="p">:</code> <code class="l-Scalar-Plain">ConfigMap</code>
<code class="nt">metadata</code><code class="p">:</code>
  <code class="nt">name</code><code class="p">:</code> <code class="p-Indicator">{{</code> <code class="nv">include "&lt;CHARTNAME&gt;.fullname" .</code> <code class="p-Indicator">}}</code>
  <code class="nt">labels</code><code class="p">:</code>
    <code class="p-Indicator">{{</code><code class="nv">- include "&lt;CHARTNAME&gt;.labels" . | nindent 4</code> <code class="p-Indicator">}}</code>
<code class="nt">data</code><code class="p">:</code>
  <code class="nt">hello</code><code class="p">:</code> <code class="p-Indicator">{{</code> <code class="nv">.Values.hello | quote</code> <code class="p-Indicator">}}</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This chart must still contain a <em>Chart.yaml</em> file to work; however, it will be overwritten by the generator.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Making Starters Available to Helm"><div class="sect2" id="idm46125983085576">
<h2>Making Starters Available to Helm</h2>

<p>Before using a starter, you must first decide on a unique name for it, <a data-type="indexterm" data-primary="namespace (Kubernetes)" data-secondary="names unique within" data-tertiary="starters" id="idm46125983084312"/><a data-type="indexterm" data-primary="starters" data-secondary="making available to Helm" id="idm46125983083064"/><a data-type="indexterm" data-primary="names" data-secondary="starters" data-tertiary="unique name for" id="idm46125983082152"/>for example “basic-webapp” for a starter containing boilerplate templates for deploying a basic web application.</p>

<p>To make this starter a valid option to be used when the <code>--starter</code> flag is specified on the command line, it must exist as a directory under the filepath 
<span class="keep-together"><code>$(helm env HELM_DATA_HOME)/starters</code></span>.</p>

<p>If this is the first starter you are adding, ensure that the top-level <em>starters</em> directory first exists:</p>

<pre data-type="programlisting">$ export HELM_STARTERS="$(helm env HELM_DATA_HOME)/starters"
$ mkdir -p "${HELM_STARTERS}"</pre>

<p>Then just copy the entire <em>basic-webapp</em> directory into that top-level directory:</p>

<pre data-type="programlisting">cp -r basic-webapp "${HELM_STARTERS}"</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Starters"><div class="sect2" id="idm46125983075672">
<h2>Using Starters</h2>

<p>Once a starter is available, you can generate new charts based on it <a data-type="indexterm" data-primary="starters" data-secondary="using" id="idm46125983074104"/><a data-type="indexterm" data-primary="create command" data-secondary="starters" id="idm46125983073128"/><a data-type="indexterm" data-primary="names" data-secondary="starters" data-tertiary="using starters" id="idm46125983072184"/>by referencing its name on the command line:</p>

<pre data-type="programlisting">$ helm create --starter basic-webapp superapp
Creating superapp</pre>

<p>The structure of the newly generated chart will be identical to that of the starter. All references to <code>&lt;CHARTNAME&gt;</code> in the starter’s templates will be replaced with the new chart’s name (i.e., <em>superapp</em>).</p>

<p>Here’s an example directory structure for a generated chart based on a starter that has only two templates defined, <em>deployment.yaml</em> and <em>service.yaml</em>:</p>

<pre data-type="programlisting">$ tree superapp/
superapp/
├── Chart.yaml
├── templates
│   ├── _helpers.tpl
│   ├── deployment.yaml
│   └── service.yaml
└── values.yaml</pre>

<p>From here, you could check this new chart into version control and start making changes to customize it for the given application.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Extending Helm Further"><div class="sect1" id="idm46125983065768">
<h1>Extending Helm Further</h1>

<p>In this chapter, we have discussed how Helm can be extended using plugins and starters. However, there is one other way in which you can extend Helm: via open source contributions.<a data-type="indexterm" data-primary="open source tools" data-secondary="contributions to" id="idm46125983064360"/></p>

<p>Everything in this book has been a reflection of thousands of open source contributions to the Helm project. While much of this work has been performed by maintainers (past and present), the majority of contributions have come from individuals around the world. This includes not only changes to the Go source code, but also testing and documentation updates.</p>

<p>Do you have something to contribute to the Helm project? Navigate to the <a href="https://oreil.ly/9TloH">Helm community landing page</a> to learn more!<a data-type="indexterm" data-primary="Helm" data-secondary="online community" id="idm46125983061432"/><a data-type="indexterm" data-primary="online community" id="idm46125983060456"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="online community" id="idm46125983059784"/></p>
</div></section>







</div></section></div></body></html>