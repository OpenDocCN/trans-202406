<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section data-type="chapter" epub:type="chapter" class="calibre4" data-pdf-bookmark="Chapter 1. Creating Applications"><div class="preface" id="chapter01">
<h1 class="calibre9"><span class="label">Chapter 1. </span>Creating Applications</h1>


<p class="author1">React is a surprisingly adaptable development framework.<a data-type="indexterm" data-primary="applications, creating" id="ix_apps" class="calibre6"/> Developers use it to create large JavaScript-heavy Single-Page Applications
(SPAs) or to build surprisingly small plug-ins. You can use it to embed code inside a Rails application or generate a content-rich website.</p>

<p class="author1">In this chapter, we look at the various ways of creating a React application. We also look at some of the more valuable tools you
might want to add to your development cycle. Few people now create their JavaScript projects from scratch.<a data-type="indexterm" data-primary="JavaScript" data-secondary="application development" id="idm46634448144584" class="calibre6"/> Doing so is a tedious process, involving an uncomfortable amount of tinkering and configuration. The good news is that you can use a tool to
generate the code you need in almost every case.</p>

<p class="author1">Let’s take a whistle-stop tour of the many ways of starting your React journey, beginning with the one most frequently used:
<code class="calibre21">create-react-app</code>.</p>






<section data-type="sect1" data-pdf-bookmark="Generate a Simple Application" class="calibre4"><div class="preface" id="ch01-01">
<h1 class="calibre17">Generate a Simple Application</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634448140712">
<h2 class="calibre27">Problem</h2>

<p class="author1">React projects are challenging to create and configure from scratch. <a data-type="indexterm" data-primary="applications, creating" data-secondary="simple application" id="ix_appssim" class="calibre6"/>Not only are there numerous design choices to make—which
libraries to include, which tools to use, which language features to enable—but manually created applications will, by their nature,
differ from one another.<a data-type="indexterm" data-primary="projects (React), tool for building SPAs" id="idm46634448137688" class="calibre6"/> Project idiosyncrasies increase the time it takes a new developer to become productive.<a data-type="indexterm" data-primary="SPAs" data-see="Single-Page Applications" id="idm46634448136744" class="calibre6"/></p>
</div></section>













<section data-type="sect2" class="calibre4" data-pdf-bookmark="Solution"><div class="preface" id="idm46634448135528">
<h2 class="calibre27">Solution</h2>

<p class="author1"><code class="calibre21">create-react-app</code> is a tool for building SPAs with a standard structure and a good set of default options. Generated projects use
the React Scripts library to build, test, and run the code. Projects have a standard Webpack configuration and a standard set of
language features enabled.<a data-type="indexterm" data-primary="create-react-app tool" id="ix_CRAtool" class="calibre6"/><a data-type="indexterm" data-primary="Single-Page Applications (SPAs)" data-secondary="generating with create-react-app" id="ix_SPAsgen" class="calibre6"/><a data-type="indexterm" data-primary="Webpack configuration" id="idm46634448130392" class="calibre6"/><a data-type="indexterm" data-primary="React Scripts library" id="idm46634448129720" class="calibre6"/></p>

<p class="author1">Any developer who has worked on one <code class="calibre21">create-react-app</code> application instantly feels at home with any other. They understand the
project structure and know which language features they can use. It is simple to use and contains all the features that a typical
application requires: from Babel configuration and file loaders to testing libraries and a development server.</p>

<p class="author1">If you’re new to React, or need to create a generic SPA with the minimum of fuss, then you should consider creating your app with
<code class="calibre21">create-react-app</code>.</p>

<p class="author1">You can choose to install the <code class="calibre21">create-react-app</code> command globally on your machine, but this is now discouraged.<a data-type="indexterm" data-primary="npx command" data-secondary="calling create-react-app via" id="idm46634447813960" class="calibre6"/> Instead, you should
create a new project by calling <code class="calibre21">create-react-app</code> via <code class="calibre21">npx</code>. Using <code class="calibre21">npx</code> ensures you’re building your application with the latest
version of <code class="calibre21">create-react-app</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-react-app my-app</code></pre>

<p class="author1">This command creates a new project directory called <em class="calibre7">my-app</em>. By default, the application uses JavaScript. <a data-type="indexterm" data-primary="JavaScript" data-secondary="default language for create-react-app" id="idm46634446599992" class="calibre6"/><a data-type="indexterm" data-primary="TypeScript" data-secondary="generating applications with create-react-app" id="idm46634447034760" class="calibre6"/>If you want to use
TypeScript as your development language, <code class="calibre21">create-react-app</code> provides that as an option:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-react-app --template typescript my-app</code></pre>

<p class="author1">Facebook developed <code class="calibre21">create-react-app</code>, so it should come as no surprise that if you have the <code class="calibre21">yarn</code> package manager installed, then
your new project will use <code class="calibre21">yarn</code> by default.<a data-type="indexterm" data-primary="yarn package manager" data-secondary="use with create-react-script" id="idm46634443422568" class="calibre6"/><a data-type="indexterm" data-primary="npm" data-secondary="using with create-react-app" id="idm46634443978088" class="calibre6"/> To use <code class="calibre21">npm</code>, you can either specify the <code class="calibre21">--use-npm</code> flag or change into the directory
and remove the <em class="calibre7">yarn.lock</em> file and then rerun the install with <code class="calibre21">npm</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ rm yarn.lock</code>
<code class="go">$ npm install</code></pre>

<p class="author1">To start your application, run the <code class="calibre21">start</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm start # or yarn start</code></pre>

<p class="author1">This command launches a server on port 3000 and opens a browser at the home page, as shown in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_1" class="calibre6">Figure 1-1</a>.</p>

<figure class="calibre29"><div id="ch01_image_1" class="figure">
<h6 class="calibre30"><span class="firstname">Figure 1-1. </span>The generated front page</h6>
</div></figure>

<p class="author1">The server delivers your application as a single, large bundle of JavaScript. The code mounts all of its components inside this
<code class="calibre21">&lt;div/&gt;</code> in <em class="calibre7">public/index.html</em>:</p>

<pre data-type="programlisting" data-code-language="html" class="calibre28"><code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"root"</code><code class="nt">&gt;&lt;/div&gt;</code></pre>

<p class="author1">The code to generate the components begins in the <em class="calibre7">src/index.js</em> file (<em class="calibre7">src/index.tsx</em> if you’re using TypeScript):</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">ReactDOM</code> <code class="nx">from</code> <code class="s">'react-dom'</code>
<code class="kr">import</code> <code class="s">'./index.css'</code>
<code class="kr">import</code> <code class="nx">App</code> <code class="nx">from</code> <code class="s">'./App'</code>
<code class="kr">import</code> <code class="nx">reportWebVitals</code> <code class="nx">from</code> <code class="s">'./reportWebVitals'</code>

<code class="nx">ReactDOM</code><code class="go">.</code><code class="nx">render</code><code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">React</code><code class="go">.</code><code class="na">StrictMode</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">App</code> <code class="go">/&gt;</code>
  <code class="go">&lt;/</code><code class="nt">React</code><code class="go">.</code><code class="na">StrictMode</code><code class="go">&gt;,</code>
  <code class="nb">document</code><code class="go">.</code><code class="nx">getElementById</code><code class="go">(</code><code class="s">'root'</code><code class="go">)</code>
<code class="go">)</code>

<code class="c">// If you want to start measuring performance in your app, pass a function</code>
<code class="c">// to log results (for example: reportWebVitals(console.log))</code>
<code class="c">// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals</code>
<code class="nx">reportWebVitals</code><code class="go">()</code></pre>

<p class="author1">This file does little more than render a single component called <code class="calibre21">&lt;App/&gt;</code>, which it imports from <em class="calibre7">App.js</em> (or <em class="calibre7">App.tsx</em>) in the same
directory:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">logo</code> <code class="nx">from</code> <code class="s">'./logo.svg'</code>
<code class="kr">import</code> <code class="s">'./App.css'</code>

<code class="kr">function</code> <code class="nx">App</code><code class="go">()</code> <code class="go">{</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"App"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">header</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-header"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">img</code> <code class="na">src</code><code class="o">=</code><code class="go">{</code><code class="nx">logo</code><code class="go">}</code> <code class="na">className</code><code class="o">=</code><code class="s">"App-logo"</code> <code class="na">alt</code><code class="o">=</code><code class="s">"logo"</code> <code class="go">/&gt;</code>
        <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
          <code class="nx">Edit</code> <code class="go">&lt;</code><code class="nt">code</code><code class="go">&gt;</code><code class="nx">src</code><code class="o">/</code><code class="nx">App</code><code class="go">.</code><code class="nx">js</code><code class="go">&lt;/</code><code class="nt">code</code><code class="go">&gt;</code> <code class="nx">and</code> <code class="nx">save</code> <code class="nx">to</code> <code class="nx">reload</code><code class="go">.</code>
        <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">a</code>
          <code class="na">className</code><code class="o">=</code><code class="s">"App-link"</code>
          <code class="na">href</code><code class="o">=</code><code class="s">"https://reactjs.org"</code>
          <code class="na">target</code><code class="o">=</code><code class="s">"_blank"</code>
          <code class="na">rel</code><code class="o">=</code><code class="s">"noopener noreferrer"</code>
        <code class="go">&gt;</code>
          <code class="nx">Learn</code> <code class="nx">React</code>
        <code class="go">&lt;/</code><code class="nt">a</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">header</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">App</code></pre>

<p class="author1">If you edit this file while the application is <code class="calibre21">start</code>-ed, the page in the browser automatically updates.</p>

<p class="author1">When you’re ready to ship the code to production, you need to generate a set of static files that you can deploy on a standard web
server.<a data-type="indexterm" data-primary="build script (create-react-app)" id="idm46634442155672" class="calibre6"/> To do this, run the <code class="calibre21">build</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run build</code></pre>

<p class="author1">The <code class="calibre21">build</code> script creates a <em class="calibre7">build</em> directory and then publishes a set of static files (see <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_2" class="calibre6">Figure 1-2</a>).</p>

<figure class="calibre29"><div id="ch01_image_2" class="figure">
<img src="Images/recb_0102.png" alt="" class="calibre31"/>
<h6 class="calibre30"><span class="firstname">Figure 1-2. </span>The generated contents in the build directory</h6>
</div></figure>

<p class="author1">The build copies many of these files from the <em class="calibre7">public/</em> directory. The code for the app is transpiled into browser-compatible
JavaScript and stored in one or more files in the <em class="calibre7">static/js</em> directory. Stylesheets used by the application are stitched together
and stored in <em class="calibre7">static/css</em>. Several of the files have hashed IDs added to them so that when you deploy your application, browsers
download the latest code rather than some old cached version.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634448134616">
<h2 class="calibre27">Discussion</h2>

<p class="author1"><code class="calibre21">create-react-app</code> is not just a tool for generating a new application but also a platform to keep your React application up-to-date
with the latest tools and libraries.<a data-type="indexterm" data-primary="create-react-app tool" data-secondary="keeping your application up to date" id="idm46634442147928" class="calibre6"/> You can upgrade the <code class="calibre21">react-scripts</code> library as you would any other: by changing the version
number and rerunning <code class="calibre21">npm install</code>. You don’t need to manage a list of Babel plugins or postcss libraries, or maintain a complex
<em class="calibre7">webpack.config.js</em> file. The <code class="calibre21">react-scripts</code> library manages them all for you.<a data-type="indexterm" data-primary="Webpack configuration" data-secondary="keeping config file updated with create-react-app" id="idm46634442145160" class="calibre6"/></p>

<p class="author1">The configuration is all still there, of course, but buried deep within the <em class="calibre7">react-scripts</em> directory. In there, you will
find the <em class="calibre7">webpack.config.js</em> file, containing all the Babel configuration and file loaders that your application will use.<a data-type="indexterm" data-primary="React Scripts library" data-secondary="keeping updated with create-react-app" id="idm46634442142888" class="calibre6"/> Because it’s a
library, you can update React Scripts just as you would any other dependency.</p>

<p class="author1">If, however, you later decide to manage all of this yourself, you’re free to do so.<a data-type="indexterm" data-primary="ejecting applications" id="idm46634442141320" class="calibre6"/> If you eject the application, then everything
comes back under your control:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run eject</code></pre>

<p class="author1">However, this is a one-time-only change. Once you have ejected your application, there is no going back. You should think carefully
before ever ejecting an application. You may find that the configuration you need is already available. For example, developers
would often eject an application to switch to using TypeScript. The <code class="calibre21">--template typescript</code> option now removes the need for that.</p>

<p class="author1">Another common reason for ejecting was to proxy web services.<a data-type="indexterm" data-primary="APIs" data-secondary="React apps connecting to, proxying in create-react-app" id="idm46634442136936" class="calibre6"/><a data-type="indexterm" data-primary="proxies" data-secondary="proxying web services" id="idm46634442135960" class="calibre6"/> React apps often need to connect to some separate API backend.
Developers used to do this by configuring Webpack to proxy a remote server through the local development server.<a data-type="indexterm" data-primary="JSON" data-secondary="setting proxy in package.json file" id="idm46634442097000" class="calibre6"/> You can now avoid
doing this by setting a proxy in the <em class="calibre7">package.json</em> file:</p>

<pre data-type="programlisting" data-code-language="json" class="calibre28"><code class="s">"proxy"</code><code class="err">:</code> <code class="s">"http://myapiserver"</code><code class="err">,</code></pre>

<p class="author1">If your code now contacts a URL that the server cannot find locally (<em class="calibre7">/api/thing</em>), the <code class="calibre21">react-scripts</code> automatically proxies
these requests to <em class="calibre7">http://myapiserver/api/thing</em>.</p>
<div data-type="tip" class="calibre25">
<p class="author1">If you can, avoid ejecting your application. Look through the <a href="https://oreil.ly/99Ied" class="calibre6"><code class="calibre21">create-react-app</code> documentation</a> to see if you can make the change some other way.</p>
</div>

<p class="author1">You can download the source for this recipe in <a href="https://oreil.ly/UK0dZ" class="calibre6">JavaScript</a> or <a href="https://oreil.ly/oOSo9" class="calibre6">TypeScript</a> from the 
<span class="firstname">GitHub</span> site.<a data-type="indexterm" data-primary="GitHub repository for this book" id="idm46634442102616" class="calibre6"/><a data-type="indexterm" data-primary="Single-Page Applications (SPAs)" data-secondary="generating with create-react-app" data-startref="ix_SPAsgen" id="idm46634442101912" class="calibre6"/><a data-type="indexterm" data-primary="create-react-app tool" data-startref="ix_CRAtool" id="idm46634442112968" class="calibre6"/><a data-type="indexterm" data-primary="applications, creating" data-secondary="simple application" data-startref="ix_appssim" id="idm46634442112024" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Build Content-Rich Apps with Gatsby" class="calibre4"><div class="preface" id="ch01-02">
<h1 class="calibre17">Build Content-Rich Apps with Gatsby</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634442109512">
<h2 class="calibre27">Problem</h2>

<p class="author1"><em class="calibre7">Content-rich</em> sites like blogs and online stores need to serve large amounts of complex content efficiently.<a data-type="indexterm" data-primary="applications, creating" data-secondary="content-rich sites, using Gatsby" id="ix_appsCR" class="calibre6"/><a data-type="indexterm" data-primary="content-rich apps, generating with Gatsby" id="ix_CRAsgenGat" class="calibre6"/><a data-type="indexterm" data-primary="Gatsby" data-secondary="building content-rich apps with" id="ix_GatsCRA" class="calibre6"/> A tool like
<code class="calibre21">create-react-app</code> is not suitable for this kind of website because it delivers everything as a single large bundle of JavaScript
that a browser must download before anything displays.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634442050248">
<h2 class="calibre27">Solution</h2>

<p class="author1">If you are building a content-rich site, consider using Gatsby.</p>

<p class="author1">Gatsby focuses on loading, transforming, and delivering content in the most efficient way possible. It can generate static versions
of web pages, which means that the response times of Gatsby sites are often significantly slower than, say, those built with
<code class="calibre21">create-react-app</code>.</p>

<p class="author1">Gatsby has many plugins that can load and transform data efficiently from static local data, GraphQL sources, and third-party
content management systems such as 
<span class="firstname">WordPress</span>.</p>

<p class="author1">You can install <code class="calibre21">gatsby</code> globally, but you <a data-type="indexterm" data-primary="npx command" data-secondary="running Gatsby with" id="idm46634442044888" class="calibre6"/>can also run it via the <code class="calibre21">npx</code> command:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx gatsby new my-app</code></pre>

<p class="author1">The <code class="calibre21">gatsby new</code> command creates a new project in a subdirectory called <em class="calibre7">my-app</em>. The first time you run this command, it asks which
package manager to use: either <code class="calibre21">yarn</code> or <code class="calibre21">npm</code>.</p>

<p class="author1">To start your application, change into the new directory and run it in development mode:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ npm run develop</code></pre>

<p class="author1">You can then open your application at <em class="calibre7">http://localhost:8000</em>, as shown in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_3" class="calibre6">Figure 1-3</a>.</p>

<figure class="calibre29"><div id="ch01_image_3" class="figure">
<img src="Images/recb_0103.png" alt="" class="calibre32"/>
<h6 class="calibre30"><span class="firstname">Figure 1-3. </span>Gatsby page at <span class="firstname">http://localhost:8000</span></h6>
</div></figure>

<p class="author1">Gatsby projects have a straightforward structure, as shown in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_4" class="calibre6">Figure 1-4</a>.</p>

<figure class="calibre29"><div id="ch01_image_4" class="figure">
<img src="Images/recb_0104.png" alt="" class="calibre33"/>
<h6 class="calibre30"><span class="firstname">Figure 1-4. </span>The Gatsby directory structure</h6>
</div></figure>

<p class="author1">The core <a data-type="indexterm" data-primary="Gatsby" data-secondary="building content-rich apps with" data-tertiary="directory structure" id="idm46634441982744" class="calibre6"/>of the application lives under the <em class="calibre7">src</em> directory. Each page within a Gatsby app has its own React component. This is the
front page of the default application in <em class="calibre7">index.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">"react"</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">Link</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">"gatsby"</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">StaticImage</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">"gatsby-plugin-image"</code>

<code class="kr">import</code> <code class="nx">Layout</code> <code class="nx">from</code> <code class="s">"../components/layout"</code>
<code class="kr">import</code> <code class="nx">Seo</code> <code class="nx">from</code> <code class="s">"../components/seo"</code>

<code class="kr">const</code> <code class="nx">IndexPage</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">(</code>
  <code class="go">&lt;</code><code class="nt">Layout</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">Seo</code> <code class="na">title</code><code class="o">=</code><code class="s">"Home"</code> <code class="go">/&gt;</code>
    <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Hi</code> <code class="nx">people</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Welcome</code> <code class="nx">to</code> <code class="nx">your</code> <code class="kr">new</code> <code class="nx">Gatsby</code> <code class="nx">site</code><code class="go">.&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">Now</code> <code class="nx">go</code> <code class="nx">build</code> <code class="nx">something</code> <code class="nx">great</code><code class="go">.&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">StaticImage</code>
      <code class="na">src</code><code class="o">=</code><code class="s">"../images/gatsby-astronaut.png"</code>
      <code class="na">width</code><code class="o">=</code><code class="go">{</code><code class="mi">300</code><code class="go">}</code>
      <code class="na">quality</code><code class="o">=</code><code class="go">{</code><code class="mi">95</code><code class="go">}</code>
      <code class="na">formats</code><code class="o">=</code><code class="go">{[</code><code class="s">"AUTO"</code><code class="go">,</code> <code class="s">"WEBP"</code><code class="go">,</code> <code class="s">"AVIF"</code><code class="go">]}</code>
      <code class="na">alt</code><code class="o">=</code><code class="s">"A Gatsby astronaut"</code>
      <code class="na">style</code><code class="o">=</code><code class="go">{{</code> <code class="nx">marginBottom</code><code class="o">:</code> <code class="err">`</code><code class="mi">1.45</code><code class="nx">rem</code><code class="err">`</code> <code class="go">}}</code>
    <code class="go">/&gt;</code>
    <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">Link</code> <code class="na">to</code><code class="o">=</code><code class="s">"/page-2/"</code><code class="go">&gt;</code><code class="nx">Go</code> <code class="nx">to</code> <code class="nx">page</code> <code class="mi">2</code><code class="go">&lt;/</code><code class="nt">Link</code><code class="go">&gt;</code> <code class="go">&lt;</code><code class="nt">br</code> <code class="go">/&gt;</code>
      <code class="go">&lt;</code><code class="nt">Link</code> <code class="na">to</code><code class="o">=</code><code class="s">"/using-typescript/"</code><code class="go">&gt;</code><code class="nx">Go</code> <code class="nx">to</code> <code class="s">"Using TypeScript"</code><code class="go">&lt;/</code><code class="nt">Link</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
  <code class="go">&lt;/</code><code class="nt">Layout</code><code class="go">&gt;</code>
<code class="go">)</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">IndexPage</code></pre>

<p class="author1">There is no need to create a route for the page.<a data-type="indexterm" data-primary="routing" data-secondary="routes for page components generated with Gatsby" id="idm46634441960008" class="calibre6"/> Each page component is automatically assigned a route. For example, the page at
<em class="calibre7">src/pages/using-typescript.tsx</em> is 
<span class="firstname">automatically</span>
available at <em class="calibre7">using-typescript</em>.<sup class="calibre34"><a data-type="noteref" id="idm46634434661000-marker" href="ch01_split_001.xhtml#idm46634434661000" class="calibre35">1</a></sup> This approach has multiple advantages. First, if you have many pages, you don’t need to manage
the routes for them manually.<a data-type="indexterm" data-primary="TypeScript" data-secondary="Gatsby's built-in support for" id="idm46634434660136" class="calibre6"/> Second, it means that Gatsby can deliver much more rapidly. To see why, let’s look at how to generate a
production build for a Gatsby application.</p>

<p class="author1">If you stop the Gatsby development server,<sup class="calibre34"><a data-type="noteref" id="idm46634434658632-marker" href="ch01_split_001.xhtml#idm46634434658632" class="calibre35">2</a></sup> you can
generate a production build with the following:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run build</code></pre>

<p class="author1">This command runs a <code class="calibre21">gatsby build</code> command, which creates a <em class="calibre7">public</em> directory. And it is the <em class="calibre7">public</em> directory that contains the
real magic of Gatsby. <a data-type="indexterm" data-primary="JavaScript" data-secondary="generated file for page components using Gatsby" id="idm46634434633208" class="calibre6"/>For each page, you find two files. First, a generated JavaScript file:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">1389 06:48 component---src-pages-using-typescript-tsx-93b78cfadc08d7d203c6.js</code></pre>

<p class="author1">Here you can see that the code for <em class="calibre7">using-typescript.tsx</em> is just 1,389 bytes long, which, with the core framework, is just enough
JavaScript to build the page. It is not the kind of include-everything script that you find in a <code class="calibre21">create-react-app</code> project.<a data-type="indexterm" data-primary="HTML" data-secondary="files generated for page components using Gatsby" id="idm46634434639608" class="calibre6"/></p>

<p class="author1">Second, there is a subdirectory for each page containing a generated HTML file. For <em class="calibre7">using-typescript.tsx</em>, the file is called
<em class="calibre7">public/using-typescript/index.html</em>, containing a statically generated version of the web page. It contains the HTML that the
<em class="calibre7">using-typescript.tsx</em> component would otherwise render dynamically. At the end of the web page, it loads the JavaScript version of
the page to generate any dynamic content.</p>

<p class="author1">This file structure means that Gatsby pages load as quickly as static pages. Using<a data-type="indexterm" data-primary="react-helmet library" id="idm46634434653480" class="calibre6"/> the bundled <code class="calibre21">react-helmet</code> library, you can also
generate <code class="calibre21">&lt;meta/&gt;</code> header tags with additional features about your site. Both features are great for search engine optimization (SEO).<a data-type="indexterm" data-primary="SEO" data-see="search engine optimization" id="idm46634434650984" class="calibre6"/><a data-type="indexterm" data-primary="search engine optimization (SEO)" data-secondary="Gatsby applications" id="idm46634434649992" class="calibre6"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634442049304">
<h2 class="calibre27">Discussion</h2>

<p class="author1">How will the content get into your Gatsby application? You might use a headless content management system, a GraphQL service, a
static data source, or something else.<a data-type="indexterm" data-primary="Gatsby" data-secondary="building content-rich apps with" data-tertiary="plugins, getting content into the application" id="idm46634434647672" class="calibre6"/> Fortunately, Gatsby has many plugins that allow you to connect data sources to your
application and then transform the content from other formats, such as Markdown, into HTML.</p>

<p class="author1">You can find a complete set of plugins on the <a href="https://oreil.ly/9GwLv" class="calibre6">Gatsby website</a>.</p>

<p class="author1">Most of the time, you choose the plugins you need when you first create the project. To give you a head start, Gatsby also supports
<em class="calibre7">start templates</em>. The template provides the initial application structure and configuration. The app we built earlier uses the
default starter template, which is quite simple. The <em class="calibre7">gatsby-config.js</em> file in the root of the application configures which plugins
your application uses.</p>

<p class="author1">But there are<a data-type="indexterm" data-primary="starters (Gatsby)" id="idm46634434643080" class="calibre6"/> masses of Gatsby starters available, preconfigured to build applications that connect to various data sources, with
preconfigured options for SEO, styling, offline caching, progressive web applications (PWAs), and more. Whatever kind of
content-rich application you are building, there is a starter close to what you need.</p>

<p class="author1">There is more information on the Gatsby website about <a href="https://oreil.ly/vwUd8" class="calibre6">Gatsby starters</a>, as well as a
<a href="https://oreil.ly/f7xbF" class="calibre6">cheat sheet</a> for the most useful tools and commands.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/DzLSy" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="content-rich sites, using Gatsby" data-startref="ix_appsCR" id="idm46634434613352" class="calibre6"/><a data-type="indexterm" data-primary="Gatsby" data-secondary="building content-rich apps with" data-startref="ix_GatsCRA" id="idm46634434612056" class="calibre6"/><a data-type="indexterm" data-primary="content-rich apps, generating with Gatsby" data-startref="ix_CRAsgenGat" id="idm46634434610824" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Build Universal Apps with Razzle" class="calibre4"><div class="preface" id="ch01-03">
<h1 class="calibre17">Build Universal Apps with Razzle</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634434608232">
<h2 class="calibre27">Problem</h2>

<p class="author1">Sometimes when you start to build an application, it is not always clear what the significant architectural decisions will be.<a data-type="indexterm" data-primary="applications, creating" data-secondary="Universal applications, using Razzle" id="ix_appsUniv" class="calibre6"/><a data-type="indexterm" data-primary="universal apps, building with Razzle" id="ix_Uniapps" class="calibre6"/><a data-type="indexterm" data-primary="Razzle" data-secondary="building universal apps with" id="ix_Razz" class="calibre6"/>
Should you create an SPA? If performance is critical, should you use server side r? You will need to decide what your
deployment platform will be and whether you will write your code in JavaScript or TypeScript.</p>

<p class="author1">Many tools require that you answer these questions early on. If you later change your mind, modifying how you build and deploy your
application can be complicated.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634434585688">
<h2 class="calibre27">Solution</h2>

<p class="author1">If you want to defer decisions about how you build and deploy your application, you should consider using
<a href="https://oreil.ly/3pZic" class="calibre6">Razzle</a>.</p>

<p class="author1">Razzle is a tool for building <a href="https://oreil.ly/C496O" class="calibre6">Universal applications</a>: applications that can
execute their JavaScript on the server. Or the client. Or both.</p>

<p class="author1">Razzle uses a plugin architecture that allows you to change your mind about how you build your application. It will even let you
change your mind about building your code in React, Preact, or some other framework entirely, like Elm or Vue.<a data-type="indexterm" data-primary="npx command" data-secondary="calling create-razzle-app via" id="idm46634434581016" class="calibre6"/></p>

<p class="author1">You can <a data-type="indexterm" data-primary="create-razzle-app command" id="idm46634434579592" class="calibre6"/>create a Razzle application with the <code class="calibre21">create-razzle-app</code> command:<sup class="calibre34"><a data-type="noteref" id="idm46634434578328-marker" href="ch01_split_001.xhtml#idm46634434578328" class="calibre35">3</a></sup></p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-razzle-app my-app</code></pre>

<p class="author1">This command creates a new Razzle project in the <em class="calibre7">my-app</em> subdirectory. You can start the development server with the <code class="calibre21">start</code>
script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ npm run start</code></pre>

<p class="author1">The <code class="calibre21">start</code> script <a data-type="indexterm" data-primary="clients and servers" data-secondary="building with Razzle" id="idm46634434532024" class="calibre6"/>will dynamically build both client code and server code and then run the server on port 3000, as shown in Figure
1-5.</p>

<figure class="calibre29"><div id="ch01_image_5" class="figure">
<img src="Images/recb_0105.png" alt="" class="calibre36"/>
<h6 class="calibre30"><span class="firstname">Figure 1-5. </span>The Razzle front page at <span class="firstname">http://localhost:3000</span></h6>
</div></figure>

<p class="author1">When you want to deploy a production version of your application, you can then run the <code class="calibre21">build</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run build</code></pre>

<p class="author1">Unlike <code class="calibre21">create-react-app</code>, this will build not just the client code but also a Node server.<a data-type="indexterm" data-primary="Node" data-secondary="building server with Razzle" id="idm46634434568072" class="calibre6"/> Razzle generates the code in the
<em class="calibre7">build</em> subdirectory. The server code will continue to generate static code for your client at runtime. You can start a production
server by running the <em class="calibre7">build/server.js</em> file using the <code class="calibre21">start:prod</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run start:prod</code></pre>

<p class="author1">You can deploy the production server anywhere that Node is available.</p>

<p class="author1">The server and the client can both run the same code, which makes it <em class="calibre7">Universal</em>. But how does it do this?</p>

<p class="author1">The client and the server have different entry points. The server runs the code in <em class="calibre7">src/server.js</em>; the browser runs the code in
<em class="calibre7">src/client.js</em>. Both <em class="calibre7">server.js</em> and <em class="calibre7">client.js</em> then render the same app using <em class="calibre7">src/App.js</em>.</p>

<p class="author1">If you want to run your app as an SPA, remove the <em class="calibre7">src/index.js</em> and <em class="calibre7">src/server.js</em> files.<a data-type="indexterm" data-primary="Single-Page Applications (SPAs)" data-secondary="building with Razzle" id="idm46634434561352" class="calibre6"/> Then create an <em class="calibre7">index.html</em> file in the
<em class="calibre7">public</em> folder containing a <code class="calibre21">&lt;div/&gt;</code> with an ID of <code class="calibre21">root</code>, and rebuild the application with this:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ node_modules/.bin/razzle build --type=spa</code></pre>
<div data-type="tip" class="calibre25">
<p class="author1">To build your application as an SPA every time, add <code class="calibre21">--type=spa</code> to the <code class="calibre21">start</code> and <code class="calibre21">build</code> scripts in <em class="calibre7">package.json</em>.<a data-type="indexterm" data-primary="JSON" data-secondary="start and build scripts  in package.json file" id="idm46634434446872" class="calibre6"/></p>
</div>

<p class="author1">You will generate a full SPA in <em class="calibre7">build/public/</em> that you can deploy on any web server.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634434584744">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Razzle is so adaptable because it is built from a set of highly configurable plugins. Each plugin is a higher-order function that
receives a Webpack configuration and returns a modified version. One plugin might transpile TypeScript code; another might bundle
the React libraries.</p>

<p class="author1">If you want to switch your application to Vue, you only need to replace the plugins you use.</p>

<p class="author1">You can find a list of available plugins on the <a href="https://oreil.ly/UXwPv" class="calibre6">Razzle website</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/rBR9r" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="Universal applications, using Razzle" data-startref="ix_appsUniv" id="idm46634434440296" class="calibre6"/><a data-type="indexterm" data-primary="universal apps, building with Razzle" data-startref="ix_Uniapps" id="idm46634434422520" class="calibre6"/><a data-type="indexterm" data-primary="Razzle" data-secondary="building universal apps with" data-startref="ix_Razz" id="idm46634434421560" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Manage Server and Client Code with Next.js" class="calibre4"><div class="preface" id="ch01-04">
<h1 class="calibre17">Manage Server and Client Code with Next.js</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634434398408">
<h2 class="calibre27">Problem</h2>

<p class="author1">React generates client code—even if it generates the client code on the server. <a data-type="indexterm" data-primary="applications, creating" data-secondary="client and server code, managing with Next.js" id="ix_appsclser" class="calibre6"/><a data-type="indexterm" data-primary="clients and servers" data-secondary="managing code with Next.js" id="ix_clserNext" class="calibre6"/><a data-type="indexterm" data-primary="Next.js" data-secondary="managing server and client code with" id="ix_Next" class="calibre6"/>Sometimes, however, you might have a relatively
small amount of application programming interface (API) code that you would prefer to manage as part of the same React application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634434392776">
<h2 class="calibre27">Solution</h2>

<p class="author1">Next.js is a tool for generating React applications and server code. The API end-points and the client pages use default routing
conventions, making them simpler to build and deploy than they would be if you manage them yourself. You can find full details about
Next.js on the <a href="https://nextjs.org" class="calibre6">website</a>.</p>

<p class="author1">You can create a Next.js application with this command:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-next-app my-app</code></pre>

<p class="author1">This will use <code class="calibre21">yarn</code> as the package manager if you have it installed.<a data-type="indexterm" data-primary="yarn package manager" data-secondary="using with Next.js applications" id="idm46634434350856" class="calibre6"/><a data-type="indexterm" data-primary="npm" data-secondary="using with Next.js applications" id="idm46634434350008" class="calibre6"/> You can force it to use the <code class="calibre21">npm</code> package manager with the
<code class="calibre21">--user-npm</code> flag:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-next-app --use-npm my-app</code></pre>

<p class="author1">This will create a Next.js application in the <em class="calibre7">my-app</em> subdirectory. To start the app, run the <code class="calibre21">dev</code> script (see <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_6" class="calibre6">Figure 1-6</a>):</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ npm run dev</code></pre>

<figure class="calibre29"><div id="ch01_image_6" class="figure">
<img src="Images/recb_0106.png" alt="" class="calibre37"/>
<h6 class="calibre30"><span class="firstname">Figure 1-6. </span>A Next.js page running at <span class="firstname">http://localhost:3000</span></h6>
</div></figure>

<p class="author1">Next.js allows you to create pages without the need to manage any routing configuration. If you add a component script to the
<em class="calibre7">pages</em> folder, it will instantly become available through the server. For example, the <em class="calibre7">pages/index.js</em> component generates the
home page of the default application.</p>

<p class="author1">This approach is similar to the one taken by Gatsby,<sup class="calibre34"><a data-type="noteref" id="idm46634434328376-marker" href="ch01_split_001.xhtml#idm46634434328376" class="calibre35">4</a></sup> but is taken further in Next.js to
include server-side code.</p>

<p class="author1">Next.js applications usually include some API server code, which is unusual for React applications, which are often built separately
from server code. But if you look inside <em class="calibre7">pages/api</em>, you will find an example server endpoint called <em class="calibre7">hello.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="c">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="go">(</code><code class="nx">req</code><code class="go">,</code> <code class="nx">res</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">res</code><code class="go">.</code><code class="nx">status</code><code class="go">(</code><code class="mi">200</code><code class="go">).</code><code class="nx">json</code><code class="go">({</code> <code class="nx">name</code><code class="o">:</code> <code class="s">'John Doe'</code> <code class="go">})</code>
<code class="go">}</code></pre>

<p class="author1">The routing that mounts this to the endpoint <em class="calibre7">api/hello</em> happens automatically.</p>

<p class="author1">Next.js transpiles your code into a hidden directory called .next, which it can then deploy to a service such as Next.js’s own
<a href="https://vercel.com" class="calibre6">Vercel</a> platform.<a data-type="indexterm" data-primary="Vercel platform" id="idm46634434262760" class="calibre6"/></p>

<p class="author1">If you want, you generate a static build of your application with:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ node_modules/.bin/next export</code></pre>

<p class="author1">The <code class="calibre21">export</code> command will build your client code in a directory called <em class="calibre7">out</em>. The command will convert each page into a statically
rendered HTML file, which will load quickly in the browser. At the end of the page, it will load the JavaScript version to
generate any dynamic content.</p>
<div data-type="warning" epub:type="warning" class="calibre26">
<p class="author1">If you create an exported version of a Next.js application, it won’t include any server-side APIs.</p>
</div>

<p class="author1">Next.js comes<a data-type="indexterm" data-primary="data-fetching options (Next.js)" id="idm46634434260088" class="calibre6"/><a data-type="indexterm" data-primary="headless content management system sources" data-secondary="getting data with Next.js" id="idm46634434259384" class="calibre6"/> with a bunch of data-fetching options, which allow you to get data from static content, or via
<a href="https://oreil.ly/Xmia8" class="calibre6">headless content management system (CMS) sources</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634434391864">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Next.js is in many ways similar to Gatsby. Its focus is on the speed of delivery, with a small amount of configuration. It’s
probably most beneficial for teams that will have very little server code.</p>

<p class="author1">You can download the source for this recipe from the
<a href="https://oreil.ly/9gbJs" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="client and server code, managing with Next.js" data-startref="ix_appsclser" id="idm46634434219288" class="calibre6"/><a data-type="indexterm" data-primary="clients and servers" data-secondary="managing code with Next.js" data-startref="ix_clserNext" id="idm46634434217912" class="calibre6"/><a data-type="indexterm" data-primary="Next.js" data-secondary="managing server and client code with" data-startref="ix_Next" id="idm46634434255928" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create a Tiny App with Preact" class="calibre4"><div class="preface" id="ch01-05">
<h1 class="calibre17">Create a Tiny App with Preact</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634434253016">
<h2 class="calibre27">Problem</h2>

<p class="author1">React applications can be large.<a data-type="indexterm" data-primary="applications, creating" data-secondary="tiny apps, using Preact" id="ix_appstiny" class="calibre6"/><a data-type="indexterm" data-primary="tiny apps, creating with Preact" id="ix_tnyapp" class="calibre6"/><a data-type="indexterm" data-primary="Preact" data-secondary="creating tiny apps with" id="ix_Preatiny" class="calibre6"/> It’s pretty easy to create a simple React application that is transpiled into bundles of JavaScript
code that are several hundred kilobytes in size. You might want to build an app with React-like features but with a much smaller
footprint.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634434247576">
<h2 class="calibre27">Solution</h2>

<p class="author1">If you want React features but don’t want to pay the price of a React-size JavaScript bundle, consider using Preact.</p>

<p class="author1">Preact is <em class="calibre7">not</em> React. It is a separate library, designed to be as close to React as possible but much smaller.</p>

<p class="author1">The reason that the React framework is so big is because of the way it works. React components don’t generate elements in the
Document Object Model (DOM) of the browser directly.<a data-type="indexterm" data-primary="components" data-secondary="building elements in virtual DOM" id="idm46634434243848" class="calibre6"/><a data-type="indexterm" data-primary="virtual DOM" id="idm46634434242856" class="calibre6"/> Instead, they build elements within a <em class="calibre7">virtual DOM</em> and then update the actual
DOM at frequent intervals.<a data-type="indexterm" data-primary="DOM" data-secondary="virtual DOM in Preact" id="idm46634434241672" class="calibre6"/> Doing so allows basic DOM rendering to be fast because the actual DOM needs to be updated only when there
are actual changes. However, it does have a downside. React’s virtual DOM requires a lot of code to keep it up-to-date. It needs to
manage an entire synthetic event model, which parallels the one in the browser. For this reason, the React framework is large and
can take some time to download.</p>

<p class="author1">One way around this is to use techniques such as SSR, but SSR can be complex to configure.<sup class="calibre34"><a data-type="noteref" id="idm46634434199464-marker" href="ch01_split_001.xhtml#idm46634434199464" class="calibre35">5</a></sup> Sometimes, you want to download a small amount of code. And that’s why Preact exists.</p>

<p class="author1">The Preact library, although similar to React, is tiny. At the time of writing, the main Preact library is around 4KB, which is
small enough that it’s possible to add React-like features to web pages in barely more code than is required to write native 
<span class="firstname">JavaScript</span>.</p>

<p class="author1">Preact lets you choose how to use it: as a small JavaScript library included in a web page (the <em class="calibre7">no-tools</em> approach) or as a
full-blown JavaScript application.<a data-type="indexterm" data-primary="no-tools approach" id="idm46634434195064" class="calibre6"/></p>

<p class="author1">The no-tools approach is basic. The core Preact library does not support JSX, and you will have no Babel support, so you will
not be able to use modern JavaScript. Here is an example web page using the raw Preact library:</p>

<pre data-type="programlisting" data-code-language="html" class="calibre28"><code class="nt">&lt;html&gt;</code>
    <code class="nt">&lt;head&gt;</code>
        <code class="nt">&lt;title&gt;</code>No Tools!<code class="nt">&lt;/title&gt;</code>
        <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"https://unpkg.com/preact?umd"</code><code class="nt">&gt;&lt;/script&gt;</code>
    <code class="nt">&lt;/head&gt;</code>
    <code class="nt">&lt;body&gt;</code>
        <code class="nt">&lt;h1&gt;</code>No Tools Preact App!<code class="nt">&lt;/h1&gt;</code>
        <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"root"</code><code class="nt">&gt;&lt;/div&gt;</code>
        <code class="nt">&lt;script&gt;</code>
         <code class="kr">var</code> <code class="nx">h</code> <code class="o">=</code> <code class="nb">window</code><code class="go">.</code><code class="nx">preact</code><code class="go">.</code><code class="nx">h</code><code class="go">;</code>
         <code class="kr">var</code> <code class="nx">render</code> <code class="o">=</code> <code class="nb">window</code><code class="go">.</code><code class="nx">preact</code><code class="go">.</code><code class="nx">render</code><code class="go">;</code>

         <code class="kr">var</code> <code class="nx">mount</code> <code class="o">=</code> <code class="nb">document</code><code class="go">.</code><code class="nx">getElementById</code><code class="go">(</code><code class="s">'root'</code><code class="go">);</code>

         <code class="nx">render</code><code class="go">(</code>
             <code class="nx">h</code><code class="go">(</code><code class="s">'button'</code><code class="go">,</code>
               <code class="go">{</code>
                   <code class="nx">onClick</code><code class="o">:</code> <code class="kr">function</code><code class="go">()</code> <code class="go">{</code>
                       <code class="nx">render</code><code class="go">(</code><code class="nx">h</code><code class="go">(</code><code class="s">'div'</code><code class="go">,</code> <code class="kr">null</code><code class="go">,</code> <code class="s">'Hello'</code><code class="go">),</code> <code class="nx">mount</code><code class="go">);</code>
                   <code class="go">}</code>
               <code class="go">},</code>
               <code class="s">'Click!'</code><code class="go">),</code>
             <code class="nx">mount</code>
         <code class="go">);</code>
        <code class="nt">&lt;/script&gt;</code>
    <code class="nt">&lt;/body&gt;</code>
<code class="nt">&lt;/html&gt;</code></pre>

<p class="author1">This application will mount itself at the <code class="calibre21">&lt;div/&gt;</code> with an ID of <code class="calibre21">root</code>, where it will display a button. When you click the button, it
will replace the contents of the root <code class="calibre21">div</code> with the string <code class="calibre21">"Hello"</code>, which is about as basic as a Preact app can be.</p>

<p class="author1">You would rarely write an application in this way. In reality, you would create a simple build-chain that would, at the least,
support modern JavaScript.</p>

<p class="author1">Preact supports the entire spectrum of JavaScript applications. At the other extreme, you can create a complete Preact application
with <code class="calibre21">preact-cli</code>.<a data-type="indexterm" data-primary="preact-cli tool" id="idm46634434083992" class="calibre6"/></p>

<p class="author1"><code class="calibre21">preact-cli</code> is a tool for creating Preact projects and is analogous to tools like <code class="calibre21">create-react-app</code>. You can create a Preact
application with:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx preact-cli create default my-app</code></pre>
<div data-type="tip" class="calibre25">
<p class="author1">This command uses the default template. Other templates are available for creating projects using, for example, Material
components or TypeScript. See the <a href="https://oreil.ly/IVQua" class="calibre6">Preact GitHub page</a> for more information.</p>
</div>

<p class="author1">This command will create your new Preact application in the <em class="calibre7">my-app</em> subdirectory. To start it, run the <code class="calibre21">dev</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ npm run dev</code></pre>

<p class="author1">The server will run on port 8080, as shown in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_7" class="calibre6">Figure 1-7</a>.</p>

<figure class="calibre29"><div id="ch01_image_7" class="figure">
<img src="Images/recb_0107.png" alt="" class="calibre38"/>
<h6 class="calibre30"><span class="firstname">Figure 1-7. </span>A page from Preact</h6>
</div></figure>

<p class="author1">The server generates a web page, which calls back for a JavaScript bundle made from the code in <em class="calibre7">src/index.js</em>.</p>

<p class="author1">You now have a full-scale React-like application. The code inside the <code class="calibre21">Home</code> component (<em class="calibre7">src/routes/home/index.js</em>), for example,
looks<a data-type="indexterm" data-primary="JSX" data-secondary="support in Preact applications" id="idm46634434010536" class="calibre6"/> very React-like, with full JSX support:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">h</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'preact'</code><code class="go">;</code>
<code class="kr">import</code> <code class="nx">style</code> <code class="nx">from</code> <code class="s">'./style.css'</code><code class="go">;</code>

<code class="kr">const</code> <code class="nx">Home</code> <code class="o">=</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="go">{</code><code class="nx">style</code><code class="go">.</code><code class="nx">home</code><code class="go">}&gt;</code>
        <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Home</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">This</code> <code class="nx">is</code> <code class="nx">the</code> <code class="nx">Home</code> <code class="nx">component</code><code class="go">.&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
<code class="go">);</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="nx">Home</code><code class="go">;</code></pre>

<p class="author1">The only significant difference from a standard React component is that a function called <code class="calibre21">h</code> is imported from the <code class="calibre21">preact</code>
library, instead of importing <code class="calibre21">React</code> from the <code class="calibre21">react</code> library.</p>
<div data-type="note" epub:type="note" class="calibre25">
<p class="author1">The JSX within the Preact code will be converted into a series of calls to the <code class="calibre21">h</code> function, which is why it needs to be
imported. For the same reason, applications created with <code class="calibre21">create-react-app</code> prior to version 17 also required the import of the
<code class="calibre21">react</code> object.<a data-type="indexterm" data-primary="JSX" id="idm46634433941992" class="calibre6"/><a data-type="indexterm" data-primary="create-react-app tool" data-secondary="JSX transforms" id="idm46634433941256" class="calibre6"/> From version 17 <code class="calibre21">create-react-app</code> switched to use the
<a href="https://oreil.ly/HOwS9" class="calibre6">JSX transform</a>, doing away for the need to import <code class="calibre21">react</code>
every time. It’s always possible that future versions of Preact will make a similar change.</p>
</div>

<p class="author1">However, the size of the application has increased: it is now a little over 300KB. That’s pretty large, but we are still in dev
mode. To see the real power of Preact, stop the dev server by pressing Ctrl-C, and then run the <code class="calibre21">build</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run build</code></pre>

<p class="author1">This command will generate a static version of the application in the <em class="calibre7">build</em> directory. First, this will have the advantage
of creating a static copy of the front page, which will render quickly. Second, it will remove all unused code from the
application and shrink everything down. If you serve this built version of the app on a standard web server, the browser will
transfer only about 50–60KB when it’s opened.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634434246664">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Preact is a remarkable project. Despite working in a very different way from React, it provides virtually the same power at a
fraction of the size. And the fact that you can use it for anything from the lowliest inline code to a full-blown SPA means it is
well worth considering if code size is critical to your project.</p>

<p class="author1">You can find out more about Preact on the <a href="https://preactjs.com" class="calibre6">Preact website</a>.</p>

<p class="author1">You can download the source for the <a href="https://oreil.ly/N9PKf" class="calibre6">no-tools example</a> and the <a href="https://oreil.ly/F0tW9" class="calibre6">larger Preact example</a> from the
GitHub site.</p>

<p class="author1">If you would like to make Preact look even more like React, see the <a href="https://oreil.ly/3YXOv" class="calibre6">preact-compat</a>
library.</p>

<p class="author1">Finally, for a project that takes a similar approach to Preact, look at <a href="https://infernojs.org" class="calibre6">InfernoJS</a>.<a data-type="indexterm" data-primary="InfernoJS" id="idm46634433928552" class="calibre6"/><a data-type="indexterm" data-primary="applications, creating" data-secondary="tiny apps, using Preact" data-startref="ix_appstiny" id="idm46634433927816" class="calibre6"/><a data-type="indexterm" data-primary="Preact" data-secondary="creating tiny apps with" data-startref="ix_Preatiny" id="idm46634433926600" class="calibre6"/><a data-type="indexterm" data-primary="tiny apps, creating with Preact" data-startref="ix_tnyapp" id="idm46634433905688" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Build Libraries with nwb" class="calibre4"><div class="preface" id="ch01-06">
<h1 class="calibre17">Build Libraries with nwb</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634433903224">
<h2 class="calibre27">Problem</h2>

<p class="author1">Large organizations often develop several React applications at the same time. If you’re a consultancy, you might create
applications for multiple organizations.<a data-type="indexterm" data-primary="applications, creating" data-secondary="libraries, building with nwb" id="ix_appslib" class="calibre6"/><a data-type="indexterm" data-primary="nwb tool, building libraries with" id="ix_nwb" class="calibre6"/> If you’re a software house, you might create various applications that require the same
look and feel, so you will probably want to build shared components to use across several applications.</p>

<p class="author1">When you create a component project, you need to create a directory structure, select a set of tools, choose a set of language
features, and create a build chain that can bundle your component in a deployable format. This process can be just as tedious as
manually creating a project for an entire React application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634433923848">
<h2 class="calibre27">Solution</h2>

<p class="author1">You can use the <code class="calibre21">nwb</code> toolkit to create complete React applications or single React components.<a data-type="indexterm" data-primary="components" data-secondary="creating with nwb" id="idm46634433921352" class="calibre6"/> It can also create components for use
within Preact and InfernoJS projects, but we concentrate on React components here.</p>

<p class="author1">To create a new React component project, you will first need to install the <code class="calibre21">nwb</code> tool globally:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm install -g nwb</code></pre>

<p class="author1">You can then create a new project with the <code class="calibre21">nwb</code> command:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ nwb new react-component my-component</code></pre>
<div data-type="note" epub:type="note" class="calibre25">
<p class="author1">If instead of creating a single component, you want to create an entire <code class="calibre21">nwb</code> application, you can replace <code class="calibre21">react-component</code> in
this command with <code class="calibre21">react-app</code>, <code class="calibre21">preact-app</code>, or <code class="calibre21">inferno-app</code> to create an application in the given framework. You can also use
<code class="calibre21">vanilla-app</code> if you want to create a basic JavaScript project without a 
<span class="firstname">framework</span>.</p>
</div>

<p class="author1">When you run this command, it will ask you several questions about the type of library you want to build. For example, it will ask
you if you’re going to build ECMAScript modules:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">Creating a react-component project...</code>
<code class="go">? Do you want to create an ES modules build? (Y/n)</code></pre>

<p class="author1">This option allows you to build a version including an <code class="calibre21">export</code> statement, which Webpack can use to decide if it needs to include
the component in a client application.<a data-type="indexterm" data-primary="Universal Module Definition (UMD)" id="idm46634433865832" class="calibre6"/><a data-type="indexterm" data-primary="UMD (Universal Module Definition)" id="idm46634433865224" class="calibre6"/> You will also be asked if you want to create a Universal Module Definition (UMD):</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">? Do you want to create a UMD build? (y/N)</code></pre>

<p class="author1">That’s useful if you want to include your component in a <code class="calibre21">&lt;script/&gt;</code> within a web page. For our example, we won’t create a UMD
build.</p>

<p class="author1">After the questions, the tool will create an <code class="calibre21">nwb</code> component project inside the <em class="calibre7">my-component</em> subdirectory. The project comes with a
simple wrapper application that you can start with the <code class="calibre21">start</code> script:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-component</code>
<code class="go">$ npm run start</code></pre>

<p class="author1">The demo application runs on port 3000, as shown in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_8" class="calibre6">Figure 1-8</a>.</p>

<figure class="calibre29"><div id="ch01_image_8" class="figure">
<img src="Images/recb_0108.png" alt="" class="calibre39"/>
<h6 class="calibre30"><span class="firstname">Figure 1-8. </span>An <code class="calibre21">nwb</code> component</h6>
</div></figure>

<p class="author1">The application will contain a single component defined in <em class="calibre7">src/index.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code><code class="go">,</code> <code class="go">{</code> <code class="nx">Component</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="kr">class</code> <code class="kr">extends</code> <code class="nx">Component</code> <code class="go">{</code>
  <code class="nx">render</code><code class="go">()</code> <code class="go">{</code>
    <code class="kr">return</code> <code class="go">(</code>
      <code class="go">&lt;</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">h2</code><code class="go">&gt;</code><code class="nx">Welcome</code> <code class="nx">to</code> <code class="nx">React</code> <code class="nx">components</code><code class="go">&lt;/</code><code class="nt">h2</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
    <code class="go">)</code>
  <code class="go">}</code>
<code class="go">}</code></pre>

<p class="author1">You can now build the component as you would any React project. When you are ready to create a publishable version, type:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run build</code></pre>

<p class="author1">The built component will be in <em class="calibre7">lib/index.js</em>, which you can deploy to a repository for use within other projects.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634433922904">
<h2 class="calibre27">Discussion</h2>

<p class="author1">For further details on creating <code class="calibre21">nwb</code> components, see the <a href="https://oreil.ly/XHrQa" class="calibre6"><code class="calibre21">nwb</code> guide to developing components and libraries</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/P4Xzj" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="libraries, building with nwb" data-startref="ix_appslib" id="idm46634433704392" class="calibre6"/><a data-type="indexterm" data-primary="nwb tool, building libraries with" data-startref="ix_nwb" id="idm46634433703144" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Add React to Rails with Webpacker" class="calibre4"><div class="preface" id="ch01-07">
<h1 class="calibre17">Add React to Rails with Webpacker</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634433676072">
<h2 class="calibre27">Problem</h2>

<p class="author1">The Rails framework was created before interactive JavaScript applications became popular.<a data-type="indexterm" data-primary="applications, creating" data-secondary="inserting React apps into Rails pages using Webpacker" id="ix_appsRails" class="calibre6"/><a data-type="indexterm" data-primary="Rails, adding React to using Webpacker" id="ix_Rails" class="calibre6"/> Rails applications follow a more
traditional model for web application development, in which it generates HTML pages on the server in response to browser requests.
But sometimes, you may want to include more interactive elements inside a Rails application.<a data-type="indexterm" data-primary="Webpacker, adding React to Rails applications" id="ix_Webpckr" class="calibre6"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634433670696">
<h2 class="calibre27">Solution</h2>

<p class="author1">You can use the Webpacker library to insert React applications into Rails-generated web pages. To see how it works, let’s first
generate a Rails application that includes Webpacker:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ rails new my-app --webpack=react</code></pre>

<p class="author1">This command will create a Rails application in a directory called <em class="calibre7">my-app</em> that is preconfigured to run a Webpacker server. Before
we start the application, let’s go into it and generate an example page/controller:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ rails generate controller Example index</code></pre>

<p class="author1">That code will generate this template page at <em class="calibre7">app/views/example/index.html.erb</em>:</p>

<pre data-type="programlisting" data-code-language="html" class="calibre28"><code class="nt">&lt;h1&gt;</code>Example#index<code class="nt">&lt;/h1&gt;</code>
<code class="nt">&lt;p&gt;</code>Find me in app/views/example/index.html.erb<code class="nt">&lt;/p&gt;</code></pre>

<p class="author1">Next, we need to create a small React application that we can insert into this page.<a data-type="indexterm" data-primary="packs" id="idm46634433607256" class="calibre6"/> Rails inserts Webpacker applications as
<em class="calibre7">packs</em>: small JavaScript bundles within Rails. We’ll create a new pack in <em class="calibre7">app/javascript/packs/counter.js</em> containing a simple
counter component:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code><code class="go">,</code> <code class="go">{</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'react'</code>
<code class="kr">import</code> <code class="nx">ReactDOM</code> <code class="nx">from</code> <code class="s">'react-dom'</code>

<code class="kr">const</code> <code class="nx">Counter</code> <code class="o">=</code> <code class="go">(</code><code class="nx">props</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">count</code><code class="go">,</code> <code class="nx">setCount</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>
  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"Counter"</code><code class="go">&gt;</code>
      <code class="nx">You</code> <code class="nx">have</code> <code class="nx">clicked</code> <code class="nx">the</code> <code class="nx">button</code> <code class="go">{</code><code class="nx">count</code><code class="go">}</code> <code class="nx">times</code><code class="go">.</code>
      <code class="go">&lt;</code><code class="nt">button</code> <code class="na">onClick</code><code class="o">=</code><code class="go">{()</code> <code class="o">=&gt;</code> <code class="nx">setCount</code><code class="go">((</code><code class="nx">c</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">c</code> <code class="o">+</code> <code class="mi">1</code><code class="go">)}&gt;</code><code class="nx">Click</code><code class="o">!</code><code class="go">&lt;/</code><code class="nt">button</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code>

<code class="nb">document</code><code class="go">.</code><code class="nx">addEventListener</code><code class="go">(</code><code class="s">'DOMContentLoaded'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="nx">ReactDOM</code><code class="go">.</code><code class="nx">render</code><code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">Counter</code> <code class="go">/&gt;,</code>
    <code class="nb">document</code><code class="go">.</code><code class="nx">body</code><code class="go">.</code><code class="nx">appendChild</code><code class="go">(</code><code class="nb">document</code><code class="go">.</code><code class="nx">createElement</code><code class="go">(</code><code class="s">'div'</code><code class="go">))</code>
  <code class="go">)</code>
<code class="go">})</code></pre>

<p class="author1">This application updates a counter every time a user clicks the button.</p>

<p class="author1">We can now insert the pack into the web page by adding a single line of code to the template page:</p>

<pre data-type="programlisting" data-code-language="html" class="calibre28"><code class="nt">&lt;h1&gt;</code>Example#index<code class="nt">&lt;/h1&gt;</code>
<code class="nt">&lt;p&gt;</code>Find me in app/views/example/index.html.erb<code class="nt">&lt;/p&gt;</code>
<code class="err">&lt;</code>%= javascript_pack_tag 'counter' %&gt;</pre>

<p class="author1">Finally, we can run the Rails server on port 3000:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ rails server</code></pre>
<div data-type="warning" epub:type="warning" class="calibre26">
<p class="author1">At the time of writing, you will need the <code class="calibre21">yarn</code> package manager installed when starting the server.<a data-type="indexterm" data-primary="yarn package manager" data-secondary="installing before starting Rails server" id="idm46634433438552" class="calibre6"/> You can install <code class="calibre21">yarn</code>
globally with <code class="calibre21">npm install -g yarn</code>.</p>
</div>

<p class="author1">You will see the <em class="calibre7">http://localhost:3000/example/index.html</em> page in <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_9" class="calibre6">Figure 1-9</a>.</p>

<figure class="calibre29"><div id="ch01_image_9" class="figure">
<img src="Images/recb_0109.png" alt="" class="calibre40"/>
<h6 class="calibre30"><span class="firstname">Figure 1-9. </span>A React app embedded in <span class="firstname">http://localhost:3000/example/index.html</span></h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634433701752">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Behind the scenes, as you have probably guessed, Webpacker transforms the application using a copy of Webpack, which you can
configure with the <em class="calibre7">app/config/webpacker.yml</em> config file.</p>

<p class="author1">Webpacker is used alongside Rails code rather than as a replacement for it. You should consider using it if your Rails application
requires a small amount of additional interactivity.</p>

<p class="author1">You can find out more about Webpacker on the <a href="https://oreil.ly/aYZ0h" class="calibre6">Webpacker GitHub site</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/H3q1F" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="inserting React apps into Rails pages using Webpacker" data-startref="ix_appsRails" id="idm46634433395224" class="calibre6"/><a data-type="indexterm" data-primary="Webpacker, adding React to Rails applications" data-startref="ix_Webpckr" id="idm46634433434840" class="calibre6"/><a data-type="indexterm" data-primary="Rails, adding React to using Webpacker" data-startref="ix_Rails" id="idm46634433433864" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create Custom Elements with Preact" class="calibre4"><div class="preface" id="ch01-08">
<h1 class="calibre17">Create Custom Elements with Preact</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634433431400">
<h2 class="calibre27">Problem</h2>

<p class="author1">There are sometimes circumstances where it is challenging to add React code into existing content.<a data-type="indexterm" data-primary="applications, creating" data-secondary="custom elements, creating with Preact" id="ix_appscusel" class="calibre6"/><a data-type="indexterm" data-primary="HTML elements" data-secondary="custom, creating with Preact" id="ix_HTMLelcus" class="calibre6"/><a data-type="indexterm" data-primary="Preact" data-secondary="creating custom elements with" id="ix_Preacusel" class="calibre6"/> For example, in some CMS
configurations, users are not allowed to insert additional JavaScript into the body of a page. In these cases, it would be helpful
to have some standardized way to insert JavaScript applications safely into a page.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634433425688">
<h2 class="calibre27">Solution</h2>

<p class="author1">Custom elements are a standard way of creating new HTML elements you can use on a web page. In effect, they extend the HTML language
by making more tags available to a user.</p>

<p class="author1">This recipe looks at how we can use a lightweight framework like Preact to create custom elements, which we can publish on a
third-party server.</p>

<p class="author1">Let’s begin by creating a new Preact application. This application will serve the custom element that we will be able to use
elsewhere:<sup class="calibre34"><a data-type="noteref" id="idm46634433377096-marker" href="ch01_split_001.xhtml#idm46634433377096" class="calibre35">6</a></sup></p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ preact create default my-element</code></pre>

<p class="author1">Now we will change into the app’s directory and add the <code class="calibre21">preact-custom-element</code> library to the project:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-element</code>
<code class="go">$ npm install preact-custom-element</code></pre>

<p class="author1">The <code class="calibre21">preact-custom-element</code> library will allow us to register a new custom HTML element in a browser.</p>

<p class="author1">Next, we need to modify the <em class="calibre7">src/index.js</em> file of the Preact project so that it registers a new custom element, which we will call
<em class="calibre7">components/Converter/index.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">register</code> <code class="nx">from</code> <code class="s">'preact-custom-element'</code>
<code class="kr">import</code> <code class="nx">Converter</code> <code class="nx">from</code> <code class="s">'./components/Converter'</code>

<code class="nx">register</code><code class="go">(</code><code class="nx">Converter</code><code class="go">,</code> <code class="s">'x-converter'</code><code class="go">,</code> <code class="go">[</code><code class="s">'currency'</code><code class="go">])</code></pre>

<p class="author1">The <code class="calibre21">register</code> method tells the browser that we want to create a new custom HTML element called <code class="calibre21">&lt;x-converter/&gt;</code> that has a single
property called <code class="calibre21">currency</code>, which we will define in <em class="calibre7">src/components/Converter/index.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="go">{</code> <code class="nx">h</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'preact'</code>
<code class="kr">import</code> <code class="go">{</code> <code class="nx">useEffect</code><code class="go">,</code> <code class="nx">useState</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'preact/hooks'</code>
<code class="kr">import</code> <code class="s">'style/index.css'</code>

<code class="kr">const</code> <code class="nx">rates</code> <code class="o">=</code> <code class="go">{</code> <code class="nx">gbp</code><code class="o">:</code> <code class="mi">0.81</code><code class="go">,</code> <code class="nx">eur</code><code class="o">:</code> <code class="mi">0.92</code><code class="go">,</code> <code class="nx">jpy</code><code class="o">:</code> <code class="mi">106.64</code> <code class="go">}</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="go">({</code> <code class="nx">currency</code> <code class="o">=</code> <code class="s">'gbp'</code> <code class="go">})</code> <code class="o">=&gt;</code> <code class="go">{</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">curr</code><code class="go">,</code> <code class="nx">setCurr</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="nx">currency</code><code class="go">)</code>
  <code class="kr">const</code> <code class="go">[</code><code class="nx">amount</code><code class="go">,</code> <code class="nx">setAmount</code><code class="go">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="go">(</code><code class="mi">0</code><code class="go">)</code>

  <code class="nx">useEffect</code><code class="go">(()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">setCurr</code><code class="go">(</code><code class="nx">currency</code><code class="go">)</code>
  <code class="go">},</code> <code class="go">[</code><code class="nx">currency</code><code class="go">])</code>

  <code class="kr">return</code> <code class="go">(</code>
    <code class="go">&lt;</code><code class="nt">div</code> <code class="na">className</code><code class="o">=</code><code class="s">"Converter"</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">label</code> <code class="na">htmlFor</code><code class="o">=</code><code class="s">"currency"</code><code class="go">&gt;</code><code class="nx">Currency</code><code class="o">:</code> <code class="go">&lt;/</code><code class="nt">label</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">select</code>
          <code class="na">name</code><code class="o">=</code><code class="s">"currency"</code>
          <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">curr</code><code class="go">}</code>
          <code class="na">onChange</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setCurr</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">)}</code>
        <code class="go">&gt;</code>
          <code class="go">{</code><code class="nb">Object</code><code class="go">.</code><code class="nx">keys</code><code class="go">(</code><code class="nx">rates</code><code class="go">).</code><code class="nx">map</code><code class="go">((</code><code class="nx">r</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">(</code>
            <code class="go">&lt;</code><code class="nt">option</code> <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">r</code><code class="go">}&gt;{</code><code class="nx">r</code><code class="go">}&lt;/</code><code class="nt">option</code><code class="go">&gt;</code>
          <code class="go">))}</code>
        <code class="go">&lt;/</code><code class="nt">select</code><code class="go">&gt;</code>
      <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">p</code> <code class="na">className</code><code class="o">=</code><code class="s">"Converter-amount"</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">label</code> <code class="na">htmlFor</code><code class="o">=</code><code class="s">"amount"</code><code class="go">&gt;</code><code class="nx">Amount</code><code class="o">:</code> <code class="go">&lt;/</code><code class="nt">label</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">input</code>
          <code class="na">name</code><code class="o">=</code><code class="s">"amount"</code>
          <code class="na">size</code><code class="o">=</code><code class="go">{</code><code class="mi">8</code><code class="go">}</code>
          <code class="na">type</code><code class="o">=</code><code class="s">"number"</code>
          <code class="na">value</code><code class="o">=</code><code class="go">{</code><code class="nx">amount</code><code class="go">}</code>
          <code class="na">onInput</code><code class="o">=</code><code class="go">{(</code><code class="nx">evt</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="nx">setAmount</code><code class="go">(</code><code class="nb">parseFloat</code><code class="go">(</code><code class="nx">evt</code><code class="go">.</code><code class="nx">target</code><code class="go">.</code><code class="nx">value</code><code class="go">))}</code>
        <code class="go">/&gt;</code>
      <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
      <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code>
        <code class="nx">Cost</code><code class="o">:</code>
        <code class="go">{((</code><code class="nx">amount</code> <code class="o">||</code> <code class="mi">0</code><code class="go">)</code> <code class="o">/</code> <code class="nx">rates</code><code class="go">[</code><code class="nx">curr</code><code class="go">]).</code><code class="nx">toLocaleString</code><code class="go">(</code><code class="s">'en-US'</code><code class="go">,</code> <code class="go">{</code>
          <code class="nx">style</code><code class="o">:</code> <code class="s">'currency'</code><code class="go">,</code>
          <code class="nx">currency</code><code class="o">:</code> <code class="s">'USD'</code><code class="go">,</code>
        <code class="go">})}</code>
      <code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
  <code class="go">)</code>
<code class="go">}</code></pre>
<div data-type="note" epub:type="note" class="calibre25">
<p class="author1">To be compliant with the custom elements specification, we must choose a name for our element that begins with a lowercase letter, does not include any uppercase letters, and contains a hyphen.<sup class="calibre41"><a data-type="noteref" id="idm46634433284040-marker" href="ch01_split_001.xhtml#idm46634433284040" class="calibre35">7</a></sup> This convention ensures the name does not clash with any standard element name.<a data-type="indexterm" data-primary="WHATWG specification" id="idm46634433282808" class="calibre6"/></p>
</div>

<p class="author1">Our <code class="calibre21">Converter</code> component is a currency converter, which in our example uses a fixed set of exchange rates. If we now start our
Preact server:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run dev</code></pre>

<p class="author1">the JavaScript for the custom element will be available at <em class="calibre7">http://localhost:8080/bundle.js</em>.</p>

<p class="author1">To use this new custom element, let’s create a static web page somewhere with this HTML:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">&lt;</code><code class="nt">html</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">head</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://unpkg.com/babel-polyfill/dist/polyfill.min.js"</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">script</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">script</code> <code class="na">src</code><code class="o">=</code><code class="s">"https://unpkg.com/@webcomponents/webcomponentsjs"</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">script</code><code class="go">&gt;</code>
        <code class="c1">&lt;!--</code> <code class="nx">Replace</code> <code class="kr">this</code> <code class="kr">with</code> <code class="nx">the</code> <code class="nx">address</code> <code class="nx">of</code> <code class="nx">your</code> <code class="nx">custom</code> <code class="nx">element</code> <code class="o">--&gt;</code>
        <code class="go">&lt;</code><code class="nt">script</code> <code class="na">type</code><code class="o">=</code><code class="s">"text/javascript"</code> <code class="na">src</code><code class="o">=</code><code class="s">"http://localhost:8080/bundle.js"</code><code class="go">&gt;</code>
        <code class="go">&lt;/</code><code class="nt">script</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">head</code><code class="go">&gt;</code>
    <code class="go">&lt;</code><code class="nt">body</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">h1</code><code class="go">&gt;</code><code class="nx">Custom</code> <code class="nx">Web</code> <code class="nx">Element</code><code class="go">&lt;/</code><code class="nt">h1</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">div</code> <code class="na">style</code><code class="o">=</code><code class="s">"float: right; clear: both"</code><code class="go">&gt;</code>
            <code class="c1">&lt;!--</code> <code class="nx">This</code> <code class="nx">tag</code> <code class="nx">will</code> <code class="nx">insert</code> <code class="nx">the</code> <code class="nx">Preact</code> <code class="nx">app</code> <code class="o">--&gt;</code>
            <code class="go">&lt;</code><code class="nt">x</code><code class="err">-</code><code class="na">converter</code> <code class="na">currency</code><code class="o">=</code><code class="s">"jpy"</code><code class="go">/&gt;</code>
        <code class="go">&lt;/</code><code class="nt">div</code><code class="go">&gt;</code>
        <code class="go">&lt;</code><code class="nt">p</code><code class="go">&gt;</code><code class="nx">This</code> <code class="nx">page</code> <code class="nx">contains</code> <code class="nx">an</code> <code class="nx">example</code> <code class="nx">custom</code> <code class="nx">element</code> <code class="nx">called</code>
            <code class="go">&lt;</code><code class="nt">code</code><code class="go">&gt;</code><code class="o">&amp;</code><code class="nx">lt</code><code class="go">;</code><code class="nx">x</code><code class="o">-</code><code class="nx">converter</code><code class="o">/&amp;</code><code class="nx">gt</code><code class="go">;&lt;/</code><code class="nt">code</code><code class="go">&gt;,</code>
            <code class="nx">which</code> <code class="nx">is</code> <code class="nx">being</code> <code class="nx">served</code> <code class="nx">from</code> <code class="nx">a</code> <code class="nx">different</code> <code class="nx">location</code><code class="go">&lt;/</code><code class="nt">p</code><code class="go">&gt;</code>
    <code class="go">&lt;/</code><code class="nt">body</code><code class="go">&gt;</code>
<code class="go">&lt;/</code><code class="nt">html</code><code class="go">&gt;</code></pre>

<p class="author1">This web page includes the definition of the custom element in the final <code class="calibre21">&lt;script/&gt;</code> of the <code class="calibre21">&lt;head/&gt;</code> element. To ensure that
the custom element is available across both new and old browsers, we also include a couple of shims from <em class="calibre7">unpkg.com</em>.</p>

<p class="author1">Now that we’ve included the custom element code in the web page, we can insert 
<span class="firstname"><code class="calibre21">&lt;x-converter/&gt;</code></span> tags into the code, as if they are
part of standard HTML.<a data-type="indexterm" data-primary="properties (custom element)" id="idm46634432743224" class="calibre6"/> In our example, we are also passing a <code class="calibre21">currency</code> property to the underlying Preact 
<span class="firstname">component</span>.</p>
<div data-type="warning" epub:type="warning" class="calibre26">
<p class="author1">Custom element properties are passed to the underlying component with lowercase names, regardless of how we define them in
the HTML.</p>
</div>

<p class="author1">We can run this page through a web server, separate from the Preact server. <a data-type="xref" href="ch01_split_000.xhtml#ch01_image_10" class="calibre6">Figure 1-10</a> shows the new custom element.</p>

<figure class="calibre29"><div id="ch01_image_10" class="figure">
<img src="Images/recb_0110.png" alt="" class="calibre42"/>
<h6 class="calibre30"><span class="firstname">Figure 1-10. </span>The custom element embedded in a static page</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634433424776">
<h2 class="calibre27">Discussion</h2>

<p class="author1">The custom element does not need to be on the same server as the web page that uses it, which means that we can use custom elements
to publish widgets for any web page. Because of this, you might want to check the <code class="calibre21">Referer</code> header on any incoming request to the
component to prevent any unauthorized usage.<a data-type="indexterm" data-primary="Referer header" id="idm46634432735080" class="calibre6"/></p>

<p class="author1">Our example is serving the custom element from Preact’s development server. For a production release, you would probably want to
create a static build of the component, which will likely be significantly smaller.<sup class="calibre34"><a data-type="noteref" id="idm46634432733768-marker" href="ch01_split_001.xhtml#idm46634432733768" class="calibre35">8</a></sup></p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/aB7BP" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="custom elements, creating with Preact" data-startref="ix_appscusel" id="idm46634432731176" class="calibre6"/><a data-type="indexterm" data-primary="HTML elements" data-secondary="custom, creating with Preact" data-startref="ix_HTMLelcus" id="idm46634432729832" class="calibre6"/><a data-type="indexterm" data-primary="Preact" data-secondary="creating custom elements with" data-startref="ix_Preacusel" id="idm46634432728600" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Use Storybook for Component Development" class="calibre4"><div class="preface" id="ch01-09">
<div class="calibre43" id="calibre_pb_0"/>
</div></section>













</div></section></div>

<div id="sbo-rt-content" class="calibre1">
<section data-type="chapter" epub:type="chapter" class="calibre4" data-pdf-bookmark="Chapter 1. Creating Applications">
<div class="preface" id="chapter01">
<section data-type="sect1" data-pdf-bookmark="Use Storybook for Component Development" class="calibre4">
<div class="preface" id="ch01-09">
<h1 class="calibre17">Use Storybook for Component Development</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634432725688">
<h2 class="calibre27">Problem</h2>

<p class="author1">React components are the stable building material of React applications.<a data-type="indexterm" data-primary="applications, creating" data-secondary="component development using Storybook" id="ix_appscmpnStry" class="calibre6"/><a data-type="indexterm" data-primary="components" data-secondary="using Storybook for development" id="ix_cmpnStry" class="calibre6"/><a data-type="indexterm" data-primary="Storybook" data-secondary="component development with" id="ix_Strybk" class="calibre6"/> If we write them carefully, we can reuse the components in
other React applications. But when you build a component, it takes work to check how it works in all circumstances. For example, in
an asynchronous application, React might render the component with undefined properties. Will the component still render correctly?
Will it show errors?</p>

<p class="author1">But if you are building components as part of a complex application, it can be tough to create all of the situations with which your
component will need to cope.</p>

<p class="author1">Also, if you have specialized user experience (UX) developers working on your team, it can waste a lot of time if they have to navigate through an
application to view the single component they have in development.</p>

<p class="author1">It would be helpful if there were some way of displaying a component in isolation and passing it example sets of properties.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634432718008">
<h2 class="calibre27">Solution</h2>

<p class="author1">Storybook is a tool for displaying libraries of components in various states. You could describe it as a gallery for components, but
that’s probably selling it short. In reality, Storybook is a tool for component development.</p>

<p class="author1">How do we add Storybook to a project? Let’s begin by creating a React application with <code class="calibre21">create-react-app</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-react-app my-app</code>
<code class="go">$ cd my-app</code></pre>

<p class="author1">Now we can add Storybook <a data-type="indexterm" data-primary="npx command" data-secondary="initiating Storybook" id="idm46634432690264" class="calibre6"/>to the project:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx sb init</code></pre>

<p class="author1">We then start the Storybook server with <code class="calibre21">yarn</code> or <code class="calibre21">npm</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm run storybook</code></pre>

<p class="author1">Storybook runs a separate server on port 9000, as you can see in <a data-type="xref" href="ch01_split_001.xhtml#ch01_image_11" class="calibre6">Figure 1-11</a>. When you use Storybook, there is no need to run the
actual React application.</p>

<figure class="calibre29"><div id="ch01_image_11" class="figure">
<img src="Images/recb_0111.png" alt="" class="calibre44"/>
<h6 class="calibre30"><span class="firstname">Figure 1-11. </span>The welcome page in Storybook</h6>
</div></figure>

<p class="author1">Storybook calls a single component rendered with example properties a <em class="calibre7">story</em>. The default installation of Storybook generates
sample stories in the <em class="calibre7">src/stories</em> directory of the application. For example, this is <em class="calibre7">src/stories/Button.stories.js</em>:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s">'react'</code><code class="go">;</code>

<code class="kr">import</code> <code class="go">{</code> <code class="nx">Button</code> <code class="go">}</code> <code class="nx">from</code> <code class="s">'./Button'</code><code class="go">;</code>

<code class="kr">export</code> <code class="kr">default</code> <code class="go">{</code>
  <code class="nx">title</code><code class="o">:</code> <code class="s">'Example/Button'</code><code class="go">,</code>
  <code class="nx">component</code><code class="o">:</code> <code class="nx">Button</code><code class="go">,</code>
  <code class="nx">argTypes</code><code class="o">:</code> <code class="go">{</code>
    <code class="nx">backgroundColor</code><code class="o">:</code> <code class="go">{</code> <code class="nx">control</code><code class="o">:</code> <code class="s">'color'</code> <code class="go">},</code>
  <code class="go">},</code>
<code class="go">};</code>

<code class="kr">const</code> <code class="nx">Template</code> <code class="o">=</code> <code class="go">(</code><code class="nx">args</code><code class="go">)</code> <code class="o">=&gt;</code> <code class="go">&lt;</code><code class="nt">Button</code> <code class="go">{</code><code class="na">...args</code><code class="go">}</code> <code class="go">/&gt;;</code>

<code class="kr">export</code> <code class="kr">const</code> <code class="nx">Primary</code> <code class="o">=</code> <code class="nx">Template</code><code class="go">.</code><code class="nx">bind</code><code class="go">({});</code>
<code class="nx">Primary</code><code class="go">.</code><code class="nx">args</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">primary</code><code class="o">:</code> <code class="kr">true</code><code class="go">,</code>
  <code class="nx">label</code><code class="o">:</code> <code class="s">'Button'</code><code class="go">,</code>
<code class="go">};</code>

<code class="kr">export</code> <code class="kr">const</code> <code class="nx">Secondary</code> <code class="o">=</code> <code class="nx">Template</code><code class="go">.</code><code class="nx">bind</code><code class="go">({});</code>
<code class="nx">Secondary</code><code class="go">.</code><code class="nx">args</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">label</code><code class="o">:</code> <code class="s">'Button'</code><code class="go">,</code>
<code class="go">};</code>

<code class="kr">export</code> <code class="kr">const</code> <code class="nx">Large</code> <code class="o">=</code> <code class="nx">Template</code><code class="go">.</code><code class="nx">bind</code><code class="go">({});</code>
<code class="nx">Large</code><code class="go">.</code><code class="nx">args</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">size</code><code class="o">:</code> <code class="s">'large'</code><code class="go">,</code>
  <code class="nx">label</code><code class="o">:</code> <code class="s">'Button'</code><code class="go">,</code>
<code class="go">};</code>

<code class="kr">export</code> <code class="kr">const</code> <code class="nx">Small</code> <code class="o">=</code> <code class="nx">Template</code><code class="go">.</code><code class="nx">bind</code><code class="go">({});</code>
<code class="nx">Small</code><code class="go">.</code><code class="nx">args</code> <code class="o">=</code> <code class="go">{</code>
  <code class="nx">size</code><code class="o">:</code> <code class="s">'small'</code><code class="go">,</code>
  <code class="nx">label</code><code class="o">:</code> <code class="s">'Button'</code><code class="go">,</code>
<code class="go">};</code></pre>

<p class="author1">Storybook watches for files named <em class="calibre7">*.stories.js</em> in your source folder, and it doesn’t care where they are, so you are free to
create them where you like. One typical pattern places the stories in a folder alongside the component they are showcasing. So if
you copy the folder to a different application, you can include stories as living 
<span class="firstname">documentation</span>.</p>

<p class="author1"><a data-type="xref" href="ch01_split_001.xhtml#ch01_image_12" class="calibre6">Figure 1-12</a> shows what <em class="calibre7">Button.stories.js</em> looks like in Storybook.</p>

<figure class="calibre29"><div id="ch01_image_12" class="figure">
<img src="Images/recb_0112.png" alt="" class="calibre45"/>
<h6 class="calibre30"><span class="firstname">Figure 1-12. </span>An example story</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634432717384">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Despite its simple appearance, Storybook is a productive development tool. It allows you to focus on one component at a time.
Like a kind of visual unit test, it enables you to try a component in a series of possible scenarios to check that it behaves
appropriately.</p>

<p class="author1">Storybook also has a large selection of additional <a href="https://oreil.ly/3kSVa" class="calibre6">add-ons</a>.</p>

<p class="author1">The add-ons allow you to:</p>

<ul class="stafflist">
<li class="calibre8">
<p class="author1">Check for accessibility problems (<em class="calibre7">addon-a11y</em>)</p>
</li>
<li class="calibre8">
<p class="author1">Add interactive controls for setting properties (<em class="calibre7">Knobs</em>)</p>
</li>
<li class="calibre8">
<p class="author1">Include inline documentation for each story (<em class="calibre7">Docs</em>)</p>
</li>
<li class="calibre8">
<p class="author1">Record snapshots of the HTML to test the impact of changes (<em class="calibre7">Storyshots</em>)</p>
</li>
</ul>

<p class="author1">And do much more.</p>

<p class="author1">For further information about Storybook, see <a href="https://storybook.js.org" class="calibre6">the website</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/GyxTX" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="component development using Storybook" data-startref="ix_appscmpnStry" id="idm46634432430056" class="calibre6"/><a data-type="indexterm" data-primary="components" data-secondary="using Storybook for development" data-startref="ix_cmpnStry" id="idm46634432428808" class="calibre6"/><a data-type="indexterm" data-primary="Storybook" data-secondary="component development with" data-startref="ix_Strybk" id="idm46634432427576" class="calibre6"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Test Your Code in a Browser with Cypress" class="calibre4"><div class="preface" id="ch01-10">
<h1 class="calibre17">Test Your Code in a Browser with Cypress</h1>








<section data-type="sect2" data-pdf-bookmark="Problem" class="calibre4"><div class="preface" id="idm46634432424728">
<h2 class="calibre27">Problem</h2>

<p class="author1">Most React projects include a testing library.<a data-type="indexterm" data-primary="applications, creating" data-secondary="testing code in browsers using Cypress" id="ix_appstest" class="calibre6"/><a data-type="indexterm" data-primary="testing" data-secondary="browser-based, using Cypress" id="ix_tstbrwCyp" class="calibre6"/><a data-type="indexterm" data-primary="browsers" data-secondary="testing code using Cypress" id="ix_brwstst" class="calibre6"/><a data-type="indexterm" data-primary="Cypress" data-secondary="testing code in browsers" id="ix_Cypr" class="calibre6"/> The most common is probably <code class="calibre21">@testing-library/react</code>, which comes bundled with
<code class="calibre21">create-react-app</code>, or Enzyme, which is used by Preact.</p>

<p class="author1">But nothing quite beats testing code in a real browser, with all the additional complications that entails.
Traditionally, browser testing can be unstable and requires frequent maintenance as you need to upgrade browser drivers (such as
ChromeDriver) every time you upgrade the browser.</p>

<p class="author1">Add to that the issue of generating test data on a backend server, and browser-based testing can be complex to set up and manage.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution" class="calibre4"><div class="preface" id="idm46634432415912">
<h2 class="calibre27">Solution</h2>

<p class="author1">The <a href="https://www.cypress.io" class="calibre6">Cypress testing framework</a> avoids many of the downsides of traditional browser testing. It runs in a
browser but avoids the need for an external web-driver tool. Instead, it communicates directly with a browser, like Chrome or
Electron, over a network port and then injects JavaScript to run much of the test code.</p>

<p class="author1">Let’s create an application <code class="calibre21">create-react-app</code> to see how it works:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx create-react-app --use-npm my-app</code></pre>

<p class="author1">Now let’s go into the app directory and install Cypress:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ cd my-app</code>
<code class="go">$ npm install cypress --save-dev</code></pre>

<p class="author1">Before we run Cypress, we need to configure it so that it knows how to find our application.<a data-type="indexterm" data-primary="JSON" data-secondary="cypress.json file" id="idm46634432396584" class="calibre6"/> We can do this by creating a
<em class="calibre7">cypress.json</em> file in the application directory and telling it the uniform resource locator (URL) of our app:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="go">{</code>
  <code class="s">"baseUrl"</code><code class="o">:</code> <code class="s">"http://localhost:3000/"</code>
<code class="go">}</code></pre>

<p class="author1">Once we have started the main application:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npm start</code></pre>

<p class="author1">we can then open Cypress:</p>

<pre data-type="programlisting" data-code-language="shell-session" class="calibre28"><code class="go">$ npx cypress open</code></pre>

<p class="author1">The first time you run Cypress, it will install all the dependencies it needs. We’ll now create a test in the
<em class="calibre7">cypress/integration</em> directory called <em class="calibre7">screenshot.js</em>, which opens the home page and takes a screenshot:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">describe</code><code class="go">(</code><code class="s">'screenshot'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
    <code class="nx">it</code><code class="go">(</code><code class="s">'should be able to take a screenshot'</code><code class="go">,</code> <code class="go">()</code> <code class="o">=&gt;</code> <code class="go">{</code>
        <code class="nx">cy</code><code class="go">.</code><code class="nx">visit</code><code class="go">(</code><code class="s">'/'</code><code class="go">);</code>
        <code class="nx">cy</code><code class="go">.</code><code class="nx">screenshot</code><code class="go">(</code><code class="s">'frontpage'</code><code class="go">);</code>
    <code class="go">});</code>
<code class="go">});</code></pre>

<p class="author1">You’ll notice that we wrote the tests in Jest format. Once you save the test, it will appear in the main Cypress window, shown in
<a data-type="xref" href="ch01_split_001.xhtml#ch01_image_13" class="calibre6">Figure 1-13</a>.</p>

<figure class="calibre29"><div id="ch01_image_13" class="figure">
<img src="Images/recb_0113.png" alt="" class="calibre46"/>
<h6 class="calibre30"><span class="firstname">Figure 1-13. </span>The Cypress window</h6>
</div></figure>

<p class="author1">If you double-click the test, Cypress will run it in a browser. The front page of the application will open, and the test will save a
screenshot to <em class="calibre7">cypress/screenshots/screenshot.js/frontpage.png</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion" class="calibre4"><div class="preface" id="idm46634432415288">
<h2 class="calibre27">Discussion</h2>

<p class="author1">Here are some example commands you can perform with Cypress:</p>
<table class="calibre10">

<thead class="calibre11">
<tr class="calibre12">
<th class="calibre13">Command</th>
<th class="calibre13">Description</th>
</tr>
</thead>
<tbody class="calibre14">
<tr class="calibre12">
<td class="calibre15"><p class="author1"><code class="calibre47">cy.contains('Fred')</code></p></td>
<td class="calibre15"><p class="author1">Finds the element containing <em class="calibre7"><code class="calibre48">Fred</code></em></p></td>
</tr>
<tr class="calibre16">
<td class="calibre15"><p class="author1"><code class="calibre47">cy.get('.Norman').click()</code></p></td>
<td class="calibre15"><p class="author1">Clicks the element with class <em class="calibre7"><code class="calibre48">Norman</code></em></p></td>
</tr>
<tr class="calibre12">
<td class="calibre15"><p class="author1"><code class="calibre47">cy.get('input').type('Hi!')</code></p></td>
<td class="calibre15"><p class="author1">Types <code class="calibre47">"Hi!"</code> into the input field</p></td>
</tr>
<tr class="calibre16">
<td class="calibre15"><p class="author1"><code class="calibre47">cy.get('h1').scrollIntoView()</code></p></td>
<td class="calibre15"><p class="author1">Scrolls the <code class="calibre47">&lt;h1/&gt;</code> into view</p></td>
</tr>
</tbody>
</table>

<p class="author1">These are just some of the commands that interact with the web page. But Cypress has another trick up its sleeve. Cypress can also
modify the code inside the browser to change the time (<code class="calibre21">cy.clock()</code>), the cookies (<code class="calibre21">cy.setCookie()</code>), the local storage
(<code class="calibre21">cy.clearLocalStorage()</code>) and—most impressively—fake requests and responses to an API server.<a data-type="indexterm" data-primary="APIs" data-secondary="faking server requests/responses using Cypress" id="idm46634432230824" class="calibre6"/></p>

<p class="author1">It does this by modifying the networking functions that are built into the browser so that this code:</p>

<pre data-type="programlisting" data-code-language="jsx" class="calibre28"><code class="nx">cy</code><code class="go">.</code><code class="nx">route</code><code class="go">(</code><code class="s">"/api/server?*"</code><code class="go">,</code> <code class="go">[{</code><code class="nx">some</code><code class="o">:</code> <code class="s">'Data'</code><code class="go">}])</code></pre>

<p class="author1">will intercept any requests to a server endpoint beginning <em class="calibre7">/api/server?</em> and return the JSON array
<code class="calibre21">[{some: 'Data'}]</code>.</p>

<p class="author1">Simulating network responses can completely change the way teams develop applications because it decouples the frontend development
from the backend. The browser tests can specify what data they need without having to create a real server and 
<span class="firstname">database</span>.</p>

<p class="author1">To learn more about Cypress, visit the <a href="https://oreil.ly/eX09t" class="calibre6">documentation site</a>.</p>

<p class="author1">You can download the source for this recipe from the <a href="https://oreil.ly/3j8vI" class="calibre6">GitHub site</a>.<a data-type="indexterm" data-primary="applications, creating" data-secondary="testing code in browsers using Cypress" data-startref="ix_appstest" id="idm46634432186536" class="calibre6"/><a data-type="indexterm" data-primary="testing" data-secondary="browser-based, using Cypress" data-startref="ix_tstbrwCyp" id="idm46634432185288" class="calibre6"/><a data-type="indexterm" data-primary="Cypress" data-secondary="testing code in browsers" data-startref="ix_Cypr" id="idm46634432184104" class="calibre6"/><a data-type="indexterm" data-primary="browsers" data-secondary="testing code using Cypress" data-startref="ix_brwstst" id="idm46634432179816" class="calibre6"/><a data-type="indexterm" data-primary="applications, creating" data-startref="ix_apps" id="idm46634432178584" class="calibre6"/></p>
</div></section>





</div></section>







<div data-type="footnotes" class="calibre49"><p data-type="footnote" id="idm46634434661000" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634434661000-marker" class="calibre35">1</a></sup> And yes, this means that Gatsby has TypeScript support built-in.</p><p data-type="footnote" id="idm46634434658632" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634434658632-marker" class="calibre35">2</a></sup> You can do this in most operating systems by pressing Ctrl-C.</p><p data-type="footnote" id="idm46634434578328" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634434578328-marker" class="calibre35">3</a></sup> The name is intentionally similar to <code class="calibre21">create-react-app</code>. The maintainer of Razzle, Jared Palmer, lists <code class="calibre21">create-react-app</code> as one of the inspirations for Razzle.</p><p data-type="footnote" id="idm46634434328376" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634434328376-marker" class="calibre35">4</a></sup> See <a data-type="xref" href="ch01_split_000.xhtml#ch01-02" class="calibre6">“Build Content-Rich Apps with Gatsby”</a>.</p><p data-type="footnote" id="idm46634434199464" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634434199464-marker" class="calibre35">5</a></sup> See Recipes <a href="ch01_split_000.xhtml#ch01-02" class="calibre6">1.2</a> and <a href="ch01_split_000.xhtml#ch01-03" class="calibre6">1.3</a>.</p><p data-type="footnote" id="idm46634433377096" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634433377096-marker" class="calibre35">6</a></sup> For more information on creating Preact applications, see <a data-type="xref" href="ch01_split_000.xhtml#ch01-05" class="calibre6">“Create a Tiny App with Preact”</a>.</p><p data-type="footnote" id="idm46634433284040" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634433284040-marker" class="calibre35">7</a></sup> See the <a href="https://oreil.ly/KOjmP" class="calibre6">WHATWG specification</a> for further details on custom elements and naming conventions.</p><p data-type="footnote" id="idm46634432733768" class="calibre50"><sup class="calibre51"><a href="ch01_split_000.xhtml#idm46634432733768-marker" class="calibre35">8</a></sup> For further details on shrinking Preact downloads, see <a data-type="xref" href="ch01_split_000.xhtml#ch01-05" class="calibre6">“Create a Tiny App with Preact”</a>.</p></div></div></section></div></body></html>