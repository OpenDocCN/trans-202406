<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Starting, Stopping, Restarting, and &#10;Putting Linux into Sleep Modes"><div class="chapter" id="cha-stop-start">
<h1><span class="label">Chapter 3. </span>Starting, Stopping, Restarting, and 
<span class="keep-together">Putting Linux into Sleep Modes</span></h1>


<p>In this chapter you will learn several ways to stop, start, and restart a Linux
system, and how to manage sleep modes. You will learn both the legacy commands
and the new systemd commands.</p>

<p>You will also learn how to set up automated startups and shutdowns.
An<a data-type="indexterm" data-primary="startup commands" data-secondary="scheduled startups" data-tertiary="purpose of" id="idm46466162709608"/><a data-type="indexterm" data-primary="shutdown commands" data-secondary="scheduled shutdowns" data-tertiary="purpose of" id="idm46466162708520"/><a data-type="indexterm" data-primary="scheduled shutdowns" data-secondary="purpose of" id="idm46466162707080"/><a data-type="indexterm" data-primary="scheduled startups" data-secondary="purpose of" id="idm46466162706232"/><a data-type="indexterm" data-primary="automated shutdowns" data-see="scheduled shutdowns" id="idm46466162705288"/><a data-type="indexterm" data-primary="automated startups" data-see="scheduled startups" id="idm46466162704312"/><a data-type="indexterm" data-primary="wakeups" data-see="startup commands" id="idm46466162703240"/> automated shutdown is nice to remind you to stop working, and you don’t have to
remember to shut off your computer for the night. You can set up automated wake-ups
and shutdowns on a remote machine, so that you can access it during work hours
without leaving it running all the time. If your users are watt wasters
who don’t shut off their computers, you can configure them to shut down
during off hours.</p>

<p>The<a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="purpose of" id="idm46466162696648"/> “three-key salute,” Ctrl-Alt-Delete, is useful when you need to interrupt a
startup and reboot, or reboot when a process or application is misbehaving. In
graphical desktops you can remap the keys to a more convenient key combination.</p>

<p>There<a data-type="indexterm" data-primary="shutdown commands" data-secondary="legacy commands" data-tertiary="purpose of" id="idm46466162710344"/><a data-type="indexterm" data-primary="shutdown command" id="idm46466162697224"/><a data-type="indexterm" data-primary="halt command" id="idm46466162701688"/><a data-type="indexterm" data-primary="poweroff command" id="idm46466162701048"/><a data-type="indexterm" data-primary="reboot command" id="idm46466162700248"/> are a number of legacy shutdown commands that have accumulated over the decades,
with a lot of overlapping functionality: <em>shutdown</em>, <em>halt</em>, <em>poweroff</em>,
and <em>reboot</em>. The <em>shutdown</em> command provides the useful options of timed
shutdowns, with warnings to all logged-in users. These commands are useful in
scripts, in SSH sessions, and anytime you are working from the command line.</p>
<div data-type="note" epub:type="note"><h1>Root Privileges Not Always Required</h1>
<p>In olden times, <a data-type="indexterm" data-primary="shutdown commands" data-secondary="root privileges" id="idm46466162692024"/><a data-type="indexterm" data-primary="root privileges" data-secondary="for shutdown commands" data-secondary-sortas="shutdown commands" id="idm46466162691288"/>root privileges were needed to run the shutdown commands. This is
changing, and on many modern Linux distributions, root privileges are not needed for
these commands. The examples in this chapter are for normal, unprivileged users.
If your particular Linux requires root permissions, it will tell you.</p>

<p>These permissions are controlled by Polkit (formerly PolicyKit) on modern Linux
distributions. See <em>man 8 polkit</em> to learn more.</p>
</div>

<p>But <a data-type="indexterm" data-primary="shutdown commands" data-secondary="legacy commands" data-tertiary="symlinks for" id="idm46466162688584"/><a data-type="indexterm" data-primary="symlinks" data-secondary="for shutdown commands" data-secondary-sortas="shutdown commands" id="idm46466162686760"/><a data-type="indexterm" data-primary="systemctl command" data-secondary="symlinks to" id="idm46466162685672"/><a data-type="indexterm" data-primary="systemd" data-secondary="shutdown commands" id="idm46466162684760"/>that’s not all, because in Linux distributions with systemd (<a data-type="xref" href="ch04.xhtml#cha-systemd">Chapter 4</a>),
the classic old commands are not installed on the system. Intead, their names are
symlinked to the <em>systemctl</em> command. You can see this with the <em>stat</em> command,
like this example for <em>shutdown</em>:</p>
<pre>$ <strong>stat /sbin/shutdown</strong>
  File: /sbin/shutdown -&gt; /bin/systemctl
  Size: 14              Blocks: 0          IO Block: 4096   symbolic link
Device: 802h/2050d      Inode: 1177556     Links: 1
Access: (0777/lrwxrwxrwx)  Uid: ( 0/ root)   Gid: ( 0/ root)
</pre>

<p>The <code>File:</code> line displays a symbolic link to <em>/bin/systemctl</em>. All of the legacy
command names, <em>/sbin/shutdown</em>, <em>/sbin/halt</em>, <em>/sbin/poweroff</em>, and
<em>/sbin/reboot</em>, are symlinked to <em>/bin/systemctl</em>. The symlinks for the legacy
command names are provided for backward compatibility. On Linux systems without
systemd these symlinks do not exist, and these systems use the legacy executables.</p>

<p>On some Linux distros these symlinks are in <em>/usr/sbin</em> rather than <em>/sbin</em>.
When you use the legacy command names, they behave the same way on systems with
systemd and on systems without systemd.</p>

<p>The power buttons on your graphical desktop are configurable; you should
be able to customize which buttons are visible and their location.</p>






<section data-type="sect1" data-pdf-bookmark="3.1 Shutting Down with systemctl"><div class="sect1" id="idm46466162672216">
<h1>3.1 Shutting Down with systemctl</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162674312">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="shutdown commands" data-secondary="systemctl" id="shutdown-systemctl"/><a data-type="indexterm" data-primary="systemctl command" data-secondary="shutdown with" id="systemctl-shutdown"/> want to use the <em>systemctl</em> commands to shut down and reboot your system.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162668120">
<h2>Solution</h2>

<p>Halt the <a data-type="indexterm" data-primary="poweroff command" id="idm46466162666536"/>system and power off the machine:</p>
<pre>$ <strong>systemctl poweroff</strong></pre>

<p class="pagebreak-before less_space">Another way to halt the system <a data-type="indexterm" data-primary="shutdown command" id="idm46466162663976"/>and power off the machine:</p>
<pre>$ <strong>systemctl shutdown</strong></pre>

<p>Reboot:<a data-type="indexterm" data-primary="reboot command" id="idm46466162662040"/></p>
<pre>$ <strong>systemctl reboot</strong></pre>

<p>Halt the system without <a data-type="indexterm" data-primary="halt command" id="idm46466162659880"/>powering off the machine:</p>
<pre>$ <strong>systemctl halt</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162658344">
<h2>Discussion</h2>

<p>The <em>systemctl</em> shutdown commands do not have the many options that the legacy
commands do, which does not matter all that much because there are a lot of
redundant options in the legacy commands. There is one significant difference:
<em>systemctl shutdown</em> lacks the timed shutdown options supported by the
<em>shutdown</em> command<a data-type="indexterm" data-primary="shutdown commands" data-secondary="systemctl" data-startref="shutdown-systemctl" id="idm46466162656024"/><a data-type="indexterm" data-primary="systemctl command" data-secondary="shutdown with" data-startref="systemctl-shutdown" id="idm46466162654424"/> (see <a data-type="xref" href="#rec-shutdown">Recipe 3.2</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162651816">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 systemd-halt.service</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.2 Shutting Down, Timed Shutdowns, and Rebooting with the shutdown Command"><div class="sect1" id="rec-shutdown">
<h1>3.2 Shutting Down, Timed Shutdowns, and Rebooting with the shutdown Command</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162647624">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="shutdown commands" data-secondary="shutdown command options" id="shutdown-shutdown-options"/><a data-type="indexterm" data-primary="shutdown command" data-secondary="options" id="shutdown-options"/>want to use timed shutdowns, for example, 10 minutes from now or
at a specific time, and warn all logged-in users. Or you want to just shut down
now with no frills.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162643736">
<h2>Solution</h2>

<p>The <em>shutdown</em> command works the same way, whether it is symlinked to <em>systemctl</em>
or the legacy <em>shutdown</em> executable.</p>

<p>The following examples show how to shut down immediately, shut down a certain
number of minutes from now, cancel a shut down, shutdown at a specific time,
halt, and reboot.</p>

<p>Shut down immediately, with no notification to other logged-in users:</p>
<pre>$ <strong>shutdown -h now</strong></pre>

<p class="pagebreak-before less_space">Shut down<a data-type="indexterm" data-primary="timed shutdowns" data-secondary="with shutdown command" data-secondary-sortas="shutdown command" id="idm46466162637576"/> in 10 minutes with notifications:</p>
<pre>$ <strong>shutdown -h +10</strong>
Shutdown scheduled for Sun 2021-05-23 11:04:43 PDT, use 'shutdown -c' to cancel.
</pre>

<p>Other users on the system may see this message, depending on which Linux they are
using, and if they have a terminal open:</p>
<pre>Broadcast message from <i>duchess@client4</i> on pts/4 (Sun 2021-05-24 10:54:43 PDT):

The system is going down for poweroff at Sun 2021-05-24 11:04:43 PDT!</pre>

<p>Cancel the<a data-type="indexterm" data-primary="timed shutdowns" data-secondary="canceling" id="idm46466162633128"/><a data-type="indexterm" data-primary="canceling timed shutdowns" id="idm46466162631912"/> shutdown:</p>
<pre>$ <strong>shutdown -c</strong></pre>

<p>Logged-in users may see this message:</p>
<pre>Broadcast message from <i>duchess@client4</i> on pts/4 (Sun 2021-05-24 10:56:00 PDT):

The system shutdown has been cancelled</pre>

<p>Create your own message:</p>
<pre>$ <strong>shutdown -h +6 "Time to stop working and go outside to play!"</strong></pre>

<p>Rather than specifying minutes to shutdown, you may set a shutdown time in
24-hour hh:mm format. The following example shuts down the system at 10:15 P.M.:</p>
<pre>$ <strong>shutdown -h 22:15</strong></pre>

<p>Reboot:<a data-type="indexterm" data-primary="rebooting" data-secondary="with shutdown command" data-secondary-sortas="shutdown command" id="idm46466162626008"/></p>
<pre>$ <strong>shutdown -r</strong></pre>

<p>Halt the <a data-type="indexterm" data-primary="halting with shutdown command" id="idm46466162623112"/>system without powering off:</p>
<pre>$ <strong>shutdown -H</strong></pre>

<p>Running <em>shutdown</em> with no options is equivalent to <em>shutdown -h +1</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162642952">
<h2>Discussion</h2>

<p><em>shutdown</em> sends messages only when you use the <em>-h</em> option, except for
the <em>-h now</em> option, and when you use the <em>-k</em> option. These are <a data-type="indexterm" data-primary="wall messages" id="idm46466162617576"/>called <em>wall</em>
messages, which is short for “write to all logged-in users.” Linux distributions
vary in their support of this feature, so other users on your particular Linux
may not see these messages.</p>

<ul>
<li>
<p><em>--help</em> displays a summary of options.</p>
</li>
<li>
<p><em>-H</em>, <em>--halt</em>  performs a clean shutdown but does not power off the machine;
you must press and hold the power button to power off your machine.</p>
</li>
<li>
<p><em>-P</em>, <em>--poweroff</em> performs a clean shutdown and powers off the machine.</p>
</li>
<li>
<p><em>-r</em>, <em>--reboot</em> performs a clean shutdown and reboots the machine.</p>
</li>
<li>
<p><em>-k</em> sends a wall message without shutting down the machine.</p>
</li>
<li>
<p><em>--no-wall</em> disables wall<a data-type="indexterm" data-primary="shutdown commands" data-secondary="shutdown command options" data-startref="shutdown-shutdown-options" id="idm46466162606616"/><a data-type="indexterm" data-primary="shutdown command" data-secondary="options" data-startref="shutdown-options" id="idm46466162605640"/> messages.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162604120">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 shutdown</em></p>
</li>
<li>
<p><em>man 1 wall</em></p>
</li>
<li>
<p><em>man 8 systemd-halt.service</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.3 Shutting Down and Rebooting with halt, reboot, &#10;and poweroff"><div class="sect1" id="idm46466162599176">
<h1>3.3 Shutting Down and Rebooting with halt, reboot, 
<span class="keep-together">and poweroff</span></h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162598040">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="shutdown commands" data-secondary="halt command options" id="shutdown-halt-options"/><a data-type="indexterm" data-primary="shutdown commands" data-secondary="reboot command options" id="shutdown-reboot-options"/><a data-type="indexterm" data-primary="shutdown commands" data-secondary="poweroff command options" id="shutdown-poweroff-options"/><a data-type="indexterm" data-primary="halt command" data-secondary="options" id="halt-options"/><a data-type="indexterm" data-primary="reboot command" data-secondary="options" id="reboot-options"/><a data-type="indexterm" data-primary="poweroff command" data-secondary="options" id="poweroff-options"/>understand the <em>shutdown</em> command, and now you want to know what <em>halt</em>,
<em>reboot</em>, and <em>poweroff</em> are for, and how to use them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162586312">
<h2>Solution</h2>

<p>These are all pretty much the same.</p>

<p><em>halt</em> performs a clean shutdown, stopping all services and processes and
unmounting filesystems, but it does not power off the machine. After
the <em>halt</em> command is finished, you must press and hold the machine’s power
button to complete the shutdown.</p>

<p><em>reboot</em> performs a <a data-type="indexterm" data-primary="rebooting" data-secondary="with reboot command" data-secondary-sortas="reboot command" id="idm46466162583720"/>clean shutdown and restarts the system.</p>

<p><em>poweroff</em> performs a clean shutdown and powers off the machine:</p>
<pre>$ <strong>halt</strong>
$ <strong>reboot</strong>
$ <strong>poweroff</strong></pre>

<p>The <em>halt</em> and <em>poweroff</em> commands<a data-type="indexterm" data-primary="rebooting" data-secondary="with halt command" data-secondary-sortas="halt command" id="idm46466162577496"/><a data-type="indexterm" data-primary="rebooting" data-secondary="with poweroff command" data-secondary-sortas="poweroff command" id="idm46466162576408"/> can reboot the system:</p>
<pre>$ <strong>halt --reboot</strong>
$ <strong>poweroff --reboot</strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162573720">
<h2>Discussion</h2>

<p>If you’re thinking this all looks a little weird and redundant, you’re right.
As software ages, cruft accumulates and never goes away. Linux has been around
since 1991, and started out as a free clone of Unix, which was born in 1969.
That is a lot of years for the various contributors to tweak code and add their
own favorite features.</p>

<p><em>halt</em> and <em>poweroff</em> are the same commands and support the same options:</p>

<ul>
<li>
<p><em>--help</em> displays a summary of options.</p>
</li>
<li>
<p><em>--halt</em> performs a clean shutdown but does not power off the machine (yes,
<em>halt</em> and <em>halt --halt</em> do the same thing).</p>
</li>
<li>
<p><em>-p</em>, <em>--poweroff</em> performs a clean shutdown and powers off the machine (yes,
<em>poweroff</em> and <em>poweroff --poweroff</em> do the same thing) .</p>
</li>
<li>
<p><em>--reboot</em> performs a clean shutdown and restarts the machine.</p>
</li>
<li>
<p><em>-f</em>, <em>--force</em> forces an immediate halt or poweroff. Shutdown of all running
services is skipped, all processes are killed, and all filesystems are
unmounted or mounted read-only. Run it twice to force an unclean shutdown; for
example, <em>poweroff -f -f</em>,  which you should use only when normal shutdown
commands fail.</p>
</li>
<li>
<p><em>-w</em>, <em>--wtmp-only</em> does not perform a shutdown, but only writes an entry in
<em>/var/log/wtmp</em>.</p>
</li>
<li>
<p><em>-d</em>, <em>--no-wtmp</em> prevents writing<a data-type="indexterm" data-primary="shutdown commands" data-secondary="halt command options" data-startref="shutdown-halt-options" id="idm46466162556664"/><a data-type="indexterm" data-primary="shutdown commands" data-secondary="reboot command options" data-startref="shutdown-reboot-options" id="idm46466162555576"/><a data-type="indexterm" data-primary="shutdown commands" data-secondary="poweroff command options" data-startref="shutdown-poweroff-options" id="idm46466162554488"/><a data-type="indexterm" data-primary="halt command" data-secondary="options" data-startref="halt-options" id="idm46466162553400"/><a data-type="indexterm" data-primary="reboot command" data-secondary="options" data-startref="reboot-options" id="idm46466162552216"/><a data-type="indexterm" data-primary="poweroff command" data-secondary="options" data-startref="poweroff-options" id="idm46466162550872"/> a <em>wtmp</em> entry.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162552088">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 halt</em></p>
</li>
<li>
<p><em>man 8 poweroff</em></p>
</li>
<li>
<p><em>man 8 systemd-halt.service</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.4 Sending Your System into Sleep Modes with systemctl"><div class="sect1" id="idm46466162544040">
<h1>3.4 Sending Your System into Sleep Modes with systemctl</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162543032">
<h2>Problem</h2>

<p>Your<a data-type="indexterm" data-primary="systemctl command" data-secondary="sleep modes" id="systemctl-sleepmode"/><a data-type="indexterm" data-primary="sleep modes" id="sleepmode-systemctl"/><a data-type="indexterm" data-primary="power management" data-secondary="sleep modes" id="power-sleepmode-systemctl"/> Linux system has systemd, and you want to use <em>systemctl</em> to
manage system sleep modes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162537784">
<h2>Solution</h2>

<p><em>systemctl</em> provides these power saving modes: <em>suspend</em>, <em>hibernate</em>,
<em>hybrid-sleep</em>, and <em>suspend-then-hibernate</em>.</p>

<p>Put your system into<a data-type="indexterm" data-primary="suspend mode" id="idm46466162533016"/> suspend mode:</p>
<pre>$ <strong>systemctl suspend</strong></pre>

<p>This stores your current session in RAM and puts all hardware into a suspended
state. Wake your system up by pressing any key, moving the mouse, or opening
your laptop lid.</p>

<p>Put your system into<a data-type="indexterm" data-primary="hibernate mode" id="idm46466162530696"/> hibernate mode:</p>
<pre>$ <strong>systemctl hibernate</strong></pre>

<p>This stores your session on disk and powers off the machine. Wake it up by
pressing the power button, and when it resumes, which can take a minute or two,
your session will be restored where you left off.</p>

<p>Put your system into<a data-type="indexterm" data-primary="hybrid-sleep mode" id="idm46466162528408"/> hybrid-sleep mode:</p>
<pre>$ <strong>systemctl hybrid-sleep</strong></pre>

<p>This suspends your system to both memory and disk, and shuts off all devices
except RAM. If your system RAM loses power, the system resumes from disk.
Wake it up by pressing the power button.</p>

<p>Put your system into<a data-type="indexterm" data-primary="suspend-then-hibernate mode" id="idm46466162525880"/> suspend-then-hibernate mode:</p>
<pre>$ <strong>systemctl suspend-then-hibernate</strong></pre>

<p><em>suspend-then-hibernate</em> first goes into suspend mode, then enters hibernation
after the period of time specified by the HibernateDelaySec= setting in
<em>/etc/systemd/sleep.conf</em>. Wake it up by pressing the power button.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162536632">
<h2>Discussion</h2>

<p>See the Discussion in <a data-type="xref" href="#rec-rtc-wakeups">Recipe 3.9</a> for details on the different sleep
states.</p>

<p>Your graphical desktop should have buttons for entering power saving modes and
a graphical configuration tool for controlling events such as screen blanking,
screen locking, power button, mouse, and laptop lid actions such as entering a
sleep state or powering off.</p>

<p>Power management tends to work best on laptops and may not behave as expected on
your Linux distribution. Power management is affected by your UEFI, CPU
capabilities, udev, Advanced Configuration and Power Interface (ACPI), kernel compilation options, and possibly other devices
and programs; so much depends on how your particular Linux has implemented power
management. Check your Linux distribution <a data-type="indexterm" data-primary="systemctl command" data-secondary="sleep modes" data-startref="systemctl-sleepmode" id="idm46466162515144"/><a data-type="indexterm" data-primary="sleep modes" data-startref="sleepmode-systemctl" id="idm46466162513896"/><a data-type="indexterm" data-primary="power management" data-secondary="sleep modes" data-startref="power-sleepmode-systemctl" id="idm46466162512920"/>documentation.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162518408">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 systemctl</em></p>
</li>
<li>
<p><em>man 8 systemd-halt.service</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.5 Rebooting Out of Trouble with Ctrl-Alt-Delete"><div class="sect1" id="idm46466162510664">
<h1>3.5 Rebooting Out of Trouble with Ctrl-Alt-Delete</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162509816">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="rebooting" data-secondary="with Ctrl-Alt-Delete" data-secondary-sortas="Ctrl-Alt-Delete" id="reboot-ctrl-alt-delete"/><a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="rebooting with" id="ctrl-alt-delete-reboot"/>want a reliable method of rebooting that always works, even when you are
having problems such as crashes and runaway processes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162505320">
<h2>Solution</h2>

<p>The good old “three-key salute,” Ctrl-Alt-Delete, was made for this. Press and
hold these three keys in sequence, and they will override most problems and
reboot your system. Ctrl-Alt-Delete is disabled in some Linux distributions, and you
can change this.</p>

<p>Ctrl-Alt-Delete is controlled by systemd in the Linux console. See
<a data-type="xref" href="#rec-systemd-ctraltdel">Recipe 3.6</a> to learn about managing Ctrl-Alt-Delete in systemd.</p>

<p>For systems without systemd, see the Discussion in this recipe.</p>

<p>Graphical environments<a data-type="indexterm" data-primary="graphical environments" data-secondary="Ctrl-Alt-Delete configuration" id="idm46466162502792"/><a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="configuration" data-tertiary="in graphical environments" data-tertiary-sortas="graphical environments" id="idm46466162500024"/> have their own configuration tools for Ctrl-Alt-Delete,
independent of systemd. For example, there is a keyboard configuration module in
the Xfce4 Settings Manager (<a data-type="xref" href="#fig-keyboard-shortcuts">Figure 3-1</a>); in GNOME, use the
Keyboard Settings module in the GNOME Settings utility.</p>

<figure class="width-70"><div id="fig-keyboard-shortcuts" class="figure">
<img src="Images/lcb2_0301.png" alt="Configuring Ctrl-Alt-Deletein Xubuntu" width="626" height="543"/>
<h6><span class="label">Figure 3-1. </span>Settings → Keyboard → Applications, configuring keyboard shortcuts in Xubuntu</h6>
</div></figure>

<p>If you prefer a different key combination, use any keys you want. You
could even use a single key, though that risks rebooting with an accidental key
press.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162494552">
<h2>Discussion</h2>

<p>On Linux systems<a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="configuration" data-tertiary="in /etc/inittab file" data-tertiary-sortas="/etc/inittab file" id="idm46466162493016"/><a data-type="indexterm" data-primary="/etc/inittab" id="idm46466162491320"/> that do not use systemd, Ctrl-Alt-Delete is controlled by the
<em>/etc/inittab</em> file. This example, from MX Linux, shows a typical configuration:</p>
<pre># What to do when CTRL-ALT-DEL is pressed.
ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -r now</pre>

<p><em>12345</em> makes it active in runlevels 1, 2, 3, 4, and 5. <em>-t1</em> means wait one
second, <em>-a</em> calls <em>/etc/shutdown.allow</em>, and <em>-r</em> is reboot. Configure it to
power off the system with the <em>-h</em> option, just like running <em>shutdown</em> from
the command line (see <a data-type="xref" href="#rec-shutdown">Recipe 3.2</a>). To disable Ctrl-Alt-Delete, comment out the
line with the <em>shutdown</em> command.</p>

<p>Note that <em>-t1</em> and <em>-a</em> are not present in all <em>shutdown</em> command implementations.
The preceding example is from MX Linux. MX Linux supports both the Unix System V initialization system (SysV init) and systemd,
and you select the one you want to use from the boot menu.</p>

<p>Ctrl-Alt-Delete is coded into the IBM PC BIOS/UEFI, and it should always reboot a system before the operating system is launched, up to the moment before GRUB
launches the operating system.</p>

<p>Ctrl-Alt-Delete was created by IBM engineer David Bradley <a data-type="indexterm" data-primary="Bradley, David" id="idm46466162480792"/>for the IBM PC BIOS.
Orignally it was a developer tool and not intended for users. It required two
hands by design, to make it difficult to press by accident.</p>

<p>Then Microsoft adopted it to bring up the Task Manager on the first press, and to
reboot on the second press. Then in Windows NT it was used to access the Windows
login screen. Supposedly this was a security measure that prevented users from being
deceived by fake login screens, which I never knew was a risk, but that was a long
time ago. There is a funny exchange about the invention and use of Ctrl-Alt-Delete
between Mr. Bradley and Bill Gates<a data-type="indexterm" data-primary="Gates, Bill" id="idm46466162481224"/> preserved in a YouTube video, which hopefully
will stay up<a data-type="indexterm" data-primary="rebooting" data-secondary="with Ctrl-Alt-Delete" data-secondary-sortas="Ctrl-Alt-Delete" data-startref="reboot-ctrl-alt-delete" id="idm46466162479512"/><a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="rebooting with" data-startref="ctrl-alt-delete-reboot" id="idm46466162476248"/> forever:
<a href="https://oreil.ly/e83k6">“Control-Alt-Delete: David Bradley &amp; Bill Gates”</a>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162494296">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 7 systemd.special</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.6 Disabling, Enabling, and Configuring Ctrl-Alt-Delete in the Linux Console"><div class="sect1" id="rec-systemd-ctraltdel">
<h1>3.6 Disabling, Enabling, and Configuring Ctrl-Alt-Delete in the Linux Console</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162470392">
<h2>Problem</h2>

<p>systemd <a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="configuration" data-tertiary="with systemd" data-tertiary-sortas="systemd" id="ctrl-alt-delete-systemd"/><a data-type="indexterm" data-primary="systemd" data-secondary="Ctrl-Alt-Delete configuration" id="systemd-ctrl-alt-delete-config"/>controls the behavior of Ctrl-Alt-Delete in the Linux console, and you
want to know how to manage it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162466008">
<h2>Solution</h2>

<p>You can check the status, disable or enable Ctrl-Alt-Delete, or change it to
power off the system.</p>

<p>The Ctrl-Alt-Delete unit file is not a service, but a target, so it does not run
as a daemon. If the <em>/etc/systemd/system/ctrl-alt-del.target</em> symlink exists,
Ctrl-Alt-Delete is enabled.</p>

<p>The following example<a data-type="indexterm" data-primary="disabling" data-secondary="Ctrl-Alt-Delete" id="idm46466162462760"/> disables and masks <em>ctrl-alt-del.target</em>:</p>
<pre>$ <strong>sudo systemctl disable ctrl-alt-del.target</strong>
Removed /etc/systemd/system/ctrl-alt-del.target.

$ <strong>sudo systemctl mask ctrl-alt-del.target</strong>
Created symlink /etc/systemd/system/ctrl-alt-del.target → /dev/null.</pre>

<p>Unmask<a data-type="indexterm" data-primary="enabling" data-secondary="Ctrl-Alt-Delete" id="idm46466162458680"/> and re-enable it:</p>
<pre>$ <strong>sudo systemctl unmask ctrl-alt-del.target</strong>
Removed /etc/systemd/system/ctrl-alt-del.target.

$ <strong>sudo systemctl enable ctrl-alt-del.target</strong>
Created symlink /etc/systemd/system/ctrl-alt-del.target →
/lib/systemd/system/reboot.target.</pre>

<p>The changes take effect immediately.</p>

<p>Change it to <a data-type="indexterm" data-primary="shutdown commands" data-secondary="Ctrl-Alt-Delete as" id="idm46466162454984"/><a data-type="indexterm" data-primary="poweroff command" data-secondary="symlink with Ctrl-Alt-Delete" id="idm46466162454136"/><a data-type="indexterm" data-primary="symlinks" data-secondary="for Ctrl-Alt-Delete" data-secondary-sortas="Ctrl-Alt-Delete" id="idm46466162453256"/>power off the system by linking the <em>ctrl-alt-del.target</em> unit to the
<em>poweroff.target</em> unit. First, disable it to remove the existing symlink, then
create the new symlink:</p>
<pre>$ <strong>sudo systemctl disable ctrl-alt-del.target</strong>
Removed /etc/systemd/system/ctrl-alt-del.target.

$ <strong>sudo ln -s /lib/systemd/system/poweroff.target \
  /etc/systemd/system/ctrl-alt-del.target</strong>
</pre>

<p>Now it will power off the system instead of rebooting.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162465432">
<h2>Discussion</h2>

<p>Use <a data-type="indexterm" data-primary="stat command" id="idm46466162447432"/>the <em>stat</em> command to see symlinks:</p>
<pre>$ <strong>stat /lib/systemd/system/ctrl-alt-del.target</strong>
  File: /lib/systemd/system/ctrl-alt-del.target -&gt; reboot.target
  Size: 13              Blocks: 0          IO Block: 4096   symbolic link
Device: 802h/2050d      Inode: 136890      Links: 1
Access: (0777/lrwxrwxrwx)  Uid: ( 0/ root)   Gid: ( 0/ root)</pre>

<p>You should not change any <em>/lib/systemd/system/</em> links. Instead, create the
new symlink in <em>/etc/systemd/system/</em> so that your change is not overwritten by
system<a data-type="indexterm" data-primary="Ctrl-Alt-Delete" data-secondary="configuration" data-tertiary="with systemd" data-tertiary-sortas="systemd" data-startref="ctrl-alt-delete-systemd" id="idm46466162443000"/><a data-type="indexterm" data-primary="systemd" data-secondary="Ctrl-Alt-Delete configuration" data-startref="systemd-ctrl-alt-delete-config" id="idm46466162441432"/> updates.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162443848">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 7 systemd.special</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.7 Creating Scheduled Shutdowns with cron"><div class="sect1" id="rec-scheduled-shutdowns-cron">
<h1>3.7 Creating Scheduled Shutdowns with cron</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162436328">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="shutdown commands" data-secondary="scheduled shutdowns" data-tertiary="with cron" data-tertiary-sortas="cron" id="shutdown-schedule-cron"/><a data-type="indexterm" data-primary="scheduled shutdowns" data-secondary="with cron" data-secondary-sortas="cron" id="schedule-shutdown-cron"/><a data-type="indexterm" data-primary="cron" data-secondary="scheduled shutdowns" id="cron-schedule-shutdown"/><a data-type="indexterm" data-primary="crontab command" data-secondary="scheduled shutdowns" id="crontab-schedule-shutdown"/> want your machine to turn itself off at night so you can walk away and not
worry about it. Or, your users are careless watt wasters who refuse to develop
the habit of shutting their PCs down at night.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162428760">
<h2>Solution</h2>

<p>Use <em>cron</em> to create scheduled shutdowns. For example, add this line to
<em>/etc/crontab</em> to shut down every night at 10:30 P.M., with a 20-minute warning.
Editing <em>/etc/crontab</em> requires root permissions, and the following example
uses the nano text editor:</p>
<pre>$ <strong>sudo nano /etc/crontab</strong>
#  m   h   dom mon dow   user    command
<strong>  10  22    *   *   *    root    /sbin/shutdown -h +20</strong></pre>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Before doing this on your work computer, check your employer’s policies. If they
run updates and backups at night, then your computer may need to stay on.</p>
</div>

<p>This example runs only at 11 P.M. on weekdays and shuts down immediately:</p>
<pre>#  m   h   dom mon dow   user    command
<strong>  00  23    *   *  1-5   root    /sbin/shutdown -h now</strong></pre>

<p class="pagebreak-before less_space">Another way is to use the <em>crontab</em> command as root or with <em>sudo</em>:</p>
<pre>$ <strong>sudo crontab -e</strong>
# m   h     dom mon  dow command
<strong>  00  23    *   *    1-5 /sbin/shutdown -h now</strong></pre>

<p>There is no name field when you run <em>crontab</em>, as there is in <em>/etc/crontab</em>.
The previous example opens the root user’s crontab in edit mode. Edit and save,
then you’re done.</p>

<p>Don’t try to name the file yourself. During editing it is a temporary file,
which is automatically renamed by <em>crontab</em> when you save it. It will be saved in
<em>/var/spool/cron/crontabs</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162428184">
<h2>Discussion</h2>

<p><em>/etc/crontab</em> has a name field, so any user can have entries in this file, but
only root can edit <em>/etc/crontab</em>. Users who want to control their own
personal crontabs should use the <em>crontab</em> command, as personal crontabs do not
require root permissions.</p>

<p>The fields in <em>/etc/crontab</em> can take a little getting used to (<a data-type="xref" href="#crontab_values">Table 3-1</a>), so here are
more examples and explanations.</p>
<table id="crontab_values">
<caption><span class="label">Table 3-1. </span>Table of crontab values</caption>
<thead>
<tr>
<th>Field</th>
<th>Allowed values</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>minute</p></td>
<td><p>0-59</p></td>
</tr>
<tr>
<td><p>hour</p></td>
<td><p>0-23</p></td>
</tr>
<tr>
<td><p>day of month</p></td>
<td><p>1-31</p></td>
</tr>
<tr>
<td><p>month</p></td>
<td><p>1-12</p></td>
</tr>
<tr>
<td><p>day of week</p></td>
<td><p>0-7</p></td>
</tr>
</tbody>
</table>

<p>The asterisk * is a wildcard for “all.”</p>

<p>Shut down only on weekends:</p>
<pre># shutdown at 1:05 am Saturdays and Sundays
<strong>00 01   * * 7,0   root /sbin/shutdown -h +5</strong></pre>

<p>There is a quirk in <em>cron</em> that Sunday is 0 or 7. This dates back to very olden
times, and I have no idea why it persists. You’ll have to test it to see
what works, so you may need to use <em>6,7</em> for Saturday, Sunday:</p>
<pre><strong>00 01   * * 6,7   root /sbin/shutdown -h +5</strong></pre>

<p>It would be nice to use <em>sat,sun</em>, but you can only enter one day by name, and
cannot use names in lists. Days of the week and months are named with the
first three letters: sat, sun, jan, feb. Case does not matter.</p>

<p>You can use ranges: 1–4 means 1, 2, 3, and 4.</p>

<p>Ranges and lists can be mixed: 1, 3, 5, 6-10.</p>

<p>Step values follow ranges:</p>

<ul>
<li>
<p>10–23/2  is every second hour in the range</p>
</li>
<li>
<p>*/2 in the dow field means every other day</p>
</li>
<li>
<p>2–6/2 equals 2, 4, 6</p>
</li>
</ul>

<p>The following strings are nice shortcuts that replace the first <a data-type="indexterm" data-primary="shutdown commands" data-secondary="scheduled shutdowns" data-tertiary="with cron" data-tertiary-sortas="cron" data-startref="shutdown-schedule-cron" id="idm46466162388168"/><a data-type="indexterm" data-primary="scheduled shutdowns" data-secondary="with cron" data-secondary-sortas="cron" data-startref="schedule-shutdown-cron" id="idm46466162386600"/><a data-type="indexterm" data-primary="cron" data-secondary="scheduled shutdowns" data-startref="cron-schedule-shutdown" id="idm46466162385272"/><a data-type="indexterm" data-primary="crontab command" data-secondary="scheduled shutdowns" data-startref="crontab-schedule-shutdown" id="idm46466162384184"/>five fields:</p>

<pre data-type="programlisting">@reboot
@yearly
@annually
@monthly
@weekly
@daily
@midnight
@hourly</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162388952">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 cron</em></p>
</li>
<li>
<p><em>man 1 crontab</em></p>
</li>
<li>
<p><em>man 5 crontab</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.8 Scheduling Automated Startups with UEFI Wake-Ups"><div class="sect1" id="rec-uefi-wakeup">
<h1>3.8 Scheduling Automated Startups with UEFI Wake-Ups</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162376696">
<h2>Problem</h2>

<p>Scheduled <a data-type="indexterm" data-primary="startup commands" data-secondary="scheduled startups" data-tertiary="with BIOS/UEFI setup" data-tertiary-sortas="BIOS/UEFI setup" id="startup-schedule-biosuefi"/><a data-type="indexterm" data-primary="scheduled startups" data-secondary="with BIOS/UEFI setup" data-secondary-sortas="BIOS/UEFI setup" id="schedule-startup-biosuefi"/><a data-type="indexterm" data-primary="BIOS/UEFI setup" data-secondary="scheduled startups" id="BIOS-UEFI-schedule-startup"/>shutdowns are so wonderful, you want scheduled wake-ups as well.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162370312">
<h2>Solution</h2>

<p>You’re in luck, because Linux supports scheduled wake-ups. There are three
methods to try: Wake-on-LAN, real-time clock (RTC) wake-ups, or your computer’s UEFI setup, if it
has a scheduled wake-up feature.</p>

<p>UEFI wake-ups are the most reliable. <a data-type="xref" href="#fig-bios-wakeup">Figure 3-2</a> shows the scheduled
wake-up screen on a Lenovo ThinkPad.</p>

<figure><div id="fig-bios-wakeup" class="figure">
<img src="Images/lcb2_0302.png" alt="Lenovo UEFI wake-up scheduler" width="900" height="512"/>
<h6><span class="label">Figure 3-2. </span>Scheduling wake-ups in a Lenovo UEFI</h6>
</div></figure>

<p>Enter your UEFI setup by pressing the appropriate F<em>n</em> key at startup. On
Dell, ASUS, and Acer systems this is usually F2; Lenovo uses F1. This varies, however. For example, some systems use the Delete key, so check your
machine’s documentation. Some systems tell which key to press on their startup
screens. It can be a bit tricky to press the key at the right time, so
start pressing it right after you press the power button, just like banging on
an elevator button to make it arrive faster.</p>

<p>If your system does not have a UEFI wake-up feature, try either Wake-on-LAN (see
<a data-type="xref" href="#rec-wol-wired-wakeups">Recipe 3.10</a>, which requires a second device to send a wake-up
signal), or RTC wake-ups (see <a data-type="xref" href="#rec-rtc-wakeups">Recipe 3.9</a>).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162363064">
<h2>Discussion</h2>

<p>Let’s discuss briefly what BIOS and UEFI mean. When you boot up your
computer, the first startup instructions come from the Basic Input Output
System (BIOS), or the Unified Extensible Firmware Interface (UEFI) firmware
stored on the computer’s motherboard. BIOS is the old legacy system that has
been with us since 1980. UEFI is its modern replacement. UEFI includes legacy
BIOS support, though someday this will be removed. Nearly all computers made
after the mid-2000s have UEFI.</p>

<p>UEFI has considerably more features than the old BIOS, and is like a little
operating system. The UEFI setup screens control boot order, boot devices,
security options, Secure Boot, overclocking, displaying hardware health,
networking, and many more <a data-type="indexterm" data-primary="startup commands" data-secondary="scheduled startups" data-tertiary="with BIOS/UEFI setup" data-tertiary-sortas="BIOS/UEFI setup" data-startref="startup-schedule-biosuefi" id="idm46466162362008"/><a data-type="indexterm" data-primary="scheduled startups" data-secondary="with BIOS/UEFI setup" data-secondary-sortas="BIOS/UEFI setup" data-startref="schedule-startup-biosuefi" id="idm46466162351240"/><a data-type="indexterm" data-primary="BIOS/UEFI setup" data-secondary="scheduled startups" data-startref="BIOS-UEFI-schedule-startup" id="idm46466162354152"/>functions.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162354024">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="#rec-rtc-wakeups">Recipe 3.9</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-wol-wired-wakeups">Recipe 3.10</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-wol-wifi-wakeups">Recipe 3.11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.9 Scheduling Automated Startups with RTC Wake-ups"><div class="sect1" id="rec-rtc-wakeups">
<h1>3.9 Scheduling Automated Startups with RTC Wake-ups</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162346744">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="startup commands" data-secondary="scheduled startups" data-tertiary="with rtcwake command" data-tertiary-sortas="rtcwake command" id="startup-schedule-rtcwake"/><a data-type="indexterm" data-primary="scheduled startups" data-secondary="with rtcwake command" data-secondary-sortas="rtcwake command" id="schedule-startup-rtcwake"/><a data-type="indexterm" data-primary="rtcwake command" id="rtcwake"/><a data-type="indexterm" data-primary="RTC (real-time clock)" data-secondary="scheduled startups with" id="rtc-schedule-startup"/><a data-type="indexterm" data-primary="real-time clock" data-see="RTC" id="idm46466162339832"/> want to set up scheduled wake-ups with RTC because your UEFI setup does not
have a scheduled wake-up feature, or because you just want to.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162337832">
<h2>Solution</h2>

<p>Use the <em>rtcwake</em> command, which should already be present on your system from
the <em>util-linux</em> package. <em>rtcwake</em> stops and wakes your system. You may set
it to wake up your system after a specified interval, such as 1800 seconds from
now, or at a scheduled time and date.</p>

<p>Your system’s real-time clock (RTC) should be set to Coordinated Universal Time
(UTC).</p>

<p>When <em>rtcwake</em> stops your system, it sends it into an ACPI sleep state. Look in
<em>/sys/power/state</em> to see which sleep states your system supports. In the
following example, only three of the six ACPI sleep states are supported:</p>
<pre>$ <strong>cat /sys/power/state</strong>
freeze mem disk</pre>

<p>On non-systemd Linuxes, run <em>cat /proc/acpi/info</em>.</p>

<p>In the above example, we have three sleep states to try. Test each one
according to the following example:</p>
<pre>$ <strong>sudo rtcwake -m freeze -s 60</strong></pre>

<p><em>-m</em> specifies the standby mode, and <em>-s</em> is the number of seconds until the
system starts up again. When it is successful, you will see your system go into
a sleep state, then wake up, and you will see either a success message or
an error message.</p>

<p>The following example does a dry run of scheduling a wake-up tomorrow at 8 A.M.:</p>
<pre>$ <strong>sudo rtcwake -n -m disk no -u -t $(date +%s -d "tomorrow 08:00")</strong>
rtcwake: wakeup from "disk" using /dev/rtc0 at Mon Nov 23 08:00:00 2021</pre>

<p>Remove <em>-n</em> to disable the dry run and run it for real.</p>

<p>The following is a nice, simple <em>/etc/crontab</em> example to automate shutdowns and
wake-ups. The <em>rtcwake</em> command suspends to disk at 11 P.M. on weeknights and wakes
up 8 hours later:</p>
<pre>#  m   h   dom mon dow   user    command
<strong>  00  23    *   *  1-5   root    /usr/sbin/rtcwake -m disk -s 28800</strong>
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162337288">
<h2>Discussion</h2>

<p>Look in your system’s BIOS/UEFI to verify that your hardware clock is <a data-type="indexterm" data-primary="UTC (Coordinated Universal Time)" id="idm46466162320680"/>set to UTC.
If there is no button or some kind of setting to change the real-time clock to
UTC, change the time manually to the current UTC time.</p>

<p>The example that includes <em>-u -t +$(date +%s -d “tomorrow 08:00”)</em> converts Unix
epoch time to human-readable values. Unix epoch time is the number of seconds elapsed
since midnight January 1, 1970 UTC. <em>date +%s</em> reports the current Unix epoch time.
The <em>-t</em> option passes Unix epoch time to <em>date</em> for conversion, and <em>-u</em>
specifies that your hardware clock is set to UTC.</p>

<p>The <em>no</em> option for <em>rtcwake</em> means do not go into a sleep state, but only set
the wake-up time. Remove the <em>no</em> option to immediately go into a sleep state.</p>

<p>Real-time clock (RTC) wake-ups are the least reliable. Your system has to be put
into an Advanced Configuration and Power Interface (ACPI) sleep state
supported<a data-type="indexterm" data-primary="ACPI (Advanced Configuration and Power Interface)" id="idm46466162316216"/><a data-type="indexterm" data-primary="sleep modes" id="idm46466162314984"/><a data-type="indexterm" data-primary="power management" data-secondary="ACPI sleep states" id="idm46466162314376"/> by your Linux. ACPI is the modern power management standard
for managing sleep states. It is supposed to be vendor neutral and
hardware independent, but the standard is complex and hardware vendors often
support only a subset of its capabilities. Adding to the fun, the various
Linuxes implement it in different ways.</p>

<p>There are six ACPI sleep states, S0-S5. The Linux kernel is capable of
supporting up to four, and distributions vary in which ones and how many:</p>
<dl>
<dt>S0</dt>
<dd>
<p>System is running, monitor may be off, most peripherals are on.</p>
</dd>
<dt>S1</dt>
<dd>
<p>Power-on suspended, CPU stops, power to CPU and RAM is on.</p>
</dd>
<dt>S2</dt>
<dd>
<p>CPU is powered off, dirty cache is flushed to RAM.</p>
</dd>
<dt>S3</dt>
<dd>
<p>Also called standby, sleep, and suspend-to-RAM. Data may not be written to disk.</p>
</dd>
<dt>S4</dt>
<dd>
<p>Hibernation, suspend-to-disk. Everything in RAM is written to disk and the system is powered down.</p>
</dd>
<dt>S5</dt>
<dd>
<p>Similar to powering the system off, except there is still power to the power button and peripherals, such as the keyboard, network interface, <a data-type="indexterm" data-primary="startup commands" data-secondary="scheduled startups" data-tertiary="with rtcwake command" data-tertiary-sortas="rtcwake command" data-startref="startup-schedule-rtcwake" id="idm46466162303368"/><a data-type="indexterm" data-primary="scheduled startups" data-secondary="with rtcwake command" data-secondary-sortas="rtcwake command" data-startref="schedule-startup-rtcwake" id="idm46466162301592"/><a data-type="indexterm" data-primary="rtcwake command" data-startref="rtcwake" id="idm46466162299832"/><a data-type="indexterm" data-primary="RTC (real-time clock)" data-secondary="scheduled startups with" data-startref="rtc-schedule-startup" id="idm46466162298888"/>and USB devices.</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162322888">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 cron</em></p>
</li>
<li>
<p><em>man 8 rtcwake</em></p>
</li>
<li>
<p><a href="https://timeanddate.com">Time and Date</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.10 Setting Up Remote Wake-Ups with Wake-on-LAN over Wired Ethernet"><div class="sect1" id="rec-wol-wired-wakeups">
<h1>3.10 Setting Up Remote Wake-Ups with Wake-on-LAN over Wired Ethernet</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162290936">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="startup commands" data-secondary="remote startups" data-tertiary="with Wake-on-LAN" data-tertiary-sortas="Wake-on-LAN" id="startup-remote-wakeonlan"/><a data-type="indexterm" data-primary="remote startups" data-secondary="with Wake-on-LAN" data-secondary-sortas="Wake-on-LAN" id="remote-startup-wakeonlan"/><a data-type="indexterm" data-primary="Wake-on-LAN, remote startups with" id="wakeonlan-remote-startup"/><a data-type="indexterm" data-primary="wakeonlan command" id="wakeonlan-command"/>want to set up remotely triggered wake-ups with Wake-on-LAN
because your UEFI setup does not have a scheduled wake-up feature, or it
is too simple for your needs, or you want the flexibility to send a wake-up
signal at random times. This recipe is for waking up a machine on the same
network as the device you use to send the wake-up signal, and your target
machine must use a wired Ethernet interface.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162283784">
<h2>Solution</h2>

<p>Configure your PC to listen for wake-up requests, then use a second device,
such as another computer, a smartphone, or a Raspberry Pi to send the wake-up
signal, which is called <a data-type="indexterm" data-primary="magic packets" id="idm46466162280424"/>the <em>magic packet</em>. Which isn’t really magic, but
merely a specialized packet designed specifically for remote wake-ups. (Yes, I
too am sad it is not real magic.)</p>

<p>Start by booting into your system’s UEFI setup and look for settings for
enabling Wake-on-LAN.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>An important precaution is to disable all settings that enable <a data-type="indexterm" data-primary="PXE booting" id="idm46466162281064"/><a data-type="indexterm" data-primary="booting" data-secondary="PXE booting" id="idm46466162277048"/>PXE (preboot execution environment) booting. If
PXE boot is enabled, and you have a PXE server (a preboot execution environment server, which is booting from a network installation server) on your network, it is possible
that your machine will wake up to PXE boot and install a new image, overwriting
the existing installation.</p>
</div>

<p>Then exit and finish starting up. Install the <em>wakeonlan</em> and <em>ethtool</em>
packages.</p>

<p>Fetch the name of your Ethernet interface, which in this example is <em>enp0s25</em>,
and use <em>ethtool</em> to verify that it supports Wake-on-LAN. The output is
abbreviated for clarity:</p>
<pre>$ <strong>ip addr show</strong>
2: enp0s25: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; state UP 0
    link/ether 9c:ef:d5:fe:8f:20 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.97/24 brd 192.168.1.255 scope global dynamic
    [...]

$ <strong>sudo ethtool enp0s25 | grep -i wake-on</strong>
        Supports Wake-on: pumbg
        Wake-on: g </pre>

<p>Record the MAC address of your interface. In the preceding <em>ip</em> example, the
“ether” line lists the MAC address, 9c:ef:d5:fe:8f:20. Yours will be
different, as MAC addresses are unique.</p>

<p>“Supports Wake-on: pumbg” is the magic phrase that verifies your interface
has the necessary support, indicated by the <em>g</em> switch. The second
line, “Wake-on: g,” tells you that it is already enabled. If it is not, enable
it:</p>
<pre>$ <strong>sudo ethtool -s <i>enp0s25</i> wol g</strong></pre>

<p>If it does not stay enabled after a restart, add an entry like this to <em>/etc/crontab</em>
to run the command after every restart:</p>
<pre>$ <strong>@reboot root /usr/bin/ethtool -s <i>enp0s25</i> wol g</strong></pre>

<p>Shut down the machine, and from a second device on the same network, send the
command to wake it up, using the MAC address of your target machine’s Ethernet
interface:</p>
<pre>$ <strong>/usr/bin/wakeonlan <i>9c:ef:d5:fe:8f:20</i></strong></pre>

<p>If your target machine and second device are on the same network but in
different subnets, specify the broadcast address for your target machine:</p>
<pre>$ <strong>/usr/bin/wakeonlan -i <i>192.168.44.255 9c:ef:d5:fe:8f:20</i></strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162283160">
<h2>Discussion</h2>

<p>Wake-on-LAN is an Ethernet standard for remotely waking up a computer by
sending it a wake-up signal over a network. <em>wakeonlan</em> is the name of the
command and the name of the package on most Linuxes.</p>

<p>When your computer is shut down, it isn’t really turned off, but is in a low
power mode, and can receive and act on the magic packet wake-up signal.</p>

<p><em>wakeonlan</em> sends the magic packet over UDP port 9. The magic packet goes
to the network’s broadcast address, and every host on the network receives this
packet. The MAC address ensures that only the host with that address will wake
up.</p>

<p>The target machine wakes up just as if you had pressed the<a data-type="indexterm" data-primary="startup commands" data-secondary="remote startups" data-tertiary="with Wake-on-LAN" data-tertiary-sortas="Wake-on-LAN" data-startref="startup-remote-wakeonlan" id="idm46466162255432"/><a data-type="indexterm" data-primary="remote startups" data-secondary="with Wake-on-LAN" data-secondary-sortas="Wake-on-LAN" data-startref="remote-startup-wakeonlan" id="idm46466162258728"/><a data-type="indexterm" data-primary="Wake-on-LAN, remote startups with" data-startref="wakeonlan-remote-startup" id="idm46466162254744"/><a data-type="indexterm" data-primary="wakeonlan command" data-startref="wakeonlan-command" id="idm46466162253896"/> power button.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162260360">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 wakeonlan</em></p>
</li>
<li>
<p><em>man 8 ethtool</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-uefi-wakeup">Recipe 3.8</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-rtc-wakeups">Recipe 3.9</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-wol-wifi-wakeups">Recipe 3.11</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="3.11 Setting Up Remote Wake-Ups over WiFi (WoWLAN)"><div class="sect1" id="rec-wol-wifi-wakeups">
<h1>3.11 Setting Up Remote Wake-Ups over WiFi (WoWLAN)</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466162244136">
<h2>Problem</h2>

<p>Your <a data-type="indexterm" data-primary="startup commands" data-secondary="remote startups" data-tertiary="with WoWLAN" data-tertiary-sortas="WoWLAN" id="startup-remote-wowlan"/><a data-type="indexterm" data-primary="remote startups" data-secondary="with WoWLAN" data-secondary-sortas="WoWLAN" id="remote-startup-wowlan"/><a data-type="indexterm" data-primary="WoWLAN (Wake-on-Wireless LAN), remote startups with" id="wowlan-remote-startup"/><a data-type="indexterm" data-primary="Wake-on-Wireless LAN (WoWLAN), remote startups with" id="wake-on-wireless"/>want to wake up a remote computer via its wireless interface
(Wake-on-Wireless LAN, or WoWLAN).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466162237016">
<h2>Solution</h2>

<p>This recipe is for waking up a machine on the same network as the device you
use to send the wake-up signal.</p>

<p>Your machine must have an onboard wireless interface, either integrated on the
motherboard or peripheral component interconnect (PCI). It will not work with 
<span class="keep-together">a USB</span> interface because there is no
power to the USB bus when the machine is 
<span class="keep-together">shut down.</span></p>

<p>First, enter the UEFI setup of the machine you want to wake up remotely and
enable any Wake-on-LAN settings.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>An important precaution is to also
disable all settings that enable PXE booting. If PXE boot is enabled and you
have a PXE server on your network, it is possible that your machine will wake
up to PXE boot and install a new image, overwriting the existing installation.</p>
</div>

<p>Then exit and finish starting up. Install <a data-type="indexterm" data-primary="iw command" id="iw-command"/>the <em>iw</em> command, and use it to list
all of your wireless devices:</p>
<pre>$ <strong>iw dev</strong>
phy#0
        Interface <i>wlxcc3fd5fe014c</i>
                ifindex 3
                wdev 0x1
                addr <i>9c:bf:25:fe:0e:7c</i>
                ssid <i>accesspointe</i>
                type managed
                channel 11 (2462 MHz), width: 20 MHz, center1: 2462 MHz
                txpower 20.00 dBm </pre>

<p>If there is more than one, query the one you want to use. The following example
shows a wireless interface that does not support WoWLAN:</p>
<pre>$ <strong>iw phy0 wowlan show</strong>
command failed: Operation not supported (-95)</pre>

<p>The following example is for an interface that supports WoWLAN, and it is not
enabled:</p>
<pre>$ <strong>iw phy0 wowlan show</strong>
WoWLAN is disabled</pre>

<p>Enable WoWLAN:</p>
<pre>$ <strong>sudo iw phy0 wowlan enable magic-packet</strong>
WoWLAN is enabled:
  * wake up on magic packet</pre>

<p><em>iw dev</em> provides the MAC address, which your second device needs to send the
magic packet:</p>
<pre>$ <strong>/usr/bin/wakeonlan <i>9c:bf:25:fe:0e:7c</i></strong></pre>

<p>Send the magic packet to a machine on the same network, but in a different
subnet, using the broadcast address of the<a data-type="indexterm" data-primary="iw command" data-startref="iw-command" id="idm46466162219752"/> subnet:</p>
<pre>$ <strong>/usr/bin/wakeonlan -i <i>192.168.44.255 9c:bf:25:fe:0e:7c</i></strong></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466162236600">
<h2>Discussion</h2>

<p>This works well when the remote computer is a laptop, as laptops have
integrated wireless network interfaces that typically support more features.
Desktop machines usually don’t ship with integrated wireless interfaces, so you
must shop carefully for a PCI/PCIe wireless adapter that supports WoWLAN <a data-type="indexterm" data-primary="startup commands" data-secondary="remote startups" data-tertiary="with WoWLAN" data-tertiary-sortas="WoWLAN" data-startref="startup-remote-wowlan" id="idm46466162211336"/><a data-type="indexterm" data-primary="remote startups" data-secondary="with WoWLAN" data-secondary-sortas="WoWLAN" data-startref="remote-startup-wowlan" id="idm46466162215192"/><a data-type="indexterm" data-primary="WoWLAN (Wake-on-Wireless LAN), remote startups with" data-startref="wowlan-remote-startup" id="idm46466162213672"/><a data-type="indexterm" data-primary="Wake-on-Wireless LAN (WoWLAN), remote startups with" data-startref="wake-on-wireless" id="idm46466162212728"/>and
Linux.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466162211592">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 8 iw</em></p>
</li>
<li>
<p><em>man 1 wakeonlan</em></p>
</li>
<li>
<p><a data-type="xref" href="#rec-uefi-wakeup">Recipe 3.8</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-rtc-wakeups">Recipe 3.9</a></p>
</li>
<li>
<p><a data-type="xref" href="#rec-wol-wired-wakeups">Recipe 3.10</a></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>