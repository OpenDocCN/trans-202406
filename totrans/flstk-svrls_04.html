<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Introduction to Authentication"><div class="chapter" id="ch4">
<h1><span class="label">Chapter 4. </span>Introduction to Authentication</h1>


<p><a data-type="indexterm" data-primary="unique identifier" id="idm45364347724008"/><a data-type="indexterm" data-primary="authentication" data-secondary="about" id="idm45364347723304"/><em>Authentication</em> and <em>identity</em> are integral parts of almost any application. Knowing who the user is, what permissions they have, whether or not they are signed in, and having a unique identifier for the user allow your application to render the correct views and return the proper data for the currently signed-in user.</p>

<p><a data-type="indexterm" data-primary="OAUTH (open authentication)" id="idm45364347720936"/><a data-type="indexterm" data-primary="MFA (multifactor authentication)" id="idm45364347720264"/><a data-type="indexterm" data-primary="TOTP (time-based on time passwords)" id="idm45364347719624"/>Most applications require mechanisms to handle user sign-up, user sign-in, password encryption, and updating, as well as countless other tasks around identity management. Modern applications often call for things like open authentication (OAUTH), multifactor authentication (MFA), and time-based on time passwords (TOTP).</p>

<p><a data-type="indexterm" data-primary="Auth0" id="idm45364347718216"/><a data-type="indexterm" data-primary="Okta" id="idm45364347717512"/>In the past, developers had to hand roll all of this authentication functionality from scratch. This task alone could take a team of developers weeks, or even months, to get right and to do so securely. Today there are fully managed authentication services like Auth0, Okta, and Amazon Cognito that handle all of this for us.</p>

<p>In this chapter, you will learn how to properly and securely implement authentication in a React application using Amazon Cognito with AWS Amplify.</p>

<p><a data-type="indexterm" data-primary="public route" id="idm45364347715544"/><a data-type="indexterm" data-primary="profile route" id="idm45364347714840"/><a data-type="indexterm" data-primary="protected routes" id="idm45364347714168"/>The app that you will be building is a basic application that requires authentication in order to be viewed and also has a profile page showing profile information about the signed-in user. If the user is signed in, they can navigate between a <em>public route</em>, a <em>profile route</em> with an authentication form, and a <em>protected route</em> viewable only to signed-in users.</p>

<p>If they are not signed in, they can only view the public route and authentication form on the profile route. If the user tries to access a protected route when they are not signed in, we want to redirect them to the authentication form so that they can sign in and then access the route once authenticated.</p>

<p><a data-type="indexterm" data-primary="persist" id="idm45364347710792"/><a data-type="indexterm" data-primary="user state" id="idm45364347710088"/>This app will also persist <em>user state</em>, so if they refresh the app or navigate away from it and come back, they will stay signed in.</p>






<section data-type="sect1" data-pdf-bookmark="Introduction to Amazon Cognito"><div class="sect1" id="idm45364347708616">
<h1>Introduction to Amazon Cognito</h1>

<p>Amazon Cognito<a data-type="indexterm" data-primary="Amazon Cognito" data-secondary="about" id="aco_ab"/><a data-type="indexterm" data-primary="Cognito" data-secondary="about" id="co_ab"/><a data-type="indexterm" data-primary="identity service" id="idm45364347704552"/><a data-type="indexterm" data-primary="access control" id="idm45364347703880"/><a data-type="indexterm" data-primary="user identity management" id="idm45364347703208"/> is a fully managed <em>identity service</em> from AWS. Cognito allows for simple and secure user sign-up, sign-in, <em>access control</em>, and <em>user identity management</em>. Cognito scales to millions of users and also supports sign-in with social identity providers, such as Facebook, Google, and Amazon. It is also free for the first 50,000 users of any app.</p>








<section data-type="sect2" data-pdf-bookmark="How Amazon Cognito Works"><div class="sect2" id="idm45364347700824">
<h2>How Amazon Cognito Works</h2>

<p><a data-type="indexterm" data-primary="Amazon Cognito" data-secondary="how it works" id="idm45364347699496"/><a data-type="indexterm" data-primary="Cognito" data-secondary="how it works" id="idm45364347698520"/>Cognito has two main pieces: <em>user pools</em> and <em>identity pools</em>:</p>
<dl>
<dt>User pools</dt>
<dd>
<p><a data-type="indexterm" data-primary="user pools" id="idm45364347695160"/><a data-type="indexterm" data-primary="Cognito user pool" id="idm45364347694456"/>These provide a secure user directory that stores all your users and scales to hundreds of millions of users. It is a fully managed service. As a serverless technology, user pools are easy to set up without having to worry about standing up any infrastructure. User pools are what manage all of the users that sign up and sign in to the account, and are what we will be focusing on in this chapter.</p>
</dd>
<dt>Identity pools</dt>
<dd>
<p><a data-type="indexterm" data-primary="identity pools" id="idm45364347692088"/>These allow you to authorize users that are signed in to your application to access various other AWS services. Say you wanted to allow a user to have access to a Lambda function so that they could fetch data from another API; you could specify that while creating an identity pool. Where user pools come in is that the source of these identities could be a Cognito user pool or even Facebook or <span class="keep-together">Google.</span></p>
</dd>
</dl>

<p>Cognito user pools allow your application to invoke various methods against the service to manage all aspects of user identity, including such items as:</p>

<ul>
<li>
<p>Signing up a user</p>
</li>
<li>
<p>Signing in a user</p>
</li>
<li>
<p>Signing out a user</p>
</li>
<li>
<p>Changing a user’s password</p>
</li>
<li>
<p>Resetting a user’s password</p>
</li>
<li>
<p>Confirming an MFA code</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Amazon Cognito Integration with AWS Amplify"><div class="sect2" id="idm45364347683368">
<h2>Amazon Cognito Integration with AWS Amplify</h2>

<p><a data-type="indexterm" data-primary="Cognito" data-secondary="integrating with AWS Amplify" id="idm45364347681960"/><a data-type="indexterm" data-primary="signUp function" id="idm45364347680792"/><a data-type="indexterm" data-primary="signOut method" id="idm45364347680120"/><a data-type="indexterm" data-primary="signIn function" id="idm45364347679448"/><a data-type="indexterm" data-primary="Amazon Cognito" data-secondary="integrating with AWS Amplify" id="idm45364347678776"/><a data-type="indexterm" data-primary="Amplify" data-secondary="integrating Amazon Cognito with" id="idm45364347677816"/>AWS Amplify has support for Amazon Cognito in various ways. First of all, you can create and configure Amazon Cognito services directly from the Amplify CLI. Once you’ve created the authentication service via the CLI you can then call various methods (like <code>signUp</code>, <code>signIn</code>, and <code>signOut</code>) from your JavaScript application using the Amplify JavaScript client library.</p>

<p><a data-type="indexterm" data-primary="Angular" id="idm45364347675048"/><a data-type="indexterm" data-primary="React Native" id="idm45364347674312"/>Amplify also has preconfigured UI components that allow you to scaffold out entire authentication flows in just a couple of lines of code for frameworks like React, React Native, Vue, and Angular.</p>

<p><a data-type="indexterm" data-primary="React Router" id="idm45364347673048"/>In this chapter, you’ll be using a combination of the Amplify CLI, Amplify JavaScript client, and Amplify React UI components to build an application that demonstrates <em>routing</em>, <em>authentication</em>, and <em>protected routes</em>. You’ll also use React Router for routing and Ant Design to give the application some basic styling <a data-type="indexterm" data-primary="" data-startref="aco_ab" id="idm45364347670408"/><a data-type="indexterm" data-primary="" data-startref="co_ab" id="idm45364347669432"/>(see <a data-type="xref" href="#fig4a">Figure 4-1</a>).</p>

<figure><div id="fig4a" class="figure">
<img src="Images/fssl_0401.png" alt="React with Routing and Authentication" width="940" height="588"/>
<h6><span class="label">Figure 4-1. </span>React with routing and authentication</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Creating the React App and Adding Amplify"><div class="sect1" id="idm45364347665464">
<h1>Creating the React App and Adding Amplify</h1>

<p><a data-type="indexterm" data-primary="adding" data-secondary="Amplify" id="idm45364347663896"/><a data-type="indexterm" data-primary="Amplify" data-secondary="adding" id="idm45364347662920"/><a data-type="indexterm" data-primary="creating" data-secondary="React application" id="idm45364347661976"/><a data-type="indexterm" data-primary="React application" data-secondary="creating" id="idm45364347661032"/>The first thing you’ll do to get started is create the React application, install the necessary dependencies, and create the Amplify project.</p>

<p class="less_space pagebreak-before">To begin, open your terminal and create a new React application:</p>

<pre data-type="programlisting">~ npx create-react-app basic-authentication
~ cd basic-authentication</pre>

<p>Then install the AWS Amplify, AWS Amplify React, React Router, and Ant Design libraries:</p>

<pre data-type="programlisting">~ npm install aws-amplify @aws-amplify/ui-react antd react-router-dom</pre>

<p>Initialize a new Amplify project:</p>

<pre data-type="programlisting">~ amplify init

# Follow the steps to give the project a name, environment name, and set
  the default text editor.
# Accept defaults for everything else and choose your AWS Profile.</pre>

<p>With the Amplify project now initialized, we can create the authentication service. To do so, run the following command:</p>

<pre data-type="programlisting">~ amplify add auth

? Do you want to use the default authentication and security
  configuration? Default configuration
? How do you want users to be able to sign in? Username
? Do you want to configure advanced settings? No, I am done.</pre>

<p><a data-type="indexterm" data-primary="push command" id="idm45364347653944"/>Now the authentication service has been configured and you can deploy it using the <code>amplify push</code> command:</p>

<pre data-type="programlisting">~ amplify push

? Are you sure you want to continue? Yes</pre>

<p>The authentication service has been deployed, so let’s start testing it out.</p>








<section data-type="sect2" data-pdf-bookmark="Client Authentication Overview"><div class="sect2" id="idm45364347651384">
<h2>Client Authentication Overview</h2>

<p><a data-type="indexterm" data-primary="client authentication" id="idm45364347650216"/>Using Amplify, there are two main ways to implement authentication on the client now that the service is up and running:</p>
<dl>
<dt><code>Auth</code> class</dt>
<dd>
<p><a data-type="indexterm" data-primary="Auth class" id="idm45364347647416"/>The Amplify client library exposes an <code>Auth</code> class with over 30 different methods that allow you to handle everything associated with user management. Some examples of the methods available are <code>Auth.signUp</code>, <code>Auth.signIn</code>, and <code>Auth.signOut</code>.</p>

<p>Using this class, you can create a completely custom authentication flow based on your application’s requirements. To do so, you have to manage all of the styling and application state yourself.</p>
</dd>
<dt>Framework-specific authentication components</dt>
<dd>
<p><a data-type="indexterm" data-primary="Angular" id="idm45364347642712"/><a data-type="indexterm" data-primary="abstractions" id="idm45364347642008"/><a data-type="indexterm" data-primary="Framework-specific authentication components" id="idm45364347641336"/>The framework-specific libraries available in Amplify for frameworks like React, React Native, Vue, and Angular expose higher-level abstractions for managing authentication. These components will render an entire (customizable) authentication flow with only a few lines of code.</p>
</dd>
</dl>

<p><a data-type="indexterm" data-primary="HOC (higher order component)" id="idm45364347639640"/>In <a data-type="xref" href="ch01.xhtml#ch1">Chapter 1</a>, you had a chance to try out the higher-order component (HOC) from the AWS Amplify React library called <code>withAuthenticator</code>. Here, you’ll be using this HOC along with routing to create protected routes and a profile view that can only be viewed if the user is signed in.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Building the App"><div class="sect1" id="idm45364347664840">
<h1>Building the App</h1>

<p><a data-type="indexterm" data-primary="applications" data-secondary="creating" id="app_cre"/><a data-type="indexterm" data-primary="creating" data-secondary="applications" id="cre_app"/>The next step will be to go ahead and create the folder and file structure for the app.</p>








<section data-type="sect2" data-pdf-bookmark="Creating the File and Folder Structure"><div class="sect2" id="idm45364347632856">
<h2>Creating the File and Folder Structure</h2>

<p><a data-type="indexterm" data-primary="creating" data-secondary="file/folder structure" id="idm45364347631544"/><a data-type="indexterm" data-primary="files, creating structure of" id="idm45364347630568"/><a data-type="indexterm" data-primary="folders, creating structure of" id="idm45364347629928"/><a data-type="indexterm" data-primary="src directory" id="idm45364347629240"/>In your app, create the following files in the <em>src</em> directory:</p>

<pre data-type="programlisting">Container.js
Nav.js
Profile.js
Protected.js
Public.js
Router.js</pre>

<p><a data-type="indexterm" data-primary="Container.js file" id="idm45364347626968"/><a data-type="indexterm" data-primary="Nav.js file" id="idm45364347626264"/><a data-type="indexterm" data-primary="Profile.js file" id="idm45364347625592"/><a data-type="indexterm" data-primary="Protected.js file" id="idm45364347624920"/><a data-type="indexterm" data-primary="Public.js file" id="idm45364347624248"/><a data-type="indexterm" data-primary="Router.js file" id="idm45364347623576"/>These files do the following:</p>
<dl>
<dt><em>Container.js</em></dt>
<dd>
<p>This file will hold a component you will be using to apply reusable styling to the other components.</p>
</dd>
<dt><em>Nav.js</em></dt>
<dd>
<p>In this component, you will create a navigation UI.</p>
</dd>
<dt><em>Profile.js</em></dt>
<dd>
<p>This component will render profile information about the logged-in user. This will also be the component where we add the authentication component for signing up and signing in.</p>
</dd>
<dt><em>Protected.js</em></dt>
<dd>
<p>This is the component we will be using as an example of how to create a protected route. If the user is signed in, they will be able to view this route. If they are not signed in, they will be redirected to the sign-in form.</p>
</dd>
<dt><em>Public.js</em></dt>
<dd>
<p>This is a basic route that will be viewable whether or not the user is signed in.</p>
</dd>
<dt><em>Router.js</em></dt>
<dd>
<p>This file will hold the router and some logic to determine the current route name.</p>
</dd>
</dl>

<p>Now that these files have been created, you have everything you need to begin writing some code.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Creating the First Component"><div class="sect2" id="idm45364347612360">
<h2>Creating the First Component</h2>

<p><a data-type="indexterm" data-primary="Container component" id="idm45364347611016"/><a data-type="indexterm" data-primary="components, creating" id="idm45364347610312"/><a data-type="indexterm" data-primary="creating" data-secondary="components" id="idm45364347609640"/>To start, let’s create the most simple component we will be using for the app—the <code>Container</code> component. This component is what we will be using to wrap all of our other components so that we can apply some reusable styles between the <span class="keep-together">components:</span></p>

<pre data-type="programlisting">/* src/Container.js */
import React from 'react'

const Container = ({ children }) =&gt; (
  &lt;div style={styles.container}&gt;
    { children }
  &lt;/div&gt;
)

const styles = {
  container: {
    margin: '0 auto',
    padding: '50px 100px'
  }
}

export default Container</pre>

<p>Using this component, you can now apply consistent styling across the entire app without having to rewrite your styles. You can then use it like this:</p>

<pre data-type="programlisting">&lt;Container&gt;
  &lt;h1&gt;Hello World&lt;/h1&gt;
&lt;/Container&gt;</pre>

<p>Anything that is a child of the <code>Container</code> component will be rendered with the styling set in the <code>Container</code> component. Doing this allows you to have a single place that you can control the styles. In case you want to make styling changes later, you only need to adjust one component.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Public Component"><div class="sect2" id="idm45364347603432">
<h2>Public Component</h2>

<p><a data-type="indexterm" data-primary="Public component" id="idm45364347602232"/>This component simply renders the name of the route to the UI and can be accessed whether or not the user is signed in. In this component, you will use the <code>Container</code> component to add some padding and margin:</p>

<pre data-type="programlisting">/* src/Public.js */
import React from 'react'
import Container from './Container'

function Public() {
  return (
    &lt;Container&gt;
      &lt;h1&gt;Public route&lt;/h1&gt;
    &lt;/Container&gt;
  )
}

export default Public</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Nav Component"><div class="sect2" id="idm45364347599512">
<h2>Nav Component</h2>

<p><a data-type="indexterm" data-primary="Nav component" id="idm45364347598312"/><a data-type="indexterm" data-primary="Menu component" id="idm45364347597384"/><a data-type="indexterm" data-primary="Icon component" id="idm45364347596712"/>The <code>Nav</code> (navigation) component will be utilizing the Ant Design library and React Router. Ant Design will provide the <code>Menu</code> and <code>Icon</code> components to make a nice looking menu, and React Router will provide the <code>Link</code> component so that we can link and navigate to different parts of the app.</p>

<p><a data-type="indexterm" data-primary="Router component" id="idm45364347593960"/>You’ll also notice that there is a <code>current</code> prop that is passed in to the component. This prop represents the name of the current route. For this application the value will either be <code>home</code>, <code>profile</code>, or <code>protected</code>. The <code>current</code> value is used in the <code>selectedKeys</code> array of the <code>Menu</code> component to highlight the current route in the navigation bar. This value will be calculated in the <code>Router</code> component and passed into this component as a prop:</p>

<pre data-type="programlisting">/* src/Nav.js */
import React from 'react'
import { Link } from 'react-router-dom'
import { Menu } from 'antd'
import { HomeOutlined, ProfileOutlined, FileProtectOutlined } from
         '@ant-design/icons'

const Nav = (props) =&gt; {
  const { current } = props
  return (
    &lt;div&gt;
      &lt;Menu selectedKeys={[current]} mode="horizontal"&gt;
        &lt;Menu.Item key='home'&gt;
          &lt;Link to={`/`}&gt;
            &lt;HomeOutlined /&gt;Home
          &lt;/Link&gt;
        &lt;/Menu.Item&gt;
        &lt;Menu.Item key='profile'&gt;
          &lt;Link to='/profile'&gt;
          &lt;ProfileOutlined /&gt;Profile
          &lt;/Link&gt;
        &lt;/Menu.Item&gt;
        &lt;Menu.Item key='protected'&gt;
          &lt;Link to='/protected'&gt;
            &lt;FileProtectOutlined /&gt;Protected
          &lt;/Link&gt;
        &lt;/Menu.Item&gt;
      &lt;/Menu&gt;
    &lt;/div&gt;
  )
}

export default Nav</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Protected Component"><div class="sect2" id="idm45364347587336">
<h2>Protected Component</h2>

<p><a data-type="indexterm" data-primary="Protected component" id="idm45364347585960"/>The <code>Protected</code> component will be the protected, or private, route. If the user trying to access this route is signed in, they will be able to view this route. If they are not signed in, they will be redirected to the profile page to sign up or sign in.</p>

<p><a data-type="indexterm" data-primary="useEffect hook" id="idm45364347584168"/><a data-type="indexterm" data-primary="Auth class" id="idm45364347583464"/>In this component, you will be using the <code>useEffect</code> hook from React and the <code>Auth</code> class from AWS Amplify:</p>
<dl>
<dt><code>useEffect</code></dt>
<dd>
<p>This is a React hook that allows you to perform side effects in function components. This hook accepts a function that is called when the function renders for the first time and, optionally, every additional time that it renders. By passing in an empty array as the second argument, we are choosing to only fire the function once: when the component loads. If you have used <code>componentDidMount</code> in a React class, <code>useEffect</code> has similar characteristics and use cases.</p>
</dd>
<dt><code>Auth</code></dt>
<dd>
<p><a data-type="indexterm" data-primary="Auth.currentAuthenticatedUser method" id="idm45364347577352"/>This AWS Amplify class handles user identity management. You can use this class to do everything from signing a user up and signing them in to resetting their password. In this component we will be calling a method, <code>Auth.currentAuthenticatedUser</code>, that will check if the user is currently signed in and, if so, return data about the signed-in user:</p>
</dd>
</dl>

<pre data-type="programlisting">/* src/Protected.js */
import React, { useEffect } from 'react';
import { Auth } from 'aws-amplify'
import Container from './Container'

function Protected(props) {
  useEffect(() =&gt; {
    Auth.currentAuthenticatedUser()
      .catch(() =&gt; {
        props.history.push('/profile')
      })
  }, [])
  return (
    &lt;Container&gt;
      &lt;h1&gt;Protected route&lt;/h1&gt;
    &lt;/Container&gt;
  );
}

export default Protected</pre>

<p>When the component is rendered, we check to see if the user is signed in to the app by calling <code>Auth.currentAuthenticatedUser</code> in the <code>useEffect</code> hook. If this API call is not successful, that means the user is not signed in and we need to redirect them. We redirect them by calling <code>props.history.push('/profile')</code>.</p>

<p>If the user is signed in, then we take no action and allow them to view the route.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Router Component"><div class="sect2" id="idm45364347571960">
<h2>Router Component</h2>

<p><a data-type="indexterm" data-primary="Router component" id="idm45364347570584"/>The <code>Router</code> component will define the components and routes we want to have available in our application.</p>

<p>This component will also be setting the current route name that will be used in the <code>Nav</code> component to highlight the current route based on the <code>window.location.href</code> property.</p>

<p><a data-type="indexterm" data-primary="HashRouter" id="idm45364347567592"/><a data-type="indexterm" data-primary="Switch" id="idm45364347566888"/><a data-type="indexterm" data-primary="Route" id="idm45364347566216"/>The components that you will be using from React Router are <code>HashRouter</code>, <code>Switch</code>, and <code>Route</code>:</p>
<dl>
<dt><code>HashRouter</code></dt>
<dd>
<p>This is a router that uses the hash portion of the URL (i.e., <em>window.location.hash</em>) to keep your UI in sync with the URL.</p>
</dd>
<dt><code>Switch</code></dt>
<dd>
<p><code>Switch</code> renders the first child route that matches the location. This is different than the default functionality of just using the router, which may render multiple routes that match the location.</p>
</dd>
<dt><code>Route</code></dt>
<dd>
<p>This component allows you to define the component that you’d like to render based on a path parameter:</p>
</dd>
</dl>

<pre data-type="programlisting">/* src/Router.js */
import React, { useState, useEffect } from 'react'
import { HashRouter, Switch, Route } from 'react-router-dom'

import Nav from './Nav'
import Public from './Public'
import Profile from './Profile'
import Protected from './Protected'

const Router = () =&gt; {
  const [current, setCurrent] = useState('home')
  useEffect(() =&gt; {
    setRoute()
    window.addEventListener('hashchange', setRoute)
    return () =&gt;  window.removeEventListener('hashchange', setRoute)
  }, [])
  function setRoute() {
    const location = window.location.href.split('/')
    const pathname = location[location.length-1]
    setCurrent(pathname ? pathname : 'home')
  }
  return (
    &lt;HashRouter&gt;
      &lt;Nav current={current} /&gt;
      &lt;Switch&gt;
        &lt;Route exact path="/" component={Public}/&gt;
        &lt;Route exact path="/protected" component={Protected} /&gt;
        &lt;Route exact path="/profile" component={Profile}/&gt;
        &lt;Route component={Public}/&gt;
      &lt;/Switch&gt;
    &lt;/HashRouter&gt;
  )
}

export default Router</pre>

<p><a data-type="indexterm" data-primary="useEffect hook" id="idm45364347555976"/>Inside the <code>useEffect</code> hook in this component, we set the route name by calling <code>setRoute</code>. We also set up an event listener to call <code>setRoute</code> whenever the route changes.</p>

<p><a data-type="indexterm" data-primary="pass in" id="idm45364347553528"/>When declaring a <code>Route</code> component, you can pass in the component you would like to render as the <code>component</code> prop.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Profile Component"><div class="sect2" id="idm45364347551640">
<h2>Profile Component</h2>

<p><a data-type="indexterm" data-primary="Profile component" id="idm45364347550264"/>The last component we need to finish our app is the <code>Profile</code> component. This component will do several things:</p>

<ul>
<li>
<p>Render the authentication form if the user is not signed in.</p>
</li>
<li>
<p>Provide a sign-out button.</p>
</li>
<li>
<p>Render the user’s profile information to the UI.</p>
</li>
</ul>

<p>Just like in <a data-type="xref" href="ch01.xhtml#ch1">Chapter 1</a>, we are using the <code>withAuthenticator</code> HOC to render the authentication flow by wrapping the <code>Profile</code> component in the default export. This will show the sign-up/sign-in form if the user is not signed in, and if the user is signed in will show the UI with the user’s profile details.</p>

<p><a data-type="indexterm" data-primary="users, signing out" id="idm45364347542968"/><a data-type="indexterm" data-primary="sign out" id="idm45364347542264"/>To sign the user out, we use the <code>AmplifySignOut</code> UI component. This component will sign the user out and re-render the UI to show the authentication form.</p>

<p><a data-type="indexterm" data-primary="Auth.currentAuthenticatedUser method" id="idm45364347540616"/><a data-type="indexterm" data-primary="displaying profile data" id="idm45364347539848"/><a data-type="indexterm" data-primary="profile data, displaying" id="idm45364347539176"/>To display the user profile data, we use the <code>Auth.currentAuthenticatedUser</code> method. If the user is signed in, this method will return the user profile data along with information about the session. The information that we are interested in using for the profile are the username and user attributes, which include the phone number, email, and any other information gathered when the user signed up:</p>

<pre data-type="programlisting">/* src/Profile.js */
import React, { useState, useEffect } from 'react'
import { Auth } from 'aws-amplify'
import { withAuthenticator, AmplifySignOut } from '@aws-amplify/ui-react'
import Container from './Container'

function Profile() {
  useEffect(() =&gt; {
    checkUser()
  }, [])
  const [user, setUser] = useState({})
  async function checkUser() {
    try {
      const data = await Auth.currentUserPoolUser()
      const userInfo = { username: data.username, ...data.attributes, }
      setUser(userInfo)
    } catch (err) { console.log('error: ', err) }
  }
  return (
    &lt;Container&gt;
      &lt;h1&gt;Profile&lt;/h1&gt;
      &lt;h2&gt;Username: {user.username}&lt;/h2&gt;
      &lt;h3&gt;Email: {user.email}&lt;/h3&gt;
      &lt;h4&gt;Phone: {user.phone_number}&lt;/h4&gt;
      &lt;AmplifySignOut /&gt;
    &lt;/Container&gt;
  );
}

export default withAuthenticator(Profile)</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Styling the UI Components"><div class="sect2" id="idm45364347535944">
<h2>Styling the UI Components</h2>

<p><a data-type="indexterm" data-primary="CSS" id="idm45364347534776"/><a data-type="indexterm" data-primary="styling UI components" id="idm45364347534072"/><a data-type="indexterm" data-primary="UI components, styling" id="idm45364347533400"/><a data-type="indexterm" data-primary="Web Components" id="idm45364347532728"/>Under the hood, the Amplify UI components are implemented using Web Components. This means we can target them as a first-class HTML element for CSS styling. We want our UI components to match the blue colors in the rest of our app. To do so, we can add the following CSS property to the bottom of <em>index.css</em> to define the colors we’d like to use:</p>

<pre data-type="programlisting">/* src/index.css */

:root {
  --amplify-primary-color: #1890ff;
  --amplify-primary-tint: #1890ff;
  --amplify-primary-shade: #1890ff;
}</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Configuring the App"><div class="sect2" id="idm45364347530056">
<h2>Configuring the App</h2>

<p><a data-type="indexterm" data-primary="applications" data-secondary="configuring" id="idm45364347528824"/><a data-type="indexterm" data-primary="configuring" data-secondary="applications" id="idm45364347527848"/>Now the app is built. The last thing we need to do is update <em>index.js</em> to import the Router and add the Amplify configuration. We also want to import the necessary CSS for the Ant Design library:</p>

<pre data-type="programlisting">/* src/index.js */
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import Router from './Router';
import 'antd/dist/antd.css';

import Amplify from 'aws-amplify'
import config from './aws-exports'
Amplify.configure(config)

ReactDOM.render(&lt;Router /&gt;, document.getElementById('root'));</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Testing the App"><div class="sect2" id="idm45364347524888">
<h2>Testing the App</h2>

<p><a data-type="indexterm" data-primary="start command" id="idm45364347523688"/><a data-type="indexterm" data-primary="testing" data-secondary="applications" id="idm45364347522984"/><a data-type="indexterm" data-primary="applications" data-secondary="testing" id="idm45364347522040"/>To test the app, we can now run the <code>start</code> command:</p>

<pre data-type="programlisting">~ npm start</pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm45364347636520">
<h1>Summary</h1>

<p><a data-type="indexterm" data-primary="" data-startref="app_cre" id="idm45364347518536"/><a data-type="indexterm" data-primary="" data-startref="cre_app" id="idm45364347517560"/><a data-type="indexterm" data-primary="Ant Design" id="idm45364347516616"/><a data-type="indexterm" data-primary="Auth class" id="idm45364347515944"/><a data-type="indexterm" data-primary="withAuthenticator component" id="idm45364347515272"/>Congratulations, you’ve built out an authentication flow with routing and protected routes!</p>

<p>Here are a few things to keep in mind from this chapter:</p>

<ul>
<li>
<p>Use the <code>withAuthenticator</code> HOC to quickly get up and running with a preconfigured authentication flow.</p>
</li>
<li>
<p>Use the <code>Auth</code> class for more fine-grained control over authentication and to get data about the currently signed-in user.</p>
</li>
<li>
<p>Ant Design helps you get started with preconfigured design without having to write any style-specific code.</p>
</li>
</ul>
</div></section>







</div></section></div>



  </body></html>