<html><head></head><body><section data-pdf-bookmark="Chapter 15. Working with Media" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch15">&#13;
<h1><span class="label">Chapter 15. </span>Working with Media</h1>&#13;
&#13;
&#13;
<p>Pretty pictures. Animations. Cool videos. Sound!</p>&#13;
&#13;
<p><a data-primary="media, working with" data-type="indexterm" id="ix_media_ch15"/>The web is a richer place through the availability of many media types. Our old friends SVG and Canvas can be used for complex animations, charts, and graphs. Added to them are the video and audio elements included in HTML5, and the near-future potential of 3D graphics.</p>&#13;
&#13;
<p>Best of all, none of these require any kind of proprietary plug-in—they’re all integrated with all your browser clients, including those on your smartphones, tablets, and computers.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Adding JavaScript to SVG" data-type="sect1"><div class="sect1" id="adding_javascript_to_an_svg_file">&#13;
<h1>Adding JavaScript to SVG</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475136723896">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="SVG (Scalable Vector Graphics)" data-secondary="adding JavaScript to" data-type="indexterm" id="ix_svg_adding_js"/><a data-primary="media, working with" data-secondary="adding JavaScript to SVG" data-type="indexterm" id="ix_media_js_to_svg"/>You want to add JavaScript to an SVG file or element.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475136719816">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="data" data-secondary="CDATA markup" data-type="indexterm" id="ix_data_cdata_markup"/><a data-primary="CDATA (character data) markup" data-type="indexterm" id="ix_cdata_markup"/>JavaScript in SVG is included in <code>script</code> elements, just as with HTML, except with the addition of CDATA markup surrounding the script (<a data-type="xref" href="#demonstration_of_javascript_within_an_sv">Example 15-1</a>). <a data-primary="DOM (Document Object Model)" data-secondary="SVG and" data-type="indexterm" id="idm45475136714952"/>DOM methods are also available for working with the SVG elements.</p>&#13;
<div data-type="example" id="demonstration_of_javascript_within_an_sv">&#13;
<h5><span class="label">Example 15-1. </span>Demonstration of JavaScript within an SVG file</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</code>&#13;
<code class="nt">&lt;svg</code> <code class="na">xmlns=</code><code class="s">"http://www.w3.org/2000/svg"</code>&#13;
<code class="na">xmlns:xlink=</code><code class="s">"http://www.w3.org/1999/xlink"</code> <code class="na">width=</code><code class="s">"600"</code> <code class="na">height=</code><code class="s">"600"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/ecmascript"</code><code class="nt">&gt;</code>&#13;
    <code class="o">&lt;!</code><code class="p">[</code><code class="nx">CDATA</code><code class="p">[</code>&#13;
&#13;
      <code class="c1">// set element onclick event handler</code>&#13;
      <code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kr">const</code> <code class="nx">square</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'square'</code><code class="p">);</code>&#13;
&#13;
        <code class="c1">// onclick event handler, change circle radius</code>&#13;
        <code class="nx">square</code><code class="p">.</code><code class="nx">onclick</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">click</code><code class="p">()</code> <code class="p">{</code>&#13;
          <code class="kr">const</code> <code class="nx">color</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">);</code>&#13;
          <code class="k">if</code> <code class="p">(</code><code class="nx">color</code> <code class="o">===</code> <code class="s1">'#ff0000'</code><code class="p">)</code> <code class="p">{</code>&#13;
            <code class="k">this</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'#0000ff'</code><code class="p">);</code>&#13;
          <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
            <code class="k">this</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'#ff0000'</code><code class="p">);</code>&#13;
          <code class="p">}</code>&#13;
        <code class="p">};</code>&#13;
      <code class="p">};</code>&#13;
    <code class="p">]]</code><code class="o">&gt;</code>&#13;
  <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;rect</code> <code class="na">id=</code><code class="s">"square"</code> <code class="na">width=</code><code class="s">"400"</code> <code class="na">height=</code><code class="s">"400"</code> <code class="na">fill=</code><code class="s">"#ff0000"</code>&#13;
   <code class="na">x=</code><code class="s">"10"</code> <code class="na">y=</code><code class="s">"10"</code> <code class="nt">/&gt;</code>&#13;
<code class="nt">&lt;/svg&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475136367064">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="script elements" data-type="indexterm" id="idm45475136709608"/><a data-primary="elements" data-secondary="script elements" data-type="indexterm" id="idm45475136708824"/>As the solution demonstrates, SVG is XML, and the rules for embedding script into XML must be adhered to. This means providing the script <code>type</code> within the <code>script</code> tag, as well as wrapping the script contents in a CDATA block. If you don’t have the CDATA section, and your script uses characters such as <code>&lt;</code> or <code>&amp;</code>, your page will have errors, because the XML parser treats them as XML characters, not script.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>There is some drive to treat SVG as HTML, especially when the SVG is inline in HTML documents. That’s what Chrome does. Still, it’s better to be safe than sorry, and follow XML requirements.</p>&#13;
</div>&#13;
&#13;
<p><a data-primary="fill attribute" data-type="indexterm" id="idm45475136659512"/>The DOM methods, such as <code>document.getElementById()</code>, aren’t HTML specific; they’re usable with any XML document, including SVG. What’s new is the SVG-specific <code>fill</code> attribute, an attribute unique to SVG elements, such as <code>rect</code>.</p>&#13;
<div data-type="caution"><h6>Caution</h6>&#13;
<p><a data-primary="namespaces" data-type="indexterm" id="idm45475136656456"/>If namespaces were used with any of the elements in the file, then the namespace version of the DOM methods would have to be used.</p>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before less_space"><a data-primary="XHTML, CDATA and" data-type="indexterm" id="idm45475136654808"/>The code in the solution is a standalone SVG file, with a <em>.svg</em> extension. If we were to embed the SVG within an HTML file, as shown in <a data-type="xref" href="#svg_element_from_example_15-1comma_embed">Example 15-2</a>, the color-changing animation would work the same. The CDATA section is removed because all modern browsers understand the SVG is now in an HTML context. If the file is XHTML, though, add them back.</p>&#13;
<div data-type="example" id="svg_element_from_example_15-1comma_embed">&#13;
<h5><span class="label">Example 15-2. </span>SVG element from <a data-type="xref" href="#demonstration_of_javascript_within_an_sv">Example 15-1</a>, embedded into an HTML page</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html&gt;</code>&#13;
<code class="nt">&lt;head&gt;</code>&#13;
<code class="nt">&lt;title&gt;</code>Accessing Inline SVG<code class="nt">&lt;/title&gt;</code>&#13;
<code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code>&#13;
<code class="nt">&lt;/head&gt;</code>&#13;
<code class="nt">&lt;body&gt;</code>&#13;
<code class="nt">&lt;svg</code> <code class="na">width=</code><code class="s">"600"</code> <code class="na">height=</code><code class="s">"600"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;script&gt;</code>&#13;
    <code class="c1">// set element onclick event handler</code>&#13;
    <code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>&#13;
      <code class="kr">const</code> <code class="nx">square</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'square'</code><code class="p">);</code>&#13;
&#13;
      <code class="c1">// onclick event handler, change circle radius</code>&#13;
      <code class="nx">square</code><code class="p">.</code><code class="nx">onclick</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">click</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kr">const</code> <code class="nx">color</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">);</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="nx">color</code> <code class="o">===</code> <code class="s1">'#ff0000'</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'#0000ff'</code><code class="p">);</code>&#13;
        <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
          <code class="k">this</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'#ff0000'</code><code class="p">);</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">};</code>&#13;
    <code class="p">};</code>&#13;
  <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;rect</code> <code class="na">id=</code><code class="s">"square"</code> <code class="na">width=</code><code class="s">"400"</code> <code class="na">height=</code><code class="s">"400"</code> <code class="na">fill=</code><code class="s">"#ff0000"</code>&#13;
 <code class="na">x=</code><code class="s">"10"</code> <code class="na">y=</code><code class="s">"10"</code> <code class="nt">/&gt;</code>&#13;
<code class="nt">&lt;/svg&gt;</code>&#13;
<code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre></div>&#13;
&#13;
<p>The above example embeds the SVG directly into the HTML page. You can also embed a JavaScript-containing SVG file on the page by using the <code>&lt;object&gt;</code> tag with a fallback <code>&lt;img&gt;</code> tag:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="nt">&lt;object</code> <code class="na">type=</code><code class="s">"image/svg+xml"</code> <code class="na">data=</code><code class="s">"demo.svg"</code><code class="nt">&gt;</code>&#13;
    <code class="nt">&lt;img</code> <code class="na">src=</code><code class="s">"demo.svg"</code> <code class="nt">/&gt;</code>&#13;
<code class="nt">&lt;/object&gt;</code></pre>&#13;
&#13;
<p>All modern browsers support SVG, including SVG in HTML. IE supports SVG after version 9.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="Drasner, Sarah" data-secondary="SVG Animations (O’Reilly)" data-type="indexterm" id="idm45475136292328"/><a data-primary="SVG Animations (O’Reilly)" data-type="indexterm" id="idm45475136291416"/>To learn more about SVG, I recommend <a class="orm:hideurl" href="https://www.oreilly.com/library/view/svg-animations/9781491939697/"><em>SVG Animations</em></a> by Sarah Drasner (O’Reilly).</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Extra: Using SVG Libraries" data-type="sect2"><div class="sect2" id="idm45475136366472">&#13;
<h2>Extra: Using SVG Libraries</h2>&#13;
&#13;
<p><a data-primary="Canvas" data-type="indexterm" id="idm45475136283352"/>There aren’t quite as many libraries for working with SVG as there are for working with Canvas, but the ones that exist are very handy. One of the most popular is the D3 library, covered in <a data-type="xref" href="#creating_svg_bar_chart_d3">“Creating an SVG Bar Chart with D3”</a>. A few other popular libraries include <a href="http://raphaeljs.com">Raphaël</a>, <a href="https://greensock.com">GreenSock</a>, <a href="http://snapsvg.io">Snap.svg</a>, and <a href="https://svgjs.dev/docs/3.0">SVG.js</a>. All of these can simplify SVG creation and animation. The following code snippet shows an example of using Raphaël:<a data-primary="" data-startref="ix_media_js_to_svg" data-type="indexterm" id="idm45475136278360"/><a data-primary="" data-startref="ix_svg_adding_js" data-type="indexterm" id="idm45475136277384"/><a data-primary="" data-startref="ix_cdata_markup" data-type="indexterm" id="idm45475136276440"/><a data-primary="" data-startref="ix_data_cdata_markup" data-type="indexterm" id="idm45475136275496"/></p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Creates canvas 320 × 400 at 10, 50</code>&#13;
<code class="kr">const</code> <code class="nx">paper</code> <code class="o">=</code> <code class="nx">Raphael</code><code class="p">(</code><code class="mi">10</code><code class="p">,</code> <code class="mi">50</code><code class="p">,</code> <code class="mi">320</code><code class="p">,</code> <code class="mi">400</code><code class="p">);</code>&#13;
<code class="c1">// Creates circle at x = 150, y = 140, with radius 100</code>&#13;
<code class="kr">const</code> <code class="nx">circle</code> <code class="o">=</code> <code class="nx">paper</code><code class="p">.</code><code class="nx">circle</code><code class="p">(</code><code class="mi">150</code><code class="p">,</code> <code class="mi">140</code><code class="p">,</code> <code class="mi">100</code><code class="p">);</code>&#13;
<code class="c1">// Sets the fill attribute of the circle to red (#f00)</code>&#13;
<code class="nx">circle</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"fill"</code><code class="p">,</code> <code class="s2">"#f0f"</code><code class="p">);</code>&#13;
<code class="c1">// Sets the stroke attribute of the circle to white</code>&#13;
<code class="nx">circle</code><code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s2">"stroke"</code><code class="p">,</code> <code class="s2">"#ff0"</code><code class="p">);</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Accessing SVG from a Web Page Script" data-type="sect1"><div class="sect1" id="accessing_svg_from_web_page_script">&#13;
<h1>Accessing SVG from a Web Page Script</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475136154648">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="media, working with" data-secondary="web page script, accessing SVG from" data-type="indexterm" id="ix_media_web_page_svg"/><a data-primary="SVG (Scalable Vector Graphics)" data-secondary="web page script access" data-type="indexterm" id="ix_svg_web_page_access"/>You want to modify the contents of an SVG element from script within the web page.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475136150728">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>If the SVG is embedded directly in the web page, access the element and its attributes using the same functionality you would use with any other web page element:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">square</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"square"</code><code class="p">);</code>&#13;
<code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s2">"width"</code><code class="p">,</code> <code class="s2">"500"</code><code class="p">);</code></pre>&#13;
&#13;
<p>However, if the SVG is in an external SVG file embedded into the page via an <code>object</code> element, you have to get the document for the external SVG file in order to access the elements. The technique requires object detection because the process differs by browser:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code> <code class="nx">onLoad</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">object</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'object'</code><code class="p">);</code>&#13;
  <code class="kd">let</code> <code class="nx">svgdoc</code><code class="p">;</code>&#13;
&#13;
  <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="nx">svgdoc</code> <code class="o">=</code> <code class="nx">object</code><code class="p">.</code><code class="nx">contentDocument</code><code class="p">;</code>&#13;
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
      <code class="nx">svgdoc</code> <code class="o">=</code> <code class="nx">object</code><code class="p">.</code><code class="nx">getSVGDocument</code><code class="p">();</code>&#13;
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>&#13;
      <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="s1">'SVG in object not supported in this environment'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">svgdoc</code><code class="p">)</code> <code class="k">return</code><code class="p">;</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">square</code> <code class="o">=</code> <code class="nx">svgdoc</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'square'</code><code class="p">);</code>&#13;
  <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="s1">'900'</code><code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475136068808">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The first option listed in the solution accesses SVG embedded in an HTML file. You can access SVG elements using the same methods you’ve used to access HTML elements.</p>&#13;
&#13;
<p><a data-primary="getSVGDocument() method" data-type="indexterm" id="idm45475135962696"/>The second option is a little more involved, and depends on retrieving the document object for the SVG document. The first approach tries to access the <code>contentDocument</code> property on the object. If this fails, the application then tries to access the SVG document using <code>getSVGDocument()</code>. Once you have access to the SVG document object, you can use the same DOM methods you would use with elements native to the web page.</p>&#13;
&#13;
<p><a data-type="xref" href="#accessing_svg_in_an_object_element_from">Example 15-3</a> shows the second way to add SVG to a web page, and how to access the SVG element(s) from script in HTML.</p>&#13;
<div data-type="example" id="accessing_svg_in_an_object_element_from">&#13;
<h5><span class="label">Example 15-3. </span>Accessing SVG in an object element from script</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;head&gt;</code>&#13;
  <code class="nt">&lt;title&gt;</code>SVG in Object<code class="nt">&lt;/title&gt;</code>&#13;
  <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code> <code class="nt">/&gt;</code>&#13;
<code class="nt">&lt;/head&gt;</code>&#13;
<code class="nt">&lt;body&gt;</code>&#13;
  <code class="nt">&lt;object</code> <code class="na">id=</code><code class="s">"object"</code> <code class="na">type=</code><code class="s">"image/svg+xml"</code> <code class="na">data=</code><code class="s">"../demo1.svg"</code><code class="nt">&gt;</code>&#13;
    <code class="nt">&lt;p&gt;</code>No SVG support<code class="nt">&lt;/p&gt;</code>&#13;
  <code class="nt">&lt;/object&gt;</code>&#13;
  <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>&#13;
    <code class="kr">const</code> <code class="nx">object</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'object'</code><code class="p">);</code>&#13;
    <code class="nx">object</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>&#13;
      <code class="kd">let</code> <code class="nx">svgdoc</code><code class="p">;</code>&#13;
&#13;
      <code class="c1">// get access to the SVG document object</code>&#13;
      <code class="k">try</code> <code class="p">{</code>&#13;
        <code class="nx">svgdoc</code> <code class="o">=</code> <code class="nx">object</code><code class="p">.</code><code class="nx">contentDocument</code><code class="p">;</code>&#13;
      <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">e</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="k">try</code> <code class="p">{</code>&#13;
          <code class="nx">svgdoc</code> <code class="o">=</code> <code class="nx">object</code><code class="p">.</code><code class="nx">getSVGDocument</code><code class="p">();</code>&#13;
        <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">err</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">err</code><code class="p">,</code> <code class="s1">'SVG in object not supported in this environment'</code><code class="p">);</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">}</code>&#13;
&#13;
      <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">svgdoc</code><code class="p">)</code> <code class="k">return</code><code class="p">;</code>&#13;
&#13;
      <code class="c1">// get SVG element and modify</code>&#13;
      <code class="kr">const</code> <code class="nx">square</code> <code class="o">=</code> <code class="nx">svgdoc</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'square'</code><code class="p">);</code>&#13;
      <code class="nx">square</code><code class="p">.</code><code class="nx">onclick</code> <code class="o">=</code> <code class="kd">function</code><code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kd">let</code> <code class="nx">width</code> <code class="o">=</code> <code class="nb">parseFloat</code><code class="p">(</code><code class="nx">square</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'width'</code><code class="p">));</code>&#13;
        <code class="nx">width</code> <code class="o">-=</code> <code class="mi">50</code><code class="p">;</code>&#13;
        <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="nx">width</code><code class="p">);</code>&#13;
        <code class="kr">const</code> <code class="nx">color</code> <code class="o">=</code> <code class="nx">square</code><code class="p">.</code><code class="nx">getAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">);</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="nx">color</code> <code class="o">==</code> <code class="s1">'blue'</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'yellow'</code><code class="p">);</code>&#13;
          <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'stroke'</code><code class="p">,</code> <code class="s1">'green'</code><code class="p">);</code>&#13;
        <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
          <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'blue'</code><code class="p">);</code>&#13;
          <code class="nx">square</code><code class="p">.</code><code class="nx">setAttribute</code><code class="p">(</code><code class="s1">'stroke'</code><code class="p">,</code> <code class="s1">'red'</code><code class="p">);</code>&#13;
        <code class="p">}</code>&#13;
      <code class="p">};</code>&#13;
    <code class="p">};</code>&#13;
  <code class="nt">&lt;/script&gt;</code>&#13;
<code class="nt">&lt;/body&gt;</code></pre></div>&#13;
&#13;
<p>In the example code, the object is accessed after it has loaded; the <code>object.onload</code> event handler is then accessed to get the SVG document and assign the function to the <code>onclick</code> event handler.<a data-primary="" data-startref="ix_svg_web_page_access" data-type="indexterm" id="idm45475135954824"/><a data-primary="" data-startref="ix_media_web_page_svg" data-type="indexterm" id="idm45475135953880"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating an SVG Bar Chart with D3" data-type="sect1"><div class="sect1" id="creating_svg_bar_chart_d3">&#13;
<h1>Creating an SVG Bar Chart with D3</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475135750824">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="libraries" data-secondary="D3" data-type="indexterm" id="ix_lib_d3"/><a data-primary="SVG (Scalable Vector Graphics)" data-secondary="D3 tool to create SVG bar chart" data-type="indexterm" id="ix_svg_bar_chart"/><a data-primary="D3 library" data-type="indexterm" id="ix_d3_library"/><a data-primary="media, working with" data-secondary="D3 tool to create SVG bar chart" data-type="indexterm" id="ix_media_bar_chart"/>You want to create a scalable bar chart, but you’re hoping to avoid having to create every last bit of the graphics.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475135744536">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use D3 and SVG to create a chart bound to a set of data that your application provides. <a data-type="xref" href="#bar_chart_svg_d3">Example 15-4</a> shows a vertical bar chart created using D3 with a given set of data representing the height of each bar.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="bar_chart_svg_d3">&#13;
<h5><span class="label">Example 15-4. </span>SVG bar chart created using D3</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>SVG Bar Chart using D3<code class="nt">&lt;/title&gt;</code>&#13;
    <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"</code><code class="nt">&gt;&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>&#13;
      <code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">[</code><code class="mi">56</code><code class="p">,</code> <code class="mi">99</code><code class="p">,</code> <code class="mi">14</code><code class="p">,</code> <code class="mi">12</code><code class="p">,</code> <code class="mi">46</code><code class="p">,</code> <code class="mi">33</code><code class="p">,</code> <code class="mi">22</code><code class="p">,</code> <code class="mi">100</code><code class="p">,</code> <code class="mi">87</code><code class="p">,</code> <code class="mi">6</code><code class="p">,</code> <code class="mi">55</code><code class="p">,</code> <code class="mi">44</code><code class="p">,</code> <code class="mi">27</code><code class="p">,</code> <code class="mi">28</code><code class="p">,</code> <code class="mi">34</code><code class="p">];</code>&#13;
&#13;
      <code class="kr">const</code> <code class="nx">height</code> <code class="o">=</code> <code class="mi">400</code><code class="p">;</code>&#13;
      <code class="kr">const</code> <code class="nx">barWidth</code> <code class="o">=</code> <code class="mi">25</code><code class="p">;</code>&#13;
&#13;
      <code class="kr">const</code> <code class="nx">x</code> <code class="o">=</code> <code class="nx">d3</code>&#13;
        <code class="p">.</code><code class="nx">scaleLinear</code><code class="p">()</code>&#13;
        <code class="p">.</code><code class="nx">domain</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="nx">d3</code><code class="p">.</code><code class="nx">max</code><code class="p">(</code><code class="nx">data</code><code class="p">)])</code>&#13;
        <code class="p">.</code><code class="nx">range</code><code class="p">([</code><code class="mi">0</code><code class="p">,</code> <code class="nx">height</code><code class="p">]);</code>&#13;
&#13;
      <code class="kr">const</code> <code class="nx">svg</code> <code class="o">=</code> <code class="nx">d3</code>&#13;
        <code class="p">.</code><code class="nx">select</code><code class="p">(</code><code class="s1">'body'</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'svg'</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">length</code> <code class="o">*</code> <code class="p">(</code><code class="nx">barWidth</code> <code class="o">+</code> <code class="mi">1</code><code class="p">))</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'height'</code><code class="p">,</code> <code class="nx">height</code><code class="p">);</code>&#13;
&#13;
      <code class="nx">svg</code>&#13;
        <code class="p">.</code><code class="nx">selectAll</code><code class="p">(</code><code class="s1">'rect'</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">data</code><code class="p">(</code><code class="nx">data</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">enter</code><code class="p">()</code>&#13;
        <code class="p">.</code><code class="nx">append</code><code class="p">(</code><code class="s1">'rect'</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'fill'</code><code class="p">,</code> <code class="s1">'#008b8b'</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'x'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">,</code> <code class="nx">i</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="k">return</code> <code class="nx">i</code> <code class="o">*</code> <code class="p">(</code><code class="nx">barWidth</code> <code class="o">+</code> <code class="mi">1</code><code class="p">);</code>&#13;
        <code class="p">})</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'y'</code><code class="p">,</code> <code class="kd">function</code><code class="p">(</code><code class="nx">d</code><code class="p">)</code> <code class="p">{</code>&#13;
          <code class="k">return</code> <code class="nx">height</code> <code class="o">-</code> <code class="nx">x</code><code class="p">(</code><code class="nx">d</code><code class="p">);</code>&#13;
        <code class="p">})</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'width'</code><code class="p">,</code> <code class="nx">barWidth</code><code class="p">)</code>&#13;
        <code class="p">.</code><code class="nx">attr</code><code class="p">(</code><code class="s1">'height'</code><code class="p">,</code> <code class="nx">x</code><code class="p">);</code>&#13;
    <code class="nt">&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475135738056">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>D3 isn’t a standard graphics tool that creates the shape based on the dimensions you provide. With D3, you give it a set of data, the objects used to visualize the data, and then stand back and let it do its thing. It sounds simple, but to get this data <span class="keep-together">visualization</span> goodness, you do have to properly set it up, and that can be challenging when you first start using the library.</p>&#13;
&#13;
<p><a data-primary="chaining, method" data-type="indexterm" id="idm45475135456216"/><a data-primary="method chaining" data-type="indexterm" id="idm45475135455512"/>First of all, be aware that D3 makes use of <em>method chaining</em> to a maximum degree. Yes, you can invoke methods separately, but it’s clearer, cleaner, and more efficient to use the library’s chaining support.</p>&#13;
&#13;
<p>In the solution, the first line is the creation of a data set as an array. D3 expects data points to be in an array, though each element can be an object, as well as a simple value, as shown in the solution. Next, the maximum height of the bar chart is defined, as is the width of each bar. Next, we get into the first use of D3.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a href="http://d3js.org">D3</a>, created by Mike Bostock, is a powerful data visualization tool that isn’t necessarily something you can pick up and master in a lazy afternoon. <a data-primary="Bostock, Mike" data-type="indexterm" id="idm45475135451672"/>However, it is a tool well worth learning, so consider the example in this recipe more of a teaser to get you interested, rather than a definitive introduction.</p>&#13;
&#13;
<p><a data-primary="D3 for the Impatient (O’Reilly)" data-type="indexterm" id="idm45475135450408"/><a data-primary="Janert, Philipp" data-secondary="D3 for the Impatient (O’Reilly)" data-type="indexterm" id="idm45475135449736"/>For a more in-depth primer, I recommend <a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920224341.do"><em>D3 for the Impatient</em></a> by Philipp Janert (O’Reilly).</p>&#13;
</div>&#13;
&#13;
<p>I could have added a static SVG element to the web page, but I wanted to demonstrate how D3 creates an element. By creating the SVG element, we’re also getting a reference to it for future work, though we could have used D3 to get a reference to an existing element. In the code, a reference to the <code>body</code> element is obtained using D3’s <code>select()</code> method. Once this happens, a new SVG element is appended to the <code>body</code> element via <code>append()</code>, and attributes are given to it via the <code>attr()</code> function. The height of the element is already predefined, but the width is equal to multiplying the number of data elements by the bar width (+1, to provide necessary spacing).</p>&#13;
&#13;
<p><a data-primary="scale functionality, D3" data-type="indexterm" id="idm45475135443928"/>Once the SVG element is created, the code uses D3’s <em>scale</em> functionality to determine the necessary ratio between the element’s height and each bar’s height, in such a way that the bar chart fills the SVG element, but each bar’s height is proportional. It does this by using <code>scale.linear()</code> to create a linear scale. According to the D3 documentation, “The mapping is linear in that the output range value <em>y</em> can be expressed as a linear function of the input domain value <em>x</em>: <em>y</em> = <em>mx</em> + <em>b</em>.”</p>&#13;
&#13;
<p>The <code>domain()</code> function sets the input domain for the scale, while the <code>range()</code> sets the output range. In the solution, the value given for the domain is zero to the maximum value in the data set, determined via a call to <code>max()</code>. The value given for the range is zero to the height of the SVG element. A function is then returned to a variable that will normalize any data passed to it when called. If the function is given a value equal to the height of the largest data value, the returned value is equal to the height of the element (in this case,  the largest data value of 100 returns a scaled value of 400).</p>&#13;
&#13;
<p>The last portion of the code is the part that creates the bars. We need something to work with, so the code calls <code>selectAll()</code> with <code>rect</code>. There aren’t any <code>rect</code> elements in the SVG block yet, but we’ll be adding them. The data is passed to D3 via the <code>data()</code> method, and then the <code>enter()</code> function is called. What <code>enter()</code> does is process the data and return placeholders for all the missing elements. In the solution, placeholders for all 15 <code>rect</code> elements, one for each bar, are created.</p>&#13;
&#13;
<p><a data-primary="rect element" data-type="indexterm" id="idm45475135433048"/>A <code>rect</code> element is then appended to the SVG element with <code>append()</code>, and the attributes for each are set with <code>attr()</code>. In the solution, the <code>fill</code> and <code>stroke</code> are given, though these could have been defined in the page’s stylesheet. Following, the position for the <code>x</code> attribute, or the lower-left attribute for the bar, is provided as a function, where <code>d</code> is the current datum (data value) and <code>i</code> is the current index. For the <code>x</code> attribute, the index is multiplied by the <code>barWidth</code>, plus one (1), to account for <span class="keep-together">spacing</span>.</p>&#13;
&#13;
<p>For the <code>y</code> attribute, we have to get a little tricky. SVG’s point of origin is the top-left corner, which means increasing values of <code>y</code> go down the chart, not up. To reverse this, we need to subtract the value of <code>y</code> from the height. However, we can’t just do this directly. If the code used the datum passed to it directly, then we’d have a proportional chart with very small, scrunched-down bars. Instead we need to use the newly created scale function, <code>x</code>, passing the datum to it.</p>&#13;
&#13;
<p>The width of each bar is a constant value given in <code>barWidth</code>, and the height is just the scale function variable, which is equivalent to calling the scale function and passing in the datum. All of this creates the chart shown in <a data-type="xref" href="#example_with_normalization">Figure 15-1</a>.<a data-primary="" data-startref="ix_media_bar_chart" data-type="indexterm" id="idm45475135422360"/><a data-primary="" data-startref="ix_svg_bar_chart" data-type="indexterm" id="idm45475135421384"/><a data-primary="" data-startref="ix_d3_library" data-type="indexterm" id="idm45475135420440"/><a data-primary="" data-startref="ix_lib_d3" data-type="indexterm" id="idm45475135419496"/></p>&#13;
&#13;
<figure class="no-frame"><div class="figure" id="example_with_normalization">&#13;
<img alt="jsc3 1501" src="assets/jsc3_1501.png"/>&#13;
<h6><span class="label">Figure 15-1. </span>Example of a bar chart with each bar’s height normalized to fill the given space</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Integrating SVG and the Canvas Element in HTML" data-type="sect1"><div class="sect1" id="integrating_svg_and_the_canvas_element_i">&#13;
<h1>Integrating SVG and the Canvas Element in HTML</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475135414808">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="elements" data-secondary="media" data-type="indexterm" id="ix_elem_media"/><a data-primary="elements" data-secondary="canvas element" data-type="indexterm" id="ix_elem_canvas"/><a data-primary="HTML5" data-secondary="canvas element integration with SVG" data-type="indexterm" id="ix_html_canvas_svg"/><a data-primary="canvas element" data-type="indexterm" id="ix_canvas_elem"/><a data-primary="SVG (Scalable Vector Graphics)" data-secondary="canvas element integration in HTML" data-type="indexterm" id="ix_svg_canvas"/><a data-primary="media, working with" data-secondary="canvas element integration" data-type="indexterm" id="ix_media_canvas"/>You want to use the <code>canvas</code> element and SVG together within a web page.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475135405720">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>One option is to embed both the SVG and the <code>canvas</code> element directly into the HTML page, and then access the <code>canvas</code> element from script within SVG:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Integrating SVG and the Canvas Element in HTML<code class="nt">&lt;/title&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;canvas</code> <code class="na">id=</code><code class="s">"myCanvas"</code> <code class="na">width=</code><code class="s">"400px"</code> <code class="na">height=</code><code class="s">"100px"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;p&gt;</code>canvas item alternative content<code class="nt">&lt;/p&gt;</code>&#13;
    <code class="nt">&lt;/canvas&gt;</code>&#13;
&#13;
    <code class="nt">&lt;svg</code> <code class="na">id=</code><code class="s">"svgelem"</code> <code class="na">height=</code><code class="s">"400"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;title&gt;</code>SVG Circle<code class="nt">&lt;/title&gt;</code>&#13;
      <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>&#13;
      <code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
        <code class="kd">var</code> <code class="nx">context</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"myCanvas"</code><code class="p">).</code><code class="nx">getContext</code><code class="p">(</code><code class="s1">'2d'</code><code class="p">);</code>&#13;
        <code class="nx">context</code><code class="p">.</code><code class="nx">fillStyle</code> <code class="o">=</code> <code class="s1">'rgba(0,200,0,0.7)'</code><code class="p">;</code>&#13;
        <code class="nx">context</code><code class="p">.</code><code class="nx">fillRect</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">100</code><code class="p">,</code><code class="mi">100</code><code class="p">);</code>&#13;
      <code class="p">}</code>&#13;
      <code class="nt">&lt;/script&gt;</code>&#13;
      <code class="nt">&lt;circle</code> <code class="na">id=</code><code class="s">"redcircle"</code> <code class="na">cx=</code><code class="s">"100"</code> <code class="na">cy=</code><code class="s">"100"</code> <code class="na">r=</code><code class="s">"100"</code> <code class="na">fill=</code><code class="s">"red"</code> <code class="na">stroke=</code><code class="s">"#000"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;/svg&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
&#13;
<p>Or you can embed the <code>canvas</code> element as a foreign object directly in the SVG:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html&gt;</code>&#13;
<code class="nt">&lt;head&gt;</code>&#13;
<code class="nt">&lt;title&gt;</code>Accessing Inline SVG<code class="nt">&lt;/title&gt;</code>&#13;
<code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"utf-8"</code><code class="nt">&gt;</code>&#13;
<code class="nt">&lt;/head&gt;</code>&#13;
<code class="nt">&lt;body&gt;</code>&#13;
<code class="nt">&lt;svg</code> <code class="na">id=</code><code class="s">"svgelem"</code> <code class="na">height=</code><code class="s">"400"</code> <code class="na">width=</code><code class="s">"600"</code><code class="nt">&gt;</code>&#13;
   <code class="nt">&lt;script </code><code class="na">type=</code><code class="s">"text/javascript"</code><code class="nt">&gt;</code>&#13;
      <code class="nb">window</code><code class="p">.</code><code class="nx">onload</code> <code class="o">=</code> <code class="kd">function</code> <code class="p">()</code> <code class="p">{</code>&#13;
         <code class="kd">var</code> <code class="nx">context2</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s2">"thisCanvas"</code><code class="p">).</code><code class="nx">getContext</code><code class="p">(</code><code class="s1">'2d'</code><code class="p">);</code>&#13;
&#13;
         <code class="nx">context2</code><code class="p">.</code><code class="nx">fillStyle</code> <code class="o">=</code> <code class="s2">"#ff0000"</code><code class="p">;</code>&#13;
         <code class="nx">context2</code><code class="p">.</code><code class="nx">fillRect</code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">0</code><code class="p">,</code><code class="mi">200</code><code class="p">,</code><code class="mi">200</code><code class="p">);</code>&#13;
       <code class="p">};</code>&#13;
   <code class="nt">&lt;/script&gt;</code>&#13;
&#13;
   <code class="nt">&lt;foreignObject</code> <code class="na">width=</code><code class="s">"300"</code> <code class="na">height=</code><code class="s">"150"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;canvas</code> <code class="na">width=</code><code class="s">"300"</code> <code class="na">height=</code><code class="s">"150"</code> <code class="na">id=</code><code class="s">"thisCanvas"</code><code class="nt">&gt;</code>&#13;
         alternate content for browsers that do not support Canvas&#13;
      <code class="nt">&lt;/canvas&gt;</code>&#13;
   <code class="nt">&lt;/foreignObject&gt;</code>&#13;
   <code class="nt">&lt;circle</code> <code class="na">id=</code><code class="s">"redcircle"</code> <code class="na">cx=</code><code class="s">"300"</code> <code class="na">cy=</code><code class="s">"100"</code> <code class="na">r=</code><code class="s">"100"</code> <code class="na">fill=</code><code class="s">"red"</code> <code class="na">stroke=</code><code class="s">"#000"</code> <code class="nt">/&gt;</code>&#13;
  <code class="nt">&lt;/svg&gt;</code>&#13;
<code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475135171992">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="foreignObject element" data-type="indexterm" id="idm45475135170984"/>When the SVG element is embedded into the current web page, you can access HTML elements from within the SVG. However, you can also embed elements directly in SVG, using the SVG <code>foreignObject</code> element. This element allows us to embed XHTML, MathML, RDF, or any other XML-based syntax.</p>&#13;
&#13;
<p>In both solutions, I was able to use <code>getElementById()</code>. However, if I want to manipulate the elements using other methods, such as <code>getElementsByTagName()</code>, I have to be careful about which version of the method I use. <a data-primary="getElementsByTagNameNS() method" data-type="indexterm" id="idm45475135032152"/>For instance, I can use <code>getElementsByTagName()</code> for the outer <code>canvas</code> element, but I would need to use the namespace version of the method, <code>getElementsByTagNameNS</code>, if the contained object is XML, such as RDF/XML. Because the embedded object in the solution is HTML5, a namespace wasn’t necessary.</p>&#13;
&#13;
<p>Once you have the canvas context, use the element like you would from script within HTML: add rectangles, draw paths, create arcs, and so on.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Extra: Canvas? Or SVG?" data-type="sect2"><div class="sect2" id="idm45475135029240">&#13;
<h2>Extra: Canvas? Or SVG?</h2>&#13;
&#13;
<p><a data-primary="Canvas" data-type="indexterm" id="idm45475135028040"/>Why would you use Canvas over SVG, or SVG over Canvas? The <code>canvas</code> element is faster in frame-type animations. With each animation, the browser only needs to redraw the changed pixels, not recreate the entire scene. However, the advantage you get with the <code>canvas</code> element animation lessens when you have to support a variety of screen sizes, from smartphone to large monitor. SVG scales beautifully.</p>&#13;
&#13;
<p>Another advantage to SVG is that it figures in rich data visualizations with the assistance of powerful libraries. But then, Canvas is used with 3D systems, such as WebGL.</p>&#13;
&#13;
<p>One use of SVG and Canvas together is to provide a fallback for the canvas element: the SVG writes to the DOM and persists even if JavaScript is turned off, while the <code>canvas</code> element does not.<a data-primary="" data-startref="ix_media_canvas" data-type="indexterm" id="idm45475135024424"/><a data-primary="" data-startref="ix_canvas_elem" data-type="indexterm" id="idm45475135023416"/><a data-primary="" data-startref="ix_svg_canvas" data-type="indexterm" id="idm45475135022472"/><a data-primary="" data-startref="ix_elem_canvas" data-type="indexterm" id="idm45475135021528"/><a data-primary="" data-startref="ix_html_canvas_svg" data-type="indexterm" id="idm45475135020584"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Running a Routine When an Audio File Begins Playing" data-type="sect1"><div class="sect1" id="audio-routine">&#13;
<h1>Running a Routine When an Audio File Begins Playing</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475135017896">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="media, working with" data-secondary="audio file playing" data-type="indexterm" id="ix_media_audio_elem"/><a data-primary="audio element" data-type="indexterm" id="ix_audio_elem"/><a data-primary="HTML5" data-secondary="audio element" data-type="indexterm" id="ix_html_audio_elem"/>You want to provide an audio file and then share additional information when the audio file begins or ends playing.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475135012776">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="ended event" data-type="indexterm" id="idm45475135011368"/><a data-primary="events" data-secondary="ended" data-type="indexterm" id="idm45475135010664"/><a data-primary="events" data-secondary="play" data-type="indexterm" id="idm45475135009720"/><a data-primary="play event" data-type="indexterm" id="idm45475135008776"/>Use the HTML5 <code>audio</code> element:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="nt">&lt;audio</code> <code class="na">id=</code><code class="s">"meadow"</code> <code class="na">controls</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;source</code> <code class="na">src=</code><code class="s">"meadow.wav"</code> <code class="na">type=</code><code class="s">"audio/wav"</code> <code class="nt">/&gt;</code>&#13;
  <code class="nt">&lt;p&gt;&lt;a</code> <code class="na">href=</code><code class="s">"meadow.wav"</code><code class="nt">&gt;</code>Meadow sounds<code class="nt">&lt;/a&gt;&lt;/p&gt;</code>&#13;
<code class="nt">&lt;/audio&gt;</code></pre>&#13;
&#13;
<p>and capture either its <code>play</code> event (playback has begun) or <code>ended</code> event (playback has finished):</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">meadow</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'meadow'</code><code class="p">);</code>&#13;
<code class="nx">meadow</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'play'</code><code class="p">,</code> <code class="nx">aboutAudio</code><code class="p">);</code></pre>&#13;
&#13;
<p>then display the information:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">aboutAudio</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">info</code> <code class="o">=</code> <code class="s1">'A summer field near a lake in July.'</code><code class="p">;</code>&#13;
  <code class="kr">const</code> <code class="nx">txt</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createTextNode</code><code class="p">(</code><code class="nx">info</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">div</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="s1">'div'</code><code class="p">);</code>&#13;
  <code class="nx">div</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">txt</code><code class="p">);</code>&#13;
  <code class="nb">document</code><code class="p">.</code><code class="nx">body</code><code class="p">.</code><code class="nx">appendChild</code><code class="p">(</code><code class="nx">div</code><code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475134868744">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="HTML5" data-secondary="video element" data-type="indexterm" id="idm45475134850600"/><a data-primary="images (img element)" data-secondary="video" data-type="indexterm" id="idm45475134849624"/><a data-primary="media, working with" data-secondary="video control" data-type="indexterm" id="idm45475134848680"/><a data-primary="video element" data-type="indexterm" id="idm45475134847736"/>HTML5 added two media elements: <code>audio</code> and <code>video</code>. These simple-to-use controls provide a way to play audio and video files.</p>&#13;
&#13;
<p><a data-primary="controls attribute, audio element" data-type="indexterm" id="idm45475134845816"/>In the solution, the <code>audio</code> element’s <code>controls</code> Boolean attribute is set, so the controls are displayed. The element has a <code>src</code> of a WAV audio file for in-browser playback. Additionally, a link to the WAV file is provided as a fallback, which means people using browsers that don’t support <code>audio</code> can still access the sound file. I could have also provided an <code>object</code> element, or other fallback content.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><a data-primary="files" data-secondary="WAV format" data-type="indexterm" id="idm45475134841752"/><a data-primary="WAV file format" data-type="indexterm" id="idm45475134840776"/>WAV is a widely supported audio format, but different browsers support various formats and filetypes. The Mozilla Developer Network has a comprehensive <a href="http://mzl.la/1DS3rPL">table</a> with audio and video codec support for the various browsers, and Wikipedia maintains a <a href="https://oreil.ly/55EwV">simple browser support table</a> for audio coding formats.</p>&#13;
</div>&#13;
&#13;
<p><a data-primary="aboutAudio() event handler" data-type="indexterm" id="idm45475134837960"/><a data-primary="event handlers" data-secondary="aboutAudio()" data-type="indexterm" id="idm45475134837096"/>The media elements come with a set of methods to control the playback, as well as events that can be triggered when the event occurs. In the solution, the <code>ended</code> event is captured and assigned the event handler <code>aboutAudio()</code>, which displays a message about the file after the playback is finished. Notice that though the code is using a DOM Level 0 event handler with the window load event, it’s using DOM Level 2 event handling with the <code>audio</code> element. Browser support is erratic with this event handler, so I strongly recommend you use <code>addEventListener()</code>. However, <code>onended</code> does seem to work without problems when used directly in the element:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="nt">&lt;audio</code> <code class="na">id=</code><code class="s">"meadow"</code> <code class="na">src=</code><code class="s">"meadow.wav"</code> <code class="na">controls</code> <code class="na">onended=</code><code class="s">"alert('All done')"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;p&gt;&lt;a</code> <code class="na">href=</code><code class="s">"meadow.wav"</code><code class="nt">&gt;</code>Meadow sounds<code class="nt">&lt;/a&gt;&lt;/p&gt;</code>&#13;
<code class="nt">&lt;/audio&gt;</code></pre>&#13;
&#13;
<p>It’s interesting to see the appearance of the elements in all of the browsers that currently support them. There is no standard look, so each browser provides its own interpretation. You can control the appearance by providing your own playback controls and using your own elements/CSS/SVG/Canvas to supply the decoration.<a data-primary="" data-startref="ix_html_audio_elem" data-type="indexterm" id="idm45475134824936"/><a data-primary="" data-startref="ix_audio_elem" data-type="indexterm" id="idm45475134824088"/><a data-primary="" data-startref="ix_media_audio_elem" data-type="indexterm" id="idm45475134823176"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Controlling Video from JavaScript with the video Element" data-type="sect1"><div class="sect1" id="controlling_video_from_javascript">&#13;
<h1>Controlling Video from JavaScript with the video Element</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45475134780968">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="images (img element)" data-secondary="video" data-type="indexterm" id="ix_img_video"/><a data-primary="video element" data-type="indexterm" id="ix_video_elem"/><a data-primary="media, working with" data-secondary="video control" data-type="indexterm" id="ix_media_video_elem"/><a data-primary="HTML5" data-secondary="video element" data-type="indexterm" id="ix_html5_video_elem"/>You want to embed video in your web page along with a consistent look for the video controls, regardless of browser and operating system.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45475134774600">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the HTML5 <code>video</code> element:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="nt">&lt;video</code> <code class="na">id=</code><code class="s">"meadow"</code> <code class="na">poster=</code><code class="s">"purples.jpg"</code> <code class="nt">&gt;</code>&#13;
   <code class="nt">&lt;source</code> <code class="na">src=</code><code class="s">"meadow.m4v"</code> <code class="na">type=</code><code class="s">"video/mp4"</code><code class="nt">/&gt;</code>&#13;
   <code class="nt">&lt;source</code> <code class="na">src=</code><code class="s">"meadow.ogv"</code> <code class="na">type=</code><code class="s">"video/ogg"</code> <code class="nt">/&gt;</code>&#13;
<code class="nt">&lt;/video&gt;</code></pre>&#13;
&#13;
<p>You can provide controls for it via JavaScript, as shown in <a data-type="xref" href="#providing_a_custom_control_for_the_html5">Example 15-5</a>. Buttons are used to provide the video control, and text in a <code>div</code> element is used to provide feedback on time during the playback.</p>&#13;
<div data-type="example" id="providing_a_custom_control_for_the_html5">&#13;
<h5><span class="label">Example 15-5. </span>Providing a custom control for the HTML5 video element</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="cp">&lt;!DOCTYPE html&gt;</code>&#13;
<code class="nt">&lt;html</code> <code class="na">lang=</code><code class="s">"en"</code><code class="nt">&gt;</code>&#13;
  <code class="nt">&lt;head&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">charset=</code><code class="s">"UTF-8"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">name=</code><code class="s">"viewport"</code> <code class="na">content=</code><code class="s">"width=device-width, initial-scale=1.0"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;meta</code> <code class="na">http-equiv=</code><code class="s">"X-UA-Compatible"</code> <code class="na">content=</code><code class="s">"ie=edge"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;title&gt;</code>Controlling Video from JavaScript with the video Element<code class="nt">&lt;/title&gt;</code>&#13;
    <code class="nt">&lt;style&gt;</code>&#13;
      <code class="nt">video</code> <code class="p">{</code>&#13;
        <code class="k">border</code><code class="o">:</code> <code class="m">1px</code> <code class="nb">solid</code> <code class="nb">black</code><code class="p">;</code>&#13;
        <code class="k">max-width</code><code class="o">:</code> <code class="m">600px</code><code class="p">;</code>&#13;
      <code class="p">}</code>&#13;
    <code class="nt">&lt;/style&gt;</code>&#13;
  <code class="nt">&lt;/head&gt;</code>&#13;
  <code class="nt">&lt;body&gt;</code>&#13;
    <code class="nt">&lt;h1&gt;</code>Controlling Video from JavaScript with the video Element<code class="nt">&lt;/h1&gt;</code>&#13;
&#13;
    <code class="nt">&lt;video</code> <code class="na">id=</code><code class="s">"meadow"</code> <code class="na">controls</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;source</code> <code class="na">src=</code><code class="s">"meadow.mp4"</code> <code class="na">type=</code><code class="s">"video/mp4"</code> <code class="nt">/&gt;</code>&#13;
      <code class="nt">&lt;source</code> <code class="na">src=</code><code class="s">"meadow.webm"</code> <code class="na">type=</code><code class="s">"video/webm"</code> <code class="nt">/&gt;</code>&#13;
    <code class="nt">&lt;/video&gt;</code>&#13;
    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"feedback"</code><code class="nt">&gt;&lt;/div&gt;</code>&#13;
    <code class="nt">&lt;div</code> <code class="na">id=</code><code class="s">"controls"</code><code class="nt">&gt;</code>&#13;
      <code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"start"</code><code class="nt">&gt;</code>Play<code class="nt">&lt;/button&gt;</code>&#13;
      <code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"stop"</code><code class="nt">&gt;</code>Stop<code class="nt">&lt;/button&gt;</code>&#13;
      <code class="nt">&lt;button</code> <code class="na">id=</code><code class="s">"pause"</code><code class="nt">&gt;</code>Pause<code class="nt">&lt;/button&gt;</code>&#13;
    <code class="nt">&lt;/div&gt;</code>&#13;
&#13;
    <code class="nt">&lt;script </code><code class="na">src=</code><code class="s">"video.js"</code><code class="nt">&gt;&lt;/script&gt;</code>&#13;
  <code class="nt">&lt;/body&gt;</code>&#13;
<code class="nt">&lt;/html&gt;</code></pre>&#13;
&#13;
<p>And in <code>video.js</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// dom elements</code>&#13;
<code class="kr">const</code> <code class="nx">meadow</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'meadow'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">start</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'start'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">pause</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'pause'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">stop</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'stop'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// start video, enable stop and pause</code>&#13;
<code class="c1">// disable play</code>&#13;
<code class="kd">function</code> <code class="nx">startPlayback</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">meadow</code><code class="p">.</code><code class="nx">play</code><code class="p">();</code>&#13;
  <code class="nx">pause</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
  <code class="nx">stop</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
  <code class="k">this</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// pause video, enable start, disable stop</code>&#13;
<code class="c1">// disable pause</code>&#13;
<code class="kd">function</code> <code class="nx">pausePlayback</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">meadow</code><code class="p">.</code><code class="nx">pause</code><code class="p">();</code>&#13;
  <code class="nx">pause</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
  <code class="nx">start</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
  <code class="nx">stop</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// stop video, return to zero time</code>&#13;
<code class="c1">// enable play, disable pause and stop</code>&#13;
<code class="kd">function</code> <code class="nx">stopPlayback</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">meadow</code><code class="p">.</code><code class="nx">pause</code><code class="p">();</code>&#13;
  <code class="nx">meadow</code><code class="p">.</code><code class="nx">currentTime</code> <code class="o">=</code> <code class="mi">0</code><code class="p">;</code>&#13;
  <code class="nx">start</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
  <code class="nx">pause</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
  <code class="k">this</code><code class="p">.</code><code class="nx">disabled</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// for every time divisible by 5, output feedback</code>&#13;
<code class="kd">function</code> <code class="nx">reportProgress</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">time</code> <code class="o">=</code> <code class="nb">Math</code><code class="p">.</code><code class="nx">round</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">currentTime</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">div</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'feedback'</code><code class="p">);</code>&#13;
  <code class="nx">div</code><code class="p">.</code><code class="nx">innerHTML</code> <code class="o">=</code> <code class="sb">`</code><code class="si">${</code><code class="nx">time</code><code class="si">}</code><code class="sb"> seconds`</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="c1">// event listeners</code>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'start'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">startPlayback</code><code class="p">);</code>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'stop'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">stopPlayback</code><code class="p">);</code>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">getElementById</code><code class="p">(</code><code class="s1">'pause'</code><code class="p">).</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'click'</code><code class="p">,</code> <code class="nx">pausePlayback</code><code class="p">);</code>&#13;
<code class="nx">meadow</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'timeupdate'</code><code class="p">,</code> <code class="nx">reportProgress</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45475134579640">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The  HTML5 <code>video</code> element, as with the HTML5 <code>audio</code> element, can be controlled with its own built-in controls, or you can provide your own. The media elements support the following methods:</p>&#13;
<dl>&#13;
<dt><code>play</code></dt>&#13;
<dd>&#13;
<p>Starts playing the video</p>&#13;
</dd>&#13;
<dt><code>pause</code></dt>&#13;
<dd>&#13;
<p>Pauses the video</p>&#13;
</dd>&#13;
<dt><code>load</code></dt>&#13;
<dd>&#13;
<p>Preloads the video without starting play</p>&#13;
</dd>&#13;
<dt><code>canPlayType</code></dt>&#13;
<dd>&#13;
<p>Tests if the user agent supports the video type</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-primary="currentTime attribute" data-type="indexterm" id="idm45475134407432"/>The media elements don’t support a stop method, so the code emulates one by pausing video play and then setting the video’s <code>currentTime</code> attribute to 0, which basically resets the play start time. I also used <code>currentTime</code> to print out the video time, using <code>Math.round</code> to round the time to the nearest second.</p>&#13;
&#13;
<p>The video control is providing two different video codecs: H.264 (<em>.mp4</em>) and VP8 (<em>.webm</em>). Nearly all modern browsers support the WebM file format, but including the MP4 provides a fallback for older browsers that support the <code>video</code> element.</p>&#13;
&#13;
<p><a data-primary="accessibility" data-secondary="video controls" data-type="indexterm" id="idm45475134403000"/>The video and audio controls are inherently keyboard accessible. If you replace the controls, you’ll want to provide accessibility information with your replacements.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The video playback functionality demonstrated in the solution works, as is, with video that isn’t encrypted. If the video (or audio) file is encrypted, considerably more effort is necessary so that the video plays, making use of the HTML 5.1 W3C Encrypted Media Extensions (EME).<a data-primary="" data-startref="ix_media_ch15" data-type="indexterm" id="idm45475134400424"/><a data-primary="" data-startref="ix_html5_video_elem" data-type="indexterm" id="idm45475134399448"/><a data-primary="" data-startref="ix_video_elem" data-type="indexterm" id="idm45475134398504"/><a data-primary="" data-startref="ix_media_video_elem" data-type="indexterm" id="idm45475134397560"/><a data-primary="" data-startref="ix_elem_media" data-type="indexterm" id="idm45475134396616"/><a data-primary="" data-startref="ix_img_video" data-type="indexterm" id="idm45475134395672"/></p>&#13;
&#13;
<p><a data-primary="EME (Encrypted Media Extensions)" data-type="indexterm" id="idm45475134394472"/><a data-primary="encrypted files" data-type="indexterm" id="idm45475134393752"/><a data-primary="files" data-secondary="encrypted" data-type="indexterm" id="idm45475134393080"/><a data-primary="security issues" data-secondary="encrypted media and playback functionality" data-type="indexterm" id="idm45475134392136"/>The <a href="https://oreil.ly/mMu7q">W3C EME working draft</a> has been implemented in <a href="http://bit.ly/1DS5umQ">Internet Explorer 11</a>, Chrome, Firefox, Microsoft Edge, and Safari.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>