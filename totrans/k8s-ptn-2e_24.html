<html><head></head><body><section data-pdf-bookmark="Chapter 19. EnvVar Configuration" data-type="chapter" epub:type="chapter"><div class="chapter" id="EnvVarConfiguration">&#13;
<h1><span class="label">Chapter 19. </span>EnvVar Configuration</h1>&#13;
&#13;
&#13;
<p>In<a data-primary="EnvVar Configuration" data-type="indexterm" id="envcnfg19"/> this <em>EnvVar Configuration</em> pattern, we look into the simplest way to configure applications. For small sets of configuration values, the easiest way to<a data-primary="configuration information" data-secondary="externalizing configuration" data-type="indexterm" id="idm45902090862256"/> externalize configuration is by putting them into universally supported environment variables.&#13;
We’ll see different ways of declaring environment variables in Kubernetes but also the limitations of using environment variables for complex configurations.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect1"><div class="sect1" id="idm45902090861088">&#13;
<h1>Problem</h1>&#13;
&#13;
<p>Every<a data-primary="problems" data-secondary="configuration, externalizing" data-type="indexterm" id="idm45902090859792"/> nontrivial application needs some configuration for accessing data sources, external services, or production-level tuning. And we knew well before the <a href="https://12factor.net">twelve-factor app manifesto</a> that it is a bad thing to hardcode configurations within the application. Instead, the configuration should be <em>externalized</em> so that we can change it even after the application has been built. That provides even more value for containerized applications that enable and promote sharing of immutable application artifacts. But how can this be done best in a containerized world?</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect1"><div class="sect1" id="idm45902090857216">&#13;
<h1>Solution</h1>&#13;
&#13;
<p>The<a data-primary="twelve-factor app" data-type="indexterm" id="idm45902090855616"/> twelve-factor app manifesto recommends using<a data-primary="environment variables" data-secondary="storing application configuration in" data-type="indexterm" id="idm45902090854816"/> environment variables for storing application configurations. This approach is simple and works for any environment and platform. Every operating system knows how to define environment variables and how to propagate them to applications, and every programming language also allows easy access to these environment variables. It is fair to claim that environment variables are universally applicable. When using environment variables, a typical usage pattern is to define hardcoded default values during build time, which we can then overwrite at runtime. Let’s see some concrete examples of how this works in Docker and Kubernetes.</p>&#13;
&#13;
<p>For Docker images, environment variables can be defined directly in Dockerfiles with the <code>ENV</code> directive. You can define them line by line or all in a single line, as shown in <a data-type="xref" href="#ex-config-envvar">Example 19-1</a>.</p>&#13;
<div data-type="example" id="ex-config-envvar">&#13;
<h5><span class="label">Example 19-1. </span>Example Dockerfile with environment variables</h5>&#13;
&#13;
<pre data-type="programlisting">FROM openjdk:11&#13;
ENV PATTERN "EnvVar Configuration"&#13;
ENV LOG_FILE "/tmp/random.log"&#13;
ENV SEED "1349093094"&#13;
&#13;
# Alternatively:&#13;
ENV PATTERN="EnvVar Configuration" LOG_FILE=/tmp/random.log SEED=1349093094&#13;
...</pre></div>&#13;
&#13;
<p>Then a Java application running in such a container can easily access the variables with a call to the Java standard library, as shown in <a data-type="xref" href="#ex-config-envvar-java">Example 19-2</a>.</p>&#13;
<div data-type="example" id="ex-config-envvar-java">&#13;
<h5><span class="label">Example 19-2. </span>Reading environment variables in Java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="n">Random</code><code class="w"> </code><code class="nf">initRandom</code><code class="p">(</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
</code><code class="w">  </code><code class="kt">long</code><code class="w"> </code><code class="n">seed</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Long</code><code class="p">.</code><code class="na">parseLong</code><code class="p">(</code><code class="n">System</code><code class="p">.</code><code class="na">getenv</code><code class="p">(</code><code class="s">"</code><code class="s">SEED</code><code class="s">"</code><code class="p">)</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="w">  </code><code class="k">return</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">Random</code><code class="p">(</code><code class="n">seed</code><code class="p">)</code><code class="p">;</code><code class="w">      </code><a class="co" href="#callout_envvar_configuration_CO1-1" id="co_envvar_configuration_CO1-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="p">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_envvar_configuration_CO1-1" id="callout_envvar_configuration_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Initializes a random-number generator with a seed from an EnvVar.</p></dd>&#13;
</dl></div>&#13;
&#13;
<p>Directly running such an image will use the default hardcoded values. But in most cases, you want to override these parameters from outside the image.</p>&#13;
&#13;
<p>When running such an image directly with Docker, environment variables can be set from the command line by calling Docker, as in <a data-type="xref" href="#ex-config-envvar-docker">Example 19-3</a>.</p>&#13;
<div data-type="example" id="ex-config-envvar-docker">&#13;
<h5><span class="label">Example 19-3. </span>Set environment variables when starting a Docker container</h5>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="l-Scalar-Plain">docker run -e PATTERN="EnvVarConfiguration" \</code><code class="w"/>&#13;
<code class="w">           </code><code class="l-Scalar-Plain">-e LOG_FILE="/tmp/random.log" \</code><code class="w"/>&#13;
<code class="w">           </code><code class="l-Scalar-Plain">-e SEED="147110834325" \</code><code class="w"/>&#13;
<code class="w">           </code><code class="l-Scalar-Plain">k8spatterns/random-generator:1.0</code><code class="w"/></pre></div>&#13;
&#13;
<p class="pagebreak-before">For<a data-primary="ReplicaSet" data-secondary="environment variables" data-type="indexterm" id="idm45902090739136"/> Kubernetes, these types of environment variables can be set directly in the Pod specification of a controller like Deployment or ReplicaSet (as shown in &#13;
<span class="keep-together"><a data-type="xref" href="#ex-config-envvar-replicaset">Example 19-4</a>).</span></p>&#13;
<div data-type="example" id="ex-config-envvar-replicaset">&#13;
<h5><span class="label">Example 19-4. </span>Deployment with environment variables set</h5>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">v1</code><code class="w">&#13;
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">Pod</code><code class="w">&#13;
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="nt">spec</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">containers</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">k8spatterns/random-generator:1.0</code><code class="w">&#13;
</code><code class="w">    </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="w">    </code><code class="nt">env</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">LOG_FILE</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">value</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">/tmp/random.log</code><code class="w">             </code><a class="co" href="#callout_envvar_configuration_CO2-1" id="co_envvar_configuration_CO2-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">PATTERN</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">valueFrom</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">        </code><code class="nt">configMapKeyRef</code><code class="p">:</code><code class="w">                 </code><a class="co" href="#callout_envvar_configuration_CO2-2" id="co_envvar_configuration_CO2-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
</code><code class="w">          </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator-config</code><code class="w">  </code><a class="co" href="#callout_envvar_configuration_CO2-3" id="co_envvar_configuration_CO2-3"><img alt="3" src="assets/3.png"/></a><code class="w">&#13;
</code><code class="w">          </code><code class="nt">key</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">pattern</code><code class="w">                   </code><a class="co" href="#callout_envvar_configuration_CO2-4" id="co_envvar_configuration_CO2-4"><img alt="4" src="assets/4.png"/></a><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">SEED</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">valueFrom</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">        </code><code class="nt">secretKeyRef</code><code class="p">:</code><code class="w">                    </code><a class="co" href="#callout_envvar_configuration_CO2-5" id="co_envvar_configuration_CO2-5"><img alt="5" src="assets/5.png"/></a><code class="w">&#13;
</code><code class="w">          </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator-secret</code><code class="w">&#13;
</code><code class="w">          </code><code class="nt">key</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">seed</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_envvar_configuration_CO2-1" id="callout_envvar_configuration_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>EnvVar with a literal value.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO2-2" id="callout_envvar_configuration_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>EnvVar from a ConfigMap.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO2-3" id="callout_envvar_configuration_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>ConfigMap’s name.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO2-4" id="callout_envvar_configuration_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Key within the ConfigMap to look for the EnvVar value.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO2-5" id="callout_envvar_configuration_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>EnvVar from a Secret (lookup semantic is the same as for a ConfigMap).</p></dd>&#13;
</dl></div>&#13;
&#13;
<p>In such a Pod template, you not only can attach values directly to environment variables (as for <code>LOG_FILE</code>), but also can use a delegation to Kubernetes Secrets and ConfigMaps. The advantage of ConfigMap and Secret indirection is that the environment variables can be managed independently from the Pod definition. Secret and ConfigMap and their pros and cons are explained in detail in<a data-primary="Configuration Resource" data-secondary="EnvVar Configuration" data-type="indexterm" id="idm45902090529248"/><a data-primary="Configuration Resource" data-type="indexterm" id="idm45902090528272"/> <a data-type="xref" data-xrefstyle="chap-num-title" href="ch20.html#ConfigurationResource">Chapter 20, “Configuration Resource”</a>.</p>&#13;
&#13;
<p class="pagebreak-before">In the preceding example, the <code>SEED</code> variable comes from a Secret resource. While that is a perfectly valid use of Secret, it is also important to point out that environment variables are not secure. Putting sensitive, readable information into environment variables makes this information easy to read, and it may even leak into logs.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45902090524976">&#13;
<h1>About Default Values</h1>&#13;
<p>Default values<a data-primary="default values" data-type="indexterm" id="idm45902090523472"/><a data-primary="configuration information" data-secondary="default values" data-type="indexterm" id="idm45902090522736"/> make life easier, as they take away the burden of selecting a value for a configuration parameter you might not even know exists. They also play a significant role in the<a data-primary="convention over configuration paradigm" data-type="indexterm" id="idm45902090521600"/> <em>convention over configuration</em> paradigm. However, defaults are not always a good idea. Sometimes they might even be an antipattern for an evolving application.</p>&#13;
&#13;
<p>This is because <em>changing</em> default values retrospectively is a difficult task.&#13;
First, changing default values means replacing them within the code, which requires a rebuild. Second, people relying on defaults (either by convention or consciously) will always be surprised when a default value changes. We have to communicate the change, and the user of such an application probably has to modify the calling code as well.</p>&#13;
&#13;
<p>Changes in default values, however, often make sense, because it is hard to get default values right from the very beginning. It’s essential that we consider a change in a default value as a <em>major change</em>, and if semantic versioning is in use, such a modification justifies a bump in the major version number. If unsatisfied with a given default value, it is often better to remove the default altogether and throw an error if the user does not provide a configuration value. This will at least break the application early and prominently instead of it doing something different and unexpected silently.</p>&#13;
&#13;
<p>Considering all these issues, it is often the best solution to <em>avoid default values</em> from the very beginning if you cannot be 90% sure that a reasonable default will last for a long time. Passwords or database connection parameters are good candidates for not providing default values, as they depend highly on the environment and often cannot be reliably predicted. Also, if we do not use default values, the configuration information has to be provided explicitly, which serves as documentation too.</p>&#13;
</div></aside>&#13;
&#13;
<p>Instead of individually referring to configuration values from Secrets or ConfigMaps, you can also import <em>all</em> values of a particular Secret or ConfigMap with <code>envFrom</code>.&#13;
We explain this field in <a data-type="xref" data-xrefstyle="chap-num-title" href="ch20.html#ConfigurationResource">Chapter 20, “Configuration Resource”</a>, when we talk about ConfigMaps and Secrets in detail.</p>&#13;
&#13;
<p class="pagebreak-before">Two other valuable features that can be used with environment variables are the downward API and <em>dependent variables</em>.&#13;
You learned all about the downward API in <a data-type="xref" data-xrefstyle="chap-num-title" href="ch14.html#SelfAwareness">Chapter 14, “Self Awareness”</a>, so let’s have a look at dependent variables in <a data-type="xref" href="#ex-config-envvar-dependent">Example 19-5</a> that allow you to reference previously defined variables in the value definition of other entries.</p>&#13;
<div data-type="example" id="ex-config-envvar-dependent">&#13;
<h5><span class="label">Example 19-5. </span>Dependent environment variables</h5>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">v1</code><code class="w">&#13;
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">Pod</code><code class="w">&#13;
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="nt">spec</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">containers</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">k8spatterns/random-generator:1.0</code><code class="w">&#13;
</code><code class="w">    </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="w">    </code><code class="nt">env</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">PORT</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">value</code><code class="p">:</code><code class="w"> </code><code class="s">"</code><code class="s">8181</code><code class="s">"</code><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">IP</code><code class="w">                        </code><a class="co" href="#callout_envvar_configuration_CO3-1" id="co_envvar_configuration_CO3-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="w">      </code><code class="nt">valueFrom</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">        </code><code class="nt">fieldRef</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">          </code><code class="nt">fieldPath</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">status.podIP</code><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">MY_URL</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">value</code><code class="p">:</code><code class="w"> </code><code class="s">"</code><code class="s">https://$(IP):$(PORT)</code><code class="s">"</code><code class="w">  </code><a class="co" href="#callout_envvar_configuration_CO3-2" id="co_envvar_configuration_CO3-2"><img alt="2" src="assets/2.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_envvar_configuration_CO3-1" id="callout_envvar_configuration_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Use the downward API to pick up the Pod’s IP. The downward API is discussed in detail in <a data-type="xref" data-xrefstyle="chap-num-title" href="ch14.html#SelfAwareness">Chapter 14, “Self Awareness”</a>.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO3-2" id="callout_envvar_configuration_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Include the previously defined environment variables <code>IP</code> and <code>PORT</code> to build up a URL.</p></dd>&#13;
</dl></div>&#13;
&#13;
<p>With a <code>$(...)</code> notation, you can reference environment variables defined earlier in the <code>env</code> list or coming from an <code>envFrom</code> import.&#13;
Kubernetes will resolve those references during the startup of the container.&#13;
Be careful about the ordering, though: if you reference a variable defined later in the list, it will not be resolved, and the <code>$(...)</code> reference will be taken over literally.&#13;
In addition, you can also reference environment variables with this syntax for Pod commands, as shown in <a data-type="xref" href="#ex-config-envvar-command-subst">Example 19-6</a>.</p>&#13;
<div class="less_space pagebreak-before" data-type="example" id="ex-config-envvar-command-subst">&#13;
<h5><span class="label">Example 19-6. </span>Using environment variables in a container’s command definition</h5>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nt">apiVersion</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">v1</code><code class="w">&#13;
</code><code class="nt">kind</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">Pod</code><code class="w">&#13;
</code><code class="nt">metadata</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="nt">spec</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">  </code><code class="nt">containers</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">    </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-generator</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">image</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">k8spatterns/random-generator:1.0</code><code class="w">&#13;
</code><code class="w">      </code><code class="nt">command</code><code class="p">:</code><code class="w"> </code><code class="p-Indicator">[</code><code class="w"> </code><code class="s">"</code><code class="s">java</code><code class="s">"</code><code class="p-Indicator">,</code><code class="w"> </code><code class="s">"</code><code class="s">RandomRunner</code><code class="s">"</code><code class="p-Indicator">,</code><code class="w"> </code><code class="s">"</code><code class="s">$(OUTPUT_FILE)</code><code class="s">"</code><code class="p-Indicator">,</code><code class="w"> </code><code class="s">"</code><code class="s">$(COUNT)</code><code class="s">"</code><code class="w"> </code><code class="p-Indicator">]</code><code class="w"> </code><a class="co" href="#callout_envvar_configuration_CO4-1" id="co_envvar_configuration_CO4-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="w">      </code><code class="nt">env</code><code class="p">:</code><code class="w">                       </code><a class="co" href="#callout_envvar_configuration_CO4-2" id="co_envvar_configuration_CO4-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
</code><code class="w">        </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">OUTPUT_FILE</code><code class="w">&#13;
</code><code class="w">          </code><code class="nt">value</code><code class="p">:</code><code class="w"> </code><code class="s">"</code><code class="s">/numbers.txt</code><code class="s">"</code><code class="w">&#13;
</code><code class="w">        </code><code class="p-Indicator">-</code><code class="w"> </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">COUNT</code><code class="w">&#13;
</code><code class="w">          </code><code class="nt">valueFrom</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">            </code><code class="nt">configMapKeyRef</code><code class="p">:</code><code class="w">&#13;
</code><code class="w">              </code><code class="nt">name</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">random-config</code><code class="w">&#13;
</code><code class="w">              </code><code class="nt">key</code><code class="p">:</code><code class="w"> </code><code class="l-Scalar-Plain">RANDOM_COUNT</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_envvar_configuration_CO4-1" id="callout_envvar_configuration_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Reference environment variables for the startup command of a container.</p></dd>&#13;
<dt><a class="co" href="#co_envvar_configuration_CO4-2" id="callout_envvar_configuration_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Definition of the environment variables substituted in the commands.</p></dd>&#13;
</dl></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect1"><div class="sect1" id="idm45902090856592">&#13;
<h1>Discussion</h1>&#13;
&#13;
<p>Environment variables are easy to use, and everybody knows about them. This concept maps smoothly to containers, and every runtime platform supports environment variables.&#13;
But environment variables are not secure, and are good only for a decent number of configuration values. And when there are a lot of different parameters to configure, the management of all these environment variables becomes unwieldy.</p>&#13;
&#13;
<p>In these cases, many people use an extra level of indirection and put configuration into various configuration files, one for each environment. Then a single environment variable is used to select one of these files. <em>Profiles</em> from<a data-primary="Spring Boot" data-type="indexterm" id="idm45902090263424"/> Spring Boot are an example of this approach. Since these profile configuration files are typically stored within the application itself, which is within the container, it couples the configuration tightly with the application. This often leads to configuration for development and production ending up side by side in the same Docker image, which requires an image rebuild for every change in either environment. We do not recommend this setup (configuration should always be external to the application), but this solution indicates that environment variables are suitable for small to medium sets of configurations only.</p>&#13;
&#13;
<p>The<a data-primary="Configuration Resource" data-type="indexterm" id="idm45902090261952"/><a data-primary="Configuration Resource" data-secondary="EnvVar Configuration" data-type="indexterm" id="idm45902090261216"/><a data-primary="Immutable Configuration" data-secondary="EnvVar Configuration" data-type="indexterm" id="idm45902090260272"/><a data-primary="Immutable Configuration" data-type="indexterm" id="idm45902090206560"/><a data-primary="Configuration Template" data-type="indexterm" id="idm45902090205952"/><a data-primary="Configuration Template" data-secondary="EnvVar Configuration" data-type="indexterm" id="idm45902090205344"/> patterns <em>Configuration Resource</em>, <em>Immutable Configuration</em>, and <em>Configuration Template</em> described in the following chapters are good alternatives when more complex configuration needs come up.</p>&#13;
&#13;
<p>Environment variables are universally applicable, and because of that, we can set them at various levels. This option leads to fragmentation of the configuration definitions and makes it hard to track for a given environment variable where it is set.&#13;
When there is no central place where all environments variables are defined, it is hard to debug configuration issues.</p>&#13;
&#13;
<p>Another disadvantage of environment variables is that they can be set only <em>before</em> an application starts, and we cannot change them later. On the one hand, it’s a drawback that you can’t change configuration “hot” during runtime to tune the application. However, many see this as an advantage, as it promotes<a data-primary="immutability" data-type="indexterm" id="idm45902090201712"/> <em>immutability</em> even to the configuration. Immutability here means you throw away the running application container and start a new copy with a modified configuration, very likely with a smooth Deployment strategy like rolling updates. That way, you are always in a defined and well-known configuration state.</p>&#13;
&#13;
<p>Environment variables are simple to use, but are applicable mainly for simple use cases and have limitations for complex configuration requirements. The next patterns show how to overcome those limitations.<a data-primary="" data-startref="envcnfg19" data-type="indexterm" id="idm45902090199744"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="More Information" data-type="sect1"><div class="sect1" id="idm45902090198640">&#13;
<h1>More Information</h1>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://oreil.ly/W25g0">EnvVar Configuration Example</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/DzBTm">The Twelve-Factor App</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/KxFtr">Expose Pod Information to Containers Through Environment Variables</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/YoUVj">Define Dependent Environment Variables</a></p>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://oreil.ly/3XVe9">Spring Boot Profiles for Using Sets of Configuration Values</a></p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
</div></section></body></html>