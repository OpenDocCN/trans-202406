<html><head></head><body><section data-pdf-bookmark="Chapter 4. Network Requests" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_network">&#13;
<h1><span class="label">Chapter 4. </span>Network Requests</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id47">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="network requests" data-type="indexterm" id="ix_04-network-requests-asciidoc0"/>You’d <a data-primary="network requests" data-secondary="basics" data-type="indexterm" id="id800"/>have a tough time finding a web application today that doesn’t send any network requests. Since the dawn of Web 2.0 and the novel approach known as Ajax (Asynchronous JavaScript and XML), web apps have been sending asynchronous requests to get new data without reloading the entire page. <a data-primary="XMLHttpRequest" data-secondary="introduction of" data-type="indexterm" id="id801"/>The XMLHttpRequest API started a new era of interactive JavaScript apps. Despite the name, XMLHttpRequest (or XHR, as it is sometimes known) can also work with JSON and form data payloads.</p>&#13;
&#13;
<p>XMLHttpRequest was a game changer, but the API can be painful to work with. Eventually, third-party libraries such as Axios and jQuery added more streamlined APIs that wrapped the core XHR API.</p>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="introduction of" data-type="indexterm" id="id802"/>In 2015, a newer <code>Promise</code>-based API called Fetch became a new standard, and browsers gradually started adding support for it. Today, Fetch is the standard way to make asynchronous requests from your web apps.</p>&#13;
&#13;
<p>This chapter explores XHR and Fetch as well as some other APIs for network &#13;
<span class="keep-together">communication:</span></p>&#13;
<dl>&#13;
<dt>Beacons</dt>&#13;
<dd>&#13;
<p>A simple one-way POST request ideal for sending analytics data</p>&#13;
</dd>&#13;
<dt>Server-sent events</dt>&#13;
<dd>&#13;
<p>A one-way persistent connection with a server to receive real-time events</p>&#13;
</dd>&#13;
<dt>WebSockets</dt>&#13;
<dd>&#13;
<p>A two-way persistent connection for bidirectional communication</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sending a Request with XMLHttpRequest" data-type="sect1"><div class="sect1" id="id426">&#13;
<h1>Sending a Request with XMLHttpRequest</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id269">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="GET request" data-secondary="sending with XMLHttpRequest" data-type="indexterm" id="ix_04-network-requests-asciidoc1"/><a data-primary="network requests" data-secondary="sending with XMLHttpRequest" data-type="indexterm" id="ix_04-network-requests-asciidoc2"/><a data-primary="XMLHttpRequest" data-secondary="sending GET request with" data-type="indexterm" id="ix_04-network-requests-asciidoc3"/>You want to send a GET request to a public API, and you want to support older browsers that don’t implement the Fetch API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id427">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the XMLHttpRequest API. XMLHttpRequest is an asynchronous, event-based API for making network requests. The general usage of XMLHttpRequest is this:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Create a new <code>XMLHttpRequest</code> object.</p>&#13;
</li>&#13;
<li>&#13;
<p>Add a listener for the <code>load</code> event, which receives the response data.</p>&#13;
</li>&#13;
<li>&#13;
<p>Call <code>open</code> on the request, passing the HTTP method and URL.</p>&#13;
</li>&#13;
<li>&#13;
<p>Finally, call <code>send</code> on the request. This triggers the HTTP request to be sent.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p><a data-type="xref" href="#code_xhr">Example 4-1</a> shows a simple example of how to work with JSON data using an XHR.</p>&#13;
<div data-type="example" id="code_xhr">&#13;
<h5><span class="label">Example 4-1. </span>Making a GET request with XMLHttpRequest</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Loads user data from the URL /api/users, then prints them</code>&#13;
<code class="cm"> * to the console</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">getUsers</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">request</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">XMLHttpRequest</code><code class="p">();</code>&#13;
&#13;
  <code class="nx">request</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'load'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// The event target is the XHR itself; it contains a</code>&#13;
    <code class="c1">// responseText property that we can use to create a JavaScript object from</code>&#13;
    <code class="c1">// the JSON text.</code>&#13;
    <code class="kr">const</code> <code class="nx">users</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">responseText</code><code class="p">);</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Got users:'</code><code class="p">,</code> <code class="nx">users</code><code class="p">);</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="c1">// Handle any potential errors with the request.</code>&#13;
  <code class="c1">// This only handles network errors. If the request</code>&#13;
  <code class="c1">// returns an error status like 404, the 'load' event still fires</code>&#13;
  <code class="c1">// where you can inspect the status code.</code>&#13;
  <code class="nx">request</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'error'</code><code class="p">,</code> <code class="nx">err</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Error!'</code><code class="p">,</code> <code class="nx">err</code><code class="p">);</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="nx">request</code><code class="p">.</code><code class="nx">open</code><code class="p">(</code><code class="s1">'GET'</code><code class="p">,</code> <code class="s1">'/api/users'</code><code class="p">);</code>&#13;
  <code class="nx">request</code><code class="p">.</code><code class="nx">send</code><code class="p">();</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id48">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The XMLHttpRequest API is an event-based API. When the response is received, a <code>load</code> event is triggered. In <a data-type="xref" href="#code_xhr">Example 4-1</a>, the&#13;
<code>load</code> event handler passes the raw response text to <code>JSON.parse</code>. It expects the response body to be JSON and uses <code>JSON.parse</code> to&#13;
turn the JSON string into an object.</p>&#13;
&#13;
<p>If an error occurs while loading the data, the <code>error</code> event is triggered. This handles connection or network errors, but an HTTP status code that’s considered an “error,” like 404 or 500, does <em>not</em> trigger this event. Instead, it also triggers the <code>load</code> event.</p>&#13;
&#13;
<p>To protect against such errors, you need to examine the response’s <code>status</code> property to determine if such an error situation exists. This can be accessed by referencing <code>event.target.status</code>.</p>&#13;
&#13;
<p>Fetch has been supported for a long time now, so unless you have to support really old browsers you most likely won’t need to use XMLHttpRequest. Most—if not all—of the time, you’ll be using the Fetch API.<a data-startref="ix_04-network-requests-asciidoc3" data-type="indexterm" id="id803"/><a data-startref="ix_04-network-requests-asciidoc2" data-type="indexterm" id="id804"/><a data-startref="ix_04-network-requests-asciidoc1" data-type="indexterm" id="id805"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sending a GET Request with the Fetch API" data-type="sect1"><div class="sect1" id="id428">&#13;
<h1>Sending a GET Request with the Fetch API</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id270">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="GET request with" data-type="indexterm" id="ix_04-network-requests-asciidoc4"/><a data-primary="GET request" data-secondary="with Fetch API" data-type="indexterm" id="ix_04-network-requests-asciidoc5"/><a data-primary="network requests" data-secondary="GET request with the Fetch API" data-type="indexterm" id="ix_04-network-requests-asciidoc6"/>You want to send a GET request to a public API using a modern browser.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id429">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Fetch API. Fetch is a newer request API that uses <code>Promise</code>s. It’s very flexible and can send all kinds of data, but <a data-type="xref" href="#fetchPromise">Example 4-2</a> sends a basic GET request to an API.</p>&#13;
<div data-type="example" id="fetchPromise">&#13;
<h5><span class="label">Example 4-2. </span>Sending a GET request with the Fetch API</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Loads users by calling the /api/users API, and parses the</code>&#13;
<code class="cm"> * response JSON.</code>&#13;
<code class="cm"> * @returns a Promise that resolves to an array of users returned by the API</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">loadUsers</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="c1">// Make the request.</code>&#13;
  <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/users'</code><code class="p">)</code>&#13;
    <code class="c1">// Parse the response body to an object.</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>&#13;
    <code class="c1">// Handle errors, including network and JSON parsing errors.</code>&#13;
    <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s1">'Unable to fetch:'</code><code class="p">,</code> <code class="nx">error</code><code class="p">.</code><code class="nx">message</code><code class="p">));</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">loadUsers</code><code class="p">().</code><code class="nx">then</code><code class="p">(</code><code class="nx">users</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Got users:'</code><code class="p">,</code> <code class="nx">users</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id49">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The Fetch API is more concise. It returns a <code>Promise</code> that resolves to an object representing the HTTP response. The <code>response</code> object contains data such as the status code, headers, and body.</p>&#13;
&#13;
<p>To get the JSON response body, you need to call the response’s <code>json</code> method. This method reads the body from the stream and returns a <code>Promise</code> that resolves to the JSON body parsed as an object. If the response body is not valid JSON, the <code>Promise</code> is rejected.</p>&#13;
&#13;
<p>The response also has methods to read the body in other formats such as <code>FormData</code> or a plain text string.</p>&#13;
&#13;
<p>Because Fetch works with <code>Promise</code>s, you can also use <code>await</code>, as shown in <a data-type="xref" href="#fetchAsync">Example 4-3</a>.</p>&#13;
<div data-type="example" id="fetchAsync">&#13;
<h5><span class="label">Example 4-3. </span>Using Fetch with <code>async</code>/<code>await</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">loadUsers</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="k">try</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/users'</code><code class="p">);</code>&#13;
    <code class="k">return</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">();</code>&#13;
  <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s1">'Error loading users:'</code><code class="p">,</code> <code class="nx">error</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">printUsers</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">users</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">loadUsers</code><code class="p">();</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Got users:'</code><code class="p">,</code> <code class="nx">users</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Remember that before using <code>await</code> in a function, that function must have the <code>async</code> keyword<a data-startref="ix_04-network-requests-asciidoc6" data-type="indexterm" id="id806"/><a data-startref="ix_04-network-requests-asciidoc5" data-type="indexterm" id="id807"/><a data-startref="ix_04-network-requests-asciidoc4" data-type="indexterm" id="id808"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sending a POST Request with the Fetch API" data-type="sect1"><div class="sect1" id="id430">&#13;
<h1>Sending a POST Request with the Fetch API</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id271">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="sending a POST request with" data-type="indexterm" id="id809"/><a data-primary="JSON" data-secondary="request body" data-type="indexterm" id="id810"/><a data-primary="network requests" data-secondary="sending a POST request with the Fetch API" data-type="indexterm" id="id811"/><a data-primary="POST request" data-secondary="sending with Fetch API" data-type="indexterm" id="id812"/>You want to send a POST request to an API that expects a JSON request body.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id431">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Fetch API, specifying the method (POST), and the JSON body and content type (see <a data-type="xref" href="#fetchJson">Example 4-4</a>).</p>&#13;
<div data-type="example" id="fetchJson">&#13;
<h5><span class="label">Example 4-4. </span>Sending JSON payload via POST with the Fetch API</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Creates a new user by sending a POST request to /api/users.</code>&#13;
<code class="cm"> * @param firstName The user's first name</code>&#13;
<code class="cm"> * @param lastName The user's last name</code>&#13;
<code class="cm"> * @param department The user's department</code>&#13;
<code class="cm"> * @returns a Promise that resolves to the API response body</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">createUser</code><code class="p">(</code><code class="nx">firstName</code><code class="p">,</code> <code class="nx">lastName</code><code class="p">,</code> <code class="nx">department</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="s1">'/api/users'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code> <code class="nx">firstName</code><code class="p">,</code> <code class="nx">lastName</code><code class="p">,</code> <code class="nx">department</code> <code class="p">}),</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json'</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">createUser</code><code class="p">(</code><code class="s1">'John'</code><code class="p">,</code> <code class="s1">'Doe'</code><code class="p">,</code> <code class="s1">'Engineering'</code><code class="p">)</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Created user!'</code><code class="p">))</code>&#13;
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s1">'Error creating user:'</code><code class="p">,</code> <code class="nx">error</code><code class="p">));</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id432">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-type="xref" href="#fetchJson">Example 4-4</a> sends some JSON data in a <code>POST</code> request. Calling <code>JSON.stringify</code> on the user object turns it into a JSON <em>string</em>, which is required to send it as the body with <code>fetch</code>. You also need to set the <code>Content-Type</code> header so the server knows how to interpret the body.</p>&#13;
&#13;
<p>Fetch also allows you to send other content types as the body. <a data-type="xref" href="#example4-5">Example 4-5</a> shows how you would send a <code>POST</code> request with some form data.</p>&#13;
<div data-type="example" id="example4-5">&#13;
<h5><span class="label">Example 4-5. </span>Sending form data in a POST request</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">fetch</code><code class="p">(</code><code class="s1">'/login'</code><code class="p">,</code> <code class="p">{</code>&#13;
  <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
  <code class="nx">body</code><code class="o">:</code> <code class="s1">'username=sysadmin&amp;password=password'</code><code class="p">,</code>&#13;
  <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/x-www-form-urlencoded;charset=UTF-8'</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">})</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">data</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Logged in!'</code><code class="p">,</code> <code class="nx">data</code><code class="p">))</code>&#13;
  <code class="p">.</code><code class="k">catch</code><code class="p">(</code><code class="nx">error</code> <code class="o">=&gt;</code> <code class="nx">console</code><code class="p">.</code><code class="nx">error</code><code class="p">(</code><code class="s1">'Request failed:'</code><code class="p">,</code> <code class="nx">error</code><code class="p">));</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Uploading a File with the Fetch API" data-type="sect1"><div class="sect1" id="recipe_uploadFetch">&#13;
<h1>Uploading a File with the Fetch API</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id272">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Fetch API" data-secondary="uploading a file with" data-type="indexterm" id="id813"/><a data-primary="network requests" data-secondary="uploading a file with the Fetch API" data-type="indexterm" id="id814"/><a data-primary="POST request" data-secondary="uploading file data with the Fetch API" data-type="indexterm" id="id815"/>You want to upload file data with a POST request, using the Fetch API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id434">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use an <code>&lt;input type="file"&gt;</code> element, and send the file content as the request body (see <a data-type="xref" href="#example4-6">Example 4-6</a>).</p>&#13;
<div data-type="example" id="example4-6">&#13;
<h5><span class="label">Example 4-6. </span>Sending file data with the Fetch API</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Given a form with a 'file' input, sends a POST request containing</code>&#13;
<code class="cm"> * the file data in its body.</code>&#13;
<code class="cm"> * @param form the form object (should have a file input with the name 'file')</code>&#13;
<code class="cm"> * @returns a Promise that resolves when the response JSON is received</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">uploadFile</code><code class="p">(</code><code class="nx">form</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">formData</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FormData</code><code class="p">(</code><code class="nx">form</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">fileData</code> <code class="o">=</code> <code class="nx">formData</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'file'</code><code class="p">);</code>&#13;
  <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="s1">'https://httpbin.org/post'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="s1">'POST'</code><code class="p">,</code>&#13;
    <code class="nx">body</code><code class="o">:</code> <code class="nx">fileData</code>&#13;
  <code class="p">})</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="nx">response</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id435">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>There aren’t many steps involved to upload a file using modern browser APIs. The <code>&lt;input type="file"&gt;</code> provides the file data through the FormData API and is included in the body of the POST request. The browser takes care of the rest.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Sending a Beacon" data-type="sect1"><div class="sect1" id="id436">&#13;
<h1>Sending a Beacon</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id273">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Beacon API" data-secondary="sending a POST request with" data-type="indexterm" id="ix_04-network-requests-asciidoc7"/><a data-primary="network requests" data-secondary="sending a beacon" data-type="indexterm" id="ix_04-network-requests-asciidoc8"/><a data-primary="POST request" data-secondary="sending with Beacon API" data-type="indexterm" id="ix_04-network-requests-asciidoc9"/>You want to send a quick request without waiting for a response, for example, to send analytics data.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id274">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Beacon API to send data in a POST request. A regular POST request with the Fetch API may not complete in time before the page unloads. Using a beacon is more likely to succeed (see <a data-type="xref" href="#example4-7">Example 4-7</a>). The browser doesn’t wait for a response, and the request is more likely to succeed when sent as the user is leaving your site.</p>&#13;
<div data-type="example" id="example4-7">&#13;
<h5><span class="label">Example 4-7. </span>Sending a beacon</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">currentUser</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">username</code><code class="o">:</code> <code class="s1">'sysadmin'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// Some analytics data we want to capture</code>&#13;
<code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">user</code><code class="o">:</code> <code class="nx">currentUser</code><code class="p">.</code><code class="nx">username</code><code class="p">,</code>&#13;
  <code class="nx">lastVisited</code><code class="o">:</code> <code class="k">new</code> <code class="nb">Date</code><code class="p">()</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// Send the data before unload.</code>&#13;
<code class="nb">document</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'visibilitychange'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// If the visibility state is 'hidden', that means the page just became hidden.</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nb">document</code><code class="p">.</code><code class="nx">visibilityState</code> <code class="o">===</code> <code class="s1">'hidden'</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="nx">navigator</code><code class="p">.</code><code class="nx">sendBeacon</code><code class="p">(</code><code class="s1">'/api/analytics'</code><code class="p">,</code> <code class="nx">data</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id816">&#13;
<h1>A Note on Beacon Reliability</h1>&#13;
<p><a data-primary="Beacon API" data-secondary="reliability" data-type="indexterm" id="id817"/>In the past, the recommendation was to use the <code>beforeunload</code> or <code>unload</code> events to send analytics beacons, but this can be unreliable in many cases. Many sites such as <a href="https://oreil.ly/iBoG-">MDN</a> now recommend using the <code>visibilitychange</code> event instead.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id50">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>With an <code>XMLHttpRequest</code> or <code>fetch</code> call, the browser waits for the response and returns it (with an event or <code>Promise</code>). In general, you don’t need to wait for the response for one-way requests, such as sending analytics data.</p>&#13;
&#13;
<p>Instead of a <code>Promise</code>, <code>navigator.sendBeacon</code> returns a boolean value that indicates if the send operation was scheduled. There are no further events or notifications.</p>&#13;
&#13;
<p><code>navigator.sendBeacon</code> always sends a <code>POST</code> request. If you want to send multiple sets of analytics data, such as a collection of UI interactions, you can collect them in an array as the user interacts with your page, then send the array as the <code>POST</code> body with the beacon<a data-startref="ix_04-network-requests-asciidoc9" data-type="indexterm" id="id818"/><a data-startref="ix_04-network-requests-asciidoc8" data-type="indexterm" id="id819"/><a data-startref="ix_04-network-requests-asciidoc7" data-type="indexterm" id="id820"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Listening for Remote Events with Server-Sent Events" data-type="sect1"><div class="sect1" id="id437">&#13;
<h1>Listening for Remote Events with Server-Sent Events</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id51">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="EventSource API" data-type="indexterm" id="ix_04-network-requests-asciidoc10"/><a data-primary="network requests" data-secondary="listening for remote events with server-sent events" data-type="indexterm" id="ix_04-network-requests-asciidoc11"/><a data-primary="remote events, listening for" data-type="indexterm" id="ix_04-network-requests-asciidoc12"/><a data-primary="server-sent events (SSEs)" data-type="indexterm" id="ix_04-network-requests-asciidoc13"/><a data-primary="SSEs (server-sent events)" data-type="indexterm" id="ix_04-network-requests-asciidoc13a"/>You want to receive notifications from your backend server without repeated polling.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id438">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the EventSource API to receive server-sent events (SSE).</p>&#13;
&#13;
<p>To start listening for SSE, create a new instance of <code>EventSource</code>, passing the URL as the first argument (see <a data-type="xref" href="#example4-8">Example 4-8</a>).</p>&#13;
<div data-type="example" id="example4-8">&#13;
<h5><span class="label">Example 4-8. </span>Opening an SSE connection</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">events</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">EventSource</code><code class="p">(</code><code class="s1">'https://example.com/events'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// Fired once connected</code>&#13;
<code class="nx">events</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'open'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Connection is open'</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Fired if a connection error occurs</code>&#13;
<code class="nx">events</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'error'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'An error occurred:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Fired when receiving an event with a type of 'heartbeat'</code>&#13;
<code class="nx">events</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'heartbeat'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'got heartbeat:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">);</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// Fired when receiving an event with a type of 'notice'</code>&#13;
<code class="nx">events</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'notice'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'got notice:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">);</code>&#13;
<code class="p">})</code>&#13;
&#13;
<code class="c1">// The EventSource leaves the connection open. If we want to close the connection,</code>&#13;
<code class="c1">// we need to call close on the EventSource object.</code>&#13;
<code class="kd">function</code> <code class="nx">cleanup</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">events</code><code class="p">.</code><code class="nx">close</code><code class="p">();</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id52">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>An <code>EventSource</code> must connect to a special HTTP endpoint that leaves the connection open with a <code>Content-Type</code> header of <code>text/event-stream</code>. Whenever an event occurs, the server can send a new message across the open connection.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>As pointed out by <a href="https://oreil.ly/MliFN">MDN</a>, It’s highly recommended to use HTTP/2 with SSE. Otherwise, browsers impose a strict limit on the number of <code>EventSource</code> connections per domain. In this case, there can only be up to six connections.</p>&#13;
&#13;
<p>This limit is not per tab; it is imposed across all tabs in the browser on a given domain.</p>&#13;
</div>&#13;
&#13;
<p>When <code>EventSource</code> receives an event over a persistent connection, it is plain text. You can access the event text from the received event object’s <code>data</code> property. Here’s an example of an event of type <code>notice</code>:</p>&#13;
&#13;
<pre data-type="programlisting">event: notice&#13;
data: Connection established at 10:51 PM, 2023-04-22&#13;
id: 3</pre>&#13;
&#13;
<p>To listen for this event, call <code>addEventListener('notice')</code> on the <code>EventSource</code> object. The event object has a <code>data</code> property, whose value is whatever string value is prefixed with <code>data:</code> in the event.</p>&#13;
&#13;
<p>If an event does not have an event type, you can listen for the generic <code>message</code> event to receive it<a data-startref="ix_04-network-requests-asciidoc13a" data-type="indexterm" id="id821"/><a data-startref="ix_04-network-requests-asciidoc13" data-type="indexterm" id="id822"/><a data-startref="ix_04-network-requests-asciidoc12" data-type="indexterm" id="id823"/><a data-startref="ix_04-network-requests-asciidoc11" data-type="indexterm" id="id824"/><a data-startref="ix_04-network-requests-asciidoc10" data-type="indexterm" id="id825"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exchanging Data in Real Time with WebSockets" data-type="sect1"><div class="sect1" id="id439">&#13;
<h1>Exchanging Data in Real Time with WebSockets</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id53">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="network requests" data-secondary="exchanging data in real time with WebSockets" data-type="indexterm" id="ix_04-network-requests-asciidoc14"/><a data-primary="WebSocket API, exchanging data in real time with" data-type="indexterm" id="ix_04-network-requests-asciidoc15"/>You want to send and receive data in real time without having to repeatedly poll the server with Fetch requests.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id440">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the WebSocket API to open a persistent connection to your backend server (see <a data-type="xref" href="#example4-9">Example 4-9</a>).</p>&#13;
<div data-type="example" id="example4-9">&#13;
<h5><span class="label">Example 4-9. </span>Creating a WebSocket connection</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Open the WebSocket connection (the URL scheme should be ws: or wss:).</code>&#13;
<code class="kr">const</code> <code class="nx">socket</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">WebSocket</code><code class="p">(</code><code class="nx">url</code><code class="p">);</code>&#13;
&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'open'</code><code class="p">,</code> <code class="nx">onSocketOpened</code><code class="p">);</code>&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'message'</code><code class="p">,</code> <code class="nx">handleMessage</code><code class="p">);</code>&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'error'</code><code class="p">,</code> <code class="nx">handleError</code><code class="p">);</code>&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'close'</code><code class="p">,</code> <code class="nx">onSocketClosed</code><code class="p">);</code>&#13;
&#13;
<code class="kd">function</code> <code class="nx">onSocketOpened</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Socket ready for messages'</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">function</code> <code class="nx">handleMessage</code><code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Received message:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">.</code><code class="nx">data</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">function</code> <code class="nx">handleError</code><code class="p">(</code><code class="nx">event</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Socket error:'</code><code class="p">,</code> <code class="nx">event</code><code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kd">function</code> <code class="nx">onSocketClosed</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'Connection was closed'</code><code class="p">);</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>To use WebSockets, your server must have a WebSocket-enabled endpoint you can connect to. MDN has a nice <a href="https://oreil.ly/fzX67">deep dive on creating a WebSocket server</a>.</p>&#13;
</div>&#13;
&#13;
<p>Once the socket fires the <code>open</code> event, you can begin sending messages, as shown in <a data-type="xref" href="#example4-10">Example 4-10</a>.</p>&#13;
<div data-type="example" id="example4-10">&#13;
<h5><span class="label">Example 4-10. </span>Sending WebSocket messages</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Messages are simple strings.</code>&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s1">'Hello'</code><code class="p">);</code>&#13;
&#13;
<code class="c1">// The socket needs the data as a string, so you can use</code>&#13;
<code class="c1">// JSON.stringify to serialize objects to be sent.</code>&#13;
<code class="nx">socket</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">({</code>&#13;
  <code class="nx">username</code><code class="o">:</code> <code class="s1">'sysadmin'</code><code class="p">,</code>&#13;
  <code class="nx">password</code><code class="o">:</code> <code class="s1">'password'</code>&#13;
<code class="p">}));</code></pre></div>&#13;
&#13;
<p>A WebSocket connection is a bidirectional connection. Received data from the server fires a <code>message</code> event. You can handle these as needed or even send a response (see <a data-type="xref" href="#example4-11">Example 4-11</a>).</p>&#13;
<div data-type="example" id="example4-11">&#13;
<h5><span class="label">Example 4-11. </span>Responding to a WebSocket message</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">socket</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'message'</code><code class="p">,</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">socket</code><code class="p">.</code><code class="nx">send</code><code class="p">(</code><code class="s1">'ACKNOWLEDGED'</code><code class="p">);</code>&#13;
<code class="p">});</code></pre></div>&#13;
&#13;
<p>Finally, to clean up when you’re done, you can close the connection by calling <code>close</code> on the WebSocket object.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id54">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>WebSockets are well suited for apps requiring real-time capabilities such as a chat system or event monitoring. WebSocket endpoints have a <code>ws://</code> or <code>wss://</code> scheme. These are analogous to <code>http://</code> and <code>https://</code>—one is insecure and one uses &#13;
<span class="keep-together">encryption.</span></p>&#13;
&#13;
<p>To initiate a WebSocket connection, the browser first sends a <code>GET</code> request to the WebSocket endpoint. The request payload for the URL <code>wss://example.com/websocket</code> looks like this:</p>&#13;
&#13;
<pre data-type="programlisting">GET /websocket HTTP/1.1&#13;
Host: example.com&#13;
Sec-WebSocket-Key: aSBjYW4gaGFzIHdzIHBsej8/&#13;
Sec-WebSocket-Version: 13&#13;
Connection: Upgrade&#13;
Upgrade: websocket</pre>&#13;
&#13;
<p>This initiates a WebSocket handshake. If it’s successful, the server responds with a status code of 101 (Switching Protocols):</p>&#13;
&#13;
<pre data-type="programlisting">HTTP/1.1 101 Switching Protocols&#13;
Connection: Upgrade&#13;
Upgrade: websocket&#13;
Sec-WebSocket-Accept: bm8gcGVla2luZywgcGxlYXNlIQ==</pre>&#13;
&#13;
<p>The WebSocket protocol specifies an algorithm to generate a <code>Sec-Websocket-Accept</code> header based on the request’s <code>Sec-WebSocket-Key</code>. The client verifies this value, and at that point the two-way WebSocket connection is active and the socket fires the <code>open</code> event.</p>&#13;
&#13;
<p>Once the connection is open, you can listen for messages with the <code>message</code> event and send messages by calling <code>send</code> on the socket object. Later, you can terminate the WebSocket session by calling <code>close</code> on the socket object<a data-startref="ix_04-network-requests-asciidoc15" data-type="indexterm" id="id826"/><a data-startref="ix_04-network-requests-asciidoc14" data-type="indexterm" id="id827"/>.<a data-startref="ix_04-network-requests-asciidoc0" data-type="indexterm" id="id828"/></p>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>