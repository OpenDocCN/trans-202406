<html><head></head><body><section data-pdf-bookmark="Preface" data-type="preface" epub:type="preface"><div class="preface" id="preface">&#13;
  <h1>Preface</h1>&#13;
  <p>In the cloud native community and beyond, eBPF has become one of the hottest technical topics of recent years. A&#13;
    new generation of <a href="https://ebpf.io/applications">powerful tools and projects</a> in networking, security,&#13;
    observability, and more have been built (and more continue to be created) using eBPF as a platform, offering better&#13;
    performance and accuracy compared to their predecessors. eBPF-related conferences such as the <a href="https://ebpf.io/summit-2022">eBPF Summit</a> and <a href="https://oreil.ly/q9-p3">Cloud Native eBPF Day</a>&#13;
    have attracted thousands of attendees and viewers, and at the time of this writing, the <a href="http://ebpf.io/slack">eBPF Slack</a> community has more than 14,000 members.</p>&#13;
  <p>Why is eBPF being selected as the underlying technology for so many infrastructure tools? How does it deliver the&#13;
    promised improvements to performance? How is eBPF useful in such disparate technical fields, which range from&#13;
    performance tracing to network traffic encryption?</p>&#13;
  <p>This book aims to answer these questions by giving the reader an understanding of how eBPF works, as well as&#13;
    providing an introduction to writing eBPF code.</p>&#13;
  <section data-pdf-bookmark="Who This Book Is For" data-type="sect1"><div class="sect1" id="who_this_book_is_for">&#13;
    <h1>Who This Book Is For</h1>&#13;
    <p>This book is for developers, system administrators, operators, and students who are curious about eBPF and want&#13;
      to know more about how it works. It will provide a foundation for those who want to explore writing eBPF programs&#13;
      themselves. Since eBPF provides a great platform for a whole new generation of instrumentation and tooling, there&#13;
      will likely be gainful employment for eBPF developers for some years to come.</p>&#13;
    <p>But you don’t necessarily need to be planning to write eBPF code yourself for this book to be useful to you. If&#13;
      you work in operations, security, or any other role that involves software infrastructure, you’re likely to come&#13;
      across eBPF-based tooling, now or over the next few years. If you understand something about the internals of&#13;
      these tools, you’ll be in a better position to use them effectively. For example, if you know how events can&#13;
      trigger eBPF programs, you’ll have a better mental model for exactly what an eBPF-based tool is really measuring&#13;
      when it shows you performance metrics. If you’re an application developer, you might also come into contact with&#13;
      some of these eBPF-based tools—for example, if you are performance tuning an application, you might use a tool&#13;
      like <a href="https://www.parca.dev">Parca</a> to generate flame graphs showing which functions are taking the&#13;
      most time. If you are evaluating security tools, this book will help you understand where eBPF shines and how to&#13;
      avoid using it in a naïve way that is less effective against attacks.</p>&#13;
    <p>Even if you’re not using eBPF tools today, I hope this book will give you interesting insights into areas of&#13;
      Linux that you might not have considered before. Most developers take the kernel for granted, as they use&#13;
      programming languages with convenient higher-level abstractions that allow them to focus on the work of&#13;
      application development—which is plenty hard enough! They use tools like debuggers and performance analyzers to&#13;
      help them do their job effectively. Knowing the internals of how a debugger or performance tool works might be&#13;
      interesting, but it’s not essential. Yet, for many of us, it’s fun and fulfilling to go down the rabbit hole to&#13;
      find out more.<sup><a data-type="noteref" href="preface01.html#ch00fn1" id="ch00fn1-marker">1</a></sup> In the same&#13;
      way, most people will use eBPF tools without having to worry about how they are built. <a href="https://oreil.ly/gOV1D">Arthur C. Clarke wrote</a> that “any sufficiently advanced technology is&#13;
      indistinguishable from magic,” but personally, I like to dig in and find out how the magic trick works. You might&#13;
      be like me and feel compelled to explore eBPF programming to get a better feel for what is possible with this&#13;
      technology. If so, I think you’ll enjoy this book.</p>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="What This Book Covers" data-type="sect1"><div class="sect1" id="what_this_book_covers">&#13;
    <h1>What This Book Covers</h1>&#13;
    <p>eBPF continues to evolve at quite a rapid pace, which makes it rather difficult to write a comprehensive&#13;
      reference that doesn’t constantly need updating. However, there are some fundamentals and basic principles that&#13;
      are unlikely to change significantly, and that’s what this book discusses.</p>&#13;
    <p><a data-type="xref" href="ch01.html#what_is_ebpf_and_why_is_it_importantque">Chapter 1</a>&#13;
      sets the scene by describing why eBPF is so powerful as a technology and explaining how the ability to run custom&#13;
      programs in the operating system kernel enables so many exciting capabilities.</p>&#13;
    <p>Things become more concrete in <a data-type="xref" href="ch02.html#ebpfapostrophes_quotation_markhello_wor">Chapter 2</a>, where you’ll see&#13;
      some “Hello World” examples that introduce you to the concepts of eBPF programs and maps.</p>&#13;
    <p><a data-type="xref" href="ch03.html#anatomy_of_an_ebpf_program">Chapter 3</a> dives into more detail&#13;
      about eBPF programs and how they run in the kernel, and <a data-type="xref" href="ch04.html#the_bpfleft_parenthesisright_parenthesi">Chapter 4</a> explores the&#13;
      interface between user space applications and eBPF programs.</p>&#13;
    <p>One of the big challenges of eBPF in recent years has been the question of compatibility across kernel versions.&#13;
      <a data-type="xref" href="ch05.html#co_recomma_btfcomma_and_libbpf">Chapter 5</a> looks at the&#13;
      “compile once, run everywhere” (CO-RE) approach that solves this problem.&#13;
    </p>&#13;
    <p>The verification process is perhaps the most important characteristic that distinguishes eBPF from kernel&#13;
      modules. I’ll introduce you to the eBPF verifier in <span class="keep-together"><a data-type="xref" href="ch06.html#the_ebpf_verifier">Chapter 6</a></span>.</p>&#13;
    <p>In <a data-type="xref" href="ch07.html#ebpf_program_and_attachment_types">Chapter 7</a> you’ll&#13;
      get an introduction to the many different types of eBPF programs and their attachment points. Many of those&#13;
      attachment points are within the networking stack, and <a data-type="xref" href="ch08.html#ebpf_for_networking">Chapter 8</a> explores the application of eBPF for networking features in&#13;
      more detail. <a data-type="xref" href="ch09.html#ebpf_for_security">Chapter 9</a> looks at how eBPF is being used&#13;
      to build security tools.</p>&#13;
    <p>If you want to write a user space application that interacts with eBPF programs, there are many libraries and&#13;
      frameworks available to help. <a data-type="xref" href="ch10.html#ebpf_programming">Chapter 10</a> gives an overview&#13;
      of the options for various programming languages.</p>&#13;
    <p>Finally, in <a data-type="xref" href="ch11.html#the_future_evolution_of_ebpf">Chapter 11</a> I’ll gaze&#13;
      into my crystal ball and tell you about some future developments that are likely to unfold in the eBPF world.</p>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="Prerequisite Knowledge" data-type="sect1"><div class="sect1" id="prerequisite_knowledge">&#13;
    <h1>Prerequisite Knowledge</h1>&#13;
    <p>This book assumes you are comfortable with basic shell commands on Linux and with the idea of using a compiler to&#13;
      turn source code into an executable program. There are some simple example extracts from Makefiles, on the&#13;
      assumption that you have at least a minimal understanding of how <code>make</code> uses these files.</p>&#13;
    <p>There are lots of code examples in Python, C, and Go. You won’t need in-depth knowledge of those languages to get&#13;
      something out of these examples, but you’ll get the most out of the book if you are generally happy to read some&#13;
      code. I’m also assuming you are familiar with the idea of <em>pointers</em>, which identify a memory <span class="keep-together">location</span>.</p>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="Example Code and Exercises" data-type="sect1"><div class="sect1" id="example_code_and_exercises">&#13;
    <h1>Example Code and Exercises</h1>&#13;
    <p><a contenteditable="false" data-primary="code examples, GitHub repository for" data-type="indexterm" id="idm46123212718592"/>There are lots of code examples in this book. If you want to try them out for&#13;
      yourself, you’ll find an accompanying GitHub repository and instructions for installing and running the code at <a href="https://github.com/lizrice/learning-ebpf"><em class="hyperlink">https://github.com/lizrice/learning-ebpf</em></a>.</p>&#13;
    <p>I have also included exercises at the end of most of the chapters to help you explore eBPF programming by&#13;
      extending the examples or writing your own programs.</p>&#13;
    <p><a contenteditable="false" data-primary="kernel" data-secondary="evolution of features on" data-type="indexterm" id="idm46123214772496"/>Because eBPF is continually evolving, the features available to you depend on&#13;
      the kernel version you’re running. Many of the restrictions that apply to earlier versions have been lifted or&#13;
      relaxed in later versions. <a contenteditable="false" data-primary="Iovisor project" data-type="indexterm" id="idm46123214770976"/>The Iovisor project has a useful overview of the <a href="https://oreil.ly/SsnEV">kernel versions in which different BPF features were added</a>, and in this book I&#13;
      have attempted to note when the particular capabilities I’m describing were added. The examples were tested using&#13;
      version 5.15 of the kernel, and at the time of this writing some of the popular Linux distributions don’t yet&#13;
      support such a recent kernel version. If you’re reading this book shortly after it was published, you might find&#13;
      that some of the features won’t work on the Linux kernel your organization uses in production.</p>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="Is eBPF Only for Linux?" data-type="sect1"><div class="sect1" id="is_ebpf_only_for_linuxquestion_mark">&#13;
    <h1>Is eBPF Only for Linux?</h1>&#13;
    <p>eBPF was originally developed for Linux. There’s no particular reason why the same approach couldn’t be used in&#13;
      other operating systems too—indeed, Microsoft has been developing an <a href="https://oreil.ly/k7AvA">eBPF&#13;
        implementation for Windows</a>. I discuss that briefly in <a data-type="xref" href="ch11.html#the_future_evolution_of_ebpf">Chapter 11</a>, but throughout the rest of the book I&#13;
      focus on the Linux implementation, and all the examples will be from Linux.</p>&#13;
  </div></section>&#13;
&#13;
  <section data-pdf-bookmark="Conventions Used in This Book" data-type="sect1"><div class="sect1" id="_conventions_used_in_this_book">&#13;
    <h1>Conventions Used in This Book</h1>&#13;
    <p>The following typographical conventions are used in this book:</p>&#13;
    <dl>&#13;
      <dt><em>Italic</em></dt>&#13;
      <dd>&#13;
        <p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>&#13;
      </dd>&#13;
      <dt><code>Constant width</code></dt>&#13;
      <dd>&#13;
        <p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or&#13;
          function names, databases, data types, environment variables, statements, and keywords.</p>&#13;
      </dd>&#13;
      <dt><strong><code>Constant width bold</code></strong></dt>&#13;
      <dd>&#13;
        <p>Shows commands or other text that should be typed literally by the user.</p>&#13;
      </dd>&#13;
      <dt><em><code>Constant width italic</code></em></dt>&#13;
      <dd>&#13;
        <p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>&#13;
      </dd>&#13;
    </dl>&#13;
    <div class="pagebreak-before less_space" data-type="tip"><h6>Tip</h6>&#13;
      <p>This element signifies a tip or suggestion.</p>&#13;
    </div>&#13;
    <div data-type="note" epub:type="note"><h6>Note</h6>&#13;
      <p>This element signifies a general note.</p>&#13;
    </div>&#13;
    <div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
      <p>This element indicates a warning or caution.</p>&#13;
    </div>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="Using Code Examples" data-type="sect1"><div class="sect1" id="_using_code_examples">&#13;
    <h1>Using Code Examples</h1>&#13;
    <!--PROD: Please reach out to author to find out if they will be uploading code examples to oreilly.com or their own site (e.g., GitHub). If there is no code download, delete this whole section. If there is, when you email digidist with the link, let them know what you filled in for title_title (should be as close to book title as possible, i.e., learning_python_2e). This info will determine where digidist loads the files.-->&#13;
    <p>Supplemental material (code examples, exercises, etc.) is available for download at <a href="https://github.com/lizrice/learning-ebpf"><em>https://github.com/lizrice/learning-ebpf</em></a>.</p>&#13;
    <p>If you have a technical question or a problem using the code examples, please send email to <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a>.</p>&#13;
    <p>This book is here to help you get your job done. In general, if example code is offered with this book, you may&#13;
      use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing&#13;
      a significant portion of the code. For example, writing a program that uses several chunks of code from this book&#13;
      does not require permission. Selling or distributing examples from O’Reilly books does require permission.&#13;
      Answering a question by citing this book and quoting example code does not require permission. Incorporating a&#13;
      significant amount of example code from this book into your product’s documentation does require <span class="keep-together">permission</span>.</p>&#13;
    <p>We appreciate, but generally do not require, attribution. An attribution usually includes the title, author,&#13;
      publisher, and ISBN. For example: “<em>Learning eBPF</em> by Liz Rice (O’Reilly). Copyright 2023 Vertical Shift&#13;
      Ltd., 978-1-098-13512-6.”</p>&#13;
    <p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact&#13;
      us at <a class="email" href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>&#13;
  </div></section>&#13;
  <section class="pagebreak-before" data-pdf-bookmark="O’Reilly Online Learning" data-type="sect1"><div class="sect1" id="_safari_books_online">&#13;
    <h1 class="less_space">O’Reilly Online Learning</h1>&#13;
    <div class="ormenabled" data-type="note" epub:type="note"><h6>Note</h6>&#13;
      <p>For more than 40 years, <a class="orm:hideurl" href="https://oreilly.com"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business&#13;
        training, knowledge, and insight to help companies succeed.</p>&#13;
    </div>&#13;
    <p>Our unique network of experts and innovators share their knowledge and expertise through books, articles, and our&#13;
      online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses,&#13;
      in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly&#13;
      and 200+ other publishers. For more information, visit <a class="orm:hideurl" href="https://oreilly.com"><em>https://oreilly.com</em></a>.</p>&#13;
  </div></section>&#13;
  <section data-pdf-bookmark="How to Contact Us" data-type="sect1"><div class="sect1" id="_how_to_contact_us">&#13;
    <h1>How to Contact Us</h1>&#13;
    <p>Please address comments and questions concerning this book to the publisher:</p>&#13;
    <ul class="simplelist">&#13;
      <li>O’Reilly Media, Inc.</li>&#13;
      <li>1005 Gravenstein Highway North</li>&#13;
      <li>Sebastopol, CA 95472</li>&#13;
      <li>800-998-9938 (in the United States or Canada)</li>&#13;
      <li>707-829-0515 (international or local)</li>&#13;
      <li>707-829-0104 (fax)</li>&#13;
    </ul>&#13;
    <p>We have a web page for this book, where we list errata, examples, and any additional information. You can access&#13;
      this page at <a href="https://oreil.ly/learning-eBPF"><em>https://oreil.ly/learning-eBPF</em></a>.</p>&#13;
    <!--Don't forget to update the link above.-->&#13;
    <p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical&#13;
      questions about this book.</p>&#13;
&#13;
    <p>For news and information about our books and courses, visit <a href="https://oreilly.com"><em>https://oreilly.com</em></a>.</p>&#13;
    <p>Find us on LinkedIn: <a href="https://linkedin.com/company/oreilly-media"><em>https://linkedin.com/company/oreilly-media</em></a>.</p>&#13;
    <p>Follow us on Twitter: <a href="https://twitter.com/oreillymedia"><em>https://twitter.com/oreillymedia</em></a>.&#13;
    </p>&#13;
    <p>Watch us on YouTube: <a href="https://youtube.com/oreillymedia"><em>https://youtube.com/oreillymedia</em></a>.&#13;
    </p>&#13;
  </div></section>&#13;
&#13;
  <section class="pagebreak-before" data-pdf-bookmark="Acknowledgments" data-type="sect1"><div class="sect1" id="acknowledgments">&#13;
    <h1 class="less_space">Acknowledgments</h1>&#13;
    <p>I would like to thank the many people who have contributed enormously to the writing of this book:</p>&#13;
    <ul>&#13;
      <li>&#13;
        <p>My technical reviewers—Timo Beckers, Jess Males, Quentin Monnet, Kevin Sheldrake, and Celeste&#13;
          Stinger—provided detailed, actionable feedback and great ideas for improving the examples, for which I’m very&#13;
          grateful.</p>&#13;
      </li>&#13;
      <li>&#13;
        <p>I’m standing on the shoulders of the giants who built, popularized, and continue to maintain eBPF, including&#13;
          Daniel Borkmann, Thomas Graf, Brendan Gregg, Andrii Nakryiko, Alexei Starovoitov, and countless others who&#13;
          have contributed not just code but also conference talks and blog posts to the community.</p>&#13;
      </li>&#13;
      <li>&#13;
        <p>Thank you to my talented and lovely colleagues at Isovalent, many of whom are eBPF and kernel specialists,&#13;
          from whom I continue to learn so much.</p>&#13;
      </li>&#13;
      <li>&#13;
        <p>Thanks also to the team at O’Reilly, especially my editor, Rita Fernando, who gave me endless support during&#13;
          the writing process, as well as the planning that helped keep the book on schedule; and John Devins, for&#13;
          encouraging me to write the book in the first place.</p>&#13;
      </li>&#13;
      <li>&#13;
        <p>Phil Pearl not only gave helpful feedback on the content, but he also made sure I ate and took breaks. I am&#13;
          forever grateful for his support and encouragement.</p>&#13;
      </li>&#13;
    </ul>&#13;
    <p>I also want to thank all the wonderful people who, over the years, have taken the time to make encouraging&#13;
      comments about my work, whether it’s in person at an event or on social media. It’s incredibly inspiring to know&#13;
      that something I have written or recorded has helped someone else get to grips with a technical concept or has&#13;
      given them the desire to build or write something themselves. Thank you!</p>&#13;
  </div></section>&#13;
<div data-type="footnotes"><p data-type="footnote" id="ch00fn1"><sup><a href="preface01.html#ch00fn1-marker">1</a></sup> At the dotGo Paris conference in 2017, <a href="https://youtu.be/TBrv17QyUE0">I gave a talk that showed how a debugger works</a>.</p></div></div></section></body></html>