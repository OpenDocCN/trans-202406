<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Fragments and Navigation: Finding Your Way"><div class="chapter" id="fragments_and_navigationcolon_finding_yo">
<h1><span class="label">Chapter 6. </span>Fragments and Navigation: <em>Finding Your Way</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0219-01.png" alt="image" width="600" height="361"/>
<h6/>
</div></figure>
<p><strong>Most apps require more than one screen.</strong></p>
<p>So far, we’ve just looked at how to create single-screen apps, which is fine for simple applications. But what if you have <strong>more complex requirements</strong>? In this chapter, you’ll learn how to use <strong>fragments</strong> and the <strong>Navigation component</strong> to <strong>build multi-screen apps.</strong> You’ll learn how <strong>fragments are like subactivities</strong> with their own methods. You’ll find out how to <strong>design effective navigation graphs</strong>. Finally, you’ll meet the <strong>navigation host</strong> and <strong>navigation controller</strong>, and learn how they help you navigate from place to place.</p>
<section data-type="sect1" data-pdf-bookmark="Most apps need more than one screen"><div class="sect1" id="most_apps_need_more_than_one_screen">
<h1>Most apps need more than one screen</h1>
<p><a data-type="indexterm" data-primary="Secret Message app" id="idm46053740844704"/>All of the apps you’ve built so far have one thing in common: they each have a single screen. Each app has a single activity with a corresponding layout, which defines the app’s appearance, and how the user can interact with it.</p>
<p>Most apps, however, contain <em>more</em> than one screen. An email app, for example, might have one screen that lets you compose an email, and another that displays a list of emails you’ve received. A calendar app might display a list of events on one screen, and the details of one specific event on another.</p>
<p>We’re going to show you how to build multi-screen apps by creating a Secret Message app. The app will comprise of a welcome screen, a second screen which allows the user to enter a message, and a third which displays an encrypted version of the message.</p>
<p>Here’s what the app will look like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0220-01.png" alt="image" width="600" height="435"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Each screen is a fragment"><div class="sect1" id="each_screen_is_a_fragment">
<h1>Each screen is a <u>fragment</u></h1>
<p><a data-type="indexterm" data-primary="Android apps" data-seealso="specific app projects" id="idm46053740835408"/><a data-type="indexterm" data-primary="Android devices" data-secondary="adapting apps for different sizes of" data-see="fragments" id="idm46053740834432"/><a data-type="indexterm" data-primary="Android Jetpack" data-secondary="fragments" data-see="fragments" id="idm46053740833216"/><a data-type="indexterm" data-primary="apps" data-see="Android apps" id="idm46053740831824"/><a data-type="indexterm" data-primary="EncryptFragment" id="idm46053740830720"/><a data-type="indexterm" data-primary="fragments" data-seealso="specific fragments for apps" id="idm46053740829888"/><a data-type="indexterm" data-primary="layouts" data-secondary="for fragments" data-see="fragments" id="idm46053740828816"/><a data-type="indexterm" data-primary="projects" data-seealso="specific app projects" id="idm46053740827440"/><a data-type="indexterm" data-primary="screens" data-seealso="fragments" id="idm46053740826336"/><a data-type="indexterm" data-primary="Secret Message app" data-secondary="EncryptFragment" data-see="EncryptFragment" id="idm46053740825232"/><a data-type="indexterm" data-primary="WelcomeFragment" id="idm46053740823856"/>The Secret Message app has three distinct screens, and we’re going to build each screen as a separate <strong>fragment</strong>. A fragment is like a kind of subactivity that’s displayed inside an activity’s layout. It has Kotlin code that controls its behavior, and an associated layout that defines its appearance.</p>
<p>Here are the three fragments that the app will use:</p>
<blockquote>
<p><strong>A <u>fragment</u> has Kotlin code that controls its behavior, and a layout that specifies its appearance.</strong></p>
</blockquote>
<section data-type="sect2" data-pdf-bookmark="WelcomeFragment"><div class="sect2" id="welcomefragment">
<h2>WelcomeFragment</h2>
<p>This is the app’s main screen. It needs to display some introductory text, and a button. The button will be used to navigate to the next screen—<code>MessageFragment</code>.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="MessageFragment"><div class="sect2" id="messagefragment">
<h2>MessageFragment</h2>
<p>This screen will let the user enter a message into an edit text. When the user clicks on its button, the app will navigate to <code>EncryptFragment</code>.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="EncryptFragment"><div class="sect2" id="encryptfragment">
<h2>EncryptFragment</h2>
<p>This is the final screen. It encrypts the user’s message, and displays the result.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0221-01.png" alt="image" width="550" height="745"/>
<h6/>
</div></figure>
<p>As you can see, the user needs to be able to navigate between all three fragments. So how will this work?</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Navigate between screens using the Navigation component"><div class="sect1" id="navigate_between_screens_using_the_navig">
<h1>Navigate between screens using the Navigation component</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="Navigation component" id="idm46053740808528"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="fragments" id="idm46053740807072"/>The best way of navigating between fragments is to use Android’s <strong>Navigation component</strong>. The Navigation component is part of Android Jetpack, and it helps you implement navigation in a standard way.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0222-01.png" alt="image" width="361" height="146"/>
<h6/>
</div></figure>
<p>To use the Navigation component in the Secret Message app, we’ll include a single activity named <code>MainActivity</code>. As the user navigates through the app, the activity will display each fragment in turn like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0222-02.png" alt="image" width="600" height="458"/>
<h6/>
</div></figure>
<p>You’ll find out more about fragments and the Navigation component as we build the Secret Message app. Let’s go through the steps we’ll take to create it.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s what we’re going to do"><div class="sect1" id="hereapostrophes_what_weapostroph-id00075">
<h1>Here’s what we’re going to do</h1>
<p>We’re going to start building the Secret Message app in this chapter, and complete it in the next.</p>
<p>Here’s what we’ll do in this chapter:</p>
<ol>
<li><p><strong>Create and display WelcomeFragment.</strong></p>
<p>In this step, we’ll create <code>WelcomeFragment</code>, which will be the app’s first screen. We’ll display this fragment in <code>MainActivity</code>’s layout so the user sees it when the app launches.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0223-01.png" alt="image" width="600" height="322"/>
<h6/>
</div></figure></li>
<li><p><strong>Navigate to MessageFragment.</strong></p>
<p>We’ll create a second fragment named <code>MessageFragment</code>, and navigate to it when the user clicks on a button in <code>WelcomeFragment</code>’s layout. We’ll use Android’s Navigation component to implement navigation.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0223-02.png" alt="image" width="600" height="250"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s start by creating a new project for the app.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create a new project"><div class="sect1" id="create_a_new_project-id00076">
<h1>Create a new project</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0224-01.png" alt="image" width="318" height="59"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="String resources" data-secondary="Secret Message app" id="idm46053740785552"/>We’re going to use a new project for the Secret Message app, so create one now using the same steps you used in the previous chapters. Choose the Empty Activity option, enter a name of “Secret Message” and a package name of “com.hfad.secretmessage”, and accept the default save location. Make sure the language is set to Kotlin and the minimum SDK is API 21 so it will run on most Android devices.</p>
<section data-type="sect2" data-pdf-bookmark="Add some String resources"><div class="sect2" id="add_some_string_resources">
<h2>Add some String resources</h2>
<p>Before we create any fragments, we’re going to add some <code>String</code> resources to the project. We’ll use these to display text in the fragments’ layouts, such as the labels for buttons, and the welcome message on the first screen.</p>
<p>To add the <code>String</code>s, open the file <em>strings.xml</em> in the <em>SecretMessage/app/src/main/res/values</em> folder, and then add the following resources (in bold) to the file:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0224-02.png" alt="image" width="600" height="226"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00077">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Why are we using fragments? Can’t you create a multi-screen app using multiple activities instead?</strong></p>
<p><strong>A:</strong> Yes, it’s possible to create multi-screen apps using multiple activities, and up until a few years ago, this is how you’d typically develop apps of this kind.</p>
<p>Since releasing Android’s Navigation component, the Android team recommends using fragments instead. The Navigation component is primarily designed to work with fragments, so this is now the standard way of implementing navigation.</p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add WelcomeFragment to the project"><div class="sect1" id="add_welcomefragment_to_the_project">
<h1>Add WelcomeFragment to the project</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="WelcomeFragment" id="idm46053740774528"/><a data-type="indexterm" data-primary="Secret Message app" data-secondary="WelcomeFragment" id="idm46053740770816"/><a data-type="indexterm" data-primary="WelcomeFragment" data-secondary="adding to project" id="idm46053740769536"/>We’re going to add a fragment named <code>WelcomeFragment</code> to the project. <code>WelcomeFragment</code> will be the first screen that the user sees when she opens the app, and we’ll use it to display some introductory text about the app, and a button.</p>
<p>To add the fragment, highlight the <em>com.hfad.secretmessage</em> package in the <em>app/src/main/java</em> folder in the project explorer, go to the File menu, and choose New→Fragment→Fragment (Blank).</p>
<p>You will be asked how you want to configure the new fragment. Name the fragment “WelcomeFragment”, and give its layout a name of “fragment_welcome”. Then make sure the language is set to Kotlin, and click on the Finish button.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0225-02.png" alt="image" width="359" height="289"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0225-03.png" alt="image" width="600" height="407"/>
<h6/>
</div></figure>
<p>When you click on the Finish button, Android Studio creates the new fragment and adds it to the project.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What fragment code looks like"><div class="sect1" id="what_fragment_code_looks_like">
<h1>What fragment code looks like</h1>
<p><a data-type="indexterm" data-primary="Fragment class" id="idm46053740760448"/><a data-type="indexterm" data-primary="fragments" data-secondary="code for" id="idm46053740758496"/><a data-type="indexterm" data-primary="fragments" data-secondary="layouts for" id="idm46053740757392"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" data-secondary="overriding" id="idm46053740756288"/>When you create a new fragment, Android Studio adds two files to your project: a Kotlin file that controls the fragment’s behavior, and a layout file that describes the fragment’s appearance.</p>
<p>We’ll look at the Kotlin code first. Go to the <em>com.hfad.secretmessage</em> package in the <em>app/src/main/java</em> folder and open the file <em>WelcomeFragment.kt</em>. Then <strong>replace the code</strong> that Android Studio generated with the code below:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0226-02.png" alt="image" width="600" height="381"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Fragment code looks similar to activity code"><div class="sect2" id="fragment_code_looks_similar_to_activity">
<h2>Fragment code looks similar to activity code</h2>
<p>The above code defines a basic fragment. As you can see, the code for a fragment looks very similar to activity code. Instead of extending <code>AppCompatActivity</code>, however, it extends <code><strong>Fragment</strong></code>.</p>
<p>The <code>androidx.fragment.app.Fragment</code> class is part of Android Jetpack, and it’s used to define a basic fragment. It includes the latest fragment features, while being backward compatible with older versions of Android.</p>
<p>The fragment overrides the <code>onCreateView()</code> method, which gets called as soon as Android needs the fragment’s layout. Nearly every fragment overrides this method, so let’s look at it in more detail.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0226-03.png" alt="image" width="301" height="291"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The fragment’s onCreateView() method"><div class="sect1" id="the_fragmentapostrophes_oncreateviewleft">
<h1>The fragment’s onCreateView() method</h1>
<p><a data-type="indexterm" data-primary="Bundle? parameter" id="idm46053740741824"/><a data-type="indexterm" data-primary="inflate() method" data-secondary="LayoutInflater" id="idm46053740740656"/><a data-type="indexterm" data-primary="inflaters, layout" id="idm46053740739552"/><a data-type="indexterm" data-primary="LayoutInflator class" id="idm46053740738720"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" id="idm46053740737888"/><a data-type="indexterm" data-primary="setContentView() method, activity" data-secondary="fragments and navigation" id="idm46053740737088"/><a data-type="indexterm" data-primary="ViewGroup? parameter" id="idm46053740736048"/>The <code>onCreateView()</code> method gets called when Android needs access to the fragment’s layout. Overriding this method is optional, but as you need to implement it each time you define a fragment with a layout, you’ll override it for nearly every fragment you create.</p>
<p>The method takes three parameters:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0227-02.png" alt="image" width="600" height="105"/>
<h6/>
</div></figure>
<p>The first parameter is a <code>LayoutInflater</code> that you use to inflate the fragment’s layout. As you learned in <a data-type="xref" href="ch03.xhtml#layoutscolon_being_a_layout">Chapter 3</a>, inflating a layout turns its XML views into objects.</p>
<p>The second parameter is a <code>ViewGroup?</code>. This is the <code>ViewGroup</code> in the activity’s layout that displays the fragment.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">You’ll find out more about this a few pages ahead.</span></p>
</div>
<p>The final parameter is a <code>Bundle?</code>. This is used if you’ve previously saved the fragment’s state, and want to reinstate it. It works in a similar way to the <code>Bundle?</code> parameter that’s passed to an activity’s <code>onCreate()</code> method.</p>
<section data-type="sect2" data-pdf-bookmark="Inflate the fragment’s layout, and return it"><div class="sect2" id="inflate_the_fragmentapostrophes_layoutco">
<h2>Inflate the fragment’s layout, and return it</h2>
<p>The <code>onCreateView()</code> method returns a <code>View?</code>, which is an inflated version of the fragment’s layout.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0227-04.png" alt="image" width="406" height="172"/>
<h6/>
</div></figure>
<p>You inflate the layout using the <code>LayoutInflater</code>’s <code>inflate()</code> method like this:</p>
<pre data-type="programlisting">override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,
                          savedInstanceState: Bundle?): View? {
    <strong>return inflater.inflate(R.layout.fragment_welcome, container, false)</strong>
}</pre>
<p>The above code is the fragment equivalent of calling an activity’s <code>setContentView()</code> method, as it’s used to inflate the fragment’s layout into a hierarchy of <code>View</code> objects. The above code, for example, inflates <code>WelcomeFragment</code>’s layout <em>fragment_welcome.xml</em>.</p>
<p>Once the fragment’s layout has been inflated, the <code>View</code> hierarchy is inserted into the activity’s layout, and displayed.</p>
<p>Now that you’ve seen <code>WelcomeFragment</code>’s Kotlin code, let’s take a look at its layout.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0227-05.png" alt="image" width="301" height="262"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fragment layout code looks like activity layout code"><div class="sect1" id="fragment_layout_code_looks_like_activity">
<h1>Fragment layout code looks like activity layout code</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="code for" id="idm46053740708576"/>As we said earlier, fragments use layout files to describe their appearance. There’s no difference between activity layout and fragment layout code, so <strong>you can use any of the views and view groups in your fragment layout code that you’re already familiar with</strong>.</p>
<p>We’re going to replace the default layout code Android Studio has generated for us with a linear layout containing a text view that displays a brief description of the app, and a button that we’ll use to navigate to a different fragment later in the chapter.</p>
<p>Open the file <em>fragment_welcome.xml</em> in the <em>app/src/main/res/layout</em> folder, and replace its contents with the code below:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0228-01.png" alt="image" width="600" height="515"/>
<h6/>
</div></figure>
<p>That’s all the code we need for <code>WelcomeFragment</code> (and its layout) for now, so let’s find out how to display it in the app.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="You display a fragment in a FragmentContainerView"><div class="sect1" id="you_display_a_fragment_in_a_fragmentcont">
<h1>You display a fragment in a FragmentContainerView</h1>
<p><a data-type="indexterm" data-primary="FragmentContainerView" id="idm46053740699792"/><a data-type="indexterm" data-primary="name attribute" id="idm46053740698768"/><a data-type="indexterm" data-primary="name attribute" data-secondary="FragmentContainerView" id="idm46053740697872"/>To display a fragment, you need to add it to an activity’s layout. In this app, for example, we’re going to display <code>WelcomeFragment</code> by adding it to <code>MainActivity</code>’s layout file <em>activity_main.xml</em>.</p>
<p>You add a fragment to a layout using a <code><strong>FragmentContainerView</strong></code>. This is a type of <code>FrameLayout</code> that’s used to display fragments, and you add it to a layout file using code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0229-01.png" alt="image" width="600" height="113"/>
<h6/>
</div></figure>
<p>You specify which fragment you want to display by setting the <code>FragmentContainerView</code>’s <code>android:name</code> attribute to the fully qualified fragment name, including its package. In the Secret Message app, we want to display the fragment named <code>WelcomeFragment</code> that’s in the <em>com.hfad.secretmessage</em> package, so we’re setting the <code>android:name</code> attribute using:</p>
<pre data-type="programlisting">android:name="com.hfad.secretmessage.WelcomeFragment"</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0229-02.png" alt="image" width="281" height="326"/>
<h6/>
</div></figure>
<p>When Android creates the activity’s layout, it populates the <code>FragmentContainerView</code> with the <code>View</code> object returned by the fragment’s <code>onCreateView()</code> method. This <code>View</code> is the fragment’s user interface, so you can think of the <code>FragmentContainerView</code> as a placeholder for where the fragment’s layout should be inserted:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0229-03.png" alt="image" width="600" height="201"/>
<h6/>
</div></figure>
<p>Now that you know how to add a fragment to a layout, let’s add <code>WelcomeFragment</code> to <code>MainActivity</code>’s layout.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update the activity_main.xml code"><div class="sect1" id="update_the_activityunderscoremaindotxml">
<h1>Update the activity_main.xml code</h1>
<p>We want <code>MainActivity</code> to display <code>WelcomeFragment</code>, which means we need to add a <code>FragmentContainerView</code> to its layout.</p>
<p>Here’s the full code for <em>activity_main.xml</em>: replace the code so that it includes the changes shown here:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0230-02.png" alt="image" width="600" height="217"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="The full code for MainActivity.kt"><div class="sect2" id="the_full_code_for_mainactivitydo-id00078">
<h2>The full code for MainActivity.kt</h2>
<p>We don’t need to add any extra Kotlin code to <code>MainActivity</code> to make it display a fragment because the layout’s <code>FragmentContainerView</code> handles everything. You just need to make sure that the code in <em>MainActivity.kt</em> looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0230-03.png" alt="image" width="600" height="224"/>
<h6/>
</div></figure>
<p>Let’s see what happens when the app runs.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What the code does"><div class="sect1" id="what_the_code_does-id00079">
<h1>What the code does</h1>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>When the app is launched, MainActivity gets created.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0231-02.png" alt="image" width="323" height="170"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity’s onCreate() method runs.</strong></p>
<p>The <code>onCreate()</code> method specifies that <em>activity_main.xml</em> should be used for <code>MainActivity</code>’s layout.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0231-03.png" alt="image" width="471" height="129"/>
<h6/>
</div></figure></li>
<li><p><strong>activity_main.xml includes a FragmentContainerView.</strong></p>
<p>Its <code>android:name</code> attribute specifies that it needs to display <code>WelcomeFragment</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0231-04.png" alt="image" width="451" height="197"/>
<h6/>
</div></figure></li>
<li><p><strong>WelcomeFragment’s onCreateView() method is called, which inflates its layout.</strong></p>
<p><code>WelcomeFragment</code>’s inflated view hierarchy is added to the <code>FragmentContainerView</code> in M<code>ainActivity</code>’s layout.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0231-05.png" alt="image" width="600" height="98"/>
<h6/>
</div></figure></li>
<li><p><strong>Finally, MainActivity is displayed on the device.</strong></p>
<p>As the <code>FragmentContainerView</code> includes <code>WelcomeFragment</code>, this fragment is displayed on the screen.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0232-02.png" alt="image" width="391" height="180"/>
<h6/>
</div></figure></li>
</ol>
<p>Now that you’ve seen what happens when the code runs, let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00080">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the Secret Message app, <code>MainActivity</code> is launched. The <code>FragmentContainerView</code> in <code>MainActivity</code>’s layout includes <code>WelcomeFragment</code>, so the fragment’s layout is displayed on the device.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0232-03.png" alt="image" width="600" height="326"/>
<h6/>
</div></figure>
<p>You’ve now learned how to create and display a fragment. Before we build a second fragment and learn how to navigate to it, have a go at the following exercise.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle"><div class="sect1" id="pool_puzzle-id00081">
<h1>Pool Puzzle</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Pool Puzzle" id="idm46053740635264"/><a data-type="indexterm" data-primary="fragments" data-secondary="linear layout exercise" id="idm46053740633984"/>Your <strong>job</strong> is to take code snippets from the pool and place them into the blank lines in the linear layout. You may <strong>not</strong> use the same code snippet more than once, and you won’t need to use all the snippets. Your <strong>goal</strong> is to make the linear layout display two fragments, <code>AFragment</code> and <code>BFragment</code>, so that it displays the screen shown on the right. Hint: both fragments are in a package named <em>com.hfad.exercise</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0233-01.png" alt="image" width="429" height="547"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0233-02.png" alt="image" width="600" height="557"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Note: each thing from the pool can only be used once!</strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle Solution"><div class="sect1" id="pool_puzzle_solution-id00082">
<h1>Pool Puzzle Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p>Your <strong>job</strong> is to take code snippets from the pool and place them into the blank lines in the linear layout. You may <strong>not</strong> use the same code snippet more than once, and you won’t need to use all the snippets. Your <strong>goal</strong> is to make the linear layout display two fragments, <code>AFragment</code> and <code>BFragment</code>, so that it displays the screen shown on the right. Hint: both fragments are in a package named <em>com.hfad.exercise</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0234-01.png" alt="image" width="288" height="546"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0234-02.png" alt="image" width="600" height="542"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create MessageFragment"><div class="sect1" id="create_messagefragment">
<h1>Create MessageFragment</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0235-01.png" alt="image" width="318" height="61"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="MessageFragment" id="idm46053740610384"/><a data-type="indexterm" data-primary="MessageFragment" id="idm46053740609104"/><a data-type="indexterm" data-primary="Secret Message app" data-secondary="MessageFragment" id="idm46053740608272"/>So far, we’ve created a fragment named <code>WelcomeFragment</code>, which is displayed in <code>MainActivity</code>’s layout. Next, we’ll create a new fragment named <code>MessageFragment</code>, which we’ll navigate to when the user clicks on <code>WelcomeFragmen</code>t’s Start button.</p>
<p>We’ll add <code>MessageFragment</code> in the same way we added <code>WelcomeFragment</code>. Highlight the <em>com.hfad.secretmessage</em> package in the <em>app/src/main/java</em> folder in the project explorer, go to the File menu, and choose New→Fragment→Fragment (Blank). Name the fragment “MessageFragment” and its layout “fragment_message”, and make sure the language is set to Kotlin. Then click on the Finish button to add the fragment and its layout to the project.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0235-02.png" alt="image" width="375" height="214"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0235-03.png" alt="image" width="600" height="409"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update MessageFragment’s layout"><div class="sect1" id="update_messagefragmentapostrophes_layout">
<h1>Update MessageFragment’s layout</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="layouts for" id="idm46053740597776"/>When you create <code>MessageFragment</code>, Android Studio adds two new files to your project: <em>MessageFragment.kt</em> (which specifies the fragment’s behavior), and <em>fragment_message.xml</em> (which defines its appearance). We’ll update both of these files, starting with the layout.</p>
<p>The fragment needs to have an edit text to let the user enter a message, and a button which, later on, will be used for navigation. You’re already familiar with the code to add these views, so update the code in <em>fragment_message.xml</em> so it matches the code shown here:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0236-02.png" alt="image" width="600" height="463"/>
<h6/>
</div></figure>
<p>That’s all the code we need for <code>MessageFragment</code>’s layout, so let’s go and update its Kotlin code.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update MessageFragment.kt"><div class="sect1" id="update_messagefragmentdotkt">
<h1>Update MessageFragment.kt</h1>
<p><code>MessageFragment</code>’s Kotlin code defines the fragment’s behavior. For now, all we need to do is make sure Android Studio hasn’t added any unnecessary extra code to it that might stop it from working in the way we want.</p>
<p>Go to the <em>com.hfad.secretmessage</em> package in the <em>app/src/main/java</em> folder and open the file <em>MessageFragment.kt</em>. Then replace the code that Android Studio has generated with the code below:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0237-02.png" alt="image" width="600" height="358"/>
<h6/>
</div></figure>
<p>The above code is everything that <em>MessageFragment.kt</em> needs to define a basic fragment. Just like the code you saw for <code>WelcomeFragment</code>, it extends the <code>Fragment</code> class, and overrides its <code>onCreateView()</code> method. This method inflates the fragment’s layout, and returns its root view. It gets called whenever the app needs to display the fragment.</p>
<p>We’ve now finished writing all the layout and Kotlin code that <code>MessageFragment</code> needs. Next, we need to make <code>WelcomeFragment</code> navigate to it. So how is this done?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0237-03.png" alt="image" width="298" height="265"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use the Navigation component to navigate between fragments"><div class="sect1" id="use_the_navigation_component_to_navigate">
<h1>Use the Navigation component to navigate between fragments</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="Navigation component" id="idm46053740576752"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="fragments" id="idm46053740575360"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation controller" id="idm46053740574256"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" id="idm46053740573152"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation host" id="idm46053740572048"/>As we said earlier in the chapter, the standard way of navigating between fragments is to use Android’s Navigation component.</p>
<p>The Navigation component is part of Android Jetpack, and it’s a suite of libraries, plug-ins, and tools that you add to your project. It’s extremely flexible, and simplifies many of the complexities of fragment navigation—such as fragment transactions and back stack manipulation—which were previously much harder to implement.</p>
<p>Navigating between fragments is comprised of three main parts:</p>
<ul style="list-style-type:none;">
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>A navigation graph</strong></p>
<p>The navigation graph holds all of the navigation-related information that your app requires, and describes the possible paths the user can take when navigating the app.</p>
<p>The navigation graph is an XML resource, but you usually edit it using a visual design editor.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-02.png" alt="image" width="387" height="303"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>A navigation host</strong></p>
<p>A navigation host is an empty container that’s used to display the fragment you navigate to. You add the navigation host to your activity’s layout.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-03.png" alt="image" width="415" height="174"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/star.png" alt="Images" width="17" height="17"/></span> <strong>A navigation controller</strong></p>
<p>The navigation controller controls which fragment is displayed in the navigation host as the user navigates through the app. You interact with the navigation controller using Kotlin code.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-04.png" alt="image" width="300" height="322"/>
<h6/>
</div></figure></li>
</ul>
<p>We’re going to use all three of these to implement navigation in the Secret Message app. First, let’s add the Navigation component’s library to the project.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Use Gradle to add the Navigation component to your project"><div class="sect1" id="use_gradle_to_add_the_navigation_compone">
<h1>Use Gradle to add the Navigation component to your project</h1>
<p><a data-type="indexterm" data-primary="build.gradle file" id="idm46053740552512"/>As you learned in <a data-type="xref" href="ch04.xhtml#constraint_layoutscolon_draw_up_a_bluepr">Chapter 4</a>, you add any extra libraries, tools, and plug-ins your app needs by making changes to the <em>build.gradle</em> files. When you create a new project, Android Studio automatically includes two of these files for you: one for the project, and another for the app.</p>
<p>To add the Navigation component, you need to edit <em>both</em> versions of <em>build.gradle</em>. Let’s begin by updating the project version.</p>
<section data-type="sect2" data-pdf-bookmark="Add a version number to the project build.gradle file"><div class="sect2" id="add_a_version_number_to_the_project_buil">
<h2>Add a version number to the <u>project</u> build.gradle file</h2>
<p>We’ll begin by adding a new variable to the project’s <em>build.gradle</em> file that specifies which version of the Navigation component we’re going to use. Using a variable for this version number means that if we add any extra Navigation component libraries (which we’ll do in the next chapter), the version number for each library will stay nice and consistent.</p>
<p>To add the variable, open the file <em>SecretMessage/build.gradle</em>, and add the following line (in bold) to the <code>buildscript</code> section:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-02.png" alt="image" width="600" height="111"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="watch_itexclamation_mark-id00083">
<h5><span class="inlineimage"><img src="Images/watch.png" alt="Images" width="89" height="84"/></span> Watch it!</h5>
<p><strong>Always click on the Sync Now option after updating the <em>build.gradle</em> files.</strong></p>
<p><em>Any changes you make (such as adding libraries) don’t come into effect until you sync them.</em></p>
</div></aside>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Add a dependency to the app build.gradle file"><div class="sect2" id="add_a_dependency_to_the_app_builddotgrad">
<h2>Add a dependency to the <u>app</u> build.gradle file</h2>
<p>Next, you need to add a library dependency to the app’s version of the <em>build.gradle</em> file.</p>
<p>Open the file <em>SecretMessage/app/build.gradle</em>, and add the following line (in bold) to the <code>dependencies</code> section:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-03.png" alt="image" width="600" height="190"/>
<h6/>
</div></figure>
<p>Once you’ve made these changes, click on the Sync Now option that appears at the top of the code editor. This syncs the changes you’ve made with the rest of your project, and adds the library.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create a navigation graph"><div class="sect1" id="create_a_navigation_graph">
<h1>Create a navigation graph</h1>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" data-tertiary="creating" id="idm46053740529792"/>Now that we’ve added the Navigation component’s main library to the Secret Message project, we can implement navigation.</p>
<p>We’ll start by adding a navigation graph to the project. Select the <em>SecretMessage/app/src/main/res</em> folder in the project explorer, and then choose File→New→Android Resource File. When prompted, enter a file name of “nav_graph”, choose a resource type of “Navigation”, and click on the OK button. This adds an empty navigation graph file named <em>nav_graph.xml</em> to the <em>SecretMessage/app/src/main/res/navigation</em> folder.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0240-02.png" alt="image" width="497" height="360"/>
<h6/>
</div></figure>
<p>Once you’ve created the new navigation graph, open it (if it’s not open already) by double-clicking on the <em>nav_graph.xml</em> file in the project explorer. The file should open in the navigation graph design editor, which looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0240-03.png" alt="image" width="600" height="358"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add fragments to the navigation graph"><div class="sect1" id="add_fragments_to_the_navigation_graph">
<h1>Add fragments to the navigation graph</h1>
<p><a data-type="indexterm" data-primary="destinations, navigation graph" id="idm46053740519280"/>We want the user to be able to navigate from <code>WelcomeFragment</code> to <code>MessageFragment</code>, so we need to add these fragments to the navigation graph as <strong>destinations</strong>. A destination is a screen in the app—usually a fragment—which the user can navigate to.</p>
<p>We’ll add <code>WelcomeFragment</code> first, as this is the first screen we want the user to see when the app launches. Click on the New Destination button at the top of the design editor, and when prompted, select the option for “fragment_welcome” (<code>WelcomeFragment</code>’s layout). This adds <code>WelcomeFragment</code> to the navigation graph, so it looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0241-02.png" alt="image" width="600" height="285"/>
<h6/>
</div></figure>
<p>Next, add <code>MessageFragment</code> to the navigation graph by clicking on the New Destination button, and selecting the “fragment_message” option. This adds the second fragment to the navigation graph like so:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0241-03.png" alt="image" width="600" height="321"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Connect fragments using an action"><div class="sect1" id="connect_fragments_using_an_action">
<h1>Connect fragments using an action</h1>
<p><a data-type="indexterm" data-primary="actions" data-secondary="connecting fragments with" id="idm46053740508112"/><a data-type="indexterm" data-primary="IDs, action" id="idm46053740506976"/>We next need to specify that the user can navigate from <code>WelcomeFragment</code> to <code>MessageFragment</code>, and this is done with an <strong>action</strong>. Actions are used to connect destinations in the navigation graph, and they define possible paths the user can take when navigating through the app.</p>
<p>We’re going to add an action that goes from <code>WelcomeFragment</code> to <code>MessageFragment</code>, as this is the direction in which we want the user to navigate through the app. Hover your mouse pointer over <code>WelcomeFragment</code> in the design editor, then click on the circle that appears on its right edge, and drag it to <code>MessageFragment</code>. This draws an arrow—the action—between the two fragments:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0242-02.png" alt="image" width="600" height="213"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Every action needs a unique ID"><div class="sect2" id="every_action_needs_a_unique_id">
<h2>Every action needs a unique ID</h2>
<p><strong><em>Every action must have a unique ID. Android uses this ID to determine which destination needs to be displayed as the user navigates through the app.</em></strong></p>
<p>Each time you create an action, Android Studio assigns it a default ID. You can edit this ID—and any other of the action’s properties—using the Attributes panel on the right of the navigation graph.</p>
<p>You want the action you just created to have an ID of “action_welcomeFragment_to_messageFragment” so that it matches the code in this chapter. Make sure this is the case by selecting the action (the arrow) in the design editor, and checking the value of its <code>id</code> attribute in the Attributes panel. You’ll use this ID a few pages ahead.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0242-03.png" alt="image" width="360" height="313"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Navigation graphs are XML resources"><div class="sect1" id="navigation_graphs_are_xml_resources">
<h1>Navigation graphs are XML resources</h1>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" data-tertiary="XML resources" id="idm46053740496944"/>Just like a layout, a navigation graph is really just a bunch of XML code. To view the code, click on the Code button at the top of the design editor.</p>
<p>Here’s the underlying XML code for the Secret Message app’s navigation graph <em>nav_graph.xml</em>:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0243-02.png" alt="image" width="600" height="428"/>
<h6/>
</div></figure>
<p>As you can see, <em>nav_graph.xml</em> has a root element of <code>&lt;navigation&gt;</code>, and contains two <code>&lt;fragment&gt;</code> elements: one for <code>WelcomeFragment</code>, and another for <code>MessageFragment</code>. The <code>&lt;fragment&gt;</code> element for <code>WelcomeFragment</code> includes an extra <code>&lt;action&gt;</code> element, which denotes the action we just added.</p>
<p>Now that we’ve created the navigation graph, let’s move onto the next part of the Navigation component.</p>
<blockquote>
<p><strong>Navigation graphs are usually edited using the design editor, but it can still be useful to check the XML.</strong></p>
</blockquote>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a navigation host to the layout using a FragmentContainerView"><div class="sect1" id="add_a_navigation_host_to_the_layout_usin">
<h1>Add a navigation host to the layout using a FragmentContainerView</h1>
<p><a data-type="indexterm" data-primary="FragmentContainerView" data-secondary="navigation host" id="idm46053740478976"/><a data-type="indexterm" data-primary="NavHostFragment" id="idm46053740477968"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation host" data-tertiary="adding to layout" id="idm46053740477136"/>As we said earlier, the Navigation component is comprised of three main parts: a navigation graph that defines the possible navigation paths, a navigation host that displays destinations, and a navigation controller that controls which destination is displayed. We’ve just created a navigation graph, so the next thing we’ll add is the navigation host.</p>
<p>You add a navigation host by including one in the activity’s layout. The great news is that the Navigation component comes with a built-in one named <code><strong>NavHostFragment</strong></code> so you don’t have to write one yourself. It’s a subclass of <code>Fragment</code> that implements the <code>NavHost</code> interface.</p>
<p>As <code>NavHostFragment</code> is a type of fragment, you add it to a layout file using a <code>FragmentContainerView</code>. The code looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0244-02.png" alt="image" width="378" height="442"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0244-03.png" alt="image" width="600" height="246"/>
<h6/>
</div></figure>
<p>The above code is like the <code>FragmentContainerView</code> code you’ve seen before, but it includes two extra attributes: <code><strong>app:navGraph</strong></code> and <code><strong>app:defaultNavHost</strong></code>.</p>
<p>The <code>app:navGraph</code> attribute tells the navigation host which navigation graph to use, in this case <em>nav_graph.xml</em>. The navigation graph specifies which fragment to display first (its start destination) and lets the user navigate between its destinations.</p>
<p>The <code>app:defaultNavHost</code> attribute lets the navigation host interact with the device back button: you’ll find out more about this in the next chapter.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0244-04.png" alt="image" width="290" height="343"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a NavHostFragment to activity_main.xml"><div class="sect1" id="add_a_navhostfragment_to_activityundersc">
<h1>Add a NavHostFragment to activity_main.xml</h1>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="activity code for" id="idm46053740460000"/>We’re going to add a navigation host to <code>MainActivity</code>’s layout that uses the navigation graph we created. To do this, update the code in <em>activity_main.xml</em> so it includes the changes below (in bold).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0245-02.png" alt="image" width="600" height="342"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We need to navigate between the fragments"><div class="sect2" id="we_need_to_navigate_between_the_fragment">
<h2>We need to navigate between the fragments</h2>
<p>We’ve now created a navigation graph, and linked it to a navigation host that’s held in a <code>FragmentContainerView</code> in <code>MainActivity</code>’s layout. When the app runs, <code>WelcomeFragment</code>—which is the navigation graph’s start destination—will be displayed.</p>
<p>The final thing we need to do in this chapter is navigate from <code>WelcomeFragment</code> to <code>MessageFragment</code> when the user clicks on the Start button in <code>WelcomeFragment</code>’s layout. Let’s find out how this is done.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0245-03.png" alt="image" width="311" height="143"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add an OnClickListener to the button"><div class="sect1" id="add_an_onclicklistener_to_the_button">
<h1>Add an OnClickListener to the button</h1>
<p><a data-type="indexterm" data-primary="click response" data-secondary="Navigation component" id="idm46053740453136"/><a data-type="indexterm" data-primary="findViewById() method" data-secondary="Fragment class’s lack of" id="idm46053740445968"/><a data-type="indexterm" data-primary="Fragment class" id="idm46053740444896"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="OnClickListener for WelcomeFragment" id="idm46053740444064"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" data-secondary="OnClickListener" id="idm46053740442992"/><a data-type="indexterm" data-primary="WelcomeFragment" data-secondary="OnClickListener" id="idm46053740441920"/>To navigate from <code>WelcomeFragment</code> to <code>MessageFragment</code>, we first need to make <code>WelcomeFragment</code>’s Start button respond to clicks. We’ll do this by adding an <code>OnClickListener</code> to it.</p>
<p>Previously, you added <code>OnClickListener</code> to an <em>activity’s</em> button by getting a reference to it with <code>findViewById()</code>, and then calling its <code>setOnClickListener</code> method. You included this code in the activity’s <code>onCreate()</code> method as this is where it first has access to the views in its layout.</p>
<p>When you want to add an <code>OnClickListener</code> to a <em>fragment’s</em> button, however, things are slightly different.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0246-02.png" alt="image" width="179" height="169"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Fragment OnClickListener code is a little different"><div class="sect2" id="fragment_onclicklistener_code_is_a_littl">
<h2><u>Fragment</u> OnClickListener code is a little different</h2>
<p>The first difference is that you add an <code>OnClickListener</code> to a <em>fragment’s</em> button in the fragment’s <code><strong>onCreateView()</strong></code> <strong><em>method, not</em></strong> <code>onCreate()</code>. This is because a fragment first has access to its views in <code>onCreateView()</code>, so it’s the best place to set any <code>OnClickListener</code>s.</p>
<p>The second difference is <strong>the</strong> <code><strong>Fragment</strong></code> <strong>class doesn’t include a</strong> <code><strong>findViewById()</strong></code> <strong>method</strong>, so you can’t directly call it to get a reference to any views. You can, however, call <code>findViewById()</code> on the fragment’s root view instead.</p>
<p>Here’s what the code looks like to add an <code>OnClickListener</code> to a view in fragment code: we’ll add this to <code>WelcomeFragment</code> a couple pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0246-03.png" alt="image" width="303" height="282"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0246-04.png" alt="image" width="600" height="218"/>
<h6/>
</div></figure>
<p>Now that you know how to add an <code>OnClickListener</code> to a fragment’s button, let’s make it navigate when clicked.</p>
<p><strong>The Fragment class isn’t a subclass of Activity.</strong></p>
<p>Even though fragments have a lot in common with activities, the <code>Fragment</code> class doesn’t extend <code>Activity</code> so it doesn’t inherit any of its methods.</p>
<p>Instead, the <code>Fragment</code> class defines its own set of methods. While many of these look identical to the ones that activities inherit, it doesn’t include methods like <code>findViewById()</code>.</p>
<p>You’ll find out more about fragments and their methods as we go through the book. For now, let’s see what code we need to add to <code>WelcomeFragment</code> so that it navigates to <code>MessageFragment</code> when its button gets clicked.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0247-02.png" alt="image" width="582" height="793"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Get a navigation controller"><div class="sect1" id="get_a_navigation_controller">
<h1>Get a navigation controller</h1>
<p><a data-type="indexterm" data-primary="findNavController() method" id="idm46053740409216"/><a data-type="indexterm" data-primary="navigate() method, navigation controller" id="idm46053740407920"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation controller" data-tertiary="findNavController()" id="idm46053740406992"/>Each time you want to navigate to a new fragment, you first need to get a reference to a navigation controller. You do this by calling the <code><strong>findNavController()</strong></code> method on its root <code>View</code> object. The following code, for example, gets a reference to the navigation controller associated with a root view object named <code>view</code>:</p>
<pre data-type="programlisting"><strong>val navController = view.findNavController()</strong></pre>
<section data-type="sect2" data-pdf-bookmark="Tell it where to navigate with an action"><div class="sect2" id="tell_it_where_to_navigate_with_an_action">
<h2>Tell it where to navigate with an action</h2>
<p>Once you have a navigation controller, you ask it to navigate to a new destination by calling its <code><strong>navigate()</strong></code> method. This method takes one parameter: a navigation action ID.</p>
<p>As you may recall, when we created the navigation graph, we included an action that went from <code>WelcomeFragment</code> to <code>MessageFragment</code>. We gave this action the ID “action_welcomeFragment_to_messageFragment”.</p>
<p>If we pass this ID to the navigation controller’s <code>navigate()</code> method, the controller will see that the action goes from <code>WelcomeFragment</code> to <code>MessageFragment</code>, and use it to navigate to the new fragment.</p>
<p>Here’s what the code looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0248-02.png" alt="image" width="342" height="551"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0248-03.png" alt="image" width="600" height="79"/>
<h6/>
</div></figure>
<p>We want to navigate to <code>MessageFragment</code> when the user clicks on <code>WelcomeFragment</code>’s Start button. We’ll therefore add this code to the Start button’s <code>OnClickListener</code> like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0248-04.png" alt="image" width="600" height="155"/>
<h6/>
</div></figure>
<p>We’ll show you the full <code>WelcomeFragment</code> code on the next page.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for WelcomeFragment.kt"><div class="sect1" id="the_full_code_for_welcomefragmentdotkt">
<h1>The full code for WelcomeFragment.kt</h1>
<p><a data-type="indexterm" data-primary="fragments" data-secondary="code for" id="idm46053740386496"/><a data-type="indexterm" data-primary="WelcomeFragment" data-secondary="activity code for" id="idm46053740384896"/>Below is the complete code for <code>WelcomeFragment</code>; update <em>WelcomeFragment.kt</em> so it includes the changes (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0249-02.png" alt="image" width="600" height="424"/>
<h6/>
</div></figure>
<p>That’s all the code we need to make <code>WelcomeFragment</code> navigate to <code>MessageFragment</code>. Let’s go through what the code does when it runs, and then take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs-id00084">
<h1>What happens when the app runs</h1>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="running app with" id="idm46053740379632"/>The following things happen when the app runs:</p>
<ol>
<li><p><strong>The app is launched and MainActivity gets created.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0250-02.png" alt="image" width="331" height="167"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity’s layout, activity_main.xml, includes a FragmentContainerView that specifies a navigation host and a navigation graph.</strong></p><figure class="informal"><div class="figure">
<img src="Images/f0250-03.png" alt="image" width="433" height="251"/>
<h6/>
</div></figure></li>
<li><p><strong>The start destination in the navigation graph is WelcomeFragment, so this fragment is added to the navigation host and displayed on the device screen.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0250-04.png" alt="image" width="532" height="153"/>
<h6/>
</div></figure></li>
<li><p><strong>The user clicks on the Start button in WelcomeFragment’s layout.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0250-05.png" alt="image" width="364" height="169"/>
<h6/>
</div></figure></li>
<li><p><strong>The code for the Start button’s OnClickListener finds the navigation controller, and calls its navigate() method.</strong></p>
<p>It passes it the action used to navigate from <code>WelcomeFragment</code> to <code>MessageFragment</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0251-02.png" alt="image" width="555" height="191"/>
<h6/>
</div></figure></li>
<li><p><strong>The navigation controller looks for the action with this ID in the navigation graph.</strong></p>
<p>It sees that the action goes from <code>WelcomeFragment</code> to <code>MessageFragment</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0251-03.png" alt="image" width="600" height="193"/>
<h6/>
</div></figure></li>
<li><p><strong>The navigation controller replaces WelcomeFragment with MessageFragment in the navigation host, and MessageFragment is displayed on the device screen.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0251-04.png" alt="image" width="600" height="194"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00085">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>MainActivity</code> is launched, and <code>WelcomeFragment</code> is displayed as before.</p>
<p>When we click on the Start button, the app navigates to <code>MessageFragment</code>, and this fragment is displayed on the device.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0252-02.png" alt="image" width="600" height="389"/>
<h6/>
</div></figure>
<p>Congratulations! You’ve now learned how to build a multi-screen app that lets you navigate from one screen to another.</p>
<p>You’ll build on this knowledge in the next chapter when we finish building the Secret Message app.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00086">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: I tried creating a navigation graph before editing the <em>build.gradle</em> files, and Android Studio offered to add the Navigation component library for me. Why are we adding the libraries manually?</strong></p>
<p><strong>A:</strong> It’s so you can see what libraries are needed, and how to include them, without relying on Android Studio.</p>
<p>Another reason is we know the code in this book works with the library version we’ve specified in the <em>build.gradle</em> files. Android Studio may include a different version, which might break the code.</p>
<p><strong>Q: Do I have to implement navigation using the Navigation component?</strong></p>
<p><strong>A:</strong> Strictly speaking, no, but it’s far more complicated if you don’t. Before the Navigation component was introduced, navigating between screens required a <em>lot</em> more code.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00087">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil</h5>
<p>The diagram below shows part of the navigation graph for a music app. It describes two navigation paths: one that goes from <code>ChooseMusicFragment</code> to <code>FoundFragment</code>, and another that goes from <code>ChooseMusicFragment</code> to <code>NotFoundFragment</code>.</p>
<p>Complete <code>ChooseMusicFragment</code>’s <code>onCreateView()</code> method so that if the <code>musicFound()</code> method returns <em>true</em>, the app displays <code>FoundFragment</code>, and if the method returns <em>false</em>, the app displays <code>NotFoundFragment</code> instead.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0253-01.png" alt="image" width="600" height="577"/>
<h6/>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil_solution-id00088">
<h5><span class="inlineimage"><img src="Images/pencil.png" alt="Images" width="149" height="65"/></span> Sharpen your pencil Solution</h5>
<p>The diagram below shows part of the navigation graph for a music app. It describes two navigation paths: one that goes from <code>ChooseMusicFragment</code> to <code>FoundFragment</code>, and another that goes from <code>ChooseMusicFragment</code> to <code>NotFoundFragment</code>.</p>
<p>Complete <code>ChooseMusicFragment</code>’s <code>onCreateView()</code> method so that if the <code>musicFound()</code> method returns <em>true</em>, the app displays <code>FoundFragment</code>, and if the method returns <em>false</em>, the app displays <code>NotFoundFragment</code> instead.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-01.png" alt="image" width="600" height="524"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00089">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#fragments_and_navigationcolon_finding_yo">Chapter 6</a> under your belt and now you’ve added fragments and navigation to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0255-01.png" alt="image" width="233" height="211"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00090">
<h5>Bullet Points</h5>
<ul>
<li><p>A fragment has Kotlin code and a layout.</p></li>
<li><p>Every fragment extends the <code>Fragment</code> class or one of its subclasses.</p></li>
<li><p>Add a fragment to an activity’s layout using a <code>FragmentContainerView</code>.</p></li>
<li><p><code>onCreateView()</code> gets called each time Android needs the fragment’s layout.</p></li>
<li><p>The <code>Fragment</code> class doesn’t extend <code>Activity</code>.</p></li>
<li><p>Fragments don’t have a <code>findViewById()</code> method.</p></li>
<li><p>The Navigation component is a suite of libraries, plug-ins, and tools which you add to your project using Gradle.</p></li>
<li><p>A navigation graph describes possible destinations and navigation paths. It uses actions to describe these paths.</p></li>
<li><p>A navigation host is an empty container used to display the fragment you navigate to. The Navigation component comes with a default navigation host named <code>NavHostFragment</code>, which extends the <code>Fragment</code> class and implements the <code>NavHost</code> interface.</p></li>
<li><p>A navigation controller uses actions to control which fragment is displayed in the navigation host.</p></li>
</ul>
</div></aside>
</div></section>
</div></section></div></body></html>