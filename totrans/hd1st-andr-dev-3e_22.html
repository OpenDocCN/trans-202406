<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 19. Integrating Compose with views: Perfect Harmony"><div class="chapter" id="integrating_compose_with_viewscolon_perf">
<h1><span class="label">Chapter 19. </span>Integrating Compose with views: <em>Perfect Harmony</em></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0811-01.png" alt="image" width="600" height="341"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composables" data-secondary="adding to view-based UI" id="idm46053732826544"/><a data-type="indexterm" data-primary="Compose" data-secondary="using with views" id="idm46053732825360"/><strong>You get the best results when things work together.</strong></p>
<p>So far, you’ve learned how to build a UI using views or composables. But what if you want to use <strong>both</strong>? In this chapter, you’ll find out how to get <strong>the best of both worlds</strong> by <strong>adding composables to a View-based UI</strong>. You’ll discover techniques for making <strong>composables work with view models</strong>. You’ll even find out how to make them <strong>respond to <em>LiveData</em> updates</strong>. By the end of the chapter, you’ll have all the tools you need to <strong>use composables with views</strong>, or even <strong>migrate to a pure Compose UI</strong>.</p>
<section data-type="sect1" data-pdf-bookmark="You can add composables to View-based UIs"><div class="sect1" id="you_can_add_composables_to_view-based_ui">
<h1>You can add composables to View-based UIs</h1>
<p><a data-type="indexterm" data-primary="Guessing Game app" data-secondary="composables instead of views for" id="idm46053732816944"/><a data-type="indexterm" data-primary="Guessing Game app" data-secondary="structure" id="idm46053732815488"/>In the previous chapter, you learned how to implement a Compose UI by building a brand new Temperature Converter app. Instead of adding views to a layout file, you created the UI by calling composables in the activity’s Kotlin code.</p>
<p>There are times, however, when you might want to use views <em>and</em> composables in the same UI. This may be because you want to use components that are only available as views or composables, for example, or you want to migrate parts of your app to Compose.</p>
<p>The great news is that you can add composables to a UI that’s defined in a layout file. We’ll show you how this is done by taking the Guessing Game app we created earlier in the book, and migrating it to Compose.</p>
<section data-type="sect2" data-pdf-bookmark="The Guessing Game app revisited"><div class="sect2" id="the_guessing_game_app_revisited-id00308">
<h2>The Guessing Game app revisited</h2>
<p>As we’re sure you remember, the Guessing Game app lets the user guess which letters are included in a secret word. She wins the game if she guesses all the letters, and loses if she runs out of lives.</p>
<p>Here’s what the game currently looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0812-01.png" alt="image" width="600" height="280"/>
<h6/>
</div></figure>
<p>Before we start replacing the app’s views with composables, let’s quickly review how the app is constructed.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Guessing Game app structure"><div class="sect1" id="the_guessing_game_app_structure">
<h1>The Guessing Game app structure</h1>
<p>The Guessing Game app uses two fragments for its UI: <code>GameFragment</code> and <code>ResultFragment</code>.</p>
<p><code>GameFragment</code> is the app’s main screen, which the user interacts with to play the game. It displays information—such as the number of lives left and any incorrect guesses the user has made—and lets the user make guesses. It also includes a button that, when clicked, lets the user immediately finish the game without making any more guesses.</p>
<p><code>ResultFragment</code> is displayed when the game is over. It shows the user if she has won or lost the game, along with the secret word.</p>
<p>The app also include two view models—<code>GameViewModel</code> and <code>ResultViewModel</code>—which hold the app’s game logic and data, and maintain its state when the app is rotated. <code>GameFragment</code> uses <code>GameViewModel</code>, and <code>ResultFragment</code> uses <code>ResultViewModel</code>:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0813-01.png" alt="image" width="600" height="430"/>
<h6/>
</div></figure>
<p>Let’s run through the steps we’ll take to update the app.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s what we’re going to do"><div class="sect1" id="hereapostrophes_what_weapostroph-id00309">
<h1>Here’s what we’re going to do</h1>
<p>We’re going to replace the Guessing Game app’s views with composables in two main steps:</p>
<ol>
<li><p><strong>Replace ResultFragment’s views with composables.</strong></p>
<p>We’ll add the Compose libraries to the app’s <em>build.gradle</em> files, and then add composables to <code>ResultFragment</code>’s layout to replicate the current views. When we’re satisfied that the composables do what we want, we’ll remove the views from its UI.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0814-01.png" alt="image" width="600" height="227"/>
<h6/>
</div></figure></li>
<li><p><strong>Replace GameFragment’s views with composables.</strong></p>
<p>We’ll then go through a similar process for <code>GameFragment</code>. We’ll add composables to its layout to reproduce its current views, and when we’re certain that they work in the way we want, we’ll remove the views from its UI.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0814-02.png" alt="image" width="541" height="340"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s start by adding the Compose libraries to the app’s <em>build.gradle</em> files.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0814-03.png" alt="image" width="327" height="311"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Update the project build.gradle file…"><div class="sect1" id="update_the_project_builddotgradl-id00310">
<h1>Update the <u>project</u> build.gradle file…</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0815-01.png" alt="image" width="284" height="60"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Compose" data-secondary="libraries for" id="idm46053732780896"/>We’ll first add a new variable to the project’s <em>build.gradle</em> file to specify which version of Compose we’ll use. Open the file <em>GuessingGame/build.gradle</em>, and add the line below (in bold) to the <code>buildscript</code> section:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0815-02.png" alt="image" width="600" height="95"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="…and update the app build.gradle file, too"><div class="sect2" id="hellipand_update_the_app_builddo-id00311">
<h2>…and update the <u>app</u> build.gradle file, too</h2>
<p>In the app’s <em>build.gradle</em> file, we need to add a bunch of Compose options and libraries, and make sure the minimum SDK is 21. Open the file <em>GuessingGame/app/build.gradle</em>, and add the following lines (in bold) to the appropriate sections:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0815-03.png" alt="image" width="600" height="393"/>
<h6/>
</div></figure>
<p>Once you’ve made these changes, click on the Sync Now option.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ll replace ResultFragment’s views with composables"><div class="sect1" id="weapostrophell_replace_resultfragmentapo">
<h1>We’ll replace ResultFragment’s views with composables</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0816-01.png" alt="image" width="284" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composables" data-secondary="Text" id="idm46053732765632"/><a data-type="indexterm" data-primary="ResultFragment" data-secondary="composables instead of views" id="idm46053732764336"/><a data-type="indexterm" data-primary="Text composable" data-secondary="replacing TextView with" id="idm46053732763264"/><a data-type="indexterm" data-primary="TextView" data-secondary="replacing with Text composable" id="idm46053732762160"/>Now that we’ve updated the <em>build.gradle</em> files to include Compose, we can start replacing the app’s views with composables. We’ll begin with <code>ResultFragment</code>, as this is the simplest fragment.</p>
<p>As you may recall, <code>ResultFragment</code>’s layout includes a <code>TextView</code> to display the game’s result, and a <code>Button</code> to let the user start a new game. It looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0816-02.png" alt="image" width="600" height="504"/>
<h6/>
</div></figure>
<p>We can replace these views with composables by using a <code>Text</code> composable instead of the <code>TextView</code>, and a <code>Button</code> composable instead of the <code>Button</code> view. This is what the new UI will look like:</p>
<p>We’ll build the new UI bit by bit so that at first, <code>ResultFragment</code> will use both views and composables. Let’s begin by finding out how to add composables to a layout file.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="A ComposeView lets you add composables to a layout"><div class="sect1" id="a_composeview_lets_you_add_composables_t">
<h1>A ComposeView lets you add composables to a layout</h1>
<p><a data-type="indexterm" data-primary="composables" data-secondary="adding to layouts" id="idm46053732751168"/><a data-type="indexterm" data-primary="ComposeView" id="idm46053732749712"/><a data-type="indexterm" data-primary="layouts" data-secondary="adding composables to" id="idm46053732748880"/>If you want to add composables to a <code>View</code>-based UI, you can do so by adding a <code><strong>ComposeView</strong></code> element to the layout file. This is a type of view that can display composables, and the code looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0817-01.png" alt="image" width="600" height="73"/>
<h6/>
</div></figure>
<p>You can think of a <code>ComposeView</code> as a type of view that acts as a placeholder for any composables you want to add to the UI in your Kotlin code. When the app runs, it displays the layout’s views, and populates the <code>ComposeView</code> with composables.</p>
<blockquote>
<p><strong>A ComposeView is a View that acts as a placeholder for composables. It lets you use Compose in a View-based UI.</strong></p>
</blockquote>
<section data-type="sect2" data-pdf-bookmark="We’ll add a ComposeView to fragment_result.xml"><div class="sect2" id="weapostrophell_add_a_composeview_to_frag">
<h2>We’ll add a ComposeView to fragment_result.xml</h2>
<p>We want to add <code>Text</code> and <code>Button</code> composables to <code>ResultFragment</code>’s UI, so we need to add a <code>ComposeView</code> to its layout file.</p>
<p>Here’s the updated code for <em>fragment_result.xml</em>; update the file to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0817-02.png" alt="image" width="600" height="305"/>
<h6/>
</div></figure>
<p>Now that we’ve added the <code>ComposeView</code>, let’s add some composables to it.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add composables using Kotlin code"><div class="sect1" id="add_composables_using_kotlin_code">
<h1>Add composables using Kotlin code</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0818-01.png" alt="image" width="284" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composables" data-secondary="Text" id="idm46053732732048"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" data-secondary="with composables" id="idm46053732730576"/><a data-type="indexterm" data-primary="setContent() function" data-secondary="ComposeView" id="idm46053732729504"/><a data-type="indexterm" data-primary="Text composable" data-secondary="replacing TextView with" id="idm46053732728400"/>Once the layout includes a <code>ComposeView</code>, you can add composables to it in the fragment’s <code>onCreateView()</code> method using code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0818-02.png" alt="image" width="600" height="190"/>
<h6/>
</div></figure>
<p>The code calls <code>setContent()</code> on the layout’s <code>ComposeView</code>, which tells it what composables it needs to include. It then applies this to the fragment’s inflated layout. If you wanted to add a <code>Text</code> composable to <code>ResultFragment</code>’s layout, for example, you’d use the code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0818-03.png" alt="image" width="600" height="292"/>
<h6/>
</div></figure>
<p>Running this code would display the <code>Text</code> composable in the layout’s <code>ComposeView</code> like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0818-04.png" alt="image" width="600" height="166"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a composable function for the fragment’s content"><div class="sect1" id="add_a_composable_function_for_the_fragme">
<h1>Add a composable function for the fragment’s content</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0819-01.png" alt="image" width="284" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composable functions" data-secondary="replicating views" id="idm46053732712256"/><a data-type="indexterm" data-primary="ResultFragmentContent composable function" id="idm46053732710960"/>Now that you’ve learned how to add composables to a <code>ComposeView</code>, let’s use the one we’ve added to <em>fragment_result.xml</em> to replicate its existing views.</p>
<p>We’ll begin by adding a new composable function to <em>ResultFragment.kt</em> named <code>ResultFragmentContent</code>, which we’ll use for the fragment’s UI. We’ll call it from <code>setContent()</code> so that any composables we add to it will run when <code>ResultFragment</code> gets displayed.</p>
<p>Here’s what the new code looks like; we’ll add it to <em>ResultFragment.kt</em> a few pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0819-02.png" alt="image" width="600" height="494"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reproduce the Start New Game button"><div class="sect1" id="reproduce_the_start_new_game_button">
<h1>Reproduce the Start New Game button</h1>
<p><a data-type="indexterm" data-primary="Button view" data-secondary="replacing view with composable" id="idm46053732703072"/><a data-type="indexterm" data-primary="NewGameButton composable function" id="idm46053732701696"/>Now that we’ve added the <code>ResultFragmentContent</code> composable function to <em>ResultFragment.kt</em>, we can use it to add composables to the UI. We’ll begin by adding a button.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0820-01.png" alt="image" width="304" height="148"/>
<h6/>
</div></figure>
<p><code>ResultFragment</code> currently includes a button <code>View</code> labeled “Start new game” that uses the following <code>OnClickListener</code> to navigate to <code>GameFragment</code> when clicked:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0820-02.png" alt="image" width="600" height="78"/>
<h6/>
</div></figure>
<p>We can reproduce the button in Compose by creating a new composable function named <code>NewGameButton</code> that we’ll run from <code>ResultFragmentContent</code>. We’ll add a lambda argument to <code>NewGameButton</code> so that <code>ResultFragmentContent</code> can tell it what to do when it’s clicked.</p>
<p>Here’s what the new code looks like; we’ll add it to <em>ResultFragment.kt</em> a couple pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0820-03.png" alt="image" width="600" height="305"/>
<h6/>
</div></figure>
<p>That’s the button sorted. What about the layout’s text?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reproduce ResultFragment’s TextView"><div class="sect1" id="reproduce_resultfragmentapostrophes_text">
<h1>Reproduce ResultFragment’s TextView</h1>
<p><a data-type="indexterm" data-primary="composables" data-secondary="Text" id="idm46053732688464"/><a data-type="indexterm" data-primary="ResultText composable function" id="idm46053732685280"/><a data-type="indexterm" data-primary="Text composable" data-secondary="replacing TextView with" id="idm46053732684480"/><a data-type="indexterm" data-primary="TextView" data-secondary="replacing with Text composable" id="idm46053732683376"/>As you may recall, <code>ResultFragment</code> uses a <code>TextView</code> in its layout to display the game’s result. It’s defined using this code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0821-02.png" alt="image" width="600" height="154"/>
<h6/>
</div></figure>
<p>Instead of using a <code>TextView</code> to display the text, we can define a new <code>ResultText</code> composable function that displays the text in a <code>Text</code> composable. We’ll add a <code>String</code> argument to <code>ResultText</code> that <code>ResultFragmentContent</code> will use to pass it the text.</p>
<p>Here’s the new code; we’ll add it to <em>ResultFragment.kt</em> on the next page:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0821-03.png" alt="image" width="600" height="340"/>
<h6/>
</div></figure>
<p>That’s all the code that we need to reproduce all of <code>ResultFragment</code>’s views with composables. Let’s see what the code looks like.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The updated code for ResultFragment.kt"><div class="sect1" id="the_updated_code_for_resultfragm-id00312">
<h1>The updated code for ResultFragment.kt</h1>
<p>Here’s the updated code for <em>ResultFragment.kt</em>; update the file to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0822-02.png" alt="image" width="600" height="602"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0823-02.png" alt="image" width="600" height="652"/>
<h6/>
</div></figure>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00313">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>GameFragment</code> is displayed. When we click on its Finish Game button, it navigates to <code>ResultFragment</code>.</p>
<p><code>ResultFragment</code> displays the original views, and the composables we just added. The <code>Text</code> composable displays the correct text, and the <code>Button</code> composable navigates to <code>GameFragment</code> when it’s clicked.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0824-02.png" alt="image" width="600" height="327"/>
<h6/>
</div></figure>
<p>The composables we added to <code>ResultFragment</code> work exactly how we want them to, so the next thing we’ll do is remove the views.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00314">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: So <code>ResultFragment</code>’s views and composables are both using the same view model. Is that right?</strong></p>
<p><strong>A:</strong> Yes. The view model has a property for the game’s result, and the <code>TextView</code> and <code>Text</code> composable both refer to it.</p>
<p><strong>Q: Do composables usually use a view model?</strong></p>
<p><strong>A:</strong> They often do, yes. Just like with a <code>View</code>-based UI, view models provide a useful way of managing the state of any composables so they don’t get reset when the user rotates the screen.</p>
<p><strong>Q: You’re passing a view model to <code>ResultFragmentContent</code> as an argument. Can’t the function just get a reference to the view model?</strong></p>
<p><strong>A:</strong> Composable functions can get a reference to a view model using the <code>viewModel()</code> function, but at the time of writing, the Compose library it’s in isn’t stable. You can find out more about this—and other features—in the appendix.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We need to remove ResultFragment’s views…"><div class="sect1" id="we_need_to_remove_resultfragmentapostrop">
<h1>We need to remove ResultFragment’s views…</h1>
<p><a data-type="indexterm" data-primary="layouts" data-secondary="removing" id="idm46053732645632"/><a data-type="indexterm" data-primary="onCreateView() method, fragments" data-secondary="with composables" id="idm46053732643872"/><a data-type="indexterm" data-primary="ResultFragment" data-secondary="removing views" id="idm46053732642736"/><a data-type="indexterm" data-primary="view binding" data-secondary="stopping for code with composables" id="idm46053732641632"/><a data-type="indexterm" data-primary="views" data-secondary="removing from Guessing Game app" id="idm46053732640560"/>You can remove a fragment or activity’s views in a couple ways:</p>
<ol>
<li><p><strong>By removing any views you don’t need from the layout file</strong></p>
<p>This approach is useful if the UI contains a mix of views and composables.</p></li>
<li><p><strong>By removing the entire layout file</strong></p>
<p>If the UI <em>only</em> includes composables, you can delete the layout file, and remove any references to it in the activity or fragment’s Kotlin code.</p></li>
</ol>
<p>In the Guessing Game app, we’ve reproduced all of <code>ResultFragment</code>’s views with composables, so we no longer need any of its original views. This means that we can delete its layout file <em>fragment_result.xml</em> so that the UI only includes composables.</p>
<section data-type="sect2" data-pdf-bookmark="…and update ResultFragment.kt"><div class="sect2" id="hellipand_update_resultfragmentdotkt">
<h2>…and update ResultFragment.kt</h2>
<p>Before we delete the layout file, we first need to remove any references to its views from <em>ResultFragment.kt</em>, and stop using view binding.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#9D9EA0;">View binding gives your activity and fragment code an easier way to access a layout file’s views. As we’re removing ResultFragment’s layout file, it no longer needs to use view binding.</span></p>
</div>
<p>We also need to tweak the fragment’s <code>onCreateView()</code> method so that instead of inflating a layout file, it adds the composables to the fragment’s UI.</p>
<p>As you learned in <a data-type="xref" href="ch18.xhtml#jetpack_composecolon_compose_yourself">Chapter 18</a>, you can do this with an <em>activity</em> by simply calling <code>setContent()</code> from its <code>onCreate()</code> method like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0825-03.png" alt="image" width="600" height="174"/>
<h6/>
</div></figure>
<p>When you’re dealing with a fragment, however, you need a slightly different approach. To find out what this is and why, let’s revisit the fragment’s <code>onCreateView()</code> method.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="onCreateView() returns the UI’s root view"><div class="sect1" id="oncreateviewleft_parenthesisright_parent">
<h1>onCreateView() returns the UI’s root view</h1>
<p><a data-type="indexterm" data-primary="ComposeView" id="idm46053732621472"/>As you know, a fragment’s <code>onCreateView()</code> method gets called when an activity needs to display the fragment’s UI.</p>
<p>When the UI is defined with a layout file, code in the <code>onCreateView()</code> method inflates the layout into a hierarchy of views, and returns the root view. The root view gets added to the activity’s layout, which displays the fragment’s UI.</p>
<p>But what if there’s no layout file?</p>
<section data-type="sect2" data-pdf-bookmark="Return a ComposeView for Compose UIs"><div class="sect2" id="return_a_composeview_for_compose_uis">
<h2>Return a ComposeView for Compose UIs</h2>
<p>If the fragment’s UI is just made up of composables and has no layout file, <strong>the</strong> <code><strong>onCreateView()</strong></code> <strong>method must still return a</strong> <code><strong>View?</strong></code><strong>, or the code won’t compile</strong>.</p>
<p>You deal with this by making the method return a <code>ComposeView</code> that includes all of the UI’s composables. Here’s what the code for this looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0826-02.png" alt="image" width="600" height="243"/>
<h6/>
</div></figure>
<p>When the activity needs to display the fragment’s UI, it calls the fragment’s <code>onCreateView()</code> method as before. The method returns a <code>ComposeView</code> that includes the fragment’s composables, which are then displayed by the activity.</p>
<p>That’s everything you need to know to complete the code for <em>ResultFragment.kt</em>. We’ll show you the full code over the next few pages.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The full code for ResultFragment.kt"><div class="sect1" id="the_full_code_for_resultfragment-id00315">
<h1>The full code for ResultFragment.kt</h1>
<p><a data-type="indexterm" data-primary="ResultFragment" data-secondary="code for" id="idm46053732613536"/>Here’s the complete code for <em>ResultFragment.kt</em>; update the file to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0827-02.png" alt="image" width="600" height="645"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0828-02.png" alt="image" width="600" height="634"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0829-02.png" alt="image" width="600" height="322"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="We can delete fragment_result.xml"><div class="sect2" id="we_can_delete_fragmentunderscoreresultdo">
<h2>We can delete fragment_result.xml</h2>
<p><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" data-tertiary="XML resources" id="idm46053732598464"/>Now that <code>ResultFragment</code> is no longer using its layout file, we’ll remove any references to <em>fragment_result.xml</em> from the navigation graph, and delete the layout file.</p>
<p>First, open <em>nav_graph.xml</em> in the <em>app/src/main/res/navigation</em> folder, and remove the reference to <code>"@layout/fragment_result"</code> from the <code>ResultFragment</code> section like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0829-03.png" alt="image" width="600" height="185"/>
<h6/>
</div></figure>
<p>Then right-click on <em>fragment_result.xml</em> in the explorer, choose Refactor, and then select the Safe Delete option. When you click on the OK button and choose the option to do the refactor, the file is deleted.</p>
<p>Let’s go through what happens when we run the app.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What happens when the app runs"><div class="sect1" id="what_happens_when_the_app_runs-id00316">
<h1>What happens when the app runs</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0830-01.png" alt="image" width="285" height="59"/>
<h6/>
</div></figure>
<p>The following things happen when the app runs:</p>
<ol>
<li><p><strong>MainActivity launches and displays GameFragment in its layout.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0830-02.png" alt="image" width="595" height="186"/>
<h6/>
</div></figure></li>
<li><p><strong>When the user clicks on the Finish Game button, or wins or loses the game, the app navigates to ResultFragment and calls its onCreateView() method.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0830-03.png" alt="image" width="477" height="133"/>
<h6/>
</div></figure></li>
<li><p><strong>The onCreateView() method creates a ComposeView.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0830-04.png" alt="image" width="484" height="125"/>
<h6/>
</div></figure></li>
<li><p><strong>The onCreateView() method sets the ComposeView’s content to ResultFragmentContent.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0830-05.png" alt="image" width="490" height="119"/>
<h6/>
</div></figure></li>
<li><p><strong>When ResultFragmentContent runs, it calls the ResultText and NewGameButton composables.</strong></p>
<p>The composables are added to the <code>ComposeView</code>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0831-02.png" alt="image" width="600" height="151"/>
<h6/>
</div></figure></li>
<li><p><strong>The onCreateView() method returns the ComposeView to MainActivity.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0831-03.png" alt="image" width="600" height="151"/>
<h6/>
</div></figure></li>
<li><p><strong>MainActivity displays the ComposeView in its layout.</strong></p>
<p>The <code>ComposeView</code>’s composables are displayed on the device.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0831-04.png" alt="image" width="427" height="186"/>
<h6/>
</div></figure></li>
</ol>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00317">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app and click on <code>GameFragment</code>’s Finish Game button, it navigates to <code>ResultFragment</code> as before. This time, however, the UI is just made up of composables.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0832-02.png" alt="image" width="600" height="574"/>
<h6/>
</div></figure>
<p>That’s everything we need to make <code>ResultFragment</code> use a Compose UI. Before we get to work on <code>GameFragment</code>, have a go at the exercise on the next page.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00318">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: You said that a <code>ComposeView</code> is a type of <code>View</code> you can add composables to. Is there a type of composable you can add <code>View</code>s to?</strong></p>
<p><strong>A:</strong> Great question! Yes, you can use an <code>AndroidView</code>, which is a type of composable that returns a <code>View</code>. It’s useful if you have a Compose UI, and you want to add a component to it that’s only available as a <code>View</code>, and not as a composable.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle"><div class="sect1" id="pool_puzzle-id00319">
<h1>Pool Puzzle</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composables" data-secondary="adding to view-based UI" id="idm46053732548224"/><a data-type="indexterm" data-primary="exercises" data-secondary="Pool Puzzle" id="idm46053732546944"/>Your <strong>job</strong> is to take code snippets from the pool and place them into the blank lines in the code below. You may <strong>not</strong> use the same snippet more than once, and you won’t need to use all the snippets. Your <strong>goal</strong> is to write the code for a fragment named <code>MusicFragment</code> that has no layout file and uses a composable function named <code>MusicFragmentContent</code> for its UI. A theme named <code>MusicTheme</code> needs to be applied to the UI, including any surfaces.</p>
<pre data-type="programlisting">class MusicFragment : Fragment() {
    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?
    ): View? {
        return ............................................................
            ...............................................................
                 ..........................................................
                    .......................................................
                        MusicFragmentContent()
                    }
                }
            }
        }
    }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0833-01.png" alt="image" width="600" height="269"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong>Note: each thing from the pool can only be used once!</strong></p>
</div>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="101" height="9"/></span> <strong>Answers in <a data-type="xref" href="#pool_puzzle_solution-id00328">“Pool Puzzle Solution”</a>.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Next we’ll make GameFragment use composables too"><div class="sect1" id="next_weapostrophell_make_gamefragment_us">
<h1>Next we’ll make GameFragment use composables too</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0834-01.png" alt="image" width="285" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="ComposeView" id="idm46053732531008"/><a data-type="indexterm" data-primary="GameFragment" data-secondary="composables instead of views" id="idm46053732530080"/>Now that we’ve made <code>ResultFragment</code> use composables instead of views, we can do a similar thing for <code>GameFragment</code>.</p>
<p>As you may recall, <code>GameFragment</code>’s layout includes <code>TextView</code>s, <code>Button</code>s, and an <code>EditText</code> to let the user play the guessing game. Here’s a reminder of what it looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0834-02.png" alt="image" width="600" height="332"/>
<h6/>
</div></figure>
<p>Over the next few pages, we’re going to replace these views with composables. Here’s what the new UI will look like when we’ve finished:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0834-03.png" alt="image" width="581" height="353"/>
<h6/>
</div></figure>
<p>As before, we’ll begin by adding new composables to <code>GameFragment</code>’s UI, which means we need to add a <code>ComposeView</code> to its layout. We’ll show you the code for this on the next page.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ll add a ComposeView to fragment_game.xml"><div class="sect1" id="weapostrophell_add_a_composeview-id00320">
<h1>We’ll add a ComposeView to fragment_game.xml</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0835-01.png" alt="image" width="285" height="61"/>
<h6/>
</div></figure>
<p>Here’s the code to add a <code>ComposeView</code> to <code>GameFragment</code>’s layout; update the file <em>fragment_game.xml</em> to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0835-02.png" alt="image" width="600" height="517"/>
<h6/>
</div></figure>
<p>Now that we’ve updated the layout file, let’s start adding composables to it.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Add a composable function for GameFragment’s content"><div class="sect1" id="add_a_composable_function_for_gamefragme">
<h1>Add a composable function for GameFragment’s content</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0836-01.png" alt="image" width="284" height="58"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composable functions" data-secondary="GameFragmentContent" id="idm46053732508336"/><a data-type="indexterm" data-primary="GameFragmentContent composable function" id="idm46053732507136"/>Just as we did with <em>ResultFragment.kt</em>, we’ll add a new composable function to <em>GameFragment.kt</em> that we’ll use for the fragment’s UI. We’ll name the function <code>GameFragmentContent</code>, and call it from <code>setContent()</code> so that any composables we add to it will run when <code>GameFragment</code> gets displayed.</p>
<p>Here’s what the new code looks like; we’ll add it to <em>GameFragment.kt</em> a few pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0836-02.png" alt="image" width="600" height="525"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reproduce the Finish Game button"><div class="sect1" id="reproduce_the_finish_game_button">
<h1>Reproduce the Finish Game button</h1>
<p><a data-type="indexterm" data-primary="FinishGameButton composable function" id="idm46053732500512"/><a data-type="indexterm" data-primary="finishGame() method, GameViewModel" id="idm46053732499408"/><a data-type="indexterm" data-primary="GameFragmentContent composable function" id="idm46053732498608"/>Just as we did with <code>ResultFragment</code>, we’ll add composables to the <code>GameFragmentContent</code> composable function so that they’re displayed in <code>GameFragment</code>’s UI. We’ll begin by reproducing the Finish Game button.</p>
<p>The Finish Game button is defined using the following code in the fragment’s layout:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0837-02.png" alt="image" width="600" height="208"/>
<h6/>
</div></figure>
<p>As you can see, when the button is clicked, it calls <code>GameViewModel</code>’s <code>finishGame()</code> method.</p>
<p>We can reproduce this in Compose by creating a new composable function named <code>FinishGameButton</code> that we’ll run from <code>GameFragmentContent</code>. Here’s what the new code looks like; we’ll add it to <em>GameFragment.kt</em> a few pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0837-03.png" alt="image" width="600" height="286"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reproduce the EditText with a TextField"><div class="sect1" id="reproduce_the_edittext_with_a_textfield">
<h1>Reproduce the EditText with a TextField</h1>
<p><a data-type="indexterm" data-primary="composables" data-secondary="TextField" id="idm46053732486864"/><a data-type="indexterm" data-primary="converter composables" data-secondary="TextField" id="idm46053732485456"/><a data-type="indexterm" data-primary="EditText, LinearLayout" id="idm46053732484352"/><a data-type="indexterm" data-primary="EnterGuess composable function" id="idm46053732483520"/><a data-type="indexterm" data-primary="guess, MutableState" id="idm46053732482720"/><a data-type="indexterm" data-primary="MutableState object" id="idm46053732481888"/><a data-type="indexterm" data-primary="TextField composable" data-secondary="EnterGuess function" id="idm46053732481056"/>The next view we’ll reproduce is the <code>EditText</code> that lets the user enter a letter. We’ll create a new composable function named <code>EnterGuess</code> that uses a <code>TextField</code>, and accepts two arguments: a <code>String</code> for the user’s guess, and a lambda that specifies what should happen when the value changes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0838-02.png" alt="image" width="388" height="103"/>
<h6/>
</div></figure>
<p>We’ll run the <code>EnterGuess</code> function from <code>GameFragmentContent</code> so that it’s added to the fragment’s UI. We’ll also add a <code>MutableState</code> object named <code>guess</code> to <code>GameFragmentContent,</code> which we’ll use to manage the <code>TextField</code>’s state.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0838-03.png" alt="image" width="420" height="105"/>
<h6/>
</div></figure>
<p>Here’s what the new code looks like; we’ll add it to <em>GameFragment.kt</em> a couple pages ahead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0838-04.png" alt="image" width="600" height="460"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reproduce the Guess button"><div class="sect1" id="reproduce_the_guess_button">
<h1>Reproduce the Guess button</h1>
<p><a data-type="indexterm" data-primary="Button composable" id="idm46053732466416"/><a data-type="indexterm" data-primary="composables" data-secondary="Button" id="idm46053732465296"/><a data-type="indexterm" data-primary="converter composables" data-secondary="Button" id="idm46053732464192"/><a data-type="indexterm" data-primary="GameFragmentContent composable function" id="idm46053732463088"/><a data-type="indexterm" data-primary="GuessButton composable function" id="idm46053732462288"/><a data-type="indexterm" data-primary="makeGuess() method" data-secondary="view model" id="idm46053732461488"/>Now that we’ve added a <code>TextField</code> to the UI that lets the user enter a letter, we’ll add a <code>Button</code> composable that passes the letter to the view model’s <code>makeGuess()</code> method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0839-02.png" alt="image" width="321" height="149"/>
<h6/>
</div></figure>
<p>We’ll add the <code>Button</code> using a new composable function named <code>GuessButton</code> that we’ll run from <code>GameFragmentContent</code>. Here’s what the new code looks like; we’ll add it to <em>GameFragment.kt</em> on the next page:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0839-03.png" alt="image" width="600" height="570"/>
<h6/>
</div></figure>
<p>We’ve now reproduced three of <code>GameFragment</code>’s views with composables. Before we tackle the remaining ones, let’s update <em>GameFragment.kt</em> and take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The updated code for GameFragment.kt"><div class="sect1" id="the_updated_code_for_gamefragmen-id00321">
<h1>The updated code for GameFragment.kt</h1>
<p>Here’s the code so far for <em>GameFragment.kt</em>; update the file to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0840-02.png" alt="image" width="600" height="632"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0841-02.png" alt="image" width="600" height="670"/>
<h6/>
</div></figure>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00322">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>GameFragment</code> is displayed. It includes all its original views, along with three extra composables that let us make guesses and finish the game.</p>
<p>When we use the <code>EnterGuess</code> and <code>GuessButton</code> composables to guess which letters the secret word contains, the app registers each guess. If we make a correct guess, the letter is added to the secret word display, and if we make a wrong guess, the number of lives left is updated and the letter is added to the list of incorrect guesses.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0842-02.png" alt="image" width="600" height="538"/>
<h6/>
</div></figure>
<p>Now that we know the three composables we’ve added work, let’s tackle the remaining ones.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ll display the incorrect guesses in a Text composable"><div class="sect1" id="weapostrophell_display_the_incorrect_gue">
<h1>We’ll display the incorrect guesses in a Text composable</h1>
<p><a data-type="indexterm" data-primary="incorrectGuesses property, GameViewModel" id="idm46053732433888"/><a data-type="indexterm" data-primary="observeAsState() function, State object" id="idm46053732432992"/><a data-type="indexterm" data-primary="State objects, composables and live data" id="idm46053732432160"/><a data-type="indexterm" data-primary="TextView" data-secondary="replacing with Text composable" id="idm46053732431296"/>The next view we’ll reproduce is a <code>TextView</code> that uses live data to display the user’s incorrect guesses. Each time the user makes a wrong guess, it gets added to the <code>incorrectGuesses</code> property in the view model, and the <code>TextView</code> responds by updating the text it displays.</p>
<p>Here’s a reminder of the <code>TextView</code>’s code:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0843-02.png" alt="image" width="600" height="337"/>
<h6/>
</div></figure>
<p>We can replace the <code>TextView</code> with a <code>Text</code> composable so that it displays the same text, but how do we make sure the text gets updated when the <code>incorrectGuesses</code> property value changes?</p>
<section data-type="sect2" data-pdf-bookmark="Respond to LiveData using observeAsState()"><div class="sect2" id="respond_to_livedata_using_observeasstate">
<h2>Respond to LiveData using observeAsState()</h2>
<p>As you learned in <a data-type="xref" href="ch18.xhtml#jetpack_composecolon_compose_yourself">Chapter 18</a>, composables are recomposed when any <code>State</code> or <code>MutableState</code> objects they depend on get new values. This <em>doesn’t</em> happen, however, for <code>LiveData</code> objects—like the view model’s <code>incorrectGuesses</code> property. If you try to use a <code>LivaData</code> object’s value with a composable, it won’t get redrawn when its value changes; it will just keep using the object’s initial value, so it won’t stay up-to-date.</p>
<p>If you want to make a composable respond to <code>LiveData</code> updates, you can do so using the <code><strong>observeAsState()</strong></code> function. This function returns a <code>State</code> version of a <code>LiveData</code> object so that any composables that depend on it are recomposed when its value changes.</p>
<p>You use the <code>observeAsState()</code> function with code like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0843-04.png" alt="image" width="600" height="182"/>
<h6/>
</div></figure>
<p>This defines a variable (whose type is <code>State</code>) that observes the view model’s <code>incorrectGuesses LiveData</code> property. It means that when its value changes, composables can respond.</p>
<p>Let’s put this into practice by reproducing <code>GameFragment</code>’s incorrect guesses <code>TextView</code> in Compose.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Create an IncorrectGuessesText composable function"><div class="sect1" id="create_an_incorrectguessestext_composabl">
<h1>Create an IncorrectGuessesText composable function</h1>
<p><a data-type="indexterm" data-primary="GameFragmentContent composable function" id="idm46053732408080"/><a data-type="indexterm" data-primary="GameViewModel" data-secondary="incorrectGuessesText composable function" id="idm46053732407088"/><a data-type="indexterm" data-primary="IncorrectGuessesText composable function" id="idm46053732406016"/><a data-type="indexterm" data-primary="stringResource() function, Text composable" id="idm46053732405216"/>To reproduce the incorrect guesses <code>TextView</code>, we’ll define a new composable function named <code>IncorrectGuessesText</code>. The function will accept a <code>GameViewModel</code> argument, observe its <code>incorrectGuesses</code> property, and use a <code>Text</code> composable to display its value in the UI. Each time the property’s value gets updated, the <code>Text</code> will be recomposed and display the updated text.</p>
<p>Here’s what the <code>IncorrectGuessesText</code> function looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0844-02.png" alt="image" width="600" height="198"/>
<h6/>
</div></figure>
<p>As you can see, the <code>Text</code> composable in the above code uses a function named <code>stringResource()</code> to set its text. This function lets you use <code>String</code> resources with composables, and pass arguments to them.</p>
<section data-type="sect2" data-pdf-bookmark="Run IncorrectGuessesText from GameFragmentContent"><div class="sect2" id="run_incorrectguessestext_from_gamefragme">
<h2>Run IncorrectGuessesText from GameFragmentContent</h2>
<p>Just like the other composable functions we’ve created, we’ll add <code>IncorrectGuessesText</code> to <code>GameFragment</code>’s UI by running it from the <code>GameFragmentContent</code> composable function. The new code looks like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0844-03.png" alt="image" width="290" height="280"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0844-04.png" alt="image" width="597" height="233"/>
<h6/>
</div></figure>
<p>We’ll update <em>GameFragment.kt</em> a few pages ahead. First, see if you can piece together the code for the remaining two composables by having a go at the following exercise.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Compose Magnets"><div class="sect1" id="compose_magnets-id00323">
<h1>Compose Magnets</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="composable functions" data-secondary="exercises" id="idm46053732385984"/><a data-type="indexterm" data-primary="exercises" data-secondary="Magnets" id="idm46053732384704"/>Someone used fridge magnets to create two new composable functions (named <code>SecretWordDisplay</code> and <code>LivesLeftText</code>) that reproduce <code>GameFragment</code>’s two remaining views. Unfortunately some of the magnets fell off when someone unleashed the kitchen kraken. Can you piece the code back together again?</p>
<p>The <code>SecretWordDisplay</code> function needs to display the <code>secretWordDisplay LiveData&lt;String&gt;</code> property from <code>GameViewModel</code>. The <code>LivesLeftText</code> function needs to display the <code>lives_left String</code> resource, and pass it <code>GameViewModel</code>’s <code>livesLeft LiveData&lt;Int&gt;</code> property. Both functions need to be able to respond to live data updates.</p>
<pre data-type="programlisting">@Composable
fun SecretWordDisplay(viewModel: GameViewModel) {

    val display = viewModel.secretWordDisplay..............................

    display..............................{

        Text(.......................................)
    }
}

@Composable
fun LivesLeftText(viewModel: GameViewModel) {..............................

    val livesLeft = viewModel.livesLeft

    livesLeft..............................{

        Text(.....................................................................)

    }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0845-01.png" alt="image" width="600" height="115"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Compose Magnets Solution"><div class="sect1" id="compose_magnets_solution-id00324">
<h1>Compose Magnets Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common02.png" alt="image" width="86" height="144"/>
<h6/>
</div></figure>
<p>Someone used fridge magnets to create two new composable functions (named <code>SecretWordDisplay</code> and <code>LivesLeftText</code>) that reproduce <code>GameFragment</code>’s two remaining views. Unfortunately some of the magnets fell off when someone unleashed the kitchen kraken. Can you piece the code back together again?</p>
<p>The <code>SecretWordDisplay</code> function needs to display the <code>secretWordDisplay LiveData&lt;String&gt;</code> property from <code>GameViewModel</code>. The <code>LivesLeftText</code> function needs to display the <code>lives_left String</code> resource, and pass it <code>GameViewModel</code>’s <code>livesLeft LiveData&lt;Int&gt;</code> property. Both functions need to be able to respond to live data updates.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0846-01.png" alt="image" width="600" height="552"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The updated code for GameFragment.kt"><div class="sect1" id="the_updated_code_for_gamefragmen-id00325">
<h1>The updated code for GameFragment.kt</h1>
<p><a data-type="indexterm" data-primary="GameFragment" data-secondary="code for" id="idm46053732366496"/>You now know how to reproduce all of <code>GameFragment</code>’s views with composables, so let’s add them to <em>GameFragment.kt</em>. Update the file to include the changes below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0847-02.png" alt="image" width="600" height="610"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0848-02.png" alt="image" width="600" height="720"/>
<h6/>
</div></figure>
<p>Let’s take the app for a test drive.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00326">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>GameFragment</code> includes all its original views, and their Compose equivalents.</p>
<p>When we try to guess which letters the secret word contains, the text in the <code>SecretWordDisplay</code>, <code>LivesLeftText</code>, and <code>IncorrectGuessesText</code> composables is automatically updated.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0849-02.png" alt="image" width="600" height="538"/>
<h6/>
</div></figure>
<p>We’ve now made sure that all of <code>GameFragment</code>’s composables work just the way we want. All that’s left is for us to remove the fragment’s views.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Remove views from GameFragment.kt"><div class="sect1" id="remove_views_from_gamefragmentdotkt">
<h1>Remove views from GameFragment.kt</h1>
<p><a data-type="indexterm" data-primary="GameFragment" data-secondary="removing views" id="idm46053732347536"/><a data-type="indexterm" data-primary="views" data-secondary="removing from Guessing Game app" id="idm46053732344496"/>Just as we did with <code>ResultFragment</code>, we’ll remove <code>GameFragment</code>’s views by deleting its layout file. Before we can do this, however, we need to remove any references to the views from <em>GameFragment.kt</em>. We’ll also stop using data binding, as this is no longer needed.</p>
<p>Here’s the full code for the file; update <em>GameFragment.kt</em> to include all the changes shown below (in bold):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0850-02.png" alt="image" width="600" height="505"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0851-02.png" alt="image" width="600" height="629"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0852-02.png" alt="image" width="600" height="668"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0853-02.png" alt="image" width="600" height="635"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0854-02.png" alt="image" width="600" height="482"/>
<h6/>
</div></figure>
<p>Those are all the changes we need to make to <em>GameFragment.kt</em> so that it doesn’t inflate its layout or reference any of its views.</p>
<p>As the fragment no longer needs to have a layout file, we can go ahead and delete it after we’ve removed any references to it from the navigation graph. We’ll do this on the next page.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Delete fragment_game.xml"><div class="sect1" id="delete_fragmentunderscoregamedotxml">
<h1>Delete fragment_game.xml</h1>
<p><a data-type="indexterm" data-primary="data binding" data-secondary="switching off" id="idm46053732328208"/><a data-type="indexterm" data-primary="Navigation component" data-secondary="navigation graph" data-tertiary="XML resources" id="idm46053732326816"/>The navigation graph includes a reference to the layout file <em>fragment_game.xml</em>. We need to remove this before we can remove the layout file.</p>
<p>Open <em>nav_graph.xml</em> in the <em>app/src/main/res/navigation</em> folder, and remove the line that references <code>"@layout/fragment_game"</code> from the <code>GameFragment</code> section like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0855-02.png" alt="image" width="600" height="203"/>
<h6/>
</div></figure>
<p>Then right-click on <em>fragment_game.xml</em> in the explorer, choose Refactor, and select the Safe Delete option. When you click on the OK button and choose the option to do the refactor, the file is deleted.</p>
<section data-type="sect2" data-pdf-bookmark="We can also switch off data binding"><div class="sect2" id="we_can_also_switch_off_data_binding">
<h2>We can also switch off data binding</h2>
<p>One final change we can make to the Guessing Game app is to disable data binding. As you may recall, we originally enabled data binding so that views in <em>fragment_game.xml</em> and <em>fragment_result.xml</em> could interact with each fragment’s view model. Now that we’ve deleted the layout files, data binding is no longer required.</p>
<p>To switch off data binding, open the file <em>GuessingGame/app/build.gradle</em>, and remove the data binding line from the <code>buildFeatures</code> section like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0855-03.png" alt="image" width="521" height="173"/>
<h6/>
</div></figure>
<p>When you’ve done this, click on the Sync Now option to sync the change with the rest of the project.</p>
<p>Let’s take the app for a final test drive.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark=" Test Drive"><div class="sect1" id="test_drive-id00327">
<h1><span class="inlineimage"><img src="Images/car.png" alt="Images" width="119" height="58"/></span> Test Drive</h1>
<p>When we run the app, <code>GameFragment</code> is displayed. This time, its UI is just made up of composables. They work exactly how we want them to.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0856-02.png" alt="image" width="600" height="539"/>
<h6/>
</div></figure>
<p>Congratulations! You’ve now learned how to add composables to an existing <code>View</code>-based UI, and even replace your UI with one that just uses Compose.</p>
<p>We think Compose has a bright future ahead of it, and you can find out more about it in the appendix. In the meantime, why not try adding composables to some of the other apps you’ve built in this book?</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Pool Puzzle Solution"><div class="sect1" id="pool_puzzle_solution-id00328">
<h1>Pool Puzzle Solution</h1>
<figure class="informal"><div class="figure">
<img src="Images/common01.png" alt="image" width="148" height="160"/>
<h6/>
</div></figure>
<p>Your <strong>job</strong> is to take code snippets from the pool and place them into the blank lines in the code below. You may <strong>not</strong> use the same snippet more than once, and you won’t need to use all the snippets. Your <strong>goal</strong> is to write the code for a fragment named <code>MusicFragment</code> that has no layout file and uses a composable function named <code>MusicFragmentContent</code> for its UI. A theme named <code>MusicTheme</code> needs to be applied to the UI, including any surfaces.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0857-01.png" alt="image" width="600" height="276"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0857-02.png" alt="image" width="600" height="268"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your Android Toolbox"><div class="sect1" id="your_android_toolbox-id00329">
<h1>Your Android Toolbox</h1>
<figure class="informal"><div class="figure">
<img src="Images/tools.png" alt="image" width="182" height="129"/>
<h6/>
</div></figure>
<p><strong>You’ve got <a data-type="xref" href="#integrating_compose_with_viewscolon_perf">Chapter 19</a> under your belt and now you’ve added integrating Jetpack Compose to your toolbox.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0858-01.png" alt="image" width="233" height="210"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00330">
<h5>Bullet Points</h5>
<ul>
<li><p>Apps can include a mix of <code>View</code> and Compose UIs.</p></li>
<li><p>Compose can be used in existing apps so long as the minimum SDK is 21, and the language is Kotlin.</p></li>
<li><p>Before you can use Compose in an existing <code>View</code>-based UI, you need to add Compose options and libraries to the <em>build.gradle</em> files.</p></li>
<li><p>A <code>ComposeView</code> is a <code>View</code> you can add composables to. You can think of it as a placeholder for any composables you want to add to your layout file.</p></li>
<li><p>Composables can interact with a view model’s properties and methods.</p></li>
<li><p>Use <code>observeAsState()</code> to make composables respond to <code>LiveData</code> updates.</p></li>
<li><p>Once you’ve replaced an activity or fragment’s views with composables, you can remove its layout file.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Leaving town"><div class="sect1" id="leaving_town">
<h1>Leaving town</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0859-01.png" alt="image" width="600" height="507"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="It’s been great having you here in Androidville"><div class="sect1" id="itapostrophes_been_great_having_you_here">
<h1>It’s been great having you here in Androidville</h1>
<p><strong>We’re sad to see you leave,</strong> but there’s nothing like taking what you’ve learned and putting it to good use. There are still a few more gems for you in the back of the book and a handy index to study, and then it’s time to take all these new ideas and put them into practice. Bon voyage!</p>
</div></section>
</div></section></div></body></html>