<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Working with Strings"><div class="chapter" id="nch-strings"><h1><span class="label">Chapter 7. </span>Working with Strings</h1><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820373631456"><h5>A note for Early Release readers</h5><p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p></div></aside><section data-type="sect1" data-pdf-bookmark="7.0 Introduction"><div class="sect1" id="nch-strings-strings-intro"><h1>7.0 Introduction</h1><p>Like most types of data, string values can be compared for equality or inequality or
    relative ordering. However, strings have additional properties to
    consider:</p><ul><li><p>A string can be binary or nonbinary. Binary strings are used for
        raw data such as images, music files, or encrypted values. Nonbinary
        strings are used for character data such as text and are associated
        with a character set and collation (sort order).</p></li><li><p>A character set determines
            which characters are legal in a string. You can choose
        collations according to whether you need comparisons to be case
        sensitive or case insensitive, or to use the rules of a particular
        language.</p></li><li><p>Data types for binary strings are <code>BINARY</code>, <code>VARBINARY</code>, and <code>BLOB</code>. Data types for nonbinary strings are <code>CHAR</code>, <code>VARCHAR</code>, and <code>TEXT</code>, each of which permits <code>CHARACTER</code>
        <code>SET</code> and <code>COLLATE</code> attributes.</p></li><li><p>You can convert a binary string to a nonbinary string and vice versa, or
        convert a nonbinary string from one character set or collation to
        another.</p></li><li><p>You can use a string in its entirety or extract substrings from
        it. Strings can be combined with other strings.</p></li><li><p>You can apply pattern-matching operations to strings.</p></li><li><p>Full-text searching is available for efficient queries on large
        collections of text.</p></li></ul><p>This chapter discusses how to use those properties, so that you can
    store, retrieve, and manipulate strings according to any requirements your
    applications have.</p><p>Scripts to create the tables used in this chapter are located in the
    <em class="filename">tables</em> directory of the <code>recipes</code> distribution.</p></div></section><section data-type="sect1" data-pdf-bookmark="7.1 String Properties"><div class="sect1" id="nch-strings-strings-properties"><h1>7.1 String Properties</h1><p>One string property is whether it is binary or nonbinary:</p><ul><li><p>A binary string is a sequence of bytes. It can contain any type of
        information, such as images, MP3 files, or compressed or encrypted
        data. A binary string is not associated with a character set, even if
        you store a value such as <code>abc</code> that
        looks like ordinary text. Binary strings are compared byte by byte
        using numeric byte values.</p></li><li><p>A nonbinary string is a sequence of characters. It stores text that has a
        particular character set and collation. The character set defines which
        characters can be stored in the string. The collation defines the
        character ordering, which affects comparison and sorting
        operations.</p></li></ul><p>To see which character sets are available for nonbinary strings, use this statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SHOW CHARACTER SET;</code></strong>
+----------+-----------------------------+---------------------+--------+
| Charset  | Description                 | Default collation   | Maxlen |
+----------+-----------------------------+---------------------+--------+
| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |
…
| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |
| latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |
| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |
…
| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |
| utf8mb4  | UTF-8 Unicode               | utf8mb4_0900_ai_ci  |      4 |
…</pre><p>The default character set in MySQL 8.0 is <code>utf8mb4</code> with collation of <code>utf8mb4_0900_ai_ci</code>. 
      If you  must store characters from several languages in a single column, consider
    using one of the Unicode character sets (such as <code>utf8mb4</code> or <code>utf16</code>) because they can represent characters from
    multiple languages.</p><p>Some character sets contain only single-byte characters, whereas
    others permit multibyte characters. Some multibyte character sets contain
    characters of varying lengths. For others, all characters have a fixed
    length. For example, Unicode data can be stored using the <code>utf8mb4</code> character set in which characters take from
    one to four bytes or the <code>utf16</code>
    character set in which all characters take two bytes.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>In MySQL, to use the full set of
      Unicode characters, including supplemental characters that lie outside
      the Basic Multilingual Plane (BMP), use <code>utf8mb4</code>, in which
      characters take from one to four bytes. Other Unicode character sets
      that include supplemental characters are <code>utf16</code>, <code>utf16le</code>, and <code>utf32</code>.</p></div><p>To determine whether a given string contains multibyte characters,
    use the <code>LENGTH()</code> and <code>CHAR_LENGTH()</code> functions, which return the length
    of a string in bytes and characters, respectively. If <code>LENGTH()</code> is greater than <code>CHAR_LENGTH()</code> for a given string, multibyte characters are present:</p><ul><li><p>The <code>utf8</code> Unicode character
        set has multibyte characters, but a given <code>utf8</code> string might contain only single-byte
        characters, as in the following example:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s = CONVERT('abc' USING utf8mb4);</code></strong>
mysql&gt; <strong><code>SELECT LENGTH(@s), CHAR_LENGTH(@s);</code></strong>
+------------+-----------------+
| LENGTH(@s) | CHAR_LENGTH(@s) |
+------------+-----------------+
|          3 |               3 |
+------------+-----------------+</pre></li><li><p>For the <code>utf16</code> Unicode
        character set, all characters are encoded using two bytes, even if
        they are single-byte characters in another character set such as
        <code>latin1</code>. Thus, every <code>utf16</code> string contains multibyte
        characters:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s = CONVERT('abc' USING utf16);</code></strong>
mysql&gt; <strong><code>SELECT LENGTH(@s), CHAR_LENGTH(@s);</code></strong>
+------------+-----------------+
| LENGTH(@s) | CHAR_LENGTH(@s) |
+------------+-----------------+
|          6 |               3 |
+------------+-----------------+</pre></li></ul><p>Another property of nonbinary strings is collation, which determines
    the sort order of characters in the character set. Use <code>SHOW</code> <code>COLLATION</code> to see all available collations; add a <code>LIKE</code> clause to see the collations for a
    particular character set:</p><pre data-type="programlisting">mysql&gt; <strong><code>SHOW COLLATION LIKE 'utf8mb4%';</code></strong>
+----------------------------+---------+-----+---------+----------+---------+---------------+
| Collation                  | Charset | Id  | Default | Compiled | Sortlen | Pad_attribute |
+----------------------------+---------+-----+---------+----------+---------+---------------+
| utf8mb4_0900_ai_ci         | utf8mb4 | 255 | Yes     | Yes      |       0 | NO PAD        |
| utf8mb4_0900_as_ci         | utf8mb4 | 305 |         | Yes      |       0 | NO PAD        |
..
| utf8mb4_es_0900_ai_ci      | utf8mb4 | 263 |         | Yes      |       0 | NO PAD        |
| utf8mb4_es_0900_as_cs      | utf8mb4 | 286 |         | Yes      |       0 | NO PAD        |
| utf8mb4_es_trad_0900_ai_ci | utf8mb4 | 270 |         | Yes      |       0 | NO PAD        |
| utf8mb4_es_trad_0900_as_cs | utf8mb4 | 293 |         | Yes      |       0 | NO PAD        |
..
| utf8mb4_tr_0900_ai_ci      | utf8mb4 | 265 |         | Yes      |       0 | NO PAD        |
| utf8mb4_tr_0900_as_cs      | utf8mb4 | 288 |         | Yes      |       0 | NO PAD        |
| utf8mb4_turkish_ci         | utf8mb4 | 233 |         | Yes      |       8 | PAD SPACE     |
| utf8mb4_unicode_520_ci     | utf8mb4 | 246 |         | Yes      |       8 | PAD SPACE     |</pre><p>In contexts where no collation is specified explicitly, strings in a
    given character set use the collation with <code>Yes</code> in the <code>Default</code> column. As shown, the default collation
    for <code>utf8mb4</code> is <code>utf8mb4_0900_ai_ci</code>. (Default collations are also
    displayed by <code>SHOW</code> <code>CHARACTER</code> <code>SET</code>.)</p><p>A collation can be case sensitive (<code>a</code> and
    <code>A</code> are different), case insensitive
    (<code>a</code> and <code>A</code> are the same), or binary (two characters are
    the same or different based on whether their numeric values are equal). A
    collation name ending in <code>_ci</code>, <code>_cs</code>, or <code>_bin</code>
    is case insensitive, case sensitive, or binary, respectively.</p><p>Binary strings and binary collations both use numeric
    values. The difference is that binary string comparisons are always based
    on single-byte units, whereas a binary collation compares nonbinary
    strings using <em>character</em> numeric values; depending on
    the character set, some of these might be multibyte values.</p><p>The following example illustrates how collation affects sort order.
    Suppose that a table contains a <code>utf8mb4</code>
    string column and has the following rows:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE t (c CHAR(3) CHARACTER SET utf8mb4);</code></strong>
mysql&gt; <strong><code>INSERT INTO t (c) VALUES('AAA'),('bbb'),('aaa'),('BBB');</code></strong>
mysql&gt; <strong><code>SELECT c FROM t;</code></strong>
+------+
| c    |
+------+
| AAA  |
| bbb  |
| aaa  |
| BBB  |
+------+</pre><p>By applying the <code>COLLATE</code> operator
    to the column, you can choose which collation to use for
    sorting and thus affect the order of the result:</p><ul><li><p>A case-insensitive collation sorts <code>a</code> and <code>A</code>
        together, placing them before <code>b</code> and
        <code>B</code>. However, for a given letter, it
        does not necessarily order one lettercase before another, as shown by
        the following result:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT c FROM t ORDER BY c COLLATE utf8mb4_turkish_ci;</code></strong>
+------+
| c    |
+------+
| AAA  |
| aaa  |
| bbb  |
| BBB  |
+------+</pre></li><li><p>A case-sensitive collation puts <code>A</code> and <code>a</code>
        before <code>B</code> and <code>b</code>, and sorts lowercase before
        uppercase:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT c FROM t ORDER BY c COLLATE utf8mb4_tr_0900_as_cs;</code></strong>
+------+
| c    |
+------+
| aaa  |
| AAA  |
| bbb  |
| BBB  |
+------+</pre></li><li><p>A binary collation sorts characters using their numeric values. Assuming that
        uppercase letters have numeric values less than those of lowercase
        letters, a binary collation results in the following ordering:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT c FROM t ORDER BY c COLLATE utf8mb4_bin;</code></strong>
+------+
| c    |
+------+
| AAA  |
| BBB  |
| aaa  |
| bbb  |
+------+</pre><p>Note that because characters in different lettercases have different numeric values, a binary
        collation produces a case-sensitive ordering. However, the order
        differs from that for the case-sensitive collation.</p></li></ul><p>If you require that comparison and sorting operations use the
    sorting rules of a particular language, choose a language-specific
    collation. For example, if you store strings using the <code>utf8mb4</code> character set, the default collation
    (<code>utf8mb4_0900_ai_ci</code>) treats <code>ch</code> and <code>ll</code> as
    two-character strings. To use the traditional Spanish ordering that treats
    <code>ch</code> and <code>ll</code> as single characters that follow <code>c</code> and <code>l</code>,
    respectively, specify the <code>utf8mb4_spanish2_ci</code> collation. The two collations
    produce different results, as shown here:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE t (c CHAR(2) CHARACTER SET utf8mb4);</code></strong>
mysql&gt; <strong><code>INSERT INTO t (c) VALUES('cg'),('ch'),('ci'),('lk'),('ll'),('lm');</code></strong>
mysql&gt; <strong><code>SELECT c FROM t ORDER BY c COLLATE utf8mb4_general_ci;</code></strong>
+------+
| c    |
+------+
| cg   |
| ch   |
| ci   |
| lk   |
| ll   |
| lm   |
+------+
mysql&gt; <strong><code>SELECT c FROM t ORDER BY c COLLATE utf8mb4_spanish2_ci;</code></strong>
+------+
| c    |
+------+
| cg   |
| ci   |
| ch   |
| lk   |
| lm   |
| ll   |
+------+</pre><p>Ideally set the collation in the column definition in case you are not using the default collation by following;
    </p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE t (c CHAR(2) CHARACTER SET utf8mb4 COLLATE utf8mb4_spanish2_ci);</code></strong></pre><p>
    This will make sure to avoid possible query performance degradation during sort operations by using wrong collation.
   </p></div></section><section data-type="sect1" data-pdf-bookmark="7.2 Choosing a String Data Type"><div class="sect1" id="nch-strings-strings-types"><h1>7.2 Choosing a String Data Type</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373545328"><h2>Problem</h2><p>You want to store string data but aren’t sure which data type is the most appropriate.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373544176"><h2>Solution</h2><p>Choose the data type according to the characteristics of the
      information to be stored and how you need to use it. Consider questions
      such as these:</p><ul><li><p>Are the strings binary or nonbinary?</p></li><li><p>Does case sensitivity matter?</p></li><li><p>What is the maximum string length?</p></li><li><p>Do you want to store fixed- or variable-length values?</p></li><li><p>Do you need to retain trailing spaces?</p></li><li><p>Is there a fixed set of permitted values?</p></li></ul></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373540224"><h2>Discussion</h2><p>MySQL provides several binary and nonbinary string data types. These types come
      in pairs as shown in the following table. The maximum length is in
      bytes, whether the type is binary or nonbinary. For nonbinary types, the
      maximum number of <em>characters</em> is less for strings
      that contain multibyte characters as we show in the <a data-type="xref" href="#nch-strings-strings-types-lenghts">Table 7-1</a></p><table id="nch-strings-strings-types-lenghts"><caption><span class="label">Table 7-1. </span>Maximum Number of Characters per Data Type</caption><thead><tr><th>Binary data type</th><th>Nonbinary data type</th><th>Maximum length</th></tr></thead><tbody><tr><td><code>BINARY </code></td><td><code>CHAR </code></td><td>255</td></tr><tr><td><code>VARBINARY </code></td><td><code>VARCHAR </code></td><td>65,535</td></tr><tr><td><code>TINYBLOB </code></td><td><code>TINYTEXT </code></td><td>255</td></tr><tr><td><code>BLOB </code></td><td><code>TEXT </code></td><td>65,535</td></tr><tr><td><code>MEDIUMBLOB </code></td><td><code>MEDIUMTEXT </code></td><td>16,777,215</td></tr><tr><td><code>LONGBLOB </code></td><td><code>LONGTEXT </code></td><td>4,294,967,295</td></tr></tbody></table><p>For the <code>BINARY</code> and <code>CHAR</code> data types, MySQL stores column values using a fixed width. For
      example, values stored in a <code>BINARY(10)</code> or <code>CHAR(10)</code> column always take 10 bytes or 10
      characters, respectively. Shorter values are padded to the required
      length as necessary when stored. For <code>BINARY</code>, the pad value is <code>0x00</code> (the zero-valued byte, also known as
      ASCII NUL). <code>CHAR</code> values are
      padded with spaces for storage and trailing spaces are stripped upon
      retrieval.</p><p>For <code>VARBINARY</code>, <code>VARCHAR</code>, and the <code>BLOB</code> and <code>TEXT</code> types, MySQL stores values using only as much storage as
      required, up to the maximum column length. No padding is added or
      stripped when values are stored or retrieved.</p><p>To preserve trailing pad values that are present in the original
      strings that are stored, use a data type for which no stripping occurs.
      For example, if you store character (nonbinary) strings that might end
      with spaces, and want to preserve them, use <code>VARCHAR</code> or one of the <code>TEXT</code> data types. The following statements
      illustrate the difference in trailing-space handling for <code>CHAR</code> and <code>VARCHAR</code> columns:</p><pre data-type="programlisting">mysql&gt; <strong><code>DROP TABLE IF EXISTS t;</code></strong>
mysql&gt; <strong><code>CREATE TABLE t (c1 CHAR(10), c2 VARCHAR(10));</code></strong>
mysql&gt; <strong><code>INSERT INTO t (c1,c2) VALUES('abc       ','abc       ');</code></strong>
mysql&gt; <strong><code>SELECT c1, c2, CHAR_LENGTH(c1), CHAR_LENGTH(c2) FROM t;</code></strong>
+------+------------+-----------------+-----------------+
| c1   | c2         | CHAR_LENGTH(c1) | CHAR_LENGTH(c2) |
+------+------------+-----------------+-----------------+
| abc  | abc        |               3 |              10 |
+------+------------+-----------------+-----------------+</pre><p>This shows that if you store a string that contains trailing
      spaces into a <code>CHAR</code> column, they’re
      removed when you retrieve the value.</p><p>A table can include a mix of binary and nonbinary string columns,
      and its nonbinary columns can use different character sets and
      collations. When you declare a nonbinary string column, use the <code>CHARACTER</code> <code>SET</code> and <code>COLLATE</code> attributes if you require a particular
      character set and collation. For example, if you need to store <code>utf8mb4</code> (Unicode)
      and <code>sjis</code> (Japanese) strings, you
      might define a table with two columns like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">mytbl</code>
<code class="p">(</code>
  <code class="n">utf8str</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code> <code class="nb">CHARACTER</code> <code class="k">SET</code> <code class="n">utf8mb4</code> <code class="k">COLLATE</code> <code class="n">utf8mb4_danish_ci</code><code class="p">,</code>
  <code class="n">sjisstr</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">100</code><code class="p">)</code> <code class="nb">CHARACTER</code> <code class="k">SET</code> <code class="n">sjis</code> <code class="k">COLLATE</code> <code class="n">sjis_japanese_ci</code>
<code class="p">);</code></pre><p>The <code>CHARACTER</code> <code>SET</code> and <code>COLLATE</code> clauses are each optional in a column
      definition:</p><ul><li><p>If you specify <code>CHARACTER</code>
          <code>SET</code> and omit <code>COLLATE</code>, the default collation for the
          character set is used.</p></li><li><p>If you specify <code>COLLATE</code> and
          omit <code>CHARACTER</code> <code>SET</code>, the character set implied by the
          collation name (the first part of the name) is used. For example,
          <code>utf8mb4_danish_ci</code> and <code>sjis_japanese_ci</code> imply <code>utf8mb4</code> and <code>sjis</code>, respectively. This means that the
          <code>CHARACTER</code> <code>SET</code> attributes could have been omitted
          from the preceding <code>CREATE</code>
          <code>TABLE</code> statement.</p></li><li><p>If you omit both <code>CHARACTER</code>
          <code>SET</code> and <code>COLLATE</code>, the column is assigned the table
          default character set and collation. A table definition can include
          those attributes following the closing parenthesis at the end of the
          <code>CREATE</code> <code>TABLE</code> statement. If present, they apply to
          columns that have no explicit character set or collation of their
          own. If omitted, the table defaults are taken from the database
          defaults. You can specify the database defaults when you create the
          database with the <code>CREATE</code>
          <code>DATABASE</code> statement. The server
          defaults apply to the database if they are omitted.</p></li></ul><p>The server default character set and collation for MySQL 8.0 are <code>utf8mb4</code> and <code>utf8mb4_0900_ai_ci</code>, so strings by default use
      the <code>utf8mb4</code> character set and are not
      case sensitive. To change this, set the <code>character_set_server</code> and <code>collation_server</code> system variables at server startup (see <a data-type="xref" href="ch22.xhtml#nch-admin-server-config">Recipe 22.1</a>).</p><p>MySQL also supports <code>ENUM</code> and
      <code>SET</code> string types, which are used for
      columns that have a fixed set of permitted values. The <code>CHARACTER</code> <code>SET</code> and <code>COLLATE</code> attributes apply to these data types
      as well.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.3 Setting the Client Connection Character Set"><div class="sect1" id="nch-strings-strings-set-names"><h1>7.3 Setting the Client Connection Character Set</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373437696"><h2>Problem</h2><p>You’re executing SQL statements or producing query results that don’t use
      the default character set.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373436688"><h2>Solution</h2><p>Use <code>SET</code> <code>NAMES</code> or an equivalent method to set your connection to the proper
      character set.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373434848"><h2>Discussion</h2><p>When you send information back and forth between your application
      and the server, you may need to tell MySQL the appropriate character
      set. For example, the default character set is <code>latin1</code>, but that may not always be the proper
      character set to use for connections to the server. If you have Greek
      data, displaying it using <code>latin1</code> will
      result in gibberish on your screen. If you use Unicode strings
      in the <code>utf8mb4</code> character
      set, <code>latin1</code> might not be sufficient
      to represent all the characters that you might need.</p><p>To deal with this problem, configure your connection to use the
      appropriate character set. You have several ways to do this:</p><ul><li><p>Issue a <code>SET</code> <code>NAMES</code> statement after you connect:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET NAMES 'utf8mb4';</code></strong></pre><p><code>SET</code> <code>NAMES</code> permits the connection collation to
          be specified as well:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET NAMES 'utf8mb4' COLLATE 'utf8mb4_0900_ai_ci';</code></strong></pre></li><li><p>If your client program supports the <code class="option">--default-character-set</code> option,
          you can use it to specify the character set at program invocation
          time. <span class="command"><em>mysql</em></span> is one such program.
          Put the option in an option file so that it takes effect each time
          you connect to the server:</p><pre data-type="programlisting">[mysql]
default-character-set=utf8mb4</pre></li><li><p>If you set the environment for your working environment using the <code>LANG</code> or <code>LC_ALL</code> environment variable on Unix, or
          the code page setting on Windows, MySQL client programs
          automatically detect which character set to use. For example,
          setting <code>LC_ALL</code> to <code>en_US.UTF-8</code> causes programs such as
          <span class="command"><em>mysql</em></span> to use <code>utf8</code>.</p></li><li><p>Some programming interfaces provide their own method of
          setting the character set. For example, MySQL Connector/J for Java
          clients detects the character set used on the server side
          automatically when you connect, but you can specify a different set
          explicitly using the <code>characterEncoding</code> property in the
          connection URL. The property value should be the Java-style
          character-set name. To select <code>utf8mb4</code>, you might use a connection URL like
          this:</p><pre data-type="programlisting">jdbc:mysql://localhost/cookbook?characterEncoding=UTF-8</pre><p>This is preferable to <code>SET</code>
          <code>NAMES</code> because Connector/J
          performs character-set conversion on behalf of the application, but
          is unaware of which character set applies if you use <code>SET</code> <code>NAMES</code>. Similar principles apply to
          programs written for other APIs. For PHP Data Objects (PDO), use a <code>charset</code> option in your data source name
          (DSN) string (this works in PHP 5.3.6 or later):</p><pre data-type="programlisting" data-code-language="php"><code class="nv">$dsn</code> <code class="o">=</code> <code class="s2">"mysql:host=localhost;dbname=cookbook;charset=utf8mb4"</code><code class="p">;</code></pre><p>For Connector/Python, specify a <code>charset</code> connection parameter:</p><pre data-type="programlisting" data-code-language="python"><code class="n">conn_params</code> <code class="o">=</code> <code class="p">{</code>
  <code class="s2">"database"</code><code class="p">:</code> <code class="s2">"cookbook"</code><code class="p">,</code>
  <code class="s2">"host"</code><code class="p">:</code> <code class="s2">"localhost"</code><code class="p">,</code>
  <code class="s2">"user"</code><code class="p">:</code> <code class="s2">"cbuser"</code><code class="p">,</code>
  <code class="s2">"password"</code><code class="p">:</code> <code class="s2">"cbpass"</code><code class="p">,</code>
  <code class="s2">"charset"</code><code class="p">:</code> <code class="s2">"utf8mb4"</code><code class="p">,</code>
<code class="p">}</code></pre><p>For Go, specify a <code>charset</code> connection parameter:</p><pre data-type="programlisting" data-code-language="go"><code class="nx">db</code><code class="p">,</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="o">:=</code><code class="w"> </code><code class="nx">sql</code><code class="p">.</code><code class="nx">Open</code><code class="p">(</code><code class="s">"mysql"</code><code class="p">,</code><code class="w"/>
<code class="w">          </code><code class="s">"cbuser:cbpass@tcp(127.0.0.1:3306)/cookbook?charset=utf8mb4"</code><code class="p">)</code><code class="w"/></pre><p>Some APIs may also provide a parameter to specify the
          collation.</p></li></ul><div data-type="note" epub:type="note"><h6>Note</h6><p>Some character sets cannot be used as the connection character
        set: <code>utf16</code>,<code>utf16le</code>, <code>utf32</code>.</p></div><p>You should also ensure that the character set used by your display
      device matches what you use for MySQL. Otherwise, even with MySQL
      handling the data properly, it might display as garbage. Suppose that
      you use the <span class="command"><em>mysql</em></span> program in a
      terminal window and that you configure MySQL to use <code>utf8mb4</code> and store <code>utf8mb4</code>-encoded Turkish data. If you set your
      terminal window to use <code>euc-tr</code> encoding,
      that is also Turkish, but its encoding for Turkish characters differs
      from <code>utf8mb4</code>, so the data will not
      display as you expect. (If you use autodetection, this should not be an
      issue.)</p><p>In an example Turkish characters inserted in a table will show 
      garbled in a connection made with different character set.  
      </p><pre data-type="programlisting">mysql&gt; <strong><code>DROP TABLE IF EXISTS t;</code></strong>
mysql&gt; <strong><code>CREATE TABLE t (c CHAR(3) CHARACTER SET utf8mb4);</code></strong>
mysql&gt; <strong><code>INSERT INTO t (c) VALUES('iii'),('şşş'),('ööö'),('ççç');</code></strong></pre><p>From another connection using <code>Latin1</code> client 
      character set will result following. </p><pre data-type="programlisting">mysql&gt; <strong><code>\s</code></strong>
--------------
mysql  Ver 8.0.27 for Linux on x86_64 (MySQL Community Server - GPL)
...
Server characterset:    utf8mb4
Db     characterset:    utf8mb4
Client characterset:    latin1
Conn.  characterset:    latin1
...
<strong><code>SELECT c from t;</code></strong>
+------+
| c    |
+------+
| iii  |
| ???  |
| ���  |
| ���  |
+------+</pre><p>To verify that you’re connected with correct character set to MySQL 
      command line interface issue following to show status.</p><pre data-type="programlisting">mysql&gt; <strong><code>\s</code></strong>
--------------
mysql  Ver 8.0.27 for Linux on x86_64 (MySQL Community Server - GPL)
...
Server characterset:	utf8mb4
Db     characterset:	utf8mb4
Client characterset:	utf8mb4
Conn.  characterset:	utf8mb4
...
<strong><code>SELECT c from t;</code></strong>
+------+
| c    |
+------+
| iii  |
| şşş  |
| ööö  |
| ççç  |
+------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.4 Writing String Literals"><div class="sect1" id="nch-strings-strings-literals"><h1>7.4 Writing String Literals</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373308688"><h2>Problem</h2><p>You need to write literal strings in SQL statements.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373307712"><h2>Solution</h2><p>Learn the syntax rules that govern string values.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373306768"><h2>Discussion</h2><p>You can write strings several ways:</p><ul><li><p>Enclose the text of the string within single quotes or double quotes:</p><pre data-type="programlisting">'my string'
"my string"</pre><p>When the <code>ANSI_QUOTES</code> SQL
          mode is enabled, you cannot use double quotes for quoting
          strings: the server interprets double quote as the quoting character
          for identifiers such as table or column names, and not for strings
          (see <a data-type="xref" href="ch04.xhtml#nch-api-api-ident-quoting">Recipe 4.6</a>). If you adopt the
          convention of always writing quoted strings using single quotes,
          MySQL interprets them as strings and not as identifiers regardless
          of the <code>ANSI_QUOTES</code>
          setting.</p></li><li><p>Use hexadecimal notation. Each pair of hex digits produces
          one byte of the string. <code>abcd</code> can
          be written using any of these formats:</p><pre data-type="programlisting">0x61626364
X'61626364'
x'61626364'</pre><p>MySQL treats strings written using hex notation as binary strings. Not
          coincidentally, it’s common for applications to use hex strings when
          constructing SQL statements that refer to binary values:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">INSERT</code> <code class="k">INTO</code> <code class="n">t</code> <code class="k">SET</code> <code class="n">binary_col</code> <code class="o">=</code> <code class="mi">0</code><code class="n">xdeadbeef</code><code class="p">;</code></pre></li><li><p>To specify a character set for interpretation of a literal
          string, use an introducer consisting of a character-set name
          preceded by an underscore:</p><pre data-type="programlisting">_utf8mb4 'abcd'
_utf16 'abcd'</pre><p>An introducer tells the server how to interpret the string
          that follows it. For <code>_utf8mb4</code>
          <code>'abcd'</code>, the server produces a
          string consisting of four single-byte characters. For <code>_ucs2</code> <code>'abcd'</code>, the server produces a string
          consisting of two two-byte characters because <code>ucs2</code> is a double-byte character
          set.</p></li></ul><p>To ensure that a string is a binary string or that a nonbinary
      string has a specific character set or collation, use the instructions
      for string conversion given in <a data-type="xref" href="#nch-strings-strings-charset-checking-changing">Recipe 7.5</a>.</p><p>A quoted string that includes the same quote character produces a syntax error if executed by an API or in the <span class="command"><em>mysql</em></span> batch mode:</p><pre data-type="programlisting"><strong><code>mysql -e "SELECT 'I'm asleep'"</code></strong>
ERROR 1064 (42000) at line 1: You have an error in your SQL syntax; ↩
check the manual that corresponds to your MySQL server version ↩
for the right syntax to use near 'asleep'' at line 1</pre><p>
        If executed interactively by the <span class="command"><em>mysql</em></span> client, it waits for the closing quote.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="s1">'I'</code><code class="n">m</code><code> </code><code class="n">asleep</code><code class="s1">';</code></strong><code class="s1">
    '</code><code class="o">&gt;</code><code>
    </code><code class="s1">'&gt; </code><strong><code class="s1">'</code><code class="err">\</code><code class="k">c</code></strong><code>
</code><code class="n">mysql</code><code class="o">&gt;</code></pre><p>You have several ways to deal with this:</p><ul><li><p>Enclose a string containing single quotes within double quotes
          (assuming that <code>ANSI_QUOTES</code> is
          disabled), or enclose a string containing double quotes within
          single quotes:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT "I'm asleep", 'He said, "Boo!"';</code></strong>
+------------+-----------------+
| I'm asleep | He said, "Boo!" |
+------------+-----------------+
| I'm asleep | He said, "Boo!" |
+------------+-----------------+</pre></li><li><p>To include a quote character within a string quoted by the same kind of quote,
          double the quote or precede it with a backslash. When MySQL reads
          the statement, it strips the extra quote or the backslash:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT 'I''m asleep', 'I\'m wide awake';</code></strong>
+------------+----------------+
| I'm asleep | I'm wide awake |
+------------+----------------+
| I'm asleep | I'm wide awake |
+------------+----------------+
mysql&gt; <strong><code>SELECT "He said, ""Boo!""", "And I said, \"Yikes!\"";</code></strong>
+-----------------+----------------------+
| He said, "Boo!" | And I said, "Yikes!" |
+-----------------+----------------------+
| He said, "Boo!" | And I said, "Yikes!" |
+-----------------+----------------------+</pre><p>A backslash turns off any special meaning of the following
          character, including itself. To write a literal backslash within a
          string, double it:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT 'Install MySQL in C:\\mysql on Windows';</code></strong>
+--------------------------------------+
| Install MySQL in C:\mysql on Windows |
+--------------------------------------+
| Install MySQL in C:\mysql on Windows |
+--------------------------------------+</pre><p>Backslash causes a temporary escape from normal string
          processing rules, so sequences such as <code>\'</code>, <code>\"</code>,
          and <code>\\</code> are called escape
          sequences. Others recognized by MySQL are <code>\b</code> (backspace), <code>\n</code> (newline, also called linefeed),
          <code>\r</code> (carriage return), <code>\t</code> (tab), and <code>\0</code> (ASCII NUL).</p></li><li><p>Write the string as a hex value:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT 0x49276D2061736C656570;</code></strong>
+------------------------+
| 0x49276D2061736C656570 |
+------------------------+
| I'm asleep             |
+------------------------+</pre></li></ul><div data-type="warning" epub:type="warning"><h6>Warning</h6><p>
          Starting from version 8.0 <span class="command"><em>mysql</em></span> client is running with option <code>--binary-as-hex</code> by default. If you do not disable this option you would get binary output as hex values. For example, for the above command you will see:
        </p><pre data-type="programlisting" data-code-language="sql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="mi">0</code><code class="n">x49276D2061736C656570</code><code class="p">;</code></strong><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="mi">0</code><code class="n">x49276D2061736C656570</code><code>                         </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------+
</code><code class="o">|</code><code> </code><code class="mi">0</code><code class="n">x49276D2061736C656570</code><code>                         </code><code class="o">|</code><code>
</code><code class="o">+</code><code class="c1">------------------------------------------------+
</code><code class="mi">1</code><code> </code><code class="k">row</code><code> </code><code class="k">in</code><code> </code><code class="k">set</code><code> </code><code class="p">(</code><code class="mi">0</code><code class="p">,</code><code class="mi">00</code><code> </code><code class="n">sec</code><code class="p">)</code></pre><p>
          To get human-readable output start the <span class="command"><em>mysql</em></span> client with option <code>--binary-as-hex=0</code>.
        </p></div></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820373306464"><h2>See Also</h2><p>If you execute SQL statements from within a program, you can refer
      to strings or binary values symbolically and let your programming
      interface take care of quoting: use the placeholder mechanism provided
      by the language’s database-access API (see <a data-type="xref" href="ch04.xhtml#nch-api-api-quoting">Recipe 4.5</a>). Alternatively, load binary values
      such as images from files using the <code>LOAD_FILE()</code>
      function (see <a href="https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_load-file"> MySQL documentation</a>).
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.5 Checking or Changing a String’s Character Set or Collation"><div class="sect1" id="nch-strings-strings-charset-checking-changing"><h1>7.5 Checking or Changing a String’s Character Set or Collation</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373147344"><h2>Problem</h2><p>You want to know the character set or collation of a string, or change a string
      to some other character set or collation.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373146224"><h2>Solution</h2><p>To check a string’s character set or collation, use the <code>CHARSET()</code> or
      <code>COLLATION()</code> function. To change its
      character set, use the <code>CONVERT()</code> function.
      To change its collation, use the <code>COLLATE</code>
      operator.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373143520"><h2>Discussion</h2><p>For a table created as follows, you know that values stored in the
      column <code>c</code> have a character set of
      <code>utf8</code> and a collation of <code>utf8_danish_ci</code>:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">t</code> <code class="p">(</code><code class="k">c</code> <code class="nb">CHAR</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code> <code class="nb">CHARACTER</code> <code class="k">SET</code> <code class="n">utf8mb4</code> <code class="k">COLLATE</code> <code class="n">utf8mb4_danish_ci</code><code class="p">);</code></pre><p>But sometimes it’s not so clear what character set or collation
      applies to a string. Server configuration can affect literal strings and
      some string functions, and other string functions return values in a
      specific character set. Symptoms that you have the wrong character set
      or collation are that a collation-mismatch error occurs for a comparison
      operation, or a lettercase conversion doesn’t work properly.</p><p>To determine a string’s character set or collation, use the
      <code>CHARSET()</code> or <code>COLLATION()</code> function. For example, did you
      know that the <code>USER()</code> function
      returns a Unicode string?</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT USER(), CHARSET(USER()), COLLATION(USER());</code></strong>
+------------------+-----------------+-------------------+
| USER()           | CHARSET(USER()) | COLLATION(USER()) |
+------------------+-----------------+-------------------+
| cbuser@localhost | utf8mb3         | utf8_general_ci   |
+------------------+-----------------+-------------------+</pre><p>String values that take their character set and collation from the
      current client configuration may change properties if the configuration
      changes. This is true for literal strings:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET NAMES 'utf8mb4';</code></strong>
mysql&gt; <strong><code>SELECT CHARSET('abc'), COLLATION('abc');</code></strong>
+----------------+--------------------+
| CHARSET('abc') | COLLATION('abc')   |
+----------------+--------------------+
| utf8mb4         | utf8mb4_0900_ai_ci|
+----------------+--------------------+
mysql&gt; <strong><code>SET NAMES 'utf8mb4' COLLATE 'utf8mb4_bin';</code></strong>
mysql&gt; <strong><code>SELECT CHARSET('abc'), COLLATION('abc');</code></strong>
+----------------+------------------+
| CHARSET('abc') | COLLATION('abc') |
+----------------+------------------+
| utf8mb4        | utf8mb4_bin      |
+----------------+------------------+</pre><p>For a binary string, the <code>CHARSET()</code> or <code>COLLATION()</code> functions return a value of
      <code>binary</code>, which means that the string
      is compared and sorted based on numeric byte values, not character
      collation values.</p><p>To convert a string from one character set to another, use the
      <code>CONVERT()</code> function:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'my string', @s2 = CONVERT(@s1 USING utf8mb4);</code></strong>
mysql&gt; <strong><code>SELECT CHARSET(@s1), CHARSET(@s2);</code></strong>
+--------------+--------------+
| CHARSET(@s1) | CHARSET(@s2) |
+--------------+--------------+
| latin1       | utf8mb4      |
+--------------+--------------+</pre><p>To change the collation of a string, use the <code>COLLATE</code> operator:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'my string', @s2 = @s1 COLLATE latin1_spanish_ci;</code></strong>
mysql&gt; <strong><code>SELECT COLLATION(@s1), COLLATION(@s2);</code></strong>
+-------------------+-------------------+
| COLLATION(@s1)    | COLLATION(@s2)    |
+-------------------+-------------------+
| latin1_swedish_ci | latin1_spanish_ci |
+-------------------+-------------------+</pre><p>The new collation must be legal for the character set of the
      string. For example, you can use the <code>utf8_general_ci</code> collation with <code>utf8mb3</code> strings, but not with <code>latin1</code> strings:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT _latin1 'abc' COLLATE utf8_bin;</code></strong>
ERROR 1253 (42000): COLLATION 'utf8_bin' is not valid for
CHARACTER SET 'latin1'</pre><p>To convert both the character set and collation of a string, use
      <code>CONVERT()</code> to change the character
      set, and apply the <code>COLLATE</code> operator
      to the result:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'my string';</code></strong>
mysql&gt; <strong><code>SET @s2 = CONVERT(@s1 USING utf8mb4) COLLATE utf8mb4_spanish_ci;</code></strong>
mysql&gt; <strong><code>SELECT CHARSET(@s1), COLLATION(@s1), CHARSET(@s2), COLLATION(@s2);</code></strong>
+--------------+-------------------+--------------+-----------------+
| CHARSET(@s1) | COLLATION(@s1)    | CHARSET(@s2) | COLLATION(@s2)  |
+--------------+-------------------+--------------+-----------------+
| latin1       | latin1_swedish_ci | utf8         | utf8_spanish_ci |
+--------------+-------------------+--------------+-----------------+</pre><p>The <code>CONVERT()</code> function can also
      convert binary strings to nonbinary strings and vice versa. To produce a
      binary string, use <code>binary</code>; any other
      character-set name produces a nonbinary string:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'my string';</code></strong>
mysql&gt; <strong><code>SET @s2 = CONVERT(@s1 USING binary);</code></strong>
mysql&gt; <strong><code>SET @s3 = CONVERT(@s2 USING utf8mb4);</code></strong>
mysql&gt; <strong><code>SELECT CHARSET(@s1), CHARSET(@s2), CHARSET(@s3);</code></strong>
+--------------+--------------+--------------+
| CHARSET(@s1) | CHARSET(@s2) | CHARSET(@s3) |
+--------------+--------------+--------------+
| latin1       | binary       | utf8mb4      |
+--------------+--------------+--------------+</pre><p>Alternatively, produce binary strings using the <code>CAST</code> function, which is equivalent to <code>CONVERT(</code><em><code>str</code></em>
      <code>USING</code> <code>binary)</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT CHARSET(CAST(_utf8mb4 'my string' AS binary));</code></strong>
+-----------------------------------------------+
| CHARSET(CAST(_utf8mb4 'my string' AS binary)) |
+-----------------------------------------------+
| binary                                        |
+-----------------------------------------------+</pre><p>See also <a data-type="xref" href="#nch-strings-strings-set-names">Recipe 7.3</a> for more
  information on character sets.
  </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.6 Converting the Lettercase of a String"><div class="sect1" id="nch-strings-strings-lettercase-changing"><h1>7.6 Converting the Lettercase of a String</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373044928"><h2>Problem</h2><p>You want to convert a string to uppercase or lowercase.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373043920"><h2>Solution</h2><p>Use the <code>UPPER()</code> or <code>LOWER()</code> function. If they don’t work, you’re probably trying to convert a
      binary string. Convert it to a nonbinary string that has a character set
      and collation and is subject to case mapping.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373041856"><h2>Discussion</h2><p>The <code>UPPER()</code> and <code>LOWER()</code> functions convert the lettercase of a
      string:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT thing, UPPER(thing), LOWER(thing) FROM limbs;</code></strong>
+--------------+--------------+--------------+
| thing        | UPPER(thing) | LOWER(thing) |
+--------------+--------------+--------------+
| human        | HUMAN        | human        |
| insect       | INSECT       | insect       |
| squid        | SQUID        | squid        |
| fish         | FISH         | fish         |
| centipede    | CENTIPEDE    | centipede    |
| table        | TABLE        | table        |
| armchair     | ARMCHAIR     | armchair     |
| phonograph   | PHONOGRAPH   | phonograph   |
| tripod       | TRIPOD       | tripod       |
| Peg Leg Pete | PEG LEG PETE | peg leg pete |
| space alien  | SPACE ALIEN  | space alien  |
+--------------+--------------+--------------+</pre><p>But some strings are <q>stubborn</q> and resist lettercase
      conversion. To get human-readable output start the mysql client with 
      option binary-as-hex=0.
      </p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE t (b VARBINARY(10)) SELECT 'aBcD' AS b;</code></strong>
mysql&gt; <strong><code>SELECT b, UPPER(b), LOWER(b) FROM t;</code></strong>
+------+----------+----------+
| b    | UPPER(b) | LOWER(b) |
+------+----------+----------+
| aBcD | aBcD     | aBcD     |
+------+----------+----------+</pre><p>This problem occurs for strings that have a <code>BINARY</code> or <code>BLOB</code> data type. These are binary strings that
      have no character set or collation. Lettercase does not apply, and
      <code>UPPER()</code> and <code>LOWER()</code> do nothing.</p><p>To map a binary string to a given lettercase, convert it to a nonbinary string, choosing a character set
      that has uppercase and lowercase characters. The case-conversion
      functions then work as you expect because the collation provides case
      mapping:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT b,</code></strong>
    -&gt; <strong><code>UPPER(CONVERT(b USING utf8mb4)) AS upper,</code></strong>
    -&gt; <strong><code>LOWER(CONVERT(b USING utf8mb4)) AS lower</code></strong>
    -&gt; <strong><code>FROM t;</code></strong>
+------+-------+-------+
| b    | upper | lower |
+------+-------+-------+
| aBcD | ABCD  | abcd  |
+------+-------+-------+</pre><p>The example uses a table column, but the same principles apply to
      binary string literals and string expressions.</p><p>If you’re not sure whether a string expression is binary or
      nonbinary, use the <code>CHARSET()</code> function to find out; see <a data-type="xref" href="#nch-strings-strings-charset-checking-changing">Recipe 7.5</a>.</p><p>To convert the lettercase of only part of a string, break it into
      pieces, convert the relevant piece, and put the pieces back together.
      Suppose that you want to convert only the initial character of a string
      to uppercase. The following expression accomplishes that:</p><pre data-type="programlisting">CONCAT(UPPER(LEFT(<em><code>str</code></em>,1)),MID(<em><code>str</code></em>,2))</pre><p>But it’s ugly to write an expression like that each time you need
      it. For convenience, define a stored function:</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE FUNCTION initial_cap (s VARCHAR(255))</code></strong>
    -&gt; <strong><code>RETURNS VARCHAR(255) DETERMINISTIC</code></strong>
    -&gt; <strong><code>RETURN CONCAT(UPPER(LEFT(s,1)),MID(s,2));</code></strong></pre><p>Then you can capitalize initial characters more easily:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT thing, initial_cap(thing) FROM limbs;</code></strong>
+--------------+--------------------+
| thing        | initial_cap(thing) |
+--------------+--------------------+
| human        | Human              |
| insect       | Insect             |
| squid        | Squid              |
| fish         | Fish               |
| centipede    | Centipede          |
| table        | Table              |
| armchair     | Armchair           |
| phonograph   | Phonograph         |
| tripod       | Tripod             |
| Peg Leg Pete | Peg Leg Pete       |
| space alien  | Space alien        |
+--------------+--------------------+</pre><p>For more information about writing stored functions, see <a data-type="xref" href="ch11.xhtml#nch-routines">Chapter 11</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.7 Comparing String Values"><div class="sect1" id="nch-strings-strings-compare"><h1>7.7 Comparing String Values</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820373019584"><h2>Problem</h2><p>You want to know whether strings are equal or unequal, or which appears
      first in lexical order.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820373018464"><h2>Solution</h2><p>Use a comparison operator. But remember that strings have properties such as case
      sensitivity that you must take into account. A string comparison might
      be case sensitive when you don’t want it to be, or vice versa.</p><p>As is the case with other data types, you can compare string values for
      equality, inequality, or relative ordering:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT 'cat' = 'cat', 'cat' = 'dog', 'cat' &lt;&gt; 'cat', 'cat' &lt;&gt; 'dog';</code></strong>
+---------------+---------------+----------------+----------------+
| 'cat' = 'cat' | 'cat' = 'dog' | 'cat' &lt;&gt; 'cat' | 'cat' &lt;&gt; 'dog' |
+---------------+---------------+----------------+----------------+
|             1 |             0 |              0 |              1 |
+---------------+---------------+----------------+----------------+
mysql&gt; <strong><code>SELECT 'cat' &lt; 'auk', 'cat' &lt; 'dog', 'cat' BETWEEN 'auk' AND 'eel';</code></strong>
+---------------+---------------+-------------------------------+
| 'cat' &lt; 'auk' | 'cat' &lt; 'dog' | 'cat' BETWEEN 'auk' AND 'eel' |
+---------------+---------------+-------------------------------+
|             0 |             1 |                             1 |
+---------------+---------------+-------------------------------+</pre></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820373015152"><h2>Discussion</h2><p>However, comparison and sorting properties of strings are subject
      to complications that don’t apply to other types of data. For example,
      sometimes you must ensure that a string comparison is case sensitive
      that would not otherwise be, or vice versa. This section describes how
      to do that.</p><p>String comparison properties depend on whether the operands are
      binary or nonbinary strings:</p><ul><li><p>A binary string is a sequence of bytes and is compared using numeric byte
          values. Lettercase has no meaning. However, because letters in
          different cases have different byte values, comparisons of binary
          strings effectively are case sensitive. (That is, <code>a</code> and <code>A</code>
          are unequal.) To compare binary strings such that lettercase does
          not matter, convert them to nonbinary strings that have a
          case-insensitive collation.</p></li><li><p>A nonbinary string is a sequence of characters and is compared in character
          units. (Depending on the character set, some characters might have
          multiple bytes.) The string has a character set that defines the
          legal characters and a collation that defines their sort order. The
          collation also determines whether to consider characters in
          different lettercases the same in comparisons. If the collation is
          case sensitive, and you want a case-insensitive collation (or vice
          versa), convert the strings to use a collation with the desired
          case-comparison properties.</p></li></ul><p>By default, strings have a character set of <code>utf8mb4</code> and a collation of <code>utf8mb4_0900_ai_ci</code> unless you reconfigure the
      server (see <a data-type="xref" href="ch22.xhtml#nch-admin-server-config">Recipe 22.1</a>). This results in
      case-insensitive string comparisons.</p><p>The following example shows how two binary strings that compare as
      unequal can be handled so that they are equal when compared as
      case-insensitive nonbinary strings:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = CAST('cat' AS BINARY), @s2 = CAST('CAT' AS BINARY);</code></strong>
mysql&gt; <strong><code>SELECT @s1 = @s2;</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         0 |
+-----------+
mysql&gt; <strong><code>SET @s1 = CONVERT(@s1 USING utf8mb4) COLLATE utf8mb4_0900_ai_ci;</code></strong>
mysql&gt; <strong><code>SET @s2 = CONVERT(@s2 USING utf8mb4) COLLATE utf8mb4_0900_ai_ci;</code></strong>
mysql&gt; <strong><code>SELECT @s1 = @s2;</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         1 |
+-----------+</pre><p>In this case, because <code>utf8mb4_0900_ai_ci</code> is the default collation for
      <code>utf8mb4</code>, you can omit the <code>COLLATE</code> operator:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = CONVERT(@s1 USING utf8mb4);</code></strong>
mysql&gt; <strong><code>SET @s2 = CONVERT(@s2 USING utf8mb4);</code></strong>
mysql&gt; <strong><code>SELECT @s1 = @s2;</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         1 |
+-----------+</pre><p>The next example shows how to compare, in case-sensitive fashion,
      two strings that are not case sensitive:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'cat', @s2 = _latin1 'CAT';</code></strong>
mysql&gt; <strong><code>SELECT @s1 = @s2;</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         1 |
+-----------+
mysql&gt; <strong><code>SELECT @s1 COLLATE latin1_general_cs = @s2 COLLATE latin1_general_cs</code></strong>
    -&gt;   <strong><code>AS '@s1 = @s2';</code></strong>
+-----------+
| @s1 = @s2 |
+-----------+
|         0 |
+-----------+</pre><p>If you compare a binary string with a nonbinary string, the
      comparison treats both operands as binary strings:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT _latin1 'cat' = CAST('CAT' AS BINARY);</code></strong>
+---------------------------------------+
| _latin1 'cat' = CAST('CAT' AS BINARY) |
+---------------------------------------+
|                                     0 |
+---------------------------------------+</pre><p>Thus, to compare two nonbinary strings as binary strings, cast them to the
      <code>BINARY</code> data type to either one
      when comparing them:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @s1 = _latin1 'cat', @s2 = _latin1 'CAT';</code></strong>
mysql&gt; <strong><code>SELECT @s1 = @s2, CAST(@s1 AS BINARY) = @s2, @s1 = CAST(@s2 AS BINARY);</code></strong>
+-----------+---------------------------+---------------------------+
| @s1 = @s2 | CAST(@s1 AS BINARY) = @s2 | @s1 = CAST(@s2 AS BINARY) |
+-----------+---------------------------+---------------------------+
|         1 |                         0 |                         0 |
+-----------+---------------------------+---------------------------+</pre><p>If you find that you’ve declared a column using a type not suited
      to the kind of comparisons for which you typically use it, use <code>ALTER</code> <code>TABLE</code>
      to change the type. Suppose that this table stores news
      articles:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="n">news</code>
<code class="p">(</code>
  <code class="n">id</code>      <code class="nb">INT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="n">article</code> <code class="nb">BLOB</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="n">id</code><code class="p">)</code>
<code class="p">);</code></pre><p>Here the <code>article</code> column is
      declared as a <code>BLOB</code>. That is a binary
      string type, so comparisons of text stored in the column are made
      without regard to character set. (In effect, they are case sensitive.)
      If that’s not what you want, use <code>ALTER</code> <code>TABLE</code>
      to convert the column to a nonbinary type that has a case-insensitive collation:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="n">news</code>
  <code class="k">MODIFY</code> <code class="n">article</code> <code class="nb">TEXT</code> <code class="nb">CHARACTER</code> <code class="k">SET</code> <code class="n">utf8mb4</code> <code class="k">COLLATE</code> <code class="n">utf8mb4_0900_ai_ci</code><code class="p">;</code></pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.8 Converting Between Decimal, Octal and Hexadecimal Formats"><div class="sect1" id="nch-converting-between-formats"><h1>7.8 Converting Between Decimal, Octal and Hexadecimal Formats</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372923136"><h2>Problem</h2><p>
      You want to convert between one numeric base to another. 
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372922256"><h2>Solution</h2><p>
      Use the <code>CONV()</code> function and SQL pattern described in this 
      section. 
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372920960"><h2>Discussion</h2><p>
      It is difficult to operate literals as text strings in some formats such as <code>HEX</code>. An alternative 
      method is to convert them to binary values. This will produce data type with a value of BINARY(16) that is 
      128 bits long. Using <code>BIN()</code>,<code>OCT()</code>,<code>HEX()</code> functions to convert 
      between decimal number to binary, octal and hexadecimal is already possible. What if we you to do the reverse? This is where
      <code>CONV()</code> function comes handy. With the <code>CONV()</code> function from we can convert from one 
      numeric base system to another. 
      </p><p> Syntax to use <code>CONV()</code> function:
      </p><pre data-type="programlisting"> CONV(number, from_base, to_base)</pre><p>
      </p><ul><li><p>A <code>number</code> is a value which we
          want to convert from one numeric base to another.</p></li><li><p>A <code>from_base</code> is original base value of the 
          numeric base limited to value between 2 and 36.</p></li><li><p>A <code>to_base</code> is target value of the 
          numeric base. This value can be between 2 and 36 or -2 and -36.</p></li></ul><pre data-type="programlisting">mysql&gt; <strong><code>SELECT CONV(8, 10, 2) AS DectoBin;</code></strong>
+----------+
| DectoBin |
+----------+
| 1000     |
+----------+</pre><p>Similar to <code>BIN()</code> function we get same result. Although
	<code>BIN()</code> function returns a string. 
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT BIN(8);</code></strong>
+--------+
| BIN(8) |
+--------+
| 1000   |
+--------+</pre><p>
	</p><p>Like wise we can convert values between each other in reverse:
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT CONV('F', 16, 10) AS Hex2Dec;</code></strong>
+---------+
| Hex2Dec |
+---------+
| 15      |
+---------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.9 Converting Between ASCII,BIT and Hexadecimal Formats "><div class="sect1" id="nch-converting-between-formats-hex"><h1>7.9 Converting Between ASCII,BIT and Hexadecimal Formats </h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372902544"><h2>Problem</h2><p>
      You want to convert between one string format to another. 
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372901632"><h2>Solution</h2><p>
      Use the MySQL <code>CHAR()</code>, <code>ASCII()</code> ,<code>BIT_LENGTH()</code> functions 
      and SQL pattern described in this section. 
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372886304"><h2>Discussion</h2><p>
      There are many powerful string functions to support MySQL’s string operations. In different use cases we may have to
      convert them to have different results. Using some of the string functions such as <code>ASCII()</code>
      we can convert between other formats like <code>BIT</code> and <code>HEX</code>. 
      </p><p> Syntax to use <code>ASCII()</code> function:
      </p><pre data-type="programlisting"> ASCII(character);</pre><p>
      </p><div data-type="note" epub:type="note"><h6>Note</h6><p>The <code>ASCII()</code> function only returns left most character’s numeric
      value of the string. This is similar to MySQL’s <code>ORD()</code> function.
      </p></div><pre data-type="programlisting">mysql&gt; <strong><code>SELECT ASCII("LARA");</code></strong>
+---------------+
| ASCII("LARA") |
+---------------+
|            76 |
+---------------+</pre><pre data-type="programlisting">mysql&gt; <strong><code>SELECT ASCII("L");</code></strong>
+---------------+
| ASCII("L") |
+---------------+
|            76 |
+---------------+</pre><p>As you can see the result is same for both strings. The function only 
    takes the leftmost character of the string. 
    </p><p>In the following example, we will convert a string value to <code>HEX</code> format:
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT DISTINCT CONV(ASCII("LARA"),10,16) as ASCII2HEX;</code></strong>
+-----------+
| ASCII2HEX |
+-----------+
| 4C        |
+-----------+</pre><p>Say we have table <code>name</code> and want to get all unique <code>last_name</code> from this
    table in <code>HEX</code> format:
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT DISTINCT CONV(ASCII(last_name),10,16) from name;</code></strong>
+------------------------------+
| CONV(ASCII(last_name),10,16) |
+------------------------------+
| 42                           |
| 47                           |
| 57                           |
+------------------------------+</pre><p>
	</p><p>Bit operations before MySQL 8.0 handled on unsingned 64-bit integer values. After MySQL 8.0
	bit operations extended to handle binary string arguments. This allowed strings that are not
	integers or binary strings to be converted. UUID (Universal Unique Identifier) specified by 
	<a href="https://datatracker.ietf.org/doc/html/rfc4122">RFC 4122</a> is a 128-bit unique value 
	globally when complete uniqueness is required.  UUIDs also come in handy  using for security purposes since it does not reveal any information about data.
	It is represented in human readable format as <code> utf8mb4 </code> with the string of five hexadecimal numbers. 
	A good example is converting <code>UUID</code> value to binary by using <code>UUID_TO_BIN</code> function (we are running <span class="command"><em>mysql</em></span> with option <code>binary-as-hex</code>):
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT UUID();</code></strong>
+--------------------------------------+
| UUID()                               |
+--------------------------------------+
| e52e0524-385b-11ec-99b1-054a662275e4 |
+--------------------------------------+</pre><p>
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT UUID_TO_BIN(UUID());</code></strong>
+------------------------------------------+
| UUID_TO_BIN(UUID())                      |
+------------------------------------------+
| 0xB8D11A66134E11ECB46CC15B8175C680       |
+------------------------------------------+</pre><p>
</p><p>Later we can convert this value to compare bit count using <code>BIT_COUNT()</code> function.
This function mainly used to identify active bits in given input. 
	</p><pre data-type="programlisting">mysql&gt; <strong><code>select UUID_TO_BIN(UUID()) into @bin_uuid;</code></strong>
mysql&gt; <strong><code>select BIT_COUNT(@bin_uuid);</code></strong>
+----------------------+
| BIT_COUNT(@bin_uuid) |
+----------------------+
|                   57 |
+----------------------+</pre><p>
</p><p>The purpose of the <code>BIT_COUNT()</code> function is to identify active bits in given decimal value.
For example if we were to find out active bits in number 18. Binary conversion of 18 is <code>10010</code> hence 
active bits are only two. 
</p><pre data-type="programlisting">mysql&gt; <strong><code>select BIT_COUNT(18);</code></strong>
+---------------+
| BIT_COUNT(18) |
+---------------+
|             2 |
+---------------+</pre><p>
<code>BIT_COUNT()</code> function powered with <code>BIT_OR()</code> function can be combined to calculate following problem. 
<code>BIT_OR()</code> function returns the bitwise OR all the bits in an expression. 
Say we want to find number of Sundays in month of November. We will create a table called <code>sundays</code>:
</p><pre data-type="programlisting">mysql&gt; <strong><code>CREATE TABLE sundays (
    year YEAR, 
    month INT UNSIGNED ,
    day INT UNSIGNED 
);
</code></strong></pre><p>
</p><pre data-type="programlisting">mysql&gt; <strong><code>INSERT INTO sundays VALUES(2021,11,7),
                            (2021,11,14),
                            (2021,11,21),
                            (2021,11,28);
</code></strong></pre><p>
</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT year, month, BIT_COUNT(BIT_OR(1 &lt;&lt; day)) AS 'Number of Sundays'</code></strong>
    -&gt; <strong><code>FROM sundays GROUP BY year,month;
</code></strong>
+------+-------+-------------------+
| year | month | Number of Sundays |
+------+-------+-------------------+
| 2021 |    11 |                 4 |
+------+-------+-------------------+</pre><p>
This example can be extended to find number of holidays in a given calendar year or date range. 
</p><p>Another use case is IPv6 and IPv4 network addresses are string values. In order to return 
binary value to represent it in numeric <code>INET_ATON()</code> function can be used. This function converts
dotted quad IPv4 adress string represenation to numeric value. While use cases for this function may vary it is widely 
used for storing source and destionation of IP addresses for data as well as transactions mostly logging purposes. 
Once the IPv4 address is stored in numeric value than it can be indexed and processed faster.
	</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT INET_ATON('10.0.2.1');</code></strong>
+-----------------------+
| INET_ATON('10.0.2.1') |
+-----------------------+
|             167772673 |
+-----------------------+</pre><p>
</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT HEX(INET6_ATON('10.0.2.1'));</code></strong>
+-----------------------------+
| HEX(INET6_ATON('10.0.2.1')) |
+-----------------------------+
| 0A000201                    |
+-----------------------------+</pre><p>
</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.10 Pattern Matching with SQL Patterns"><div class="sect1" id="nch-strings-strings-pat-sql"><h1>7.10 Pattern Matching with SQL Patterns</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372848624"><h2>Problem</h2><p>You want to perform a pattern match, not a literal comparison.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372847680"><h2>Solution</h2><p>Use the <code>LIKE</code> operator and
      an SQL pattern, described in this section. Or use a
      regular-expression pattern match, described in <a data-type="xref" href="#nch-strings-strings-pat-regexp">Recipe 7.11</a>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372845040"><h2>Discussion</h2><p>Patterns are strings that contain special characters known as
      metacharacters because they stand for something other than
      themselves. MySQL provides two kinds of pattern matching. One is based
      on SQL patterns and the other on regular expressions. SQL patterns are
      more standard among different database systems, but regular expressions
      are more powerful. The two kinds of pattern match use different
      operators and different metacharacters. This section describes SQL
      patterns. <a data-type="xref" href="#nch-strings-strings-pat-regexp">Recipe 7.11</a> describes
      regular expressions.</p><p>The example here uses a table named <code>metal</code> that contains the following rows:</p><pre data-type="programlisting">+----------+
| name     |
+----------+
| gold     |
| iron     |
| lead     |
| mercury  |
| platinum |
| tin      |
+----------+</pre><p>SQL pattern matching uses the <code>LIKE</code> and <code>NOT</code> <code>LIKE</code>
      operators rather than <code>=</code> and
      <code>&lt;&gt;</code> to perform matching against
      a pattern string. Patterns may contain two special metacharacters: <code>_</code>
      matches any single character, and <code>%</code> matches any
      sequence of characters, including the empty string. You can use these
      characters to create patterns that match a variety of values:</p><ul><li><p>Strings that begin with a particular substring:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name LIKE 'me%';</code></strong>
+---------+
| name    |
+---------+
| mercury |
+---------+</pre></li><li><p>Strings that end with a particular substring:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name LIKE '%d';</code></strong>
+------+
| name |
+------+
| gold |
| lead |
+------+</pre></li><li><p>Strings that contain a particular substring at any
          position:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name LIKE '%in%';</code></strong>
+----------+
| name     |
+----------+
| platinum |
| tin      |
+----------+</pre></li><li><p>Strings that contain a substring at a specific position (the
          pattern matches only if <code>at</code> occurs
          at the third position of the <code>name</code>
          column):</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal where name LIKE '__at%';</code></strong>
+----------+
| name     |
+----------+
| platinum |
+----------+</pre></li></ul><p>An SQL pattern matches successfully only if it matches the entire
      comparison value. Of the following two pattern matches, only the second
      succeeds:</p><pre data-type="programlisting">'abc' LIKE 'b'
'abc' LIKE '%b%'</pre><p>To reverse the sense of a pattern match, use <code>NOT</code> <code>LIKE</code>.
      The following statement finds strings that contain no <code>i</code> characters:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name NOT LIKE '%i%';</code></strong>
+---------+
| name    |
+---------+
| gold    |
| lead    |
| mercury |
+---------+</pre><p>SQL patterns do not match <code>NULL</code>
      values. This is true both for <code>LIKE</code>
      and for <code>NOT</code> <code>LIKE</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT NULL LIKE '%', NULL NOT LIKE '%';</code></strong>
+---------------+-------------------+
| NULL LIKE '%' | NULL NOT LIKE '%' |
+---------------+-------------------+
|          NULL |              NULL |
+---------------+-------------------+</pre><p>In some cases, pattern matches are equivalent to substring
      comparisons. For example, using patterns to find strings at one end or
      the other of a string is like using <code>LEFT()</code> or
      <code>RIGHT()</code>, as shown in the <a data-type="xref" href="#nch-strings-strings-pat-sql-substr-comp">Table 7-2</a>:</p><table id="nch-strings-strings-pat-sql-substr-comp"><caption><span class="label">Table 7-2. </span>Patern Match versus Substring Comparison</caption><thead><tr><th>Pattern match</th><th>Substring comparison</th></tr></thead><tbody><tr><td><em><code>str</code></em><code> LIKE 'abc%'</code></td><td><code>LEFT(</code><em><code>str</code></em><code>,3) = 'abc'</code></td></tr><tr><td><em><code>str</code></em><code> LIKE '%abc'</code></td><td><code>RIGHT(</code><em><code>str</code></em><code>,3) = 'abc'</code></td></tr></tbody></table><p>If you’re matching against a column that is indexed and you have a
      choice of using a pattern or an equivalent <code>LEFT()</code> exprlenghtession, you’ll likely find the
      pattern match to be faster. MySQL can use the index to narrow the search
      for a pattern that begins with a literal string. With <code>LEFT()</code>, it cannot. Also <code>LIKE</code> comparison with a <code>%</code>
      in the beginning can be slow due to optimizer checking entire content
      of the string. </p><p>Case sensitivity of a pattern match is like that of a string
      comparison. That is, it depends on whether the operands are binary or
      nonbinary strings, and for nonbinary strings, it depends on their
      collation. See <a data-type="xref" href="#nch-strings-strings-compare">Recipe 7.7</a> for
      discussion of how these factors apply to comparisons.</p><aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45820372810480"><h5>Using Patterns with Nonstring Values</h5><p>Unlike some other database systems, MySQL permits pattern
        matches to be applied to nonstring values such as numbers or dates,
        which can sometimes be useful. The <a data-type="xref" href="#nch-dates-dates-format-table">Table 7-3</a> shows some ways to
        test a <code>DATE</code> value <code>d</code> using function calls that extract date
        parts and using the equivalent pattern matches. The pairs of
        expressions are true for dates occurring in the year 1975, in the
        month of June, or on the twenty first day of the month:</p><table id="nch-dates-dates-format-table"><caption><span class="label">Table 7-3. </span> Pattern Matching for Temporal Data Types</caption><thead><tr><th>Function value test</th><th>Pattern match test</th></tr></thead><tbody><tr><td><code>YEAR(d) = 1975</code></td><td><code>d LIKE '1975-%'</code></td></tr><tr><td><code>MONTH(d) = 6</code></td><td><code>d LIKE '%-06-%'</code></td></tr><tr><td><code>DAYOFMONTH(d) = 21</code></td><td><code>d LIKE '%-21'</code></td></tr></tbody></table></div></aside></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.11 Pattern Matching with Regular Expressions"><div class="sect1" id="nch-strings-strings-pat-regexp"><h1>7.11 Pattern Matching with Regular Expressions</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372801392"><h2>Problem</h2><p>You want to perform a pattern match, not a literal comparison.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372800512"><h2>Solution</h2><p>Use the <code>REGEXP</code> operator and a
      regular expression pattern, described in this section. Or
      use an SQL pattern, described in <a data-type="xref" href="#nch-strings-strings-pat-sql">Recipe 7.10</a>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372797968"><h2>Discussion</h2><p>SQL patterns (see <a data-type="xref" href="#nch-strings-strings-pat-sql">Recipe 7.10</a>)
      are likely to be implemented by other database systems, so they’re
      reasonably portable beyond MySQL. On the other hand, they’re somewhat
      limited. For example, you can easily write an SQL pattern <code>%abc%</code> to find strings that contain <code>abc</code>, but you cannot write a single SQL pattern
      to identify strings that contain any of the characters <code>a</code>, <code>b</code>, or
      <code>c</code>. Nor can you match string content
      based on character types such as letters or digits. For such operations,
      MySQL supports another type of pattern-matching operation based on
      regular expressions and the <code>REGEXP</code>
      operator (or <code>NOT</code> <code>REGEXP</code> to reverse the sense of the match).
      <code>REGEXP</code> matching uses the pattern
      elements shown in the <a data-type="xref" href="#nch-strings-strings-pat-regexp-syntax">Table 7-4</a>:</p><table id="nch-strings-strings-pat-regexp-syntax"><caption><span class="label">Table 7-4. </span>Popular Regular Expressions Syntax</caption><thead><tr><th>Pattern</th><th>What the pattern matches</th></tr></thead><tbody><tr><td><code>^</code></td><td>Beginning of string</td></tr><tr><td><code>$</code></td><td>End of string</td></tr><tr><td><code>.</code></td><td>Any single character</td></tr><tr><td><code>[...]</code></td><td>Any character listed between
              the square brackets</td></tr><tr><td><code>[^...]</code></td><td>Any character not listed
              between the square brackets</td></tr><tr><td><em><code>p1</code></em><code>|</code><em><code>p2</code></em><code>|</code><em><code>p3</code></em></td><td>Alternation; matches any of
              the patterns <em><code>p1</code></em>,
              <em><code>p2</code></em>, or
              <em><code>p3</code></em></td></tr><tr><td><code>*</code></td><td>Zero or more instances of preceding element</td></tr><tr><td><code>+</code></td><td>One or more instances of preceding element</td></tr><tr><td><code>{</code><em><code>n</code></em><code>}</code></td><td><em><code>n</code></em>
              instances of preceding element</td></tr><tr><td><code>{</code><em><code>m</code></em><code>,</code><em><code>n</code></em><code>}</code></td><td><em><code>m</code></em>
              through <em><code>n</code></em> instances of preceding
              element</td></tr></tbody></table><p>You may already be familiar with these regular expression pattern
      characters; many of them are the same as those used by <span class="command"><em>vi</em></span>, <span class="command"><em>grep</em></span>,
      <span class="command"><em>sed</em></span>, and other Unix utilities that
      support regular expressions. Most of them are used also in the regular
      expressions understood by programming languages. (For discussion of
      pattern matching in programs for data validation and transformation, see
      <a data-type="xref" href="ch14.xhtml#nch-format">Chapter 14</a>.)</p><p><a data-type="xref" href="#nch-strings-strings-pat-sql">Recipe 7.10</a> shows how to use
      SQL patterns to match substrings at the beginning or end of a string, or
      at an arbitrary or specific position within a string. You can do the
      same things with regular expressions:</p><ul><li><p>Strings that begin with a particular substring:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name REGEXP '^me';</code></strong>
+---------+
| name    |
+---------+
| mercury |
+---------+</pre></li><li><p>Strings that end with a particular substring:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name REGEXP 'd$';</code></strong>
+------+
| name |
+------+
| gold |
| lead |
+------+</pre></li><li><p>Strings that contain a particular substring at any
          position:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name REGEXP 'in';</code></strong>
+----------+
| name     |
+----------+
| platinum |
| tin      |
+----------+</pre></li><li><p>Strings that contain a particular substring at a specific
          position:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name REGEXP '^..at';</code></strong>
+----------+
| name     |
+----------+
| platinum |
+----------+</pre></li></ul><p>In addition, regular expressions have other capabilities and can
      perform matches that SQL patterns cannot. For example, regular
      expressions can contain character classes, which match any character in the
      class:</p><ul><li><p>To write a character class, use square brackets and list the
          characters you want the class to match inside the brackets. Thus,
          the pattern <code>[abc]</code> matches
          <code>a</code>, <code>b</code>, or <code>c</code>.</p></li><li><p>Classes can indicate ranges of characters; use a dash between
          the beginning and end of the range. <code>[a-z]</code> matches any letter, <code>[0-9]</code> matches digits, and <code>[a-z0-9]</code> matches letters or digits.</p></li><li><p>To negate a character class (<q>match any character but
          these</q>), begin the list with a <code>^</code> character. For example, <code>[^0-9]</code> matches anything but digits.</p></li></ul><p>MySQL’s regular-expression capabilities also support POSIX character classes. These match specific
      character sets, as described in the <a data-type="xref" href="#nch-strings-strings-pat-regexp-posix">Table 7-5</a>:</p><table id="nch-strings-strings-pat-regexp-posix"><caption><span class="label">Table 7-5. </span>POSIX Regular Expressions Syntax</caption><thead><tr><th>POSIX class</th><th>What the class matches</th></tr></thead><tbody><tr><td><code>[:alnum:] </code></td><td>Alphabetic and numeric characters</td></tr><tr><td><code>[:alpha:] </code></td><td>Alphabetic characters</td></tr><tr><td><code>[:blank:] </code></td><td>Whitespace (space or tab characters)</td></tr><tr><td><code>[:cntrl:] </code></td><td>Control characters</td></tr><tr><td><code>[:digit:] </code></td><td>Digits</td></tr><tr><td><code>[:graph:] </code></td><td>Graphic (nonblank) characters</td></tr><tr><td><code>[:lower:] </code></td><td>Lowercase alphabetic characters</td></tr><tr><td><code>[:print:] </code></td><td>Graphic or space characters</td></tr><tr><td><code>[:punct:] </code></td><td>Punctuation characters</td></tr><tr><td><code>[:space:] </code></td><td>Space, tab, newline, carriage return</td></tr><tr><td><code>[:upper:] </code></td><td>Uppercase alphabetic characters</td></tr><tr><td><code>[:xdigit:] </code></td><td>Hexadecimal digits (<code>0-9</code>,
              <code>a-f</code>, <code>A-F</code>)</td></tr></tbody></table><p>POSIX classes are intended for use within character classes, so
      use them within square brackets. The following expression matches values
      that contain any hexadecimal digit character:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name, name REGEXP '[[:xdigit:]]' FROM metal;</code></strong>
+----------+----------------------------+
| name     | name REGEXP '[[:xdigit:]]' |
+----------+----------------------------+
| gold     |                          1 |
| iron     |                          0 |
| lead     |                          1 |
| mercury  |                          1 |
| platinum |                          1 |
| tin      |                          0 |
+----------+----------------------------+</pre><p>Regular expressions can specify alternations using this
      syntax:</p><pre data-type="programlisting"><em><code>alternative1</code></em>|<em><code>alternative2</code></em>|...</pre><p>An alternation is similar to a character class in the sense that it matches
      if any of the alternatives match. But unlike a character class, the
      alternatives are not limited to single characters. They can be
      multiple-character strings or even patterns. The following alternation
      matches strings that begin with a vowel or end with <code>d</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name FROM metal WHERE name REGEXP '^[aeiou]|d$';</code></strong>
+------+
| name |
+------+
| gold |
| iron |
| lead |
+------+</pre><p>Parentheses can be used to group alternations. For example, to match
      strings that consist entirely of digits or entirely of letters, you
      might try this pattern, using an alternation:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT '0m' REGEXP '^[[:digit:]]+|[[:alpha:]]+$';</code></strong>
+-------------------------------------------+
| '0m' REGEXP '^[[:digit:]]+|[[:alpha:]]+$' |
+-------------------------------------------+
|                                         1 |
+-------------------------------------------+</pre><p>However, as the query result shows, the pattern doesn’t work.
      That’s because the <code>^</code> groups with the
      first alternative, and the <code>$</code> groups
      with the second alternative. So the pattern actually matches strings
      that begin with one or more digits, or strings that end with one or more
      letters. If you group the alternatives within parentheses, the <code>^</code> and <code>$</code>
      apply to both of them, and the pattern acts as you expect:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT '0m' REGEXP '^([[:digit:]]+|[[:alpha:]]+)$';</code></strong>
+---------------------------------------------+
| '0m' REGEXP '^([[:digit:]]+|[[:alpha:]]+)$' |
+---------------------------------------------+
|                                           0 |
+---------------------------------------------+</pre><p>Unlike SQL pattern matches, which are successful only if the
      pattern matches the entire comparison value, regular expressions are
      successful if the pattern matches anywhere within the value. The
      following two pattern matches are equivalent in the sense that each one
      succeeds only for strings that contain a <code>b</code> character, but the first is more efficient
      because the pattern is simpler:</p><pre data-type="programlisting">'abc' REGEXP 'b'
'abc' REGEXP '^.*b.*$'</pre><p>Regular expressions do not match <code>NULL</code> values. This is true both for <code>REGEXP</code> and for <code>NOT</code> <code>REGEXP</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT NULL REGEXP '.*', NULL NOT REGEXP '.*';</code></strong>
+------------------+----------------------+
| NULL REGEXP '.*' | NULL NOT REGEXP '.*' |
+------------------+----------------------+
|             NULL |                 NULL |
+------------------+----------------------+</pre><p>Because a regular expression matches a string if the pattern is
      found anywhere in the string, you must take care not to inadvertently
      specify a pattern that matches the empty string. If you do, it matches
      any non-<code>NULL</code> value. For example, the
      pattern <code>a*</code> matches any number of
      <code>a</code> characters, even none. If your goal
      is to match only strings containing nonempty sequences of <code>a</code> characters, use <code>a+</code> instead. The <code>+</code> requires one or more instances of the
      preceding pattern element for a match.</p><p>As with SQL pattern matches performed using <code>LIKE</code>, regular-expression matches performed
      with <code>REGEXP</code> sometimes are equivalent
      to substring comparisons. As shown in the <a data-type="xref" href="#nch-strings-strings-pat-regexp-substr-comp">Table 7-6</a>, the <code>^</code> and <code>$</code>
      metacharacters serve much the same purpose as <code>LEFT()</code> or <code>RIGHT()</code>, at least if you’re looking for literal strings:</p><table id="nch-strings-strings-pat-regexp-substr-comp"><caption><span class="label">Table 7-6. </span>Regular Expressions versus Substring Comparison Functions</caption><thead><tr><th>Pattern match</th><th>Substring comparison</th></tr></thead><tbody><tr><td><em><code>str</code></em><code> REGEXP '^abc'</code></td><td><code>LEFT(</code><em><code>str</code></em><code>,3) = 'abc'</code></td></tr><tr><td><em><code>str</code></em><code> REGEXP 'abc$'</code></td><td><code>RIGHT(</code><em><code>str</code></em><code>,3) = 'abc'</code></td></tr></tbody></table><p>For nonliteral patterns, it’s typically not possible to construct
      an equivalent substring comparison. For example, to match strings that
      begin with any nonempty sequence of digits, use this pattern
      match:</p><pre data-type="programlisting"><em><code>str</code></em> REGEXP '^[0-9]+'
</pre><p>That is something that <code>LEFT()</code>
      cannot do (and neither can <code>LIKE</code>, for
      that matter).</p><p>Case sensitivity of a regular-expression match is like that of a
      string comparison. That is, it depends on whether the operands are
      binary or nonbinary strings, and for nonbinary strings, it depends on
      their collation. See <a data-type="xref" href="#nch-strings-strings-compare">Recipe 7.7</a> for
      discussion of how these factors apply to comparisons.</p><div data-type="note" epub:type="note"><h6>Note</h6><p>Prior version 8.0.4, regular expresisons worked only for single-byte character
        sets. In MySQL 8.0.4 this limitation was removed and now you can use regular expressions with multibyte character sets such as
        <code>utf8mb4</code> or <code>sjis</code>.</p></div></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.12 Reversing the string content"><div class="sect1" id="nch-strings-strings-combine"><h1>7.12 Reversing the string content</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372703840"><h2>Problem</h2><p>You want to modify a string, and find its reverse form.
      </p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372702864"><h2>Solution</h2><p>Use function <code>REVERSE()</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372701392"><h2>Discussion</h2><p>You can reverse a string or a sub-string by using 
          <code>REVERSE()</code> function. This function utilizes any string
          value into its reverse form by character. It’s also often used in <code>SELECT</code>
          statements like many other functions in this chapter. 
       </p><p> Syntax to use <code>REVERSE()</code> function:
      </p><pre data-type="programlisting"> REVERSE(expression)</pre><p>
      </p><p>Following examples are showing basic functionality of <code>REVERSE()</code>
      function:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT REVERSE("sports flow");</code></strong>
+------------------------+
| REVERSE("sports flow") |
+------------------------+
| wolf strops            |
+------------------------+</pre><pre data-type="programlisting">mysql&gt; <strong><code>SELECT REVERSE(0123456789);</code></strong>
+---------------------+
| REVERSE(0123456789) |
+---------------------+
| 987654321           |
+---------------------+</pre><pre data-type="programlisting">mysql&gt; <strong><code>SELECT REVERSE("0123456789");</code></strong>
+-----------------------+
| REVERSE("0123456789") |
+-----------------------+
| 9876543210            |
+-----------------------+</pre><p>The following example shows the when the expression is <code>numeric</code>
	 value the zero values is omitted by the function.</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT REVERSE(001122334455);</code></strong>
+-----------------------+
| REVERSE(001122334455) |
+-----------------------+
| 5544332211            |
+-----------------------+</pre><p>While we can reverse any expression we also have some words returns exactly the same 
      written in reverse known as Palindrome. For such strings function <code>REVERSE</code> will return string, equal to the original one.
      For example:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT REVERSE("STEP ON NO PETS");</code></strong>
+----------------------------+
| REVERSE("STEP ON NO PETS") |
+----------------------------+
| STEP ON NO PETS            |
+----------------------------+</pre><p>The broader example uses table <code>top_names</code> from the <em>recipes</em> distribution, that stores the most common used names.
	Among these names we will find out the number of palindromatic names.</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM top_names WHERE REVERSE(top_name) = top_name;</code></strong>
+----------+
| COUNT(*) |
+----------+
|      234 |
+----------+</pre><p>Just to get a sample from this count we can have a look names start with “U”.</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT top_name FROM top_names</code></strong>
    -&gt; <strong><code>WHERE REVERSE(top_name) = top_name</code></strong>
    -&gt; <strong><code>AND top_name LIKE "U%";</code></strong>
+----------+
| top_name |
+----------+
| ULU      |
| UTU      |
+----------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.13 Searching for Substrings"><div class="sect1" id="nch-strings-strings-substr"><h1>7.13 Searching for Substrings</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372683184"><h2>Problem</h2><p>You want to know whether a given string occurs within another
      string.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372682240"><h2>Solution</h2><p>Use <code>LOCATE()</code> or a pattern match.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372680656"><h2>Discussion</h2><p>The <code>LOCATE()</code> function takes two
      arguments representing the substring that you’re looking for and the
      string in which to look for it. The return value is the position at
      which the substring occurs, or <code>0</code> if
      it’s not present. An optional third argument may be given to indicate
      the position within the string at which to start looking.</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name, LOCATE('in',name), LOCATE('in',name,3) FROM metal;</code></strong>
+----------+-------------------+---------------------+
| name     | LOCATE('in',name) | LOCATE('in',name,3) |
+----------+-------------------+---------------------+
| gold     |                 0 |                   0 |
| iron     |                 0 |                   0 |
| lead     |                 0 |                   0 |
| mercury  |                 0 |                   0 |
| platinum |                 5 |                   5 |
| tin      |                 2 |                   0 |
+----------+-------------------+---------------------+</pre><p>To determine only whether the substring is present if you don’t
      care about its position, an alternative is to use <code>LIKE</code> or <code>REGEXP</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name, name LIKE '%in%', name REGEXP 'in' FROM metal;</code></strong>
+----------+------------------+------------------+
| name     | name LIKE '%in%' | name REGEXP 'in' |
+----------+------------------+------------------+
| gold     |                0 |                0 |
| iron     |                0 |                0 |
| lead     |                0 |                0 |
| mercury  |                0 |                0 |
| platinum |                1 |                1 |
| tin      |                1 |                1 |
+----------+------------------+------------------+</pre><p><code>LOCATE()</code>, <code>LIKE</code>, and <code>REGEXP</code> use the collation of their arguments to
      determine whether the search is case sensitive. <a data-type="xref" href="#nch-strings-strings-charset-checking-changing">Recipe 7.5</a> and <a data-type="xref" href="#nch-strings-strings-compare">Recipe 7.7</a>
      discuss changing the argument comparison properties if you want to
      change the search behavior.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.14 Breaking Apart or Combining Strings"><div class="sect1" id="nch-strings-strings-combine-break"><h1>7.14 Breaking Apart or Combining Strings</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372670016"><h2>Problem</h2><p>You want to extract a piece of a string or combine strings to form a larger
      string.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372668960"><h2>Solution</h2><p>To obtain a piece of a string, use a substring-extraction
      function. To combine strings, use <code>CONCAT()</code>.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372667488"><h2>Discussion</h2><p>You can break apart strings by using appropriate substring-extraction functions. For
      example, <code>LEFT()</code>, <code>MID()</code>, and <code>RIGHT()</code> extract substrings from the left,
      middle, or right part of a string:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @date = '2015-07-21';</code></strong>
mysql&gt; <strong><code>SELECT @date, LEFT(@date,4) AS year,</code></strong>
    -&gt; <strong><code>MID(@date,6,2) AS month, RIGHT(@date,2) AS day;</code></strong>
+------------+------+-------+------+
| @date      | year | month | day  |
+------------+------+-------+------+
| 2015-07-21 | 2015 | 07    | 21   |
+------------+------+-------+------+</pre><p>For <code>LEFT()</code> and <code>RIGHT()</code>, the second argument indicates how
      many characters to return from the left or right end of the string. For
      <code>MID()</code>, the second argument is the
      starting position of the substring you want (beginning from 1), and the
      third argument indicates how many characters to return.</p><p>The <code>SUBSTRING()</code> function takes
      a string and a starting position, returning everything to
      the right of the position. <code>MID()</code> acts
      the same way if you omit its third argument because <code>MID()</code> is actually a synonym for <code>SUBSTRING()</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @date = '2015-07-21';</code></strong>
mysql&gt; <strong><code>SELECT @date, SUBSTRING(@date,6), MID(@date,6);</code></strong>
+------------+--------------------+--------------+
| @date      | SUBSTRING(@date,6) | MID(@date,6) |
+------------+--------------------+--------------+
| 2015-07-21 | 07-21              | 07-21        |
+------------+--------------------+--------------+</pre><p>Use <code>SUBSTRING_INDEX(</code><em><code>str</code></em><code>,</code><em><code>c</code></em><code>,</code><em><code>n</code></em><code>)</code> to return everything to the right or left of a given
      character. It searches into a string <em><code>str</code></em> for
      the <em><code>n</code></em>-th occurrence of the character
      <em><code>c</code></em> and returns everything to its left. If
      <em><code>n</code></em> is negative, the search for
      <em><code>c</code></em> starts from the right and returns
      everything to the right of the character:</p><pre data-type="programlisting">mysql&gt; <strong><code>SET @email = 'postmaster@example.com';</code></strong>
mysql&gt; <strong><code>SELECT @email,</code></strong>
    -&gt; <strong><code>SUBSTRING_INDEX(@email,'@',1) AS user,</code></strong>
    -&gt; <strong><code>SUBSTRING_INDEX(@email,'@',-1) AS host;</code></strong>
+------------------------+------------+-------------+
| @email                 | user       | host        |
+------------------------+------------+-------------+
| postmaster@example.com | postmaster | example.com |
+------------------------+------------+-------------+</pre><p>If there is no <em><code>n</code></em>-th occurrence of the
      character, <code>SUBSTRING_INDEX()</code> returns
      the entire string. <code>SUBSTRING_INDEX()</code>
      is case sensitive.</p><p>You can use substrings for purposes other than display, such as to
      perform comparisons. The following statement finds metal names having a
      first letter that lies in the last half of the alphabet:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT name from metal WHERE LEFT(name,1) &gt;= 'n';</code></strong>
+----------+
| name     |
+----------+
| platinum |
| tin      |
+----------+</pre><p>To combine rather than pull apart strings, use the <code>CONCAT()</code> function. It concatenates its
      arguments and returns the result:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT CONCAT(name,' ends in "d": ',IF(name LIKE '%d','YES','NO'))</code></strong>
    -&gt; <strong><code>AS 'ends in "d"?'</code></strong>
    -&gt; <strong><code>FROM metal;</code></strong>
+--------------------------+
| ends in "d"?             |
+--------------------------+
| gold ends in "d": YES    |
| iron ends in "d": NO     |
| lead ends in "d": YES    |
| mercury ends in "d": NO  |
| platinum ends in "d": NO |
| tin ends in "d": NO      |
+--------------------------+</pre><p>Concatenation can be useful for modifying column values <q>in
      place.</q> For example, the following <code>UPDATE</code> statement adds a string to the end of
      each <code>name</code> value in the <code>metal</code> table:</p><pre data-type="programlisting">mysql&gt; <strong><code>UPDATE metal SET name = CONCAT(name,'ide');</code></strong>
mysql&gt; <strong><code>SELECT name FROM metal;</code></strong>
+-------------+
| name        |
+-------------+
| goldide     |
| ironide     |
| leadide     |
| mercuryide  |
| platinumide |
| tinide      |
+-------------+</pre><p>To undo the operation, strip the last three characters (the <code>CHAR_LENGTH()</code> function returns the length of a
      string in characters):</p><pre data-type="programlisting">mysql&gt; <strong><code>UPDATE metal SET name = LEFT(name,CHAR_LENGTH(name)-3);</code></strong>
mysql&gt; <strong><code>SELECT name FROM metal;</code></strong>
+----------+
| name     |
+----------+
| gold     |
| iron     |
| lead     |
| mercury  |
| platinum |
| tin      |
+----------+</pre><p>The concept of modifying a column in place can be applied to <code>ENUM</code> or
      <code>SET</code> values as well, which usually can
      be treated as string values even though they are stored internally as
      numbers. For example, to concatenate a <code>SET</code> element to an existing <code>SET</code> column, use <code>CONCAT()</code> to add the new value to the existing
      value, preceded by a comma. But remember to account for the possibility
      that the existing value might be <code>NULL</code>. In that case, set the column value equal
      to the new element, without the leading comma:</p><pre data-type="programlisting" data-code-language="sql">UPDATE <em><code>tbl_name</code></em>
SET <em><code>set_col</code></em> = IF(<em><code>set_col</code></em> IS NULL,<em><code>val</code></em>,CONCAT(<em><code>set_col</code></em>,',',<em><code>val</code></em>));</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.15 Using Full-Text Searches"><div class="sect1" id="nch-strings-strings-full-text-intro"><h1>7.15 Using Full-Text Searches</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372625184"><h2>Problem</h2><p>You want to search long text columns.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372624160"><h2>Solution</h2><p>Use a <code>FULLTEXT</code> index.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372622768"><h2>Discussion</h2><p>Pattern matches enable you to look through any number of rows, but
      as the amount of text goes up, the match operation can become quite
      slow. It’s also a common task to search for the same text in several
      string columns, but with pattern matching, that results in unwieldy
      queries:</p><pre data-type="programlisting" data-code-language="sql">SELECT * from <em><code>tbl_name</code></em>
WHERE <em><code>col1</code></em> LIKE '<em><code>pat%</code></em>' OR <em><code>col2</code></em> LIKE '<em><code>pat%</code></em>' OR <em><code>col3</code></em> LIKE '<em><code>pat%</code></em>' ...</pre><p>A useful alternative is full-text searching, which is designed for
      looking through large amounts of text and can search multiple columns
      simultaneously. To use this capability, add a <code>FULLTEXT</code> index to your table, and then use the
      <code>MATCH</code> operator to look for strings in the indexed column or columns.
      <code>FULLTEXT</code> indexing can be used with
      MyISAM tables or InnoDB tables
      for nonbinary string data types (<code>CHAR</code>, <code>VARCHAR</code>, or <code>TEXT</code>).</p><p>Full-text searching is best illustrated with a reasonably
      good-sized body of text. If you don’t have a sample dataset, you can
      find several repositories of freely available electronic text on the
      Internet. For the examples here, the one we’ve chosen is the sample
      dump of the Amazon review data (2018), which is both available for public to 
      download and scrape from <a href="https://nijianmo.github.io/amazon/index.html"> 
      Amazon Review Data (2018).</a> Because of its size, this dataset is not included with the <code>recipes</code> distribution, but is available
      separately as instructions at GitHub repository.
      The <code>Amazon</code> distribution includes a file named
      <em class="filename">Appliances_5.json</em> that contains the product reviews 
      for each category. This is subset of larger datasets. As most text-based data are found on the Internet,
      this data is only available in <code>JSON</code> data format. Some sample records look like this:</p><pre data-type="programlisting">{
      "overall":        2.0,
      "verified":       false,
      "reviewTime":     "07 6, 2017",
      "reviewerID":     "A3LGZ8M29PBNGG",
      "asin":           "B000N6302Q",
      "style":          {"Color:": " Stainless Steel"},
      "reviewerName":   "nerenttt",
      "reviewText":     "Luved it for the few months it worked!↩
                         great little diamond ice cubes...",
      "unixReviewTime": 1499299200
}</pre><p>What we are interested in here is <code>reviewText</code> field which has the large body of text
      we are looking to examine.</p><p>Each record contains the following fields:</p><ul><li><p><code>overall</code> rating of the product</p></li><li><p><code>verified</code> purchase verification flag</p></li><li><p><code>reviewTime</code> date of the review</p></li><li><p><code>reviewerID</code> - ID of the reviewer(<code>O</code> or <code>N</code>), e.g. A2SUAM1J3GNN3B</p></li><li><p><code>asin</code> - ID of the product, e.g. 0000013714 </p></li><li><p><code>style</code> a discretionary of the product metadata</p></li><li><p><code>reviewerName</code> name of the reviewer</p></li><li><p><code>reviewText</code> text of the review</p></li><li><p><code>unixReviewTime</code> time of the review (unix time)</p></li></ul><p>To import the records into MySQL, create a table named <code>reviews</code> that looks like this:</p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> <code class="p">(</code>  
   <code class="o">`</code><code class="n">id</code><code class="o">`</code> <code class="nb">BIGINT</code> <code class="n">UNSIGNED</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
   <code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="n">JSON</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
     <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="o">`</code><code class="n">id</code><code class="o">`</code><code class="p">)</code>
<code class="p">);</code></pre><p>In order to load <code>json</code> data to this table we could have used 
      MySQL built-in json functions which is later covered in <a data-type="xref" href="ch13.xhtml#nch-xfer-xfer-importjson">Recipe 13.17</a>.
      On some cases of large text data can include escape characters such as end of line <code>/n/n</code>
      which breaks the import functions to work. To overcome we’ll use simple script to load the data 
      which is provided in GitHub repository called <code>load_amazon_reviews.py</code>.</p><p>After loading the data we will convert the <code>reviewText</code> column as 
      generated column and add <code>FULLTEXT</code> index
      to enable its use in full-text searching.</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> <code class="k">ADD</code> <code class="k">COLUMN</code> <code class="o">`</code><code class="n">reviews_virtual</code><code class="o">`</code> <code class="nb">TEXT</code> 
<code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="o">-&gt;&gt;</code> <code class="s1">'$.reviewText'</code><code class="p">)</code> <code class="n">STORED</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">;</code>
<code class="k">ALTER</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> <code class="k">ADD</code> <code class="n">FULLTEXT</code> <code class="n">idx_ft_json</code><code class="p">(</code><code class="n">reviews_virtual</code><code class="p">);</code></pre><p>The table has now <code>FULLTEXT</code> index
      to enable its use in full-text searching. </p><p>After creating the <code>reviews</code> table,
      load the <em class="filename">Appliances_5.json</em> file into it using
      this statement:</p><pre data-type="programlisting" data-code-language="bash"> <strong><code>python3 load_amazon_reviews.py Appliances_5.json</code></strong></pre><p>You’ll notice that the <code>reviews</code>
      table contains columns both for complete <code>appliences_review</code> data as well as 
      <code>reviews_virtual</code> to demonstrate the <code>FULLTEXT</code> index.
      </p><pre data-type="programlisting" data-code-language="sql"><code class="k">CREATE</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> <code class="p">(</code>
  <code class="o">`</code><code class="n">id</code><code class="o">`</code> <code class="nb">bigint</code> <code class="n">unsigned</code> <code class="k">NOT</code> <code class="k">NULL</code> <code class="n">AUTO_INCREMENT</code><code class="p">,</code>
  <code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="n">json</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="o">`</code><code class="n">reviews_virtual</code><code class="o">`</code> <code class="nb">text</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> 
    <code class="p">(</code><code class="n">json_unquote</code><code class="p">(</code><code class="n">json_extract</code><code class="p">(</code><code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code><code class="p">,</code><code class="n">_utf8mb4</code><code class="s1">'$.reviewText'</code><code class="p">)))</code> 
  <code class="n">STORED</code> <code class="k">NOT</code> <code class="k">NULL</code><code class="p">,</code>
  <code class="k">PRIMARY</code> <code class="k">KEY</code> <code class="p">(</code><code class="o">`</code><code class="n">id</code><code class="o">`</code><code class="p">),</code>
  <code class="n">FULLTEXT</code> <code class="k">KEY</code> <code class="o">`</code><code class="n">idx_ft_json</code><code class="o">`</code> <code class="p">(</code><code class="o">`</code><code class="n">reviews_virtual</code><code class="o">`</code><code class="p">)</code>
<code class="p">)</code> <code class="n">ENGINE</code><code class="o">=</code><code class="n">InnoDB</code> <code class="n">AUTO_INCREMENT</code><code class="o">=</code><code class="mi">2278</code> <code class="k">DEFAULT</code> <code class="n">CHARSET</code><code class="o">=</code><code class="n">utf8mb4</code> <code class="k">COLLATE</code><code class="o">=</code><code class="n">utf8mb4_0900_ai_ci</code><code class="p">;</code></pre><p>To perform a search using the <code>FULLTEXT</code> index, use <code>MATCH()</code> to name the indexed column and
      <code>AGAINST()</code> to specify what text to look for. For example, you might wonder,
      <q>How many times does the word “awesome” occur?</q> To answer
      that question, search the <code>reviews_virtual</code>
      column using this statement:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) from reviews WHERE MATCH(reviews_virtual) AGAINST('awesome');</code></strong>
+----------+
| COUNT(*) |
+----------+
|        3 |
+----------+</pre><p>To verify <code>FULLTEXT</code> index was used
      </p><pre data-type="programlisting">mysql&gt; <strong><code>EXPLAIN select reviews_virtual from reviews WHERE MATCH(reviews_virtual) 
    -&gt; AGAINST('awesome') \G</code></strong>
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: reviews
   partitions: NULL
         type: fulltext
possible_keys: idx_ft_json
          key: idx_ft_json
      key_len: 0
          ref: const
         rows: 1
     filtered: 100.00
        Extra: Using where; Ft_hints: sorted</pre><p>To find out which products had the keyword “excellent” in <code>reviews</code> are, select the columns you want to
      see (the example here truncates the <code>reviews_virtual</code> column and uses <code>\G</code> so the results better fit the page):</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT JSON_EXTRACT(appliences_review, "$.reviewerID") as ReviwerID, </code></strong>
    -&gt; <strong><code>JSON_EXTRACT(appliences_review, "$.asin") as ProductID,</code></strong>
    -&gt; <strong><code>JSON_EXTRACT(appliences_review, "$.overall") as Rating</code></strong>
    -&gt; <strong><code>from reviews WHERE MATCH(reviews_virtual) AGAINST('excellent') \G</code></strong>
*************************** 1. row ***************************
ReviwerID: "A2CIEGHZ7L1WWR"
ProductID: "B00009W3PA"
   Rating: 5.0
*************************** 2. row ***************************
ReviwerID: "A1T1YSCDW0PD25"
ProductID: "B0013DN4NI"
   Rating: 5.0
*************************** 3. row ***************************
ReviwerID: "A1T1YSCDW0PD25"
ProductID: "B0013DN4NI"
   Rating: 5.0
*************************** 4. row ***************************
ReviwerID: "A26M3TN8QICJ3K"
ProductID: "B004XLDE5A"
   Rating: 5.0
*************************** 5. row ***************************
ReviwerID: "A2CIEGHZ7L1WWR"
ProductID: "B004XLDHSE"
   Rating: 5.0</pre><p>By default, full-text searches compute a
      relevance ranking and use it for sorting. To make sure a search result
      is sorted the way you want, add an explicit <code>ORDER</code> <code>BY</code> clause:</p><pre data-type="programlisting" data-code-language="sql">SELECT reviews_virtual
FROM reviews WHERE MATCH(reviews_virtual) AGAINST('<em><code>search string</code></em>')
ORDER BY {column}, {column};</pre><p>To see the relevance ranking, repeat the <code>MATCH()</code> … <code>AGAINST()</code> expression in the output column
      list.</p><p>To narrow the search further, include additional criteria. To provide additional 
      fields in the search we’ll add the following virtual columns from <code>json</code> extract. 
      	</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> 
    <code class="o">-&gt;</code> <code class="k">ADD</code> <code class="k">COLUMN</code> <code class="o">`</code><code class="n">reviews_virtual_vote</code><code class="o">`</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code> 
    <code class="o">-&gt;</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="o">-&gt;&gt;</code> <code class="s1">'$.vote'</code><code class="p">)</code> <code class="n">STORED</code><code class="p">;</code></pre><p>
</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> 
    <code class="o">-&gt;</code> <code class="k">ADD</code> <code class="k">COLUMN</code> <code class="o">`</code><code class="n">reviews_virtual_overall</code><code class="o">`</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code> 
    <code class="o">-&gt;</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="o">-&gt;&gt;</code> <code class="s1">'$.overall'</code><code class="p">)</code> <code class="n">STORED</code><code class="p">;</code></pre><p>
</p><pre data-type="programlisting" data-code-language="sql"><code class="k">ALTER</code> <code class="k">TABLE</code> <code class="o">`</code><code class="n">reviews</code><code class="o">`</code> 
    <code class="o">-&gt;</code> <code class="k">ADD</code> <code class="k">COLUMN</code> <code class="o">`</code><code class="n">reviews_virtual_verified</code><code class="o">`</code> <code class="nb">VARCHAR</code><code class="p">(</code><code class="mi">10</code><code class="p">)</code> 
    <code class="o">-&gt;</code> <code class="k">GENERATED</code> <code class="n">ALWAYS</code> <code class="k">AS</code> <code class="p">(</code><code class="o">`</code><code class="n">appliences_review</code><code class="o">`</code> <code class="o">-&gt;&gt;</code> <code class="s1">'$.verified'</code><code class="p">)</code> <code class="n">STORED</code><code class="p">;</code></pre><p>
      The following queries perform progressively more specific searches to
      determine how often each keyword occurs.</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT count(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good');</code></strong>
+----------+
| COUNT(*) |
+----------+
|      855 |
+----------+
mysql&gt; <strong><code>SELECT count(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good')</code></strong>
    -&gt; <strong><code>AND reviews_virtual_vote &gt; 5;</code></strong>
+----------+
| COUNT(*) |
+----------+
|      620 |
+----------+
mysql&gt; <strong><code>SELECT COUNT(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good')</code></strong>
    -&gt; <strong><code>AND reviews_virtual_overall = 5;</code></strong>
+----------+
| COUNT(*) |
+----------+
|      646 |
+----------+
mysql&gt; <strong><code>SELECT COUNT(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good')</code></strong>
    -&gt; <strong><code>AND reviews_virtual_overall = 5 AND reviews_virtual_verified = "True";</code></strong>
+----------+
| COUNT(*) |
+----------+
|      645 |
+----------+</pre><p>If you expect to use search criteria frequently that include other
      non-<code>FULLTEXT</code> columns, add regular
      indexes to those columns so that queries perform better. For example, to
      index the vote, overall rating and verified columns, do this:</p><pre data-type="programlisting">mysql&gt; <strong><code>ALTER TABLE reviews ADD INDEX idx_vote (reviews_virtual_vote),
    -&gt;  ADD INDEX idx_overall(reviews_virtual_overall), 
    -&gt;  ADD INDEX idx_verified(reviews_virtual_verified);</code></strong></pre><p>Search strings in full-text queries can include more than one
      word, and you might suppose that adding words would make a search more
      specific. But in fact that widens it because a full-text search returns
      rows that contain any of the words. In effect, the query performs an
      <code>OR</code> search for any of the words. The
      following queries illustrate this; they identify successively larger
      numbers of reviews as additional search words are added:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('excellent');</code></strong>
+----------+
| COUNT(*) |
+----------+
|      11  |
+----------+
mysql&gt; <strong><code>SELECT COUNT(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('excellent product');</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1480 |
+----------+
mysql&gt; <strong><code>SELECT COUNT(*) from reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_text) AGAINST('excellent product for home');</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1486 |
+----------+</pre><p>To perform a search for which each word in the search string must
      be present, see <a data-type="xref" href="#nch-strings-strings-full-text-boolean">Recipe 7.17</a>.</p><p>To use full-text searches that look through multiple columns
      simultaneously, name all the columns when you construct the <code>FULLTEXT</code> index:</p><pre data-type="programlisting" data-code-language="sql">ALTER TABLE <em><code>tbl_name</code></em> ADD FULLTEXT (<em><code>col1</code></em>, <em><code>col2</code></em>, <em><code>col3</code></em>);</pre><p>To issue a search query that uses the index, name those same
      columns in the <code>MATCH()</code> list:</p><pre data-type="programlisting" data-code-language="sql">SELECT ... FROM <em><code>tbl_name</code></em>
WHERE MATCH(<em><code>col1</code></em>, <em><code>col2</code></em>, <em><code>col3</code></em>) AGAINST('<em><code>search string</code></em>');</pre><p>You need one such <code>FULLTEXT</code>
      index for each distinct combination of columns that you want to
      search.</p></div></section><section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45820372621984"><h2>See Also</h2><p>For further information on <code>FULLTEXT</code> indexing see <a data-type="xref" href="ch21.xhtml#nch-queryperf-queryperf-fulltext">Recipe 21.9</a>.
      </p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.16 Using a Full-Text Search with Short Words"><div class="sect1" id="nch-strings-strings-full-text-wordlen"><h1>7.16 Using a Full-Text Search with Short Words</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372129328"><h2>Problem</h2><p>Your full-text searches for short words return no rows.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372128288"><h2>Solution</h2><p>Change the indexing engine’s minimum word length parameter.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372127344"><h2>Discussion</h2><p>In a text like the <code>reviews</code>, certain words have special significance,
      such as <q>ok</q> and <q>up</q>. You might want to
      check fulltext index server variables first to make sure minimum length is satisfied by the
      engine.</p><pre data-type="programlisting">mysql&gt; <strong><code>SHOW GLOBAL VARIABLES LIKE 'innodb_ft_%';</code></strong>
+---------------------------------+------------+
| Variable_name                   | Value      |
+---------------------------------+------------+
| innodb_ft_aux_table             |            |
| innodb_ft_cache_size            | 8000000    |
| innodb_ft_enable_diag_print     | OFF        |
| innodb_ft_enable_stopword       | ON         |
| innodb_ft_max_token_size        | 84         |
| innodb_ft_min_token_size        | 3          |
| innodb_ft_num_word_optimize     | 2000       |
| innodb_ft_result_cache_limit    | 2000000000 |
| innodb_ft_server_stopword_table |            |
| innodb_ft_sort_pll_degree       | 2          |
| innodb_ft_total_cache_size      | 640000000  |
| innodb_ft_user_stopword_table   |            |
+---------------------------------+------------+
mysql&gt; <strong><code>SELECT count(*) FROM reviews WHERE MATCH(reviews_virtual) AGAINST('ok');</code></strong>
+----------+
| count(*) |
+----------+
|       0  |
+----------+
<strong><code>SELECT count(*) FROM reviews WHERE MATCH(reviews_virtual) AGAINST('up');
+----------+
| count(*) |
+----------+
|       0  |
+----------+</code></strong></pre><p>One property of the indexing engine is that it ignores words that
      are <q>too common</q> (that is, words that occur in more than
      half the rows). This eliminates words such as <q>the</q> or
      <q>and</q> from the index, but that’s not what is going on here.
      You can verify that by counting the total number of rows, and by using
      SQL pattern matches to count the number of rows containing each word
      (see <a data-type="xref" href="ch10.xhtml#nch-sum-sum-basic-count">Recipe 10.1</a> regarding the use of <code>COUNT()</code> to produce multiple counts from the same set of
      values):</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) AS Total_Reviews,</code></strong>
    -&gt; <strong><code>COUNT(IF(reviews_virtual LIKE '%good%',1,NULL)) AS Good_Reviews,</code></strong>
    -&gt; <strong><code>COUNT(IF(reviews_virtual LIKE '%great%',1,NULL)) AS Great_Reviews,</code></strong>
    -&gt; <strong><code>COUNT(IF(reviews_virtual LIKE '%excellent%',1,NULL)) AS Excellent_Reviews</code></strong>
    -&gt; <strong><code>FROM reviews;</code></strong>
+---------------+--------------+---------------+-------------------+
| Total_Reviews | Good_Reviews | Great_Reviews | Excellent_Reviews |
+---------------+--------------+---------------+-------------------+
|          2277 |          855 |          1095 |                11 |
+---------------+--------------+---------------+-------------------+</pre><p>
      InnoDB full-text indexing engine doesn’t include words less than three
      characters long. The minimum word length is a configurable parameter; to
      change it, set the <code>ft_min_word_len</code>
      for MyISAM  <code>innodb_ft_min_token_size</code> for InnoDB storage
      engine system variable. For example, to tell the indexing engine to include
      words as short as three characters, add a line to the <code>[mysqld]</code> group of the <em class="filename">/etc/my.cnf</em> file (or whatever option file you
      use for server settings):</p><pre data-type="programlisting">[mysqld]
ft_min_word_len=2 ##MyISAM
innodb_ft_min_token_size=2 ##InnoDB</pre><p>After making this change, restart the server. Next, rebuild the
      <code>FULLTEXT</code> index to take advantage of show
      the new setting first set the <code>innodb_optimize_fulltext_only</code>
      parameter and run <code>OPTIMIZE</code> operation. </p><pre data-type="programlisting">mysql&gt; <strong><code>SET GLOBAL innodb_optimize_fulltext_only=ON;</code></strong></pre><pre data-type="programlisting">mysql&gt; <strong><code>OPTIMIZE TABLE reviews;</code></strong></pre><p>
       For MyISAM, additionally run <span class="command"><em>REPAIR TABLE</em></span> command:
     </p><pre data-type="programlisting">mysql&gt; <strong><code>REPAIR TABLE reviews QUICK;</code></strong></pre><p>You should also use <code>REPAIR</code>
      <code>TABLE</code> to rebuild the indexes for all other MyISAM tables that have
      <code>FULLTEXT</code> indexes.</p><p>Finally, try the new index to verify that it includes shorter
      words:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT count(*) from reviews WHERE MATCH(reviews_virtual) AGAINST('ok');</code></strong>
+----------+
| count(*) |
+----------+
|       10 |
+----------+
mysql&gt; <strong><code>SELECT count(*) from reviews WHERE MATCH(reviews_virtual) AGAINST('up');</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1449 |
+----------+</pre></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.17 Requiring or Prohibiting Full-Text Search Words"><div class="sect1" id="nch-strings-strings-full-text-boolean"><h1>7.17 Requiring or Prohibiting Full-Text Search Words</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372102080"><h2>Problem</h2><p>You want to require or prohibit specific words in a full-text search.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372101168"><h2>Solution</h2><p>Use a Boolean mode search.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372100144"><h2>Discussion</h2><p>Normally, full-text searches return rows that contain any of the
      words in the search string, even if some of them are missing. For
      example, the following statement finds rows that contain either of the
      words <q>good</q> or <q>great</q>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good great');</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1330 |
+----------+</pre><p>This behavior is undesirable if you want only rows that contain
      both words. One way to do this is to rewrite the statement to look for
      each word separately and join the conditions with <code>AND</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('good')</code></strong>
    -&gt; <strong><code>AND MATCH(reviews_virtual) AGAINST('great');</code></strong>
+----------+
| COUNT(*) |
+----------+
|      620 |
+----------+</pre><p>An easier way to require multiple words is with a Boolean mode
      search. To do this, precede each word in the search string with a
      <code>+</code> character and add <code>IN</code> <code>BOOLEAN</code> <code>MODE</code> after the string:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('+good +great' IN BOOLEAN MODE);</code></strong>
+----------+
| COUNT(*) |
+----------+
|     620  |
+----------+</pre><p>Boolean mode searches also permit you to exclude words by
      preceding each one with a <code>-</code>
      character. The following queries select <code>reviews</code> rows containing the name <q>good</q> but not
      <q>great</q>, and vice versa:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('+good -great' IN BOOLEAN MODE);</code></strong>
+----------+
| COUNT(*) |
+----------+
|      235 |
+----------+
mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('-good +great' IN BOOLEAN MODE);</code></strong>
+----------+
| COUNT(*) |
+----------+
|      475 |
+----------+</pre><p>Another useful special character in Boolean searches is <code>*</code>; when appended to
      a search word, it acts as a wildcard operator. The following statement
      finds rows containing not only <code>use</code>,
      but also words such as <code>user</code>,
      <code>useful</code>, and <code>useless</code>:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('use*' IN BOOLEAN MODE);</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1475 |
+----------+</pre><p>For the complete list of Boolean full-text operators, see the <a href="https://dev.mysql.com/doc/refman/8.0/en/fulltext-boolean.html">MySQL Reference
      Manual</a>.</p></div></section></div></section><section data-type="sect1" data-pdf-bookmark="7.18 Performing Full-Text Phrase Searches"><div class="sect1" id="nch-strings-strings-full-text-phrase"><h1>7.18 Performing Full-Text Phrase Searches</h1><section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45820372077456"><h2>Problem</h2><p>You want to perform a full-text search for a phrase; that is, for words that
      occur adjacent to each other and in a specific order.</p></div></section><section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45820372076512"><h2>Solution</h2><p>Use the full-text phrase-search capability.</p></div></section><section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45820372075504"><h2>Discussion</h2><p>To find rows that contain a particular phrase, a simple full-text
      search doesn’t work:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('great product');</code></strong>
+----------+
| COUNT(*) |
+----------+
|     1725 |
+----------+</pre><p>The query returns a result, but not the one you’re looking for. A
      full-text search computes a relevance ranking based on the presence of
      each word individually, no matter where it occurs within the <code>reviews_virtual</code> column, and the ranking is nonzero as
      long as any of the words are present. Consequently, that kind of
      statement tends to find too many rows.</p><p>Instead, use full-text Boolean mode, which supports phrase
      searching. Enclose the phrase in double quotes within the search
      string:</p><pre data-type="programlisting">mysql&gt; <strong><code>SELECT COUNT(*) FROM reviews</code></strong>
    -&gt; <strong><code>WHERE MATCH(reviews_virtual) AGAINST('"great product"' IN BOOLEAN MODE);</code></strong>
+----------+
| COUNT(*) |
+----------+
|      216 |
+----------+</pre><p>A phrase match succeeds if a column contains the same words as in
      the phrase, in the order specified.</p></div></section></div></section></div></section></div></body></html>