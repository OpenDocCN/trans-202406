<html><head></head><body><section data-pdf-bookmark="Chapter 6. Incorporating External Data" data-type="chapter" epub:type="chapter"><div class="chapter" id="unique_chapter_id_05">&#13;
<h1><span class="label">Chapter 6. </span>Incorporating External Data</h1>&#13;
&#13;
&#13;
<p>The previous chapters prepared you for the essentials of working with components, including passing data between components and handling data changes and events within components. You are now ready to use Vue components to incorporate and represent your application’s data on the screen to your users.</p>&#13;
&#13;
<p>In most cases, an application will not have data available within the application itself. Instead, we usually request the data from an external server or database, then populate the proper UI with the received data for our application. This chapter covers this aspect of developing a robust Vue application: how to communicate and handle external data from an external resource using Axios as the HTTP request tool.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What Is Axios?" data-type="sect1"><div class="sect1" id="id73">&#13;
<h1>What Is Axios?</h1>&#13;
&#13;
<p>For making HTTP requests to external resources, various options are available for Vue developers, including the built-in <code>fetch</code> method, the classic <code>XMLHttpRequest</code>, and third-party libraries such as Axios. While the built-in <code>fetch</code> is a good option for making HTTP requests for fetching data only, Axios, in the long term, provides extra functionalities that come in handy when working with more complex external resources’ API handling<a data-primary="Axios" data-secondary="external data incorporation with" data-type="indexterm" id="ix-comp-incorp1"/><a data-primary="data" data-secondary="external data incorporation with Axios" data-type="indexterm" id="ix-comp-incorp1a"/><a data-primary="Axios" data-secondary="advantages" data-type="indexterm" id="id1093"/><a data-primary="Axios" data-secondary="fetch and" data-type="indexterm" id="id1094"/><a data-primary="fetch" data-secondary="Axios and" data-type="indexterm" id="id1095"/><a data-primary="XMLHttpRequest" data-type="indexterm" id="id1096"/>.</p>&#13;
&#13;
<p>Axios is a JavaScript open source lightweight library for making HTTP requests. Like <code>fetch</code>, it is a promise-based HTTP client and isomorphic, supporting both node (server-side) and browser side.</p>&#13;
&#13;
<p>Some significant advantages of using Axios are the ability to intercept and cancel HTTP requests and its built-in cross-site request forgery protection for the client side. Another advantage of Axios is that it automatically transforms the response data to JSON format, giving you a better developer experience in working with the data than using the built-in <code>fetch</code><a data-primary="Cross-Site Request Forgery" data-type="indexterm" id="id1097"/><a data-primary="security" data-secondary="Cross-Site Request Forgery" data-type="indexterm" id="id1098"/><a data-primary="security" data-secondary="Axios and" data-type="indexterm" id="id1099"/><a data-primary="JSON and Axios" data-type="indexterm" id="id1100"/>.</p>&#13;
&#13;
<p>The <a href="https://oreil.ly/WxSN3">official website for Axios</a> includes API documentation, installation, and primary use cases for reference (<a data-type="xref" href="#figure_06_01">Figure 6-1</a>).</p>&#13;
&#13;
<figure><div class="figure" id="figure_06_01">&#13;
<img alt="Screenshot of Axios Official Website" src="assets/lvue_0601.png"/>&#13;
<h6><span class="label">Figure 6-1. </span>Axios official website</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Installing Axios" data-type="sect1"><div class="sect1" id="id74">&#13;
<h1>Installing Axios</h1>&#13;
&#13;
<p>To add Axios to your Vue project within your project’s root directory, use the following command in your terminal<a data-primary="installing" data-secondary="Axios" data-type="indexterm" id="id1101"/><a data-primary="Axios" data-secondary="installing" data-type="indexterm" id="id1102"/>:</p>&#13;
&#13;
<pre data-code-language="bash" data-type="programlisting">yarn<code class="w"> </code>add<code class="w"> </code>axios<code class="w"/></pre>&#13;
&#13;
<p>Once Axios is installed, you can import the Axios library into your component where needed with the following code:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">axios</code> <code class="nx">from</code> <code class="s1">'axios'</code><code class="p">;</code></pre>&#13;
&#13;
<p>You then can use <code>axios</code> to start querying for your application’s data. Let’s explore how to combine Axios with lifecycle hooks to load and display data<a data-primary="data" data-secondary="loading with Axios" data-type="indexterm" id="ix-comp-incorp2a"/><a data-primary="lifecycle hooks" data-secondary="loading data with Axios" data-type="indexterm" id="ix-comp-incorp3"/><a data-primary="beforeCreate() hook" data-secondary="loading data with Axios" data-type="indexterm" id="id1103"/><a data-primary="beforeMounted() hook" data-type="indexterm" id="id1104"/><a data-primary="created() hook" data-secondary="data loading with Axios and" data-type="indexterm" id="id1105"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Load Data with Lifecycle Hooks and Axios" data-type="sect1"><div class="sect1" id="id75">&#13;
<h1>Load Data with Lifecycle Hooks and Axios</h1>&#13;
&#13;
<p>As you learned in <a data-type="xref" href="ch03.html#unique_chapter_id_03">Chapter 3</a>, you can use the <code>beforeCreate</code>, <code>created</code>, and <code>beforeMounted</code> lifecycle hooks to perform side calls such as data fetching. However, in a scenario where you need to load external data and use it within the component and use Options API, <code>beforeCreate</code> is not an option. Vue ignores any data assignment using <code>beforeCreate</code> since it hasn’t initialized any reactive data yet. Using <code>created</code> and <code>beforeMounted</code> is a better choice in this case. However, <code>beforeMounted</code> is not &#13;
<span class="keep-together">available</span> in server-side rendering, and if we want to use the Composition API (covered in <a data-type="xref" href="ch05.html#unique_chapter_id_06">Chapter 5</a>), there is no equivalent lifecycle function in Composition API to the <code>created</code> hook.</p>&#13;
&#13;
<p>A better option for loading external data is to use <code>setup()</code> or <code>&lt;script setup&gt;</code> with the respective reactive composition functions<a data-primary="setup hook" data-secondary="loading data with Axios" data-type="indexterm" id="id1106"/>.</p>&#13;
&#13;
<p>Let’s make an asynchronous GET request to get the public information about my GitHub profile through the URL <em><a class="bare" href="https://api.github.com/users/mayashavin"><em class="hyperlink">https://api.github.com/users/mayashavin</em></a></em> by using the <code>axios.get()</code> method, as seen in the following code:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**UserProfile.vue */</code>&#13;
<code class="kr">import</code> <code class="nx">axios</code> <code class="nx">from</code> <code class="s1">'axios'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">ref</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'vue'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">ref</code><code class="p">(</code><code class="kc">null</code><code class="p">);</code>&#13;
&#13;
<code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'https://api.github.com/users/mayashavin'</code><code class="p">)</code>&#13;
    <code class="p">.</code><code class="nx">then</code><code class="p">(</code><code class="nx">response</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
        <code class="nx">user</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code>&#13;
    <code class="p">});</code></pre>&#13;
&#13;
<p><code>axios.get()</code> returns a promise, which can use the promise chaining method <code>then()</code> to handle the response data when it resolves. Axios automatically parses the response data from the HTTP response body into the appropriate JSON format. In this example, we assign the received data to the <code>user</code> data property of the component. We can also rewrite this code to use <code>await/async</code> syntax<a data-primary="then(), loading data with Axios" data-type="indexterm" id="id1107"/><a data-primary="asynchronous calls" data-secondary="loading data with Axios" data-type="indexterm" id="id1108"/><a data-primary="Promises" data-secondary="loading data with Axios" data-type="indexterm" id="id1109"/>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**UserProfile.vue */</code>&#13;
<code class="c1">//...</code>&#13;
&#13;
<code class="nx">async</code> <code class="kd">function</code> <code class="nx">getUser</code><code class="p">()</code> <code class="p">{</code>&#13;
    <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code>&#13;
        <code class="s1">'https://api.github.com/users/mayashavin'</code>&#13;
    <code class="p">);</code>&#13;
    <code class="nx">user</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">getUser</code><code class="p">();</code></pre>&#13;
&#13;
<p>We also should wrap the code in a <code>try/catch</code> block to handle any errors that may occur during the request. Hence, our code becomes<a data-primary="errors" data-secondary="loading data with Axios" data-type="indexterm" id="id1110"/><a data-primary="try/catch blocks, loading data with Axios" data-type="indexterm" id="id1111"/>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**UserProfile.vue */</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="nx">axios</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'axios'</code><code class="p">;</code><code>&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">ref</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s1">'vue'</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="kr">const</code><code> </code><code class="nx">user</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="p">;</code><code>&#13;
</code><code class="kr">const</code><code> </code><code class="nx">error</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO1-1" id="co_incorporating_external_data_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
&#13;
</code><code class="nx">async</code><code> </code><code class="kd">function</code><code> </code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="k">try</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO1-2" id="co_incorporating_external_data_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="p">(</code><code class="s1">'https://api.github.com/users/mayashavin'</code><code class="p">)</code><code class="p">;</code><code>&#13;
&#13;
        </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code><code>&#13;
    </code><code class="p">}</code><code> </code><code class="k">catch</code><code> </code><code class="p">(</code><code class="nx">error</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">error</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO1-3" id="co_incorporating_external_data_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO1-1" id="callout_incorporating_external_data_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Add an <code>error</code> data property to store any error received from the request.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO1-2" id="callout_incorporating_external_data_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Wrap the code in a <code>try/catch</code> block to handle any errors that occur during the request.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO1-3" id="callout_incorporating_external_data_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Assign the error to the <code>error</code> data property, for displaying an error message to the user in the browser.</p></dd>&#13;
</dl>&#13;
&#13;
<p>GitHub responds to our request with a JSON object containing the primary fields shown in <a data-type="xref" href="#user_profile_type_05">Example 6-1</a>.</p>&#13;
<div data-type="example" id="user_profile_type_05">&#13;
<h5><span class="label">Example 6-1. </span><code>UserProfile</code> type</h5>&#13;
&#13;
<pre data-code-language="typescript" data-type="programlisting"><code class="kr">type</code> <code class="nx">User</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">name</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>&#13;
  <code class="nx">bio</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>&#13;
  <code class="nx">avatar_url</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>&#13;
  <code class="nx">twitter_username</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>&#13;
  <code class="nx">blog</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>&#13;
  <code class="c1">//...</code>&#13;
<code class="p">};</code></pre></div>&#13;
&#13;
<p>With this response data, we now have the necessary information to display the user’s profile on the screen. Let’s add the following code to our component’s <code>template</code> &#13;
<span class="keep-together">section</span>:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"user-profile"</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"user"</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">img</code> <code class="na">:src</code><code class="o">=</code><code class="s">"user.avatar_url"</code> <code class="na">alt</code><code class="o">=</code><code class="s">"`${user.name} Avatar`"</code> <code class="na">width</code><code class="o">=</code><code class="s">"200"</code>  <code class="p">/&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code>{{ user.name }}<code class="p">&lt;/</code><code class="nt">h1</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>{{ user.bio }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Twitter: {{ user.twitter_username }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
        <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Blog: {{ user.blog }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>Note here we add <code>v-if="user"</code> to ensure the Vue renders the user profile only when <code>user</code> is available<a data-primary="TypeScript" data-secondary="loading data with Axios" data-type="indexterm" id="id1112"/><a data-primary="rendering" data-secondary="conditional rendering and loading data with Axios" data-type="indexterm" id="ix-comp-incorp4"/><a data-primary="rendering" data-secondary="conditional rendering with v-if, v-else, and v-else-if" data-type="indexterm" id="ix-comp-incorp4a"/><a data-primary="v-if" data-secondary="conditional rendering with" data-type="indexterm" id="ix-comp-incorp4b"/><a data-primary="v-if" data-secondary="loading data with Axios" data-type="indexterm" id="ix-comp-incorp4c"/>.</p>&#13;
&#13;
<p class="pagebreak-before">Finally, as in <a data-type="xref" href="#example_user_profile">Example 6-2</a>, we need to add some modifications to our component’s <code>script</code> section to make the code fully TypeScript compatible, including mapping the response data to be the <code>User</code> data type before assigning it to the <code>user</code> property, as well as the <code>error</code>.</p>&#13;
<div data-type="example" id="example_user_profile">&#13;
<h5><span class="label">Example 6-2. </span>UserProfile component</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"user-profile"</code><code> </code><code class="na">v-if</code><code class="o">=</code><code class="s">"user"</code><code class="p">&gt;</code><code>&#13;
        </code><code class="cm">&lt;!-- ... --&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code> </code><code class="na">setup</code><code class="p">&gt;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="nx">axios</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'axios'</code><code class="p">;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">ref</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'vue'</code><code class="p">;</code><code class="w">&#13;
&#13;
</code><code class="nx">type</code><code class="w"> </code><code class="nx">User</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="cm">/**... */</code><code class="w"> </code><code class="p">}</code><code class="w">&#13;
&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">&lt;</code><code class="nt">User</code><code> </code><code class="err">|</code><code> </code><code class="na">null</code><code class="p">&gt;</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="w"> </code><a class="co" href="#callout_incorporating_external_data_CO2-1" id="co_incorporating_external_data_CO2-1"><img alt="1" src="assets/1.png"/></a><code class="w">&#13;
</code><code class="kd">const</code><code class="w"> </code><code class="nx">error</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">ref</code><code class="p">&lt;</code><code class="nt">Error</code><code> </code><code class="err">|</code><code> </code><code class="na">null</code><code class="p">&gt;</code><code class="p">(</code><code class="kc">null</code><code class="p">)</code><code class="w">&#13;
&#13;
</code><code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">getUser</code><code class="w"> </code><code class="p">(</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
    </code><code class="k">try</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
        </code><code class="kd">const</code><code class="w"> </code><code class="nx">response</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="p">&lt;</code><code class="nt">User</code><code class="p">&gt;</code><code class="p">(</code><code class="w">&#13;
            </code><code class="s2">"https://api.github.com/users/mayashavin"</code><code class="w">&#13;
        </code><code class="p">)</code><code class="w">&#13;
&#13;
        </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="w"> </code><a class="co" href="#callout_incorporating_external_data_CO2-2" id="co_incorporating_external_data_CO2-2"><img alt="2" src="assets/2.png"/></a><code class="w">&#13;
    </code><code class="p">}</code><code class="w"> </code><code class="k">catch</code><code class="w"> </code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w">&#13;
        </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">err</code><code class="w"> </code><code class="kr">as</code><code class="w"> </code><code class="ne">Error</code><code class="w"> </code><a class="co" href="#callout_incorporating_external_data_CO2-3" id="co_incorporating_external_data_CO2-3"><img alt="3" src="assets/3.png"/></a><code class="w">&#13;
    </code><code class="p">}</code><code class="w">&#13;
</code><code class="p">}</code><code class="w">&#13;
&#13;
</code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO2-1" id="callout_incorporating_external_data_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Add the <code>User</code> type declaration to the <code>user</code>.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO2-2" id="callout_incorporating_external_data_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Assign the response data to the <code>user</code> property.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO2-3" id="callout_incorporating_external_data_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Cast the error to be <code>Error</code> type before assigning it to the <code>error</code> property.</p></dd>&#13;
</dl>&#13;
&#13;
<p>When the request is successfully resolved, you will see my GitHub profile information displayed on the screen, as shown in <a data-type="xref" href="#figure_05_02">Figure 6-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_05_02">&#13;
<img alt="A screenshot displaying a photo of Maya Shavin with her name, job title, twitter handler and blog address." src="assets/lvue_0602.png"/>&#13;
<h6><span class="label">Figure 6-2. </span>Sample output for a successful GitHub profile information request</h6>&#13;
</div></figure>&#13;
&#13;
<p>Similarly, you can also add a section with <code>v-else-if="error"</code> condition to display an error message to the user when the request fails<a data-primary="errors" data-secondary="loading data with Axios" data-type="indexterm" id="id1113"/><a data-primary="v-else-if" data-type="indexterm" id="id1114"/>:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"user-profile"</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"user"</code><code class="p">&gt;</code>&#13;
    <code class="cm">&lt;!--...--&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"error"</code> <code class="na">v-else-if</code><code class="o">=</code><code class="s">"error"</code><code class="p">&gt;</code>&#13;
    {{ error.message }}&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>At this point, you may wonder what happens behind the scenes when we perform an asynchronous request while the component is in the middle of creation. The component’s lifecycle operates synchronously, meaning Vue still proceeds in creating the component despite the status of the asynchronous request. That brings us to the challenge of handling different data requests in various components during run-time, which we will explore next<a data-primary="" data-startref="ix-comp-incorp2a" data-type="indexterm" id="id1115"/><a data-primary="" data-startref="ix-comp-incorp4" data-type="indexterm" id="id1116"/><a data-primary="" data-startref="ix-comp-incorp4a" data-type="indexterm" id="id1117"/><a data-primary="" data-startref="ix-comp-incorp4b" data-type="indexterm" id="id1118"/><a data-primary="" data-startref="ix-comp-incorp4c" data-type="indexterm" id="id1119"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before" data-pdf-bookmark="Async Data Requests in Run-Time: the Challenge" data-type="sect1"><div class="sect1" id="id76">&#13;
<h1>Async Data Requests in Run-Time: the Challenge</h1>&#13;
&#13;
<p>Similar to how the JavaScript engine works, Vue also works synchronously. If there is any asynchronous request along the way, Vue will not wait for the request to complete before proceeding to the next step. Instead, Vue finishes the component’s creation process, then returns to handle the asynchronous request when it resolves/rejects according to the execution order<a data-primary="asynchronous calls" data-secondary="loading data with Axios" data-type="indexterm" id="ix-comp-incorp5"/><a data-primary="data" data-secondary="loading with Axios, asynchronous challenges" data-type="indexterm" id="ix-comp-incorp5b"/><a data-primary="run-time" data-secondary="asynchronous data calls with Axios" data-type="indexterm" id="ix-comp-incorp5c"/>.</p>&#13;
&#13;
<p>Let’s take a step back, add some console logs to the <code>onBeforeMounted</code>, <code>onMounted</code>, and <code>onUpdated</code> hooks in our component and see the order of execution<a data-primary="onBeforeMounted() hook" data-type="indexterm" id="id1120"/><a data-primary="onMounted() hook" data-type="indexterm" id="id1121"/><a data-primary="onUpdated() hook" data-type="indexterm" id="id1122"/>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">//&lt;script setup&gt;&#13;
</code><code class="kr">import</code><code> </code><code class="p">{</code><code> </code><code class="nx">onBeforeMount</code><code class="p">,</code><code> </code><code class="nx">onMounted</code><code class="p">,</code><code> </code><code class="nx">onUpdated</code><code> </code><code class="p">}</code><code> </code><code class="nx">from</code><code> </code><code class="s2">"vue"</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="c1">//...&#13;
</code><code class="nx">async</code><code> </code><code class="kd">function</code><code> </code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
  </code><code class="k">try</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="kr">const</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="o">&lt;</code><code class="nx">User</code><code class="o">&gt;</code><code class="p">(</code><code>&#13;
        </code><code class="s1">'https://api.github.com/users/mayashavin'</code><code>&#13;
    </code><code class="p">)</code><code class="p">;</code><code>&#13;
    </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code><code>&#13;
&#13;
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'User'</code><code class="p">,</code><code> </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="p">.</code><code class="nx">name</code><code class="p">)</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO3-1" id="co_incorporating_external_data_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
  </code><code class="p">}</code><code> </code><code class="k">catch</code><code> </code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">err</code><code class="p">;</code><code>&#13;
  </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="nx">onBeforeMount</code><code class="p">(</code><code class="nx">async</code><code> </code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s1">'created'</code><code class="p">)</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO3-2" id="co_incorporating_external_data_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
    </code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>&#13;
</code><code class="p">}</code><code class="p">)</code><code>&#13;
&#13;
</code><code class="nx">onMounted</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"mounted"</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO3-3" id="co_incorporating_external_data_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="p">}</code><code class="p">)</code><code class="p">;</code><code>&#13;
&#13;
</code><code class="nx">onUpdated</code><code class="p">(</code><code class="p">(</code><code class="p">)</code><code> </code><code class="o">=&gt;</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="s2">"updated"</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO3-4" id="co_incorporating_external_data_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="p">}</code><code class="p">)</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO3-1" id="callout_incorporating_external_data_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Log the details of <code>user</code> when finished fetching to the console.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO3-2" id="callout_incorporating_external_data_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Log the lifecycle state: before mounting</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO3-3" id="callout_incorporating_external_data_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Log the lifecycle state: mounted</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO3-4" id="callout_incorporating_external_data_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Log the lifecycle state: component is updated</p></dd>&#13;
</dl>&#13;
&#13;
<p class="pagebreak-before">Looking at the browser’s console log, we see the order displayed as in <a data-type="xref" href="#figure_05_03">Figure 6-3</a>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_05_03">&#13;
<img alt="A screenshot showing the execution order when there is an asynchronous request." src="assets/lvue_0603.png"/>&#13;
<h6><span class="label">Figure 6-3. </span>Order of execution with an asynchronous request</h6>&#13;
</div></figure>&#13;
&#13;
<p>Once the asynchronous request is resolved/rejected and there are component data changes, the Vue renderer will trigger the update process for the component. The component is not yet with the response data when Vue mounts it to the DOM. Thus, we still need to handle the component’s loading state before receiving the server’s data.</p>&#13;
&#13;
<p>To do so, we can add another <code>loading</code> property to the component’s data and disable the loading state after the request is resolved/rejected, as in <a data-type="xref" href="#example_user_profile_loading_05">Example 6-3</a><a data-primary="loading property and state" data-type="indexterm" id="id1123"/><a data-primary="state" data-secondary="loading property and" data-type="indexterm" id="id1124"/>.</p>&#13;
<div data-type="example" id="example_user_profile_loading_05">&#13;
<h5><span class="label">Example 6-3. </span>UserProfile component with loading state and error state</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">//...&#13;
</code><code class="kr">const</code><code> </code><code class="nx">loading</code><code> </code><code class="o">=</code><code> </code><code class="nx">ref</code><code class="o">&lt;</code><code class="kr">boolean</code><code class="o">&gt;</code><code class="p">(</code><code class="kc">false</code><code class="p">)</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO4-1" id="co_incorporating_external_data_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
&#13;
</code><code class="nx">async</code><code> </code><code class="kd">function</code><code> </code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
    </code><code class="nx">loading</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="kc">true</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO4-2" id="co_incorporating_external_data_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
&#13;
    </code><code class="k">try</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="kr">const</code><code> </code><code class="nx">response</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="o">&lt;</code><code class="nx">User</code><code class="o">&gt;</code><code class="p">(</code><code>&#13;
            </code><code class="s2">"https://api.github.com/users/mayashavin"</code><code>&#13;
        </code><code class="p">)</code><code>&#13;
&#13;
        </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">await</code><code> </code><code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code>&#13;
    </code><code class="p">}</code><code> </code><code class="k">catch</code><code> </code><code class="p">(</code><code class="nx">err</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="nx">err</code><code> </code><code class="nx">as</code><code> </code><code class="nb">Error</code><code>&#13;
    </code><code class="p">}</code><code> </code><code class="k">finally</code><code> </code><code class="p">{</code><code>&#13;
        </code><code class="nx">loading</code><code class="p">.</code><code class="nx">value</code><code> </code><code class="o">=</code><code> </code><code class="kc">false</code><code class="p">;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO4-3" id="co_incorporating_external_data_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code><code>&#13;
&#13;
</code><code class="nx">getUser</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO4-1" id="callout_incorporating_external_data_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a reactive <code>loading</code> variable.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO4-2" id="callout_incorporating_external_data_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Set <code>loading</code> to <code>true</code> before fetching the data.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO4-3" id="callout_incorporating_external_data_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Set <code>loading</code> to <code>false</code> after the request is resolved/rejected.</p></dd>&#13;
</dl>&#13;
&#13;
<p>And then add a <code>v-if="loading"</code> condition to the component’s <code>template</code> section for a loading message, as in <a data-type="xref" href="#example_user_profile_loading_UI_05">Example 6-4</a><a data-primary="rendering" data-secondary="conditional rendering and loading data with Axios" data-type="indexterm" id="id1125"/><a data-primary="rendering" data-secondary="conditional rendering with v-if, v-else, and v-else-if" data-type="indexterm" id="id1126"/>.</p>&#13;
<div data-type="example" id="example_user_profile_loading_UI_05">&#13;
<h5><span class="label">Example 6-4. </span>UserProfile component template with loading state and error state</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"loading"</code><code class="p">&gt;</code>Loading...<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"user-profile"</code> <code class="na">v-else-if</code><code class="o">=</code><code class="s">"user"</code><code class="p">&gt;</code>&#13;
        <code class="cm">&lt;!--...--&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"error"</code> <code class="na">v-else-if</code><code class="o">=</code><code class="s">"error"</code><code class="p">&gt;</code>&#13;
        {{ error.message }}&#13;
<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>This code renders a loading message while the asynchronous request is in progress and displays the user’s profile information when the request resolves or otherwise sends an error message.</p>&#13;
&#13;
<p>You can also create your reusable wrapper component to handle different states for components with the asynchronous data request, such as a skeleton placeholder component when a list of components is loading (<a data-type="xref" href="#figure_05_04">Figure 6-4</a>) or a fetch component (covered next)<a data-primary="" data-startref="ix-comp-incorp3" data-type="indexterm" id="id1127"/><a data-primary="skeleton placeholder for state" data-type="indexterm" id="id1128"/><a data-primary="state" data-secondary="skeleton placeholder for" data-type="indexterm" id="id1129"/>.</p>&#13;
&#13;
<figure><div class="figure" id="figure_05_04">&#13;
<img alt="A screenshot showing a skeleton component for loading state." src="assets/lvue_0604.png"/>&#13;
<h6><span class="label">Figure 6-4. </span>Skeleton component for loading state</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating Your Reusable Fetch Component" data-type="sect1"><div class="sect1" id="fetch_component">&#13;
<h1>Creating Your Reusable Fetch Component</h1>&#13;
&#13;
<p>Handling states in a Vue component for its asynchronous data request is a common challenge. The UI for these states usually follows the same pattern: a spinner or loading message for the loading state, an error message, or a more stylish error component when a data request rejects. Thus,  we can create one common component for handling such cases, which we call <code>FetchComponent</code><a data-primary="asynchronous calls" data-secondary="reusable fetch component with Axios" data-type="indexterm" id="ix-comp-incorp6"/><a data-primary="Axios" data-secondary="fetch and" data-type="indexterm" id="ix-comp-incorp6a"/><a data-primary="data" data-secondary="reusable fetch component with Axios" data-type="indexterm" id="ix-comp-incorp6b"/><a data-primary="fetch" data-secondary="Axios and" data-type="indexterm" id="ix-comp-incorp6c"/><a data-primary="state" data-secondary="reusable fetch component with Axios" data-type="indexterm" id="ix-comp-incorp6d"/>.</p>&#13;
&#13;
<p class="pagebreak-before"><code>FetchComponent</code> has a <code>template</code> section divided into three main areas using <code>slot</code> and <code>v-if</code>:</p>&#13;
<dl>&#13;
<dt><code>#loading</code> slot for displaying a loading message</dt>&#13;
<dd>&#13;
<p>The condition for this slot to render is if the component is in the <code>isLoading</code> state.</p>&#13;
</dd>&#13;
<dt><code>#error</code> slot for displaying an error message</dt>&#13;
<dd>&#13;
<p>We also pass the <code>error</code> object as the slot props for customization if needed while ensuring Vue renders this slot only if <code>error</code> is available.</p>&#13;
</dd>&#13;
<dt><code>#default</code> slot for displaying the component’s content, when there is <code>data</code> received</dt>&#13;
<dd>&#13;
<p>We also pass the <code>data</code> to the slot as props.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>We also use a named <code>slot</code> to allow customizing the error and loading the component instead of the default messages:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">slot</code> <code class="na">name</code><code class="o">=</code><code class="s">"loading"</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"isLoading"</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"loadin-message"</code><code class="p">&gt;</code>Loading...<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">slot</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">slot</code> <code class="na">:data</code><code class="o">=</code><code class="s">"data"</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"data"</code><code class="p">&gt;&lt;/</code><code class="nt">slot</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;</code><code class="nt">slot</code> <code class="na">name</code><code class="o">=</code><code class="s">"error"</code> <code class="na">:error</code><code class="o">=</code><code class="s">"error"</code> <code class="na">v-if</code><code class="o">=</code><code class="s">"error"</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;</code><code class="nt">div</code> <code class="na">class</code><code class="o">=</code><code class="s">"error"</code><code class="p">&gt;</code>&#13;
      <code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>Error: {{ error.message }}<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
    <code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code>&#13;
  <code class="p">&lt;/</code><code class="nt">slot</code><code class="p">&gt;</code>&#13;
<code class="p">&lt;/</code><code class="nt">template</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>In our <code>script setup</code> section, we need to declare our data type <code>FetchComponentData</code> for the component to contain the <code>isLoading</code>, <code>error</code>, and <code>data</code> properties of type generics <code>Object</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="nx">ref</code><code class="o">&lt;</code><code class="nb">Object</code> <code class="o">|</code> <code class="kc">undefined</code><code class="o">&gt;</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="nx">error</code> <code class="o">=</code> <code class="nx">ref</code><code class="o">&lt;</code><code class="nb">Error</code> <code class="o">|</code> <code class="kc">undefined</code><code class="o">&gt;</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="nx">loading</code> <code class="o">=</code> <code class="nx">ref</code><code class="o">&lt;</code><code class="kr">boolean</code><code class="o">&gt;</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code></pre>&#13;
&#13;
<p>The component receives two props: a <code>url</code> for the request URL and a <code>method</code> for the request method with the default value of <code>GET</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">//...</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">props</code> <code class="o">=</code> <code class="nx">defineProps</code><code class="p">({</code>&#13;
    <code class="nx">url</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="nb">String</code><code class="p">,</code>&#13;
        <code class="nx">required</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>&#13;
    <code class="p">},</code>&#13;
    <code class="nx">method</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="nx">type</code><code class="o">:</code> <code class="nb">String</code><code class="p">,</code>&#13;
        <code class="k">default</code><code class="o">:</code> <code class="s2">"GET"</code><code class="p">,</code>&#13;
    <code class="p">},</code>&#13;
<code class="p">});</code>&#13;
<code class="c1">//...</code></pre>&#13;
&#13;
<p>Finally, we make the asynchronous request and update the component’s state when Vue creates the component:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">async</code> <code class="kd">function</code> <code class="nx">fetchData</code> <code class="p">()</code> <code class="p">{</code>&#13;
    <code class="k">try</code> <code class="p">{</code>&#13;
        <code class="nx">loading</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>&#13;
        <code class="kr">const</code> <code class="nx">response</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">axios</code><code class="p">(</code><code class="nx">props</code><code class="p">.</code><code class="nx">url</code><code class="p">,</code> <code class="p">{</code>&#13;
            <code class="nx">method</code><code class="o">:</code> <code class="nx">props</code><code class="p">.</code><code class="nx">method</code><code class="p">,</code>&#13;
            <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
                <code class="s1">'Content-Type'</code><code class="o">:</code> <code class="s1">'application/json'</code><code class="p">,</code>&#13;
            <code class="p">},</code>&#13;
        <code class="p">});</code>&#13;
        <code class="nx">data</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">catch</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="p">{</code>&#13;
        <code class="nx">error</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="nx">error</code> <code class="nx">as</code> <code class="nb">Error</code><code class="p">;</code>&#13;
    <code class="p">}</code> <code class="k">finally</code> <code class="p">{</code>&#13;
        <code class="nx">loading</code><code class="p">.</code><code class="nx">value</code> <code class="o">=</code> <code class="kc">false</code><code class="p">;</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">fetchData</code><code class="p">();</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>If you know the types of <code>data</code> in advance, you should use them instead of <code>any</code> or <code>Object</code> to ensure full TypeScript type check coverage. Don’t use <code>any</code> unless there is no other way<a data-primary="any type, avoiding" data-type="indexterm" id="id1130"/><a data-primary="type checking" data-secondary="any type and" data-type="indexterm" id="id1131"/><a data-primary="TypeScript" data-secondary="and any type" data-type="indexterm" id="id1132"/>.</p>&#13;
</div>&#13;
&#13;
<p>Now we can rewrite <a data-type="xref" href="#example_user_profile">Example 6-2</a> to use the new <code>FetchComponent</code> component as in <a data-type="xref" href="#example_user_profile_fetch_component_01">Example 6-5</a>.</p>&#13;
<div data-type="example" id="example_user_profile_fetch_component_01">&#13;
<h5><span class="label">Example 6-5. </span>UserProfile component using the <code>FetchComponent</code></h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="nt">FetchComponent</code><code> </code><code class="na">url</code><code class="o">=</code><code class="s">"https://api.github.com/users/mayashavin"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO5-1" id="co_incorporating_external_data_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
        </code><code class="p">&lt;</code><code class="nt">template</code><code> </code><code class="err">#</code><code class="na">default</code><code class="o">=</code><code class="s">"defaultProps"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO5-2" id="co_incorporating_external_data_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
            </code><code class="p">&lt;</code><code class="nt">div</code><code> </code><code class="na">class</code><code class="o">=</code><code class="s">"user-profile"</code><code class="p">&gt;</code><code> </code><a class="co" href="#callout_incorporating_external_data_CO5-3" id="co_incorporating_external_data_CO5-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">img</code><code>&#13;
                    </code><code class="na">:src</code><code class="o">=</code><code class="s">"(defaultProps.data as User).avatar_url"</code><code>&#13;
                    </code><code class="na">alt</code><code class="o">=</code><code class="s">"`${defaultProps.data.name} Avatar`"</code><code>&#13;
                    </code><code class="na">width</code><code class="o">=</code><code class="s">"200"</code><code>&#13;
                </code><code class="p">/</code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
                    </code><code class="p">&lt;</code><code class="nt">h1</code><code class="p">&gt;</code><code>{{ (defaultProps.data as User).name }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">h1</code><code class="p">&gt;</code><code>&#13;
                    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>{{ (defaultProps.data as User).bio }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>&#13;
                    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>Twitter: {{(defaultProps.data as User).twitter_username }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>&#13;
                    </code><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code><code>Blog: {{ (defaultProps.data as User).blog }}</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">p</code><code class="p">&gt;</code><code>&#13;
                </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
            </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">div</code><code class="p">&gt;</code><code>&#13;
        </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
    </code><code class="p">&lt;</code><code class="p">/</code><code class="nt">FetchComponent</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">template</code><code class="p">&gt;</code><code>&#13;
</code><code class="p">&lt;</code><code class="nt">script</code><code> </code><code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code> </code><code class="na">setup</code><code class="p">&gt;</code><code class="w"> </code><a class="co" href="#callout_incorporating_external_data_CO5-4" id="co_incorporating_external_data_CO5-4"><img alt="4" src="assets/4.png"/></a><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="nx">FetchComponent</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"./FetchComponent.vue"</code><code class="p">;</code><code class="w">&#13;
</code><code class="k">import</code><code class="w"> </code><code class="nx">type</code><code class="w"> </code><code class="p">{</code><code class="w"> </code><code class="nx">User</code><code class="w"> </code><code class="p">}</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s2">"../types/User.type"</code><code class="p">;</code><code class="w">&#13;
</code><code class="p">&lt;</code><code class="p">/</code><code class="nt">script</code><code class="p">&gt;</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO5-1" id="callout_incorporating_external_data_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Use the <code>FetchComponent</code> component and pass the <code>url</code> prop as the target URL for the request (<em><a class="bare" href="https://api.github.com/users/mayashavin"><em class="hyperlink">https://api.github.com/users/mayashavin</em></a></em>).</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO5-2" id="callout_incorporating_external_data_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Wrap the main content of the component inside the <code>template</code> for the main slot, <code>#default</code>. We also bind the props this slot receives to the <code>defaultProps</code> object. Since <code>defaultProps.data</code> is of <code>Object</code> type, we cast it to <code>User</code> to pass TypeScript validation.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO5-3" id="callout_incorporating_external_data_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Use the <code>defaultProps.data</code> to access the data received from the request and display it on the UI.</p></dd>&#13;
<dt><a class="co" href="#co_incorporating_external_data_CO5-4" id="callout_incorporating_external_data_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Remove all the related original logic code for fetching.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Here we pass <code>data</code> to this slot from our <code>FetchComponent</code> implementation, which in our case stands for our original <code>user</code> property. Thus, we replace the occurrences of <code>user</code> from the previous implementation with <code>defaultProps.data</code>. The output remains the same.</p>&#13;
<div data-type="tip"><h1>Implementing FetchComponent with Composition API</h1>&#13;
<p>You can rewrite the <code>FetchComponent</code> with <code>useFetch()</code> (see <a data-type="xref" href="ch05.html#example_22_06">Example 5-20</a>) in <code>setup()</code> function (or <code>&lt;script setup&gt;</code> tag) instead<a data-primary="Composition API" data-secondary="useFetch()" data-type="indexterm" id="id1133"/><a data-primary="useFetch()" data-type="indexterm" id="id1134"/>.</p>&#13;
</div>&#13;
&#13;
<p>Now you understand how to create a simple <code>FetchComponent</code> to fetch and handle data request states on the UI for your Vue components. You may want to extend it to handle more complex data requests, such as POST requests. By isolating the data request and controlling logic in a single place, you can reduce the complexity and reuse it in other components more quickly<a data-primary="" data-startref="ix-comp-incorp5" data-type="indexterm" id="id1135"/><a data-primary="" data-startref="ix-comp-incorp5b" data-type="indexterm" id="id1136"/><a data-primary="" data-startref="ix-comp-incorp5c" data-type="indexterm" id="id1137"/>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Connect Your Application with an External Database" data-type="sect1"><div class="sect1" id="id78">&#13;
<h1>Connect Your Application with an External Database</h1>&#13;
&#13;
<p>At this point, you can handle external data requests and errors on the UI of your Vue components. However, fetching data every time Vue creates a component may not be the best practice, especially if the component’s data is not likely to change frequently<a data-primary="applications" data-secondary="connecting to databases" data-type="indexterm" id="id1138"/><a data-primary="data" data-secondary="connecting application to external database" data-type="indexterm" id="id1139"/><a data-primary="localStorage" data-type="indexterm" id="id1140"/><a data-primary="state management systems" data-secondary="connecting applications to databases and" data-type="indexterm" id="id1141"/>.</p>&#13;
&#13;
<p>A perfect illustration is switching between pages in a web application, where we need to fetch the page’s data only once when loading the view for the first time. In this case, we can cache the data using the browser’s local storage as an external local database or using a state management service such as Vuex and Pinia (more in <a data-type="xref" href="ch09.html#unique_chapter_id_08">Chapter 9</a>).</p>&#13;
&#13;
<p>To use local storage, we can use the built-in browser <code>localStorage</code> API. For example, to save the user’s GitHub profile data to local storage, we can write:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'user'</code><code class="p">,</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">user</code><code class="p">));</code></pre>&#13;
&#13;
<p>Note the browser’s <code>localStorage</code> saves the item as a string, so we need to convert the object to a string before saving it. When we need it, we can use this code:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">user</code> <code class="o">=</code> <code class="nx">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'user'</code><code class="p">));</code></pre>&#13;
&#13;
<p>You can add the previous code to your <code>UserProfile</code> component (<a data-type="xref" href="#example_user_profile">Example 6-2</a>) as &#13;
<span class="keep-together">follows</span>:</p>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">script</code> <code class="na">lang</code><code class="o">=</code><code class="s">"ts"</code><code class="p">&gt;</code><code class="w"/>&#13;
<code class="k">import</code><code class="w"> </code><code class="nx">axios</code><code class="w"> </code><code class="kr">from</code><code class="w"> </code><code class="s1">'axios'</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="c1">//...</code><code class="w"/>&#13;
&#13;
<code class="k">async</code><code class="w"> </code><code class="kd">function</code><code class="w"> </code><code class="nx">getUser</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">    </code><code class="k">try</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="kd">const</code><code class="w"> </code><code class="nx">user</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">parse</code><code class="p">(</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'user'</code><code class="p">));</code><code class="w"/>&#13;
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="nx">user</code><code class="p">)</code><code class="w"> </code><code class="k">return</code><code class="w"> </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">user</code><code class="p">;</code><code class="w"/>&#13;
&#13;
<code class="w">        </code><code class="kd">const</code><code class="w"> </code><code class="nx">response</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">await</code><code class="w"> </code><code class="nx">axios</code><code class="p">.</code><code class="nx">get</code><code class="p">&lt;</code><code class="nt">User</code><code class="p">&gt;(</code><code class="w"/>&#13;
<code class="w">            </code><code class="s1">'https://api.github.com/users/mayashavin'</code><code class="w"/>&#13;
<code class="w">        </code><code class="p">);</code><code class="w"/>&#13;
&#13;
<code class="w">        </code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">response</code><code class="p">.</code><code class="nx">data</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'user'</code><code class="p">,</code><code class="w"> </code><code class="nb">JSON</code><code class="p">.</code><code class="nx">stringify</code><code class="p">(</code><code class="nx">user</code><code class="p">.</code><code class="nx">value</code><code class="p">));</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}</code><code class="w"> </code><code class="k">catch</code><code class="w"> </code><code class="p">(</code><code class="nx">error</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>&#13;
<code class="w">        </code><code class="nx">error</code><code class="p">.</code><code class="nx">value</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="nx">error</code><code class="w"> </code><code class="kr">as</code><code class="w"> </code><code class="ne">Error</code><code class="p">;</code><code class="w"/>&#13;
<code class="w">    </code><code class="p">}</code><code class="w"/>&#13;
<code class="p">}</code><code class="w"/>&#13;
&#13;
<code class="nx">getUser</code><code class="p">();</code><code class="w"/>&#13;
<code class="p">&lt;/</code><code class="nt">script</code><code class="p">&gt;</code></pre>&#13;
&#13;
<p>It will trigger the asynchronous call only when loading the page for the first time. When the page is loaded again, if we have saved the data successfully, it will load directly from local storage.</p>&#13;
<div data-type="warning" epub:type="warning"><h1>Using localStorage in Real-World Application</h1>&#13;
<p>I don’t recommend this approach for a real-world application. It has several limitations, such as your browser will reset any local storage data for private/incognito sessions, or users can disable the use of local stage on their end. The better approach is to use state management tools like Vuex or Pinia (see <a data-type="xref" href="ch09.html#unique_chapter_id_08">Chapter 9</a>)<a data-primary="" data-startref="ix-comp-incorp1" data-type="indexterm" id="id1142"/><a data-primary="" data-startref="ix-comp-incorp1a" data-type="indexterm" id="id1143"/><a data-primary="" data-startref="ix-comp-incorp6" data-type="indexterm" id="id1144"/><a data-primary="" data-startref="ix-comp-incorp6a" data-type="indexterm" id="id1145"/><a data-primary="" data-startref="ix-comp-incorp6b" data-type="indexterm" id="id1146"/><a data-primary="" data-startref="ix-comp-incorp6c" data-type="indexterm" id="id1147"/><a data-primary="" data-startref="ix-comp-incorp6d" data-type="indexterm" id="id1148"/>.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="id360">&#13;
<h1>Summary</h1>&#13;
&#13;
<p>This chapter introduced techniques for handling asynchronous data in a Vue component, with the help of the Axios library and Composition API. We learned how to create a reusable component to fetch and handle data request states on the UI for your Vue applications while keeping the code clean and readable. We also explored connecting your application to an external database service such as local storage.</p>&#13;
&#13;
<p>The next chapter will introduce more advanced rendering concepts of Vue, including using functional components, registering custom plugins globally in your Vue application, and using dynamic rendering to compose layouts conditionally and &#13;
<span class="keep-together">dynamically</span>.</p>&#13;
</div></section>&#13;
</div></section></body></html>