<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 11. Data Structures: Collections and Generics"><div class="chapter" id="data_structures_collections_and_generics">
<h1><span class="label">Chapter 11. </span>Data Structures: Collections and Generics</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0309-01.png" alt="image" width="961" height="782"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Java Collections Framework" data-seealso="collections" id="idm46038392365856"/><strong>Sorting is a snap in Java.</strong> You have all the tools for collecting and manipulating your data without having to write your own sort algorithms (unless you’re reading this right now sitting in your Computer Science 101 class, in which case, trust us—you are SO going to be writing sort code while the rest of us just call a method in the Java API).  In this chapter, you’re going to get a peek at when Java can save you some typing and figure out the types that you need.</p>
<p>The Java Collections Framework has a data structure that should work for virtually anything you’ll ever need to do. Want to keep a list that you can easily keep adding to? Want to find something by name? Want to create a list that automatically takes out all the duplicates? Sort your co-workers by the number of times they’ve tried to speak with their mic muted on a video call? Sort your pets by number of tricks learned? It’s all here...</p>
<section data-type="sect1" data-pdf-bookmark="Tracking song popularity on your jukebox"><div class="sect1" id="tracking_song_popularity_on_your_jukebox">
<h1>Tracking song popularity on your jukebox</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0310-01.png" alt="image" width="425" height="194"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="relationship to List in sorting project" id="idm46038392355232"/><a data-type="indexterm" data-primary="List interface" data-secondary="sorting with" id="idm46038392352656"/><a data-type="indexterm" data-primary="mocking" id="idm46038392351552"/>Congratulations on your new job—managing the automated jukebox system at Lou’s Diner. There’s no Java inside the jukebox itself, but each time someone plays a song, the song data is appended to a simple text file.</p>
<p>Your job is to manage the data to track song popularity, generate reports, and manipulate the playlists. You’re not writing the entire app—some of the other software developers are involved as well, but you’re responsible for managing and sorting the data inside the Java app. And since Lou has a thing against databases, this is strictly an in-memory data collection. Another programmer will be writing the code to read the song data from a file and put the songs into a List. (In a few chapters you’ll learn how to read data from files, and write data to files.) All you’re going to get is a List with the song data the jukebox keeps adding to.</p>
<p>Let’s not wait for that other programmer to give us the actual file of songs; let’s create a small test program to provide us with some sample data we can work with. We’ve agreed with the other programmer that she’ll ultimately provide a Songs class with a getSongs method we’ll use to get the data. Armed with that information, we can write a small class to temporarily “stand in” for the actual code. Code that stands in for other code is often called “<strong>mock</strong>” code.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">You’ll often want to write some temporary code that stands in for the real code that will come later. This is called “mocking.”</span></strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0310-02.png" alt="image" width="1461" height="672"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Your first job, sort the songs in alphabetical order"><div class="sect1" id="your_first_jobcomma_sort_the_songs_in_al">
<h1>Your first job, sort the songs in alphabetical order</h1>
<p><a data-type="indexterm" data-primary="mock Songs class" id="idm46038392461056"/><a data-type="indexterm" data-primary="sorting" data-secondary="List" id="idm46038395254768"/><a data-type="indexterm" data-primary="Strings" data-secondary="sorting in mock Songs class" id="idm46038393038688"/>We’ll start by creating code that reads in data from the mock Songs class and prints out what it got. Since an ArrayList’s elements are placed in the order in which they were added, it’s no surprise that the song titles are not yet alphabetized.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0311-01.png" alt="image" width="1437" height="914"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0311-02.png" alt="image" width="1453" height="300"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0312-01.png" alt="image" width="992" height="752"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Great question! You spotted the diamond operator"><div class="sect1" id="great_questionexclamation_mark_you_spott">
<h1>Great question! You spotted the <u>diamond operator</u></h1>
<p><a data-type="indexterm" data-primary="&lt;&gt; (diamond operator)" id="idm46038392328016"/><a data-type="indexterm" data-primary="ArrayList" data-secondary="diamond operator" id="idm46038392327280"/><a data-type="indexterm" data-primary="diamond operator (&lt;&gt;)" id="idm46038392326304"/><a data-type="indexterm" data-primary="type inference" id="idm46038392325568"/>So far, we’ve been declaring our ArrayLists by showing the element type twice:</p>
<pre data-type="programlisting"><strong>ArrayList&lt;<u>String</u>&gt; songs = new ArrayList&lt;<u>String</u>&gt;();</strong></pre>
<p>Most of the time, we don’t need to say the same thing twice. The compiler can tell from what you wrote on the left-hand side what you probably want on the right-hand side. It uses <em>type inference</em> to infer (work out) the type you need.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0312-03.png" alt="image" width="991" height="65"/>
<h6/>
</div></figure>
<p>This syntax is called the diamond operator (because, well, it’s diamond-shaped!) and was introduced in Java 7, so it’s been around a while and is probably available in your version of Java.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#646466;">Over time, Java has evolved to remove unnecessary code duplication from its syntax. If the compiler can figure out a type, you don’t always need to write it out in full.</span></strong></p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00027">
<h5>there are no Dumb Questions</h5>
<p><a data-type="indexterm" data-primary="List interface" data-secondary="using versus implementation type" id="idm46038392319232"/><a data-type="indexterm" data-primary="polymorphism" data-secondary="and List versus ArrayList" id="idm46038392318096"/><strong>Q: Should I be using the diamond operator all the time? Are there any downsides?</strong></p>
<p><strong>A:</strong>  The diamond operator is “syntactic sugar,” which means it’s there to make our lives easier as we write (and read) code, but it doesn’t make any difference to the underlying byte code. So if you’re worried about whether using the diamond means something different to using the specific type, don’t worry! It’s basically the same thing.</p>
<p>However, sometimes you might choose to write out the full type. The main reason you might want to is to help people reading your code. For example, if the variable is declared a long way from where it’s initialized, you might want to use the type when you initialize it so you can see clearly what objects go into it.</p>
<pre data-type="programlisting"><strong>ArrayList&lt;String&gt; songs;</strong>
<strong>// lots of code between these lines...</strong>
<strong>songs = new ArrayList&lt;String&gt;();</strong></pre>
<p><strong>Q: Are there any other places the compiler can work out the types for me?</strong></p>
<p><strong>A:</strong> Yes! For example, the <strong><code>var</code></strong> keyword (“Local Variable Type Inference”), which we’ll talk about in <a data-type="xref" href="app02.xhtml#appendix_b_the_top_ten-ish_topics_that_d">Appendix B</a>. And another important example, lambda expressions, which we will see later in this chapter.</p>
<p><strong>Q: I saw you were creating an ArrayList but assigning it to a List reference, and that you created an ArrayList but returned a List from the method. Why not just use ArrayList everywhere?</strong></p>
<p><strong>A:</strong> One of the advantages of polymorphism is that code doesn’t need to know the specific implementation type of an object to work well with it. List is a well-known, well-understood interface (which we’ll see more of in this chapter). Code that is working with an ArrayList doesn’t usually need to know it’s an ArrayList. It could be a LinkedList. Or a specialized type of List. Code that’s working with the List only needs to know it can call List methods on it (like add(), size() etc). It’s usually safer to pass the interface type (i.e., List) around instead of the implementation. That way, other code can’t go rooting around inside your object in a way that was never intended.</p>
<p>It also means that should you ever want to change from an ArrayList to a LinkedList, or a CopyOnWriteArrayList (see <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a>, <em>Dealing with Concurrency Issues</em>) at a later date, you can without having to change all the places the List is used.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exploring the java.util API, List and Collections"><div class="sect1" id="exploring_the_javadotutil_apicomma_list">
<h1>Exploring the java.util API, List and Collections</h1>
<p><a data-type="indexterm" data-primary="ArrayList" id="idm46038392305968"/><a data-type="indexterm" data-primary="Collections class" id="idm46038392344128"/><a data-type="indexterm" data-primary="Collections.sort()" id="idm46038392343408"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="sorting with" id="idm46038392342576"/><a data-type="indexterm" data-primary="data structures" data-see="collections" id="idm46038392341472"/><a data-type="indexterm" data-primary="java.util API" id="idm46038392295040"/>We know that with an ArrayList, or any List, the elements are kept in the order in which they were added. So we’re going to need to sort the elements in the song list. In this chapter, we’ll be looking at some of the most important and commonly used collection classes in the java.util package, but for now, let’s limit ourselves to two classes: java.util.List and java.util.Collections.</p>
<p>We’ve been using ArrayList for a while now. Because ArrayList IS-A List and because many of the methods we’re familiar with on ArrayList come from List, we can comfortably transfer most of what we know about working with ArrayLists to List.</p>
<p>The Collections class is known as a “utility” class. It’s a class that has a lot of handy methods for working with the various collection types.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000030">
<p><strong>Excerpts from the API</strong></p>
<p>java.util.List</p>
<p>sort(<strong>Comparator</strong>): Sorts this list according to the order induced by the specified <strong>Comparator.</strong></p>
<p>java.util.Collections</p>
<p>sort(List): Sorts the specified list into ascending order, according to the <strong>natural ordering</strong> of its elements.</p>
<p>sort(List, <strong>Comparator</strong>): Sorts the specified list according to the order defined by the <strong>Comparator</strong>.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="In the “Real-World”™ there are lots of ways to sort"><div class="sect1" id="in_the_quotation_markreal-worldquotation">
<h1>In the “Real-World”™ there are lots of ways to sort</h1>
<p>We don’t always want our lists sorted alphabetically. We might want to sort clothes by size, or movies by how many five-star reviews they get. Java lets you sort the good old-fashioned way, alphabetically, and it also lets you create your own custom sorting approaches. Those references you see above to “Comparator” have to do with custom sorting, which we’ll get to later this chapter. So for now, let’s stick with “natural ordering” (alphabetical).</p>
<p>Since we know we have a List, it looks like we’ve found the perfect method, <strong>Collections.sort()</strong>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="“Natural Ordering,” what Java means by alphabetical"><div class="sect1" id="quotation_marknatural_orderingcommaquota">
<h1>“Natural Ordering,” what Java means by alphabetical</h1>
<p><a data-type="indexterm" data-primary="alphabetical (natural) ordering in Java" id="idm46038392335488"/><a data-type="indexterm" data-primary="natural ordering in Java (alphabetical)" id="idm46038392275456"/>Lou wants you to sort songs “alphabetically,” but what exactly does that mean? The A–Z part is obvious, but how about lowercase versus uppercase letters? How about numbers and special characters? Well, this is another can-of-worms topic, but Java uses Unicode, and for many of us in “the West” that means that numbers sort before uppercase letters, uppercase letters sort before lowercase letters, and some special characters sort before numbers and some sort after numbers. That’s pretty clear, right? Ha! Well, the upshot is that, by default, sorting in Java happens in what’s called “natural order,” which is more or less alphabetical. Let’s take a look at what happens when we sort our list of songs:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0315-01.png" alt="image" width="1449" height="692"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0315-02.png" alt="image" width="982" height="441"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But now you need Song objects, not just simple Strings"><div class="sect1" id="but_now_you_need_song_objectscomma_not_j">
<h1>But now you need Song objects, not just simple Strings</h1>
<p><a data-type="indexterm" data-primary="overriding methods" data-secondary="toString()" id="idm46038392299968"/><a data-type="indexterm" data-primary="Song class" id="idm46038392298736"/><a data-type="indexterm" data-primary="Song object" id="idm46038393151296"/><a data-type="indexterm" data-primary="toString()" id="idm46038392256864"/>Now your boss Lou wants actual Song class instances in the list, not just Strings, so that each Song can have more data. The new jukebox device outputs more information, so the actual song file will have <em>three</em> pieces of information for each song.</p>
<p>The Song class is really simple, with only one interesting feature—the overridden toString() method. Remember, the toString() method is defined in class Object, so every class in Java inherits the method. And since the toString() method is called on an object when it’s printed (System.out.println(anObject)), you should override it to print something more readable than the default unique identifier code. When you print a list, the toString() method will be called on each object.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0316-01.png" alt="image" width="1459" height="1297"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Changing the Jukebox code to use Songs instead of Strings"><div class="sect1" id="changing_the_jukebox_code_to_use_songs_i">
<h1>Changing the Jukebox code to use Songs instead of Strings</h1>
<p><a data-type="indexterm" data-primary="Collections.sort()" data-secondary="with Objects instead of Strings" id="idm46038392251856"/>Your code changes only a little. The big change is that the List will be of type &lt;SongV2&gt; instead of &lt;String&gt;.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0317-01.png" alt="image" width="1072" height="620"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0317-02.png" alt="image" width="668" height="680"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="It won’t compile!"><div class="sect1" id="it_wonapostrophet_compileexclamation_mar">
<h1>It won’t compile!</h1>
<p><a data-type="indexterm" data-primary="sort()" id="idm46038392236688"/>He’s right to be curious, something’s wrong...the Collections class clearly shows there’s a sort() method that takes a List. It <em>should</em> work.</p>
<p><strong><em>But it doesn’t!</em></strong></p>
<p>The compiler says it can’t find a sort method that takes a List&lt;SongV2&gt;, so maybe it doesn’t like a List of Song objects? It didn’t mind a List&lt;String&gt;, so what’s the important difference between Song and String? What’s the difference that’s making the compiler fail?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0318-01.png" alt="image" width="1070" height="337"/>
<h6/>
</div></figure>
<p>And of course you probably already asked yourself, “What would it be sorting <em>on</em>?” How would the sort method even <em>know</em> what made one Song greater or less than another Song? Obviously if you want the song’s <em>title</em> to be the value that determines how the songs are sorted, you’ll need some way to tell the sort method that it needs to use the title and not, say, the beats per minute.</p>
<p>We’ll get into all that a few pages from now, but first, let’s find out why the compiler won’t even let us pass a SongV2 List to the sort() method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0319-01.png" alt="image" width="483" height="860"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The sort() method declaration"><div class="sect1" id="the_sortleft_parenthesisright_parenthesi">
<h1>The sort() method declaration</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0319-02.png" alt="image" width="1293" height="123"/>
<h6/>
</div></figure>
<p>From the API docs (looking up the java.util.Collections class and scrolling to the sort() method), it looks like the sort() method is declared...<em>strangely</em>. Or at least different from anything we’ve seen so far.</p>
<p>That’s because the sort() method (along with other things in the whole collection framework in Java) makes heavy use of <em>generics</em>. Any time you see something with angle brackets in Java source code or documentation, it means generics—a feature added in Java 5. So it looks like we’ll have to learn how to interpret the documentation before we can figure out why we were able to sort String objects in a List, but not a List of Song objects.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Generics means more type-safety"><div class="sect1" id="generics_means_more_type-safety">
<h1>Generics means more type-safety</h1>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="and value of generics" id="idm46038393053760"/><a data-type="indexterm" data-primary="collections" data-secondary="generics for type-safe" id="idm46038392316544"/><a data-type="indexterm" data-primary="generics" id="idm46038392220736"/>Although generics can be used in other ways, you’ll often use generics to write type-safe collections. In other words, code that makes the compiler stop you from putting a Dog into a list of Ducks.</p>
<p>Without generics the compiler could not care less what you put into a collection, because all collection implementations hold type Object. You could put <em>anything</em> in any ArrayList without generics; it’s like the ArrayList is declared as ArrayList&lt;Object&gt;.</p>
<p><strong>WITHOUT generics</strong></p>
<p><strong>Objects go IN as a reference to SoccerBall, Fish, Guitar, and Car objects</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0320-01.png" alt="image" width="554" height="591"/>
<h6/>
</div></figure>
<p><strong>And come OUT as a reference of type Object</strong></p>
<hr/>
<p><strong>WITH generics</strong></p>
<p><strong>Objects go IN as a reference to only Fish objects</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0320-02.png" alt="image" width="1102" height="406"/>
<h6/>
</div></figure>
<p><strong>And come out as a reference of type Fish</strong></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;"><strong>Without generics, the compiler would happily let you put a Pumpkin into an ArrayList that was supposed to hold only Cat objects.</strong></span></p>
<p><span style="color:#636466;"><strong>With generics, you can create type-safe collections where more problems are caught at compile-time instead of runtime.</strong></span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Learning generics"><div class="sect1" id="learning_generics">
<h1>Learning generics</h1>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="and value of generics" id="idm46038392212240"/><a data-type="indexterm" data-primary="classes" data-secondary="generic" id="idm46038392210096"/><a data-type="indexterm" data-primary="generics" data-secondary="classes" id="idm46038392208992"/><a data-type="indexterm" data-primary="methods" data-secondary="generic" id="idm46038392207888"/><a data-type="indexterm" data-primary="polymorphism" data-secondary="with generic types" id="idm46038392206784"/><a data-type="indexterm" data-primary="variables" data-secondary="of generic types" id="idm46038392205680"/>Of the dozens of things you could learn about generics, there are really only three that matter to most programmers:</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>Creating instances of generic <em><u>classes</u></em> (like ArrayList)</strong></p>
<p>When you make an ArrayList, you have to tell it the type of objects you’ll allow in the list, just as you do with plain old arrays.</p>
<pre data-type="programlisting"><strong><span style="color:#636466;">new ArrayList</span>&lt;Song&gt;()</strong></pre>
</li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>Declaring and assigning <em><u>variables</u></em> of generic types</strong></p>
<p>How does polymorphism really work with generic types? If you have an ArrayList&lt;Animal&gt; reference variable, can you assign an ArrayList&lt;Dog&gt; to it? What about a List&lt;Animal&gt; reference? Can you assign an ArrayList&lt;Animal&gt; to it? You’ll see...</p>
<pre data-type="programlisting"><strong><span style="color:#636466;">List</span><strong>&lt;Song&gt;</strong><span style="color:#636466;">songList =</span></strong>
       <strong><span style="color:#636466;">new ArrayList</span><strong>&lt;Song&gt;()</strong></strong></pre>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>Declaring (and invoking) <em><u>methods</u></em> that take generic types</strong></p>
<p>If you have a method that has as a parameter, say, an ArrayList of Animal objects, what does that really mean? Can you also pass it an ArrayList of Dog objects? We’ll look at some subtle and tricky polymorphism issues that are very different from the way you write methods that take plain old arrays.</p>
<p>(This is actually the same point as #2, but that shows you how important we think it is.)</p>
<pre data-type="programlisting"><strong><span style="color:#636466;">void foo(List</span><strong>&lt;Song&gt;</strong> <span style="color:#636466;">list)</span></strong>

<strong><span style="color:#636466;">x.foo(songList)</span></strong></pre>
</li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00028">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: But don’t I also need to learn how to create my OWN generic classes? What if I want to make a class type that lets people instantiating the class decide the type of things that class will use?</strong></p>
<p><strong>A:</strong> You probably won’t do much of that. Think about it—the API designers made an entire library of collections classes covering most of the data structures you’d need, and the things that really need to be generic are collection classes or classes and methods that work on collections. There are some other cases too (like Optional, which we’ll see in the next chapter). Generally, generic classes are classes that hold or operate on objects of some other type they don’t know about.</p>
<p>Yes, it is possible that you might want to <em>create</em> generic classes, but that’s pretty advanced, so we won’t cover it here. (But you can figure it out from the things we <em>do</em> cover, anyway.)</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using generic CLASSES"><div class="sect1" id="using_generic_classes">
<h1>Using generic <u>CLASSES</u></h1>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="as generic class" id="idm46038392199824"/>Since ArrayList is one of our most-used generic classes, we’ll start by looking at its documentation. The two key areas to look at in a generic class are:</p>
<ol>
<li><p>The <em>class</em> declaration</p></li>
<li><p>The <em>method</em> declarations that let you add elements</p></li>
</ol>
<p><strong>Understanding ArrayList documentation <em>(Or, what’s the true meaning of “E”?)</em></strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0322-01.png" alt="image" width="1381" height="622"/>
<h6/>
</div></figure>
<p>The “E” represents the type used to create an instance of ArrayList. When you see an “E” in the ArrayList documentation, you can do a mental find/replace to exchange it for whatever &lt;type&gt; you use to instantiate ArrayList.</p>
<p>So, new ArrayList&lt;Song&gt; means that “E” becomes “Song” in any method or variable declaration that uses “E.”</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">Think of “E” as a stand-in for “the type of element you want this collection to hold and return.” (<u>E</u> is for <u>E</u>lement.)</span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using type parameters with ArrayList"><div class="sect1" id="using_type_parameters_with_arraylist">
<h1>Using type parameters with ArrayList</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0323-01.png" alt="image" width="1056" height="414"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="type parameters with" id="idm46038392157568"/><a data-type="indexterm" data-primary="Collections class" id="idm46038392156400"/><a data-type="indexterm" data-primary="parameters" data-secondary="type" data-see="type parameters" id="idm46038392155568"/><a data-type="indexterm" data-primary="type parameters" id="idm46038392154192"/><a data-type="indexterm" data-primary="type parameters" data-secondary="ArrayList" id="idm46038392153360"/><strong>Is treated by the compiler as:</strong></p>
<pre data-type="programlisting"><span style="color:#636466;"><strong>public class ArrayList</strong></span><strong>&lt;String&gt;</strong> <span style="color:#636466;"><strong>extends AbstractList</strong></span><strong>&lt;String&gt;</strong><span style="color:#636466;"><strong>... {</strong></span>

     <span style="color:#636466;"><strong>public boolean add(</strong></span><strong>String</strong> <span style="color:#636466;"><strong>o)</strong></span>
     <span style="color:#636466;"><strong>// more code</strong></span>
<span style="color:#636466;"><strong>}</strong></span></pre>
<p>In other words, the “E” is replaced by the <em>real</em> type (also called the <em>type parameter</em>) that you use when you create the ArrayList. And that’s why the add() method for ArrayList won’t let you add anything except objects of a reference type that’s compatible with the type of “E.” So if you make an ArrayList<strong>&lt;String&gt;</strong>, the add() method suddenly becomes <strong>add(String o)</strong>. If you make the ArrayList of type <strong>Dog</strong>, suddenly the add() method becomes <strong>add(Dog o)</strong>.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00029">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Is “E” the only thing you can put there? Because the docs for sort used “T”....</strong></p>
<p><strong>A:</strong> You can use anything that’s a legal Java identifier.  That means anything that you could use for a method or variable name will work as a type parameter. But you’ll often see single letter used. Another convention is to use “T” (“Type”) unless you’re specifically writing a collection class, where you’d use “E” to represent the “type of the Element the collection will hold.” Sometimes you’ll see “R” for “Return type.”</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using generic METHODS"><div class="sect1" id="using_generic_methods">
<h1>Using generic <u>METHODS</u></h1>
<p><a data-type="indexterm" data-primary="classes" data-secondary="without type parameters" id="idm46038392573296"/><a data-type="indexterm" data-primary="generics" data-secondary="methods" id="idm46038392139168"/><a data-type="indexterm" data-primary="methods" data-secondary="generic" id="idm46038392569120"/><a data-type="indexterm" data-primary="type parameters" data-secondary="generic methods" id="idm46038392568352"/><a data-type="indexterm" data-primary="type parameters" data-secondary="not defined in class declaration" id="idm46038392129984"/>A generic <em>class</em> means that the <em>class declaration</em> includes a type parameter. A generic <em>method</em> means that the <em>method declaration</em> uses a type parameter in its signature.</p>
<p>You can use type parameters in a method in several different ways:</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>Using a type parameter defined in the class declaration</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0324-01.png" alt="image" width="1029" height="157"/>
<h6/>
</div></figure>
<p>When you declare a type parameter for the class, you can simply use that type any place that you’d use a <em>real</em> class or interface type. The type declared in the method argument is essentially replaced with the type you use when you instantiate the class.</p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>Using a type parameter <code>that was NOT defined in the class declaration</code></strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0324-02.png" alt="image" width="1365" height="212"/>
<h6/>
</div></figure>
<p>If the class itself doesn’t use a type parameter, you can still specify one for a method, by declaring it in a really unusual (but available) space—<em>before the return type</em>. This method says that T can be “any type of Animal.”</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0325-01.png" alt="image" width="741" height="758"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Here’s where it gets weird..."><div class="sect1" id="hereapostrophes_where_it_gets_weirdhelli">
<h1>Here’s where it gets weird...</h1>
<p><a data-type="indexterm" data-primary="sort()" id="idm46038394717248"/><a data-type="indexterm" data-primary="sorting" id="idm46038392112912"/><a data-type="indexterm" data-primary="sorting" data-secondary="Comparable interface" id="idm46038392112080"/><strong><em>This:</em></strong></p>
<pre data-type="programlisting"><span style="color:#636466;"><strong>public</strong></span><strong>&lt;T extends Animal&gt;</strong> <span style="color:#636466;"><strong>void takeThing(ArrayList</strong></span><strong>&lt;T&gt;</strong> <span style="color:#636466;"><strong>list)</strong></span></pre>
<p><strong><em>Is NOT the same as this:</em></strong></p>
<pre data-type="programlisting"><span style="color:#636466;"><strong>public void takeThing(ArrayList</strong></span><strong>&lt;Animal&gt;</strong> <span style="color:#636466;"><strong>list)</strong></span></pre>
<p>Both are legal, but they’re <em>different</em>!</p>
<p>The first one, where <strong>&lt;T extends Animal&gt;</strong> is part of the method declaration, means that any ArrayList declared of a type that is Animal, or one of Animal’s subtypes (like Dog or Cat), is legal. So you could invoke the top method using an ArrayList&lt;Dog&gt;, ArrayList&lt;Cat&gt;, or ArrayList&lt;Animal&gt;.</p>
<p>But...the one on the bottom, where the method argument is (ArrayList&lt;Animal&gt; list) means that <em>only</em> an ArrayList&lt;Animal&gt; is legal. In other words, while the first version takes an ArrayList of any type that is a type of Animal (Animal, Dog, Cat, etc.), the second version takes <em>only</em> an ArrayList of type Animal. Not ArrayList&lt;Dog&gt; or ArrayList&lt;Cat&gt;, but only ArrayList&lt;Animal&gt;.</p>
<p>And yes, it does appear to violate the point of polymorphism, but it will become clear when we revisit this in detail at the end of the chapter. For now, remember that we’re only looking at this because we’re still trying to figure out how to sort() that SongList, and that led us into looking at the API for the sort() method, which had this strange generic type declaration.</p>
<p><strong><em>For now, all you need to know is that the syntax of the top version is legal and that it means you can pass in a ArrayList object instantiated as Animal or any Animal subtype.</em></strong></p>
<p>And now back to our sort() method...</p>
<figure class="informal"><div class="figure">
<img src="Images/f0326-01.png" alt="image" width="669" height="680"/>
<h6/>
</div></figure>
<p><strong>Remember where we were...</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0326-02.png" alt="image" width="952" height="368"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0326-03.png" alt="image" width="1220" height="522"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Revisiting the sort() method"><div class="sect1" id="revisiting_the_sortleft_parenthesisright">
<h1>Revisiting the sort() method</h1>
<p><a data-type="indexterm" data-primary="Comparable interface" data-secondary="Collections.sort()" id="idm46038392084928"/>So here we are, trying to read the sort() method docs to find out why it was OK to sort a list of Strings, but not a list of Song objects. And it looks like the answer is...</p>
<figure class="informal"><div class="figure">
<img src="Images/f0327-01.png" alt="image" width="1294" height="122"/>
<h6/>
</div></figure>
<p><strong>The sort() method can take only lists of</strong> <span style="color:#636466;"><strong>Comparable</strong></span> <strong>objects.</strong></p>
<p><strong>Song is NOT a subtype of Comparable, so you cannot sort() the list of Songs.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0327-02.png" alt="image" width="1423" height="385"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0327-03.png" alt="image" width="851" height="689"/>
<h6/>
</div></figure>
<pre data-type="programlisting"><span style="color:#636466;"><strong>public final class</strong></span> <strong>String</strong>
    <strong>implements</strong> <span style="color:#636466;"><strong>java.io.Serializable,</strong></span> <strong>Comparable&lt;String&gt;</strong>, <span style="color:#636466;"><strong>CharSequence {</strong></span></pre>
<p>Great point, and one that deserves a full answer! Turn the page...</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="In generics, “extends” means “extends or implements”"><div class="sect1" id="in_genericscomma_quotation_markextendsqu">
<h1>In generics, “extends” means “extends <u>or</u> implements”</h1>
<p><a data-type="indexterm" data-primary="classes" data-secondary="generic" id="idm46038392069312"/><a data-type="indexterm" data-primary="extends keyword" id="idm46038392066800"/><a data-type="indexterm" data-primary="generics" data-secondary="extends or implements" id="idm46038392066032"/><a data-type="indexterm" data-primary="keywords in Java" id="idm46038392064928"/><a data-type="indexterm" data-primary="reserved words" id="idm46038392064096"/>The Java engineers had to give you a way to put a constraint on a parameterized type so that you can restrict it to, say, only subclasses of Animal. But you also need to constrain a type to allow only classes that implement a particular interface. So here’s a situation where we need one kind of syntax to work for both situations—inheritance and implementation. In other words, that works for both <em>extends</em> and <em>implements</em>.</p>
<p>And the winning word was...<em>extends</em>. But it really means “IS-A” and works regardless of whether the type on the right is an interface or a class.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">In generics, the keyword “extends” really means “IS-A” and works for BOTH classes and interfaces.</span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0328-01.png" alt="image" width="1400" height="342"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00030">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Why didn’t they just make a new keyword, “is”?</strong></p>
<p><strong>A:</strong> Adding a new keyword to the language is a REALLY big deal because it risks breaking Java code you wrote in an earlier version. Think about it—you might be using a variable “is” (which we do use in this book to represent input streams).  And since you’re not allowed to use keywords as identifiers in your code, that means any earlier code that used the keyword <em>before</em> it was a reserved word, would break. So whenever there’s a chance for the language engineers to reuse an existing keyword, as they did here with “extends,” they’ll usually choose that. But sometimes they don’t have a choice.</p>
<p>In recent years, new “keyword-like” terms have been added to the language, without actually making it a keyword that would trample all over your earlier code. For example, the identifier <strong><code>var</code></strong>, which we’ll talk about in <a data-type="xref" href="app02.xhtml#appendix_b_the_top_ten-ish_topics_that_d">Appendix B</a>, is a <em>reserved type name</em>, not a keyword. This means any existing code that used var (for example, as a variable name) will not break if it’s compiled with a version of Java that supports <strong><code>var</code></strong>.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Finally we know what’s wrong..."><div class="sect1" id="finally_we_know_whatapostrophes_wronghel">
<h1>Finally we know what’s wrong...</h1>
<section data-type="sect2" data-pdf-bookmark="The Song class needs to implement Comparable"><div class="sect2" id="the_song_class_needs_to_implement_compar">
<h2>The Song class needs to implement Comparable</h2>
<p><a data-type="indexterm" data-primary="compareTo()" id="idm46038392179888"/>We can pass the ArrayList&lt;Song&gt; to the sort() method only if the Song class implements Comparable, since that’s the way the sort() method was declared. A quick check of the API docs shows the Comparable interface is really simple, with only one method to implement:</p>
<p><strong>java.lang.Comparable</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0329-01.png" alt="image" width="683" height="286"/>
<h6/>
</div></figure>
<p>And the method documentation for compareTo() says:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0329-02.png" alt="image" width="684" height="285"/>
<h6/>
</div></figure>
<p>It looks like the compareTo() method will be called on one Song object, passing that Song a reference to a different Song. The Song running the compareTo() method has to figure out if the Song it was passed should be sorted higher, lower, or the same in the list.</p>
<p>Your big job now is to decide what makes one song greater than another, and then implement the compareTo() method to reflect that. A negative number (any negative number) means the Song you were passed is greater than the Song running the method. Returning a positive number says that the Song running the method is greater than the Song passed to the compareTo() method. Returning zero means the Songs are equal (at least for the purpose of sorting...it doesn’t necessarily mean they’re the same object). You might, for example, have two Songs by different artists with the same title.</p>
<p>(That brings up a whole different can of worms we’ll look at later...)</p>
<p><strong>The big question is: what makes <em>one</em> song less than, equal to, or greater than <em>another</em> song?</strong></p>
<p><strong>You can’t implement the Comparable interface until you make that decision.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00023">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>Write in your idea and pseudocode (or better, REAL code) for implementing the compareTo()  method in a way that will sort() the Song objects by title.</p>
<p>Hint: if you’re on the right track, it should take less than three lines of code!</p>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Yours to solve.</strong></p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The new, improved, comparable Song class"><div class="sect1" id="the_newcomma_improvedcomma_comparable_so">
<h1>The new, improved, comparable Song class</h1>
<p>We decided we want to sort by title, so we implement the compareTo() method to compare the title of the Song passed to the method against the title of the song on which the compareTo() method was invoked. In other words, the song running the method has to decide how its title compares to the title of the method parameter.</p>
<p>Hmmm...we know that the String class must know about alphabetical order, because the sort() method worked on a list of Strings. We know String has a compareTo() method, so why not just call it? That way, we can simply let one title String compare itself to another, and we don’t have to write the comparing/alphabetizing algorithm!</p>
<figure class="informal"><div class="figure">
<img src="Images/f0330-01.png" alt="image" width="1420" height="1182"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0330-02.png" alt="image" width="975" height="368"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We can sort the list, but..."><div class="sect1" id="we_can_sort_the_listcomma_buthellip">
<h1>We can sort the list, but...</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0331-01.png" alt="image" width="520" height="803"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Collections.sort()" data-secondary="Comparator" id="idm46038392010784"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="sorting with" id="idm46038392009808"/><a data-type="indexterm" data-primary="List interface" data-secondary="Comparator with" id="idm46038392008832"/><a data-type="indexterm" data-primary="sorting" data-secondary="with Comparator" id="idm46038392007728"/>There’s a new problem—Lou wants two different views of the song list, one by song title and one by artist!</p>
<p>But when you make a collection element comparable (by having it implement Comparable), you get only one chance to implement the compareTo() method. So what can you do?</p>
<p>The horrible way would be to use a flag variable in the Song class and then do an <em>if</em> test in compareTo() and give a different result depending on whether the flag is set to use title or artist for the comparison.</p>
<p>But that’s an awful and brittle solution, and there’s something much better. Something built into the API for just this purpose—when you want to sort the same thing in more than one way.</p>
<p><strong>Look at API documentation again. There’s a second sort() method on Collections—and it takes a Comparator. There’s also a sort method on List that takes a Comparator.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0331-02.png" alt="image" width="1422" height="879"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using a custom Comparator"><div class="sect1" id="using_a_custom_comparator">
<h1>Using a custom Comparator</h1>
<p><a data-type="indexterm" data-primary="Collections.sort()" data-secondary="and List.sort()" id="idm46038392024960"/><a data-type="indexterm" data-primary="Comparable interface" data-secondary="versus Comparator" id="idm46038392002160"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="versus Comparable" id="idm46038392001184"/><a data-type="indexterm" data-primary="compare()" id="idm46038392000208"/><a data-type="indexterm" data-primary="compareTo()" id="idm46038391999472"/><a data-type="indexterm" data-primary="List.sort()" id="idm46038391998672"/>A <strong>Comparable</strong> element in a list can compare <em>itself</em> to another of its own type in only one way, using its compareTo() method. But a <strong>Comparator</strong> is external to the element type you’re comparing—it’s a separate class. So you can make as many of these as you like! Want to compare songs by artist? Make an ArtistComparator. Sort by beats per minute? Make a BpmComparator.</p>
<p>Then all you need to do is call a sort() method that takes a Comparator (Collections.sort or List.sort), which will use this Comparator to put things in order.</p>
<p>The sort() method that takes a Comparator will use the Comparator instead of the element’s own compareTo() method when it puts the elements in order. In other words, if your sort() method gets a Comparator, it won’t even <em>call</em> the compareTo() method of the elements in the list. The sort() method will instead invoke the <strong>compare</strong><strong>()</strong> method on the Comparator.</p>
<p>To summarize, the rules are:</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> Invoking the <strong>Collections.sort(List list)</strong> method means the list element’s compareTo() method determines the order. The elements in the list MUST implement the <strong>Comparable</strong> interface.</p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> Invoking <strong>List.sort(Comparator c)</strong> or <strong>Collections.sort(List list, Comparator c)</strong> means the <strong>Comparator</strong>’s compare() method will be used. That means the elements in the list do NOT need to implement the Comparable interface, but if they do, the list element’s compareTo() method will NOT be called.</p></li>
</ul>
<p><strong>java.util.Comparator</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0332-01.png" alt="image" width="611" height="286"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#636466;">If you pass a Comparator to the sort() method, the sort order is determined by the Comparator.</span></strong></p>
<p><strong><span style="color:#636466;">If you don’t pass a Comparator and the element is Comparable, the sort order is determined by the element’s compareTo() method.</span></strong></p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00031">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Why are there two sort methods that take a comparator on two different classes? Which sort method should I use?</strong></p>
<p><strong>A:</strong> Both methods that take a comparator, Collections.sort(List, Comparator) and List.sort(Comparator), do the same thing; you can use either and expect exactly the same results.</p>
<p>List.sort was introduced in Java 8, so older code <em>must</em> use Collections.sort(List, Comparator).</p>
<p>We use List.sort because it’s a bit shorter, and generally you already have the list you want to sort, so it makes sense to call the sort method on that list.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Updating the Jukebox to use a Comparator"><div class="sect1" id="updating_the_jukebox_to_use_a_comparator">
<h1>Updating the Jukebox to use a Comparator</h1>
<p><a data-type="indexterm" data-primary="Collections.sort()" data-secondary="compare()" id="idm46038392297120"/><a data-type="indexterm" data-primary="compare()" id="idm46038391977712"/>We’re going to update the Jukebox code in three ways:</p>
<p>1. Create a separate class that implements Comparator (and thus the <strong><em>compare()</em></strong> method that does the work previously done by <strong><em>compareTo()</em></strong>).</p>
<p>2. Make an instance of the Comparator class.</p>
<p>3. Call the List.sort() method, giving it the instance of the Comparator class.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0333-01.png" alt="image" width="1313" height="873"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0333-02.png" alt="image" width="1377" height="367"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/pencil1.png" alt="image" width="157" height="48"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Fill-in-the-blanks"><div class="sect1" id="fill_in_the_blanks">
<h1>Fill-in-the-blanks</h1>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038391974576"/>For each of the questions below, fill in the blank with one of the words from the “possible answers” list, to correctly answer the question.</p>
<p><strong>Possible Answers:</strong></p>
<pre data-type="programlisting"><strong>Comparator,</strong>
<strong>Comparable,</strong>
<strong>compareTo( ),</strong>
<strong>compare( ),</strong>
<strong>yes,</strong>
<strong>no</strong></pre>
<p>Given the following compilable statement:</p>
<pre data-type="programlisting"><strong>Collections.sort(myArrayList);</strong></pre>
<ol>
<li><p>What must the class of the objects stored in <code>myArrayList</code> implement?                  ________________</p></li>
<li><p>What method must the class of the objects stored in <code>myArrayList</code> implement?     ________________</p></li>
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement both <code>Comparator</code> AND <code>Comparable</code>?                                                                           ________________</p></li>
</ol>
<p>Given the following compilable statements (they both do the same thing):</p>
<pre data-type="programlisting"><strong>Collections.sort(myArrayList, myCompare);</strong>
<strong>myArrayList.sort(myCompare);</strong></pre>
<ol start="4">
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement <code>Comparable</code>?  ________________</p></li>
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement <code>Comparator</code>?  ________________</p></li>
<li><p>Must the class of the objects stored in <code>myArrayList</code> implement <code>Comparable</code>? ________________</p></li>
<li><p>Must the class of the objects stored in <code>myArrayList</code> implement <code>Comparator</code>? ________________</p></li>
<li><p>What must the class of the <code>myCompare</code> object implement?                                      ________________</p></li>
<li><p>What method must the class of the <code>myCompare</code> object implement? __________________</p></li>
</ol>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#fill_in_the_blanksleft_parenthesisfrom_p">“Fill-in-the-blanks”</a>.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But wait! We’re sorting in two different ways!"><div class="sect1" id="but_waitexclamation_mark_weapostrophere">
<h1>But wait! We’re sorting in two different ways!</h1>
<p><a data-type="indexterm" data-primary="Comparable interface" data-secondary="versus Comparator" id="idm46038391939088"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="versus Comparable" id="idm46038391937952"/>Now we’re able to sort the song list two ways:</p>
<ol>
<li><p>Using Collections.sort(songList), because Song implements <strong>Comparable</strong></p></li>
<li><p>Using songLists.sort(artistCompare) because the ArtistCompare class implements <strong>Comparator</strong></p></li>
</ol>
<p>While our new code allows us to sort songs by title and by artist, it is reminiscent of Frankenstein’s monster, cobbled together bit by bit.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0335-01.png" alt="image" width="1048" height="389"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#636466;">A better approach would be to handle all of the sorting definitions in classes that implement Comparator.</span></strong></p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00032">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: So does this mean that if you have a class that doesn’t implement Comparable, and you don’t have the source code, you could still put the things in order by creating a Comparator?</strong></p>
<p><strong>A:</strong> That’s right. The other option (if it’s possible) would be to subclass the element and make the subclass implement Comparable.</p>
<p><strong>Q: But why doesn’t <em>every</em> class implement Comparable?</strong></p>
<p><strong>A:</strong> Do you really believe that <em>everything</em> can be ordered? If you have element types that just don’t lend themselves to any kind of natural ordering, then you’d be misleading other programmers if you implement Comparable. And there’s no problem if you <em>don’t</em> implement Comparable, since a programmer can compare anything in any way that they choose using their own custom Comparator.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Sorting using only Comparators"><div class="sect1" id="sorting_using_only_comparators">
<h1>Sorting using only Comparators</h1>
<p>Having Song implement Comparable and creating a custom Comparator for sorting by Artist absolutely works, but it’s confusing to rely on two different mechanisms for our sort. It’s much clearer if our code uses the same technique to sort, regardless of how Lou wants his songs sorted. The code below has been updated to use Comparators for sorting by both Title and Artist; the new code is in bold.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0336-01.png" alt="image" width="1293" height="1027"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0336-02.png" alt="image" width="749" height="759"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Just the code that matters"><div class="sect1" id="just_the_code_that_matters">
<h1>Just the code that matters</h1>
<p><a data-type="indexterm" data-primary="inner classes" id="idm46038391921152"/>The Jukebox class does have a lot of code that’s needed for sorting. Let’s zoom in on one of the Comparator classes we wrote for Lou. The first thing to notice is that all we really want to sort our collection is the one line of code in the middle of the class. The rest of the code is just the long-winded syntax that’s necessary to let the compiler know what type of class this is and which method it implements.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="code_up_close">
<h5>Code Up Close</h5>
<figure class="informal"><div class="figure">
<img src="Images/common-07.png" alt="image" width="150" height="114"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0337-01.png" alt="image" width="1000" height="131"/>
<h6/>
</div></figure>
</div></aside>
<p>There’s more than one way to declare small pieces of functionality like this. One approach is inner classes, which we’ll look at in a later chapter. You can even declare the inner class right where you use it (instead of at the end of your class file); this is sometimes called an “argument-defined anonymous inner class.” Sounds fun already:</p>
<pre data-type="programlisting">songList.<strong>sort</strong>(new Comparator&lt;SongV3&gt;() {
  public int compare(SongV3 one, SongV3 two) {
    return one.getTitle().compareTo(two.getTitle());
  }
});</pre>
<p>While this lets us declare the sorting logic in exactly the location we need it (where we call the sort method, instead of in a separate class), there’s still a lot of code there for saying “sort by title please”).</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax">
<h5>Relax</h5>
<figure class="informal"><div class="figure">
<img src="Images/cup.png" alt="image" width="70" height="106"/>
<h6/>
</div></figure>
<p>We’re not going to learn how to write “argument-defined anonymous inner classes”!</p>
<p>We just wanted you to see this example, in case you stumble across it in Real Code.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What do we REALLY need in order to sort?"><div class="sect1" id="what_do_we_really_need_in_order_to_sortq">
<h1>What do we REALLY need in order to sort?</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0338-01.png" alt="image" width="1414" height="516"/>
<h6/>
</div></figure>
<p>Let’s take a look at the API documentation for the sort method on List:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0338-02.png" alt="image" width="1124" height="106"/>
<h6/>
</div></figure>
<p>If we were to explain out loud the following line of code:</p>
<pre data-type="programlisting"><strong>songList.sort(titleCompare);</strong></pre>
<p>We could say:</p>
<blockquote>
<p><span style="color:#636466;"><strong>“Call the sort method on the list of songs <span class="inlineimage"><img src="Images/1circle.png" alt="Images" width="20" height="20"/></span> and pass it a reference to a Comparator object, which is designed specifically to sort Song objects <span class="inlineimage"><img src="Images/2circle.png" alt="Images" width="23" height="23"/></span>.”</strong></span></p>
</blockquote>
<p>If we’re honest, we could say all that without even looking at the TitleCompare class. We can work it all out just by looking at the documentation for sort and the type of the List that we’re sorting!</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_barbell-id00001">
<h5>Brain Barbell</h5>
<figure class="informal"><div class="figure">
<img src="Images/barbell.png" alt="image" width="163" height="95"/>
<h6/>
</div></figure>
<p>Do you think the compiler cares about the name “TitleCompare”? If the class was called “FooBar” instead, would the code still work?</p>
</div></aside>
<p/>
<figure class="informal"><div class="figure"><img src="Images/f0339-01.png" alt="image" width="1311" height="1189"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Enter lambdas! Leveraging what the compiler can infer"><div class="sect1" id="enter_lambdasexclamation_mark_leveraging">
<h1>Enter lambdas! Leveraging what the compiler can infer</h1>
<p><a data-type="indexterm" data-primary="lambda expressions" id="idm46038391880944"/>We could write a whole bunch of code to say how to sort a list (like we have been doing)...</p>
<figure class="informal"><div class="figure">
<img src="Images/f0340-01.png" alt="image" width="1423" height="1107"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_barbell-id00002">
<h5>Brain Barbell</h5>
<figure class="informal"><div class="figure">
<img src="Images/barbell.png" alt="image" width="163" height="95"/>
<h6/>
</div></figure>
<p>What do you think would happen if Comparator needed you to implement more than one method? How much could the compiler fill in for you?</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Where did all that code go?"><div class="sect1" id="where_did_all_that_code_goquestion_mark">
<h1>Where did all that code go?</h1>
<p><a data-type="indexterm" data-primary="Comparator interface" data-secondary="lambda expressions with" id="idm46038391872816"/><a data-type="indexterm" data-primary="compare()" id="idm46038391871392"/><a data-type="indexterm" data-primary="SAM (Single Abstract Method)" id="idm46038391870560"/><a data-type="indexterm" data-primary="Single Abstract Method" data-see="SAM" id="idm46038391869760"/>To answer this question, let’s take a look at the API documentation for the Comparator interface.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0341-01.png" alt="image" width="1288" height="476"/>
<h6/>
</div></figure>
<p>Because equals has been implemented by Object, if we create a custom comparator, we know we only <em>need</em> to implement the compare method.</p>
<p>We also know exactly the shape of that method—it has to return an int, and it takes two arguments of type T (remember generics?). Our lambda expression implements the compare() method, without having to declare the class or the method, only the details of what goes into the body of the compare() method.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Some interfaces have only ONE method to implement"><div class="sect1" id="some_interfaces_have_only_one_method_to">
<h1>Some interfaces have only ONE method to implement</h1>
<p>With interfaces like Comparator, we only have to implement a <strong><em>single abstract method</em></strong>, SAM for short. These interfaces are so important that they have several special names:</p>
<p><strong>SAM Interfaces</strong> a.k.a. <strong>Functional Interfaces</strong></p>
<p>If an interface has only one method that needs to be implemented, that interface can be implemented as a <strong><em>lambda expression</em></strong>. You don’t need to create a whole class to implement the interface; the compiler knows what the class and method would look like. What the compiler <em>doesn’t</em> know is the logic that goes <em>inside</em> that method.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="relax-id0001">
<h5>Relax</h5>
<figure class="informal"><div class="figure">
<img src="Images/cup.png" alt="image" width="70" height="106"/>
<h6/>
</div></figure>
<p>We’ll look at lambda expressions and functional interfaces in much more detail in the next chapter. For now, back to Lou’s diner.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Updating the Jukebox code with lambdas"><div class="sect1" id="updating_the_jukebox_code_with_lambdas">
<h1>Updating the Jukebox code with lambdas</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0342-01.png" alt="image" width="1365" height="964"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0342-02.png" alt="image" width="1447" height="271"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00025">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p><strong>How could you sort the songs differently?</strong></p>
<p>Write lambda expressions to sort the songs in these ways (the answers are at the end of the chapter):</p>
<ul>
<li><p>Sort by BPM</p></li>
<li><p>Sort by title in descending order</p></li>
</ul>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#sorting_with_lambdas_left_parenthesisfro">“Sorting with lambdas”</a>.</strong></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="Images/pencil1.png" alt="image" width="157" height="48"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Reverse Engineer"><div class="sect1" id="reverse_engineer">
<h1>Reverse Engineer</h1>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038391838800"/>Assume this code exists in a single file. Your job is to fill in the blanks so the program will create the output shown.</p>
<pre data-type="programlisting"><strong>import __________________;</strong>
<strong>public class SortMountains {</strong>
  <strong>public static void main(String [] args) {</strong>
    <strong>new SortMountains().go();</strong>
  <strong>}</strong>

  <strong>public void go() {</strong>
    <strong>List______________ mountains = new ArrayList&lt;&gt;();</strong>
    <strong>mountains.add(new Mountain("Longs", 14255));</strong>
    <strong>mountains.add(new Mountain("Elbert", 14433));</strong>
    <strong>mountains.add(new Mountain("Maroon", 14156));</strong>
    <strong>mountains.add(new Mountain("Castle", 14265));</strong>
    <strong>System.out.println("as entered:\n" + mountains);</strong>

    <strong>mountains._______(____-&gt;____________);</strong>
    <strong>System.out.println("by name:\n" + mountains);</strong>

    <strong>_________._______(____-&gt;____________);</strong>
    <strong>System.out.println("by height:\n" + mountains);</strong>
  <strong>}</strong>
<strong>}</strong>
<strong>class Mountain {</strong>
  <strong>__________________;</strong>
  <strong>_________________;</strong>
  <strong>______________________ {</strong>
    <strong>_________________;</strong>
    <strong>_________________;</strong>
  <strong>}</strong>
  <strong>_________________________ {</strong>
    <strong>______________________________;</strong>
  <strong>}</strong>
<strong>}</strong></pre>
<p><strong>Output:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0343-02.png" alt="image" width="824" height="356"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#quotation_markreverse_engineerquotation">““Reverse Engineer” lambdas exercise”</a></strong>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Uh-oh. The sorting all works, but now we have duplicates..."><div class="sect1" id="uh-ohdot_the_sorting_all_workscomma_but">
<h1>Uh-oh. The sorting all works, but now we have duplicates...</h1>
<p>The sorting works great; now we know how to sort on both <em>title</em> and <em>artist</em>. But there’s a new problem we didn’t notice with a test sample of the jukebox songs—<strong><em>the sorted list contains duplicates.</em></strong></p>
<p>Unlike the mock code, Lou’s real jukebox application appears to just keep writing to the file regardless of whether the same song has already been played (and thus written) to the text file. The <em>SongListMore.txt</em> jukebox text file is an example. It’s a complete record of every song that was played, and might contain the same song multiple times.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0344-01.png" alt="image" width="1440" height="727"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0344-02.png" alt="image" width="1457" height="397"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We need a Set instead of a List"><div class="sect1" id="we_need_a_set_instead_of_a_list">
<h1>We need a <u>Set</u> instead of a <u>List</u></h1>
<p><a data-type="indexterm" data-primary="Collection API" id="idm46038391805808"/><a data-type="indexterm" data-primary="collections" id="idm46038391805296"/><a data-type="indexterm" data-primary="collections" data-secondary="List" data-see="List interface" id="idm46038391804560"/><a data-type="indexterm" data-primary="index position, List" id="idm46038391803280"/><a data-type="indexterm" data-primary="List interface" id="idm46038391802448"/><a data-type="indexterm" data-primary="Map interface" data-secondary="key-value pairs" id="idm46038391801616"/><a data-type="indexterm" data-primary="Set interface" id="idm46038391800512"/>From the Collection API, we find three main interfaces, <strong>List</strong>, <strong>Set</strong>, and <strong>Map</strong>. ArrayList is a <strong>List</strong>, but it looks like <strong><em>Set</em></strong> is exactly what we need.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>LIST</strong> - <strong>when <em>sequence</em> matters</strong></p>
<p>Collections that know about <em><strong>index position</strong></em>.</p>
<p>Lists know where something is in the list. You can have more than one element referencing the same object.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0345-01.png" alt="image" width="602" height="271"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>SET</strong> - <strong>when <em>uniqueness</em> matters</strong></p>
<p>Collections that <em><strong>do not allow duplicates</strong></em>.</p>
<p>Sets know whether something is already in the collection. You can never have more than one element referencing the same object (or more than one element referencing two objects that are considered equal—we’ll look at what object equality means in a moment).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0345-02.png" alt="image" width="446" height="275"/>
<h6/>
</div></figure>
</li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>MAP</strong> - <strong>when <em>finding something by key</em> matters</strong></p>
<p>Collections that use <em><strong>key-value pairs</strong></em>.</p>
<p>Maps know the value associated with a given key. You can have two keys that reference the same value, but you cannot have duplicate keys. A key can be any object.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0345-03.png" alt="image" width="646" height="307"/>
<h6/>
</div></figure></li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Collection API (part of it)"><div class="sect1" id="the_collection_api_left_parenthesispart">
<h1>The Collection API (part of it)</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0346-01.png" alt="image" width="1514" height="980"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Map interface" data-secondary="Collection API" id="idm46038391781200"/>Notice that the Map interface doesn’t actually extend the Collection interface, but Map is still considered part of the “Collection Framework” (also known as the “Collection API”). So Maps are still collections, even though they don’t include java.util.Collection in their inheritance tree.</p>
<p>(Note: this is not the complete collection API; there are other classes and interfaces, but these are the ones we care most about.)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0346-02.png" alt="image" width="1181" height="583"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using a HashSet instead of ArrayList"><div class="sect1" id="using_a_hashset_instead_of_arraylist">
<h1>Using a HashSet instead of ArrayList</h1>
<p><a data-type="indexterm" data-primary="ArrayList" data-secondary="HashSet instead of" id="idm46038391771744"/>We updated the Jukebox code to put the songs in a HashSet to try to eliminate our duplicate songs. (Note: we left out some of the Jukebox code, but you can copy it from earlier versions.)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0347-01.png" alt="image" width="1335" height="690"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0347-02.png" alt="image" width="1470" height="581"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#636466;">The Set didn’t help!!</span></strong></p>
<p><strong><span style="color:#636466;">We still have all the duplicates!</span></strong></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What makes two objects equal?"><div class="sect1" id="what_makes_two_objects_equalquestion_mar">
<h1>What makes two objects equal?</h1>
<p><a data-type="indexterm" data-primary="&lt;=, ==,!=, &gt;, &gt;= (comparison operators)" id="idm46038391762240"/><a data-type="indexterm" data-primary="== (equals operator)" id="idm46038391761504"/><a data-type="indexterm" data-primary="comparison operators" id="idm46038391760768"/><a data-type="indexterm" data-primary="equality" id="idm46038391760032"/><a data-type="indexterm" data-primary="equals operator (==)" id="idm46038391759296"/><a data-type="indexterm" data-primary="hashCode()" id="idm46038391758560"/><a data-type="indexterm" data-primary="objects" data-secondary="equality" id="idm46038391757824"/><a data-type="indexterm" data-primary="operators" data-secondary="comparison" id="idm46038391756816"/><a data-type="indexterm" data-primary="operators" data-secondary="equals (==)" id="idm46038391755712"/><a data-type="indexterm" data-primary="reference variables" data-secondary="equality" id="idm46038391754608"/>To figure out why using a Set didn’t remove the duplicates, we have to ask—what makes two Song references duplicates? They must be considered <strong><em>equal</em></strong>. Is it simply two references to the very same object, or is it two separate objects that both have the same <em>title</em>?</p>
<p>This brings up a key issue: <em>reference</em> equality vs. <em>object</em> equality.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong><span style="color:#636466;">Reference</span> equality</strong></p>
<p><strong>Two references, one object on the heap.</strong></p>
<p>Two references that refer to the same object on the heap are equal. Period. If you call the <strong><code>hashCode()</code></strong> method on both references, you’ll get the same result. If you don’t override the hashCode <code>()</code> method, the default behavior (remember, you inherited this from class Object) is that each object will get a unique number (most versions of Java assign a hashcode based on the object’s memory address on the heap, so no two objects will have the same hashcode).</p>
<p>If you want to know if two <em>references</em> are really referring to the same object, use the == operator, which (remember) compares the bits in the variables. If both references point to the same object, the bits will be identical.</p></li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000031">
<p><strong>If two objects <em>foo</em> and <em>bar</em> are equal, <em>foo.equals(bar)</em> and <em>bar.equals(foo)</em> must be true, and both <em>foo</em> and <em>bar</em> must return the same value from <em>hashCode()</em>. For a Set to treat two objects as duplicates, you must override the hashCode() and equals() methods inherited from class Object so that you can make two different objects be viewed as equal.</strong></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="Images/f0348-02.png" alt="image" width="584" height="518"/>
<h6/>
</div></figure>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong><span style="color:#636466;">Object</span> equality</strong></p>
<p><strong>Two references, two objects on the heap, but the objects are considered <em>meaningfully equivalent.</em></strong></p>
<p>If you want to treat two different Song objects as equal (for example if you decided that two Songs are the same if they have matching <em>title</em> variables), you must override <em>both</em> the <strong>hashCode()</strong> and <strong>equals()</strong> methods inherited from class Object.</p>
<p>As we said above, if you <em>don’t</em> override hashCode(), the default behavior (from Object) is to give each object a unique hashcode value. So you must override hashCode() to be sure that two equivalent objects return the same hashcode. But you must also override equals() so that if you call it on <em>either</em> object, passing in the other object, always returns <em><strong>true</strong></em>.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0348-03.png" alt="image" width="609" height="485"/>
<h6/>
</div></figure>
<pre data-type="programlisting">if (song1.equals(song2) &amp;&amp; song1.hashCode() == song2.hashCode()) {
    // both references are referring to either a
    // a single object, or to two objects that are equal
}</pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How a HashSet checks for duplicates: hashCode() and equals()"><div class="sect1" id="how_a_hashset_checks_for_duplicates_hash">
<h1>How a HashSet checks for duplicates: hashCode() and equals()</h1>
<p><a data-type="indexterm" data-primary="equality" id="idm46038391728640"/><a data-type="indexterm" data-primary="equals()" id="idm46038391727680"/><a data-type="indexterm" data-primary="objects" data-secondary="equality" id="idm46038391726848"/><a data-type="indexterm" data-primary="Set interface" id="idm46038391725744"/>When you put an object into a HashSet, it calls the object’s hashCode method to determine where to put the object in the Set. But it also compares the object’s hash code to the hash code of all the other objects in the HashSet, and if there’s no matching hash code, the HashSet assumes that this new object is <em>not</em> a duplicate.</p>
<p>In other words, if the hash codes are different, the HashSet assumes there’s no way the objects can be equal!</p>
<p>So you must override hashCode() to make sure the objects have the same value.</p>
<p>But two objects with the same hash code might <em>not</em> be equal (more on this on the next page), so if the HashSet finds a matching hash code for two objects—one you’re inserting and one already in the set—the HashSet will then call one of the object’s equals() methods to see if these hash code–matched objects really <em>are</em> equal.</p>
<p>And if they’re equal, the HashSet knows that the object you’re attempting to add is a duplicate of something in the Set, so the add doesn’t happen.</p>
<p>You don’t get an exception, but the HashSet’s add() method returns a boolean to tell you (if you care) whether the new object was added. So if the add() method returns <em>false</em>, you know the new object was a duplicate of something already in the set.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0349-01.png" alt="image" width="2026" height="1507"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The Song class with overridden hashCode() and equals()"><div class="sect1" id="the_song_class_with_overridden_hashcodel">
<h1>The Song class with overridden hashCode() and equals()</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0350-01.png" alt="image" width="1384" height="1311"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0350-02.png" alt="image" width="881" height="497"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000032">
<p><a data-type="indexterm" data-primary="overriding methods" data-secondary="hashCode() and equals()" id="idm46038391713072"/><strong>Java Object Law for hashCode() and equals()</strong></p>
<hr/>
<p><strong>The API docs for class Object state the rules you MUST follow:</strong></p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>If two objects are equal, they MUST have matching hash codes.</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>If two objects are equal, calling equals() on either object MUST return true. In other words, if (a.equals(b)) then (b.equals(a)).</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>If two objects have the same hash code value, they are NOT required to be equal. But if they’re equal, they MUST have the same hash code value.</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>So, if you override equals(), you MUST override hashCode().</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>The default behavior of hashCode() is to generate a unique integer for each object on the heap. So if you don’t override hashCode() in a class, no two objects of that type can EVER be considered equal.</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>The default behavior of equals() is to do an == comparison. In other words, to test whether the two references refer to a single object on the heap. So if you don’t override equals() in a class, no two objects can EVER be considered equal since references to two different objects will always contain a different bit pattern.</strong></p>
<p><strong><em>a.equals(b)</em> must also mean that</strong></p>
<p><strong><em>a.hashCode()</em> == b.hashCode()</strong></p>
<p><strong>But <em>a.hashCode()</em> == <em>b.hashCode()</em></strong></p>
<p><strong>does NOT have to mean <em>a.equals(b)</em></strong></p>
</li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00033">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: How come hash codes can be the same even if objects aren’t equal?</strong></p>
<p><strong>A:</strong> HashSets use hash codes to store the elements in a way that makes it much faster to access. If you try to find an object in an ArrayList by giving the ArrayList a copy of the object (as opposed to an index value), the ArrayList has to start searching from the beginning, looking at each element in the list to see if it matches. But a HashSet can find an object much more quickly, because it uses the hash code as a kind of label on the “bucket” where it stored the element. So if you say, “I want you to find an object in the set that’s exactly like this one...,” the HashSet gets the hash code value from the copy of the Song you give it (say, 742), and then the HashSet says, “Oh, I know exactly where the object with hash code #742 is stored...,” and it goes right to the #742 bucket.</p>
<p>This isn’t the whole story you get in a computer science class, but it’s enough for you to use HashSets effectively. In reality, developing a good hashing algorithm is the subject of many a PhD thesis, and more than we want to cover in this book.</p>
<p>The point is that hash codes can be the same without necessarily guaranteeing that the objects are equal, because the “hashing algorithm” used in the hashCode() method might happen to return the same value for multiple objects. And yes, that means that multiple objects would all land in the same hash code bucket in the HashSet, but that’s not the end of the world. The HashSet might be a little less efficient, because if the HashSet finds more than one object in the same hash code bucket, it has to use the equals() on all those objects to see if there’s a perfect match.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="If we want the set to stay sorted, we’ve got TreeSet"><div class="sect1" id="if_we_want_the_set_to_stay_sortedcomma_w">
<h1>If we want the set to <u>stay</u> sorted, we’ve got TreeSet</h1>
<p><a data-type="indexterm" data-primary="compareTo()" id="idm46038391683520"/><a data-type="indexterm" data-primary="sorting" data-secondary="TreeSet" id="idm46038391779536"/><a data-type="indexterm" data-primary="TreeSet" id="idm46038391685808"/>TreeSet is similar to HashSet in that it prevents duplicates. But it also <em>keeps</em> the list sorted. It works just like the sort() method in that if you make a TreeSet without giving it a Comparator, the TreeSet uses each object’s compareTo() method for the sort. But you have the option of passing a Comparator to the TreeSet constructor, to have the TreeSet use that instead.</p>
<p>The downside to TreeSet is that if you don’t <em>need</em> sorting, you’re still paying for it with a small performance hit. But you’ll probably find that the hit is almost impossible to notice for most apps.</p>
<pre data-type="programlisting">public class Jukebox10 {
  public static void main(String[] args) {
    new Jukebox10().go();
  }

  public void go() {
    List&lt;SongV4&gt; songList = MockMoreSongs.getSongsV4();
    System.out.println(songList);

    songList.sort((one, two) -&gt; one.getTitle().compareTo(two.getTitle()));
    System.out.println(songList);

    <strong>Set&lt;SongV4&gt; songSet = new TreeSet&lt;&gt;(songList);</strong>
    System.out.println(songSet);
  }
}</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">Create a TreeSet instead of HashSet. The TreeSet will use SongV4’s compareTo() method to sort the items in songList.</span></p>
</div>
<p>If we want the TreeSet to sort on something different (i.e., to NOT use SongV4’s compareTo() method), we need to pass in a Comparator (or a lambda) to the TreeSet constructor. Then we’d use songSet.addAll() to add the songList values into the TreeSet.</p>
<pre data-type="programlisting"><strong>Set&lt;SongV4&gt; songSet = new TreeSet&lt;&gt;((o1, o2) -&gt; o1.getBpm() - o2.getBpm());</strong>
<strong>songSet.addAll(songList);</strong></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">Yep, another lambda for sorting. This one sorts by BPM. Remember, this lambda implements Comparator.</span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What you MUST know about TreeSet..."><div class="sect1" id="what_you_must_know_about_treesethellip">
<h1>What you MUST know about TreeSet...</h1>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038391733616"/>TreeSet looks easy, but make sure you really understand what you need to do to use it. We thought it was so important that we made it an exercise so you’d <em>have</em> to think about it. Do NOT turn the page until you’ve done this. <em>We mean it.</em></p>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#treeset_exercise_left_parenthesisfrom_pa">“TreeSet exercise”</a>.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00026">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>Look at this code. Read it carefully, then answer the questions below. (Note: there are no syntax errors in this code.)</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar" style="border-solid:#000000;"><div class="sidebar" id="id00000033">
<pre data-type="programlisting"><strong>import java.util.*;</strong>
<strong>public class TestTree {</strong>
  <strong>public static void main(String[] args) {</strong>
    <strong>new TestTree().go();</strong>
  <strong>}</strong>

  <strong>public void go() {</strong>
    <strong>Book b1 = new Book("How Cats Work");</strong>
    <strong>Book b2 = new Book("Remix your Body");</strong>
    <strong>Book b3 = new Book("Finding Emo");</strong>

    <strong>Set&lt;Book&gt; tree = new TreeSet&lt;&gt;();</strong>
    <strong>tree.add(b1);</strong>
    <strong>tree.add(b2);</strong>
    <strong>tree.add(b3);</strong>
    <strong>System.out.println(tree);</strong>
  <strong>}</strong>
<strong>}</strong>
<strong>class Book {</strong>
  <strong>private String title;</strong>
  <strong>public Book(String t) {</strong>
    <strong>title = t;</strong>
  <strong>}</strong>
<strong>}</strong></pre></div></aside>
<p>1. What is the result when you compile this code?</p>
<p>__________________________________________________</p>
<p>2. If it compiles, what is the result when you run the TestTree class?</p>
<p>__________________________________________________</p>
<p>3. If there is a problem (either compile-time or runtime) with this code,  how would you fix it?</p>
<p>__________________________________________________</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="TreeSet elements MUST be comparable"><div class="sect1" id="treeset_elements_must_be_comparable">
<h1>TreeSet elements MUST be comparable</h1>
<p><a data-type="indexterm" data-primary="Comparable interface" id="idm46038391639392"/><a data-type="indexterm" data-primary="Comparator interface" data-secondary="and TreeSet" id="idm46038391633296"/>TreeSet can’t read the programmer’s mind to figure out how the objects should be sorted. You have to tell the TreeSet <em>how</em>.</p>
<p><strong>To use a TreeSet, one of these things must be true:</strong></p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>The elements in the list must be of a type that implements</strong> <span style="color:#646466;"><em><strong>Comparable</strong></em></span></p>
<p>The Book class on the previous page didn’t implement Comparable, so it wouldn’t work at runtime. Think about it, the poor TreeSet’s sole purpose in life is to keep your elements sorted, and once again—it had no idea how to sort Book objects! It doesn’t fail at compile-time, because the TreeSet add() method doesn’t take a Comparable type. The TreeSet add() method takes whatever type you used when you created the TreeSet. In other words, if you say new TreeSet&lt;Book&gt;(), the add() method is essentially add(Book). And there’s no requirement that the Book class implement Comparable! But it fails at runtime when you add the second element to the set. That’s the first time the set tries to call one of the object’s compareTo() methods and...can’t.</p>
<p><strong>OR</strong></p></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>You use the TreeSet’s overloaded constructor that takes a</strong> <span style="color:#636466;"><strong><em>Comparator</em></strong></span></p>
<p>TreeSet works a lot like the sort() method—you have a choice of using the element’s compareTo() method, assuming the element type implemented the Comparable interface, OR you can use a custom Comparator that knows how to sort the elements in the set. To use a custom Comparator, you call the TreeSet constructor that takes a Comparator.</p></li>
</ul>
<pre data-type="programlisting">class Book <strong>implements Comparable&lt;Book&gt;</strong> {
  private String title;
  public Book(String t) {
    title = t;
  }

  <strong>public int compareTo(Book other) {</strong>
    <strong>return title.compareTo(other.title);</strong>
  <strong>}</strong>
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0354-02.png" alt="image" width="567" height="397"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We’ve seen Lists and Sets, now we’ll use a Map"><div class="sect1" id="weapostropheve_seen_lists_and_setscomma">
<h1>We’ve seen Lists and Sets, now we’ll use a Map</h1>
<p><a data-type="indexterm" data-primary="collections" data-secondary="Map" id="idm46038391609600"/><a data-type="indexterm" data-primary="key-value pairs, Map" id="idm46038391608464"/><a data-type="indexterm" data-primary="Map interface" id="idm46038391607600"/>Lists and Sets are great, but sometimes a Map is the best collection (not Collection with a capital “C”—remember that Maps are part of Java collections but they don’t implement the Collection interface).</p>
<p>Imagine you want a collection that acts like a property list, where you give it a name and it gives you back the value associated with that name. Keys can be any Java object (or, through autoboxing, a primitive), but you’ll often see String keys (i.e., property names) or Integer keys (representing unique IDs, for example).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0355-01.png" alt="image" width="480" height="164"/>
<h6/>
</div></figure>
<p><strong>Each element in a Map is actually TWO objects—a <u><em>key</em></u> and a <u><em>value</em></u>. You can have duplicate values, but NOT duplicate <em>keys</em>.</strong></p>
<p><strong>Map example</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0355-02.png" alt="image" width="874" height="341"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0355-03.png" alt="image" width="966" height="181"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0356-01.png" alt="image" width="867" height="483"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Creating and filling collections"><div class="sect1" id="creating_and_filling_collections">
<h1>Creating and filling collections</h1>
<p><a data-type="indexterm" data-primary="collections" data-secondary="factory methods" id="idm46038391594768"/><a data-type="indexterm" data-primary="Collectors.toUnmodifiableList" id="idm46038391593792"/><a data-type="indexterm" data-primary="factory methods" id="idm46038391593056"/><a data-type="indexterm" data-primary="List interface" data-secondary="unmodifiable output" id="idm46038391592320"/>The code for creating, and then filling, a collection crops up again and again. You’ve already seen code for creating an ArrayList and adding elements to it quite a few times. Code like this:</p>
<pre data-type="programlisting"><strong>List&lt;String&gt; songs = new ArrayList&lt;&gt;();</strong>
<strong>songs.add("somersault");</strong>
<strong>songs.add("cassidy");</strong>
<strong>songs.add("$10");</strong></pre>
<p>Whether you’re creating a List, a Set, or a Map, it looks pretty similar. What’s more, these types of collections are often ones where we know what the data is right at the start, and then we don’t intend to change it at all during the lifetime of the collection. If we wanted to really make sure that no-one changed the collection after we’d created it, we’d have to add an extra step:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0356-03.png" alt="image" width="751" height="222"/>
<h6/>
</div></figure>
<p>That’s a lot of code! And it’s a lot of code for something common that we probably want to do a lot.</p>
<p>Fortunately for us, Java now has “Convenience Factory Methods of Collections” (they were added in Java 9). We can use these methods to create common data structures and fill them with data, with just one method call.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Convenience Factory Methods for Collections"><div class="sect1" id="convenience_factory_methods_for_collecti">
<h1>Convenience Factory Methods for Collections</h1>
<p><a data-type="indexterm" data-primary="convenience methods" id="idm46038392312592"/><a data-type="indexterm" data-primary="List.of()" id="idm46038392311664"/><a data-type="indexterm" data-primary="Map.of()" id="idm46038391586592"/><a data-type="indexterm" data-primary="Map.ofEntries()" id="idm46038391585856"/><a data-type="indexterm" data-primary="Set.of()" id="idm46038391585120"/>Convenience Factory Methods for Collections allow you to easily create a List, Set, or Map that’s been prefilled with known data. There are a couple of things to understand about using them:</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>The resulting collections cannot be changed.</strong> You can’t add to them or alter the values; in fact, you can’t even do the sorting that we’ve seen in this chapter.</p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>The resulting collections are not the standard Collections we’ve seen</strong>. These are not ArrayList, HashSet, HashMap, etc. You can rely on them to behave according to their interface: a List will always preserve the order in which the elements were placed; a Set will never have duplicates. But you can’t rely on them being a specific implementation of List, Set, or Map.</p></li>
</ul>
<p>Convenience Factory Methods are just that—a convenience that will work for most of the cases where you want to create a collection prefilled with data. And for those cases where these factory methods don’t suit you, you can still use the Collections constructors and add() or put() methods instead.</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>Creating a List:</strong> <code><strong>List.of()</strong></code></p>
<p>To create the list of Strings from the last page, we don’t need five lines of code; we just need one:</p>
<pre data-type="programlisting"><strong>List&lt;String&gt; strings = List.of("somersault", "cassidy", "$10");</strong></pre>
<p>If you want to add Song objects instead of simple Strings, it’s still short and descriptive:</p>
<pre data-type="programlisting"><strong>List&lt;SongV4&gt; songs = List.of(new SongV4("somersault", "zero 7", 147),</strong>
                             <strong>new SongV4("cassidy", "grateful dead", 158),</strong>
                             <strong>new SongV4("$10", "hitchhiker", 140));</strong></pre></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>Creating a Set:</strong> <code><strong>Set.of()</strong></code></p>
<p>Creating a Set uses very similar syntax:</p>
<pre data-type="programlisting"><strong>Set&lt;Book&gt; books = Set.of(new Book("How Cats Work"),</strong>
                         <strong>new Book("Remix your Body"),</strong>
                         <strong>new Book("Finding Emo"));</strong></pre></li>
<li><p><span class="inlineimage"><img src="Images/arrow.png" alt="Images" width="14" height="16"/></span> <strong>Creating a Map:</strong> <code><strong>Map.of(), Map.ofEntries()</strong></code></p>
<p>Maps are different, because they take two objects for each “entry”—a key and a value. If you want to put less than 10 entries into your Map, you can use Map.of, passing in key, value, key, value, etc.:</p>
<pre data-type="programlisting"><strong>Map&lt;String, Integer&gt; scores = Map.of("Kathy", 42,</strong>
                                     <strong>"Bert", 343,</strong>
                                     <strong>"Skyler", 420);</strong></pre>
<p>If you have more than 10 entries, or if you want to be clearer about how your keys are paired up to their values, you can use Map.ofEntries instead:</p>
<pre data-type="programlisting"><strong>Map&lt;String, String&gt; stores = Map.ofEntries(Map.entry("Riley", "Supersports"),</strong>
                                           <strong>Map.entry("Brooklyn", "Camera World"),</strong>
                                           <strong>Map.entry("Jay", "Homecase"));</strong></pre>
<p>To make the line shorter, you can use a <em>static import</em> on Map.entry (we talked about static imports in <a data-type="xref" href="ch10.xhtml#numbers_matter_numbers_and_statics">Chapter 10</a>).</p></li>
</ul>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Finally, back to generics"><div class="sect1" id="finallycomma_back_to_generics">
<h1>Finally, back to generics</h1>
<p><a data-type="indexterm" data-primary="arguments" data-secondary="with generic types" id="idm46038391563904"/><a data-type="indexterm" data-primary="generics" data-secondary="and polymorphic arguments" id="idm46038391562928"/><a data-type="indexterm" data-primary="polymorphism" data-secondary="with generic types" id="idm46038391561920"/>Remember earlier in the chapter we talked about how methods that take arguments with generic types can be...<em>weird</em>. And we mean weird in the polymorphic sense. If things start to feel strange here, just keep going—it takes a few pages to really tell the whole story. The examples are going to use a class hierarchy of Animals.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0358-01.png" alt="image" width="840" height="239"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Using polymorphic arguments and generics"><div class="sect2" id="using_polymorphic_arguments_and_generics">
<h2>Using polymorphic arguments and generics</h2>
<p>Generics can be a little...counterintuitive when it comes to using polymorphism with a generic type (the class inside the angle brackets). Let’s create a method that takes a List&lt;Animal&gt; and use this to experiment.</p>
<p><strong>Passing in List&lt;Animal&gt;</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0358-02.png" alt="image" width="866" height="374"/>
<h6/>
</div></figure>
<p><strong>Compiles and runs just fine</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0358-03.png" alt="image" width="524" height="201"/>
<h6/>
</div></figure>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="But will it work with List&lt;Dog&gt;?"><div class="sect1" id="but_will_it_work_with_listless_thandoggr">
<h1>But will it work with List&lt;Dog&gt;?</h1>
<p>A List&lt;Animal&gt; argument can be passed to a method with a List&lt;Animal&gt; parameter. So the big question is, will the List&lt;Animal&gt; parameter accept a List&lt;Dog&gt;? Isn’t that what polymorphism is for?</p>
<p><strong>Passing in List&lt;Dog&gt;</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0359-01.png" alt="image" width="821" height="314"/>
<h6/>
</div></figure>
<p><strong>When we compile it:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0359-02.png" alt="image" width="968" height="242"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0360-01.png" alt="image" width="542" height="538"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What could happen if it were allowed...?"><div class="sect1" id="what_could_happen_if_it_were_allowedhell">
<h1>What could happen if it were allowed...?</h1>
<p>Imagine the compiler let you get away with that. It let you pass a List&lt;<u>Dog</u>&gt; to a method declared as:</p>
<pre data-type="programlisting">public void takeAnimals(<strong>List&lt;<u>Animal</u>&gt;</strong> animals) {
  for (Animal a : animals) {
    a.eat();
  }
}</pre>
<p>There’s nothing in that method that <em>looks</em> harmful, right? After all, the whole point of polymorphism is that anything an Animal can do (in this case, the eat() method), a Dog can do as well. So what’s the problem with having the method call eat() on each of the Dog references?</p>
<p>There’s nothing wrong with <em>that</em> code. But imagine <em>this</em> code instead:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0360-03.png" alt="image" width="731" height="89"/>
<h6/>
</div></figure>
<p>So that’s the problem. There’s certainly nothing wrong with adding a Cat to a List&lt;Animal&gt;, and that’s the whole point of having a List of a supertype like Animal—so that you can put all types of animals in a single Animal List.</p>
<p>But if you passed a Dog List—one meant to hold ONLY Dogs—to this method that takes an Animal List, then suddenly you’d end up with a Cat in the Dog list. The compiler knows that if it lets you pass a Dog List into the method like that, someone could, at runtime, add a Cat to your Dog list. So instead, the compiler just won’t let you take the risk.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><strong><span style="color:#636466;">If you declare a method to take List&lt;Animal&gt;, it can take ONLY a List&lt;Animal&gt;, not List&lt;Dog&gt; or List&lt;Cat&gt;.</span></strong></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0361-02.png" alt="image" width="653" height="751"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="We can do this with wildcards"><div class="sect1" id="we_can_do_this_with_wildcards">
<h1>We can do this with wildcards</h1>
<p>It looks unusual, but there <em>is</em> a way to create a method argument that can accept a List of any Animal subtype. The simplest way is to use a <strong>wildcard</strong>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0361-01.png" alt="image" width="682" height="107"/>
<h6/>
</div></figure>
<p>So now you’re wondering, “What’s the <em>difference</em>? Don’t you have the same problem as before?”</p>
<p>And you’d be right for wondering. The answer is NO. When you use the wildcard &lt;?&gt; in your declaration, the compiler won’t let you do anything that adds to the list!</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000034">
<p><strong>When you use a wildcard in your method argument, the compiler will STOP you from doing anything that could hurt the list referenced by the method parameter.</strong></p>
<p><strong>You can still call methods on the elements in the list, but you cannot <u>add</u> elements to the list.</strong></p>
<p><strong>In other words, you can do things <em>with</em> the list elements, but you can’t put <em>new</em> things in the list.</strong></p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00034">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Back when we first saw generic methods, there was a similar-looking method that declared the generic type in front of the method name. Does that do the same thing as this takeAnimals method?</strong></p>
<p><strong>A:</strong> Well spotted! Back at the start of the chapter, there was a method like this:</p>
<pre data-type="programlisting"><strong>&lt;T extends Animal&gt;</strong> void takeThing(List<strong>&lt;T&gt;</strong> list)</pre>
<p>We actually could use this syntax to achieve a similar thing, but it works in a slightly different way. Yes, you can pass List&lt;Animal&gt; and List&lt;Dog&gt; into the method, but you get the added benefit of being able to use the generic type, T, elsewhere too.</p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using the method’s generic type parameter"><div class="sect1" id="using_the_methodapostrophes_generic_type">
<h1>Using the method’s generic type parameter</h1>
<p><a data-type="indexterm" data-primary="generics" data-secondary="type parameters" id="idm46038392055168"/><a data-type="indexterm" data-primary="methods" data-secondary="generic" id="idm46038391517872"/><a data-type="indexterm" data-primary="type parameters" data-secondary="generic methods" id="idm46038391516768"/>What can we do if we define our method like this instead?</p>
<pre data-type="programlisting">public <strong>&lt;T extends Animal&gt;</strong> void takeAnimals(List<strong>&lt;T&gt;</strong> list) { }</pre>
<p>Well, not much as the method stands right now, we don’t need to use “T” for anything. But if we made a change to our method to return a List, for example of all the animals we had successfully vaccinated, we can declare that the List that’s returned has the same generic type as the List that’s passed in:</p>
<pre data-type="programlisting">public <strong>&lt;T extends Animal&gt; List&lt;T&gt;</strong> takeAnimals(List<strong>&lt;T&gt;</strong> list) { }</pre>
<p>When you call the method, you know you’re going to get the same type back as you put in.</p>
<pre data-type="programlisting"><strong>List&lt;<u>Dog</u>&gt; dogs</strong> = List.of(new Dog(), new Dog());
<strong>List&lt;<u>Dog</u>&gt; vaccinatedDogs = takeAnimals(dogs);</strong>

<strong>List&lt;<u>Animal</u>&gt; animals =</strong> List.of(new Dog(), new Cat());
<strong>List&lt;<u>Animal</u>&gt; vaccinatedAnimals = takeAnimals(animals);</strong></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;"><strong>The List we get back from the takeAnimals method is always the same type as the list we pass in.</strong></span></p>
</div>
<p>If the method used the wildcard for both method parameter and return type, there’s nothing to guarantee they’re the same type. In fact, anything calling the method has almost no idea what’s going to be in the collection, other than “some sort of animal.”</p>
<pre data-type="programlisting">public void go() {
  List&lt;Dog&gt; dogs = List.of(new Dog(), new Dog());
  <strong>List&lt;? extends Animal&gt; vaccinatedSomethings = takeAnimals(dogs);</strong>
}

public <strong>List&lt;? extends Animal&gt;</strong> takeAnimals(List<strong>&lt;? extends Animal&gt;</strong> animals) { }</pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#636466;">Using the wildcard (“? extends”) is fine when you don’t care much about the generic type, you just want to allow all subtypes of some type.</span></p>
<p><span style="color:#636466;">Using a type parameter (“T”) is more helpful when you want to do more with the type itself, for example in the method’s return.</span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000017">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/exercise.png" alt="image" width="150" height="126"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="BE the Compiler, advanced"><div class="sect2" id="be_the_compilercomma_advanced">
<h2>BE the Compiler, advanced</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0363-02.png" alt="image" width="159" height="170"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Be the..." id="idm46038391496672"/>Your job is to play compiler and determine which of these statements would compile. Some of this code wasn’t covered in the chapter, so you need to work out the answers based on what you DID learn, applying the “rules” to these new situations.</p>
<p>The signatures of the methods used in the exercise are in the boxes.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0363-03.png" alt="image" width="779" height="267"/>
<h6/>
</div></figure>
<p><strong>Compiles?</strong></p>
<table class="border">
<tbody>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeAnimals(new ArrayList&lt;Animal&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeDogs(new ArrayList&lt;Animal&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeAnimals(new ArrayList&lt;Dog&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeDogs(new ArrayList&lt;&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>List&lt;Dog&gt; dogs = new ArrayList&lt;&gt;(); takeDogs(dogs);</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeSomeAnimals(new ArrayList&lt;Dog&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeSomeAnimals(new ArrayList&lt;&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeSomeAnimals(new ArrayList&lt;Animal&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>List&lt;Animal&gt; animals = new ArrayList&lt;&gt;(); takeSomeAnimals(animals);</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>List&lt;Object&gt; objects = new ArrayList&lt;&gt;(); takeObjects(objects);</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeObjects(new ArrayList&lt;Dog&gt;());</code></strong></td>
</tr>
<tr>
<td><span class="inlineimage"><img src="Images/box.png" alt="Images" width="15" height="15"/></span></td>
<td><strong><code>takeObjects(new ArrayList&lt;Object&gt;());</code></strong></td>
</tr>
</tbody>
</table>
<p><span class="inlineimage"><img src="Images/arr1.png" alt="Images" width="137" height="12"/></span> <strong>Answers in <a data-type="xref" href="#be_the_compiler_solution_left_parenthesi">“BE the Compiler solution”</a>.</strong></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise Solution"><div class="sect1" id="exercise_solution-id00300">
<h1>Exercise Solution</h1>
<section data-type="sect2" data-pdf-bookmark="Fill-in-the-blanks"><div class="sect2" id="fill_in_the_blanksleft_parenthesisfrom_p">
<h2>Fill-in-the-blanks</h2>
<p>(from <a data-type="xref" href="#fill_in_the_blanks">“Fill-in-the-blanks”</a>)</p>
<p><strong>Possible Answers:</strong></p>
<pre data-type="programlisting"><strong>Comparator,</strong>
<strong>Comparable,</strong>
<strong>compareTo( ),</strong>
<strong>compare( ),</strong>
<strong>yes,</strong>
<strong>no</strong></pre>
<p>Given the following compilable statement:</p>
<pre data-type="programlisting"><strong>Collections.sort(myArrayList);</strong></pre>
<ol style="list-style-type:none;">
<li><p>What must the class of the objects stored in <code>myArrayList</code> implement? <u><strong>Comparable</strong></u></p></li>
<li><p>What method must the class of the objects stored in <code>myArrayList</code> implement? <u><strong>compareTo( )</strong></u></p></li>
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement both <code>Comparator</code> AND <code>Comparable</code>? <u><strong>yes</strong></u></p></li>
</ol>
<p>Given the following compilable statement:</p>
<pre data-type="programlisting"><strong>Collections.sort(myArrayList, myCompare);</strong></pre>
<ol start="4">
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement <code>Comparable</code>? <u><strong>yes</strong></u></p></li>
<li><p>Can the class of the objects stored in <code>myArrayList</code> implement <code>Comparator</code>? <u><strong>yes</strong></u></p></li>
<li><p>Must the class of the objects stored in <code>myArrayList</code> implement <code>Comparable</code>? <u><strong>no</strong></u></p></li>
<li><p>Must the class of the objects stored in <code>myArrayList</code> implement <code>Comparator</code>? <u><strong>no</strong></u></p></li>
<li><p>What must the class of the <code>myCompare</code> object implement? <u><strong>Comparator</strong></u></p></li>
<li><p>What method must the class of the <code>myCompare</code> object implement? <u><strong>compare( )</strong></u></p></li>
</ol>
<figure class="informal"><div class="figure">
<img src="Images/pencil1.png" alt="image" width="157" height="48"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="“Reverse Engineer” lambdas exercise"><div class="sect2" id="quotation_markreverse_engineerquotation">
<h2>“Reverse Engineer” lambdas exercise</h2>
<p>(from <a data-type="xref" href="#reverse_engineer">“Reverse Engineer”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0365-01.png" alt="image" width="981" height="597"/>
<h6/>
</div></figure>
<pre data-type="programlisting">class Mountain {
  <strong>String name;</strong>
  <strong>int height;</strong>

  <strong>Mountain(String name, int height)</strong> {
    <strong>this.name = name;</strong>
    <strong>this.height = height;</strong>
  }
  <strong>public String toString( )</strong> {
    <strong>return name + " " + height;</strong>
  }
}</pre>
<p><strong>Output:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0365-03.png" alt="image" width="561" height="241"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Sorting with lambdas"><div class="sect2" id="sorting_with_lambdas_left_parenthesisfro">
<h2>Sorting with lambdas</h2>
<p>(from <a data-type="xref" href="#reverse_engineer">“Reverse Engineer”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0366-01.png" alt="image" width="771" height="144"/>
<h6/>
</div></figure>
<p><strong>Output:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0366-02.png" alt="image" width="571" height="123"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="TreeSet exercise"><div class="sect2" id="treeset_exercise_left_parenthesisfrom_pa">
<h2>TreeSet exercise</h2>
<p>(from <a data-type="xref" href="#what_you_must_know_about_treesethellip">“What you MUST know about TreeSet...”</a>)</p>
<ol style="list-style-type:none;">
<li><p>What is the result when you compile this code?</p>
<p><u><strong>It compiles correctly</strong></u></p></li>
<li><p>If it compiles, what is the result when you run the TestTree class?</p>
<p><strong>It throws an exception:</strong></p>
<pre data-type="programlisting"><strong>Exception in thread "main" java.lang.ClassCastException: class Book can-</strong>
<strong>not be cast to class java.lang.Comparable</strong>
      <strong>at java.base/java.util.TreeMap.compare(TreeMap.java:1291)</strong>
      <strong>at java.base/java.util.TreeMap.put(TreeMap.java:536)</strong>
      <strong>at java.base/java.util.TreeSet.add(TreeSet.java:255)</strong>
      <strong>at TestTree.go(TestTree.java:16)</strong>
      <strong>at TestTree.main(TestTree.java:7)</strong></pre></li>
<li><p>If there is a problem (either compile-time or runtime) with this code,  how would you fix it?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0366-04.png" alt="image" width="790" height="116"/>
<h6/>
</div></figure></li>
</ol>
</div></section>
<section data-type="sect2" data-pdf-bookmark="BE the Compiler solution"><div class="sect2" id="be_the_compiler_solution_left_parenthesi">
<h2>BE the Compiler solution</h2>
<p>(from <a data-type="xref" href="#be_the_compilercomma_advanced">“BE the Compiler, advanced”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0367-01.png" alt="image" width="148" height="170"/>
<h6/>
</div></figure>
<p><strong>Compiles?</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0367-03.png" alt="image" width="1000" height="814"/>
<h6/>
</div></figure>
</div></section>
</div></section>
</div></section></div></body></html>