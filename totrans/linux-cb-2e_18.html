<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 17. Keeping Time with ntpd, chrony, &#10;and timesyncd"><div class="chapter" id="keeping_time_ntpd_chrony_and_timesyncd">
<h1><span class="label">Chapter 17. </span>Keeping Time with ntpd, chrony, 
<span class="keep-together">and timesyncd</span></h1>


<p>Keeping <a data-type="indexterm" data-primary="time synchronization" data-secondary="overview" id="time-overview"/>accurate time on your computer, and on all hosts on your network, is
easy and automatic with <a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="purpose of" id="idm46466154979912"/><a data-type="indexterm" data-primary="Network Time Protocol" data-see="NTP" id="idm46466154979400"/>NTP, the Network Time Protocol. NTP is implemented on
Linux with <em>ntpd</em>, the NTP daemon, <em>chrony</em>, the modern replacement for <em>ntpd</em>,
and systemd’s <em>timesyncd</em>. That is right,<a data-type="indexterm" data-primary="ntpd" data-secondary="purpose of" id="idm46466154977912"/><a data-type="indexterm" data-primary="chrony" data-secondary="purpose of" id="idm46466154977064"/><a data-type="indexterm" data-primary="timesyncd" data-secondary="purpose of" id="idm46466154976216"/> friends, there are three (at least),
count them, three ways to automatically manage time on your Linux computer.</p>

<p><em>ntpd</em> and <em>chrony</em> can also function as LAN time servers, while <em>timesyncd</em> is
a simpler lightweight client with no server functions. <em>ntpd</em> and <em>chrony</em> are
full NTP implementations, while <em>timesyncd</em> uses SNTP, the Simple Network Time
Protocol.</p>

<p>Most Linux distributions provide a default configuration that points to time
servers that they maintain. These servers have names like <em>2.fedora.pool.ntp.org</em> and <em>0.ubuntu.pool.ntp.org</em>. You don’t have to do anything, except be sure to
not disable this during installation. In this chapter you will learn how to
check your current settings, how to change them, and how to set up a LAN time
server.</p>

<p>There is a <a data-type="indexterm" data-primary="time servers" data-secondary="strata" id="time-server-strata"/>worldwide network of time servers that are free for everyone to use,
and they are organized into <em>strata</em>, starting at stratum 0. Stratum 0 is the
source for all timekeeping, a network of atomic clocks, radio receivers tuned to
atomic clocks, and GPS receivers using signals broadcast by GPS satellites.</p>

<p>Next in line is stratum 1, where the primary time servers reside. The primary
time servers in stratum 1 are directly connected to the sources in stratum 0.</p>

<p>Stratum 2 contains thousands of public servers, and they sync with stratum 1.
It is good etiquette to connect to stratum 2 servers to prevent the stratum 1
servers from being overwhelmed and to not use the stratum 1 servers without a
good reason.</p>

<p>The hierarchy continues on down the line, for example there are stratum 4,
5, and 6 public servers, and private LAN servers that sync with them. It’s
not really that orderly; you can designate your private LAN NTP server as
stratum 10, and it doesn’t have to connect to stratum 9 servers, but any server
it can reach. You don’t have to worry about selecting the correct servers
because you will use <em>pool</em> servers, which are clusters of NTP servers, rather
than individual <a data-type="indexterm" data-primary="time servers" data-secondary="strata" data-startref="time-server-strata" id="idm46466154958760"/><a data-type="indexterm" data-primary="pool servers" id="idm46466154963352"/>servers.</p>

<p>When you dig into timekeeping on computers, it becomes confusing and
overwhelming, or perhaps fascinating, depending on how nerdy you want to get.
Visit the <a href="https://ntppool.org">NTP Pool Project</a> and
<a href="http://ntp.org">NTP: The Network Time Protocol</a> to learn the
nerdy stuff and how to run your own public time server.</p>

<p>There are at least two timekeepers on your Linux system. One is the hardware
clock on<a data-type="indexterm" data-primary="RTC (real-time clock)" id="idm46466154965800"/><a data-type="indexterm" data-primary="real-time clock" data-see="RTC" id="idm46466154965192"/> your motherboard, which is also called the real-time clock (RTC). The
other is system time, managed by your Linux kernel. The RTC always has power,
even when your machine is turned off, from a battery or capacitor on the
motherboard. When your Linux computer starts up, your selected NTP client
gets its time from the RTC. Then, after the network is available, it corrects
the time according to its upstream time server.</p>

<p>Your RTC time is set in your BIOS/UEFI, and with some of the commands you will
learn about in this chapter. It should always be set<a data-type="indexterm" data-primary="UTC (Coordinated Universal Time)" id="idm46466154959816"/><a data-type="indexterm" data-primary="Coordinated Universal Time" data-see="UTC" id="idm46466154956456"/> to UTC, Coordinated
Universal Time, and then the Linux kernel calculates the time for your time
zone from the UTC. UTC is similar <a data-type="indexterm" data-primary="GMT (Greenwich Mean Time)" id="idm46466154954360"/><a data-type="indexterm" data-primary="Greenwich Mean Time (GMT)" id="idm46466154956968"/>to Greenwich Mean Time (GMT), though they are
not the same. UTC is a time standard and GMT is a time zone. Neither UTC nor
GMT change for daylight saving time (DST).</p>

<p>Time zone data <a data-type="indexterm" data-primary="time zones" id="idm46466154955064"/>comes from <a href="https://oreil.ly/gUnet">IETF.org Timezones</a>.
This is a moving target as countries change their DST dates,
opt out of DST, and opt back in. Most Linuxes store this information in
<em>/usr/share/zoneinfo/</em>. The Internet Engineering Task Force (IETF) tracks
these changes and makes their databases freely<a data-type="indexterm" data-primary="time synchronization" data-secondary="overview" data-startref="time-overview" id="idm46466154949336"/> available.</p>






<section data-type="sect1" data-pdf-bookmark="17.1 Finding Which NTP Client Is on Your Linux System"><div class="sect1" id="rec-which-ntp">
<h1>17.1 Finding Which NTP Client Is on Your Linux System</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154948568">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="time synchronization" data-secondary="NTP clients, determining" id="time-ntp-client-determine"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="determining" id="ntp-client-determine"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="determining" id="client-NTP-determine"/><a data-type="indexterm" data-primary="ps command" id="ps-command"/><a data-type="indexterm" data-primary="ntpd" data-secondary="determining usage" id="ntpd-determine"/><a data-type="indexterm" data-primary="timesyncd" data-secondary="determining usage" id="timesyncd-determine"/><a data-type="indexterm" data-primary="chrony" data-secondary="determining usage" id="chrony-determine"/>read the chapter introduction, and now you know that time synchronization
on Linux is managed by <em>ntpd</em>, <em>chrony</em>, or <em>timesyncd</em>, and you need to know
which one your Linux system uses.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154940440">
<h2>Solution</h2>

<p>Use the <em>ps</em> command to see if any of the three time synchronization daemons,
<em>ntpd</em>, <em>chronyd</em>, or <em>timesyncd</em> are running on your system:</p>
<pre>$ <strong>ps ax|grep -w ntp</strong>
$ <strong>ps ax|grep -w chrony</strong>
$ <strong>ps ax|grep -w timesyncd</strong>
</pre>

<p>If any of these are running, skip ahead to the relevant recipes in this
chapter to learn how to manage your time daemon.</p>

<p>If none of these are running, see if your system is<a data-type="indexterm" data-primary="timedatectl" id="timedatectl"/><a data-type="indexterm" data-primary="systemd" data-secondary="timedatectl" id="systemd-timedatectl"/> using <em>timedatectl</em>,
which is part of systemd:</p>
<pre>$ <strong>timedatectl status</strong>
                      Local time: Sun 2020-10-04 10:59:48 PDT
                  Universal time: Sun 2020-10-04 17:59:48 UTC
                        RTC time: Sun 2020-10-04 17:59:48
                       Time zone: America/Los_Angeles (PDT, -0700)
       System clock synchronized: no
systemd-timesyncd.service active: no
                 RTC in local TZ: no
</pre>

<p>This output shows that <em>timedatectl</em> is running without any time daemons,
indicated by <em>systemd-timesyncd.service active: no</em>. Double-check by querying
the status of <em>systemd-timesyncd</em>:</p>
<pre>$ <strong>systemctl status systemd-timesyncd</strong>
● systemd-timesyncd.service - Network Time Synchronization
   Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; disabled;
vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:systemd-timesyncd.service(8)
</pre>

<p>This shows that <em>systemd-timesyncd</em> is not running, which means there is no
time synchronization on your system, and it is getting its time from your
system’s real-time clock (RTC). In this case you need to set up <em>ntpd</em>,
<em>chrony</em>, or <em>timesyncd</em>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154920248">
<h2>Discussion</h2>

<p>Some Linux distributions do not use systemd; see <a data-type="xref" href="ch04.xhtml#rec-is-systemd-present">Recipe 4.1</a> to
learn how to know if your Linux has it. If you are running a Linux system
without systemd, your NTP choices are <em>ntpd</em> or <em>chrony</em>.</p>

<p>If you find both <em>ntpd</em> and <em>chrony</em> running on the same system, get rid of
<em>ntpd</em>, as <em>chrony</em> is newer, faster, and more reliable. Having both will
create conflicts.</p>

<p>The output of <em>timedatectl</em> has a lot of useful information. The example shows
that the RTC is correctly set to the Coordinated Universal Time (UTC) protocol,
and that the system time zone is Pacific Daylight Time, PDT.
<em>systemd-timesyncd.service</em> is not running, and the system has not been<a data-type="indexterm" data-primary="time synchronization" data-secondary="NTP clients, determining" data-startref="time-ntp-client-determine" id="idm46466154912168"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="determining" data-startref="ntp-client-determine" id="idm46466154911080"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="determining" data-startref="client-NTP-determine" id="idm46466154909544"/><a data-type="indexterm" data-primary="ps command" data-startref="ps-command" id="idm46466154908120"/><a data-type="indexterm" data-primary="ntpd" data-secondary="determining usage" data-startref="ntpd-determine" id="idm46466154907176"/><a data-type="indexterm" data-primary="timesyncd" data-secondary="determining usage" data-startref="timesyncd-determine" id="idm46466154905832"/><a data-type="indexterm" data-primary="chrony" data-secondary="determining usage" data-startref="chrony-determine" id="idm46466154904488"/>
synchronized.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154902840">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/QddJ7">timedatectl: Control the system time and date</a></p>
</li>
<li>
<p><em>man 1 ps</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.2 Using timesyncd for Simple Time Synchronization"><div class="sect1" id="idm46466154899352">
<h1>17.2 Using timesyncd for Simple Time Synchronization</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154898488">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="time synchronization" data-secondary="timesyncd, configuring" id="time-timesyncd-configuring"/><a data-type="indexterm" data-primary="timesyncd" data-secondary="configuring" id="timesyncd-configure"/><a data-type="indexterm" data-primary="configuring" data-secondary="timesyncd" id="configure-timesyncd"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="timesyncd configuration" id="ntp-client-timesyncd"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="timesyncd configuration" id="client-NTP-timesyncd"/> want to know how to set up the simplest NTP client to keep the correct time
on your computer.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154889880">
<h2>Solution</h2>

<p>Enable synchronization with a public NTP server using the <em>systemd-timesyncd</em>
daemon, which requires systemd. Check the status of <em>systemd-timesyncd</em>:</p>
<pre>$ <strong>systemctl status systemd-timesyncd</strong>
● systemd-timesyncd.service - Network Time Synchronization
     Loaded: loaded (/usr/lib/systemd/system/systemd-timesyncd.service;
       disabled; vendor preset: enabled)
     Active: inactive (dead)
       Docs: man:systemd-timesyncd.service(8)
</pre>

<p>Enable it with <em>timedatectl</em>, and verify that <em>systemd-timesyncd</em> started:</p>
<pre>$ <strong>timedatectl set-ntp true</strong>
$ <strong>systemctl status systemd-timesyncd</strong>
● systemd-timesyncd.service - Network Time Synchronization
   Loaded: loaded (/lib/systemd/system/systemd-timesyncd.service; enabled;
vendor preset: enabled)
   Active: active (running) since Sun 2020-10-04 18:17:51 PDT; 16min ago
     Docs: man:systemd-timesyncd.service(8)
 Main PID: 3990 (systemd-timesyn)
   Status: "Synchronized to time server 91.189.89.198:123 (ntp.ubuntu.com)."
    Tasks: 2 (limit: 4915)
   CGroup: /system.slice/systemd-timesyncd.service
           └─3990 /lib/systemd/systemd-timesyncd

Oct 04 18:17:51 pc systemd[1]: Starting Network Time Synchronization...
Oct 04 18:17:51 pc systemd[1]: Started Network Time Synchronization.
Oct 04 18:33:01 pc systemd-timesyncd[3990]: Synchronized to time server
91.189.89.198:123 (ntp.ubuntu.com).
</pre>

<p>If <em>systemd-timesyncd</em> did not start, start it:</p>
<pre>$ <strong>sudo systemctl start systemd-timesyncd</strong>
</pre>

<p class="pagebreak-before less_space">Now see what <em>timedatectl</em> reports:</p>
<pre>$ <strong>timedatectl status</strong>
                      Local time: Sun 2020-10-04 18:35:56 PDT
                  Universal time: Mon 2020-10-05 01:35:56 UTC
                        RTC time: Mon 2020-10-05 01:35:56
                       Time zone: America/Los_Angeles (PDT, -0700)
       System clock synchronized: yes
systemd-timesyncd.service active: yes
                 RTC in local TZ: no
</pre>

<p>Everything looks correct. Your system is synchronized, all the times are
correct, and the <em>systemd-timesyncd.service</em> is active.</p>

<p>It is a good practice to configure multiple public time servers for
redundancy. Edit <em>/etc/systemd/timesyncd.conf</em> to add more NTP servers by
uncommenting the <code>NTP</code> line and entering a space-delimited list of public
server pools:</p>
<pre>
[Time]
<strong>NTP=0.north-america.pool.ntp.org 1.north-america.pool.ntp.org
2.north-america.pool.ntp.org</strong>
#FallbackNTP=ntp.ubuntu.com
#RootDistanceMaxSec=5
#PollIntervalMinSec=32
#PollIntervalMaxSec=2048
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154889496">
<h2>Discussion</h2>

<p>In your original <em>/etc/systemd/timesyncd.conf</em> file, the commented options
document the default configuration.</p>

<p>The pool servers <a data-type="indexterm" data-primary="pool servers" id="idm46466154872680"/>are highly reliable because they are multiple servers in a
single pool, rather than individual servers. For best peformance use the pool
servers for your region, either the <a href="https://oreil.ly/iEipo">continental pools</a>
or the country pools, which you will find by clicking on the continental
pool links.</p>

<p>Your Linux distribution may configure multiple server pools of their own, such as:</p>

<pre data-type="programlisting">0.opensuse.pool.ntp.org 1.opensuse.pool.ntp.org 2.opensuse.pool.ntp.org</pre>

<p>This is good, and you don’t need to change it, but a
more diverse configuration is usually more <a data-type="indexterm" data-primary="time synchronization" data-secondary="timesyncd, configuring" data-startref="time-timesyncd-configuring" id="idm46466154867256"/><a data-type="indexterm" data-primary="timesyncd" data-secondary="configuring" data-startref="timesyncd-configure" id="idm46466154866616"/><a data-type="indexterm" data-primary="configuring" data-secondary="timesyncd" data-startref="configure-timesyncd" id="idm46466154865976"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="timesyncd configuration" data-startref="ntp-client-timesyncd" id="idm46466154865176"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="timesyncd configuration" data-startref="client-NTP-timesyncd" id="idm46466154864040"/>reliable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154861944">
<h2>See Also</h2>

<ul>
<li>
<p><a data-type="xref" href="ch04.xhtml#cha-systemd">Chapter 4</a></p>
</li>
<li>
<p><a href="https://ntppool.org">NTP Pool Project</a></p>
</li>
<li>
<p><em>man 5 timesyncd.conf</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.3 Setting Time Manually with timedatectl"><div class="sect1" id="idm46466154856520">
<h1>17.3 Setting Time Manually with timedatectl</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154855624">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="time synchronization" data-secondary="manual settings with timedatectl" id="idm46466154853928"/><a data-type="indexterm" data-primary="manual time settings" id="idm46466154853080"/><a data-type="indexterm" data-primary="RTC (real-time clock)" data-secondary="manual settings" id="idm46466154852472"/>want to set your system and RTC time manually.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154850968">
<h2>Solution</h2>

<p>Use <em>timedatectl</em>. It sets the date, system time, and RTC time with a single
command:</p>
<pre>$ <strong>timedatectl set-time "2020-10-04 19:30:00"</strong>
Failed to set time: Automatic time synchronization is enabled
</pre>

<p>You cannot do this when <em>systemd-timesyncd</em> is running, so you must stop it:</p>
<pre>$ <strong>sudo systemctl stop systemd-timesyncd</strong></pre>

<p>Then enter your new settings in the format shown in the example, YYYY-MM-DD
HH:MM:SS, and verify that it worked:</p>
<pre>$ <strong>timedatectl set-ntp false</strong>
$ <strong>timedatectl set-time "2020-10-04 19:30:00"</strong>
$ <strong>timedatectl status</strong>
                      Local time: Sun 2020-10-04 19:30:06 PDT
                  Universal time: Mon 2020-10-05 02:30:06 UTC
                        RTC time: Mon 2020-10-05 02:30:06
                       Time zone: America/Los_Angeles (PDT, -0700)
       System clock synchronized: no
systemd-timesyncd.service active: no
                 RTC in local TZ: no
</pre>

<p>If you restart <em>systemd-timesyncd</em>, it will override your manual settings.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154843208">
<h2>Discussion</h2>

<p><em>timedatectl</em> has a small set of commands. If you are used to the <em>date</em>
command for setting the time, and other time and date operations, <em>timedatectl</em>
may seem lightweight. It is simple by design, and you still have <em>date</em> and its
numerous options for complex <a data-type="indexterm" data-primary="timedatectl" data-startref="timedatectl" id="idm46466154840264"/><a data-type="indexterm" data-primary="systemd" data-secondary="timedatectl" data-startref="systemd-timedatectl" id="idm46466154837976"/>tasks.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154836472">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 timesyncd.conf</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.4 Using chrony for Your NTP Client"><div class="sect1" id="rec-chrony-client">
<h1>17.4 Using chrony for Your NTP Client</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154832312">
<h2>Problem</h2>

<p>Your<a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" id="time-chrony-client"/><a data-type="indexterm" data-primary="chrony" data-secondary="as NTP client" data-secondary-sortas="NTP client" id="chrony-client"/><a data-type="indexterm" data-primary="configuring" data-secondary="chrony" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" id="configure-chrony-client"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="chrony configuration" id="ntp-client-chrony"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="chrony configuration" id="client-NTP-chrony"/> want a fully featured NTP client/server, and you want to know how to set
up <em>chrony</em> as your NTP client.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154822408">
<h2>Solution</h2>

<p>First, check if <em>ntpd</em> is installed. If it is, remove it. If you have
<em>systemd-timesyncd</em>, 
<span class="keep-together">disable</span> it:</p>
<pre>$ <strong>sudo systemctl disable systemd-timesyncd</strong>
$ <strong>sudo systemctl stop systemd-timesyncd</strong>
</pre>

<p>Then install <em>chrony</em>. The package name on most Linuxes is <em>chrony</em>. After
installation use <a data-type="indexterm" data-primary="chronyc command" id="idm46466154815752"/>the <em>chronyc</em> command to check its status:</p>
<pre>$ <strong>chronyc activity</strong>
200 OK
8 sources online
0 sources offline
0 sources doing burst (return to online)
0 sources doing burst (return to offline)
0 sources with unknown address
</pre>

<p>Success! It is already working, as <em>8 sources online</em> tells you. (If it did
not start, see the Discussion.) Find your <em>chrony.conf</em>, either
<em>/etc/chrony.conf</em> (Fedora) or <em>/etc/chrony/chrony.conf</em> (Ubuntu), and take a
look at the settings. There is not much you need to change, if anything, to use
it as a client. Check the NTP server list, where you will see either <em>server</em> options
or <em>pool</em>. The following example on an Ubuntu system includes the default
Ubuntu NTP server pools and a local LAN server:</p>
<pre>pool 0.ubuntu.pool.ntp.org iburst
pool 1.ubuntu.pool.ntp.org iburst
pool 1.ubuntu.pool.ntp.org iburst
server ntp.domain.lan iburst prefer</pre>

<p>You could replace some of the Ubuntu server pools with some public server pools
to improve reliability with a more diverse set of pools:</p>

<pre data-type="programlisting">pool 0.ubuntu.pool.ntp.org iburst
pool 1.ubuntu.pool.ntp.org iburst
pool 0.north-america.pool.ntp.org iburst
pool 1.north-america.pool.ntp.org iburst
server ntp.domain.lan iburst prefer</pre>

<p>Restart <em>chronyd</em> after changing the configuration file.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154821480">
<h2>Discussion</h2>

<p><em>iburst</em> means synchronize quickly after network interruptions, and
<em>prefer</em> means always use this server, unless it is not available.</p>

<p>That really is all you need to do for a client setup. <em>chrony</em> is a full NTP
implementation and has many options; see <em>man 5 chrony.conf</em> for a complete
description.</p>

<p>Manage <em>chronyd</em> just like any other service using the following commands:</p>

<ul>
<li>
<p><em>systemctl status chrony</em></p>
</li>
<li>
<p><em>sudo systemctl stop chrony</em></p>
</li>
<li>
<p><em>sudo systemctl start chrony</em></p>
</li>
<li>
<p><em>sudo systemctl restart chrony</em></p>
</li>
</ul>

<p>Chrony has <a data-type="indexterm" data-primary="chrony" data-secondary="advantages" id="idm46466154797304"/><a data-type="indexterm" data-primary="ntpd" data-secondary="chrony advantages over" id="idm46466154796216"/>several advantages over <em>ntpd</em>. The main advantages as a client
are better handling of interrupted network connections and faster resyncing
when the connection is<a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" data-startref="time-chrony-client" id="idm46466154795368"/><a data-type="indexterm" data-primary="chrony" data-secondary="as NTP client" data-secondary-sortas="NTP client" data-startref="chrony-client" id="idm46466154793176"/><a data-type="indexterm" data-primary="configuring" data-secondary="chrony" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" data-startref="configure-chrony-client" id="idm46466154791496"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="chrony configuration" data-startref="ntp-client-chrony" id="idm46466154789928"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="chrony configuration" data-startref="client-NTP-chrony" id="idm46466154788408"/> restored.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154786664">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/1S41c">chrony</a></p>
</li>
<li>
<p><em>man 5 chrony.conf</em></p>
</li>
<li>
<p><em>man 1 chronyc</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.5 Using chrony as a LAN Time Server"><div class="sect1" id="idm46466154781128">
<h1>17.5 Using chrony as a LAN Time Server</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154779944">
<h2>Problem</h2>

<p>You <a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" id="time-chrony-server"/><a data-type="indexterm" data-primary="chrony" data-secondary="as NTP server" data-secondary-sortas="NTP server" id="chrony-server"/><a data-type="indexterm" data-primary="configuring" data-secondary="chrony" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" id="configure-chrony-server"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="servers" data-tertiary="chrony configuration" id="ntp-server-chrony"/><a data-type="indexterm" data-primary="time servers" data-secondary="chrony configuration" id="time-server-chrony"/><a data-type="indexterm" data-primary="servers" data-secondary="time" data-see="time servers" id="idm46466154771224"/>want to set up <em>chrony</em> as your LAN time server.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154769720">
<h2>Solution</h2>

<p>Just like in <a data-type="xref" href="#rec-chrony-client">Recipe 17.4</a>, disable <em>systemd-timesyncd</em>  and remove <em>ntpd</em> if it
is on your system. Then install the <em>chrony</em> package.</p>

<p>Find the configuration file, either <em>/etc/chrony.conf</em> (Fedora, openSUSE) or
<em>/etc/chrony/chrony.conf</em> (Ubuntu). The following example is a basic
configuration:</p>
<pre><i>pool 0.north-america.pool.ntp.org iburst
pool 1.north-america.pool.ntp.org iburst
pool 2.north-america.pool.ntp.org iburst

local stratum 10
allow 192.168.0.0/16
allow 2001:db8::/56</i>

driftfile /var/lib/chrony/chrony.drift
maxupdateskew 100.0
rtcsync
logdir /var/log/chrony
log measurements statistics tracking
leapsectz right/UTC
makestep 1 3</pre>

<p>Then your clients need your server’s name added to their <em>chrony.conf</em>  files:</p>
<pre>server <i>ntp.domain.lan</i> iburst prefer</pre>

<p>The <em>prefer</em> option means to always use this server as long as it is
available. One of the reasons to keep a local time server is to put less of a
load on the public time servers. With the <em>prefer</em> option you can configure
some public servers as backups, in case your local server becomes unavailable,
and not worry about burdening them, like this:</p>
<pre>server <i>ntp.domain.lan</i> iburst prefer
pool 1.north-america.pool.ntp.org iburst
pool 2.north-america.pool.ntp.org iburst</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154758680">
<h2>Discussion</h2>

<p><em>local stratum 10</em> configures <em>chrony</em> to continue acting as your local NTP
server even when your internet connection is interrupted, and <em>stratum 10</em>
puts your server safely down the strata hierarchy, so that it is lower than any
external NTP servers you are using. Allowed values are 1–15. (Do please use a
number other than 10, in case this recipe makes <em>stratum 10</em> wildly popular.)</p>

<p>The <em>allow</em> options define the networks that are allowed to use your NTP
server.</p>

<p><em>rtcsync</em> tells <em>chrony</em> to keep your RTC synchronized with system time.</p>

<p><em>log</em> enables logging and defines the events you want logged.</p>

<p>You may look up the other options in <em>man 5 chrony.conf</em>, or in your default
<em>chrony.conf</em>, which is usually <a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" data-startref="time-chrony-server" id="idm46466154749768"/><a data-type="indexterm" data-primary="chrony" data-secondary="as NTP server" data-secondary-sortas="NTP server" data-startref="chrony-server" id="idm46466154748312"/><a data-type="indexterm" data-primary="configuring" data-secondary="chrony" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" data-startref="configure-chrony-server" id="idm46466154746984"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="servers" data-tertiary="chrony configuration" data-startref="ntp-server-chrony" id="idm46466154745416"/><a data-type="indexterm" data-primary="time servers" data-secondary="chrony configuration" data-startref="time-server-chrony" id="idm46466154744088"/>well commented.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154742472">
<h2>See Also</h2>

<ul>
<li>
<p><a href="https://oreil.ly/1S41c">chrony</a></p>
</li>
<li>
<p><em>man 5 chrony.conf</em></p>
</li>
<li>
<p><em>man 1 chronyc</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.6 Viewing chrony Statistics"><div class="sect1" id="idm46466154736952">
<h1>17.6 Viewing chrony Statistics</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154736088">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="viewing statistics" id="time-chrony-stats"/><a data-type="indexterm" data-primary="chrony" data-secondary="viewing statistics" id="chrony-stats"/><a data-type="indexterm" data-primary="displaying" data-secondary="chrony statistics" id="dispay-chrony-stats"/><a data-type="indexterm" data-primary="statistics for chrony, displaying" id="stats-chrony"/><a data-type="indexterm" data-primary="chronyc command" id="chronyc"/> want to call up some real-time <em>chrony</em> activity and statistics,
such as upstream NTP servers, offsets, skew, which server you are currently
synced with, and other information.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154728696">
<h2>Solution</h2>

<p>Use the <em>chronyc</em> command. The <em>tracking</em> subcommand shows how much correction
has been applied, the RTC time, skew, and other information:</p>
<pre>$ <strong>chronyc tracking</strong>
Reference ID    : A29FC87B (time.cloudflare.com)
Stratum         : 4
Ref time (UTC)  : Tue Oct 06 02:20:23 2020
System time     : 0.002051390 seconds fast of NTP time
Last offset     : +0.002320110 seconds
RMS offset      : 0.017948814 seconds
Frequency       : 28.890 ppm fast
Residual freq   : +0.252 ppm
Skew            : 1.250 ppm
Root delay      : 0.069674924 seconds
Root dispersion : 0.003726898 seconds
Update interval : 838.2 seconds
Leap status     : Normal
</pre>

<p>List your current source servers:</p>
<pre>$ <strong>chronyc sources</strong>
chronyc sources
210 Number of sources = 19
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- golem.canonical.com           2   9     0   37m    +55ms[  +58ms] +/-  209ms
^- alphyn.canonical.com          2   9     0   34m    +23ms[  +25ms] +/-  158ms
^- pugot.canonical.com           2   9     0   44m    +92ms[  +80ms] +/-  229ms
^- chilipepper.canonical.com     2   9    11    31    +48ms[  +48ms] +/-  181ms
[...]
</pre>

<p>List your current source servers, with descriptions:</p>
<pre>$ <strong>chronyc sources -v</strong>
210 Number of sources = 19

  .-- Source mode  '^' = server, '=' = peer, '#' = local clock.
 / .- Source state '*' = current synced, '+' = combined , '-' = not combined,
| /   '?' = unreachable, 'x' = time may be in error, '~' = time too variable.
||                                                 .- xxxx [ yyyy ] +/- zzzz
||      Reachability register (octal) -.           |  xxxx = adjusted offset,
||      Log2(Polling interval) --.      |          |  yyyy = measured offset,
||                                \     |          |  zzzz = estimated error.
||                                 |    |           \
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^- golem.canonical.com           2   9     0   46m    +67ms[  +58ms] +/-  209ms
^- alphyn.canonical.com          2   9     0   44m    +35ms[  +25ms] +/-  158ms
^* pugot.canonical.com           2   9     1   54m   +104ms[  +80ms] +/-  229ms
^- chilipepper.canonical.com     2   9    11   587    +60ms[  +48ms] +/-  181ms
^- ntp.wdc1.us.leaseweb.net      2   7     4   327    +26ms[  +15ms] +/-  198ms
^- 216.126.233.109               2   9     1   459   +106ms[  +95ms] +/-  171ms
^- 157.245.170.163               3   9     1   476  +1191us[  -10ms] +/-  145ms
</pre>

<p>The asterisk shows which server your system is currently synchronizing with.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154719064">
<h2>Discussion</h2>

<p><em>chrony</em> adjusts for network delays and latency, intermittent connections, and
sleep and hibernate modes on client machines. The <em>chrony</em> clock never stops, and it keeps your network synchronized even when external name servers are <a data-type="indexterm" data-primary="time synchronization" data-secondary="chrony" data-tertiary="viewing statistics" data-startref="time-chrony-stats" id="idm46466154714584"/><a data-type="indexterm" data-primary="chrony" data-secondary="viewing statistics" data-startref="chrony-stats" id="idm46466154713816"/><a data-type="indexterm" data-primary="displaying" data-secondary="chrony statistics" data-startref="dispay-chrony-stats" id="idm46466154713176"/><a data-type="indexterm" data-primary="statistics for chrony, displaying" data-startref="stats-chrony" id="idm46466154712536"/><a data-type="indexterm" data-primary="chronyc command" data-startref="chronyc" id="idm46466154711992"/>unavailable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154710424">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 chronyc</em></p>
</li>
<li>
<p><a href="https://oreil.ly/1S41c">chrony.tuxfamily.org</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.7 Using ntpd for Your NTP Client"><div class="sect1" id="idm46466154706120">
<h1>17.7 Using ntpd for Your NTP Client</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154705224">
<h2>Problem</h2>

<p>Yes, <a data-type="indexterm" data-primary="time synchronization" data-secondary="ntpd" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" id="time-ntpd-client"/><a data-type="indexterm" data-primary="ntpd" data-secondary="as NTP client" data-secondary-sortas="NTP client" id="ntpd-client"/><a data-type="indexterm" data-primary="configuring" data-secondary="ntpd" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" id="configure-ntpd-client"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="ntpd configuration" id="ntp-client-ntpd"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="ntpd configuration" id="client-NTP-ntpd"/>you know all about <em>chrony</em> and <em>timesyncd</em>, and how good they are, but
you still want to use <em>ntpd</em> as your NTP client.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154698952">
<h2>Solution</h2>

<p>No problem, because <em>ntpd</em> is actively maintained and does the job just
fine. First, make sure that <em>ntpd</em> is the only NTP client on your system (see
<a data-type="xref" href="#rec-which-ntp">Recipe 17.1</a>). On most Linux distributions, look for the <em>ntp</em> package to
install.</p>

<p>On most Linux distributions <em>ntpd</em> comes with a useful configuration, and
starts after installation. Check with<a data-type="indexterm" data-primary="ps command" id="idm46466154687928"/> the <em>ps</em> command:</p>
<pre>$ <strong>ps ax | grep -w ntpd</strong>
3754 ?        Ssl    0:00 /usr/sbin/ntpd -u ntp:ntp -g
</pre>

<p>If it does not start automatically, start it:</p>
<pre>$ <strong>systemctl start ntpd</strong>
</pre>

<p>While <em>ntpd</em> is running, take a look at your configuration file, usually
<em>/etc/ntp.conf</em>. The default configuration for your Linux distribution
should work fine for you without changes. If your network has its own LAN
server, the following configuration sets the local server as the primary and
one Fedora Linux server pool as a fallback:</p>
<pre>server <i>ntp.domain.lan</i> iburst prefer
pool 2.fedora.pool.ntp.org iburst</pre>

<p>You may keep the default configuration, which works fine for most situations.
It is common for Linux distributions to maintain their own NTP server pools
and provide these in the default configuration. If you wish to replace these,
or add some external public servers, see
<a href="https://oreil.ly/W70Ba">continental pools</a> for a list of the
continental NTP server pools, or use your country pools, which you will find by
clicking on the continental pool links.</p>

<p>When you change <em>/etc/ntp.conf</em>, restart <em>ntpd</em>:</p>
<pre>$ <strong>systemctl restart ntpd</strong>
</pre>
<pre>$ <strong>sudo /etc/init.d/ntp restart</strong>
</pre>

<p>Check that it is working<a data-type="indexterm" data-primary="ntpq command" id="idm46466154677032"/> with <em>ntpq</em>. The asterisk shows that the machine is
syncing with the LAN NTP server:</p>
<pre>$ <strong>ntpq -p</strong>

     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 2.fedora.pool.n .POOL.          16 p    -   64    0    0.000   +0.000   0.000
*<i>ntp.domain.lan</i>. 172.16.16.3      2 u   34  256  203   80.324  -49.772  54.508
+138.68.46.177 ( 80.153.195.191   2 u   92  256  123   90.932  -15.534  39.947
+vps6.ctyme.com  216.218.254.202  2 u  453  256   46   69.927  -29.296  84.811
+ec2-3-217-79-24 132.163.97.6     2 u  426  256  202  165.888  -51.442  93.224
</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154695592">
<h2>Discussion</h2>

<p><em>iburst</em> tells <em>ntpd</em> to synchronize quickly at system startup.</p>

<p><em>prefer</em> means use this server, and use the others only when it <a data-type="indexterm" data-primary="time synchronization" data-secondary="ntpd" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" data-startref="time-ntpd-client" id="idm46466154670264"/><a data-type="indexterm" data-primary="ntpd" data-secondary="as NTP client" data-secondary-sortas="NTP client" data-startref="ntpd-client" id="idm46466154668696"/><a data-type="indexterm" data-primary="configuring" data-secondary="ntpd" data-tertiary="as NTP client" data-tertiary-sortas="NTP client" data-startref="configure-ntpd-client" id="idm46466154667368"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="clients" data-tertiary="ntpd configuration" data-startref="ntp-client-ntpd" id="idm46466154665640"/><a data-type="indexterm" data-primary="clients" data-secondary="NTP" data-tertiary="ntpd configuration" data-startref="client-NTP-ntpd" id="idm46466154664056"/>becomes
unavailable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154671432">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 ntp.conf</em></p>
</li>
<li>
<p><em>man 8 ntpd</em></p>
</li>
<li>
<p><em>man 8 ntpq</em></p>
</li>
<li>
<p><a href="https://oreil.ly/lpDgk">NTP Documentation</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.8 Using ntpd for Your NTP Server"><div class="sect1" id="idm46466154656728">
<h1>17.8 Using ntpd for Your NTP Server</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154655432">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="time synchronization" data-secondary="ntpd" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" id="time-ntpd-server"/><a data-type="indexterm" data-primary="ntpd" data-secondary="as NTP server" data-secondary-sortas="NTP server" id="ntpd-server"/><a data-type="indexterm" data-primary="configuring" data-secondary="ntpd" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" id="configure-ntpd-server"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="servers" data-tertiary="ntpd configuration" id="ntp-server-ntpd"/><a data-type="indexterm" data-primary="time servers" data-secondary="ntpd configuration" id="time-server-ntpd"/> want to know how to run an <em>ntpd</em> server for your LAN.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154646520">
<h2>Solution</h2>

<p>Using <em>ntpd</em> for your LAN time server is similar to using it as an NTP client.
The configuration is almost the same, with the addition of some access
controls. The following example is a complete <em>/etc/ntp.conf</em> configuration:</p>

<pre data-type="programlisting">driftfile /var/lib/ntp/drift

restrict default nomodify notrap nopeer noquery
restrict -6 default nomodify notrap nopeer noquery
restrict 127.0.0.1
restrict ::1

pool 0.north-america.pool.ntp.org
pool 1.north-america.pool.ntp.org
pool 2.north-america.pool.ntp.org

leapfile /usr/share/zoneinfo/leap-seconds.list

statistics clockstats loopstats peerstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable
statsdir /var/log/ntpstats/</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154641928">
<h2>Discussion</h2>

<p>The driftfile is where <em>ntpd</em> tracks the time drift caused by
fluctuations in the oscillating frequency of the quartz crystal on your
motherboard. You have the following options:</p>

<ul>
<li>
<p><em>restrict default</em> denies all, permits only what is explicitly allowed, and
sets defaults.</p>
</li>
<li>
<p><em>nomodify</em> does not allow other time servers to make any changes on your
system. Queries are allowed.</p>
</li>
<li>
<p><em>notrap</em> disables remote logging.</p>
</li>
<li>
<p><em>nopeer</em> does not allow peering. Peer servers synchronize with each other, so
the only servers allowed to supply time service are specified by the <em>server</em> or <em>pool</em> directives.</p>
</li>
</ul>

<ul class="pagebreak-before less_space">
<li>
<p><em>noquery</em> disallows remote queries and remote logging.</p>
</li>
<li>
<p><em>restrict 127.0.0.1</em> and <em>restrict ::1</em> mean trust localhost.</p>
</li>
</ul>

<p>The <em>statistics</em> section logs your selected statistics into
<em>/var/log/ntpstats/</em>. This is not necessary, but it could be interesting for
tracking which upstream NTP servers have the best<a data-type="indexterm" data-primary="time synchronization" data-secondary="ntpd" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" data-startref="time-ntpd-server" id="idm46466154628296"/><a data-type="indexterm" data-primary="ntpd" data-secondary="as NTP server" data-secondary-sortas="NTP server" data-startref="ntpd-server" id="idm46466154627032"/><a data-type="indexterm" data-primary="configuring" data-secondary="ntpd" data-tertiary="as NTP server" data-tertiary-sortas="NTP server" data-startref="configure-ntpd-server" id="idm46466154626264"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" data-secondary="servers" data-tertiary="ntpd configuration" data-startref="ntp-server-ntpd" id="idm46466154623208"/><a data-type="indexterm" data-primary="time servers" data-secondary="ntpd configuration" data-startref="time-server-ntpd" id="idm46466154621880"/> performance.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154620280">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 5 ntp.conf</em></p>
</li>
<li>
<p><em>man 8 ntpd</em></p>
</li>
<li>
<p><em>man 8 ntpq</em></p>
</li>
<li>
<p><a href="https://oreil.ly/lpDgk">NTP Documentation</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.9 Managing Time Zones with timedatectl"><div class="sect1" id="idm46466154613928">
<h1>17.9 Managing Time Zones with timedatectl</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154613032">
<h2>Problem</h2>

<p>You<a data-type="indexterm" data-primary="time synchronization" data-secondary="time zone management" id="time-timezone-manage"/><a data-type="indexterm" data-primary="time zones" id="time-zone"/><a data-type="indexterm" data-primary="timedatectl" id="timedatectl2"/><a data-type="indexterm" data-primary="systemd" data-secondary="timedatectl" id="systemd-timedatectl2"/> want to list all time zones, see your current time zone, and change time zones.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154606648">
<h2>Solution</h2>

<p>Use <em>timedatectl</em>. View your current time zone:</p>
<pre>$ <strong>timedatectl | grep -i "time zone"</strong>
     Time zone: America/Los_Angeles (PDT, -0700)
</pre>

<p>List all time zones:</p>
<pre>$ <strong>timedatectl list-timezones</strong>
Africa/Abidjan
Africa/Accra
Africa/Addis_Ababa
Africa/Algiers
[...]
</pre>

<p>The list is over 400 lines long. Use the <em>grep</em> command when you know what you
are looking for. The list names major cities, for example, Berlin:</p>
<pre>$ <strong>timedatectl list-timezones | grep -i berlin</strong>
Europe/Berlin
</pre>

<p>Set this as your time zone:</p>
<pre>$ <strong>sudo timedatectl set-timezone Europe/Berlin</strong>
</pre>

<p>The change takes effect immediately. Run <em>timedatectl</em> again to verify.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154606264">
<h2>Discussion</h2>

<p>When you work with people in different time zones, use<a data-type="indexterm" data-primary="UTC (Coordinated Universal Time)" id="idm46466154595768"/> UTC to coordinate
meeting times. There are several online time zone converters, such as
<a href="https://oreil.ly/NyLj7">Time Zone Converter</a>.</p>

<p>You must use the region/city form, as displayed by <em>timedatectl
list-timezones</em>, to set your time zone. This is defined by the ISO 8601
standard, which defines an unambiguous standard for expressing time zones, time,
and dates. The standard uses a “descending notation,” which is the largest
values to the smallest values, in sequence. For example, for time zones the
order is continent/country/city. The US habit of writing the date as
year-day-month does not conform to this standard. Year-month-day is the
standard, with a 4-digit year, YYYY-MM-DD. Time is HH:MM:SS, in the 24-hour
clock format.</p>

<p>The officially published ISO 8601 standard costs money, but a bit of
web searching should find the information for<a data-type="indexterm" data-primary="timedatectl" data-startref="timedatectl2" id="idm46466154595032"/><a data-type="indexterm" data-primary="systemd" data-secondary="timedatectl" data-startref="systemd-timedatectl2" id="idm46466154593176"/> free.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154592536">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 timedatectl</em></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="17.10 Managing Time Zones Without timedatectl"><div class="sect1" id="idm46466154588168">
<h1>17.10 Managing Time Zones Without timedatectl</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm46466154587160">
<h2>Problem</h2>

<p>Your Linux system does not have systemd, and you need to know what commands to
use to manage time zones.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm46466154583336">
<h2>Solution</h2>

<p>Use the <em>date</em> command to<a data-type="indexterm" data-primary="date command" id="idm46466154582504"/> see your current time zone:</p>
<pre>$ <strong>date</strong>
Wed Oct  7 08:32:40 PDT 2020
</pre>

<p>Or <a data-type="indexterm" data-primary="/etc/localtime" id="idm46466154580344"/>see what <em>/etc/localtime</em> is linked to:</p>
<pre>$ <strong>ls -l /etc/localtime</strong>
lrwxrwxrwx 1 root root 41 Oct  7 08:06 /etc/localtime -&gt;
../usr/share/zoneinfo/America/Los_Angeles
</pre>

<p>The <em>/usr/share/zoneinfo</em> directory <a data-type="indexterm" data-primary="/usr/share/zoneinfo" id="idm46466154577144"/>contains all time zones:</p>
<pre>$ <strong>ls /usr/share/zoneinfo</strong>
total 324
drwxr-xr-x  2 root root  4096 May 21 23:02 Africa
drwxr-xr-x  6 root root 20480 May 21 23:02 America
drwxr-xr-x  2 root root  4096 May 21 23:02 Antarctica
drwxr-xr-x  2 root root  4096 May 21 23:02 Arctic
[...]
</pre>

<p>Look in the subdirectories to find a city close to yours, for example, Madrid:</p>
<pre>$ <strong>ls /usr/share/zoneinfo/Europe</strong>
[...]
-rw-r--r-- 1 root root 2637 May  7 17:01 Madrid
-rw-r--r-- 1 root root 2629 May  7 17:01 Malta
lrwxrwxrwx 1 root root    8 May  7 17:01 Mariehamn
-rw-r--r-- 1 root root 1370 May  7 17:01 Minsk
[...]
</pre>

<p>Change your time zone by changing the link to <em>/etc/localtime</em>:</p>
<pre>$ <strong>sudo ln -sf /usr/share/zoneinfo/Europe/Madrid/etc/localtime</strong>
</pre>

<p>The change takes effect immediately.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm46466154571400">
<h2>Discussion</h2>

<p>This<a data-type="indexterm" data-primary="php command" id="idm46466154570088"/> cool command lists all time zones alphabetically:</p>
<pre>$ <strong>php -r 'print_r(timezone_identifiers_list());'</strong>
Array
(
    [0] =&gt; Africa/Abidjan
    [1] =&gt; Africa/Accra
    [2] =&gt; Africa/Addis_Ababa
    [3] =&gt; Africa/Algiers
    [4] =&gt; Africa/Asmara
[...]</pre>

<p>The <em>php</em> command is in the <em>php-cli</em> package.</p>

<p>Your graphical desktop should have a nice graphical utility for managing time,
date, and time zones. If a clock is displayed on your desktop, try right-clicking
it to bring up a properties or settings<a data-type="indexterm" data-primary="time synchronization" data-secondary="time zone management" data-startref="time-timezone-manage" id="idm46466154566440"/><a data-type="indexterm" data-primary="time zones" data-startref="time-zone" id="idm46466154565352"/> panel.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm46466154563928">
<h2>See Also</h2>

<ul>
<li>
<p><em>man 1 date</em></p>
</li>
<li>
<p><em>man 1 ln</em></p>
</li>
</ul>
</div></section>





</div></section>







</div></section></div></body></html>