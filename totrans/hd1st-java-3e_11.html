<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. Life and Death of an Object: Constructors and Garbage Collection"><div class="chapter" id="life_and_death_of_an_object_constructors">
<h1><span class="label">Chapter 9. </span>Life and Death of an Object: Constructors and Garbage Collection</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0237-01.png" alt="image" width="1019" height="961"/>
<h6/>
</div></figure>
<p><strong>Objects are born and objects die.</strong> You’re in charge of an object’s lifecycle. You decide when and how to <strong>construct</strong> it. You decide when to <strong>destroy</strong> it. Except you don’t actually <em>destroy</em> the object yourself, you simply <em>abandon</em> it. But once it’s abandoned, the heartless <strong>Garbage Collector (gc)</strong> can vaporize it, reclaiming the memory that object was using.  If you’re gonna write Java, you’re gonna create objects. Sooner or later, you’re gonna have to let some of them go, or risk running out of RAM.  In this chapter we look at how objects are created, where they live while they’re alive, and how to keep or abandon them efficiently. That means we’ll talk about the heap, the stack, scope, constructors, superclass constructors, null references, and more. Warning: this chapter contains material about object death that some may find disturbing.  Best not to get too attached.</p>
<section data-type="sect1" data-pdf-bookmark="The Stack and the Heap: where things live"><div class="sect1" id="the_stack_and_the_heap_where_things_live">
<h1>The Stack and the Heap: where things live</h1>
<p><a data-type="indexterm" data-primary="classes" data-secondary="instance variable declarations inside" id="idm46038393636720"/><a data-type="indexterm" data-primary="declarations" data-secondary="method" id="idm46038393632528"/><a data-type="indexterm" data-primary="declarations" data-secondary="variable" id="idm46038393641456"/><a data-type="indexterm" data-primary="Garbage-Collectible Heap" id="idm46038393640352"/><a data-type="indexterm" data-primary="heap" id="idm46038393626816"/><a data-type="indexterm" data-primary="instance variables" data-secondary="declaring" id="idm46038393626080"/><a data-type="indexterm" data-primary="instance variables" data-secondary="versus local variables" id="idm46038393624944"/><a data-type="indexterm" data-primary="local variables" id="idm46038393623840"/><a data-type="indexterm" data-primary="local variables" data-secondary="declaring" id="idm46038393623008"/><a data-type="indexterm" data-primary="local variables" data-secondary="versus instance variables" id="idm46038393621904"/><a data-type="indexterm" data-primary="local variables" data-secondary="in Stack" id="idm46038393620832"/><a data-type="indexterm" data-primary="memory" data-secondary="stack and heap in object lifecycle" id="idm46038393619728"/><a data-type="indexterm" data-primary="methods" data-secondary="local variables declared inside" id="idm46038393618656"/><a data-type="indexterm" data-primary="methods" data-secondary="in Stack" id="idm46038393617584"/><a data-type="indexterm" data-primary="objects" data-secondary="in heap" id="idm46038393616480"/><a data-type="indexterm" data-primary="stack" id="idm46038393615376"/><a data-type="indexterm" data-primary="stack" data-secondary="variable declarations" id="idm46038393614544"/><a data-type="indexterm" data-primary="stack variables" data-see="local variables" id="idm46038393613440"/><a data-type="indexterm" data-primary="variables" data-secondary="local" data-see="local variables" id="idm46038393612336"/>Before we can understand what really happens when you create an object, we have to step back a bit. We need to learn more about where everything lives (and for how long) in Java. That means we need to learn more about two areas of memory—the Stack and the Heap. When a JVM starts up, it gets a chunk of memory from the underlying OS and uses it to run your Java program. How <em>much</em> memory, and whether or not you can tweak it, is dependent on which version of the JVM (and on which platform) you’re running. But usually you <em>won’t</em> have any say in the matter. And with good programming, you probably won’t care (more on that a little later).</p>
<p>In Java, we (programmers) care about the area of memory where objects live (the heap) and the one where method invocations and local variables live (the stack).</p>
<p>We know that all <em>objects</em> live on the garbage-collectible heap, but we haven’t yet looked at where <em>variables</em> live. And where a variable lives depends on what <em>kind</em> of variable it is. And by “kind,” we don’t mean <em>type</em> (i.e., primitive or object reference). The two <em>kinds</em> of variables whose lives we care about now are <em>instance</em> variables and <em>local</em> variables. Local variables are also known as <em>stack</em> variables, which is a big clue for where they live.</p>
<p><strong>The Stack</strong></p>
<p>Where method invocations and local variables live</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-01.png" alt="image" width="411" height="282"/>
<h6/>
</div></figure>
<p><strong>The Heap</strong></p>
<p>Where <strong><em>ALL</em></strong> objects live</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-02.png" alt="image" width="706" height="485"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="instance_variables">
<h5>Instance Variables</h5>
<p><strong>Instance variables are declared inside a class but not inside a method.</strong> They represent the “fields” that each individual object has (which can be filled with different values for each instance of the class). Instance variables live inside the object they belong to.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-03.png" alt="image" width="612" height="151"/>
<h6/>
</div></figure>
<p><strong>Local Variables</strong></p>
<p><strong>Local variables are declared inside a method, including method parameters.</strong> They’re temporary and live only as long as the method is on the stack (in other words, as long as the method has not reached the closing curly brace).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0238-04.png" alt="image" width="677" height="211"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Methods are stacked"><div class="sect1" id="methods_are_stacked">
<h1>Methods are stacked</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0239-01.png" alt="image" width="817" height="302"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="methods" data-secondary="in Stack" id="idm46038393592400"/><a data-type="indexterm" data-primary="stack" data-secondary="calling methods from" id="idm46038393591232"/><a data-type="indexterm" data-primary="stack frame" id="idm46038393590128"/>When you call a method, the method lands on the top of a call stack. That new thing that’s actually pushed onto the stack is the stack <em>frame</em>, and it holds the state of the method including which line of code is executing, and the values of all local variables.</p>
<p>The method at the <em>top</em> of the stack is always the currently running method for that stack (for now, assume there’s only one stack, but in <a data-type="xref" href="ch14.xhtml#a_very_graphic_story_getting_gui">Chapter 14</a>, <em>A Very Graphic Story</em>, we’ll add more.) A method stays on the stack until the method hits its closing curly brace (which means the method’s done). If method foo() calls method bar(), method bar() is stacked on top of method foo().</p>
<p>A call stack with two methods</p>
<p><strong>The method on the top of the stack is always the currently executing method.</strong></p>
<pre data-type="programlisting">public void doStuff() {
  boolean b = true;
  go(4);
}

public void go(int x) {
  int z = x + 24;
  crazy();
  // imagine more code here
}

public void crazy() {
  char c = 'a';
}</pre>
<section data-type="sect2" data-pdf-bookmark="A stack scenario"><div class="sect2" id="a_stack_scenario">
<h2>A stack scenario</h2>
<p>The code on the left is a snippet (we don’t care what the rest of the class looks like) with three methods. The first method (doStuff()) calls the second method (go()), and the second method calls the third (crazy()). Each method declares one local variable within the body of the method (<em>b</em>, <em>z</em>, and <em>c</em>), and method go() also declares a parameter variable (which means go() has two local variables, <em>x</em> and <em>z</em>).</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> Code from another class calls <code><strong>doStuff(),</strong></code> and <code><strong>doStuff()</strong></code> goes into a stack frame at the top of the stack. The boolean variable named <strong>“b”</strong> goes on the <code><strong>doStuff()</strong></code> stack frame.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-03.png" alt="image" width="246" height="111"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <code><strong>doStuff()</strong></code> calls <code><strong>go()</strong></code>, and <code><strong>go()</strong></code> is <em>pushed</em> on top of the stack. Variables “<code><strong>x</strong></code>” and “<code><strong>z</strong></code>” are in the <code><strong>go()</strong></code> stack frame.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-04.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <code>go()</code> calls <code>crazy(), crazy()</code> is now on the top of the stack, with variable <code>“c”</code> in the frame.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-05.png" alt="image" width="246" height="254"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> <code>crazy()</code> completes, and its stack frame is <em>popped</em> off the stack. Execution goes back to the <code><strong>go()</strong></code> method and picks up at the line following the call to <strong><code>crazy().</code></strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0239-06.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure></li>
</ul>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What about local variables that are objects?"><div class="sect1" id="what_about_local_variables_that_are_obje">
<h1>What about local variables that are <u>objects?</u></h1>
<p><a data-type="indexterm" data-primary="local variables" data-secondary="references on heap" id="idm46038393546800"/><a data-type="indexterm" data-primary="reference variables" data-secondary="on heap" id="idm46038393545936"/>Remember, a non-primitive variable holds a reference to an object, not the object itself. You already know where objects live—on the heap. It doesn’t matter where they’re declared or created. <strong><em>If the local variable is a reference to an object, only the variable (the reference/remote control) goes on the stack.</em></strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0240-01.png" alt="image" width="1442" height="653"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00019">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: One more time, WHY are we learning the whole stack/heap thing? How does this help me? Do I really need to learn about it?</strong></p>
<p><strong>A:</strong> Knowing the fundamentals of the Java Stack and Heap is crucial if you want to understand variable scope, object creation issues, memory management, threads, and exception handling. We cover threads and exception handling in later chapters. You do not need to know anything about how the Stack and Heap are implemented in any particular JVM and/or platform. Everything you need to know about the Stack and Heap is on this page and the previous one. If you nail these pages, all the other topics that depend on your knowing this stuff will go much, much, much easier. Once again, some day you will SO thank us for shoving Stacks and Heaps down your throat.</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00009">
<h5>BULLET POINTS</h5>
<ul>
<li><p>Java has two areas of memory we care about: the Stack and the Heap.</p></li>
<li><p>Instance variables are variables declared inside a class but outside any method.</p></li>
<li><p>Local variables are variables declared inside a method or method parameter.</p></li>
<li><p>All local variables live on the stack, in the frame corresponding to the method where the variables are declared.</p></li>
<li><p>Object reference variables work just like primitive variables.if the reference is declared as a local variable, it goes on the stack.</p></li>
<li><p>All objects live in the heap, regardless of whether the reference is a local or instance variable.</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="If local variables live on the stack, where do instance variables live?"><div class="sect1" id="if_local_variables_live_on_the_stackcomm">
<h1>If <u>local</u> variables live on the stack, where do <u>instance</u> variables live?</h1>
<p><a data-type="indexterm" data-primary="instance variables" data-secondary="on heap" id="idm46038393535056"/><a data-type="indexterm" data-primary="objects" data-secondary="instance variables as living inside" id="idm46038393523472"/><a data-type="indexterm" data-primary="primitive variables" data-secondary="bit-size space" id="idm46038393522832"/><a data-type="indexterm" data-primary="reference variables" data-secondary="memory space allotted for" id="idm46038393521856"/>When you say new CellPhone(), Java has to make space on the Heap for that CellPhone. But how <em>much</em> space? Enough for the object, which means enough to house all of the object’s instance variables. That’s right, instance variables live on the Heap, <em>inside</em> the object they belong to.</p>
<p>Remember that the <em>values</em> of an object’s instance variables live inside the object. If the instance variables are all primitives, Java makes space for the instance variables based on the primitive type. An int needs 32 bits, a long 64 bits, etc. Java doesn’t care about the value inside primitive variables; the bit-size of an int variable is the same (32 bits) whether the value of the int is 32,000,000 or 32.</p>
<p>But what if the instance variables are <em>objects</em>? What if CellPhone HAS-A Antenna? In other words, CellPhone has a reference variable of type Antenna.</p>
<p>When the new object has instance variables that are object references rather than primitives, the real question is: does the object need space for all of the objects it holds references to? The answer is, <em>not exactly</em>. No matter what, Java has to make space for the instance variable values. But remember that a reference variable value is not the whole <em>object</em>, but merely a <em>remote control</em> to the object. So if CellPhone has an instance variable declared as the non-primitive type Antenna, Java makes space within the CellPhone object only for the Antenna’s <em>remote control</em> (i.e., reference variable) but not the Antenna <em>object.</em></p>
<p>Well, then, when does the Antenna <em>object</em> get space on the Heap? First we have to find out <em>when</em> the Antenna object itself is created. That depends on the instance variable declaration. If the instance variable is declared but no object is assigned to it, then only the space for the reference variable (the remote control) is created.</p>
<pre data-type="programlisting">private Antenna ant;</pre>
<p>No actual Antenna object is made on the heap unless or until the reference variable is assigned a new Antenna object.</p>
<pre data-type="programlisting">private Antenna ant = new Antenna();</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0241-01.png" alt="image" width="425" height="257"/>
<h6/>
</div></figure>
<p><span style="color:#646466;">Object with two primitive instance variables. Space for the variables lives in the object.</span></p>
<figure class="informal"><div class="figure">
<img src="Images/f0241-02.png" alt="image" width="425" height="258"/>
<h6/>
</div></figure>
<p><span style="color:#646466;">Object with one non-primitive instance variable—a reference to an Antenna object, but no actual Antenna object. This is what you get if you declare the variable but don’t initialize it with an actual Antenna object.</span></p>
<pre data-type="programlisting">public class CellPhone {
  private Antenna ant;
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0241-03.png" alt="image" width="632" height="283"/>
<h6/>
</div></figure>
<p><span style="color:#646466;">Object with one non-primitive instance variable, and the Antenna variable is assigned a new Antenna object.</span></p>
<pre data-type="programlisting">public class CellPhone {
  private Antenna ant = new Antenna();
}</pre>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The miracle of object creation"><div class="sect1" id="the_miracle_of_object_creation">
<h1>The miracle of object creation</h1>
<p><a data-type="indexterm" data-primary="objects" data-secondary="creating" id="idm46038393503392"/>Now that you know where variables and objects live, we can dive into the mysterious world of object creation. Remember the three steps of object declaration and assignment: declare a reference variable, create an object, and assign the object to the reference.</p>
<p>But until now, step two—where a miracle occurs and the new object is “born”—has remained a Big Mystery. Prepare to learn the facts of object life. <em>Hope you’re not squeamish.</em></p>
<p><strong>Let’s review the 3 steps of object declaration, creation and assignment:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0242-01.png" alt="image" width="1478" height="1049"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="canonical constructor" data-see="constructors" id="idm46038393494704"/><a data-type="indexterm" data-primary="classes" data-secondary="and constructors" id="idm46038393493520"/><a data-type="indexterm" data-primary="constructors" id="idm46038393492416"/><a data-type="indexterm" data-primary="Duck constructor" id="idm46038393491584"/><strong>Are we calling a method named Duck()? Because it sure <em>looks</em> like it.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0243-01.png" alt="image" width="830" height="129"/>
<h6/>
</div></figure>
<p><strong>No.</strong></p>
<p><strong>We’re calling the Duck <em>constructor.</em></strong></p>
<p>A constructor <em>does</em> look and feel a lot like a method, but it’s not a method. It’s got the code that runs when you say <code>new.</code> In other words, <em>the code that runs when you instantiate an object.</em></p>
<p>The only way to invoke a constructor is with the keyword <code>new</code> followed by the class name. The JVM finds that class and invokes the constructor in that class. (OK, technically this isn’t the <em>only</em> way to invoke a constructor. But it’s the only way to do it from <em>outside</em> a constructor. You <em>can</em> call a constructor from within another constructor, with restrictions, but we’ll get into all that later in the chapter.)</p>
<p><strong>But where is the constructor?</strong></p>
<p><strong>If we didn’t write it, who did?</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46038393481536">
<p><strong>A constructor has the code that runs when you instantiate an object. In other words, the code that runs when you say <code>new</code> on a class type.</strong></p>
<p><strong>Every class you write has a constructor, even if you don’t write it yourself.</strong></p>
</div></aside>
<p>You can write a constructor for your class (we’re about to do that), but if you don’t, <strong><em>the compiler writes one for you!</em></strong></p>
<p>Here’s what the compiler’s default constructor looks like:</p>
<pre data-type="programlisting">public Duck() {

}</pre>
<p><strong>Notice something missing? How is this different from a method?</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0243-03.png" alt="image" width="1072" height="316"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Construct a Duck"><div class="sect1" id="construct_a_duck">
<h1>Construct a Duck</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0244-01.png" alt="image" width="753" height="634"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="constructors" data-secondary="function of" id="idm46038393471552"/>The key feature of a constructor is that it runs <em>before</em> the object can be assigned to a reference. That means you get a chance to step in and do things to get the object ready for use. In other words, before anyone can use the remote control for an object, the object has a chance to help construct itself. In our Duck constructor, we’re not doing anything useful, just demonstrating the sequence of events.</p>
<p><strong>The constructor gives you a chance to step into the middle of <code>new.</code></strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0244-02.png" alt="image" width="790" height="580"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0244-03.png" alt="image" width="349" height="249"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Yours to solve.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00017">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>A constructor lets you jump into the middle of the object creation step—into the middle of <code><strong>new.</strong></code> Can you imagine conditions where that would be useful? Which of the actions on the right might be useful in a Car class constructor, if the Car is part of a Racing Game? Check off the ones that you came up with a scenario for.</p>
<ul>
<li><p>Increment a counter to track how many objects of this class type have been made.</p></li>
<li><p>Assign runtime-specific state (data about what’s happening NOW).</p></li>
<li><p>Assign values to the object’s important instance variables.</p></li>
<li><p>Get and save a reference to the object that’s creating the new object.</p></li>
<li><p>Add the object to an ArrayList.</p></li>
<li><p>Create HAS-A objects.</p></li>
<li><p>________________________________________ (your idea here)</p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Initializing the state of a new Duck"><div class="sect1" id="initializing_the_state_of_a_new_duck">
<h1>Initializing the state of a new Duck</h1>
<p><a data-type="indexterm" data-primary="constructors" data-secondary="initializing state of object" id="idm46038393448240"/><a data-type="indexterm" data-primary="methods" data-secondary="versus constructors" id="idm46038393445840"/>Most people use constructors to initialize the state of an object. In other words, to make and assign values to the object’s instance variables.</p>
<pre data-type="programlisting">public Duck() {
   size = 34;
}</pre>
<p>That’s all well and good when the Duck class <em>developer</em> knows how big the Duck object should be. But what if we want the programmer who is <em>using</em> Duck to decide how big a particular Duck should be?</p>
<p>Imagine the Duck has a size instance variable, and you want the programmer using your Duck class to set the size of the new Duck. How could you do it?</p>
<p>Well, you could add a setSize() setter method to the class. But that leaves the Duck temporarily without a size* and forces the Duck user to write <em>two</em> statements—one to create the Duck, and one to call the setSize() method. The code below uses a setter method to set the initial size of the new Duck.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0245-02.png" alt="image" width="909" height="845"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00020">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Why do you need to write a constructor if the compiler writes one for you?</strong></p>
<p><strong>A:</strong> If you need code to help initialize your object and get it ready for use, you’ll have to write your own constructor. You might, for example, be dependent on input from the user before you can finish making the object ready. There’s another reason you might have to write a constructor, even if you don’t need any constructor code yourself. It has to do with your superclass constructor, and we’ll talk about that soon.</p>
<p><strong>Q: How can you tell a constructor from a method? Can you also have a method that’s the same name as the class?</strong></p>
<p><strong>A:</strong> Java lets you declare a method with the same name as your class. That doesn’t make it a constructor, though. The thing that separates a method from a constructor is the return type. Methods must have a return type, but constructors cannot have a return type.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0245-03.png" alt="image" width="463" height="151"/>
<h6/>
</div></figure>
<p>The compiler will allow these methods but <strong>don’t do this.</strong> It’s against normal naming conventions (methods start with a lowercase letter) but more importantly it’s super confusing.</p>
<p><strong>Q: Are constructors inherited? If you don’t provide a constructor but your superclass does, do you get the superclass constructor instead of the default?</strong></p>
<p><strong>A:</strong> Nope. Constructors are not inherited. We’ll look at that in just a few pages.</p>
</div></aside>
<p>*Instance variables do have a default value. 0 or 0.0 for numeric primitives, false for booleans, and null for references.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Using the constructor to initialize important Duck state*"><div class="sect1" id="using_the_constructor_to_initialize_impo">
<h1>Using the constructor to initialize important Duck state*</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0246-01.png" alt="image" width="692" height="582"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="initializing" id="idm46038393428272"/><a data-type="indexterm" data-primary="initializing" data-secondary="with constructor" id="idm46038393427536"/>If an object shouldn’t be used until one or more parts of its state (instance variables) have been initialized, don’t let anyone get hold of a Duck object until you’re finished initializing! It’s usually way too risky to let someone make—and get a reference to—a new Duck object that isn’t quite ready for use until that someone turns around and calls the setSize() method. How will the Duck user even <em>know</em> that he’s required to call the setter method after making the new Duck?</p>
<p>The best place to put initialization code is in the constructor. And all you need to do is make a constructor with arguments.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0246-02.png" alt="image" width="1458" height="967"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0246-03.png" alt="image" width="349" height="249"/>
<h6/>
</div></figure>
<p>*Not to imply that not all Duck state is not unimportant.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Make it easy to make a Duck"><div class="sect1" id="make_it_easy_to_make_a_duck">
<h1>Make it easy to make a Duck</h1>
<section data-type="sect2" data-pdf-bookmark="Be sure you have a no-arg constructor"><div class="sect2" id="be_sure_you_have_a_no-arg_constructor">
<h2>Be sure you have a no-arg constructor</h2>
<p><a data-type="indexterm" data-primary="arguments" data-secondary="and no-arg constructor" id="idm46038393419040"/><a data-type="indexterm" data-primary="no-arg constructors" id="idm46038393415632"/>What happens if the Duck constructor takes an argument? Think about it. On the previous page, there’s only <em>one</em> Duck constructor—and it takes an int argument for the size of the Duck. That might not be a big problem, but it does make it harder for a programmer to create a new Duck object, especially if the programmer doesn’t <em>know</em> what the size of a Duck should be. Wouldn’t it be helpful to have a default size for a Duck so that if the user doesn’t know an appropriate size, they can still make a Duck that works?</p>
<p><strong><em>Imagine that you want Duck users to have TWO options for making a Duck—one where they supply the Duck size (as the constructor argument) and one where they don’t specify a size and thus get your <u>default</u> Duck size.</em></strong></p>
<p>You can’t do this cleanly with just a single constructor. Remember, if a method (or constructor—same rules) has a parameter, you <em>must</em> pass an appropriate argument when you invoke that method or constructor. You can’t just say, “If someone doesn’t pass anything to the constructor, then use the default size” because they won’t even be able to compile without sending an int argument to the constructor call. You <em>could</em> do something clunky like this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0247-01.png" alt="image" width="839" height="352"/>
<h6/>
</div></figure>
<p>But that means the programmer making a new Duck object has to <em>know</em> that passing a “0” is the protocol for getting the default Duck size. Pretty ugly. What if the other programmer doesn’t know that? Or what if they really <em>do</em> want a zero-sized Duck? (Assuming a zerosized Duck is allowed. If you don’t want zero-sized Duck objects, put validation code in the constructor to prevent it.) The point is, it might not always be possible to distinguish between a genuine “I want zero for the size” constructor argument and a “I’m sending zero so you’ll give me the default size, whatever that is” constructor argument.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000021">
<p><strong>You really want TWO ways to make a new Duck:</strong></p>
<pre data-type="programlisting">public class Duck2 {
  int size;

  public Duck2() {
    // supply default size
    size = 27;
  }

  public Duck2(int duckSize) {
    // use duckSize parameter
    size = duckSize;
  }
}</pre>
<p><strong>To make a Duck when you know the size:</strong></p>
<pre data-type="programlisting">Duck2 d = new Duck2(15);</pre>
<p><strong>To make a Duck when you do not know the size:</strong></p>
<pre data-type="programlisting">Duck2 d2 = new Duck2();</pre>
<p>So this two-options-to-make-a-Duck idea needs two constructors. One that takes an int and one that doesn’t. <strong><em>If you have more than one constructor in a class, it means you have overloaded constructors.</em></strong></p>
</div></aside>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Doesn’t the compiler always make a no-arg constructor for you? No!"><div class="sect1" id="doesnapostrophet_the_compiler_always_mak">
<h1>Doesn’t the compiler <u>always</u> make a no-arg constructor for you? <span style="color:#646466;"><u>No!</u></span></h1>
<figure class="informal"><div class="figure">
<img src="Images/f0248-01.png" alt="image" width="700" height="892"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="argument list" id="idm46038393629824"/>You might think that if you write <em>only</em> a constructor with arguments, the compiler will see that you don’t have a no-arg constructor and stick one in for you. But that’s not how it works. The compiler gets involved with constructor-making <em>only if you don’t say anything at all about constructors.</em></p>
<p><strong>If you write a constructor that takes arguments and you <em>still</em> want a no-arg constructor, you’ll have to build the no-arg constructor yourself!</strong></p>
<p>As soon as you provide a constructor, ANY kind of constructor, the compiler backs off and says, “OK fair enough, looks like you’re in charge of constructors now.”</p>
<p><strong>If you have more than one constructor in a class, the constructors MUST have different argument lists.</strong></p>
<p>The argument list includes the order and types of the arguments. As long as they’re different, you can have more than one constructor. You can do this with methods as well, but we’ll get to that in another chapter.</p>
<p><strong><u>Overloaded</u> constructors means you have more than one constructor in your class.</strong></p>
<p><strong>To compile, each constructor must have a <em>different</em> argument list!</strong></p>
<p>The class below is legal because all five constructors have different argument lists. If you had two constructors that took only an int, for example, the class wouldn’t compile. What you name the parameter variable doesn’t count. It’s the variable <em>type</em> (int, Dog, etc.) and <em>order</em> that matters. You <em>can</em> have two constructors that have identical types, <strong><em>as long as the order is different.</em></strong> A constructor that takes a String followed by an int is not the same as one that takes an int followed by a String.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46038393714896">
<p><strong>Five different constructors means five different ways to make a new mushroom.</strong></p>
</div></aside>
<figure class="informal"><div class="figure">
<img src="Images/f0249-02.png" alt="image" width="1477" height="504"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="bullet_points-id00010">
<h5>BULLET POINTS</h5>
<ul>
<li><p>Instance variables live within the object they belong to, on the Heap.</p></li>
<li><p>If the instance variable is a reference to an object, both the reference and the object it refers to are on the Heap.</p></li>
<li><p>A constructor is the code that runs when you say new on a class type.</p></li>
<li><p>A constructor must have the same name as the class, and must not have a return type.</p></li>
<li><p>You can use a constructor to initialize the state (i.e., the instance variables) of the object being constructed.</p></li>
<li><p>If you don’t put a constructor in your class, the compilerwill put in a default constructor.</p></li>
<li><p>The default constructor is always a no-arg constructor.</p></li>
<li><p>If you put a constructor.any constructor.in your class, the compiler will not build the default constructor.</p></li>
<li><p>If you want a no-arg constructor and you’ve already put in a constructor with arguments, you’ll have to build the no-arg constructor yourself.</p></li>
<li><p>Always provide a no-arg constructor if you can, to make it easy for programmers to make a working object. Supply default values.</p></li>
<li><p>Overloaded constructors means you have more than one constructor in your class.</p></li>
<li><p>Overloaded constructors must have different argument lists.</p></li>
<li><p>You cannot have two constructors with the same argument lists. An argument list includes the order and type of arguments.</p></li>
<li><p>Instance variables are assigned a default value, even when you don’t explicitly assign one. The default values are 0/0.0/false for primitives, and null for references.</p></li>
</ul>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00018">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="Duck constructor" id="idm46038393394416"/><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038393393904"/><a data-type="indexterm" data-primary="no-arg constructors" id="idm46038393393264"/><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Yours to solve.</strong></p>
<p>Match the <code>new Duck()</code> call with the constructor that runs when that Duck is instantiated. We did the easy one to get you started.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0250-02.png" alt="image" width="1494" height="1053"/>
<h6/>
</div></figure>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00021">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Earlier you said that it’s good to have a no-argument constructor so that if people call the no-arg constructor, we can supply default values for the “missing” arguments. But aren’t there times when it’s impossible to come up with defaults? Are there times when you should not have a no-arg constructor in your class?</strong></p>
<p>A: You’re right. There are times when a no-arg constructor doesn’t make sense. You’ll see this in the Java API—some classes don’t have a no-arg constructor. The Color class, for example, represents a...color. Color objects are used to, for example, set or change the color of a screen font or GUI button. When you make a Color instance, that instance is of a particular color (you know, Death-by-Chocolate Brown, Blue-Screen-of-Death Blue, Scandalous Red, etc.).</p>
<p>If you make a Color object, you must specify the color in some way.</p>
<pre data-type="programlisting">Color c = new Color(3,45,200);</pre>
<p>(We’re using three ints for RGB values here. We’ll get into using Color later, in <a data-type="xref" href="ch15.xhtml#work_on_your_swing_using_swing">Chapter 15</a>, <em>Work on Your Swing.</em>) Otherwise, what would you get? The Java API programmers could have decided that if you call a no-arg Color constructor you’ll get a lovely shade of mauve. But good taste prevailed. If you try to make a Color without supplying an argument:</p>
<pre data-type="programlisting">Color c = new Color();</pre>
<p>the compiler freaks out because it can’t find a matching no-arg constructor in the Color class.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0250-01.png" alt="image" width="428" height="249"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Nanoreview: four things to remember about constructors"><div class="sect1" id="nanoreview_four_things_to_remember_about">
<h1>Nanoreview: four things to remember about constructors</h1>
<ul style="list-style-type:none">
<li><p><a data-type="indexterm" data-primary="access modifiers" id="idm46038394091408"/><a data-type="indexterm" data-primary="constructors" data-secondary="private" id="idm46038393376400"/><a data-type="indexterm" data-primary="constructors" data-secondary="review" id="idm46038393375296"/><a data-type="indexterm" data-primary="private constructor" id="idm46038393374192"/><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> A constructor is the code that runs when somebody says <code>new</code> on a class type:</p>
<pre data-type="programlisting">Duck d = <u>new Duck();</u></pre></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> A constructor must have the same name as the class, and <code><strong>no</strong></code> return type:</p>
<pre data-type="programlisting">public <u>Duck</u>(int size) { }</pre></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> If you don’t put a constructor in your class, the compiler puts in a default constructor. The default constructor is always a no-arg constructor.</p>
<pre data-type="programlisting">public Duck() { }</pre></li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> You can have more than one constructor in your class, as long as the argument lists are different. Having more than one constructor in a class means you have <u>overloaded</u> constructors.</p>
<pre data-type="programlisting">public Duck() { }

public Duck(int size) { }

public Duck(String name) { }

public Duck(String name, int size) { }</pre></li>
</ul>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="brain_power-id00006">
<h5>BRAIN POWER</h5>
<figure class="informal"><div class="figure">
<img src="Images/brain.png" alt="image" width="80" height="71"/>
<h6/>
</div></figure>
<p><strong>What about superclasses?</strong></p>
<p><strong>When you make a Dog, should the Canine constructor run too?</strong></p>
<p><strong>If the superclass is abstract, should it even <em>have</em> a constructor?</strong></p>
<p>We’ll look at this on the next few pages, so stop now and think about the implications of constructors and superclasses.*</p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="there_are_no_dumb_questions-id00022">
<h5>there are no Dumb Questions</h5>
<p><strong>Q: Do constructors have to be <code>public?</code></strong></p>
<p><strong>A:</strong> No. Constructors can be <code>public, protected, private,</code> or <em>default</em> (which means no access modifier at all). We’ll look more at <em>default</em> access in <a data-type="xref" href="app02.xhtml#appendix_b_the_top_ten-ish_topics_that_d">Appendix B</a>.</p>
<p><strong>Q: How could a private constructor ever be useful? Nobody could ever call it, so nobody could ever make a new object!</strong></p>
<p><strong>A:</strong> Not exactly right. Marking something <code>private</code> doesn’t mean <em>nobody</em> can access it; it just means that <em>nobody outside the class</em> can access it. Bet you’re thinking Catch 22. Only code from the <em>same</em> class as the class-with-private-constructor can make a new object from that class, but without first making an object, how do you ever get to run code from that class in the first place? How do you ever get to anything in that class? <em>Patience grasshopper.</em> We’ll get there in the next chapter.</p>
</div></aside>
<p>*Doing all the Brain Power exercises has been shown to produce a 42% increase in neuron size. And you know what they say, “Big neurons...”</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Wait a minute...we never DID talk about superclasses and inheritance and how that all fits in with constructors"><div class="sect1" id="wait_a_minutehellipwe_never_did_talk_abo">
<h1>Wait a minute...we never DID talk about superclasses and inheritance and how that all fits in with constructors</h1>
<p><a data-type="indexterm" data-primary="constructors" data-secondary="superclass" id="idm46038393342224"/><a data-type="indexterm" data-primary="objects" data-secondary="superclass constructors" id="idm46038393363696"/><a data-type="indexterm" data-primary="superclass constructor" id="idm46038393343120"/>Here’s where it gets fun. Remember in the previous chapter we looked at the Snowboard object wrapping around an inner core representing the Object portion of the Snowboard class? The Big Point there was that every object holds not just its <em>own</em> declared instance variables, but also <em>everything from its superclasses</em> (which, at a minimum, means class Object, since <em>every</em> class extends Object).</p>
<p>So when an object is created (because somebody said <code>new</code>; there is <strong><em>no other way</em></strong> to create an object other than someone, somewhere saying <code><strong>new</strong></code> on the class type), the object gets space for <em>all</em> the instance variables, from all the way up the inheritance tree. Think about it for a moment... a superclass might have setter methods encapsulating a private variable. But that variable has to live <em>somewhere</em>. When an object is created, it’s almost as though <em>multiple</em> objects materialize—the object being new’d and one object per each superclass. Conceptually, though, it’s much better to think of it like the picture below, where the object being created has <em>layers</em> of itself representing each superclass.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0252-01.png" alt="image" width="634" height="771"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0252-02.png" alt="image" width="705" height="857"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="The role of superclass constructors in an object’s life"><div class="sect1" id="the_role_of_superclass_constructors_in_a">
<h1>The role of superclass constructors in an object’s life</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0253-01.png" alt="image" width="681" height="725"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0253-02.png" alt="image" width="216" height="496"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="abstract classes" data-secondary="constructors in" id="idm46038393328384"/><a data-type="indexterm" data-primary="constructors" data-secondary="chaining" id="idm46038393327184"/><a data-type="indexterm" data-primary="IS-A test" id="idm46038393326080"/><a data-type="indexterm" data-primary="objects" data-secondary="lifecycle of" id="idm46038393325248"/><strong><em>All the constructors in an object’s inheritance tree must run when you make a new object.</em></strong></p>
<p>Let that sink in.</p>
<p>That means every superclass has a constructor (because every class has a constructor), and each constructor up the hierarchy runs at the time an object of a subclass is created.</p>
<p>Saying <code><strong>new</strong></code> is a Big Deal. It starts the whole constructor chain reaction. And yes, even abstract classes have constructors. Although you can never say new on an abstract class, an abstract class is still a superclass, so its constructor runs when someone makes an instance of a concrete subclass.</p>
<p>The superclass constructors run to build out the superclass parts of the object. Remember, a subclass might inherit methods that depend on superclass state (in other words, the value of instance variables in the superclass). For an object to be fully formed, all the superclass parts of itself <em>must</em> be fully formed, and that’s why the superclass constructor must run. All instance variables from every class in the inheritance tree have to be declared and initialized. Even if Animal has instance variables that Hippo doesn’t inherit (if the variables are private, for example), the Hippo still depends on the Animal methods that <em>use</em> those variables.</p>
<p>When a constructor runs, it immediately calls its superclass constructor, all the way up the chain until you get to the class Object constructor.</p>
<p>On the next few pages, you’ll learn how superclass constructors are called, and how you can call them yourself. You’ll also learn what to do if your superclass constructor has arguments!</p>
<p><strong>A new Hippo object also IS-A Animal and IS-A Object. If you want to make a Hippo, you must also make the Animal and Object parts of the Hippo.</strong></p>
<p><strong>This all happens in a process called Constructor Chaining.</strong></p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Making a Hippo means making the Animal and Object parts too..."><div class="sect1" id="making_a_hippo_means_making_the_animal_a">
<h1>Making a Hippo means making the Animal and Object parts too...</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0254-01.png" alt="image" width="753" height="648"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="stack" data-secondary="superclass constructor" id="idm46038393307584"/>Given the class hierarchy in the code above, we can step through the process of creating a new Hippo object.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00019">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p>What’s the real output? Given the code on the left, what prints out when you run TestHippo? A or B?</p>
<p>(The answer is at the bottom of the page.)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-02.png" alt="image" width="432" height="564"/>
<h6/>
</div></figure>
</div></aside>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> Code from another class calls new <code><strong>Hippo()</strong></code>, and the <code><strong>Hippo()</strong></code> constructor goes into a stack frame at the top of the stack.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-03.png" alt="image" width="246" height="111"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <code><strong>Hippo()</strong></code> invokes the superclass constructor, which pushes the <code><strong>Animal()</strong></code> constructor onto the top of the stack.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-04.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <code><strong>Animal()</strong></code> invokes the superclass constructor, which pushes the <code><strong>Object()</strong></code> constructor onto the top of the stack, since Object is the superclass of Animal.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-05.png" alt="image" width="246" height="253"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/4.png" alt="Images" width="20" height="20"/></span> <code><strong>Object()</strong></code> completes, and its stack frame is popped off the stack. Execution goes back to the <code><strong>Animal()</strong></code> constructor and picks up at the line following Animal’s call to its superclass constructor.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0254-06.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure></li>
</ul>
<p>The first one, A. The Hippo() constructor is invoked first, but it’s the Animal constructor that finishes first.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="How do you invoke a superclass constructor?"><div class="sect1" id="how_do_you_invoke_a_superclass_construct">
<h1><em>How</em> do you invoke a superclass constructor?</h1>
<p>You might think that somewhere in, say, a Duck constructor, if Duck extends Animal you’d call Animal(). But that’s not how it works:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0255-01.png" alt="image" width="791" height="365"/>
<h6/>
</div></figure>
<p>The only way to call a superclass constructor is by calling <strong><em>super().</em></strong> That’s right—<strong><em>super()</em></strong> calls the <strong><em>superclass constructor.</em></strong></p>
<p>What are the odds?</p>
<figure class="informal"><div class="figure">
<img src="Images/f0255-02.png" alt="image" width="692" height="408"/>
<h6/>
</div></figure>
<p>A call to super() in your constructor puts the superclass constructor on the top of the Stack. And what do you think that superclass constructor does? <em>Calls its superclass constructor.</em> And so it goes until the Object constructor is on the top of the Stack. Once Object() finishes, it’s popped off the Stack, and the next thing down the Stack (the subclass constructor that called Object()) is now on top. <em>That</em> constructor finishes and so it goes until the original constructor is on the top of the Stack, where it can now finish.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000023">
<p><strong>And how is it that we’ve gotten away without calling super() before?</strong></p>
<p>You probably figured that out.</p>
<p><strong>Our good friend the compiler puts in a call to <em>super()</em> if you don’t.</strong></p>
<p>So the compiler gets involved in constructor-making in <em>two</em> ways:</p>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>If you <em>don’t</em> provide a constructor</strong></p>
<p>The compiler puts one in that looks like:</p>
<pre data-type="programlisting">public ClassName() {
  super();
}</pre></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>If you do provide a constructor but you do not put in the call to super()</strong></p>
<p>The compiler will put a call to super() in each of your overloaded constructors.* The compiler-supplied call looks like:</p>
<pre data-type="programlisting">super();</pre>
<p>It always looks like that. The compilerinserted call to super() is always a no-arg call. If the superclass has overloaded constructors, only the no-arg constructor is called.</p>
<p><span style="color:#646466;">*Unless the constructor calls another overloaded constructor (you’ll see that in a few pages).</span></p></li>
</ul>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Can the child exist before the parents?"><div class="sect1" id="can_the_child_exist_before_the_parentsqu">
<h1>Can the child exist before the parents?</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0256-01.png" alt="image" width="896" height="832"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="subclasses" data-secondary="and superclass constructors" id="idm46038393251632"/><a data-type="indexterm" data-primary="super()" id="idm46038393250880"/>If you think of a superclass as the parent to the subclass child, you can figure out which has to exist first. <strong><em>The superclass parts of an object have to be fully formed (completely built) before the subclass parts can be constructed.</em></strong> Remember, the subclass object might depend on things it inherits from the superclass, so it’s important that those inherited things be finished. No way around it. The superclass constructor must finish before its subclass constructor.</p>
<p>Look at the Stack series in <a data-type="xref" href="#making_a_hippo_means_making_the_animal_a">“Making a Hippo means making the Animal and Object parts too...”</a> again, and you can see that while the Hippo constructor is the <em>first</em> to be invoked (it’s the first thing on the Stack), it’s the <em>last</em> one to complete! Each subclass constructor immediately invokes its own superclass constructor, until the Object constructor is on the top of the Stack. Then Object’s constructor completes, and we bounce back down the Stack to Animal’s constructor. Only after Animal’s constructor completes do we finally come back down to finish the rest of the Hippo constructor. For that reason:</p>
<p><strong>The call to super() must be the <em>first</em> statement in each constructor!*</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000024">
<p>Possible constructors for class Boop</p>
<figure class="informal"><div class="figure">
<img src="Images/f0256-02.png" alt="image" width="1454" height="540"/>
<h6/>
</div></figure>
</div></aside>
<p>*There’s an exception to this rule; you’ll learn it in <a data-type="xref" href="#invoking_one_overloaded_constructor_from">“Invoking one overloaded constructor from another”</a>.</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Superclass constructors with arguments"><div class="sect1" id="superclass_constructors_with_arguments">
<h1>Superclass constructors with arguments</h1>
<p><a data-type="indexterm" data-primary="arguments" data-secondary="passing to super()" id="idm46038393238528"/>What if the superclass constructor has arguments? Can you pass something in to the super() call? Of course. If you couldn’t, you’d never be able to extend a class that didn’t have a no-arg constructor. Imagine this scenario: all animals have a name. There’s a getName() method in class Animal that returns the value of the name instance variable. The instance variable is marked private, but the subclass (in this case, Hippo) inherits the getName() method. So here’s the problem: Hippo has a getName() method (through inheritance) but does not have the name instance variable. Hippo has to depend on the Animal part of himself to keep the name instance variable, and return it when someone calls getName() on a Hippo object. But...how does the Animal part get the name? The only reference Hippo has to the Animal part of himself is through super(), so that’s the place where Hippo sends the Hippo’s name up to the Animal part of himself, so that the Animal part can store it in the private name instance variable.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0257-01.png" alt="image" width="269" height="709"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0257-02.png" alt="image" width="1045" height="1115"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0257-03.png" alt="image" width="483" height="495"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0257-04.png" alt="image" width="349" height="248"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Invoking one overloaded constructor from another"><div class="sect1" id="invoking_one_overloaded_constructor_from">
<h1>Invoking one overloaded constructor from another</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0258-01.png" alt="image" width="743" height="1030"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="constructors" data-secondary="overloaded" id="idm46038393217424"/><a data-type="indexterm" data-primary="overloaded constructors" id="idm46038393216144"/><a data-type="indexterm" data-primary="super()" id="idm46038393215312"/><a data-type="indexterm" data-primary="this()" id="idm46038393214480"/>What if you have overloaded constructors that, with the exception of handling different argument types, all do the same thing? You know that you don’t want <em>duplicate</em> code sitting in each of the constructors (pain to maintain, etc.), so you’d like to put the bulk of the constructor code (including the call to super()) in only <em>one</em> of the overloaded constructors. You want whichever constructor is first invoked to call The Real Constructor and let The Real Constructor finish the job of construction. It’s simple: just say <em>this()</em>. Or <em>this(aString)</em>. Or <em>this(27, x)</em>. In other words, just imagine that the keyword <em>this</em> is a reference to <strong>the current object.</strong></p>
<p>You can say <em>this()</em> only within a constructor, and it must be the first statement in the constructor!</p>
<p>But that’s a problem, isn’t it? Earlier we said that super() must be the first statement in the constructor. Well, that means you get a choice.</p>
<p><strong>Every constructor can have a call to super() or this(), but never both!</strong></p>
<p>You’ll need to choose which to call based on which values you have, which ones you need to set, and which constructors are provided in this class or the superclass.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0258-02.png" alt="image" width="1484" height="722"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sharpen_your_pencil-id00020">
<h5>Sharpen your pencil</h5>
<figure class="informal"><div class="figure">
<img src="Images/pencil.png" alt="image" width="122" height="80"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Sharpen Your Pencil" id="idm46038393202848"/><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Yours to solve.</strong></p>
<p>Some of the constructors in the SonOfBoo class will not compile. See if you can recognize which constructors are not legal. Match the compiler errors with the SonOfBoo constructors that caused them, by drawing a line from the compiler error to the “bad” constructor.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0259-01.png" alt="image" width="886" height="1306"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0259-02.png" alt="image" width="738" height="1673"/>
<h6/>
</div></figure>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Now we know how an object is born, but how long does an object live?"><div class="sect1" id="now_we_know_how_an_object_is_borncomma_b">
<h1>Now we know how an object is born, but how long does an object <em>live</em>?</h1>
<p><a data-type="indexterm" data-primary="instance variables" data-secondary="life and scope of" id="idm46038393194224"/><a data-type="indexterm" data-primary="local variables" data-secondary="life and scope of" id="idm46038393192224"/><a data-type="indexterm" data-primary="objects" data-secondary="lifecycle of" id="idm46038393191120"/><a data-type="indexterm" data-primary="reference variables" data-secondary="life and scope of" id="idm46038393190016"/><a data-type="indexterm" data-primary="scope, variable" id="idm46038393188912"/>An <em>object’s</em> life depends entirely on the life of references referring to it. If the reference is considered “alive,” the object is still alive on the Heap. If the reference dies (and we’ll look at what that means in just a moment), the object will die.</p>
<p><strong>So if an object’s life depends on the reference variable’s life, how long does a <em>variable</em> live?</strong></p>
<p>That depends on whether the variable is a <em>local</em> variable or an <em>instance</em> variable. The code below shows the life of a local variable. In the example, the variable is a primitive, but variable lifetime is the same whether it’s a primitive or reference variable.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0260-01.png" alt="image" width="771" height="1068"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000025">
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>A <u>local</u> variable lives only within the method that declared the variable.</strong></p>
<pre data-type="programlisting">public void read() {
  int s = 42;
  // ‘s’ can be used only
  // within this method.
  // When this method ends,
  // ‘s’ disappears completely.
}</pre>
<p>Variable “<strong>s</strong>” can be used only within the read() method. In other words, <em><strong>the variable is in scope only within its own method.</strong></em> No other code in the class (or any other class) can see “<strong>s.</strong>”</p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>An <u>instance</u> variable lives as long as the object does. If the object is still alive, so are its instance variables.</strong></p>
<pre data-type="programlisting">public class Life {
  int size;

  public void setSize(int s) {
    size = s;
    // ‘s’ disappears at the
    // end of this method,
    // but ‘size’ can be used
    // anywhere in the class
  }
}</pre>
<p>Variable ‘<strong>s</strong>’ (this time a method parameter) is in scope only within the setSize() method. But instance variable size is scoped to the life of the object as opposed to the life of the <em>method.</em></p></li>
</ul>
</div></aside>
<p><strong>The difference between life and scope for local variables:</strong></p>
<p><strong>Life</strong></p>
<p>A local variable is <em>alive</em> as long as its Stack frame is on the Stack. In other words, <em>until the method completes.</em></p>
<p><strong>Scope</strong></p>
<p>A local variable is in <em>scope</em> only within the method in which the variable was declared. When its own method calls another, the variable is alive, but not in scope until its method resumes. <strong><em>You can use a variable only when it is in scope.</em></strong></p>
<p>Let’s walk through what happens on the stack when something calls the doStuff() method.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0261-01.png" alt="image" width="491" height="406"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0261-02.png" alt="image" width="247" height="111"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/1circle.png" alt="Images" width="20" height="20"/></span> <strong><em>doStuff()</em> goes on the Stack. Variable “b” is alive and in scope.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0261-03.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/2circle.png" alt="Images" width="23" height="23"/></span> <strong><em>go()</em> plops on top of the Stack. “x” and “z” are alive and in scope, and “b” is alive but not in scope.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0261-04.png" alt="image" width="246" height="254"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/3circle.png" alt="Images" width="23" height="23"/></span> <strong><em>crazy()</em> is pushed onto the Stack, with “c” now alive and in scope. The other three variables are alive but out of scope.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0261-05.png" alt="image" width="251" height="177"/>
<h6/>
</div></figure>
<p><span class="inlineimage"><img src="Images/4circle.png" alt="Images" width="20" height="19"/></span> <strong><em>crazy()</em> completes and is popped off the Stack, so ‘c’ is out of scope and dead. When go() resumes where it left off, “x” and “x” are both alive and back in scope. Variable “b” is still alive but out of scope (until go() completes).</strong></p>
<p>While a local variable is alive, its state persists. As long as method doStuff() is on the Stack, for example, the “b” variable keeps its value. But the “b” variable can be used only while doStuff()’s Stack frame is at the top. In other words, you can use a local variable <em>only</em> while that local variable’s method is actually running (as opposed to waiting for higher Stack frames to complete).</p>
</div></section>
<section data-type="sect1" data-pdf-bookmark="What about reference variables?"><div class="sect1" id="what_about_reference_variablesquestion_m">
<h1>What about reference variables?</h1>
<p><a data-type="indexterm" data-primary="garbage collection" id="idm46038393777264"/><a data-type="indexterm" data-primary="memory" id="idm46038397219296"/><a data-type="indexterm" data-primary="memory" data-secondary="garbage collection" id="idm46038393414528"/><a data-type="indexterm" data-primary="objects" data-secondary="eligibility for garbage collection" id="idm46038393195232"/>The rules are the same for primitives and references. A reference variable can be used only when it’s in scope, which means you can’t use an object’s remote control unless you’ve got a reference variable that’s in scope. The <em>real</em> question is:</p>
<p><strong>“How does <em>variable</em> life affect <em>object</em> life?”</strong></p>
<p>An object is alive as long as there are live references to it. If a reference variable goes out of scope but is still alive, the object it <em>refers</em> to is still alive on the Heap. And then you have to ask...“What happens when the Stack frame holding the reference gets popped off the Stack at the end of the method?”</p>
<p>If that was the <em>only</em> live reference to the object, the object is now abandoned on the Heap. The reference variable disintegrated with the Stack frame, so the abandoned object is now, <em>officially</em>, toast. The trick is to know the point at which an object becomes <strong><em>eligible for garbage collection.</em></strong></p>
<p>Once an object is eligible for garbage collection (GC), you don’t have to worry about reclaiming the memory that object was using. If your program gets low on memory, GC will destroy some or all of the eligible objects, to keep you from running out of RAM. You can still run out of memory, but <em>not</em> before all eligible objects have been hauled off to the dump. Your job is to make sure that you abandon objects (i.e., make them eligible for GC) when you’re done with them, so that the garbage collector has something to reclaim. If you hang on to objects, GC can’t help you, and you run the risk of your program dying a painful out-of-memory death.</p>
<p><strong>An object’s life has no value, no meaning, no point, unless somebody has a reference to it.</strong></p>
<p><strong>If you can’t get to it, you can’t ask it to do anything and it’s just a big fat waste of bits.</strong></p>
<p><strong>But if an object is unreachable, the Garbage Collector will figure that out. Sooner or later, that object’s goin’ down.</strong></p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000026">
<p><strong>An object becomes eligible for GC when its last live reference disappears.</strong></p>
<p><strong>Three ways to get rid of an object’s reference:</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0262-01.png" alt="image" width="414" height="193"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0262-02.png" alt="image" width="903" height="436"/>
<h6/>
</div></figure>
</div></aside>
<p><strong>Object-killer #1</strong></p>
<p><strong>Reference goes out of scope, permanently.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0263-01.png" alt="image" width="351" height="161"/>
<h6/>
</div></figure>
<pre data-type="programlisting">public class StackRef {
  public void foof() {
     barf();
  }

  public void barf() {
     Duck d = new Duck();
 }
}</pre>
<figure class="informal"><div id="id000100006" class="figure">
<img src="Images/f0263-03.png" alt="image" width="601" height="516"/>
<h6/>
</div></figure>
<ul style="list-style-type:none">
<li><p><span class="inlineimage"><img src="Images/1-circle.png" alt="Images" width="23" height="22"/></span> <strong><em>foof()</em> is pushed onto the Stack; no variables are declared.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0263-04.png" alt="image" width="292" height="111"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/2-circle.png" alt="Images" width="23" height="23"/></span> <strong>2 <em>barf()</em> is pushed onto the Stack, where it declares a reference variable, and creates a new object assigned to that reference. The object is created on the Heap, and the reference is alive and in scope.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0263-05.png" alt="image" width="1046" height="333"/>
<h6/>
</div></figure></li>
<li><p><span class="inlineimage"><img src="Images/3-circle.png" alt="Images" width="20" height="20"/></span> <strong>3 <em>barf()</em> completes and pops off the Stack. Its frame disintegrates, so “d” is now dead and gone. Execution returns to foof(), but foof() can’t use “d.”</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0263-06.png" alt="image" width="292" height="230"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0263-07.png" alt="image" width="732" height="253"/>
<h6/>
</div></figure></li>
</ul>
<p><a data-type="indexterm" data-primary="reference variables" data-secondary="assignment" id="idm46038393104528"/><strong>Object-killer #2</strong></p>
<p><strong>Assign the reference to another object</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0264-01.png" alt="image" width="349" height="165"/>
<h6/>
</div></figure>
<pre data-type="programlisting">public class ReRef {
  Duck d = new Duck();

  public void go() {
    d = new Duck();
 }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0264-03.png" alt="image" width="648" height="473"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0264-04.png" alt="image" width="694" height="678"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0264-05.png" alt="image" width="805" height="1327"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="null reference" id="idm46038393094448"/><a data-type="indexterm" data-primary="reference variables" data-secondary="nulling" id="idm46038393093440"/><strong>Object-killer #3</strong></p>
<p><strong>Explicitly set the reference to null</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0265-01.png" alt="image" width="349" height="164"/>
<h6/>
</div></figure>
<pre data-type="programlisting">public class ReRef {
  Duck d = new Duck();

  public void go() {
    d = null;
  }
}</pre>
<figure class="informal"><div class="figure">
<img src="Images/f0265-03.png" alt="image" width="648" height="473"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0265-04.png" alt="image" width="693" height="598"/>
<h6/>
</div></figure>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="id00000027">
<p><strong>The meaning of <code>null</code></strong></p>
<p>When you set a reference to <code>null</code>, you’re deprogramming the remote control. In other words, you’ve got a remote control, but no TV at the other end. A null reference has bits representing “null” (we don’t know or care what those bits are, as long as the JVM knows).</p>
<p>If you have an unprogrammed remote control, in the real world, the buttons don’t do anything when you press them. But in Java, you can’t press the buttons (i.e., use the dot operator) on a null reference, because the JVM knows (this is a runtime issue, not a compiler error) that you’re expecting a bark, but there’s no Dog there to do it!</p>
<p><strong>If you use the dot operator on a null reference, you’ll get a NullPointerException at runtime.</strong> You’ll learn all about exceptions in <a data-type="xref" href="ch13.xhtml#risky_behavior_exception_handling">Chapter 13</a>, <em>Risky Behavior.</em></p>
</div></aside>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="fireside_chats">
<h5>Fireside Chats</h5>
<figure class="informal"><div class="figure">
<img src="Images/f0266-01.png" alt="image" width="396" height="166"/>
<h6/>
</div></figure>
<p>Tonight’s Talk: <strong>An instance variable and a local variable discuss life and death (with remarkable civility)</strong></p>
<table class="border">
<tbody>
<tr>
<td><a data-type="indexterm" data-primary="Fireside Chats" data-secondary="variable discussion on life and death" id="idm46038393072128"/><a data-type="indexterm" data-primary="local variables" data-secondary="life and scope of" id="idm46038393071024"/><strong>Instance Variable</strong></td>
<td><strong>Local Variable</strong></td>
</tr>
<tr>
<td>I’d like to go first, because I tend to be more important to a program than a local variable. I’m there to support an object, usually throughout the object’s entire life. After all, what’s an object without state? And what is state? Values kept in <strong><em>instance variables.</em></strong></td>
<td>I appreciate your point of view, and I certainly appreciate the value of object state and all, but I don’t want folks to be misled. Local variables are <em>really</em> important. To use your phrase, “After all, what’s an object without <em>behavior?”</em> And what is behavior? Algorithms in methods. And you can bet your bits there’ll be some <em>local variables</em> in there to make those algorithms work.</td>
</tr>
<tr>
<td>No, don’t get me wrong, I do understand your role in a method; it’s just that your life is so short. So temporary. That’s why they call you guys “temporary variables.”</td>
<td>Within the local-variable community, the phrase “temporary variable” is considered derogatory. We prefer “local,” “stack,” “automatic,” or “Scope-challenged.”</td>
</tr>
<tr>
<td>My apologies. I understand completely.</td>
<td>Anyway, it’s true that we don’t have a long life, and it’s not a particularly <em>good</em> life either. First, we’re shoved into a Stack frame with all the other local variables. And then, if the method we’re part of calls another method, another frame is pushed on top of us. And if that method calls another method...and so on. Sometimes we have to wait forever for all the other methods on top of the Stack to complete so that our method can run again.</td>
</tr>
<tr>
<td>I never really thought about it like that. What are you doing while the other methods are running and you’re waiting for your frame to be the top of the Stack again?</td>
<td>Nothing. Nothing at all. It’s like being in stasis— that thing they do to people in science-fiction movies when they have to travel long distances. Suspended animation, really. We just sit there on hold. As long as our frame is still there, we’re safe and the value we hold is secure, but it’s a mixed blessing when our frame gets to run again. On the one hand, we get to be active again. On the other hand, the clock starts ticking again on our short lives. The more time our method spends running, the closer we get to the end of the method. We <em>all</em> know what happens then.</td>
</tr>
<tr>
<td>We saw an educational video about it once. Looks like a pretty brutal ending. I mean, when that method hits its ending curly brace, the frame is literally <em>blown</em> off the Stack! Now <em>that’s</em> gotta hurt.</td>
<td>Tell me about it. In computer science they use the term <em>popped</em> as in “the frame was popped off the Stack.” That makes it sound fun, or maybe like an extreme sport. But, well, <em>you</em> saw the footage. So why don’t we talk about you? I know what my little Stack frame looks like, but where do you live?</td>
</tr>
<tr>
<td>I live on the Heap, with the objects. Well, not <em>with</em> the objects, actually <em>in</em> an object. The object whose state I store. I have to admit life can be pretty luxurious on the Heap. A lot of us feel guilty, especially around the holidays.</td>
<td>But you don’t <em>always</em> live as long as the object who declared you, right? Say there’s a Dog object with a Collar instance variable. Imagine <em>you’re</em> an instance variable of the <em>Collar</em> object, maybe a reference to a Buckle or something, sitting there all happy inside the <em>Collar</em> object who’s all happy inside the <em>Dog</em> object. But...what happens if the Dog wants a new Collar or <em>nulls</em> out its Collar instance variable? That makes the Collar object eligible for GC. So...if <em>you’re</em> an instance variable inside the <em>Collar</em> and the whole Collar is abandoned, what happens to <em>you?</em></td>
</tr>
<tr>
<td>OK, hypothetically, yes, if I’m an instance variable of the Collar and the Collar gets GC’d, then the Collar’s instance variables would indeed be tossed out like so many pizza boxes. But I was told that this almost never happens.</td>
<td>And you believed it? That’s what they say to keep us motivated and productive. But aren’t you forgetting something else? What if you’re an instance variable inside an object, and that object is referenced only by a local variable? If I’m the only reference to the object you’re in, when I go, you’re coming with me. Like it or not, our fates may be connected. So I say we forget about all this and go get a drink while we still can. Carpe RAM and all that.</td>
</tr>
</tbody>
</table>
<p>They let us <em>drink?</em></p>
</div></aside>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise"><div class="sect1" id="exercise-id000015">
<h1>Exercise</h1>
<figure class="informal"><div class="figure">
<img src="Images/common-03.png" alt="image" width="100" height="85"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="BE the Garbage Collector"><div class="sect2" id="be_the_garbage_collector">
<h2>BE the Garbage Collector</h2>
<figure class="informal"><div class="figure">
<img src="Images/common-05.png" alt="image" width="208" height="241"/>
<h6/>
</div></figure>
<p><strong>Which of the lines of code on the right, if added to the class on the left at point A, would cause exactly one additional object to be eligible for the Garbage Collector? (Assume that point A (//call more methods) will execute for a long time, giving the Garbage Collector time to do its stuff.)</strong></p>
<pre data-type="programlisting">public class GC {
 public static GC doStuff() {
   GC newGC = new GC();
   doStuff2(newGC);
   return newGC;
}

public static void main(String[] args) {
  GC gc1;
  GC gc2 = new GC();
  GC gc3 = new GC();
  GC gc4 = gc3;
  gc1 = doStuff();

  <img src="Images/a.png" alt="image" width="20" height="20"/>

  // call more methods
}

public static void doStuff2(GC copyGC) {
  GC localGC = copyGC;
 }
}</pre>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#be_the_garbage_collector_left_parenthesi">“Be the Garbage Collector”</a>.</strong></p>
<p><strong>1</strong> <code>copyGC = null;</code></p>
<p><strong>2</strong> <code>gc2 = null;</code></p>
<p><strong>3</strong> <code>newGC = gc3;</code></p>
<p><strong>4</strong> <code>gc1 = null;</code></p>
<p><strong>5</strong> <code>newGC = null;</code></p>
<p><strong>6</strong> <code>gc4 = null;</code></p>
<p><strong>7</strong> <code>gc3 = gc2;</code></p>
<p><strong>8</strong> <code>gc1 = gc4;</code></p>
<p><strong>9</strong> <code>gc3 = null;</code></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Popular Objects"><div class="sect2" id="popular_objects-id0100010">
<h2>Popular Objects</h2>
<p><a data-type="indexterm" data-primary="exercises" data-secondary="Popular Objects" id="idm46038393018448"/>In this code example, several new objects are created. Your challenge is to find the object that is “most popular,” i.e., the one that has the most reference variables referring to it. Then list how many total references there are for that object, and what they are! We’ll start by pointing out one of the new objects and its reference variable.</p>
<p>Good luck!</p>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#popular_objects_left_parenthesis_from_pa">“Popular Objects”</a>.</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0269-01.png" alt="image" width="1055" height="1380"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/common-04.png" alt="image" width="110" height="75"/>
<h6/>
</div></figure>
<p><a data-type="indexterm" data-primary="puzzles" data-secondary="Five-Minute Mystery" id="idm46038393005584"/>“We’ve run the simulation four times, and the main module’s temperature consistently drifts out of nominal toward cold,” Sarah said, exasperated. “We installed the new temp-bots last week. The readings on the radiator bots, designed to cool the living quarters, seem to be within spec, so we’ve focused our analysis on the heat retention bots, the bots that help to warm the quarters.” Tom sighed, at first it had seemed that nanotechnology was going to really put them ahead of schedule. Now, with only five weeks left until launch, some of the orbiter’s key life support systems were still not passing the simulation gauntlet.</p>
<p>“What ratios are you simulating?” Tom asked.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Five-Minute Mystery"><div class="sect2" id="five-minute_mystery-id00002">
<h2>Five-Minute Mystery</h2>
<figure class="informal"><div class="figure">
<img src="Images/common-07.png" alt="image" width="150" height="114"/>
<h6/>
</div></figure>
<p>“Well, if I see where you’re going, we already thought of that,” Sarah replied. “Mission control will not sign off on critical systems if we run them out of spec. We are required to run the v3 radiator bot’s SimUnits in a 2:1 ratio with the v2 radiator’s SimUnits,” Sarah continued. “Overall, the ratio of retention bots to radiator bots is supposed to run 4:3.”</p>
<p>“How’s power consumption, Sarah?” Tom asked. Sarah paused, “Well, that’s another thing, power consumption is running higher than anticipated. We’ve got a team tracking that down too, but because the nanos are wireless, it’s been hard to isolate the power consumption of the radiators from the retention bots.” “Overall power consumption ratios,” Sarah continued, “are designed to run 3:2 with the radiators pulling more power from the wireless grid.”</p>
<p>“OK, Sarah,” Tom said. “Let’s take a look at some of the simulation initiation code. We’ve got to find this problem, and find it quick!”</p>
<pre data-type="programlisting">import java.util.ArrayList;

class V2Radiator {
  V2Radiator(ArrayList&lt;SimUnit&gt; list) {
    for (int x = 0; x &lt; 5; x++) {
      list.add(new SimUnit("V2Radiator"));
    }
  }
}

class V3Radiator extends V2Radiator {
  V3Radiator(ArrayList&lt;SimUnit&gt; lglist) {
    super(lglist);
    for (int g = 0; g &lt; 10; g++) {
      lglist.add(new SimUnit("V3Radiator"));
    }
  }
}

class RetentionBot {
  RetentionBot(ArrayList&lt;SimUnit&gt; rlist) {
    rlist.add(new SimUnit("Retention"));
  }
}
import java.util.ArrayList;

public class TestLifeSupportSim {
  public static void main(String[] args) {
    ArrayList&lt;SimUnit&gt; aList = new ArrayList&lt;SimUnit&gt;();
    V2Radiator v2 = new V2Radiator(aList);
    V3Radiator v3 = new V3Radiator(aList);
    for (int z = 0; z &lt; 20; z++) {
      RetentionBot ret = new RetentionBot(aList);
    }
  }
}

class SimUnit {
  String botType;

  SimUnit(String type) {
    botType = type;
  }

  int powerUse() {
    if ("Retention".equals(botType)) {
      return 2;
    } else {
      return 4;
    }
  }
}</pre>
<p>Tom gave the code a quick look, and a small smile crept across his lips. “I think I’ve found the problem, Sarah, and I bet I know by what percentage your power usage readings are off too!”</p>
<p><strong><em>What did Tom suspect? How could he guess the power readings errors, and what few lines of code could you add to help debug this program?</em></strong></p>
<p><span class="inlineimage"><img src="Images/arr.png" alt="Images" width="60" height="12"/></span> <strong>Answers in <a data-type="xref" href="#five-minute_mystery_left_parent-id01000">“Five-Minute Mystery”</a>.</strong></p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="Exercise Solutions"><div class="sect1" id="exercise_solutions-id00005">
<h1>Exercise Solutions</h1>
<figure class="informal"><div class="figure">
<img src="Images/common-03.png" alt="image" width="100" height="85"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Be the Garbage Collector"><div class="sect2" id="be_the_garbage_collector_left_parenthesi">
<h2>Be the Garbage Collector</h2>
<p>(from <a data-type="xref" href="#exercise-id000015">“Exercise”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0272-01.png" alt="image" width="904" height="696"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Popular Objects"><div class="sect2" id="popular_objects_left_parenthesis_from_pa">
<h2>Popular Objects</h2>
<p>(from <a data-type="xref" href="#popular_objects-id0100010">“Popular Objects”</a>)</p>
<p>It probably wasn’t too hard to figure out that the Honey object first referred to by the honeyPot variable is by far the most “popular” object in this class. But maybe it was a little trickier to see that all of the variables that point from the code to the Honey object refer to the <strong><em>same object!</em></strong> There are a total of 12 active references to this object right before the main( ) method completes. The <em>kit.honeyPot</em> variable is valid for a while, but kit gets nulled at the end. Since <em>raccoon.rk</em> still refers to the Kit object, <em>raccoon.kit.honeyPot</em> (although never explicitly declared) refers to the object!</p>
<figure class="informal"><div class="figure">
<img src="Images/f0272-03.png" alt="image" width="1386" height="718"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Five-Minute Mystery"><div class="sect2" id="five-minute_mystery_left_parent-id01000">
<h2>Five-Minute Mystery</h2>
<p>(from <a data-type="xref" href="#five-minute_mystery-id00002">“Five-Minute Mystery”</a>)</p>
<figure class="informal"><div class="figure">
<img src="Images/common-04.png" alt="image" width="110" height="75"/>
<h6/>
</div></figure>
<p>Tom noticed that the constructor for the V2Radiator class took an ArrayList. That meant that every time the V3Radiator constructor was called, it passed an ArrayList in its super() call to the V2Radiator constructor. That meant that an extra five V2Radiator SimUnits were created. If Tom was right, total power use would have been 120, not the 100 that Sarah’s expected ratios predicted.</p>
<p>Since all the Bot classes create SimUnits, writing a constructor for the SimUnit class, which printed out a line every time a SimUnit was created, would have quickly highlighted the problem!</p>
</div></section>
</div></section>
</div></section></div></body></html>