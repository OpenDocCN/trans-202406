<html><head></head><body><section data-pdf-bookmark="Chapter 23. GraphQL and React Native" data-type="chapter" epub:type="chapter"><div class="chapter" id="mobile-api">&#13;
<h1><span class="label">Chapter 23. </span>GraphQL and React Native</h1>&#13;
&#13;
&#13;
<p>At the Andy Warhol Museum in Pittsburgh, Pennsylvania, there is a permanent installation called “Silver Clouds.” The installation is a sparse room with a dozen or so rectangular foil balloons, each filled with a mix of helium and regular air. The result is that the balloons will stay suspended longer than balloons filled with atmospheric air, but don’t float to the ceiling like helium balloons. Patrons of the museum walk through the museum, playfully batting the balloons to keep them afloat.</p>&#13;
&#13;
<p>Currently, our application is much like the room of “clouds.” It’s enjoyable to playfully click the icons and navigate around the app shell, but in the end it is a mostly empty room (no offense to Mr. Warhol). In this chapter, we’ll begin to fill our application by first exploring how we can display content with React Native’s list views. We’ll then make use of <a href="https://www.apollographql.com/docs/react">Apollo Client</a> to connect to our data API. Once we’ve connected, we’ll write GraphQL queries, which will display data on an app screen.</p>&#13;
<div data-type="note" epub:type="note"><h1>Running Our API Locally</h1>&#13;
<p>The development of our mobile application will require access to a local instance of our API. If you’ve been following along with the book, you may already have the Notedly API and its database up and running on your machine. If not, I’ve added instructions in the book’s <a data-type="xref" href="app01.html#appendix-api">Appendix A</a> on how to get a copy of the API up and running along with some sample data. If you already have the API running, but would like some additional data to work with, run <strong><code>npm run seed</code></strong> from the root of the API project directory.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Creating List and Scrollable Content Views" data-type="sect1"><div class="sect1" id="idm45339483136248">&#13;
<h1>Creating List and Scrollable Content Views</h1>&#13;
&#13;
<p><a data-primary="list" data-secondary="creating" data-type="indexterm" id="ix_ch23-asciidoc0"/><a data-primary="React Native" data-secondary="creating list and scrollable content views" data-type="indexterm" id="ix_ch23-asciidoc1"/><a data-primary="scrollable content views" data-type="indexterm" id="ix_ch23-asciidoc2"/>Lists are everywhere. In life we keep to-do lists, grocery lists, and guest lists. In applications, lists are one of the most common UI patterns: lists of social media posts, lists of articles, lists of songs, lists of movies, and so on. The list (see what I did there?) goes on and on. It may come as no surprise, then, that React Native makes creating scrollable lists of content a straightforward process.</p>&#13;
&#13;
<p>The two types of lists on React Native are <code>FlatList</code> and <code>SectionList</code>. A <a data-primary="FlatList" data-type="indexterm" id="idm45339483128824"/><code>FlatList</code> is useful for a large number of items in a single scrollable list. React Native does some helpful things behind the scenes, such as rendering only the items that are initially viewable to improve performance. A <a data-primary="SectionList" data-type="indexterm" id="idm45339483127480"/><code>SectionList</code> is much like a <code>FlatList</code>, except that it allows groups of list items to have a header. Think of contacts in a contact list, often grouped alphabetically beneath an alphanumeric header.</p>&#13;
&#13;
<p>For our purposes, we’ll be using a <code>FlatList</code> to display a list of notes, through which a user can scroll and tap a preview to read the full note. To achieve this, let’s create a new component named <code>NoteFeed</code>, which we can use to display the list of notes. For now we’ll use some stand-in data, but we’ll connect it to our API soon.</p>&#13;
&#13;
<p>To begin, let’s create a new component at <em>src/components/NoteFeed.js</em>. We’ll start by importing our dependencies and adding an array of temporary data.</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">FlatList</code><code class="p">,</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// our dummy data</code>&#13;
<code class="kr">const</code> <code class="nx">notes</code> <code class="o">=</code> <code class="p">[</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Giant Steps'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Tomorrow Is The Question'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">2</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Tonight At Noon'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">3</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Out To Lunch'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">4</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Green Street'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">5</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'In A Silent Way'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">6</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Lanquidity'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">7</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Nuff Said'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">8</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Nova'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">9</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'The Awakening'</code> <code class="p">}</code>&#13;
<code class="p">];</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// our component code will go here</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">NoteFeed</code><code class="p">;</code></pre>&#13;
&#13;
<p class="pagebreak-before">Now we can write our component code, which will contain a <code>FlatList</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">item</code><code class="p">.</code><code class="nx">content</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Text&gt;}</code>&#13;
      <code class="err">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>In the preceding code you can see that <code>FlatList</code> receives three properties that simplify the process of iterating over the data:</p>&#13;
<dl>&#13;
<dt><code>data</code></dt>&#13;
<dd>&#13;
<p>This property points to the array of data that the list will contain.</p>&#13;
</dd>&#13;
<dt><code>keyExtractor</code></dt>&#13;
<dd>&#13;
<p>Each item in the list must have a unique <code>key</code> value. We are using <code>keyExtractor</code> to use the unique <code>id</code> value as the <code>key</code>.</p>&#13;
</dd>&#13;
<dt><code>renderItem</code></dt>&#13;
<dd>&#13;
<p>This property defines what should be rendered within the list. For now we are passing an individual <code>item</code> from our <code>notes</code> array and displaying it as <code>Text</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>We can view our list by updating our <em>src/screens/feed.js</em> component to display the feed:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// import NoteFeed</code>&#13;
<code class="kr">import</code> <code class="nx">NoteFeed</code> <code class="nx">from</code> <code class="s1">'../components/NoteFeed'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Feed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">Feed</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Feed'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Feed</code><code class="p">;</code></pre>&#13;
&#13;
<p>Let’s move back to our <em>src/components/NoteFeed.js</em> file and update <code>renderItem</code> to add some spacing between list items using a styled component:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// FeedView styled component definition</code>&#13;
<code class="kr">const</code> <code class="nx">FeedView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  height: 100;</code>&#13;
<code class="sb">  overflow: hidden;</code>&#13;
<code class="sb">  margin-bottom: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">FeedView</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">item</code><code class="p">.</code><code class="nx">content</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/FeedView&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>If you preview our app, you’ll see a scrollable list of data. Finally, we can add a separator between our list items. Rather than adding a bottom border via CSS, React Native enables us to pass an <code>ItemSeparatorComponent</code> property to our <code>FlatList</code>. This gives us fine-grained control to place any type of component as a separator between list elements. It also avoids placing a separator in unwanted places, such as after the last item in the list. For our purposes we’ll add a simple border, created as a styled component <code>View</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// FeedView styled component definition</code>&#13;
<code class="kr">const</code> <code class="nx">FeedView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  height: 100;</code>&#13;
<code class="sb">  overflow: hidden;</code>&#13;
<code class="sb">  margin-bottom: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// add a Separator styled component</code>&#13;
<code class="kr">const</code> <code class="nx">Separator</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  height: 1;</code>&#13;
<code class="sb">  width: 100%;</code>&#13;
<code class="sb">  background-color: #ced0ce;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">ItemSeparatorComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">Separator</code> <code class="o">/&gt;</code><code class="p">}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">FeedView</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">item</code><code class="p">.</code><code class="nx">content</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/FeedView&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Rather than rendering and styling our note’s content directly in our <code>FlatList</code>, let’s isolate it within its own component. To do so we’ll introduce a new type of view called <a data-primary="ScrollView" data-type="indexterm" id="idm45339482653608"/><code>ScrollView</code>. The functionality of a <code>ScrollView</code> is precisely what you’d expect: rather than conforming to the size of the screen, a <code>ScrollView</code> will overflow the content, allowing the user to scroll.</p>&#13;
&#13;
<p>Let’s create a new component at <em>src/components/Note.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">ScrollView</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">ScrollView</code><code class="sb">`</code>&#13;
<code class="sb">  padding: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Note</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">NoteView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">note</code><code class="p">.</code><code class="nx">content</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/NoteView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Note</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, we’ll update our <em>src/components/NoteFeed.js</em> component to make use of our new <code>Note</code> component by importing it and using it within our <code>FeedView</code>. The final component code will be as follows (<a data-type="xref" href="#flatlist_demo">Figure 23-1</a>):</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">FlatList</code><code class="p">,</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Note</code> <code class="nx">from</code> <code class="s1">'./Note'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// our dummy data</code>&#13;
<code class="kr">const</code> <code class="nx">notes</code> <code class="o">=</code> <code class="p">[</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">0</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Giant Steps'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">1</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Tomorrow Is The Question'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">2</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Tonight At Noon'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">3</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Out To Lunch'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">4</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Green Street'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">5</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'In A Silent Way'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">6</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Lanquidity'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">7</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Nuff Said'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">8</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'Nova'</code> <code class="p">},</code>&#13;
  <code class="p">{</code> <code class="nx">id</code><code class="o">:</code> <code class="mi">9</code><code class="p">,</code> <code class="nx">content</code><code class="o">:</code> <code class="s1">'The Awakening'</code> <code class="p">}</code>&#13;
<code class="p">];</code>&#13;
&#13;
<code class="c1">// FeedView styled-component definition</code>&#13;
<code class="kr">const</code> <code class="nx">FeedView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  height: 100;</code>&#13;
<code class="sb">  overflow: hidden;</code>&#13;
<code class="sb">  margin-bottom: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Separator</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  height: 1;</code>&#13;
<code class="sb">  width: 100%;</code>&#13;
<code class="sb">  background-color: #ced0ce;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">ItemSeparatorComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">Separator</code> <code class="o">/&gt;</code><code class="p">}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">FeedView</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Note</code> <code class="nx">note</code><code class="o">=</code><code class="p">{</code><code class="nx">item</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/FeedView&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">NoteFeed</code><code class="p">;</code></pre>&#13;
&#13;
<figure><div class="figure" id="flatlist_demo">&#13;
<img alt="A screenshot of the app with a list of data" src="assets/jsev_2301.png"/>&#13;
<h6><span class="label">Figure 23-1. </span>Using FlatList we can display a list of data</h6>&#13;
</div></figure>&#13;
&#13;
<p>With this we’ve laid out a simple <code>FlatList</code>. Now let’s make it possible to route from a list item to an individual route.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Making a List Routable" data-type="sect2"><div class="sect2" id="idm45339482375096">&#13;
<h2>Making a List Routable</h2>&#13;
&#13;
<p><a data-primary="list" data-secondary="making a list routable" data-type="indexterm" id="idm45339482373496"/><a data-primary="React Native" data-secondary="making a list routable" data-type="indexterm" id="idm45339482108856"/>A very common pattern in mobile applications is to tap an item in a list to view more information or expanded functionality. If you recall from the previous chapter, our feed screen sits atop the note screen in our navigation stack.  In React Native we can use the <code>TouchableOpacity</code> as a wrapper for making any view respond to user touches. This means that we can wrap the content of our <code>FeedView</code> in <code>TouchableOpacity</code> and route the user on press, the same way that we previously did with a button. Let’s go ahead and update our <em>src/components/NoteFeed.js</em> component to do just that.</p>&#13;
&#13;
<p>First, we must update our <code>react-native</code> import to include <code>TouchableOpacity</code> in <em>src/components/NoteFeed.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">FlatList</code><code class="p">,</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">TouchableOpacity</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Next, we update our component to use <code>TouchableOpacity</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">ItemSeparatorComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">Separator</code> <code class="o">/&gt;</code><code class="p">}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">TouchableOpacity</code>&#13;
            <code class="nx">onPress</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code>&#13;
              <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'Note'</code><code class="p">,</code> <code class="p">{</code>&#13;
                <code class="nx">id</code><code class="o">:</code> <code class="nx">item</code><code class="p">.</code><code class="nx">id</code>&#13;
              <code class="p">})</code>&#13;
            <code class="p">}</code>&#13;
          <code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">FeedView</code><code class="o">&gt;</code>&#13;
              <code class="o">&lt;</code><code class="nx">Note</code> <code class="nx">note</code><code class="o">=</code><code class="p">{</code><code class="nx">item</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
            <code class="o">&lt;</code><code class="err">/FeedView&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/TouchableOpacity&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>We’ll also need to update our <em>feed.js</em> screen component to pass the navigation properties to the feed. In <em>src/screens/feed.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">Feed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With this, we can easily navigate to our generic note screen. Let’s customize that screen so that it displays the ID of the note. You may have noticed that in our <code>NoteFeed</code> component navigation, we’re passing an <code>id</code> property. In <em>screens/note.js</em> we can read the value of that property:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">View</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteScreen</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">id</code> <code class="o">=</code> <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">getParam</code><code class="p">(</code><code class="s1">'id'</code><code class="p">);</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code> <code class="nx">style</code><code class="o">=</code><code class="p">{{</code> <code class="nx">padding</code><code class="o">:</code> <code class="mi">10</code> <code class="p">}}</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">This</code> <code class="nx">is</code> <code class="nx">note</code> <code class="p">{</code><code class="nx">id</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">NoteScreen</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now, we’re able to navigate from our list view to a detail page. Next, let’s take a look at how we can integrate data from our API into our application.<a data-startref="ix_ch23-asciidoc2" data-type="indexterm" id="idm45339481898216"/><a data-startref="ix_ch23-asciidoc1" data-type="indexterm" id="idm45339481897608"/><a data-startref="ix_ch23-asciidoc0" data-type="indexterm" id="idm45339481773384"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GraphQL with Apollo Client" data-type="sect1"><div class="sect1" id="idm45339483135464">&#13;
<h1>GraphQL with Apollo Client</h1>&#13;
&#13;
<p><a data-primary="Apollo Client" data-secondary="GraphQL" data-type="indexterm" id="ix_ch23-asciidoc3"/><a data-primary="GraphQL" data-secondary="Apollo Client" data-type="indexterm" id="ix_ch23-asciidoc4"/>At this point we are ready to read and display data within our application. We’ll be accessing the GraphQL API that we created in the first portion of the book. Conveniently, we’ll be making use of Apollo Client, the same GraphQL client library from the web portion of the book. Apollo Client offers a number of helpful features to simplify working with GraphQL within JavaScript UI applications. Apollo’s client features include fetching data from a remote API, local caching, GraphQL syntax handling, local state management, and more.</p>&#13;
&#13;
<p>To get started we’ll first need to set up our configuration file. We’ll store our environment variables in a file called <em>config.js</em>. There are several ways to manage environment and configuration variables in React Native, but I’ve found this style of configuration file to be the most straightforward and effective. To get started, I’ve included a <em>config-example.js</em> file, which you can copy and edit with our app values. In your terminal application, from the root of the project directory:</p>&#13;
&#13;
<pre data-type="programlisting">$ cp config.example.js config.js</pre>&#13;
&#13;
<p>From here we can update any <code>dev</code> or <code>prod</code> environment variables. In our case that will only be a production <code>API_URI</code> value:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// set environment variables</code>&#13;
<code class="kr">const</code> <code class="nx">ENV</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">dev</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">API_URI</code><code class="o">:</code> <code class="sb">`http://</code><code class="si">${</code><code class="nx">localhost</code><code class="si">}</code><code class="sb">:4000/api`</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">prod</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="c1">// update the API_URI value with your publicly deployed API address</code>&#13;
    <code class="nx">API_URI</code><code class="o">:</code> <code class="s1">'https://your-api-uri/api'</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>We will now be able to access these two values, based on Expo’s environment, using the <code>getEnvVars</code> function. We won’t dive into the rest of the configuration file, but it is well commented if you are interested in exploring this setup further.</p>&#13;
&#13;
<p>From here we can connect our client to our API. In our <em>src/Main.js</em> file we will set up Apollo by using the Apollo Client library. If you worked through the web portion of the book, this  will look very familiar:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Screens</code> <code class="nx">from</code> <code class="s1">'./screens'</code><code class="p">;</code>&#13;
<code class="c1">// import the Apollo libraries</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">ApolloClient</code><code class="p">,</code> <code class="nx">ApolloProvider</code><code class="p">,</code> <code class="nx">InMemoryCache</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
<code class="c1">// import environment configuration</code>&#13;
<code class="kr">import</code> <code class="nx">getEnvVars</code> <code class="nx">from</code> <code class="s1">'../config'</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="p">{</code> <code class="nx">API_URI</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">getEnvVars</code><code class="p">();</code>&#13;
&#13;
<code class="c1">// configure our API URI &amp; cache</code>&#13;
<code class="kr">const</code> <code class="nx">uri</code> <code class="o">=</code> <code class="nx">API_URI</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">InMemoryCache</code><code class="p">();</code>&#13;
&#13;
<code class="c1">// configure Apollo Client</code>&#13;
<code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ApolloClient</code><code class="p">({</code>&#13;
  <code class="nx">uri</code><code class="p">,</code>&#13;
  <code class="nx">cache</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Main</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// wrap our app in the ApolloProvider higher-order component</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">ApolloProvider</code> <code class="nx">client</code><code class="o">=</code><code class="p">{</code><code class="nx">client</code><code class="p">}</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Screens</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/ApolloProvider&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Main</code><code class="p">;</code></pre>&#13;
&#13;
<p>With this, there won’t be a visible change in our application, but we are now connected to our API. Next, let’s look at how we can query data from that API.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Writing GraphQL Queries" data-type="sect2"><div class="sect2" id="idm45339481738456">&#13;
<h2>Writing GraphQL Queries</h2>&#13;
&#13;
<p><a data-primary="GraphQL" data-secondary="writing queries" data-type="indexterm" id="ix_ch23-asciidoc5"/><a data-primary="queries" data-secondary="GraphQL" data-type="indexterm" id="ix_ch23-asciidoc6"/>Now that we’re connected to our API, let’s query some of the data. We’ll start by querying for all of the notes in our database, to be displayed in our <code>NoteFeed</code> list. We’ll then query for individual notes to be displayed in our <code>Note</code> detail view.</p>&#13;
<div data-type="note" epub:type="note"><h1>The note Query</h1>&#13;
<p>We’ll be using the bulk <code>note</code> API query rather than the paginated <code>noteFeed</code> query for simplicity and to reduce repetition.</p>&#13;
</div>&#13;
&#13;
<p>Writing a <code>Query</code> component works exactly the same way as in a React web application. In <em>src/screens/feed.js</em>, we import the <code>useQuery</code> and GraphQL Language (<code>gql</code>) libraries like so:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// import our React Native and Apollo dependencies</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Next, we compose our query:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">GET_NOTES</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  query notes {</code>&#13;
<code class="sb">    notes {</code>&#13;
<code class="sb">      id</code>&#13;
<code class="sb">      createdAt</code>&#13;
<code class="sb">      content</code>&#13;
<code class="sb">      favoriteCount</code>&#13;
<code class="sb">      author {</code>&#13;
<code class="sb">        username</code>&#13;
<code class="sb">        id</code>&#13;
<code class="sb">        avatar</code>&#13;
<code class="sb">      }</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, we update our component to call the query:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">Feed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">GET_NOTES</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// if the data is loading, our app will display a loading indicator</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if there is an error fetching the data, display an error message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">loading</code> <code class="nx">notes</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if the query is successful and there are notes, return the feed of notes</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="nx">notes</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">notes</code><code class="p">}</code> <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>All together, our <em>src/screens/feed.js</em> file is written as follows:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="c1">// import our Apollo libraries</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">NoteFeed</code> <code class="nx">from</code> <code class="s1">'../components/NoteFeed'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// compose our query</code>&#13;
<code class="kr">const</code> <code class="nx">GET_NOTES</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  query notes {</code>&#13;
<code class="sb">    notes {</code>&#13;
<code class="sb">      id</code>&#13;
<code class="sb">      createdAt</code>&#13;
<code class="sb">      content</code>&#13;
<code class="sb">      favoriteCount</code>&#13;
<code class="sb">      author {</code>&#13;
<code class="sb">        username</code>&#13;
<code class="sb">        id</code>&#13;
<code class="sb">        avatar</code>&#13;
<code class="sb">      }</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Feed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">GET_NOTES</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// if the data is loading, our app will display a loading indicator</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if there is an error fetching the data, display an error message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">loading</code> <code class="nx">notes</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if the query is successful and there are notes, return the feed of notes</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="nx">notes</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">notes</code><code class="p">}</code> <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">Feed</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Feed'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Feed</code><code class="p">;</code></pre>&#13;
&#13;
<p>With our query written, we can update the <em>src/components/NoteFeed.js</em> component to use the data passed to it via <code>props</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">NoteFeed</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FlatList</code>&#13;
        <code class="nx">data</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">notes</code><code class="p">}</code>&#13;
        <code class="nx">keyExtractor</code><code class="o">=</code><code class="p">{({</code> <code class="nx">id</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="nx">id</code><code class="p">.</code><code class="nx">toString</code><code class="p">()}</code>&#13;
        <code class="nx">ItemSeparatorComponent</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="o">&lt;</code><code class="nx">Separator</code> <code class="o">/&gt;</code><code class="p">}</code>&#13;
        <code class="nx">renderItem</code><code class="o">=</code><code class="p">{({</code> <code class="nx">item</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">TouchableOpacity</code>&#13;
            <code class="nx">onPress</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code>&#13;
              <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'Note'</code><code class="p">,</code> <code class="p">{</code>&#13;
                <code class="nx">id</code><code class="o">:</code> <code class="nx">item</code><code class="p">.</code><code class="nx">id</code>&#13;
              <code class="p">})</code>&#13;
            <code class="p">}</code>&#13;
          <code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">FeedView</code><code class="o">&gt;</code>&#13;
              <code class="o">&lt;</code><code class="nx">Note</code> <code class="nx">note</code><code class="o">=</code><code class="p">{</code><code class="nx">item</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
            <code class="o">&lt;</code><code class="err">/FeedView&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/TouchableOpacity&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With this change, with Expo running, we will see the data from our local API displayed in a list, as shown in <a data-type="xref" href="#data_feedview">Figure 23-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="data_feedview">&#13;
<img alt="A screenshot of the API data present in the application's feed view" src="assets/jsev_2302.png"/>&#13;
<h6><span class="label">Figure 23-2. </span>Our API data displaying in our feed view</h6>&#13;
</div></figure>&#13;
&#13;
<p>Right now, tapping a note preview in the list will still display a generic note page. Let’s resolve that by making a <code>note</code> query in the <em>src/screens/note.js</em> file:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Note</code> <code class="nx">from</code> <code class="s1">'../components/Note'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// our note query, which accepts an ID variable</code>&#13;
<code class="kr">const</code> <code class="nx">GET_NOTE</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  query note($id: ID!) {</code>&#13;
<code class="sb">    note(id: $id) {</code>&#13;
<code class="sb">      id</code>&#13;
<code class="sb">      createdAt</code>&#13;
<code class="sb">      content</code>&#13;
<code class="sb">      favoriteCount</code>&#13;
<code class="sb">      author {</code>&#13;
<code class="sb">        username</code>&#13;
<code class="sb">        id</code>&#13;
<code class="sb">        avatar</code>&#13;
<code class="sb">      }</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteScreen</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">id</code> <code class="o">=</code> <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">getParam</code><code class="p">(</code><code class="s1">'id'</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">GET_NOTE</code><code class="p">,</code> <code class="p">{</code> <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code> <code class="nx">id</code> <code class="p">}</code> <code class="p">});</code>&#13;
&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if there's an error, display this message to the user</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code><code class="o">!</code> <code class="nx">Note</code> <code class="nx">not</code> <code class="nx">found</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if successful, pass the data to the note component</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Note</code> <code class="nx">note</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">note</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">NoteScreen</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, let’s update out <em>src/components/Note</em> component file to display the note contents. We’ll add two new dependencies, <code>react-native-markdown-renderer</code> and <code>date-fns</code>, to parse the Markdown and dates from our API in a more user-friendly way.</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">ScrollView</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Markdown</code> <code class="nx">from</code> <code class="s1">'react-native-markdown-renderer'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">format</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'date-fns'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">NoteView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">ScrollView</code><code class="sb">`</code>&#13;
<code class="sb">  padding: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Note</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">note</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">NoteView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code>&#13;
        <code class="nx">Note</code> <code class="nx">by</code> <code class="p">{</code><code class="nx">note</code><code class="p">.</code><code class="nx">author</code><code class="p">.</code><code class="nx">username</code><code class="p">}</code> <code class="o">/</code> <code class="nx">Published</code><code class="p">{</code><code class="s1">' '</code><code class="p">}</code>&#13;
        <code class="p">{</code><code class="nx">format</code><code class="p">(</code><code class="k">new</code> <code class="nb">Date</code><code class="p">(</code><code class="nx">note</code><code class="p">.</code><code class="nx">createdAt</code><code class="p">),</code> <code class="s1">'MMM do yyyy'</code><code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Markdown</code><code class="o">&gt;</code><code class="p">{</code><code class="nx">note</code><code class="p">.</code><code class="nx">content</code><code class="p">}</code><code class="o">&lt;</code><code class="err">/Markdown&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/NoteView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Note</code><code class="p">;</code></pre>&#13;
&#13;
<p>With these changes, we’ll see a list of notes in the application’s feed view. Tapping a note preview will take us to the full, scrollable content of the note (see <a data-type="xref" href="#api_data_nav">Figure 23-3</a>)<a data-startref="ix_ch23-asciidoc6" data-type="indexterm" id="idm45339480835032"/><a data-startref="ix_ch23-asciidoc5" data-type="indexterm" id="idm45339480834392"/>.<a data-startref="ix_ch23-asciidoc4" data-type="indexterm" id="idm45339480641448"/><a data-startref="ix_ch23-asciidoc3" data-type="indexterm" id="idm45339480640744"/></p>&#13;
&#13;
<figure><div class="figure" id="api_data_nav">&#13;
<img alt="Screenshots of the feed list and the note detail screen" src="assets/jsev_2303.png"/>&#13;
<h6><span class="label">Figure 23-3. </span>With our GraphQL queries written, we can navigate between screens to view note previews and full notes</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Adding a Loading Indicator" data-type="sect1"><div class="sect1" id="idm45339481772456">&#13;
<h1>Adding a Loading Indicator</h1>&#13;
&#13;
<p><a data-primary="loading indicator" data-type="indexterm" id="ix_ch23-asciidoc7"/><a data-primary="React Native" data-secondary="adding a loading indicator" data-type="indexterm" id="ix_ch23-asciidoc8"/>Currently when data is loading in our application, it flashes the word “Loading” on the screen. This may be effective at conveying the message, but is also a pretty jarring user experience. React Native supplies us with a built-in <code>ActivityIndicator</code>, which displays an operating system–appropriate loading spinner. Let’s write a simple component that we can use as a loading indicator across our application.</p>&#13;
&#13;
<p>Create a file at <em>src/components/Loading.js</em> and compose a simple component that displays the activity indicator in the center of the screen:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">ActivityIndicator</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">LoadingWrap</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  flex: 1;</code>&#13;
<code class="sb">  justify-content: center;</code>&#13;
<code class="sb">  align-items: center;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Loading</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">LoadingWrap</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">ActivityIndicator</code> <code class="nx">size</code><code class="o">=</code><code class="s2">"large"</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/LoadingWrap&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Loading</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we can replace the “Loading” text in our GraphQL query components. In both <em>src/screens/feed.js</em> and <em>src/screens/note.js</em>, first import the <code>Loading</code> component:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Then, in both files, update the Apollo loading state as follows:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code></pre>&#13;
&#13;
<p>With this, our application will now display a spinning activity indicator when our API data is loading (see <a data-type="xref" href="#rn_loading">Figure 23-4</a>).<a data-startref="ix_ch23-asciidoc8" data-type="indexterm" id="idm45339480539784"/><a data-startref="ix_ch23-asciidoc7" data-type="indexterm" id="idm45339480539144"/></p>&#13;
&#13;
<figure><div class="figure" id="rn_loading">&#13;
<img alt="A screenshot of the application in a loading state" src="assets/jsev_2304.png"/>&#13;
<h6><span class="label">Figure 23-4. </span>Using ActivityIndicator, we can add an operating system–appropriate loading spinner</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45339480637736">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>In this chapter we first looked at how we can integrate list views into a React Native application, making use of common application UI patterns. From there we configured Apollo Client and integrated the data from our API into the application. With this, we already have everything we need to build many common types of applications, such as a news app or integrating a blog feed from a website. In the next chapter, we’ll add authentication to our app and display user-specific queries.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>