<html><head></head><body><section data-pdf-bookmark="Chapter 15. Web Authentication and State" data-type="chapter" epub:type="chapter"><div class="chapter" id="web-authentication">&#13;
<h1><span class="label">Chapter 15. </span>Web Authentication and State</h1>&#13;
&#13;
&#13;
<p><a data-primary="web authentication and state" data-type="indexterm" id="ix_ch15-asciidoc0"/>My family and I recently moved. After filling out and signing several forms (my hand is <em>still</em> tired), we were handed the keys to the front door. Each time we come back home, we are able to use those keys to unlock the door and enter. I’m grateful that I don’t need to complete the form each time that I come home, but also appreciate having a lock so that we don’t have any unexpected guests.</p>&#13;
&#13;
<p>Client-side web authentication works in much the same way. Our users will fill out a form and will be handed a key to the website, in the form of a password alongside a token stored in their browser. When they return to the site they will either be automatically authenticated with the token, or be able to sign back in using their <span class="keep-together">password.</span></p>&#13;
&#13;
<p>In this chapter, we’ll build out a web authentication system with our GraphQL API. To do this, we’ll be building forms, storing JWTs in the browser, sending tokens with each request, and keeping track of our application’s state.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Sign-up Form" data-type="sect1"><div class="sect1" id="idm45339495547352">&#13;
<h1>Creating a Sign-up Form</h1>&#13;
&#13;
<p><a data-primary="sign-up forms" data-type="indexterm" id="ix_ch15-asciidoc1"/><a data-primary="web authentication and state" data-secondary="sign-up form creation" data-type="indexterm" id="ix_ch15-asciidoc2"/>To get started with our application’s client authentication, we can create a user sign-up React component. Before doing so, let’s map out how the component will work.</p>&#13;
&#13;
<p>First, a user will navigate to the <em>/signup</em> route within our application. On this page they will be presented with a form where they can enter their email address, desired username, and password. Submitting the form will perform our API’s <code>signUp</code> mutation. If the mutation is successful, a new user account will be created and the API will return a JWT. If there is an error, we can inform the user. We’ll be displaying a generic error message, but we could update our API to return specific error messages, such as a pre-existing username or a duplicate email address.</p>&#13;
&#13;
<p>Let’s get started by creating our new route. First, we’ll create a new React component at <em>src/pages/signup.js</em>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// include the props passed to the component for later use</code>&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign Up — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/div&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignUp</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we’ll update our route list in <em>src/pages/index.js</em> to include the <code>signup</code> route:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// import the signup route</code>&#13;
<code class="kr">import</code> <code class="nx">SignUp</code> <code class="nx">from</code> <code class="s1">'./signup'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// within the Pages component add the route</code>&#13;
<code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/signup"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">SignUp</code><code class="p">}</code> <code class="o">/&gt;</code></pre>&#13;
&#13;
<p>By adding the route, we will be able to navigate to <em>http://localhost:1234/signup</em> to see the (mostly empty) sign-up page. Now, let’s add the markup for our form:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign Up — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">form</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"username"</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"username"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"email"</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Email"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"password"</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Password"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">button</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/button&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/form&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/div&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignUp</code><code class="p">;</code></pre>&#13;
<div data-type="note" epub:type="note"><h1>htmlFor</h1>&#13;
<p><a data-primary="htmlFor" data-type="indexterm" id="idm45339495419512"/>If you’re just learning React, one of the common gotchas are JSX attributes that differ from their HTML counterparts. In this case we are using the JSX <code>htmlFor</code> in place of HTML’s <code>for</code> attribute to avoid any JavaScript collisions. You can see a full, though short, list of these attributes in the <a href="https://oreil.ly/Kn5Ke">React DOM Elements documentation</a>.</p>&#13;
</div>&#13;
&#13;
<p>Now we can add some style by importing our <code>Button</code> component and styling the form as a styled component:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'../components/Button'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Wrapper</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">div</code><code class="sb">`</code>&#13;
<code class="sb">  border: 1px solid #f5f4f0;</code>&#13;
<code class="sb">  max-width: 500px;</code>&#13;
<code class="sb">  padding: 1em;</code>&#13;
<code class="sb">  margin: 0 auto;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Form</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">form</code><code class="sb">`</code>&#13;
<code class="sb">  label,</code>&#13;
<code class="sb">  input {</code>&#13;
<code class="sb">    display: block;</code>&#13;
<code class="sb">    line-height: 2em;</code>&#13;
<code class="sb">  }</code>&#13;
&#13;
<code class="sb">  input {</code>&#13;
<code class="sb">    width: 100%;</code>&#13;
<code class="sb">    margin-bottom: 1em;</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign Up — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Wrapper</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Form</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"username"</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"username"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"email"</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Email"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"password"</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Password"</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/Button&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/Form&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Wrapper&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignUp</code><code class="p">;</code></pre>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="React Forms and State" data-type="sect2"><div class="sect2" id="idm45339495188232">&#13;
<h2>React Forms and State</h2>&#13;
&#13;
<p><a data-primary="react forms" data-type="indexterm" id="idm45339495186760"/><a data-primary="sign-up forms" data-secondary="react forms and state" data-type="indexterm" id="idm45339495186056"/><a data-primary="web authentication and state" data-secondary="react forms" data-type="indexterm" id="idm45339494980984"/>In an application, things change. Data is entered into a form, a user toggles a slider open, a message is sent. In React, we can track these changes at the component level by assigning <em>state</em>. In our form, we’ll need to track the state of each form element, so that it can be submitted.</p>&#13;
<div data-type="note" epub:type="note"><h1>React Hooks</h1>&#13;
<p>In this book we’re using functional components and React’s newer Hooks API. If you’ve used other learning resources that make use of React’s <code>class</code> components, this may look a little different. You can read more about Hooks in the <a href="https://oreil.ly/Tz9Hg">React documentation</a>.</p>&#13;
</div>&#13;
&#13;
<p>To get started with state, we’ll first update the React import at the top of our <em>src/pages/signup.js</em> file to include <code>useState</code>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code><code class="p">,</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Next, within our <code>SignUp</code> component we’ll set the default form value state:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// set the default state of the form</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">values</code><code class="p">,</code> <code class="nx">setValues</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
<code class="c1">// rest of component goes here</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Now we’ll update our component to change the state when a form field is entered and perform an operation when a user submits the form. First, we’ll create an <a data-primary="onChange function" data-type="indexterm" id="idm45339494948056"/><code>onChange</code> function, which will update our component’s state whenever the form is updated. We’ll also update the markup of each form element to call this function when a user makes a change, using the <code>onChange</code> property. Then we’ll update our <code>form</code> element to include an <code>onSubmit</code> handler. For now, we’ll simply log our form data to the console.</p>&#13;
&#13;
<p>In <em>/src/pages/sigunp.js</em>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// set the default state of the form</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">values</code><code class="p">,</code> <code class="nx">setValues</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="c1">// update the state when a user types in the form</code>&#13;
  <code class="kr">const</code> <code class="nx">onChange</code> <code class="o">=</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">setValues</code><code class="p">({</code>&#13;
      <code class="p">...</code><code class="nx">values</code><code class="p">,</code>&#13;
      <code class="p">[</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">name</code><code class="p">]</code><code class="o">:</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign Up — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Wrapper</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Form</code>&#13;
        <code class="nx">onSubmit</code><code class="o">=</code><code class="p">{</code><code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
          <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
          <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">values</code><code class="p">);</code>&#13;
        <code class="p">}}</code>&#13;
        <code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"username"</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"username"</code>&#13;
          <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"email"</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Email"</code>&#13;
          <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"password"</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Password"</code>&#13;
          <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/Button&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/Form&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Wrapper&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With this form markup in place, we’re ready to request data with a GraphQL <span class="keep-together">mutation.</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="signUp Mutation" data-type="sect2"><div class="sect2" id="idm45339495187640">&#13;
<h2>signUp Mutation</h2>&#13;
&#13;
<p><a data-primary="sign-up forms" data-secondary="signUp mutation" data-type="indexterm" id="ix_ch15-asciidoc3"/><a data-primary="signUp mutation" data-type="indexterm" id="ix_ch15-asciidoc4"/><a data-primary="web authentication and state" data-secondary="signUp mutation" data-type="indexterm" id="ix_ch15-asciidoc5"/>To sign up a user, we’ll be using our API’s <code>signUp</code> mutation. This mutation will accept an email, username, and password as variables and return a JWT if the signup is successful. Let’s write our mutation and integrate it into our sign-up form.</p>&#13;
&#13;
<p>First, we’ll need to import our Apollo libraries. We’ll be making using of the <a data-primary="useMutation" data-type="indexterm" id="idm45339494643368"/><code>useMutation</code> and <a data-primary="useApolloClient" data-type="indexterm" id="idm45339494642280"/><code>useApolloClient</code> hooks, as well as the <code>gql</code> syntax, from Apollo Client.  In <em>src/pages/signUp</em>, add the following alongside the other library import statements:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">useApolloClient</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now write the GraphQL mutation as follows:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">SIGNUP_USER</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  mutation signUp($email: String!, $username: String!, $password: String!) {</code>&#13;
<code class="sb">    signUp(email: $email, username: $username, password: $password)</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>With the mutation written, we can update our React component markup to perform the mutation when a user submits the form, passing the form elements as variables. For now, we’ll log our response (which, if successful, should be a JWT) to the console:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// useState, onChange, and useEffect all remain the same here</code>&#13;
&#13;
  <code class="c1">//add the mutation hook</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
   <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
     <code class="c1">// console.log the JSON Web Token when the mutation is complete</code>&#13;
     <code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
   <code class="p">}</code>&#13;
 <code class="p">});</code>&#13;
&#13;
  <code class="c1">// render our form</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Wrapper</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/h2&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* pass the form data to the mutation when a user submits the form */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="nx">Form</code>&#13;
        <code class="nx">onSubmit</code><code class="o">=</code><code class="p">{</code><code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
          <code class="nx">event</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
          <code class="nx">signUp</code><code class="p">({</code>&#13;
            <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code>&#13;
              <code class="p">...</code><code class="nx">values</code>&#13;
            <code class="p">}</code>&#13;
          <code class="p">});</code>&#13;
        <code class="p">}}</code>&#13;
      <code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="cm">/* ... the rest of the form remains unchanged ... */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="err">/Form&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Wrapper&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Now if you complete and submit the form, you should see a JWT logged to your console (<a data-type="xref" href="#web_signup">Figure 15-1</a>). Additionally, if you perform a <code>users</code> query in the GraphQL Playground (<em>http://localhost:4000/api</em>), you’ll see the new account (<a data-type="xref" href="#web_signup_playground">Figure 15-2</a>).</p>&#13;
&#13;
<figure><div class="figure" id="web_signup">&#13;
<img alt="A screenshot of our form and a JSON Web Token in the console" src="assets/jsev_1501.png"/>&#13;
<h6><span class="label">Figure 15-1. </span>If successful, a JSON Web Token will print to our console when we submit the form</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="web_signup_playground">&#13;
<img alt="A screenshot of the users query and results in GraphQL Playground" src="assets/jsev_1502.png"/>&#13;
<h6><span class="label">Figure 15-2. </span>We can also see a list of users by performing a users query in the GraphQL Playground</h6>&#13;
</div></figure>&#13;
&#13;
<p>With our mutation in place and returning the expected data, next we want to store the response that we receive.<a data-startref="ix_ch15-asciidoc5" data-type="indexterm" id="idm45339494374568"/><a data-startref="ix_ch15-asciidoc4" data-type="indexterm" id="idm45339494373864"/><a data-startref="ix_ch15-asciidoc3" data-type="indexterm" id="idm45339494373192"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="JSON Web Tokens and Local Storage" data-type="sect2"><div class="sect2" id="idm45339494907112">&#13;
<h2>JSON Web Tokens and Local Storage</h2>&#13;
&#13;
<p><a data-primary="JSON Web Tokens (JWT)" data-type="indexterm" id="idm45339494371144"/><a data-primary="localStorage" data-type="indexterm" id="idm45339494370216"/><a data-primary="sign-up forms" data-secondary="JSON Web Token and local storage" data-type="indexterm" id="idm45339494369544"/><a data-primary="web authentication and state" data-secondary="JSON Web Token and local storage" data-type="indexterm" id="idm45339494368632"/>When our <code>signUp</code> mutation is successful, it returns a JSON Web Token (JWT). You may recall from the API portion of the book that a <a href="https://jwt.io">JWT</a> allows us to securely store a user’s ID on the user’s device. To achieve this in our user’s web browser, we’ll store the token in the browser’s <code>localStorage</code>. <code>localStorage</code> is a simple key-value store that persists across browser sessions until the storage is updated or cleared. Let’s update our mutation to store the token in <code>localStorage</code>.</p>&#13;
&#13;
<p>In <em>src/pages/signup.js</em>, update the <code>useMutation</code> hook to store the token in <code>local</code><span class="keep-together"><code>Storage</code></span> (see <a data-type="xref" href="#web_token_storage">Figure 15-3</a>):</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
  <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// store the JWT in localStorage</code>&#13;
    <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<figure><div class="figure" id="web_token_storage">&#13;
<img alt="A screenshot of our token in the browser's localStorage" src="assets/jsev_1503.png"/>&#13;
<h6><span class="label">Figure 15-3. </span>Our web token is now stored in the browser’s localStorage</h6>&#13;
</div></figure>&#13;
<div data-type="warning" epub:type="warning"><h1>JWTs and Security</h1>&#13;
<p><a data-primary="security, local storage and" data-type="indexterm" id="idm45339494260712"/>When a token is stored in <code>localStorage</code>, any JavaScript that can be run on the page has access to the token, making it susceptible to cross-site scripting (XSS) attacks. For this reason, when using <code>localStorage</code> to store token credentials, you need to take extra care to limit (or avoid) CDN hosted scripts. If a third-party script is compromised, it would have access to the JWT.</p>&#13;
</div>&#13;
&#13;
<p>With our JWT stored locally, we’re prepared to use it in our GraphQL mutations and queries.<a data-startref="ix_ch15-asciidoc2" data-type="indexterm" id="idm45339494258088"/><a data-startref="ix_ch15-asciidoc1" data-type="indexterm" id="idm45339494333672"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Redirects" data-type="sect1"><div class="sect1" id="idm45339495546728">&#13;
<h1>Redirects</h1>&#13;
&#13;
<p><a data-primary="redirects" data-type="indexterm" id="idm45339494331592"/><a data-primary="web authentication and state" data-secondary="redirects" data-type="indexterm" id="idm45339494330888"/>Currently when a user completes the sign-up form, the form re-renders as an empty form. This doesn’t leave the user with much of a visual cue that their account registration was successful. Instead, let’s redirect the user to the home page of our application. Another option would be to create a “Success” page that thanks the user for registering and onboards them to the application.</p>&#13;
&#13;
<p>As you may recall from earlier in the chapter, we’re passing the properties into the component. We can redirect a route using React Router’s <code>history</code>, which will be available to us through <code>props.history.push</code>. To implement this, we’ll update our mutation’s <code>onCompleted</code> event to include a redirect like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="c1">// store the token</code>&#13;
      <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
      <code class="c1">// redirect the user to the homepage</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s1">'/'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code></pre>&#13;
&#13;
<p>With this change, users will now be redirected to our application’s home page after registering for an account.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Attaching Headers to Requests" data-type="sect1"><div class="sect1" id="idm45339494332696">&#13;
<h1>Attaching Headers to Requests</h1>&#13;
&#13;
<p><a data-primary="attaching headers to requests" data-type="indexterm" id="idm45339494220280"/><a data-primary="web authentication and state" data-secondary="attaching headers to requests" data-type="indexterm" id="idm45339494219608"/>Though we are storing our token in <code>localStorage</code>, our API does not yet have access to it. This means that even if a user has created an account, the API has no way of identifying the user. If you recall from our API development, each API call receives a token in the header of the request. We’ll modify our client to send the JWT as a header with each request.</p>&#13;
&#13;
<p>In <em>src/App.js</em> we’ll update our dependencies to include <code>createHttpLink</code> from Apollo Client as well as <code>setContext</code> from Apollo’s Link Context package. We’ll then update Apollo’s configuration to send the token in the header of each request:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// import the Apollo dependencies</code>&#13;
<code class="kr">import</code> <code class="p">{</code>&#13;
  <code class="nx">ApolloClient</code><code class="p">,</code>&#13;
  <code class="nx">ApolloProvider</code><code class="p">,</code>&#13;
  <code class="nx">createHttpLink</code><code class="p">,</code>&#13;
  <code class="nx">InMemoryCache</code>&#13;
<code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">setContext</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'apollo-link-context'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// configure our API URI &amp; cache</code>&#13;
<code class="kr">const</code> <code class="nx">uri</code> <code class="o">=</code> <code class="nx">process</code><code class="p">.</code><code class="nx">env</code><code class="p">.</code><code class="nx">API_URI</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">httpLink</code> <code class="o">=</code> <code class="nx">createHttpLink</code><code class="p">({</code> <code class="nx">uri</code> <code class="p">});</code>&#13;
<code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">InMemoryCache</code><code class="p">();</code>&#13;
&#13;
<code class="c1">// check for a token and return the headers to the context</code>&#13;
<code class="kr">const</code> <code class="nx">authLink</code> <code class="o">=</code> <code class="nx">setContext</code><code class="p">((</code><code class="nx">_</code><code class="p">,</code> <code class="p">{</code> <code class="nx">headers</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="p">...</code><code class="nx">headers</code><code class="p">,</code>&#13;
      <code class="nx">authorization</code><code class="o">:</code> <code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">)</code> <code class="o">||</code> <code class="s1">''</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">};</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// create the Apollo client</code>&#13;
<code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ApolloClient</code><code class="p">({</code>&#13;
  <code class="nx">link</code><code class="o">:</code> <code class="nx">authLink</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="nx">httpLink</code><code class="p">),</code>&#13;
  <code class="nx">cache</code><code class="p">,</code>&#13;
  <code class="nx">resolvers</code><code class="o">:</code> <code class="p">{},</code>&#13;
  <code class="nx">connectToDevTools</code><code class="o">:</code> <code class="kc">true</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>With this change, we’ll now be able to pass the information of the logged-in user to our API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Local State Management" data-type="sect1"><div class="sect1" id="idm45339494213336">&#13;
<h1>Local State Management</h1>&#13;
&#13;
<p><a data-primary="local state management" data-type="indexterm" id="ix_ch15-asciidoc6"/><a data-primary="web authentication and state" data-secondary="local state management" data-type="indexterm" id="ix_ch15-asciidoc7"/>We’ve looked at managing state within a component, but what about across our application? There are times where it’s useful to have some information shared among many components. We could pass <code>props</code> from a base component across our application, but as soon as we get past a couple of levels of subcomponents, this can get messy. Libraries such as <a href="https://redux.js.org">Redux</a> and <a href="https://mobx.js.org">MobX</a> have sought to solve the challenges of state management and have proven useful for many developers and teams. In our case, we’re already making use of the Apollo Client library, which includes the ability to use GraphQL queries for local state management. Rather than introducing another dependency, let’s implement a local state property that will store whether the user is logged in.</p>&#13;
&#13;
<p>The Apollo React library puts the <code>ApolloClient</code> instance within React’s context, but at times we may need to access it directly. We can do so with the <a data-primary="useApolloClient" data-type="indexterm" id="idm45339494046488"/><code>useApolloClient</code> hook, which will allow us to perform actions such as directly updating or resetting the cache store or writing local data.</p>&#13;
&#13;
<p>Currently, we have two ways to determine if a user is logged in to our application. First, we know they are a current user if they’ve successfully submitted the sign-up form. Second, we know that if a visitor accesses the site with a token stored in <code>localStorage</code>, then they are already logged in. Let’s begin by adding to our state when a user completes the sign-up form. To achieve this, we’ll write directly to our Apollo Client’s local store, using <code>client.writeData</code> and the <code>useApolloClient</code> hook.</p>&#13;
&#13;
<p>In <em>src/pages/signup.js</em> we first need to update the <code>@apollo/client</code> library import to include <code>useApolloClient</code>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">useApolloClient</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code></pre>&#13;
&#13;
<p>In <em>src/pages/signup.js</em> we’ll call the <code>useApolloClient</code> function and update the mutation to add to the local store, using <code>writeData</code>, when it is complete:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// Apollo Client</code>&#13;
<code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="nx">useApolloClient</code><code class="p">();</code>&#13;
<code class="c1">// Mutation Hook</code>&#13;
<code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
  <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// store the token</code>&#13;
    <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
    <code class="c1">// update the local cache</code>&#13;
    <code class="nx">client</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code><code class="o">:</code> <code class="p">{</code> <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">});</code>&#13;
    <code class="c1">// redirect the user to the homepage</code>&#13;
    <code class="nx">props</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s1">'/'</code><code class="p">);</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Now, let’s update our application to check for a pre-existing token when the page loads and update the state when a token is found. In <code>src/App.js</code>, first update the  <code>ApolloClient</code> configuration to an empty <code>resolvers</code> object. This will allow us to perform GraphQL queries on our local cache.</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// create the Apollo client</code>&#13;
<code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ApolloClient</code><code class="p">({</code>&#13;
  <code class="nx">link</code><code class="o">:</code> <code class="nx">authLink</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="nx">httpLink</code><code class="p">),</code>&#13;
  <code class="nx">cache</code><code class="p">,</code>&#13;
  <code class="nx">resolvers</code><code class="o">:</code> <code class="p">{},</code>&#13;
  <code class="nx">connectToDevTools</code><code class="o">:</code> <code class="kc">true</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>Next, we can perform the check on the initial page load of our application:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// check for a local token</code>&#13;
<code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="o">!!</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">)</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// write the cache data on initial load</code>&#13;
<code class="nx">cache</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code> <code class="p">});</code></pre>&#13;
&#13;
<p>Here comes the cool part: we can now access <code>isLoggedIn</code> as a GraphQL query anywhere within our application by using the <code>@client</code> directive. To demonstrate this, let’s update the header of our application to display a “Sign Up” and “Sign In” link if <code>isLoggedIn</code> is <code>false</code> and a “Log Out” link if <code>isLoggedIn</code> is <code>true</code>.</p>&#13;
&#13;
<p>In <em>src/components/Header.js</em>, import the necessary dependencies and write the query like so:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// new dependencies</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Link</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-router-dom'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// local query</code>&#13;
<code class="kr">const</code> <code class="nx">IS_LOGGED_IN</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  {</code>&#13;
<code class="sb">    isLoggedIn @client</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now, within our React component we can include a simple query to retrieve the state along with a tertiary operator that displays options either to log out or sign in:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">UserState</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">div</code><code class="sb">`</code>&#13;
<code class="sb">  margin-left: auto;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Header</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// query hook for user logged in state</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">IS_LOGGED_IN</code><code class="p">);</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">HeaderBar</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Notedly Logo"</code> <code class="nx">height</code><code class="o">=</code><code class="s2">"40"</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">LogoText</code><code class="o">&gt;</code><code class="nx">Notedly</code><code class="o">&lt;</code><code class="err">/LogoText&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* If logged in display a logout link, else display sign-in options */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserState</code><code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">isLoggedIn</code> <code class="o">?</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Log</code> <code class="nx">Out</code><code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
        <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signin'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">In</code><code class="o">&lt;</code><code class="err">/Link&gt; or{' '}</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signup'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="err">/UserState&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/HeaderBar&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With this, when a user is logged in they’ll see a “Log Out” option: otherwise, they’ll be presented with options to sign up or in, all thanks to local state. We’re not limited to simple boolean logic, either. Apollo enables us to write local resolvers and type definitions, allowing us to take advantage of everything GraphQL has to offer within our local state.<a data-startref="ix_ch15-asciidoc7" data-type="indexterm" id="idm45339493748424"/><a data-startref="ix_ch15-asciidoc6" data-type="indexterm" id="idm45339493579448"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Logging Out" data-type="sect1"><div class="sect1" id="idm45339494212744">&#13;
<h1>Logging Out</h1>&#13;
&#13;
<p><a data-primary="logging out" data-type="indexterm" id="ix_ch15-asciidoc8"/><a data-primary="web authentication and state" data-secondary="logging out" data-type="indexterm" id="ix_ch15-asciidoc9"/>Currently once a user is signed in, they have no way to log out of our application. Let’s turn the “Log Out” language in our header into a button that, when clicked, will log out the user. To do this, when the button is clicked we will remove the token that has been stored in <code>localStorage</code>. We’ll use a <code>&lt;button&gt;</code> element for its built-in accessibility, as it both serves as a semantic representation of a user action and receives focus, like a link, when a user is navigating the application with their keyboard.</p>&#13;
&#13;
<p>Before writing our code, let’s write a styled component that will render a button like a link. Create a new file at <em>src/Components/ButtonAsLink.js</em> and add the following:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">ButtonAsLink</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">button</code><code class="sb">`</code>&#13;
<code class="sb">  background: none;</code>&#13;
<code class="sb">  color: #0077cc;</code>&#13;
<code class="sb">  border: none;</code>&#13;
<code class="sb">  padding: 0;</code>&#13;
<code class="sb">  font: inherit;</code>&#13;
<code class="sb">  text-decoration: underline;</code>&#13;
<code class="sb">  cursor: pointer;</code>&#13;
&#13;
<code class="sb">  :hover,</code>&#13;
<code class="sb">  :active {</code>&#13;
<code class="sb">    color: #004499;</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">ButtonAsLink</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now in <em>src/components/Header.js</em> we can implement our logout functionality. We need to use React Router’s <code>withRouter</code> higher-order component to handle the redirect since our <em>Header.js</em> file is a UI component and not a defined route. Let’s begin by importing the <code>ButtonAsLink</code> component as well as <code>withRouter</code>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// import both Link and withRouter from React Router</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Link</code><code class="p">,</code> <code class="nx">withRouter</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-router-dom'</code><code class="p">;</code>&#13;
<code class="c1">// import the ButtonAsLink component</code>&#13;
<code class="kr">import</code> <code class="nx">ButtonAsLink</code> <code class="nx">from</code> <code class="s1">'./ButtonAsLink'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now, within our JSX we’ll update our component to include the <code>props</code> parameter and update the logout markup to be a button:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">Header</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// query hook for user logged-in state,</code>&#13;
  <code class="c1">// including the client for referencing the Apollo store</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">data</code><code class="p">,</code> <code class="nx">client</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">IS_LOGGED_IN</code><code class="p">);</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">HeaderBar</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Notedly Logo"</code> <code class="nx">height</code><code class="o">=</code><code class="s2">"40"</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">LogoText</code><code class="o">&gt;</code><code class="nx">Notedly</code><code class="o">&lt;</code><code class="err">/LogoText&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* If logged in display a logout link, else display sign-in options */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserState</code><code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">isLoggedIn</code> <code class="o">?</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">ButtonAsLink</code><code class="o">&gt;</code>&#13;
            <code class="nx">Logout</code>&#13;
          <code class="o">&lt;</code><code class="err">/ButtonAsLink&gt;</code>&#13;
        <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signin'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">In</code><code class="o">&lt;</code><code class="err">/Link&gt; or{' '}</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signup'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="err">/UserState&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/HeaderBar&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// we wrap our component in the withRouter higher-order component</code>&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">withRouter</code><code class="p">(</code><code class="nx">Header</code><code class="p">);</code></pre>&#13;
<div data-type="note" epub:type="note"><h1>withRouter</h1>&#13;
<p><a data-primary="withRouter" data-type="indexterm" id="idm45339493533096"/>When we want to include routing in a component that is not itself directly routable, we need to use React Router’s <code>withRouter</code> higher-order component.</p>&#13;
</div>&#13;
&#13;
<p>When a user logs out of our application, we want to reset the cache store to prevent any unwanted data from appearing outside of the session. Apollo offers the ability to call the <a data-primary="resetStore function" data-type="indexterm" id="idm45339493306472"/><code>resetStore</code> function, which will fully clear the cache. Let’s add an <code>onClick</code> handler to our component’s button to remove the user’s token, reset the Apollo Store, update the local state, and redirect the user to the home page. To accomplish this, we’ll update our <code>useQuery</code> hook to include a reference to the client and wrap our component in the <code>withRouter</code> higher-order component in our <code>export</code> statement.</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">Header</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// query hook for user logged in state</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">data</code><code class="p">,</code> <code class="nx">client</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">IS_LOGGED_IN</code><code class="p">);</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">HeaderBar</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">img</code> <code class="nx">src</code><code class="o">=</code><code class="p">{</code><code class="nx">logo</code><code class="p">}</code> <code class="nx">alt</code><code class="o">=</code><code class="s2">"Notedly Logo"</code> <code class="nx">height</code><code class="o">=</code><code class="s2">"40"</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">LogoText</code><code class="o">&gt;</code><code class="nx">Notedly</code><code class="o">&lt;</code><code class="err">/LogoText&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* If logged in display a logout link, else display sign-in options */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserState</code><code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">isLoggedIn</code> <code class="o">?</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">ButtonAsLink</code>&#13;
            <code class="nx">onClick</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
              <code class="c1">// remove the token</code>&#13;
              <code class="nx">localStorage</code><code class="p">.</code><code class="nx">removeItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">);</code>&#13;
              <code class="c1">// clear the application's cache</code>&#13;
              <code class="nx">client</code><code class="p">.</code><code class="nx">resetStore</code><code class="p">();</code>&#13;
              <code class="c1">// update local state</code>&#13;
              <code class="nx">client</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code><code class="o">:</code> <code class="p">{</code> <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="kc">false</code> <code class="p">}</code> <code class="p">});</code>&#13;
              <code class="c1">// redirect the user to the home page</code>&#13;
              <code class="nx">props</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s1">'/'</code><code class="p">);</code>&#13;
            <code class="p">}}</code>&#13;
          <code class="o">&gt;</code>&#13;
            <code class="nx">Logout</code>&#13;
          <code class="o">&lt;</code><code class="err">/ButtonAsLink&gt;</code>&#13;
        <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signin'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">In</code><code class="o">&lt;</code><code class="err">/Link&gt; or{' '}</code>&#13;
            <code class="o">&lt;</code><code class="nx">Link</code> <code class="nx">to</code><code class="o">=</code><code class="p">{</code><code class="s1">'/signup'</code><code class="p">}</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
        <code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="err">/UserState&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/HeaderBar&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">withRouter</code><code class="p">(</code><code class="nx">Header</code><code class="p">);</code></pre>&#13;
&#13;
<p>Finally, we will need Apollo to add the user state back to our cached state when the store is reset. In <em>src/App.js</em> update the cache settings to include <code>onResetStore</code>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// check for a local token</code>&#13;
<code class="kr">const</code> <code class="nx">data</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="o">!!</code><code class="nx">localStorage</code><code class="p">.</code><code class="nx">getItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">)</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="c1">// write the cache data on initial load</code>&#13;
<code class="nx">cache</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code> <code class="p">});</code>&#13;
<code class="c1">// write the cache data after cache is reset</code>&#13;
<code class="nx">client</code><code class="p">.</code><code class="nx">onResetStore</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="nx">cache</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code> <code class="p">}));</code></pre>&#13;
&#13;
<p>With this, logged-in users are able to easily log out of our application. We’ve integrated this functionality directly into our <code>Header</code> component, but in the future we could refactor it into a standalone component.<a data-startref="ix_ch15-asciidoc9" data-type="indexterm" id="idm45339493059800"/><a data-startref="ix_ch15-asciidoc8" data-type="indexterm" id="idm45339493059192"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Sign-In Form" data-type="sect1"><div class="sect1" id="idm45339493578248">&#13;
<h1>Creating a Sign-In Form</h1>&#13;
&#13;
<p><a data-primary="sign-in forms" data-type="indexterm" id="ix_ch15-asciidoc10"/><a data-primary="web authentication and state" data-secondary="sign-in form creation" data-type="indexterm" id="ix_ch15-asciidoc11"/>Currently our users are able to sign up and log out of our application, but they have no way to sign back in. Let’s create a sign-in form and do a bit of refactoring along the way so that we can reuse much of the code found in our signup component.</p>&#13;
&#13;
<p>Our first step will be to create a new page component that will live at <em>/signin</em>. In a new file at <em>src/pages/signin.js</em>, add the following:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign In — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">div</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">up</code> <code class="nx">page</code><code class="o">&lt;</code><code class="err">/p&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/div&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignIn</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we can make our page routable, so that users can navigate to it. In <em>src/pages/index.js</em> import the route page and add a new route path:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// import the sign-in page component</code>&#13;
<code class="kr">import</code> <code class="nx">SignIn</code> <code class="nx">from</code> <code class="s1">'./signin'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Pages</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Router</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Layout</code><code class="o">&gt;</code>&#13;
        <code class="c1">// ... our other routes</code>&#13;
        <code class="c1">// add a signin route to our routes list</code>&#13;
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/signin"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">SignIn</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/Layout&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Router&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Let’s pause here, before we implement our sign-in form, to consider our options. We could reimplement a form, much like we wrote for our Sign Up page, but that feels tedious and would require us to maintain two similar forms. When one changes, we would need to be sure to update the other. Another option is to isolate the form into its own component, which would allow us to reuse common code and make updates in a single location. Let’s go forward with the shared form component approach.</p>&#13;
&#13;
<p>We’ll first create a new component at <em>src/components/UserForm.js</em>, bringing over our <code>&lt;form&gt;</code> markup and styles. We will be making a few minor, but notable, changes to this form to use the properties that it receives from the parent component. First, we’ll rename our <code>onSubmit</code> mutation to <code>props.action</code>, which will allow us to pass the mutation to our form through the component’s properties. Second, we’ll add some conditional statements where we know that our two forms will differ. We’ll make use of a second property named <code>formType</code>, which we’ll pass a string. We can change our template’s rendering based on the value of the string.</p>&#13;
&#13;
<p>We’ll write these either as an inline <code>if</code> statement with a logical <code>&amp;&amp;</code> operator or as a conditional ternary operator:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Button</code> <code class="nx">from</code> <code class="s1">'./Button'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Wrapper</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">div</code><code class="sb">`</code>&#13;
<code class="sb">  border: 1px solid #f5f4f0;</code>&#13;
<code class="sb">  max-width: 500px;</code>&#13;
<code class="sb">  padding: 1em;</code>&#13;
<code class="sb">  margin: 0 auto;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Form</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">form</code><code class="sb">`</code>&#13;
<code class="sb">  label,</code>&#13;
<code class="sb">  input {</code>&#13;
<code class="sb">    display: block;</code>&#13;
<code class="sb">    line-height: 2em;</code>&#13;
<code class="sb">  }</code>&#13;
&#13;
<code class="sb">  input {</code>&#13;
<code class="sb">    width: 100%;</code>&#13;
<code class="sb">    margin-bottom: 1em;</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// set the default state of the form</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">values</code><code class="p">,</code> <code class="nx">setValues</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="c1">// update the state when a user types in the form</code>&#13;
  <code class="kr">const</code> <code class="nx">onChange</code> <code class="o">=</code> <code class="nx">event</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">setValues</code><code class="p">({</code>&#13;
      <code class="p">...</code><code class="nx">values</code><code class="p">,</code>&#13;
      <code class="p">[</code><code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">name</code><code class="p">]</code><code class="o">:</code> <code class="nx">event</code><code class="p">.</code><code class="nx">target</code><code class="p">.</code><code class="nx">value</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Wrapper</code><code class="o">&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* Display the appropriate form header */</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">===</code> <code class="s1">'signup'</code> <code class="o">?</code> <code class="o">&lt;</code><code class="nx">h2</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">Up</code><code class="o">&lt;</code><code class="err">/h2&gt; : &lt;h2&gt;Sign In&lt;/h2&gt;}</code>&#13;
      <code class="p">{</code><code class="cm">/* perform the mutation when a user submits the form */</code><code class="p">}</code>&#13;
      <code class="o">&lt;</code><code class="nx">Form</code>&#13;
        <code class="nx">onSubmit</code><code class="o">=</code><code class="p">{</code><code class="nx">e</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
          <code class="nx">e</code><code class="p">.</code><code class="nx">preventDefault</code><code class="p">();</code>&#13;
          <code class="nx">props</code><code class="p">.</code><code class="nx">action</code><code class="p">({</code>&#13;
            <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code>&#13;
              <code class="p">...</code><code class="nx">values</code>&#13;
            <code class="p">}</code>&#13;
          <code class="p">});</code>&#13;
        <code class="p">}}</code>&#13;
      <code class="o">&gt;</code>&#13;
        <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">===</code> <code class="s1">'signup'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">Fragment</code><code class="o">&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"username"</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
            <code class="o">&lt;</code><code class="nx">input</code>&#13;
              <code class="nx">required</code>&#13;
              <code class="nx">type</code><code class="o">=</code><code class="s2">"text"</code>&#13;
              <code class="nx">id</code><code class="o">=</code><code class="s2">"username"</code>&#13;
              <code class="nx">name</code><code class="o">=</code><code class="s2">"username"</code>&#13;
              <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"username"</code>&#13;
              <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
            <code class="o">/&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/React.Fragment&gt;</code>&#13;
        <code class="p">)}</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"email"</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"email"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Email"</code>&#13;
          <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">label</code> <code class="nx">htmlFor</code><code class="o">=</code><code class="s2">"password"</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">:&lt;</code><code class="err">/label&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">input</code>&#13;
          <code class="nx">required</code>&#13;
          <code class="nx">type</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">id</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">name</code><code class="o">=</code><code class="s2">"password"</code>&#13;
          <code class="nx">placeholder</code><code class="o">=</code><code class="s2">"Password"</code>&#13;
          <code class="nx">onChange</code><code class="o">=</code><code class="p">{</code><code class="nx">onChange</code><code class="p">}</code>&#13;
        <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">type</code><code class="o">=</code><code class="s2">"submit"</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/Button&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/Form&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Wrapper&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">UserForm</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we can simplify our <em>src/pages/signup.js</em> component to make use of the shared form component:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">useApolloClient</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">UserForm</code> <code class="nx">from</code> <code class="s1">'../components/UserForm'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SIGNUP_USER</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  mutation signUp($email: String!, $username: String!, $password: String!) {</code>&#13;
<code class="sb">    signUp(email: $email, username: $username, password: $password)</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign Up — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="nx">useApolloClient</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="c1">// store the token</code>&#13;
      <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
      <code class="c1">// update the local cache</code>&#13;
      <code class="nx">client</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code><code class="o">:</code> <code class="p">{</code> <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">});</code>&#13;
      <code class="c1">// redirect the user to the homepage</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s1">'/'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">Fragment</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserForm</code> <code class="nx">action</code><code class="o">=</code><code class="p">{</code><code class="nx">signUp</code><code class="p">}</code> <code class="nx">formType</code><code class="o">=</code><code class="s2">"signup"</code> <code class="o">/&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* if the data is loading, display a loading message*/</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">loading</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/p&gt;}</code>&#13;
      <code class="p">{</code><code class="cm">/* if there is an error, display a error message*/</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">error</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">creating</code> <code class="nx">an</code> <code class="nx">account</code><code class="o">!&lt;</code><code class="err">/p&gt;}</code>&#13;
    <code class="o">&lt;</code><code class="err">/React.Fragment&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignUp</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, we can write our <code>SignIn</code> component, making use of our <code>signIn</code> mutation and <code>UserForm</code> component. In <em>src/pages/signin.js</em>:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">useApolloClient</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">UserForm</code> <code class="nx">from</code> <code class="s1">'../components/UserForm'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SIGNIN_USER</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  mutation signIn($email: String, $password: String!) {</code>&#13;
<code class="sb">    signIn(email: $email, password: $password)</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// update the document title</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">title</code> <code class="o">=</code> <code class="s1">'Sign In — Notedly'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="nx">useApolloClient</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">signIn</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNIN_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="c1">// store the token</code>&#13;
      <code class="nx">localStorage</code><code class="p">.</code><code class="nx">setItem</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">data</code><code class="p">.</code><code class="nx">signIn</code><code class="p">);</code>&#13;
      <code class="c1">// update the local cache</code>&#13;
      <code class="nx">client</code><code class="p">.</code><code class="nx">writeData</code><code class="p">({</code> <code class="nx">data</code><code class="o">:</code> <code class="p">{</code> <code class="nx">isLoggedIn</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">});</code>&#13;
      <code class="c1">// redirect the user to the homepage</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">history</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="s1">'/'</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">Fragment</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserForm</code> <code class="nx">action</code><code class="o">=</code><code class="p">{</code><code class="nx">signIn</code><code class="p">}</code> <code class="nx">formType</code><code class="o">=</code><code class="s2">"signIn"</code> <code class="o">/&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* if the data is loading, display a loading message*/</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">loading</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/p&gt;}</code>&#13;
      <code class="p">{</code><code class="cm">/* if there is an error, display a error message*/</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">error</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">signing</code> <code class="k">in</code><code class="o">!&lt;</code><code class="err">/p&gt;}</code>&#13;
    <code class="o">&lt;</code><code class="err">/React.Fragment&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignIn</code><code class="p">;</code></pre>&#13;
&#13;
<p>With this, we now have a manageable form component and have enabled users to both sign up and sign in to our application.<a data-startref="ix_ch15-asciidoc11" data-type="indexterm" id="idm45339492423000"/><a data-startref="ix_ch15-asciidoc10" data-type="indexterm" id="idm45339492422392"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Protected Routes" data-type="sect1"><div class="sect1" id="idm45339493057960">&#13;
<h1>Protected Routes</h1>&#13;
&#13;
<p><a data-primary="protected routes" data-type="indexterm" id="idm45339492017112"/><a data-primary="web authentication and state" data-secondary="protected routes" data-type="indexterm" id="idm45339492016408"/>A common application pattern is to limit access to specific pages or portions of the site to authenticated users. In our case, nonauthenticated users would have no use for the My Notes or Favorites pages. We can implement this pattern in our router, automatically routing unauthenticated users to the application’s Sign In page when they attempt to visit those routes.</p>&#13;
&#13;
<p>In <em>src/pages/index.js</em> we’ll start by importing the necessary dependencies and adding our <code>isLoggedIn</code> query:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">IS_LOGGED_IN</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  {</code>&#13;
<code class="sb">    isLoggedIn @client</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we’ll import React Router’s <code>Redirect</code> library and write a <code>PrivateRoute</code> component, which will redirect the user if they are not logged in:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="c1">// update our react-router import to include Redirect</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">BrowserRouter</code> <code class="nx">as</code> <code class="nx">Router</code><code class="p">,</code> <code class="nx">Route</code><code class="p">,</code> <code class="nx">Redirect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-router-dom'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// add the PrivateRoute component below our `Pages` component</code>&#13;
<code class="kr">const</code> <code class="nx">PrivateRoute</code> <code class="o">=</code> <code class="p">({</code> <code class="nx">component</code><code class="o">:</code> <code class="nx">Component</code><code class="p">,</code> <code class="p">...</code><code class="nx">rest</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">IS_LOGGED_IN</code><code class="p">);</code>&#13;
  <code class="c1">// if the data is loading, display a loading message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nx">Loading</code><code class="p">...</code><code class="o">&lt;</code><code class="err">/p&gt;;</code>&#13;
  <code class="c1">// if there is an error fetching the data, display an error message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">p</code><code class="o">&gt;</code><code class="nb">Error</code><code class="o">!&lt;</code><code class="err">/p&gt;;</code>&#13;
  <code class="c1">// if the user is logged in, route them to the requested component</code>&#13;
  <code class="c1">// else redirect them to the sign-in page</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Route</code>&#13;
      <code class="p">{...</code><code class="nx">rest</code><code class="p">}</code>&#13;
      <code class="nx">render</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code> <code class="o">=&gt;</code>&#13;
        <code class="nx">data</code><code class="p">.</code><code class="nx">isLoggedIn</code> <code class="o">===</code> <code class="kc">true</code> <code class="o">?</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">Component</code> <code class="p">{...</code><code class="nx">props</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="p">)</code> <code class="o">:</code> <code class="p">(</code>&#13;
          <code class="o">&lt;</code><code class="nx">Redirect</code>&#13;
            <code class="nx">to</code><code class="o">=</code><code class="p">{{</code>&#13;
              <code class="nx">pathname</code><code class="o">:</code> <code class="s1">'/signin'</code><code class="p">,</code>&#13;
              <code class="nx">state</code><code class="o">:</code> <code class="p">{</code> <code class="nx">from</code><code class="o">:</code> <code class="nx">props</code><code class="p">.</code><code class="nx">location</code> <code class="p">}</code>&#13;
            <code class="p">}}</code>&#13;
          <code class="o">/&gt;</code>&#13;
        <code class="p">)</code>&#13;
      <code class="p">}</code>&#13;
    <code class="o">/&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Pages</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, we can update any of our routes intended for logged-in users to use the <span class="keep-together"><code>Private</code></span><code>Route</code> component:</p>&#13;
&#13;
<pre data-code-language="js" data-type="programlisting"><code class="kr">const</code> <code class="nx">Pages</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">Router</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Layout</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">exact</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Home</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">PrivateRoute</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/mynotes"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">MyNotes</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">PrivateRoute</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/favorites"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Favorites</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/note/:id"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">Note</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/signup"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">SignUp</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">Route</code> <code class="nx">path</code><code class="o">=</code><code class="s2">"/signin"</code> <code class="nx">component</code><code class="o">=</code><code class="p">{</code><code class="nx">SignIn</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/Layout&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Router&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
<div data-type="note" epub:type="note"><h1>Redirect State</h1>&#13;
<p>When we redirect a private route, we are also storing the referring URL as state. This allows us to redirect users back to the page they were originally attempting to navigate to. We could update our redirect on the Sign In page to optionally use <span class="keep-together"><code>props.state.</code></span>​<span class="keep-together"><code>location.from</code></span> to enable this feature.</p>&#13;
</div>&#13;
&#13;
<p>Now when a user attempts to navigate to a page intended for logged-in users, they will be redirected to our Sign In page.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45339492421160">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>In this chapter we’ve covered two critical concepts for building client-side JavaScript applications: authentication and state. By building a full authentication flow, you’ve gained insight into how user accounts work with a client application. From here, I would encourage you to explore alternate options such as OAuth and authentication services such as Auth0, Okta, and Firebase. Additionally, you’ve learned to manage state in an application, both at the component level, using the React Hooks API, as well as across the application, using Apollo’s local state. With these key concepts behind you, you can now build robust user interface applications.<a data-startref="ix_ch15-asciidoc0" data-type="indexterm" id="idm45339491771768"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>