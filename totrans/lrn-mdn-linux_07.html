<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 7. Networking"><div class="chapter" id="networking">
<h1><span class="label">Chapter 7. </span>Networking</h1>


<p><a data-type="indexterm" data-primary="networking" id="ix_ch07-asciidoc0"/>In this chapter, we go into detail about Linux networking. In modern environments,
the network stack that Linux provides is an essential component. Without it,
few things are possible. Whether you want to access an instance in your
cloud provider, browse the web, or install a new app, you need connectivity,
and you need a way to interact with it.</p>

<p>We’ll first have a look at common network terms, from the hardware level
all the way up to user-facing components such as HTTP and SSH. We’ll also
discuss the network stack, protocols, and interfaces. Specifically,
we’ll spend time on the naming center piece of the web and the wider internet,
the so-called Domain Name System (DNS). Interestingly, this system is found
not only in wide-area deployments but is also a central component used for
service discovery in container environments such as Kubernetes.</p>

<p>Next, we’ll look at application layer network protocols and tooling.
This includes file sharing, the web, networked filesystems,
and other methods to share data over the network.</p>

<p>In the last part of the chapter, we’ll review some advanced network topics,
from geomapping to managing time over the network.</p>

<p>To set the expectations for the content in this chapter: you can spend a lot
of time with the topic of Linux networking; in fact, entire books are dedicated
to the topic. We’ll take a pragmatic stance here, jumping into hands-on
topics from an end-user point of view. Admin topics around networking, such as
configuration and setup of network devices, are by and large out of scope here.</p>

<p>Now, let’s turn our attention to the networking basics.</p>






<section data-type="sect1" data-pdf-bookmark="Basics"><div class="sect1" id="net-basics">
<h1>Basics</h1>

<p><a data-type="indexterm" data-primary="networking" data-secondary="basics" id="idm45805432015408"/>Let’s first discuss why networking is relevant for a number of use cases and define some common network
terminology.</p>

<p>In modern environments, networking plays a central role. This ranges from
tasks such as installing apps, browsing the web,
and viewing mail or social media to working with remote machines (from the embedded
system you’re connecting to over a local network to servers that run in
data centers of your cloud providers). Given a network’s many moving parts and layers,
it can be difficult to figure out if a problem is hardware-related or
originates in the software stack.</p>

<p><a data-type="indexterm" data-primary="network interfaces" id="idm45805432013504"/>Another challenge Linux networking addresses comes from abstractions: many of
the things we’ll cover in this chapter provide a high-level user interface,
making it appear that files or applications that in reality run on a remote machine are
accessible or can be manipulated on your local machine. While providing an
abstraction that makes remote resources seem to be local is a
useful feature, we should not forget that at the end of the day, all of this
boils down to bits traveling over the wire and through the air. Keep this in
mind when troubleshooting or testing.</p>

<p><a data-type="xref" href="#fig-net-overview">Figure 7-1</a> shows how, on a high level, networking works
in Linux. There is some kind of networking hardware, such as Ethernet or
wireless cards; then a number of kernel-level components, such as the TCP/IP
stack; and finally, in the user space, a range of tools to configure, query, and use
networking.</p>

<figure><div id="fig-net-overview" class="figure">
<img src="Images/lmlx_0701.png" alt="lmlx 0701" width="600" height="449"/>
<h6><span class="label">Figure 7-1. </span>An overview of Linux networking</h6>
</div></figure>

<p>Let’s now dive into the TCP/IP stack, the core of networking in Linux.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Unlike in other areas of Linux, where you need to either consult the source
code or hope for properly documented design assumptions behind interfaces
and protocols, in the networking space, almost every protocol and interface
is based on publicly available specifications. The Internet Engineering
Task Force (IETF) makes all of those requests for comments (RFCs) freely available via <a href="https://datatracker.ietf.org" class="orm:hideurl"><em>data​tracker.ietf.org</em></a>.</p>

<p>Make a habit out of simply reading these RFCs before you get into the details
of implementations. Those RFCs are written by practitioners for practitioners
and document good practices and how to implement stuff. Don’t be afraid of
working through them; you’ll gain a much better understanding about the
motivation, use cases, and reasons why things are the way they are.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The TCP/IP Stack"><div class="sect1" id="tcp-ip-stack">
<h1>The TCP/IP Stack</h1>

<p><a data-type="indexterm" data-primary="networking" data-secondary="protocols" id="ix_ch07-asciidoc1"/><a data-type="indexterm" data-primary="networking" data-secondary="TCP/IP stack" id="ix_ch07-asciidoc2"/><a data-type="indexterm" data-primary="TCP/IP stack" id="ix_ch07-asciidoc3"/>The TCP/IP stack, shown in <a data-type="xref" href="#fig-tcpip-stack">Figure 7-2</a>, is a layered network model made of a number
of protocols and tools, mostly defined by IETF specs. Each layer must
be aware of and able to communicate with only the layers right above and below itself. The data is
encapsulated in packets, and each layer typically wraps the data in
a header that contains information relevant for its function. So, if an app
wants to send data, it would interact directly with the highest layer
that would add a header and so on down the stack (the send path). Conversely,
if an app wants to receive data, it would arrive at the lowest layer, and
each layer in turn would process it based on the header information it finds
and pass the payload on to the layer above (the receive path).</p>

<figure><div id="fig-tcpip-stack" class="figure">
<img src="Images/lmlx_0702.png" alt="lmlx 0702" width="600" height="423"/>
<h6><span class="label">Figure 7-2. </span>The TCP/IP layers working together to enable communication</h6>
</div></figure>

<p>Starting at the bottom of the stack, the four layers of the TCP/IP stack are the 
<span class="keep-together">following:</span></p>
<dl>
<dt>The link layer</dt>
<dd>
<p>Lowest in the stack, this layer covers the hardware
  (Ethernet, WiFi) and kernel drivers and focuses on how packets are sent
  between physical devices. See <a data-type="xref" href="#tcp-link">“The Link Layer”</a> for details.</p>
</dd>
<dt>The internet layer</dt>
<dd>
<p><a data-type="indexterm" data-primary="IP address" id="idm45805431993408"/>With the Internet Protocol (IP), this layer focuses on routing;
  that is, it supports sending packets between machines across networks. We’ll discuss it in <a data-type="xref" href="#tcp-internet">“The Internet Layer”</a>.</p>
</dd>
<dt>The transport layer</dt>
<dd>
<p>This layer controls end-to-end communications between
  (virtual or physical) hosts, with the Transmission Control Protocol (TCP)
  for session-based, reliable communication and User Datagram Protocol (UDP)
  for connection-less communication. It mainly deals with how packets are transmitted,
  including addressing individual services on a machine via ports as well as
  data integrity. Further, Linux supports sockets as communication endpoints.
  See <a data-type="xref" href="#tcp-transport">“The Transport Layer”</a>.</p>
</dd>
<dt>The application layer</dt>
<dd>
<p>This layer deals with user-facing tooling and apps, such as the web, SSH, and mail. We’ll discuss it in <a data-type="xref" href="#dns">“DNS”</a> and <a data-type="xref" href="#app-layer-net">“Application Layer Networking”</a>.</p>
</dd>
</dl>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805431986144">
<h5>The Internet and OSI</h5>
<p><a data-type="indexterm" data-primary="Open Systems Interconnection (OSI) model" id="idm45805431984944"/>The internet has its roots in a US Department of Defense project started in the 1960s that had the
goal to create a communication network that couldn’t easily be destroyed. The internet
is a network of networks—that is, many local networks hooked up with a backend
infrastructure enabling communication between different systems.</p>

<p>You’ll likely come across the Open Systems Interconnection
(OSI) model, a theoretical model of networking that uses seven layers,
with the seventh, the top-most layer, being the application layer. The
TCP/IP model has only four layers, but the TCP/IP stack is what is used
everywhere in practice.</p>

<p>Don’t get confused by the layer numbering. Usually, since the hardware
counts as layer 1, the link layer would be 2, the internet layer 3, the
transport layer 4, and (for historical reasons, to be OSI model-aligned),
the application layer would be 7.</p>
</div></aside>

<p>The layering means that the header and the payload of a layer make up the
payload for the next layer. For example, looking at <a data-type="xref" href="#fig-tcpip-stack">Figure 7-2</a>, the
payload in the internet layer is the transport layer header H<sub>T</sub> and its payload.
In other words, the internet layer takes the packet it gets from the transport
layer, treats it as an opaque chunk of bytes, and can focus on its function, the
routing of the packet to the target machine.</p>

<p>Let’s now work our way up the TCP/IP stack, starting with the lowest layer, the
link layer.</p>








<section data-type="sect2" data-pdf-bookmark="The Link Layer"><div class="sect2" id="tcp-link">
<h2>The Link Layer</h2>

<p><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="link layer" id="ix_ch07-asciidoc4"/>In the link layer of the TCP/IP stack, it’s all about hardware or near-hardware
stuff, such as bytes, wires, electromagnetic waves, device drivers, and network interfaces.
You’ll come across the following terms in this context:</p>
<dl>
<dt>Ethernet</dt>
<dd>
<p>A family of networking technologies using wires to connect machines;
often used in local area networks (LANs).</p>
</dd>
<dt>Wireless</dt>
<dd>
<p>Also known as WiFi, a class of communication protocols and methods that,
rather than using wires, uses some electromagnetic waves to transport data.</p>
</dd>
<dt>MAC addresses</dt>
<dd>
<p><a data-type="indexterm" data-primary="media access control (MAC)" id="idm45805431806608"/>Short for <em>media access control</em>, MAC is a unique 48-bit identifier for hardware,
used to identify your machine (to be precise, the network interface; see
the following term). The MAC address encodes the manufacturer (of the interface) via
the organizationally unique identifier (OUI), usually occupying the first 24 bits.</p>
</dd>
<dt>Interface</dt>
<dd>
<p>A network connection. It can be a physical interface (see <a data-type="xref" href="#nic">“Network interface controller”</a> for details)
or a virtual (software) interface, like the loopback interface <code>lo</code>.</p>
</dd>
</dl>

<p>Equipped with these basics, let’s have a closer look at the link layer.</p>










<section data-type="sect3" data-pdf-bookmark="Network interface controller"><div class="sect3" id="nic">
<h3>Network interface controller</h3>

<p><a data-type="indexterm" data-primary="network interface controller (NIC)" id="idm45805431800000"/><a data-type="indexterm" data-primary="NIC (network interface controller)" id="idm45805431799104"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="NIC" id="idm45805431798464"/>One essential piece of hardware equipment is the
<a href="https://oreil.ly/fZeVJ"><em>network interface controller</em>
(NIC)</a>, sometimes also called the <em>network interface card</em>.
The NIC provides the physical connectivity to a network through either
a wired standard—for example, the
<a href="https://oreil.ly/9g4Mu">IEEE 802.3-2018 standard
for Ethernet</a>—or one of the many wireless standards from the
<a href="https://oreil.ly/V5NiL">IEEE 802.11 family</a>. Once part of a network, the NIC
turns the digital representation of the bytes you want to send into
electrical or electromagnetic signals. The reverse is true for the receive
path, where the NIC turns whatever physical signals it receives into
bits and bytes that the software can deal with.</p>

<p>Let’s have a look at NICs in action. Traditionally, one would use the (now
widely considered deprecated) <a href="https://oreil.ly/QwgOc"><code>ifconfig</code>
command</a> to query information on the NICs available on the system (we show it
here first for educational purposes; in practice, it’s better to use <code>ip</code>, as shown in the next
example):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ifconfig</code><code>
</code><code>lo:</code><code> </code><code class="nv">flags</code><code class="o">=</code><code class="m">73</code><code>&lt;</code><code>UP,LOOPBACK,RUNNING&gt;</code><code>  </code><code>mtu</code><code> </code><code class="m">65536</code><code> </code><a class="co" id="co_networking_CO1-1" href="#callout_networking_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
        </code><code>inet</code><code> </code><code class="m">127</code><code>.0.0.1</code><code>  </code><code>netmask</code><code> </code><code class="m">255</code><code>.0.0.0</code><code>
        </code><code>inet6</code><code> </code><code>::1</code><code>  </code><code>prefixlen</code><code> </code><code class="m">128</code><code>  </code><code>scopeid</code><code> </code><code>0x10</code><code>&lt;</code><code>host&gt;</code><code>
        </code><code>loop</code><code>  </code><code>txqueuelen</code><code> </code><code class="m">1000</code><code>  </code><code class="o">(</code><code>Local</code><code> </code><code>Loopback</code><code class="o">)</code><code>
        </code><code>RX</code><code> </code><code>packets</code><code> </code><code class="m">7218</code><code>  </code><code>bytes</code><code> </code><code class="m">677714</code><code> </code><code class="o">(</code><code class="m">677</code><code>.7</code><code> </code><code>KB</code><code class="o">)</code><code>
        </code><code>RX</code><code> </code><code>errors</code><code> </code><code class="m">0</code><code>  </code><code>dropped</code><code> </code><code class="m">0</code><code>  </code><code>overruns</code><code> </code><code class="m">0</code><code>  </code><code>frame</code><code> </code><code class="m">0</code><code>
        </code><code>TX</code><code> </code><code>packets</code><code> </code><code class="m">7218</code><code>  </code><code>bytes</code><code> </code><code class="m">677714</code><code> </code><code class="o">(</code><code class="m">677</code><code>.7</code><code> </code><code>KB</code><code class="o">)</code><code>
        </code><code>TX</code><code> </code><code>errors</code><code> </code><code class="m">0</code><code>  </code><code>dropped</code><code> </code><code class="m">0</code><code> </code><code>overruns</code><code> </code><code class="m">0</code><code>  </code><code>carrier</code><code> </code><code class="m">0</code><code>  </code><code>collisions</code><code> </code><code class="m">0</code><code>

</code><code>wlp1s0:</code><code> </code><code class="nv">flags</code><code class="o">=</code><code class="m">4163</code><code>&lt;</code><code>UP,BROADCAST,RUNNING,MULTICAST&gt;</code><code>  </code><code>mtu</code><code> </code><code class="m">1500</code><code> </code><a class="co" id="co_networking_CO1-2" href="#callout_networking_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
        </code><code>inet</code><code> </code><code class="m">192</code><code>.168.178.40</code><code>  </code><code>netmask</code><code> </code><code class="m">255</code><code>.255.255.0</code><code>  </code><code>broadcast</code><code> </code><code class="m">192</code><code>.168.178.255</code><code>
        </code><code>inet6</code><code> </code><code>fe80::be87:e600:7de7:e08f</code><code>  </code><code>prefixlen</code><code> </code><code class="m">64</code><code>  </code><code>scopeid</code><code> </code><code>0x20</code><code>&lt;</code><code>link&gt;</code><code>
        </code><code>ether</code><code> </code><code class="m">38</code><code>:de:ad:37:32:0f</code><code>  </code><code>txqueuelen</code><code> </code><code class="m">1000</code><code>  </code><code class="o">(</code><code>Ethernet</code><code class="o">)</code><code>
        </code><code>RX</code><code> </code><code>packets</code><code> </code><code class="m">2398756</code><code>  </code><code>bytes</code><code> </code><code class="m">3003287387</code><code> </code><code class="o">(</code><code class="m">3</code><code>.0</code><code> </code><code>GB</code><code class="o">)</code><code>
        </code><code>RX</code><code> </code><code>errors</code><code> </code><code class="m">0</code><code>  </code><code>dropped</code><code> </code><code class="m">7</code><code>  </code><code>overruns</code><code> </code><code class="m">0</code><code>  </code><code>frame</code><code> </code><code class="m">0</code><code>
        </code><code>TX</code><code> </code><code>packets</code><code> </code><code class="m">504087</code><code>  </code><code>bytes</code><code> </code><code class="m">85467550</code><code> </code><code class="o">(</code><code class="m">85</code><code>.4</code><code> </code><code>MB</code><code class="o">)</code><code>
        </code><code>TX</code><code> </code><code>errors</code><code> </code><code class="m">0</code><code>  </code><code>dropped</code><code> </code><code class="m">0</code><code> </code><code>overruns</code><code> </code><code class="m">0</code><code>  </code><code>carrier</code><code> </code><code class="m">0</code><code>  </code><code>collisions</code><code> </code><code class="m">0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO1-1" href="#co_networking_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The first interface here is <code>lo</code>, the loopback interface with
the IP address <code>127.0.0.1</code> (see <a data-type="xref" href="#ipv4">“IPv4”</a>). <a data-type="indexterm" data-primary="maximum transmission unit (MTU)" id="idm45805431751024"/><a data-type="indexterm" data-primary="MTU (maximum transmission unit)" id="idm45805431750352"/>The maximum transmission unit (MTU)
is the packet size, here 65,536 bytes (with larger sizes meaning higher throughput);
for historical reasons, the default for Ethernet was 1,500 bytes, but you can use
<a href="https://oreil.ly/NjpnF">jumbo frames</a>
that are 9,000 bytes in size.</p></dd>
<dt><a class="co" id="callout_networking_CO1-2" href="#co_networking_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The second interface reported is <code>wlp1s0</code>, with an IPv4 address of
<code>192.168.178.40</code> assigned. This interface is an NIC and has a MAC address
(<code>ether</code> is <code>38:de:ad:37:32:0f</code>). When looking at the flags (<code>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;</code>),
it seems to be operational.</p></dd>
</dl>

<p>For a more modern approach of doing the same thing (querying interfaces and checking on their status),
use the <a href="https://oreil.ly/pruUF"><code>ip</code> command</a>.
We’ll use this approach most often in this chapter (output edited to fit):</p>
<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ip</code><code> </code><code>link</code><code> </code><code>show</code><code>
</code><code class="m">1</code><code>:</code><code> </code><code>lo:</code><code> </code><code>&lt;</code><code>LOOPBACK,UP,LOWER_UP&gt;</code><code> </code><code>mtu</code><code> </code><code class="m">65536</code><code> </code><code>qdisc</code><code> </code><code>noqueue</code><code> </code><a class="co" id="custom_co_networking_CO2-1" href="#custom_callout_networking_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
   </code><code>state</code><code> </code><code>UNKNOWN</code><code> </code><code>mode</code><code> </code><code>DEFAULT</code><code> </code><code>group</code><code> </code><code>default</code><code> </code><code>qlen</code><code> </code><code class="m">1000</code><code>
   </code><code>link/loopback</code><code> </code><code class="m">00</code><code>:00:00:00:00:00</code><code> </code><code>brd</code><code> </code><code class="m">00</code><code>:00:00:00:00:00</code><code>
</code><code class="m">2</code><code>:</code><code> </code><code>wlp1s0:</code><code> </code><code>&lt;</code><code>BROADCAST,MULTICAST,UP,LOWER_UP&gt;</code><code> </code><code>mtu</code><code> </code><code class="m">1500</code><code> </code><code>qdisc</code><code> </code><code>noqueue</code><code> </code><a class="co" id="custom_co_networking_CO2-2" href="#custom_callout_networking_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
   </code><code>state</code><code> </code><code>UP</code><code> </code><code>mode</code><code> </code><code>DORMANT</code><code> </code><code>group</code><code> </code><code>default</code><code> </code><code>qlen</code><code> </code><code class="m">1000</code><code>
    </code><code>link/ether</code><code> </code><code class="m">38</code><code>:de:ad:37:32:0f</code><code> </code><code>brd</code><code> </code><code>ff:ff:ff:ff:ff:ff</code></pre>
<dl class="calloutlist pagebreak-before">
<dt class="less_space"><a class="co" id="custom_callout_networking_CO2-1" href="#custom_co_networking_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The loopback interface.</p></dd>
<dt><a class="co" id="custom_callout_networking_CO2-2" href="#custom_co_networking_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>My NIC, with a MAC address of <code>38:de:ad:37:32:0f</code>. Note that the name
(<code>wlp1s0</code>) here tells you something about the interface: it’s a wireless
interface (<code>wl</code>) in PCI bus 1 (<code>p1</code>) and slot 0 (<code>s0</code>). This naming makes the interface names more predictable. In other words,
if you had two old-style interfaces (say, <code>eth0</code> and <code>eth1</code>), there was
no guarantee that a reboot or adding a new card wouldn’t cause Linux to
rename those interfaces.</p></dd>
</dl>

<p>For both <code>ifconfig</code> and <code>ip link</code>, you might be interested in the meaning of flags
such as <code>LOWER_IP</code> or <code>MULTICAST</code>; these are documented in the
<a href="https://oreil.ly/OTB7R">netdevice man pages</a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Address Resolution Protocol"><div class="sect3" id="arp">
<h3>Address Resolution Protocol</h3>

<p><a data-type="indexterm" data-primary="Address Resolution Protocol (ARP)" id="ix_ch07-asciidoc5"/><a data-type="indexterm" data-primary="ARP (Address Resolution Protocol)" id="ix_ch07-asciidoc6"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="ARP" id="ix_ch07-asciidoc7"/>The Address Resolution Protocol (ARP) maps MAC addresses to IP addresses. In a sense, it bridges the link layer with
the layer above it, the internet layer.</p>

<p>Let’s see it in action:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>arp</code><code> </code><a class="co" id="co_networking_CO2-1" href="#callout_networking_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Address</code><code>                  </code><code>HWtype</code><code>  </code><code>HWaddress</code><code>           </code><code>Flags</code><code> </code><code>Mask</code><code>            </code><code>Iface</code><code>
</code><code>mh9-imac.fritz.box</code><code>       </code><code>ether</code><code>   </code><code class="m">00</code><code>:25:4b:9b:64:49</code><code>   </code><code>C</code><code>                     </code><code>wlp1s0</code><code>
</code><code>fritz.box</code><code>                </code><code>ether</code><code>   </code><code>3c:a6:2f:8e:66:b3</code><code>   </code><code>C</code><code>                     </code><code>wlp1s0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO2-1" href="#co_networking_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>arp</code> command to show the cache of mapping MAC addresses to
hostnames or IP addresses. Note that you can use <code>arp -n</code> to prevent
hostname resolution and show IP addresses instead of DNS names.</p></dd>
</dl>

<p>Or, using a more modern approach with <code>ip</code>:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ip</code><code> </code><code>neigh</code><code> </code><a class="co" id="co_networking_CO3-1" href="#callout_networking_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="m">192</code><code>.168.178.34</code><code> </code><code>dev</code><code> </code><code>wlp1s0</code><code> </code><code>lladdr</code><code> </code><code class="m">00</code><code>:25:4b:9b:64:49</code><code> </code><code>STALE</code><code>
</code><code class="m">192</code><code>.168.178.1</code><code> </code><code>dev</code><code> </code><code>wlp1s0</code><code> </code><code>lladdr</code><code> </code><code>3c:a6:2f:8e:66:b3</code><code> </code><code>REACHABLE</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO3-1" href="#co_networking_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>ip</code> command to show the cache of mapping MAC addresses to IP addresses.</p></dd>
</dl>

<p>To display, configure, and troubleshoot wireless devices, you want to use the
<a href="https://oreil.ly/fyR0y"><code>iw</code> command</a>. For
example, I know that my wireless NIC is called <code>wlp1s0</code>, so I can query it:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>iw</code><code> </code><code>dev</code><code> </code><code>wlp1s0</code><code> </code><code>info</code><code> </code><a class="co" id="co_networking_CO4-1" href="#callout_networking_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Interface</code><code> </code><code>wlp1s0</code><code>
        </code><code>ifindex</code><code> </code><code class="m">2</code><code>
        </code><code>wdev</code><code> </code><code>0x1</code><code>
        </code><code>addr</code><code> </code><code class="m">38</code><code>:de:ad:37:32:0f</code><code>
        </code><code>ssid</code><code> </code><code>FRITZ!Box</code><code> </code><code class="m">7530</code><code> </code><code>QJ</code><code> </code><a class="co" id="co_networking_CO4-2" href="#callout_networking_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
        </code><code class="nb">type</code><code> </code><code>managed</code><code>
        </code><code>wiphy</code><code> </code><code class="m">0</code><code>
        </code><code>channel</code><code> </code><code class="m">5</code><code> </code><code class="o">(</code><code class="m">2432</code><code> </code><code>MHz</code><code class="o">)</code><code>,</code><code> </code><code>width:</code><code> </code><code class="m">20</code><code> </code><code>MHz,</code><code> </code><code>center1:</code><code> </code><code class="m">2432</code><code> </code><code>MHz</code><code> </code><a class="co" id="co_networking_CO4-3" href="#callout_networking_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code>txpower</code><code> </code><code class="m">20</code><code>.00</code><code> </code><code>dBm</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO4-1" href="#co_networking_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Show base information about wireless interface <code>wlp1s0</code>.</p></dd>
<dt><a class="co" id="callout_networking_CO4-2" href="#co_networking_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The router the interface is connected to (see also the next example).</p></dd>
<dt><a class="co" id="callout_networking_CO4-3" href="#co_networking_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The WiFi frequency band the interface is using.</p></dd>
</dl>

<p>Further, I can gather router- and traffic-related information like so:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>iw</code><code> </code><code>dev</code><code> </code><code>wlp1s0</code><code> </code><code>link</code><code> </code><a class="co" id="co_networking_CO5-1" href="#callout_networking_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Connected</code><code> </code><code>to</code><code> </code><code class="m">74</code><code>:42:7f:67:ca:b5</code><code> </code><code class="o">(</code><code>on</code><code> </code><code>wlp1s0</code><code class="o">)</code><code>
        </code><code>SSID:</code><code> </code><code>FRITZ!Box</code><code> </code><code class="m">7530</code><code> </code><code>QJ</code><code>
        </code><code>freq:</code><code> </code><code class="m">2432</code><code>
        </code><code>RX:</code><code> </code><code class="m">28003606</code><code> </code><code>bytes</code><code> </code><code class="o">(</code><code class="m">45821</code><code> </code><code>packets</code><code class="o">)</code><code> </code><a class="co" id="co_networking_CO5-2" href="#callout_networking_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
        </code><code>TX:</code><code> </code><code class="m">4993401</code><code> </code><code>bytes</code><code> </code><code class="o">(</code><code class="m">15605</code><code> </code><code>packets</code><code class="o">)</code><code>
        </code><code>signal:</code><code> </code><code>-67</code><code> </code><code>dBm</code><code>
        </code><code>tx</code><code> </code><code>bitrate:</code><code> </code><code class="m">65</code><code>.0</code><code> </code><code>MBit/s</code><code> </code><code>MCS</code><code> </code><code class="m">6</code><code> </code><code>short</code><code> </code><code>GI</code><code>

        </code><code>bss</code><code> </code><code>flags:</code><code>      </code><code>short-preamble</code><code> </code><code>short-slot-time</code><code>
        </code><code>dtim</code><code> </code><code>period:</code><code>    </code><code class="m">1</code><code>
        </code><code>beacon</code><code> </code><code>int:</code><code>     </code><code class="m">100</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO5-1" href="#co_networking_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Show connection information about wireless interface <code>wlp1s0</code>.</p></dd>
<dt><a class="co" id="callout_networking_CO5-2" href="#co_networking_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This and the next line send (<code>TX</code> stands for “transmit”) and receive (<code>RX</code>)
statistics—that is, bytes and packets sent and received via this interface<a data-type="indexterm" data-startref="ix_ch07-asciidoc7" id="idm45805431280768"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc6" id="idm45805431280064"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc5" id="idm45805431279392"/>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc4" id="idm45805431278592"/></p></dd>
</dl>

<p>Now that we have a good handle on what’s going on in the lowest layer of the
TCP/IP stack, the (data) link layer, let’s move up the stack.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="The Internet Layer"><div class="sect2" id="tcp-internet">
<h2>The Internet Layer</h2>

<p><a data-type="indexterm" data-primary="routing" id="ix_ch07-asciidoc8"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="internet layer" id="ix_ch07-asciidoc9"/>The second-lowest layer of the TCP/IP stack, the internet layer, is concerned
with routing packets from one machine on the network to another. The
design of the internet layer assumes that the available network infrastructure
is unreliable and that the participants (such as nodes in the network or the
connections between them) change frequently.</p>

<p>The internet layer provides best-effort delivery (that is, no guarantees
concerning performance) and treats every packet as independent. As a consequence,
higher layers, typically the transport layer,
take care of addressing reliability issues, including packet order, retries,
or delivery guarantees.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805431244064">
<h5>How Routing Is Like Surface Mail</h5>
<p>Think of an internet layer address as similar to your postal address. This postal address
is made up of a number of parts, from the most coarse
grained (the country) down to the street-level information, including house number.</p>

<p>That postal address is all I need to know to make sure that I can
send, say, a postcard to you from anywhere in the world. Note also that I don’t
need to know the details of the transportation (such as when my postcard travels
via ship or plane, or what exact path is taken). The contract between
me and the post office is simple: if I put the correct address on it and
pay the correct amount (via the right stamp), the post office promises to deliver it.</p>

<p>Likewise, your machine is identified by the internet layer via a logical address.</p>
</div></aside>

<p>In this layer, the dominating protocol for logically identifying machines
uniquely, worldwide, is the Internet Protocol (IP), which comes in two flavors,
IP version 4 (IPv4) and IP version 6 (IPv6).</p>










<section data-type="sect3" data-pdf-bookmark="IPv4"><div class="sect3" id="ipv4">
<h3>IPv4</h3>

<p><a data-type="indexterm" data-primary="IPv4" id="ix_ch07-asciidoc10"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="IPv4" id="ix_ch07-asciidoc11"/>IPv4 defines unique 32-bit numbers identifying a host or process
acting as an endpoint in a TCP/IP communication.</p>

<p>One way to write IPv4 addresses is to split up the 32-bit into four 8-bit
segments separated by a period, each segment in the 0 to 255 range, called
an <em>octet</em> (hinting at that the segment covers 8 bits). Let’s have a look at
a concrete example:</p>

<pre data-type="programlisting"> 63.32.106.149
\_/\_/ \_/ \_/
 |  |   |   └─ <a class="co" id="co_networking_CO6-1" href="#callout_networking_CO6-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a>
 |  |   └───── <a class="co" id="co_networking_CO6-2" href="#callout_networking_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a>
 |  └───────── <a class="co" id="co_networking_CO6-3" href="#callout_networking_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a>
 └──────────── <a class="co" id="co_networking_CO6-4" href="#callout_networking_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO6-1" href="#co_networking_CO6-4"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>First octet in binary form: <code>00111111</code></p></dd>
<dt><a class="co" id="callout_networking_CO6-2" href="#co_networking_CO6-3"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Second octet in binary form: <code>00100000</code></p></dd>
<dt><a class="co" id="callout_networking_CO6-3" href="#co_networking_CO6-2"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Third octet in binary form: <code>01101010</code></p></dd>
<dt><a class="co" id="callout_networking_CO6-4" href="#co_networking_CO6-1"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Fourth octet in binary form: <code>10010101</code></p></dd>
</dl>

<p>The IP header (<a data-type="xref" href="#fig-ip-header">Figure 7-3</a>), as defined in
<a href="https://oreil.ly/7u93r">RFC 791</a>
and related IETF specs, has a number of fields, but the following are the most important
ones that you should be aware of:</p>
<dl>
<dt>Source address (32 bits)</dt>
<dd>
<p>The IP address of the sender</p>
</dd>
<dt>Destination address (32 bits)</dt>
<dd>
<p>The IP address of the receiver</p>
</dd>
<dt>Protocol (8 bits)</dt>
<dd>
<p>The payload type (next-higher layer type),
  as per <a href="https://oreil.ly/Y8PPz">RFC 790</a>—for example, TCP, UDP, or ICMP</p>
</dd>
<dt>Time to live, aka TTL (8 bits)</dt>
<dd>
<p>The maximal time the packet is allowed to exist</p>
</dd>
<dt>Type of service (8 bits)</dt>
<dd>
<p>Can be used for quality of service (QoS) purposes</p>
</dd>
</dl>

<figure><div id="fig-ip-header" class="figure">
<img src="Images/lmlx_0703.png" alt="lmlx 0703" width="600" height="268"/>
<h6><span class="label">Figure 7-3. </span>The IP header format as per RFC 791</h6>
</div></figure>

<p>Given that the internet is a network of networks, it seems natural to distinguish
between networks and single machines (hosts) in the networks. IP address ranges
are assigned to networks and within those networks to individual hosts.</p>

<p><a data-type="indexterm" data-primary="Classless Inter-Domain Routing (CIDR)" id="idm45805431203664"/>Today, the
<a href="https://oreil.ly/VDVuy">Classless Inter-Domain
Routing (CIDR)</a> is the only relevant method for assigning IP addresses.
The CIDR format consists of two parts:</p>

<ul>
<li>
<p>The first part represents the network address.
This looks like a normal IP address—for example, <code>10.0.0.0</code>.</p>
</li>
<li>
<p>The second part defines how many bits (and with that, IP addresses) fall within
the address range—for example, <code>/24</code>.</p>
</li>
</ul>

<p class="pagebreak-before">So, a complete CIDR range example looks like the following:</p>

<pre data-type="programlisting">10.0.0.0/24</pre>

<p>In the preceding example, the first 24 bits (or three octets) represent the
network, and the last 8 bits (32 bits overall minus the 24 bits for the network)
are the IP addresses available for the 256 hosts (2<sup>8</sup>). The first
IP address in this CIDR range is <code>10.0.0.0</code>, and the last IP address is
<code>10.0.0.255</code>. Strictly speaking, only the addresses <code>10.0.0.1</code> to <code>10.0.0.254</code>
can be assigned to hosts since the <code>.0</code> and <code>.255</code> addresses are reserved for special
purposes. In addition, we can say that the netmask is <code>255.255.255.0</code> since
that’s the first 24 bits representing the network.</p>

<p>In practice, you don’t need to remember all the math here. If you’re
dealing with CIDR ranges on a daily basis, then you just know, and if you’re a casual user, you
may want to use some tooling. If you want to do CIDR range calculations, such
as determining how many IPs are in a range, the following are available:</p>

<ul>
<li>
<p>Online tools such as those at <a href="https://cidr.xyz"><em class="hyperlink">https://cidr.xyz</em></a> and
<a href="https://ipaddressguide.com/cidr"><em class="hyperlink">https://ipaddressguide.com/cidr</em></a></p>
</li>
<li>
<p>Command-line tools like <a href="https://oreil.ly/2uTwU">mapcidr</a>
and <a href="https://oreil.ly/g88Yk">cidrchk (by yours truly)</a></p>
</li>
</ul>

<p>There are also some notable <a href="https://oreil.ly/97Tp7">reserved IPv4
addresses</a> you should know:</p>
<dl>
<dt><code>127.0.0.0</code></dt>
<dd>
<p>This subnet is reserved for local addresses, with the most prominent
 one being the loopback address <code>127.0.0.1</code>.</p>
</dd>
<dt><code>169.254.0.0/16</code> (<code>169.254.0.0</code> to <code>169.254.255.255</code>)</dt>
<dd>
<p>These are link local
 addresses, meaning packets sent there should not be forwarded to other parts
 of the network. Some cloud providers such as Amazon Web Services use this
 for special services (metadata).</p>
</dd>
<dt><code>224.0.0.0/24</code> (<code>224.0.0.0</code> to <code>239.255.255.255</code>)</dt>
<dd>
<p>This range is reserved for multicast.</p>
</dd>
</dl>

<p><a href="https://oreil.ly/2Ijxk">RFC 1918</a> defines private IP ranges.
A private IP range means that the IP addresses in it are not routable on the public
internet; hence, it is safe to assign them internally (for example, in the context
of your company):</p>

<ul class="pagebreak-after">
<li>
<p><code>10.0.0.0</code> to <code>10.255.255.255</code> (the <code>10/8</code> prefix)</p>
</li>
<li>
<p><code>172.16.0.0</code> to <code>172.31.255.255</code> (<code>172.16/12</code> prefix)</p>
</li>
<li>
<p><code>192.168.0.0</code> to <code>192.168.255.255</code> (<code>192.168/16</code> prefix)</p>
</li>
</ul>

<p>Another interesting IPv4 address is <code>0.0.0.0</code>. It is a nonroutable address
that has different use cases and different meanings depending on the context,
but the most important one, from a server perspective, is that <code>0.0.0.0</code> refers
to all IPv4 addresses present in the machine. That’s a great way to say “listen
on all available IP addresses” as a source until it turns into a known IP.</p>

<p>That was a lot of dry theory; let’s see it in action. We’ll start by querying the
machine for IP-related things (output edited):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ip</code><code> </code><code>addr</code><code> </code><code>show</code><code> </code><a class="co" id="co_networking_CO7-1" href="#callout_networking_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="m">1</code><code>:</code><code> </code><code>lo:</code><code> </code><code>&lt;</code><code>LOOPBACK,UP,LOWER_UP&gt;</code><code> </code><code>mtu</code><code> </code><code class="m">65536</code><code> </code><code>qdisc</code><code> </code><code>noqueue</code><code>
    </code><code>state</code><code> </code><code>UNKNOWN</code><code> </code><code>group</code><code> </code><code>default</code><code> </code><code>qlen</code><code> </code><code class="m">1000</code><code>
    </code><code>link/loopback</code><code> </code><code class="m">00</code><code>:00:00:00:00:00</code><code> </code><code>brd</code><code> </code><code class="m">00</code><code>:00:00:00:00:00</code><code>
    </code><code>inet</code><code> </code><code class="m">127</code><code>.0.0.1/8</code><code> </code><code>scope</code><code> </code><code>host</code><code> </code><code>lo</code><code> </code><a class="co" id="co_networking_CO7-2" href="#callout_networking_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
       </code><code>valid_lft</code><code> </code><code>forever</code><code> </code><code>preferred_lft</code><code> </code><code>forever</code><code>
    </code><code>inet6</code><code> </code><code>::1/128</code><code> </code><code>scope</code><code> </code><code>host</code><code>
       </code><code>valid_lft</code><code> </code><code>forever</code><code> </code><code>preferred_lft</code><code> </code><code>forever</code><code>
</code><code class="m">2</code><code>:</code><code> </code><code>wlp1s0:</code><code> </code><code>&lt;</code><code>BROADCAST,MULTICAST,UP,LOWER_UP&gt;</code><code> </code><code>mtu</code><code> </code><code class="m">1500</code><code> </code><code>qdisc</code><code>
    </code><code>noqueue</code><code> </code><code>state</code><code> </code><code>UP</code><code> </code><code>group</code><code> </code><code>default</code><code> </code><code>qlen</code><code> </code><code class="m">1000</code><code>
    </code><code>link/ether</code><code> </code><code class="m">38</code><code>:de:ad:37:32:0f</code><code> </code><code>brd</code><code> </code><code>ff:ff:ff:ff:ff:ff</code><code>
    </code><code>inet</code><code> </code><code class="m">192</code><code>.168.178.40/24</code><code> </code><code>brd</code><code> </code><code class="m">192</code><code>.168.178.255</code><code> </code><code>scope</code><code> </code><code>global</code><code> </code><code>dynamic</code><code> </code><a class="co" id="co_networking_CO7-3" href="#callout_networking_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code>noprefixroute</code><code> </code><code>wlp1s0</code><code>
       </code><code>valid_lft</code><code> </code><code>863625sec</code><code> </code><code>preferred_lft</code><code> </code><code>863625sec</code><code>
    </code><code>inet6</code><code> </code><code>fe80::be87:e600:7de7:e08f/64</code><code> </code><code>scope</code><code> </code><code>link</code><code> </code><code>noprefixroute</code><code>
       </code><code>valid_lft</code><code> </code><code>forever</code><code> </code><code>preferred_lft</code><code> </code><code>forever</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO7-1" href="#co_networking_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>List addresses of all interfaces.</p></dd>
<dt><a class="co" id="callout_networking_CO7-2" href="#co_networking_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The IP address of the loopback interface (<code>127.0.0.1</code>, as expected).</p></dd>
<dt><a class="co" id="callout_networking_CO7-3" href="#co_networking_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The (private) IP address of the wireless NIC. Note that this is the
LAN-local IP address of the machine, which isn’t publicly routable since
it falls in the <code>192.168/16</code> range.</p></dd>
</dl>

<p>The IPv4 address space is already exhausted, and given that there are many
more endpoints today than the internet designers thought there would be (for
example, due to mobile devices and IoT), a sustainable solution is needed.</p>

<p>Luckily, with IPv6 there is a solution for the address-exhaustion issue.
Unfortunately, at this time of writing, the ecosystem at large has still not made
the move to IPv6, partly for infrastructure reasons but also due to a lack of tooling that supports IPv6. This means that for the time being you’ll still have to deal with IPv4 and
its limitations and <a href="https://oreil.ly/XSiTu">workarounds</a>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc11" id="idm45805431029088"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc10" id="idm45805431028384"/></p>

<p class="pagebreak-after">Let’s have a look at the (hopefully not-to-distant) future: IPv6.</p>
</div></section>













<section data-type="sect3" class="less_space" data-pdf-bookmark="IPv6"><div class="sect3" id="ipv6">
<h3>IPv6</h3>

<p><a data-type="indexterm" data-primary="IPv6" id="idm45805431025488"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="IPv6" id="idm45805431024784"/><a href="https://oreil.ly/T0ISm">Internet Protocol version 6 (IPv6)</a> is a
128-bit number identifying an endpoint in a TCP/IP communication. This means
that with IPv6 we can assign on the order of 10<sup>38</sup> individual machines
(devices). In contrast to IPv4, IPv6 uses a hexadecimal representation,
eight groups of 16 bits each, separating the groups by a colon (<code>:</code>).</p>

<p>There are a few rules for shortening IPv6 addresses, such as removing leading
zeros or compressing consecutive sections of zeros by replacing them with two
colons (<code>::</code>). For example, the IPv6
<a href="https://oreil.ly/mGfiU">loopback address</a> can be
written abbreviated as <code>::1</code> (the IPv4 variant would be <code>127.0.0.1</code>).</p>

<p>Just like IPv4, IPv6 has a number of special and reserved addresses;
see APNIC’s listing of <a href="https://oreil.ly/isoL1">IPv6 address types</a>
for examples.</p>

<p>It’s important to note that IPv4 and IPv6 are not compatible. This means that
IPv6 support needs to be built into each and every network participant, from
edge devices (like your phone) to routers to server software. This IPv6 support
has, at least in the context of Linux, already shown to be pretty wide. For
example, the <code>ip addr</code> command we saw in the section <a data-type="xref" href="#ipv4">“IPv4”</a> would already by
default show us the IPv6 addresses.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Internet Control Message Protocol"><div class="sect3" id="icmp">
<h3>Internet Control Message Protocol</h3>

<p><a data-type="indexterm" data-primary="ICMP (Internet Control Message Protocol)" id="idm45805431015088"/><a data-type="indexterm" data-primary="Internet Control Message Protocol (ICMP)" id="idm45805431014416"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="ICMP" id="idm45805431013776"/>The <a href="https://oreil.ly/6Nphe">RFC 792</a> defines the
Internet Control Message Protocol (ICMP), which is used for lower-level
components to send error messages and operational information like availability.</p>

<p>Let’s see ICMP in action by testing the reachability of a website with <code>ping</code>:</p>

<pre data-type="programlisting" data-code-language="shell">$ ping mhausenblas.info
PING mhausenblas.info <code class="o">(</code><code class="m">185</code>.199.109.153<code class="o">)</code>: <code class="m">56</code> data bytes
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">0</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">23</code>.140 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">1</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">23</code>.237 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">2</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">23</code>.989 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">3</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">24</code>.028 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">4</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">24</code>.826 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">5</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">23</code>.579 ms
<code class="m">64</code> bytes from <code class="m">185</code>.199.109.153: <code class="nv">icmp_seq</code><code class="o">=</code><code class="m">6</code> <code class="nv">ttl</code><code class="o">=</code><code class="m">38</code> <code class="nv">time</code><code class="o">=</code><code class="m">22</code>.984 ms
^C
--- mhausenblas.info ping statistics ---
<code class="m">7</code> packets transmitted, <code class="m">7</code> packets received, <code class="m">0</code>.0% packet loss
round-trip min/avg/max/stddev <code class="o">=</code> <code class="m">22</code>.984/23.683/24.826/0.599 ms</pre>

<p>Alternatively, you can use <a href="https://oreil.ly/1Y5qv"><code>gping</code></a>, which
can ping multiple targets at the same time and plot a graph on the
command line (see <a data-type="xref" href="#fig-gping">Figure 7-4</a>).</p>

<figure><div id="fig-gping" class="figure">
<img src="Images/lmlx_0704.png" alt="lmlx 0704" width="600" height="235"/>
<h6><span class="label">Figure 7-4. </span>Pinging two websites with <code>gping</code></h6>
</div></figure>

<p>Note that an equivalent tool is available for IPv6: the aptly named
<a href="https://oreil.ly/F6q6B"><code>ping6</code></a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Routing"><div class="sect3" id="routing">
<h3>Routing</h3>

<p><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="routing" id="ix_ch07-asciidoc12"/>Part of the network stack in Linux is concerned with routing—that is,
deciding on a per-packet basis where to send a packet. The
destination could be a process on the same machine, or it could be an IP
address on a different machine.</p>

<p>While the exact implementation details of routing are beyond the
scope of this chapter, we’ll provide a high-level overview:
<a href="https://oreil.ly/roRsv">iptables</a>, a widely used tool
that allows you to manipulate the routing tables—for example, to reroute packets
on certain conditions or implement a firewall—uses
<a href="https://www.netfilter.org">netfilter</a> to intercept and manipulate packets.</p>

<p>What you should know is how to query and display routing information, as follows:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>route</code><code> </code><code>-n</code><code> </code><a class="co" id="co_networking_CO8-1" href="#callout_networking_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Kernel</code><code> </code><code>IP</code><code> </code><code>routing</code><code> </code><code>table</code><code>
</code><code>Destination</code><code>     </code><code>Gateway</code><code>         </code><code>Genmask</code><code>         </code><code>Flags</code><code> </code><code>Metric</code><code> </code><code>Ref</code><code>    </code><code>Use</code><code> </code><code>Iface</code><code>
</code><code class="m">0</code><code>.0.0.0</code><code>         </code><code class="m">192</code><code>.168.178.1</code><code>   </code><code class="m">0</code><code>.0.0.0</code><code>         </code><code>UG</code><code>    </code><code class="m">600</code><code>    </code><code class="m">0</code><code>        </code><code class="m">0</code><code> </code><code>wlp1s0</code><code>
</code><code class="m">169</code><code>.254.0.0</code><code>     </code><code class="m">0</code><code>.0.0.0</code><code>         </code><code class="m">255</code><code>.255.0.0</code><code>     </code><code>U</code><code>     </code><code class="m">1000</code><code>   </code><code class="m">0</code><code>        </code><code class="m">0</code><code> </code><code>wlp1s0</code><code>
</code><code class="m">192</code><code>.168.178.0</code><code>   </code><code class="m">0</code><code>.0.0.0</code><code>         </code><code class="m">255</code><code>.255.255.0</code><code>   </code><code>U</code><code>     </code><code class="m">600</code><code>    </code><code class="m">0</code><code>        </code><code class="m">0</code><code> </code><code>wlp1s0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO8-1" href="#co_networking_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>route</code> command with <code>-n</code>, forcing numerical IP addresses.</p></dd>
</dl>

<p>The detailed meaning of the tabular output in the previous <code>route</code> command is as 
<span class="keep-together">follows:</span></p>
<dl class="pagebreak-before">
<dt class="less_space"><code>Destination</code></dt>
<dd>
<p>The IP address of the destination; <code>0.0.0.0</code> means it’s unspecified or unknown, potentially sending it to the gateway.</p>
</dd>
<dt><code>Gateway</code></dt>
<dd>
<p>For packets not on the same network, the gateway address.</p>
</dd>
<dt><code>Genmask</code></dt>
<dd>
<p>The subnet mask used.</p>
</dd>
<dt><code>Flags</code></dt>
<dd>
<p><code>UG</code> means the network is up and is a gateway.</p>
</dd>
<dt><code>Iface</code></dt>
<dd>
<p>The network interface the packet is going to use.</p>
</dd>
</dl>

<p>A modern way is using <code>ip</code> like so:</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo ip route
default via <code class="m">192</code>.168.178.1 dev wlp1s0 proto dhcp metric <code class="m">600</code>
<code class="m">169</code>.254.0.0/16 dev wlp1s0 scope link metric <code class="m">1000</code>
<code class="m">192</code>.168.178.0/24 dev wlp1s0 proto kernel scope link src <code class="m">192</code>.168.178.40 metric <code class="m">600</code></pre>

<p>Is it down? We can check connectivity as follows:</p>

<pre data-type="programlisting" data-code-language="shell">$ traceroute mhausenblas.info
traceroute to mhausenblas.info <code class="o">(</code><code class="m">185</code>.199.108.153<code class="o">)</code>, <code class="m">30</code> hops max, <code class="m">60</code> byte packets
 <code class="m">1</code>  _gateway <code class="o">(</code><code class="m">192</code>.168.5.2<code class="o">)</code>  <code class="m">1</code>.350 ms  <code class="m">1</code>.306 ms  <code class="m">1</code>.293 ms</pre>

<p>Note that we will discuss a number of TCP/IP-related troubleshooting and
performance tools in <a data-type="xref" href="ch08.xhtml#monitoring">“Monitoring”</a>.</p>

<p><a data-type="indexterm" data-primary="BGP (Border Gateway Protocol)" id="idm45805430714496"/><a data-type="indexterm" data-primary="Border Gateway Protocol (BGP)" id="idm45805430713856"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="BGP" id="idm45805430713216"/>To round things off, I’ll also briefly mention the
<a href="https://oreil.ly/QMc1v">Border Gateway Protocol (BGP)</a>
as defined in <a href="https://oreil.ly/iwRNE">RFC 4271</a> and other
IETF specs. While it’s unlikely that you’ll interact directly with BGP (unless you work
at a network provider or admin a network), it’s crucial to be aware of its
existence and understand at a high level what it does.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805430710416">
<h5>Facebook Disappears from the Internet</h5>
<p>In late 2021, we saw the impact that BGP misconfiguration can have.
Read the backstory and lessons learned in
<a href="https://oreil.ly/UTwSk">“Understanding How
Facebook Disappeared from the Internet”</a>.</p>
</div></aside>

<p><a data-type="indexterm" data-primary="autonomous system" id="idm45805430707888"/>We said earlier on that the internet really is a network of networks. In BGP
terminology, a network is called an <em>autonomous system</em> (AS). For
IP routing to work, these ASs need to share their routing and reachability data,
announcing routes to deliver packets across the internet<a data-type="indexterm" data-startref="ix_ch07-asciidoc12" id="idm45805430706544"/>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc9" id="idm45805430705712"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc8" id="idm45805430705008"/></p>

<p>Now that you know the fundamental workings of the internet layer—how addresses
and routing work—let’s move up the stack.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="The Transport Layer"><div class="sect2" id="tcp-transport">
<h2>The Transport Layer</h2>

<p><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="transport layer" id="ix_ch07-asciidoc13"/>In this layer, it’s all about the nature of the communication between
endpoints. There are connection-oriented protocols and connection-less
ones. Reliability, QoS, and in-order delivery may be a concern.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are attempts in modern protocol design—<a href="https://oreil.ly/ecuPK">HTTP/3</a> is an example—to combine functionality, such as moving parts of TCP into higher-level protocols.</p>
</div>










<section data-type="sect3" data-pdf-bookmark="Ports"><div class="sect3" id="transport-ports">
<h3>Ports</h3>

<p><a data-type="indexterm" data-primary="ports" id="idm45805430682752"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="ports" id="idm45805430682144"/>One core concept in this layer is that of ports. No matter which protocol
is used in this layer, each requires ports. A <em>port</em> is a unique 16-bit
number identifying a service available at an IP address. Think of it this
way: a single (virtual) machine may have a number of services
(see <a data-type="xref" href="#app-layer-net">“Application Layer Networking”</a>) running, and you need to be able to identify each
in the context of the machine’s IP.</p>

<p>We differentiate between the following:</p>
<dl>
<dt>Well-known ports (from 0 to 1023)</dt>
<dd>
<p>These are for daemons such as an SSH server or a web server.
Using (binding to) one of them requires elevated privileges (<code>root</code> or <code>CAP_NET_BIND_SERVICE</code>
capability, as discussed in <a data-type="xref" href="ch04.xhtml#capabilities">“Capabilities”</a>).</p>
</dd>
<dt>Registered ports (from 1024 to 49151)</dt>
<dd>
<p>These are managed by Internet Assigned Numbers Authority (IANA)
through a publicly documented process.</p>
</dd>
<dt>Ephemeral ports (from 49152 to 65535)</dt>
<dd>
<p>These cannot be registered. They can be used
for automatically allocating a temporary port (for example, if your app
connects to a web server, it needs a port itself, as the other endpoint of
the communication) as well as for private (say, company-internal) services.</p>
</dd>
</dl>

<p class="pagebreak-after">You can see the ports and mapping in <em>/etc/services</em>, and further, there is a
comprehensive list of
<a href="https://oreil.ly/VBp7N">TCP and UDP
port numbers</a> you might want to consult if you’re unsure.</p>

<p>If you want to see what’s in use on your local machine (<em>do not</em> do this on
someone else’s machine/against a nonlocal IP):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>nmap</code><code> </code><code>-A</code><code> </code><code>localhost</code><code> </code><a class="co" id="co_networking_CO9-1" href="#callout_networking_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

</code><code>Starting</code><code> </code><code>Nmap</code><code> </code><code class="m">7</code><code>.60</code><code> </code><code class="o">(</code><code> </code><code>https://nmap.org</code><code> </code><code class="o">)</code><code> </code><code>at</code><code> </code><code class="m">2021</code><code>-09-19</code><code> </code><code class="m">14</code><code>:53</code><code> </code><code>IST</code><code>
</code><code>Nmap</code><code> </code><code>scan</code><code> </code><code>report</code><code> </code><code class="k">for</code><code> </code><code>localhost</code><code> </code><code class="o">(</code><code class="m">127</code><code>.0.0.1</code><code class="o">)</code><code>
</code><code>Host</code><code> </code><code>is</code><code> </code><code>up</code><code> </code><code class="o">(</code><code class="m">0</code><code>.00025s</code><code> </code><code>latency</code><code class="o">)</code><code>.</code><code>
</code><code>Not</code><code> </code><code>shown:</code><code> </code><code class="m">999</code><code> </code><code>closed</code><code> </code><code>ports</code><code>
</code><code>PORT</code><code>    </code><code>STATE</code><code> </code><code>SERVICE</code><code> </code><code>VERSION</code><code>
</code><code class="m">631</code><code>/tcp</code><code> </code><code>open</code><code>  </code><code>ipp</code><code>     </code><code>CUPS</code><code> </code><code class="m">2</code><code>.2</code><code> </code><a class="co" id="co_networking_CO9-2" href="#callout_networking_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="p">|</code><code> </code><code>http-methods:</code><code>
</code><code class="p">|</code><code>_</code><code>  </code><code>Potentially</code><code> </code><code>risky</code><code> </code><code>methods:</code><code> </code><code>PUT</code><code>
</code><code class="p">|</code><code> </code><code>http-robots.txt:</code><code> </code><code class="m">1</code><code> </code><code>disallowed</code><code> </code><code>entry</code><code>
</code><code class="p">|</code><code>_/</code><code>
</code><code class="p">|</code><code>_http-server-header:</code><code> </code><code>CUPS/2.2</code><code> </code><code>IPP/2.1</code><code>
</code><code class="p">|</code><code>_http-title:</code><code> </code><code>Home</code><code> </code><code>-</code><code> </code><code>CUPS</code><code> </code><code class="m">2</code><code>.2.7</code><code>

</code><code>Service</code><code> </code><code>detection</code><code> </code><code>performed.</code><code> </code><code>Please</code><code> </code><code>report</code><code> </code><code>any</code><code> </code><code>incorrect</code><code> </code><code>results</code><code>
</code><code>at</code><code> </code><code>https://nmap.org/submit/</code><code> </code><code>.</code><code>
</code><code>Nmap</code><code> </code><code class="k">done</code><code>:</code><code> </code><code class="m">1</code><code> </code><code>IP</code><code> </code><code>address</code><code> </code><code class="o">(</code><code class="m">1</code><code> </code><code>host</code><code> </code><code>up</code><code class="o">)</code><code> </code><code>scanned</code><code> </code><code class="k">in</code><code> </code><code class="m">6</code><code>.93</code><code> </code><code>seconds</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO9-1" href="#co_networking_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Scan ports on local machine.</p></dd>
<dt><a class="co" id="callout_networking_CO9-2" href="#co_networking_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Found one open port, 631, which is the Internet Printing Protocol (IPP).</p></dd>
</dl>

<p>With the general idea of ports explained, let’s now have a look how these ports
are used in different transport layer protocols.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Transmission Control Protocol"><div class="sect3" id="idm45805430683968">
<h3>Transmission Control Protocol</h3>

<p><a data-type="indexterm" data-primary="TCP (Transmission Control Protocol)" id="ix_ch07-asciidoc14"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="TCP layer" id="ix_ch07-asciidoc15"/><a data-type="indexterm" data-primary="Transmission Control Protocol (TCP)" id="ix_ch07-asciidoc16"/>The <em>Transmission Control Protocol</em> (TCP) is a connection-oriented transport
layer protocol that is used by a number of higher-level protocols, including
HTTP and SSH (see <a data-type="xref" href="#app-layer-net">“Application Layer Networking”</a>). It is a session-based protocol that guarantees
delivery of the packets in order and supports retransmission in case of errors.</p>

<p>The TCP header (<a data-type="xref" href="#fig-tcp-header">Figure 7-5</a>),
as defined in <a href="https://oreil.ly/4BY3T">RFC 793</a>
and related IETF specs, has these most important fields:</p>
<dl>
<dt>Source port (16 bits)</dt>
<dd>
<p>The port used by the sender.</p>
</dd>
<dt>Destination port (16 bits)</dt>
<dd>
<p>The port used by the receiver.</p>
</dd>
<dt>Sequence number (32 bits)</dt>
<dd>
<p>Used to manage in-order delivery.</p>
</dd>
<dt>Acknowledgment number (32 bits)</dt>
<dd>
<p>This number and the <code>SYN</code> and <code>ACK</code>
  flags are the core of the so-called
  <a href="https://oreil.ly/Icea3"><em>TCP/IP
  three-way handshake</em></a>.</p>
</dd>
<dt>Flags (9 bits)</dt>
<dd>
<p>Most important, the <code>SYN</code> (synchronize) and the <code>ACK</code> (acknowledgement) bits.</p>
</dd>
<dt>Window (16 bits)</dt>
<dd>
<p>The receive window size.</p>
</dd>
<dt>Checksum (16 bits)</dt>
<dd>
<p>A checksum of the TCP-header, used for error checking.</p>
</dd>
<dt>Data</dt>
<dd>
<p>The payload to transport.</p>
</dd>
</dl>

<figure><div id="fig-tcp-header" class="figure">
<img src="Images/lmlx_0705.png" alt="lmlx 0705" width="600" height="340"/>
<h6><span class="label">Figure 7-5. </span>The TCP header format as per RFC 793</h6>
</div></figure>

<p>TCP tracks the state of the connection from establishment to termination, with
both the sender and the receiver having to negotiate certain things, from how much
data to send (TCP window size) to QoS.</p>

<p>From a security perspective, TCP is without any defense mechanisms. In other
words, the payload is sent in plain text, and anyone between the sender and the
receiver (and there are by design many hops) can inspect the packet; see <a data-type="xref" href="#network-traffic-inspection">“Wireshark and tshark”</a> for details on using Wireshark and <code>tshark</code> to inspect the payload. To enable
encryption of the message, you need to use the Transport Layer Security (TLS)
protocol, ideally in version 1.3 as per
<a href="https://oreil.ly/6dTwf">RFC 8446</a>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc16" id="idm45805430492704"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc15" id="idm45805430491968"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc14" id="idm45805430491296"/></p>

<p>With that, let’s move on to the most important stateless transport layer protocol: UDP.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="User Datagram Protocol"><div class="sect3" id="idm45805430489872">
<h3>User Datagram Protocol</h3>

<p><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="UDP" id="idm45805430488496"/><a data-type="indexterm" data-primary="UDP (User Datagram Protocol)" id="idm45805430487296"/><a data-type="indexterm" data-primary="User Datagram Protocol (UDP)" id="idm45805430486608"/><em>User Datagram Protocol</em> (UDP) <a data-type="indexterm" data-primary="datagrams" id="idm45805430485536"/>is a connection-less transport layer protocol allowing
you to send messages, called <em>datagrams</em> in UDP, without communication setups (such
as TCP does with the handshake). It does, however, support datagram checksums to ensure
integrity. There are a number of application-level protocols, such as NTP and
DHCP (see <a data-type="xref" href="#app-layer-net">“Application Layer Networking”</a>) as well as DNS (see <a data-type="xref" href="#dns">“DNS”</a>), that use UDP.</p>

<p>The <a href="https://oreil.ly/dysc4">RFC 768</a> defines the UDP header
format as shown in <a data-type="xref" href="#fig-udp-header">Figure 7-6</a>. Its most important fields are the following:</p>
<dl>
<dt>Source port (16 bits)</dt>
<dd>
<p>The port used by the sender; optional, and if not, use 0</p>
</dd>
<dt>Destination port (16 bits)</dt>
<dd>
<p>The port used by the receiver</p>
</dd>
<dt>Length (16 bits)</dt>
<dd>
<p>The total length of the UDP header and data</p>
</dd>
<dt>Checksum (16 bits)</dt>
<dd>
<p>Can optionally be used for error checking</p>
</dd>
<dt>Data</dt>
<dd>
<p>The payload of the datagram</p>
</dd>
</dl>

<figure><div id="fig-udp-header" class="figure">
<img src="Images/lmlx_0706.png" alt="lmlx 0706" width="600" height="344"/>
<h6><span class="label">Figure 7-6. </span>The UDP header format as per RFC 768</h6>
</div></figure>

<p>UDP is a very simple protocol and requires the higher-level protocol that
works on top of it to take care of many of the things that TCP would handle
itself. On the other hand, UDP has very little overhead and can achieve
high throughput. It’s very simple to use; see also the
<a href="https://oreil.ly/NJiAQ">UDP manual page</a>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc13" id="idm45805430470112"/></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Sockets"><div class="sect2" id="sockets">
<h2>Sockets</h2>

<p><a data-type="indexterm" data-primary="sockets" id="idm45805430467504"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="sockets" id="idm45805430466800"/>A high-level communication interface that Linux provides are
<a href="https://oreil.ly/C7gQA"><em>sockets</em></a>.
Think of them as endpoints in a communication, with their
distinct identity: a tuple made up of the TCP or UDP port and the IP address.</p>

<p>It’s likely that you’ll only use sockets if you want to develop
network-related tooling or apps, but you should at least be aware of how
to query them. For example, in the context of the
 <a href="https://oreil.ly/OUD5V">Docker daemon</a>, you
 at least need to know about the required permissions for the socket.</p>

<p>Let’s have a look at how to use the
<a href="https://oreil.ly/qtCkK"><code>ss</code> command</a> to display
socket-related information.</p>

<p>Let’s assume we want to get an overview of the TCP sockets in use on the system:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ss</code><code> </code><code>-s</code><code> </code><a class="co" id="co_networking_CO10-1" href="#callout_networking_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Total:</code><code> </code><code class="m">913</code><code> </code><code class="o">(</code><code>kernel</code><code> </code><code class="m">0</code><code class="o">)</code><code>
</code><code>TCP:</code><code>   </code><code class="m">10</code><code> </code><code class="o">(</code><code>estab</code><code> </code><code class="m">4</code><code>,</code><code> </code><code>closed</code><code> </code><code class="m">1</code><code>,</code><code> </code><code>orphaned</code><code> </code><code class="m">0</code><code>,</code><code> </code><code>synrecv</code><code> </code><code class="m">0</code><code>,</code><code> </code><code>timewait</code><code> </code><code class="m">1</code><code>/0</code><code class="o">)</code><code>,</code><code> </code><code>ports</code><code> </code><code class="m">0</code><code> </code><a class="co" id="co_networking_CO10-2" href="#callout_networking_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>

</code><code>Transport</code><code> </code><code>Total</code><code>     </code><code>IP</code><code>        </code><code>IPv6</code><code> </code><a class="co" id="co_networking_CO10-3" href="#callout_networking_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>*</code><code>         </code><code class="m">0</code><code>         </code><code>-</code><code>         </code><code>-</code><code>
</code><code>RAW</code><code>       </code><code class="m">1</code><code>         </code><code class="m">0</code><code>         </code><code class="m">1</code><code>
</code><code>UDP</code><code>       </code><code class="m">10</code><code>        </code><code class="m">8</code><code>         </code><code class="m">2</code><code>
</code><code>TCP</code><code>       </code><code class="m">9</code><code>         </code><code class="m">8</code><code>         </code><code class="m">1</code><code>
</code><code>INET</code><code>      </code><code class="m">20</code><code>        </code><code class="m">16</code><code>        </code><code class="m">4</code><code>
</code><code>FRAG</code><code>      </code><code class="m">0</code><code>         </code><code class="m">0</code><code>         </code><code class="m">0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO10-1" href="#co_networking_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>ss</code> command to query ports (with <code>-s</code>, we ask for a summary).</p></dd>
<dt><a class="co" id="callout_networking_CO10-2" href="#co_networking_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The summary for TCP; overall, 10 sockets in use.</p></dd>
<dt><a class="co" id="callout_networking_CO10-3" href="#co_networking_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>A more detailed overview, breaking down by type and IP version.</p></dd>
</dl>

<p>Now, what about UDP? Can we get this information, maybe with some more details, such
as endpoint IP addresses? Turns out this is also possible with <code>ss</code>
(output edited):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ss</code><code> </code><code>-ulp</code><code> </code><a class="co" id="co_networking_CO11-1" href="#callout_networking_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>State</code><code>    </code><code>Recv-Q</code><code>  </code><code>Send-Q</code><code>   </code><code>Local</code><code> </code><code>Address:Port</code><code>     </code><code>Peer</code><code> </code><code>Address:Port</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>              </code><code class="m">0</code><code>.0.0.0:60360</code><code>         </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>        </code><code class="m">127</code><code>.0.0.53%lo:domain</code><code>        </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>              </code><code class="m">0</code><code>.0.0.0:bootpc</code><code>        </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>              </code><code class="m">0</code><code>.0.0.0:ipp</code><code>           </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>              </code><code class="m">0</code><code>.0.0.0:mdns</code><code>          </code><code class="m">0</code><code>.0.0.0:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>                 </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:mdns</code><code>             </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:*</code><code>
</code><code>UNCONN</code><code>   </code><code class="m">0</code><code>       </code><code class="m">0</code><code>                 </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:38359</code><code>            </code><code class="o">[</code><code>::</code><code class="o">]</code><code>:*</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO11-1" href="#co_networking_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>ss</code>: the <code>-u</code> parameter restricts to UDP sockets, <code>-l</code> is for selecting
listening sockets, and <code>-p</code> also shows the process information (none in our case).</p></dd>
</dl>

<p>Another tool you might find handy in this context (sockets and processes) is
<a href="https://oreil.ly/YBhMB"><code>lsof</code></a>. For example, let’s see
what UDP sockets Chrome uses on my machine (output edited):</p>

<pre data-type="programlisting" data-code-language="shell"><code> </code><code>$</code><code> </code><code>lsof</code><code> </code><code>-c</code><code> </code><code>chrome</code><code> </code><code>-i</code><code> </code><code>udp</code><code> </code><code class="p">|</code><code> </code><code>head</code><code> </code><code>-5</code><code> </code><a class="co" id="co_networking_CO12-1" href="#callout_networking_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>COMMAND</code><code>   </code><code>PID</code><code> </code><code>USER</code><code>   </code><code>FD</code><code>  </code><code>TYPE</code><code>   </code><code>DEVICE</code><code>     </code><code>NODE</code><code> </code><code>NAME</code><code>
</code><code>chrome</code><code>   </code><code class="m">3131</code><code>  </code><code>mh9</code><code>  </code><code>cwd</code><code>   </code><code>DIR</code><code>      </code><code class="m">0</code><code>,5</code><code>   </code><code class="m">265463</code><code> </code><code>/proc/5321/fdinfo</code><code>
</code><code>chrome</code><code>   </code><code class="m">3131</code><code>  </code><code>mh9</code><code>  </code><code>rtd</code><code>   </code><code>DIR</code><code>      </code><code class="m">0</code><code>,5</code><code>   </code><code class="m">265463</code><code> </code><code>/proc/5321/fdinfo</code><code>
</code><code>chrome</code><code>   </code><code class="m">3131</code><code>  </code><code>mh9</code><code>  </code><code>txt</code><code>   </code><code>REG</code><code>    </code><code class="m">253</code><code>,0</code><code>  </code><code class="m">3673554</code><code> </code><code>/opt/google/chrome/chrome</code><code>
</code><code>chrome</code><code>   </code><code class="m">3131</code><code>  </code><code>mh9</code><code>  </code><code>mem</code><code>   </code><code>REG</code><code>    </code><code class="m">253</code><code>,0</code><code>  </code><code class="m">3673563</code><code> </code><code>/opt/google/chrome/icudtl.dat</code><code>
</code><code>chrome</code><code>   </code><code class="m">3131</code><code>  </code><code>mh9</code><code>  </code><code>mem</code><code>   </code><code>REG</code><code>    </code><code class="m">253</code><code>,0</code><code> </code><code class="m">12986737</code><code> </code><code>/usr/lib/locale/locale-archive</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO12-1" href="#co_networking_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>lsof</code> with <code>-c</code> to specifically select a process by name as well as
limit to UDP with <code>-i</code>. Note that the overall output would be many dozens
of lines; that’s why I cut it down to five with the <code>head -5</code> command in the
pipe.</p></dd>
</dl>

<p>With that we’ve covered the three lower layers of the TCP/IP stack. Since the
application layer has so much going on, I’ve dedicated two sections
to it: first, we’re looking into the global-scale naming system, and then we’ll look into
a number of application layer (or layer 7) protocols and applications, such
as the web.<a data-type="indexterm" data-startref="ix_ch07-asciidoc3" id="idm45805430165312"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc2" id="idm45805430164608"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc1" id="idm45805430163936"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="DNS"><div class="sect1" id="dns">
<h1>DNS</h1>

<p><a data-type="indexterm" data-primary="DNS (Domain Name System)" id="ix_ch07-asciidoc17"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="DNS" id="ix_ch07-asciidoc18"/>We learned that the internet layer of the TCP/IP stack defines so-called IP
addresses whose main function it is to identify machines, virtual or physical
alike. In the context of <a data-type="xref" href="ch06.xhtml#containers">“Containers”</a>, we go so far as to assign IP
addresses to individual containers. There are two challenges with numerical
IP addresses, no matter if IPv4 or IPv6:</p>

<ul>
<li>
<p>As humans, we generally remember names better than we do (long) numbers. For
example, if you want to share a website with a friend, you can just say
it’s <a class="orm:hideurl" href="https://ietf.org"><em>ietf.org</em></a> they should check out rather than <code>4.31.198.44</code>.</p>
</li>
<li>
<p>Due to the way the internet and its applications are built, IP addresses
often change. You might get a new server with a new IP address
in a more traditional setup. Or, in the context of containers, you may
be rescheduled onto a different host, in which case the container automatically
gets a new IP address assigned.</p>
</li>
</ul>

<p>So, in a nutshell, IP addresses are hard to remember and can change, while a
name (for a server or a service) remains the same. This challenge has existed
since the beginning of the internet and since UNIX supported the TCP/IP
stack.</p>

<p>The way to address this was to locally (in the context of a single
machine) maintain a mapping between names and IP addresses via <em>/etc/hosts</em>.
The Network Information Center (NIC) would share a
single file called <em>HOSTS.TXT</em> via FTP with all participating hosts.</p>

<p>Very soon it became clear that this centralized approach could not keep up
with the growing internet, and in the early 1980s, a distributed system
was designed. Paul Mockapetris was the lead architect.</p>

<p>The DNS is a worldwide, hierarchical naming system
for hosts and services on the internet. While there are many related RFCs,
the original one, <a href="https://oreil.ly/rbQNY">RFC 1034</a>, and
its implementation guidance via <a href="https://oreil.ly/c1eYB">RFC
1035</a> are still valid, and I strongly recommend you read them if you want to learn
more about the motivation and design.</p>

<p>The DNS uses a number of terms, but the following are the main concepts:</p>
<dl>
<dt>Domain name space</dt>
<dd>
<p>A tree structure with <code>.</code> as the root and each tree node and leaf
containing information about a certain space. The labels (63 bytes maximum
length) along the path from a leaf to the root is what we call a <em>fully qualified domain name</em> (FQDN).
For example, <em>demo.mhausenblas.info.</em> is an FQDN with the so-called top-level
domain <em>.info</em>. Note that the right-most dot, the root, is often left off.</p>
</dd>
<dt>Resource records</dt>
<dd>
<p>The payload in the nodes or leaves of the domain name space (see <a data-type="xref" href="#dns-records">“DNS Records”</a>).</p>
</dd>
<dt>Name servers</dt>
<dd>
<p>Server programs that hold information about the domain tree’s structure.
If a name server has the complete information about a space, it’s called
an <em>authoritative name server</em>. Authoritative information is organized into zones.</p>
</dd>
<dt>Resolvers</dt>
<dd>
<p>Programs that extract information from name servers in response to client
requests. They are machine local, and no explicit protocol is defined for the
interaction between a resolver and a client. Often there are library
calls supported for resolving the DNS.</p>
</dd>
</dl>

<p><a data-type="xref" href="#fig-dns-example">Figure 7-7</a> shows a complete setup of a DNS system, including user
program, resolver, and name server(s), as described in RFC 1035. In the query
process, the resolver would iteratively query authoritative name servers (NS)
starting from the root or, if supported, using a recursive query where an NS
queries others on behalf of a resolver.</p>

<figure><div id="fig-dns-example" class="figure">
<img src="Images/lmlx_0707.png" alt="lmlx 0707" width="600" height="567"/>
<h6><span class="label">Figure 7-7. </span>A complete DNS example setup</h6>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Although they’re still around, we usually don’t use the DNS
<a href="https://oreil.ly/2plq1">resolver configuration</a>
in <em>/etc/resolv.conf</em> in modern systems, especially when DHCP
(see <a data-type="xref" href="#dhcp">“Dynamic Host Configuration Protocol”</a>) is deployed.</p>
</div>

<p>The DNS is a hierarchical naming system, and at its root sit 13
<a href="https://oreil.ly/hNppq">root servers</a> that manage the
records for the top-level domains. <a data-type="indexterm" data-primary="top-level domains (TLD)" id="idm45805430108608"/>Directly beneath the root are the
<a href="https://oreil.ly/secgy">top-level domains (TLD)</a>:</p>
<dl>
<dt>Infrastructure top-level domain</dt>
<dd>
<p>Managed by IANA on behalf of the IETF and including, for example, <em>example</em> and <em>localhost</em></p>
</dd>
<dt>Generic top-level domains (gTLD)</dt>
<dd>
<p>Generic domains having three or more characters, such as <em>.org</em>
  or <em>.com</em></p>
</dd>
<dt>Country-code top-level domains (ccTLD)</dt>
<dd>
<p>For countries or territories
  assigned <a href="https://oreil.ly/lBWjD">two-letter ISO country codes</a></p>
</dd>
<dt>Sponsored top-level domains (sTLD)</dt>
<dd>
<p>For private agencies or organizations that
  establish and enforce rules restricting the eligibility to use the TLD—for
  example, <em>.aero</em> and <em>.gov</em></p>
</dd>
</dl>

<p>Let’s have a closer look at some moving parts of the DNS and how to use it in 
<span class="keep-together">practice.</span></p>








<section data-type="sect2" data-pdf-bookmark="DNS Records"><div class="sect2" id="dns-records">
<h2>DNS Records</h2>

<p><a data-type="indexterm" data-primary="DNS (Domain Name System)" data-secondary="records" id="ix_ch07-asciidoc19"/>A name server manages records that capture the type, the payload, and other fields,
including things like the time to live (TTL), the time period after which the record
is supposed to be discarded. You can think of the FQDN as the address of the
node and the resource record (RR) as the payload, the data in the node.</p>

<p>DNS has a number of <a href="https://oreil.ly/5QTJ9">record types</a>,
including the following most important ones (in alphabetical order):</p>
<dl>
<dt><code>A</code> records (RFC 1035) and <code>AAAA</code> records (RFC 3596)</dt>
<dd>
<p>IPv4 and IPv6 address records, respectively; usually used to map hostnames to an IP address of the host.</p>
</dd>
<dt><code>CNAME</code> records  (RFC 1035)</dt>
<dd>
<p>Canonical name records providing an alias of one name to another.</p>
</dd>
<dt><code>NS</code> records (RFC 1035)</dt>
<dd>
<p>Name server records delegating a DNS zone to use
  the authoritative name servers.</p>
</dd>
<dt><code>PTR</code> records (RFC 1035)</dt>
<dd>
<p>Pointer records used for performing reverse DNS lookups;
   the opposite of <code>A</code> records.</p>
</dd>
<dt><code>SRV</code> records (RFC 2782)</dt>
<dd>
<p>Service locator records. They are a generalized discovery
  mechanism, rather than hardcoded (as traditionally was the case with the <code>MX</code>
  record type for mail exchange).</p>
</dd>
<dt><code>TXT</code> records (RFC 1035)</dt>
<dd>
<p>Text records. These were originally meant for
   arbitrary human-readable text but over time found a new use case. Today,
   these records often have machine-readable data in the context of security-related DNS extensions.</p>
</dd>
</dl>

<p class="pagebreak-after">There are also <a href="https://oreil.ly/yL039">wildcard
records</a> starting with the asterisk label (<code>*</code>)—for example, <em>*.mhausenblas.info</em>—as a catch-all to match requests for nonexistent names.</p>

<p>Let’s see how these records look in practice. The DNS records are
represented in a textual form in a
<a href="https://oreil.ly/4Ngai">zone file</a> that a name server—such as <a href="https://oreil.ly/095v2">bind</a>—reads in and makes part of its database:</p>

<pre data-type="programlisting">$ORIGIN example.com. <a class="co" id="co_networking_CO13-1" href="#callout_networking_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a>
$TTL 3600 <a class="co" id="co_networking_CO13-2" href="#callout_networking_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a>
@	SOA nse.example.com. nsmaster.example.com. (
		1234567890 ; serial number
		21600      ; refresh after 6 hours
		3600       ; retry after 1 hour
		604800     ; expire after 1 week
		3600 )     ; minimum TTL of 1 hour
example.com.  IN  NS    nse <a class="co" id="co_networking_CO13-3" href="#callout_networking_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a>
example.com.  IN  MX    10 mail.example.com. <a class="co" id="co_networking_CO13-4" href="#callout_networking_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a>
example.com.  IN  A     1.2.3.4 <a class="co" id="co_networking_CO13-5" href="#callout_networking_CO13-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a>
nse           IN  A     5.6.7.8 <a class="co" id="co_networking_CO13-6" href="#callout_networking_CO13-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a>
www           IN  CNAME example.com. <a class="co" id="co_networking_CO13-7" href="#callout_networking_CO13-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a>
mail          IN  A     9.0.0.9 <a class="co" id="co_networking_CO13-8" href="#callout_networking_CO13-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO13-1" href="#co_networking_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The start of this zone file in the namespace.</p></dd>
<dt><a class="co" id="callout_networking_CO13-2" href="#co_networking_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Default expiration time in seconds of all RRs that don’t define their own TTL.</p></dd>
<dt><a class="co" id="callout_networking_CO13-3" href="#co_networking_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The nameserver for this domain.</p></dd>
<dt><a class="co" id="callout_networking_CO13-4" href="#co_networking_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The mailserver for this domain.</p></dd>
<dt><a class="co" id="callout_networking_CO13-5" href="#co_networking_CO13-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The IPv4 address for this domain.</p></dd>
<dt><a class="co" id="callout_networking_CO13-6" href="#co_networking_CO13-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>The IPv4 address for the nameserver.</p></dd>
<dt><a class="co" id="callout_networking_CO13-7" href="#co_networking_CO13-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Make <em>www.example.com</em> an alias for this domain—that is, <em>example.com</em>.</p></dd>
<dt><a class="co" id="callout_networking_CO13-8" href="#co_networking_CO13-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>The IPv4 address for the mail server.</p></dd>
</dl>

<p>Putting all the concepts discussed together, we can now understand the
example shown in <a data-type="xref" href="#fig-dns-space-example">Figure 7-8</a>. This shows a part of the
global domain name space and a concrete example FQDN, <em>demo.mhausenblas.info</em>:</p>
<dl>
<dt><em>.info</em></dt>
<dd>
<p>A generic TLD managed by a company called <a href="https://www.afilias.info">Afilias</a>.</p>
</dd>
<dt><em>mhausenblas.info</em></dt>
<dd>
<p>A domain I bought. Within this zone I can assign subdomains as I please.</p>
</dd>
<dt><em>demo.mhausenblas.info</em></dt>
<dd>
<p>The subdomain I assigned for demo purposes.</p>
</dd>
</dl>

<figure><div id="fig-dns-space-example" class="figure">
<img src="Images/lmlx_0708.png" alt="lmlx 0708" width="600" height="437"/>
<h6><span class="label">Figure 7-8. </span>The domain name space and an example path (FQDN)</h6>
</div></figure>

<p>Consider how in the previous example each entity (Afilias or me) only looks
after its part, and no coordination is required. For example,
to create the <em>demo</em> subdomain, I only had to change my DNS settings
for the zone, without asking anyone at Afilias for support or permissions.
This seemingly simple fact is the core of the decentralized nature of DNS and is
what makes it so scalable.<a data-type="indexterm" data-startref="ix_ch07-asciidoc19" id="idm45805430028032"/></p>

<p>Now that we know how the domain name space is structured and the information
in the nodes is represented, let’s see how you can query them.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="DNS Lookups"><div class="sect2" id="idm45805430096496">
<h2>DNS Lookups</h2>

<p><a data-type="indexterm" data-primary="DNS (Domain Name System)" data-secondary="lookups" id="ix_ch07-asciidoc20"/>With all the infrastructure in place, mainly nameservers and resolvers, we now
look at performing DNS queries. There is a lot of logic in the evaluation and
construction of the resolution (mostly covered in RFC 1034 and 1035), but this
is beyond the scope of the book. Let’s have a look at how you can do the query
without having to understand the internals.</p>

<p>You can use the <code>host</code> command to query local (and global) names to resolve them
to IP addresses and the other way around:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>host</code><code> </code><code>-a</code><code> </code><code>localhost</code><code> </code><a class="co" id="co_networking_CO14-1" href="#callout_networking_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Trying</code><code> </code><code class="s2">"localhost.fritz.box"</code><code>
</code><code>Trying</code><code> </code><code class="s2">"localhost"</code><code>
</code><code class="p">;</code><code class="p">;</code><code> </code><code>-&gt;&gt;HEADER</code><code class="s">&lt;&lt;- opco</code><code>de:</code><code> </code><code>QUERY,</code><code> </code><code>status:</code><code> </code><code>NOERROR,</code><code> </code><code>id:</code><code> </code><code class="m">49150</code><code>
</code><code class="p">;</code><code class="p">;</code><code> </code><code>flags:</code><code> </code><code>qr</code><code> </code><code>rd</code><code> </code><code>ra</code><code class="p">;</code><code> </code><code>QUERY:</code><code> </code><code class="m">1</code><code>,</code><code> </code><code>ANSWER:</code><code> </code><code class="m">2</code><code>,</code><code> </code><code>AUTHORITY:</code><code> </code><code class="m">0</code><code>,</code><code> </code><code>ADDITIONAL:</code><code> </code><code class="m">0</code><code>

</code><code class="p">;</code><code class="p">;</code><code> </code><code>QUESTION</code><code> </code><code>SECTION:</code><code>
</code><code class="p">;</code><code>localhost.</code><code>                     </code><code>IN</code><code>      </code><code>ANY</code><code>

</code><code class="p">;</code><code class="p">;</code><code> </code><code>ANSWER</code><code> </code><code>SECTION:</code><code>
</code><code>localhost.</code><code>              </code><code class="m">0</code><code>       </code><code>IN</code><code>      </code><code>A</code><code>       </code><code class="m">127</code><code>.0.0.1</code><code>
</code><code>localhost.</code><code>              </code><code class="m">0</code><code>       </code><code>IN</code><code>      </code><code>AAAA</code><code>    </code><code>::1</code><code>

</code><code>Received</code><code> </code><code class="m">71</code><code> </code><code>bytes</code><code> </code><code>from</code><code> </code><code class="m">127</code><code>.0.0.53#53</code><code> </code><code class="k">in</code><code> </code><code class="m">0</code><code> </code><code>ms</code><code>

</code><code>$</code><code> </code><code>host</code><code> </code><code>mhausenblas.info</code><code> </code><a class="co" id="co_networking_CO14-2" href="#callout_networking_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>mhausenblas.info</code><code> </code><code>has</code><code> </code><code>address</code><code> </code><code class="m">185</code><code>.199.110.153</code><code>
</code><code>mhausenblas.info</code><code> </code><code>has</code><code> </code><code>address</code><code> </code><code class="m">185</code><code>.199.109.153</code><code>
</code><code>mhausenblas.info</code><code> </code><code>has</code><code> </code><code>address</code><code> </code><code class="m">185</code><code>.199.111.153</code><code>
</code><code>mhausenblas.info</code><code> </code><code>has</code><code> </code><code>address</code><code> </code><code class="m">185</code><code>.199.108.153</code><code>

</code><code>$</code><code> </code><code>host</code><code> </code><code class="m">185</code><code>.199.110.153</code><code> </code><a class="co" id="co_networking_CO14-3" href="#callout_networking_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="m">153</code><code>.110.199.185.in-addr.arpa</code><code> </code><code>domain</code><code> </code><code>name</code><code> </code><code>pointer</code><code> </code><code>cdn-185-199-110-153.github.com.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO14-1" href="#co_networking_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Look up local IP addresses.</p></dd>
<dt><a class="co" id="callout_networking_CO14-2" href="#co_networking_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Look up FQDN.</p></dd>
<dt><a class="co" id="callout_networking_CO14-3" href="#co_networking_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Reverse lookup of IP address to find an FQDN; looks like the GitHub CDN.</p></dd>
</dl>

<p>A more powerful way to look up the DNS records is using the <code>dig</code> command:</p>

<pre data-type="programlisting" class="widows10">$ dig mhausenblas.info <a class="co" id="co_networking_CO15-1" href="#callout_networking_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a>
; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; mhausenblas.info
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 43159
;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 2, ADDITIONAL: 5

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;mhausenblas.info.              IN      A

;; ANSWER SECTION: <a class="co" id="co_networking_CO15-2" href="#callout_networking_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a>
mhausenblas.info.       1799    IN      A       185.199.111.153
mhausenblas.info.       1799    IN      A       185.199.108.153
mhausenblas.info.       1799    IN      A       185.199.109.153
mhausenblas.info.       1799    IN      A       185.199.110.153

;; AUTHORITY SECTION: <a class="co" id="co_networking_CO15-3" href="#callout_networking_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a>
mhausenblas.info.       1800    IN      NS      dns1.registrar-servers.com.
mhausenblas.info.       1800    IN      NS      dns2.registrar-servers.com.

;; ADDITIONAL SECTION:
dns1.registrar-servers.com. 47950 IN    A       156.154.132.200
dns2.registrar-servers.com. 47950 IN    A       156.154.133.200
dns1.registrar-servers.com. 28066 IN    AAAA    2610:a1:1024::200
dns2.registrar-servers.com. 28066 IN    AAAA    2610:a1:1025::200

;; Query time: 58 msec
;; SERVER: 172.16.173.64#53(172.16.173.64)
;; WHEN: Wed Sep 15 19:22:26 IST 2021
;; MSG SIZE  rcvd: 256</pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO15-1" href="#co_networking_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Using <code>dig</code>, look up the DNS records of the FQDN <em>mhausenblas.info</em>.</p></dd>
<dt><a class="co" id="callout_networking_CO15-2" href="#co_networking_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The DNS A records.</p></dd>
<dt><a class="co" id="callout_networking_CO15-3" href="#co_networking_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The authoritative nameserver.</p></dd>
</dl>

<p>There are alternatives to the <code>dig</code> command available, notably <code>dog</code> and
<code>nslookup</code>; see <a data-type="xref" href="app02.xhtml#appendix-modern">Appendix B</a>.</p>
<div data-type="tip"><h6>Tip</h6>
<p>One saying you will come across often is: “It’s always DNS.” But what does this
mean? It’s about troubleshooting and understanding that DNS is a distributed
database with many moving parts. When debugging DNS-related issues, consider
the TTL of records and that there are many caches, from local ones in your
app to resolver, to anything between you and the nameservers.</p>
</div>

<p>In <a data-type="xref" href="#dns-records">“DNS Records”</a>, we mentioned the <code>SRV</code> record type and that it serves as a
generic discovery mechanism. So, rather than defining a new record type for
a new service in an RFC, the community came up with a generic way to
address any upcoming service type. This mechanism, described in
<a href="https://oreil.ly/DIKbI">RFC 2782</a>, explains how <code>SRV</code>
records can be used to communicate the IP address and port of a service via DNS.</p>

<p>Let’s see that in practice. Say we want to know what chat services—more
specifically, <a href="https://oreil.ly/rDmcx">Extensible Messaging and Presence
Protocol (XMPP)</a> services—if any, are available:</p>
<pre data-type="programlisting" class="pagebreak-after" data-code-language="shell"><code>$</code><code> </code><code>dig</code><code> </code><code>+short</code><code> </code><code>_xmpp-client._tcp.gmail.com.</code><code> </code><code>SRV</code><code> </code><a class="co" id="custom_co_networking_CO16-1" href="#custom_callout_networking_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="m">20</code><code> </code><code class="m">0</code><code> </code><code class="m">5222</code><code> </code><code>alt3.xmpp.l.google.com.</code><code>
</code><code class="m">5</code><code> </code><code class="m">0</code><code> </code><code class="m">5222</code><code> </code><code>xmpp.l.google.com.</code><code> </code><a class="co" id="custom_co_networking_CO16-2" href="#custom_callout_networking_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="m">20</code><code> </code><code class="m">0</code><code> </code><code class="m">5222</code><code> </code><code>alt4.xmpp.l.google.com.</code><code>
</code><code class="m">20</code><code> </code><code class="m">0</code><code> </code><code class="m">5222</code><code> </code><code>alt2.xmpp.l.google.com.</code><code>
</code><code class="m">20</code><code> </code><code class="m">0</code><code> </code><code class="m">5222</code><code> </code><code>alt1.xmpp.l.google.com.</code></pre>
<dl class="calloutlist">
<dt class="less_space"><a class="co" id="custom_callout_networking_CO16-1" href="#custom_co_networking_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>dig</code> command with the <code>+short</code> option to display only the relevant
answer section. The <em>_xmpp-client._tcp</em> part is the format RFC 2782
prescribes, and the <code>SRV</code> at the end of this command specifies what record
type we’re interested in.</p></dd>
<dt><a class="co" id="custom_callout_networking_CO16-2" href="#custom_co_networking_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Overall there are five answers. An example service instance is available
at <em>xmpp.l.google.com:5222</em> with a TTL of 5 seconds. If you have an XMPP
such as Jabber, you could use this address for configuration input.</p></dd>
</dl>

<p>With this, we’ve reached the end of the DNS section<a data-type="indexterm" data-startref="ix_ch07-asciidoc20" id="idm45805429808464"/>.<a data-type="indexterm" data-startref="ix_ch07-asciidoc18" id="idm45805429807632"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc17" id="idm45805429806928"/> Now we’ll have a look
at other application layer protocols and tooling.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Application Layer Networking"><div class="sect1" id="app-layer-net">
<h1>Application Layer Networking</h1>

<p><a data-type="indexterm" data-primary="application layer networking" id="ix_ch07-asciidoc21"/><a data-type="indexterm" data-primary="TCP/IP stack" data-secondary="application layer" id="ix_ch07-asciidoc22"/>In this section, we focus on user space or application layer network
protocols, tooling, and apps. As an end user, you’ll likely spend
most of your time here, using things such as web browsers or mail clients for your
daily tasks.</p>








<section data-type="sect2" data-pdf-bookmark="The Web"><div class="sect2" id="www">
<h2>The Web</h2>

<p><a data-type="indexterm" data-primary="application layer networking" data-secondary="web and" id="ix_ch07-asciidoc23"/><a data-type="indexterm" data-primary="web" id="ix_ch07-asciidoc24"/>The web, originally developed by Sir Tim Berners-Lee in the early 1990s,
has three core components:</p>
<dl>
<dt>Uniform Resource Locators (URL)</dt>
<dd>
<p><a data-type="indexterm" data-primary="Uniform Resource Locator (URL)" id="idm46210158654608"/><a data-type="indexterm" data-primary="URL (Uniform Resource Locator)" id="idm46210158653936"/>As per <a href="https://oreil.ly/EfgPm">RFC 1738</a> originally
and a number of updates and related RFCs. A URL defines both the identity
and the location of a resource on the web. A resource could be a static
page or a process that generates content dynamically.</p>
</dd>
<dt>Hypertext Transfer Protocol (HTTP)</dt>
<dd>
<p><a data-type="indexterm" data-primary="Hypertext Transfer Protocol (HTTP)" id="idm46210158651280"/>HTTP defines an application layer protocol and how to interact with content
available via URLs. As per <a href="https://oreil.ly/hGr3E">RFC 2616</a>
for v1.1, but there are also more modern versions, such as HTTP/2, defined in
<a href="https://oreil.ly/1Z6pn">RFC 7540</a>, and the
<a href="https://oreil.ly/XRkMf">HTTP/3 draft</a>
(which at the time of this writing was still in the works). Core HTTP concepts are:</p>
<dl>
<dt><a href="https://oreil.ly/FFWuP">HTTP methods</a></dt>
<dd>
<p>Including <code>GET</code> for read operations and, among others, <code>POST</code> for write
operations, these define a CRUD-like interface.</p>
</dd>
<dt><a href="https://oreil.ly/ttnOq">Resource naming</a></dt>
<dd>
<p>This dictates how to form URLs.</p>
</dd>
<dt class="pagebreak-before less_space"><a href="https://oreil.ly/LppmX">HTTP status codes</a></dt>
<dd>
<p>With the <code>2xx</code> range for success, <code>3xx</code> for redirects, <code>4xx</code> for client errors,
and <code>5xx</code> for server errors.</p>
</dd>
</dl>
</dd>
<dt>Hyper Text Markup Language (HTML)</dt>
<dd>
<p><a data-type="indexterm" data-primary="Hyper Text Markup Language (HTML)" id="idm46210158638048"/>Initially a W3C specification, HTML is now a living standard available
via <a href="https://oreil.ly/lUcHo">WHATWG</a>. A hypertext markup
allows you to define page elements such as headers or inputs.</p>
</dd>
</dl>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45805429776560">
<h5>W3C and standards</h5>
<p><a data-type="indexterm" data-primary="standards, W3C and" id="idm45805429775360"/><a data-type="indexterm" data-primary="W3C (World Wide Web Consortium)" id="idm45805429774656"/>Technically neither IETF nor W3C (World Wide Web Consortium) do standards.
They create specifications through formal processes that the community accepts
as de facto standards. I strongly recommend that you read these specifications and
try to understand what’s going in there. For me, in 2006, after using
and building web sites and applications for almost a decade, I started
to take this seriously (when I got involved in W3C efforts), and the payoff
was enormous.</p>
</div></aside>

<p>Let’s have a closer look at how URIs (the generic version of URLs)
are constructed (as per RFC 3986) and how that maps to HTTP URLs:</p>

<pre data-type="programlisting">michaelh:12345678@http://example.com:4242/this/is/the/way?orisit=really#another
\______/ \______/ \__/   \_____________/\______________/ \___________/ \_____/
   |        |       |          |                |              |          |
   v        v       v          v                v              v          v
user password  scheme  authority             path          query   fragment</pre>

<p>The components are as follows:</p>
<dl>
<dt><code>user</code> and <code>password</code> (both optional)</dt>
<dd>
<p>Initially used for basic authentication, these components should not be used
anymore.  Instead, for HTTP, you should be using a proper
<a href="https://oreil.ly/EHNfN">authentication
mechanism</a> together with <a href="https://oreil.ly/Dvuh4">HTTPS</a> for
encryption on the wire.</p>
</dd>
<dt><code>scheme</code></dt>
<dd>
<p>Refers to the <a href="https://oreil.ly/R9QeW">URL
  scheme</a>, an IETF specification defining its meaning. For
  HTTP, that scheme is called <code>http</code>, which really is a family of HTTP specifications,
  such as RFC 2616.</p>
</dd>
<dt><code>authority</code></dt>
<dd>
<p>The hierarchical naming part. For HTTP, this is:</p>
<dl>
<dt>Hostname</dt>
<dd>
<p>Either as a DNS FQDN or an IP address.</p>
</dd>
<dt>Port</dt>
<dd>
<p>With a default of 80 (so <em>example.com:80</em> and <em>example.com</em> are the same).</p>
</dd>
</dl>
</dd>
<dt><code>path</code></dt>
<dd>
<p>A scheme-specific part for further resource details.</p>
</dd>
<dt><code>query</code> and <code>fragment</code> (both optional)</dt>
<dd>
<p>The former appears after the <code>?</code> for nonhierarchical
  data (for example, to express tags or form data), and the latter appears after the
  <code>#</code> for secondary resources (in the context of HTML, that could be a section).</p>
</dd>
</dl>

<p>Today, the web has advanced far beyond its humble 1990s roots, with a
number of technologies such as
<a href="https://oreil.ly/b8kFe">JavaScript/ECMAScript</a> and
<a href="https://oreil.ly/rSlYl">Cascading Style Sheets (CSS)</a>
considered core. Those additions, JavaScript for dynamic client-side content
and CSS for styling, have eventually led to
<a href="https://oreil.ly/E1SJu">single-page web apps</a>.
While this topic is beyond the scope of the book, it’s important to remember
that knowing the basics (URL, HTTP, and HTML) well goes a long way in terms of
understanding how things work and troubleshooting issues you may have.</p>

<p>Let’s now see web specifications in action by simulating the flow end to end,
starting at the HTTP server end.</p>

<p>You can rather easily run a simple HTTP server that only serves the content
of a directory in two ways: by using <a href="https://oreil.ly/clti0">Python</a>
or by using <a href="https://oreil.ly/AaCJG">netcat (<code>nc</code>)</a>.</p>

<p>With Python, to serve the content of a directory, you would do the following:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>python3</code><code> </code><code>-m</code><code> </code><code>http.server</code><code> </code><a class="co" id="co_networking_CO16-1" href="#callout_networking_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Serving</code><code> </code><code>HTTP</code><code> </code><code>on</code><code> </code><code>::</code><code> </code><code>port</code><code> </code><code class="m">8000</code><code> </code><code class="o">(</code><code>http://</code><code class="o">[</code><code>::</code><code class="o">]</code><code>:8000/</code><code class="o">)</code><code> </code><code>...</code><code> </code><a class="co" id="co_networking_CO16-2" href="#callout_networking_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>::ffff:127.0.0.1</code><code> </code><code>-</code><code> </code><code>-</code><code> </code><code class="o">[</code><code class="m">21</code><code>/Sep/2021</code><code> </code><code class="m">08</code><code>:53:53</code><code class="o">]</code><code> </code><code class="s2">"GET / HTTP/1.1"</code><code> </code><code class="m">200</code><code> </code><code>-</code><code> </code><a class="co" id="co_networking_CO16-3" href="#callout_networking_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO16-1" href="#co_networking_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the built-in Python module <code>http.server</code> to serve the content of the
current directory (that is, the directory from which you launched this command).</p></dd>
<dt><a class="co" id="callout_networking_CO16-2" href="#co_networking_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>It confirms that it’s ready to serve via port 8000. This means that you
could enter <em><a href="http://localhost:8000"><em class="hyperlink">http://localhost:8000</em></a></em> into your browser and you would see the
content of your directory there.</p></dd>
<dt><a class="co" id="callout_networking_CO16-3" href="#co_networking_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This shows that an HTTP request against the root (<em>/</em>) has been issued
and served successfully (the 200 HTTP response code).</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>If you want to do more advanced stuff, beyond serving a static directory,
consider using a proper web server such as <a href="https://docs.nginx.com">NGINX</a>.
You could, for example, run NGINX using Docker (see <a data-type="xref" href="ch06.xhtml#docker">“Docker”</a>) with the following
command:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>docker</code><code> </code><code>run</code><code> </code><code>--name</code><code> </code><code>mywebserver</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO17-1" href="#callout_networking_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
             </code><code>--rm</code><code> </code><code>-d</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO17-2" href="#callout_networking_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
             </code><code>–v</code><code>  </code><code class="s2">"</code><code class="nv">$PWD</code><code class="s2">"</code><code>:/usr/share/nginx/html:ro</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO17-3" href="#callout_networking_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
             </code><code>-p</code><code> </code><code class="m">8042</code><code>:80</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO17-4" href="#callout_networking_CO17-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
             </code><code>nginx:1.21</code><code> </code><a class="co" id="co_networking_CO17-5" href="#callout_networking_CO17-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO17-1" href="#co_networking_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Call the running container <code>mywebserver</code>; you should see that when you issue
a <code>docker ps</code> command to list running 
<span class="keep-together">containers.</span></p></dd>
<dt><a class="co" id="callout_networking_CO17-2" href="#co_networking_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>--rm</code> removes the container on exit, and the <code>-d</code> turns it into a daemon
(detach from terminal, run in background).</p></dd>
<dt><a class="co" id="callout_networking_CO17-3" href="#co_networking_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Mounts the current directory (<code>$PWD</code>) into the container as the NGINX source
content directory. Note that <code>$PWD</code> is a bash way to address the current
directory. In Fish you would use <code>(pwd)</code> instead.</p></dd>
<dt><a class="co" id="callout_networking_CO17-4" href="#co_networking_CO17-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Makes the container-internal port 80 available on the host via 8042.
That means you would be able to access the web server via <em><a href="http://localhost:8042"><em class="hyperlink">http://localhost:8042</em></a></em>
on your machine.</p></dd>
<dt><a class="co" id="callout_networking_CO17-5" href="#co_networking_CO17-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The container image to use (<code>nginx:1.21</code>), and implicitly using Docker Hub
since we didn’t specify the registry part.</p></dd>
</dl>
</div>

<p>Now let’s see how we can use <a href="https://curl.se"><code>curl</code></a>, a powerful and popular
tool to interact with any kind of URLs, to get the content of the web server
we launched in the previous example (make sure it’s still running, or launch
it again in a separate session if you terminated it already):</p>

<pre data-type="programlisting" data-code-language="shell">$ curl localhost:8000
&lt;!DOCTYPE HTML PUBLIC <code class="s2">"-//W3C//DTD HTML 4.01//EN"</code>
                      <code class="s2">"http://www.w3.org/TR/html4/strict.dtd"</code>&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv<code class="o">=</code><code class="s2">"Content-Type"</code> <code class="nv">content</code><code class="o">=</code><code class="s2">"text/html; charset=utf-8"</code>&gt;
&lt;title&gt;Directory listing <code class="k">for</code> /&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Directory listing <code class="k">for</code> /&lt;/h1&gt;
&lt;hr&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"app.yaml"</code>&gt;app.yaml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"Dockerfile"</code>&gt;Dockerfile&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"example.json"</code>&gt;example.json&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"gh-user-info.sh"</code>&gt;gh-user-info.sh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"main.go"</code>&gt;main.go&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"script.sh"</code>&gt;script.sh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a <code class="nv">href</code><code class="o">=</code><code class="s2">"test"</code>&gt;test&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;/body&gt;</pre>

<p>In <a data-type="xref" href="#tab-curl-usage">Table 7-1</a> you see some common options for <code>curl</code> that you may find
useful. The selection is based on my usage history for a range of tasks, from
developing to system administration.</p>
<table id="tab-curl-usage">
<caption><span class="label">Table 7-1. </span>Useful options for <code>curl</code></caption>
<thead>
<tr>
<th>Option</th>
<th>Long-form option</th>
<th>Description and use case</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>-v</code></p></td>
<td><p><code>--verbose</code></p></td>
<td><p>For verbose output, use for debugging.</p></td>
</tr>
<tr>
<td><p><code>-s</code></p></td>
<td><p><code>--silent</code></p></td>
<td><p>Silence <code>curl</code>: do not show the progress meter or error messages.</p></td>
</tr>
<tr>
<td><p><code>-L</code></p></td>
<td><p><code>--location</code></p></td>
<td><p>Follow page redirects (<code>3XX</code> HTTP response codes).</p></td>
</tr>
<tr>
<td><p><code>-o</code></p></td>
<td><p><code>--output</code></p></td>
<td><p>By default, the content goes to <code>stdout</code>; if you want to directly store it in a file, specify it via this option.</p></td>
</tr>
<tr>
<td><p><code>-m</code></p></td>
<td><p><code>--max-time</code></p></td>
<td><p>Maximum time (in seconds) you are willing to wait for the operation to take.</p></td>
</tr>
<tr>
<td><p><code>-I</code></p></td>
<td><p><code>--head</code></p></td>
<td><p>Fetch the headers only (careful: not every HTTP server supports the <code>HEAD</code> method for a path).</p></td>
</tr>
<tr>
<td><p><code>-k</code></p></td>
<td><p><code>--insecure</code></p></td>
<td><p>By default, HTTPS calls are verified. Use this option to ignore the errors for cases where that’s not possible.</p></td>
</tr>
</tbody>
</table>

<p>If <code>curl</code> is not available, you can fall back to <a href="https://oreil.ly/0jYJj"><code>wget</code></a>,
which is more limited but sufficient for simple HTTP-related interactions.<a data-type="indexterm" data-startref="ix_ch07-asciidoc24" id="idm45805429504224"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc23" id="idm45805429503552"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Secure Shell"><div class="sect2" id="ssh">
<h2>Secure Shell</h2>

<p><a data-type="indexterm" data-primary="application layer networking" data-secondary="SSH" id="idm45805429501648"/><a data-type="indexterm" data-primary="Secure Shell (SSH)" id="idm45805429500704"/><a data-type="indexterm" data-primary="security" data-secondary="SSH" id="idm45805429500032"/><a data-type="indexterm" data-primary="SSH (Secure Shell)" id="idm45805429499088"/><a href="https://oreil.ly/dNVgt">Secure Shell (SSH)</a>
is a cryptographic network protocol for securely offering network services
on an unsecured network. For example, as a replacement for <code>telnet</code>, you can
use <code>ssh</code> to log into a remote machine and also move data securely
between (virtual) machines.</p>

<p>Let’s see SSH in action. I’ve provisioned a virtual machine in the cloud with an IP address of <code>63.32.106.149</code>, and the user name provided by
default is <code>ec2-user</code>. To log into the machine, I can do the
following (note that the output is edited and assumes that you or someone
else created credentials in <em>~/.ssh/lml.pem</em> beforehand):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>ssh</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO18-1" href="#callout_networking_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code>-i</code><code> </code><code>~/.ssh/lml.pem</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO18-2" href="#callout_networking_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code>ec2-user@63.32.106.149</code><code> </code><a class="co" id="co_networking_CO18-3" href="#callout_networking_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>

</code><code>...</code><code>

</code><code>https://aws.amazon.com/amazon-linux-2/</code><code>
</code><code class="m">11</code><code> </code><code>package</code><code class="o">(</code><code>s</code><code class="o">)</code><code> </code><code>needed</code><code> </code><code class="k">for</code><code> </code><code>security,</code><code> </code><code>out</code><code> </code><code>of</code><code> </code><code class="m">35</code><code> </code><code>available</code><code>
</code><code>Run</code><code> </code><code class="s2">"sudo yum update"</code><code> </code><code>to</code><code> </code><code>apply</code><code> </code><code>all</code><code> </code><code>updates.</code><code>
</code><code class="o">[</code><code>ec2-user@ip-172-26-8-138</code><code> </code><code>~</code><code class="o">]</code><code>$</code><code> </code><a class="co" id="co_networking_CO18-4" href="#callout_networking_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO18-1" href="#co_networking_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the <code>ssh</code> command to log into a remote machine.</p></dd>
<dt><a class="co" id="callout_networking_CO18-2" href="#co_networking_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Use the identity file <em>~/.ssh/lml.pem</em> rather than a password. Explicitly
providing that file is a good practice but in our case would strictly
speaking not be necessary as it resides in the default location <em>~/.ssh</em>.</p></dd>
<dt><a class="co" id="callout_networking_CO18-3" href="#co_networking_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The SSH target machine in the format <code>username@host</code>.</p></dd>
<dt><a class="co" id="callout_networking_CO18-4" href="#co_networking_CO18-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Once the login process is completed, I can tell from the prompt that I’m on the
target machine and can use it just as if it were local.</p></dd>
</dl>

<p>Some general SSH usage tips:</p>

<ul>
<li>
<p>If you run an SSH server, that is, allow others to <code>ssh</code> into your machine,
then you absolutely should <a href="https://oreil.ly/Jz5tA">disable
password authentication</a>. This forces users to create a key pair and share
the public key with you that you then add to <em>~/.ssh/authorized_keys</em> and
allow to log in via this mechanism.</p>
</li>
<li>
<p>Use <code>ssh -tt</code> to force pseudo-tty allocation.</p>
</li>
<li>
<p>Do <code>export TERM=xterm</code> when you <code>ssh</code> into a machine, in case you are having
display issues.</p>
</li>
<li>
<p>Configure timeouts for <code>ssh</code> sessions in your client. On a per-user basis,
this is usually via <em>~/.ssh/config</em>, where you can
set <code>ServerAliveInterval</code> and <code>Server​Ali⁠veCountMax</code> options to keep your
connections alive.</p>
</li>
<li>
<p>If you’re having issues, and you’ve excluded local permission issues with
the key(s), then you can try launching <code>ssh</code> with the <code>-v</code> option, giving you
details about what’s going on under the hood (also, try multiple instances of <code>v</code>, like <code>-vvv</code>
for finer-grained debug info).</p>
</li>
</ul>

<p>SSH is not only used directly by humans, but it is also used as a building block under the
hood—for example, in file-transfer tooling.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="File Transfer"><div class="sect2" id="file-transfers">
<h2>File Transfer</h2>

<p><a data-type="indexterm" data-primary="application layer networking" data-secondary="file transfer" id="ix_ch07-asciidoc25"/><a data-type="indexterm" data-primary="file transfer" id="ix_ch07-asciidoc26"/>One very common task involving the network is transferring files. You can do
this from your local machine to a server in the cloud or from another
machine in the local network.</p>

<p><a data-type="indexterm" data-primary="scp" id="idm45805429396160"/>To copy to and from remote systems, you can use one basic tool.
<a href="https://oreil.ly/RKbEu"><code>scp</code> (short for “secure copy”)</a> works on
top of SSH. Given that <code>scp</code> defaults to <code>ssh</code>, we need to make sure that we
have the password (or even better, key-based authentication) in place for it to
work.</p>

<p>Let’s assume we have a remote machine with the IPv4 address
<code>63.32.106.149</code>, and we want to copy a file there from our local machine:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>scp</code><code> </code><code>copyme</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO19-1" href="#callout_networking_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
      </code><code>ec2-user@63.32.106.149:/home/ec2-user/</code><code> </code><a class="co" id="co_networking_CO19-2" href="#callout_networking_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>copyme</code><code>                       </code><code class="m">100</code><code>%</code><code>    </code><code class="m">0</code><code>     </code><code class="m">0</code><code>.0KB/s</code><code>   </code><code class="m">00</code><code>:00</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO19-1" href="#co_networking_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Source is the file <em>copyme</em> in the current directory.</p></dd>
<dt><a class="co" id="callout_networking_CO19-2" href="#co_networking_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Destination is the <em>/home/ec2-user/</em> directory on machine <code>63.32.106.149</code>.</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="rsync" id="idm45805429367376"/>Synchronizing files with <a href="https://oreil.ly/eC6Kz"><code>rsync</code></a>
is much more convenient and faster than <code>scp</code>. Under the hood, <code>rsync</code> uses
SSH by default.</p>

<p>Let’s now see how we can use <code>rsync</code> to transfer files from the <em>~/data/</em> from
the local machine to the host at <code>63.32.106.149</code>:</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>rsync</code><code> </code><code>-avz</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO20-1" href="#callout_networking_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
        </code><code>~/data/</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO20-2" href="#callout_networking_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
        </code><code>mh9@:63.32.106.149:</code><code> </code><a class="co" id="co_networking_CO20-3" href="#callout_networking_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>building</code><code> </code><code>file</code><code> </code><code>list</code><code> </code><code>...</code><code> </code><code class="k">done</code><code>
</code><code>./</code><code>
</code><code>example.txt</code><code>

</code><code>sent</code><code> </code><code class="m">155</code><code> </code><code>bytes</code><code>  </code><code>received</code><code> </code><code class="m">48</code><code> </code><code>bytes</code><code>  </code><code class="m">135</code><code>.33</code><code> </code><code>bytes/sec</code><code>
</code><code>total</code><code> </code><code>size</code><code> </code><code>is</code><code> </code><code class="m">10</code><code>  </code><code>speedup</code><code> </code><code>is</code><code> </code><code class="m">0</code><code>.05</code><code>

</code><code>$</code><code> </code><code>ssh</code><code> </code><code>ec2-user@63.32.106.149</code><code> </code><code>--</code><code> </code><code>ls</code><code> </code><a class="co" id="co_networking_CO20-4" href="#callout_networking_CO20-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>example.txt</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO20-1" href="#co_networking_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Options meaning <code>-a</code> for archive (incremental, preserve), <code>-v</code> for verbose
so that we see something, and <code>-z</code> for using compression.</p></dd>
<dt><a class="co" id="callout_networking_CO20-2" href="#co_networking_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Source directories (since <code>-a</code> includes <code>-r</code> which is recursive).</p></dd>
<dt><a class="co" id="callout_networking_CO20-3" href="#co_networking_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Destination in <code>user@host</code> format.</p></dd>
<dt><a class="co" id="callout_networking_CO20-4" href="#co_networking_CO20-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Verify if the data has arrived by executing an <code>ls</code> on the remote machine.
The next line shows that it indeed worked—the data arrived in good order.</p></dd>
</dl>

<p>If you’re unsure what <code>rsync</code> will do, use the <code>--dry-run</code> option in addition
to the other ones. It will essentially tell you what it will do without actually
carrying out the operation, so it’s safe.</p>

<p><code>rsync</code> is also a great tool to perform directory backups because it can be
set to copy only files that have been added or changed.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Don’t forget the <code>:</code> after the host! Without it, <code>rsync</code>
will happily go ahead and interpret the source or destination as a local directory.
That is, the command will work fine, but rather than copying the files to the remote
machine, it will end up on your local machine. For example, <em>user@example.com</em>
as the destination would be a subdirectory of the current directory called
<em>user@example.com/</em>.</p>
</div>

<p>Last but not least, one use case you often come across is when someone provides
files in an Amazon S3 bucket. To download those files, you can use the
<a href="https://oreil.ly/mqQcr">AWS CLI</a> with the <code>s3</code> subcommand as follows. We’re using a dataset from the <a href="https://oreil.ly/cbYMH">Open Data
registry</a> in a public S3 bucket (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>aws</code><code> </code><code>s3</code><code> </code><code>sync</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO21-1" href="#callout_networking_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
      </code><code>s3://commoncrawl/contrib/c4corpus/CC-MAIN-2016-07/</code><code> </code><code class="se">\ </code><a class="co" id="co_networking_CO21-2" href="#callout_networking_CO21-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
      </code><code>.</code><code class="se">\ </code><a class="co" id="co_networking_CO21-3" href="#callout_networking_CO21-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
      </code><code>--no-sign-request</code><code> </code><a class="co" id="co_networking_CO21-4" href="#callout_networking_CO21-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>download:</code><code> </code><code>s3://commoncrawl/contrib/c4corpus/CC-MAIN-2016-07/</code><code>
</code><code>Lic_by-nc-nd_Lang_af_NoBoilerplate_true_MinHtml_true-r-00009.seg-00000.warc.gz</code><code> </code><code>to</code><code>
</code><code>./Lic_by-nc-nd_Lang_af_NoBoilerplate_true_MinHtml_true-r-00009.seg-00000.warc.gz</code><code>
</code><code>download:</code><code> </code><code>s3://commoncrawl/contrib/c4corpus/CC-MAIN-2016-07/</code><code>
</code><code>Lic_by-nc-nd_Lang_bn_NoBoilerplate_true_MinHtml_true-r-00017.seg-00000.warc.gz</code><code> </code><code>to</code><code>
</code><code>./Lic_by-nc-nd_Lang_bn_NoBoilerplate_true_MinHtml_true-r-00017.seg-00000.warc.gz</code><code>
</code><code>download:</code><code> </code><code>s3://commoncrawl/contrib/c4corpus/CC-MAIN-2016-07/</code><code>
</code><code>Lic_by-nc-nd_Lang_da_NoBoilerplate_true_MinHtml_true-r-00004.seg-00000.warc.gz</code><code> </code><code>to</code><code>
</code><code>./Lic_by-nc-nd_Lang_da_NoBoilerplate_true_MinHtml_true-r-00004.seg-00000.warc.gz</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO21-1" href="#co_networking_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use the AWS S3 command to synchronize files from a public bucket.</p></dd>
<dt><a class="co" id="callout_networking_CO21-2" href="#co_networking_CO21-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>This is the source bucket, <em>s3://commoncrawl</em>, and the exact path of the source we
want to sync. Warning: there are more than 8 GB of data in that directory,
so try this only if you don’t mind the bandwidth.</p></dd>
<dt><a class="co" id="callout_networking_CO21-3" href="#co_networking_CO21-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The destination is the current directory, signaled by a single period (<code>.</code>).</p></dd>
<dt><a class="co" id="callout_networking_CO21-4" href="#co_networking_CO21-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Ignore/skip authentication since this is a publicly available bucket
(and thus the data in it).</p></dd>
</dl>

<p class="pagebreak-after"><a data-type="indexterm" data-primary="File Transfer Protocol (FTP)" id="idm45805429168640"/><a data-type="indexterm" data-primary="FTP (File Transfer Protocol)" id="idm45805429167920"/>The File Transfer Protocol (FTP) as per <a href="https://oreil.ly/Okegf">RFC 959</a>
is still in use, but we don’t recommend using it anymore. Not only are these insecure,
but there are also many better alternatives, such as the ones we discussed in this section.
So, there’s no actual need for FTP anymore.<a data-type="indexterm" data-startref="ix_ch07-asciidoc26" id="idm45805429166448"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc25" id="idm45805429165744"/></p>
</div></section>













<section data-type="sect2" class="less_space" data-pdf-bookmark="Network File System"><div class="sect2" id="nfs">
<h2>Network File System</h2>

<p><a data-type="indexterm" data-primary="application layer networking" data-secondary="NFS" id="idm45805429163216"/><a data-type="indexterm" data-primary="Network File System (NFS)" id="idm45805429162272"/><a data-type="indexterm" data-primary="NFS (Network File System)" id="idm45805429161584"/>A widely supported and used way to share files from a central location over the network
is via network file system (NFS), originally developed by Sun Microsystems in the
early 1980s. It saw multiple iterations as per <a href="https://oreil.ly/Uy4CZ">RFC 7530</a>
and other related IETF specs and is very stable.</p>

<p>You would usually have an NFS server maintained by a cloud provider or central IT
in a professional setup. All you would need to do is install the client
(usually through a package called  <code>nfs-common</code>). Then, you
can mount a source directory from the NFS server as follows:</p>

<pre data-type="programlisting" data-code-language="shell">$ sudo mount nfs.example.com:/source_dir /opt/target_mount_dir</pre>

<p>Many cloud providers, such as AWS and Azure, now offer NFS as a service.
It’s a nice way to provide your storage-hungry application with a lot of
space in a way that looks and feels almost like local attached storage. For
media applications, however, a
<a href="https://oreil.ly/JrQ8m">network-attached storage (NAS)
setup</a> is likely the better choice.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sharing with Windows"><div class="sect2" id="fs-windows">
<h2>Sharing with Windows</h2>

<p><a data-type="indexterm" data-primary="application layer networking" data-secondary="sharing with Windows" id="idm45805429154768"/><a data-type="indexterm" data-primary="Windows, application layer networking and" id="idm45805429153920"/>If you have Windows machines in your local network and want to share it, you can use the
<a href="https://oreil.ly/mTAMe">Server Message Block (SMB)</a>,
a protocol initially developed at IBM in the 1980s, or its Microsoft-owned successor,
<a href="https://oreil.ly/qMEjj">Common Internet File System (CIFS)</a>.</p>

<p>You would typically use <a href="https://www.samba.org">Samba</a>, the standard Windows
interoperability suite of programs for Linux, to achieve the file sharing.<a data-type="indexterm" data-startref="ix_ch07-asciidoc22" id="idm45805429150592"/><a data-type="indexterm" data-startref="ix_ch07-asciidoc21" id="idm45805429149888"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Advanced Network Topics"><div class="sect1" id="advanced-networking">
<h1>Advanced Network Topics</h1>

<p>In this section, we discuss some advanced network protocols and tooling across
the TCP/IP stack. Their usage is normally beyond the scope of a casual user.
However, if you’re a developer or sys admin, you probably will want to be at
least aware of them.</p>








<section data-type="sect2" data-pdf-bookmark="whois"><div class="sect2" id="idm45805429146752">
<h2>whois</h2>

<p><a data-type="indexterm" data-primary="networking" data-secondary="whois" id="idm45805429145552"/><a data-type="indexterm" data-primary="whois" id="idm45805429144576"/><a href="https://oreil.ly/3m97l"><code>whois</code></a> is a client for the whois directory
service that you can use to look up registration and user information. For example,
if I want to find out who is behind the <em>ietf.org</em> domain (note that you
can pay your domain registrar to keep that information private), I would do the following:</p>

<pre data-type="programlisting" data-code-language="shell" class="pagebreak-before"><code>$</code><code> </code><code>whois</code><code> </code><code>ietf.org</code><code> </code><a class="co" id="co_networking_CO22-1" href="#callout_networking_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>%</code><code> </code><code>IANA</code><code> </code><code>WHOIS</code><code> </code><code>server</code><code>
</code><code>%</code><code> </code><code class="k">for</code><code> </code><code>more</code><code> </code><code>information</code><code> </code><code>on</code><code> </code><code>IANA,</code><code> </code><code>visit</code><code> </code><code>http://www.iana.org</code><code>
</code><code>%</code><code> </code><code>This</code><code> </code><code>query</code><code> </code><code>returned</code><code> </code><code class="m">1</code><code> </code><code>object</code><code>

</code><code>refer:</code><code>        </code><code>whois.pir.org</code><code>

</code><code>domain:</code><code>       </code><code>ORG</code><code>

</code><code>organisation:</code><code> </code><code>Public</code><code> </code><code>Interest</code><code> </code><code>Registry</code><code> </code><code class="o">(</code><code>PIR</code><code class="o">)</code><code>
</code><code>address:</code><code>      </code><code class="m">11911</code><code> </code><code>Freedom</code><code> </code><code>Drive</code><code> </code><code>10th</code><code> </code><code>Floor,</code><code>
</code><code>address:</code><code>      </code><code>Suite</code><code> </code><code class="m">1000</code><code>
</code><code>address:</code><code>      </code><code>Reston,</code><code> </code><code>VA</code><code> </code><code class="m">20190</code><code>
</code><code>address:</code><code>      </code><code>United</code><code> </code><code>States</code><code>

</code><code>contact:</code><code>      </code><code>administrative</code><code>
</code><code>name:</code><code>         </code><code>Director</code><code> </code><code>of</code><code> </code><code>Operations,</code><code> </code><code>Compliance</code><code> </code><code>and</code><code> </code><code>Customer</code><code> </code><code>Support</code><code>
</code><code>organisation:</code><code> </code><code>Public</code><code> </code><code>Interest</code><code> </code><code>Registry</code><code> </code><code class="o">(</code><code>PIR</code><code class="o">)</code><code>
</code><code>address:</code><code>      </code><code class="m">11911</code><code> </code><code>Freedom</code><code> </code><code>Drive</code><code> </code><code>10th</code><code> </code><code>Floor,</code><code>
</code><code>address:</code><code>      </code><code>Suite</code><code> </code><code class="m">1000</code><code>
</code><code>address:</code><code>      </code><code>Reston,</code><code> </code><code>VA</code><code> </code><code class="m">20190</code><code>
</code><code>address:</code><code>      </code><code>United</code><code> </code><code>States</code><code>
</code><code>phone:</code><code>        </code><code>+1</code><code> </code><code class="m">703</code><code> </code><code class="m">889</code><code> </code><code class="m">5778</code><code>
</code><code>fax-no:</code><code>       </code><code>+1</code><code> </code><code class="m">703</code><code> </code><code class="m">889</code><code> </code><code class="m">5779</code><code>
</code><code>e-mail:</code><code>       </code><code>ops@pir.org</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO22-1" href="#co_networking_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>whois</code> to look up registration information about domain.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Dynamic Host Configuration Protocol"><div class="sect2" id="dhcp">
<h2>Dynamic Host Configuration Protocol</h2>

<p><a data-type="indexterm" data-primary="DHCP (Dynamic Host Configuration Protocol)" id="idm45805429103232"/><a data-type="indexterm" data-primary="Dynamic Host Configuration Protocol (DHCP)" id="idm45805429102560"/><a data-type="indexterm" data-primary="networking" data-secondary="DHCP" id="idm45805429101920"/>The <a href="https://oreil.ly/C8vOE">Dynamic
Host Configuration Protocol (DHCP)</a> is a network protocol that enables
automatic assignment of an IP address to a host. It’s a cli⁠ent​/server
setup that removes the need for manually configuring network devices.</p>

<p>Setting up and managing a DHCP server is outside our scope, but you can use
<a href="https://oreil.ly/uPvGn"><code>dhcpdump</code></a> to scan for DHCP packets.
For this, a device in your local network needs to join, trying to acquire
an IP address, so you may need to be a bit patient to see something here
(output shortened):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>dhcpdump</code><code> </code><code>-i</code><code> </code><code>wlp1s0</code><code> </code><a class="co" id="co_networking_CO23-1" href="#callout_networking_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code>TIME:</code><code> </code><code class="m">2021</code><code>-09-19</code><code> </code><code class="m">17</code><code>:26:24.115</code><code>
    </code><code>IP:</code><code> </code><code class="m">0</code><code>.0.0.0</code><code> </code><code class="o">(</code><code class="m">88</code><code>:cb:87:c9:19:92</code><code class="o">)</code><code> </code><code>&gt;</code><code> </code><code class="m">255</code><code>.255.255.255</code><code> </code><code class="o">(</code><code>ff:ff:ff:ff:ff:ff</code><code class="o">)</code><code>
    </code><code>OP:</code><code> </code><code class="m">1</code><code> </code><code class="o">(</code><code>BOOTPREQUEST</code><code class="o">)</code><code>
 </code><code>HTYPE:</code><code> </code><code class="m">1</code><code> </code><code class="o">(</code><code>Ethernet</code><code class="o">)</code><code>
  </code><code>HLEN:</code><code> </code><code class="m">6</code><code>
  </code><code>HOPS:</code><code> </code><code class="m">0</code><code>
   </code><code>XID:</code><code> </code><code>7533fb70</code><code>
   </code><code>...</code><code>
</code><code>OPTION:</code><code>  </code><code class="m">57</code><code> </code><code class="o">(</code><code>  </code><code class="m">2</code><code class="o">)</code><code> </code><code>Maximum</code><code> </code><code>DHCP</code><code> </code><code>message</code><code> </code><code>size</code><code> </code><code class="m">1500</code><code>
</code><code>OPTION:</code><code>  </code><code class="m">61</code><code> </code><code class="o">(</code><code>  </code><code class="m">7</code><code class="o">)</code><code> </code><code>Client-identifier</code><code>         </code><code class="m">01</code><code>:88:cb:87:c9:19:92</code><code>
</code><code>OPTION:</code><code>  </code><code class="m">50</code><code> </code><code class="o">(</code><code>  </code><code class="m">4</code><code class="o">)</code><code> </code><code>Request</code><code> </code><code>IP</code><code> </code><code>address</code><code>        </code><code class="m">192</code><code>.168.178.42</code><code>
</code><code>OPTION:</code><code>  </code><code class="m">51</code><code> </code><code class="o">(</code><code>  </code><code class="m">4</code><code class="o">)</code><code> </code><code>IP</code><code> </code><code>address</code><code> </code><code>leasetime</code><code>      </code><code class="m">7776000</code><code> </code><code class="o">(</code><code>12w6d</code><code class="o">)</code><code>
</code><code>OPTION:</code><code>  </code><code class="m">12</code><code> </code><code class="o">(</code><code> </code><code class="m">15</code><code class="o">)</code><code> </code><code>Host</code><code> </code><code>name</code><code>                 </code><code>MichaelminiiPad</code><code>
</code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO23-1" href="#co_networking_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Using <code>dhcpdump</code>, sniff DHCP packets on interface <code>wlp1s0</code>.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Network Time Protocol"><div class="sect2" id="ntp">
<h2>Network Time Protocol</h2>

<p><a data-type="indexterm" data-primary="Network Time Protocol (NTP)" id="idm45805428867504"/><a data-type="indexterm" data-primary="networking" data-secondary="NTP" id="idm45805428866832"/><a data-type="indexterm" data-primary="NTP (Network Time Protocol)" id="idm45805428943552"/>The <a href="http://www.ntp.org">Network Time Protocol (NTP)</a> is for synchronizing
clocks of computers over a network. For example, using
the <a href="https://oreil.ly/0JxbJ"><code>ntpq</code> command</a>, a standard NTP query program,
you could make an explicit time server query like so:</p>

<pre data-type="programlisting" data-code-language="shell"><code> </code><code>$</code><code> </code><code>ntpq</code><code> </code><code>-p</code><code> </code><a class="co" id="co_networking_CO24-1" href="#callout_networking_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
     </code><code>remote</code><code>           </code><code>refid</code><code>      </code><code>st</code><code> </code><code>t</code><code> </code><code>when</code><code> </code><code>poll</code><code> </code><code>reach</code><code>   </code><code>delay</code><code>   </code><code>offset</code><code>  </code><code class="nv">jitter</code><code>
</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>
 </code><code class="m">0</code><code>.ubuntu.pool.n</code><code> </code><code>.POOL.</code><code>          </code><code class="m">16</code><code> </code><code>p</code><code>    </code><code>-</code><code>   </code><code class="m">64</code><code>    </code><code class="m">0</code><code>    </code><code class="m">0</code><code>.000</code><code>    </code><code class="m">0</code><code>.000</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code class="m">1</code><code>.ubuntu.pool.n</code><code> </code><code>.POOL.</code><code>          </code><code class="m">16</code><code> </code><code>p</code><code>    </code><code>-</code><code>   </code><code class="m">64</code><code>    </code><code class="m">0</code><code>    </code><code class="m">0</code><code>.000</code><code>    </code><code class="m">0</code><code>.000</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code class="m">2</code><code>.ubuntu.pool.n</code><code> </code><code>.POOL.</code><code>          </code><code class="m">16</code><code> </code><code>p</code><code>    </code><code>-</code><code>   </code><code class="m">64</code><code>    </code><code class="m">0</code><code>    </code><code class="m">0</code><code>.000</code><code>    </code><code class="m">0</code><code>.000</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code class="m">3</code><code>.ubuntu.pool.n</code><code> </code><code>.POOL.</code><code>          </code><code class="m">16</code><code> </code><code>p</code><code>    </code><code>-</code><code>   </code><code class="m">64</code><code>    </code><code class="m">0</code><code>    </code><code class="m">0</code><code>.000</code><code>    </code><code class="m">0</code><code>.000</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code>ntp.ubuntu.com</code><code>  </code><code>.POOL.</code><code>          </code><code class="m">16</code><code> </code><code>p</code><code>    </code><code>-</code><code>   </code><code class="m">64</code><code>    </code><code class="m">0</code><code>    </code><code class="m">0</code><code>.000</code><code>    </code><code class="m">0</code><code>.000</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code>...</code><code>
 </code><code>ntp17.kashra-se</code><code> </code><code class="m">90</code><code>.187.148.77</code><code>    </code><code class="m">2</code><code> </code><code>u</code><code>    </code><code class="m">7</code><code>   </code><code class="m">64</code><code>    </code><code class="m">1</code><code>   </code><code class="m">27</code><code>.482</code><code>   </code><code>-3.451</code><code>   </code><code class="m">2</code><code>.285</code><code>
 </code><code>golem.canonical</code><code> </code><code class="m">17</code><code>.253.34.123</code><code>    </code><code class="m">2</code><code> </code><code>u</code><code>   </code><code class="m">13</code><code>   </code><code class="m">64</code><code>    </code><code class="m">1</code><code>   </code><code class="m">20</code><code>.338</code><code>    </code><code class="m">0</code><code>.057</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code>chilipepper.can</code><code> </code><code class="m">17</code><code>.253.34.123</code><code>    </code><code class="m">2</code><code> </code><code>u</code><code>   </code><code class="m">12</code><code>   </code><code class="m">64</code><code>    </code><code class="m">1</code><code>   </code><code class="m">19</code><code>.117</code><code>   </code><code>-0.439</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code>alphyn.canonica</code><code> </code><code class="m">140</code><code>.203.204.77</code><code>   </code><code class="m">2</code><code> </code><code>u</code><code>   </code><code class="m">14</code><code>   </code><code class="m">64</code><code>    </code><code class="m">1</code><code>   </code><code class="m">91</code><code>.462</code><code>   </code><code>-0.356</code><code>   </code><code class="m">0</code><code>.000</code><code>
 </code><code>pugot.canonical</code><code> </code><code class="m">145</code><code>.238.203.14</code><code>   </code><code class="m">2</code><code> </code><code>u</code><code>   </code><code class="m">13</code><code>   </code><code class="m">64</code><code>    </code><code class="m">1</code><code>   </code><code class="m">20</code><code>.788</code><code>    </code><code class="m">0</code><code>.226</code><code>   </code><code class="m">0</code><code>.000</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO24-1" href="#co_networking_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>With the <code>-p</code> option, show a list of peers known to the machine, including
their state.</p></dd>
</dl>

<p>Usually, NTP works in the background, managed by <code>systemd</code> and other daemons,
so you are unlikely to need to manually query it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Wireshark and tshark"><div class="sect2" id="network-traffic-inspection">
<h2>Wireshark and tshark</h2>

<p><a data-type="indexterm" data-primary="networking" data-secondary="wireshark and tshark" id="idm45805428822976"/><a data-type="indexterm" data-primary="tshark" id="idm45805428822112"/><a data-type="indexterm" data-primary="Wireshark" id="idm45805428821440"/>If you want to do low-level network traffic analysis—that is, you want
to see exactly the packets across the stack—you can use either
the command-line tool
<a href="https://oreil.ly/n7Urm"><code>tshark</code></a>
or its GUI-based version,
<a href="https://oreil.ly/YQrSa"><code>wireshark</code></a>.</p>

<p>For example, after finding out via <code>ip link</code> that I have a network interface
called <code>wlp1s0</code>, I capture traffic there (output edited to fit):</p>

<pre data-type="programlisting" data-code-language="shell"><code>$</code><code> </code><code>sudo</code><code> </code><code>tshark</code><code> </code><code>-i</code><code> </code><code>wlp1s0</code><code> </code><code>tcp</code><code> </code><a class="co" id="co_networking_CO25-1" href="#callout_networking_CO25-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>Running</code><code> </code><code>as</code><code> </code><code>user</code><code> </code><code class="s2">"root"</code><code> </code><code>and</code><code> </code><code>group</code><code> </code><code class="s2">"root"</code><code>.</code><code> </code><code>This</code><code> </code><code>could</code><code> </code><code>be</code><code> </code><code>dangerous.</code><code>
</code><code>Capturing</code><code> </code><code>on</code><code> </code><code class="s1">'wlp1s0'</code><code>
    </code><code class="m">1</code><code> </code><code class="m">0</code><code>.000000000</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>→</code><code> </code><code class="m">34</code><code>.196.251.55</code><code> </code><code>TCP</code><code> </code><code class="m">66</code><code> </code><code class="m">47618</code><code> </code><code>→</code><code> </code><code class="m">443</code><code>
    </code><code class="o">[</code><code>ACK</code><code class="o">]</code><code> </code><code class="nv">Seq</code><code class="o">=</code><code class="m">1</code><code> </code><code class="nv">Ack</code><code class="o">=</code><code class="m">1</code><code> </code><code class="nv">Win</code><code class="o">=</code><code class="m">501</code><code> </code><code class="nv">Len</code><code class="o">=</code><code class="m">0</code><code> </code><code class="nv">TSval</code><code class="o">=</code><code class="m">3796364053</code><code> </code><code class="nv">TSecr</code><code class="o">=</code><code class="m">153122458</code><code>
    </code><code class="m">2</code><code> </code><code class="m">0</code><code>.111215098</code><code> </code><code class="m">34</code><code>.196.251.55</code><code> </code><code>→</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>TCP</code><code> </code><code class="m">66</code><code>
    </code><code class="o">[</code><code>TCP</code><code> </code><code>ACKed</code><code> </code><code>unseen</code><code> </code><code>segment</code><code class="o">]</code><code> </code><code class="m">443</code><code> </code><code>→</code><code> </code><code class="m">47618</code><code> </code><code class="o">[</code><code>ACK</code><code class="o">]</code><code> </code><code class="nv">Seq</code><code class="o">=</code><code class="m">1</code><code> </code><code class="nv">Ack</code><code class="o">=</code><code class="m">2</code><code> </code><code class="nv">Win</code><code class="o">=</code><code class="m">283</code><code>
    </code><code class="nv">Len</code><code class="o">=</code><code class="m">0</code><code> </code><code class="nv">TSval</code><code class="o">=</code><code class="m">153167579</code><code> </code><code class="nv">TSecr</code><code class="o">=</code><code class="m">3796227866</code><code>
    </code><code>...</code><code>
    </code><code class="m">8</code><code> </code><code class="m">7</code><code>.712741925</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>→</code><code> </code><code class="m">185</code><code>.199.109.153</code><code> </code><code>HTTP</code><code> </code><code class="m">146</code><code> </code><code>GET</code><code> </code><code>/</code><code> </code><code>HTTP/1.1</code><code> </code><a class="co" id="co_networking_CO25-2" href="#callout_networking_CO25-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="m">9</code><code> </code><code class="m">7</code><code>.776535946</code><code> </code><code class="m">185</code><code>.199.109.153</code><code> </code><code>→</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>TCP</code><code> </code><code class="m">66</code><code> </code><code class="m">80</code><code> </code><code>→</code><code> </code><code class="m">42000</code><code> </code><code class="o">[</code><code>ACK</code><code class="o">]</code><code>
    </code><code class="nv">Seq</code><code class="o">=</code><code class="m">1</code><code> </code><code class="nv">Ack</code><code class="o">=</code><code class="m">81</code><code> </code><code class="nv">Win</code><code class="o">=</code><code class="m">144896</code><code> </code><code class="nv">Len</code><code class="o">=</code><code class="m">0</code><code> </code><code class="nv">TSval</code><code class="o">=</code><code class="m">2759410860</code><code> </code><code class="nv">TSecr</code><code class="o">=</code><code class="m">4258870662</code><code>
   </code><code class="m">10</code><code> </code><code class="m">7</code><code>.878721682</code><code> </code><code class="m">185</code><code>.199.109.153</code><code> </code><code>→</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>TCP</code><code> </code><code class="m">2946</code><code> </code><code>HTTP/1.1</code><code> </code><code class="m">200</code><code> </code><code>OK</code><code>
   </code><code class="o">[</code><code>TCP</code><code> </code><code>segment</code><code> </code><code>of</code><code> </code><code>a</code><code> </code><code>reassembled</code><code> </code><code>PDU</code><code class="o">]</code><code>
   </code><code class="m">11</code><code> </code><code class="m">7</code><code>.878722366</code><code> </code><code class="m">185</code><code>.199.109.153</code><code> </code><code>→</code><code> </code><code class="m">192</code><code>.168.178.40</code><code> </code><code>TCP</code><code> </code><code class="m">2946</code><code> </code><code class="m">80</code><code> </code><code>→</code><code> </code><code class="m">42000</code><code>
   </code><code class="o">[</code><code>PSH,</code><code> </code><code>ACK</code><code class="o">]</code><code> </code><code class="nv">Seq</code><code class="o">=</code><code class="m">2881</code><code> </code><code class="nv">Ack</code><code class="o">=</code><code class="m">81</code><code> </code><code class="nv">Win</code><code class="o">=</code><code class="m">144896</code><code> </code><code class="nv">Len</code><code class="o">=</code><code class="m">2880</code><code> </code><code class="nv">TSval</code><code class="o">=</code><code class="m">2759410966</code><code> </code><code class="se">\
</code><code>   </code><code class="nv">TSecr</code><code class="o">=</code><code class="m">4258870662</code><code>
   </code><code class="o">[</code><code>TCP</code><code> </code><code>segment</code><code> </code><code>of</code><code> </code><code>a</code><code> </code><code>reassembled</code><code> </code><code>PDU</code><code class="o">]</code><code>
   </code><code>...</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_networking_CO25-1" href="#co_networking_CO25-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>tshark</code> to capture network traffic on network interface <code>wlp1s0</code> and
only look at TCP traffic.</p></dd>
<dt><a class="co" id="callout_networking_CO25-2" href="#co_networking_CO25-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>In another session, I issued a <code>curl</code> command to trigger an HTTP session,
    in which application layer interaction starts.
You could also use the less powerful but on the other hand more widely available
<a href="http://www.tcpdump.org"><code>tcpdump</code></a> for this task.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Other Advanced Tooling"><div class="sect2" id="idm45805428514608">
<h2>Other Advanced Tooling</h2>

<p>There are a number of advanced network-related tools out there you may find
useful, including but not limited to the following:</p>
<dl>
<dt><a href="https://oreil.ly/R4Upv"><code>socat</code></a></dt>
<dd>
<p><a data-type="indexterm" data-primary="socat" id="idm45805428511184"/>Establishes two bidirectional
  byte streams and enables the transferring of data between the endpoint.</p>
</dd>
<dt><a href="https://oreil.ly/huZpl"><code>geoiplookup</code></a></dt>
<dd>
<p><a data-type="indexterm" data-primary="geoiplookup" id="idm45805428400688"/>Allows you to
  map an IP to a geographic region.</p>
</dd>
<dt>Tunnels</dt>
<dd>
<p><a data-type="indexterm" data-primary="Tunnels" id="idm45805428398704"/>An
  easy-to-use alternative to VPNs and other site-to-site networking solutions. Enabled by such tools as <a href="https://docs.inlets.dev">inlets</a>.</p>
</dd>
<dt>BitTorrent</dt>
<dd>
<p><a data-type="indexterm" data-primary="BitTorrent" id="idm45805428395872"/>A peer-to-peer system that groups files into a package called
  a <em>torrent</em>. Check out <a href="https://oreil.ly/Z4rak">some clients</a>
  to decide if this is something for your 
<span class="keep-together">toolbox.</span></p>
</dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Conclusion"><div class="sect1" id="idm45805428467088">
<h1>Conclusion</h1>

<p>In this chapter, we defined common network terms, from the hardware level, such
as NICs, to the TCP/IP stack, to application-layer, user-facing components, such as HTTP.</p>

<p>Linux provides a powerful, standards-based implementation of the TCP/IP stack that
you can use programmatically (for example, sockets) and in the context of setting up
and querying (usually with the <code>ip</code> command).</p>

<p>We further discussed application-layer protocols and interfaces that make up
most of the daily (network-related) flows. Your command-line friends here include <code>curl</code> for transfer and <code>dig</code> for DNS lookups.</p>

<p>If you want to dive deeper into networking topics, check out the following resources:</p>
<dl>
<dt>The TCP/IP stack</dt>
<dd>

<ul>
<li>
<p><a class="orm:hideurl" href="https://oreil.ly/pXRxW"><em>Understanding Linux Network Internals</em></a> by Christian Benvenuti (O’Reilly)</p>
</li>
<li>
<p><a href="https://oreil.ly/wRxdI">“A Protocol for Packet Network Intercommunication”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/S6ZFJ">DHCP server setup webpage</a></p>
</li>
<li>
<p><a href="https://oreil.ly/DPgZc">“Hello IPv6: A Minimal Tutorial for IPv4 Users”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/91jkO">“Understanding IPv6—7 Part Series”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/MUcxG">Collection of IPv6 articles by Johannes Weber</a></p>
</li>
<li>
<p>Iljitsch van Beijnum’s <a href="https://oreil.ly/K47dS">BGP Expert website</a></p>
</li>
<li>
<p><a href="https://oreil.ly/CCrfA">“Everything You Ever Wanted to Know About UDP Sockets but Were Afraid to Ask”</a></p>
</li>
</ul>
</dd>
<dt>DNS</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/K31GM">“An Introduction to DNS Terminology, Components, and Concepts”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/eKdtK">“How to Install and Configure DNS Server in Linux”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/KkVSf">“Anatomy of a Linux DNS Lookup”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/qwRTx">“TLDs—Putting the <em>.fun</em> in the Top of the DNS”</a></p>
</li>
</ul>
</dd>
<dt class="pagebreak-before less_space">Application layer and advanced networking</dt>
<dd>

<ul>
<li>
<p><a href="https://oreil.ly/3yhlV">“SSH Tunneling Explained”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/OzB6P"><em>Everything curl</em></a></p>
</li>
<li>
<p><a href="https://oreil.ly/hrLpo">“What Is DHCP and How to Configure DHCP Server in Linux”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/kHZhw">“How to Install and Configure Linux NTP Server and Client”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/IOS4b">NFS wiki</a></p>
</li>
<li>
<p><a href="https://oreil.ly/1ttt0">“Use Wireshark at the Linux Command Line with TShark”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/LWXCj">“Getting Started with socat”</a></p>
</li>
<li>
<p><a href="https://oreil.ly/TAd0b">“Geomapping Network Traffic”</a></p>
</li>
</ul>
</dd>
</dl>

<p>With<a data-type="indexterm" data-startref="ix_ch07-asciidoc0" id="idm45805428547712"/> that, we’re ready to move on to the next topic in the book: using observability to avoid flying blind.</p>
</div></section>







</div></section></div></body></html>