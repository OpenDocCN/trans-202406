<html><head></head><body><section data-pdf-bookmark="Chapter 24. Mobile Application Authentication" data-type="chapter" epub:type="chapter"><div class="chapter" id="mobile-auth">&#13;
<h1><span class="label">Chapter 24. </span>Mobile Application Authentication</h1>&#13;
&#13;
&#13;
<p><a data-primary="authentication" data-secondary="mobile application" data-type="indexterm" id="ix_ch24-asciidoc0"/><a data-primary="mobile application authentication" data-type="indexterm" id="ix_ch24-asciidoc1"/>If you’ve ever stayed with a relative, vacationed at a rental property, or rented a furnished apartment, you know what it’s like to be surrounded by things that aren’t yours. It can be hard to feel settled in these types of environments, not wanting to leave something out of place or make a mess. When I’m in these situations, no matter how kind or accommodating the host is, this lack of ownership leaves me on edge. What can I say? I’m just not comfortable unless I can put a glass down without a coaster.</p>&#13;
&#13;
<p>Without the ability to customize or read user-specific data, our app might fill users with the same sense of discomfort. Their notes are simply mixed in with those of everyone else, not making the application truly their own. In this chapter we’ll add authentication to our application. To accomplish this, we’ll introduce an authentication routing flow, store token data using Expo’s <code>SecureStore</code>, create text forms in React Native, and perform authentication GraphQL mutations.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Authentication Routing Flow" data-type="sect1"><div class="sect1" id="idm45339480480680">&#13;
<h1>Authentication Routing Flow</h1>&#13;
&#13;
<p><a data-primary="authentication" data-secondary="routing flow" data-type="indexterm" id="ix_ch24-asciidoc2"/><a data-primary="mobile application authentication" data-secondary="authentication routing flow" data-type="indexterm" id="ix_ch24-asciidoc3"/>Let’s begin by creating our authentication flow. When a user first accesses our application, we’ll present them with a sign-in screen. When the user signs in, we’ll store a token on the device, allowing them to bypass the sign-in screen on future application uses. We’ll also add a settings screen, where a user can click a button to log out of the application and remove the token from their device.</p>&#13;
&#13;
<p>To accomplish this, we’ll be adding several new screens:</p>&#13;
<dl>&#13;
<dt><em>authloading.js</em></dt>&#13;
<dd>&#13;
<p>This<a data-primary="authloading.js" data-type="indexterm" id="idm45339480473592"/> will be an interstitial screen, which users won’t interact with. When the app is opened, we’ll use the screen to check if a token is present and navigate the user to either the sign-in screen or the application content.</p>&#13;
</dd>&#13;
<dt><em>signin.js</em></dt>&#13;
<dd>&#13;
<p>This<a data-primary="signin.js" data-type="indexterm" id="idm45339480471080"/> is the screen where a user can sign in to their account. After a successful login attempt, we will store a token on the device.</p>&#13;
</dd>&#13;
<dt><em>settings.js</em></dt>&#13;
<dd>&#13;
<p>In<a data-primary="settings.js" data-type="indexterm" id="idm45339480452120"/> the settings screen, a user will be able to click a button and log out of the application. Once they are logged out, they will be routed back to the sign-in screen.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h1>Using an Existing Account</h1>&#13;
<p>We’ll be adding the ability to create an account through the app later in the chapter. If you haven’t already, it would be useful to create an account either directly through your API instance’s GraphQL Playground or the web application interface.</p>&#13;
</div>&#13;
&#13;
<p>For storing and working with tokens, we’ll be using <a data-primary="SecureStore library" data-type="indexterm" id="idm45339480449128"/>Expo’s <a href="https://oreil.ly/nvqEO">SecureStore library</a>. I’ve found SecureStore to be a straightforward way to encrypt and store data locally on a device. For iOS devices, SecureStore makes use of the built-in <a href="https://oreil.ly/iCu8R">keychain services</a>, while on Android it uses the OS’s Shared Preferences, encrypting the data with <a href="https://oreil.ly/gIXsp">Keystore</a>. All of this happens under the hood, allowing us to simply store and retrieve data.</p>&#13;
&#13;
<p>To begin with, we’ll create our sign-in screen. For now, our sign-in screen will consist of a <code>Button</code> component that, when pressed, will store a token. Let’s create a new screen component at <em>src/screens/signin.js</em>, importing our dependencies:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Sign in!"</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="nx">SignIn</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Sign In'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignIn</code><code class="p">;</code></pre>&#13;
&#13;
<p class="pagebreak-before">Next, let’s create our authentication loading component at <em>src/screens/authloading.js</em>, which for now will simply display a loading indicator:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">AuthLoading</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">AuthLoading</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, we can create our settings screen at <em>src/screens/settings.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Settings</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Sign Out"</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">Settings</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Settings'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Settings</code><code class="p">;</code></pre>&#13;
&#13;
<p>With these components written, we will update our routing to handle the authenticated and unauthenticated states. In <em>src/screens/index.js</em>, add the new screens to our list of import statements as follows:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">AuthLoading</code> <code class="nx">from</code> <code class="s1">'./authloading'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">SignIn</code> <code class="nx">from</code> <code class="s1">'./signin'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Settings</code> <code class="nx">from</code> <code class="s1">'./settings'</code><code class="p">;</code></pre>&#13;
&#13;
<p>We’ll also need to update our <code>react-navigation</code> dependency to <a data-primary="createSwitchNavigator" data-type="indexterm" id="idm45339480214456"/>include <span class="keep-together"><code>createSwitchNavigator</code></span>, which allows us to display a single screen at a time and switch between them. The <a href="https://oreil.ly/vSURH"><code>SwitchNavigator</code></a> resets routes to the default state when a user navigates and does not offer back-navigation options.</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="p">{</code> <code class="nx">createAppContainer</code><code class="p">,</code> <code class="nx">createSwitchNavigator</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-navigation'</code><code class="p">;</code></pre>&#13;
&#13;
<p class="pagebreak-before">We can create a new <a data-primary="stack navigation" data-type="indexterm" id="idm45339480195048"/><code>StackNavigator</code> for our authentication and settings screens. This will allow us to add subnavigation screens when or if needed in the future:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">AuthStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">SignIn</code><code class="o">:</code> <code class="nx">SignIn</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SettingsStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">Settings</code><code class="o">:</code> <code class="nx">Settings</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>We will then add our settings screen to the bottom <code>TabNavigator</code>. The rest of the tab navigation settings will stay the same:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">TabNavigator</code> <code class="o">=</code> <code class="nx">createBottomTabNavigator</code><code class="p">({</code>&#13;
 <code class="nx">FeedScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
   <code class="c1">// ...</code>&#13;
 <code class="p">},</code>&#13;
 <code class="nx">MyNoteScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
  <code class="c1">// ...</code>&#13;
 <code class="p">},</code>&#13;
 <code class="nx">FavoriteScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
   <code class="c1">// ...</code>&#13;
 <code class="p">},</code>&#13;
 <code class="nx">Settings</code><code class="o">:</code> <code class="p">{</code>&#13;
   <code class="nx">screen</code><code class="o">:</code> <code class="nx">Settings</code><code class="p">,</code>&#13;
   <code class="nx">navigationOptions</code><code class="o">:</code> <code class="p">{</code>&#13;
     <code class="nx">tabBarLabel</code><code class="o">:</code> <code class="s1">'Settings'</code><code class="p">,</code>&#13;
     <code class="nx">tabBarIcon</code><code class="o">:</code> <code class="p">({</code> <code class="nx">tintColor</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
       <code class="o">&lt;</code><code class="nx">MaterialCommunityIcons</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"settings"</code> <code class="nx">size</code><code class="o">=</code><code class="p">{</code><code class="mi">24</code><code class="p">}</code> <code class="nx">color</code><code class="o">=</code><code class="p">{</code><code class="nx">tintColor</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
     <code class="p">)</code>&#13;
   <code class="p">}</code>&#13;
 <code class="p">}</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>We can now create our <code>SwitchNavigator</code> by defining the screens to switch between and setting a default screen, the <code>AuthLoading</code>. We’ll then replace our existing <code>export</code> statement with one that exports the <code>SwitchNavigator</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">SwitchNavigator</code> <code class="o">=</code> <code class="nx">createSwitchNavigator</code><code class="p">(</code>&#13;
  <code class="p">{</code>&#13;
    <code class="nx">AuthLoading</code><code class="o">:</code> <code class="nx">AuthLoading</code><code class="p">,</code>&#13;
    <code class="nx">Auth</code><code class="o">:</code> <code class="nx">AuthStack</code><code class="p">,</code>&#13;
    <code class="nx">App</code><code class="o">:</code> <code class="nx">TabNavigator</code>&#13;
  <code class="p">},</code>&#13;
  <code class="p">{</code>&#13;
    <code class="nx">initialRouteName</code><code class="o">:</code> <code class="s1">'AuthLoading'</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">);</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">createAppContainer</code><code class="p">(</code><code class="nx">SwitchNavigator</code><code class="p">);</code></pre>&#13;
&#13;
<p class="pagebreak-before">All together, our <em>src/screens/index.js</em> file will appear as follows:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">ScrollView</code><code class="p">,</code> <code class="nx">Button</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">createAppContainer</code><code class="p">,</code> <code class="nx">createSwitchNavigator</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-navigation'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">createBottomTabNavigator</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-navigation-tabs'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">createStackNavigator</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-navigation-stack'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">MaterialCommunityIcons</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@expo/vector-icons'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Feed</code> <code class="nx">from</code> <code class="s1">'./feed'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Favorites</code> <code class="nx">from</code> <code class="s1">'./favorites'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">MyNotes</code> <code class="nx">from</code> <code class="s1">'./mynotes'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Note</code> <code class="nx">from</code> <code class="s1">'./note'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">SignIn</code> <code class="nx">from</code> <code class="s1">'./signin'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">AuthLoading</code> <code class="nx">from</code> <code class="s1">'./authloading'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Settings</code> <code class="nx">from</code> <code class="s1">'./settings'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">AuthStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">SignIn</code><code class="o">:</code> <code class="nx">SignIn</code><code class="p">,</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FeedStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">Feed</code><code class="o">:</code> <code class="nx">Feed</code><code class="p">,</code>&#13;
  <code class="nx">Note</code><code class="o">:</code> <code class="nx">Note</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">MyStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">MyNotes</code><code class="o">:</code> <code class="nx">MyNotes</code><code class="p">,</code>&#13;
  <code class="nx">Note</code><code class="o">:</code> <code class="nx">Note</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FavStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">Favorites</code><code class="o">:</code> <code class="nx">Favorites</code><code class="p">,</code>&#13;
  <code class="nx">Note</code><code class="o">:</code> <code class="nx">Note</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SettingsStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">Settings</code><code class="o">:</code> <code class="nx">Settings</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">TabNavigator</code> <code class="o">=</code> <code class="nx">createBottomTabNavigator</code><code class="p">({</code>&#13;
  <code class="nx">FeedScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">screen</code><code class="o">:</code> <code class="nx">FeedStack</code><code class="p">,</code>&#13;
    <code class="nx">navigationOptions</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">tabBarLabel</code><code class="o">:</code> <code class="s1">'Feed'</code><code class="p">,</code>&#13;
      <code class="nx">tabBarIcon</code><code class="o">:</code> <code class="p">({</code> <code class="nx">tintColor</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">MaterialCommunityIcons</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"home"</code> <code class="nx">size</code><code class="o">=</code><code class="p">{</code><code class="mi">24</code><code class="p">}</code> <code class="nx">color</code><code class="o">=</code><code class="p">{</code><code class="nx">tintColor</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">MyNoteScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">screen</code><code class="o">:</code> <code class="nx">MyStack</code><code class="p">,</code>&#13;
    <code class="nx">navigationOptions</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">tabBarLabel</code><code class="o">:</code> <code class="s1">'My Notes'</code><code class="p">,</code>&#13;
      <code class="nx">tabBarIcon</code><code class="o">:</code> <code class="p">({</code> <code class="nx">tintColor</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">MaterialCommunityIcons</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"notebook"</code> <code class="nx">size</code><code class="o">=</code><code class="p">{</code><code class="mi">24</code><code class="p">}</code> <code class="nx">color</code><code class="o">=</code><code class="p">{</code><code class="nx">tintColor</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">FavoriteScreen</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">screen</code><code class="o">:</code> <code class="nx">FavStack</code><code class="p">,</code>&#13;
    <code class="nx">navigationOptions</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">tabBarLabel</code><code class="o">:</code> <code class="s1">'Favorites'</code><code class="p">,</code>&#13;
      <code class="nx">tabBarIcon</code><code class="o">:</code> <code class="p">({</code> <code class="nx">tintColor</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">MaterialCommunityIcons</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"star"</code> <code class="nx">size</code><code class="o">=</code><code class="p">{</code><code class="mi">24</code><code class="p">}</code> <code class="nx">color</code><code class="o">=</code><code class="p">{</code><code class="nx">tintColor</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">},</code>&#13;
  <code class="nx">Settings</code><code class="o">:</code> <code class="p">{</code>&#13;
    <code class="nx">screen</code><code class="o">:</code> <code class="nx">SettingsStack</code><code class="p">,</code>&#13;
    <code class="nx">navigationOptions</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">tabBarLabel</code><code class="o">:</code> <code class="s1">'Settings'</code><code class="p">,</code>&#13;
      <code class="nx">tabBarIcon</code><code class="o">:</code> <code class="p">({</code> <code class="nx">tintColor</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">MaterialCommunityIcons</code> <code class="nx">name</code><code class="o">=</code><code class="s2">"settings"</code> <code class="nx">size</code><code class="o">=</code><code class="p">{</code><code class="mi">24</code><code class="p">}</code> <code class="nx">color</code><code class="o">=</code><code class="p">{</code><code class="nx">tintColor</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SwitchNavigator</code> <code class="o">=</code> <code class="nx">createSwitchNavigator</code><code class="p">(</code>&#13;
  <code class="p">{</code>&#13;
    <code class="nx">AuthLoading</code><code class="o">:</code> <code class="nx">AuthLoading</code><code class="p">,</code>&#13;
    <code class="nx">Auth</code><code class="o">:</code> <code class="nx">AuthStack</code><code class="p">,</code>&#13;
    <code class="nx">App</code><code class="o">:</code> <code class="nx">TabNavigator</code>&#13;
  <code class="p">},</code>&#13;
  <code class="p">{</code>&#13;
    <code class="nx">initialRouteName</code><code class="o">:</code> <code class="s1">'AuthLoading'</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">);</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">createAppContainer</code><code class="p">(</code><code class="nx">SwitchNavigator</code><code class="p">);</code></pre>&#13;
&#13;
<p>Right now, when we preview our app we’ll only see loading spinner, since our <code>AuthLoading</code> route is the initial screen. Let’s update this so that the loading screen checks for the existence of a <code>token</code> value in the application’s <code>SecureStore</code>. If the token is present, we’ll navigate the user to the main application screen. However, if no token is present, the user should be routed to the sign-in screen. Let’s update <em>src/screens/</em><span class="keep-together"><em>authloading.js</em></span> to perform this check:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useEffect</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">AuthLoadingScreen</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">checkLoginState</code> <code class="o">=</code> <code class="nx">async</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// retrieve the value of the token</code>&#13;
    <code class="kr">const</code> <code class="nx">userToken</code> <code class="o">=</code> <code class="nx">await</code> <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">getItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">);</code>&#13;
    <code class="c1">// navigate to the app screen if a token is present</code>&#13;
    <code class="c1">// else navigate to the auth screen</code>&#13;
    <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="nx">userToken</code> <code class="o">?</code> <code class="s1">'App'</code> <code class="o">:</code> <code class="s1">'Auth'</code><code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="c1">// call checkLoginState as soon as the component mounts</code>&#13;
  <code class="nx">useEffect</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">checkLoginState</code><code class="p">();</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">AuthLoadingScreen</code><code class="p">;</code></pre>&#13;
&#13;
<p>With this change, when we load the app we should now be routed to the sign-in screen, since no token is present. For now, let’s update our sign-in screen to store a generic token and navigate to the application when the user presses the button (<a data-type="xref" href="#temp_sign_in">Figure 24-1</a>):</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// store the token with a key value of `token`</code>&#13;
  <code class="c1">// after the token is stored navigate to the app's main screen</code>&#13;
  <code class="kr">const</code> <code class="nx">storeToken</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">setItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="s1">'abc'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'App'</code><code class="p">)</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Sign in!"</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">storeToken</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">SignIn</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Sign In'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignIn</code><code class="p">;</code></pre>&#13;
&#13;
<figure><div class="figure" id="temp_sign_in">&#13;
<img alt="A screenshot of the temporary sign in screen" src="assets/jsev_2401.png"/>&#13;
<h6><span class="label">Figure 24-1. </span>Clicking the button will store a token and route the user to the application</h6>&#13;
</div></figure>&#13;
&#13;
<p>Now, when a user presses the button, a token is stored via <code>SecureStore</code>. With the sign-in functionality in place, let’s add the ability for users to sign out of the application. To do so, we’ll add a button on our settings screen that, when pressed, will remove the <em>token</em> from <code>SecureStore</code> (<a data-type="xref" href="#sign-out">Figure 24-2</a>). In <em>src/screens/settings.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Settings</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// delete the token then navigate to the auth screen</code>&#13;
  <code class="kr">const</code> <code class="nx">signOut</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">deleteItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'Auth'</code><code class="p">)</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Sign Out"</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">signOut</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">Settings</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Settings'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Settings</code><code class="p">;</code></pre>&#13;
&#13;
<figure><div class="figure" id="sign-out">&#13;
<img alt="A screenshot of the setting screen" src="assets/jsev_2402.png"/>&#13;
<h6><span class="label">Figure 24-2. </span>Clicking the button will remove the token from the device and return the user to the sign-in screen</h6>&#13;
</div></figure>&#13;
&#13;
<p>With these pieces in place, we have everything we need to create an application authentication flow.</p>&#13;
<div data-type="tip"><h1>Be Sure to Sign Out</h1>&#13;
<p>If you haven’t already, tap the Sign Out button in your local app instance. We’ll be adding proper sign-in functionality in the upcoming sections.<a data-startref="ix_ch24-asciidoc3" data-type="indexterm" id="idm45339479041048"/><a data-startref="ix_ch24-asciidoc2" data-type="indexterm" id="idm45339479040344"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creating a Sign-in Form" data-type="sect1"><div class="sect1" id="idm45339480479736">&#13;
<h1>Creating a Sign-in Form</h1>&#13;
&#13;
<p><a data-primary="mobile application authentication" data-secondary="creating a sign-in form" data-type="indexterm" id="ix_ch24-asciidoc4"/><a data-primary="sign-in forms" data-type="indexterm" id="ix_ch24-asciidoc5"/>While we can now click a button and store a token on the user’s device, we’re not yet allowing a user to sign in to an account by entering their own information. Let’s begin to remedy this by creating a form where a user can enter their email address and password. To do this, we’ll create a new component at <em>src/components/UserForm.js</em> with a form using React Native’s <code>TextInput</code> component:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">TextInput</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">TouchableOpacity</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Log In"</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">UserForm</code><code class="p">;</code></pre>&#13;
&#13;
<p>Now we can display this form on our authentication screen. To do so, update <em>src/screens/signin.js</em> to import and use the component like so:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">UserForm</code> <code class="nx">from</code> <code class="s1">'../components/UserForm'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">storeToken</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">setItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="s1">'abc'</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'App'</code><code class="p">)</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserForm</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignIn</code><code class="p">;</code></pre>&#13;
&#13;
<p>With this, we’ll see a basic form display on the authentication screen, but it lacks any style or functionality. We can continue implementing the form in our <em>src/components/UserForm.js</em> file. We’ll be using React’s <a data-primary="useState component" data-type="indexterm" id="idm45339478911064"/><code>useState</code> hook to read and set the values of our form elements:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// form element state</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code> <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code> <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code> <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Log In"</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Now we can add a few more additional properties to our form elements to provide users with the expected functionality when working with email addresses or passwords. Full documentation of the <code>TextInput</code> API can be found in the <a href="https://oreil.ly/yvgyU">React Native docs</a>. We’ll also call a function when the button is pressed, though the functionality will be limited.</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// form element state</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// this function is called when the user presses the form button</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"emailAddress"</code>&#13;
        <code class="nx">autoCompleteType</code><code class="o">=</code><code class="s2">"email"</code>&#13;
        <code class="nx">autoFocus</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
        <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">TextInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"password"</code>&#13;
        <code class="nx">secureTextEntry</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Log In"</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">handleSubmit</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>Our form has all of the necessary components, but the styling leaves a lot to be desired. Let’s use the Styled Components library to give the form a more appropriate appearance:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">TextInput</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">TouchableOpacity</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FormView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  padding: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">StyledInput</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TextInput</code><code class="sb">`</code>&#13;
<code class="sb">  border: 1px solid gray;</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">  padding: 8px;</code>&#13;
<code class="sb">  margin-bottom: 24px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FormLabel</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// this function is called when the user presses the form button</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">FormView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"emailAddress"</code>&#13;
        <code class="nx">autoCompleteType</code><code class="o">=</code><code class="s2">"email"</code>&#13;
        <code class="nx">autoFocus</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
        <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"password"</code>&#13;
        <code class="nx">secureTextEntry</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">Button</code> <code class="nx">title</code><code class="o">=</code><code class="s2">"Log In"</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">handleSubmit</code><code class="p">}</code> <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/FormView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">UserForm</code><code class="p">;</code></pre>&#13;
&#13;
<p>Finally, our <a data-primary="button component" data-secondary="mobile application authentication" data-type="indexterm" id="idm45339478481768"/><code>Button</code> component is limited to the default style options, with the exception of accepting a <code>color</code> property value. To create a custom-styled button component, we can use the React Native wrapper <code>TouchableOpacity</code> (see <a data-type="xref" href="#styled-sign-in">Figure 24-3</a>):</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">FormButton</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TouchableOpacity</code><code class="sb">`</code>&#13;
<code class="sb">  background: #0077cc;</code>&#13;
<code class="sb">  width: 100%;</code>&#13;
<code class="sb">  padding: 8px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">ButtonText</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  text-align: center;</code>&#13;
<code class="sb">  color: #fff;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// this function is called when the user presses the form button</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">FormView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"emailAddress"</code>&#13;
        <code class="nx">autoCompleteType</code><code class="o">=</code><code class="s2">"email"</code>&#13;
        <code class="nx">autoFocus</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
        <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"password"</code>&#13;
        <code class="nx">secureTextEntry</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormButton</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">handleSubmit</code><code class="p">}</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">ButtonText</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/ButtonText&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/FormButton&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/FormView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With this, we’ve implemented a sign-in form and applied custom styles. Let’s now implement the form’s functionality.<a data-startref="ix_ch24-asciidoc5" data-type="indexterm" id="idm45339478257128"/><a data-startref="ix_ch24-asciidoc4" data-type="indexterm" id="idm45339478256520"/></p>&#13;
&#13;
<figure><div class="figure" id="styled-sign-in">&#13;
<img alt="A screenshot of the completed sign in form" src="assets/jsev_2403.png"/>&#13;
<h6><span class="label">Figure 24-3. </span>Our sign-in form with custom styles</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Authentication with GraphQL Mutations" data-type="sect1"><div class="sect1" id="idm45339479039288">&#13;
<h1>Authentication with GraphQL Mutations</h1>&#13;
&#13;
<p><a data-primary="GraphQL" data-secondary="mobile application authentication" data-type="indexterm" id="ix_ch24-asciidoc6"/><a data-primary="mobile application authentication" data-secondary="GraphQL mutations" data-type="indexterm" id="ix_ch24-asciidoc7"/>You may recall the authentication flow we’ve developed from the API and web application chapters, but before moving forward let’s do a quick refresher. We will send a GraphQL mutation to our API that includes the user’s email address and password. If the email address is present in our database and the password is correct, our API will respond with a JWT. We can then store the token on the user’s device, as we’ve already been doing, and send it along with every GraphQL request. This will allow us to identify the user on every API request, without requiring them to constantly re-enter their password.</p>&#13;
&#13;
<p>With our form in place, we can write our GraphQL mutation in <em>src/screens/signin.js</em>. First, we’ll add the Apollo libraries as well as our <code>Loading</code> component to our list of imports:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">UserForm</code> <code class="nx">from</code> <code class="s1">'../components/UserForm'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Next, we can add our GraphQL query:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">SIGNIN_USER</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  mutation signIn($email: String, $password: String!) {</code>&#13;
<code class="sb">    signIn(email: $email, password: $password)</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>And update our <a data-primary="storeToken" data-type="indexterm" id="idm45339477966504"/><code>storeToken</code> function to store a token string passed as a parameter:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">storeToken</code> <code class="o">=</code> <code class="nx">token</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
   <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">setItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">token</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
     <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'App'</code><code class="p">)</code>&#13;
   <code class="p">);</code>&#13;
 <code class="p">};</code></pre>&#13;
&#13;
<p>Finally, we update the component as a GraphQL mutation. We’ll also pass several property values to the <code>UserForm</code> component, allowing us to share the mutation data, identify the type of form we are calling, and make use of the router’s navigation.</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">SignIn</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">storeToken</code> <code class="o">=</code> <code class="nx">token</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">setItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">token</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'App'</code><code class="p">)</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">signIn</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNIN_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">storeToken</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">signIn</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="c1">// if loading, return a loading indicator</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">Fragment</code><code class="o">&gt;</code>&#13;
      <code class="p">{</code><code class="nx">error</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">signing</code> <code class="k">in</code><code class="o">!&lt;</code><code class="err">/Text&gt;}</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserForm</code>&#13;
        <code class="nx">action</code><code class="o">=</code><code class="p">{</code><code class="nx">signIn</code><code class="p">}</code>&#13;
        <code class="nx">formType</code><code class="o">=</code><code class="s2">"signIn"</code>&#13;
        <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/React.Fragment&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Now we can make a simple change in our <em>src/components/UserForm.js</em> component, which will enable it to pass the user-entered data to the mutation. Within the component, we will update our <code>handleSubmit</code> function to pass the form values to our <span class="keep-together">mutation:</span></p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="nx">props</code><code class="p">.</code><code class="nx">action</code><code class="p">({</code>&#13;
    <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="nx">email</code><code class="o">:</code> <code class="nx">email</code><code class="p">,</code>&#13;
      <code class="nx">password</code><code class="o">:</code> <code class="nx">password</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>With our mutation written and form complete, users can now sign in to the application, which will store the returned JSON Web Token for future use.<a data-startref="ix_ch24-asciidoc7" data-type="indexterm" id="idm45339477572360"/><a data-startref="ix_ch24-asciidoc6" data-type="indexterm" id="idm45339477571752"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Authenticated GraphQL Queries" data-type="sect1"><div class="sect1" id="idm45339478020536">&#13;
<h1>Authenticated GraphQL Queries</h1>&#13;
&#13;
<p><a data-primary="authenticated GraphQL queries" data-type="indexterm" id="ix_ch24-asciidoc8"/><a data-primary="mobile application authentication" data-secondary="authenticated GraphQL queries" data-type="indexterm" id="ix_ch24-asciidoc9"/>Now that our users can sign-in to their account, we’ll need to use the stored token to authenticate each request. This will allow us to request user-specific data, such as a list of notes by the current user or a list of notes the user has marked as “favorites.” To accomplish this, we’ll update the Apollo configuration to check for the existence of a token and, when one is present, send that token’s value with each API call.</p>&#13;
&#13;
<p>In <em>src/Main.js</em>, first add <code>SecureStore</code> to the list of imports and update the Apollo Client dependencies to include <code>createHttpLink</code> and <code>setContext</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// import the Apollo libraries</code>&#13;
<code class="kr">import</code> <code class="p">{</code>&#13;
  <code class="nx">ApolloClient</code><code class="p">,</code>&#13;
  <code class="nx">ApolloProvider</code><code class="p">,</code>&#13;
  <code class="nx">createHttpLink</code><code class="p">,</code>&#13;
  <code class="nx">InMemoryCache</code>&#13;
<code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">setContext</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'apollo-link-context'</code><code class="p">;</code>&#13;
<code class="c1">// import SecureStore for retrieving the token value</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code></pre>&#13;
&#13;
<p>We can then update our Apollo Client configuration to send the token value with each request:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// configure our API URI &amp; cache</code>&#13;
<code class="kr">const</code> <code class="nx">uri</code> <code class="o">=</code> <code class="nx">API_URI</code><code class="p">;</code>&#13;
<code class="kr">const</code> <code class="nx">cache</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">InMemoryCache</code><code class="p">();</code>&#13;
<code class="kr">const</code> <code class="nx">httpLink</code> <code class="o">=</code> <code class="nx">createHttpLink</code><code class="p">({</code> <code class="nx">uri</code> <code class="p">});</code>&#13;
&#13;
<code class="c1">// return the headers to the context</code>&#13;
<code class="kr">const</code> <code class="nx">authLink</code> <code class="o">=</code> <code class="nx">setContext</code><code class="p">(</code><code class="nx">async</code> <code class="p">(</code><code class="nx">_</code><code class="p">,</code> <code class="p">{</code> <code class="nx">headers</code> <code class="p">})</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">return</code> <code class="p">{</code>&#13;
    <code class="nx">headers</code><code class="o">:</code> <code class="p">{</code>&#13;
      <code class="p">...</code><code class="nx">headers</code><code class="p">,</code>&#13;
      <code class="nx">authorization</code><code class="o">:</code> <code class="p">(</code><code class="nx">await</code> <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">getItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">))</code> <code class="o">||</code> <code class="s1">''</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">};</code>&#13;
<code class="p">});</code>&#13;
&#13;
<code class="c1">// configure Apollo Client</code>&#13;
<code class="kr">const</code> <code class="nx">client</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">ApolloClient</code><code class="p">({</code>&#13;
  <code class="nx">link</code><code class="o">:</code> <code class="nx">authLink</code><code class="p">.</code><code class="nx">concat</code><code class="p">(</code><code class="nx">httpLink</code><code class="p">),</code>&#13;
  <code class="nx">cache</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>With the token sent in the header of each request, we can now update the <code>mynotes</code> and <code>favorites</code> screens to request user-specific data. If you followed along through the web chapters, these queries should look very familiar.</p>&#13;
&#13;
<p>In <em>src/screens/mynotes.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">View</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">NoteFeed</code> <code class="nx">from</code> <code class="s1">'../components/NoteFeed'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// our GraphQL query</code>&#13;
<code class="kr">const</code> <code class="nx">GET_MY_NOTES</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  query me {</code>&#13;
<code class="sb">    me {</code>&#13;
<code class="sb">      id</code>&#13;
<code class="sb">      username</code>&#13;
<code class="sb">      notes {</code>&#13;
<code class="sb">        id</code>&#13;
<code class="sb">        createdAt</code>&#13;
<code class="sb">        content</code>&#13;
<code class="sb">        favoriteCount</code>&#13;
<code class="sb">        author {</code>&#13;
<code class="sb">          username</code>&#13;
<code class="sb">          id</code>&#13;
<code class="sb">          avatar</code>&#13;
<code class="sb">        }</code>&#13;
<code class="sb">      }</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">MyNotes</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">GET_MY_NOTES</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// if the data is loading, our app will display a loading message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
  <code class="c1">// if there is an error fetching the data, display an error message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">loading</code> <code class="nx">notes</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if the query is successful and there are notes, return the feed of notes</code>&#13;
  <code class="c1">// else if the query is successful and there aren't notes, display a message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">me</code><code class="p">.</code><code class="nx">notes</code><code class="p">.</code><code class="nx">length</code> <code class="o">!==</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="nx">notes</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">me</code><code class="p">.</code><code class="nx">notes</code><code class="p">}</code> <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">No</code> <code class="nx">notes</code> <code class="nx">yet</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">MyNotes</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'My Notes'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">MyNotes</code><code class="p">;</code></pre>&#13;
&#13;
<p>In <em>src/screens/favorites.js</em>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">View</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useQuery</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">NoteFeed</code> <code class="nx">from</code> <code class="s1">'../components/NoteFeed'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// our GraphQL query</code>&#13;
<code class="kr">const</code> <code class="nx">GET_MY_FAVORITES</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  query me {</code>&#13;
<code class="sb">    me {</code>&#13;
<code class="sb">      id</code>&#13;
<code class="sb">      username</code>&#13;
<code class="sb">      favorites {</code>&#13;
<code class="sb">        id</code>&#13;
<code class="sb">        createdAt</code>&#13;
<code class="sb">        content</code>&#13;
<code class="sb">        favoriteCount</code>&#13;
<code class="sb">        author {</code>&#13;
<code class="sb">          username</code>&#13;
<code class="sb">          id</code>&#13;
<code class="sb">          avatar</code>&#13;
<code class="sb">        }</code>&#13;
<code class="sb">      }</code>&#13;
<code class="sb">    }</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Favorites</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code><code class="p">,</code> <code class="nx">data</code> <code class="p">}</code> <code class="o">=</code> <code class="nx">useQuery</code><code class="p">(</code><code class="nx">GET_MY_FAVORITES</code><code class="p">);</code>&#13;
&#13;
  <code class="c1">// if the data is loading, our app will display a loading message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
  <code class="c1">// if there is an error fetching the data, display an error message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">error</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">loading</code> <code class="nx">notes</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="c1">// if the query is successful and there are notes, return the feed of notes</code>&#13;
  <code class="c1">// else if the query is successful and there aren't notes, display a message</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">me</code><code class="p">.</code><code class="nx">favorites</code><code class="p">.</code><code class="nx">length</code> <code class="o">!==</code> <code class="mi">0</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">NoteFeed</code> <code class="nx">notes</code><code class="o">=</code><code class="p">{</code><code class="nx">data</code><code class="p">.</code><code class="nx">me</code><code class="p">.</code><code class="nx">favorites</code><code class="p">}</code> <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">No</code> <code class="nx">notes</code> <code class="nx">yet</code><code class="o">&lt;</code><code class="err">/Text&gt;;</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">Favorites</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Favorites'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">Favorites</code><code class="p">;</code></pre>&#13;
&#13;
<figure><div class="figure" id="authenticated_query">&#13;
<img alt="An image of a cartoonish tiger head" src="assets/jsev_2404.png"/>&#13;
<h6><span class="label">Figure 24-4. </span>Passing the token in the header of each request allows us to make user-specific queries in our application</h6>&#13;
</div></figure>&#13;
&#13;
<p>We are now retrieving user-specific data based on the token value stored on the user’s device (<a data-type="xref" href="#authenticated_query">Figure 24-4</a>).<a data-startref="ix_ch24-asciidoc9" data-type="indexterm" id="idm45339476946792"/><a data-startref="ix_ch24-asciidoc8" data-type="indexterm" id="idm45339476946088"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Adding a Sign-up Form" data-type="sect1"><div class="sect1" id="idm45339477570552">&#13;
<h1>Adding a Sign-up Form</h1>&#13;
&#13;
<p><a data-primary="mobile application authentication" data-secondary="adding a sign-up form" data-type="indexterm" id="ix_ch24-asciidoc10"/><a data-primary="sign-up forms" data-secondary="mobile application authentication" data-type="indexterm" id="ix_ch24-asciidoc11"/>Right now a user can sign in to an existing account, but they have no way to create an account if one doesn’t exist. A common UI pattern is to add a link to a registration form below the sign-in link (or vice versa). Let’s add a sign-up screen to allow users to create a new account from within our application.</p>&#13;
&#13;
<p>To begin, let’s create a new screen component at <em>src/screens/signup.js</em>. This component will be nearly identical to our sign-in screen, but we’ll call our <code>signUp</code> GraphQL mutation and pass a <code>formType="signUp"</code> property to our <code>UserForm</code> component:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">Text</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="o">*</code> <code class="nx">as</code> <code class="nx">SecureStore</code> <code class="nx">from</code> <code class="s1">'expo-secure-store'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">useMutation</code><code class="p">,</code> <code class="nx">gql</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'@apollo/client'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">import</code> <code class="nx">UserForm</code> <code class="nx">from</code> <code class="s1">'../components/UserForm'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">Loading</code> <code class="nx">from</code> <code class="s1">'../components/Loading'</code><code class="p">;</code>&#13;
&#13;
<code class="c1">// signUp GraphQL mutation</code>&#13;
<code class="kr">const</code> <code class="nx">SIGNUP_USER</code> <code class="o">=</code> <code class="nx">gql</code><code class="sb">`</code>&#13;
<code class="sb">  mutation signUp($email: String!, $username: String!, $password: String!) {</code>&#13;
<code class="sb">    signUp(email: $email, username: $username, password: $password)</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="c1">// store the token with a key value of `token`</code>&#13;
  <code class="c1">// after the token is stored navigate to the app's main screen</code>&#13;
  <code class="kr">const</code> <code class="nx">storeToken</code> <code class="o">=</code> <code class="nx">token</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">SecureStore</code><code class="p">.</code><code class="nx">setItemAsync</code><code class="p">(</code><code class="s1">'token'</code><code class="p">,</code> <code class="nx">token</code><code class="p">).</code><code class="nx">then</code><code class="p">(</code>&#13;
      <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'App'</code><code class="p">)</code>&#13;
    <code class="p">);</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="c1">// the signUp mutation hook</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">signUp</code><code class="p">,</code> <code class="p">{</code> <code class="nx">loading</code><code class="p">,</code> <code class="nx">error</code> <code class="p">}]</code> <code class="o">=</code> <code class="nx">useMutation</code><code class="p">(</code><code class="nx">SIGNUP_USER</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">onCompleted</code><code class="o">:</code> <code class="nx">data</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
      <code class="nx">storeToken</code><code class="p">(</code><code class="nx">data</code><code class="p">.</code><code class="nx">signUp</code><code class="p">);</code>&#13;
    <code class="p">}</code>&#13;
  <code class="p">});</code>&#13;
&#13;
  <code class="c1">// if loading, return a loading indicator</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">loading</code><code class="p">)</code> <code class="k">return</code> <code class="o">&lt;</code><code class="nx">Loading</code> <code class="o">/&gt;</code><code class="p">;</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">React</code><code class="p">.</code><code class="nx">Fragment</code><code class="o">&gt;</code>&#13;
      <code class="p">{</code><code class="nx">error</code> <code class="o">&amp;&amp;</code> <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nb">Error</code> <code class="nx">signing</code> <code class="k">in</code><code class="o">!&lt;</code><code class="err">/Text&gt;}</code>&#13;
      <code class="o">&lt;</code><code class="nx">UserForm</code>&#13;
        <code class="nx">action</code><code class="o">=</code><code class="p">{</code><code class="nx">signUp</code><code class="p">}</code>&#13;
        <code class="nx">formType</code><code class="o">=</code><code class="s2">"signUp"</code>&#13;
        <code class="nx">navigation</code><code class="o">=</code><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/React.Fragment&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="nx">SignUp</code><code class="p">.</code><code class="nx">navigationOptions</code> <code class="o">=</code> <code class="p">{</code>&#13;
  <code class="nx">title</code><code class="o">:</code> <code class="s1">'Register'</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">SignUp</code><code class="p">;</code></pre>&#13;
&#13;
<p>With the screen created, we can add it to our router. In the <em>src/screens/index.js</em> file, first add the new component to our list of file imports:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">SignUp</code> <code class="nx">from</code> <code class="s1">'./signup'</code><code class="p">;</code></pre>&#13;
&#13;
<p>Next, we will update our <code>AuthStack</code> to include the sign-up screen:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">AuthStack</code> <code class="o">=</code> <code class="nx">createStackNavigator</code><code class="p">({</code>&#13;
  <code class="nx">SignIn</code><code class="o">:</code> <code class="nx">SignIn</code><code class="p">,</code>&#13;
  <code class="nx">SignUp</code><code class="o">:</code> <code class="nx">SignUp</code>&#13;
<code class="p">});</code></pre>&#13;
&#13;
<p>With this, our component is created and routable; however, our <code>UserForm</code> component does not contain all of the necessary fields. Rather than creating a registration form component, we can make use of the <a data-primary="formType" data-type="indexterm" id="idm45339476690648"/><code>formType</code> property that we’re passing to <code>UserForm</code> to customize the form, depending on the type.</p>&#13;
&#13;
<p>In our <em>src/components/UserForm.js</em> file, let’s first update the form to include a username field when the <code>formType</code> equals <code>signUp</code>:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">username</code><code class="p">,</code> <code class="nx">setUsername</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">props</code><code class="p">.</code><code class="nx">action</code><code class="p">({</code>&#13;
      <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="nx">email</code><code class="o">:</code> <code class="nx">email</code><code class="p">,</code>&#13;
        <code class="nx">password</code><code class="o">:</code> <code class="nx">password</code><code class="p">,</code>&#13;
        <code class="nx">username</code><code class="o">:</code> <code class="nx">username</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">FormView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"emailAddress"</code>&#13;
        <code class="nx">autoCompleteType</code><code class="o">=</code><code class="s2">"email"</code>&#13;
        <code class="nx">autoFocus</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
        <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">===</code> <code class="s1">'signUp'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
            <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setUsername</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
            <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">username</code><code class="p">}</code>&#13;
            <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"username"</code>&#13;
            <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
          <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
      <code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"password"</code>&#13;
        <code class="nx">secureTextEntry</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormButton</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">handleSubmit</code><code class="p">}</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">ButtonText</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/ButtonText&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/FormButton&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/FormView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code></pre>&#13;
&#13;
<p>Next, let’s add a link at the bottom of the sign-in form that will allow a user to route to the sign-up form when pressed:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="k">return</code> <code class="p">(</code>&#13;
  <code class="o">&lt;</code><code class="nx">FormView</code><code class="o">&gt;</code>&#13;
      <code class="p">{</code><code class="cm">/* existing form component code is here */</code><code class="p">}</code>&#13;
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">!==</code> <code class="s1">'signUp'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">TouchableOpacity</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'SignUp'</code><code class="p">)}</code><code class="o">&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">up</code><code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
        <code class="o">&lt;</code><code class="err">/TouchableOpacity&gt;</code>&#13;
      <code class="p">)}</code>&#13;
  <code class="o">&lt;</code><code class="err">/FormView&gt;</code>&#13;
<code class="p">)</code></pre>&#13;
&#13;
<p>We can then use styled components to update the look of the link:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TouchableOpacity</code><code class="sb">`</code>&#13;
<code class="sb">  margin-top: 20px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Link</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  color: #0077cc;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">`</code><code class="p">;</code></pre>&#13;
&#13;
<p>And in the component’s JSX:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">!==</code> <code class="s1">'signUp'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
  <code class="o">&lt;</code><code class="nx">SignUp</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'SignUp'</code><code class="p">)}</code><code class="o">&gt;</code>&#13;
    <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code>&#13;
      <code class="nx">Need</code> <code class="nx">an</code> <code class="nx">account</code><code class="o">?</code> <code class="o">&lt;</code><code class="nx">Link</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">up</code><code class="p">.</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>&#13;
    <code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
  <code class="o">&lt;</code><code class="err">/SignUp&gt;</code>&#13;
<code class="p">)}</code></pre>&#13;
&#13;
<p>All together, our <em>src/components/UserForm.js</em> file will now be as follows:</p>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">import</code> <code class="nx">React</code><code class="p">,</code> <code class="p">{</code> <code class="nx">useState</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="p">{</code> <code class="nx">View</code><code class="p">,</code> <code class="nx">Text</code><code class="p">,</code> <code class="nx">TextInput</code><code class="p">,</code> <code class="nx">Button</code><code class="p">,</code> <code class="nx">TouchableOpacity</code> <code class="p">}</code> <code class="nx">from</code> <code class="s1">'react-native'</code><code class="p">;</code>&#13;
<code class="kr">import</code> <code class="nx">styled</code> <code class="nx">from</code> <code class="s1">'styled-components/native'</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FormView</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">View</code><code class="sb">`</code>&#13;
<code class="sb">  padding: 10px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">StyledInput</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TextInput</code><code class="sb">`</code>&#13;
<code class="sb">  border: 1px solid gray;</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">  padding: 8px;</code>&#13;
<code class="sb">  margin-bottom: 24px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FormLabel</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">FormButton</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TouchableOpacity</code><code class="sb">`</code>&#13;
<code class="sb">  background: #0077cc;</code>&#13;
<code class="sb">  width: 100%;</code>&#13;
<code class="sb">  padding: 8px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">ButtonText</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  text-align: center;</code>&#13;
<code class="sb">  color: #fff;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">  font-size: 18px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">SignUp</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">TouchableOpacity</code><code class="sb">`</code>&#13;
<code class="sb">  margin-top: 20px;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">Link</code> <code class="o">=</code> <code class="nx">styled</code><code class="p">.</code><code class="nx">Text</code><code class="sb">`</code>&#13;
<code class="sb">  color: #0077cc;</code>&#13;
<code class="sb">  font-weight: bold;</code>&#13;
<code class="sb">`</code><code class="p">;</code>&#13;
&#13;
<code class="kr">const</code> <code class="nx">UserForm</code> <code class="o">=</code> <code class="nx">props</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">email</code><code class="p">,</code> <code class="nx">setEmail</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">password</code><code class="p">,</code> <code class="nx">setPassword</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
  <code class="kr">const</code> <code class="p">[</code><code class="nx">username</code><code class="p">,</code> <code class="nx">setUsername</code><code class="p">]</code> <code class="o">=</code> <code class="nx">useState</code><code class="p">();</code>&#13;
&#13;
  <code class="kr">const</code> <code class="nx">handleSubmit</code> <code class="o">=</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nx">props</code><code class="p">.</code><code class="nx">action</code><code class="p">({</code>&#13;
      <code class="nx">variables</code><code class="o">:</code> <code class="p">{</code>&#13;
        <code class="nx">email</code><code class="o">:</code> <code class="nx">email</code><code class="p">,</code>&#13;
        <code class="nx">password</code><code class="o">:</code> <code class="nx">password</code><code class="p">,</code>&#13;
        <code class="nx">username</code><code class="o">:</code> <code class="nx">username</code>&#13;
      <code class="p">}</code>&#13;
    <code class="p">});</code>&#13;
  <code class="p">};</code>&#13;
&#13;
  <code class="k">return</code> <code class="p">(</code>&#13;
    <code class="o">&lt;</code><code class="nx">FormView</code><code class="o">&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Email</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setEmail</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">email</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"emailAddress"</code>&#13;
        <code class="nx">autoCompleteType</code><code class="o">=</code><code class="s2">"email"</code>&#13;
        <code class="nx">autoFocus</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
        <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">===</code> <code class="s1">'signUp'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">View</code><code class="o">&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Username</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
            <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setUsername</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
            <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">username</code><code class="p">}</code>&#13;
            <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"username"</code>&#13;
            <code class="nx">autoCapitalize</code><code class="o">=</code><code class="s2">"none"</code>&#13;
          <code class="o">/&gt;</code>&#13;
        <code class="o">&lt;</code><code class="err">/View&gt;</code>&#13;
      <code class="p">)}</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormLabel</code><code class="o">&gt;</code><code class="nx">Password</code><code class="o">&lt;</code><code class="err">/FormLabel&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">StyledInput</code>&#13;
        <code class="nx">onChangeText</code><code class="o">=</code><code class="p">{</code><code class="nx">text</code> <code class="o">=&gt;</code> <code class="nx">setPassword</code><code class="p">(</code><code class="nx">text</code><code class="p">)}</code>&#13;
        <code class="nx">value</code><code class="o">=</code><code class="p">{</code><code class="nx">password</code><code class="p">}</code>&#13;
        <code class="nx">textContentType</code><code class="o">=</code><code class="s2">"password"</code>&#13;
        <code class="nx">secureTextEntry</code><code class="o">=</code><code class="p">{</code><code class="kc">true</code><code class="p">}</code>&#13;
      <code class="o">/&gt;</code>&#13;
      <code class="o">&lt;</code><code class="nx">FormButton</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{</code><code class="nx">handleSubmit</code><code class="p">}</code><code class="o">&gt;</code>&#13;
        <code class="o">&lt;</code><code class="nx">ButtonText</code><code class="o">&gt;</code><code class="nx">Submit</code><code class="o">&lt;</code><code class="err">/ButtonText&gt;</code>&#13;
      <code class="o">&lt;</code><code class="err">/FormButton&gt;</code>&#13;
      <code class="p">{</code><code class="nx">props</code><code class="p">.</code><code class="nx">formType</code> <code class="o">!==</code> <code class="s1">'signUp'</code> <code class="o">&amp;&amp;</code> <code class="p">(</code>&#13;
        <code class="o">&lt;</code><code class="nx">SignUp</code> <code class="nx">onPress</code><code class="o">=</code><code class="p">{()</code> <code class="o">=&gt;</code> <code class="nx">props</code><code class="p">.</code><code class="nx">navigation</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s1">'SignUp'</code><code class="p">)}</code><code class="o">&gt;</code>&#13;
          <code class="o">&lt;</code><code class="nx">Text</code><code class="o">&gt;</code>&#13;
            <code class="nx">Need</code> <code class="nx">an</code> <code class="nx">account</code><code class="o">?</code> <code class="o">&lt;</code><code class="nx">Link</code><code class="o">&gt;</code><code class="nx">Sign</code> <code class="nx">up</code><code class="p">.</code><code class="o">&lt;</code><code class="err">/Link&gt;</code>&#13;
          <code class="o">&lt;</code><code class="err">/Text&gt;</code>&#13;
        <code class="o">&lt;</code><code class="err">/SignUp&gt;</code>&#13;
      <code class="p">)}</code>&#13;
    <code class="o">&lt;</code><code class="err">/FormView&gt;</code>&#13;
  <code class="p">);</code>&#13;
<code class="p">};</code>&#13;
&#13;
<code class="kr">export</code> <code class="k">default</code> <code class="nx">UserForm</code><code class="p">;</code></pre>&#13;
&#13;
<p>With these changes, a user can both sign in and register for an account with our application (<a data-type="xref" href="#reg_screen">Figure 24-5</a>).<a data-startref="ix_ch24-asciidoc11" data-type="indexterm" id="idm45339476119768"/><a data-startref="ix_ch24-asciidoc10" data-type="indexterm" id="idm45339476119128"/></p>&#13;
&#13;
<figure><div class="figure" id="reg_screen">&#13;
<img alt="A screenshot of the completed sign in and sign up screens" src="assets/jsev_2405.png"/>&#13;
<h6><span class="label">Figure 24-5. </span>A user can now register an account and navigate between the authentication screens</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conclusion" data-type="sect1"><div class="sect1" id="idm45339476944504">&#13;
<h1>Conclusion</h1>&#13;
&#13;
<p>In this chapter we looked at how to bring authentication to an application. Through a combination of React Native’s text form elements, React Navigation’s routing capabilities, Expo’s SecureStore library, and GraphQL mutations, we can create a user-friendly authentication flow. Having a solid understanding of this type of authentication also enables us to explore additional React Native authentication methods, such as Expo’s <a href="https://oreil.ly/RaxNo"><code>AppAuth</code></a> or <a href="https://oreil.ly/Ic6BW"><code>GoogleSignIn</code></a>. In this next chapter, we’ll look at how we can publish and distribute a React Native application.<a data-startref="ix_ch24-asciidoc1" data-type="indexterm" id="idm45339475669352"/><a data-startref="ix_ch24-asciidoc0" data-type="indexterm" id="idm45339475668680"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>