<html><head></head><body><section data-pdf-bookmark="Chapter 17. CSS" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch_css">&#13;
<h1><span class="label">Chapter 17. </span>CSS</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Introduction" data-type="sect1"><div class="sect1" id="id230">&#13;
<h1>Introduction</h1>&#13;
&#13;
<p><a data-primary="CSS" data-type="indexterm" id="ix_17-css-asciidoc0"/>In <a data-primary="CSS" data-secondary="basics" data-type="indexterm" id="id1222"/>the modern browser environment, CSS not only lets you write style rules but also has a set of APIs you can use to further enhance your application.</p>&#13;
&#13;
<p><a data-primary="CSS Object Model (CSSOM)" data-type="indexterm" id="id1223"/>The CSS Object Model (CSSOM) allows you to set inline styles programmatically from JavaScript code. Not only that, but you can even change the values of CSS variables at runtime.</p>&#13;
&#13;
<p>In <a data-type="xref" href="ch08.html#ch_webAnimationsApi">Chapter 8</a>, you saw an example of using <code>window.matchMedia</code> to programmatically check a media query to see if it matches on the current page.</p>&#13;
&#13;
<p>This chapter has some helpful recipes that use some of these CSS-related APIs. At the time of writing, some of these APIs do not have good browser support. Always check browser compatibility before using them.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Highlighting Text Ranges" data-type="sect1"><div class="sect1" id="id654">&#13;
<h1>Highlighting Text Ranges</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id231">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="highlighting text ranges" data-type="indexterm" id="ix_17-css-asciidoc1"/><a data-primary="CSS Custom Highlight API" data-type="indexterm" id="ix_17-css-asciidoc2"/><a data-primary="highlighting text ranges" data-type="indexterm" id="ix_17-css-asciidoc3"/><a data-primary="text" data-secondary="highlighting text ranges" data-type="indexterm" id="ix_17-css-asciidoc4"/>You want to apply a highlight effect to a range of text in the document.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id655">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <code>Range</code> object around the desired text, then use the CSS Custom Highlight API to apply the highlighting styles to that range.</p>&#13;
&#13;
<p>The first step is to create a <code>Range</code> object. This object represents a region of text within the document. <a data-type="xref" href="#example17-1">Example 17-1</a> shows a general purpose utility function to create a range given a text node and the text to highlight.</p>&#13;
<div data-type="example" id="example17-1">&#13;
<h5><span class="label">Example 17-1. </span>Creating a Range</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Given a text node and a substring to highlight, creates a Range object covering</code>&#13;
<code class="cm"> * the desired text.</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">function</code> <code class="nx">getRange</code><code class="p">(</code><code class="nx">textNode</code><code class="p">,</code> <code class="nx">textToHighlight</code><code class="p">)</code> <code class="p">{</code>&#13;
  <code class="kr">const</code> <code class="nx">startOffset</code> <code class="o">=</code> <code class="nx">textNode</code><code class="p">.</code><code class="nx">textContent</code><code class="p">.</code><code class="nx">indexOf</code><code class="p">(</code><code class="nx">textToHighlight</code><code class="p">);</code>&#13;
  <code class="kr">const</code> <code class="nx">endOffset</code> <code class="o">=</code> <code class="nx">startOffset</code> <code class="o">+</code> <code class="nx">textToHighlight</code><code class="p">.</code><code class="nx">length</code><code class="p">;</code>&#13;
&#13;
  <code class="c1">// Create a Range for the text to highlight.</code>&#13;
  <code class="kr">const</code> <code class="nx">range</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Range</code><code class="p">();</code>&#13;
  <code class="nx">range</code><code class="p">.</code><code class="nx">setStart</code><code class="p">(</code><code class="nx">textNode</code><code class="p">,</code> <code class="nx">startOffset</code><code class="p">);</code>&#13;
  <code class="nx">range</code><code class="p">.</code><code class="nx">setEnd</code><code class="p">(</code><code class="nx">textNode</code><code class="p">,</code> <code class="nx">endOffset</code><code class="p">);</code>&#13;
&#13;
  <code class="k">return</code> <code class="nx">range</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This API may not be supported by all browsers yet. See <a href="https://oreil.ly/wDJWH">CanIUse</a> for the latest compatibility data.</p>&#13;
</div>&#13;
&#13;
<p>Suppose you have the HTML element shown in <a data-type="xref" href="#example17-2">Example 17-2</a>.</p>&#13;
<div data-type="example" id="example17-2">&#13;
<h5><span class="label">Example 17-2. </span>Some HTML markup</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">p</code> <code class="na">id</code><code class="o">=</code><code class="s">"text"</code><code class="p">&gt;</code>&#13;
  This is some text. We're using the CSS Custom Highlight API to highlight some of&#13;
  the text.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>If you wanted to highlight the text “highlight some of the text,” you can use the <code>getRange</code> helper to create a <code>Range</code> around that text (see <a data-type="xref" href="#example17-3">Example 17-3</a>).</p>&#13;
<div data-type="example" id="example17-3">&#13;
<h5><span class="label">Example 17-3. </span>Using the <code>getRange</code> helper</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">node</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#text'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">range</code> <code class="o">=</code> <code class="nx">getRange</code><code class="p">(</code><code class="nx">node</code><code class="p">.</code><code class="nx">firstChild</code><code class="p">,</code> <code class="s1">'highlight some of the text'</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Now that you have the range, you need to register a new highlight with the browser’s highlight registry. Do this by creating a new <code>Highlight</code> object with the range, and then pass that <code>Highlight</code> to the <code>CSS.highlights.set</code> function (see <a data-type="xref" href="#code_registerHighlight">Example 17-4</a>).</p>&#13;
<div data-type="example" id="code_registerHighlight">&#13;
<h5><span class="label">Example 17-4. </span>Registering the highlight</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">highlight</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">Highlight</code><code class="p">(</code><code class="nx">range</code><code class="p">);</code>&#13;
<code class="nx">CSS</code><code class="p">.</code><code class="nx">highlights</code><code class="p">.</code><code class="nx">set</code><code class="p">(</code><code class="s1">'highlight-range'</code><code class="p">,</code> <code class="nx">highlight</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>This registers the highlight, but by default this has no visual effect. Next, you need to create some CSS styles that you’d like to apply to the highlight. This is done by using the <code>::highlight</code> pseudo-element. You use this pseudo-element combined with the key you registered the <code>Highlight</code> under in <a data-type="xref" href="#code_registerHighlight">Example 17-4</a> (see <a data-type="xref" href="#example17-5">Example 17-5</a>).</p>&#13;
<div data-type="example" id="example17-5">&#13;
<h5><span class="label">Example 17-5. </span>Styling the highlight</h5>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nd">::highlight</code><code class="o">(</code><code class="nt">highlight-range</code><code class="o">)</code> <code class="p">{</code>&#13;
  <code class="k">background-color</code><code class="o">:</code> <code class="m">#fef3c7</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>With this style applied, the text inside the range is now highlighted with a light amber color.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id232">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="&lt;mark&gt; element" data-primary-sortas="mark" data-type="indexterm" id="id1224"/>You can also highlight content by using the <code>&lt;mark&gt;</code> element. <a data-type="xref" href="#example17-6">Example 17-6</a> shows how to highlight some text with <code>&lt;mark&gt;</code>.</p>&#13;
<div data-type="example" id="example17-6">&#13;
<h5><span class="label">Example 17-6. </span>Highlighting using the mark element</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">p</code> <code class="na">id</code><code class="o">=</code><code class="s">"text"</code><code class="p">&gt;</code>&#13;
  This is some text. We're using the mark element to&#13;
  <code class="p">&lt;</code><code class="nt">mark</code><code class="p">&gt;</code>highlight some of the text<code class="p">&lt;/</code><code class="nt">mark</code><code class="p">&gt;</code>.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>This has the same visual effect as using the CSS Custom Highlight API, but the key difference is that using <code>&lt;mark&gt;</code> involves inserting a new element into the DOM. This can be tricky depending on where you are adding the new element.</p>&#13;
&#13;
<p>For example, if the text you want to highlight spans multiple elements, it may not be possible to do this with a <code>&lt;mark&gt;</code> element and still be valid HTML. Consider the HTML in <a data-type="xref" href="#example17-7">Example 17-7</a>.</p>&#13;
<div data-type="example" id="example17-7">&#13;
<h5><span class="label">Example 17-7. </span>Some markup to highlight</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  This is a paragraph, which is being highlighted.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
&#13;
&#13;
&#13;
<code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  The highlight extends to this paragraph. This is not highlighted.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>If you want to highlight “which is being highlighted. The highlight extends to this paragraph,” you can’t do this with a single <code>&lt;mark&gt;</code> element (see <a data-type="xref" href="#example17-8">Example 17-8</a>).</p>&#13;
<div data-type="example" id="example17-8">&#13;
<h5><span class="label">Example 17-8. </span>Invalid HTML</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  This is a paragraph, <code class="p">&lt;</code><code class="nt">mark</code><code class="p">&gt;</code>which is being highlighted.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">p</code><code class="p">&gt;</code>&#13;
  The highlight extends to this paragraph<code class="p">&lt;/</code><code class="nt">mark</code><code class="p">&gt;</code>. This is not highlighted.&#13;
<code class="p">&lt;/</code><code class="nt">p</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>This is not valid HTML. The solution would be to use two separate <code>&lt;mark&gt;</code> elements, but then it’s not a single continuous highlighted region.</p>&#13;
&#13;
<p>Using the CSS Custom Highlight API makes such highlighting possible by creating a range that spans multiple tags and applying the highlight effect<a data-startref="ix_17-css-asciidoc4" data-type="indexterm" id="id1225"/><a data-startref="ix_17-css-asciidoc3" data-type="indexterm" id="id1226"/><a data-startref="ix_17-css-asciidoc2" data-type="indexterm" id="id1227"/><a data-startref="ix_17-css-asciidoc1" data-type="indexterm" id="id1228"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Preventing a Flash of Unstyled Text" data-type="sect1"><div class="sect1" id="id656">&#13;
<h1>Preventing a Flash of Unstyled Text</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id233">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="preventing a flash of unstyled text" data-type="indexterm" id="ix_17-css-asciidoc5"/><a data-primary="CSS Font Loading API" data-type="indexterm" id="ix_17-css-asciidoc6"/><a data-primary="text" data-secondary="preventing flash of unstyled text" data-type="indexterm" id="ix_17-css-asciidoc7"/><a data-primary="unstyled text, preventing flash of" data-type="indexterm" id="ix_17-css-asciidoc8"/><a data-primary="web fonts, preventing flash of unstyled text with" data-type="indexterm" id="ix_17-css-asciidoc9"/>You want to avoid the flash of unstyled text when using web fonts.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id657">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the CSS Font Loading API to explicitly load the font faces you want to use in your application, and delay rendering any text until the fonts have been loaded.</p>&#13;
&#13;
<p>To load a font with this API, you first create a <code>FontFace</code> object containing data about the font face you want to load. <a data-type="xref" href="#example17-9">Example 17-9</a> uses the Roboto font.</p>&#13;
<div data-type="example" id="example17-9">&#13;
<h5><span class="label">Example 17-9. </span>Creating the Roboto font face</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">roboto</code> <code class="o">=</code> <code class="k">new</code> <code class="nx">FontFace</code><code class="p">(</code>&#13;
  <code class="s1">'Roboto'</code><code class="p">,</code>&#13;
  <code class="s1">'url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2)'</code><code class="p">,</code> <code class="p">{</code>&#13;
    <code class="nx">style</code><code class="o">:</code> <code class="s1">'normal'</code><code class="p">,</code>&#13;
    <code class="nx">weight</code><code class="o">:</code> <code class="mi">400</code>&#13;
  <code class="p">});</code></pre></div>&#13;
&#13;
<p>The document has a global <code>fonts</code> property, which is a <code>FontFaceSet</code>, containing all of the font faces used in the document. In order to use this font face, you need to add it to the <code>FontFaceSet</code> (see <a data-type="xref" href="#example17-10">Example 17-10</a>).</p>&#13;
<div data-type="example" id="example17-10">&#13;
<h5><span class="label">Example 17-10. </span>Adding Roboto to the global <code>FontFaceSet</code></h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nb">document</code><code class="p">.</code><code class="nx">fonts</code><code class="p">.</code><code class="nx">add</code><code class="p">(</code><code class="nx">roboto</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>So far, you’ve only defined the font. Nothing has been loaded yet. You can start the loading process by calling <code>load</code> on the <code>FontFace</code> object (see <a data-type="xref" href="#example17-11">Example 17-11</a>). This returns a <code>Promise</code> that is resolved once the font is loaded.</p>&#13;
<div data-type="example" id="example17-11">&#13;
<h5><span class="label">Example 17-11. </span>Waiting for the font to be loaded</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="nx">roboto</code><code class="p">.</code><code class="nx">load</code><code class="p">()</code>&#13;
  <code class="p">.</code><code class="nx">then</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="c1">// Font has been loaded and is ready for use.</code>&#13;
  <code class="p">});</code></pre></div>&#13;
&#13;
<p>To prevent the flash of unstyled text, you’ll need to hide the text that uses this font until it has finished loading. If your app shows an initial loading animation, for example, you could continue the animation until the necessary fonts are loaded, then remove the loader and start rendering the app.</p>&#13;
&#13;
<p>If your app is using multiple fonts, you can wait for the <code>document.fonts.ready</code> <code>Promise</code>. This <code>Promise</code> is resolved once all fonts are loaded and ready.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id234">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>When using web fonts with CSS, fonts are declared with a <code>@font-face</code> rule, which contains the URL of the font file to download. If text is rendered before the font has finished loading, a fallback system font is used. Once the font is ready, the text is re-rendered with the correct font. This can cause undesirable effects such as layout shifts if the font metrics are different.</p>&#13;
&#13;
<p>The downside of using <code>@font-face</code> is that you have no way of knowing when the font has been loaded and is ready for use. By using the CSS Font Loading API, you can get better control over your font loading and know exactly when it’s safe to start using a given font to render text.</p>&#13;
&#13;
<p>If there is an error while loading the font—for example, maybe you mistyped the font URL—the <code>Promise</code> returned by the font’s <code>load</code> method rejects with the error<a data-startref="ix_17-css-asciidoc9" data-type="indexterm" id="id1229"/><a data-startref="ix_17-css-asciidoc8" data-type="indexterm" id="id1230"/><a data-startref="ix_17-css-asciidoc7" data-type="indexterm" id="id1231"/><a data-startref="ix_17-css-asciidoc6" data-type="indexterm" id="id1232"/><a data-startref="ix_17-css-asciidoc5" data-type="indexterm" id="id1233"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Animating DOM Transitions" data-type="sect1"><div class="sect1" id="id658">&#13;
<h1>Animating DOM Transitions</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id319">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="animations" data-secondary="DOM transitions" data-type="indexterm" id="ix_17-css-asciidoc10"/><a data-primary="CSS" data-secondary="animating DOM transitions" data-type="indexterm" id="ix_17-css-asciidoc11"/><a data-primary="DOM elements" data-secondary="animating transitions" data-type="indexterm" id="ix_17-css-asciidoc12"/><a data-primary="transitions" data-secondary="animating DOM transitions" data-type="indexterm" id="ix_17-css-asciidoc13"/>You want to show an animated transition when removing or adding elements to the DOM.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id659">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the View Transitions API to provide an animated transition between the two states.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>This API may not be supported by all browsers yet. See <a href="https://oreil.ly/I8RFN">CanIUse</a> for the latest compatibility data.</p>&#13;
</div>&#13;
&#13;
<p>This API is used to apply a transition effect between two DOM states. To start a view transition, call the <code>document.startViewTransition</code> function. This function takes a callback function as its argument. You need to perform your DOM changes within this callback function.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#code_simpleViewTransition">Example 17-12</a>, imagine you have a single-page app. Each view of the app is a top-level HTML element with a unique ID. To route between views, you can remove the current view and add the new one.</p>&#13;
<div data-type="example" id="code_simpleViewTransition">&#13;
<h5><span class="label">Example 17-12. </span>A simple view transition</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kd">function</code> <code class="nx">showAboutPage</code><code class="p">()</code> <code class="p">{</code>&#13;
  <code class="nb">document</code><code class="p">.</code><code class="nx">startViewTransition</code><code class="p">(()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#home-page'</code><code class="p">).</code><code class="nx">style</code><code class="p">.</code><code class="nx">display</code> <code class="o">=</code> <code class="s1">'none'</code><code class="p">;</code>&#13;
    <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#about-page'</code><code class="p">).</code><code class="nx">style</code><code class="p">.</code><code class="nx">display</code> <code class="o">=</code> <code class="s1">'block'</code><code class="p">;</code>&#13;
  <code class="p">});</code>&#13;
<code class="p">}</code></pre></div>&#13;
&#13;
<p>This applies a basic cross-fade transition effect between the two views.</p>&#13;
&#13;
<p>If you want to adjust the speed of the cross-fade transition, you can do so with a bit of CSS, as shown in <a data-type="xref" href="#example17-13">Example 17-13</a>.</p>&#13;
<div data-type="example" id="example17-13">&#13;
<h5><span class="label">Example 17-13. </span>Slowing down the transition</h5>&#13;
&#13;
<pre data-code-language="css" data-type="programlisting"><code class="nd">::view-transition-old</code><code class="o">(</code><code class="nt">root</code><code class="o">),</code>&#13;
<code class="nd">::view-transition-new</code><code class="o">(</code><code class="nt">root</code><code class="o">)</code> <code class="p">{</code>&#13;
  <code class="k">animation-duration</code><code class="o">:</code> <code class="m">2s</code><code class="p">;</code>&#13;
<code class="p">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id235">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The view transition effect works by effectively taking a screenshot of the current DOM state. Once the DOM changes inside the callback are made, another screenshot is taken. The browser creates some pseudo-elements on the page and applies an animated transition between them.</p>&#13;
&#13;
<p>The pseudo-elements created are:</p>&#13;
<dl>&#13;
<dt><code>::view-transition</code></dt>&#13;
<dd>&#13;
<p>A top-level overlay containing all view transitions</p>&#13;
</dd>&#13;
<dt><code>::view-transition-group(&lt;name&gt;)</code></dt>&#13;
<dd>&#13;
<p>An individual view transition</p>&#13;
</dd>&#13;
<dt><code>::view-transition-image-pair(&lt;name&gt;)</code></dt>&#13;
<dd>&#13;
<p>Contains the two images being transitioned</p>&#13;
</dd>&#13;
<dt><code>::view-transition-old(&lt;name&gt;)</code></dt>&#13;
<dd>&#13;
<p>Image of the old DOM state</p>&#13;
</dd>&#13;
<dt><code>::view-transition-new(&lt;name&gt;)</code></dt>&#13;
<dd>&#13;
<p>Image of the new DOM state</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Some of these pseudo-elements take a <code>name</code> argument. This can be one of the &#13;
<span class="keep-together">following:</span></p>&#13;
<dl>&#13;
<dt><code>*</code></dt>&#13;
<dd>&#13;
<p>Matches all view transition groups</p>&#13;
</dd>&#13;
<dt><code>root</code></dt>&#13;
<dd>&#13;
<p>Matches the <code>root</code> transition group, which is the default name if no custom name is given.</p>&#13;
</dd>&#13;
<dt>A custom identifier</dt>&#13;
<dd>&#13;
<p>You can specify the custom identifier by setting the <code>view-transition-name</code> property on the element to be transitioned.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>You can use CSS selectors to target these pseudo-elements and apply different &#13;
<span class="keep-together">animations.</span> You can do this by creating a <code>@keyframes</code> rule for the animation and applying that animation to the <code>::view-transition-old</code> or <code>::view-transition-new</code> &#13;
<span class="keep-together">pseudo-elements</span><a data-startref="ix_17-css-asciidoc13" data-type="indexterm" id="id1234"/><a data-startref="ix_17-css-asciidoc12" data-type="indexterm" id="id1235"/><a data-startref="ix_17-css-asciidoc11" data-type="indexterm" id="id1236"/><a data-startref="ix_17-css-asciidoc10" data-type="indexterm" id="id1237"/>.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Modifying Stylesheets at Runtime" data-type="sect1"><div class="sect1" id="id660">&#13;
<h1>Modifying Stylesheets at Runtime</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id236">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="modifying stylesheets at runtime" data-type="indexterm" id="id1238"/><a data-primary="runtime, modifying stylesheets at" data-type="indexterm" id="id1239"/><a data-primary="stylesheets" data-secondary="modifying at runtime" data-type="indexterm" id="id1240"/>You want to dynamically add a CSS rule to a stylesheet on the page.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id661">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>insertRule</code> method of <code>CSSStyleSheet</code> to add the desired rule (see <a data-type="xref" href="#example17-14">Example 17-14</a>).</p>&#13;
<div data-type="example" id="example17-14">&#13;
<h5><span class="label">Example 17-14. </span>Adding a CSS rule</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="p">[</code><code class="nx">stylesheet</code><code class="p">]</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">styleSheets</code><code class="p">;</code>&#13;
<code class="nx">stylesheet</code><code class="p">.</code><code class="nx">insertRule</code><code class="p">(</code><code class="sb">`</code>&#13;
<code class="sb">  .some-selector {</code>&#13;
<code class="sb">    background-color: red;</code>&#13;
<code class="sb">  }</code>&#13;
<code class="sb">`</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id662">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>You might want to do this if you have new HTML content that is dynamically added to the page, such as in a single-page application. You can dynamically add the style rules when the new content is added.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conditionally Setting a CSS Class" data-type="sect1"><div class="sect1" id="id663">&#13;
<h1>Conditionally Setting a CSS Class</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id320">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="conditionally setting a class" data-type="indexterm" id="id1241"/>You want to apply a CSS class to an element only if a certain condition is met.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id664">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>toggle</code> method of the element’s <code>classList</code> (see <a data-type="xref" href="#example17-15">Example 17-15</a>).</p>&#13;
<div data-type="example" id="example17-15">&#13;
<h5><span class="label">Example 17-15. </span>Toggling a class conditionally</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="c1">// Assume isExpanded is a variable with the current expanded</code>&#13;
<code class="c1">// state</code>&#13;
<code class="nx">element</code><code class="p">.</code><code class="nx">classList</code><code class="p">.</code><code class="nx">toggle</code><code class="p">(</code><code class="s1">'expanded'</code><code class="p">,</code> <code class="nx">isExpanded</code><code class="p">);</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id665">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If you call <code>toggle</code> without the second argument, it adds the class name if it’s not currently set, or removes it if it’s already set.</p>&#13;
&#13;
<p>In addition to <code>toggle</code>, you can use <code>add</code> and <code>remove</code> to manipulate the class list by adding and removing the given class name. If you call <code>add</code> when the class name is already set, it has no effect. Similarly, if you call <code>remove</code> when the class name isn’t set, it also has no effect.</p>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Matching Media Queries" data-type="sect1"><div class="sect1" id="id666">&#13;
<h1>Matching Media Queries</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id321">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="matching media queries" data-type="indexterm" id="id1242"/><a data-primary="media" data-secondary="matching/evaluating queries" data-type="indexterm" id="id1243"/>You want to check if a certain media query is satisfied using JavaScript. For example, you might want to use the <code>prefers-color-scheme</code> media query to determine if a user’s operating system is set to a dark theme.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id667">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>window.matchMedia</code> to evaluate the media query or listen for changes (see <a data-type="xref" href="#example17-16">Example 17-16</a>).</p>&#13;
<div data-type="example" id="example17-16">&#13;
<h5><span class="label">Example 17-16. </span>Checking for a dark color scheme</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">isDarkTheme</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">matchMedia</code><code class="p">(</code><code class="s1">'(prefers-color-scheme: dark)'</code><code class="p">).</code><code class="nx">matches</code><code class="p">;</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id668">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><code>window.matchMedia</code> returns a <code>MediaQueryList</code> object that not only has the <code>matches</code> property but also lets you listen for the <code>change</code> event. This event fires if the result of the media query changes.</p>&#13;
&#13;
<p>For example, if the user’s operating system color theme setting changes while your app is open, the <code>change</code> event fires for the <code>prefers-color-scheme</code> query. You can then check for the new match state (see <a data-type="xref" href="#example17-17">Example 17-17</a>).</p>&#13;
<div data-type="example" id="example17-17">&#13;
<h5><span class="label">Example 17-17. </span>Listening for media query changes</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">query</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">matchMedia</code><code class="p">(</code><code class="s1">'(prefers-color-scheme: dark)'</code><code class="p">);</code>&#13;
<code class="nx">query</code><code class="p">.</code><code class="nx">addEventListener</code><code class="p">(</code><code class="s1">'change'</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="p">{</code>&#13;
  <code class="k">if</code> <code class="p">(</code><code class="nx">query</code><code class="p">.</code><code class="nx">matches</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="c1">// switch to dark mode</code>&#13;
  <code class="p">}</code> <code class="k">else</code> <code class="p">{</code>&#13;
    <code class="c1">// switch to light mode</code>&#13;
  <code class="p">}</code>&#13;
<code class="p">});</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Getting an Element’s Computed Style" data-type="sect1"><div class="sect1" id="id669">&#13;
<h1>Getting an Element’s Computed Style</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="id237">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="CSS" data-secondary="getting an element’s computed style" data-type="indexterm" id="ix_17-css-asciidoc14"/><a data-primary="getComputedStyle" data-type="indexterm" id="ix_17-css-asciidoc15"/><a data-primary="stylesheets" data-secondary="getting an element’s computed style" data-type="indexterm" id="ix_17-css-asciidoc16"/>You want to find a particular CSS style for an element that comes from a stylesheet (not an inline style).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="id670">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>window.getComputedStyle</code> to calculate the final styles for the element.</p>&#13;
<div data-type="warning" epub:type="warning"><h1>Use getComputedStyle Sparingly</h1>&#13;
<p>When you call <code>getComputedStyle</code>, it forces the browser to recalculate styles and layout, which can be a performance bottleneck.</p>&#13;
</div>&#13;
&#13;
<p>Consider the HTML element in <a data-type="xref" href="#example17-18">Example 17-18</a> with some styling applied.</p>&#13;
<div data-type="example" id="example17-18">&#13;
<h5><span class="label">Example 17-18. </span>Some HTML with style</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">style</code><code class="p">&gt;</code>&#13;
  <code class="nf">#content</code> <code class="p">{</code>&#13;
    <code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
&#13;
  <code class="nc">.container</code> <code class="p">{</code>&#13;
    <code class="k">background-color</code><code class="o">:</code> <code class="nb">red</code><code class="p">;</code>&#13;
    <code class="k">color</code><code class="o">:</code> <code class="nb">white</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="nt">&lt;/style&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"content"</code> <code class="na">class</code><code class="o">=</code><code class="s">"container"</code><code class="p">&gt;</code>What color am I?<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>To determine the styles that are applied to the element, pass the element to <code>window.getComputedStyle</code> (see <a data-type="xref" href="#example17-19">Example 17-19</a>).</p>&#13;
<div data-type="example" id="example17-19">&#13;
<h5><span class="label">Example 17-19. </span>Getting the computed style</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">content</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#content'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">styles</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">getComputedStyle</code><code class="p">(</code><code class="nx">content</code><code class="p">);</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">styles</code><code class="p">.</code><code class="nx">backgroundColor</code><code class="p">);</code></pre></div>&#13;
&#13;
<p>Because the ID selector has a higher specificity than the class selector, it wins the conflict and <code>styles.backgroundColor</code> is blue. On some browsers, it may not be the string “blue” but rather a color expression such as <code>rgb(0, 0, 255)</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="id238">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-primary="inline styles" data-type="indexterm" id="id1244"/>An element’s <code>style</code> property only works for <em>inline styles</em>. Consider <a data-type="xref" href="#example17-20">Example 17-20</a>.</p>&#13;
<div data-type="example" id="example17-20">&#13;
<h5><span class="label">Example 17-20. </span>An element with inline styles</h5>&#13;
&#13;
<pre data-code-language="html" data-type="programlisting"><code class="p">&lt;</code><code class="nt">style</code><code class="p">&gt;</code>&#13;
  <code class="nf">#content</code> <code class="p">{</code>&#13;
    <code class="k">background-color</code><code class="o">:</code> <code class="nb">blue</code><code class="p">;</code>&#13;
  <code class="p">}</code>&#13;
<code class="nt">&lt;/style&gt;</code>&#13;
&#13;
<code class="p">&lt;</code><code class="nt">div</code> <code class="na">id</code><code class="o">=</code><code class="s">"content"</code> <code class="na">style</code><code class="o">=</code><code class="s">"color: white;"</code><code class="p">&gt;</code>Content<code class="p">&lt;/</code><code class="nt">div</code><code class="p">&gt;</code></pre></div>&#13;
&#13;
<p>This example specifies the <code>color</code> property as an inline style, so you can access this by referencing the <code>style</code> property. However, the background color comes from a stylesheet and won’t be found this way (see <a data-type="xref" href="#example17-21">Example 17-21</a>)<a data-startref="ix_17-css-asciidoc16" data-type="indexterm" id="id1245"/><a data-startref="ix_17-css-asciidoc15" data-type="indexterm" id="id1246"/><a data-startref="ix_17-css-asciidoc14" data-type="indexterm" id="id1247"/>.<a data-startref="ix_17-css-asciidoc0" data-type="indexterm" id="id1248"/></p>&#13;
<div data-type="example" id="example17-21">&#13;
<h5><span class="label">Example 17-21. </span>Checking inline styles</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">content</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#content'</code><code class="p">);</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">content</code><code class="p">.</code><code class="nx">style</code><code class="p">.</code><code class="nx">backgroundColor</code><code class="p">);</code> <code class="c1">// empty string</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">content</code><code class="p">.</code><code class="nx">style</code><code class="p">.</code><code class="nx">color</code><code class="p">);</code> <code class="c1">// 'white'</code></pre></div>&#13;
&#13;
<p>Since <code>getComputedStyle</code> calculates the final style of the element, it contains both stylesheet styles and inline styles (see <a data-type="xref" href="#example17-22">Example 17-22</a>).</p>&#13;
<div data-type="example" id="example17-22">&#13;
<h5><span class="label">Example 17-22. </span>Checking computed styles</h5>&#13;
&#13;
<pre data-code-language="javascript" data-type="programlisting"><code class="kr">const</code> <code class="nx">content</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">querySelector</code><code class="p">(</code><code class="s1">'#content'</code><code class="p">);</code>&#13;
<code class="kr">const</code> <code class="nx">styles</code> <code class="o">=</code> <code class="nb">window</code><code class="p">.</code><code class="nx">getComputedStyle</code><code class="p">(</code><code class="nx">content</code><code class="p">);</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">styles</code><code class="p">.</code><code class="nx">backgroundColor</code><code class="p">);</code> <code class="c1">// 'rgb(0, 0, 255)'</code>&#13;
<code class="nx">console</code><code class="p">.</code><code class="nx">log</code><code class="p">(</code><code class="nx">styles</code><code class="p">.</code><code class="nx">color</code><code class="p">);</code> <code class="c1">// 'rgb(255, 255, 255)'</code></pre></div>&#13;
</div></section>&#13;
</div></section>&#13;
</div></section></body></html>