<html><head></head><body><div id="sbo-rt-content"><section data-type="appendix" epub:type="appendix" data-pdf-bookmark="Appendix B. The top ten-ish topics that didn’t make it into the rest of the book..."><div class="appendix" id="appendix_b_the_top_ten-ish_topics_that_d">
<h1><span class="label">Appendix B. </span>The top ten-ish topics that didn’t make it into the rest of the book...</h1>
<figure class="informal"><div class="figure">
<img src="Images/f0683-01.png" alt="image" width="598" height="688"/>
<h6/>
</div></figure>
<p>We covered a lot of ground, and you’re almost finished with this book. We’ll miss you, but before we let you go, we wouldn’t feel right about sending you out into JavaLand without a little more preparation. We can’t possibly fit everything you’ll need to know into this relatively small appendix. Actually, we <em>did</em> originally include everything you need to know about Java (not already covered by the other chapters), by reducing the type point size to .00003. It all fit, but nobody could read it. So, we threw most of it away, but kept the best bits for this Top Ten-ish appendix. Yep, there’s more than ten Really Useful Things that you still need to know.</p>
<p>This really <em>is</em> the end of the book. Except for the index (a must-read!).</p>
<section data-type="sect1" data-pdf-bookmark="#11 JShell (Java REPL)"><div class="sect1" id="hash11_jshell_left_parenthesisjava_replr">
<h1>#11 JShell (Java REPL)</h1>
<p><strong><span style="color:#636466;">Java 9+</span></strong></p>
<section data-type="sect2" data-pdf-bookmark="Why do you care?"><div class="sect2" id="why_do_you_carequestion_mark">
<h2>Why do you care?</h2>
<p><a data-type="indexterm" data-primary="JShell" id="idm46038386543600"/><a data-type="indexterm" data-primary="Read Eval Print Loop" data-see="REPL" id="idm46038386542976"/><a data-type="indexterm" data-primary="REPL (Read Eval Print Loop)" id="idm46038386542000"/>A REPL (Read Eval Print Loop) lets you run snippets of code without needing a full application or framework. It’s a great way to try out new features, experiment with new ideas, and get immediate feedback. We’ve put this right at the start of this appendix in case you want to use JShell to try out some of the features we’ll be talking about in the following pages.</p>
<section data-type="sect3" data-pdf-bookmark="Starting the REPL"><div class="sect3" id="starting_the_repl">
<h3>Starting the REPL</h3>
<p>JShell is a command-line tool that comes part of the JDK. If JAVA_HOME/bin is on your system’s path, you can just type “jshell” from the command line (full details on getting started are in Oracle’s Introduction to JShell (<em><a href="https://oreil.ly/Ei3Df">https://oreil.ly/Ei3Df</a></em>).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0684-01.png" alt="image" width="486" height="142"/>
<h6/>
</div></figure>
<p>JShell is available only in <strong>JDK 9 and higher</strong>, but the good news is that even if you’re running code and applications on an older version of Java, you can still use JShell from a more recent version, since it’s completely independent of your “JAVA_HOME” or IDE’s version of Java. Just run it directly from the <em>bin</em> directory of whichever version of Java you want to use.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Run Java code without a class"><div class="sect3" id="run_java_code_without_a_class">
<h3>Run Java code without a class</h3>
<p>Try out some Java from the prompt:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0684-02.png" alt="image" width="711" height="175"/>
<h6/>
</div></figure>
<p>Note:</p>
<ul>
<li><p>No need for a class</p></li>
<li><p>No need for a <em>public static main</em> method</p></li>
<li><p>No need for a semicolon on the end of the line</p></li>
</ul>
<p>Just start typing Java!</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="More than just lines of code"><div class="sect3" id="more_than_just_lines_of_code">
<h3>More than just lines of code</h3>
<p>You can define variables and methods:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0684-03.png" alt="image" width="711" height="466"/>
<h6/>
</div></figure>
<p>It supports <em>forward references</em>, so you can sketch out the shape of your code without having to define everything immediately.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0684-04.png" alt="image" width="711" height="245"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Code suggestions"><div class="sect3" id="code_suggestions">
<h3>Code suggestions</h3>
<p>If you press Tab halfway through typing, you’ll get code suggestions. You can also use the up and down arrows to cycle through the lines you’ve typed so far.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0684-05.png" alt="image" width="711" height="160"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Commands"><div class="sect3" id="commands">
<h3>Commands</h3>
<p>There are lots of helpful commands that are part of JShell and not part of Java. For example, type <strong><code>/vars</code></strong> to see all the variables you’ve declared. Type <strong><code>/exit</code></strong> to, er, exit. Use <strong><code>/help</code></strong> to see a list of commands and to get more information.</p>
<p>Oracle has a very useful JShell User Guide (<em><a href="https://oreil.ly/Ei3Df">https://oreil.ly/Ei3Df</a></em>), which also shows how to create and run scripts with JShell.</p>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#10 Packages"><div class="sect1" id="hash10_packages">
<h1>#10 Packages</h1>
<section data-type="sect2" data-pdf-bookmark="Packages prevent class name conflicts"><div class="sect2" id="packages_prevent_class_name_conflicts">
<h2>Packages prevent <u>class</u> name conflicts</h2>
<p><a data-type="indexterm" data-primary="classes" data-secondary="and Java API packages" id="idm46038386510560"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="preventing class name conflicts" id="idm46038386509808"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="reverse domain package names" id="idm46038386508832"/><a data-type="indexterm" data-primary="reverse domain package names" id="idm46038386507824"/>Although packages aren’t just for preventing name collisions, that’s a key feature. If part of the point of OO is to write reusable components, developers need to be able to piece together components from a variety of sources and build something new out of them. Your components have to be able to “play well with others,” including those you didn’t write or even know about.</p>
<p>Remember way back in <a data-type="xref" href="ch06.xhtml#using_the_java_library_get_to_know_the_j">Chapter 6</a>, <em>Using the Java Library</em>, when we discussed how a package name is like the full name of a class, technically known as the <em>fully qualified name</em>. Class List is really <strong><code>java.util.List</code></strong>, a GUI List is really <strong><code>java.awt.List</code></strong>, and Socket is really <strong><code>java.net.Socket</code></strong>. Hey presto, an example of how package names can help prevent name conflicts—there’s a List that’s a data structure and a List that’s a GUI element, and we can use the package names to tell them apart.</p>
<p>Notice that these classes have <em>java</em> as their “first name.” In other words, the first part of their fully qualified names is “java”; think of a hierarchy when you think of package structures, and organize your classes accordingly.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0685-02.png" alt="image" width="365" height="307"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0685-03.png" alt="image" width="369" height="301"/>
<h6/>
</div></figure>
<p><strong>What does this picture look like to you? Doesn’t it look a whole lot like a <u>directory</u> hierarchy?</strong></p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Preventing package name conflicts"><div class="sect2" id="preventing_package_name_conflicts">
<h2>Preventing <u>package</u> name conflicts</h2>
<p>The standard package naming convention is to prepend every class with your reverse domain name. Remember, domain names are guaranteed to be unique. Two different guys can be named Bartholomew Simpson, but two different domains cannot be named <em><a href="http://doh.com">doh.com</a></em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0685-01.png" alt="image" width="582" height="292"/>
<h6/>
</div></figure>
<p>When you look at the code samples at <em><a href="https://oreil.ly/hfJava_3e_examples">https://oreil.ly/hfJava_3e_examples</a></em>, you’ll see we’ve put the classes into packages named after each chapter to clearly separate the examples.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#646466;"><strong>Packages can prevent name conflicts, but only if you choose a package name that’s guaranteed to be unique. The best way to do that is to preface your packages with your reverse domain name.</strong></span></p>
</div>
<figure class="informal"><div class="figure">
<img src="Images/f0685-04.png" alt="image" width="327" height="66"/>
<h6/>
</div></figure>
<section data-type="sect3" data-pdf-bookmark="To put your class in a package:"><div class="sect3" id="to_put_your_class_in_a_package">
<h3>To put your class in a package:</h3>
<ul style="list-style-type:none">
<li><p><a data-type="indexterm" data-primary="classes" data-secondary="and Java API packages" id="idm46038386491456"/><a data-type="indexterm" data-primary="directories" data-secondary="packages" id="idm46038386490240"/><a data-type="indexterm" data-primary="Gradle" id="idm46038386489136"/><a data-type="indexterm" data-primary="Maven, Java project structure" id="idm46038386488304"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="directory structure" id="idm46038386487504"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="organizing code" id="idm46038386486400"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="putting classes in" id="idm46038386485296"/><span class="inlineimage"><img src="Images/1.png" alt="Images" width="20" height="21"/></span> <strong>Choose a package name</strong></p>
<p>We’re using <strong><code>com.headfirstjava</code></strong> as our example. The class name is PackageExercise, so the fully qualified name of the class is now <strong><code>com.headfirstjava.PackageExercise</code></strong>.</p></li>
<li><p><span class="inlineimage"><img src="Images/2.png" alt="Images" width="20" height="21"/></span> <strong>Put a package statement in your class</strong></p>
<p>It must be the first statement in the source code file, above any import statements. There can be only one package statement per source code file, so <strong><code>all classes in a source file must be in the same package</code></strong>. That includes inner classes, of course.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="pre">
<pre data-type="programlisting"><strong><span style="background-color:#E0E1E2;">package com.headfirstjava;</span></strong>

<strong>import javax.swing.*;</strong>

<strong>public class PackageExercise {</strong>
  <strong>// life-altering code here</strong>
<strong>}</strong></pre>
</div></aside>
</li>
<li><p><span class="inlineimage"><img src="Images/3.png" alt="Images" width="20" height="21"/></span> <strong>Set up a matching directory structure</strong></p>
<p>It’s not enough to <strong><em>say</em></strong> your class is in a package by merely putting a package statement in the code. Your class isn’t <em>truly</em> in a package until you put the class in a matching directory structure. So, if the fully qualified class name is com.headfirstjava.PackageExercise, you <em>must</em> put the PackageExercise source code in a directory named <strong><code>headfirstjava</code></strong>, which <strong><em>must</em></strong> be in a directory named <strong><code>com</code></strong>.</p></li>
</ul>
<figure class="informal"><div class="figure">
<img src="Images/f0686-01.png" alt="image" width="410" height="733"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="A note on directories"><div class="sect3" id="a_note_on_directories">
<h3>A note on directories</h3>
<p>In the Real World, source files and class files are usually kept in separate directories—you don’t want to copy the source code to wherever it’s running (a customer’s computer or the cloud), only the class files.</p>
<p>The most common structure for Java projects is based off Maven’s* convention:</p>
<p><code><strong>MyProject/src/main/java</strong></code> Application sources</p>
<p><code><strong>MyProject/src/test/java</strong></code> Test sources</p>
<p>The class files are placed elsewhere. Real enterprise systems usually use a build tool like Maven or Gradle to compile and build the application (our sample code uses Gradle). Each build tool puts the classes into different folders:</p>
<table class="border">
<thead>
<tr>
<th/>
<th>Maven</th>
<th>Gradle</th>
</tr>
</thead>
<tbody>
<tr>
<td>Application classes</td>
<td>MyProject/target/classes</td>
<td>MyProject/out/production/classes</td>
</tr>
<tr>
<td>Test classes</td>
<td>MyProject/target/test-classes</td>
<td>MyProject/out/test/classes</td>
</tr>
</tbody>
</table>
<p>*Maven and Gradle are the most common build tools for Java projects.</p>
</div></section>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Compiling and running with packages"><div class="sect2" id="compiling_and_running_with_packages">
<h2>Compiling and running with packages</h2>
<p><a data-type="indexterm" data-primary="compiler" id="idm46038386454496"/><a data-type="indexterm" data-primary="-d (directory) flag" id="idm46038386453984"/><a data-type="indexterm" data-primary="packages, Java API" data-secondary="compiling and running" id="idm46038386453248"/>We don’t need to use a build tool to separate our classes and source files. By using the <code><strong>-d</strong></code> flag, <em>you</em> get to decide which <strong><code>directory</code></strong> the compiled code lands in, rather than accepting the default of class files landing in the same directory as the source code.</p>
<p>Compiling with the <code><strong>-d</strong></code> flag not only lets you send your compiled class files into a directory other than the one where the source file is, but it also knows to put the class into the correct directory structure for the package the class is in. Not only that, compiling with -d tells the compiler to <em>build</em> the directories if they don’t exist.</p>
<blockquote><p><strong>The <code>-d</code> flag tells the compiler, “Put the class into its package directory structure, using the class specified after the <code>-d</code> as the root directory. But...if the directories aren’t there, create them first and <em>then</em> put the class in the right place!”</strong></p></blockquote>
<section data-type="sect3" data-pdf-bookmark="Compiling with the -d (directory) flag"><div class="sect3" id="compiling_with_the_-d_left_parenthesisdi">
<h3>Compiling with the <code>-d</code> (directory) flag</h3>
<figure class="informal"><div class="figure">
<img src="Images/f0687-01.png" alt="image" width="725" height="267"/>
<h6/>
</div></figure>
<p>To compile all the .java files in the com.headfirstjava package, use:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0687-03.png" alt="image" width="555" height="103"/>
<h6/>
</div></figure>
<figure class="informal"><div class="figure">
<img src="Images/f0687-02.png" alt="image" width="386" height="564"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Running your code"><div class="sect3" id="running_your_code">
<h3>Running your code</h3>
<figure class="informal"><div class="figure">
<img src="Images/f0687-04.png" alt="image" width="518" height="284"/>
<h6/>
</div></figure>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#9 Immutability in Strings and Wrappers"><div class="sect1" id="hash9_immutability_in_strings_and_wrappe">
<h1>#9 Immutability in Strings and Wrappers</h1>
<p><a data-type="indexterm" data-primary="immutability" id="idm46038386434464"/><a data-type="indexterm" data-primary="memory" data-secondary="String immutability" id="idm46038386433456"/><a data-type="indexterm" data-primary="StringBuilder" id="idm46038386432352"/><a data-type="indexterm" data-primary="Strings" data-secondary="immutability" id="idm46038386431520"/><a data-type="indexterm" data-primary="Strings" data-secondary="reusing" id="idm46038386430416"/><a data-type="indexterm" data-primary="wrappers" id="idm46038386429312"/><a data-type="indexterm" data-primary="wrappers" data-secondary="immutability" id="idm46038386428480"/>We talked about immutability in <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a>, and we’ll mention immutability in the last item of this appendix. This section is specifically about immutability in two important Java types: Strings and Wrappers.</p>
<section data-type="sect2" data-pdf-bookmark="Why do you care that Strings are immutable?"><div class="sect2" id="why_do_you_care_that_strings_are_immutab">
<h2>Why do you care that <u>Strings</u> are immutable?</h2>
<p>For security purposes and for the sake of conserving memory (whether you’re running on phones, IoT devices, or the cloud, memory matters), Strings in Java are immutable. What this means is that when you say:</p>
<pre data-type="programlisting"><strong>String s = "0";</strong>
<strong>for (int i = 1; i &lt; 10; i++) {</strong>
   <strong>s = s + i;</strong>
<strong>}</strong></pre>
<p>what’s actually happening is that you’re creating ten String objects (with values “0,” “01,” “012,” through “0123456789”). In the end, <em>s</em> is referring to the String with the value “0123456789,” but at this point there are <em>ten different</em> Strings in existence!</p>
<p>Similarly, if you use methods on String to “change” a String object, it doesn’t change that object at all; it creates a new one:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0688-01.png" alt="image" width="478" height="125"/>
<h6/>
</div></figure>
<section data-type="sect3" data-pdf-bookmark="How does this save memory?"><div class="sect3" id="how_does_this_save_memoryquestion_mark">
<h3>How does this save memory?</h3>
<p>Whenever you make a new String, the JVM puts it into a special part of memory called the “String Pool” (sounds refreshing, doesn’t it?). If there is already a String in the pool with the same value, the JVM <em>doesn’t create a duplicate</em>; it refers your reference variable to the <em>existing</em> entry. So you won’t have 500 objects of the word “customer” (for example), but 500 references to the single “customer” String object.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0688-02.png" alt="image" width="385" height="129"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Immutability makes reuse possible"><div class="sect3" id="immutability_makes_reuse_possible">
<h3>Immutability makes reuse possible</h3>
<p>The JVM can get away with this because Strings are <strong><code>immutable</code></strong>; one reference variable can’t change a String’s value out from under another reference variable referring to the same String.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="What happens to unused Strings?"><div class="sect3" id="what_happens_to_unused_stringsquestion_m">
<h3>What happens to unused Strings?</h3>
<p>Our first example created a lot of intermediate Strings that weren’t used (“01,” “012,” etc). These were placed in the String Pool, which is on the heap and therefore eligible for Garbage Collection (see <a data-type="xref" href="ch09.xhtml#life_and_death_of_an_object_constructors">Chapter 9</a>). Strings that aren’t used will eventually be garbage-collected.</p>
<p>However, if you have to do a lot of String manipulations (like concatenations, etc.), you can avoid the creation of unnecessary strings by using a <em>StringBuilder</em>:</p>
<pre data-type="programlisting"><strong>StringBuilder s = new StringBuilder("0");</strong>
<strong>for (int i = 1; i &lt; 10; i++) {</strong>
  <strong>s.append(i);</strong>
<strong>}</strong>
<strong>String finalString = s.toString();</strong></pre>
<p>This way, the single <em>mutable</em> StringBuilder is updated every time to represent the intermediate states, instead of ten <em>immutable</em> String instances being created and the nine intermediate Strings being thrown away.</p>
</div></section>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Why do you care that Wrappers are immutable?"><div class="sect2" id="why_do_you_care_that_wrappers_are_immuta">
<h2>Why do you care that <u>Wrappers</u> are immutable?</h2>
<p>In <a data-type="xref" href="ch10.xhtml#numbers_matter_numbers_and_statics">Chapter 10</a>, we talked about the two main uses of the wrapper classes:</p>
<ul>
<li><p>Wrapping a primitive so it can act like an object.</p></li>
<li><p>Using the static utility methods (e.g., Integer.parseInt()).</p></li>
</ul>
<p>It’s important to remember that when you create a wrapper object like:</p>
<pre data-type="programlisting"><strong>Integer iWrap = new Integer(42);</strong></pre>
<p>that’s it for that wrapper object. Its value will <em>always</em> be 42. <strong><em>There is no setter method for a wrapper object.</em></strong> You can, of course, refer <em>iWrap</em> to a <em>different</em> wrapper object, but then you’ll have <em>two</em> objects. Once you create a wrapper object, there’s no way to change the <em>value</em> of that object!</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#8 Access levels and access modifiers (who sees what)"><div class="sect1" id="hash8_access_levels_and_access_modifiers">
<h1>#8 Access levels and access modifiers (who sees what)</h1>
<p><a data-type="indexterm" data-primary="access control" id="idm46038386388192"/><a data-type="indexterm" data-primary="access control" data-secondary="levels" id="idm46038386387440"/><a data-type="indexterm" data-primary="access control" data-secondary="modifiers" id="idm46038386386336"/><a data-type="indexterm" data-primary="access levels" id="idm46038386385232"/><a data-type="indexterm" data-primary="access modifiers" id="idm46038386384400"/><a data-type="indexterm" data-primary="default access level" id="idm46038386383568"/><a data-type="indexterm" data-primary="private access modifier" id="idm46038386382736"/><a data-type="indexterm" data-primary="protected access level" id="idm46038386381904"/><a data-type="indexterm" data-primary="protected access modifier" id="idm46038386381072"/><a data-type="indexterm" data-primary="public access modifier" id="idm46038386380272"/>Java has four access levels and three access modifiers. There are only three modifiers because the default (what you get when you don’t use any access modifier) is one of the four access levels.</p>
<p><strong>Access levels</strong> (in order of how restrictive they are, from least to most restrictive)</p>
<figure class="informal"><div class="figure">
<img src="Images/f0689-01.png" alt="image" width="877" height="283"/>
<h6/>
</div></figure>
<p><strong>Access modifiers</strong></p>
<pre data-type="programlisting">public
protected
private</pre>
<p>Most of the time you’ll use only public and private access levels.</p>
<p><strong>public</strong></p>
<p>Use public for classes, constants (static final variables), and methods that you’re exposing to other code (for example getters and setters) and most constructors.</p>
<p><strong>private</strong></p>
<p>Use private for virtually all instance variables, and for methods that you don’t want outside code to call (in other words, methods used by the public methods of your class).</p>
<p>Although you might not use the other two (protected and default) much, you still need to know what they do because you’ll see them in other code.</p>
<p><strong>default and protected</strong></p>
<p><strong>default</strong></p>
<p><a data-type="indexterm" data-primary="default access level" id="idm46038386370768"/><a data-type="indexterm" data-primary="protected access level" id="idm46038386370144"/>Both protected and default access levels are tied to packages. Default access is simple—it means that only code <em>within the same package</em> can access code with default access. So a default class, for example (which means a class that isn’t explicitly declared as <em>public</em>) can be accessed by only classes within the same package as the default class.</p>
<p>But what does it really mean to <em>access</em> a class? Code that does not have access to a class is not allowed to even <em>think</em> about the class. And by think, we mean <em>use</em> the class in code. For example, if you don’t have access to a class, because of access restriction, you aren’t allowed to instantiate the class or even declare it as a type for a variable, argument, or return value. You simply can’t type it into your code at all! If you do, the compiler will complain.</p>
<p>Think about the implications—a default class with public methods means the public methods aren’t really public at all. You can’t access a method if you can’t <em>see</em> the class.</p>
<p>Why would anyone want to restrict access to code within the same package? Typically, packages are designed as a group of classes that work together as a related set. So it might make sense that classes within the same package need to access one another’s code, while as a package, only a small number of classes and methods are exposed to the outside world (i.e., code outside that package).</p>
<p>OK, that’s default. It’s simple—if something has default access (which, remember, means no explicit access modifier!), only code within the same package as the default <em>thing</em> (class, variable, method, inner class) can access that <em>thing</em>.</p>
<p>Then what’s <em>protected</em> for?</p>
<p><strong>protected</strong></p>
<p>Protected access is almost identical to default access, with one exception: it allows subclasses to <em>inherit</em> the protected thing, <em>even if those subclasses are outside the package of the superclass they extend</em>. That’s it. That’s <em>all</em> protected buys you—the ability to let your subclasses be outside your superclass package, yet still <em>inherit</em> pieces of the class, including methods and constructors.</p>
<p>Many developers find very little reason to use protected, but it is used in some designs, and some day you might find it to be exactly what you need. One of the interesting things about protected is that—unlike the other access levels—protected access applies only to <em>inheritance</em>. If a subclass-outside-the-package has a <em>reference</em> to an instance of the superclass (the superclass that has, say, a protected method), the subclass can’t access the protected method using that superclass reference! The only way the subclass can access that method is by <em>inheriting</em> it. In other words, the subclass-outside-the-package doesn’t have <em>access</em> to the protected method; it just <em>has</em> the method, through inheritance.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#646466;">Experienced developers writing libraries for other developers to use will find both default and protected access levels very helpful.</span></p>
<p><span style="color:#646466;">These access levels can separate the internals of a library from the API that other developers will call from their code.</span></p>
</div>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#7 Varargs"><div class="sect1" id="hash7_varargs">
<h1>#7 Varargs</h1>
<p><a data-type="indexterm" data-primary="methods" data-secondary="varargs" id="idm46038386446912"/><a data-type="indexterm" data-primary="varargs (variable argument lists)" id="idm46038386345856"/>We saw varargs briefly in <a data-type="xref" href="ch10.xhtml#numbers_matter_numbers_and_statics">Chapter 10</a>, <em>Numbers Matter,</em> when we looked at the String.format() method. You also saw them in <a data-type="xref" href="ch11.xhtml#data_structures_collections_and_generics">Chapter 11</a>, <em>Data Structures</em>, when we looked at <em>convenience factory methods for Collections</em>. Varargs let a method take as many arguments as they want, as long as they’re of the same type.</p>
<section data-type="sect2" data-pdf-bookmark="Why do you care?"><div class="sect2" id="why_do_you_carequestion_mark-id0001">
<h2>Why do you care?</h2>
<p>Chances are, you won’t write many (or any!) methods with a vararg parameter. But you will likely use them, passing in varargs, since the Java libraries do provide helpful methods, like the ones we just mentioned, that can take as many arguments as they like.</p>
<section data-type="sect3" data-pdf-bookmark="How can I tell if a method takes varargs?"><div class="sect3" id="how_can_i_tell_if_a_method_takes_varargs">
<h3>How can I tell if a method takes varargs?</h3>
<p>Let’s look at the API documentation for String.format():</p>
<pre data-type="programlisting"><strong>static String format(String format, Object... args)</strong></pre>
<p>The triple dot (...) says this is method takes an arbitrary number of Objects after the String argument, <strong><code>including zero</code></strong>. For example:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0691-01.png" alt="image" width="947" height="127"/>
<h6/>
</div></figure>
<p>Methods that take varargs generally don’t care how many arguments there are; it doesn’t matter much. Consider List.of(), for example. It doesn’t care how many items you want in the List; it will just use add all the arguments into the new list.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Creating a method that takes varargs"><div class="sect3" id="creating_a_method_that_takes_varargs">
<h3>Creating a method that takes varargs</h3>
<p>You will generally be calling a method that takes varargs, not creating it, but let’s take a look anyway. If you wanted to define your own method that, for example, printed out everything passed into it, you could do it like this:</p>
<pre data-type="programlisting"><strong>void printAllObjects(Object... elements) {</strong>
  <strong>for (Object element : elements) {</strong>
    <strong>System.out.println(element);</strong>
  <strong>}</strong>
<strong>}</strong></pre>
<p>The parameter <em>elements</em> is nothing magic; it’s actually just an array of Objects. So you can iterate over it the same way as if you’d created the method signature as:</p>
<pre data-type="programlisting"><strong>void printAllObjects(Object[] elements) {</strong></pre>
<p>It’s the calling code that looks different. Instead of having to create an array of objects to pass in, you get the convenience of passing in an arbitrary number of parameters.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Rules"><div class="sect3" id="rules">
<h3>Rules</h3>
<ul>
<li><p>A method can have only one varargs parameter.</p></li>
<li><p>The varargs parameter must be the last parameter.</p></li>
</ul>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#6 Annotations"><div class="sect1" id="hash6_annotations">
<h1>#6 Annotations</h1>
<section data-type="sect2" data-pdf-bookmark="Why do you care?"><div class="sect2" id="why_do_you_carequestion_mark-id0002">
<h2>Why do you care?</h2>
<p><a data-type="indexterm" data-primary="annotations" id="idm46038386334064"/><a data-type="indexterm" data-primary="compiler-safe documentation, annotations as" id="idm46038386333200"/><a data-type="indexterm" data-primary="testing code, annotations in" id="idm46038386332400"/>We very briefly mentioned annotations back in <a data-type="xref" href="ch12.xhtml#lambdas_and_streams_whatcomma_not_how_la">Chapter 12</a>, <em>Lambdas and Streams: What, Not How</em>, when we said that interfaces that can be implemented as a lambda expression may be marked with a “@FunctionalInterface” annotation.</p>
<p>Adding an annotation to your code can add extra behavior, or an annotation can be a kind of compiler-friendly documentation; i.e., you’re simply tagging the code with some additional information that could optionally be used by the compiler.</p>
<p>You will definitely see annotations used in the Real World, and very likely use them.</p>
<section data-type="sect3" data-pdf-bookmark="Where will you see annotations?"><div class="sect3" id="where_will_you_see_annotationsquestion_m">
<h3>Where will you see annotations?</h3>
<p>You will see annotations in code that uses libraries and frameworks like Java EE/Jakarta EE, Spring/Spring Boot, Hibernate and Jackson, all of which are very commonly used in the Java world for building large and small applications.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0692-01.png" alt="image" width="442" height="66"/>
<h6/>
</div></figure>
<p>Where you will definitely see annotations is in test code. Back in <a data-type="xref" href="ch05.xhtml#extra-strength_methods_writing_a_program">Chapter 5</a>, <em>Extra-Strength Methods</em>, we introduced the idea of testing your code, but what we haven’t shown is the frameworks that make it much easier. The most common one is JUnit. If you look at the code samples at <em><a href="https://oreil.ly/hfJava_3e_examples">https://oreil.ly/hfJava_3e_examples</a></em>, you’ll see there are some example test classes in the “test” folder.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0692-01a.png" alt="image" width="466" height="74"/>
<h6/>
</div></figure>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#646466;">Annotations can be applied to classes and methods, to variables (local and instance) and parameters, and even some other places in the code.</span></p>
</div>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Annotations can have elements"><div class="sect3" id="annotations_can_have_elements">
<h3>Annotations can have elements</h3>
<p>Some annotations include elements, which are like parameters with names.</p>
<pre data-type="programlisting"><strong>@Table(name="cust")</strong>
<strong>public class Customer {</strong></pre>
<p>If the annotation has only one element, you don’t need to give the name.</p>
<pre data-type="programlisting"><strong>@Disabled("This test isn't finished")</strong>
<strong>void thisTestIsForIgnoring() {</strong></pre>
<p>As you saw in the earlier examples, you don’t need to add parentheses to an annotation that doesn’t have elements.</p>
<p>You can add more than one annotation to the class, method, or variable that you’re annotating.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="What do they do?"><div class="sect3" id="what_do_they_doquestion_mark">
<h3>What do they do?</h3>
<p>Well, it depends! Some can be used as a sort of compiler-safe documentation. If you add @FunctionalInterface to an interface with more than one abstract method, you’ll get a compiler error.</p>
<p>Other annotations (like @NotNull) can be used by your IDE or by analysis tools to see if your code is correct.</p>
<p>Many libraries provide annotations for you to use to tag parts of your code so the framework knows what to do with your code. For example, the @Test annotation tags methods that need to be run as individual tests by JUnit; @SpringBootApplication tags the class with the <em>main</em> method that’s the entry point of a Spring Boot application; @Entity tags a Java class as a data object that needs to be saved to a database by Hibernate.</p>
<p>Some annotations provide behavior on top of your code. For example, Lombok can use annotations to generate common code: add @Data to the top of your class, and Lombok will generate constructors, getters and (if needed) setters, and hashCode, toString, and equals methods.</p>
<aside data-type="sidebar" epub:type="sidebar" style="background-color: #231F20; color: #FFFFFF;"><div class="sidebar" id="id0003a">
<p><strong>Sometimes annotations seem to work like magic! The code that does the hard work is hidden away. If you use annotations that are well documented, you’ll have a better understanding of what they do and how they work. This will help you fix any issues you may run into.</strong></p>
</div></aside>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#5 Lambdas and Maps"><div class="sect1" id="hash5_lambdas_and_maps">
<h1>#5 Lambdas and Maps</h1>
<p><strong><span style="color:#636466;">Java 8+</span></strong></p>
<section data-type="sect2" data-pdf-bookmark="Why do you care?"><div class="sect2" id="why_do_you_carequestion_mark-id0003">
<h2>Why do you care?</h2>
<p><a data-type="indexterm" data-primary="computeIfAbsent" id="idm46038386313088"/><a data-type="indexterm" data-primary="lambda expressions" data-secondary="map operation" id="idm46038386312352"/><a data-type="indexterm" data-primary="Map interface" data-secondary="lambda expressions" id="idm46038386311344"/>Java 8 famously added lambdas and streams to Java, but what is less well-known is that java.util.Map also got a few new methods that take lambda expressions as arguments. These methods make it much easier to do common operations on Maps, which will save you time and brainpower.</p>
<section data-type="sect3" data-pdf-bookmark="Create a new value if there isn’t one for the key"><div class="sect3" id="create_a_new_value_if_there_isnapostroph">
<h3>Create a new value if there isn’t one for the key</h3>
<p>Imagine you want to track what a customer does on your website, and you do this using an Actions object. You might have a Map of String username to Actions. When a customer performs some action that you want to add to their Actions object, you want to either:</p>
<ul>
<li><p>Create a new Actions object for this customer and add it to the Map</p></li>
<li><p>Get the existing Actions object for this customer</p></li>
</ul>
<p>It’s very common to use an <em>if</em> statement and a <em>null</em> check to do this (pre-Java 8):</p>
<figure class="informal"><div class="figure">
<img src="Images/f0693-01.png" alt="image" width="691" height="211"/>
<h6/>
</div></figure>
<p>It’s not a lot of code, but it is a pattern that is used again and again. If you’re using Java 8 or higher, you don’t need to do this at all. Use <strong>computeIfAbsent</strong>, and give it a lambda expression that says how to “compute” the value that should go into the Map if there isn’t an entry for the given key:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0693-02.png" alt="image" width="720" height="282"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Update the value only if it already exists"><div class="sect3" id="update_the_value_only_if_it_already_exis">
<h3>Update the value only if it already exists</h3>
<p><a data-type="indexterm" data-primary="computeIfPresent" id="idm46038386297456"/><a data-type="indexterm" data-primary="forEach()" id="idm46038386296304"/><a data-type="indexterm" data-primary="replaceAll" id="idm46038386295472"/>There may be other scenarios when you want to update a value in the Map only if it exists. For example, you might have a Map of things that you are counting, like metrics, and you want to update only the metrics that you care about. You don’t want to add any arbitrary new metric to the Map. Before Java 8, you might use a combination of <em>contains</em>, <em>get</em>, and <em>put</em> to check if the map has a value for this metric and update it if so.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0694-01.png" alt="image" width="828" height="189"/>
<h6/>
</div></figure>
<p>Java 8 added <strong>computeIfPresent</strong>, which takes the key you’re looking for and a lambda expression, which you can use to describe how to calculate the updated value for the Map. Using this, the code above can be simplified to:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0694-02.png" alt="image" width="806" height="132"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Other methods"><div class="sect3" id="other_methods">
<h3>Other methods</h3>
<p>There are other, more advanced methods on Map that can be useful when you want to “add a new value OR do something with the existing value” (or even remove a value), like <em>merge</em> and <em>compute</em>. There’s also <em>replaceAll</em>, which you can give a lambda expression that calculates a new value for all the values in the map (we could use this, for example, to increment ALL the metrics in our previous example, if we needed to). And, like all the collections, it has a <em>forEach</em> that lets us iterate over all the key/value pairs in the Map.</p>
<p>The Java libraries continuously evolve, so even if you think you understand something you’ve used a lot, like List or Map, it’s always worth keeping an eye out for changes that may make your life easier.</p>
<p>Remember, the Java API documentation (<em><a href="https://oreil.ly/ln5xn">https://oreil.ly/ln5xn</a></em>) is a great place to start if you want to see what methods are available on a class, and what they do.</p>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#4 Parallel Streams"><div class="sect1" id="hash4_parallel_streams_java_8plus">
<h1>#4 Parallel Streams</h1>
<p><strong><span style="color:#636466;">Java 8+</span></strong></p>
<p><a data-type="indexterm" data-primary="Fork-Join framework" id="idm46038386277808"/><a data-type="indexterm" data-primary="multithreading" data-seealso="concurrency" id="idm46038386277296"/><a data-type="indexterm" data-primary="multithreading" data-secondary="parallel streams" id="idm46038386276656"/><a data-type="indexterm" data-primary="parallelStream" id="idm46038386275680"/><a data-type="indexterm" data-primary="parallel streams" id="idm46038386274912"/><a data-type="indexterm" data-primary="streams (Streams API)" data-secondary="parallel streams" id="idm46038386274080"/>Back in <a data-type="xref" href="ch12.xhtml#lambdas_and_streams_whatcomma_not_how_la">Chapter 12</a>, <em>Lambdas and Streams: What, Not How</em>, we took a long look at the Streams API. We did not look at one of the really interesting features of streams, which is that you can use them to take advantage of modern multicore, multi-CPU hardware and run your stream operations in parallel. Let’s look at that now.</p>
<p>So far, we’ve used the Streams API to effectively “query” our data structures. Now, imagine those data structures can get big. We mean REALLY big. Like all the data from a database, or like a real-time stream of data from a social media API. We <em>could</em> plod over each of these items one by one, in <strong><code>serial</code></strong>, until we get the results we want. Or, we could split the work up into multiple operations and run them at the same time, in <strong><code>parallel</code></strong>, on different CPUs. After <a data-type="xref" href="ch17.xhtml#make_a_connection_networking_and_threads">Chapter 17</a> and <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a> you might be tempted to run off and write a multithreaded application to do that, but <em>you don’t have to</em>!</p>
<section data-type="sect2" data-pdf-bookmark="Going parallel"><div class="sect2" id="going_parallel">
<h2>Going parallel</h2>
<p>You can simply tell the Streams API you want your stream pipeline to be run on multiple CPU cores. There are two ways to do this.</p>
<ol>
<li><p><strong>Start a parallelStream</strong></p>
<figure class="informal"><div class="figure">
<img src="Images/f0695-01.png" alt="image" width="467" height="93"/>
<h6/>
</div></figure></li>
<li><p><strong>Add parallel() to the stream pipeline</strong></p>
<pre data-type="programlisting">List&lt;Song&gt; songs = getSongs();
Stream&lt;Song&gt; par = songs.stream()
                        .<strong>parallel()</strong>;</pre></li>
</ol>
<p>They both do the same thing, and you can choose whichever approach you prefer.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="OK now what?"><div class="sect2" id="ok_now_whatquestion_mark">
<h2>OK now what?</h2>
<p>Now, you just write a stream pipeline just like we did in <a data-type="xref" href="ch12.xhtml#lambdas_and_streams_whatcomma_not_how_la">Chapter 12</a>, adding the operations you want and finishing off with a terminator. The Java libraries will take care of figuring out:</p>
<ul>
<li><p>How to split the data to run the stream pipeline on multiple CPU cores</p></li>
<li><p>How many parallel operations to run</p></li>
<li><p>How to merge the results of the multiple operations</p></li>
</ul>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Multithreading is taken care of"><div class="sect2" id="multithreading_is_taken_care_of">
<h2>Multithreading is taken care of</h2>
<p>Under the covers, parallel streams use the <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/forkjoin.html">Fork-Join framework</a> (which we did not cover in this book; see <em><a href="https://oreil.ly/XJ6eH">https://oreil.ly/XJ6eH</a></em>), yet another type of thread pool (which we did talk about in <a data-type="xref" href="ch17.xhtml#make_a_connection_networking_and_threads">Chapter 17</a>, <em>Make a Connection</em>). With parallel streams, you’ll find the number of threads is equal to the number of cores available wherever your application is running. There are ways to change this setup, but it’s recommended to stick with the defaults unless you <em>really</em> know what you’re doing.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Do not use parallel everywhere!"><div class="sect2" id="do_not_use_parallel_everywhereexclamatio">
<h2>Do not use parallel everywhere!</h2>
<p>Before you going running off and making all your stream calls parallel, <strong>wait</strong>! Remember we said back in <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a>, <em>Dealing with Concurrency Issues</em>, that multithreaded programming was hard, because the solutions you choose depend a lot on your application, your data, and your environment? The same applies to using parallel streams. Going parallel and making use of multiple CPU cores is <strong><em>not</em></strong> free and does <strong><em>not</em></strong> automatically mean your application will run faster.</p>
<p>There is a cost to running a stream pipeline in parallel. The data needs to be split up, the operations need to be run on each bit of data on separate threads, and then at the end the results of each separate parallel operation need to be combined in some way to give a final result. All of that adds time.</p>
<p>If the data going into your stream pipeline is a simple collection, like the examples we looked at in <a data-type="xref" href="ch12.xhtml#lambdas_and_streams_whatcomma_not_how_la">Chapter 12</a> (indeed, in <em>most</em> places streams are used today), using serial streams is almost definitely going to be faster. Yes, you read that correctly: for most ordinary use cases, you do <strong><em>not</em></strong> want to go parallel.</p>
<p>Parallel streams can improve performance when:</p>
<ul>
<li><p>The input collection is BIG (think hundreds of thousands of elements at least)</p></li>
<li><p>The stream pipeline is performing complicated, long-running operations</p></li>
<li><p>The decomposition (splitting) of the data/operations and merging of the results are not too costly.</p></li>
</ul>
<p>You should measure the performance with and without parallel before using it. If you want to learn more, Richard Warburton’s <em>Java 8 Lambdas</em> book has an excellent section on data parallelism.</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#3 Enumerations (also called enumerated types or enums)"><div class="sect1" id="hash3_enumerations_left_parenthesisalso">
<h1>#3 Enumerations (also called enumerated types or enums)</h1>
<p><a data-type="indexterm" data-primary="constants" id="idm46038386231680"/><a data-type="indexterm" data-primary="enumerations" id="idm46038386231008"/><a data-type="indexterm" data-primary="static final variables" id="idm46038386230400"/>We’ve talked about constants that are defined in the API, for instance, <code><strong>JFrame.EXIT_ON_CLOSE</strong></code>. You can also create your own constants by marking a variable <code><strong>static final</strong></code>. But sometimes you’ll want to create a set of constant values to represent the <strong><em>only</em></strong> valid values for a variable. This set of valid values is commonly referred to as an enumeration. Full-fledged enumerations were introduce way back in Java 5.</p>
<section data-type="sect2" data-pdf-bookmark="Who’s in the band?"><div class="sect2" id="whoapostrophes_in_the_bandquestion_mark">
<h2>Who’s in the band?</h2>
<p>Let’s say that you’re creating a website for your favorite band, and you want to make sure that all of the comments are directed to a particular band member.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="The old way to fake an “enum”:"><div class="sect2" id="the_old_way_to_fake_an_quotation_markenu">
<h2>The old way to fake an “enum”:</h2>
<figure class="informal"><div class="figure">
<img src="Images/f0696-01.png" alt="image" width="789" height="217"/>
<h6/>
</div></figure>
<p>The good news about this technique is that it DOES make the code easier to read. The other good news is that you can’t ever change the value of the fake enums you’ve created; <code>KEVIN</code> will always be <code>1</code>. The bad news is that there’s no easy or good way to make sure that the value of <code>selectedBandMember</code> will always be <code>1, 2</code>, or <code>3</code>. If some hard-to-find piece of code sets <code>selectedBandMember</code> equal to <code>812</code>, it’s pretty likely your code will break.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><span style="color:#646466;">This IS the <u>OLD</u> way to fake an enum, but you will still see code like this in Real Life (e.g., the older Java libraries like AWT).</span></p>
<p><span style="color:#646466;">However, if you have any control over the code, try to use enums instead of constants like this. See the next page...</span></p>
</div>
<p><a data-type="indexterm" data-primary="equals()" id="idm46038386214528"/><a data-type="indexterm" data-primary="if statement" id="idm46038386215280"/><a data-type="indexterm" data-primary="switch statement" id="idm46038386216816"/>Let’s see what the band members would look like with a “real” enum. While this is a very basic enumeration, most enumerations usually are this simple.</p>
<section data-type="sect3" data-pdf-bookmark="An official “enum”"><div class="sect3" id="an_official_quotation_markenumquotation">
<h3>An official “enum”</h3>
<figure class="informal"><div class="figure">
<img src="Images/f0697-01.png" alt="image" width="951" height="391"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Your enum extends java.lang.Enum"><div class="sect3" id="your_enum_extends_javadotlangdotenum">
<h3>Your enum extends java.lang.Enum</h3>
<p>When you create an enum, you’re creating a new class, and <strong><em>you’re implicitly extending</em></strong> <code><strong><em>java.lang.Enum</em></strong></code>. You can declare an enum as its own standalone class, in its own source file, or as a member of another class.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Using “if” and “switch” with enums"><div class="sect3" id="using_quotation_markifquotation_mark_and">
<h3>Using “if” and “switch” with enums</h3>
<p>Using the enum we just created, we can perform branches in our code using either the <code>if</code> or <code>switch</code> statement. Also notice that we can compare enum instances using either <code>==</code> or the <code>.equals()</code> method. Usually <code>==</code> is considered better style.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0697-02.png" alt="image" width="889" height="347"/>
<h6/>
</div></figure>
<p>You can add a bunch of things to your enum like a constructor, methods, variables, and something called a constant-specific class body. They’re not common, but you might run into them.</p>
<p><span style="color:#636466;">Answer:</span></p>
<p><span style="color:#636466;">King Bob</span></p>
<p><span style="color:#636466;">Banana!</span></p>
</div></section>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#2 Local Variable Type Inference (var)"><div class="sect1" id="hash2_local_variable_type_inference_left">
<h1>#2 Local Variable Type Inference (var)</h1>
<p><strong><span style="color:#636466;">Java 10+</span></strong></p>
<p><a data-type="indexterm" data-primary="&lt;&gt; (diamond operator)" id="idm46038386194208"/><a data-type="indexterm" data-primary="diamond operator (&lt;&gt;)" id="idm46038386193312"/><a data-type="indexterm" data-primary="local variables" data-secondary="type inference" id="idm46038386192480"/><a data-type="indexterm" data-primary="methods" data-secondary="descriptive naming best practice" id="idm46038386191376"/><a data-type="indexterm" data-primary="type inference" id="idm46038386190304"/><a data-type="indexterm" data-primary="variables" data-secondary="concrete type with var" id="idm46038386189472"/><a data-type="indexterm" data-primary="variables" data-secondary="descriptive naming best practice" id="idm46038386188368"/><a data-type="indexterm" data-primary="variables" data-secondary="var for local" id="idm46038386187296"/>If you’re using Java 10 or higher, you can use <strong><code>var</code></strong> when you’re declaring your <em>local</em> variables (i.e., variables inside methods, <strong>not</strong> method parameters or instance variables).</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-01.png" alt="image" width="388" height="38"/>
<h6/>
</div></figure>
<p>This is another example of <em>type inference</em>, where the compiler can use what it already knows about the types to save you from writing more. The compiler knows <em>name</em> is a String because it was declared as a String on the right hand side of the equals sign.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-02.png" alt="image" width="393" height="152"/>
<h6/>
</div></figure>
<section data-type="sect2" data-pdf-bookmark="Type inference, NOT dynamic types"><div class="sect2" id="type_inferencecomma_not_dynamic_types">
<h2>Type inference, NOT dynamic types</h2>
<p>When you declare your variable using <em>var</em>, <strong><em>it still has a type</em></strong>. It’s not a way of adding dynamic or optional types to Java (it’s <strong>not</strong> like Groovy’s <em>def</em>). It’s simply a way of avoiding writing that type twice.</p>
<p>You do have to somehow tell the compiler what the type is when you declare the variable. You can’t assign it later. So, you <strong><em>can’t</em></strong> do this:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-03.png" alt="image" width="271" height="32"/>
<h6/>
</div></figure>
<p>because the compiler has no idea what type <em>name</em> is.</p>
<p>It also means that you can’t change its type later:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-04.png" alt="image" width="424" height="38"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Someone has to read your code"><div class="sect2" id="someone_has_to_read_your_code">
<h2>Someone has to read your code</h2>
<p>Using <em>var</em> does make the code shorter, and an IDE can tell you exactly what type your variable is, so you might be tempted to use var everywhere.</p>
<p>However, someone reading your code might not be using an IDE or have the same understanding of the code as you.</p>
<p>We did not use var in this book (even though it would have been easier to fit the code on the pages), because we wanted to be explicit to you, the reader, about what the code was doing.</p>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Tip: Better with useful variable names"><div class="sect2" id="tip_better_with_useful_variable_names">
<h2>Tip: Better with useful variable names</h2>
<p>If you don’t have the type information visible in the code, descriptive variable and method names will be extra helpful to a reader.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-05.png" alt="image" width="438" height="182"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Tip: Variable will be the concrete type"><div class="sect2" id="tip_variable_will_be_the_concrete_type">
<h2>Tip: Variable will be the concrete type</h2>
<p>In <a data-type="xref" href="ch11.xhtml#data_structures_collections_and_generics">Chapter 11</a> we started “programming to interfaces”; i.e., we declared our variables as the interface type, not the implementation:</p>
<pre data-type="programlisting"><strong>List&lt;String&gt; list = new ArrayList&lt;&gt;();</strong></pre>
<p>If you’re using var, you can’t do this. The type will be the type from the right-hand side:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-06.png" alt="image" width="374" height="66"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect2" data-pdf-bookmark="Tip: Don’t use var with the diamond operator"><div class="sect2" id="tip_donapostrophet_use_var_with_the_diam">
<h2>Tip: Don’t use var with the diamond operator</h2>
<p>Look at the last example. We declared list first as a List&lt;String&gt; and used the diamond operator (&lt;&gt;) on the right-hand side. The compiler knows the type of the list element is a String from the lefthand side.</p>
<p>If you use var, like we did in the second example, the compiler no longer has this information. If you want the list to still be a list of Strings, you need to declare that on the righthand side; otherwise, it will contain Objects.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0698-07.png" alt="image" width="387" height="89"/>
<h6/>
</div></figure>
<p>Read all the style guidelines from the OpenJDK developers (<em><a href="https://oreil.ly/eVfSd">https://oreil.ly/eVfSd</a></em>).</p>
</div></section>
</div></section>
<section data-type="sect1" data-pdf-bookmark="#1 Records"><div class="sect1" id="hash1_records">
<h1>#1 Records</h1>
<section data-type="sect2" data-pdf-bookmark="Why do you care?"><div class="sect2" id="why_do_you_carequestion_mark-id0004">
<h2>Why do you care?</h2>
<p><a data-type="indexterm" data-primary="classes" data-secondary="records" id="idm46038386146176"/><a data-type="indexterm" data-primary="records" id="idm46038386144960"/>A “simple” Java data object is often not simple at all. Even a data class (sometimes called a Java Bean, for historical reasons) with only a couple of fields requires quite a lot more code than you might expect.</p>
<section data-type="sect3" data-pdf-bookmark="A Java data class, before Java 16"><div class="sect3" id="a_java_data_classcomma_before_java_16">
<h3>A Java data class, before Java 16</h3>
<p>Imagine a basic Customer class, with a name and an ID:</p>
<pre data-type="programlisting"><strong>public final class Customer {</strong>
  <strong>private final int id;</strong>
  <strong>private final String name;</strong>

  <strong>public Customer(int id, String name) {</strong>
    <strong>this.id = id;</strong>
    <strong>this.name = name;</strong>
  <strong>}</strong>

  <strong>public int getId() {</strong>
    <strong>return id;</strong>
  <strong>}</strong>

  <strong>public String getName() {</strong>
    <strong>return name;</strong>
  <strong>}</strong>

  <strong>public boolean equals(Object o) { }</strong>

  <strong>public int hashCode() { }</strong>

  <strong>public String toString() { }</strong>
<strong>}</strong></pre>
<p>We’ve left out the details of the equals, hashCode, and toString methods, but you would probably want to implement those methods, especially if you’re going to use this object in any collections. We’ve also left off the “setters”; this is an immutable object with final fields, but in some cases you might want setters as well.</p>
<p>That’s a lot of code! It’s a simple class with two fields, and the full code, including implementation, is 41 lines!</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="What if there was a special syntax for data classes?"><div class="sect3" id="what_if_there_was_a_special_syntax_for_d">
<h3>What if there was a special syntax for data classes?</h3>
<p>Guess what? If you’re using <strong>Java 16</strong> or higher, there is! Instead of creating a <em>class</em>, you create a <em>record</em>.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0699-01.png" alt="image" width="492" height="259"/>
<h6/>
</div></figure>
<p>That’s it. That’s all you need to do to replace the 42 lines of code of the “old” Customer data class.</p>
<p>A record like this one has instance variables, a constructor, accessor methods, and equals, hashCode, and toString methods.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Using a record"><div class="sect3" id="using_a_record">
<h3>Using a record</h3>
<p>When you’re using a record that’s already been defined, it looks exactly the same as it would if the record class was a standard data class:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0699-02.png" alt="image" width="448" height="120"/>
<h6/>
</div></figure>
<p>The output looks like:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0699-03.png" alt="image" width="476" height="132"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Goodbye “get”"><div class="sect3" id="goodbye_quotation_markgetquotation_mark">
<h3>Goodbye “get”</h3>
<p>Did you notice something? Records don’t use the classic “get” prefix for the methods that let you read the instance variables (hence we carefully called them “accessors” and not “getters”). They just use the name of the record component as the method name.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="You can override constructors"><div class="sect3" id="you_can_override_constructors">
<h3>You can override constructors</h3>
<p>The constructor, accessors, and equals, hashCode, and toString methods are all provided by default, but you can still override their behavior if you need something specific.</p>
<p>Most of the time, you probably won’t need to. But if you want, for example, to add validation when you create the record, you can do that by overriding the constructor.</p>
<pre data-type="programlisting"><strong>public record Customer(int id, String name) {</strong>
  <strong>public Customer(int id, String name) {</strong>
    <strong>if (id &lt; 0) {</strong>
      <strong>throw new ValidationException();</strong>
    <strong>}</strong>
    <strong>this.id = id;</strong>
    <strong>this.name = name;</strong>
  <strong>}</strong>
<strong>}</strong></pre>
<p>Actually, it’s even easier than that. The example above is a <strong><em>canonical constructor</em></strong>, i.e., the normal kind of constructor we’ve been using everywhere. But records also have a <strong><em>compact constructor</em></strong>. This compact constructor assumes all the normal stuff is taken care of (having the right number of parameters in the right order, and all assigned to the instance variables) and lets you define only the other stuff that matters, like validation:</p>
<figure class="informal"><div class="figure">
<img src="Images/f0699-04.png" alt="image" width="740" height="384"/>
<h6/>
</div></figure>
<p>When you call the Customer’s constructor, you still need to pass it an ID and a name, and they will still be assigned to the instance variables (that’s all defined by the record header). All you need to do to add validation to the constructor is use the compact form and let the compiler take care of all of the rest.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0700-01.png" alt="image" width="711" height="114"/>
<h6/>
</div></figure>
</div></section>
<section data-type="sect3" data-pdf-bookmark="You can override or add methods"><div class="sect3" id="you_can_override_or_add_methods">
<h3>You can override or add methods</h3>
<p>You can override any of the methods and add your own (public, default, or private) methods. If you are migrating existing data classes to use records, you may want to keep your old equals, hashCode, and toString methods.</p>
<figure class="informal"><div class="figure">
<img src="Images/f0700-02.png" alt="image" width="726" height="332"/>
<h6/>
</div></figure>
<p>You can create a protected method; the compiler won’t stop you, but there’s no point—records are always <em>final</em> classes and can’t be subclassed.</p>
</div></section>
<section data-type="sect3" data-pdf-bookmark="Records are immutable"><div class="sect3" id="records_are_immutable">
<h3>Records are immutable</h3>
<p>In <a data-type="xref" href="ch18.xhtml#dealing_with_concurrency_issues_race_con">Chapter 18</a>, we talked about making data objects <em>immutable</em>. Immutable objects are safer to use in concurrent applications, because you know that it’s impossible for more than one thread to change the data.</p>
<p>It’s also easier to reason about what’s happening in your application if you know the data classes can’t change, so even in applications that aren’t multithreaded, you may find immutable data objects being used. And in #9 in this appendix we saw how immutability in Strings can save memory.</p>
<p>Records are immutable. You can’t change the values in a record Object after you have created it; there are no “setters” and no way to change the instance variables. You can’t access them directly from outside the record, only read them via the accessor method.</p>
<p>If you try to change one of the record’s instance variables from inside the record, the compiler will throw an exception. A record’s instance variables are <em>final</em>.</p>
<p>Find out more about records in Oracle’s Record Classes documentation (<em><a href="https://oreil.ly/D7fh3">https://oreil.ly/D7fh3</a></em>). There, you can also read about some of the other new language features available in Java 17 that we didn’t get a chance to cover, like Pattern Matching, Sealed Classes, Switch Expressions, and the very useful Text Blocks.</p>
</div></section>
</div></section>
</div></section>
</div></section></div></body></html>