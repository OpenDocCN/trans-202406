<html><head></head><body><div id="sbo-rt-content"><section data-type="preface" epub:type="preface" data-pdf-bookmark="Preface"><div class="preface" id="idm45302830853408">
<h1>Preface</h1>


<p>Welcome to <em>Hacking Kubernetes</em>, a book for Kubernetes practitioners who want
to run their workloads securely and safely. At time of writing, Kubernetes has
been around for some six years, give or take. There are over one hundred
certified <a href="https://oreil.ly/bo2xA">Kubernetes offerings</a>
available, such as distributions and managed services. With an increasing number
of organizations deciding to move their workloads to Kubernetes, we thought
we’d share our experiences in this space, to help make your workloads more secure
and safe to deploy and operate. Thank you for joining us on this journey, and we hope you have as much fun reading this book and applying what you learn as we had writing it.</p>

<p>In this preface, we will paint a picture of our intended audience, talk about
why we wrote the book, and explain how we think you should go about using it by
providing a quick content guide. We will also go over some
administrative details like Kubernetes versions and conventions used.</p>






<section data-type="sect1" data-pdf-bookmark="About You"><div class="sect1" id="idm45302830850672">
<h1>About You</h1>

<p>To get most out of the book, we assume that you either have a DevOps role,
are a Kubernetes platform person, a cloud native architect, a site reliability
engineer (SRE), or something related to being a chief information security officer (CISO).
We further assume that you’re interested in being hands-on—while we discuss
threats and defenses in principle, we try our best to demonstrate them at the
same time and point you to tools that can help you.</p>

<p>At this point we also want to make sure you understand that the book you’re
reading is targeting advanced topics. We assume that you’re already
familiar with Kubernetes, and specifically Kubernetes security topics, at least on
a surface level. In other words, we don’t go into much detail about how things
work, but summarize or recap important concepts or mechanisms on a per-chapter
basis.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>We wrote this book with Blue and Red Teams in mind. It goes without saying that
what we share here is to be used exclusively for defending your own Kubernetes
cluster and workloads.</p>
</div>

<p>In particular, we assume that you understand what containers are for and how
they run in Kubernetes. If you are not yet familiar with these topics, we
recommend that you do some preliminary reading. The following are books we
suggest consulting:</p>

<ul>
<li>
<p><a href="https://oreil.ly/k9ydo"><em>Kubernetes: Up and Running</em></a> by Brendan Burns, Kelsey Hightower, and Joe Beda (O’Reilly)</p>
</li>
<li>
<p><a href="https://oreil.ly/cli0J"><em>Managing Kubernetes</em></a> by Brendan Burns and Craig Tracey (O’Reilly)</p>
</li>
<li>
<p><a href="https://oreil.ly/S8jQf"><em>Kubernetes Security</em></a> by Liz Rice and Michael Hausenblas (O’Reilly)</p>
</li>
<li>
<p><a href="https://oreil.ly/Yh8EM"><em>Container Security</em></a> by Liz Rice (O’Reilly)</p>
</li>
<li>
<p><em>Cloud Native Security</em> by Chris Binnie and Rory McCune (Wiley)</p>
</li>
</ul>

<p>Now that we have made clear what this book aims to achieve and who will,
in our view, benefit from it, let’s move on to a different topic: the authors.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="About Us"><div class="sect1" id="idm45302819415840">
<h1>About Us</h1>

<p>Based on our combined 10+ years of hands-on experience designing,
running, attacking, and defending Kubernetes-based workloads and clusters,
we, the authors, want to equip you, the cloud native security practitioner,
with what you need to be successful in your job.</p>

<p>Security is often illuminated by the light of past mistakes, and both of us have been learning (and making mistakes in!) Kubernetes security for a while now.
We wanted to be sure that what we thought we understood about the subject was true,
so we wrote a book to verify our suspicions through a shared lens.</p>

<p>We have both served in different companies and roles, given training sessions,
published material from tooling to blog posts, and we have shared
lessons learned on the topic in various public speaking engagements. Much of what motivates us here
and the examples we use are rooted in our experiences in our day-to-day jobs and/or things we observed at our clients’ companies.</p>
</div></section>













<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="How To Use This Book"><div class="sect1" id="idm45302831056512">
<h1>How To Use This Book</h1>

<p>This book is a threat-based guide to security in Kubernetes, using a vanilla
Kubernetes installation with its (built-in) defaults as a starting point.
We’ll kick off discussions with an abstract threat model of a distributed
system running arbitrary workloads and progress to a detailed assessment
of each component of a secure Kubernetes system.</p>

<p>In each chapter, we examine a component’s architecture and potential default
settings and review high-profile attacks and historical Common Vulnerabilities and Exposures (CVEs). We also demonstrate
attacks and share best-practice configuration in order to demonstrate hardening
clusters from possible angles of attack.</p>

<p>In order to aid you in navigating the book, here’s a quick rundown on the
chapter level:</p>

<ul>
<li>
<p>In <a data-type="xref" data-xrefstyle="chap-num-title" href="ch01.xhtml#intro">Chapter 1, “Introduction”</a> we set the scene, introducing our main antagonist and also what
threat modeling is.</p>
</li>
<li>
<p><a data-type="xref" data-xrefstyle="chap-num-title" href="ch02.xhtml#ch-pod-level-resources">Chapter 2, “Pod-Level Resources”</a> then focuses on pods, from configurations to
attacks to defenses.</p>
</li>
<li>
<p>Next up, in <a data-type="xref" data-xrefstyle="chap-num-title" href="ch03.xhtml#ch-container-runtime-isolation">Chapter 3, “Container Runtime Isolation”</a>, we switch gears and dive deep
into sandboxing and isolation techniques.</p>
</li>
<li>
<p><a data-type="xref" data-xrefstyle="chap-num-title" href="ch04.xhtml#ch-apps-supply-chain">Chapter 4, “Applications and Supply Chain”</a> then covers supply chain attacks and what you
can do to detect and mitigate them.</p>
</li>
<li>
<p>In <a data-type="xref" data-xrefstyle="chap-num-title" href="ch05.xhtml#ch-networking">Chapter 5, “Networking”</a> we then review networking defaults and how to secure
your cluster and workload traffic.</p>
</li>
<li>
<p>Then, in <a data-type="xref" data-xrefstyle="chap-num-title" href="ch06.xhtml#ch-storage">Chapter 6, “Storage”</a> we shift our focus to aspects of persistence, looking
at filesystems, volumes, and sensitive information at rest.</p>
</li>
<li>
<p><a data-type="xref" data-xrefstyle="chap-num-title" href="ch07.xhtml#ch-hard-multi-tenancy">Chapter 7, “Hard Multitenancy”</a> covers the topic of running workloads for multitenants in a cluster and what can go wrong with this.</p>
</li>
<li>
<p>Next up is <a data-type="xref" data-xrefstyle="chap-num-title" href="ch08.xhtml#ch-policy">Chapter 8, “Policy”</a>, where we review different kinds of policies
in use, discuss access control—specifically role-based access control (RBAC)—and
generic policy solutions such as Open Policy Agent (OPA).</p>
</li>
<li>
<p>In <a data-type="xref" data-xrefstyle="chap-num-title" href="ch09.xhtml#ch-intrusion-detection">Chapter 9, “Intrusion Detection”</a> we cover the question of what you can do if,
despite controls put in place, someone manages to break in.</p>
</li>
<li>
<p>The last chapter, <a data-type="xref" data-xrefstyle="chap-num-title" href="ch10.xhtml#ch-organizations">Chapter 10, “Organizations”</a>, is somewhat special, in that it doesn’t
focus on tooling but on the human side of things, in the context of
cloud as well as on-prem installations.</p>
</li>
</ul>

<p class="pagebreak-before">In <a data-type="xref" data-xrefstyle="chap-num-title" href="app01.xhtml#appendix-pod-attack">Appendix A, “A Pod-Level Attack“</a>, we walk you through a hands-on exploration of attacks on the pod-level as discussed in <a data-type="xref" href="ch02.xhtml#ch-pod-level-resources">Chapter 2</a>. Finally, in <a data-type="xref" data-xrefstyle="chap-num-title" href="app02.xhtml#appendix-resources">Appendix B, “Resources“</a>
we put together further reading material on a per-chapter basis as well as a collection of annotated CVEs relevant in the context of this book.</p>

<p>You don’t have to read the chapters in order; we tried our best to keep the chapters as self-contained as possible and refer to related content where appropriate.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Note that at the time of writing this book, Kubernetes 1.21 was the latest
stable version. Most examples shown here work with earlier versions, and
we’re fully aware that by the time you’re reading this book, the
current version will potentially be significantly higher. The concepts stay
the same.</p>
</div>

<p>With this short guide on what to expect and a quick orientation done, let’s
have a look at conventions used in the book.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Conventions Used in This Book"><div class="sect1" id="idm45302831056112">
<h1>Conventions Used in This Book</h1>

<p>The following typographical conventions are used in this book:</p>
<dl>
<dt><em>Italic</em></dt>
<dd>
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>
</dd>
<dt><code>Constant width</code></dt>
<dd>
<p>Used for program listings. Also used within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>
</dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>This element signifies a tip or suggestion.</p>
</div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This element signifies a general note.</p>
</div>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>This element indicates a warning or caution.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Using Code Examples"><div class="sect1" id="idm45302830829216">
<h1>Using Code Examples</h1>
<!--PROD: Please reach out to author to find out if they will be uploading code examples to oreilly.com or their own site (e.g., GitHub). If there is no code download, delete this whole section. If there is, when you email digidist with the link, let them know what you filled in for title_title (should be as close to book title as possible, i.e., learning_python_2e). This info will determine where digidist loads the files.-->

<p>Supplemental material is available at <a href="http://hacking-kubernetes.info"><em class="hyperlink">http://hacking-kubernetes.info</em></a>.</p>

<p>If you have a technical question or a problem using the code examples, please
email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a>.</p>

<p>This book is here to help you get your job done. In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require 
<span class="keep-together">permission.</span></p>

<p>We appreciate but generally do not require attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em>Hacking Kubernetes</em> by Andrew Martin and Michael Hausenblas (O’Reilly). Copyright 2022 Andrew Martin and Michael Hausenblas, 978-1-492-08173-9.”</p>

<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="email" href="mailto:permissions@oreilly.com"><em>permissions@oreilly.com</em></a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="O’Reilly Online Learning"><div class="sect1" id="idm45302830992128">
<h1>O’Reilly Online Learning</h1>
<div data-type="note" epub:type="note" class="ormenabled"><h6>Note</h6>
<p>For more than 40 years, <a href="http://oreilly.com" class="orm:hideurl"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>
</div>

<p>Our unique network of experts and innovators shares its knowledge and expertise through books, articles, and our online learning platform. O’Reilly’s online learning platform gives on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, visit <a href="http://oreilly.com" class="orm:hideurl"><em>http://oreilly.com</em></a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="How to Contact Us"><div class="sect1" id="idm45302830986032">
<h1>How to Contact Us</h1>

<p>Please address comments and questions concerning this book to the publisher:</p>
<ul class="simplelist">
  <li>O’Reilly Media, Inc.</li>
  <li>1005 Gravenstein Highway North</li>
  <li>Sebastopol, CA 95472</li>
  <li>800-998-9938 (in the United States or Canada)</li>
  <li>707-829-0515 (international or local)</li>
  <li>707-829-0104 (fax)</li>
</ul>

<p>We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a href="https://oreil.ly/HackingKubernetes"><em class="hyperlink">https://oreil.ly/HackingKubernetes</em></a>.</p>
<!--Don't forget to update the link above.-->

<p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical questions about this book.</p>

<p>For news and information about our books and courses, visit <a href="http://oreilly.com"><em class="hyperlink">http://oreilly.com</em></a>.</p>

<p>Find us on Facebook: <a href="http://facebook.com/oreilly"><em class="hyperlink">http://facebook.com/oreilly</em></a></p>

<p>Follow us on Twitter: <a href="http://twitter.com/oreillymedia"><em class="hyperlink">http://twitter.com/oreillymedia</em></a></p>

<p>Watch us on YouTube: <a href="http://youtube.com/oreillymedia"><em class="hyperlink">http://youtube.com/oreillymedia</em></a></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Acknowledgments"><div class="sect1" id="idm45302830985472">
<h1>Acknowledgments</h1>

<p>Thanks go out to our reviewers Roland Huss, Liz Rice, Katie Gamanji,
Ihor Dvoretskyi, Mark Manning, and Michael Gasch. Your comments absolutely made a difference
and we appreciate your guidance and suggestions.</p>

<p>Andy would like to thank his family and friends for their unceasing love and encouragement, the inspiring and
razor-sharp team at ControlPlane for their assiduous insight and guidance, and the continually enlightening cloud native
security community for their relentless kindness and brilliance. Special thanks to Rowan Baker, Kevin Ward, Lewis Denham-Parry, Nick Simpson, Jack Kelly, and James Cleverley-Prance.</p>

<p>Michael would like to express his deepest gratitude to his awesome and supportive family: our kids Saphira, Ranya, and Iannis; my wicked smart and fun wife, Anneliese, and also our bestest of all dogs, Snoopy.</p>

<p>We would be remiss not to mention the <a href="https://oreil.ly/xr1is">Hacking Kubernetes Twitter list</a> of our 
<span class="keep-together">inspirations</span> and mentors, featuring alphabetized luminaries such as
<a href="https://twitter.com/antitree" class="orm:hideurl">@antitree</a>, <a href="https://twitter.com/bradgeesaman" class="orm:hideurl">@bradgeesaman</a>, <a href="https://twitter.com/brau_ner" class="orm:hideurl">@brau_ner</a>, <a href="https://twitter.com/christianposta" class="orm:hideurl">@christianposta</a>, <a href="https://twitter.com/dinodaizovi" class="orm:hideurl">@dinodaizovi</a>, <a href="https://twitter.com/erchiang" class="orm:hideurl">@erchiang</a>, <a href="https://twitter.com/garethr" class="orm:hideurl">@garethr</a>, <a href="https://twitter.com/IanColdwater" class="orm:hideurl">@IanColdwater</a>, <a href="https://twitter.com/IanMLewis" class="orm:hideurl">@IanMLewis</a>, <a href="https://twitter.com/jessfraz" class="orm:hideurl">@jessfraz</a>, <a href="https://twitter.com/jonpulsifer" class="orm:hideurl">@jonpulsifer</a>, <a href="https://twitter.com/jpetazzo" class="orm:hideurl">@jpetazzo</a>, <a href="https://twitter.com/justincormack" class="orm:hideurl">@justincormack</a>, <a href="https://twitter.com/kelseyhightower" class="orm:hideurl">@kelseyhightower</a>, <a href="https://twitter.com/krisnova" class="orm:hideurl">@krisnova</a>, <a href="https://twitter.com/kubernetesonarm" class="orm:hideurl">@kubernetesonarm</a>, <a href="https://twitter.com/liggitt" class="orm:hideurl">@liggitt</a>, <a href="https://twitter.com/lizrice" class="orm:hideurl">@lizrice</a>, <a href="https://twitter.com/lordcyphar" class="orm:hideurl">@lordcyphar</a>, <a href="https://twitter.com/lorenc_dan" class="orm:hideurl">@lorenc_dan</a>, <a href="https://twitter.com/lumjjb" class="orm:hideurl">@lumjjb</a>, <a href="https://twitter.com/mauilion" class="orm:hideurl">@mauilion</a>, <a href="https://twitter.com/MayaKaczorowski" class="orm:hideurl">@MayaKaczorowski</a>, <a href="https://twitter.com/mikedanese" class="orm:hideurl">@mikedanese</a>, <a href="https://twitter.com/monadic" class="orm:hideurl">@monadic</a>, <a href="https://twitter.com/raesene" class="orm:hideurl">@raesene</a>, <a href="https://twitter.com/swagitda_" class="orm:hideurl">@swagitda_</a>, <a href="https://twitter.com/tabbysable" class="orm:hideurl">@tabbysable</a>, <a href="https://twitter.com/tallclair" class="orm:hideurl">@tallclair</a>, <a href="https://twitter.com/torresariass" class="orm:hideurl">@torresariass</a>, <a href="https://twitter.com/WhyHiAnnabelle" class="orm:hideurl">@WhyHiAnnabelle</a>, and <a href="https://twitter.com/captainhashjack" class="orm:hideurl">@<sup>captain</sup>Hλ$ħ𝔍A¢k</a>.</p>

<p>Last but certainly not least, both authors thank the O’Reilly team, especially Angela Rufino, for shepherding us through the process of writing this book.</p>
</div></section>







</div></section></div></body></html>