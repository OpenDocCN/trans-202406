<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 8. Managing Users and Privileges"><div class="chapter" id="CH8_USER_MANAGEMENT">
<h1><span class="label">Chapter 8. </span>Managing Users and Privileges</h1>


<p>The simplest database system is just a bunch of files lying<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="about" id="idm46177457745352"/><a data-type="indexterm" data-primary="relational databases" data-secondary="user management" data-seealso="users" id="idm46177457744264"/><a data-type="indexterm" data-primary="clients" data-see="users" id="idm46177457743176"/><a data-type="indexterm" data-primary="CREATE DATABASE" data-secondary="user management" data-seealso="users" id="idm46177457742328"/><a data-type="indexterm" data-primary="privileges" data-secondary="users and privileges explained" data-tertiary="user management" id="idm46177457741240"/> around, with some data in them, and no unified access process. With any RDBMS, we come to expect a significantly higher level of sophistication and abstraction. For one, we want to be able to access the database from multiple clients simultaneously. However, not all of the clients are similar, and not every one of them necessarily needs access to all of the data in the database. It’s possible to imagine a database where every user is a superuser, but that would mean you’d have to install a dedicated database for every app and dataset: wasteful. Instead, databases have evolved to support multiple users and roles and provide a means to control privileges and access on a very fine-grained level to guarantee secure shared environments.</p>

<p>Understanding users and privileges is an important part of working efficiently with a database system. Well-planned and managed roles result in a secure system that is easy to manage and work with. In this chapter, we will review most of the things one needs to know about user and privilege management, starting from the basics and moving toward new features like roles. After finishing this chapter, you should have all the basics required to manage access within a MySQL database.</p>






<section data-type="sect1" data-pdf-bookmark="Understanding Users and Privileges"><div class="sect1" id="USR-SEC-UNDERSTAND">
<h1>Understanding Users and Privileges</h1>

<p>The first building block in the foundation of a shared system is<a data-type="indexterm" data-primary="users" data-secondary="privileges" id="idm46177457736440"/><a data-type="indexterm" data-primary="privileges" data-secondary="users and privileges explained" id="idm46177457735592"/><a data-type="indexterm" data-primary="security" data-secondary="users and privileges explained" id="idm46177457734744"/> the concept of a <em>user</em>. Most modern operating systems have user-based access, so it’s highly likely that you already know what that means. Users in MySQL are special objects used for the purpose of:</p>

<ul>
<li>
<p>Authentication (making sure that a user can access the MySQL server)</p>
</li>
<li>
<p>Authorization (making sure that a user can interact with objects in the database)</p>
</li>
</ul>

<p>One thing that makes MySQL distinct from other DBMSs is that users do not <em>own</em> schema objects.<a data-type="indexterm" data-primary="users" data-secondary="ownership of objects" id="idm46177457730504"/><a data-type="indexterm" data-primary="MySQL" data-secondary="ownership of objects" id="idm46177457729656"/><a data-type="indexterm" data-primary="ownership of objects" id="idm46177457728808"/><a data-type="indexterm" data-primary="object ownership" data-see="ownership of objects" id="idm46177457728200"/></p>

<p>Let’s consider these points in a little more detail. Every time you access the MySQL server, you must specify a user to be used during authentication. Once you’ve been authenticated and your identity has been confirmed, you have access to the database. Usually, the user you will be acting as when interacting with schema objects will be the same as the one you used for authentication, but that’s not strictly necessary, and that’s why we separate the second point. <a data-type="indexterm" data-primary="users" data-secondary="proxies" id="idm46177457726472"/><a data-type="indexterm" data-primary="proxies" data-secondary="definition" id="idm46177457725624"/>A proxy user is a user that is used for the purpose of checking privileges and actually acting within the database, when another user is used during authentication. That’s a rather complex topic and requires nondefault configuration, but it’s still possible.</p>

<p>This is an important distinction to remember between<a data-type="indexterm" data-primary="authentication" data-secondary="authorization versus" id="idm46177457723992"/><a data-type="indexterm" data-primary="authorization" data-secondary="authentication versus" id="idm46177457723144"/><a data-type="indexterm" data-primary="users" data-secondary="proxies" data-tertiary="authentication versus authorization" id="idm46177457722296"/> authentication and authorization. While you can authenticate with one user, you can be authorized as another and have or not have various permissions.</p>

<p>With these two covered, let’s discuss the last point. Some DBMSs support the concept of object ownership. That is, when the user creates a database object—a database or schema, a table, or a stored procedure—that user automatically becomes the new object’s owner. The owner usually has the ability to modify objects it owns and grant other users access to them. The important thing here is that MySQL does not in any way have a concept of object ownership.</p>

<p>This lack of ownership makes it even more important to have<a data-type="indexterm" data-primary="privileges" data-secondary="users and privileges explained" data-tertiary="user management" id="idm46177457719672"/><a data-type="indexterm" data-primary="privileges" data-secondary="about" id="idm46177457718584"/> flexible rules so that users can create objects and then potentially share access to those objects with other users. That is achieved using <em>privileges</em>. <a data-type="indexterm" data-primary="defaults" data-secondary="actions forbidden until privilege" id="idm46177457717064"/>Privileges can be thought of as sets of rules controlling what actions users are allowed to perform and what data they can access. It’s important to understand that by default in MySQL a database user has no privileges at all. Granting a privilege means allowing some action that by default is 
<span class="keep-together">forbidden.</span></p>

<p>Users in MySQL are also a bit different than in other databases,<a data-type="indexterm" data-primary="access control list (ACL) for network" id="idm46177457714664"/><a data-type="indexterm" data-primary="networking" data-secondary="access control list" id="idm46177457714056"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="network access control list" id="idm46177457713208"/><a data-type="indexterm" data-primary="managing users" data-see="users" id="idm46177457712120"/><a data-type="indexterm" data-primary="privileges" data-secondary="network access control list" id="idm46177457711272"/> because the user object includes a network access control list (ACL). Usually, a MySQL user is represented not just by its name, like <code>bob</code>, but with an appended network address, like <code>bob@localhost</code>. This particular example defines a user that can be accessed only locally through the loopback interface or a Unix socket connection. We will touch on this topic later, when we discuss the SQL syntax for creating and manipulating existing users.</p>

<p>MySQL stores all information related to users and privileges in<a data-type="indexterm" data-primary="grant tables" id="idm46177457708872"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="grant tables" id="idm46177457708264"/> special tables in the <code>mysql</code> system database called <em>grant tables</em>. We’ll talk about this concept in a bit more depth in <a data-type="xref" href="#USR-GRANT-TABLES">“Grant Tables”</a>.</p>

<p>This short theoretical foundation should be sufficient to form a basic understanding of MySQL’s system of users and privileges. Let’s get practical and review the commands and capabilities that the database provides for managing users and privileges.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The root User"><div class="sect1" id="USR-ROOT">
<h1>The root User</h1>

<p>Every MySQL installation comes with a few users installed by<a data-type="indexterm" data-primary="root user in MySQL" id="idm46177457703448"/><a data-type="indexterm" data-primary="users" data-secondary="root@localhost in MySQL" id="idm46177457702840"/> default. Most of them you don’t ever need to touch, but there’s one that’s extremely frequently used. Some might even say that it’s overused, but that’s not the discussion we want to have here. The user we’re talking about is the ubiquitous and all-powerful <code>root</code> user. With the same name as the default Unix and Linux superuser, this user is just that in MySQL: a user that can do anything by default.</p>

<p>To be more specific, the user is <code>root@localhost</code>, sometimes <a data-type="indexterm" data-primary="hostnames" data-secondary="localhost" id="idm46177457700040"/><a data-type="indexterm" data-primary="initial user as root user in MySQL" id="idm46177457699192"/><a data-type="indexterm" data-primary="root user in MySQL" data-secondary="root@localhost" id="idm46177457698584"/><a data-type="indexterm" data-primary="localhost" id="idm46177457697736"/>called the <em>initial user</em>. The <code>localhost</code> part of the username, as you now know, limits its use to only local connections. When you install MySQL, depending on the specific MySQL flavor  and the OS, you might be able to access <code>root@localhost</code> from the OS root account by just executing the <code>mysql</code> command. In some other cases, a temporary password will be generated for this user.</p>

<p>The initial user is not the only superuser you can create, as<a data-type="indexterm" data-primary="security" data-secondary="root user in MySQL" id="idm46177457694520"/> you’ll see in <a data-type="xref" href="#USR-PRIV-SUPER">“The SUPER Privilege”</a>. While you can create a <code>root@&lt;ip&gt;</code> user, or even a <code>root@%</code> user, we strongly discourage you from doing so, as it is a security hole waiting to be exploited. Not every MySQL server even needs to listen on an interface apart from loopback (that is, localhost), let alone have a superuser with a default name available for login. <a data-type="indexterm" data-primary="passwords" data-secondary="root account" data-tertiary="MySQL root as superuser" id="idm46177457691352"/>Of course, you can set secure passwords for all users and should probably set one for <code>root</code>, but it is arguably that little bit safer to not allow remote superuser access, if that is possible.</p>

<p>For all intents and purposes, <code>root@localhost</code> is just a regular<a data-type="indexterm" data-primary="privileges" data-secondary="root user" id="idm46177457688552"/> user with all privileges granted. You can even drop it, which can happen by mistake. Losing access to the <code>root@localhost</code> user is a fairly common problem when running MySQL. You may have set a password and forgotten it or you inherited a server and were not given the password or something else might have happened. We cover the procedure to recover a forgotten password for the <code>root@localhost</code> initial user in <a data-type="xref" href="#USR-ROOT-RESET">“Changing root’s Password and Insecure Startup”</a>. If you dropped your last available superuser, you will have to follow the same procedure but create a new user instead of changing an existing one.</p>
</div></section>













<section data-type="sect1" class="less_space pagebreak-before" data-pdf-bookmark="Creating and Using New Users"><div class="sect1" id="USR-CREATE">
<h1>Creating and Using New Users</h1>

<p>The first task we’ll cover is creating a new user. Let’s start with a rather simple example and review each part:<a data-type="indexterm" data-primary="users" data-secondary="creating new" id="idm46177457682984"/><a data-type="indexterm" data-primary="CREATE USER" id="idm46177457682008"/><a data-type="indexterm" data-primary="passwords" data-secondary="CREATE USER" id="idm46177457681336"/></p>

<pre data-type="programlisting">CREATE USER <a class="co" id="co_managing_users_and_privileges_CO1-1" href="#callout_managing_users_and_privileges_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a>
'bob'@'10.0.2.%' <a class="co" id="co_managing_users_and_privileges_CO1-2" href="#callout_managing_users_and_privileges_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a>
IDENTIFIED BY 'password'; <a class="co" id="co_managing_users_and_privileges_CO1-3" href="#callout_managing_users_and_privileges_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_managing_users_and_privileges_CO1-1" href="#co_managing_users_and_privileges_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>SQL statement to create a user</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO1-2" href="#co_managing_users_and_privileges_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>User and host definition</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO1-3" href="#co_managing_users_and_privileges_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Password specification</p></dd>
</dl>

<p>Here’s a more complex example:</p>

<pre data-type="programlisting">CREATE USER <a class="co" id="co_managing_users_and_privileges_CO2-1" href="#callout_managing_users_and_privileges_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a>
'bob'@'10.0.2.%' <a class="co" id="co_managing_users_and_privileges_CO2-2" href="#callout_managing_users_and_privileges_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a>
IDENTIFIED WITH mysql_native_password <a class="co" id="co_managing_users_and_privileges_CO2-3" href="#callout_managing_users_and_privileges_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a>
BY 'password' <a class="co" id="co_managing_users_and_privileges_CO2-4" href="#callout_managing_users_and_privileges_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a>
DEFAULT ROLE 'user_role' <a class="co" id="co_managing_users_and_privileges_CO2-5" href="#callout_managing_users_and_privileges_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a>
REQUIRE SSL <a class="co" id="co_managing_users_and_privileges_CO2-6" href="#callout_managing_users_and_privileges_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a>
AND CIPHER 'EDH-RSA-DES-CBC3-SHA' <a class="co" id="co_managing_users_and_privileges_CO2-7" href="#callout_managing_users_and_privileges_CO2-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a>
WITH MAX_USER_CONNECTIONS 10 <a class="co" id="co_managing_users_and_privileges_CO2-8" href="#callout_managing_users_and_privileges_CO2-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a>
PASSWORD EXPIRE NEVER; <a class="co" id="co_managing_users_and_privileges_CO2-9" href="#callout_managing_users_and_privileges_CO2-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-1" href="#co_managing_users_and_privileges_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>SQL statement to create a user</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-2" href="#co_managing_users_and_privileges_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>User and host definition</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-3" href="#co_managing_users_and_privileges_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Authentication plugin specification</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-4" href="#co_managing_users_and_privileges_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Authentication string/password</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-5" href="#co_managing_users_and_privileges_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Default role set once user is authenticated and connected</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-6" href="#co_managing_users_and_privileges_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Require SSL for connections for this user</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-7" href="#co_managing_users_and_privileges_CO2-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Require specific ciphers</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-8" href="#co_managing_users_and_privileges_CO2-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>Limit maximum number of connections from this user</p></dd>
<dt><a class="co" id="callout_managing_users_and_privileges_CO2-9" href="#co_managing_users_and_privileges_CO2-9"><img src="Images/9.png" alt="9" width="12" height="12"/></a></dt>
<dd><p>Override global password expiration settings</p></dd>
</dl>

<p>This is just scratching the surface, but should give an idea of the parameters that can be changed for a user during its creation. There are quite a lot of them. Let’s review the specific parts of that statement in a little more detail:</p>
<dl>
<dt>User and host definition</dt>
<dd>
<div class="openblock">
<p>We mentioned in <a data-type="xref" href="#USR-SEC-UNDERSTAND">“Understanding Users and Privileges”</a> that users in<a data-type="indexterm" data-primary="hostnames" data-secondary="creating new user" id="idm46177457621800"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="hostname" id="idm46177457620952"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="hostname" id="idm46177457619864"/><a data-type="indexterm" data-primary="names" data-secondary="user@host" id="idm46177457619016"/> MySQL are defined not only by their name, but also by hostname. In the previous example, the user is <code>'bob'@'10.0.2.%'</code>, where <code><em>bob</em></code> is the username and <code><em>10.0.2.%</em></code> is a hostname specification. In fact, it’s a hostname specification with a wildcard. Each time someone connects with the username <code><em>bob</em></code> using TCP, MySQL will do a few things:</p>
<ol>
<li>
<p>Get the IP address of the connecting client.</p>
</li>
<li>
<p>Perform a reverse DNS lookup of the IP address to a hostname.</p>
</li>
<li>
<p>Perform a DNS lookup for that hostname (to make sure the reverse lookup wasn’t compromised).</p>
</li>
<li>
<p>Check the hostname or IP address with the user’s hostname specification.</p>
</li>

</ol>

<p>Only if the hostnames match is access granted. For our user <code><em>bob</em></code>, a connection from IP address <code>10.0.2.121</code> would be allowed, while a connection from <code>10.0.3.22</code> would be denied. <a data-type="indexterm" data-primary="security" data-secondary="user-hostname connection" id="idm46177457610536"/>In fact, to allow connections from another hostname, a new user should be created. Internally, <code>'bob'@'10.0.2.%'</code> is a completely different user from <code>'bob'@'10.0.3.%'</code>. <a data-type="indexterm" data-primary="fully qualified domain names (FQDNs)" id="idm46177457608680"/><a data-type="indexterm" data-primary="names" data-secondary="user@host" data-tertiary="fully qualified domain names" id="idm46177457608072"/>It’s also possible to use fully qualified domain names (FQDNs) in the hostname specification, as in <code>'bob'@'acme.com'</code>, but DNS lookups take time, and it’s a common optimization to disable them completely.</p>

<p>Specifying all possible hostnames for all users to connect from might be tedious, but it’s a useful security feature. However, sometimes a database is set up behind a firewall, or it’s simply impractical to specify hostnames. <a data-type="indexterm" data-primary="names" data-secondary="user@host" data-tertiary="wildcards" id="idm46177457605528"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="user@hostname wildcards" id="idm46177457604440"/><a data-type="indexterm" data-primary="hostnames" data-secondary="creating new user" data-tertiary="wildcard in hostname" id="idm46177457603352"/><a data-type="indexterm" data-primary="wildcard (%)" data-secondary="user hostnames" id="idm46177457602264"/><a data-type="indexterm" data-primary="% (wildcard)" data-secondary="user hostnames" data-primary-sortas="#wildcard" id="idm46177457601416"/>To completely subvert this system, a single wildcard can be used in the host specification, as in <code>'bob'@'10.0.2%'</code>. The <code>'%'</code> wildcard is also used when you do not specify the host at all  (<code>'bob'@'%'</code>).</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When proxying connections to MySQL, pay attention to what<a data-type="indexterm" data-primary="HAProxy load balancer" data-secondary="IP address for incoming connections" id="idm46177457597960"/><a data-type="indexterm" data-primary="connections" data-secondary="IP address for incoming" id="idm46177457597112"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="IP address of incoming connection" id="idm46177457596264"/><a data-type="indexterm" data-primary="users" data-secondary="proxies" data-tertiary="proxying connections" id="idm46177457595416"/><a data-type="indexterm" data-primary="IP address for incoming connections" id="idm46177457594328"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="IP address of incoming connection" id="idm46177457593720"/><a data-type="indexterm" data-primary="defaults" data-secondary="HAProxy IP address for incoming" id="idm46177457592472"/><a data-type="indexterm" data-primary="proxies" data-secondary="IP address of incoming connection" id="idm46177457591432"/> IP address MySQL “sees” for incoming connections. For example, when HAProxy is used, by default all connections will come from the IP addresses of machines where HAProxy is running. This fact should be taken into consideration when configuring users. We cover HAProxy configuration for MySQL in <a data-type="xref" href="ch15.xhtml#CH15_LOAD_BAlANCERS">Chapter 15</a>.</p>
</div>

<p>You’ll notice that we’ve enclosed both the username and the host specification in single quotes (<code>''</code>). That is not mandatory, and username and host specification follow a similar set of rules to those that were outlined for table and column names and aliases in <a data-type="xref" href="ch04.xhtml#MOD-SEC-CREATEDB">“Creating and Using Databases”</a> and <a data-type="xref" href="ch05.xhtml#ADV1-SEC-ALIASES">“Aliases”</a>. For example, when creating or altering the user <code>bob@localhost</code>  or <code>bob@172.17.0.2</code>, there’s no need to use any quoting. You can’t, though, create this user without using quotes: <code>'username with a space'@'172.%'</code>. Double quotes, single quotes, or backticks can be used to enclose usernames and hostnames with special symbols.</p>
</div>

</dd>
<dt>Authentication plugins specification</dt>
<dd>
<div class="openblock">
<p>MySQL supports a wide variety of ways to authenticate users<a data-type="indexterm" data-primary="authentication" data-secondary="plugin for new user" id="idm46177457582888"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="authentication plugins" id="idm46177457581832"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="authentication plugins" id="idm46177457580616"/> through its system of authentication plugins. These plugins also provide a way for developers to implement new means of authentication without changing MySQL itself. You can set a particular plugin for a user in the creation phase or later.</p>

<p>You might never need to change the plugin for a user, but it’s still worth knowing about this subsystem. <a data-type="indexterm" data-primary="authentication" data-secondary="LDAP" id="idm46177457578776"/><a data-type="indexterm" data-primary="LDAP authentication" id="idm46177457577800"/><a data-type="indexterm" data-primary="PAM (Pluggable Authentication Modules; Percona)" id="idm46177457577128"/><a data-type="indexterm" data-primary="authentication" data-secondary="PAM" id="idm46177457576360"/>In particular, LDAP authentication with MySQL can be achieved by using a special authentication plugin. MySQL Enterprise Edition supports a first-class LDAP plugin, and other MySQL versions and flavors can use PAM as a middleman.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><em>PAM</em> stands for Pluggable Authentication Modules. It’s a standard interface on Unix-like systems that, in very simple terms, allows MySQL to provide authentication by various methods, such as OS passwords, or  LDAP. PAM hides the complexity of those authentication methods, and programs like MySQL only need to interface with PAM itself.</p>
</div>

<p>MySQL 8.0 uses the <code>caching_sha2_password</code> plugin by<a data-type="indexterm" data-primary="passwords" data-secondary="CREATE USER" data-tertiary="password plugin" id="idm46177457572440"/> default, which provides superior security and performance compared to the legacy <code>mysql_native_password</code> but is not compatible with every client library. To change the default plugin you can configure the <code>default_authentication_plugin</code> variable, which will cause new users to be created with the specified plugin instead.</p>
</div>

</dd>
<dt>Authentication string/password</dt>
<dd>
<div class="openblock">
<p>Some authentication plugins, including the default one, require<a data-type="indexterm" data-primary="authentication" data-secondary="plugin for new user" data-tertiary="auth_string" id="idm46177457567976"/><a data-type="indexterm" data-primary="passwords" data-secondary="CREATE USER" data-tertiary="authentication string" id="idm46177457566648"/> you to set a password for the user. Other plugins, like the PAM one, require you to define a mapping from OS users to MySQL users. <code>auth_string</code> will be used in both cases. Let’s take a look at an example mapping with PAM:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">''</code><code class="o">@</code><code class="s1">''</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">WITH</code><code> </code><code class="n">auth_pam</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AS</code><code> </code><code class="s1">'mysqld, dba=dbausr, dev=devusr'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.01 sec)</pre>

<p>What’s defined here is a mapping that can be read as follows: <a data-type="indexterm" data-primary="PAM (Pluggable Authentication Modules; Percona)" data-secondary="configuration file" id="idm46177457537784"/>the PAM configuration file <em>mysqld</em> will be used (usually located at <em>/etc/pam.d/mysqld</em>); OS users with group <code>dba</code> will be mapped to MySQL user <code>dbausr</code>, and OS users with group <code>dev</code> to <code>devusr</code>. The mapping alone is not enough, however, as the necessary permissions have to be assigned.</p>

<p>Note that either the Percona PAM plugin or MySQL Enterprise Edition is required for this to work. This example creates a proxy user, which we briefly discussed in <a data-type="xref" href="#USR-SEC-UNDERSTAND">“Understanding Users and Privileges”</a>.</p>

<p>Using nondefault authentication plugins is a relatively advanced topic, so we’re only bringing up PAM here to show you that the authentication string is not always a password.</p>
<div data-type="tip"><h6>Tip</h6>
<p>You can consult the documentation for details on installing the<a data-type="indexterm" data-primary="MySQL Enterprise Edition" data-secondary="authentication plugin documentation link" id="idm46177457531352"/><a data-type="indexterm" data-primary="PAM (Pluggable Authentication Modules; Percona)" data-secondary="authentication plugin link" id="idm46177457530440"/> <a href="https://oreil.ly/A5rbp">Percona plugin</a> and the MySQL <a href="https://oreil.ly/oihnX">Enterprise Edition plugin</a>.</p>
</div>
</div>

</dd>
<dt>Default role set</dt>
<dd>
<p>Roles are a fairly recent addition to MySQL. You may think of a role as a collection of privileges. We discuss them in <a data-type="xref" href="#USR-SEC-ROLES">“Roles”</a>.</p>
</dd>
<dt>SSL configuration</dt>
<dd>
<div class="openblock">
<p>You can force connections from particular users to use SSL by<a data-type="indexterm" data-primary="CREATE USER" data-secondary="SSL configuration" id="idm46177457509496"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="SSL configuration" id="idm46177457508648"/><a data-type="indexterm" data-primary="SSL configuration for users" id="idm46177457507560"/><a data-type="indexterm" data-primary="encryption" data-secondary="SSL configuration for users" id="idm46177457506952"/><a data-type="indexterm" data-primary="REQUIRE SSL" id="idm46177457506104"/><a data-type="indexterm" data-primary="REQUIRE CIPHER" id="idm46177457505496"/> passing <code>REQUIRE SSL</code> to the <code>CREATE USER</code> or <code>ALTER USER</code> command. Unencrypted connections to the user will be forbidden. Additionally, you can, as shown in the example we gave, specify a particular cipher suite or a number of suites that can be used for this user. Ideally, you should set the acceptable cipher suites on the system level, but setting this on the user level is useful to allow some less safe suites for specific connections. You don’t need to specify <code>REQUIRE SSL</code> to specify <code>REQUIRE CIPHER</code>, and in that case unencrypted connections can be established. However, if an encrypted connection is established, it will use only the particular set of ciphers you supply:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'P@ssw0rd#'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">REQUIRE</code><code> </code><code class="n">CIPHER</code><code> </code><code class="s1">'EDH-RSA-DES-CBC3-SHA'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.02 sec)</pre>

<p>Additional configurable options that are available include the following:</p>
<dl>
<dt><code>X509</code></dt>
<dd>
<p>Forcing a client to present a valid certificate. This, as well as the following options, implies the use of <code>SSL</code>.</p>
</dd>
<dt><code>ISSUER</code> <code><em>issuer</em></code></dt>
<dd>
<p>Forcing a client to present a valid certificate issued by a particular CA, specified in <code><em><em>issuer</em></em></code>.</p>
</dd>
<dt><code>SUBJECT</code> <code><em>subject</em></code></dt>
<dd>
<p>Forcing a client to present a valid certificate with a particular subject.</p>
</dd>
</dl>

<p>These options can be combined to specify a very particular certificate and encryption requirement:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">REQUIRE</code><code> </code><code class="n">SUBJECT</code><code> </code><code class="s1">'/C=US/ST=NC/L=Durham/</code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">O=BI Dept certificate/</code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">CN=client/emailAddress=john@nonexistent.com'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AND</code><code> </code><code class="n">ISSUER</code><code> </code><code class="s1">'/C=US/ST=NC/L=Durham/</code></strong><code class="s1">
    -&gt; </code><strong><code class="s1">O=MySQL/CN=CA/emailAddress=ca@nonexistent.com'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AND</code><code> </code><code class="n">CIPHER</code><code> </code><code class="s1">'EDH-RSA-DES-CBC3-SHA'</code><code class="p">;</code></strong></pre>
</div>

</dd>
<dt>Resource consumption limits</dt>
<dd>
<div class="openblock">
<p>You can define resource consumption limits. In our example we<a data-type="indexterm" data-primary="CREATE USER" data-secondary="resource consumption limits" id="idm46177457414136"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="resource consumption limits" id="idm46177457412776"/><a data-type="indexterm" data-primary="resource consumption limits" id="idm46177457411592"/><a data-type="indexterm" data-primary="MAX_CONNECTIONS_PER_HOUR" id="idm46177457410952"/><a data-type="indexterm" data-primary="MAX_QUERIES_PER_HOUR" id="idm46177457410312"/><a data-type="indexterm" data-primary="MAX_UPDATES_PER_HOUR" id="idm46177457409640"/><a data-type="indexterm" data-primary="queries" data-secondary="MAX_QUERIES_PER_HOUR" id="idm46177457408968"/><a data-type="indexterm" data-primary="UPDATE" data-secondary="MAX_UPDATES_PER_HOUR" id="idm46177457408024"/><a data-type="indexterm" data-primary="connections" data-secondary="MAX_CONNECTIONS_PER_HOUR" id="idm46177457407080"/> are limiting 
<span class="keep-together">the maximum</span> number of concurrent connections by this user to 10. This and other resource options default to 0, meaning unlimited. The other possible 
<span class="keep-together">constraints</span> are <code>MAX_CONNECTIONS_PER_HOUR</code>, <code>MAX_QUERIES_PER_HOUR</code>, and 
<span class="keep-together"><code>MAX_UPDATES_PER_HOUR</code></span>. All of these options are part of the <code>WITH</code> specification.</p>

<p>Let’s create a fairly restricted user, which can run only 10 queries during each given hour, can have only a single concurrent connection, and may not connect more than twice per hour:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WITH</code><code> </code><code class="n">MAX_QUERIES_PER_HOUR</code><code> </code><code class="mi">10</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">MAX_CONNECTIONS_PER_HOUR</code><code> </code><code class="mi">2</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">MAX_USER_CONNECTIONS</code><code> </code><code class="mi">1</code><code class="p">;</code></strong></pre>

<p>Note that the number of <code>MAX_QUERIES_PER_HOUR</code> is inclusive of <code>MAX_UPDATES_PER_HOUR</code> and will limit updates as well. <a data-type="indexterm" data-primary="command line interface mysql" data-secondary="MAX_QUERIES_PER_HOUR" id="idm46177457340728"/><a data-type="indexterm" data-primary="mysql command line interface" data-secondary="MAX_QUERIES_PER_HOUR" id="idm46177457339784"/>The number of queries also includes everything that the MySQL CLI executes, so setting a really low value is not recommended.</p>
</div>

</dd>
<dt>Password management options override</dt>
<dd>
<div class="openblock">
<p>For authentication plugins that deal with passwords, which are<a data-type="indexterm" data-primary="CREATE USER" data-secondary="authentication plugins" data-tertiary="password options" id="idm46177457336392"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="authentication options for passwords" id="idm46177457335144"/><a data-type="indexterm" data-primary="passwords" data-secondary="CREATE USER" data-tertiary="password options" id="idm46177457333960"/> stored in grant tables (covered in <a data-type="xref" href="#USR-GRANT-TABLES">“Grant Tables”</a>), you can specify a variety of options related to passwords. In our example, we’re setting up a user that has the <code>PASSWORD EXPIRE NEVER</code> policy, meaning that its password will never expire based on time. You could also create a user that would have a password expiring every other day, or each week.</p>

<p>MySQL 8.0 extends control capabilities to include tracking of failed authentication attempts and the ability to lock an account temporarily. Let’s consider an important user with strict control:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'app_admin'</code><code class="o">@</code><code class="s1">'192.168.%'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">IDENTIFY</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'...'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WITH</code><code> </code><code class="n">PASSWORD</code><code> </code><code class="n">EXPIRE</code><code> </code><code class="k">INTERVAL</code><code> </code><code class="mi">30</code><code> </code><code class="n">DAY</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">PASSWORD</code><code> </code><code class="n">REUSE</code><code> </code><code class="k">INTERVAL</code><code> </code><code class="mi">180</code><code> </code><code class="n">DAY</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">PASSWORD</code><code> </code><code class="k">REQUIRE</code><code> </code><code class="n">CURRENT</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">FAILED_LOGIN_ATTEMPTS</code><code> </code><code class="mi">3</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">PASSWORD_LOCK_TIME</code><code> </code><code class="mi">1</code><code class="p">;</code></strong></pre>

<p>This user’s password will need to be changed every 30 days, and previous passwords will not be eligible for reuse for 180 days. When changing the password, the current password must be presented. For good measure, we also only allow three consecutive failed login attempts and will block this user for one day if those are made.</p>

<p>Note that these are overrides on the default system options. It’s impractical to set up each individual user manually, so we instead recommend that you set up the defaults and only use overrides for particular users. For example, you can have your DBA users’ passwords expire more frequently.</p>
</div>

</dd>
</dl>

<p>There are some other options available for user creation, which we won’t cover here. As MySQL evolves, more options become available, but we believe the ones we’ve covered so far should be enough while learning your way around MySQL.</p>

<p>Since this section is about not only creating but also using new users, let’s talk about these uses. They typically fall into a few categories:</p>
<dl>
<dt>Connecting and authenticating</dt>
<dd>
<div class="openblock">
<p>This is the default and most widespread use of any user entity.<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="grant tables" id="idm46177457258232"/><a data-type="indexterm" data-primary="grant tables" data-secondary="authentication of user" id="idm46177457257096"/><a data-type="indexterm" data-primary="authentication" data-secondary="users connecting" data-tertiary="grant tables" id="idm46177457256152"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" id="idm46177457254936"/><a data-type="indexterm" data-primary="authorization" data-secondary="user authentication" id="idm46177457253992"/><a data-type="indexterm" data-primary="users" data-secondary="authentication" id="idm46177457222728"/><a data-type="indexterm" data-primary="connections" data-secondary="users connecting" id="idm46177457221880"/><a data-type="indexterm" data-primary="authentication" data-secondary="users connecting" id="idm46177457221032"/> You specify the user and password, and MySQL authenticates you with that user and your origin host. Then that pair forms a user as defined within grant tables, which will be used for authorization when you access database objects. This is the default situation. You can run the following query to see the currently authenticated user as well as the user provided by the client:<a data-type="indexterm" data-primary="users" data-secondary="SELECT CURRENT_USER(), USER()" id="idm46177457219656"/><a data-type="indexterm" data-primary="SELECT" data-secondary="CURRENT_USER(), USER()" id="idm46177457218808"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">CURRENT_USER</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="nf">USER</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------+----------------+
| CURRENT_USER() | USER()         |
+----------------+----------------+
| root@localhost | root@localhost |
+----------------+----------------+
1 row in set (0.00 sec)</pre>

<p>Quite unsurprisingly, the records match. This is the most common occurrence, but as you’ll see next, it’s not the only possibility.</p>
</div>

</dd>
<dt>Providing security for stored objects</dt>
<dd>
<div class="openblock">
<p>When a stored object (like a stored procedure or a view) is created, any user can be specified within the <code>DEFINER</code> clause of that object. That allows you to execute an object from the standpoint of another user: definer, instead of invoker. This can be a useful way to provide elevated privileges for some specific operation, but it can also be a security hole in your system.</p>

<p>When a MySQL account is specified in the <code>DEFINER</code> clause<a data-type="indexterm" data-primary="stored objects access via DEFINER" id="idm46177457202168"/><a data-type="indexterm" data-primary="DEFINER account for access" id="idm46177457201464"/><a data-type="indexterm" data-primary="privileges" data-secondary="DEFINER account for access" id="idm46177457200824"/><a data-type="indexterm" data-primary="users" data-secondary="DEFINER account for access" id="idm46177457199912"/> of an object, such as a stored procedure, that account will be used for authorization when the stored procedure is executed or when a view is queried. In other words, the current user of a session changes temporarily. As we mentioned, this can be used to elevate privileges in a controlled manner. For example, instead of granting a user permission to read from some tables, you can create a view with a <code>DEFINER</code>: the account you specify will be allowed to access the tables when the view is being queried, but not under any other circumstances. Also, the view itself can further restrict what data is returned. The same is true for stored procedures. To interact with an object that has a <code>DEFINER</code>, a caller must have the necessary permissions.</p>

<p>Let’s take a look at an example. Here’s a simple stored procedure that returns the current user used for authorization, as well as the authenticated user. The <code>DEFINER</code> is set to <code>'bob'@'localhost'</code>:</p>

<pre data-type="programlisting" data-code-language="mysql"><strong><code class="n">DELIMITER</code><code> </code><code class="p">;</code><code class="p">;</code><code>
</code><code class="k">CREATE</code><code> </code><code class="n">DEFINER</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="k">PROCEDURE</code><code> </code><code class="nf">test_proc</code><code class="p">(</code><code class="p">)</code><code>
</code><code class="n">BEGIN</code><code>
    </code><code class="k">SELECT</code><code> </code><code class="k">CURRENT_USER</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="nf">USER</code><code class="p">(</code><code class="p">)</code><code class="p">;</code><code>
</code><code class="n">END</code><code class="p">;</code><code>
</code><code class="p">;</code><code class="p">;</code><code>
</code><code class="n">DELIMITER</code><code> </code><code class="p">;</code></strong></pre>

<p>If this procedure is executed by the user <code>john</code> from the previous examples, output similar to the following will be printed:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CALL</code><code> </code><code class="nf">test_proc</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------+--------------------+
| CURRENT_USER() | USER()             |
+----------------+--------------------+
| bob@localhost  | john@192.168.1.174 |
+----------------+--------------------+
1 row in set (0.00 sec)</pre>

<p>It’s important to keep this in mind. Sometimes users are not who they appear to be, and to keep your database safe that has to be noted.</p>
</div>

</dd>
<dt>Proxying</dt>
<dd>
<div class="openblock">
<p>Some authentication methods, like PAM and LDAP, do not<a data-type="indexterm" data-primary="users" data-secondary="proxies" id="idm46177457104824"/><a data-type="indexterm" data-primary="proxies" data-secondary="users connecting" id="idm46177457103848"/><a data-type="indexterm" data-primary="connections" data-secondary="users connecting" data-tertiary="proxying" id="idm46177457102904"/> operate with a one-to-one mapping from authenticating users to database ones. We showed before how to create a PAM-authenticated user—let’s see what such a user would see if they queried the authenticating and provided users:<a data-type="indexterm" data-primary="SELECT" data-secondary="CURRENT_USER(), USER()" data-tertiary="proxying" id="idm46177457101320"/><a data-type="indexterm" data-primary="users" data-secondary="SELECT CURRENT_USER(), USER()" data-tertiary="proxying" id="idm46177457100104"/><a data-type="indexterm" data-primary="PAM (Pluggable Authentication Modules; Percona)" data-secondary="SELECT CURRENT_USER(), USER()" id="idm46177457080664"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">CURRENT_USER</code><code class="p">(</code><code class="p">)</code><code class="p">,</code><code> </code><code class="nf">USER</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting" class="less_space pagebreak-before">+------------------+------------------------+
| CURRENT_USER()   | USER()                 |
+------------------+------------------------+
| dbausr@localhost | localdbauser@localhost |
+------------------+------------------------+
1 row in set (0.00 sec)</pre>
</div>

</dd>
</dl>

<p>Before we close this section, we should bring up a couple of important points related to the <code>CREATE USER</code> statement. <a data-type="indexterm" data-primary="CREATE USER" data-secondary="multiple users with one command" id="idm46177457065992"/>First, it is possible to create multiple user accounts with a single command, instead of executing multiple <code>CREATE USER</code> statements individually. <a data-type="indexterm" data-primary="CREATE USER" data-secondary="IF NOT EXISTS" id="idm46177457064376"/>Second, if the user already exists, <code>CREATE USER</code> doesn’t fail, but will change that user in subtle ways. This can be dangerous. To avoid this, you can specify an <code>IF NOT EXISTS</code> option to the command. By doing so, you tell MySQL to create the user only if no such user already exists, and do nothing if it does.</p>

<p>At this point, you should have a good understanding of what a MySQL user is and how it can be used. Next we’ll show you how users can be modified, but first you need to understand how user-related information is stored internally.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Grant Tables"><div class="sect1" id="USR-GRANT-TABLES">
<h1>Grant Tables</h1>

<p>MySQL stores both user information and privileges as records in<a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="grant tables" id="idm46177457038936"/><a data-type="indexterm" data-primary="grant tables" id="idm46177457037432"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" id="idm46177457036824"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="grant tables" id="idm46177457035976"/><a data-type="indexterm" data-primary="GRANT" data-secondary="grant tables" id="idm46177457034888"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="grant tables" id="idm46177457034040"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="grant tables" id="idm46177457033192"/> <em>grant tables</em>. These are special internal tables in the <code>mysql</code> database, which should ideally never be modified manually and instead are implicitly modified when statements like <code>CREATE USER</code> or <code>GRANT</code> are run. <a data-type="indexterm" data-primary="mysql.user table" id="idm46177457030312"/>For example, here is the slightly truncated output of a <code>SELECT</code> query on the <code>mysql.user</code> table, which contains user records, including their passwords (in hashed form):</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">user</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">user</code><code> </code><code class="o">=</code><code> </code><code class="s1">'root'</code><code class="err">\</code><code class="n">G</code></strong></pre>

<pre data-type="programlisting">*************************** 1. row ***************************
                    Host: localhost
                    User: root
             Select_priv: Y
             Insert_priv: Y
             Update_priv: Y
             Delete_priv: Y
...
     Create_routine_priv: Y
      Alter_routine_priv: Y
        Create_user_priv: Y
              Event_priv: Y
            Trigger_priv: Y
  Create_tablespace_priv: Y
                ssl_type:
              ssl_cipher: 0x
             x509_issuer: 0x
            x509_subject: 0x
           max_questions: 0
             max_updates: 0
         max_connections: 0
    max_user_connections: 0
                  plugin: mysql_native_password
   authentication_string: *E1206987C3E6057289D6C3208EACFC1FA0F2FA56
        password_expired: N
   password_last_changed: 2020-09-06 17:20:57
       password_lifetime: NULL
          account_locked: N
        Create_role_priv: Y
          Drop_role_priv: Y
  Password_reuse_history: NULL
     Password_reuse_time: NULL
Password_require_current: NULL
         User_attributes: NULL
1 row in set (0.00 sec)</pre>

<p>You can immediately see that a lot of the fields directly correspond to specific invocations of the <code>CREATE USER</code> or <code>ALTER USER</code> statements. For example, you can see that this <code>root</code> user doesn’t have any specific rules set regarding its password’s lifecycle. You can also see quite a lot of privileges, though we have omitted some for brevity. These are privileges that don’t require a target, like a table. <a data-type="indexterm" data-primary="privileges" data-secondary="global privileges" id="idm46177457001464"/><a data-type="indexterm" data-primary="global privileges" id="idm46177457000488"/>Such privileges are called <em>global</em>. We’ll show you how to view targeted privileges later.</p>

<p>As of MySQL 8.0, the other grant tables are:<a data-type="indexterm" data-primary="grant tables" data-secondary="listing of" id="idm46177456999016"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" data-tertiary="listing of" id="idm46177456998040"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="grant tables" data-tertiary="listing of" id="idm46177456996824"/></p>
<dl>
<dt><code>mysql.user</code></dt>
<dd>
<p>User accounts, static global privileges, and other nonprivilege columns</p>
</dd>
<dt><code>mysql.global_grants</code></dt>
<dd>
<p>Dynamic global privileges</p>
</dd>
<dt><code>mysql.db</code></dt>
<dd>
<p>Database-level privileges</p>
</dd>
<dt><code>mysql.tables_priv</code></dt>
<dd>
<p>Table-level privileges</p>
</dd>
<dt><code>mysql.columns_priv</code></dt>
<dd>
<p>Column-level privileges</p>
</dd>
<dt><code>mysql.procs_priv</code></dt>
<dd>
<p>Stored procedure and function privileges</p>
</dd>
<dt><code>mysql.proxies_priv</code></dt>
<dd>
<p>Proxy-user privileges</p>
</dd>
<dt><code>mysql.default_roles</code></dt>
<dd>
<p>Default user roles</p>
</dd>
<dt><code>mysql.role_edges</code></dt>
<dd>
<p>Edges for role subgraphs</p>
</dd>
<dt><code>mysql.password_history</code></dt>
<dd>
<p>Password change history</p>
</dd>
</dl>

<p>You don’t need to remember all of these tables, let alone their structure and contents, but you should remember that they exist. When necessary, you can easily look up the necessary structure information in the docs or in the database itself.</p>

<p>Internally, MySQL caches grant tables in memory and refreshes this cached representation every time an account management statement is run and thus modifies grant tables. Cache invalidation happens only for the specific user affected. Ideally, you should never modify these grant tables directly, and there’s rarely a use case for that. <a data-type="indexterm" data-primary="grant tables" data-secondary="rereading after modification" id="idm46177456967352"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" data-tertiary="rereading after modification" id="idm46177456966408"/><a data-type="indexterm" data-primary="FLUSH PRIVILEGES" id="idm46177456965224"/><a data-type="indexterm" data-primary="privileges" data-secondary="FLUSH PRIVILEGES" id="idm46177456964552"/>However, in the unfortunate event that you do need to modify a grant table, you can tell MySQL to reread them by running the <code>FLUSH PRIVILEGES</code> command. Failure to do so will mean that the in-memory cache won’t get updated until either the database is restarted, an account management statement is run against the same user that was updated directly in the grant tables, or <code>FLUSH PRIVILEGES</code> is executed for some other purpose. Even though the command’s name suggests it only affects privileges, MySQL will reread information from all of the tables and refresh its cache in 
<span class="keep-together">memory.</span></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="User Management Commands and Logging"><div class="sect1" id="USR-MGMT-REPL">
<h1>User Management Commands and Logging</h1>

<p>There are some direct consequences of the fact that all the<a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="grant tables logging" id="idm46177456959576"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="grant tables logging" id="idm46177456958248"/><a data-type="indexterm" data-primary="logs by grant tables" id="idm46177456957032"/><a data-type="indexterm" data-primary="grant tables" data-secondary="actions logged" id="idm46177456956360"/><a data-type="indexterm" data-primary="users" data-secondary="managing" id="ch08-man"/> commands we’re discussing in this chapter are, under the hood, modifying the grant tables. They are close to DML operations in some regards. They are atomic: any <code>CREATE USER</code>, <code>ALTER USER</code>, <code>GRANT</code>, or other such operation either succeeds or fails without actually changing its target. They are logged: all of the changes done to grant tables either manually or through the relevant commands are logged to the binary log.<a data-type="indexterm" data-primary="binary logs" data-secondary="grant tables" id="idm46177456952376"/><a data-type="indexterm" data-primary="replication" data-secondary="user management and" id="idm46177456951400"/> Thus, they are replicated (see <a data-type="xref" href="ch13.xhtml#CH13_HA">Chapter 13</a>) and will also be available for point-in-time recovery (see 
<span class="keep-together"><a data-type="xref" href="ch10.xhtml#CH10_BACKUP">Chapter 10</a>).</span></p>

<p>Application of these statements on the source can break<a data-type="indexterm" data-primary="replication" data-secondary="replica user data" id="idm46177456948024"/> replication if the targeted user doesn’t exist on the replica. We therefore recommend that you keep your replicas consistent with their sources not only in data, but also in users and other metadata. Of course, it’s only “meta” in the sense that it exists outside of your real application data; <a data-type="indexterm" data-primary="users" data-secondary="mysql.user table and replication" id="idm46177456946728"/><a data-type="indexterm" data-primary="replication" data-secondary="users in mysql.user table" id="idm46177456945880"/>users are records in the <code>mysql.user</code> table, and that should be remembered when setting up replication.</p>

<p>Mostly, replicas are full copies of their sources. In more complex topologies, like fan-in, that may not be true, but even in such cases we recommend keeping users consistent across the topology. In general, it is easier and safer than fixing broken replicas or remembering whether you need to disable binary logging before altering a user.</p>

<p>While we say that execution of <code>CREATE USER</code> is similar to an<a data-type="indexterm" data-primary="CREATE USER" data-secondary="mysql.user table" id="idm46177456942408"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="mysql.user table" id="idm46177456941400"/> <code>INSERT</code> to the <code>mysql.user</code> table, the <code>CREATE USER</code> statement itself is not changed in any way before being logged. That is true for the binary log, the slow query log (with a caveat), the general query log, and audit logs. The same is true for every other operation discussed in this chapter. The caveat for the slow query log is that an extra server option, <code>log_slow_admin_statements</code>, has to be enabled for administrative statements to be logged here.</p>
<div data-type="tip"><h6>Tip</h6>
<p>You can find the locations of the logs we’ve mentioned under<a data-type="indexterm" data-primary="logs by grant tables" data-secondary="location of" id="idm46177456937064"/><a data-type="indexterm" data-primary="grant tables" data-secondary="actions logged" data-tertiary="log locations" id="idm46177456935656"/><a data-type="indexterm" data-primary="log_bin_basename" id="idm46177456934440"/><a data-type="indexterm" data-primary="slow query log" data-secondary="slow_query_log_file" id="idm46177456933768"/><a data-type="indexterm" data-primary="general_log_file" id="idm46177456932824"/><a data-type="indexterm" data-primary="system variables" data-secondary="grant table log locations" id="idm46177456932152"/> 
<span class="keep-together">the following</span> system variable names: <code>log_bin_basename</code>, <code>slow_query_log_file</code>, and <code>general_log_file</code>. Their values can include the full path to the file or just the filename. In the latter case, that file will be in the MySQL server’s data directory. <a data-type="indexterm" data-primary="binary logs" data-secondary="grant tables" data-tertiary="file names" id="idm46177456928840"/><a data-type="indexterm" data-primary="names" data-secondary="binary logs" id="idm46177456927592"/>Binary logs always have a numeric suffix: for example, <em>binlog.000271</em>. We do not cover audit log configuration in this book.</p>
</div>

<p>Consider the following example:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'vinicius'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'...'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<p>Here’s an example of how the same <code>CREATE USER</code> command is reflected in the general, slow query, and binary logs:</p>
<dl>
<dt>General log</dt>
<dd>
<div class="openblock"><pre data-type="programlisting" class="no-indent">
2020-11-22T15:53:17.354270Z        29 Query
    CREATE USER 'vinicius'@'%' IDENTIFIED BY &lt;secret&gt;
</pre>
</div>

</dd>
<dt>Slow query log</dt>
<dd>
<div class="openblock"><pre data-type="programlisting" class="no-indent">
# Time: 2020-11-22T15:53:17.368010Z
# User@Host: root[root] @ localhost []  Id:    29
# Query_time: 0.013772  Lock_time: 0.000161 Rows_sent: 0  Rows_examined: 0
SET timestamp=1606060397;
CREATE USER 'vinicius'@'%' IDENTIFIED BY &lt;secret&gt;;
</pre>
</div>

</dd>
<dt>Binary log</dt>
<dd>
<div class="openblock"><pre data-type="programlisting" class="no-indent">
#201122 18:53:17 server id 1  end_log_pos 4113 CRC32 0xa12ac622
    Query   thread_id=29    exec_time=0     error_code=0    Xid = 243
SET TIMESTAMP=1606060397.354238/*!*/;
CREATE USER 'vinicius'@'%' IDENTIFIED WITH 'caching_sha2_password'
    AS '$A$005$|v&gt;\ZKe^R...'
/*!*/;
</pre>
</div>

</dd>
</dl>

<p>Don’t worry if the binary log output is intimidating. It’s not intended for easy human consumption. However, you can see that the actual hash of the password, as it would appear in <code>mysql.user</code>, gets written to the binary log. We’ll talk more about this log in <a data-type="xref" href="ch10.xhtml#CH10_BACKUP">Chapter 10</a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Modifying and Dropping Users"><div class="sect1" id="USR-MOD-DROP">
<h1>Modifying and Dropping Users</h1>

<p>Creating a user usually isn’t the end of your interaction with it. You may later need to change its properties, perhaps to require an encrypted connection. It also happens that users need to be dropped. Neither of these operations is too different from user creation, but you need to know how to perform them in order to fully grasp user management.</p>








<section data-type="sect2" data-pdf-bookmark="Modifying a User"><div class="sect2" id="idm46177456879320">
<h2>Modifying a User</h2>

<p>Any parameter that it’s possible to set during user creation can<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="modifying users" id="ch08-modu"/><a data-type="indexterm" data-primary="ALTER USER" id="ch08-modu2"/><a data-type="indexterm" data-primary="RENAME USER" id="idm46177456874840"/><a data-type="indexterm" data-primary="SET command" data-secondary="PASSWORD" id="idm46177456874168"/><a data-type="indexterm" data-primary="passwords" data-secondary="SET PASSWORD" id="idm46177456873224"/> also be altered at a later time. This is generally achieved using the <code>ALTER USER</code> command. MySQL 5.7 and before also have <code>RENAME USER</code> and <code>SET PASSWORD</code> shortcuts, <a data-type="indexterm" data-primary="SET command" data-secondary="DEFAULT ROLE" id="idm46177456870904"/><a data-type="indexterm" data-primary="roles" data-secondary="DEFAULT ROLE" id="idm46177456869896"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="DEFAULT ROLE" id="idm46177456868952"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="DEFAULT ROLE" id="idm46177456867736"/><a data-type="indexterm" data-primary="defaults" data-secondary="role" id="idm46177456866520"/>while version 8.0 expanded that list to include <code>SET DEFAULT ROLE</code> (we’ll cover the role system in <a data-type="xref" href="#USR-SEC-ROLES">“Roles”</a>). Note that <code>ALTER USER</code> can be used to change everything about the user, and the other commands are just convenient ways to run common maintenance operations.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We called <code>RENAME USER</code> a shortcut, but it’s special in that it doesn’t have a “full” <code>ALTER USER</code> alternative. As you’ll see, the privileges required to run the <code>RENAME USER</code> command are also different, and are the same as for user creation  (we’ll talk more about privileges soon).</p>
</div>

<p>We will start with the regular <code>ALTER USER</code> command. In the first example, <a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="authentication plugins" id="idm46177456860328"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="authentication plugins" id="idm46177456859080"/><a data-type="indexterm" data-primary="CREATE USER" data-secondary="authentication plugins" id="idm46177456857864"/><a data-type="indexterm" data-primary="authentication" data-secondary="plugin for new user" data-tertiary="modifying" id="idm46177456856920"/><a data-type="indexterm" data-primary="grant tables" data-secondary="authentication plugins" id="idm46177456855704"/><a data-type="indexterm" data-primary="ALTER USER" data-secondary="authentication plugins" id="idm46177456854760"/>we’re going to modify the authentication plugin used. A lot of older programs do not support the new and standard in MySQL 8.0 <code>caching_sha2_password</code> plugin and require you to either create the users using the older <code>mysql_native_password</code> plugin or alter them after creation to use that plugin. We can check the current plugin in use by querying one of the grant tables (see <a data-type="xref" href="#USR-GRANT-TABLES">“Grant Tables”</a> for more information on these):</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">plugin</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">user</code><code> </code><code class="k">WHERE</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">user</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob'</code><code> </code><code class="k">AND</code><code> </code><code class="n">host</code><code> </code><code class="o">=</code><code> </code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-----------------------+
| plugin                |
+-----------------------+
| caching_sha2_password |
+-----------------------+
1 row in set (0.00 sec)</pre>

<p class="pagebreak-before">And now we can alter the plugin for this user and make sure the change is reflected:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">WITH</code><code> </code><code class="n">mysql_native_password</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">plugin</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">user</code><code> </code><code class="k">WHERE</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="n">user</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob'</code><code> </code><code class="k">AND</code><code> </code><code class="n">host</code><code> </code><code class="o">=</code><code> </code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-----------------------+
| plugin                |
+-----------------------+
| mysql_native_password |
+-----------------------+
1 row in set (0.00 sec)</pre>

<p>Since the change was made via an <code>ALTER</code> command, there’s<a data-type="indexterm" data-primary="FLUSH PRIVILEGES" data-secondary="ALTER command not needing" id="idm46177456733800"/><a data-type="indexterm" data-primary="privileges" data-secondary="FLUSH PRIVILEGES" data-tertiary="ALTER command not needing" id="idm46177456732824"/> no need to run <code>FLUSH</code> 
<span class="keep-together"><code>PRIVILEGES</code></span>. Once this command executes successfully, each new authentication attempt will use the new plugin. You could modify the user record directly to make this change, but again, we recommend against that.</p>

<p>The properties that <code>ALTER USER</code> can modify are pretty numerous and were explained or at least outlined in <a data-type="xref" href="#USR-CREATE">“Creating and Using New Users”</a>. There are, however, some frequently required operations that you should know a bit more about:</p>
<dl>
<dt>Changing a user’s password</dt>
<dd>
<div class="openblock">
<p>This is probably the single most frequent operation that’s ever<a data-type="indexterm" data-primary="ALTER USER" data-secondary="password changed" id="idm46177456711944"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="password changed" id="idm46177456711096"/><a data-type="indexterm" data-primary="passwords" data-secondary="ALTER USER to change" id="idm46177456710008"/> done on a user. Changing a user’s password can be done by another user that has the necessary privileges, or by anyone authorized as that user, using a command like the following:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">by</code><code> </code><code class="s1">'new password'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>This change takes effect immediately, so the next time this user authenticates they’ll need to use the updated password. <a data-type="indexterm" data-primary="SET command" data-secondary="PASSWORD" id="idm46177456686056"/>There’s also a <code>SET PASSWORD</code> shortcut for this command. It can be executed by the authenticated user without any target specification like this:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">PASSWORD</code><code> </code><code class="o">=</code><code> </code><code class="s1">'new password'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>Or it can be executed by another user, with the target specification.</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">PASSWORD</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="o">=</code><code> </code><code class="s1">'new password'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>
</div>

</dd>
<dt>Locking and unlocking a user</dt>
<dd>
<div class="openblock">
<p>If you need to temporarily (or permanently) block access to a<a data-type="indexterm" data-primary="ALTER USER" data-secondary="account locking" id="idm46177456618488"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="account locking" id="idm46177456617512"/><a data-type="indexterm" data-primary="authentication" data-secondary="users connecting" data-tertiary="account locking" id="idm46177456616296"/><a data-type="indexterm" data-primary="connections" data-secondary="users connecting" data-tertiary="account locking" id="idm46177456615080"/> specific user, you can do that using the <code>ACCOUNT LOCK</code> option of <code>ALTER USER</code>. The user in this case is only blocked for authentication. While nobody will be able to connect to MySQL as the blocked user, it can still be used both as a proxy and in a <code>DEFINER</code> clause. That makes such users slightly more secure and easier to manage. The <code>ACCOUNT LOCK</code> can also be used to, for example, block traffic from an application connecting as a specific user that is generating excessive load.</p>

<p>We can block <code>bob</code> from authenticating using the following command:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">ACCOUNT</code><code> </code><code class="k">LOCK</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<p>Only new connections will be affected. The message that MySQL produces in this case is clear:</p>

<pre data-type="programlisting">$ <strong>mysql -ubob -p</strong></pre>

<pre data-type="programlisting">Enter password:
ERROR 3118 (HY000): Access denied for user 'bob'@'localhost'.
Account is locked.</pre>

<p>The counterpart to <code>ACCOUNT LOCK</code> is <code>ACCOUNT UNLOCK</code>. This option to <code>ALTER USER</code> does exactly what it says. Let’s allow access to <code>bob</code> again:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">ACCOUNT</code><code> </code><code class="k">UNLOCK</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>Now the connection attempt will succeed:</p>

<pre data-type="programlisting">$ <strong>mysql -ubob -p</strong></pre>

<pre data-type="programlisting">Enter password:</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code></pre>
</div>

</dd>
<dt>Expiring a user’s password</dt>
<dd>
<div class="openblock">
<p>Instead of blocking a user’s access completely or changing the<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="password change forced" id="idm46177456544776"/><a data-type="indexterm" data-primary="ALTER USER" data-secondary="password change forced" id="idm46177456543608"/><a data-type="indexterm" data-primary="connections" data-secondary="users connecting" data-tertiary="password change forced" id="idm46177456542664"/><a data-type="indexterm" data-primary="passwords" data-secondary="change forced" id="idm46177456541448"/> password for them, you may instead want to force them to change their password. That is possible in MySQL with the <code>PASSWORD EXPIRE</code> option of the <code>ALTER USER</code> command. After this command is executed, the user will still be able to connect to the server using the previous password. However, as soon as they run a query from the new connection—that is, as soon as their privileges are checked—the user will be presented with an error and forced to change the password. Existing connections are not affected.</p>

<p>Let’s see what this looks like for the user. First, the actual alter:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">PASSWORD</code><code> </code><code class="n">EXPIRE</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p class="pagebreak-before">Now, what the user gets. Note the successful authentication:</p>

<pre data-type="programlisting">$ <strong>mysql -ubob -p</strong></pre>

<pre data-type="programlisting">Enter password:</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">id</code><code class="p">,</code><code> </code><code class="n">data</code><code> </code><code class="k">FROM</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1820 (HY000): You must reset your password using ALTER USER
statement before executing this statement.</pre>

<p>Even though the error states you have to run <code>ALTER USER</code>, you <a data-type="indexterm" data-primary="SET command" data-secondary="PASSWORD" id="idm46177456447048"/>now know that you can use <code>SET PASSWORD</code> instead. It also doesn’t matter who changes the password: the user in question or another user. The <code>PASSWORD EXPIRE</code> option just forces the password change. If another user changes the password, then sessions authenticated with the old password after the password has been expired will need to be reopened. As we saw earlier, the authenticated user can change the password without a target specification, and they’ll be able to continue with their session as normal (new connections, however, will need to be authenticated with the new password):</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">PASSWORD</code><code> </code><code class="o">=</code><code> </code><code class="s1">'new password'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.06 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">id</code><code class="p">,</code><code> </code><code class="n">data</code><code> </code><code class="k">FROM</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Empty set (0.00 sec)</pre>

<p>In this case, you should also be aware that without password reuse and history controls in place, the user could just reset the password to the original one.</p>
</div>

</dd>
<dt>Renaming a user</dt>
<dd>
<div class="openblock">
<p>Changing a username is a relatively rare operation, <a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="renaming a user" id="idm46177456371192"/><a data-type="indexterm" data-primary="ALTER USER" data-secondary="renaming a user" id="idm46177456369944"/><a data-type="indexterm" data-primary="names" data-secondary="user@host" data-tertiary="renaming a user" id="idm46177456369000"/><a data-type="indexterm" data-primary="RENAME USER" id="idm46177456367784"/><a data-type="indexterm" data-primary="hostnames" data-secondary="renaming a user" id="idm46177456367112"/>but it is sometimes necessary. This operation has a special command: <code>RENAME USER</code>. It requires the 
<span class="keep-together"><code>CREATE USER</code></span> privilege, or the <code>UPDATE</code> privilege on the <code>mysql</code> database or just the grant tables. There’s no <code>ALTER USER</code> alternative for this command.</p>

<p>You can change both the “name” part of the username and the “host” part. Since, as you know by now, the “host” part acts as a firewall, be cautious when changing it, as you may cause outages (actually, the same is true of the “name” part as well). Let’s rename our <code>bob</code> user to something more formal:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">RENAME</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'robert'</code><code class="o">@</code><code class="s1">'172.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected, 1 warning (0.01 sec)</pre>

<p>When the username changes, MySQL automatically scans through its internal tables to see whether that user has been named in the <code>DEFINER</code> clause of a view or a stored object. Whenever that is the case, a warning is produced. Since we did get a warning when we renamed <code>bob</code>, let’s check it out:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">WARNINGS</code><code class="err">\</code><code class="n">G</code></strong></pre>

<pre data-type="programlisting">*************************** 1. row ***************************
  Level: Warning
   Code: 4005
Message: User 'bob'@'localhost' is referenced as a definer
  account in a stored routine.
1 row in set (0.00 sec)</pre>

<p>Failure to address this issue can potentially result in orphaned objects that will error out when accessed or executed. We discuss this in detail in the next section.<a data-type="indexterm" data-startref="ch08-modu" id="idm46177456304744"/><a data-type="indexterm" data-startref="ch08-modu2" id="idm46177456304104"/></p>
</div>

</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Dropping a User"><div class="sect2" id="idm46177456878696">
<h2>Dropping a User</h2>

<p>The final part of the lifecycle of a database user is its end of life.<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="dropping a user" id="idm46177456302008"/><a data-type="indexterm" data-primary="DROP USER" id="idm46177456299288"/> Like any database object, users can be deleted. In MySQL, the <code>DROP USER</code> command is used to achieve that. This is one of the simplest commands discussed in this chapter, and potentially in the whole book. <code>DROP USER</code> takes a user or, optionally, a list of users as an argument, and has a single modifier: <code>IF NOT EXISTS</code>. <a data-type="indexterm" data-primary="grant tables" data-secondary="dropping a user" id="idm46177456278296"/>Successful execution of the command irrevocably deletes the user-related information from the grant tables (with a caveat we’ll discuss later) and thus prevents further logins.</p>

<p>When you drop a user that has made one or more connections<a data-type="indexterm" data-primary="connections" data-secondary="users connecting" data-tertiary="open connections of dropped user" id="idm46177456276872"/> to the database that are still open, even though the drop succeeds, the associated records will be removed only when the last of those connections ends. The next attempt to connect with the given user will result in the <code>ERROR 1045 (28000): Access denied</code> message.</p>

<p>The <code>IF NOT EXISTS</code> modifier works similarly to with <code>CREATE USER</code>: if the user you target with <code>DROP USER</code> does not exist, no error will be returned. This is useful in unattended scripts. <a data-type="indexterm" data-primary="hostnames" data-secondary="dropping a user" id="idm46177456273144"/>If the host part of the username is not specified, the wildcard <code>%</code> is used by default.</p>

<p>In its most basic form, the <code>DROP USER</code> command looks like this:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">DROP</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'jeff'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<p>Executing the same command again will result in an error:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">DROP</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'jeff'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1396 (HY000): Operation DROP USER failed for 'jeff'@'localhost'</pre>

<p>If you want to construct an idempotent command that won’t fail, then use the following construct instead:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">DROP</code><code> </code><code class="n">USER</code><code> </code><code class="k">IF</code><code> </code><code class="k">EXISTS</code><code> </code><code class="s1">'jeff'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected, 1 warning (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">WARNINGS</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-------+------+-----------------------------------------------------+
| Level | Code | Message                                             |
+-------+------+-----------------------------------------------------+
| Note  | 3162 | Authorization ID 'jeff'@'localhost' does not exist. |
+-------+------+-----------------------------------------------------+
1 row in set (0.01 sec)</pre>

<p>Again, if you do not specify the host part of the username, MySQL will assume the default <code>%</code>. It’s also possible to drop multiple users at once:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">DROP</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'jeff'</code><code class="p">,</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>In MySQL, as users do not own objects, they can be dropped<a data-type="indexterm" data-primary="MySQL" data-secondary="ownership of objects" data-tertiary="dropping a user" id="idm46177456137416"/><a data-type="indexterm" data-primary="ownership of objects" data-secondary="dropping a user" id="idm46177456136200"/><a data-type="indexterm" data-primary="users" data-secondary="ownership of objects" data-tertiary="dropping a user" id="idm46177456135256"/> quite easily and without much preparation. However, as we have already discussed, users can fulfill extra roles. <a data-type="indexterm" data-primary="proxies" data-secondary="dropping users" id="ch08-pdu"/><a data-type="indexterm" data-primary="DEFINER account for access" data-secondary="dropping users" id="ch08-pdu2"/><a data-type="indexterm" data-primary="relationships" data-secondary="dropping users" id="ch08-pdu3"/>If the dropped user is used as a proxy user or is part of the <code>DEFINER</code> clause of some object, then dropping it can create an orphaned record. Whenever the user you drop is part of such a relationship, MySQL emits a warning. Note that the <code>DROP USER</code> command will still succeed, so it’s up to you to resolve the resulting inconsistencies and fix any orphaned records:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">DROP</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected, 1 warning (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">WARNINGS</code><code class="err">\</code><code class="n">G</code></strong></pre>

<pre data-type="programlisting">*************************** 1. row ***************************
  Level: Warning
   Code: 4005
Message: User 'bob'@'localhost' is referenced as a definer
  account in a stored routine.
1 row in set (0.00 sec)</pre>

<p>We recommend that you check this before actually dropping the user. If you fail to notice the warning and take action, the objects are left orphaned. Orphaned objects will produce errors when used:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CALL</code><code> </code><code class="n">test</code><code class="p">.</code><code class="nf">test_proc</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1449 (HY000): The user specified as a definer ('bob'@'localhost')
  does not exist</pre>

<p>For users in a proxy relationship, no warning is produced. However, a subsequent attempt to use the proxied user will result in an error. <a data-type="indexterm" data-primary="authentication" data-secondary="proxy users dropped" id="idm46177456040920"/>As proxy users are used in authentication, the end result will be the inability to log into MySQL with users dependent on the dropped one. This arguably can be more impactful than temporarily losing the ability to call a procedure or query a view, but still, no warning will be emitted. If you are using pluggable authentication relying on proxy users, remember this.</p>

<p>If you find yourself in a situation where you dropped a user and unexpectedly got a warning, you can easily create the user again to avoid the errors. Note how the following <code>CREATE USER</code> statement results in the now-familiar warning:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'new password'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected, 1 warning (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">WARNINGS</code><code class="err">\</code><code class="n">G</code></strong></pre>

<pre data-type="programlisting">*************************** 1. row ***************************
  Level: Warning
   Code: 4005
Message: User 'bob'@'localhost' is referenced as a definer
  account in a stored routine.
1 row in set (0.00 sec)</pre>

<p>However, the problem here is that if you don’t know or remember the initial privileges of the account, the new one can become a security issue.</p>

<p>To identify orphaned records, you need to manually review MySQL’s catalog tables. Specifically, you’re going to need to look at the <code>DEFINER</code> column of the following tables:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">table_schema</code><code class="p">,</code><code> </code><code class="n">table_name</code><code> </code><code class="k">FROM</code><code> </code><code class="n">information_schema</code><code class="p">.</code><code class="n">columns</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">column_name</code><code> </code><code class="o">=</code><code> </code><code class="s1">'DEFINER'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+--------------------+------------+
| TABLE_SCHEMA       | TABLE_NAME |
+--------------------+------------+
| information_schema | EVENTS     |
| information_schema | ROUTINES   |
| information_schema | TRIGGERS   |
| information_schema | VIEWS      |
+--------------------+------------+</pre>

<p>Now that you know that, you can easily construct a query to<a data-type="indexterm" data-primary="DEFINER account for access" data-secondary="dropping users" data-tertiary="query to check user" id="idm46177455924744"/><a data-type="indexterm" data-primary="queries" data-secondary="user in any DEFINER clauses" id="idm46177455923560"/> check if a user you’re going to drop or have already dropped is specified within any <code>DEFINER</code> clauses:</p>

<pre data-type="programlisting" data-code-language="mysql"><strong><code class="k">SELECT</code><code> </code><code class="n">EVENT_SCHEMA</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_schema</code><code>
    </code><code class="p">,</code><code> </code><code class="n">EVENT_NAME</code><code> </code><code class="n">obj_name</code><code>
    </code><code class="p">,</code><code> </code><code class="s1">'EVENT'</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_type</code><code>
</code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">EVENTS</code><code>
</code><code class="k">WHERE</code><code> </code><code class="n">DEFINER</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob@localhost'</code><code>
</code><code class="k">UNION</code><code>
</code><code class="k">SELECT</code><code> </code><code class="n">ROUTINE_SCHEMA</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_schema</code><code>
    </code><code class="p">,</code><code> </code><code class="n">ROUTINE_NAME</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_name</code><code>
    </code><code class="p">,</code><code> </code><code class="n">ROUTINE_TYPE</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_type</code><code>
</code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">ROUTINES</code><code>
</code><code class="k">WHERE</code><code> </code><code class="n">DEFINER</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob@localhost'</code><code>
</code><code class="k">UNION</code><code>
</code><code class="k">SELECT</code><code> </code><code class="n">TRIGGER_SCHEMA</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_schema</code><code>
    </code><code class="p">,</code><code> </code><code class="n">TRIGGER_NAME</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_name</code><code>
    </code><code class="p">,</code><code> </code><code class="s1">'TRIGGER'</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_type</code><code>
</code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">TRIGGERS</code><code>
</code><code class="k">WHERE</code><code> </code><code class="n">DEFINER</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob@localhost'</code><code>
</code><code class="k">UNION</code><code>
</code><code class="k">SELECT</code><code> </code><code class="n">TABLE_SCHEMA</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_scmea</code><code>
    </code><code class="p">,</code><code> </code><code class="n">TABLE_NAME</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_name</code><code>
    </code><code class="p">,</code><code> </code><code class="s1">'VIEW'</code><code> </code><code class="k">AS</code><code> </code><code class="n">obj_type</code><code>
</code><code class="k">FROM</code><code> </code><code class="n">INFORMATION_SCHEMA</code><code class="p">.</code><code class="n">VIEWS</code><code>
</code><code class="k">WHERE</code><code> </code><code class="n">DEFINER</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob@localhost'</code><code class="p">;</code></strong></pre>

<p>That query might look intimidating, but by now you should’ve seen <code>UNION</code> used in <a data-type="xref" href="ch05.xhtml#ADV1-SEC-UNION">“The Union”</a>, and the query is just a union of four simple queries. Each individual query looks for an object with a <code>DEFINER</code> value of <code>bob@localhost</code> in one of the following tables: <code>EVENTS</code>, <code>ROUTINES</code>, <code>TRIGGERS</code>, and <code>VIEWS</code>.</p>

<p>In our example, the query returns a single record for <code>bob@localhost</code>:</p>

<pre data-type="programlisting">+------------+-----------+-----------+
| obj_schema | obj_name  | obj_type  |
+------------+-----------+-----------+
| test       | test_proc | PROCEDURE |
+------------+-----------+-----------+</pre>

<p>It’s similarly easy to check if the proxy privilege was granted for this user:<a data-type="indexterm" data-primary="proxies" data-secondary="dropping users" data-tertiary="query to check" id="idm46177455603272"/><a data-type="indexterm" data-primary="queries" data-secondary="user granted proxy privilege" id="idm46177455608648"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">user</code><code class="p">,</code><code> </code><code class="n">host</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">proxies_priv</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WHERE</code><code> </code><code class="n">proxied_user</code><code> </code><code class="o">=</code><code> </code><code class="s1">'bob'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">AND</code><code> </code><code class="n">proxied_host</code><code> </code><code class="o">=</code><code> </code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+------+------+
| user | host |
+------+------+
| jeff | %    |
+------+------+</pre>

<p>We recommend that you always check for possible orphaned objects and proxy privileges before you drop a particular user. Such gaps left in the database will not only cause obvious issues (errors) but are, in fact, a security risk.<a data-type="indexterm" data-startref="ch08-pdu" id="idm46177455649736"/><a data-type="indexterm" data-startref="ch08-pdu2" id="idm46177455658440"/><a data-type="indexterm" data-startref="ch08-pdu3" id="idm46177455657768"/><a data-type="indexterm" data-startref="ch08-man" id="idm46177455657096"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Privileges"><div class="sect1" id="USR-PRIVS">
<h1>Privileges</h1>

<p>When a user connects to a MySQL server, authentication is<a data-type="indexterm" data-primary="privileges" data-secondary="about" id="idm46177455681608"/><a data-type="indexterm" data-primary="users" data-secondary="privileges" data-seealso="privileges" id="idm46177455680632"/> performed using the username and host information, as explained before. However, the permissions the user has to perform different actions aren’t checked before any commands are executed. MySQL grants privileges according to the identity of the connected user and the actions it performs. As discussed at the beginning of this chapter, privileges are sets of permissions to perform actions on various objects. <a data-type="indexterm" data-primary="CREATE USER" data-secondary="privileges after" id="idm46177455660488"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="privileges after create" id="idm46177455659544"/>By default, a user is not entitled to any permissions, and thus it has no privileges assigned after <code>CREATE USER</code> is executed.</p>

<p>There are a lot of privileges that you can grant to a user and later revoke. For example, you can allow a user to read from a table or modify data in it. You can grant a privilege to create tables and databases, and another to create stored procedures. The list is vast. <a data-type="indexterm" data-primary="connections" data-secondary="always allowed" id="idm46177455668008"/><a data-type="indexterm" data-primary="authentication" data-secondary="privileges after" id="idm46177455667064"/>Curiously, you will not find a connection privilege anywhere: it’s impossible to disallow a user from connecting to MySQL, assuming the host part of username matches. That’s a direct consequence of what was outlined in the previous paragraph: privileges are checked only when an action is performed, so by nature they will apply only once a user is authenticated.</p>

<p>To get a full list of privileges supported and provided by your MySQL installation, we always recommend checking the manual. However, we’ll cover the few broad categories of privileges here. We’ll also talk about levels of privileges, as the same privileges can be allowed on multiple levels. Actually, that’s what we’ll start with. There are four levels of privileges in MySQL:</p>
<dl>
<dt>Global privileges</dt>
<dd>
<p>These privileges allow the <em>grantee</em> (the user who is granted the privilege—we cover the <code>GRANT</code> command in<a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="global" id="idm46177455679352"/><a data-type="indexterm" data-primary="global privileges" id="idm46177455678072"/> <a data-type="xref" href="#USR-PRIV-MGMT">“Privilege Management Commands”</a>) to either act on every object in every database or act on the cluster as a whole. The latter applies to commands that are usually considered administrative. For example, you can allow a user to shut down the cluster.</p>

<p>Privileges in this category are stored within the tables<a data-type="indexterm" data-primary="mysql.user table" id="idm46177455672056"/><a data-type="indexterm" data-primary="mysql.global_grants table" id="idm46177455676760"/><a data-type="indexterm" data-primary="privileges" data-secondary="static" data-tertiary="grant table" id="idm46177455676120"/><a data-type="indexterm" data-primary="privileges" data-secondary="dynamic" data-tertiary="grant table" id="idm46177455674904"/><a data-type="indexterm" data-primary="dynamic privileges" data-secondary="grant table" id="idm46177455903240"/><a data-type="indexterm" data-primary="static privileges" data-secondary="grant table" id="idm46177455902296"/><a data-type="indexterm" data-primary="grant tables" data-secondary="privilege levels" id="idm46177455686408"/> <code>mysql.user</code> and <code>mysql.global_grants</code>. The first one stores conventional static privileges, and the second one stores dynamic privileges. The difference is explained in the following section. MySQL versions prior to 8.0 store all global privileges in <code>mysql.user</code>.</p>
</dd>
<dt>Database privileges</dt>
<dd>
<p>Privileges granted on a database level will allow the user to act<a data-type="indexterm" data-primary="database privileges" id="idm46177455688168"/><a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="database" id="idm46177455687464"/><a data-type="indexterm" data-primary="object privileges" id="idm46177455692136"/> upon objects within that database. As you can imagine, the list of privileges is narrower at this level, since there’s little sense in breaking down the <code>SHUTDOWN</code> privilege below the global level, for example. Records for these privileges are stored within the <code>mysql.db</code> table and include the ability to run DDL and DML queries within the target database.</p>
</dd>
<dt>Object privileges</dt>
<dd>
<p>A logical continuation of database-level privileges, these target<a data-type="indexterm" data-primary="object privileges" id="idm46177455694664"/><a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="object" id="idm46177455693960"/> a particular object. Tracked in <code>mysql.tables_priv</code>, <code>mysql.procs_priv</code>, and <code>mysql.proxies_priv</code>, they respectively cover tables and views, all types of stored routines, and finally the proxy user permissions. Proxy privileges are special, but the other privileges in this category are again regular DDL and DML permissions.</p>
</dd>
<dt>Column privileges</dt>
<dd>
<p>Stored in <code>mysql.columns_priv</code>, these are an interesting set of<a data-type="indexterm" data-primary="privileges" data-secondary="column privileges" id="idm46177455720696"/><a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="column" id="idm46177455719720"/><a data-type="indexterm" data-primary="columns" data-secondary="column privileges" id="idm46177455701688"/> privileges. You can separate permissions within a particular table by column. For example, a reporting user may not have the need to read the <code>password</code> column of a particular table. This is a powerful tool, but column privileges can be difficult to manage and maintain.</p>
</dd>
</dl>

<p>The complete list of privileges, frankly, is very long. It is always<a data-type="indexterm" data-primary="privileges" data-secondary="levels of" id="idm46177455705336"/> advisable to consult the MySQL documentation for your particular version for the complete details. You should remember that any action a user can perform either will have a dedicated privilege assigned or will be covered by a privilege controlling a wider range of behaviors. In general, database- and object-level privileges will have a dedicated privilege name that you can grant (<code>UPDATE</code>, <code>SELECT</code>, and so on), and global privileges will be quite broadly grouped together, allowing multiple actions at once. For example, the <code>GROUP_REPLICATION_ADMIN</code> privilege allows five different actions at once. Global privileges will also usually be granted on a system level (the <strong><code>.</code></strong> object).</p>

<p>You can always access the list of privileges available in your MySQL instance by running the <code>SHOW PRIVILEGES</code> command:<a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="SHOW PRIVILEGES" id="idm46177455710232"/><a data-type="indexterm" data-primary="SHOW" data-secondary="PRIVILEGES" id="idm46177455920568"/><a data-type="indexterm" data-primary="privileges" data-secondary="SHOW PRIVILEGES" id="idm46177455919624"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">PRIVILEGES</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------------+----------------------+--------------------+
| Privilege                  | Context              | Comment            |
+----------------------------+----------------------+--------------------+
| Alter                      | Tables               | To alter the table |
| Alter routine              | Functions,Procedures | ...                |
| ...                                                                    |
| REPLICATION_SLAVE_ADMIN    | Server Admin         |                    |
| AUDIT_ADMIN                | Server Admin         |                    |
+----------------------------+----------------------+--------------------+
58 rows in set (0.00 sec)</pre>








<section data-type="sect2" data-pdf-bookmark="Static Versus Dynamic Privileges"><div class="sect2" id="USR-PRIVS-STAT-DYNAMIC">
<h2>Static Versus Dynamic Privileges</h2>

<p>Before we go on to review the commands used to manage privileges in MySQL, <a data-type="indexterm" data-primary="privileges" data-secondary="static" id="idm46177455723000"/><a data-type="indexterm" data-primary="static privileges" id="idm46177455759960"/><a data-type="indexterm" data-primary="privileges" data-secondary="dynamic" id="idm46177455759288"/><a data-type="indexterm" data-primary="dynamic privileges" id="idm46177455758344"/>we must pause and talk about an important distinction. There are two types of privileges in MySQL, starting with version 8.0: static and dynamic. The <em>static</em> privileges are built into the server, and every installation will have them available and usable. The <em>dynamic</em> privileges are, on the other hand, “volatile”: they are not guaranteed to be present all the time.</p>

<p>What are these dynamic privileges? They are privileges that are registered within the server at runtime. Only registered privileges can be granted, so it is possible that some privileges will never be registered and will never be grantable. All of that is a fancy way of saying that it’s now possible to extend privileges via plugins and components. <a data-type="indexterm" data-primary="MySQL Community Edition" data-secondary="dynamic privileges" id="idm46177455726840"/>However, most of the dynamic privileges currently available are registered by default in a regular Community Server installation.</p>

<p>The important role of the dynamic privileges provided with MySQL 8.0 is that <a data-type="indexterm" data-primary="privileges" data-secondary="dynamic" data-tertiary="SUPER avoided with" id="idm46177455731512"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="dynamic instead" id="idm46177455730264"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="dynamic instead" id="idm46177455735400"/><a data-type="indexterm" data-primary="dynamic privileges" data-secondary="SUPER avoided with" id="idm46177455734456"/>they are aimed at reducing the necessity of using the <code>SUPER</code> privilege, which was previously abused (we’ll talk about this privilege in the next section). The other distinction of dynamic privileges is that they usually control a set of activities users can perform. For example, unlike a direct <code>SELECT</code> privilege on a table, which just allows querying the data, <a data-type="indexterm" data-primary="CONNECTION_ADMIN privilege" id="idm46177455738920"/><a data-type="indexterm" data-primary="privileges" data-secondary="CONNECTION_ADMIN privilege" id="idm46177455738248"/>the <code>CONNECTION_ADMIN</code> privilege allows a whole list of actions. In this particular example, that includes killing other accounts’ connections, updating data in a read-only server, connecting through an extra connection when the limit is reached, and more. You can easily spot the difference.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The SUPER Privilege"><div class="sect2" id="USR-PRIV-SUPER">
<h2>The SUPER Privilege</h2>

<p>This section is not long, but it is important. We mentioned<a data-type="indexterm" data-primary="SUPER privilege" id="idm46177455741016"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" id="idm46177455740312"/> in <a data-type="xref" href="#USR-ROOT">“The root User”</a> that there’s a superuser created by default with every MySQL installation: <code>root@localhost</code>. Sometimes you might want to provide the same capabilities to another user, for example one used by a DBA. The convenient built-in way of doing so is by using the special <code>SUPER</code> privilege.</p>

<p><code>SUPER</code> is basically a catchall privilege that turns <a data-type="indexterm" data-primary="users" data-secondary="superusers via SUPER" data-seealso="privileges" id="idm46177455743416"/>a user to which it is assigned into a superuser. As with any privilege, it can be assigned via a <code>GRANT</code> statement, which we’ll review in the following section.</p>

<p>There are two huge problems with the <code>SUPER</code> privilege,<a data-type="indexterm" data-primary="SUPER privilege" data-secondary="deprecated" id="idm46177455747272"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="deprecated" id="idm46177455753144"/><a data-type="indexterm" data-primary="security" data-secondary="SUPER users" id="idm46177455751928"/> however. First, starting with MySQL 8.0 it is deprecated, and it is going to be removed in a future release of MySQL. Second, it is a security and operational nightmare. The first point is clear, so let’s talk about the second one, and about the alternatives we have.</p>

<p>Using the <code>SUPER</code> privilege poses the same risks and results in the same issues as using the default <code>root@localhost</code> user. Instead of carefully inspecting the scope of privileges required, we’re resorting to using an all-purpose hammer to solve all problems. The main problem with <code>SUPER</code> is its all-encompassing scope. When you create a superuser, you create a liability: the user must be restricted and ideally audited, and operators and programs authenticating as the user must be extremely precise and careful in their actions. With great power comes great responsibility—and, among other things, the ability to just outright shut down the MySQL instance. Imagine executing that by mistake.</p>

<p>In MySQL versions before 8.0, it’s not feasible to avoid using the <code>SUPER</code> privilege, as there are no alternatives provided for some of the permissions. <a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="dynamic instead" id="idm46177455764280"/><a data-type="indexterm" data-primary="privileges" data-secondary="dynamic" data-tertiary="SUPER avoided with" id="idm46177455763144"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="dynamic instead" id="idm46177455761928"/><a data-type="indexterm" data-primary="dynamic privileges" data-secondary="SUPER avoided with" id="idm46177455798120"/>Starting with version 8.0, which deprecates <code>SUPER</code>, MySQL provides a whole set of dynamic privileges that are aimed at removing the need for the single catchall privilege. You should try to avoid using the <code>SUPER</code> privilege, if possible.</p>

<p>Consider the example of a user that needs to control group replication.<a data-type="indexterm" data-primary="replication" data-secondary="privilege for" id="idm46177455795784"/> In MySQL 5.7, you would need to grant the <code>SUPER</code> privilege to that user. Starting with version 8.0, however, you can instead grant the special <code>GROUP_REPLICATION_ADMIN</code> privilege, which only allows users to perform a very small subset of actions related to group replication.</p>

<p>Sometimes, you will still need a full-on DBA user that can do anything. <a data-type="indexterm" data-primary="users" data-secondary="root@localhost in MySQL" data-tertiary="SUPER avoided with" id="idm46177455773464"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="root@locahost instead" id="idm46177455767992"/><a data-type="indexterm" data-primary="root user in MySQL" data-secondary="root@localhost" data-tertiary="SUPER avoided with" id="idm46177455767048"/>Instead of granting <code>SUPER</code>, consider looking at the <code>root@localhost</code> privileges and copying them instead. We show you how to do that in <a data-type="xref" href="#USR-PRIVS-CHECK">“Checking Privileges”</a>. <a data-type="indexterm" data-primary="INNODB_REDO_LOG_ENABLE unsafe" id="idm46177455770936"/>Taking this further, you can skip granting some of the privileges, such as the <code>INNODB_REDO_LOG_ENABLE</code> privilege, which authorizes a user to basically enable a crash-unsafe mode. It is much safer to not have that privilege granted at all, and to be able to grant it to yourself when absolutely required, than to open up the risk of someone running that statement by mistake.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Privilege Management Commands"><div class="sect2" id="USR-PRIV-MGMT">
<h2>Privilege Management Commands</h2>

<p>Now that you know a bit about privileges, we can proceed to the basic commands that allow you to control them. You can never <code>ALTER</code> a privilege itself, though, so by controlling privileges here we mean giving them to and removing them from users.  These actions are achieved with the <code>GRANT</code> and <code>REVOKE</code> statements.<a data-type="indexterm" data-primary="ALTER USER" data-secondary="privileges need GRANT or REVOKE" id="idm46177455776984"/></p>










<section data-type="sect3" data-pdf-bookmark="GRANT"><div class="sect3" id="idm46177455783112">
<h3>GRANT</h3>

<p>The <code>GRANT</code> statement is used to grant users (or roles)<a data-type="indexterm" data-primary="GRANT" id="ch08-gra2"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" id="ch08-gra"/> permissions to perform activities, either in general or on specific objects. The same statement can also be used to assign roles to users, but you cannot at the same time alter permissions and assign roles. To be able to grant a permission (privilege), you need to have that privilege assigned yourself and <a data-type="indexterm" data-primary="GRANT" data-secondary="GRANT OPTION privilege" id="idm46177455784808"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="GRANT OPTION privilege" id="idm46177455783864"/>have the special <code>GRANT OPTION</code> privilege (we’ll review that later). <a data-type="indexterm" data-primary="SUPER privilege" data-secondary="granting anything" id="idm46177455789352"/><a data-type="indexterm" data-primary="CONNECTION_ADMIN privilege" data-secondary="granting anything" id="idm46177455788376"/><a data-type="indexterm" data-primary="privileges" data-secondary="CONNECTION_ADMIN privilege" data-tertiary="granting anything" id="idm46177455794584"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="granting anything" id="idm46177455793400"/>Users with the <code>SUPER</code> (or newer <code>CONNECTION_ADMIN</code>) privilege can grant anything, and there’s a special condition related to grant tables, which we’ll discuss shortly.</p>

<p>For now, let’s check out the basic structure of a <code>GRANT</code> statement:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">app_db</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.01 sec)</pre>

<p>That statement, once executed, tells MySQL that user <code>'john'@'192.168.%'</code> is allowed to perform read-only queries (<code>SELECT</code>) on any table in the <code>app_db</code> database. Note that we have used a wildcard in the object specification. We could allow a particular user access to every table of every database by specifying a wildcard for the database as well:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="o">*</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'john'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.01 sec)</pre>

<p>The preceding invocation notably lacks the host specification for the user <code>'john'</code>. <a data-type="indexterm" data-primary="names" data-secondary="user@host" data-tertiary="wildcards" id="idm46177455841352"/><a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="user@hostname wildcards" id="idm46177455840104"/><a data-type="indexterm" data-primary="wildcard (%)" data-secondary="user hostnames" id="idm46177455854936"/><a data-type="indexterm" data-primary="% (wildcard)" data-secondary="user hostnames" data-primary-sortas="#wildcard" id="idm46177455853992"/><a data-type="indexterm" data-primary="hostnames" data-secondary="creating new user" data-tertiary="wildcard in hostname" id="idm46177455852776"/>This shortcut translates to <code>'john'@'%'</code>; thus, it will not be the same user as the <code>'john'@'192.168.%'</code> we used before. Speaking of wildcards and users, <a data-type="indexterm" data-primary="wildcard (%)" data-secondary="username" id="idm46177455858280"/><a data-type="indexterm" data-primary="% (wildcard)" data-secondary="usernames" data-primary-sortas="#wildcard" id="idm46177455857304"/>it is not <span class="keep-together">possible</span> to specify a wildcard for the username portion of the user. Instead, you can specify multiple users or roles in one go like this:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">app_db</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s1">'kate'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.06 sec)</pre>

<p>We cautioned you about granting too many privileges in the<a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="ALL" id="idm46177455887256"/><a data-type="indexterm" data-primary="GRANT" data-secondary="ALL" id="idm46177455886104"/><a data-type="indexterm" data-primary="users" data-secondary="“owner” users granted all privileges" data-secondary-sortas="owner users granted" id="idm46177455898392"/> previous section, but it can be useful to remember that there’s an <code>ALL</code> shortcut that allows you to grant every possible privilege on an object or set of objects. That can come handy when you define permissions for the “owner” user—for example, a read/write application user:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">ALL</code><code> </code><code class="k">ON</code><code> </code><code class="n">app_db</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'app_db_user'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 row affected (0.06 sec)</pre>

<p>You cannot chain object specifications, so you won’t be able to grant the <code>SELECT</code> privilege on two tables at once, unless that statement can be expressed using wildcards. As you’ll see in the next section, you can combine wildcard grants and specific revokes for extra flexibility.</p>

<p>An interesting property of the <code>GRANT</code> command is <a data-type="indexterm" data-primary="GRANT" data-secondary="wildcards stay wildcards" id="idm46177455403528"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="wildcards stay wildcards" id="idm46177455402680"/>that it doesn’t check for the presence of the objects that you allow. That is, a wildcard is not expanded, but stays a wildcard forever. No matter how many new tables are added to the <code>app_db</code> database, both <code>john</code> and <code>kate</code> will be able to issue <code>SELECT</code> statements on them. Earlier versions of MySQL also would create a user to whom privileges were granted if it wasn’t found in the <code>mysql.user</code> table, but that behavior is deprecated starting with MySQL 8.0.</p>

<p>As we discussed in depth in <a data-type="xref" href="#USR-GRANT-TABLES">“Grant Tables”</a> <a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="grant tables" id="idm46177455397368"/><a data-type="indexterm" data-primary="GRANT" data-secondary="grant tables" id="idm46177455375048"/><a data-type="indexterm" data-primary="privileges" data-secondary="UPDATE privilege" id="idm46177455374200"/><a data-type="indexterm" data-primary="UPDATE" data-secondary="privilege" id="idm46177455373352"/>the <code>GRANT</code> statement updates grant tables. One thing that follows from the fact that there’s an update on grant tables is that if a user has the <code>UPDATE</code> privilege on those tables, that user can grant any account any privilege. Be extremely careful with permissions on objects in the <code>mysql</code> database: there’s little benefit to granting users any privileges there. <a data-type="indexterm" data-primary="system variables" data-secondary="read_only" id="idm46177455370920"/><a data-type="indexterm" data-primary="read_only system variable" id="idm46177455370072"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="read_only system variable" id="idm46177455369464"/><a data-type="indexterm" data-primary="CONNECTION_ADMIN privilege" data-secondary="read_only system variable" id="idm46177455368616"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="read_only system variable" id="idm46177455367768"/><a data-type="indexterm" data-primary="privileges" data-secondary="CONNECTION_ADMIN privilege" data-tertiary="read_only system variable" id="idm46177455366680"/>Note also that when the <code>read_only</code> system variable is enabled, any grant requires super user privileges (<code>SUPER</code> or <code>CONNECTION_ADMIN</code>).</p>

<p>There are a few other points we’d like to make about <code>GRANT</code> before moving on. In the introduction to this section, we mentioned <a data-type="indexterm" data-primary="privileges" data-secondary="levels of" data-tertiary="column" id="idm46177455363800"/><a data-type="indexterm" data-primary="columns" data-secondary="column privileges" id="idm46177455362712"/>column privileges. This set of privileges controls whether a user can read and update data in a particular column of a table. Like all other privileges, they can be permitted using the <code>GRANT</code> command:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code class="p">(</code><code class="n">id</code><code class="p">)</code><code class="p">,</code><code> </code><code class="k">INSERT</code><code class="p">(</code><code class="n">id</code><code class="p">,</code><code> </code><code class="n">data</code><code class="p">)</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">ON</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'kate'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>The user <code>kate</code> will now be able to issue the statement <code>SELECT id</code> <code>FROM</code> 
<span class="keep-together"><code>bobs_db.bobs_private_table</code></span>, but not <code>SELECT *</code> or <code>SELECT data</code>.</p>

<p>Finally, you can grant every static privilege on a particular<a data-type="indexterm" data-primary="static privileges" data-secondary="GRANT ALL PRIVILEGES" id="idm46177455320744"/><a data-type="indexterm" data-primary="privileges" data-secondary="static" data-tertiary="GRANT ALL PRIVILEGES" id="idm46177455319768"/><a data-type="indexterm" data-primary="GRANT" data-secondary="ALL PRIVILEGES" id="idm46177455318552"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="ALL PRIVILEGES" id="idm46177455317608"/> object, or globally, by running <code>GRANT ALL PRIVILEGES</code> instead of specifying each privilege in turn. <code>ALL PRIVILEGES</code> is just a shorthand and is not itself a special privilege, unlike <code>SUPER</code>, for example.<a data-type="indexterm" data-startref="ch08-gra" id="idm46177455299448"/><a data-type="indexterm" data-startref="ch08-gra2" id="idm46177455298952"/></p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="REVOKE"><div class="sect3" id="idm46177455782200">
<h3>REVOKE</h3>

<p>The <code>REVOKE</code> statement is the opposite of the <code>GRANT</code> statement:<a data-type="indexterm" data-primary="REVOKE" id="idm46177455296248"/><a data-type="indexterm" data-primary="privileges" data-secondary="REVOKE" id="idm46177455295640"/> you can use it to revoke privileges and roles assigned using <code>GRANT</code>. Unless otherwise specified, every property of <code>GRANT</code> applies to <code>REVOKE</code>. <a data-type="indexterm" data-primary="REVOKE" data-secondary="GRANT OPTION privilege for" id="idm46177455293512"/><a data-type="indexterm" data-primary="privileges" data-secondary="REVOKE" data-tertiary="GRANT OPTION privilege for" id="idm46177455292664"/>For example, to revoke privileges you need to have the <code>GRANT OPTION</code> privilege and the particular privileges that you are revoking.</p>

<p>Starting with MySQL version 8.0.16, it’s possible to revoke privileges for particular schemas from users that have privileges granted globally. That makes it possible to easily restrict access to some databases while allowing access to all others, including ones that are newly created. For example, consider a database system where you have a single restricted schema. You need to create a user for your BI application. You start by running the usual command:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="o">*</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bi_app_user'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.03 sec)</pre>

<p>However, this user has to be forbidden from querying any data in the restricted database. This is extremely easy to set up using partial revokes:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">REVOKE</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">restricted_database</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="s1">'bi_app_user'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.03 sec)</pre>

<p>Before version 8.0.16 to achieve this you would need to fall back to explicitly running <code>GRANT SELECT</code> for each individual allowed schema.</p>

<p>Just as you can grant all privileges, a special invocation of <code>REVOKE</code> exists<a data-type="indexterm" data-primary="REVOKE" data-secondary="ALL PRIVILEGES" id="idm46177455230744"/><a data-type="indexterm" data-primary="privileges" data-secondary="REVOKE" data-tertiary="ALL PRIVILEGES" id="idm46177455229736"/> that allows the removal of all privileges from a particular user. Remember that you need to have all the privileges you are revoking, and thus this option is likely to be used only by an administrative user. The following statement will strip a user of their privileges, including the ability to assign any privileges:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">REVOKE</code><code> </code><code class="k">ALL</code><code> </code><code class="n">PRIVILEGES</code><code class="p">,</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code> </code><code class="k">FROM</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.03 sec)</pre>

<p>The <code>REVOKE</code> statement doesn’t under any circumstances remove the user itself. You can use the <code>DROP USER</code> statement for that, as described earlier in this chapter.</p>
</div></section>



</div></section>













<section data-type="sect2" class="less_space pagebreak-before" data-pdf-bookmark="Checking Privileges"><div class="sect2" id="USR-PRIVS-CHECK">
<h2>Checking Privileges</h2>

<p>An important part of managing privileges is reviewing<a data-type="indexterm" data-primary="privileges" data-secondary="checking" id="idm46177455187032"/> them—but it would be impossible to remember every privilege granted to every user. You can query the grant tables to see what users have what privileges, but that’s not always convenient. (It is still an option, however, and it can be a good way to find, for example, every user that has write privileges on a certain table.) <a data-type="indexterm" data-primary="SHOW" data-secondary="GRANTS" id="idm46177455185576"/><a data-type="indexterm" data-primary="GRANT" data-secondary="SHOW GRANTS" id="idm46177455184632"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="SHOW GRANTS" id="idm46177455183688"/>The more straightforward option for viewing the privileges granted to a particular user is to use the built-in <code>SHOW GRANTS</code> command. Let’s take a look at it:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+--------------------------------------------------+
| Grants for john@192.168.%                        |
+--------------------------------------------------+
| GRANT UPDATE ON *.* TO `john`@`192.168.%`        |
| GRANT SELECT ON `sakila`.* TO `john`@`192.168.%` |
+--------------------------------------------------+
2 rows in set (0.00 sec)</pre>

<p>In general, you can expect to see every privilege in this output, but there’s a special case. <a data-type="indexterm" data-primary="static privileges" data-secondary="SHOW GRANTS" id="idm46177455157224"/><a data-type="indexterm" data-primary="privileges" data-secondary="static" data-tertiary="SHOW GRANTS" id="idm46177455156280"/>When a user has every static privilege granted for a particular object, instead of listing each and every one of them, MySQL will output <code>ALL PRIVILEGES</code> instead. This is not a special privilege itself, but rather a shorthand for every possible privilege. Internally, <code>ALL PRIVILEGES</code> just translates to <code>Y</code> set for every privilege in the respective grant table:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------------------------------------------+
| Grants for bob@localhost                                 |
+----------------------------------------------------------+
...
| GRANT ALL PRIVILEGES ON `bobs_db`.* TO `bob`@`localhost` |
...</pre>

<p>You can also view the permissions granted to roles using the <code>SHOW GRANTS</code> command, but we’ll talk about that in more detail in <a data-type="xref" href="#USR-SEC-ROLES">“Roles”</a>. To review the permissions of the currently authenticated and authorized user, you can use any of the following statements, which are synonymous:</p>

<pre data-type="programlisting" data-code-language="mysql"><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code class="p">;</code></strong><code>
</code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="k">CURRENT_USER</code><code class="p">;</code></strong><code>
</code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="k">CURRENT_USER</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<p class="pagebreak-before">Whenever you do not remember what a specific privilege means, you can either consult the documentation or <a data-type="indexterm" data-primary="SHOW" data-secondary="PRIVILEGES" id="idm46177455080840"/><a data-type="indexterm" data-primary="privileges" data-secondary="SHOW PRIVILEGES" id="idm46177455079928"/>run the <code>SHOW PRIVILEGES</code> command, which will list every privilege currently available. That covers both static object privileges and dynamic server privileges.</p>

<p>Sometimes you might need to review privileges related to all accounts or transfer those privileges to another system. <a data-type="indexterm" data-primary="privileges" data-secondary="transferring or reviewing all" id="idm46177455077528"/><a data-type="indexterm" data-primary="grant tables" data-secondary="mysqldump" id="idm46177455076584"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" data-tertiary="mysqldump" id="idm46177455075640"/><a data-type="indexterm" data-primary="mysqldump" data-secondary="grant tables" id="idm46177455074424"/><a data-type="indexterm" data-primary="privileges" data-secondary="checking" data-tertiary="mysqldump" id="idm46177455073480"/>One option that you have is to use the <code>mysqldump</code> command provided with MySQL Server for all supported platforms. We will be reviewing that command in detail in <a data-type="xref" href="ch10.xhtml#CH10_BACKUP">Chapter 10</a>. In short, you’ll need to dump all of the grant tables, as otherwise you might miss some of the permissions. The safest way to go is to dump all of the data in the <code>mysql</code> database:</p>

<pre data-type="programlisting">$ <strong>mysqldump -uroot -p mysql</strong></pre>

<pre data-type="programlisting">Enter password:</pre>

<p>The output will include all the table definitions, along with a lot of <code>INSERT</code> statements. This output can be redirected to a file and then used to seed a new database. We talk more about that in <a data-type="xref" href="ch10.xhtml#CH10_BACKUP">Chapter 10</a>. If your server versions don’t match or the target server already has some users and privileges stored, it might be best to avoid dropping the existing objects. Add the <code>--no-create-info</code> option to the <code>mysqldump</code> invocation to only receive the <code>INSERT</code> statements.</p>

<p>By using <code>mysqldump</code> you get a portable list of users and<a data-type="indexterm" data-primary="users" data-secondary="mysqldump" id="idm46177455043288"/> privileges, but it’s not exactly easily readable. Here is an example of some of the rows in the output:</p>

<pre data-type="programlisting">--
-- Dumping data for table `tables_priv`
--

LOCK TABLES `tables_priv` WRITE;
/*!40000 ALTER TABLE `tables_priv` DISABLE KEYS */;
INSERT INTO `tables_priv` VALUES ('172.%','sakila','robert'...
'Select,Insert,Update,Delete,Create,Drop,Grant,References,...
('localhost','sys','mysql.sys','sys_config','root@localhost'
    '2020-07-13 07:14:57','Select','');
/*!40000 ALTER TABLE `tables_priv` ENABLE KEYS */;
UNLOCK TABLES;</pre>

<p>Another option to review the privileges would be to write custom queries over grant tables, as already mentioned. We won’t give any guidelines on that, as there’s no one-size-fits-all solution.</p>

<p>Yet another way is by running <code>SHOW GRANTS</code> for every user in the database. <a data-type="indexterm" data-primary="users" data-secondary="creating new" data-tertiary="re-creating for another system" id="idm46177455039448"/><a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="re-creating for another system" id="idm46177455038232"/>By combining that with the <code>SHOW CREATE USER</code> statement, you can generate the list of privileges, which can also be used to re-create the users and their privileges in another database:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="nf">CONCAT</code><code class="p">(</code><code class="s2">"SHOW GRANTS FOR `"</code><code class="p">,</code><code> </code><code class="n">user</code><code class="p">,</code><code> </code><code class="s2">"`@`"</code><code class="p">,</code><code> </code><code class="n">host</code><code class="p">,</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="s2">"`; SHOW CREATE USER `"</code><code class="p">,</code><code> </code><code class="n">user</code><code class="p">,</code><code> </code><code class="s2">"`@`"</code><code class="p">,</code><code> </code><code class="n">host</code><code class="p">,</code><code> </code><code class="s2">"`;"</code><code class="p">)</code><code> </code><code class="n">grants</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">user</code><code> </code><code class="k">WHERE</code><code> </code><code class="n">user</code><code> </code><code class="o">=</code><code> </code><code class="s2">"bob"</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------------------------------------------------+
| grants                                                         |
+----------------------------------------------------------------+
| SHOW GRANTS FOR bob@%; SHOW CREATE USER bob@%;                 |
| SHOW GRANTS FOR bob@localhost; SHOW CREATE USER bob@localhost; |
+----------------------------------------------------------------+
2 rows in set (0.00 sec)</pre>

<p>As you can imagine, the idea of automating this procedure is<a data-type="indexterm" data-primary="Percona Toolkit" data-secondary="user re-creation" id="idm46177454980456"/><a data-type="indexterm" data-primary="pt-show-grants" id="idm46177454990920"/> not new. In fact, there’s a tool in Percona Toolkit—<code>pt-show-grants</code>—that does exactly that, and more. Unfortunately, the tool can be used only on Linux officially and might not work at all on any other platform:</p>

<pre data-type="programlisting">$ <strong>pt-show-grants</strong></pre>

<pre data-type="programlisting">-- Grants dumped by pt-show-grants
-- Dumped from server Localhost via Unix socket,
    MySQL 8.0.22 at 2020-12-12 14:32:33
-- Roles
CREATE ROLE IF NOT EXISTS `application_ro`;
-- End of roles listing
...
-- Grants for 'robert'@'172.%'
CREATE USER IF NOT EXISTS 'robert'@'172.%';
ALTER USER 'robert'@'172.%' IDENTIFIED WITH 'mysql_native_password'
AS '*E1206987C3E6057289D6C3208EACFC1FA0F2FA56' REQUIRE NONE
PASSWORD EXPIRE DEFAULT ACCOUNT UNLOCK PASSWORD HISTORY DEFAULT
PASSWORD REUSE INTERVAL DEFAULT PASSWORD REQUIRE CURRENT DEFAULT;
GRANT ALL PRIVILEGES ON `bobs_db`.* TO `robert`@`172.%`;
GRANT ALL PRIVILEGES ON `sakila`.`actor` TO `robert`@`172.%` WITH GRANT OPTION;
GRANT SELECT ON `sakila`.* TO `robert`@`172.%` WITH GRANT OPTION;
GRANT SELECT ON `test`.* TO `robert`@`172.%` WITH GRANT OPTION;
GRANT USAGE ON *.* TO `robert`@`172.%`;
...</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The GRANT OPTION Privilege"><div class="sect2" id="USR-PRIVS-GRANTOPT">
<h2>The GRANT OPTION Privilege</h2>

<p>As discussed at the beginning of this chapter, MySQL does not<a data-type="indexterm" data-primary="GRANT" data-secondary="GRANT OPTION privilege" id="ch08-gopv"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="GRANT OPTION privilege" id="ch08-gopv2"/><a data-type="indexterm" data-primary="privileges" data-secondary="REVOKE" data-tertiary="GRANT OPTION privilege for" id="ch08-gopv3"/><a data-type="indexterm" data-primary="REVOKE" data-secondary="GRANT OPTION privilege for" id="ch08-gopv4"/><a data-type="indexterm" data-primary="MySQL" data-secondary="ownership of objects" data-tertiary="GRANT OPTION privilege" id="idm46177454951768"/><a data-type="indexterm" data-primary="ownership of objects" data-secondary="GRANT OPTION privilege" id="idm46177454950680"/><a data-type="indexterm" data-primary="users" data-secondary="ownership of objects" data-tertiary="GRANT OPTION privilege" id="idm46177454949832"/> have a concept of object ownership. Thus, unlike in some other systems, the fact that some user created a table does not automatically mean that the same user can allow another user to do anything with that table. To make this slightly less convoluted, let’s review an 
<span class="keep-together">example.</span></p>

<p class="pagebreak-before">Suppose the user <code>bob</code> has permissions to create tables in a database called <code>bobs_db</code>:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="k">TABLE</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="p">(</code><code class="n">id</code><code> </code><code class="n">SERIAL</code><code> </code><code class="k">PRIMARY</code><code> </code><code class="k">KEY</code><code class="p">,</code><code> </code><code class="n">data</code><code> </code><code class="kt">TEXT</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.04 sec)</pre>

<p>An operator using the <code>bob</code> user wants to allow the <code>john</code> user to read data in the newly created table—but, alas, that is not possible:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1142 (42000): SELECT, GRANT command denied
to user 'bob'@'localhost' for table 'bobs_private_table'</pre>

<p>Let’s check what privileges <code>bob</code> actually has:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------------------------------------------+
| Grants for bob@localhost                                 |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                  |
| GRANT SELECT ON `sakila`.* TO `bob`@`localhost`          |
| GRANT ALL PRIVILEGES ON `bobs_db`.* TO `bob`@`localhost` |
+----------------------------------------------------------+
3 rows in set (0.00 sec)</pre>

<p>The missing piece here is a privilege that would allow a user to grant other users privileges it has been granted. If a DBA wants to allow <code>bob</code> to grant other users access to tables in the <code>bobs_db</code> database, an extra privilege needs to be granted. <code>bob</code> can’t grant that to itself, so a user with administrative privileges is required:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">WITH</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>Note the <code>WITH GRANT OPTION</code> addition. That’s exactly the privilege that we were looking for. This option will allow the <code>bob</code> user to pass its privileges to other users. Let’s confirm that by running the <code>GRANT SELECT</code> statement as <code>bob</code> again:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="n">bobs_private_table</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<p>As expected, the statement was accepted and executed. There are still few clarifications to make, however. First, we may want to know how granular the <code>GRANT OPTION</code> privilege is. That is, what exactly (apart from <code>SELECT</code> on <code>bobs_private_table</code>) can <code>bob</code> grant to other users? <code>SHOW GRANTS</code> can answer that question for us neatly:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting" class="less_space pagebreak-before">+----------------------------------------------------------------------------+
| Grants for bob@localhost                                                   |
+----------------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                                    |
| GRANT SELECT ON `sakila`.* TO `bob`@`localhost`                            |
| GRANT ALL PRIVILEGES ON `bobs_db`.* TO `bob`@`localhost` WITH GRANT OPTION |
+----------------------------------------------------------------------------+
3 rows in set (0.00 sec)</pre>

<p>That’s much clearer. We can see that <code>WITH GRANT OPTION</code> is applied to privileges that <code>bob</code> has on a particular database. That’s important to remember. Even though we executed <code>GRANT SELECT ... WITH GRANT OPTION</code>, <code>bob</code> got the ability to grant every privilege it has in the <code>bobs_db</code> database.</p>

<p>Second, we may want to know if it is possible to revoke just the <code>GRANT OPTION</code> privilege:<a data-type="indexterm" data-primary="GRANT" data-secondary="GRANT OPTION privilege" data-tertiary="revoking" id="idm46177454726888"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="GRANT OPTION revoked" id="idm46177454725608"/><a data-type="indexterm" data-primary="REVOKE" data-secondary="GRANT OPTION privilege for" data-tertiary="revoking" id="idm46177454724392"/><a data-type="indexterm" data-primary="privileges" data-secondary="REVOKE" data-tertiary="GRANT OPTION revoked" id="idm46177454703480"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">REVOKE</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code> </code><code class="k">ON</code><code> </code><code class="n">bobs_db</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------------------------------------------+
| Grants for bob@localhost                                 |
+----------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                  |
| GRANT SELECT ON `sakila`.* TO `bob`@`localhost`          |
| GRANT ALL PRIVILEGES ON `bobs_db`.* TO `bob`@`localhost` |
+----------------------------------------------------------+
3 rows in set (0.00 sec)</pre>

<p>Finally, looking at how <code>GRANT OPTION</code> can be revoked, we may want to know whether it can be granted alone. The answer is yes, with a caveat that we’ll show. Let’s grant the <code>GRANT OPTION</code> privilege to <code>bob</code> on the <code>sakila</code> and <code>test</code> databases. As you can see from the preceding output, <code>bob</code> currently has the <code>SELECT</code> privilege on <code>sakila</code>, but no privileges on the <code>test</code> database:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code> </code><code class="k">ON</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code> </code><code class="k">ON</code><code> </code><code class="n">test</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>Both statements succeeded. It’s pretty clear what exactly <code>bob</code> can grant on <code>sakila</code>: the <code>SELECT</code> privilege. However, it’s less clear what happened with <code>test</code>. Let’s check it out:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting" class="less_space pagebreak-before">+-------------------------------------------------------------------+
| Grants for bob@localhost                                          |
+-------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                           |
| GRANT SELECT ON `sakila`.* TO `bob`@`localhost` WITH GRANT OPTION |
| GRANT USAGE ON `test`.* TO `bob`@`localhost` WITH GRANT OPTION    |
| GRANT ALL PRIVILEGES ON `bobs_db`.* TO `bob`@`localhost`          |
+-------------------------------------------------------------------+
4 rows in set (0.00 sec)</pre>

<p>Okay, so <code>GRANT OPTION</code> alone only gives the user a <code>USAGE</code> privilege, which is the “no privileges” specifier. However, the <code>GRANT OPTION</code> privilege can be seen as a switch, and when “turned on,” it’ll apply for privileges <code>bob</code> is granted in the <code>test</code> database:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">test</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-------------------------------------------------------------------+
| Grants for bob@localhost                                          |
+-------------------------------------------------------------------+
...
| GRANT SELECT ON `test`.* TO `bob`@`localhost` WITH GRANT OPTION   |
...
+-------------------------------------------------------------------+
4 rows in set (0.00 sec)</pre>

<p>So far we’ve been using wildcard privileges, but it is possible to enable <code>GRANT OPTION</code> for a specific table:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">INSERT</code><code> </code><code class="k">ON</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="n">actor</code></strong><code>
    </code><code class="o">-</code><code class="o">&gt;</code><code> </code><strong><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="k">WITH</code><code> </code><code class="k">GRANT</code><code> </code><code class="k">OPTION</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-------------------------------------------------------------------------+
| Grants for bob@localhost                                                |
+-------------------------------------------------------------------------+
...
| GRANT INSERT ON `sakila`.`actor` TO `bob`@`localhost` WITH GRANT OPTION |
+-------------------------------------------------------------------------+
5 rows in set (0.00 sec)</pre>

<p>By now, it should be clear that <code>GRANT OPTION</code> is a powerful addition to the privileges system. Given that MySQL lacks the concept of ownership, it’s the only way to make sure users that aren’t superusers can grant each other permissions. However, it is also important, as always, to remember that <code>GRANT OPTION</code> applies to every permission the user has.<a data-type="indexterm" data-startref="ch08-gopv" id="idm46177454388088"/><a data-type="indexterm" data-startref="ch08-gopv2" id="idm46177454387384"/><a data-type="indexterm" data-startref="ch08-gopv3" id="idm46177454386712"/><a data-type="indexterm" data-startref="ch08-gopv4" id="idm46177454386040"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Roles"><div class="sect1" id="USR-SEC-ROLES">
<h1>Roles</h1>

<p><em>Roles</em>, introduced in MySQL 8.0, are collections of privileges.<a data-type="indexterm" data-primary="users" data-secondary="roles" id="ch08-roll3"/><a data-type="indexterm" data-primary="roles" id="ch08-roll"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" id="ch08-roll2"/> They simplify user and privilege management by grouping and “containerizing” necessary permissions. You may have a few different DBA users that all need the same permissions. Instead of granting privileges individually to each of the users, you can create a role, grant permissions to that role, and assign users that role. In doing so, you also simplify management in that you won’t need to update each user individually. Should your DBAs need their privileges adjusted, you can simply adjust the role.</p>

<p>Roles are quite similar to users in how they are created, stored, and managed. To create a role, you need to execute<a data-type="indexterm" data-primary="CREATE ROLE" id="idm46177454359928"/><a data-type="indexterm" data-primary="DROP ROLE" id="idm46177454359320"/> a <code>CREATE ROLE [IF NOT EXISTS]</code> <em><code>role1</code></em>[, <em><code>role2</code></em>[, <em><code>role3</code></em> …]] statement. To remove a role, you execute a <code>DROP ROLE [IF EXISTS]</code> <em><code>role1</code></em>[, <em><code>role2</code></em>[, <em><code>role3</code></em> …]] statement. When you drop a role, the assignments  of that role to all users is removed. Privileges required to create a role are <code>CREATE ROLE</code> or <code>CREATE USER</code>. To drop a role, the <code>DROP ROLE</code> or <code>DROP USER</code> privilege is required. <a data-type="indexterm" data-primary="CONNECTION_ADMIN privilege" data-secondary="read_only system variable" id="idm46177454352632"/><a data-type="indexterm" data-primary="privileges" data-secondary="CONNECTION_ADMIN privilege" data-tertiary="read_only system variable" id="idm46177454351720"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="read_only system variable" id="idm46177454350568"/><a data-type="indexterm" data-primary="read_only system variable" id="idm46177454349384"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="read_only system variable" id="idm46177454348696"/><a data-type="indexterm" data-primary="system variables" data-secondary="read_only" id="idm46177454347736"/>As with the user management commands, if <code>read_only</code> is set, an admin privilege is additionally required to create and drop roles. Direct modification privileges on grant tables allow a user to modify anything, as we’ve also discussed.</p>

<p>Just like usernames, role names consist of two parts: the name<a data-type="indexterm" data-primary="names" data-secondary="rolename@host" id="idm46177454345656"/><a data-type="indexterm" data-primary="roles" data-secondary="rolename@host" id="idm46177454344680"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="rolename@host" id="idm46177454343736"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="rolename@host" id="idm46177454342520"/><a data-type="indexterm" data-primary="hostnames" data-secondary="rolename@host" id="idm46177454341304"/><a data-type="indexterm" data-primary="wildcard (%)" data-secondary="role hostnames" id="idm46177454340360"/><a data-type="indexterm" data-primary="% (wildcard)" data-secondary="role hostnames" data-primary-sortas="#wildcard" id="idm46177454339416"/><a data-type="indexterm" data-primary="mysql.user table" id="idm46177454338200"/> itself and the host specification. When host is not specified, the <code>%</code> wildcard is assumed. The host specification for a role does not limit its use in any way. The reason it’s there is because roles are stored just like users in the <code>mysql.user</code> grant table. As a consequence, you cannot have the same <em><code>rolename</code></em>@<em><code>host</code></em> as an existing user. To have a role with the same name as an existing user, specify a different hostname for the role.</p>

<p>Unlike privileges, roles are not active all the time. When a user is granted a role, they’re authorized to use that role but not obliged to do so. In fact, a user can have multiple roles and can “enable” one or more of them within the same connection.</p>

<p>One or more roles can be assigned as defaults to a user during the user’s creation or at a later time through the <code>ALTER USER</code> command. Such roles will be active as soon as the user is authenticated.</p>

<p>Let’s review the commands, settings, and terminology related to role management:</p>
<dl>
<dt><code>GRANT PRIVILEGE</code> and <code>REVOKE PRIVILEGE</code> commands</dt>
<dd>
<p>We covered these commands in <a data-type="xref" href="#USR-PRIV-MGMT">“Privilege Management Commands”</a>. For all intents and purposes, roles can be used just the same as users with the <code>GRANT</code> and <code>REVOKE</code> <code>PRIVILEGE</code> commands. That is, you can assign all the same privileges to a role as you can to a user, and revoke them, too.</p>
</dd>
<dt><code>GRANT</code> <em><code>role</code></em> [, <em><code>role</code></em> …] TO user` command</dt>
<dd>
<div class="openblock">
<p>The basic command related to role management. By running<a data-type="indexterm" data-primary="GRANT" data-secondary="roles" id="idm46177454324344"/><a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="roles" id="idm46177454323288"/> this command, you authorize a user to assume a particular role. As mentioned previously, the user is not obliged to use the role. Let’s create a couple of roles that will be able to operate on the <code>sakila</code> database:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application_rw'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application_ro'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">ALL</code><code> </code><code class="k">ON</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'application_rw'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.06 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="k">SELECT</code><code> </code><code class="k">ON</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="o">*</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'application_ro'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<p>Now you can assign these roles to an arbitrary number of users and change the roles only when needed. Here, we allow our <code>bob</code> user read-only access to the <code>sakila</code> database:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="s1">'application_ro'</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<p>You can also grant more than one role in a single statement.</p>
</div>

</dd>
<dt><code>WITH ADMIN OPTION</code> modifier</dt>
<dd>
<div class="openblock">
<p>When you grant a role to a user, that user is allowed only to activate the role, but not to alter it in any way. That user may not grant the role to any other user. <a data-type="indexterm" data-primary="privileges" data-secondary="GRANT" data-tertiary="roles with admin options" id="idm46177454180728"/><a data-type="indexterm" data-primary="GRANT" data-secondary="roles" data-tertiary="with admin options" id="idm46177454179512"/>If you wish to allow both modification of the role and the ability to grant it to other users, you can specify <code>WITH ADMIN OPTION</code> in the <code>GRANT ROLE</code> command. The result will be reflected in grant tables and will be visible in the <code>SHOW GRANTS</code> command’s output:<a data-type="indexterm" data-primary="SHOW" data-secondary="GRANTS" id="idm46177454176792"/><a data-type="indexterm" data-primary="GRANT" data-secondary="SHOW GRANTS" id="idm46177454156232"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-------------------------------------------------------------------+
| Grants for bob@localhost                                          |
+-------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                           |
| GRANT `application_ro`@`%` TO `bob`@`localhost` WITH ADMIN OPTION |
+-------------------------------------------------------------------+
2 rows in set (0.00 sec)</pre>
</div>

</dd>
<dt><code>SHOW GRANTS</code> and roles</dt>
<dd>
<div class="openblock">
<p>The <code>SHOW GRANTS</code> command, which we introduced in <a data-type="xref" href="#USR-PRIVS-CHECK">“Checking Privileges”</a>, is capable of showing you both assigned roles and the effective permissions with one or more roles activated. This is possible by adding an optional <code>USING</code> <em><code>role</code></em> modifier. Here, we show the effective privileges that <code>bob</code> will have as soon as the <code>application_ro</code> role is activated:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SHOW</code><code> </code><code class="n">GRANTS</code><code> </code><code class="k">FOR</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="k">USING</code><code> </code><code class="s1">'application_ro'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-------------------------------------------------------------------+
| Grants for bob@localhost                                          |
+-------------------------------------------------------------------+
| GRANT USAGE ON *.* TO `bob`@`localhost`                           |
| GRANT SELECT ON `sakila`.* TO `bob`@`localhost`                   |
| GRANT `application_ro`@`%` TO `bob`@`localhost` WITH ADMIN OPTION |
+-------------------------------------------------------------------+
3 rows in set (0.00 sec)</pre>
</div>

</dd>
<dt><code>SET ROLE DEFAULT | NONE | ALL | ALL EXCEPT</code> <em><code>role</code></em> [, <em><code>role1</code></em> …] | <em><code>role</code></em> [, <em><code>role1</code></em> …] command</dt>
<dd>
<div class="openblock">
<p>The <code>SET ROLE</code> role management command is invoked by an<a data-type="indexterm" data-primary="SET command" data-secondary="ROLE" id="idm46177454089800"/> authenticated user to assign a particular role or roles to itself. Once the role is set, its permissions apply to the user. Let’s continue with our example for <code>bob</code>:</p>

<pre data-type="programlisting">$ <strong>mysql -ubob</strong></pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">staff_id</code><code class="p">,</code><code> </code><code class="n">first_name</code><code> </code><code class="k">FROM</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="n">staff</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1142 (42000): SELECT command denied to user 'bob'@'localhost' for
table 'staff'</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application_rw'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 3530 (HY000): `application_rw`@`%` is not granted to
`bob`@`localhost`</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application_ro'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">staff_id</code><code class="p">,</code><code> </code><code class="n">first_name</code><code> </code><code class="k">FROM</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="n">staff</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------+------------+
| staff_id | first_name |
+----------+------------+
|        1 | Mike       |
|        2 | Jon        |
+----------+------------+
2 rows in set (0.00 sec)</pre>

<p>Only when the role is assigned can <code>bob</code> use its privileges. Note that you cannot use <code>SET ROLE</code> to assign yourself a role you aren’t authorized (through <code>GRANT ROLE</code>) to use.</p>

<p>There’s no <code>UNSET ROLE</code> command, but there are few other extensions to <code>SET ROLE</code> that allow this behavior. To unset every role, run <code>SET ROLE NONE</code>. A user can also go back to its default set of roles by executing <code>SET ROLE DEFAULT</code>, or activate all the roles it has access to by running <code>SET ROLE ALL</code>. If you need to set a subset of roles which is neither default nor all, you can construct a <code>SET ROLE ALL EXCEPT</code> <em><code>role</code></em> [, <em><code>role1</code></em> …] statement and explicitly avoid setting one or more roles.</p>
</div>

</dd>
<dt><code>DEFAULT ROLE</code> user option</dt>
<dd>
<div class="openblock">
<p>When you run <code>CREATE USER</code>, or later through <code>ALTER USER</code>, <a data-type="indexterm" data-primary="defaults" data-secondary="role" id="idm46177453943128"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="DEFAULT ROLE" id="idm46177453942280"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="DEFAULT ROLE" id="idm46177453941128"/><a data-type="indexterm" data-primary="roles" data-secondary="DEFAULT ROLE" id="idm46177453939912"/>you can set one or more roles to be the default for a particular user. These roles will be implicitly set once the user is authenticated, saving you a <code>SET ROLE</code> statement. This is convenient, for example, for application users that use a single role or a known set of roles most of the time. Let’s set <code>application_ro</code> as a default role for <code>bob</code>:<a data-type="indexterm" data-primary="SELECT" data-secondary="CURRENT_ROLL()" id="idm46177453937272"/></p>

<pre data-type="programlisting">$ <strong>mysql -uroot</strong></pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="k">DEFAULT</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application_ro'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<pre data-type="programlisting">$ <strong>mysql -ubob</strong></pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="nf">CURRENT_ROLE</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------------------+
| CURRENT_ROLE()       |
+----------------------+
| `application_ro`@`%` |
+----------------------+
1 row in set (0.00 sec)</pre>

<p>As soon as <code>bob@localhost</code> is logged in, the <code>CURRENT_ROLE()</code> function returns the desired <code>application_ro</code>.</p>
</div>

</dd>
<dt>Mandatory roles</dt>
<dd>
<p>It is possible to grant one or more roles to every user in the<a data-type="indexterm" data-primary="roles" data-secondary="mandatory roles" id="idm46177453886984"/><a data-type="indexterm" data-primary="mandatory_roles system variable" id="idm46177453886008"/><a data-type="indexterm" data-primary="system variables" data-secondary="mandatory_roles" id="idm46177453885368"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="mandatory roles" id="idm46177453884424"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="mandatory roles" id="idm46177453883208"/> database implicitly. This is achieved by setting the <code>mandatory_roles</code> system parameter (global in scope, and dynamic) to a list of roles. <a data-type="indexterm" data-primary="SET command" data-secondary="ROLE" id="idm46177453862728"/>Roles granted this way are not activated until <code>SET ROLE</code> is run. It’s impossible to revoke roles assigned this way, but you can grant them explicitly to a user. Roles listed in <code>mandatory_roles</code> cannot be dropped until removed from the setting.</p>
</dd>
<dt>Automatically activating roles</dt>
<dd>
<p>By default, roles are not active until <code>SET ROLE</code> is executed.<a data-type="indexterm" data-primary="roles" data-secondary="automatically activating" id="idm46177453859016"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="automatically activating" id="idm46177453858040"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="automatically activating" id="idm46177453856856"/> However, it is possible to override that behavior and automatically activate every role available to a user upon authentication. This is analogous to running <code>SET ROLE ALL</code> upon login. This behavior can be enabled or disabled (which is the default) by changing the <code>activate_all_roles_on_login</code> system parameter (global in scope, and dynamic). When <code>activate_all_roles_on_login</code> is set to <code>ON</code>, both explicitly and implicitly (through <code>mandatory_roles</code>) granted roles will be activated for every user.</p>
</dd>
<dt>Cascading role permissions</dt>
<dd>
<div class="openblock">
<p>Roles can be granted to roles. What happens then is that all<a data-type="indexterm" data-primary="roles" data-secondary="roles granted to roles" id="idm46177453850744"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="roles granted to roles" id="idm46177453849768"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="roles granted to roles" id="idm46177453848552"/> permissions of the granted role are inherited by the grantee role. Once the grantee role is activated by a user, you can think of that user as having activated a granted role. Let’s make our example slightly more complex. We will have an <code>application</code> role that is granted the <code>application_ro</code> and <code>application_rw</code> roles. The <code>application</code> role itself has no direct permissions assign. We will assigned the <code>application</code> role to our <code>bob</code> user and examine the result:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="s1">'application_rw'</code><code class="p">,</code><code> </code><code class="s1">'application_ro'</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'application'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">REVOKE</code><code> </code><code class="s1">'application_ro'</code><code> </code><code class="k">FROM</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="s1">'application'</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'bob'</code><code class="o">@</code><code class="s1">'localhost'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<p>What happens now is that when <code>bob</code> activates the <code>application</code> role, it will have the permissions of both the <code>rw</code> and <code>ro</code> roles. We can easily verify this. Note that <code>bob</code> cannot activate any of the roles it was granted indirectly:</p>

<pre data-type="programlisting">$ <strong>mysql -ubob</strong></pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="kt">SET</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'application'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">staff_id</code><code class="p">,</code><code> </code><code class="n">first_name</code><code> </code><code class="k">FROM</code><code> </code><code class="n">sakila</code><code class="p">.</code><code class="n">staff</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+----------+------------+
| staff_id | first_name |
+----------+------------+
|        1 | Mike       |
|        2 | Jon        |
+----------+------------+
2 rows in set (0.00 sec)</pre>
</div>

</dd>
<dt>Roles graph</dt>
<dd>
<div class="openblock">
<p>Since roles can be granted to roles, the resulting hierarchy can be pretty hard to follow. You can review it by examining the <code>mysql.role_edges</code> grant table:<a data-type="indexterm" data-primary="mysql.role_edges grant table" id="idm46177453666888"/><a data-type="indexterm" data-primary="grant tables" data-secondary="roles granted to roles" id="idm46177453666184"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" data-tertiary="roles granted to roles" id="idm46177453665240"/></p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">role_edges</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-----------+----------------+-----------+-------------+----------------+
| FROM_HOST | FROM_USER      | TO_HOST   | TO_USER     | WITH_ADMIN_... |
+-----------+----------------+-----------+-------------+----------------+
| %         | application    | localhost | bob         | N              |
| %         | application_ro | %         | application | N              |
| %         | application_rw | %         | application | N              |
| %         | developer      | 192.168.% | john        | N              |
| %         | developer      | localhost | bob         | N              |
| 192.168.% | john           | %         | developer   | N              |
+-----------+----------------+-----------+-------------+----------------+
6 rows in set (0.00 sec)</pre>

<p>For more complex hierarchies, MySQL conveniently includes a built-in function that allows you to <a data-type="indexterm" data-primary="XML output" id="idm46177453639160"/><a data-type="indexterm" data-primary="GraphML XML output" id="idm46177453638552"/><a data-type="indexterm" data-primary="output" data-secondary="XML" id="idm46177453637944"/>generate an XML document in a valid GraphML format. You can use any capable software to visualize the output. Here’s the function call, and the resulting heavily formatted output (XML doesn’t work well in books):</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="o">*</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="nf">roles_graphml</code><code class="p">(</code><code class="p">)</code><code class="err">\</code><code class="n">G</code></strong></pre>

<pre data-type="programlisting">*************************** 1. row ***************************
roles_graphml(): &lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;graphml xmlns="...
...
    &lt;node id="n0"&gt;
      &lt;data key="key1"&gt;`application`@`%`&lt;/data&gt;
    &lt;/node&gt;
    &lt;node id="n1"&gt;
      &lt;data key="key1"&gt;`application_ro`@`%`&lt;/data&gt;
    &lt;/node&gt;
...</pre>

<p>Ideally, you should use <code>SELECT ... INTO OUTFILE</code> (see <a data-type="xref" href="ch07.xhtml#WRITECSV">“Writing Data into Comma-Delimited Files”</a>). <a data-type="indexterm" data-primary="output" data-secondary="visualizing" data-tertiary="yEd" id="idm46177453592552"/><a data-type="indexterm" data-primary="yEd graph editor" id="idm46177453591304"/><a data-type="indexterm" data-primary="web links in book" data-secondary="yEd graph editor" id="idm46177453590632"/><a data-type="indexterm" data-primary="visualizing output" data-secondary="yEd" id="idm46177453589688"/>Then you can use a tool such as the <a href="https://oreil.ly/VpIYA">yEd graph editor</a>, which is a powerful, cross-platform, free desktop application, to visualize that output. You can see a zoomed-in section of the complete graph, concentrating on our <code>bob</code> user and surrounding roles, in <a data-type="xref" href="#fig0801">Figure 8-1</a>. The privilege required to run this function is <code>ROLE_ADMIN</code>.<a data-type="indexterm" data-primary="roles" data-secondary="ROLE_ADMIN privilege" id="idm46177453573752"/><a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="ROLE_ADMIN privilege" id="idm46177453572904"/></p>

<figure><div id="fig0801" class="figure">
<img src="Images/lm2e_0801.png" alt="lm2e 0801" width="867" height="269"/>
<h6><span class="label">Figure 8-1. </span>Section of a visualized MySQL roles graph</h6>
</div></figure>
</div>

</dd>
<dt>Differences between roles and users</dt>
<dd>
<div class="openblock">
<p>Earlier we mentioned that the <code>CREATE USER</code> and <code>DROP USER</code> privileges<a data-type="indexterm" data-primary="roles" data-secondary="users versus" id="idm46177453566776"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="users versus roles" id="idm46177453565768"/><a data-type="indexterm" data-primary="mysql.user table" id="idm46177453564552"/> allow modification of roles. Given that roles are stored along with users in <code>mysql.user</code>, you might also guess that the regular user management commands will work for roles. That’s easy to test and confirm: just run <code>RENAME USER</code> or a <code>DROP USER</code> on a role. Another thing to note is how the <code>GRANT</code> and <code>REVOKE</code> <code>PRIVILEGE</code> commands target roles as if they were users.</p>

<p>Roles are, at their core, just regular users. In fact, it is possible to use <code>GRANT ROLE</code> to grant an unlocked user to another unlocked user or to a role:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">CREATE</code><code> </code><code class="n">ROLE</code><code> </code><code class="s1">'developer'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">GRANT</code><code> </code><code class="s1">'john'</code><code class="o">@</code><code class="s1">'192.168.%'</code><code> </code><code class="k">TO</code><code> </code><code class="s1">'developer'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="n">from_user</code><code class="p">,</code><code> </code><code class="n">to_user</code><code> </code><code class="k">FROM</code><code> </code><code class="n">mysql</code><code class="p">.</code><code class="n">role_edges</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-----------+-----------+
| from_user | to_user   |
+-----------+-----------+
| john      | developer |
+-----------+-----------+
1 row in set (0.00 sec)</pre>

<p>Roles are a powerful and flexible addition to MySQL’s user and privilege system. As with almost any feature, they can be overused, resulting in unnecessarily complex hierarchies that will be hard to follow. However, if you keep things simple, roles can save you a lot of work.<a data-type="indexterm" data-startref="ch08-roll" id="idm46177453479176"/><a data-type="indexterm" data-startref="ch08-roll2" id="idm46177453478504"/><a data-type="indexterm" data-startref="ch08-roll3" id="idm46177453477832"/></p>
</div>

</dd>
</dl>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Changing root’s Password and Insecure Startup"><div class="sect1" id="USR-ROOT-RESET">
<h1>Changing root’s Password and Insecure Startup</h1>

<p>Sometimes, it can become necessary to gain access to a<a data-type="indexterm" data-primary="users" data-secondary="managing" data-tertiary="password forgotten" id="idm46177453475432"/><a data-type="indexterm" data-primary="ALTER USER" data-secondary="password changed" data-tertiary="forgotten password" id="idm46177453474184"/><a data-type="indexterm" data-primary="privileges" data-secondary="grant tables" data-tertiary="skipping authentication" id="idm46177453472968"/><a data-type="indexterm" data-primary="users" data-secondary="authentication" data-tertiary="skipping" id="idm46177453471752"/><a data-type="indexterm" data-primary="authentication" data-secondary="users connecting" data-tertiary="skipping authentication" id="idm46177453458280"/><a data-type="indexterm" data-primary="passwords" data-secondary="forgotten" id="idm46177453457192"/> MySQL instance without knowing any user’s password. Or you could accidentally drop every user in the database, effectively locking you out. MySQL provides a workaround in such situations, but requires you to be able to change its configuration and restart the instance in question. You might think this is shady or dangerous, but actually it’s just a protection from one of the simplest problems DBAs run up against: forgotten passwords. Just imagine having a production instance running that has no superuser access available: that’s obviously not something desirable. Luckily, it’s possible to bypass authorization when necessary.</p>

<p class="pagebreak-before">To perform the authentication and privileges bypass, you have<a data-type="indexterm" data-primary="grant tables" data-secondary="authentication of user" data-tertiary="skipping authentication" id="idm46177453454696"/><a data-type="indexterm" data-primary="my.cnf configuration file" data-secondary="skipping authentication" id="idm46177453453512"/> to restart a MySQL instance with the <code>--skip-grant-tables</code> option specified. Since most installations use service scripts to start the instance, you can specify <code>skip-grant-tables</code> in the <em>my.cnf</em> configuration file under the <code>[mysqld]</code> section. When <code>mysqld</code> is started in this mode, it (pretty obviously) skips reading grant tables, which has the following effects:</p>

<ul>
<li>
<p>No authentication is performed; thus, there’s no need to know any usernames or passwords.</p>
</li>
<li>
<p>No privileges are loaded, and no permissions are checked.</p>
</li>
<li>
<p>MySQL will implicitly set <code>--skip-networking</code> to prevent any but local access while it’s running in the unsafe configuration.<a data-type="indexterm" data-primary="networking" data-secondary="authentication skipped" id="idm46177453446936"/></p>
</li>
</ul>

<p>When you connect to a MySQL instance running with <code>--skip-grant-tables</code>, you’ll be authorized as a special user. This user has access to every table and can alter any user. <a data-type="indexterm" data-primary="passwords" data-secondary="ALTER USER to change" data-tertiary="forgotten password" id="idm46177453444488"/><a data-type="indexterm" data-primary="FLUSH PRIVILEGES" data-secondary="authentication skipped" id="idm46177453443240"/><a data-type="indexterm" data-primary="privileges" data-secondary="FLUSH PRIVILEGES" data-tertiary="authentication skipped" id="idm46177453442296"/>Before altering, for example, the <code>root</code> user’s lost password, you need to run <code>FLUSH PRIVILEGES</code>; otherwise, the <code>ALTER</code> will fail:</p>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">SELECT</code><code> </code><code class="k">current_user</code><code class="p">(</code><code class="p">)</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">+-----------------------------------+
| current_user()                    |
+-----------------------------------+
| skip-grants user@skip-grants host |
+-----------------------------------+
1 row in set (0.00 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'root'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'P@ssw0rd!'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">ERROR 1290 (HY000): The MySQL server is running with the --skip-grant-tables
option so it cannot execute this statement</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="n">FLUSH</code><code> </code><code class="n">PRIVILEGES</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.02 sec)</pre>

<pre data-type="programlisting" data-code-language="mysql"><code class="n">mysql</code><code class="o">&gt;</code><code> </code><strong><code class="k">ALTER</code><code> </code><code class="n">USER</code><code> </code><code class="s1">'root'</code><code class="o">@</code><code class="s1">'localhost'</code><code> </code><code class="n">IDENTIFIED</code><code> </code><code class="k">BY</code><code> </code><code class="s1">'P@ssw0rd!'</code><code class="p">;</code></strong></pre>

<pre data-type="programlisting">Query OK, 0 rows affected (0.01 sec)</pre>

<p>Once the password is reset, it’s recommended to restart the MySQL instance in a normal mode.</p>

<p>There’s also another way to recover <code>root</code>’s password, which is arguably more secure.<a data-type="indexterm" data-primary="root user in MySQL" data-secondary="forgotten password" id="idm46177453326472"/><a data-type="indexterm" data-primary="users" data-secondary="root@localhost in MySQL" data-tertiary="forgotten password" id="idm46177453325496"/> One of the numerous command-line arguments that <code>mysqld</code> takes is <code>--init-file</code> (or <code>init_file</code> if used through <em>my.cnf</em>). This argument specifies a path to a file containing some SQL statements that will be executed during MySQL startup. No privilege checks are done at that time, so it’s possible to put an <code>ALTER USER root</code> statement there. It’s recommended to delete the file and unset the option once you’ve regained access or created a new <code>root</code> user.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Both of the options presented here can potentially lead to security issues. Please use them carefully!</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Some Ideas for Secure Setup"><div class="sect1" id="idm46177453476776">
<h1>Some Ideas for Secure Setup</h1>

<p>During the course of this chapter, we outlined a few practices<a data-type="indexterm" data-primary="users" data-secondary="security" id="idm46177453306264"/><a data-type="indexterm" data-primary="privileges" data-secondary="security" id="idm46177453305416"/><a data-type="indexterm" data-primary="security" data-secondary="user security improved" id="idm46177453304568"/> related to user and privilege management that can help make your server more secure and safe. Here we will provide a short summary of those techniques and our recommendations for using them.</p>

<p>From the administrative side, we have the following recommendations:</p>

<ul>
<li>
<p>Avoid overusing the built-in superuser <code>root@localhost</code>. Imagine five people having access to this user.<a data-type="indexterm" data-primary="localhost" data-secondary="root@localhost security risk" id="idm46177453301528"/><a data-type="indexterm" data-primary="root user in MySQL" data-secondary="root@localhost" data-tertiary="security risk" id="idm46177453300584"/><a data-type="indexterm" data-primary="security" data-secondary="root@localhost security risk" id="idm46177453299368"/> Even if you have auditing enabled in MySQL, you won’t be able to effectively discern which particular person accessed the user and when. This user will also be the first one that potential attackers will try to exploit.</p>
</li>
<li>
<p>Starting with MySQL 8.0, avoid creating new superusers through the <code>SUPER</code> privilege. <a data-type="indexterm" data-primary="privileges" data-secondary="dynamic" data-tertiary="SUPER avoided with" id="idm46177453296840"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="security risk" id="idm46177453295560"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="security risk" id="idm46177453294616"/><a data-type="indexterm" data-primary="dynamic privileges" data-secondary="SUPER avoided with" id="idm46177453293400"/><a data-type="indexterm" data-primary="privileges" data-secondary="SUPER" data-tertiary="dynamic instead" id="idm46177453292456"/><a data-type="indexterm" data-primary="SUPER privilege" data-secondary="dynamic instead" id="idm46177453291240"/>Instead, you can create a special DBA role that has either all dynamic privileges assigned individually or just some of them that are frequently required.</p>
</li>
<li>
<p>Consider organizing privileges for DBA functions into separate roles.<a data-type="indexterm" data-primary="privileges" data-secondary="roles" data-tertiary="security via" id="idm46177453288936"/><a data-type="indexterm" data-primary="users" data-secondary="roles" data-tertiary="security via" id="idm46177453287688"/> For example, the <code>INNODB_REDO_LOG_ARCHIVE</code> and <code>INNODB_REDO_LOG_ENABLE</code> privileges could be a part of the <code>innodb_redo_admin</code> role. Since roles are not by default automatically activated, one would first need to <code>SET ROLE</code> explicitly before running potentially dangerous administrative commands.</p>
</li>
</ul>

<p>For regular users, the recommendations are pretty similar:</p>

<ul>
<li>
<p>Try to minimize the scope of permissions. Always ask if this user needs access to every database in the cluster, or even every table in a particular database.</p>
</li>
<li>
<p>With MySQL 8.0, using roles is a convenient and arguably safer way to group and manage privileges. If you have three users that need the same or similar privileges, they could share a single role.</p>
</li>
<li>
<p>Never allow any non-superuser modification permissions on tables in the <code>mysql</code> database. This is a simple mistake that follows from the first recommendation in this list. Granting <code>UPDATE</code> on <code>*.*</code> will allow the grantee to grant itself any 
<span class="keep-together">permissions.</span></p>
</li>
</ul>

<ul class="less_space pagebreak-before">
<li>
<p>To make things even more secure and visible, you can consider periodically<a data-type="indexterm" data-primary="privileges" data-secondary="security" data-tertiary="comparing privilege dumps" id="idm46177453276952"/><a data-type="indexterm" data-primary="users" data-secondary="security" data-tertiary="comparing privilege dumps" id="idm46177453275736"/><a data-type="indexterm" data-primary="privileges" data-secondary="checking" data-tertiary="mysqldump" id="idm46177453274552"/><a data-type="indexterm" data-primary="privileges" data-secondary="checking" data-tertiary="comparing samples" id="idm46177453273336"/> saving all of the privileges currently assigned to users and comparing the result with the previously saved sample. <a data-type="indexterm" data-primary="pt-show-grants" id="idm46177453271864"/>You can easily diff the <code>pt-show-grants</code> output, or even the <code>mysqldump</code> output.</p>
</li>
</ul>

<p>With this chapter done, you should be comfortable administering users and privileges in MySQL.</p>
</div></section>







</div></section></div></body></html>