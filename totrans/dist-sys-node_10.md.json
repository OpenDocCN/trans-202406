["```\nconst fs = require('fs');\nfs.writeFileSync('/tmp/count.txt', '0'); // only run once\nfunction setUrl(url) {\n  const id = Number(fs.readFileSync('/tmp/count.txt').toString()) + 1;\n  fs.writeFileSync('/tmp/count.txt', String(id));\n  fs.writeFileSync(`/tmp/${id}.txt`, url);\n  return `sho.rt/${id}`;\n}\nfunction getUrl(code) {\n  return fs.readFileSync(`/tmp/${code}.txt`).toString();\n}\n```", "```\nfs.writeFileSync('/tmp/lock.txt', '', { flag: 'wx' });\n```", "```\n$ docker run -it --rm \\\n  --name distnode-redis \\\n  -p 6379:6379 \\\n  redis:6.0.5-alpine\n```", "```\n$ echo \"PING\\r\\nQUIT\\r\\n\" | nc localhost 6379\n> +PONG\n> +OK\n```", "```\n$ docker exec -it \\\n  distnode-redis \\\n  redis-cli\n```", "```\n$ mkdir redis && cd redis\n$ npm init -y\n$ npm install ioredis@4.17\n```", "```\n#!/usr/bin/env node\n// npm install ioredis@4.17\nconst Redis = require('ioredis');\nconst redis = new Redis('localhost:6379');\n\n(async () => {\n  await redis.set('foo', 'bar');\n  const result = await redis.get('foo');\n  console.log('result:', result);\n  redis.quit();\n})();\n```", "```\n$ node redis/basic.js\n> result: bar\n```", "```\nSET foo \"bar\"\n```", "```\nSET key value [EX seconds|PX milliseconds] [NX|XX] [KEEPTTL]\n```", "```\nGET foo\n> \"bar\"\n```", "```\nSET visits \"100\"\n> OK\nINCR visits\n> (integer) 101\n```", "```\nRPUSH list aaa\n> (integer) 1\nRPUSH list bbb\n> (integer) 2\nLRANGE list 0 -1\n> 1) \"aaa\"\n> 2) \"bbb\"\n```", "```\nSADD set alpha\n> (integer) 1\nSADD set beta\n> (integer) 1\nSADD set beta\n> (integer) 0\nSMEMBERS set\n> 1) \"beta\"     2) \"alpha\"\n```", "```\nHSET obj a 1\n> (integer) 1\nHSET obj b 2\n> (integer) 1\nHSET obj b 3\n> (integer) 0\nHGETALL obj\n1) \"a\"      2) \"1\"      3) \"b\"      4) \"3\"\n```", "```\n{\"wage\": 100000, \"...other fields\": \"...\"}\n```", "```\nZADD scores 1000 tlhunter\nZADD scores 500 zerker\nZADD scores 100 rupert\nZINCRBY scores 10 tlhunter\n> \"1010\"\nZRANGE scores 0 -1 WITHSCORES\n> 1) \"rupert\"     2) \"100\"\n> 3) \"zerker\"     4) \"900\"\n> 5) \"tlhunter\"   6) \"1010\"\n```", "```\n#!/usr/bin/env node // npm install ioredis@4.17 const Redis = require('ioredis');\nconst redis = new Redis('localhost:6379');\n\n(async () => {\n  const [res_srem, res_hdel] = await redis.multi() ![1](assets/1.png)\n    .srem(\"employees\", \"42\") // Remove from Set\n    .hdel(\"employee-42\", \"company-id\") // Delete from Hash\n    .exec(); ![2](assets/2.png)\n  console.log('srem?', !!res_srem[1], 'hdel?', !!res_hdel[1]);\n  redis.quit();\n})();\n```", "```\n$ docker exec distnode-redis redis-cli SADD employees 42 tlhunter\n$ docker exec distnode-redis redis-cli HSET employee-42 company-id funcorp\n$ node redis/transaction.js\n> srem? true hdel? true\n```", "```\nEVAL script numkeys key [key ...] arg [arg ...]\nEVALSHA sha1 numkeys key [key ...] arg [arg ...]\n```", "```\nlocal LOBBY = KEYS[1] -- Set\nlocal GAME = KEYS[2] -- Hash\nlocal USER_ID = ARGV[1] -- String\n\nredis.call('SADD', LOBBY, USER_ID)\n\nif redis.call('SCARD', LOBBY) == 4 then\n  local members = table.concat(redis.call('SMEMBERS', LOBBY), \",\")\n  redis.call('DEL', LOBBY) -- empty lobby\n  local game_id = redis.sha1hex(members)\n  redis.call('HSET', GAME, game_id, members)\n  return {game_id, members}\nend\n\nreturn nil\n```", "```\n#!/usr/bin/env node\n// npm install ioredis@4.17\nconst redis = new (require('ioredis'))('localhost:6379');\nredis.defineCommand(\"adduser\", {\n  numberOfKeys: 2,\n  lua: require('fs').readFileSync(__dirname + '/add-user.lua')\n});\nconst LOBBY = 'lobby', GAME = 'game';\n(async () => {\n  console.log(await redis.adduser(LOBBY, GAME, 'alice')); // null\n  console.log(await redis.adduser(LOBBY, GAME, 'bob')); // null\n  console.log(await redis.adduser(LOBBY, GAME, 'cindy')); // null\n  const [gid, players] = await redis.adduser(LOBBY, GAME, 'tlhunter');\n  console.log('GAME ID', gid, 'PLAYERS', players.split(','));\n  redis.quit();\n})();\n```", "```\n$ docker exec -it distnode-redis redis-cli monitor\n$ node redis/script.js\n```", "```\nnull\nnull\nnull\nGAME ID 523c26dfea8b66ef93468e5d715e11e73edf8620\n  PLAYERS [ 'tlhunter', 'cindy', 'bob', 'alice' ]\n```", "```\nAPP: \"info\"\nAPP: \"evalsha\" \"1c..32\" \"2\" \"lobby\" \"game\" \"alice\"\nAPP: \"eval\" \"local...\\n\" \"2\" \"lobby\" \"game\" \"alice\"\nLUA: \"SADD\" \"lobby\" \"alice\"\nLUA: \"SCARD\" \"lobby\"\n... PREVIOUS 3 LINES REPEATED TWICE FOR BOB AND CINDY ...\nAPP: \"evalsha\" \"1c..32\" \"2\" \"lobby\" \"game\" \"tlhunter\"\nLUA: \"SADD\" \"lobby\" \"tlhunter\"\nLUA: \"SCARD\" \"lobby\"\nLUA: \"SMEMBERS\" \"lobby\"\nLUA: \"DEL\" \"lobby\"\nLUA: \"HSET\" \"game\" \"52..20\" \"tlhunter,cindy,bob,alice\"\n```"]