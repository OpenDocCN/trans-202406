<html><head></head><body><section data-pdf-bookmark="Appendix C. Role-Based Access Control (RBAC)" data-type="appendix" epub:type="appendix"><div class="appendix" id="appendix_rbac">&#13;
<h1><span class="label">Appendix C. </span>Role-Based Access Control (RBAC)</h1>&#13;
&#13;
&#13;
<p>When the Operator SDK generates an Operator project (regardless of whether it is a Helm, Ansible, or Go-based Operator), it creates a number of manifest files for deploying the Operator.<a data-primary="role-based access control (RBAC)" data-type="indexterm" id="ix_RBACref"/> Many of these files grant permissions to the deployed Operator to perform the various tasks it does throughout its lifetime.<a data-primary="role-based access control (RBAC)" data-type="indexterm" id="idm45261327648072"/></p>&#13;
&#13;
<p>The Operator SDK generates three files related to Operator permissions:</p>&#13;
<dl>&#13;
<dt><em>deploy/service_account.yaml</em></dt>&#13;
<dd>&#13;
<p>Instead of authenticating as a user, Kubernetes provides a programmatic authentication method in the form of <em>service accounts</em>.<a data-primary="authorization" data-secondary="defining Operator service account" data-type="indexterm" id="idm45261327644680"/><a data-primary="service accounts" data-secondary="defining Operator service account" data-type="indexterm" id="idm45261327643704"/> A service account functions as the identity for the Operator pod when making requests against the Kubernetes API. This file simply defines the service account itself, and you do not need to manually edit it. More information on service accounts is available in <a href="https://oreil.ly/8oXS-">the Kubernetes documentation</a>.</p>&#13;
</dd>&#13;
<dt><em>deploy/role.yaml</em></dt>&#13;
<dd>&#13;
<p>This file creates and configures a <em>role</em> for the service account. The role dictates what permissions the service account has when interacting with the cluster APIs. The Operator SDK generates this file with extremely wide permissions that, for security reasons, you will want to edit before deploying your Operator in production. In the next section we explain more about refining the default permissions in this file.</p>&#13;
</dd>&#13;
<dt><em>deploy/role_binding.yaml</em></dt>&#13;
<dd>&#13;
<p>This file creates a <em>role binding</em>, which maps the service account to the role. You do not need to make any changes to the generated file.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fine-Tuning the Role" data-type="sect1"><div class="sect1" id="idm45261327637144">&#13;
<h1>Fine-Tuning the Role</h1>&#13;
&#13;
<p>At its most basic level, a role maps resource types to the actions (known as “verbs” in the role resource terminology) a user or service account may take on resources of those types. For example, the following role grants view (but not create or delete) permissions for deployments:</p>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="p-Indicator">-</code> <code class="nt">apiGroups</code><code class="p">:</code> <code class="p-Indicator">[</code><code class="s">"apps"</code><code class="p-Indicator">]</code>&#13;
  <code class="nt">resources</code><code class="p">:</code> <code class="p-Indicator">[</code><code class="s">"deployments"</code><code class="p-Indicator">]</code>&#13;
  <code class="nt">verbs</code><code class="p">:</code> <code class="p-Indicator">[</code><code class="s">"get"</code><code class="p-Indicator">,</code> <code class="s">"list"</code><code class="p-Indicator">,</code> <code class="s">"watch"</code><code class="p-Indicator">]</code></pre>&#13;
&#13;
<p>Since the Operator SDK does not know the extent to which your Operator will need to interact with the cluster, the default role allows all actions on a variety of Kubernetes resource types. The following snippet, taken from an SDK-generated Operator project, illustrates this. The <code>*</code> wildcard allows all actions on the given resources:</p>&#13;
&#13;
<pre data-code-language="yaml" data-type="programlisting"><code class="nn">...</code>&#13;
<code class="p-Indicator">-</code> <code class="nt">apiGroups</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="s">""</code>&#13;
  <code class="nt">resources</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">pods</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">services</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">endpoints</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">persistentvolumeclaims</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">events</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">configmaps</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">secrets</code>&#13;
  <code class="nt">verbs</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="s">'*'</code>&#13;
<code class="p-Indicator">-</code> <code class="nt">apiGroups</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">apps</code>&#13;
  <code class="nt">resources</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">deployments</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">daemonsets</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">replicasets</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">statefulsets</code>&#13;
  <code class="nt">verbs</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="s">'*'</code>&#13;
<code class="nn">...</code></pre>&#13;
&#13;
<p>Not surprisingly, it is considered a bad practice to grant such open and wide-reaching permissions to a service account. The specific changes you should make vary depending on the scope and behavior of your Operator. Generally speaking, you should restrict access as much as possible while still allowing your Operator to function.</p>&#13;
&#13;
<p>For example, the following role snippet provides the minimal functionality needed by the Visitors Site Operator:</p>&#13;
&#13;
<pre class="less_space pagebreak-before" data-code-language="yaml" data-type="programlisting"><code class="nn">...</code>&#13;
<code class="p-Indicator">-</code> <code class="nt">apiGroups</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="s">""</code>&#13;
  <code class="nt">resources</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">pods</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">services</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">secrets</code>&#13;
  <code class="nt">verbs</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">create</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">list</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">get</code>&#13;
<code class="p-Indicator">-</code> <code class="nt">apiGroups</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">apps</code>&#13;
  <code class="nt">resources</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">deployments</code>&#13;
  <code class="nt">verbs</code><code class="p">:</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">create</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">get</code>&#13;
  <code class="p-Indicator">-</code> <code class="l-Scalar-Plain">update</code>&#13;
<code class="nn">...</code></pre>&#13;
&#13;
<p>Full details on configuring Kubernetes roles are outside the scope of this book. You can find<a data-primary="role-based access control (RBAC)" data-startref="ix_RBACref" data-type="indexterm" id="idm45261327494344"/> more information in the <a href="https://oreil.ly/osBC3">Kubernetes RBAC documentation</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>