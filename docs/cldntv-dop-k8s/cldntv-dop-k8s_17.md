# 第十五章：可观测性和监控

> 在船上，没有什么是完全正确的。
> 
> 威廉·兰格维奇，《违禁之海》

在本章中，我们将探讨云原生应用程序的可观测性和监控问题。什么是可观测性？它与监控有何关系？在 Kubernetes 中如何进行监控、日志记录、度量和跟踪？

# 什么是可观测性？

*可观测性*可能对您来说并不是一个熟悉的术语，尽管它作为表达传统监控之外更广阔世界的方式越来越流行。在我们看到可观测性如何扩展监控之前，让我们先解决*监控*这个问题。

## 什么是监控？

你的网站现在能正常工作吗？去检查一下；我们会等你。了解所有应用程序和服务是否按预期工作的最基本方法是自己查看它们。但是在 DevOps 上下文中谈论监控时，我们大多数时候指的是*自动化监控*。

自动化监控是以某种编程方式定期检查网站或服务的可用性或行为，并通常以自动化方式警告人类工程师是否存在问题。但问题的定义是什么？

## 封闭箱监控

让我们以静态网站为例。如果根本无法工作，它将不会响应，或者您会在浏览器中看到错误消息。因此，此站点的最简单监控检查是获取主页并检查 HTTP 状态码（200 表示成功请求）。您可以使用命令行 HTTP 客户端（如`httpie`或`curl`）执行此操作。如果客户端的退出状态为非零，则表示获取网站时出现问题。

但假设 Web 服务器配置出现问题，尽管服务器工作并响应 HTTP `200 OK` 状态，但实际上却提供空白页面（或某种默认或欢迎页面，或者可能是错误的网站）。我们简单的监控检查将无法检测到任何问题，因为 HTTP 请求成功；然而，网站对用户而言并未按预期工作。

更复杂的监控检查可能会寻找页面上的特定文本，例如组织的名称。这将捕捉配置错误但工作正常的 Web 服务器问题。

### 超越静态页面

您可以想象更复杂的网站可能需要更复杂的监控。例如，如果网站具有用户登录功能，则监控检查可能还会尝试使用已知的测试用户帐户登录，并在登录失败时发出警报。或者如果网站具有搜索功能，则检查可能会填写文本字段以某些搜索文本，模拟点击搜索按钮，并验证结果中是否包含某些预期的文本。

对于简单的网站，对于问题“它是否工作？”的肯定或否定答案可能已经足够。对于云原生应用程序来说，这些应用程序往往是更复杂的分布式系统，问题可能会变成多个问题：

+   我的应用程序在全球各地都可用吗？还是只在某些地区？

+   大多数用户加载需要多长时间？

+   关于可能拥有较慢下载速度的用户怎么办？

+   我网站的所有功能是否按预期工作？

+   特定功能的工作速度慢或完全不起作用，影响了多少用户？

+   如果它依赖于第三方服务，当外部服务出现故障或不可用时，我的应用程序会发生什么？

+   当我的云提供商遇到故障时会发生什么？

开始清楚地看到，在监控云原生分布式系统的世界中，并没有很多事情是清晰的。

### 闭盒监控的局限性

但无论这些检查变得多么复杂，它们都属于同一类监控：*闭盒监控*。正如其名称所示，闭盒检查只观察系统的外部行为，而不尝试观察其内部发生的事情。

直到几年前，像 Nagios、Icinga、Zabbix、Sensu 和 Check_MK 等流行工具执行的闭盒监控基本上是技术的最前沿。确实，任何类型的系统自动监控相比没有监控都是一大进步。但是闭盒检查存在一些局限性：

+   他们只能检测可预测的故障（例如，网站无响应）。

+   他们只检查系统外部暴露的部分的行为。

+   他们是被动和反应式的；他们只在问题发生*后*告诉你。

+   他们可以回答“发生了什么问题？”的问题，但无法回答更重要的“为什么？”的问题。

要回答“为什么？”的问题，我们需要超越传统的监控。

这种*up*/*down*测试还有另外一个问题；*up*究竟意味着什么？

## “Up”是什么意思？

在运维中，我们习惯于通过*uptime*来衡量应用程序的弹性和可用性，通常以百分比表示。例如，99%的可用性意味着在相关时间段内最多不可用 1%。99.9%的可用性，称为*三个 9*，相当于每年大约九小时的停机时间，对于平均网络应用来说是一个不错的指标。四个 9（99.99%）意味着每年不到一个小时的停机时间，而五个 9（99.999%）大约是五分钟。

因此，更多的“nines”越好，你可能会这样想。但是，用这种方式看待问题会忽略一个重要的观点：

> 如果用户不满意，百分比无关紧要。
> 
> [查理·梅杰斯](https://red.ht/2FMZcMZ)

### 如果用户不满意，百分比无关紧要。

俗话说，被测量的东西会被最大化。因此，你最好非常小心你测量的内容。如果你的服务对用户不起作用，无论内部指标如何，都无关紧要：*服务已停止*。服务可能使用户不满意的方式有很多，即使它名义上是*up*。

举个明显的例子，如果您的网站加载需要 10 秒钟？加载后可能运行正常，但如果响应太慢，它可能就等同于完全不可用了。用户只会转而去其他地方。

传统的封闭盒监控可能会尝试通过定义比如说五秒的加载时间为*上行*，超过这个时间就被视为*下行*并生成警报来解决这个问题。但是如果用户体验到各种不同的加载时间，从 2 秒到 10 秒呢？使用这样的硬阈值，对于一些用户来说服务可能被认为是*下行*，但对于其他用户来说是*上行*。如果加载时间对于北美的用户来说很好，但对于欧洲或亚洲的用户来说不可用呢？

### 云原生应用程序从来都不是“上行”

尽管您可以继续精细化更复杂的规则和阈值，以使我们能够对服务状态给出*上行*/*下行*的答复，但事实是这个问题已经彻底有缺陷了。像云原生应用这样的分布式系统[永远不会是“上行”](http://red.ht/2hMHwSL)；它们存在于一个持续部分降级服务的状态中。

这是一类称为[*灰色失败*](https://oreil.ly/4r86k).¹的问题的示例。灰色失败从单一视角或单一观察特别难以检测到。

因此，尽管封闭盒监控可能是开始您可观察性之旅的好地方，但重要的是要意识到您不应该止步于此。让我们看看是否能做得更好。

## 日志记录

大多数应用程序都会产生某种形式的*日志*。日志是一系列记录，通常带有某种时间戳，指示记录的编写时间和顺序。例如，Web 服务器会在其日志中记录每个请求，包括诸如：

+   请求的 URI

+   客户端的 IP 地址

+   响应的 HTTP 状态

如果应用程序遇到错误，通常会记录此事实，以及可能或可能不有助于运营商找出问题原因的一些信息。

经常，来自各种应用和服务的日志将被*汇总*到一个中央数据库（例如 Elasticsearch），在那里可以查询和绘制图表以帮助解决问题。像 Logstash 和 Kibana 这样的工具，或者像 Splunk 和 Loggly 这样的托管服务，旨在帮助您收集和分析大量的日志数据。

### 日志的限制

日志可能很有用，但它们也有其局限性。关于是否记录或不记录的决定是在编写应用程序时由程序员做出的。因此，就像封闭盒检查一样，日志只能回答事先可以预测的问题或检测问题。

从日志中提取信息也可能很困难，因为每个应用程序都以不同的格式编写日志，并且运营商通常需要为每种类型的日志记录编写定制的解析器，将其转换为可用的数值或事件数据。

因为日志必须记录足够的信息来诊断任何可能的问题，它们通常具有较低的信噪比。如果记录所有内容，则在尝试查找所需的一个错误消息时，浏览数百页日志非常困难和耗时。如果仅记录偶发错误，则很难知道*正常*看起来是什么样子。

使用标准格式记录日志可以极大地提高其实用性。在类似 JSON 的已知结构中记录事件将使在尝试理解日志内容时能够更轻松地筛选噪音。

### 日志难以扩展

日志在处理流量方面也扩展不佳。如果每个用户请求都生成一个必须发送到聚合器的日志行，则可能会使用大量网络带宽（从而无法为用户提供服务），并且您的日志聚合器可能会成为瓶颈。

许多托管日志提供商还根据生成的日志量收费，这是可以理解的但不幸的：它在财务上激励您记录较少的信息，并减少用户并降低服务流量！

自托管的日志解决方案也是如此：存储的数据越多，您需要支付的硬件、存储和网络资源就越多，而仅仅保持日志聚合工作也需要更多的工程时间。

### 在 Kubernetes 中，日志记录是否有用？

我们稍微谈了一下容器如何生成日志以及如何在 Kubernetes 中直接检查它们，在“查看容器日志”中。这对于单个容器是一种有用的调试技术。

如果您确实使用日志记录，应该使用某种结构化数据，比如 JSON，这样可以自动解析（参见“可观测性管道”），而不是简单的文本记录。

集中日志聚合服务（如[Loki](https://oreil.ly/1r4BG)）对于 Kubernetes 应用程序非常有用，但这并非解决问题的全部。尽管集中日志有一些商业用例（例如审计和安全要求，或客户分析），日志不能提供我们实现真正可观察性所需的所有信息。

因此，我们需要超越日志，寻找更强大的解决方案。

## 引入度量指标

更复杂的收集服务信息的方式是使用*度量指标*。顾名思义，度量指标是某些事物的数值度量。根据应用程序的不同，相关的度量指标可能包括：

+   当前正在处理的请求数量

+   每分钟（或每秒、每小时）处理的请求数量

+   在处理请求时遇到的错误数量

+   服务请求平均处理时间（或峰值时间、第 99 百分位数）

收集基础架构以及应用程序的度量指标也非常有用：

+   单个进程或容器的 CPU 使用率

+   节点和服务器的磁盘 I/O 活动

+   机器、集群或负载均衡器的入站和出站网络流量

### 指标帮助回答“为什么？”的问题

指标开启了一种新的监控维度，不仅仅是简单地查看某些东西是否*工作*或*不工作*。就像你车上的速度计或温度计上的温度刻度一样，它们为你提供了正在发生的数值信息。与日志不同，指标可以轻松地以各种有用的方式处理：绘制图表、进行统计或在预定义的阈值上发出警报。例如，你的监控系统可能会在应用程序的错误率在特定时间段内超过 10%时向你发出警报。

指标还可以帮助回答关于问题“为什么？”的问题。例如，假设用户从您的应用程序中体验到长时间的响应时间（高*延迟*）。您检查了您的指标，发现*延迟*指标的峰值与特定机器或组件的*CPU 使用*指标的类似峰值相一致。这立即为您提供了一个问题开始寻找问题的线索。组件可能被卡住，或者重复尝试某些失败的操作，或者其主机节点可能存在硬件问题。

### 指标有助于预测问题

此外，指标可以是*预测性*的：当事情出错时，通常不会一下子就发生。在问题对您或您的用户可察觉之前，某些指标的增加可能表明麻烦即将来临。

例如，服务器的磁盘使用率指标可能随着时间的推移而逐渐增加，最终达到磁盘实际上用完空间并开始失败的点。如果在它进入失败状态之前就对该指标发出警报，您可以完全防止失败的发生。

一些系统甚至使用机器学习技术分析指标，检测异常，并推断原因。这在复杂的分布式系统中尤其有用，但对于大多数目的来说，仅仅有一种收集、绘图和警报指标的方法就已经足够了。

### 指标监视应用程序的内部情况

通过闭盒检查，运营商必须猜测应用程序或服务的内部实现，并预测可能发生的故障以及这将对外部行为产生什么影响。相比之下，指标允许应用程序开发人员根据他们对系统实际运行方式（以及其失败方式）的了解，导出关键信息的隐藏方面：

> 停止逆向工程应用程序，从内部开始监控。
> 
> [Kelsey Hightower, Monitorama 2016](https://vimeo.com/173610242)

工具如 Prometheus、StatsD 和 Graphite，或者像 Datadog、New Relic 和 Dynatrace 这样的托管服务，被广泛用于收集和管理指标数据。

我们将在第十六章详细讨论 Kubernetes 的度量标准，包括应重点关注的类型以及如何处理它们。现在，让我们通过观察跟踪来完成我们对可观测性的调查。

## 跟踪

在监控工具箱中，另一个有用的技术是*跟踪*。在分布式系统中尤为重要。虽然度量和日志可以告诉您系统每个单独组件的运行情况，但跟踪则是跟随单个用户请求的整个生命周期。

假设您正试图弄清楚为什么一些用户的请求延迟非常高。您检查了系统每个组件的度量标准：负载均衡器、入口、Web 服务器、应用服务器、数据库、消息总线等等；一切看起来都正常。那么问题出在哪里呢？

当您跟踪一个（希望是代表性的）请求，从用户连接打开到关闭，您将了解该请求在系统中每个阶段的整体延迟情况。

例如，您可能会发现在管道的每个阶段处理请求所花费的时间都是正常的，除了数据库跳跃，其时间是正常时间的一百倍。尽管数据库运行良好，其度量显示没有问题，但出于某种原因，应用服务器必须等待数据库请求完成的时间非常长。

最终，您发现问题是应用服务器与数据库服务器之间的某个特定网络链接上出现了严重的数据包丢失。如果没有分布式跟踪提供的*请求视角*，很难发现这类问题。

一些流行的分布式跟踪工具包括 [Zipkin](https://zipkin.io)，[Jaeger](https://www.jaegertracing.io) 和 [Lightstep](https://lightstep.com/product)。工程师 Masroor Hasan 写了一篇有用的博文，[“使用 Jaeger 在 Kubernetes 上进行分布式跟踪基础设施”](https://oreil.ly/esVav)，描述了如何在 Kubernetes 中使用 Jaeger 进行分布式跟踪。²

[OpenTracing 框架](https://opentracing.io)（CNCF 的一部分）旨在为分布式跟踪提供一套标准的 API 和库。

[Pixie](https://px.dev) 是另一个有趣的项目，为 Kubernetes 应用程序添加了跟踪和应用程序性能分析功能，还提供了丰富的查询语言，让您可以探索集群内部发生的情况。

## 可观测性

因为*监控*这个术语对不同的人有不同的意义——从简单的闭盒检查到指标、日志和跟踪的组合，现在使用*可观察性*作为一个涵盖所有这些技术的总称越来越普遍。系统的可观察性衡量了它的仪表化程度，以及你能够多容易地了解其内部情况。有些人说可观察性是监控的超集，另一些人则认为可观察性反映了与传统监控完全不同的思维方式。

区分这些术语最有用的方法或许是说监控告诉你*系统是否工作*，而可观察性则促使你问*为什么它不工作*，并考虑*它的表现如何*。

### 可观察性是关于理解

更普遍地说，可观察性是关于*理解*：理解你的系统在做什么以及它是如何做到的。例如，如果你推出一个设计上能提高特定功能性能 10%的代码更改，可观察性可以告诉你它是否起作用了。如果性能只提高了一点点，或者更糟的是稍微下降了，你需要重新审视代码。

另一方面，如果性能提高了 20%，这种变化超出了你的预期，也许你需要考虑为什么你的预测不足。可观察性帮助你建立和完善系统不同部分相互作用的心理模型。

可观察性也涉及*数据*。我们需要知道生成什么数据、收集什么数据、如何聚合数据（如果适用）、关注哪些结果，以及如何查询和展示它们。

### 软件是不透明的

在传统监控中，我们拥有大量关于*机器*的数据：CPU 负载、磁盘活动、网络数据包等等。但是从这些数据反推我们的*软件*在做什么是很困难的。要做到这一点，我们需要为软件本身添加仪表：

> 软件默认是不透明的；它必须生成数据，以便让人类了解它在做什么。可观察的系统使人类能够回答“它是否正常工作？”这个问题，并且如果答案是否定的，还能够诊断影响范围并确定出现了什么问题。
> 
> [克里斯汀·斯潘格](https://oreil.ly/iJeFI)

### 建立可观察性文化

更普遍地说，可观察性是关于*文化*的。它是 DevOps 哲学的关键原则，即在开发代码和在生产环境中运行代码之间闭环。可观察性是关闭这一环路的主要工具。开发人员和运维人员需要密切合作，为可观察性仪表化服务，并找出消费和处理所提供信息的最佳方法。

# 可观察性管道

从实际角度来看，可观察性是如何工作的？通常会有多个数据源（日志、指标等）以一种相当自发的方式连接到不同的数据存储中。

例如，您的日志可能会发送到 ELK 服务器，而指标可能会发送到三四个不同的托管服务，传统的监控检查报告可能会发送到另一个服务。这并不理想。

一方面，难以扩展。数据源和存储越多，相互连接越多，连接上的流量就越多。把工程时间投入到使所有这些不同类型的连接稳定可靠并不合理。

此外，系统与特定解决方案或提供者的紧密集成，使得更改它们或尝试替代方案更加困难。

解决这个问题的越来越流行的方法是[*可观察性管道*](https://oreil.ly/Vyn5M)：

> 使用可观察性管道，我们将数据源与目的地解耦，并提供缓冲区。这使得可观察性数据易于消费。我们不再需要弄清楚应该从容器、虚拟机和基础设施发送什么数据，将其发送到哪里以及如何发送。相反，所有数据都发送到管道中，管道负责过滤并将其发送到正确的位置。这还使我们在添加或删除数据接收器方面具有更大的灵活性，并为数据生产者和消费者之间提供了缓冲区。
> 
> Tyler Treat

可观察性管道带来了很大的优势。现在，添加新的数据源只是将其连接到您的管道。类似地，新的可视化或警报服务只是管道的另一个消费者。

由于管道会缓冲数据，因此不会丢失任何数据。如果流量突然激增并导致指标数据过载，管道会缓冲它，而不是丢弃样本。

使用可观察性管道需要标准的指标格式（参见“Prometheus”）以及理想情况下，应用程序使用 JSON 或其他合理的序列化数据格式进行结构化日志记录。不要再发出原始文本日志，然后稍后用脆弱的正则表达式进行解析，而是从一开始就使用结构化数据。

# Kubernetes 监控

现在我们对封闭盒监控及其与总体上的可观察性的关系有了更多理解，让我们看看它如何适用于 Kubernetes 应用程序。

## 外部封闭盒检查

正如我们所见，封闭盒监控只能告诉您应用程序已经宕机。但这仍然是非常有用的信息。云原生应用程序可能存在各种问题，但仍然可以接受某些请求。工程师可以致力于解决内部问题，如慢查询和增加的错误率，而用户并不真正意识到存在问题。

然而，更严重的问题类别导致全面的*停机*：应用程序对大多数用户不可用或不起作用。这对用户来说是不好的，依赖于应用程序，这也可能对您的业务不利。为了检测停机情况，您的监控需要以与用户相同的方式使用服务。

### 监控模拟用户行为

例如，如果是 HTTP 服务，则监控系统需要向其发出 HTTP 请求，而不仅仅是 TCP 连接。如果服务只返回静态文本，监控可以检查文本是否与某些预期字符串匹配。通常情况比这复杂一点，但您的检查也可以更加健壮。

在停机情况下，一个简单的文本匹配很可能足以告诉您应用程序已停止。但是仅在您的基础设施内（例如在 Kubernetes 中）进行这些封闭框检查是不够的。停机可能由用户与基础设施外部边缘之间的各种问题和故障导致，包括：

+   错误的 DNS 记录

+   网络分区

+   数据包丢失

+   配置错误的路由器

+   缺失或错误的防火墙规则

+   云提供商停机

在所有这些情况下，您的内部指标和监控可能根本没有显示任何问题。因此，您的首要可观察性任务应该是从您自己的基础设施外部的某一点监控服务的可用性。有许多第三方服务可以为您执行此类监控，包括 Uptime Robot、Pingdom 和 Wormly。

### 不要建立自己的监控基础设施

大多数这些服务都有免费层或相当廉价的订阅，并且无论你为它们付费多少，都应将其视为必要的运营费用。不要试图建立自己的外部监控基础设施；这是不值得的。一年的 Uptime Robot 专业订阅费用可能还不足以支付你工程师一小时的工时费用。

在外部监控提供商中查找以下关键特性：

+   HTTP/HTTPS 检查

+   检测您的 TLS 证书是否无效或已过期

+   关键词匹配（当关键词缺失时发出警报*或*当其存在时）

+   通过 API 自动创建或更新检查

+   通过电子邮件、短信、Webhook 或其他直接机制发送警报

在本书中，我们倡导基础设施即代码的理念，因此应该可以使用代码自动化您的外部监控检查。例如，Uptime Robot 提供了一个简单的 REST API 用于创建新检查，并且您可以使用类似[`uptimerobot`](https://oreil.ly/WP5eG)的客户端库或命令行工具进行自动化。

使用哪种外部监控服务并不重要，只要使用一个。但不要止步于此。在下一节中，我们将看看如何监控 Kubernetes 集群内应用程序的健康状态。

## 内部健康检查

云原生应用程序以复杂、难以预测和难以检测的方式失败。应用程序必须被设计为在面对意外故障时具有弹性，并且能够在封闭盒监控面前优雅地退化。但具有讽刺意味的是，它们越具有弹性，检测这些故障就越难以通过封闭盒监控来实现。

要解决这个问题，应用程序可以并且应该执行自己的健康检查。特定功能或服务的开发者最了解它所需的“健康”状况，并且他们可以编写代码来检查这一点，并以一种可以从容器外部监控结果的方式公开这些结果（例如 HTTP 终端点）。

### 用户是否满意？

正如我们在 “存活性探针” 中看到的，Kubernetes 为应用程序提供了一个简单的机制来宣传它们的存活性或就绪性，所以这是一个很好的起点。通常，Kubernetes 的存活性或就绪性探针非常简单；应用程序总是对任何请求回应“OK”。如果没有响应，Kubernetes 将认为其已宕机或未准备好。

然而，正如许多程序员从痛苦的经验中知道的那样，仅仅因为程序运行，并不一定意味着它能正常工作。一个更复杂的就绪性探针应该问：“这个应用程序为了完成工作需要什么？”

例如，如果需要与数据库交互，它可以检查是否有有效且响应迅速的数据库连接。如果依赖其他服务，它可以检查这些服务的可用性。（如果频繁运行健康检查，则不应执行会影响真实用户请求服务的昂贵操作。）

注意，我们仍然对准备探测给出二进制的是/否响应。只是这是一个更为明智的回答。我们试图回答的问题是：“用户是否满意？”尽可能准确地回答这个问题。

### 服务和熔断器

正如您所知，如果容器的“存活性”检查失败，Kubernetes 将自动以指数回退的循环重新启动它。但在容器没有问题的情况下，其某个依赖关系失败时，这并不真正有帮助。另一方面，失败的“就绪性”检查的语义是：“我没问题，但当前无法为用户请求提供服务。”

在这种情况下，容器将被从它是后端的任何服务中移除，并且 Kubernetes 将停止向其发送请求，直到它再次就绪。这是处理失败依赖关系的更好方法。

假设你有一条由 10 个微服务组成的链条，每个微服务都依赖于下一个微服务的某个关键部分工作。链条中最后一个服务失败了。倒数第二个服务会检测到这一点，并开始失败其准备探测。Kubernetes 会将其断开连接，而下一个服务检测到这一点，依此类推。最终，前端服务将失败，并（希望）会触发封闭盒监控警报。

一旦基础服务的问题得到解决，或者可能通过自动重新启动来治愈，链中的所有其他服务将自动依次恢复就绪状态，而无需重新启动或丢失任何状态。这是所谓的[*断路器模式*](https://oreil.ly/F3lKZ)的一个例子。当应用检测到下游故障时，通过就绪检查将自己从服务中移出，以防止向其发送更多请求，直到问题解决为止。

### 优雅降级

尽管断路器对尽快展现问题很有用，但您应该设计您的服务，避免在一个或多个组件服务不可用时使整个系统失败。相反，尝试使您的服务*优雅降级*：即使它们不能完成它们应该做的一切，也许它们仍然可以做一些事情。

在分布式系统中，我们必须假设服务、组件和连接将会以神秘和间歇性的方式经常失败。一个具有弹性的系统可以在不完全失败的情况下处理这一点。

# 概要

关于监控和可观测性的主题有很多要说的。我们希望本章为您提供了一些关于传统监控技术的有用信息，它们能做什么，不能做什么，以及在云原生环境中需要如何适应。

*可观测性* 的概念使我们了解到比传统日志文件和封闭盒检查更广阔的视角。指标在这个视角中占据重要位置，在下一章也是最后一章中，我们将深入探讨 Kubernetes 中指标的世界。

在翻页之前，你可能想起这些关键点：

+   封闭盒监控检查观察系统的外部行为，以检测可预测的故障。

+   分布式系统暴露了传统监控的局限性，因为它们不处于*上*或*下*状态：它们存在于部分降级服务的不断状态。换句话说，在船上没有什么是完全正确的。

+   日志对事后故障排除很有用，但它们的扩展成本高昂。Loki 和 ELK 是流行的集中式日志记录工具。

+   指标开启了一个新的维度，超越了简单的*工作*/*不工作*状态，并且为您的系统的数百或数千个方面提供了持续的数值时间序列数据。Prometheus 是聚合应用指标的一个流行选项。

+   指标可以帮助您回答“为什么？”的问题，以及在导致停机之前识别问题趋势。

+   跟踪通过个别请求的整个生命周期精确记录事件的时间，帮助您调试性能问题。Jaeger、Zipkin 和 Pixie 是提供应用程序跟踪的一些工具示例。

+   可观测性是传统监控、日志记录、指标和跟踪的结合，以及您可以了解系统的所有其他方式。

+   可观测性还代表了一个基于事实和反馈的工程团队文化的转变。

+   依然很重要的是确保你的面向用户的服务处于运行状态，通过外部的闭合盒检查，但不要试图自己构建：使用像 Uptime Robot 这样的第三方监控服务。

+   如果用户不满意，99.999% 的可用性也毫无意义。

¹ [“云规模系统的致命弱点：灰失败”](https://blog.acolyer.org)，作者 Adrian Colyer，2017 年 6 月。

² [“在 Kubernetes 上使用 Jaeger 的分布式跟踪基础设施”](https://medium.com/@masroor.hasan)，作者 Masroor Hasan，2018 年 9 月。
